{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\u624b\u6478\u624b Redis \u6280\u672f\u4e0e\u5b9e\u6218\u6559\u7a0b Started at Jan. 2021 By Jacob Xi \u5185\u5bb9\u7b80\u4ecb \u672c\u4e66\u662f\u672c\u4eba\u7684\u201c\u624b\u6478\u624b\u6218\u672f\u6559\u7a0b\u201d\u7cfb\u5217\u7684\u7b2c\u4e09\u672c\uff0c\u5386\u7ecf\u4e24\u4e2a\u6708\u7684\u65f6\u95f4\uff0c\u7ec8\u4e8e\u4f34\u968f\u77402021\u5e74\u6625\u8282\u524d\u62ff\u672c\ud83c\udfe1\u548c\u6625\u8282\u5047\u671f\u671f\u95f4\ud83c\udf86\u5145\u7535\u5b8c\u6210\ud83c\udf4b\uff0c\u611f\u8c22\u5bb6\u4eba\uff0c\u670b\u53cb\uff0c\u540c\u4e8b\u4eec\u7684\u652f\u6301\u4e0e\u7406\u89e3\uff0c\u4e5f\u611f\u8c22\u6240\u5728team\u540c\u4e8b\u4eec\u7684\u5e2e\u52a9\u4e0e\u6307\u5bfc\u3002\u4e3a\u4e86\u8fd8\u8d37\uff01\uff01\uff01\ud83d\ude01 #\u987a\u4fbf\u6c42\u4e00\u4e2aCloudhouse\u7684\u9080\u8bf7 Previous on \u624b\u6478\u624b \u624b\u6478\u624b Jenkins \u6218\u672f\u6559\u7a0b (\u5927\u5e08\u7248\uff09 \u624b\u6478\u624b Elasticsearch7 \u6280\u672f\u4e0e\u5b9e\u6218\u6559\u7a0b \u672c\u4e66\u4e3b\u8981\u5185\u5bb9 \u672c\u4e66\u517110\u7ae0\u7740\u91cd\u4ecb\u7ecd\u4e86Redis\u6838\u5fc3\u57fa\u7840\u6570\u636e\u7ed3\u6784\uff0cAOF\u65e5\u5fd7\uff0cRDB\u5907\u4efd\uff0cRedis\u4e3b\u4ece\u6570\u636e\u540c\u6b65\uff0c\u54e8\u5175\u673a\u5236\uff0cRedis Cluster, \u5207\u7247\u96c6\u7fa4\uff0cBigkey\u963b\u585e\u67e5\u8be2\uff0cRedis\u7f13\u51b2\u533a\uff0c\u65c1\u8def\u7f13\u5b58\uff0cLRU-LFU\u7f13\u5b58\u66ff\u6362\u7b56\u7565\uff0c\u7f13\u5b58\u51fb\u7a7f\uff0c\u7f13\u5b58\u96ea\u5d29\uff0c\u7f13\u5b58\u7a7f\u900f\uff0c\u7f13\u5b58\u6c61\u67d3\uff0cACID & Locks & Pika, Codis, Gossip, \u8111\u88c2\uff0c\u6570\u636e\u503e\u659c\uff0cRedis6.0,NVM, RESP, Redis on K8s \u4ee5\u53ca\u671f\u4e2d\u671f\u672b\u7efc\u5408\u8003\u9898 Comment ca va? C'est Moi Hello, this is me, Jacob. Currently, I'm working as DevOps and Cloud Engineer in SAP, and I'm the certified AWS Solution Architect and Certified Azure Administrator, Kubernetes Specialist, Jenkins CI/CD and ElasticStack enthusiast. I was working as Backend Engineer in New York City and achieved my CS master degree in SIT, America. Believe it or not, I'll keep writing, more and more books will come out at such dramatic and unprecedented 2021. If you have anything want to talk to me directly, you can reach out for via email xichao2015@outlook.com\u3002 Salute, c'est moi, Jacob. Actuellement, je travaille en tant qu'ing\u00e9nieur DevOps et Cloud dans SAP, et je suis architecte de solution AWS certifi\u00e9 et administrateur Azure certifi\u00e9, sp\u00e9cialiste Kubernetes et passionn\u00e9 de CI/CD. Je travaillais en tant qu'ing\u00e9nieur backend \u00e0 New York et j'ai obtenu mon master CS \u00e0 SIT, en Am\u00e9rique. Croyez-le ou non, je continuerai \u00e0 \u00e9crire, de plus en plus de livres sortiront cette ann\u00e9e. \u76ee\u5f55\u5927\u7eb2 \u7b2c\u4e00\u7ae0 Redis \u6982\u8ff0 \u7b2c\u4e00\u8282 Redis \u4e0d\u5f97\u4e0d\u53bb\u638c\u63e1\u7684\u5173\u952e \u7b2c\u4e8c\u7ae0 Redis\u57fa\u7840\u7bc7 \u7b2c\u4e00\u8282 \u57fa\u672c\u67b6\u6784\uff1a \u952e\u503c\u6570\u636e\u5e93 \u7b2c\u4e8c\u8282 \u6570\u636e\u7ed3\u6784\uff1aRedis\u4e3a\u4ec0\u4e48\u90a3\u4e48\u5feb\uff1f \u7b2c\u4e09\u8282 \u9ad8\u6027\u80fdIO\u6a21\u578b\uff1aRedis\u4e3a\u4ec0\u4e48\u90a3\u4e48\u5feb\uff1f \u7b2c\u56db\u8282 Redis\u5b95\u673a\uff0c\u5982\u4f55\u907f\u514d\u6570\u636e\u4e22\u5931\uff1aAOF(Append Only File)\u65e5\u5fd7 \u7b2c\u4e94\u8282 Redis\u5b95\u673a\uff0cRedis\u5982\u4f55\u5b9e\u73b0\u5feb\u901f\u6062\u590dRDB \u7b2c\u516d\u8282 \u6570\u636e\u540c\u6b65\uff1a\u4e3b\u4ece\u5e93\u6570\u636e\u4e00\u81f4 \u7b2c\u4e03\u8282 \u54e8\u5175\u673a\u5236\uff1a\u4e3b\u5e93\u4e0d\u95f4\u65ad\u670d\u52a1 \u7b2c\u516b\u8282 \u54e8\u5175\u96c6\u7fa4\uff1a\u54e8\u5175\u6302\u4e86\uff0c\u4e3b\u4ece\u5e93\u5207\u6362 \u7b2c\u4e5d\u8282 \u5207\u7247\u96c6\u7fa4\uff1a\u6570\u636e\u589e\u591a\u4e86\uff0c\u662f\u8be5\u52a0\u5185\u5b58\u8fd8\u662f\u52a0\u5b9e\u4f8b \u7b2c\u4e8c\u7ae0 Redis\u6838\u5fc3\u6280\u672f\u57fa\u7840\u603b\u7ed3\u7bc7 \u7b2c\u4e09\u7ae0 Redis\u6570\u636e\u7ed3\u6784 \u7b2c\u4e00\u8282 Redis\u7684String\u7c7b\u578b\u6570\u636e\u7ed3\u6784\uff0c\u53ca\u5176\u5e95\u5c42\u5b9e\u73b0 \u7b2c\u4e8c\u8282 Redis\u6709\u90a3\u4e9b\u6570\u636e\u7ed3\u6784\u9002\u5408\u505a\u7edf\u8ba1 \u7b2c\u4e09\u8282 GEO\uff0c\u4e00\u79cd\u53ef\u4ee5\u5b9e\u73b0LBS\u670d\u52a1\u7684\u6570\u636e\u7ed3\u6784 \u7b2c\u56db\u8282 \u6839\u636e\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u7279\u70b9\uff0c\u9009\u62e9\u5408\u9002\u7684\u5b58\u50a8\u65b9\u6848 \u7b2c\u4e94\u8282 \u5982\u4f55\u4f7f\u7528redis\u5b9e\u73b0\u6d88\u606f\u961f\u5217\u7684\u9700\u6c42 \u7b2c\u4e09\u7ae0 Redis \u7684\u6570\u636e\u7ed3\u6784 \u7b2c\u56db\u7ae0 Redis\u6027\u80fd\u5f71\u54cd\u56e0\u5b50 \u7b2c\u4e00\u8282 Redis\u6709\u54ea\u4e9b\u53ef\u80fd\u5bfc\u81f4\u963b\u585e\u7684\u64cd\u4f5c\uff0c\u4ee5\u53ca\u89e3\u51b3\u673a\u5236 \u7b2c\u4e8c\u8282 \u5728\u591a\u6838CPU\u67b6\u6784\u548cNUMA\u67b6\u6784\u4e0b\u5bf9redis\u8fdb\u884c\u4f18\u5316\u914d\u7f6e \u7b2c\u4e09\u8282 \u5f53redis\u67e5\u8be2\u53d8\u6162\u4e86\u600e\u4e48\u529e\uff1f \u7b2c\u56db\u8282 \u5220\u9664\u6570\u636e\u540e\uff0c\u5185\u5b58\u5360\u7528\u7387\u8fd8\u662f\u5f88\u9ad8 \u7b2c\u4e94\u8282 Redis\u7f13\u51b2\u533a \u7b2c\u56db\u7ae0 Redis \u5f71\u54cd\u6027\u80fd\u7684\u6f5c\u5728\u56e0\u7d20 \u7b2c\u4e94\u7ae0 Redis\u7f13\u5b58\u4ecb\u7ecd \u7b2c\u4e00\u8282 Redis \u65c1\u8def\u7f13\u5b58 \u7b2c\u4e8c\u8282 \u7f13\u5b58\u6ee1\u540e\u7684\u66ff\u6362\u7b56\u7565 \u7b2c\u4e09\u8282 \u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u7f13\u5b58\u5f02\u5e38 \u7b2c\u56db\u8282 \u7f13\u5b58\u88ab\u6c61\u67d3\u7684\u89e3\u51b3\u95ee\u9898 \u7b2c\u4e94\u7ae0 Redis \u7f13\u5b58\u603b\u7ed3 \u7b2c\u516d\u7ae0 Redis\u6027\u80fd\u4e0e\u9501\u673a\u5236\u4ee5\u53caACID \u7b2c\u4e00\u8282 \u57fa\u4e8eSSD\u5b9e\u73b0\u5927\u5bb9\u91cfRedis:Pika \u7b2c\u4e8c\u8282 Redis\u5e94\u5bf9\u5e76\u53d1\u8bbf\u95ee\uff1a\u65e0\u9501\u7684\u539f\u5b50\u64cd\u4f5c \u7b2c\u4e09\u8282 Redis\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501 \u7b2c\u56db\u8282 \u4e8b\u52a1\u673a\u5236 Redis\u5b9e\u73b0ACID\u5c5e\u6027 \u7b2c\u516d\u7ae0 Redis\u6027\u80fd\u4e0e\u9501\u673a\u5236\u4ee5\u53caACID \u7b2c\u4e03\u7ae0 Redis Cluster\u96c6\u7fa4\u4ecb\u7ecd\u53ca\u7ba1\u7406 \u7b2c\u4e00\u8282 Redis\u4e3b\u4ece\u540c\u6b65\u4e0e\u6545\u969c\u5207\u6362\u7684\u4e09\u4e2a\u5751 \u7b2c\u4e8c\u8282 \u8111\u88c2\u5bfc\u81f4\u6570\u636e\u4e22\u5931 \u7b2c\u4e09\u8282 Redis Codis \u96c6\u7fa4\u65b9\u6848 \u7b2c\u56db\u8282 Redis\u652f\u6491\u79d2\u6740\u573a\u666f\u7684\u5173\u952e\u6280\u672f\u548c\u5b9e\u8df5 \u7b2c\u4e94\u8282 \u6570\u636e\u5206\u5e03\u4f18\u5316\u5e94\u5bf9\u6570\u636e\u503e\u659c \u7b2c\u516d\u8282 \u9650\u5236Redis Cluster\u89c4\u6a21\u7684\u5173\u952e\u56e0\u7d20\uff1a\u901a\u4fe1\u5f00\u9500 \u7b2c\u4e03\u8282 Redis \u9ad8\u53ef\u7528\u6027\u89e3\u51b3\u65b9\u6848 \u7b2c\u4e03\u7ae0 Redis Cluster\u96c6\u7fa4\u4ecb\u7ecd\u53ca\u7ba1\u7406 \u7b2c\u516b\u7ae0 Redis\u5b66\u4e60\u4e0e\u64cd\u4f5c \u7b2c\u4e00\u8282 Redis 6.0\u7684\u65b0\u7279\u6027\uff1a\u591a\u7ebf\u7a0b\u3001\u5ba2\u6237\u7aef\u7f13\u5b58\u4e0e\u5b89\u5168 \u7b2c\u4e8c\u8282 Redis \u57fa\u4e8eNVM\u5185\u5b58\u7684\u5b9e\u8df5 \u7b2c\u4e09\u8282 Redis\u5ba2\u6237\u7aef\u5982\u4f55\u4e0e\u670d\u52a1\u5668\u7aef\u4ea4\u6362\u547d\u4ee4\u548c\u6570\u636e RESP \u7b2c\u56db\u8282 Redis\u8fd0\u7ef4\u5de5\u5177 \u7b2c\u4e94\u8282 Redis\u7684\u4f7f\u7528\u89c4\u8303 \u7b2c\u516d\u8282 Redis\u5982\u4f55\u5220\u9664\u6570\u91cf\u8fc7\u4e07\u4ee5\u4e0aKey\u800c\u4e0d\u5f71\u54cd\u4e1a\u52a1 \u7b2c\u516b\u7ae0 Redis\u5b66\u4e60\u4e0e\u64cd\u4f5c\u603b\u7ed3 \u5de5\u5177\u8865\u51451\uff1aredis-shake\u6570\u636e\u540c\u6b65\u548c\u6570\u636e\u8fc1\u79fb \u7b2c\u4e5d\u7ae0 \u4f7f\u7528k8s\u5b89\u88c5Redis\u96c6\u7fa4 \u7b2c\u4e00\u8282 Kubernetes\u4e0a\u901a\u8fc7sts\u6d4b\u8bd5Redis Cluster\u96c6\u7fa4 \u7b2c\u4e8c\u8282 \u5229\u7528ConfigMap\u8bbe\u7f6e\u5b89\u88c5 Redis \u7b2c\u5341\u7ae0 \u671f\u672b\u603b\u7ed3\u7ae0 Redis \u6838\u5fc3\u6280\u672f\u8003\u9898 Redis \u57fa\u7840\u4f60\u638c\u63e1\u591a\u5c11\u4e86\uff1f\u6765\u4e2a\u67e5\u6f0f\u8865\u7f3a 40 \u9053Redis\u9762\u8bd5\u9898 115 \u9053 Redis \u9762\u8bd5\u9898\u89e3\u7b54 To be continue \u672c\u4eba\u5c06\u5e26\u6765\u624b\u6478\u624b\u6218\u672f\u6559\u7a0b\u66f4\u591a\u7684\u5185\u5bb9\u548c\u6587\u7ae0\uff0c \u63a5\u4e0b\u6765\u7684\u5c06\u5728Datatase, Linux\u6027\u80fd, Golang, Chef, Azure900, Azure103, AWS Solution Arcitect, AWS Big Data Speciality, Istio, Python\u5e26\u6765\u66f4\u591a\u66f4\u5168\u9762\u7684\u7535\u5b50\u4e66\uff0c\u656c\u8bf7\u671f\u5f85\u3002","title":"Welcome"},{"location":"#redis","text":"Started at Jan. 2021 By Jacob Xi","title":"\u624b\u6478\u624b Redis \u6280\u672f\u4e0e\u5b9e\u6218\u6559\u7a0b"},{"location":"#_1","text":"\u672c\u4e66\u662f\u672c\u4eba\u7684\u201c\u624b\u6478\u624b\u6218\u672f\u6559\u7a0b\u201d\u7cfb\u5217\u7684\u7b2c\u4e09\u672c\uff0c\u5386\u7ecf\u4e24\u4e2a\u6708\u7684\u65f6\u95f4\uff0c\u7ec8\u4e8e\u4f34\u968f\u77402021\u5e74\u6625\u8282\u524d\u62ff\u672c\ud83c\udfe1\u548c\u6625\u8282\u5047\u671f\u671f\u95f4\ud83c\udf86\u5145\u7535\u5b8c\u6210\ud83c\udf4b\uff0c\u611f\u8c22\u5bb6\u4eba\uff0c\u670b\u53cb\uff0c\u540c\u4e8b\u4eec\u7684\u652f\u6301\u4e0e\u7406\u89e3\uff0c\u4e5f\u611f\u8c22\u6240\u5728team\u540c\u4e8b\u4eec\u7684\u5e2e\u52a9\u4e0e\u6307\u5bfc\u3002\u4e3a\u4e86\u8fd8\u8d37\uff01\uff01\uff01\ud83d\ude01 #\u987a\u4fbf\u6c42\u4e00\u4e2aCloudhouse\u7684\u9080\u8bf7","title":"\u5185\u5bb9\u7b80\u4ecb"},{"location":"#previous-on","text":"\u624b\u6478\u624b Jenkins \u6218\u672f\u6559\u7a0b (\u5927\u5e08\u7248\uff09 \u624b\u6478\u624b Elasticsearch7 \u6280\u672f\u4e0e\u5b9e\u6218\u6559\u7a0b","title":"Previous on \u624b\u6478\u624b"},{"location":"#_2","text":"\u672c\u4e66\u517110\u7ae0\u7740\u91cd\u4ecb\u7ecd\u4e86Redis\u6838\u5fc3\u57fa\u7840\u6570\u636e\u7ed3\u6784\uff0cAOF\u65e5\u5fd7\uff0cRDB\u5907\u4efd\uff0cRedis\u4e3b\u4ece\u6570\u636e\u540c\u6b65\uff0c\u54e8\u5175\u673a\u5236\uff0cRedis Cluster, \u5207\u7247\u96c6\u7fa4\uff0cBigkey\u963b\u585e\u67e5\u8be2\uff0cRedis\u7f13\u51b2\u533a\uff0c\u65c1\u8def\u7f13\u5b58\uff0cLRU-LFU\u7f13\u5b58\u66ff\u6362\u7b56\u7565\uff0c\u7f13\u5b58\u51fb\u7a7f\uff0c\u7f13\u5b58\u96ea\u5d29\uff0c\u7f13\u5b58\u7a7f\u900f\uff0c\u7f13\u5b58\u6c61\u67d3\uff0cACID & Locks & Pika, Codis, Gossip, \u8111\u88c2\uff0c\u6570\u636e\u503e\u659c\uff0cRedis6.0,NVM, RESP, Redis on K8s \u4ee5\u53ca\u671f\u4e2d\u671f\u672b\u7efc\u5408\u8003\u9898","title":"\u672c\u4e66\u4e3b\u8981\u5185\u5bb9"},{"location":"#comment-ca-va-cest-moi","text":"Hello, this is me, Jacob. Currently, I'm working as DevOps and Cloud Engineer in SAP, and I'm the certified AWS Solution Architect and Certified Azure Administrator, Kubernetes Specialist, Jenkins CI/CD and ElasticStack enthusiast. I was working as Backend Engineer in New York City and achieved my CS master degree in SIT, America. Believe it or not, I'll keep writing, more and more books will come out at such dramatic and unprecedented 2021. If you have anything want to talk to me directly, you can reach out for via email xichao2015@outlook.com\u3002 Salute, c'est moi, Jacob. Actuellement, je travaille en tant qu'ing\u00e9nieur DevOps et Cloud dans SAP, et je suis architecte de solution AWS certifi\u00e9 et administrateur Azure certifi\u00e9, sp\u00e9cialiste Kubernetes et passionn\u00e9 de CI/CD. Je travaillais en tant qu'ing\u00e9nieur backend \u00e0 New York et j'ai obtenu mon master CS \u00e0 SIT, en Am\u00e9rique. Croyez-le ou non, je continuerai \u00e0 \u00e9crire, de plus en plus de livres sortiront cette ann\u00e9e.","title":"Comment ca va? C'est Moi"},{"location":"#_3","text":"\u7b2c\u4e00\u7ae0 Redis \u6982\u8ff0 \u7b2c\u4e00\u8282 Redis \u4e0d\u5f97\u4e0d\u53bb\u638c\u63e1\u7684\u5173\u952e \u7b2c\u4e8c\u7ae0 Redis\u57fa\u7840\u7bc7 \u7b2c\u4e00\u8282 \u57fa\u672c\u67b6\u6784\uff1a \u952e\u503c\u6570\u636e\u5e93 \u7b2c\u4e8c\u8282 \u6570\u636e\u7ed3\u6784\uff1aRedis\u4e3a\u4ec0\u4e48\u90a3\u4e48\u5feb\uff1f \u7b2c\u4e09\u8282 \u9ad8\u6027\u80fdIO\u6a21\u578b\uff1aRedis\u4e3a\u4ec0\u4e48\u90a3\u4e48\u5feb\uff1f \u7b2c\u56db\u8282 Redis\u5b95\u673a\uff0c\u5982\u4f55\u907f\u514d\u6570\u636e\u4e22\u5931\uff1aAOF(Append Only File)\u65e5\u5fd7 \u7b2c\u4e94\u8282 Redis\u5b95\u673a\uff0cRedis\u5982\u4f55\u5b9e\u73b0\u5feb\u901f\u6062\u590dRDB \u7b2c\u516d\u8282 \u6570\u636e\u540c\u6b65\uff1a\u4e3b\u4ece\u5e93\u6570\u636e\u4e00\u81f4 \u7b2c\u4e03\u8282 \u54e8\u5175\u673a\u5236\uff1a\u4e3b\u5e93\u4e0d\u95f4\u65ad\u670d\u52a1 \u7b2c\u516b\u8282 \u54e8\u5175\u96c6\u7fa4\uff1a\u54e8\u5175\u6302\u4e86\uff0c\u4e3b\u4ece\u5e93\u5207\u6362 \u7b2c\u4e5d\u8282 \u5207\u7247\u96c6\u7fa4\uff1a\u6570\u636e\u589e\u591a\u4e86\uff0c\u662f\u8be5\u52a0\u5185\u5b58\u8fd8\u662f\u52a0\u5b9e\u4f8b \u7b2c\u4e8c\u7ae0 Redis\u6838\u5fc3\u6280\u672f\u57fa\u7840\u603b\u7ed3\u7bc7 \u7b2c\u4e09\u7ae0 Redis\u6570\u636e\u7ed3\u6784 \u7b2c\u4e00\u8282 Redis\u7684String\u7c7b\u578b\u6570\u636e\u7ed3\u6784\uff0c\u53ca\u5176\u5e95\u5c42\u5b9e\u73b0 \u7b2c\u4e8c\u8282 Redis\u6709\u90a3\u4e9b\u6570\u636e\u7ed3\u6784\u9002\u5408\u505a\u7edf\u8ba1 \u7b2c\u4e09\u8282 GEO\uff0c\u4e00\u79cd\u53ef\u4ee5\u5b9e\u73b0LBS\u670d\u52a1\u7684\u6570\u636e\u7ed3\u6784 \u7b2c\u56db\u8282 \u6839\u636e\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u7279\u70b9\uff0c\u9009\u62e9\u5408\u9002\u7684\u5b58\u50a8\u65b9\u6848 \u7b2c\u4e94\u8282 \u5982\u4f55\u4f7f\u7528redis\u5b9e\u73b0\u6d88\u606f\u961f\u5217\u7684\u9700\u6c42 \u7b2c\u4e09\u7ae0 Redis \u7684\u6570\u636e\u7ed3\u6784 \u7b2c\u56db\u7ae0 Redis\u6027\u80fd\u5f71\u54cd\u56e0\u5b50 \u7b2c\u4e00\u8282 Redis\u6709\u54ea\u4e9b\u53ef\u80fd\u5bfc\u81f4\u963b\u585e\u7684\u64cd\u4f5c\uff0c\u4ee5\u53ca\u89e3\u51b3\u673a\u5236 \u7b2c\u4e8c\u8282 \u5728\u591a\u6838CPU\u67b6\u6784\u548cNUMA\u67b6\u6784\u4e0b\u5bf9redis\u8fdb\u884c\u4f18\u5316\u914d\u7f6e \u7b2c\u4e09\u8282 \u5f53redis\u67e5\u8be2\u53d8\u6162\u4e86\u600e\u4e48\u529e\uff1f \u7b2c\u56db\u8282 \u5220\u9664\u6570\u636e\u540e\uff0c\u5185\u5b58\u5360\u7528\u7387\u8fd8\u662f\u5f88\u9ad8 \u7b2c\u4e94\u8282 Redis\u7f13\u51b2\u533a \u7b2c\u56db\u7ae0 Redis \u5f71\u54cd\u6027\u80fd\u7684\u6f5c\u5728\u56e0\u7d20 \u7b2c\u4e94\u7ae0 Redis\u7f13\u5b58\u4ecb\u7ecd \u7b2c\u4e00\u8282 Redis \u65c1\u8def\u7f13\u5b58 \u7b2c\u4e8c\u8282 \u7f13\u5b58\u6ee1\u540e\u7684\u66ff\u6362\u7b56\u7565 \u7b2c\u4e09\u8282 \u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u7f13\u5b58\u5f02\u5e38 \u7b2c\u56db\u8282 \u7f13\u5b58\u88ab\u6c61\u67d3\u7684\u89e3\u51b3\u95ee\u9898 \u7b2c\u4e94\u7ae0 Redis \u7f13\u5b58\u603b\u7ed3 \u7b2c\u516d\u7ae0 Redis\u6027\u80fd\u4e0e\u9501\u673a\u5236\u4ee5\u53caACID \u7b2c\u4e00\u8282 \u57fa\u4e8eSSD\u5b9e\u73b0\u5927\u5bb9\u91cfRedis:Pika \u7b2c\u4e8c\u8282 Redis\u5e94\u5bf9\u5e76\u53d1\u8bbf\u95ee\uff1a\u65e0\u9501\u7684\u539f\u5b50\u64cd\u4f5c \u7b2c\u4e09\u8282 Redis\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501 \u7b2c\u56db\u8282 \u4e8b\u52a1\u673a\u5236 Redis\u5b9e\u73b0ACID\u5c5e\u6027 \u7b2c\u516d\u7ae0 Redis\u6027\u80fd\u4e0e\u9501\u673a\u5236\u4ee5\u53caACID \u7b2c\u4e03\u7ae0 Redis Cluster\u96c6\u7fa4\u4ecb\u7ecd\u53ca\u7ba1\u7406 \u7b2c\u4e00\u8282 Redis\u4e3b\u4ece\u540c\u6b65\u4e0e\u6545\u969c\u5207\u6362\u7684\u4e09\u4e2a\u5751 \u7b2c\u4e8c\u8282 \u8111\u88c2\u5bfc\u81f4\u6570\u636e\u4e22\u5931 \u7b2c\u4e09\u8282 Redis Codis \u96c6\u7fa4\u65b9\u6848 \u7b2c\u56db\u8282 Redis\u652f\u6491\u79d2\u6740\u573a\u666f\u7684\u5173\u952e\u6280\u672f\u548c\u5b9e\u8df5 \u7b2c\u4e94\u8282 \u6570\u636e\u5206\u5e03\u4f18\u5316\u5e94\u5bf9\u6570\u636e\u503e\u659c \u7b2c\u516d\u8282 \u9650\u5236Redis Cluster\u89c4\u6a21\u7684\u5173\u952e\u56e0\u7d20\uff1a\u901a\u4fe1\u5f00\u9500 \u7b2c\u4e03\u8282 Redis \u9ad8\u53ef\u7528\u6027\u89e3\u51b3\u65b9\u6848 \u7b2c\u4e03\u7ae0 Redis Cluster\u96c6\u7fa4\u4ecb\u7ecd\u53ca\u7ba1\u7406 \u7b2c\u516b\u7ae0 Redis\u5b66\u4e60\u4e0e\u64cd\u4f5c \u7b2c\u4e00\u8282 Redis 6.0\u7684\u65b0\u7279\u6027\uff1a\u591a\u7ebf\u7a0b\u3001\u5ba2\u6237\u7aef\u7f13\u5b58\u4e0e\u5b89\u5168 \u7b2c\u4e8c\u8282 Redis \u57fa\u4e8eNVM\u5185\u5b58\u7684\u5b9e\u8df5 \u7b2c\u4e09\u8282 Redis\u5ba2\u6237\u7aef\u5982\u4f55\u4e0e\u670d\u52a1\u5668\u7aef\u4ea4\u6362\u547d\u4ee4\u548c\u6570\u636e RESP \u7b2c\u56db\u8282 Redis\u8fd0\u7ef4\u5de5\u5177 \u7b2c\u4e94\u8282 Redis\u7684\u4f7f\u7528\u89c4\u8303 \u7b2c\u516d\u8282 Redis\u5982\u4f55\u5220\u9664\u6570\u91cf\u8fc7\u4e07\u4ee5\u4e0aKey\u800c\u4e0d\u5f71\u54cd\u4e1a\u52a1 \u7b2c\u516b\u7ae0 Redis\u5b66\u4e60\u4e0e\u64cd\u4f5c\u603b\u7ed3 \u5de5\u5177\u8865\u51451\uff1aredis-shake\u6570\u636e\u540c\u6b65\u548c\u6570\u636e\u8fc1\u79fb \u7b2c\u4e5d\u7ae0 \u4f7f\u7528k8s\u5b89\u88c5Redis\u96c6\u7fa4 \u7b2c\u4e00\u8282 Kubernetes\u4e0a\u901a\u8fc7sts\u6d4b\u8bd5Redis Cluster\u96c6\u7fa4 \u7b2c\u4e8c\u8282 \u5229\u7528ConfigMap\u8bbe\u7f6e\u5b89\u88c5 Redis \u7b2c\u5341\u7ae0 \u671f\u672b\u603b\u7ed3\u7ae0 Redis \u6838\u5fc3\u6280\u672f\u8003\u9898 Redis \u57fa\u7840\u4f60\u638c\u63e1\u591a\u5c11\u4e86\uff1f\u6765\u4e2a\u67e5\u6f0f\u8865\u7f3a 40 \u9053Redis\u9762\u8bd5\u9898 115 \u9053 Redis \u9762\u8bd5\u9898\u89e3\u7b54","title":"\u76ee\u5f55\u5927\u7eb2"},{"location":"#to-be-continue","text":"\u672c\u4eba\u5c06\u5e26\u6765\u624b\u6478\u624b\u6218\u672f\u6559\u7a0b\u66f4\u591a\u7684\u5185\u5bb9\u548c\u6587\u7ae0\uff0c \u63a5\u4e0b\u6765\u7684\u5c06\u5728Datatase, Linux\u6027\u80fd, Golang, Chef, Azure900, Azure103, AWS Solution Arcitect, AWS Big Data Speciality, Istio, Python\u5e26\u6765\u66f4\u591a\u66f4\u5168\u9762\u7684\u7535\u5b50\u4e66\uff0c\u656c\u8bf7\u671f\u5f85\u3002","title":"To be continue"},{"location":"chap1/1redis_intro/","text":"\u7b2c\u4e00\u8282 Redis \u4e0d\u5f97\u4e0d\u53bb\u638c\u63e1\u7684\u5173\u952e 1\u3001\u4e3a\u4ec0\u4e48\u8981\u5b66\u4e60Redis \u4f5c\u4e3a\u952e\u503c\u6570\u636e\u5e93\uff0cRedis \u7684\u5e94\u7528\u975e\u5e38\u5e7f\u6cdb, \u5982\u679c\u4f60\u662f\u540e\u7aef\u5de5\u7a0b\u5e08\uff0c\u6211\u731c\u4f60\u51fa\u53bb\u9762\u8bd5\uff0c\u516b\u6210\u90fd\u4f1a\u88ab\u95ee\u5230\u4e0e\u5b83 \u76f8\u5173\u7684\u6027\u80fd\u95ee\u9898 \u3002 \u6bd4\u5982\u8bf4\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u7684\u53ef\u9760\u6027\uff0cRedis \u9700\u8981\u5728\u78c1\u76d8\u4e0a\u8bfb\u5199 AOF \u548c RDB\uff0c\u4f46\u5728\u9ad8\u5e76\u53d1\u573a\u666f\u91cc\uff0c\u8fd9\u5c31\u4f1a\u76f4\u63a5\u5e26\u6765\u4e24\u4e2a\u65b0\u95ee\u9898\uff1a \u4e00\u4e2a\u662f\u5199 AOF \u548c RDB \u4f1a\u9020\u6210 Redis \u6027\u80fd\u6296\u52a8 \uff0c \u4e00\u4e2a\u662f Redis \u96c6\u7fa4\u6570\u636e\u540c\u6b65\u548c\u5b9e\u4f8b\u6062\u590d\u65f6\uff0c\u8bfb RDB \u6bd4\u8f83\u6162\uff0c\u9650\u5236\u4e86\u540c\u6b65\u548c\u6062\u590d\u901f\u5ea6 \u3002 RDB\uff1aRedis Database \u9ed8\u8ba4\u5f00\u542f\uff0c\u6307\u5b9a\u65f6\u95f4\u5185\u6267\u884c\u6307\u5b9a\u6b21\u6570\u5199\u64cd\u4f5c\uff0c\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5199\u5165\u78c1\u76d8 \u3002 AOF\uff1aAppend Only File \u9700\u8981\u624b\u52a8\u5f00\u542f\uff0c\u5b8c\u6574\u6027\u66f4\u9ad8\uff0c\u9ed8\u8ba4\u6bcf\u79d2\u5c06\u5199\u64cd\u4f5c\u65e5\u5fd7\u8ffd\u52a0\u5199\u5165\u5230\u78c1\u76d8 \u3002 \u5bf9\u4e8eRedis \u4e0d\u540c\u516c\u53f8\u7684\u201c\u73a9\u6cd5\u201d\u5374\u4e0d\u592a\u4e00\u6837\uff0c\u6bd4\u5982\u8bf4\uff0c \u6709\u505a\u7f13\u5b58\u7684\uff0c\u6709\u505a\u6570\u636e\u5e93\u7684\uff0c\u4e5f\u6709\u7528\u505a\u5206\u5e03\u5f0f\u9501\u7684 \u3002\u4e0d\u8fc7\uff0c\u4ed6\u4eec\u9047\u89c1\u7684\u201c\u5751\u201d\uff0c\u603b\u4f53\u6765\u8bf4\u96c6\u4e2d\u5728\u56db\u4e2a\u65b9\u9762\uff1a CPU \u4f7f\u7528\u4e0a\u7684\u201c\u5751\u201d\uff0c\u4f8b\u5982\u6570\u636e\u7ed3\u6784\u7684\u590d\u6742\u5ea6\u3001\u8de8 CPU \u6838\u7684\u8bbf\u95ee\uff1b \u5185\u5b58\u4f7f\u7528\u4e0a\u7684\u201c\u5751\u201d\uff0c\u4f8b\u5982\u4e3b\u4ece\u540c\u6b65\u548c AOF \u7684\u5185\u5b58\u7ade\u4e89\uff1b \u5b58\u50a8\u6301\u4e45\u5316\u4e0a\u7684\u201c\u5751\u201d\uff0c\u4f8b\u5982\u5728 SSD \u4e0a\u505a\u5feb\u7167\u7684\u6027\u80fd\u6296\u52a8\uff1b \u7f51\u7edc\u901a\u4fe1\u4e0a\u7684\u201c\u5751\u201d\uff0c\u4f8b\u5982\u591a\u5b9e\u4f8b\u65f6\u7684\u5f02\u5e38\u7f51\u7edc\u4e22\u5305\u3002 2\u3001\u600e\u6837\u5b66\u4e60Redis \u4e24\u5927\u7ef4\u5ea6\uff0c\u4e09\u5927\u4e3b\u7ebf \u4e24\u5927\u7ef4\u5ea6 \uff1a \u7cfb\u7edf\u7ef4\u5ea6\u548c\u5e94\u7528\u7ef4\u5ea6 \u4e09\u5927\u4e3b\u7ebf \uff1a \u4e5f\u5c31\u662f\u6307\u9ad8\u6027\u80fd\u3001\u9ad8\u53ef\u9760\u548c\u9ad8\u53ef\u6269\u5c55\uff08\u53ef\u4ee5\u7b80\u79f0\u4e3a\u201c\u4e09\u9ad8\u201d\uff09\u3002 2-1 \u4e09\u5927\u4e3b\u7ebf \u9ad8\u6027\u80fd\u4e3b\u7ebf\uff0c\u5305\u62ec\u7ebf\u7a0b\u6a21\u578b\u3001\u6570\u636e\u7ed3\u6784\u3001\u6301\u4e45\u5316\u3001\u7f51\u7edc\u6846\u67b6\uff1b \u9ad8\u53ef\u9760\u4e3b\u7ebf\uff0c\u5305\u62ec\u4e3b\u4ece\u590d\u5236\u3001\u54e8\u5175\u673a\u5236\uff1b \u9ad8\u53ef\u6269\u5c55\u4e3b\u7ebf\uff0c\u5305\u62ec\u6570\u636e\u5206\u7247\u3001\u8d1f\u8f7d\u5747\u8861 \u3002 2-2 Redis \u7684\u95ee\u9898\u753b\u50cf\u56fe \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u679c\u4f60\u9047\u5230\u4e86 Redis \u7684\u54cd\u5e94\u53d8\u6162\u95ee\u9898 \u5bf9\u7167\u7740\u8fd9\u5f20\u56fe\uff0c\u4f60\u5c31\u53ef\u4ee5\u53d1\u73b0\uff0c\u8fd9\u4e2a\u95ee\u9898\u548c Redis \u7684\u6027\u80fd\u4e3b\u7ebf\u76f8\u5173\uff0c\u800c\u6027\u80fd\u4e3b\u7ebf\u53c8\u548c\u6570\u636e\u7ed3\u6784\u3001\u5f02\u6b65\u673a\u5236\u3001RDB\u3001AOF \u91cd\u5199\u76f8\u5173\u3002\u627e\u5230\u4e86\u5f71\u54cd\u7684\u56e0\u7d20\uff0c\u89e3\u51b3\u8d77\u6765\u4e5f\u5c31\u5f88\u5bb9\u6613\u4e86\u3002","title":"\u7b2c\u4e00\u8282 Redis \u4e0d\u5f97\u4e0d\u53bb\u638c\u63e1\u7684\u5173\u952e"},{"location":"chap1/1redis_intro/#redis","text":"","title":"\u7b2c\u4e00\u8282 Redis \u4e0d\u5f97\u4e0d\u53bb\u638c\u63e1\u7684\u5173\u952e"},{"location":"chap1/1redis_intro/#1redis","text":"\u4f5c\u4e3a\u952e\u503c\u6570\u636e\u5e93\uff0cRedis \u7684\u5e94\u7528\u975e\u5e38\u5e7f\u6cdb, \u5982\u679c\u4f60\u662f\u540e\u7aef\u5de5\u7a0b\u5e08\uff0c\u6211\u731c\u4f60\u51fa\u53bb\u9762\u8bd5\uff0c\u516b\u6210\u90fd\u4f1a\u88ab\u95ee\u5230\u4e0e\u5b83 \u76f8\u5173\u7684\u6027\u80fd\u95ee\u9898 \u3002 \u6bd4\u5982\u8bf4\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u7684\u53ef\u9760\u6027\uff0cRedis \u9700\u8981\u5728\u78c1\u76d8\u4e0a\u8bfb\u5199 AOF \u548c RDB\uff0c\u4f46\u5728\u9ad8\u5e76\u53d1\u573a\u666f\u91cc\uff0c\u8fd9\u5c31\u4f1a\u76f4\u63a5\u5e26\u6765\u4e24\u4e2a\u65b0\u95ee\u9898\uff1a \u4e00\u4e2a\u662f\u5199 AOF \u548c RDB \u4f1a\u9020\u6210 Redis \u6027\u80fd\u6296\u52a8 \uff0c \u4e00\u4e2a\u662f Redis \u96c6\u7fa4\u6570\u636e\u540c\u6b65\u548c\u5b9e\u4f8b\u6062\u590d\u65f6\uff0c\u8bfb RDB \u6bd4\u8f83\u6162\uff0c\u9650\u5236\u4e86\u540c\u6b65\u548c\u6062\u590d\u901f\u5ea6 \u3002 RDB\uff1aRedis Database \u9ed8\u8ba4\u5f00\u542f\uff0c\u6307\u5b9a\u65f6\u95f4\u5185\u6267\u884c\u6307\u5b9a\u6b21\u6570\u5199\u64cd\u4f5c\uff0c\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5199\u5165\u78c1\u76d8 \u3002 AOF\uff1aAppend Only File \u9700\u8981\u624b\u52a8\u5f00\u542f\uff0c\u5b8c\u6574\u6027\u66f4\u9ad8\uff0c\u9ed8\u8ba4\u6bcf\u79d2\u5c06\u5199\u64cd\u4f5c\u65e5\u5fd7\u8ffd\u52a0\u5199\u5165\u5230\u78c1\u76d8 \u3002 \u5bf9\u4e8eRedis \u4e0d\u540c\u516c\u53f8\u7684\u201c\u73a9\u6cd5\u201d\u5374\u4e0d\u592a\u4e00\u6837\uff0c\u6bd4\u5982\u8bf4\uff0c \u6709\u505a\u7f13\u5b58\u7684\uff0c\u6709\u505a\u6570\u636e\u5e93\u7684\uff0c\u4e5f\u6709\u7528\u505a\u5206\u5e03\u5f0f\u9501\u7684 \u3002\u4e0d\u8fc7\uff0c\u4ed6\u4eec\u9047\u89c1\u7684\u201c\u5751\u201d\uff0c\u603b\u4f53\u6765\u8bf4\u96c6\u4e2d\u5728\u56db\u4e2a\u65b9\u9762\uff1a CPU \u4f7f\u7528\u4e0a\u7684\u201c\u5751\u201d\uff0c\u4f8b\u5982\u6570\u636e\u7ed3\u6784\u7684\u590d\u6742\u5ea6\u3001\u8de8 CPU \u6838\u7684\u8bbf\u95ee\uff1b \u5185\u5b58\u4f7f\u7528\u4e0a\u7684\u201c\u5751\u201d\uff0c\u4f8b\u5982\u4e3b\u4ece\u540c\u6b65\u548c AOF \u7684\u5185\u5b58\u7ade\u4e89\uff1b \u5b58\u50a8\u6301\u4e45\u5316\u4e0a\u7684\u201c\u5751\u201d\uff0c\u4f8b\u5982\u5728 SSD \u4e0a\u505a\u5feb\u7167\u7684\u6027\u80fd\u6296\u52a8\uff1b \u7f51\u7edc\u901a\u4fe1\u4e0a\u7684\u201c\u5751\u201d\uff0c\u4f8b\u5982\u591a\u5b9e\u4f8b\u65f6\u7684\u5f02\u5e38\u7f51\u7edc\u4e22\u5305\u3002","title":"1\u3001\u4e3a\u4ec0\u4e48\u8981\u5b66\u4e60Redis"},{"location":"chap1/1redis_intro/#2redis","text":"\u4e24\u5927\u7ef4\u5ea6\uff0c\u4e09\u5927\u4e3b\u7ebf \u4e24\u5927\u7ef4\u5ea6 \uff1a \u7cfb\u7edf\u7ef4\u5ea6\u548c\u5e94\u7528\u7ef4\u5ea6 \u4e09\u5927\u4e3b\u7ebf \uff1a \u4e5f\u5c31\u662f\u6307\u9ad8\u6027\u80fd\u3001\u9ad8\u53ef\u9760\u548c\u9ad8\u53ef\u6269\u5c55\uff08\u53ef\u4ee5\u7b80\u79f0\u4e3a\u201c\u4e09\u9ad8\u201d\uff09\u3002","title":"2\u3001\u600e\u6837\u5b66\u4e60Redis"},{"location":"chap1/1redis_intro/#2-1","text":"\u9ad8\u6027\u80fd\u4e3b\u7ebf\uff0c\u5305\u62ec\u7ebf\u7a0b\u6a21\u578b\u3001\u6570\u636e\u7ed3\u6784\u3001\u6301\u4e45\u5316\u3001\u7f51\u7edc\u6846\u67b6\uff1b \u9ad8\u53ef\u9760\u4e3b\u7ebf\uff0c\u5305\u62ec\u4e3b\u4ece\u590d\u5236\u3001\u54e8\u5175\u673a\u5236\uff1b \u9ad8\u53ef\u6269\u5c55\u4e3b\u7ebf\uff0c\u5305\u62ec\u6570\u636e\u5206\u7247\u3001\u8d1f\u8f7d\u5747\u8861 \u3002","title":"2-1 \u4e09\u5927\u4e3b\u7ebf"},{"location":"chap1/1redis_intro/#2-2-redis","text":"\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u679c\u4f60\u9047\u5230\u4e86 Redis \u7684\u54cd\u5e94\u53d8\u6162\u95ee\u9898 \u5bf9\u7167\u7740\u8fd9\u5f20\u56fe\uff0c\u4f60\u5c31\u53ef\u4ee5\u53d1\u73b0\uff0c\u8fd9\u4e2a\u95ee\u9898\u548c Redis \u7684\u6027\u80fd\u4e3b\u7ebf\u76f8\u5173\uff0c\u800c\u6027\u80fd\u4e3b\u7ebf\u53c8\u548c\u6570\u636e\u7ed3\u6784\u3001\u5f02\u6b65\u673a\u5236\u3001RDB\u3001AOF \u91cd\u5199\u76f8\u5173\u3002\u627e\u5230\u4e86\u5f71\u54cd\u7684\u56e0\u7d20\uff0c\u89e3\u51b3\u8d77\u6765\u4e5f\u5c31\u5f88\u5bb9\u6613\u4e86\u3002","title":"2-2 Redis \u7684\u95ee\u9898\u753b\u50cf\u56fe"},{"location":"chap10/1redis_test/","text":"Redis \u6838\u5fc3\u6280\u672f\u8003\u9898 1\u3001\u671f\u4e2d\u9009\u62e9\u9898 1.Redis\u7684Streams\u6570\u636e\u7c7b\u578b\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0\u6d88\u606f\u961f\u5217\uff0c\u5173\u4e8eStreams\uff0c\u4e0b\u5217\u54ea\u4e2a\u63cf\u8ff0\u662f \u4e0d\u6b63\u786e \u7684\uff1f Streams\u53ef\u4ee5\u4e3a\u6d88\u606f\u81ea\u52a8\u751f\u6210\u5168\u5c40\u552f\u4e00ID Streams\u4f1a\u81ea\u52a8\u7559\u5b58\u6d88\u606f\uff0c\u76f4\u5230\u6d88\u8d39\u8005\u4f7f\u7528XACK\u786e\u8ba4\u540e\uff0c\u518d\u5220\u9664\u6d88\u606f Streams\u652f\u6301\u963b\u585e\u5f0f\u6d88\u606f\u8bfb\u53d6 Streams\u63d0\u4f9b\u7684\u6d88\u8d39\u7ec4\u6a21\u5f0f\uff0c\u540c\u4e00\u4e2a\u6d88\u8d39\u7ec4\u5185\u7684\u6d88\u8d39\u8005\u53ef\u4ee5\u540c\u65f6\u6d88\u8d39\u540c\u4e00\u6761\u6d88\u606f \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6d88\u606f\u961f\u5217\u4e2d\u7684\u6d88\u606f\u4e00\u65e6\u88ab\u6d88\u8d39\u7ec4\u91cc\u7684\u4e00\u4e2a\u6d88\u8d39\u8005\u8bfb\u53d6\u4e86\uff0c\u5c31\u4e0d\u80fd\u518d\u88ab\u8be5\u6d88\u8d39\u7ec4\u5185\u7684\u5176\u4ed6\u6d88\u8d39\u8005\u8bfb\u53d6\u4e86\u3002 2.Redis\u8fd0\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8fd0\u7ef4\u4eba\u5458\u901a\u8fc7info memory \u67e5\u770b\u5230 mem_fragmentation_ratio \u7684\u503c\u7b49\u4e8e2, Redis\u7684\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u662f\u600e\u6837\u7684\uff1f \u5185\u5b58\u4f7f\u7528\u4e2d\u5b58\u5728\u8f83\u4e3a\u4e25\u91cd\u7684\u5185\u5b58\u788e\u7247 \u5185\u5b58\u7a7a\u95f4\u4e0d\u591f\uff0c\u53ef\u80fd\u5df2\u7ecf\u53d1\u751f\u4e86swap \u5185\u5b58\u4f7f\u7528\u6b63\u5e38\uff0c\u6709\u5c11\u91cf\u5185\u5b58\u788e\u7247 \u5185\u5b58\u975e\u5e38\u5145\u8db3\uff0c\u53ef\u4ee5\u4fdd\u5b58\u66f4\u591a\u7684\u6570\u636e mem_fragmentation_ratio \u5927\u4e8e 1.5\u3002\u8fd9\u8868\u660e\u5185\u5b58\u788e\u7247\u7387\u5df2\u7ecf\u8d85\u8fc7\u4e86 50%\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u9700\u8981\u91c7\u53d6\u4e00\u4e9b\u63aa\u65bd\u6765\u964d\u4f4e\u5185\u5b58\u788e\u7247\u7387\u4e86\u3002 3.\u5728Redis\u4e2d\uff0c\u9ed8\u8ba4\u7684\u5185\u5b58\u5206\u914d\u5668\u4f7f\u7528\u7684\u662fjemalloc\uff0c\u5f53 Redis\u60f3\u8981\u5206\u914d23\u5b57\u8282\u7684\u7a7a\u95f4\u65f6\uff0cjemalloc\u5b9e\u9645\u4f1a\u5206\u914d\u591a\u5927\u7a7a\u95f4\uff1f 23 24 32 64 jemalloc \u5728\u5206\u914d\u5185\u5b58\u65f6\uff0c\u4f1a\u6839\u636e\u6211\u4eec\u7533\u8bf7\u7684\u5b57\u8282\u6570 N\uff0c\u627e\u4e00\u4e2a\u6bd4 N \u5927\uff0c\u4f46\u662f\u6700\u63a5\u8fd1 N \u7684 2 \u7684\u5e42\u6b21\u6570\u4f5c\u4e3a\u5206\u914d\u7684\u7a7a\u95f4\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u9891\u7e41\u5206\u914d\u7684\u6b21\u6570\u3002 4.Redis\u4f7f\u7528RDB\u673a\u5236\u521b\u5efa\u5feb\u7167\uff0c\u5173\u4e8eRDB\u673a\u5236\uff0c\u4e0b\u9762\u7684\u63cf\u8ff0\u54ea\u4e2a\u662f\u9519\u8bef\u7684\uff1f \u4f7f\u7528save\u547d\u4ee4\u751f\u6210RDB\u5feb\u7167\u65f6\uff0c\u662f\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\u7684\uff0c\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b RDB\u6587\u4ef6\u662fRedis\u5b9e\u4f8b\u7684\u955c\u50cf\uff0c\u7528RDB \u6587\u4ef6\u6062\u590d\u5b9e\u4f8b\u65f6\uff0c\u76f4\u63a5\u628aRDB\u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\uff0c \u5c31\u53ef\u4ee5\u5feb\u901f\u6062\u590d\u4e86 \u548cAOF\u6587\u4ef6\u76f8\u6bd4\uff0cRDB\u6587\u4ef6\u66f4\u5c0f\u4e00\u70b9 \u4f7f\u7528bgsave\u547d\u4ee4\u521b\u5efaRDB\u5feb\u7167\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u53ea\u80fd\u5904\u7406\u8bfb\u8bf7\u6c42\uff0c\u5199\u8bf7\u6c42\u64cd\u4f5c\u4f1a\u88ab\u963b\u585e 2 bgsave \u521b\u5efa\u5feb\u7167\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u80fd\u540c\u65f6\u5904\u7406\u8bfb\u5199\u8bf7\u6c42 5.Redis\u4f7f\u7528AOF\u673a\u5236\u4fdd\u5b58\u6570\u636e\u64cd\u4f5c\u65f6\uff0c\u53ef\u4ee5\u91c7\u7528\u4e0d\u540c\u7684\u5199\u56de\u7b56\u7565\u3002 \u5f53\u9700\u8981\u6709\u4e00\u5b9a\u7684\u6570\u636e\u53ef\u9760\u6027\uff0c\u540c\u65f6\u4e5f\u4e0d\u80fd\u5bf9Redis\u5b9e\u4f8b\u9020\u6210\u8f83\u5927\u963b\u585e\u7684\u8bdd \uff0c\u5e94\u8be5\u9009\u62e9\u4ee5\u4e0b\u54ea\u79cd\u5199\u56de\u7b56\u7565\uff1f always everysec no yes \u4f7f\u7528everysec\u65f6\uff0c\u4f1a\u4f7f\u7528\u5b50\u7ebf\u7a0b\u6765\u64cd\u4f5c\uff0c\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002\u800c\u4f7f\u7528always\u65f6\uff0c\u662f\u4f7f\u7528\u4e3b\u7ebf\u7a0b\u6765\u64cd\u4f5c\uff0c\u6240\u4ee5\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b \u9009\u9879A\uff0c\u53ef\u9760\u6027\u9ad8\uff0c\u4f46\u4f1a\u963b\u585eRedis\u5b9e\u4f8b \u9009\u9879C\uff0c\u57fa\u672c\u4e0d\u4f1a\u963b\u585eRedis\u5b9e\u4f8b\uff0c\u4f46\u662f\u5b95\u673a\u540e\uff0c\u4f1a\u4e22\u5931\u8f83\u591a\u7684\u65e5\u5fd7\u8bb0\u5f55 \u9009\u9879D\uff0c\u5199\u56de\u7b56\u7565\u6ca1\u6709yes\u914d\u7f6e\u9879 6.\u73b0\u5728\uff0c\u6709\u4e00\u4e2aRedis\u5b9e\u4f8b\u6b63\u5728\u7ebf\u4e0a\u8fd0\u884c\uff0c \u5b83\u4f7f\u7528Hash\u7c7b\u578b\u4fdd\u5b58\u4e86\u4e00\u4e2akey\u4e3adevice\u7684Hash\u96c6\u5408 \uff0c\u96c6\u5408\u4e2d\u4fdd\u5b58\u4e86500\u4e07\u6761\u8bb0\u5f55\u3002\u5728\u8fd9\u4e9b\u8bb0\u5f55\u4e2d\uff0c\u670920\u4e07\u6761\u8bb0\u5f55\u7684key\u662f\u4ee5\u201credis\u201d\u5f00\u5934\u7684\uff0c\u73b0\u5728\u60f3\u628a\u8fd9\u4e9b\u8bb0\u5f55\u8bfb\u53d6\u51fa\u6765\uff0c\u5e94\u8be5\u91c7\u7528\u4ee5\u4e0b\u54ea\u4e9b\u547d\u4ee4\uff1f KEYS SCAN HSCAN SSCAN \u9009\u9879A, KEYS \u4f1a\u5f15\u8d77Redis\u5b9e\u4f8b\u963b\u585e\uff0c\u800c\u4e14KEYS\u65e0\u6cd5\u67e5\u8be2\u65e5ash\u96c6\u5408\u4e2d\u7684\u8bb0\u5f55 \u9009\u9879B, SCAN\u53ea\u80fd\u67e5\u8be2\u6574\u4e2a\u6570\u636e\u5e93\u4e2d\u7684key \u9009\u9879D, SSCAN\u662f\u7528\u6765\u626b\u63cf\u67e5\u8be2Set\u7c7b\u578b 7.\u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c\u5f53\u4e3b\u5e93\u6536\u5230\u4ece\u5e93\u53d1\u9001\u7684 psync?-1 \u547d\u4ee4 \u65f6\uff0c\u4ece\u5e93\u5e0c\u671b\u4e3b\u5e93\u6267\u884c\u7684\u64cd\u4f5c\u662f\u4ee5\u4e0b\u54ea\u4e00\u9879\uff1f \u8fdb\u884c\u589e\u91cf\u590d\u5236 \u7ed3\u675f\u6570\u636e\u590d\u5236\u64cd\u4f5c \u65ad\u5f00\u7f51\u7edc\u8fde\u63a5 \u8fdb\u884c\u5168\u91cf\u590d\u5236 \u9009\u9879A\uff0c\u589e\u91cf\u590d\u5236\u65f6\uff0c\u4ece\u5e93\u4f1a\u628a\u81ea\u5df1\u8bb0\u5f55\u7684\u4e3b\u5e93ID\u53d1\u7ed9\u4e3b\u5e93\uff0c\u6240\u4ee5psync\u547d\u4ee4\u4f1a\u5e26\u6709\u4e3b\u5e93ID \u9009\u9879B\uff0c\u4e0d\u4f1a\u53d1\u9001psync \u9009\u9879C\uff0c\u4e0d\u4f1a\u53d1\u9001psync \u7b2c\u4e00\u9636\u6bb5\u662f\u4e3b\u4ece\u5e93\u95f4\u5efa\u7acb\u8fde\u63a5\u3001\u534f\u5546\u540c\u6b65\u7684\u8fc7\u7a0b\uff0c\u4e3b\u8981\u662f\u4e3a\u5168\u91cf\u590d\u5236\u505a\u51c6\u5907 psync?-1 8.\u5173\u4e8e\u54e8\u5175\u673a\u5236\uff0c\u4e0b\u9762\u7684\u54ea\u4e2a\u63cf\u8ff0\u662f\u6b63\u786e\u7684\uff1f \u54e8\u5175\u662f\u4e00\u4e2a\u8fd0\u884c\u5728\u7279\u5b9a\u6a21\u5f0f\u4e0b\u7684Redis\u5b9e\u4f8b\uff0c\u4e5f\u53ef\u4ee5\u670d\u52a1\u8bf7\u6c42 \u54e8\u5175\u63d0\u4f9bpub/sub\u529f\u80fd \u54e8\u5175\u53ea\u901a\u8fc7\u5fc3\u8df3\u76d1\u542c\u4e3b\u5e93\u7684\u8fd0\u884c\u72b6\u6001 down-after-milliseconds \u662f\u54e8\u5175\u7528\u6765\u5224\u65ad\u4e3b\u5e93\u5ba2\u89c2\u4e0b\u7ebf\u7684\u5fc3\u8df3\u65ad\u8fde\u9608\u503c \u901a\u8fc7 pub/sub \u673a\u5236\uff0c\u54e8\u5175\u4e4b\u95f4\u53ef\u4ee5\u7ec4\u6210\u96c6\u7fa4\uff0c\u540c\u65f6\uff0c\u54e8\u5175\u53c8\u901a\u8fc7 INFO \u547d\u4ee4\uff0c\u83b7\u5f97\u4e86\u4ece\u5e93\u8fde\u63a5\u4fe1\u606f\uff0c\u4e5f\u80fd\u548c\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5\uff0c\u5e76\u8fdb\u884c\u76d1\u63a7\u4e86\u3002 \u9009\u9879A\uff0c\u54e8\u5175\u4e0d\u670d\u52a1\u8bf7\u6c42 \u9009\u9879C\uff0c\u54e8\u5175\u540c\u65f6\u76d1\u542c\u4ece\u5e93\u7684\u8fd0\u884c\u72b6\u6001 \u9009\u9879D, down-after-milliseconds\u662f\u4e3b\u89c2\u4e0b\u7ebf\u7684\u5224\u65ad\u4f9d\u636e \u54e8\u5175\u8fdb\u7a0b\u4f1a\u4f7f\u7528 PING \u547d\u4ee4\u68c0\u6d4b\u5b83\u81ea\u5df1\u548c\u4e3b\u3001\u4ece\u5e93\u7684\u7f51\u7edc\u8fde\u63a5\u60c5\u51b5\uff0c\u7528\u6765\u5224\u65ad\u5b9e\u4f8b\u7684\u72b6\u6001\u3002 \u5728\u5224\u65ad\u4e3b\u5e93\u662f\u5426\u4e0b\u7ebf\u65f6\uff0c\u4e0d\u80fd\u7531\u4e00\u4e2a\u54e8\u5175\u8bf4\u4e86\u7b97\uff0c\u53ea\u6709\u5927\u591a\u6570\u7684\u54e8\u5175\u5b9e\u4f8b\uff0c\u90fd\u5224\u65ad\u4e3b\u5e93\u5df2\u7ecf\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u4e86\uff0c\u4e3b\u5e93\u624d\u4f1a\u88ab\u6807\u8bb0\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\uff0c\u8fd9\u4e2a\u53eb\u6cd5\u4e5f\u662f\u8868\u660e\u4e3b\u5e93\u4e0b\u7ebf\u6210\u4e3a\u4e00\u4e2a\u5ba2\u89c2\u4e8b\u5b9e\u4e86 \u5982\u679c\u5728 down-after-milliseconds \u6beb\u79d2\u5185\uff0c\u4e3b\u4ece\u8282\u70b9\u90fd\u6ca1\u6709\u901a\u8fc7\u7f51\u7edc\u8054\u7cfb\u4e0a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba4\u4e3a\u4e3b\u4ece\u8282\u70b9\u65ad\u8fde\u4e86\u3002 9.\u5728\u4f7f\u7528\u54e8\u5175\u673a\u5236\u5bf9\u53d1\u751f\u6545\u969c\u7684\u4e3b\u4ece\u96c6\u7fa4\u8fdb\u884c\u4e3b\u4ece\u5e93\u5207 \u65f6\uff0c\u4f1a\u6d89\u53ca\uff1a (1) \u4e3b\u5e93\u88ab\u5224\u65ad\u4e3a\u4e3b\u89c2\u4e0b\u7ebf\uff1b (2\uff09\u4e3b\u5e93\u88ab\u5224\u65ad\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\uff1b (3\uff09\u786e\u5b9a\u65b0\u4e3b\u5e93\uff1b (4\uff09\u9009\u4e3e\u54e8\u5175Leader; (5\uff09\u4e3b\u4ece\u5e93\u5b9e\u9645\u5207\u6362\u3002 \u5173\u4e8e\u8fd9\u4e9b\u4e8b\u4ef6\u7684\u53d1\u751f\u987a\u5e8f\uff0c\u4ee5\u4e0b\u54ea\u4e2a\u9009\u9879\u7684\u63cf\u8ff0\u662f\u6b63\u786e\u7684\uff1f (1\uff09\u4e00\uff1e(2\uff09\u4e00\uff1e(3\uff09\u4e00\uff1e(4)\u4e00\uff1e(5) (2\uff09\u4e00\uff1e(1\uff09\u4e00\uff1e(3\uff09\u4e00\uff1e>(4)\u4e00\uff1e(5) (1\uff09\u4e00\uff1e(2\uff09\u4e00\uff1e(4)\u4e00\uff1e(3\uff09\u4e00\uff1e(5) (2\uff09\u4e00\uff1e>(1\uff09\u4e00\uff1e>(4)\u4e00\uff1e(3\uff09\u4e00\uff1e(5) \u4e3b\u5e93\u7684\u4e3b\u89c2\u4e0b\u7ebf\u53ea\u7528\u54e8\u5175\u81ea\u5df1\u5224\u65ad\u5c31\u884c\uff0c\u800c\u5ba2\u89c2\u4e0b\u7ebf\u9700\u8981\u591a\u4e2a\u54e8\u5175\u5171\u540c\u51b3\u5b9a\uff0c\u6240\u4ee5\u5224\u65ad\u4e3b\u5e93\u4e3b\u89c2\u4e0b\u7ebf\u8981\u65e9\u4e8e\u5224\u65ad\u5ba2\u89c2\u4e0b\u7ebf\u3002 \u4e3b\u4ece\u5e93\u5207\u6362\u65f6\uff0c\u65b0\u4e3b\u5e93\u662f\u7531\u54e8\u5175Leader\u6765\u786e\u5b9a\u7684\uff0c\u6240\u4ee5\uff0c\u54e8\u5175\u96c6\u7fa4\u9700\u8981\u5148\u9009\u51faLeader\uff0c\u518d\u786e\u5b9a\u65b0\u4e3b\u5e93\u3002 10.\u5728\u4e00\u4e2a\u75315\u4e2a\u54e8\u5175\u7ec4\u6210\u7684\u54e8\u5175\u96c6\u7fa4\u4e2d\uff0c\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684quorum\u503c\u914d\u7f6e\u4e3a4\uff0c\u90a3\u4e48\uff0c\u5f53\u6709\u5ced\u5175\u53d1\u73b0\u4e3b\u8282\u70b9\u6545\u969c\uff0c\u5f00\u59cb\u8fdb\u884cLeader\u9009\u4e3e\u65f6\uff0c\u8fd9\u4e2a\u5ced\u5175\u9700\u8981\u83b7\u5f97\u51e0\u5f20\u8d5e\u6210\u7968\uff0c \u624d\u80fd\u6210\u529f\u5730\u6210\u4e3aLeader? 2 3 4 5 \u54e8\u5175Leader\u9009\u4e3e\u9700\u8981\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6\uff1a \u4e00\u662f\u8981\u62ff\u5230\u534a\u6570\u4ee5\u4e0a\u7684\u8d5e\u6210\u7968\uff1b\u4e8c\u662f\uff0c\u62ff\u5230\u7684\u7968\u6570\u540c\u65f6\u8fd8\u9700\u8981\u5927\u4e8e\u7b49\u4e8e\u54e8\u5175\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684quorum\u503c\uff0c\u672c\u9898\u4e2d\u7684quorum\u503c\u8bbe\u4e3a4\uff0c\u6240\u4ee5 \u81f3\u5c11\u8981\u83b7\u5f974\u5f20\u8d5e\u6210\u7968 \u3002 11.\u5728\u4f7f\u7528Redis Cluster\u65f6\uff0c \u5982\u679c\u5ba2\u6237\u7aef\u53d1\u9001\u64cd\u4f5c\u8bf7\u6c42\u540e \uff0c \u6536\u5230\u4e86MOVED\u547d\u4ee4\uff0c\u6b64\u65f6\uff0cRedis Cluster\u53d1\u751f\u4e86\u4ee5\u4e0b \u54ea\u79cd\u60c5\u51b5\uff1f \u8bf7\u6c42\u7684\u6570\u636e\u5728Cluster\u4e2d\u5df2\u7ecf\u88ab\u5220\u9664 \u8bf7\u6c42\u6570\u636e\u6240\u5728\u7684\u54c8\u5e0c\u69fd\u6b63\u5728\u5f80\u5176\u4ed6\u5b9e\u4f8b\u8fc1\u79fb \u8bf7\u6c42\u6570\u636e\u6240\u5728\u7684\u54c8\u5e0c\u69fd\u5df2\u7ecf\u8fc1\u79fb\u5230\u4e86\u5176\u4ed6\u5b9e\u4f8b \u8bf7\u6c42\u7684\u6570\u636e\u6b63\u5728\u6301\u4e45\u5316\u4fdd\u5b58 A\u9009\u9879\uff0c\u6b64\u65f6\u8fd4\u56denil\u503c B\u9009\u9879\uff0c\u6b64\u65f6\u8fd4\u56deASK\u62a5\u9519\u4fe1\u606f D\u9009\u9879\uff0c\u4e0d\u4f1a\u62a5\u9519\uff0c\u53ef\u4ee5\u6b63\u5e38\u8fd4\u56de\u7ed3\u679c 12.\u5728Redis\u7684\u8bf8\u591a\u6570\u636e\u7c7b\u578b\u4e2d\uff0c\u4ee5\u4e0b\u54ea\u79cd\u6570\u636e\u7c7b\u578b\u5141\u8bb8\u63d2\u5165 \u91cd\u590d\u7684\u5143\u7d20\uff1f HyperLogLog List Set Sorted Set \u9009\u9879A\uff0c\u4f1a\u5bf9\u5143\u7d20\u53bb\u91cd \u9009\u9879B\uff0c\u6b63\u786e\uff0c\u5141\u8bb8\u5199\u5165\u91cd\u590d\u5143\u7d20 \u9009\u9879C\uff0c\u4f1a\u5bf9\u5143\u7d20\u53bb\u91cd \u9009\u9879D\uff0c\u4f1a\u5bf9\u5143\u7d20\u53bb\u91cd HyperLogLog \u662f\u4e00\u79cd\u7528\u4e8e\u7edf\u8ba1\u57fa\u6570\u7684\u6570\u636e\u96c6\u5408\u7c7b\u578b\uff0c\u5b83\u7684\u6700\u5927\u4f18\u52bf\u5c31\u5728\u4e8e\uff0c\u5f53\u96c6\u5408\u5143\u7d20\u6570\u91cf\u975e\u5e38\u591a\u65f6\uff0c\u5b83\u8ba1\u7b97\u57fa\u6570\u6240\u9700\u7684\u7a7a\u95f4\u603b\u662f\u56fa\u5b9a\u7684\uff0c\u800c\u4e14\u8fd8\u5f88\u5c0f\u3002 13.Redis\u6570\u636e\u5e93\u662f\u5c06\u4e0b\u5217\u54ea\u79cd\u6570\u636e\u7ed3\u6784\u4f5c\u4e3a \u5168\u5c40\u6570\u636e\u7ed3\u6784 \u6765\u4fdd\u5b58\u6bcf\u4e00\u5bf9\u952e\u503c\u5bf9\uff1f \u6570\u7ec4 \u54c8\u5e0c\u8868 \u8df3\u8868 \u53cc\u5411\u94fe\u8868 \u9898\u76ee\u95ee\u7684\u662fRedis\u6570\u636e\u5e93\u7684\u5168\u5c40\u6570\u636e\u7ed3\u6784\uff0c\u6240\u4ee5\u9009B\u3002\u5176\u4ed6\u9009\u9879\u662fRedis\u67d0\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784 14.\u5728Redis\u7684\u4e3b\u4ece\u5e93\u96c6\u7fa4\u4e2d\uff0c\u5982\u679c\u4e3b\u5e93\u5b95\u673a\u4e86\uff0c\u4ee5\u4e0b\u54ea\u4e2a \u673a\u5236\u53ef\u4ee5\u8ba9Redis\u5b9e\u73b0\u81ea\u52a8\u7684\u4e3b\u4ece\u5e93\u5207\u6362 \uff1f AOF\u91cd\u5199\u673a\u5236 RDB\u673a\u5236 \u5207\u7247\u673a\u5236 \u54e8\u5175\u673a\u5236 A\u9009\u9879\uff0c AOF\u91cd\u5199\u7528\u6765\u7cbe\u7b80\u8fc7\u5927\u7684AOF\u6587\u4ef6\uff0c\u52a0\u901fRedis\u5b9e\u4f8b\u6062\u590d\u3002 B\u9009\u9879\uff0c RDB\u673a\u5236\u7528\u6765\u751f\u6210\u5feb\u7167\uff0c\u7528\u4e8e\u5b9e\u4f8b\u6062\u590d\u6216\u662f\u4e3b\u4ece\u5e93\u590d\u5236\u3002 C\u9009\u9879\uff0c \u5207\u7247\u673a\u5236\u662f\u628a\u6570\u636e\u5206\u6563\u5230\u591a\u4e2a\u5b9e\u4f8b\u4fdd\u5b58\uff0c\u7528\u4e8e\u4fdd\u5b58\u5927\u91cf\u6570\u636e\u3002 15.\u4ee5\u4e0b\u54ea\u4e2a\u529f\u80fd\u662f\u7531Redis\u4e3b\u7ebf\u7a0b\u5b8c\u6210\u7684\uff1f \u952e\u503c\u5bf9\u8bfb\u5199 UNLINK\u64cd\u4f5c \u751f\u6210RDB\u5feb\u7167 AOF\u91cd\u5199 \u5f02\u6b65\u7684\u5b50\u7ebf\u7a0b\u673a\u5236 \u952e\u503c\u5bf9\u5220\u9664 \u5f53\u4f60\u7684\u96c6\u5408\u7c7b\u578b\u4e2d\u6709\u5927\u91cf\u5143\u7d20\uff08\u4f8b\u5982\u6709\u767e\u4e07\u7ea7\u522b\u6216\u5343\u4e07\u7ea7\u522b\u5143\u7d20\uff09\u9700\u8981\u5220\u9664\u65f6\uff0c\u6211\u5efa\u8bae\u4f60\u4f7f\u7528 UNLINK \u547d\u4ee4 B\u9009\u9879\uff0c UNLINK\u64cd\u4f5c\u662fRedis 4.0\u540e\u63d0\u4f9b\u7684\u540e\u53f0\u5f02\u6b65\u5220\u9664\u64cd\u4f5c\uff0c\u7531\u540e\u53f0\u5b50\u7ebf\u7a0b\u5b8c\u6210\u3002 C\u9009\u9879\uff0c RDB\u751f\u6210\u662f\u4e3b\u7ebf\u7a0b\u901a\u8fc7fork\u521b\u5efa\u4e86\u5b50\u8fdb\u7a0b\u6765\u5b8c\u6210\u7684\u3002 D\u9009\u9879\uff0c AOF\u91cd\u5199\u4e5f\u662f\u7531\u4e3b\u7ebf\u7a0b\u901a\u8fc7fork\u521b\u5efa\u4e86\u5b50\u8fdb\u7a0b\u6765\u5b8c\u6210\u7684\u3002 16.\u4ee5\u4e0b\u54ea\u4e9b\u60c5\u51b5\u4f1a\u5f15\u8d77Redis\u7684\u4e3b\u7ebf\u7a0b\u963b\u585e\uff1f Redis 3.0\u4e2d\uff0c\u5220\u9664\u4e00\u4e2a100\u4e07\u5143\u7d20\u7684Set\u96c6 AOF\u5199\u56de\u7b56\u7565\u914d\u7f6e\u4e3aeverysec\uff0c\u540c\u65f6 no-appendfsync-on-rewrite \u8bbe\u7f6e\u4e3ano 200\u4e07\u4e2a\u952e\u503c\u5bf9\u540c\u65f6\u8fc7\u671f \u4e00\u4e2a\u670d\u52a1\u8bfb\u4e3a\u4e3b\u8d1f\u8f7d\u7684Redis\u5b9e\u4f8b\uff0c\u5df2\u4fdd\u5b58\u7684\u6570\u636e\u91cf\u4e3a1GB\uff0c\u6b63\u5728\u521b\u5efaRDB\u5feb\u7167 \u9009\u9879A\uff0c \u4f1a\u5f15\u8d77\u963b\u585e\uff0cRedis 3.0\u65f6\u8fd8\u6ca1\u6709\u5f02\u6b65\u5220\u9664\u673a\u5236 \u9009\u9879B, AOF\u91cd\u5199\u548cAOF\u5199\u56de\u4f1a\u7ade\u4e89\u78c1\u76d8IO\u8d44\u6e90\uff0c\u5bfc\u81f4AOF\u5199\u56de\u88ab\u963b\u585e\uff0c\u8fdb\u800c\u5bfc\u81f4\u4e3b\u7ebf\u7a0b\u4e5f\u88ab\u963b\u585e \u9009\u9879C\uff0c \u5927\u91cf\u952e\u503c\u5bf9\u540c\u65f6\u8fc7\u671f\u4f1a\u5f15\u53d1\u4e3b\u7ebf\u7a0b\u963b\u585e \u9009\u9879D, RDB\u7531\u5b50\u8fdb\u7a0b\u751f\u6210\uff0c\u800c\u4e14\u5b9e\u4f8b\u670d\u52a1\u7684\u662f\u8bfb\u4e3a\u4e3b\u7684\u8d1f\u8f7d\uff0c\u6ca1\u6709\u5185\u5b58\u7684COW\u538b\u529b\uff0c\u4e0d\u4f1a\u963b\u585e \u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a yes \u65f6\uff0c\u8868\u793a\u5728 AOF \u91cd\u5199\u65f6\uff0c\u4e0d\u8fdb\u884c fsync \u64cd\u4f5c\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cRedis \u5b9e\u4f8b\u628a\u5199\u547d\u4ee4\u5199\u5230\u5185\u5b58\u540e\uff0c\u4e0d\u8c03\u7528\u540e\u53f0\u7ebf\u7a0b\u8fdb\u884c fsync \u64cd\u4f5c\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de\u4e86\u3002\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a no\uff08\u4e5f\u662f\u9ed8\u8ba4\u914d\u7f6e\uff09\uff0c\u5728 AOF \u91cd\u5199\u65f6\uff0cRedis \u5b9e\u4f8b\u4ecd\u7136\u4f1a\u8c03\u7528\u540e\u53f0\u7ebf\u7a0b\u8fdb\u884c fsync \u64cd\u4f5c\uff0c\u8fd9\u5c31\u4f1a\u7ed9\u5b9e\u4f8b\u5e26\u6765\u963b\u585e\u3002 17.RDB\u548cAOF\u662fRedis\u4f7f\u7528\u7684\u4e24\u79cd\u6301\u4e45\u5316\u673a\u5236\uff0c\u5173\u4e8e\u8fd9\u4e24\u79cd\u673a\u5236\uff0c\u4e0b\u9762\u7684\u54ea\u4e9b\u63cf\u8ff0\u662f\u6b63\u786e\u7684\uff1f \u4f7f\u7528RDB\u8fdb\u884c\u5b9e\u4f8b\u6062\u590d\u7684\u901f\u5ea6\uff0c\u8981\u6bd4\u4f7f\u7528AOF \u8fdb\u884c\u6062\u590d\u7684\u901f\u5ea6\u5feb\u8ba4 RDB\u7684\u751f\u6210\u548cAOF\u7684\u65e5\u5fd7\u8bb0\u5f55\u90fd\u662f\u901a\u8fc7\u5b50\u8fdb\u7a0b\u6765\u5b8c\u6210\u7684 AOF\u6587\u4ef6\u8bb0\u5f55\u7684\u64cd\u4f5c\u65e5\u5fd7\u8fc7\u591a\u65f6\uff0c\u4e3a\u4e86\u907f\u514d\u6587\u4ef6 \u8fc7\u5927\uff0c\u9700\u8981\u624b\u52a8\u5220\u9664\u5931\u6548\u7684\u64cd\u4f5c\u65e5\u5fd7 Redis 4.0\u7248\u672c\u4e2d\u53ef\u4ee5\u4f7f\u7528RDB\u505a\u5feb\u7167\uff0c\u540c\u65f6\u4f7f \u7528AOF\u8bb0\u5f55\u4e24\u6b21\u5feb\u7167\u95f4\u7684\u64cd\u4f5c\u65e5\u5fd7 \u9009\u9879B, AOF\u65e5\u5fd7\u8bb0\u5f55\u662f\u7531\u4e3b\u7ebf\u7a0b\u5b8c\u6210\u7684 \u9009\u9879C, AOF\u91cd\u5199\u673a\u5236\u53ef\u4ee5\u81ea\u52a8\u6e05\u7406AOF\u6587\u4ef6\uff0c\u4e0d\u7528\u624b\u52a8\u6e05\u7406 18.\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528Hash\u548cSorted Set\u7ec4\u5408\u6765\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u4ee5\u4e0b\u54ea\u4e9b\u529f\u80fd\u53ef\u4ee5\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u76f4\u63a5\u5728Redis\u5b9e\u4f8b\u4e0a\u5b8c\u6210\uff1f \u8ba1\u7b97\u67d0\u4e2a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6570\u636e\u6700\u5927\u503c \u67e5\u8be2\u67d0\u4e2a\u65f6\u523b\u7684\u6570\u636e \u67e5\u8be2\u67d0\u4e2a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6240\u6709\u6570\u636e \u67e5\u8be2\u6700\u65b0\u65f6\u523b\u7684\u6570\u636e \u65e0\u6cd5\u76f4\u63a5\u5728Redis\u5b9e\u4f8b\u4e0a\u5b8c\u6210\uff0c\u9700\u8981\u628a\u6570\u636e\u8bfb\u53d6\u5230\u5ba2\u6237\u7aef\uff0c\u7136\u540e\u518d\u8fdb\u884c\u8ba1\u7b97 19.Redis\u7684Hash\u6570\u636e\u7c7b\u578b\uff0c\u662f\u91c7\u7528\u4ee5\u4e0b\u54ea\u4e24\u79cd\u7ed3\u6784\u4f5c\u4e3a\u5b83\u7684\u5e95\u5c42\u5b9e\u73b0\u7684\uff1f \u6574\u6570\u6570\u7ec4 \u53cc\u5411\u94fe\u8868 \u54c8\u5e0c\u8868 \u538b\u7f29\u5217\u8868 A\u9009\u9879\uff0c\u662fSet\u7c7b\u578b\u7684\u5e95\u5c42\u7ed3\u6784 B\u9009\u9879\uff0c\u662fList\u7c7b\u578b\u7684\u5e95\u5c42\u7ed3\u6784 CD\u6b63\u786e 20.\u5173\u4e8eRedis Cluster\uff0c\u4e0b\u9762\u54ea\u4e2a\u63cf\u8ff0\u662f\u6b63\u786e\u7684\uff1f Redis Cluster\u4e00\u5171\u670916384\u4e2a\u54c8\u5e0c\u69fd \u4f7f\u7528Redis Cluster\u65f6\uff0c\u5ba2\u6237\u7aef\u4e0d\u7528\u8bb0\u5f55\u54c8\u5e0c\u69fd\u7684\u4efb\u4f55\u4fe1\u606f\uff0c\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u54c8\u5e0c\u8ba1\u7b97\uff0c\u786e\u5b9a\u952e\u503c\u5bf9\u5728\u54ea\u4e2a\u5b9e\u4f8b Redis Cluster\u5c5e\u4e8e\u53ef\u6269\u5c55\u96c6\u7fa4\uff0c\u4e3b\u8981\u7528\u9014\u662f\u8ba9Redis\u6570\u636e\u5e93\u80fd\u591f\u4fdd\u5b58\u66f4\u591a\u6570\u636e\u8ba4 Redis Cluster\u4e2d\u7684\u5b9e\u4f8b\u53ea\u80fd\u901a\u8fc7\u6301\u4e45\u5316\u673a\u5236\u8fdb\u884c\u53ef\u9760\u6027\u4fdd\u8bc1 \u9009\u9879B\uff0c \u5ba2\u6237\u7aef\u9700\u8981\u7f13\u5b58\u54c8\u5e0c\u69fd\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u65e0\u6cd5\u76f4\u63a5\u901a\u8fc7\u54c8\u5e0c\u8ba1\u7b97\u5c31\u77e5\u9053\u6570\u636e\u5728\u54ea\u4e2a\u5b9e\u4f8b\uff0c\u53ea\u80fd\u77e5\u9053\u5728\u54ea\u4e2a\u54c8\u5e0c\u69fd D\u9009\u9879\uff0cRedis Cluster\u7684\u5b9e\u4f8b\u4e5f\u53ef\u4ee5\u914d\u7f6e\u4e3b\u4ece\u8282\u70b9\uff0c\u8fdb\u884c\u53ef\u9760\u6027\u4fdd\u8bc1 2\u3001\u4e3b\u89c2\u9898 2-1 \u7b2c\u4e00\u9898 Redis \u5728\u63a5\u6536\u591a\u4e2a\u7f51\u7edc\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\u64cd\u4f5c\u65f6\uff0c\u5982\u679c\u6709\u4e00\u4e2a\u5ba2\u6237\u7aef\u548c Redis \u7684\u7f51\u7edc\u8fde\u63a5\u65ad\u5f00\u4e86\uff0cRedis \u4f1a\u4e00\u76f4\u7b49\u5f85\u8be5\u5ba2\u6237\u7aef\u6062\u590d\u8fde\u63a5\u5417\uff1f\u4e3a\u4ec0\u4e48\uff1f \u7b54\u6848\uff1a Redis \u4e0d\u4f1a\u7b49\u5f85\u5ba2\u6237\u7aef\u6062\u590d\u8fde\u63a5\u3002\u539f\u56e0\u662f\uff0c Redis \u7684\u7f51\u7edc\u8fde\u63a5\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u884c\u5904\u7406\u7684\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u8d1f\u8d23\u76d1\u542c\u7f51\u7edc\u8fde\u63a5\u5957\u63a5\u5b57\u4e0a\u7684\u8fde\u63a5\u8bf7\u6c42\u6216\u6570\u636e\u8bf7\u6c42\uff0c\u800c Redis \u91c7\u7528\u4e86 IO \u591a\u8def\u590d\u7528\u673a\u5236 epoll\uff0c\u4e0d\u4f1a\u963b\u585e\u5728\u67d0\u4e00\u4e2a\u7279\u5b9a\u7684\u5957\u63a5\u5b57\u4e0a \u3002 epoll \u673a\u5236\u76d1\u6d4b\u5230\u5957\u63a5\u5b57\u4e0a\u6709\u8bf7\u6c42\u5230\u8fbe\u65f6\uff0c\u5c31\u4f1a\u89e6\u53d1\u76f8\u5e94\u7684\u4e8b\u4ef6\uff0c\u5e76\u628a\u4e8b\u4ef6\u653e\u5230\u4e00\u4e2a\u961f\u5217\u4e2d\uff0cRedis \u5c31\u4f1a\u5bf9\u8fd9\u4e2a\u4e8b\u4ef6\u961f\u5217\u4e2d\u7684\u4e8b\u4ef6\u8fdb\u884c\u5904\u7406 \u3002\u8fd9\u6837\u4e00\u6765\uff0cRedis \u53ea\u7528\u67e5\u770b\u548c\u5904\u7406\u4e8b\u4ef6\u961f\u5217\uff0c\u5c31\u53ef\u4ee5\u4e86\u3002 \u5f53\u5ba2\u6237\u7aef\u7f51\u7edc\u8fde\u63a5\u65ad\u5f00\u6216\u6062\u590d\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u8fdb\u884c\u5904\u7406\uff0c\u5e76\u4e14\u5728\u5ba2\u6237\u7aef\u80fd\u518d\u6b21\u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u628a\u63a5\u6536\u5230\u7684\u8bf7\u6c42\u4ee5\u4e8b\u4ef6\u5f62\u5f0f\u901a\u77e5 Redis\u3002 2-2 \u7b2c\u4e8c\u9898 Redis \u7684\u4e3b\u4ece\u96c6\u7fa4\u53ef\u4ee5\u63d0\u5347\u6570\u636e\u53ef\u9760\u6027\uff0c\u4e3b\u8282\u70b9\u5728\u548c\u4ece\u8282\u70b9\u8fdb\u884c\u6570\u636e\u540c\u6b65\u65f6\uff0c\u4f1a\u4f7f\u7528\u4e24\u4e2a\u7f13\u51b2\u533a\uff1a\u590d \u5236\u7f13\u51b2\u533a\u548c\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u3002\u8fd9\u4e24\u4e2a\u7f13\u51b2\u533a\u7684\u4f5c\u7528\u5404\u662f\u4ec0\u4e48\uff1f\u4f1a\u5bf9 Redis \u4e3b\u4ece\u540c\u6b65\u4ea7\u751f\u4ec0\u4e48\u5f71\u54cd\u5417\uff1f Redis \u7684\u4e3b\u4ece\u96c6\u7fa4\u53ef\u4ee5\u63d0\u5347\u6570\u636e\u53ef\u9760\u6027\uff0c\u4e3b\u8282\u70b9\u5728\u548c\u4ece\u8282\u70b9\u8fdb\u884c\u6570\u636e\u540c\u6b65\u65f6\uff0c\u4f1a\u4f7f\u7528\u4e24\u4e2a\u7f13\u51b2\u533a\uff1a\u590d\u5236\u7f13\u51b2\u533a\u548c\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u3002\u8fd9\u4e24\u4e2a\u7f13\u51b2\u533a\u7684\u4f5c\u7528\u5404\u662f\u4ec0\u4e48\uff1f\u4f1a\u5bf9 Redis \u4e3b\u4ece\u540c\u6b65\u4ea7\u751f\u4ec0\u4e48\u5f71\u54cd\u5417\uff1f \u9996\u5148\u6765\u8bf4\u4e00\u4e0b\u590d\u5236\u7f13\u51b2\u533a\u3002 \u4f5c\u7528\uff1a \u4e3b\u8282\u70b9\u5f00\u59cb\u548c\u4e00\u4e2a\u4ece\u8282\u70b9\u8fdb\u884c\u5168\u91cf\u540c\u6b65\u65f6\uff0c\u4f1a\u4e3a\u4ece\u8282\u70b9\u521b\u5efa\u4e00\u4e2a\u8f93\u51fa\u7f13\u51b2\u533a\uff0c\u8fd9\u4e2a\u7f13\u51b2\u533a\u5c31\u662f\u590d\u5236\u7f13\u51b2\u533a\u3002 \u5f53\u4e3b\u8282\u70b9\u5411\u4ece\u8282\u70b9\u53d1\u9001 RDB \u6587\u4ef6\u65f6\uff0c\u5982\u679c \u53c8\u63a5\u6536\u5230\u4e86\u5199\u547d\u4ee4\u64cd\u4f5c\uff0c\u5c31\u4f1a\u628a\u5b83\u4eec\u6682\u5b58\u5728\u590d\u5236\u7f13\u51b2\u533a\u4e2d \u3002\u7b49 RDB \u6587\u4ef6\u4f20\u8f93\u5b8c\u6210\uff0c\u5e76\u4e14\u5728\u4ece\u8282\u70b9\u52a0\u8f7d\u5b8c\u6210\u540e\uff0c\u4e3b\u8282\u70b9\u518d\u628a\u590d\u5236\u7f13\u51b2\u533a\u4e2d\u7684\u5199\u547d\u4ee4\u53d1\u7ed9\u4ece\u8282\u70b9\uff0c\u8fdb\u884c\u540c\u6b65\u3002 \u5bf9\u4e3b\u4ece\u540c\u6b65\u7684\u5f71\u54cd \uff1a \u5982\u679c\u4e3b\u5e93\u4f20\u8f93 RDB \u6587\u4ef6\u4ee5\u53ca\u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6\u8017\u65f6\u957f\uff0c\u540c\u65f6\u4e3b\u5e93\u63a5\u6536\u7684\u5199\u547d\u4ee4\u64cd\u4f5c\u8f83\u591a\uff0c\u5c31\u4f1a\u5bfc\u81f4\u590d\u5236\u7f13\u51b2\u533a\u88ab\u5199\u6ee1\u800c\u6ea2\u51fa\u3002 \u4e00\u65e6\u6ea2\u51fa\uff0c\u4e3b\u5e93\u5c31\u4f1a\u5173\u95ed\u548c\u4ece\u5e93\u7684\u7f51\u7edc\u8fde\u63a5\uff0c\u91cd\u65b0\u5f00\u59cb\u5168\u91cf\u540c\u6b65\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574 client-output-buffer-limit slave \u8fd9\u4e2a\u914d\u7f6e\u9879\uff0c\u6765\u589e\u52a0\u590d\u5236\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff0c\u4ee5\u514d\u590d\u5236\u7f13\u51b2\u533a\u6ea2\u51fa \u3002 \u518d\u6765\u770b\u770b\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u3002 \u4f5c\u7528 \uff1a \u4e3b\u8282\u70b9\u548c\u4ece\u8282\u70b9\u8fdb\u884c\u5e38\u89c4\u540c\u6b65\u65f6\uff0c\u4f1a\u628a\u5199\u547d\u4ee4\u4e5f\u6682\u5b58\u5728\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u4e2d\u3002\u5982\u679c\u4ece\u8282\u70b9\u548c\u4e3b\u8282\u70b9\u95f4\u53d1\u751f\u4e86\u7f51\u7edc\u65ad\u8fde\uff0c\u7b49\u4ece\u8282\u70b9\u518d\u6b21\u8fde\u63a5\u540e\uff0c\u53ef\u4ee5\u4ece\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u4e2d\u540c\u6b65\u5c1a\u672a\u590d\u5236\u7684\u547d\u4ee4\u64cd\u4f5c\u3002 \u5bf9\u4e3b\u4ece\u540c\u6b65\u7684\u5f71\u54cd \uff1a\u5982\u679c\u4ece\u8282\u70b9\u548c\u4e3b\u8282\u70b9\u95f4\u7684\u7f51\u7edc\u65ad\u8fde\u65f6\u95f4\u8fc7\u957f\uff0c\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u53ef\u80fd\u88ab\u65b0\u5199\u5165\u7684\u547d\u4ee4\u8986\u76d6\u3002\u6b64\u65f6\uff0c \u4ece\u8282\u70b9\u5c31\u6ca1\u6709\u529e\u6cd5\u548c\u4e3b\u8282\u70b9\u8fdb\u884c\u589e\u91cf\u590d\u5236\u4e86\uff0c\u800c\u662f\u53ea\u80fd\u8fdb\u884c\u5168\u91cf\u590d\u5236\u3002\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u5e94\u5bf9\u7684\u65b9\u6cd5\u662f\u8c03\u5927\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u7684\u5927\u5c0f \uff08\u53ef\u4ee5\u53c2\u8003 \u7b2c\u516d\u8282 \u6570\u636e\u540c\u6b65\uff1a\u4e3b\u4ece\u5e93\u6570\u636e\u4e00\u81f4 repl_backlog_size \u7684\u8bbe\u7f6e\uff09\u3002 2-3 \u7b2c\u4e09\u9898 \u5047\u8bbe\u5728\u4e1a\u52a1\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u6709 20GB \u7684\u77ed\u89c6\u9891\u5c5e\u6027\u4fe1\u606f\uff08\u5305\u62ec\u77ed\u89c6\u9891 ID\u3001\u77ed\u89c6\u9891\u57fa\u672c\u4fe1\u606f\uff0c\u4f8b\u5982\u77ed\u89c6\u9891\u4f5c\u8005\u3001\u521b\u5efa\u65f6\u95f4\u7b49\uff09\u8981\u6301\u4e45\u5316\u4fdd\u5b58\uff0c\u5e76\u4e14\u7ebf\u4e0a\u8d1f\u8f7d\u4ee5\u8bfb\u4e3a\u4e3b\uff0c\u9700\u8981\u80fd\u5feb\u901f\u67e5\u8be2\u5230\u8fd9\u4e9b\u77ed\u89c6\u9891\u4fe1\u606f\u3002 \u73b0\u5728\uff0c\u9488\u5bf9\u8fd9\u4e2a\u9700\u6c42\uff0c\u6211\u4eec\u60f3\u4f7f\u7528 Redis \u6765\u89e3\u51b3\uff0c\u8bf7\u4f60\u6765\u8bbe\u8ba1\u4e00\u4e2a\u89e3\u51b3\u65b9\u6848\u3002\u6211\u6765\u63d0\u51e0\u4e2a\u95ee\u9898\uff0c\u4f60\u53ef\u4ee5\u601d\u8003\u4e0b\u3002 \u9996\u5148\uff0c\u4f60\u4f1a\u7528 Redis \u7684\u4ec0\u4e48\u6570\u636e\u7c7b\u578b\u6765\u4fdd\u5b58\u6570\u636e\uff1f\u5982\u679c\u6211\u4eec\u53ea\u7528\u5355\u4e2a\u5b9e\u4f8b\u6765\u8fd0\u884c\u7684\u8bdd\uff0c\u4f60\u4f1a\u91c7\u7528\u4ec0\u4e48\u6837\u7684\u6301\u4e45\u5316\u65b9\u6848\u6765\u4fdd\u8bc1\u6570\u636e\u7684\u53ef\u9760\u6027\uff1f \u53e6\u5916\uff0c\u5982\u679c\u4e0d\u4f7f\u7528\u5355\u5b9e\u4f8b\u8fd0\u884c\uff0c\u6211\u4eec\u6709\u4e24\u4e2a\u5907\u9009\u65b9\u6848\uff1a\u4e00\u4e2a\u662f\u7528\u4e24\u53f0 32GB \u5185\u5b58\u7684\u4e91\u4e3b\u673a\u6765\u8fd0\u884c\u4e3b\u4ece\u4e24\u4e2a Redis \u5b9e\u4f8b\uff1b\u53e6\u4e00\u4e2a\u662f\u7528 10 \u53f0 8GB \u7684\u4e91\u4e3b\u673a\u6765\u8fd0\u884c Redis Cluster\uff0c\u6bcf\u4e24\u53f0\u4e91\u4e3b\u673a\u5206\u522b\u8fd0\u884c\u4e00\u4e2a Redis \u5b9e\u4f8b\u4e3b\u5e93\u548c\u4ece\u5e93\uff0c\u5206\u522b\u4fdd\u5b58 4GB \u6570\u636e\uff0c\u4f60\u4f1a\u7528\u54ea\u79cd\u65b9\u6848\u5462\uff1f\u8bf7\u804a\u4e00\u804a\u4f60\u7684\u60f3\u6cd5\u3002 \u7b54\u6848\uff1a Redis \u7684 Hash \u7c7b\u578b\u5c5e\u4e8e\u5178\u578b\u7684\u96c6\u5408\u7c7b\u578b\uff0c\u53ef\u4ee5\u4fdd\u5b58 key-value \u5f62\u5f0f\u7684\u6570\u636e\u3002\u800c\u4e14\uff0c\u5f53 Hash \u7c7b\u578b\u4e2d\u4fdd\u5b58\u8f83\u591a\u6570\u636e\u65f6\uff0c\u5b83\u7684\u5e95\u5c42\u662f\u7531\u54c8\u5e0c\u8868\u5b9e\u73b0\u7684\u3002 \u54c8\u5e0c\u8868\u7684\u5b58\u53d6\u590d\u6742\u5ea6\u662f O(1)\uff0c\u6240\u4ee5\u53ef\u4ee5\u5b9e\u73b0\u5feb\u901f\u8bbf\u95ee\u3002 \u5728\u8fd9\u9053\u9898\u4e2d\uff0c\u77ed\u89c6\u9891\u5c5e\u6027\u4fe1\u606f\u5c5e\u4e8e\u5178\u578b key-value \u5f62\u5f0f\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Hash \u7c7b\u578b\u4fdd\u5b58\u77ed\u89c6\u9891\u4fe1\u606f\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5c31\u662f\u5c06\u4e00\u4e2a\u77ed\u89c6\u9891 ID \u4f5c\u4e3a Hash \u96c6\u5408\u7684 key\uff0c\u5c06\u77ed\u89c6\u9891\u7684\u5176\u4ed6\u5c5e\u6027\u4fe1\u606f\u4f5c\u4e3a Hash \u96c6\u5408\u5185\u90e8\u7684\u952e\u503c\u5bf9\uff0c\u4f8b\u5982\u201c\u4f5c\u8005\u201d:\u201c\u5b9e\u9645\u59d3\u540d\u201d\uff0c\u201c\u521b\u5efa\u65f6\u95f4\u201d:\u201c\u5b9e\u9645\u65f6\u95f4\u201d\u3002\u8fd9\u6837\u65e2\u6ee1\u8db3\u4e86\u4fdd\u5b58\u6570\u636e\u7684\u9700\u6c42\uff0c\u4e5f\u53ef\u4ee5\u5229\u7528 Hash \u5feb\u901f\u67e5\u8be2\u7684\u7279\u70b9\uff0c\u5feb\u901f\u67e5\u5230\u76f8\u5e94\u7684\u4fe1\u606f\u3002 Redis \u7684 AOF \u65e5\u5fd7\u4f1a\u8bb0\u5f55\u5ba2\u6237\u7aef\u53d1\u9001\u7ed9\u5b9e\u4f8b\u7684\u6bcf\u4e00\u6b21\u5199\u64cd\u4f5c\u547d\u4ee4\uff0c\u5728 Redis \u5b9e\u4f8b\u6062\u590d\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u91cd\u65b0\u8fd0\u884c AOF \u6587\u4ef6\u4e2d\u7684\u547d\u4ee4\uff0c\u5b9e\u73b0\u6062\u590d\u6570\u636e\u7684\u76ee\u7684\u3002\u5728\u8fd9\u9053\u9898\u7684\u4e1a\u52a1\u573a\u666f\u4e2d\uff0c\u8d1f\u8f7d\u4ee5\u8bfb\u4e3a\u4e3b\uff0c\u56e0\u6b64\uff0c\u5199\u547d\u4ee4\u4e0d\u4f1a\u592a\u591a\uff0cAOF \u65e5\u5fd7\u6587\u4ef6\u7684\u4f53\u91cf\u4e0d\u4f1a\u592a\u5927\uff0c\u5373\u4f7f\u5b9e\u4f8b\u6545\u969c\u4e86\uff0c\u4e5f\u53ef\u4ee5\u5feb\u901f\u5b8c\u6210\u6062\u590d\u3002\u6240\u4ee5\uff0c\u5f53\u4f7f\u7528\u5355\u5b9e\u4f8b\u8fd0\u884c\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 AOF \u65e5\u5fd7\u6765\u505a\u6301\u4e45\u5316\u65b9\u6848\u3002 \u5173\u4e8e\u4f7f\u7528\u591a\u5b9e\u4f8b\u7684\u8fd0\u884c\u65b9\u6848\uff1a\u4e24\u79cd\u65b9\u6848\u5404\u6709\u4f18\u52bf\uff0c\u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\u3002 \u65b9\u6848\u4e00 \u4f18\u52bf\uff1a\u53ef\u4ee5\u8282\u7701\u4e91\u4e3b\u673a\u6570\u91cf\u548c\u6210\u672c\u3002\u867d\u7136\u4e3b\u4ece\u8282\u70b9\u8fdb\u884c\u7b2c\u4e00\u6b21\u5168\u91cf\u540c\u6b65\u65f6\uff0cRDB \u6587\u4ef6\u8f83\u5927\uff0c\u8017\u65f6\u4f1a\u957f\u4e9b\uff0c\u4f46\u662f\u56e0\u4e3a\u5199\u8bf7\u6c42\u5c11\uff0c \u6240\u4ee5\u590d\u5236\u7f13\u51b2\u533a\u7684\u538b\u529b\u4e0d\u5927 \u3002 \u4e0d\u8db3\uff1a\u5982\u679c\u7f51\u7edc\u73af\u5883\u4e0d\u597d\uff0c\u9700\u8981\u9891\u7e41\u5730\u8fdb\u884c\u5168\u91cf\u540c\u6b65\u7684\u8bdd\uff0c\u8fd9\u79cd\u65b9\u6848\u7684\u4f18\u52bf\u5c31\u5c0f\u4e86\uff0c\u6bcf\u6b21\u5168\u91cf\u540c\u6b65\u65f6\u7684 RDB \u751f\u6210\u548c\u4f20\u8f93\u538b\u529b\u90fd\u5f88\u5927\u3002 \u65b9\u6848\u4e8c \u4f18\u52bf\uff1a\u6bcf\u4e2a\u5b9e\u4f8b\u53ea\u7528\u4fdd\u5b58 4GB \u6570\u636e\uff0c\u548c\u4ece\u5e93\u540c\u6b65\u65f6\u7684\u538b\u529b\u8f83\u5c0f\u3002\u800c\u4e14\uff0c\u8fd9\u79cd\u65b9\u6848\u7684\u53ef\u6269\u5c55\u6027\u66f4\u597d\uff0c\u5982\u679c\u6709\u65b0\u589e\u6570\u636e\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u5e94\u5bf9\u3002 \u4e0d\u8db3\uff1a\u9700\u8981\u8f83\u591a\u7684\u4e91\u4e3b\u673a\uff0c\u8fd0\u7ef4\u548c\u8d44\u6e90\u6210\u672c\u8f83\u9ad8\u3002 3\u3001\u671f\u672b\u9009\u62e9\u9898 1.\u5728\u79d2\u6740\u573a\u666f\u4e0b\uff0c\u4f60\u53ef\u4ee5\u5728\u4e0b\u9762\u54ea\u4e2a\u73af\u8282\u5e94\u7528Redis? \u524d\u7aef\u9759\u6001\u9875\u9762\u7f13\u5b58 \u79d2\u6740\u5546\u54c1\u5e93\u5b58\u67e5\u8be2\u548c\u6263\u51cf \u62e6\u622a\u6076\u610f\u653b\u51fb\u7684\u8bf7\u6c42 \u6570\u636e\u5e93\u8ba2\u5355\u5f02\u5e38\u5904\u7406 2.\u5bf9\u4e8e\u5207\u7247\u96c6\u7fa4\u6765\u8bf4\uff0c\u6570\u636e\u503e\u659c\u662f\u9700\u8981\u5173\u6ce8\u7684\u95ee\u9898\uff0c\u4ee5\u4e0b\u54ea\u4e9b\u539f\u56e0\u4f1a\u5f15\u8d77\u6570\u636e\u503e\u659c\uff1f \u5b58\u5728bigkey RDB\u5feb\u7167\u7684\u751f\u6210 \u6570\u636e\u5206\u5e03\u4e0d\u5747\u8861 HashTag\u7684\u4f7f\u7528 RDB\u5feb\u7167\u548c\u6570\u636e\u503e\u659c\u6ca1\u6709\u5173\u7cfb bigkey \u5bfc\u81f4\u503e\u659c / Slot \u5206\u914d\u4e0d\u5747\u8861\u5bfc\u81f4\u503e\u659c / Hash Tag \u5bfc\u81f4\u503e\u659c \u6570\u636e\u5206\u5e03\u4f18\u5316\u5e94\u5bf9\u6570\u636e\u503e\u659c 3.\u5173\u4e8eRedis 6.0\u7684ACL\u63a7\u5236\u673a\u5236\u7684\u63cf\u8ff0\uff0c\u54ea\u4e9b\u662f\u4e0d\u6b63\u786e ACL\u652f\u6301\u4e0d\u540c\u7528\u6237\u7528\u4e0d\u540c\u5bc6\u7801\u767b\u5f55 ACL\u53ea\u652f\u6301\u6309\u4e00\u7c7b\u547d\u4ee4\u7684\u7c92\u5ea6\u8bbe\u7f6e\u8bbf\u95ee\u89c4\u5219 ACL\u53ef\u4ee5\u7981\u6b62\u5ba2\u6237\u7aef\u8c03\u7528\u6240\u6709\u547d\u4ee4\u64cd\u4f5c ACL\u4f7f\u7528\u77ed\u6a2a\u7ebf\u4e00\u548ckey\u524d\u7f00\u7684key \u6765\u8868\u793a\u63a7\u5236\u8bbf\u95ee \u9009\u9879B, ACL\u652f\u6301\u5bf9\u5355\u4e2a\u547d\u4ee4\u8bbe\u7f6e\u8bbf\u95ee\u63a7\u5236\u89c4\u5219 \u9009\u9879D,ACL\u4f7f\u7528\u6ce2\u6d6a\u7ebf\u8bbe\u7f6e\u88ab\u8bbf\u95ee\u63a7\u5236\u7684key \u4f7f\u7528\u6ce2\u6d6a\u53f7\u201c~\u201d\u548c key \u7684\u524d\u7f00\u6765\u8868\u793a\u63a7\u5236\u8bbf\u95ee\u7684 key\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u8bbe\u7f6e\u7528\u6237 normaluser \u53ea\u80fd\u5bf9\u4ee5\u201cuser:\u201d\u4e3a\u524d\u7f00\u7684 key \u8fdb\u884c\u547d\u4ee4\u64cd\u4f5c\uff1a ACL SETUSER normaluser ~user:* +@all 4.Redis 6.0\u5f00\u59cb\u652f\u6301\u591aIO\u7ebf\u7a0b\uff0c\u5173\u4e8e\u591aIO\u7ebf\u7a0b\u7684\u63cf\u8ff0\uff0c\u4ee5\u4e0b\u54ea\u4e2a\u8bf4\u6cd5\u662f\u6b63\u786e\u7684 \u591aIO\u7ebf\u7a0b\u53ef\u4ee5\u5e76\u884c\u6267\u884cGET\u3001SET\u7b49\u8bf7\u6c42\u64cd\u4f5c Redis 6.0\u4e2d\u9ed8\u8ba4\u542f\u7528\u4e86\u591aIO\u7ebf\u7a0b \u53ef\u4ee5\u4f7f\u7528io-threads\u914d\u7f6e\u9879\u8bbe\u7f6e\u591a\u7ebf\u7a0b\u7684\u4e2a\u6570 \u53ef\u4ee5\u4f7f\u7528io-threads-enable\u6765\u542f\u7528\u6216\u5173\u95ed\u591a\u7ebf\u7a0b\u673a\u5236 \u8bbe\u7f6e\u7ebf\u7a0b\u4e2a\u6570\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u7ebf\u7a0b\u4e2a\u6570\u8981\u5c0f\u4e8e Redis \u5b9e\u4f8b\u6240\u5728\u673a\u5668\u7684 CPU \u6838\u4e2a\u6570\uff0c\u4f8b\u5982\uff0c\u5bf9\u4e8e\u4e00\u4e2a 8 \u6838\u7684\u673a\u5668\u6765\u8bf4\uff0cRedis \u5b98\u65b9\u5efa\u8bae\u914d\u7f6e 6 \u4e2a IO \u7ebf\u7a0b\u3002 io-threads 6 A\u9009\u9879\uff0c \u591aIO\u7ebf\u7a0b\u53ea\u662f\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\u89e3\u6790 B\u9009\u9879\uff0c \u9ed8\u8ba4\u662f\u5173\u95ed\u7684 D\u9009\u9879\uff0c \u4f7f\u7528 io-threads-do-reads \u914d\u7f6e\u9879\u542f\u505c\u591aIO\u7ebf\u7a0b 5.\u5f53\u4f7f\u7528RESP 2\u534f\u8bae\u7684\u5ba2\u6237\u7aef\u60f3\u8981\u4f7f\u7528Redis 6.0\u4e2d\u63a8\u51fa\u7684\u5ba2\u6237\u7aef\u7f13\u5b58\u529f\u80fd\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u54ea\u79cd\u6a21\u5f0f\uff1f direct redirect broadcast \u666e\u901a\u6a21\u5f0f \u666e\u901a\u6a21\u5f0f\u548c\u5e7f\u64ad\u6a21\u5f0f\uff0c\u9700\u8981\u5ba2\u6237\u7aef\u4f7f\u7528 RESP 3 \u534f\u8bae\uff0cRESP 3 \u534f\u8bae\u662f 6.0 \u65b0\u542f\u7528\u7684\u901a\u4fe1\u534f\u8bae \u5bf9\u4e8e\u4f7f\u7528 RESP 2 \u534f\u8bae\u7684\u5ba2\u6237\u7aef\u6765\u8bf4\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u53e6\u4e00\u79cd\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f\u91cd\u5b9a\u5411\u6a21\u5f0f\uff08redirect\uff09\u3002 6.NVM\u662f\u8fd1\u5e74\u6765\u5b58\u50a8\u8bbe\u5907\u53d1\u5c55\u7684\u4e00\u4e2a\u5927\u53d8\u5316\uff0c\u4f1a\u5bf9Redis\u7b49\u7cfb\u7edf\u8f6f\u4ef6\u4ea7\u751f\u5de8\u5927\u5f71\u54cd\uff0c\u4ee5\u4e0b\u54ea\u4e2a\u7279\u6027\u4e0d\u662f\u975e\u6613\u5931\u5b58\u50a8\u5668\u4ef6\u5177\u5907\u7684\u7279\u6027\uff1f \u8bfb\u5ef6\u8fdf\u548cDRAM\u4e00\u6837 \u5199\u5ef6\u8fdf\u63a5\u8fd1DRAM \u53ef\u4ee5\u6301\u4e45\u5316\u4fdd\u5b58\u6570\u636e \u5bc6\u5ea6\u5927\uff0c\u5bb9\u91cf\u5927 \u9009\u9879A\uff0c\u6b63\u786e\uff0c NVM\u8bfb\u5ef6\u8fdf\u8981\u9ad8\u4e8eDRAM\uff0c\u9009\u9879\u7b54\u6848\u4e0d\u662fNVM\u7279\u6027 \u9009\u9879B\uff0c\u5c5e\u4e8eNVM\u7279\u6027 \u9009\u9879C\uff0c\u5c5e\u4e8eNVM\u7279\u6027 \u9009\u9879D\uff0c\u5c5e\u4e8eNVM\u7279\u6027 7.\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u5728\u4e3b\u4ece\u5e93\u95f4\u7684\u4e00\u81f4\u6027\uff0c \u6211\u4eec\u9700\u8981\u5c06\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u7edd\u5bf9\u65f6\u95f4 \uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u54ea\u4e9b\u547d\u4ee4\u6765\u8fdb\u884c\u8bbe\u7f6e\uff1f EXPIRE PEXIRE EXPIREAT PEXPIREAT EXPIRE \u548c PEXPIRE\uff1a\u5b83\u4eec\u7ed9\u6570\u636e\u8bbe\u7f6e\u7684\u662f\u4ece\u547d\u4ee4\u6267\u884c\u65f6\u5f00\u59cb\u8ba1\u7b97\u7684\u5b58\u6d3b\u65f6\u95f4\uff1b EXPIRE / PEXIRE \u8be5\u547d\u4ee4\u8bbe\u7f6e\u76f8\u5bf9\u8fc7\u671f\u65f6\u95f4 EXPIREAT \u548c PEXPIREAT\uff1a\u5b83\u4eec\u4f1a\u76f4\u63a5\u628a\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u5177\u4f53\u7684\u4e00\u4e2a\u65f6\u95f4\u70b9\u3002 \u4ec0\u4e48\u4f1a\u5bfc\u81f4\u8bfb\u53d6\u5230\u8fc7\u671f\u6570\u636e 8.\u4e0b\u9762\u8fd9\u4e9b\u5173\u4e8eRedis\u4e8b\u52a1\u673a\u5236\u7684\u63cf\u8ff0\uff0c\u54ea\u4e9b\u662f\u6b63\u786e\u7684\uff1f Redis\u4e8b\u52a1\u53ef\u4ee5\u4fdd\u8bc1\u539f\u5b50\u6027 Redis\u4e8b\u52a1\u53ef\u4ee5\u4fdd\u8bc1\u4e00\u81f4\u6027 Redis\u4e8b\u52a1\u4e0d\u80fd\u4fdd\u8bc1\u9694\u79bb\u6027 Redis\u4e8b\u52a1\u65e0\u6cd5\u4fdd\u8bc1\u6301\u4e45\u6027 \u9009\u9879A, Redis\u5728\u4e8b\u52a1\u4e2d\u6709\u547d\u4ee4\u8bed\u6cd5\u9519\u8bef\u65f6\uff0c\u65e0\u6cd5\u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u5176\u4ed6\u60c5\u51b5\u53ef\u4ee5\u4fdd\u8bc1 \u9009\u9879C, Redis\u4e8b\u52a1\u53ef\u4ee5\u4fdd\u8bc1\u9694\u79bb\u6027 9.\u5047\u8bbe\u4e00\u4e2a\u5ba2\u6237\u7aef\u7684ID\u53f7\u662f100\uff0c\u8be5\u5ba2\u6237\u7aef\u60f3\u4f7f\u7528\u540d\u4e3amylock\u7684key\u4f5c\u4e3a\u9501\u53d8\u91cf\uff0c\u5e76\u8bbe\u7f6e\u9501\u53d8\u91cf\u7684\u8fc7\u671f\u65f6\u95f4\u662f10s\uff0c\u8bf7\u95ee\u5e94\u8be5\u4f7f\u7528\u4ee5\u4e0b\u54ea\u4e2a\u547d\u4ee4\u6765\u8fdb\u884c\u52a0\u9501\u64cd\u4f5c\uff1f SET mylock 100 PX 10 SET mylock 100 PX 10000 SET mylock 100 NX EX 10 SET mylock 10 NX EX 100 \u5982\u679c\u4f7f\u7528\u4e86 NX \u9009\u9879\uff0cSET \u547d\u4ee4\u53ea\u6709\u5728\u952e\u503c\u5bf9\u4e0d\u5b58\u5728\u65f6\uff0c\u624d\u4f1a\u8fdb\u884c\u8bbe\u7f6e\uff0c\u5426\u5219\u4e0d\u505a\u8d4b\u503c\u64cd\u4f5c\u3002\u6b64\u5916\uff0cSET \u547d\u4ee4\u5728\u6267\u884c\u65f6\u8fd8\u53ef\u4ee5\u5e26\u4e0a EX \u6216 PX \u9009\u9879\uff0c\u7528\u6765\u8bbe\u7f6e\u952e\u503c\u5bf9\u7684\u8fc7\u671f\u65f6\u95f4\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0c\u53ea\u6709 key \u4e0d\u5b58\u5728\u65f6\uff0cSET \u624d\u4f1a\u521b\u5efa key\uff0c\u5e76\u5bf9 key \u8fdb\u884c\u8d4b\u503c\u3002\u53e6\u5916\uff0ckey \u7684\u5b58\u6d3b\u65f6\u95f4\u7531 seconds \u6216\u8005 milliseconds \u9009\u9879\u503c\u6765\u51b3\u5b9a\u3002 SET key value [EX seconds | PX milliseconds] [NX] \u6709\u4e86 SET \u547d\u4ee4\u7684 NX \u548c EX/PX \u9009\u9879\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6765\u5b9e\u73b0\u52a0\u9501\u64cd\u4f5c\u4e86\u3002 SET lock_key unique_value NX PX 10000 \u9009\u9879A, PX\u7684\u5355\u4f4d\u662f\u6beb\u79d2\uff0c\u8bbe\u7f6e\u7684\u8fc7\u671f\u65f6\u95f4\u4e0d\u5bf9 \u9009\u9879B\uff0c \u6ca1\u6709\u4f7f\u7528NX\u9009\u9879\uff0c\u5982\u679cmylock\u7684key\u672c\u8eab\u4e0d\u5b58\u5728\uff0c\u90a3\u4e48\u8be5\u547d\u4ee4\u4e5f\u4e0d\u4f1a\u521b\u5efakey\uff0c\u5bfc\u81f4\u52a0\u9501\u5931\u8d25 \u9009\u9879D, EX\u7684\u503c\u5e94\u8be5\u662f10, mylock\u7684\u503c\u5e94\u8be5\u662f100 10.\u5047\u8bbe\u6211\u4eec\u5c06Redis\u7684 min-slaves-to-write \u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a1, \u54e8\u5175\u7684 down-after-milliseconds \u8bbe\u7f6e\u4e3a 15s , \u54e8\u5175\u4e3b\u4ece\u5207\u6362\u9700\u8981 5s \u3002\u4e3b\u5e93\u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0\u5361\u4f4f\u4e86 18s \uff0c\u90a3 \u4e48\uff0c mIn-slaves-max-lag \u8bbe\u7f6e\u4e3a\u591a\u5c11\u65f6\uff0c\u53ef\u4ee5\u907f\u514d\u8111\u88c2\uff1f 15 16 23 33 \u9009\u9879C\uff0c \u65e7\u4e3b\u5e9318s\u540e\u6062\u590d\u6b63\u5e38\uff0c\u6b64\u65f6\u8fd8\u6ca1\u6709\u8d85\u51fa23s\uff0c\u800c\u4e14\u54e8\u5175\u8fd8\u6ca1\u6709\u5207\u6362\u5b8c\u6210\uff0c\u5bfc\u81f4\u65e7\u4e3b\u5e93\u53ef\u80fd\u63a5\u6536\u5199\u8bf7\u6c42 \u9009\u9879D\uff0c \u65e7\u4e3b\u5e9318s\u540e\u6062\u590d\u6b63\u5e38\uff0c\u6b64\u65f6\u6ca1\u6709\u8d85\u51fa33s\uff0c\u800c\u4e14\u54e8\u5175\u8fd8\u6ca1\u6709\u5207\u6362\u5b8c\u6210\uff0c\u5bfc\u81f4\u65e7\u4e3b\u5e93\u53ef\u80fd\u63a5\u6536\u5199\u8bf7\u6c42 min-slaves-max-lag \uff1a\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e86\u4e3b\u4ece\u5e93\u95f4\u8fdb\u884c\u6570\u636e\u590d\u5236\u65f6\uff0c\u4ece\u5e93\u7ed9\u4e3b\u5e93\u53d1\u9001 ACK \u6d88\u606f\u7684\u6700\u5927\u5ef6\u8fdf\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09\u3002 11.\u5047\u8bbe\u6709\u4e00\u4e2a\u4e1a\u52a1\u5e94\u7528\u60f3\u4f7f\u7528\u5982\u4e0b\u4ee3\u7801\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\uff0c\u4f60\u89c9\u5f97\uff0c\u8fd9\u6bb5\u4ee3\u7801\u6709\u4ec0\u4e48\u95ee\u9898\u5417\uff1f SETNX lock_key 1 DO THINGS DEL lock_key \u6ca1\u6709\u5bf9\u9501\u53d8\u91cf\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4,\u4f1a\u5bfc\u81f4\u9501\u53ef\u80fd\u4e00\u76f4\u88ab\u6301\u6709 \u5e94\u8be5\u4f7f\u7528SET\u547d\u4ee4\u52a0\u4e0aNX\u9009\u9879 lock_key \u8fd9\u4e2a\u952e\u503c\u5bf9\u7684\u952e\u540d\u79f0\u5e94\u8be5\u6539\u4e3a\u5ba2\u6237\u7aef\u7684\u552f\u4e00ID \u9501\u53d8\u91cf\u53ef\u80fd\u88ab\u5e76\u53d1\u7684\u5ba2\u6237\u7aef\u91ca\u653e\u6389 \u9009\u9879B\uff0cSETNX\u548cSET NX\u7684\u6548\u679c\u662f\u4e00\u6837\u7684 \u9009\u9879C\uff0c\u9700\u8981\u628a lock_key \u952e\u503c\u5bf9\u7684\u503c\u6539\u4e3a\u5ba2\u6237\u7aef\u552f\u4e00ID\uff0c\u800c\u4e0d\u662f\u628a\u952e\u6539\u4e3a\u552f\u4e00ID 12.\u5047\u8bbe\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u540c\u65f6\u8bfb\u53d6\u952e\u503c\u5bf9a\u3001b\u7684\u503c\uff0c\u5e76\u5bf9\u952e\u503c\u5bf9c\u7684\u503c\u505a\u52a01\u64cd\u4f5c\uff0c\u4e0b\u9762\u54ea\u4e9b\u4ee3\u7801\u7247\u6bb5\u80fd\u4fdd\u8bc1\u6570\u636e\u7684\u6b63\u786e\u6027\uff1f A. GET a GET b INC c B. \u4ee5\u4e0b 5 \u53e5\u4f7f\u7528 Lua \u811a\u672c\u5b9e\u73b0 GET a GET b GET c c = c + 1 SET c C. GET a GET b // \u4ee5\u4e0b\u4e09\u53e5\u7528 Lua \u811a\u672c\u5b9e\u73b0 GET c c = c + 1 SET c D. GET a GET b // \u4ee5\u4e0b\u4e24\u53e5\u7528 Lua \u811a\u672c\u5b9e\u73b0 GET c c = c + 1 SET c \u9009\u9879A\uff0c\u6b63\u786e\uff0cINCR\u547d\u4ee4\u539f\u5b50\u6267\u884c\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u6b63\u786e\u6027 \u9009\u9879B\uff0c\u6b63\u786e\uff0cLua\u811a\u672c\u539f\u5b50\u6267\u884c\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u6b63\u786e\u6027\uff0c\u4f46\u662f\u6ca1\u6709\u5fc5\u8981\u628aGET a\u548cb\u4e5f\u653e\u5230\u811a\u672c\u4e2d \u9009\u9879C\uff0c\u6b63\u786e \u9009\u9879D, SET c\u9700\u8981\u548c\u8bfb\u53d6c\uff0c\u4ee5\u53cac\u505a\u52a0\u4e00\u64cd\u4f5c\u4e00\u8d77\u6267\u884c 13.Pika\u662f\u4e00\u4e2a\u57fa\u4e8eSSD\u5b9e\u73b0\u7684\u5927\u5bb9\u91cf\u952e\u503c\u6570\u636e\u5e93\uff0c\u4e0b\u9762\u8fd9\u4e9b\u5173\u4e8ePika\u7684\u8bf4\u6cd5\u4e2d\uff0c\u6709\u54ea\u4e9b\u662f\u6b63\u786e\u7684\uff1f Pika\u867d\u7136\u53ef\u4ee5\u5b9e\u73b0\u5927\u5bb9\u91cf\u5b58\u50a8\uff0c\u4f46\u662f\u6570\u636e\u7c7b\u578b\u548c Redis\u4e0d\u517c\u5bb9 Pika\u5185\u90e8\u4f7f\u7528RocksDB\u6765\u4fdd\u5b58\u843d\u76d8\u7684\u6570\u636e Pika\u4f7f\u7528\u591a\u7ebf\u7a0b\u6765\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42 pika\u4f7f\u7528binlog\u673a\u5236\u5b9e\u73b0\u5199\u547d\u4ee4\u7684\u589e\u91cf\u540c\u6b65\u548cRedis\u4e00\u6837\uff0c\u4ecd\u7136\u4f1a\u53d7\u5185\u5b58\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u9650\u5236 A\u9009\u9879\uff0c Pika\u652f\u6301\u517c\u5bb9Redis\u76845\u5927\u57fa\u672c\u6570\u636e\u7c7b\u578b D\u9009\u9879\uff0c Pika\u4e3b\u4ece\u540c\u6b65\u65f6\uff0c\u4e0d\u53d7\u7f13\u5b58\u533a\u5927\u5c0f\u9650\u5236\u4e86 14.\u4e0b\u9762\u8fd9\u4e9b\u5173\u4e8eCodis\u96c6\u7fa4\u7684\u63cf\u8ff0\uff0c\u54ea\u4e9b\u662f\u6b63\u786e\u7684\uff1f Codis\u96c6\u7fa4\u9ed8\u8ba4\u4f7f\u752816384\u4e2aSlot\u8fdb\u884ckey\u7684\u5206\u914d \u4e3a\u4e86\u4fdd\u8bc1\u8fc1\u79fb\u6570\u636e\u7684\u5b8c\u6574\u6027\uff0cCodis\u53ea\u652f\u6301\u540c\u6b65\u8fc1\u79fb Codis proxy\u63a5\u6536\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u5e76\u8fdb\u884c\u8bf7\u6c42\u8f6c\u53d1 Codis\u96c6\u7fa4\u53ef\u4ee5\u4f7f\u7528etcd\u4fdd\u5b58\u96c6\u7fa4\u5143\u6570\u636e A\u9009\u9879\uff0c Codis\u9ed8\u8ba4\u4f7f\u75281024\u4e2aSlot B\u9009\u9879\uff0cCodis\u652f\u6301\u5f02\u6b65\u8fc1\u79fb\uff0c\u662f\u4e3a\u4e86\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b 15.\u5f53Redis\u7528\u4f5c\u7f13\u5b58\u65f6\uff0c\u5982\u679c\u540c\u65f6\u6709 \u5927\u91cf\u6570\u636e\u5931\u6548 \uff0c\u90a3\u4e48\u6b64\u65f6\u4f1a\u53d1\u751f\u4ec0\u4e48\u95ee\u9898\uff1f \u7f13\u5b58\u51fb\u7a7f \u7f13\u5b58\u7a7f\u900f \u7f13\u5b58\u96ea\u5d29 \u6ca1\u6709\u95ee\u9898 A\u9009\u9879\uff0c \u51fb\u7a7f\u662f\u8868\u793a\u5355\u4e2a\u6216\u5c11\u91cf\u70ed\u70b9\u6570\u636e\u5931\u6548 B\u9009\u9879\uff0c \u7a7f\u900f\u662f\u6307\u8bbf\u95ee\u7684\u6570\u636e\u65e2\u4e0d\u5728\u7f13\u5b58\uff0c\u4e5f\u4e0d\u5728\u6570\u636e\u5e93 C\u9009\u9879\uff0c\u6b63\u786e D\u9009\u9879\uff0c \u9898\u5e72\u6761\u4ef6\u4e0b\uff0c\u4f1a\u53d1\u751f\u7f13\u5b58\u96ea\u5d29\uff0c\u5bfc\u81f4\u5927\u91cf\u8bf7\u6c42\u53d1\u9001\u5230\u6570\u636e\u5e93\u5c42\uff0c\u7ed9\u6570\u636e\u5e93\u5c42\u5e26\u6765\u538b\u529b 16.\u5728\u4f7f\u7528Redis\u4f5c\u4e3a\u7f13\u5b58\u65f6\uff0c \u5982\u679c\u6709\u4e00\u4e2a\u5e94\u7528\u7684\u8d1f\u8f7d\u662f\u5bf9\u4e00\u4e2a\u5927\u6570\u636e\u96c6\u4e2d\u7684\u6240\u6709\u6570\u636e\u626b\u63cf\u4e00\u904d \uff0c\u90a3\u4e48\u4f7f\u7528\u4e0b\u9762\u54ea\u79cd\u6570\u636e\u6dd8\u6c70\u7b56\u7565\u4f1a\u66f4\u52a0\u5408\u9002\uff1f allkeys-lru allkeys-Ifu allkeys-random noeviction A\u9009\u9879\uff0c \u8be5\u7b56\u7565\u6309\u6570\u636e\u8bbf\u95ee\u65f6\u6548\u6027\u8fdb\u884c\u7b5b\u9009\uff0c\u4f1a\u5bfc\u81f4\u521a\u88ab\u8bbf\u95ee\u7684\u6570\u636e\u6ede\u7559\u5728\u7f13\u5b58\uff0c\u65e0\u6cd5\u88ab\u53ca\u65f6\u6dd8\u6c70\uff0c\u9020\u6210\u7f13\u5b58\u6c61\u67d3 B\u9009\u9879\uff0c\u6b63\u786e C\u9009\u9879\uff0c\u8be5\u7b56\u7565\u968f\u673a\u9009\u53d6\u6dd8\u6c70\u7684\u6570\u636e\uff0c\u4f1a\u9020\u6210\u7f13\u5b58\u6c61\u67d3 D\u9009\u9879\uff0c\u8be5\u7b56\u7565\u4e0d\u4f1a\u6dd8\u6c70\u6570\u636e LFU \u7f13\u5b58\u7b56\u7565\u662f\u5728 LRU \u7b56\u7565\u57fa\u7840\u4e0a\uff0c\u4e3a\u6bcf\u4e2a\u6570\u636e\u589e\u52a0\u4e86\u4e00\u4e2a\u8ba1\u6570\u5668\uff0c\u6765\u7edf\u8ba1\u8fd9\u4e2a\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u3002 LRU \u7b97\u6cd5\u7684\u5168\u79f0\u662f Least Recently Used\uff0c\u4ece\u540d\u5b57\u4e0a\u5c31\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u662f\u6309\u7167\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u539f\u5219\u6765\u7b5b\u9009\u6570\u636e\uff0c\u6700\u4e0d\u5e38\u7528\u7684\u6570\u636e\u4f1a\u88ab\u7b5b\u9009\u51fa\u6765\uff0c\u800c\u6700\u8fd1\u9891\u7e41\u4f7f\u7528\u7684\u6570\u636e\u4f1a\u7559\u5728\u7f13\u5b58\u4e2d 17.\u5728\u5e94\u7528Redis\u5207\u7247\u96c6\u7fa4\u65f6\uff0c\u4f7f\u7528\u4e86Hash Tag\u5bf9\u6570\u636e\u8fdb\u884c\u5207\u7247\uff0c\u73b0\u6709\u6570\u636e\u7684key\u662f user:info:{330} , value\u662f1024\uff0c\u8bf7\u95ee\u5207\u7247\u96c6\u7fa4\u4f7f\u7528\u6570\u636e\u7684\u54ea\u4e00\u90e8\u5206\u5185\u5bb9\u8ba1\u7b97CRC \u503c\uff1f user:info:{330} 1024 330 info \u9898\u76ee\u89e3\u6790 \u4f7f\u7528Hash Tag\u65f6\uff0c Redis\u53ea\u4f1a\u4f7f\u7528\u82b1\u62ec\u53f7\u5185\u7684\u5185\u5bb9\u8ba1\u7b97CRC\u503c \uff0c\u6240\u4ee5\u9009C\uff0c\u5176\u4ed6\u9009\u9879\u90fd\u4e0d\u662f\u82b1\u62ec\u53f7\u5185\u7684\u5185\u5bb9\u3002 18.\u5f53Redis\u7528\u4f5c\u53ea\u8bfb\u7f13\u5b58\u65f6\uff0c\u5982\u679c\u6570\u636e\u53d1\u751f\u4e86\u4fee\u6539\uff0c\u4ee5\u4e0b\u54ea \u4e2a\u8bf4\u6cd5\u662f\u6b63\u786e\u7684\uff1f \u901a\u8fc7\u5148\u5220\u9664\u7f13\u5b58\u503c\uff0c\u540e\u66f4\u65b0\u6570\u636e\u5e93\u503c\uff0c\u5c31\u53ef\u4ee5\u907f\u514d \u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898 \u901a\u8fc7\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58\uff0c\u5c31\u53ef\u4ee5\u907f\u514d\u6570\u636e \u4e0d\u4e00\u81f4\u95ee\u9898x \u5728\u5148\u5220\u9664\u7f13\u5b58\u503c\uff0c\u540e\u66f4\u65b0\u6570\u636e\u5e93\u65f6\u64cd\u4f5c, \u5982\u679c\u6709\u5e76\u53d1\u8bfb\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4f7f\u7528\u91cd\u8bd5\u6570\u636e\u5e93\u66f4\u65b0\u64cd\u4f5c\uff0c\u907f\u514d\u6570\u636e\u4e0d\u4e00\u81f4 \u5728\u5148\u5220\u9664\u7f13\u5b58\u503c\uff0c\u540e\u66f4\u65b0\u6570\u636e\u5e93\u65f6\uff0c\u5982\u679c\u6709\u5e76\u53d1\u8bfb\uff0c\u53ef\u4ee5\u4f7f\u7528\u5ef6\u8fdf\u53cc\u5220\uff0c\u6765\u5e94\u5bf9\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898 \u9009\u9879A\uff0c \u5220\u9664\u7f13\u5b58\u540e\uff0c\u5982\u679c\u6570\u636e\u5e93\u6ca1\u6709\u66f4\u65b0\u6210\u529f\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6570\u636e\u4e0d\u4e00\u81f4 \u9009\u9879B\uff0c \u66f4\u65b0\u6570\u636e\u5e93\u540e\uff0c\u5982\u679c\u7f13\u5b58\u5220\u9664\u5931\u8d25\uff0c\u5c31\u4f1a\u5bfc\u81f4\u4ecd\u7136\u8bfb\u5230\u65e7\u503c \u9009\u9879C\uff0c \u91cd\u8bd5\u6570\u636e\u5e93\u66f4\u65b0\u64cd\u4f5c\u662f\u5728\u6570\u636e\u5e93\u66f4\u65b0\u5931\u8d25\u60c5\u51b5\u4e0b\u7684\u5e94\u5bf9\u65b9\u6848 \u9009\u9879D\uff0c\u6b63\u786e 19.Redis\u7f13\u5b58\u4e00\u65e6\u53d1\u751f\u7f13\u5b58\u51fb\u7a7f\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5927\u91cf\u8bf7\u6c42\u53d1\u9001\u5230 \u6570\u636e\u5e93\u5c42\u8fdb\u884c\u5904\u7406\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u538b\u529b\u8fc7\u5927\u800c\u5d29\u6e83\uff0c \u4ee5\u4e0b\u54ea\u4e9b\u65b9\u6cd5\u53ef\u4ee5\u5e94\u5bf9\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898\uff0c\u7f13\u89e3\u6570\u636e\u5e93\u538b\u529b\uff1f \u7ed9\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u589e\u52a0\u968f\u673a\u91cf\uff0c\u907f\u514d\u540c\u65f6\u8fc7\u671f \u6570\u636e\u5e93\u9650\u6d41 \u5728\u4e1a\u52a1\u5e94\u7528\u63a5\u5165\u5c42\u68c0\u67e5\u662f\u5426\u6709\u6076\u610f\u8bf7\u6c42 \u4e0d\u7ed9\u70ed\u70b9\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4 A\u9009\u9879\uff0c\u8be5\u9009\u9879\u65b9\u6cd5\u662f\u7528\u6765\u5e94\u5bf9\u7f13\u5b58\u96ea\u5d29\u7684\uff0c\u89e3\u51b3\u4e0d\u4e86\u51fb\u7a7f\u95ee\u9898 B\u9009\u9879\uff0c\u6b63\u786e\uff0c\u53ef\u4ee5\u907f\u514d\u538b\u57ae\u6570\u636e\u5e93 C\u9009\u9879\uff0c\u8be5\u9009\u9879\u65b9\u6cd5\u662f\u7528\u6765\u5e94\u5bf9\u7f13\u5b58\u7a7f\u900f\u7684 D\u9009\u9879\uff0c\u6b63\u786e \u51fb\u7a7f\u662f\u8868\u793a\u5355\u4e2a\u6216\u5c11\u91cf\u70ed\u70b9\u6570\u636e\u5931\u6548 20.\u4ee5\u4e0b\u54ea\u4e2a\u547d\u4ee4\u4e0d\u5c5e\u4e8eRedis\u4e8b\u52a1\u673a\u5236\u6240\u9700\u7684\u5173\u952e\u547d\u4ee4\uff1f MULTI SET EXEC DISCARD A\u9009\u9879\uff0c\u662f\u4e8b\u52a1\u673a\u5236\u7684\u5173\u952e\u547d\u4ee4\uff0c\u8868\u793a\u4e8b\u52a1\u5f00\u59cb B\u9009\u9879\uff0c\u6b63\u786e\uff0c \u8fd9\u662f\u7528\u6765\u8bbe\u7f6ekey\u7684value\u503c\u7684\u547d\u4ee4\uff0c\u4e0d\u5c5e\u4e8e\u4e8b\u52a1\u673a\u5236\u7684\u5fc5\u9700\u547d\u4ee4 C\u9009\u9879\uff0c\u662f\u4e8b\u52a1\u673a\u5236\u7684\u5173\u952e\u547d\u4ee4\uff0c\u8ba9\u5b9e\u4f8b\u5f00\u59cb\u5b9e\u9645\u6267\u884c\u4e8b\u52a1 D\u9009\u9879\uff0c\u662f\u4e8b\u52a1\u673a\u5236\u7684\u5173\u952e\u547d\u4ee4\uff0c\u8868\u793a\u64a4\u9500\u4e8b\u52a1\u64cd\u4f5c","title":"Redis \u6838\u5fc3\u6280\u672f\u8003\u9898"},{"location":"chap10/1redis_test/#redis","text":"","title":"Redis \u6838\u5fc3\u6280\u672f\u8003\u9898"},{"location":"chap10/1redis_test/#1","text":"1.Redis\u7684Streams\u6570\u636e\u7c7b\u578b\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0\u6d88\u606f\u961f\u5217\uff0c\u5173\u4e8eStreams\uff0c\u4e0b\u5217\u54ea\u4e2a\u63cf\u8ff0\u662f \u4e0d\u6b63\u786e \u7684\uff1f Streams\u53ef\u4ee5\u4e3a\u6d88\u606f\u81ea\u52a8\u751f\u6210\u5168\u5c40\u552f\u4e00ID Streams\u4f1a\u81ea\u52a8\u7559\u5b58\u6d88\u606f\uff0c\u76f4\u5230\u6d88\u8d39\u8005\u4f7f\u7528XACK\u786e\u8ba4\u540e\uff0c\u518d\u5220\u9664\u6d88\u606f Streams\u652f\u6301\u963b\u585e\u5f0f\u6d88\u606f\u8bfb\u53d6 Streams\u63d0\u4f9b\u7684\u6d88\u8d39\u7ec4\u6a21\u5f0f\uff0c\u540c\u4e00\u4e2a\u6d88\u8d39\u7ec4\u5185\u7684\u6d88\u8d39\u8005\u53ef\u4ee5\u540c\u65f6\u6d88\u8d39\u540c\u4e00\u6761\u6d88\u606f \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6d88\u606f\u961f\u5217\u4e2d\u7684\u6d88\u606f\u4e00\u65e6\u88ab\u6d88\u8d39\u7ec4\u91cc\u7684\u4e00\u4e2a\u6d88\u8d39\u8005\u8bfb\u53d6\u4e86\uff0c\u5c31\u4e0d\u80fd\u518d\u88ab\u8be5\u6d88\u8d39\u7ec4\u5185\u7684\u5176\u4ed6\u6d88\u8d39\u8005\u8bfb\u53d6\u4e86\u3002 2.Redis\u8fd0\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8fd0\u7ef4\u4eba\u5458\u901a\u8fc7info memory \u67e5\u770b\u5230 mem_fragmentation_ratio \u7684\u503c\u7b49\u4e8e2, Redis\u7684\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u662f\u600e\u6837\u7684\uff1f \u5185\u5b58\u4f7f\u7528\u4e2d\u5b58\u5728\u8f83\u4e3a\u4e25\u91cd\u7684\u5185\u5b58\u788e\u7247 \u5185\u5b58\u7a7a\u95f4\u4e0d\u591f\uff0c\u53ef\u80fd\u5df2\u7ecf\u53d1\u751f\u4e86swap \u5185\u5b58\u4f7f\u7528\u6b63\u5e38\uff0c\u6709\u5c11\u91cf\u5185\u5b58\u788e\u7247 \u5185\u5b58\u975e\u5e38\u5145\u8db3\uff0c\u53ef\u4ee5\u4fdd\u5b58\u66f4\u591a\u7684\u6570\u636e mem_fragmentation_ratio \u5927\u4e8e 1.5\u3002\u8fd9\u8868\u660e\u5185\u5b58\u788e\u7247\u7387\u5df2\u7ecf\u8d85\u8fc7\u4e86 50%\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u9700\u8981\u91c7\u53d6\u4e00\u4e9b\u63aa\u65bd\u6765\u964d\u4f4e\u5185\u5b58\u788e\u7247\u7387\u4e86\u3002 3.\u5728Redis\u4e2d\uff0c\u9ed8\u8ba4\u7684\u5185\u5b58\u5206\u914d\u5668\u4f7f\u7528\u7684\u662fjemalloc\uff0c\u5f53 Redis\u60f3\u8981\u5206\u914d23\u5b57\u8282\u7684\u7a7a\u95f4\u65f6\uff0cjemalloc\u5b9e\u9645\u4f1a\u5206\u914d\u591a\u5927\u7a7a\u95f4\uff1f 23 24 32 64 jemalloc \u5728\u5206\u914d\u5185\u5b58\u65f6\uff0c\u4f1a\u6839\u636e\u6211\u4eec\u7533\u8bf7\u7684\u5b57\u8282\u6570 N\uff0c\u627e\u4e00\u4e2a\u6bd4 N \u5927\uff0c\u4f46\u662f\u6700\u63a5\u8fd1 N \u7684 2 \u7684\u5e42\u6b21\u6570\u4f5c\u4e3a\u5206\u914d\u7684\u7a7a\u95f4\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u9891\u7e41\u5206\u914d\u7684\u6b21\u6570\u3002 4.Redis\u4f7f\u7528RDB\u673a\u5236\u521b\u5efa\u5feb\u7167\uff0c\u5173\u4e8eRDB\u673a\u5236\uff0c\u4e0b\u9762\u7684\u63cf\u8ff0\u54ea\u4e2a\u662f\u9519\u8bef\u7684\uff1f \u4f7f\u7528save\u547d\u4ee4\u751f\u6210RDB\u5feb\u7167\u65f6\uff0c\u662f\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\u7684\uff0c\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b RDB\u6587\u4ef6\u662fRedis\u5b9e\u4f8b\u7684\u955c\u50cf\uff0c\u7528RDB \u6587\u4ef6\u6062\u590d\u5b9e\u4f8b\u65f6\uff0c\u76f4\u63a5\u628aRDB\u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\uff0c \u5c31\u53ef\u4ee5\u5feb\u901f\u6062\u590d\u4e86 \u548cAOF\u6587\u4ef6\u76f8\u6bd4\uff0cRDB\u6587\u4ef6\u66f4\u5c0f\u4e00\u70b9 \u4f7f\u7528bgsave\u547d\u4ee4\u521b\u5efaRDB\u5feb\u7167\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u53ea\u80fd\u5904\u7406\u8bfb\u8bf7\u6c42\uff0c\u5199\u8bf7\u6c42\u64cd\u4f5c\u4f1a\u88ab\u963b\u585e 2 bgsave \u521b\u5efa\u5feb\u7167\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u80fd\u540c\u65f6\u5904\u7406\u8bfb\u5199\u8bf7\u6c42 5.Redis\u4f7f\u7528AOF\u673a\u5236\u4fdd\u5b58\u6570\u636e\u64cd\u4f5c\u65f6\uff0c\u53ef\u4ee5\u91c7\u7528\u4e0d\u540c\u7684\u5199\u56de\u7b56\u7565\u3002 \u5f53\u9700\u8981\u6709\u4e00\u5b9a\u7684\u6570\u636e\u53ef\u9760\u6027\uff0c\u540c\u65f6\u4e5f\u4e0d\u80fd\u5bf9Redis\u5b9e\u4f8b\u9020\u6210\u8f83\u5927\u963b\u585e\u7684\u8bdd \uff0c\u5e94\u8be5\u9009\u62e9\u4ee5\u4e0b\u54ea\u79cd\u5199\u56de\u7b56\u7565\uff1f always everysec no yes \u4f7f\u7528everysec\u65f6\uff0c\u4f1a\u4f7f\u7528\u5b50\u7ebf\u7a0b\u6765\u64cd\u4f5c\uff0c\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002\u800c\u4f7f\u7528always\u65f6\uff0c\u662f\u4f7f\u7528\u4e3b\u7ebf\u7a0b\u6765\u64cd\u4f5c\uff0c\u6240\u4ee5\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b \u9009\u9879A\uff0c\u53ef\u9760\u6027\u9ad8\uff0c\u4f46\u4f1a\u963b\u585eRedis\u5b9e\u4f8b \u9009\u9879C\uff0c\u57fa\u672c\u4e0d\u4f1a\u963b\u585eRedis\u5b9e\u4f8b\uff0c\u4f46\u662f\u5b95\u673a\u540e\uff0c\u4f1a\u4e22\u5931\u8f83\u591a\u7684\u65e5\u5fd7\u8bb0\u5f55 \u9009\u9879D\uff0c\u5199\u56de\u7b56\u7565\u6ca1\u6709yes\u914d\u7f6e\u9879 6.\u73b0\u5728\uff0c\u6709\u4e00\u4e2aRedis\u5b9e\u4f8b\u6b63\u5728\u7ebf\u4e0a\u8fd0\u884c\uff0c \u5b83\u4f7f\u7528Hash\u7c7b\u578b\u4fdd\u5b58\u4e86\u4e00\u4e2akey\u4e3adevice\u7684Hash\u96c6\u5408 \uff0c\u96c6\u5408\u4e2d\u4fdd\u5b58\u4e86500\u4e07\u6761\u8bb0\u5f55\u3002\u5728\u8fd9\u4e9b\u8bb0\u5f55\u4e2d\uff0c\u670920\u4e07\u6761\u8bb0\u5f55\u7684key\u662f\u4ee5\u201credis\u201d\u5f00\u5934\u7684\uff0c\u73b0\u5728\u60f3\u628a\u8fd9\u4e9b\u8bb0\u5f55\u8bfb\u53d6\u51fa\u6765\uff0c\u5e94\u8be5\u91c7\u7528\u4ee5\u4e0b\u54ea\u4e9b\u547d\u4ee4\uff1f KEYS SCAN HSCAN SSCAN \u9009\u9879A, KEYS \u4f1a\u5f15\u8d77Redis\u5b9e\u4f8b\u963b\u585e\uff0c\u800c\u4e14KEYS\u65e0\u6cd5\u67e5\u8be2\u65e5ash\u96c6\u5408\u4e2d\u7684\u8bb0\u5f55 \u9009\u9879B, SCAN\u53ea\u80fd\u67e5\u8be2\u6574\u4e2a\u6570\u636e\u5e93\u4e2d\u7684key \u9009\u9879D, SSCAN\u662f\u7528\u6765\u626b\u63cf\u67e5\u8be2Set\u7c7b\u578b 7.\u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c\u5f53\u4e3b\u5e93\u6536\u5230\u4ece\u5e93\u53d1\u9001\u7684 psync?-1 \u547d\u4ee4 \u65f6\uff0c\u4ece\u5e93\u5e0c\u671b\u4e3b\u5e93\u6267\u884c\u7684\u64cd\u4f5c\u662f\u4ee5\u4e0b\u54ea\u4e00\u9879\uff1f \u8fdb\u884c\u589e\u91cf\u590d\u5236 \u7ed3\u675f\u6570\u636e\u590d\u5236\u64cd\u4f5c \u65ad\u5f00\u7f51\u7edc\u8fde\u63a5 \u8fdb\u884c\u5168\u91cf\u590d\u5236 \u9009\u9879A\uff0c\u589e\u91cf\u590d\u5236\u65f6\uff0c\u4ece\u5e93\u4f1a\u628a\u81ea\u5df1\u8bb0\u5f55\u7684\u4e3b\u5e93ID\u53d1\u7ed9\u4e3b\u5e93\uff0c\u6240\u4ee5psync\u547d\u4ee4\u4f1a\u5e26\u6709\u4e3b\u5e93ID \u9009\u9879B\uff0c\u4e0d\u4f1a\u53d1\u9001psync \u9009\u9879C\uff0c\u4e0d\u4f1a\u53d1\u9001psync \u7b2c\u4e00\u9636\u6bb5\u662f\u4e3b\u4ece\u5e93\u95f4\u5efa\u7acb\u8fde\u63a5\u3001\u534f\u5546\u540c\u6b65\u7684\u8fc7\u7a0b\uff0c\u4e3b\u8981\u662f\u4e3a\u5168\u91cf\u590d\u5236\u505a\u51c6\u5907 psync?-1 8.\u5173\u4e8e\u54e8\u5175\u673a\u5236\uff0c\u4e0b\u9762\u7684\u54ea\u4e2a\u63cf\u8ff0\u662f\u6b63\u786e\u7684\uff1f \u54e8\u5175\u662f\u4e00\u4e2a\u8fd0\u884c\u5728\u7279\u5b9a\u6a21\u5f0f\u4e0b\u7684Redis\u5b9e\u4f8b\uff0c\u4e5f\u53ef\u4ee5\u670d\u52a1\u8bf7\u6c42 \u54e8\u5175\u63d0\u4f9bpub/sub\u529f\u80fd \u54e8\u5175\u53ea\u901a\u8fc7\u5fc3\u8df3\u76d1\u542c\u4e3b\u5e93\u7684\u8fd0\u884c\u72b6\u6001 down-after-milliseconds \u662f\u54e8\u5175\u7528\u6765\u5224\u65ad\u4e3b\u5e93\u5ba2\u89c2\u4e0b\u7ebf\u7684\u5fc3\u8df3\u65ad\u8fde\u9608\u503c \u901a\u8fc7 pub/sub \u673a\u5236\uff0c\u54e8\u5175\u4e4b\u95f4\u53ef\u4ee5\u7ec4\u6210\u96c6\u7fa4\uff0c\u540c\u65f6\uff0c\u54e8\u5175\u53c8\u901a\u8fc7 INFO \u547d\u4ee4\uff0c\u83b7\u5f97\u4e86\u4ece\u5e93\u8fde\u63a5\u4fe1\u606f\uff0c\u4e5f\u80fd\u548c\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5\uff0c\u5e76\u8fdb\u884c\u76d1\u63a7\u4e86\u3002 \u9009\u9879A\uff0c\u54e8\u5175\u4e0d\u670d\u52a1\u8bf7\u6c42 \u9009\u9879C\uff0c\u54e8\u5175\u540c\u65f6\u76d1\u542c\u4ece\u5e93\u7684\u8fd0\u884c\u72b6\u6001 \u9009\u9879D, down-after-milliseconds\u662f\u4e3b\u89c2\u4e0b\u7ebf\u7684\u5224\u65ad\u4f9d\u636e \u54e8\u5175\u8fdb\u7a0b\u4f1a\u4f7f\u7528 PING \u547d\u4ee4\u68c0\u6d4b\u5b83\u81ea\u5df1\u548c\u4e3b\u3001\u4ece\u5e93\u7684\u7f51\u7edc\u8fde\u63a5\u60c5\u51b5\uff0c\u7528\u6765\u5224\u65ad\u5b9e\u4f8b\u7684\u72b6\u6001\u3002 \u5728\u5224\u65ad\u4e3b\u5e93\u662f\u5426\u4e0b\u7ebf\u65f6\uff0c\u4e0d\u80fd\u7531\u4e00\u4e2a\u54e8\u5175\u8bf4\u4e86\u7b97\uff0c\u53ea\u6709\u5927\u591a\u6570\u7684\u54e8\u5175\u5b9e\u4f8b\uff0c\u90fd\u5224\u65ad\u4e3b\u5e93\u5df2\u7ecf\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u4e86\uff0c\u4e3b\u5e93\u624d\u4f1a\u88ab\u6807\u8bb0\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\uff0c\u8fd9\u4e2a\u53eb\u6cd5\u4e5f\u662f\u8868\u660e\u4e3b\u5e93\u4e0b\u7ebf\u6210\u4e3a\u4e00\u4e2a\u5ba2\u89c2\u4e8b\u5b9e\u4e86 \u5982\u679c\u5728 down-after-milliseconds \u6beb\u79d2\u5185\uff0c\u4e3b\u4ece\u8282\u70b9\u90fd\u6ca1\u6709\u901a\u8fc7\u7f51\u7edc\u8054\u7cfb\u4e0a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba4\u4e3a\u4e3b\u4ece\u8282\u70b9\u65ad\u8fde\u4e86\u3002 9.\u5728\u4f7f\u7528\u54e8\u5175\u673a\u5236\u5bf9\u53d1\u751f\u6545\u969c\u7684\u4e3b\u4ece\u96c6\u7fa4\u8fdb\u884c\u4e3b\u4ece\u5e93\u5207 \u65f6\uff0c\u4f1a\u6d89\u53ca\uff1a (1) \u4e3b\u5e93\u88ab\u5224\u65ad\u4e3a\u4e3b\u89c2\u4e0b\u7ebf\uff1b (2\uff09\u4e3b\u5e93\u88ab\u5224\u65ad\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\uff1b (3\uff09\u786e\u5b9a\u65b0\u4e3b\u5e93\uff1b (4\uff09\u9009\u4e3e\u54e8\u5175Leader; (5\uff09\u4e3b\u4ece\u5e93\u5b9e\u9645\u5207\u6362\u3002 \u5173\u4e8e\u8fd9\u4e9b\u4e8b\u4ef6\u7684\u53d1\u751f\u987a\u5e8f\uff0c\u4ee5\u4e0b\u54ea\u4e2a\u9009\u9879\u7684\u63cf\u8ff0\u662f\u6b63\u786e\u7684\uff1f (1\uff09\u4e00\uff1e(2\uff09\u4e00\uff1e(3\uff09\u4e00\uff1e(4)\u4e00\uff1e(5) (2\uff09\u4e00\uff1e(1\uff09\u4e00\uff1e(3\uff09\u4e00\uff1e>(4)\u4e00\uff1e(5) (1\uff09\u4e00\uff1e(2\uff09\u4e00\uff1e(4)\u4e00\uff1e(3\uff09\u4e00\uff1e(5) (2\uff09\u4e00\uff1e>(1\uff09\u4e00\uff1e>(4)\u4e00\uff1e(3\uff09\u4e00\uff1e(5) \u4e3b\u5e93\u7684\u4e3b\u89c2\u4e0b\u7ebf\u53ea\u7528\u54e8\u5175\u81ea\u5df1\u5224\u65ad\u5c31\u884c\uff0c\u800c\u5ba2\u89c2\u4e0b\u7ebf\u9700\u8981\u591a\u4e2a\u54e8\u5175\u5171\u540c\u51b3\u5b9a\uff0c\u6240\u4ee5\u5224\u65ad\u4e3b\u5e93\u4e3b\u89c2\u4e0b\u7ebf\u8981\u65e9\u4e8e\u5224\u65ad\u5ba2\u89c2\u4e0b\u7ebf\u3002 \u4e3b\u4ece\u5e93\u5207\u6362\u65f6\uff0c\u65b0\u4e3b\u5e93\u662f\u7531\u54e8\u5175Leader\u6765\u786e\u5b9a\u7684\uff0c\u6240\u4ee5\uff0c\u54e8\u5175\u96c6\u7fa4\u9700\u8981\u5148\u9009\u51faLeader\uff0c\u518d\u786e\u5b9a\u65b0\u4e3b\u5e93\u3002 10.\u5728\u4e00\u4e2a\u75315\u4e2a\u54e8\u5175\u7ec4\u6210\u7684\u54e8\u5175\u96c6\u7fa4\u4e2d\uff0c\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684quorum\u503c\u914d\u7f6e\u4e3a4\uff0c\u90a3\u4e48\uff0c\u5f53\u6709\u5ced\u5175\u53d1\u73b0\u4e3b\u8282\u70b9\u6545\u969c\uff0c\u5f00\u59cb\u8fdb\u884cLeader\u9009\u4e3e\u65f6\uff0c\u8fd9\u4e2a\u5ced\u5175\u9700\u8981\u83b7\u5f97\u51e0\u5f20\u8d5e\u6210\u7968\uff0c \u624d\u80fd\u6210\u529f\u5730\u6210\u4e3aLeader? 2 3 4 5 \u54e8\u5175Leader\u9009\u4e3e\u9700\u8981\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6\uff1a \u4e00\u662f\u8981\u62ff\u5230\u534a\u6570\u4ee5\u4e0a\u7684\u8d5e\u6210\u7968\uff1b\u4e8c\u662f\uff0c\u62ff\u5230\u7684\u7968\u6570\u540c\u65f6\u8fd8\u9700\u8981\u5927\u4e8e\u7b49\u4e8e\u54e8\u5175\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684quorum\u503c\uff0c\u672c\u9898\u4e2d\u7684quorum\u503c\u8bbe\u4e3a4\uff0c\u6240\u4ee5 \u81f3\u5c11\u8981\u83b7\u5f974\u5f20\u8d5e\u6210\u7968 \u3002 11.\u5728\u4f7f\u7528Redis Cluster\u65f6\uff0c \u5982\u679c\u5ba2\u6237\u7aef\u53d1\u9001\u64cd\u4f5c\u8bf7\u6c42\u540e \uff0c \u6536\u5230\u4e86MOVED\u547d\u4ee4\uff0c\u6b64\u65f6\uff0cRedis Cluster\u53d1\u751f\u4e86\u4ee5\u4e0b \u54ea\u79cd\u60c5\u51b5\uff1f \u8bf7\u6c42\u7684\u6570\u636e\u5728Cluster\u4e2d\u5df2\u7ecf\u88ab\u5220\u9664 \u8bf7\u6c42\u6570\u636e\u6240\u5728\u7684\u54c8\u5e0c\u69fd\u6b63\u5728\u5f80\u5176\u4ed6\u5b9e\u4f8b\u8fc1\u79fb \u8bf7\u6c42\u6570\u636e\u6240\u5728\u7684\u54c8\u5e0c\u69fd\u5df2\u7ecf\u8fc1\u79fb\u5230\u4e86\u5176\u4ed6\u5b9e\u4f8b \u8bf7\u6c42\u7684\u6570\u636e\u6b63\u5728\u6301\u4e45\u5316\u4fdd\u5b58 A\u9009\u9879\uff0c\u6b64\u65f6\u8fd4\u56denil\u503c B\u9009\u9879\uff0c\u6b64\u65f6\u8fd4\u56deASK\u62a5\u9519\u4fe1\u606f D\u9009\u9879\uff0c\u4e0d\u4f1a\u62a5\u9519\uff0c\u53ef\u4ee5\u6b63\u5e38\u8fd4\u56de\u7ed3\u679c 12.\u5728Redis\u7684\u8bf8\u591a\u6570\u636e\u7c7b\u578b\u4e2d\uff0c\u4ee5\u4e0b\u54ea\u79cd\u6570\u636e\u7c7b\u578b\u5141\u8bb8\u63d2\u5165 \u91cd\u590d\u7684\u5143\u7d20\uff1f HyperLogLog List Set Sorted Set \u9009\u9879A\uff0c\u4f1a\u5bf9\u5143\u7d20\u53bb\u91cd \u9009\u9879B\uff0c\u6b63\u786e\uff0c\u5141\u8bb8\u5199\u5165\u91cd\u590d\u5143\u7d20 \u9009\u9879C\uff0c\u4f1a\u5bf9\u5143\u7d20\u53bb\u91cd \u9009\u9879D\uff0c\u4f1a\u5bf9\u5143\u7d20\u53bb\u91cd HyperLogLog \u662f\u4e00\u79cd\u7528\u4e8e\u7edf\u8ba1\u57fa\u6570\u7684\u6570\u636e\u96c6\u5408\u7c7b\u578b\uff0c\u5b83\u7684\u6700\u5927\u4f18\u52bf\u5c31\u5728\u4e8e\uff0c\u5f53\u96c6\u5408\u5143\u7d20\u6570\u91cf\u975e\u5e38\u591a\u65f6\uff0c\u5b83\u8ba1\u7b97\u57fa\u6570\u6240\u9700\u7684\u7a7a\u95f4\u603b\u662f\u56fa\u5b9a\u7684\uff0c\u800c\u4e14\u8fd8\u5f88\u5c0f\u3002 13.Redis\u6570\u636e\u5e93\u662f\u5c06\u4e0b\u5217\u54ea\u79cd\u6570\u636e\u7ed3\u6784\u4f5c\u4e3a \u5168\u5c40\u6570\u636e\u7ed3\u6784 \u6765\u4fdd\u5b58\u6bcf\u4e00\u5bf9\u952e\u503c\u5bf9\uff1f \u6570\u7ec4 \u54c8\u5e0c\u8868 \u8df3\u8868 \u53cc\u5411\u94fe\u8868 \u9898\u76ee\u95ee\u7684\u662fRedis\u6570\u636e\u5e93\u7684\u5168\u5c40\u6570\u636e\u7ed3\u6784\uff0c\u6240\u4ee5\u9009B\u3002\u5176\u4ed6\u9009\u9879\u662fRedis\u67d0\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784 14.\u5728Redis\u7684\u4e3b\u4ece\u5e93\u96c6\u7fa4\u4e2d\uff0c\u5982\u679c\u4e3b\u5e93\u5b95\u673a\u4e86\uff0c\u4ee5\u4e0b\u54ea\u4e2a \u673a\u5236\u53ef\u4ee5\u8ba9Redis\u5b9e\u73b0\u81ea\u52a8\u7684\u4e3b\u4ece\u5e93\u5207\u6362 \uff1f AOF\u91cd\u5199\u673a\u5236 RDB\u673a\u5236 \u5207\u7247\u673a\u5236 \u54e8\u5175\u673a\u5236 A\u9009\u9879\uff0c AOF\u91cd\u5199\u7528\u6765\u7cbe\u7b80\u8fc7\u5927\u7684AOF\u6587\u4ef6\uff0c\u52a0\u901fRedis\u5b9e\u4f8b\u6062\u590d\u3002 B\u9009\u9879\uff0c RDB\u673a\u5236\u7528\u6765\u751f\u6210\u5feb\u7167\uff0c\u7528\u4e8e\u5b9e\u4f8b\u6062\u590d\u6216\u662f\u4e3b\u4ece\u5e93\u590d\u5236\u3002 C\u9009\u9879\uff0c \u5207\u7247\u673a\u5236\u662f\u628a\u6570\u636e\u5206\u6563\u5230\u591a\u4e2a\u5b9e\u4f8b\u4fdd\u5b58\uff0c\u7528\u4e8e\u4fdd\u5b58\u5927\u91cf\u6570\u636e\u3002 15.\u4ee5\u4e0b\u54ea\u4e2a\u529f\u80fd\u662f\u7531Redis\u4e3b\u7ebf\u7a0b\u5b8c\u6210\u7684\uff1f \u952e\u503c\u5bf9\u8bfb\u5199 UNLINK\u64cd\u4f5c \u751f\u6210RDB\u5feb\u7167 AOF\u91cd\u5199 \u5f02\u6b65\u7684\u5b50\u7ebf\u7a0b\u673a\u5236 \u952e\u503c\u5bf9\u5220\u9664 \u5f53\u4f60\u7684\u96c6\u5408\u7c7b\u578b\u4e2d\u6709\u5927\u91cf\u5143\u7d20\uff08\u4f8b\u5982\u6709\u767e\u4e07\u7ea7\u522b\u6216\u5343\u4e07\u7ea7\u522b\u5143\u7d20\uff09\u9700\u8981\u5220\u9664\u65f6\uff0c\u6211\u5efa\u8bae\u4f60\u4f7f\u7528 UNLINK \u547d\u4ee4 B\u9009\u9879\uff0c UNLINK\u64cd\u4f5c\u662fRedis 4.0\u540e\u63d0\u4f9b\u7684\u540e\u53f0\u5f02\u6b65\u5220\u9664\u64cd\u4f5c\uff0c\u7531\u540e\u53f0\u5b50\u7ebf\u7a0b\u5b8c\u6210\u3002 C\u9009\u9879\uff0c RDB\u751f\u6210\u662f\u4e3b\u7ebf\u7a0b\u901a\u8fc7fork\u521b\u5efa\u4e86\u5b50\u8fdb\u7a0b\u6765\u5b8c\u6210\u7684\u3002 D\u9009\u9879\uff0c AOF\u91cd\u5199\u4e5f\u662f\u7531\u4e3b\u7ebf\u7a0b\u901a\u8fc7fork\u521b\u5efa\u4e86\u5b50\u8fdb\u7a0b\u6765\u5b8c\u6210\u7684\u3002 16.\u4ee5\u4e0b\u54ea\u4e9b\u60c5\u51b5\u4f1a\u5f15\u8d77Redis\u7684\u4e3b\u7ebf\u7a0b\u963b\u585e\uff1f Redis 3.0\u4e2d\uff0c\u5220\u9664\u4e00\u4e2a100\u4e07\u5143\u7d20\u7684Set\u96c6 AOF\u5199\u56de\u7b56\u7565\u914d\u7f6e\u4e3aeverysec\uff0c\u540c\u65f6 no-appendfsync-on-rewrite \u8bbe\u7f6e\u4e3ano 200\u4e07\u4e2a\u952e\u503c\u5bf9\u540c\u65f6\u8fc7\u671f \u4e00\u4e2a\u670d\u52a1\u8bfb\u4e3a\u4e3b\u8d1f\u8f7d\u7684Redis\u5b9e\u4f8b\uff0c\u5df2\u4fdd\u5b58\u7684\u6570\u636e\u91cf\u4e3a1GB\uff0c\u6b63\u5728\u521b\u5efaRDB\u5feb\u7167 \u9009\u9879A\uff0c \u4f1a\u5f15\u8d77\u963b\u585e\uff0cRedis 3.0\u65f6\u8fd8\u6ca1\u6709\u5f02\u6b65\u5220\u9664\u673a\u5236 \u9009\u9879B, AOF\u91cd\u5199\u548cAOF\u5199\u56de\u4f1a\u7ade\u4e89\u78c1\u76d8IO\u8d44\u6e90\uff0c\u5bfc\u81f4AOF\u5199\u56de\u88ab\u963b\u585e\uff0c\u8fdb\u800c\u5bfc\u81f4\u4e3b\u7ebf\u7a0b\u4e5f\u88ab\u963b\u585e \u9009\u9879C\uff0c \u5927\u91cf\u952e\u503c\u5bf9\u540c\u65f6\u8fc7\u671f\u4f1a\u5f15\u53d1\u4e3b\u7ebf\u7a0b\u963b\u585e \u9009\u9879D, RDB\u7531\u5b50\u8fdb\u7a0b\u751f\u6210\uff0c\u800c\u4e14\u5b9e\u4f8b\u670d\u52a1\u7684\u662f\u8bfb\u4e3a\u4e3b\u7684\u8d1f\u8f7d\uff0c\u6ca1\u6709\u5185\u5b58\u7684COW\u538b\u529b\uff0c\u4e0d\u4f1a\u963b\u585e \u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a yes \u65f6\uff0c\u8868\u793a\u5728 AOF \u91cd\u5199\u65f6\uff0c\u4e0d\u8fdb\u884c fsync \u64cd\u4f5c\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cRedis \u5b9e\u4f8b\u628a\u5199\u547d\u4ee4\u5199\u5230\u5185\u5b58\u540e\uff0c\u4e0d\u8c03\u7528\u540e\u53f0\u7ebf\u7a0b\u8fdb\u884c fsync \u64cd\u4f5c\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de\u4e86\u3002\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a no\uff08\u4e5f\u662f\u9ed8\u8ba4\u914d\u7f6e\uff09\uff0c\u5728 AOF \u91cd\u5199\u65f6\uff0cRedis \u5b9e\u4f8b\u4ecd\u7136\u4f1a\u8c03\u7528\u540e\u53f0\u7ebf\u7a0b\u8fdb\u884c fsync \u64cd\u4f5c\uff0c\u8fd9\u5c31\u4f1a\u7ed9\u5b9e\u4f8b\u5e26\u6765\u963b\u585e\u3002 17.RDB\u548cAOF\u662fRedis\u4f7f\u7528\u7684\u4e24\u79cd\u6301\u4e45\u5316\u673a\u5236\uff0c\u5173\u4e8e\u8fd9\u4e24\u79cd\u673a\u5236\uff0c\u4e0b\u9762\u7684\u54ea\u4e9b\u63cf\u8ff0\u662f\u6b63\u786e\u7684\uff1f \u4f7f\u7528RDB\u8fdb\u884c\u5b9e\u4f8b\u6062\u590d\u7684\u901f\u5ea6\uff0c\u8981\u6bd4\u4f7f\u7528AOF \u8fdb\u884c\u6062\u590d\u7684\u901f\u5ea6\u5feb\u8ba4 RDB\u7684\u751f\u6210\u548cAOF\u7684\u65e5\u5fd7\u8bb0\u5f55\u90fd\u662f\u901a\u8fc7\u5b50\u8fdb\u7a0b\u6765\u5b8c\u6210\u7684 AOF\u6587\u4ef6\u8bb0\u5f55\u7684\u64cd\u4f5c\u65e5\u5fd7\u8fc7\u591a\u65f6\uff0c\u4e3a\u4e86\u907f\u514d\u6587\u4ef6 \u8fc7\u5927\uff0c\u9700\u8981\u624b\u52a8\u5220\u9664\u5931\u6548\u7684\u64cd\u4f5c\u65e5\u5fd7 Redis 4.0\u7248\u672c\u4e2d\u53ef\u4ee5\u4f7f\u7528RDB\u505a\u5feb\u7167\uff0c\u540c\u65f6\u4f7f \u7528AOF\u8bb0\u5f55\u4e24\u6b21\u5feb\u7167\u95f4\u7684\u64cd\u4f5c\u65e5\u5fd7 \u9009\u9879B, AOF\u65e5\u5fd7\u8bb0\u5f55\u662f\u7531\u4e3b\u7ebf\u7a0b\u5b8c\u6210\u7684 \u9009\u9879C, AOF\u91cd\u5199\u673a\u5236\u53ef\u4ee5\u81ea\u52a8\u6e05\u7406AOF\u6587\u4ef6\uff0c\u4e0d\u7528\u624b\u52a8\u6e05\u7406 18.\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528Hash\u548cSorted Set\u7ec4\u5408\u6765\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u4ee5\u4e0b\u54ea\u4e9b\u529f\u80fd\u53ef\u4ee5\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u76f4\u63a5\u5728Redis\u5b9e\u4f8b\u4e0a\u5b8c\u6210\uff1f \u8ba1\u7b97\u67d0\u4e2a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6570\u636e\u6700\u5927\u503c \u67e5\u8be2\u67d0\u4e2a\u65f6\u523b\u7684\u6570\u636e \u67e5\u8be2\u67d0\u4e2a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6240\u6709\u6570\u636e \u67e5\u8be2\u6700\u65b0\u65f6\u523b\u7684\u6570\u636e \u65e0\u6cd5\u76f4\u63a5\u5728Redis\u5b9e\u4f8b\u4e0a\u5b8c\u6210\uff0c\u9700\u8981\u628a\u6570\u636e\u8bfb\u53d6\u5230\u5ba2\u6237\u7aef\uff0c\u7136\u540e\u518d\u8fdb\u884c\u8ba1\u7b97 19.Redis\u7684Hash\u6570\u636e\u7c7b\u578b\uff0c\u662f\u91c7\u7528\u4ee5\u4e0b\u54ea\u4e24\u79cd\u7ed3\u6784\u4f5c\u4e3a\u5b83\u7684\u5e95\u5c42\u5b9e\u73b0\u7684\uff1f \u6574\u6570\u6570\u7ec4 \u53cc\u5411\u94fe\u8868 \u54c8\u5e0c\u8868 \u538b\u7f29\u5217\u8868 A\u9009\u9879\uff0c\u662fSet\u7c7b\u578b\u7684\u5e95\u5c42\u7ed3\u6784 B\u9009\u9879\uff0c\u662fList\u7c7b\u578b\u7684\u5e95\u5c42\u7ed3\u6784 CD\u6b63\u786e 20.\u5173\u4e8eRedis Cluster\uff0c\u4e0b\u9762\u54ea\u4e2a\u63cf\u8ff0\u662f\u6b63\u786e\u7684\uff1f Redis Cluster\u4e00\u5171\u670916384\u4e2a\u54c8\u5e0c\u69fd \u4f7f\u7528Redis Cluster\u65f6\uff0c\u5ba2\u6237\u7aef\u4e0d\u7528\u8bb0\u5f55\u54c8\u5e0c\u69fd\u7684\u4efb\u4f55\u4fe1\u606f\uff0c\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u54c8\u5e0c\u8ba1\u7b97\uff0c\u786e\u5b9a\u952e\u503c\u5bf9\u5728\u54ea\u4e2a\u5b9e\u4f8b Redis Cluster\u5c5e\u4e8e\u53ef\u6269\u5c55\u96c6\u7fa4\uff0c\u4e3b\u8981\u7528\u9014\u662f\u8ba9Redis\u6570\u636e\u5e93\u80fd\u591f\u4fdd\u5b58\u66f4\u591a\u6570\u636e\u8ba4 Redis Cluster\u4e2d\u7684\u5b9e\u4f8b\u53ea\u80fd\u901a\u8fc7\u6301\u4e45\u5316\u673a\u5236\u8fdb\u884c\u53ef\u9760\u6027\u4fdd\u8bc1 \u9009\u9879B\uff0c \u5ba2\u6237\u7aef\u9700\u8981\u7f13\u5b58\u54c8\u5e0c\u69fd\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u65e0\u6cd5\u76f4\u63a5\u901a\u8fc7\u54c8\u5e0c\u8ba1\u7b97\u5c31\u77e5\u9053\u6570\u636e\u5728\u54ea\u4e2a\u5b9e\u4f8b\uff0c\u53ea\u80fd\u77e5\u9053\u5728\u54ea\u4e2a\u54c8\u5e0c\u69fd D\u9009\u9879\uff0cRedis Cluster\u7684\u5b9e\u4f8b\u4e5f\u53ef\u4ee5\u914d\u7f6e\u4e3b\u4ece\u8282\u70b9\uff0c\u8fdb\u884c\u53ef\u9760\u6027\u4fdd\u8bc1","title":"1\u3001\u671f\u4e2d\u9009\u62e9\u9898"},{"location":"chap10/1redis_test/#2","text":"","title":"2\u3001\u4e3b\u89c2\u9898"},{"location":"chap10/1redis_test/#2-1","text":"Redis \u5728\u63a5\u6536\u591a\u4e2a\u7f51\u7edc\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\u64cd\u4f5c\u65f6\uff0c\u5982\u679c\u6709\u4e00\u4e2a\u5ba2\u6237\u7aef\u548c Redis \u7684\u7f51\u7edc\u8fde\u63a5\u65ad\u5f00\u4e86\uff0cRedis \u4f1a\u4e00\u76f4\u7b49\u5f85\u8be5\u5ba2\u6237\u7aef\u6062\u590d\u8fde\u63a5\u5417\uff1f\u4e3a\u4ec0\u4e48\uff1f \u7b54\u6848\uff1a Redis \u4e0d\u4f1a\u7b49\u5f85\u5ba2\u6237\u7aef\u6062\u590d\u8fde\u63a5\u3002\u539f\u56e0\u662f\uff0c Redis \u7684\u7f51\u7edc\u8fde\u63a5\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u884c\u5904\u7406\u7684\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u8d1f\u8d23\u76d1\u542c\u7f51\u7edc\u8fde\u63a5\u5957\u63a5\u5b57\u4e0a\u7684\u8fde\u63a5\u8bf7\u6c42\u6216\u6570\u636e\u8bf7\u6c42\uff0c\u800c Redis \u91c7\u7528\u4e86 IO \u591a\u8def\u590d\u7528\u673a\u5236 epoll\uff0c\u4e0d\u4f1a\u963b\u585e\u5728\u67d0\u4e00\u4e2a\u7279\u5b9a\u7684\u5957\u63a5\u5b57\u4e0a \u3002 epoll \u673a\u5236\u76d1\u6d4b\u5230\u5957\u63a5\u5b57\u4e0a\u6709\u8bf7\u6c42\u5230\u8fbe\u65f6\uff0c\u5c31\u4f1a\u89e6\u53d1\u76f8\u5e94\u7684\u4e8b\u4ef6\uff0c\u5e76\u628a\u4e8b\u4ef6\u653e\u5230\u4e00\u4e2a\u961f\u5217\u4e2d\uff0cRedis \u5c31\u4f1a\u5bf9\u8fd9\u4e2a\u4e8b\u4ef6\u961f\u5217\u4e2d\u7684\u4e8b\u4ef6\u8fdb\u884c\u5904\u7406 \u3002\u8fd9\u6837\u4e00\u6765\uff0cRedis \u53ea\u7528\u67e5\u770b\u548c\u5904\u7406\u4e8b\u4ef6\u961f\u5217\uff0c\u5c31\u53ef\u4ee5\u4e86\u3002 \u5f53\u5ba2\u6237\u7aef\u7f51\u7edc\u8fde\u63a5\u65ad\u5f00\u6216\u6062\u590d\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u8fdb\u884c\u5904\u7406\uff0c\u5e76\u4e14\u5728\u5ba2\u6237\u7aef\u80fd\u518d\u6b21\u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u628a\u63a5\u6536\u5230\u7684\u8bf7\u6c42\u4ee5\u4e8b\u4ef6\u5f62\u5f0f\u901a\u77e5 Redis\u3002","title":"2-1 \u7b2c\u4e00\u9898"},{"location":"chap10/1redis_test/#2-2","text":"Redis \u7684\u4e3b\u4ece\u96c6\u7fa4\u53ef\u4ee5\u63d0\u5347\u6570\u636e\u53ef\u9760\u6027\uff0c\u4e3b\u8282\u70b9\u5728\u548c\u4ece\u8282\u70b9\u8fdb\u884c\u6570\u636e\u540c\u6b65\u65f6\uff0c\u4f1a\u4f7f\u7528\u4e24\u4e2a\u7f13\u51b2\u533a\uff1a\u590d \u5236\u7f13\u51b2\u533a\u548c\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u3002\u8fd9\u4e24\u4e2a\u7f13\u51b2\u533a\u7684\u4f5c\u7528\u5404\u662f\u4ec0\u4e48\uff1f\u4f1a\u5bf9 Redis \u4e3b\u4ece\u540c\u6b65\u4ea7\u751f\u4ec0\u4e48\u5f71\u54cd\u5417\uff1f Redis \u7684\u4e3b\u4ece\u96c6\u7fa4\u53ef\u4ee5\u63d0\u5347\u6570\u636e\u53ef\u9760\u6027\uff0c\u4e3b\u8282\u70b9\u5728\u548c\u4ece\u8282\u70b9\u8fdb\u884c\u6570\u636e\u540c\u6b65\u65f6\uff0c\u4f1a\u4f7f\u7528\u4e24\u4e2a\u7f13\u51b2\u533a\uff1a\u590d\u5236\u7f13\u51b2\u533a\u548c\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u3002\u8fd9\u4e24\u4e2a\u7f13\u51b2\u533a\u7684\u4f5c\u7528\u5404\u662f\u4ec0\u4e48\uff1f\u4f1a\u5bf9 Redis \u4e3b\u4ece\u540c\u6b65\u4ea7\u751f\u4ec0\u4e48\u5f71\u54cd\u5417\uff1f \u9996\u5148\u6765\u8bf4\u4e00\u4e0b\u590d\u5236\u7f13\u51b2\u533a\u3002 \u4f5c\u7528\uff1a \u4e3b\u8282\u70b9\u5f00\u59cb\u548c\u4e00\u4e2a\u4ece\u8282\u70b9\u8fdb\u884c\u5168\u91cf\u540c\u6b65\u65f6\uff0c\u4f1a\u4e3a\u4ece\u8282\u70b9\u521b\u5efa\u4e00\u4e2a\u8f93\u51fa\u7f13\u51b2\u533a\uff0c\u8fd9\u4e2a\u7f13\u51b2\u533a\u5c31\u662f\u590d\u5236\u7f13\u51b2\u533a\u3002 \u5f53\u4e3b\u8282\u70b9\u5411\u4ece\u8282\u70b9\u53d1\u9001 RDB \u6587\u4ef6\u65f6\uff0c\u5982\u679c \u53c8\u63a5\u6536\u5230\u4e86\u5199\u547d\u4ee4\u64cd\u4f5c\uff0c\u5c31\u4f1a\u628a\u5b83\u4eec\u6682\u5b58\u5728\u590d\u5236\u7f13\u51b2\u533a\u4e2d \u3002\u7b49 RDB \u6587\u4ef6\u4f20\u8f93\u5b8c\u6210\uff0c\u5e76\u4e14\u5728\u4ece\u8282\u70b9\u52a0\u8f7d\u5b8c\u6210\u540e\uff0c\u4e3b\u8282\u70b9\u518d\u628a\u590d\u5236\u7f13\u51b2\u533a\u4e2d\u7684\u5199\u547d\u4ee4\u53d1\u7ed9\u4ece\u8282\u70b9\uff0c\u8fdb\u884c\u540c\u6b65\u3002 \u5bf9\u4e3b\u4ece\u540c\u6b65\u7684\u5f71\u54cd \uff1a \u5982\u679c\u4e3b\u5e93\u4f20\u8f93 RDB \u6587\u4ef6\u4ee5\u53ca\u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6\u8017\u65f6\u957f\uff0c\u540c\u65f6\u4e3b\u5e93\u63a5\u6536\u7684\u5199\u547d\u4ee4\u64cd\u4f5c\u8f83\u591a\uff0c\u5c31\u4f1a\u5bfc\u81f4\u590d\u5236\u7f13\u51b2\u533a\u88ab\u5199\u6ee1\u800c\u6ea2\u51fa\u3002 \u4e00\u65e6\u6ea2\u51fa\uff0c\u4e3b\u5e93\u5c31\u4f1a\u5173\u95ed\u548c\u4ece\u5e93\u7684\u7f51\u7edc\u8fde\u63a5\uff0c\u91cd\u65b0\u5f00\u59cb\u5168\u91cf\u540c\u6b65\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574 client-output-buffer-limit slave \u8fd9\u4e2a\u914d\u7f6e\u9879\uff0c\u6765\u589e\u52a0\u590d\u5236\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff0c\u4ee5\u514d\u590d\u5236\u7f13\u51b2\u533a\u6ea2\u51fa \u3002 \u518d\u6765\u770b\u770b\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u3002 \u4f5c\u7528 \uff1a \u4e3b\u8282\u70b9\u548c\u4ece\u8282\u70b9\u8fdb\u884c\u5e38\u89c4\u540c\u6b65\u65f6\uff0c\u4f1a\u628a\u5199\u547d\u4ee4\u4e5f\u6682\u5b58\u5728\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u4e2d\u3002\u5982\u679c\u4ece\u8282\u70b9\u548c\u4e3b\u8282\u70b9\u95f4\u53d1\u751f\u4e86\u7f51\u7edc\u65ad\u8fde\uff0c\u7b49\u4ece\u8282\u70b9\u518d\u6b21\u8fde\u63a5\u540e\uff0c\u53ef\u4ee5\u4ece\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u4e2d\u540c\u6b65\u5c1a\u672a\u590d\u5236\u7684\u547d\u4ee4\u64cd\u4f5c\u3002 \u5bf9\u4e3b\u4ece\u540c\u6b65\u7684\u5f71\u54cd \uff1a\u5982\u679c\u4ece\u8282\u70b9\u548c\u4e3b\u8282\u70b9\u95f4\u7684\u7f51\u7edc\u65ad\u8fde\u65f6\u95f4\u8fc7\u957f\uff0c\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u53ef\u80fd\u88ab\u65b0\u5199\u5165\u7684\u547d\u4ee4\u8986\u76d6\u3002\u6b64\u65f6\uff0c \u4ece\u8282\u70b9\u5c31\u6ca1\u6709\u529e\u6cd5\u548c\u4e3b\u8282\u70b9\u8fdb\u884c\u589e\u91cf\u590d\u5236\u4e86\uff0c\u800c\u662f\u53ea\u80fd\u8fdb\u884c\u5168\u91cf\u590d\u5236\u3002\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u5e94\u5bf9\u7684\u65b9\u6cd5\u662f\u8c03\u5927\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u7684\u5927\u5c0f \uff08\u53ef\u4ee5\u53c2\u8003 \u7b2c\u516d\u8282 \u6570\u636e\u540c\u6b65\uff1a\u4e3b\u4ece\u5e93\u6570\u636e\u4e00\u81f4 repl_backlog_size \u7684\u8bbe\u7f6e\uff09\u3002","title":"2-2 \u7b2c\u4e8c\u9898"},{"location":"chap10/1redis_test/#2-3","text":"\u5047\u8bbe\u5728\u4e1a\u52a1\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u6709 20GB \u7684\u77ed\u89c6\u9891\u5c5e\u6027\u4fe1\u606f\uff08\u5305\u62ec\u77ed\u89c6\u9891 ID\u3001\u77ed\u89c6\u9891\u57fa\u672c\u4fe1\u606f\uff0c\u4f8b\u5982\u77ed\u89c6\u9891\u4f5c\u8005\u3001\u521b\u5efa\u65f6\u95f4\u7b49\uff09\u8981\u6301\u4e45\u5316\u4fdd\u5b58\uff0c\u5e76\u4e14\u7ebf\u4e0a\u8d1f\u8f7d\u4ee5\u8bfb\u4e3a\u4e3b\uff0c\u9700\u8981\u80fd\u5feb\u901f\u67e5\u8be2\u5230\u8fd9\u4e9b\u77ed\u89c6\u9891\u4fe1\u606f\u3002 \u73b0\u5728\uff0c\u9488\u5bf9\u8fd9\u4e2a\u9700\u6c42\uff0c\u6211\u4eec\u60f3\u4f7f\u7528 Redis \u6765\u89e3\u51b3\uff0c\u8bf7\u4f60\u6765\u8bbe\u8ba1\u4e00\u4e2a\u89e3\u51b3\u65b9\u6848\u3002\u6211\u6765\u63d0\u51e0\u4e2a\u95ee\u9898\uff0c\u4f60\u53ef\u4ee5\u601d\u8003\u4e0b\u3002 \u9996\u5148\uff0c\u4f60\u4f1a\u7528 Redis \u7684\u4ec0\u4e48\u6570\u636e\u7c7b\u578b\u6765\u4fdd\u5b58\u6570\u636e\uff1f\u5982\u679c\u6211\u4eec\u53ea\u7528\u5355\u4e2a\u5b9e\u4f8b\u6765\u8fd0\u884c\u7684\u8bdd\uff0c\u4f60\u4f1a\u91c7\u7528\u4ec0\u4e48\u6837\u7684\u6301\u4e45\u5316\u65b9\u6848\u6765\u4fdd\u8bc1\u6570\u636e\u7684\u53ef\u9760\u6027\uff1f \u53e6\u5916\uff0c\u5982\u679c\u4e0d\u4f7f\u7528\u5355\u5b9e\u4f8b\u8fd0\u884c\uff0c\u6211\u4eec\u6709\u4e24\u4e2a\u5907\u9009\u65b9\u6848\uff1a\u4e00\u4e2a\u662f\u7528\u4e24\u53f0 32GB \u5185\u5b58\u7684\u4e91\u4e3b\u673a\u6765\u8fd0\u884c\u4e3b\u4ece\u4e24\u4e2a Redis \u5b9e\u4f8b\uff1b\u53e6\u4e00\u4e2a\u662f\u7528 10 \u53f0 8GB \u7684\u4e91\u4e3b\u673a\u6765\u8fd0\u884c Redis Cluster\uff0c\u6bcf\u4e24\u53f0\u4e91\u4e3b\u673a\u5206\u522b\u8fd0\u884c\u4e00\u4e2a Redis \u5b9e\u4f8b\u4e3b\u5e93\u548c\u4ece\u5e93\uff0c\u5206\u522b\u4fdd\u5b58 4GB \u6570\u636e\uff0c\u4f60\u4f1a\u7528\u54ea\u79cd\u65b9\u6848\u5462\uff1f\u8bf7\u804a\u4e00\u804a\u4f60\u7684\u60f3\u6cd5\u3002 \u7b54\u6848\uff1a Redis \u7684 Hash \u7c7b\u578b\u5c5e\u4e8e\u5178\u578b\u7684\u96c6\u5408\u7c7b\u578b\uff0c\u53ef\u4ee5\u4fdd\u5b58 key-value \u5f62\u5f0f\u7684\u6570\u636e\u3002\u800c\u4e14\uff0c\u5f53 Hash \u7c7b\u578b\u4e2d\u4fdd\u5b58\u8f83\u591a\u6570\u636e\u65f6\uff0c\u5b83\u7684\u5e95\u5c42\u662f\u7531\u54c8\u5e0c\u8868\u5b9e\u73b0\u7684\u3002 \u54c8\u5e0c\u8868\u7684\u5b58\u53d6\u590d\u6742\u5ea6\u662f O(1)\uff0c\u6240\u4ee5\u53ef\u4ee5\u5b9e\u73b0\u5feb\u901f\u8bbf\u95ee\u3002 \u5728\u8fd9\u9053\u9898\u4e2d\uff0c\u77ed\u89c6\u9891\u5c5e\u6027\u4fe1\u606f\u5c5e\u4e8e\u5178\u578b key-value \u5f62\u5f0f\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Hash \u7c7b\u578b\u4fdd\u5b58\u77ed\u89c6\u9891\u4fe1\u606f\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5c31\u662f\u5c06\u4e00\u4e2a\u77ed\u89c6\u9891 ID \u4f5c\u4e3a Hash \u96c6\u5408\u7684 key\uff0c\u5c06\u77ed\u89c6\u9891\u7684\u5176\u4ed6\u5c5e\u6027\u4fe1\u606f\u4f5c\u4e3a Hash \u96c6\u5408\u5185\u90e8\u7684\u952e\u503c\u5bf9\uff0c\u4f8b\u5982\u201c\u4f5c\u8005\u201d:\u201c\u5b9e\u9645\u59d3\u540d\u201d\uff0c\u201c\u521b\u5efa\u65f6\u95f4\u201d:\u201c\u5b9e\u9645\u65f6\u95f4\u201d\u3002\u8fd9\u6837\u65e2\u6ee1\u8db3\u4e86\u4fdd\u5b58\u6570\u636e\u7684\u9700\u6c42\uff0c\u4e5f\u53ef\u4ee5\u5229\u7528 Hash \u5feb\u901f\u67e5\u8be2\u7684\u7279\u70b9\uff0c\u5feb\u901f\u67e5\u5230\u76f8\u5e94\u7684\u4fe1\u606f\u3002 Redis \u7684 AOF \u65e5\u5fd7\u4f1a\u8bb0\u5f55\u5ba2\u6237\u7aef\u53d1\u9001\u7ed9\u5b9e\u4f8b\u7684\u6bcf\u4e00\u6b21\u5199\u64cd\u4f5c\u547d\u4ee4\uff0c\u5728 Redis \u5b9e\u4f8b\u6062\u590d\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u91cd\u65b0\u8fd0\u884c AOF \u6587\u4ef6\u4e2d\u7684\u547d\u4ee4\uff0c\u5b9e\u73b0\u6062\u590d\u6570\u636e\u7684\u76ee\u7684\u3002\u5728\u8fd9\u9053\u9898\u7684\u4e1a\u52a1\u573a\u666f\u4e2d\uff0c\u8d1f\u8f7d\u4ee5\u8bfb\u4e3a\u4e3b\uff0c\u56e0\u6b64\uff0c\u5199\u547d\u4ee4\u4e0d\u4f1a\u592a\u591a\uff0cAOF \u65e5\u5fd7\u6587\u4ef6\u7684\u4f53\u91cf\u4e0d\u4f1a\u592a\u5927\uff0c\u5373\u4f7f\u5b9e\u4f8b\u6545\u969c\u4e86\uff0c\u4e5f\u53ef\u4ee5\u5feb\u901f\u5b8c\u6210\u6062\u590d\u3002\u6240\u4ee5\uff0c\u5f53\u4f7f\u7528\u5355\u5b9e\u4f8b\u8fd0\u884c\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 AOF \u65e5\u5fd7\u6765\u505a\u6301\u4e45\u5316\u65b9\u6848\u3002 \u5173\u4e8e\u4f7f\u7528\u591a\u5b9e\u4f8b\u7684\u8fd0\u884c\u65b9\u6848\uff1a\u4e24\u79cd\u65b9\u6848\u5404\u6709\u4f18\u52bf\uff0c\u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\u3002 \u65b9\u6848\u4e00 \u4f18\u52bf\uff1a\u53ef\u4ee5\u8282\u7701\u4e91\u4e3b\u673a\u6570\u91cf\u548c\u6210\u672c\u3002\u867d\u7136\u4e3b\u4ece\u8282\u70b9\u8fdb\u884c\u7b2c\u4e00\u6b21\u5168\u91cf\u540c\u6b65\u65f6\uff0cRDB \u6587\u4ef6\u8f83\u5927\uff0c\u8017\u65f6\u4f1a\u957f\u4e9b\uff0c\u4f46\u662f\u56e0\u4e3a\u5199\u8bf7\u6c42\u5c11\uff0c \u6240\u4ee5\u590d\u5236\u7f13\u51b2\u533a\u7684\u538b\u529b\u4e0d\u5927 \u3002 \u4e0d\u8db3\uff1a\u5982\u679c\u7f51\u7edc\u73af\u5883\u4e0d\u597d\uff0c\u9700\u8981\u9891\u7e41\u5730\u8fdb\u884c\u5168\u91cf\u540c\u6b65\u7684\u8bdd\uff0c\u8fd9\u79cd\u65b9\u6848\u7684\u4f18\u52bf\u5c31\u5c0f\u4e86\uff0c\u6bcf\u6b21\u5168\u91cf\u540c\u6b65\u65f6\u7684 RDB \u751f\u6210\u548c\u4f20\u8f93\u538b\u529b\u90fd\u5f88\u5927\u3002 \u65b9\u6848\u4e8c \u4f18\u52bf\uff1a\u6bcf\u4e2a\u5b9e\u4f8b\u53ea\u7528\u4fdd\u5b58 4GB \u6570\u636e\uff0c\u548c\u4ece\u5e93\u540c\u6b65\u65f6\u7684\u538b\u529b\u8f83\u5c0f\u3002\u800c\u4e14\uff0c\u8fd9\u79cd\u65b9\u6848\u7684\u53ef\u6269\u5c55\u6027\u66f4\u597d\uff0c\u5982\u679c\u6709\u65b0\u589e\u6570\u636e\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u5e94\u5bf9\u3002 \u4e0d\u8db3\uff1a\u9700\u8981\u8f83\u591a\u7684\u4e91\u4e3b\u673a\uff0c\u8fd0\u7ef4\u548c\u8d44\u6e90\u6210\u672c\u8f83\u9ad8\u3002","title":"2-3 \u7b2c\u4e09\u9898"},{"location":"chap10/1redis_test/#3","text":"1.\u5728\u79d2\u6740\u573a\u666f\u4e0b\uff0c\u4f60\u53ef\u4ee5\u5728\u4e0b\u9762\u54ea\u4e2a\u73af\u8282\u5e94\u7528Redis? \u524d\u7aef\u9759\u6001\u9875\u9762\u7f13\u5b58 \u79d2\u6740\u5546\u54c1\u5e93\u5b58\u67e5\u8be2\u548c\u6263\u51cf \u62e6\u622a\u6076\u610f\u653b\u51fb\u7684\u8bf7\u6c42 \u6570\u636e\u5e93\u8ba2\u5355\u5f02\u5e38\u5904\u7406 2.\u5bf9\u4e8e\u5207\u7247\u96c6\u7fa4\u6765\u8bf4\uff0c\u6570\u636e\u503e\u659c\u662f\u9700\u8981\u5173\u6ce8\u7684\u95ee\u9898\uff0c\u4ee5\u4e0b\u54ea\u4e9b\u539f\u56e0\u4f1a\u5f15\u8d77\u6570\u636e\u503e\u659c\uff1f \u5b58\u5728bigkey RDB\u5feb\u7167\u7684\u751f\u6210 \u6570\u636e\u5206\u5e03\u4e0d\u5747\u8861 HashTag\u7684\u4f7f\u7528 RDB\u5feb\u7167\u548c\u6570\u636e\u503e\u659c\u6ca1\u6709\u5173\u7cfb bigkey \u5bfc\u81f4\u503e\u659c / Slot \u5206\u914d\u4e0d\u5747\u8861\u5bfc\u81f4\u503e\u659c / Hash Tag \u5bfc\u81f4\u503e\u659c \u6570\u636e\u5206\u5e03\u4f18\u5316\u5e94\u5bf9\u6570\u636e\u503e\u659c 3.\u5173\u4e8eRedis 6.0\u7684ACL\u63a7\u5236\u673a\u5236\u7684\u63cf\u8ff0\uff0c\u54ea\u4e9b\u662f\u4e0d\u6b63\u786e ACL\u652f\u6301\u4e0d\u540c\u7528\u6237\u7528\u4e0d\u540c\u5bc6\u7801\u767b\u5f55 ACL\u53ea\u652f\u6301\u6309\u4e00\u7c7b\u547d\u4ee4\u7684\u7c92\u5ea6\u8bbe\u7f6e\u8bbf\u95ee\u89c4\u5219 ACL\u53ef\u4ee5\u7981\u6b62\u5ba2\u6237\u7aef\u8c03\u7528\u6240\u6709\u547d\u4ee4\u64cd\u4f5c ACL\u4f7f\u7528\u77ed\u6a2a\u7ebf\u4e00\u548ckey\u524d\u7f00\u7684key \u6765\u8868\u793a\u63a7\u5236\u8bbf\u95ee \u9009\u9879B, ACL\u652f\u6301\u5bf9\u5355\u4e2a\u547d\u4ee4\u8bbe\u7f6e\u8bbf\u95ee\u63a7\u5236\u89c4\u5219 \u9009\u9879D,ACL\u4f7f\u7528\u6ce2\u6d6a\u7ebf\u8bbe\u7f6e\u88ab\u8bbf\u95ee\u63a7\u5236\u7684key \u4f7f\u7528\u6ce2\u6d6a\u53f7\u201c~\u201d\u548c key \u7684\u524d\u7f00\u6765\u8868\u793a\u63a7\u5236\u8bbf\u95ee\u7684 key\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u8bbe\u7f6e\u7528\u6237 normaluser \u53ea\u80fd\u5bf9\u4ee5\u201cuser:\u201d\u4e3a\u524d\u7f00\u7684 key \u8fdb\u884c\u547d\u4ee4\u64cd\u4f5c\uff1a ACL SETUSER normaluser ~user:* +@all 4.Redis 6.0\u5f00\u59cb\u652f\u6301\u591aIO\u7ebf\u7a0b\uff0c\u5173\u4e8e\u591aIO\u7ebf\u7a0b\u7684\u63cf\u8ff0\uff0c\u4ee5\u4e0b\u54ea\u4e2a\u8bf4\u6cd5\u662f\u6b63\u786e\u7684 \u591aIO\u7ebf\u7a0b\u53ef\u4ee5\u5e76\u884c\u6267\u884cGET\u3001SET\u7b49\u8bf7\u6c42\u64cd\u4f5c Redis 6.0\u4e2d\u9ed8\u8ba4\u542f\u7528\u4e86\u591aIO\u7ebf\u7a0b \u53ef\u4ee5\u4f7f\u7528io-threads\u914d\u7f6e\u9879\u8bbe\u7f6e\u591a\u7ebf\u7a0b\u7684\u4e2a\u6570 \u53ef\u4ee5\u4f7f\u7528io-threads-enable\u6765\u542f\u7528\u6216\u5173\u95ed\u591a\u7ebf\u7a0b\u673a\u5236 \u8bbe\u7f6e\u7ebf\u7a0b\u4e2a\u6570\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u7ebf\u7a0b\u4e2a\u6570\u8981\u5c0f\u4e8e Redis \u5b9e\u4f8b\u6240\u5728\u673a\u5668\u7684 CPU \u6838\u4e2a\u6570\uff0c\u4f8b\u5982\uff0c\u5bf9\u4e8e\u4e00\u4e2a 8 \u6838\u7684\u673a\u5668\u6765\u8bf4\uff0cRedis \u5b98\u65b9\u5efa\u8bae\u914d\u7f6e 6 \u4e2a IO \u7ebf\u7a0b\u3002 io-threads 6 A\u9009\u9879\uff0c \u591aIO\u7ebf\u7a0b\u53ea\u662f\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\u89e3\u6790 B\u9009\u9879\uff0c \u9ed8\u8ba4\u662f\u5173\u95ed\u7684 D\u9009\u9879\uff0c \u4f7f\u7528 io-threads-do-reads \u914d\u7f6e\u9879\u542f\u505c\u591aIO\u7ebf\u7a0b 5.\u5f53\u4f7f\u7528RESP 2\u534f\u8bae\u7684\u5ba2\u6237\u7aef\u60f3\u8981\u4f7f\u7528Redis 6.0\u4e2d\u63a8\u51fa\u7684\u5ba2\u6237\u7aef\u7f13\u5b58\u529f\u80fd\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u54ea\u79cd\u6a21\u5f0f\uff1f direct redirect broadcast \u666e\u901a\u6a21\u5f0f \u666e\u901a\u6a21\u5f0f\u548c\u5e7f\u64ad\u6a21\u5f0f\uff0c\u9700\u8981\u5ba2\u6237\u7aef\u4f7f\u7528 RESP 3 \u534f\u8bae\uff0cRESP 3 \u534f\u8bae\u662f 6.0 \u65b0\u542f\u7528\u7684\u901a\u4fe1\u534f\u8bae \u5bf9\u4e8e\u4f7f\u7528 RESP 2 \u534f\u8bae\u7684\u5ba2\u6237\u7aef\u6765\u8bf4\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u53e6\u4e00\u79cd\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f\u91cd\u5b9a\u5411\u6a21\u5f0f\uff08redirect\uff09\u3002 6.NVM\u662f\u8fd1\u5e74\u6765\u5b58\u50a8\u8bbe\u5907\u53d1\u5c55\u7684\u4e00\u4e2a\u5927\u53d8\u5316\uff0c\u4f1a\u5bf9Redis\u7b49\u7cfb\u7edf\u8f6f\u4ef6\u4ea7\u751f\u5de8\u5927\u5f71\u54cd\uff0c\u4ee5\u4e0b\u54ea\u4e2a\u7279\u6027\u4e0d\u662f\u975e\u6613\u5931\u5b58\u50a8\u5668\u4ef6\u5177\u5907\u7684\u7279\u6027\uff1f \u8bfb\u5ef6\u8fdf\u548cDRAM\u4e00\u6837 \u5199\u5ef6\u8fdf\u63a5\u8fd1DRAM \u53ef\u4ee5\u6301\u4e45\u5316\u4fdd\u5b58\u6570\u636e \u5bc6\u5ea6\u5927\uff0c\u5bb9\u91cf\u5927 \u9009\u9879A\uff0c\u6b63\u786e\uff0c NVM\u8bfb\u5ef6\u8fdf\u8981\u9ad8\u4e8eDRAM\uff0c\u9009\u9879\u7b54\u6848\u4e0d\u662fNVM\u7279\u6027 \u9009\u9879B\uff0c\u5c5e\u4e8eNVM\u7279\u6027 \u9009\u9879C\uff0c\u5c5e\u4e8eNVM\u7279\u6027 \u9009\u9879D\uff0c\u5c5e\u4e8eNVM\u7279\u6027 7.\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u5728\u4e3b\u4ece\u5e93\u95f4\u7684\u4e00\u81f4\u6027\uff0c \u6211\u4eec\u9700\u8981\u5c06\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u7edd\u5bf9\u65f6\u95f4 \uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u54ea\u4e9b\u547d\u4ee4\u6765\u8fdb\u884c\u8bbe\u7f6e\uff1f EXPIRE PEXIRE EXPIREAT PEXPIREAT EXPIRE \u548c PEXPIRE\uff1a\u5b83\u4eec\u7ed9\u6570\u636e\u8bbe\u7f6e\u7684\u662f\u4ece\u547d\u4ee4\u6267\u884c\u65f6\u5f00\u59cb\u8ba1\u7b97\u7684\u5b58\u6d3b\u65f6\u95f4\uff1b EXPIRE / PEXIRE \u8be5\u547d\u4ee4\u8bbe\u7f6e\u76f8\u5bf9\u8fc7\u671f\u65f6\u95f4 EXPIREAT \u548c PEXPIREAT\uff1a\u5b83\u4eec\u4f1a\u76f4\u63a5\u628a\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u5177\u4f53\u7684\u4e00\u4e2a\u65f6\u95f4\u70b9\u3002 \u4ec0\u4e48\u4f1a\u5bfc\u81f4\u8bfb\u53d6\u5230\u8fc7\u671f\u6570\u636e 8.\u4e0b\u9762\u8fd9\u4e9b\u5173\u4e8eRedis\u4e8b\u52a1\u673a\u5236\u7684\u63cf\u8ff0\uff0c\u54ea\u4e9b\u662f\u6b63\u786e\u7684\uff1f Redis\u4e8b\u52a1\u53ef\u4ee5\u4fdd\u8bc1\u539f\u5b50\u6027 Redis\u4e8b\u52a1\u53ef\u4ee5\u4fdd\u8bc1\u4e00\u81f4\u6027 Redis\u4e8b\u52a1\u4e0d\u80fd\u4fdd\u8bc1\u9694\u79bb\u6027 Redis\u4e8b\u52a1\u65e0\u6cd5\u4fdd\u8bc1\u6301\u4e45\u6027 \u9009\u9879A, Redis\u5728\u4e8b\u52a1\u4e2d\u6709\u547d\u4ee4\u8bed\u6cd5\u9519\u8bef\u65f6\uff0c\u65e0\u6cd5\u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u5176\u4ed6\u60c5\u51b5\u53ef\u4ee5\u4fdd\u8bc1 \u9009\u9879C, Redis\u4e8b\u52a1\u53ef\u4ee5\u4fdd\u8bc1\u9694\u79bb\u6027 9.\u5047\u8bbe\u4e00\u4e2a\u5ba2\u6237\u7aef\u7684ID\u53f7\u662f100\uff0c\u8be5\u5ba2\u6237\u7aef\u60f3\u4f7f\u7528\u540d\u4e3amylock\u7684key\u4f5c\u4e3a\u9501\u53d8\u91cf\uff0c\u5e76\u8bbe\u7f6e\u9501\u53d8\u91cf\u7684\u8fc7\u671f\u65f6\u95f4\u662f10s\uff0c\u8bf7\u95ee\u5e94\u8be5\u4f7f\u7528\u4ee5\u4e0b\u54ea\u4e2a\u547d\u4ee4\u6765\u8fdb\u884c\u52a0\u9501\u64cd\u4f5c\uff1f SET mylock 100 PX 10 SET mylock 100 PX 10000 SET mylock 100 NX EX 10 SET mylock 10 NX EX 100 \u5982\u679c\u4f7f\u7528\u4e86 NX \u9009\u9879\uff0cSET \u547d\u4ee4\u53ea\u6709\u5728\u952e\u503c\u5bf9\u4e0d\u5b58\u5728\u65f6\uff0c\u624d\u4f1a\u8fdb\u884c\u8bbe\u7f6e\uff0c\u5426\u5219\u4e0d\u505a\u8d4b\u503c\u64cd\u4f5c\u3002\u6b64\u5916\uff0cSET \u547d\u4ee4\u5728\u6267\u884c\u65f6\u8fd8\u53ef\u4ee5\u5e26\u4e0a EX \u6216 PX \u9009\u9879\uff0c\u7528\u6765\u8bbe\u7f6e\u952e\u503c\u5bf9\u7684\u8fc7\u671f\u65f6\u95f4\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0c\u53ea\u6709 key \u4e0d\u5b58\u5728\u65f6\uff0cSET \u624d\u4f1a\u521b\u5efa key\uff0c\u5e76\u5bf9 key \u8fdb\u884c\u8d4b\u503c\u3002\u53e6\u5916\uff0ckey \u7684\u5b58\u6d3b\u65f6\u95f4\u7531 seconds \u6216\u8005 milliseconds \u9009\u9879\u503c\u6765\u51b3\u5b9a\u3002 SET key value [EX seconds | PX milliseconds] [NX] \u6709\u4e86 SET \u547d\u4ee4\u7684 NX \u548c EX/PX \u9009\u9879\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6765\u5b9e\u73b0\u52a0\u9501\u64cd\u4f5c\u4e86\u3002 SET lock_key unique_value NX PX 10000 \u9009\u9879A, PX\u7684\u5355\u4f4d\u662f\u6beb\u79d2\uff0c\u8bbe\u7f6e\u7684\u8fc7\u671f\u65f6\u95f4\u4e0d\u5bf9 \u9009\u9879B\uff0c \u6ca1\u6709\u4f7f\u7528NX\u9009\u9879\uff0c\u5982\u679cmylock\u7684key\u672c\u8eab\u4e0d\u5b58\u5728\uff0c\u90a3\u4e48\u8be5\u547d\u4ee4\u4e5f\u4e0d\u4f1a\u521b\u5efakey\uff0c\u5bfc\u81f4\u52a0\u9501\u5931\u8d25 \u9009\u9879D, EX\u7684\u503c\u5e94\u8be5\u662f10, mylock\u7684\u503c\u5e94\u8be5\u662f100 10.\u5047\u8bbe\u6211\u4eec\u5c06Redis\u7684 min-slaves-to-write \u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a1, \u54e8\u5175\u7684 down-after-milliseconds \u8bbe\u7f6e\u4e3a 15s , \u54e8\u5175\u4e3b\u4ece\u5207\u6362\u9700\u8981 5s \u3002\u4e3b\u5e93\u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0\u5361\u4f4f\u4e86 18s \uff0c\u90a3 \u4e48\uff0c mIn-slaves-max-lag \u8bbe\u7f6e\u4e3a\u591a\u5c11\u65f6\uff0c\u53ef\u4ee5\u907f\u514d\u8111\u88c2\uff1f 15 16 23 33 \u9009\u9879C\uff0c \u65e7\u4e3b\u5e9318s\u540e\u6062\u590d\u6b63\u5e38\uff0c\u6b64\u65f6\u8fd8\u6ca1\u6709\u8d85\u51fa23s\uff0c\u800c\u4e14\u54e8\u5175\u8fd8\u6ca1\u6709\u5207\u6362\u5b8c\u6210\uff0c\u5bfc\u81f4\u65e7\u4e3b\u5e93\u53ef\u80fd\u63a5\u6536\u5199\u8bf7\u6c42 \u9009\u9879D\uff0c \u65e7\u4e3b\u5e9318s\u540e\u6062\u590d\u6b63\u5e38\uff0c\u6b64\u65f6\u6ca1\u6709\u8d85\u51fa33s\uff0c\u800c\u4e14\u54e8\u5175\u8fd8\u6ca1\u6709\u5207\u6362\u5b8c\u6210\uff0c\u5bfc\u81f4\u65e7\u4e3b\u5e93\u53ef\u80fd\u63a5\u6536\u5199\u8bf7\u6c42 min-slaves-max-lag \uff1a\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e86\u4e3b\u4ece\u5e93\u95f4\u8fdb\u884c\u6570\u636e\u590d\u5236\u65f6\uff0c\u4ece\u5e93\u7ed9\u4e3b\u5e93\u53d1\u9001 ACK \u6d88\u606f\u7684\u6700\u5927\u5ef6\u8fdf\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09\u3002 11.\u5047\u8bbe\u6709\u4e00\u4e2a\u4e1a\u52a1\u5e94\u7528\u60f3\u4f7f\u7528\u5982\u4e0b\u4ee3\u7801\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\uff0c\u4f60\u89c9\u5f97\uff0c\u8fd9\u6bb5\u4ee3\u7801\u6709\u4ec0\u4e48\u95ee\u9898\u5417\uff1f SETNX lock_key 1 DO THINGS DEL lock_key \u6ca1\u6709\u5bf9\u9501\u53d8\u91cf\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4,\u4f1a\u5bfc\u81f4\u9501\u53ef\u80fd\u4e00\u76f4\u88ab\u6301\u6709 \u5e94\u8be5\u4f7f\u7528SET\u547d\u4ee4\u52a0\u4e0aNX\u9009\u9879 lock_key \u8fd9\u4e2a\u952e\u503c\u5bf9\u7684\u952e\u540d\u79f0\u5e94\u8be5\u6539\u4e3a\u5ba2\u6237\u7aef\u7684\u552f\u4e00ID \u9501\u53d8\u91cf\u53ef\u80fd\u88ab\u5e76\u53d1\u7684\u5ba2\u6237\u7aef\u91ca\u653e\u6389 \u9009\u9879B\uff0cSETNX\u548cSET NX\u7684\u6548\u679c\u662f\u4e00\u6837\u7684 \u9009\u9879C\uff0c\u9700\u8981\u628a lock_key \u952e\u503c\u5bf9\u7684\u503c\u6539\u4e3a\u5ba2\u6237\u7aef\u552f\u4e00ID\uff0c\u800c\u4e0d\u662f\u628a\u952e\u6539\u4e3a\u552f\u4e00ID 12.\u5047\u8bbe\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u540c\u65f6\u8bfb\u53d6\u952e\u503c\u5bf9a\u3001b\u7684\u503c\uff0c\u5e76\u5bf9\u952e\u503c\u5bf9c\u7684\u503c\u505a\u52a01\u64cd\u4f5c\uff0c\u4e0b\u9762\u54ea\u4e9b\u4ee3\u7801\u7247\u6bb5\u80fd\u4fdd\u8bc1\u6570\u636e\u7684\u6b63\u786e\u6027\uff1f A. GET a GET b INC c B. \u4ee5\u4e0b 5 \u53e5\u4f7f\u7528 Lua \u811a\u672c\u5b9e\u73b0 GET a GET b GET c c = c + 1 SET c C. GET a GET b // \u4ee5\u4e0b\u4e09\u53e5\u7528 Lua \u811a\u672c\u5b9e\u73b0 GET c c = c + 1 SET c D. GET a GET b // \u4ee5\u4e0b\u4e24\u53e5\u7528 Lua \u811a\u672c\u5b9e\u73b0 GET c c = c + 1 SET c \u9009\u9879A\uff0c\u6b63\u786e\uff0cINCR\u547d\u4ee4\u539f\u5b50\u6267\u884c\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u6b63\u786e\u6027 \u9009\u9879B\uff0c\u6b63\u786e\uff0cLua\u811a\u672c\u539f\u5b50\u6267\u884c\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u6b63\u786e\u6027\uff0c\u4f46\u662f\u6ca1\u6709\u5fc5\u8981\u628aGET a\u548cb\u4e5f\u653e\u5230\u811a\u672c\u4e2d \u9009\u9879C\uff0c\u6b63\u786e \u9009\u9879D, SET c\u9700\u8981\u548c\u8bfb\u53d6c\uff0c\u4ee5\u53cac\u505a\u52a0\u4e00\u64cd\u4f5c\u4e00\u8d77\u6267\u884c 13.Pika\u662f\u4e00\u4e2a\u57fa\u4e8eSSD\u5b9e\u73b0\u7684\u5927\u5bb9\u91cf\u952e\u503c\u6570\u636e\u5e93\uff0c\u4e0b\u9762\u8fd9\u4e9b\u5173\u4e8ePika\u7684\u8bf4\u6cd5\u4e2d\uff0c\u6709\u54ea\u4e9b\u662f\u6b63\u786e\u7684\uff1f Pika\u867d\u7136\u53ef\u4ee5\u5b9e\u73b0\u5927\u5bb9\u91cf\u5b58\u50a8\uff0c\u4f46\u662f\u6570\u636e\u7c7b\u578b\u548c Redis\u4e0d\u517c\u5bb9 Pika\u5185\u90e8\u4f7f\u7528RocksDB\u6765\u4fdd\u5b58\u843d\u76d8\u7684\u6570\u636e Pika\u4f7f\u7528\u591a\u7ebf\u7a0b\u6765\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42 pika\u4f7f\u7528binlog\u673a\u5236\u5b9e\u73b0\u5199\u547d\u4ee4\u7684\u589e\u91cf\u540c\u6b65\u548cRedis\u4e00\u6837\uff0c\u4ecd\u7136\u4f1a\u53d7\u5185\u5b58\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u9650\u5236 A\u9009\u9879\uff0c Pika\u652f\u6301\u517c\u5bb9Redis\u76845\u5927\u57fa\u672c\u6570\u636e\u7c7b\u578b D\u9009\u9879\uff0c Pika\u4e3b\u4ece\u540c\u6b65\u65f6\uff0c\u4e0d\u53d7\u7f13\u5b58\u533a\u5927\u5c0f\u9650\u5236\u4e86 14.\u4e0b\u9762\u8fd9\u4e9b\u5173\u4e8eCodis\u96c6\u7fa4\u7684\u63cf\u8ff0\uff0c\u54ea\u4e9b\u662f\u6b63\u786e\u7684\uff1f Codis\u96c6\u7fa4\u9ed8\u8ba4\u4f7f\u752816384\u4e2aSlot\u8fdb\u884ckey\u7684\u5206\u914d \u4e3a\u4e86\u4fdd\u8bc1\u8fc1\u79fb\u6570\u636e\u7684\u5b8c\u6574\u6027\uff0cCodis\u53ea\u652f\u6301\u540c\u6b65\u8fc1\u79fb Codis proxy\u63a5\u6536\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u5e76\u8fdb\u884c\u8bf7\u6c42\u8f6c\u53d1 Codis\u96c6\u7fa4\u53ef\u4ee5\u4f7f\u7528etcd\u4fdd\u5b58\u96c6\u7fa4\u5143\u6570\u636e A\u9009\u9879\uff0c Codis\u9ed8\u8ba4\u4f7f\u75281024\u4e2aSlot B\u9009\u9879\uff0cCodis\u652f\u6301\u5f02\u6b65\u8fc1\u79fb\uff0c\u662f\u4e3a\u4e86\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b 15.\u5f53Redis\u7528\u4f5c\u7f13\u5b58\u65f6\uff0c\u5982\u679c\u540c\u65f6\u6709 \u5927\u91cf\u6570\u636e\u5931\u6548 \uff0c\u90a3\u4e48\u6b64\u65f6\u4f1a\u53d1\u751f\u4ec0\u4e48\u95ee\u9898\uff1f \u7f13\u5b58\u51fb\u7a7f \u7f13\u5b58\u7a7f\u900f \u7f13\u5b58\u96ea\u5d29 \u6ca1\u6709\u95ee\u9898 A\u9009\u9879\uff0c \u51fb\u7a7f\u662f\u8868\u793a\u5355\u4e2a\u6216\u5c11\u91cf\u70ed\u70b9\u6570\u636e\u5931\u6548 B\u9009\u9879\uff0c \u7a7f\u900f\u662f\u6307\u8bbf\u95ee\u7684\u6570\u636e\u65e2\u4e0d\u5728\u7f13\u5b58\uff0c\u4e5f\u4e0d\u5728\u6570\u636e\u5e93 C\u9009\u9879\uff0c\u6b63\u786e D\u9009\u9879\uff0c \u9898\u5e72\u6761\u4ef6\u4e0b\uff0c\u4f1a\u53d1\u751f\u7f13\u5b58\u96ea\u5d29\uff0c\u5bfc\u81f4\u5927\u91cf\u8bf7\u6c42\u53d1\u9001\u5230\u6570\u636e\u5e93\u5c42\uff0c\u7ed9\u6570\u636e\u5e93\u5c42\u5e26\u6765\u538b\u529b 16.\u5728\u4f7f\u7528Redis\u4f5c\u4e3a\u7f13\u5b58\u65f6\uff0c \u5982\u679c\u6709\u4e00\u4e2a\u5e94\u7528\u7684\u8d1f\u8f7d\u662f\u5bf9\u4e00\u4e2a\u5927\u6570\u636e\u96c6\u4e2d\u7684\u6240\u6709\u6570\u636e\u626b\u63cf\u4e00\u904d \uff0c\u90a3\u4e48\u4f7f\u7528\u4e0b\u9762\u54ea\u79cd\u6570\u636e\u6dd8\u6c70\u7b56\u7565\u4f1a\u66f4\u52a0\u5408\u9002\uff1f allkeys-lru allkeys-Ifu allkeys-random noeviction A\u9009\u9879\uff0c \u8be5\u7b56\u7565\u6309\u6570\u636e\u8bbf\u95ee\u65f6\u6548\u6027\u8fdb\u884c\u7b5b\u9009\uff0c\u4f1a\u5bfc\u81f4\u521a\u88ab\u8bbf\u95ee\u7684\u6570\u636e\u6ede\u7559\u5728\u7f13\u5b58\uff0c\u65e0\u6cd5\u88ab\u53ca\u65f6\u6dd8\u6c70\uff0c\u9020\u6210\u7f13\u5b58\u6c61\u67d3 B\u9009\u9879\uff0c\u6b63\u786e C\u9009\u9879\uff0c\u8be5\u7b56\u7565\u968f\u673a\u9009\u53d6\u6dd8\u6c70\u7684\u6570\u636e\uff0c\u4f1a\u9020\u6210\u7f13\u5b58\u6c61\u67d3 D\u9009\u9879\uff0c\u8be5\u7b56\u7565\u4e0d\u4f1a\u6dd8\u6c70\u6570\u636e LFU \u7f13\u5b58\u7b56\u7565\u662f\u5728 LRU \u7b56\u7565\u57fa\u7840\u4e0a\uff0c\u4e3a\u6bcf\u4e2a\u6570\u636e\u589e\u52a0\u4e86\u4e00\u4e2a\u8ba1\u6570\u5668\uff0c\u6765\u7edf\u8ba1\u8fd9\u4e2a\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u3002 LRU \u7b97\u6cd5\u7684\u5168\u79f0\u662f Least Recently Used\uff0c\u4ece\u540d\u5b57\u4e0a\u5c31\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u662f\u6309\u7167\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u539f\u5219\u6765\u7b5b\u9009\u6570\u636e\uff0c\u6700\u4e0d\u5e38\u7528\u7684\u6570\u636e\u4f1a\u88ab\u7b5b\u9009\u51fa\u6765\uff0c\u800c\u6700\u8fd1\u9891\u7e41\u4f7f\u7528\u7684\u6570\u636e\u4f1a\u7559\u5728\u7f13\u5b58\u4e2d 17.\u5728\u5e94\u7528Redis\u5207\u7247\u96c6\u7fa4\u65f6\uff0c\u4f7f\u7528\u4e86Hash Tag\u5bf9\u6570\u636e\u8fdb\u884c\u5207\u7247\uff0c\u73b0\u6709\u6570\u636e\u7684key\u662f user:info:{330} , value\u662f1024\uff0c\u8bf7\u95ee\u5207\u7247\u96c6\u7fa4\u4f7f\u7528\u6570\u636e\u7684\u54ea\u4e00\u90e8\u5206\u5185\u5bb9\u8ba1\u7b97CRC \u503c\uff1f user:info:{330} 1024 330 info \u9898\u76ee\u89e3\u6790 \u4f7f\u7528Hash Tag\u65f6\uff0c Redis\u53ea\u4f1a\u4f7f\u7528\u82b1\u62ec\u53f7\u5185\u7684\u5185\u5bb9\u8ba1\u7b97CRC\u503c \uff0c\u6240\u4ee5\u9009C\uff0c\u5176\u4ed6\u9009\u9879\u90fd\u4e0d\u662f\u82b1\u62ec\u53f7\u5185\u7684\u5185\u5bb9\u3002 18.\u5f53Redis\u7528\u4f5c\u53ea\u8bfb\u7f13\u5b58\u65f6\uff0c\u5982\u679c\u6570\u636e\u53d1\u751f\u4e86\u4fee\u6539\uff0c\u4ee5\u4e0b\u54ea \u4e2a\u8bf4\u6cd5\u662f\u6b63\u786e\u7684\uff1f \u901a\u8fc7\u5148\u5220\u9664\u7f13\u5b58\u503c\uff0c\u540e\u66f4\u65b0\u6570\u636e\u5e93\u503c\uff0c\u5c31\u53ef\u4ee5\u907f\u514d \u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898 \u901a\u8fc7\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58\uff0c\u5c31\u53ef\u4ee5\u907f\u514d\u6570\u636e \u4e0d\u4e00\u81f4\u95ee\u9898x \u5728\u5148\u5220\u9664\u7f13\u5b58\u503c\uff0c\u540e\u66f4\u65b0\u6570\u636e\u5e93\u65f6\u64cd\u4f5c, \u5982\u679c\u6709\u5e76\u53d1\u8bfb\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4f7f\u7528\u91cd\u8bd5\u6570\u636e\u5e93\u66f4\u65b0\u64cd\u4f5c\uff0c\u907f\u514d\u6570\u636e\u4e0d\u4e00\u81f4 \u5728\u5148\u5220\u9664\u7f13\u5b58\u503c\uff0c\u540e\u66f4\u65b0\u6570\u636e\u5e93\u65f6\uff0c\u5982\u679c\u6709\u5e76\u53d1\u8bfb\uff0c\u53ef\u4ee5\u4f7f\u7528\u5ef6\u8fdf\u53cc\u5220\uff0c\u6765\u5e94\u5bf9\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898 \u9009\u9879A\uff0c \u5220\u9664\u7f13\u5b58\u540e\uff0c\u5982\u679c\u6570\u636e\u5e93\u6ca1\u6709\u66f4\u65b0\u6210\u529f\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6570\u636e\u4e0d\u4e00\u81f4 \u9009\u9879B\uff0c \u66f4\u65b0\u6570\u636e\u5e93\u540e\uff0c\u5982\u679c\u7f13\u5b58\u5220\u9664\u5931\u8d25\uff0c\u5c31\u4f1a\u5bfc\u81f4\u4ecd\u7136\u8bfb\u5230\u65e7\u503c \u9009\u9879C\uff0c \u91cd\u8bd5\u6570\u636e\u5e93\u66f4\u65b0\u64cd\u4f5c\u662f\u5728\u6570\u636e\u5e93\u66f4\u65b0\u5931\u8d25\u60c5\u51b5\u4e0b\u7684\u5e94\u5bf9\u65b9\u6848 \u9009\u9879D\uff0c\u6b63\u786e 19.Redis\u7f13\u5b58\u4e00\u65e6\u53d1\u751f\u7f13\u5b58\u51fb\u7a7f\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5927\u91cf\u8bf7\u6c42\u53d1\u9001\u5230 \u6570\u636e\u5e93\u5c42\u8fdb\u884c\u5904\u7406\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u538b\u529b\u8fc7\u5927\u800c\u5d29\u6e83\uff0c \u4ee5\u4e0b\u54ea\u4e9b\u65b9\u6cd5\u53ef\u4ee5\u5e94\u5bf9\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898\uff0c\u7f13\u89e3\u6570\u636e\u5e93\u538b\u529b\uff1f \u7ed9\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u589e\u52a0\u968f\u673a\u91cf\uff0c\u907f\u514d\u540c\u65f6\u8fc7\u671f \u6570\u636e\u5e93\u9650\u6d41 \u5728\u4e1a\u52a1\u5e94\u7528\u63a5\u5165\u5c42\u68c0\u67e5\u662f\u5426\u6709\u6076\u610f\u8bf7\u6c42 \u4e0d\u7ed9\u70ed\u70b9\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4 A\u9009\u9879\uff0c\u8be5\u9009\u9879\u65b9\u6cd5\u662f\u7528\u6765\u5e94\u5bf9\u7f13\u5b58\u96ea\u5d29\u7684\uff0c\u89e3\u51b3\u4e0d\u4e86\u51fb\u7a7f\u95ee\u9898 B\u9009\u9879\uff0c\u6b63\u786e\uff0c\u53ef\u4ee5\u907f\u514d\u538b\u57ae\u6570\u636e\u5e93 C\u9009\u9879\uff0c\u8be5\u9009\u9879\u65b9\u6cd5\u662f\u7528\u6765\u5e94\u5bf9\u7f13\u5b58\u7a7f\u900f\u7684 D\u9009\u9879\uff0c\u6b63\u786e \u51fb\u7a7f\u662f\u8868\u793a\u5355\u4e2a\u6216\u5c11\u91cf\u70ed\u70b9\u6570\u636e\u5931\u6548 20.\u4ee5\u4e0b\u54ea\u4e2a\u547d\u4ee4\u4e0d\u5c5e\u4e8eRedis\u4e8b\u52a1\u673a\u5236\u6240\u9700\u7684\u5173\u952e\u547d\u4ee4\uff1f MULTI SET EXEC DISCARD A\u9009\u9879\uff0c\u662f\u4e8b\u52a1\u673a\u5236\u7684\u5173\u952e\u547d\u4ee4\uff0c\u8868\u793a\u4e8b\u52a1\u5f00\u59cb B\u9009\u9879\uff0c\u6b63\u786e\uff0c \u8fd9\u662f\u7528\u6765\u8bbe\u7f6ekey\u7684value\u503c\u7684\u547d\u4ee4\uff0c\u4e0d\u5c5e\u4e8e\u4e8b\u52a1\u673a\u5236\u7684\u5fc5\u9700\u547d\u4ee4 C\u9009\u9879\uff0c\u662f\u4e8b\u52a1\u673a\u5236\u7684\u5173\u952e\u547d\u4ee4\uff0c\u8ba9\u5b9e\u4f8b\u5f00\u59cb\u5b9e\u9645\u6267\u884c\u4e8b\u52a1 D\u9009\u9879\uff0c\u662f\u4e8b\u52a1\u673a\u5236\u7684\u5173\u952e\u547d\u4ee4\uff0c\u8868\u793a\u64a4\u9500\u4e8b\u52a1\u64cd\u4f5c","title":"3\u3001\u671f\u672b\u9009\u62e9\u9898"},{"location":"chap10/2Redis_interview/","text":"40 \u9053Redis\u9762\u8bd5\u9898 1\u3001\u4ec0\u4e48\u662f Redis\uff1f Redis \u662f\u5b8c\u5168\u5f00\u6e90\u514d\u8d39\u7684\uff0c\u9075\u5b88 BSD \u534f\u8bae\uff0c\u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684 key-value \u6570\u636e\u5e93\u3002 Redis \u4e0e\u5176\u4ed6 key - value \u7f13\u5b58\u4ea7\u54c1\u76f8\u6bd4\u6709\u4ee5\u4e0b\u4e09\u4e2a\u7279\u70b9\uff1a Redis \u652f\u6301\u6570\u636e\u7684\u6301\u4e45\u5316\uff0c\u53ef\u4ee5\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u4fdd\u5b58\u5728\u78c1\u76d8\u4e2d\uff0c\u91cd\u542f\u7684\u65f6\u5019\u53ef\u4ee5\u518d\u6b21\u52a0\u8f7d\u8fdb\u884c\u4f7f\u7528 \u3002 Redis \u4e0d\u4ec5\u4ec5\u652f\u6301\u7b80\u5355\u7684 key-value \u7c7b\u578b\u7684\u6570\u636e\uff0c \u540c\u65f6\u8fd8\u63d0\u4f9b list\uff0cset\uff0czset\uff0chash \u7b49\u6570\u636e\u7ed3\u6784\u7684\u5b58\u50a8\u3002 Redis \u652f\u6301\u6570\u636e\u7684\u5907\u4efd\uff0c\u5373 master-slave \u6a21\u5f0f\u7684\u6570\u636e\u5907\u4efd\u3002 Redis \u4f18\u52bf\uff1a \u6027\u80fd\u6781\u9ad8\uff1aRedis \u80fd\u8bfb\u7684\u901f\u5ea6\u662f 110000 \u6b21/s\uff0c\u5199\u7684\u901f\u5ea6\u662f 81000 \u6b21/s\u3002 \u4e30\u5bcc\u7684\u6570\u636e\u7c7b\u578b\uff1aRedis \u652f\u6301\u4e8c\u8fdb\u5236\u6848\u4f8b\u7684 Strings\uff0cLists\uff0cHashes\uff0cSets \u53ca Ordered Sets \u6570\u636e\u7c7b\u578b\u64cd\u4f5c\u3002 \u539f\u5b50\uff1aRedis \u7684\u6240\u6709\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u6027\u7684\uff0c\u610f\u601d\u5c31\u662f\u8981\u4e48\u6210\u529f\u6267\u884c\u8981\u4e48\u5931\u8d25\u5b8c\u5168\u4e0d\u6267\u884c\u3002\u5355\u4e2a\u64cd\u4f5c\u662f\u539f\u5b50\u6027\u7684\u3002\u591a\u4e2a\u64cd\u4f5c\u4e5f\u652f\u6301\u4e8b\u52a1\uff0c\u5373\u539f\u5b50\u6027\uff0c\u901a\u8fc7 MULTI \u548c EXEC \u6307\u4ee4\u5305\u8d77\u6765 \u4e30\u5bcc\u7684\u7279\u6027\uff1aRedis \u8fd8\u652f\u6301 publish/subscribe\uff0c\u901a\u77e5\uff0ckey \u8fc7\u671f\u7b49\u7b49\u7279\u6027\u3002 Redis \u4e0e\u5176\u4ed6 key-value \u5b58\u50a8\u6709\u4ec0\u4e48\u4e0d\u540c\uff1f Redis \u6709\u7740\u66f4\u4e3a\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784\u5e76\u4e14\u63d0\u4f9b\u5bf9\u4ed6\u4eec\u7684\u539f\u5b50\u6027\u64cd\u4f5c\uff0c\u8fd9\u662f\u4e00\u4e2a\u4e0d\u540c\u4e8e\u5176\u4ed6\u6570\u636e\u5e93\u7684\u8fdb\u5316\u8def\u5f84\u3002 Redis \u7684\u6570\u636e\u7c7b\u578b\u90fd\u662f\u57fa\u4e8e\u57fa\u672c\u6570\u636e\u7ed3\u6784\u7684\u540c\u65f6\u5bf9\u7a0b\u5e8f\u5458\u900f\u660e\uff0c\u65e0\u9700\u8fdb\u884c\u989d\u5916\u7684\u62bd\u8c61\u3002 Redis \u8fd0\u884c\u5728\u5185\u5b58\u4e2d\u4f46\u662f\u53ef\u4ee5\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u6240\u4ee5\u5728\u5bf9\u4e0d\u540c\u6570\u636e\u96c6\u8fdb\u884c\u9ad8\u901f\u8bfb\u5199\u65f6\u9700\u8981\u6743\u8861\u5185\u5b58\uff0c\u56e0\u4e3a\u6570\u636e\u91cf\u4e0d\u80fd\u5927\u4e8e\u786c\u4ef6\u5185\u5b58\u3002 \u5728\u5185\u5b58\u6570\u636e\u5e93\u65b9\u9762\u7684\u53e6\u4e00\u4e2a\u4f18\u70b9\u662f\uff0c \u76f8\u6bd4\u5728\u78c1\u76d8\u4e0a\u76f8\u540c\u7684\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5728\u5185\u5b58\u4e2d\u64cd\u4f5c\u8d77\u6765\u975e\u5e38\u7b80\u5355\uff0c\u8fd9\u6837 Redis \u53ef\u4ee5\u505a\u5f88\u591a\u5185\u90e8\u590d\u6742\u6027\u5f88\u5f3a\u7684\u4e8b\u60c5 \u3002\u540c\u65f6\uff0c\u5728\u78c1\u76d8\u683c\u5f0f\u65b9\u9762\u4ed6\u4eec\u662f\u7d27\u51d1\u7684\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u4ea7\u751f\u7684\uff0c\u56e0\u4e3a\u4ed6\u4eec\u5e76\u4e0d\u9700\u8981\u8fdb\u884c\u968f\u673a\u8bbf\u95ee\u3002 2\u3001Redis \u7684\u6570\u636e\u7c7b\u578b\uff1f Redis \u652f\u6301\u4e94\u79cd\u6570\u636e\u7c7b\u578b\uff1astring\uff08\u5b57\u7b26\u4e32\uff09\uff0chash\uff08\u54c8\u5e0c\uff09\uff0clist\uff08\u5217\u8868\uff09\uff0cset\uff08\u96c6\u5408\uff09\u53ca zsetsorted set\uff08\u6709\u5e8f\u96c6\u5408\uff09\u3002 \u6211\u4eec\u5b9e\u9645\u9879\u76ee\u4e2d\u6bd4\u8f83\u5e38\u7528\u7684\u662f string\uff0chash \u5982\u679c\u4f60\u662f Redis \u4e2d\u9ad8\u7ea7\u7528\u6237\uff0c\u8fd8\u9700\u8981\u52a0\u4e0a\u4e0b\u9762\u51e0\u79cd\u6570\u636e\u7ed3\u6784 HyperLogLog\u3001Geo\u3001Pub/Sub\u3002 \u5982\u679c\u4f60\u8bf4\u8fd8\u73a9\u8fc7 Redis Module\uff0c\u50cf BloomFilter\uff0cRedisSearch\uff0cRedis-ML\uff0c 3\u3001\u4f7f\u7528 Redis \u6709\u54ea\u4e9b\u597d\u5904\uff1f \u901f\u5ea6\u5feb\uff0c\u56e0\u4e3a\u6570\u636e\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u7c7b\u4f3c\u4e8e HashMap\uff0cHashMap \u7684\u4f18\u52bf\u5c31\u662f\u67e5\u627e\u548c\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u662f O(1) \u652f\u6301\u4e30\u5bcc\u6570\u636e\u7c7b\u578b\uff0c\u652f\u6301 string\uff0clist\uff0cset\uff0cZset\uff0chash \u7b49 \u652f\u6301\u4e8b\u52a1\uff0c\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u6027\uff0c\u6240\u8c13\u7684\u539f\u5b50\u6027\u5c31\u662f\u5bf9\u6570\u636e\u7684\u66f4\u6539\u8981\u4e48\u5168\u90e8\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u6267\u884c \u4e30\u5bcc\u7684\u7279\u6027\uff0c\u53ef\u7528\u4e8e\u7f13\u5b58\uff0c\u6d88\u606f\uff0c\u6309 key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u8fc7\u671f\u540e\u5c06\u4f1a\u81ea\u52a8\u5220\u9664 4\u3001Redis \u76f8\u6bd4 Memcached \u6709\u54ea\u4e9b\u4f18\u52bf\uff1f Memcached \u6240\u6709\u7684\u503c\u5747\u662f\u7b80\u5355\u7684\u5b57\u7b26\u4e32\uff0cRedis \u4f5c\u4e3a\u5176\u66ff\u4ee3\u8005\uff0c\u652f\u6301\u66f4\u4e3a\u4e30\u5bcc\u7684\u6570\u636e\u7c7b Redis \u7684\u901f\u5ea6\u6bd4 Memcached \u5feb\u5f88\u591a Redis \u53ef\u4ee5\u6301\u4e45\u5316\u5176\u6570\u636e 5\u3001Memcache \u4e0e Redis \u7684\u533a\u522b\u90fd\u6709\u54ea\u4e9b\uff1f \u5b58\u50a8\u65b9\u5f0f Memecache \u628a\u6570\u636e\u5168\u90e8\u5b58\u5728\u5185\u5b58\u4e4b\u4e2d\uff0c\u65ad\u7535\u540e\u4f1a\u6302\u6389\uff0c\u6570\u636e\u4e0d\u80fd\u8d85\u8fc7\u5185\u5b58\u5927\u5c0f\u3002Redis \u6709\u90e8\u5206\u5b58\u5728\u786c\u76d8\u4e0a\uff0c\u8fd9\u6837\u80fd\u4fdd\u8bc1\u6570\u636e\u7684\u6301\u4e45\u6027\u3002 \u6570\u636e\u652f\u6301\u7c7b\u578b Memcache \u5bf9\u6570\u636e\u7c7b\u578b\u652f\u6301\u76f8\u5bf9\u7b80\u5355\u3002Redis \u6709\u590d\u6742\u7684\u6570\u636e\u7c7b\u578b\u3002 \u4f7f\u7528\u5e95\u5c42\u6a21\u578b\u4e0d\u540c \u5b83\u4eec\u4e4b\u95f4\u5e95\u5c42\u5b9e\u73b0\u65b9\u5f0f \u4ee5\u53ca\u4e0e\u5ba2\u6237\u7aef\u4e4b\u95f4\u901a\u4fe1\u7684\u5e94\u7528\u534f\u8bae\u4e0d\u4e00\u6837\u3002Redis \u76f4\u63a5\u81ea\u5df1\u6784\u5efa\u4e86 VM \u673a\u5236 \uff0c\u56e0\u4e3a\u4e00\u822c\u7684\u7cfb\u7edf\u8c03\u7528\u7cfb\u7edf\u51fd\u6570\u7684\u8bdd\uff0c\u4f1a\u6d6a\u8d39\u4e00\u5b9a\u7684\u65f6\u95f4\u53bb\u79fb\u52a8\u548c\u8bf7\u6c42\u3002 6\u3001Redis \u662f\u5355\u8fdb\u7a0b\u5355\u7ebf\u7a0b\u7684\uff1f Redis \u662f\u5355\u8fdb\u7a0b\u5355\u7ebf\u7a0b\u7684\uff0cRedis \u5229\u7528\u961f\u5217\u6280\u672f\u5c06\u5e76\u53d1\u8bbf\u95ee\u53d8\u4e3a\u4e32\u884c\u8bbf\u95ee\uff0c\u6d88\u9664\u4e86\u4f20\u7edf\u6570\u636e\u5e93\u4e32\u884c\u63a7\u5236\u7684\u5f00\u9500\u3002 7\u3001\u4e00\u4e2a\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u667a\u80fd\u5b58\u50a8\u6700\u5927\u5bb9\u91cf\u662f\u591a\u5c11\uff1f 512M 8\u3001Redis \u7684\u6301\u4e45\u5316\u673a\u5236\u662f\u4ec0\u4e48\uff1f\u5404\u81ea\u7684\u4f18\u7f3a\u70b9\uff1f Redis\u63d0\u4f9b\u4e24\u79cd\u6301\u4e45\u5316\u673a\u5236 RDB \u548c AOF \u673a\u5236\uff1a RDB\uff08Redis DataBase\uff09\u6301\u4e45\u5316\u65b9\u5f0f\uff1a \u662f\u6307\u7528\u6570\u636e\u96c6\u5feb\u7167\u7684\u65b9\u5f0f\u534a\u6301\u4e45\u5316\u6a21\u5f0f\u8bb0\u5f55 Redis \u6570\u636e\u5e93\u7684\u6240\u6709\u952e\u503c\u5bf9\uff0c\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\u5c06\u6570\u636e\u5199\u5165\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6\uff0c\u6301\u4e45\u5316\u7ed3\u675f\u540e\uff0c\u7528\u8fd9\u4e2a\u4e34\u65f6\u6587\u4ef6\u66ff\u6362\u4e0a\u6b21\u6301\u4e45\u5316\u7684\u6587\u4ef6\uff0c\u8fbe\u5230\u6570\u636e\u6062\u590d\u3002 RDB\u4f18\u70b9 \u53ea\u6709\u4e00\u4e2a\u6587\u4ef6 dump.rdb \uff0c\u65b9\u4fbf\u6301\u4e45\u5316\u3002 \u5bb9\u707e\u6027\u597d\uff0c\u4e00\u4e2a\u6587\u4ef6\u53ef\u4ee5\u4fdd\u5b58\u5230\u5b89\u5168\u7684\u78c1\u76d8\u3002 \u6027\u80fd\u6700\u5927\u5316\uff0cfork \u5b50\u8fdb\u7a0b\u6765\u5b8c\u6210\u5199\u64cd\u4f5c\uff0c\u8ba9\u4e3b\u8fdb\u7a0b\u7ee7\u7eed\u5904\u7406\u547d\u4ee4\uff0c\u6240\u4ee5\u662f IO \u6700\u5927\u5316\u3002\u4f7f\u7528\u5355\u72ec\u5b50\u8fdb\u7a0b\u6765\u8fdb\u884c\u6301\u4e45\u5316\uff0c\u4e3b\u8fdb\u7a0b\u4e0d\u4f1a\u8fdb\u884c\u4efb\u4f55 IO \u64cd\u4f5c\uff0c\u4fdd\u8bc1\u4e86 Redis\u7684\u9ad8\u6027\u80fd\u3002 \u76f8\u5bf9\u4e8e\u6570\u636e\u96c6\u5927\u65f6\uff0c\u6bd4 AOF \u7684\u542f\u52a8\u6548\u7387\u66f4\u9ad8\u3002 RDB\u7f3a\u70b9\uff1a \u6570\u636e\u5b89\u5168\u6027\u4f4e\u3002RDB \u662f\u95f4\u9694\u4e00\u6bb5\u65f6\u95f4\u8fdb\u884c\u6301\u4e45\u5316\uff0c\u5982\u679c\u6301\u4e45\u5316\u4e4b\u95f4 Redis \u53d1\u751f\u6545\u969c\uff0c\u4f1a\u53d1\u751f\u6570\u636e\u4e22\u5931\u3002\u6240\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u66f4\u9002\u5408\u6570\u636e\u8981\u6c42\u4e0d\u4e25\u8c28\u7684\u65f6\u5019 AOF\uff08Append-only file\uff09\u6301\u4e45\u5316\u65b9\u5f0f\uff1a\u662f\u6307\u6240\u6709\u7684\u547d\u4ee4\u884c\u8bb0\u5f55\u4ee5 Redis \u547d\u4ee4\u8bf7\u6c42\u534f\u8bae\u7684\u683c\u5f0f\u5b8c\u5168\u6301\u4e45\u5316\u5b58\u50a8\u4fdd\u5b58\u4e3a aof \u6587\u4ef6\u3002 AOF\u4f18\u70b9 \u6570\u636e\u5b89\u5168\uff0caof \u6301\u4e45\u5316\u53ef\u4ee5\u914d\u7f6e appendfsync \u5c5e\u6027\uff0c\u6709 always\uff0c\u6bcf\u8fdb\u884c\u4e00\u6b21\u547d\u4ee4\u64cd\u4f5c\u5c31\u8bb0\u5f55\u5230 aof \u6587\u4ef6\u4e2d\u4e00\u6b21\u3002 \u901a\u8fc7 append \u6a21\u5f0f\u5199\u6587\u4ef6\uff0c\u5373\u4f7f\u4e2d\u9014\u670d\u52a1\u5668\u5b95\u673a\uff0c\u53ef\u4ee5\u901a\u8fc7 redis-check-aof \u5de5\u5177\u89e3\u51b3\u6570\u636e\u4e00\u81f4\u6027\u95ee\u9898 \u3002 AOF \u673a\u5236\u7684 rewrite \u6a21\u5f0f\u3002AOF \u6587\u4ef6\u6ca1\u88ab rewrite \u4e4b\u524d\uff08\u6587\u4ef6\u8fc7\u5927\u65f6\u4f1a\u5bf9\u547d\u4ee4\u8fdb\u884c\u5408\u5e76\u91cd\u5199\uff09\uff0c\u53ef\u4ee5\u5220\u9664\u5176\u4e2d\u7684\u67d0\u4e9b\u547d\u4ee4\uff08\u6bd4\u5982\u8bef\u64cd\u4f5c\u7684 flushall\uff09 AOF\u7f3a\u70b9\uff1a AOF \u6587\u4ef6\u6bd4 RDB \u6587\u4ef6\u5927\uff0c\u4e14\u6062\u590d\u901f\u5ea6\u6162\u3002 \u6570\u636e\u96c6\u5927\u7684\u65f6\u5019\uff0c\u6bd4 RDB \u542f\u52a8\u6548\u7387\u4f4e\u3002 9\u3001Redis \u5e38\u89c1\u6027\u80fd\u95ee\u9898\u548c\u89e3\u51b3\u65b9\u6848 Master \u6700\u597d\u4e0d\u8981\u5199\u5185\u5b58\u5feb\u7167\uff0c \u5982\u679c Master \u5199\u5185\u5b58\u5feb\u7167\uff0csave \u547d\u4ee4\u8c03\u5ea6 rdbSave\u51fd\u6570\uff0c\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u7684\u5de5\u4f5c\uff0c\u5f53\u5feb\u7167\u6bd4\u8f83\u5927\u65f6\u5bf9\u6027\u80fd\u5f71\u54cd\u662f\u975e\u5e38\u5927\u7684\uff0c\u4f1a\u95f4\u65ad\u6027\u6682\u505c\u670d\u52a1 \u3002 \u5982\u679c\u6570\u636e\u6bd4\u8f83\u91cd\u8981\uff0c\u67d0\u4e2a Slave \u5f00\u542f AOF \u5907\u4efd\u6570\u636e\uff0c\u7b56\u7565\u8bbe\u7f6e\u4e3a\u6bcf\u79d2\u540c\u6b65\u4e00(Everysec)\u3002 \u4e3a\u4e86\u4e3b\u4ece\u590d\u5236\u7684\u901f\u5ea6\u548c\u8fde\u63a5\u7684\u7a33\u5b9a\u6027\uff0cMaster \u548c Slave \u6700\u597d\u5728\u540c\u4e00\u4e2a\u5c40\u57df\u7f51\u3002 \u5c3d\u91cf\u907f\u514d\u5728\u538b\u529b\u5f88\u5927\u7684\u4e3b\u5e93\u4e0a\u589e\u52a0\u4ece\u3002 \u4e3b\u4ece\u590d\u5236\u4e0d\u8981\u7528\u56fe\u72b6\u7ed3\u6784\uff0c\u7528\u5355\u5411\u94fe\u8868\u7ed3\u6784\u66f4\u4e3a\u7a33\u5b9a \uff0c\u5373\uff1a Master <- Slave1<- Slave2 <- Slave3\u2026\u2026 \u8fd9\u6837\u7684\u7ed3\u6784\u65b9\u4fbf\u89e3\u51b3\u5355\u70b9\u6545\u969c\u95ee\u9898\uff0c\u5b9e\u73b0 Slave \u5bf9 Master \u7684\u66ff\u6362\u3002\u5982\u679c Master \u6302\u4e86\uff0c\u53ef\u4ee5\u7acb\u523b\u542f\u7528 Slave1 \u505a Master\uff0c\u5176\u4ed6\u4e0d\u53d8\u3002 10\u3001Redis \u8fc7\u671f\u952e\u7684\u5220\u9664\u7b56\u7565\uff1f \u5b9a\u65f6\u5220\u9664\uff1a\u5728\u8bbe\u7f6e\u952e\u7684\u8fc7\u671f\u65f6\u95f4\u7684\u540c\u65f6\uff0c\u521b\u5efa\u4e00\u4e2a\u5b9a\u65f6\u5668 timer\u3002\u8ba9\u5b9a\u65f6\u5668\u5728\u952e\u7684\u8fc7\u671f\u65f6\u95f4\u6765\u4e34\u65f6\uff0c\u7acb\u5373\u6267\u884c\u5bf9\u952e\u7684\u5220\u9664\u64cd\u4f5c\u3002 \u60f0\u6027\u5220\u9664\uff1a\u653e\u4efb\u952e\u8fc7\u671f\u4e0d\u7ba1\uff0c\u4f46\u662f\u6bcf\u6b21\u4ece\u952e\u7a7a\u95f4\u4e2d\u83b7\u53d6\u952e\u65f6\uff0c\u90fd\u68c0\u67e5\u53d6\u5f97\u7684\u952e\u662f\u5426\u8fc7\u671f\uff0c\u5982\u679c\u8fc7\u671f\u7684\u8bdd\uff0c\u5c31\u5220\u9664\u8be5\u952e;\u5982\u679c\u6ca1\u6709\u8fc7\u671f\uff0c\u5c31\u8fd4\u56de\u8be5\u952e\u3002 \u5b9a\u671f\u5220\u9664\uff1a\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u7a0b\u5e8f\u5c31\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u4e00\u6b21\u68c0\u67e5\uff0c\u5220\u9664\u91cc\u9762\u7684\u8fc7\u671f\u952e\u3002\u81f3 \u4e8e\u8981\u5220\u9664\u591a\u5c11\u8fc7\u671f\u952e\uff0c\u4ee5\u53ca\u8981\u68c0\u67e5\u591a\u5c11\u4e2a\u6570\u636e\u5e93\uff0c\u5219\u7531\u7b97\u6cd5\u51b3\u5b9a\u3002 11\u3001Redis \u7684\u56de\u6536\u7b56\u7565\uff08\u6dd8\u6c70\u7b56\u7565\uff09\uff1f volatile-lru \uff1a\u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6 \uff08server.db[i].expires\uff09 \u4e2d\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70 volatile-ttl \uff1a\u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6 \uff08server.db[i].expires\uff09 \u4e2d\u6311\u9009\u5c06\u8981\u8fc7\u671f\u7684\u6570\u636e\u6dd8\u6c70 volatile-random \uff1a\u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6 \uff08server.db[i].expires\uff09 \u4e2d\u4efb\u610f\u9009\u62e9\u6570\u636e\u6dd8\u6c70 allkeys-lru \uff1a\u4ece\u6570\u636e\u96c6\uff08 server.db[i].dict \uff09\u4e2d\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70 allkeys-random \uff1a\u4ece\u6570\u636e\u96c6\uff08 server.db[i].dict \uff09\u4e2d\u4efb\u610f\u9009\u62e9\u6570\u636e\u6dd8\u6c70 no-enviction \uff08\u9a71\u9010\uff09\uff1a\u7981\u6b62\u9a71\u9010\u6570\u636e \u6ce8\u610f\u8fd9\u91cc\u7684 6 \u79cd\u673a\u5236\uff0c volatile \u548c allkeys \u89c4\u5b9a\u4e86\u662f\u5bf9\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u6dd8\u6c70\u6570\u636e\u8fd8\u662f\u4ece\u5168\u90e8\u6570\u636e\u96c6\u6dd8\u6c70\u6570\u636e\uff0c\u540e\u9762\u7684 lru \u3001 ttl \u4ee5\u53ca random \u662f\u4e09\u79cd\u4e0d\u540c\u7684\u6dd8\u6c70\u7b56\u7565\uff0c\u518d\u52a0\u4e0a\u4e00\u79cd no-enviction \u6c38\u4e0d\u56de\u6536\u7684\u7b56\u7565\u3002 \u4f7f\u7528\u7b56\u7565\u89c4\u5219\uff1a \u5982\u679c\u6570\u636e\u5448\u73b0\u5e42\u5f8b\u5206\u5e03\uff0c\u4e5f\u5c31\u662f\u4e00\u90e8\u5206\u6570\u636e\u8bbf\u95ee\u9891\u7387\u9ad8\uff0c\u4e00\u90e8\u5206\u6570\u636e\u8bbf\u95ee\u9891\u7387\u4f4e\uff0c\u5219\u4f7f\u7528 allkeys-lru \u5982\u679c\u6570\u636e\u5448\u73b0\u5e73\u7b49\u5206\u5e03\uff0c\u4e5f\u5c31\u662f\u6240\u6709\u7684\u6570\u636e\u8bbf\u95ee\u9891\u7387\u90fd\u76f8\u540c\uff0c\u5219\u4f7f\u7528 allkeys-random 12\u3001\u4e3a\u4ec0\u4e48 Redis \u9700\u8981\u628a\u6240\u6709\u6570\u636e\u653e\u5230\u5185\u5b58\u4e2d\uff1f Redis \u4e3a\u4e86\u8fbe\u5230\u6700\u5feb\u7684\u8bfb\u5199\u901f\u5ea6\u5c06\u6570\u636e\u90fd\u8bfb\u5230\u5185\u5b58\u4e2d\uff0c\u5e76\u901a\u8fc7\u5f02\u6b65\u7684\u65b9\u5f0f\u5c06\u6570\u636e\u5199\u5165\u78c1\u76d8\u3002 \u6240\u4ee5 Redis \u5177\u6709\u5feb\u901f\u548c\u6570\u636e\u6301\u4e45\u5316\u7684\u7279\u5f81 \u3002\u5982\u679c\u4e0d\u5c06\u6570\u636e\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u78c1\u76d8 I/O \u901f\u5ea6\u4e3a\u4e25\u91cd\u5f71\u54cd Redis \u7684\u6027\u80fd\u3002\u5728\u5185\u5b58\u8d8a\u6765\u8d8a\u4fbf\u5b9c\u7684\u4eca\u5929\uff0cRedis \u5c06\u4f1a\u8d8a\u6765\u8d8a\u53d7\u6b22\u8fce\u3002 \u5982\u679c\u8bbe\u7f6e\u4e86\u6700\u5927\u4f7f\u7528\u7684\u5185\u5b58\uff0c\u5219\u6570\u636e\u5df2\u6709\u8bb0\u5f55\u6570\u8fbe\u5230\u5185\u5b58\u9650\u503c\u540e\u4e0d\u80fd\u7ee7\u7eed\u63d2\u5165\u65b0\u503c\u3002 13\u3001Redis \u7684\u540c\u6b65\u673a\u5236\u4e86\u89e3\u4e48\uff1f Redis \u53ef\u4ee5\u4f7f\u7528\u4e3b\u4ece\u540c\u6b65\uff0c\u4ece\u4ece\u540c\u6b65\u3002 \u7b2c\u4e00\u6b21\u540c\u6b65\u65f6\uff0c\u4e3b\u8282\u70b9\u505a\u4e00\u6b21 bgsave \uff0c\u5e76\u540c\u65f6\u5c06\u540e\u7eed\u4fee\u6539\u64cd\u4f5c\u8bb0\u5f55\u5230\u5185\u5b58 buffer \uff0c\u5f85\u5b8c\u6210\u540e\u5c06 rdb \u6587\u4ef6\u5168\u91cf\u540c\u6b65\u5230\u590d\u5236\u8282\u70b9\uff0c\u590d\u5236\u8282\u70b9\u63a5\u6536\u5b8c\u6210\u540e\u5c06 rdb \u955c\u50cf\u52a0\u8f7d\u5230\u5185\u5b58\u3002 \u52a0\u8f7d\u5b8c\u6210\u540e\uff0c\u518d\u901a\u77e5\u4e3b\u8282\u70b9\u5c06\u671f\u95f4\u4fee\u6539\u7684\u64cd\u4f5c\u8bb0\u5f55\u540c\u6b65\u5230\u590d\u5236\u8282\u70b9\u8fdb\u884c\u91cd\u653e\u5c31\u5b8c\u6210\u4e86\u540c\u6b65\u8fc7\u7a0b \u3002 14\u3001Pipeline \u6709\u4ec0\u4e48\u597d\u5904\uff0c\u4e3a\u4ec0\u4e48\u8981\u7528 Pipeline\uff1f \u53ef\u4ee5\u5c06\u591a\u6b21 IO \u5f80\u8fd4\u7684\u65f6\u95f4\u7f29\u51cf\u4e3a\u4e00\u6b21\uff0c\u524d\u63d0\u662f Pipeline \u6267\u884c\u7684\u6307\u4ee4\u4e4b\u95f4\u6ca1\u6709\u56e0\u679c\u76f8\u5173\u6027\u3002 \u4f7f\u7528 redis-benchmark \u8fdb\u884c\u538b\u6d4b\u7684\u65f6\u5019\u53ef\u4ee5\u53d1\u73b0\u5f71\u54cd Redis \u7684 QPS \u5cf0\u503c\u7684\u4e00\u4e2a\u91cd\u8981\u56e0\u7d20\u662f Pipeline \u6279\u6b21\u6307\u4ee4\u7684\u6570\u76ee\u3002 15\u3001\u662f\u5426\u4f7f\u7528\u8fc7 Redis \u96c6\u7fa4\uff0c\u96c6\u7fa4\u7684\u539f\u7406\u662f\u4ec0\u4e48\uff1f Redis Sentinal \u7740\u773c\u4e8e\u9ad8\u53ef\u7528\uff0c\u5728 Master \u5b95\u673a\u65f6\u4f1a\u81ea\u52a8\u5c06 slave \u63d0\u5347\u4e3amaster\uff0c\u7ee7\u7eed\u63d0\u4f9b\u670d\u52a1\u3002 Redis Cluster \u7740\u773c\u4e8e\u6269\u5c55\u6027\uff0c\u5728\u5355\u4e2a Redis \u5185\u5b58\u4e0d\u8db3\u65f6\uff0c\u4f7f\u7528 Cluster \u8fdb\u884c\u5206\u7247\u5b58\u50a8\u3002 16\u3001Redis \u96c6\u7fa4\u65b9\u6848\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u5bfc\u81f4\u6574\u4e2a\u96c6\u7fa4\u4e0d\u53ef\u7528\uff1f \u6709 A\uff0cB\uff0cC \u4e09\u4e2a\u8282\u70b9\u7684\u96c6\u7fa4\uff0c\u5728\u6ca1\u6709\u590d\u5236\u6a21\u578b\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u8282\u70b9 B \u5931\u8d25\u4e86\uff0c\u90a3\u4e48\u6574\u4e2a\u96c6\u7fa4\u5c31\u4f1a\u4ee5\u4e3a\u7f3a\u5c11 5501-11000 \u8fd9\u4e2a\u8303\u56f4\u7684\u69fd\u800c\u4e0d\u53ef\u7528\u3002 17\u3001Redis \u652f\u6301\u7684 Java \u5ba2\u6237\u7aef\u90fd\u6709\u54ea\u4e9b\uff1f\u5b98\u65b9\u63a8\u8350\u7528\u54ea\u4e2a\uff1f Redisson\u3001Jedis\u3001lettuce \u7b49\u7b49\uff0c\u5b98\u65b9\u63a8\u8350\u4f7f\u7528 Redisson\u3002 18\u3001Jedis \u4e0e Redisson \u5bf9\u6bd4\u6709\u4ec0\u4e48\u4f18\u7f3a\u70b9\uff1f Jedis \u662f Redis \u7684 Java \u5b9e\u73b0\u7684\u5ba2\u6237\u7aef\uff0c\u5176 API \u63d0\u4f9b\u4e86\u6bd4\u8f83\u5168\u9762\u7684 Redis \u547d\u4ee4\u7684\u652f\u6301\uff1bRedisson \u5b9e\u73b0\u4e86\u5206\u5e03\u5f0f\u548c\u53ef\u6269\u5c55\u7684 Java \u6570\u636e\u7ed3\u6784\uff0c\u548c Jedis \u76f8\u6bd4\uff0c\u529f\u80fd\u8f83\u4e3a\u7b80\u5355\uff0c\u4e0d\u652f\u6301\u5b57\u7b26\u4e32\u64cd\u4f5c\uff0c\u4e0d\u652f\u6301\u6392\u5e8f\u3001\u4e8b\u52a1\u3001\u7ba1\u9053\u3001\u5206\u533a\u7b49 Redis \u7279\u6027\u3002 Redisson \u7684\u5b97\u65e8\u662f\u4fc3\u8fdb\u4f7f\u7528\u8005\u5bf9 Redis \u7684\u5173\u6ce8\u5206\u79bb\uff0c\u4ece\u800c\u8ba9\u4f7f\u7528\u8005\u80fd\u591f\u5c06\u7cbe\u529b\u66f4\u96c6\u4e2d\u5730\u653e\u5728\u5904\u7406\u4e1a\u52a1\u903b\u8f91\u4e0a\u3002 19\u3001Redis \u5982\u4f55\u8bbe\u7f6e\u5bc6\u7801\u53ca\u9a8c\u8bc1\u5bc6\u7801\uff1f \u8bbe\u7f6e\u5bc6\u7801\uff1a config set requirepass 123456 \u6388\u6743\u5bc6\u7801\uff1a auth 123456 20\u3001\u8bf4\u8bf4 Redis \u54c8\u5e0c\u69fd\u7684\u6982\u5ff5\uff1f Redis \u96c6\u7fa4\u6ca1\u6709\u4f7f\u7528\u4e00\u81f4\u6027 hash\uff0c\u800c\u662f\u5f15\u5165\u4e86\u54c8\u5e0c\u69fd\u7684\u6982\u5ff5 Redis \u96c6\u7fa4\u6709 16384 \u4e2a\u54c8\u5e0c\u69fd\uff0c\u6bcf\u4e2a key \u901a\u8fc7 CRC16 \u6821\u9a8c\u540e\u5bf9 16384 \u53d6\u6a21\u6765\u51b3\u5b9a\u653e\u7f6e\u54ea\u4e2a\u69fd\uff0c\u96c6\u7fa4\u7684\u6bcf\u4e2a\u8282\u70b9\u8d1f\u8d23\u4e00\u90e8\u5206 hash \u69fd\u3002 21\u3001Redis \u96c6\u7fa4\u7684\u4e3b\u4ece\u590d\u5236\u6a21\u578b\u662f\u600e\u6837\u7684\uff1f \u4e3a\u4e86\u4f7f\u5728\u90e8\u5206\u8282\u70b9\u5931\u8d25\u6216\u8005\u5927\u90e8\u5206\u8282\u70b9\u65e0\u6cd5\u901a\u4fe1\u7684\u60c5\u51b5\u4e0b\u96c6\u7fa4\u4ecd\u7136\u53ef\u7528\uff0c\u6240\u4ee5\u96c6\u7fa4\u4f7f\u7528\u4e86\u4e3b\u4ece\u590d\u5236\u6a21\u578b\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u4f1a\u6709 N-1 \u4e2a\u590d\u5236\u54c1\u3002 22\u3001Redis \u96c6\u7fa4\u4f1a\u6709\u5199\u64cd\u4f5c\u4e22\u5931\u5417\uff1f\u4e3a\u4ec0\u4e48\uff1f Redis \u5e76\u4e0d\u80fd\u4fdd\u8bc1\u6570\u636e\u7684\u5f3a\u4e00\u81f4\u6027\uff0c\u8fd9\u610f\u5473\u7740\u5728\u5b9e\u9645\u4e2d\u96c6\u7fa4\u5728\u7279\u5b9a\u7684\u6761\u4ef6\u4e0b\u53ef\u80fd\u4f1a\u4e22\u5931\u5199\u64cd\u4f5c\u3002 23\u3001Redis \u96c6\u7fa4\u4e4b\u95f4\u662f\u5982\u4f55\u590d\u5236\u7684\uff1f \u5f02\u6b65\u590d\u5236\u3002 24\u3001Redis \u96c6\u7fa4\u6700\u5927\u8282\u70b9\u4e2a\u6570\u662f\u591a\u5c11\uff1f 16384 \u4e2a\u3002 25\u3001Redis \u96c6\u7fa4\u5982\u4f55\u9009\u62e9\u6570\u636e\u5e93\uff1f Redis \u96c6\u7fa4\u76ee\u524d\u65e0\u6cd5\u505a\u6570\u636e\u5e93\u9009\u62e9\uff0c\u9ed8\u8ba4\u5728 0 \u6570\u636e\u5e93\u3002 26\u3001\u600e\u4e48\u6d4b\u8bd5 Redis \u7684\u8fde\u901a\u6027\uff1f \u4f7f\u7528 ping \u547d\u4ee4\u3002 27\u3001\u600e\u4e48\u7406\u89e3 Redis \u4e8b\u52a1\uff1f \u4e8b\u52a1\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u9694\u79bb\u64cd\u4f5c\uff1a\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u90fd\u4f1a\u5e8f\u5217\u5316\u3001\u6309\u987a\u5e8f\u5730\u6267\u884c\u3002\u4e8b\u52a1\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u4f1a\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u53d1\u9001\u6765\u7684\u547d\u4ee4\u8bf7\u6c42\u6240\u6253\u65ad\u3002 \u4e8b\u52a1\u662f\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\uff1a\u4e8b\u52a1\u4e2d\u7684\u547d\u4ee4\u8981\u4e48\u5168\u90e8\u88ab\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u90fd\u4e0d\u6267\u884c\u3002 28\u3001Redis \u4e8b\u52a1\u76f8\u5173\u7684\u547d\u4ee4\u6709\u54ea\u51e0\u4e2a\uff1f MULTI\u3001EXEC\u3001DISCARD\u3001WATCH\u3002 29\u3001Redis key \u7684\u8fc7\u671f\u65f6\u95f4\u548c\u6c38\u4e45\u6709\u6548\u5206\u522b\u600e\u4e48\u8bbe\u7f6e\uff1f EXPIRE \u548c PERSIST \u547d\u4ee4\u3002 30\u3001Redis \u5982\u4f55\u505a\u5185\u5b58\u4f18\u5316\uff1f \u5c3d\u53ef\u80fd\u4f7f\u7528\u6563\u5217\u8868\uff08hashes\uff09\uff0c\u6563\u5217\u8868\uff08\u662f\u8bf4\u6563\u5217\u8868\u91cc\u9762\u5b58\u50a8\u7684\u6570\u5c11\uff09\u4f7f\u7528\u7684\u5185\u5b58\u975e\u5e38\u5c0f\uff0c\u6240\u4ee5\u4f60\u5e94\u8be5\u5c3d\u53ef\u80fd\u7684\u5c06\u4f60\u7684\u6570\u636e\u6a21\u578b\u62bd\u8c61\u5230\u4e00\u4e2a\u6563\u5217\u8868\u91cc\u9762\u3002\u6bd4\u5982\u4f60\u7684 Web \u7cfb\u7edf\u4e2d\u6709\u4e00\u4e2a\u7528\u6237\u5bf9\u8c61\uff0c\u4e0d\u8981\u4e3a\u8fd9\u4e2a\u7528\u6237\u7684\u540d\u79f0\uff0c\u59d3\u6c0f\uff0c\u90ae\u7bb1\uff0c\u5bc6\u7801\u8bbe\u7f6e\u5355\u72ec\u7684 key,\u800c\u662f\u5e94\u8be5\u628a\u8fd9\u4e2a\u7528\u6237\u7684\u6240\u6709\u4fe1\u606f\u5b58\u50a8\u5230\u4e00\u5f20\u6563\u5217\u8868\u91cc\u9762\u3002 31\u3001Redis \u56de\u6536\u8fdb\u7a0b\u5982\u4f55\u5de5\u4f5c\u7684\uff1f \u4e00\u4e2a\u5ba2\u6237\u7aef\u8fd0\u884c\u4e86\u65b0\u7684\u547d\u4ee4\uff0c\u6dfb\u52a0\u4e86\u65b0\u7684\u6570\u636e\u3002 Redis \u68c0\u67e5\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\uff0c\u5982\u679c\u5927\u4e8e maxmemory \u7684\u9650\u5236\uff0c\u5219\u6839\u636e\u8bbe\u5b9a\u597d\u7684\u7b56\u7565\u8fdb\u884c\u56de\u6536\u3002 \u4e00\u4e2a\u65b0\u7684\u547d\u4ee4\u88ab\u6267\u884c\uff0c\u7b49\u7b49\u3002\u6240\u4ee5\u6211\u4eec\u4e0d\u65ad\u5730\u7a7f\u8d8a\u5185\u5b58\u9650\u5236\u7684\u8fb9\u754c\uff0c\u901a\u8fc7\u4e0d\u65ad\u8fbe\u5230\u8fb9\u754c\u7136\u540e\u4e0d\u65ad\u5730\u56de\u6536\u56de\u5230\u8fb9\u754c\u4ee5\u4e0b\u3002\u5982\u679c\u4e00\u4e2a\u547d\u4ee4\u7684\u7ed3\u679c\u5bfc\u81f4\u5927\u91cf\u5185\u5b58\u88ab\u4f7f\u7528\uff08\u4f8b\u5982\u5f88\u5927\u7684\u96c6\u5408\u7684\u4ea4\u96c6\u4fdd\u5b58\u5230\u4e00\u4e2a\u65b0\u7684\u952e\uff09\uff0c\u4e0d\u7528\u591a\u4e45\u5185\u5b58\u9650\u5236\u5c31\u4f1a\u88ab\u8fd9\u4e2a\u5185\u5b58\u4f7f\u7528\u91cf\u8d85\u8d8a\u3002 32\u3001\u90fd\u6709\u54ea\u4e9b\u529e\u6cd5\u53ef\u4ee5\u964d\u4f4e Redis \u7684\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u5462\uff1f \u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f 32 \u4f4d\u7684 Redis \u5b9e\u4f8b\uff0c\u53ef\u4ee5\u597d\u597d\u5229\u7528 Hash\uff0clist\uff0csorted set\uff0cset\u7b49\u96c6\u5408\u7c7b\u578b\u6570\u636e\uff0c\u56e0\u4e3a\u901a\u5e38\u60c5\u51b5\u4e0b\u5f88\u591a\u5c0f\u7684 Key-Value \u53ef\u4ee5\u7528\u66f4\u7d27\u51d1\u7684\u65b9\u5f0f\u5b58\u653e\u5230\u4e00\u8d77\u3002 33\u3001Redis \u7684\u5185\u5b58\u7528\u5b8c\u4e86\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f \u5982\u679c\u8fbe\u5230\u8bbe\u7f6e\u7684\u4e0a\u9650\uff0cRedis \u7684\u5199\u547d\u4ee4\u4f1a\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\uff08\u4f46\u662f\u8bfb\u547d\u4ee4\u8fd8\u53ef\u4ee5\u6b63\u5e38\u8fd4\u56de\u3002\uff09\u6216\u8005\u4f60\u53ef\u4ee5\u5c06 Redis \u5f53\u7f13\u5b58\u6765\u4f7f\u7528\u914d\u7f6e\u6dd8\u6c70\u673a\u5236\uff0c\u5f53 Redis \u8fbe\u5230\u5185\u5b58\u4e0a\u9650\u65f6\u4f1a\u51b2\u5237\u6389\u65e7\u7684\u5185\u5bb9\u3002 34\u3001\u4e00\u4e2a Redis \u5b9e\u4f8b\u6700\u591a\u80fd\u5b58\u653e\u591a\u5c11\u7684 keys\uff1fList\u3001Set\u3001Sorted Set \u4ed6\u4eec\u6700\u591a\u80fd\u5b58\u653e\u591a\u5c11\u5143\u7d20\uff1f \u7406\u8bba\u4e0a Redis \u53ef\u4ee5\u5904\u7406\u591a\u8fbe 232 \u7684 keys\uff0c\u5e76\u4e14\u5728\u5b9e\u9645\u4e2d\u8fdb\u884c\u4e86\u6d4b\u8bd5\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u81f3\u5c11\u5b58\u653e\u4e86 2 \u4ebf 5 \u5343\u4e07\u7684 keys\u3002\u6211\u4eec\u6b63\u5728\u6d4b\u8bd5\u4e00\u4e9b\u8f83\u5927\u7684\u503c\u3002\u4efb\u4f55 list\u3001set\u3001\u548c sorted set \u90fd\u53ef\u4ee5\u653e 232 \u4e2a\u5143\u7d20\u3002 \u6362\u53e5\u8bdd\u8bf4\uff0cRedis \u7684\u5b58\u50a8\u6781\u9650\u662f\u7cfb\u7edf\u4e2d\u7684\u53ef\u7528\u5185\u5b58\u503c\u3002 35\u3001MySQL \u91cc\u6709 2000w \u6570\u636e\uff0cRedis \u4e2d\u53ea\u5b58 20w \u7684\u6570\u636e\uff0c\u5982\u4f55\u4fdd\u8bc1 Redis \u4e2d\u7684\u6570\u636e\u90fd\u662f\u70ed\u70b9\u6570\u636e\uff1f Redis \u5185\u5b58\u6570\u636e\u96c6\u5927\u5c0f\u4e0a\u5347\u5230\u4e00\u5b9a\u5927\u5c0f\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u65bd\u884c\u6570\u636e\u6dd8\u6c70\u7b56\u7565\u3002 \u76f8\u5173\u77e5\u8bc6\uff1aRedis \u63d0\u4f9b 6 \u79cd\u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff1a volatile-lru \uff1a\u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\uff08 server.db[i].expires \uff09\u4e2d\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70 volatile-ttl \uff1a\u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\uff08 server.db[i].expires \uff09\u4e2d\u6311\u9009\u5c06\u8981\u8fc7\u671f\u7684\u6570\u636e\u6dd8\u6c70 volatile-random \uff1a\u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\uff08 server.db[i].expires \uff09\u4e2d\u4efb\u610f\u9009\u62e9\u6570\u636e\u6dd8\u6c70 allkeys-lru \uff1a\u4ece\u6570\u636e\u96c6\uff08 server.db[i].dict \uff09\u4e2d\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70 allkeys-random \uff1a\u4ece\u6570\u636e\u96c6\uff08 server.db[i].dict \uff09\u4e2d\u4efb\u610f\u9009\u62e9\u6570\u636e\u6dd8\u6c70 no-enviction \uff08\u9a71\u9010\uff09\uff1a\u7981\u6b62\u9a71\u9010\u6570\u636e 36\u3001Redis \u6700\u9002\u5408\u7684\u573a\u666f\uff1f \u4f1a\u8bdd\u7f13\u5b58\uff08Session Cache\uff09\uff0c\u6700\u5e38\u7528\u7684\u4e00\u79cd\u4f7f\u7528 Redis \u7684\u60c5\u666f\u662f\u4f1a\u8bdd\u7f13\u5b58\uff08session cache\uff09\u3002\u7528 Redis \u7f13\u5b58\u4f1a\u8bdd\u6bd4\u5176\u4ed6\u5b58\u50a8\uff08\u5982 Memcached\uff09\u7684\u4f18\u52bf\u5728\u4e8e\uff1aRedis \u63d0\u4f9b\u6301\u4e45\u5316\u3002\u5f53\u7ef4\u62a4\u4e00\u4e2a\u4e0d\u662f\u4e25\u683c\u8981\u6c42\u4e00\u81f4\u6027\u7684\u7f13\u5b58\u65f6\uff0c\u5982\u679c\u7528\u6237\u7684\u8d2d\u7269\u8f66\u4fe1\u606f\u5168\u90e8\u4e22\u5931\uff0c\u5927\u90e8\u5206\u4eba\u90fd\u4f1a\u4e0d\u9ad8\u5174\u7684\uff0c\u73b0\u5728\uff0c\u4ed6\u4eec\u8fd8\u4f1a\u8fd9\u6837\u5417\uff1f\u5e78\u8fd0\u7684\u662f\uff0c\u968f\u7740 Redis \u8fd9\u4e9b\u5e74\u7684\u6539\u8fdb\uff0c\u5f88\u5bb9\u6613\u627e\u5230\u600e\u4e48\u6070\u5f53\u7684\u4f7f\u7528 Redis \u6765\u7f13\u5b58\u4f1a\u8bdd\u7684\u6587\u6863\u3002\u751a\u81f3\u5e7f\u4e3a\u4eba\u77e5\u7684\u5546\u4e1a\u5e73\u53f0Magento \u4e5f\u63d0\u4f9b Redis \u7684\u63d2\u4ef6\u3002 \u5168\u9875\u7f13\u5b58\uff08FPC\uff09\uff0c\u9664\u57fa\u672c\u7684\u4f1a\u8bdd token \u4e4b\u5916\uff0cRedis \u8fd8\u63d0\u4f9b\u5f88\u7b80\u4fbf\u7684 FPC \u5e73\u53f0\u3002\u56de\u5230\u4e00\u81f4\u6027\u95ee\u9898\uff0c\u5373\u4f7f\u91cd\u542f\u4e86 Redis \u5b9e\u4f8b\uff0c\u56e0\u4e3a\u6709\u78c1\u76d8\u7684\u6301\u4e45\u5316\uff0c\u7528\u6237\u4e5f\u4e0d\u4f1a\u770b\u5230\u9875\u9762\u52a0\u8f7d\u901f\u5ea6\u7684\u4e0b\u964d\uff0c\u8fd9\u662f\u4e00\u4e2a\u6781\u5927\u6539\u8fdb\uff0c\u7c7b\u4f3c PHP \u672c\u5730 FPC\u3002\u518d\u6b21\u4ee5 Magento \u4e3a\u4f8b\uff0cMagento\u63d0\u4f9b\u4e00\u4e2a\u63d2\u4ef6\u6765\u4f7f\u7528 Redis \u4f5c\u4e3a\u5168\u9875\u7f13\u5b58\u540e\u7aef\u3002\u6b64\u5916\uff0c\u5bf9 WordPress \u7684\u7528\u6237\u6765\u8bf4\uff0cPantheon \u6709\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u63d2\u4ef6 wp-redis\uff0c\u8fd9\u4e2a\u63d2\u4ef6\u80fd\u5e2e\u52a9\u4f60\u4ee5\u6700\u5feb\u901f\u5ea6\u52a0\u8f7d\u4f60\u66fe\u6d4f\u89c8\u8fc7\u7684\u9875\u9762\u3002 \u961f\u5217\uff0cReids \u5728\u5185\u5b58\u5b58\u50a8\u5f15\u64ce\u9886\u57df\u7684\u4e00\u5927\u4f18\u70b9\u662f\u63d0\u4f9b list \u548c set \u64cd\u4f5c\uff0c\u8fd9\u4f7f\u5f97 Redis\u80fd\u4f5c\u4e3a\u4e00\u4e2a\u5f88\u597d\u7684\u6d88\u606f\u961f\u5217\u5e73\u53f0\u6765\u4f7f\u7528\u3002Redis \u4f5c\u4e3a\u961f\u5217\u4f7f\u7528\u7684\u64cd\u4f5c\uff0c\u5c31\u7c7b\u4f3c\u4e8e\u672c\u5730\u7a0b\u5e8f\u8bed\u8a00\uff08\u5982 Python\uff09\u5bf9 list \u7684 push/pop \u64cd\u4f5c\u3002\u5982\u679c\u4f60\u5feb\u901f\u5730\u5728 Google\u4e2d\u641c\u7d22\u201cRedis queues\u201d\uff0c\u4f60\u9a6c\u4e0a\u5c31\u80fd\u627e\u5230\u5927\u91cf\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u8fd9\u4e9b\u9879\u76ee\u7684\u76ee\u7684\u5c31\u662f\u5229\u7528 Redis \u521b\u5efa\u975e\u5e38\u597d\u7684\u540e\u7aef\u5de5\u5177\uff0c\u4ee5\u6ee1\u8db3\u5404\u79cd\u961f\u5217\u9700\u6c42\u3002\u4f8b\u5982\uff0cCelery \u6709\u4e00\u4e2a\u540e\u53f0\u5c31\u662f\u4f7f\u7528 Redis \u4f5c\u4e3a broker\uff0c\u4f60\u53ef\u4ee5\u4ece\u8fd9\u91cc\u53bb\u67e5\u770b\u3002 \u6392\u884c\u699c/\u8ba1\u6570\u5668\uff0cRedis \u5728\u5185\u5b58\u4e2d\u5bf9\u6570\u5b57\u8fdb\u884c\u9012\u589e\u6216\u9012\u51cf\u7684\u64cd\u4f5c\u5b9e\u73b0\u7684\u975e\u5e38\u597d\u3002\u96c6\u5408\uff08Set\uff09\u548c\u6709\u5e8f\u96c6\u5408\uff08Sorted Set\uff09\u4e5f\u4f7f\u5f97\u6211\u4eec\u5728\u6267\u884c\u8fd9\u4e9b\u64cd\u4f5c\u7684\u65f6\u5019\u53d8\u7684\u975e\u5e38\u7b80\u5355\uff0cRedis \u53ea\u662f\u6b63\u597d\u63d0\u4f9b\u4e86\u8fd9\u4e24\u79cd\u6570\u636e\u7ed3\u6784\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u4ece\u6392\u5e8f\u96c6\u5408\u4e2d\u83b7\u53d6\u5230\u6392\u540d\u6700\u9760\u524d\u7684 10 \u4e2a\u7528\u6237\u2014\u2014\u6211\u4eec\u79f0\u4e4b\u4e3a\u201cuser_scores\u201d\uff0c\u6211\u4eec\u53ea\u9700\u8981\u50cf\u4e0b\u9762\u4e00\u6837\u6267\u884c\u5373\u53ef\uff1a\u5f53\u7136\uff0c\u8fd9\u662f\u5047\u5b9a\u4f60\u662f\u6839\u636e\u4f60\u7528\u6237\u7684\u5206\u6570\u505a\u9012\u589e\u7684\u6392\u5e8f\u3002\u5982\u679c\u4f60\u60f3\u8fd4\u56de\u7528\u6237\u53ca\u7528\u6237\u7684\u5206\u6570\uff0c\u4f60\u9700\u8981\u8fd9\u6837\u6267\u884c\uff1aZRANGE user_scores 0 10 WITHSCORES Agora Games \u5c31\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u4f8b\u5b50\uff0c\u7528 Ruby \u5b9e\u73b0\u7684\uff0c\u5b83\u7684\u6392\u884c\u699c\u5c31\u662f\u4f7f\u7528 Redis \u6765\u5b58\u50a8\u6570\u636e\u7684\uff0c\u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u770b\u5230\u3002 \u53d1\u5e03/\u8ba2\u9605\uff0c\u6700\u540e\uff08\u4f46\u80af\u5b9a\u4e0d\u662f\u6700\u4e0d\u91cd\u8981\u7684\uff09\u662f Redis \u7684\u53d1\u5e03/\u8ba2\u9605\u529f\u80fd\u3002\u53d1\u5e03/\u8ba2\u9605\u7684\u4f7f\u7528\u573a\u666f\u786e\u5b9e\u975e\u5e38\u591a\u3002\u6211\u5df2\u770b\u89c1\u4eba\u4eec\u5728\u793e\u4ea4\u7f51\u7edc\u8fde\u63a5\u4e2d\u4f7f\u7528\uff0c\u8fd8\u53ef\u4f5c\u4e3a\u57fa\u4e8e\u53d1\u5e03/\u8ba2\u9605\u7684\u811a\u672c\u89e6\u53d1\u5668\uff0c\u751a\u81f3\u7528 Redis \u7684\u53d1\u5e03/\u8ba2\u9605\u529f\u80fd\u6765\u5efa\u7acb\u804a\u5929\u7cfb\u7edf\uff01 37\u3001\u5047\u5982 Redis \u91cc\u9762\u6709 1 \u4ebf\u4e2a key\uff0c\u5176\u4e2d\u6709 10w \u4e2a key \u662f\u4ee5\u67d0\u4e2a\u56fa\u5b9a\u7684\u5df2\u77e5\u7684\u524d\u7f00\u5f00\u5934\u7684\uff0c\u5982\u679c\u5c06\u5b83\u4eec\u5168\u90e8\u627e\u51fa\u6765\uff1f \u4f7f\u7528 keys \u6307\u4ee4\u53ef\u4ee5\u626b\u51fa\u6307\u5b9a\u6a21\u5f0f\u7684 key \u5217\u8868\u3002 \u5bf9\u65b9\u63a5\u7740\u8ffd\u95ee\uff1a\u5982\u679c\u8fd9\u4e2a Redis \u6b63\u5728\u7ed9\u7ebf\u4e0a\u7684\u4e1a\u52a1\u63d0\u4f9b\u670d\u52a1\uff0c\u90a3\u4f7f\u7528 keys \u6307\u4ee4\u4f1a\u6709\u4ec0\u4e48\u95ee\u9898\uff1f \u8fd9\u4e2a\u65f6\u5019\u4f60\u8981\u56de\u7b54 Redis \u5173\u952e\u7684\u4e00\u4e2a\u7279\u6027\uff1aRedis \u7684\u5355\u7ebf\u7a0b\u7684\u3002 keys \u6307\u4ee4\u4f1a\u5bfc\u81f4\u7ebf\u7a0b\u963b\u585e\u4e00\u6bb5\u65f6\u95f4\uff0c\u7ebf\u4e0a\u670d\u52a1\u4f1a\u505c\u987f\uff0c\u76f4\u5230\u6307\u4ee4\u6267\u884c\u5b8c\u6bd5\uff0c\u670d\u52a1\u624d\u80fd\u6062\u590d\u3002 \u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u4f7f\u7528 scan \u6307\u4ee4\uff0cscan \u6307\u4ee4\u53ef\u4ee5\u65e0\u963b\u585e\u5730\u63d0\u53d6\u51fa\u6307\u5b9a\u6a21\u5f0f\u7684 key \u5217\u8868\uff0c\u4f46\u662f\u4f1a\u6709\u4e00\u5b9a\u7684\u91cd\u590d\u6982\u7387\uff0c\u5728\u5ba2\u6237\u7aef\u505a\u4e00\u6b21\u53bb\u91cd\u5c31\u53ef\u4ee5\u4e86\uff0c\u4f46\u662f\u6574\u4f53\u6240\u82b1\u8d39\u7684\u65f6\u95f4\u4f1a\u6bd4\u76f4\u63a5\u7528 keys \u6307\u4ee4\u957f\u3002 38\u3001\u5982\u679c\u6709\u5927\u91cf\u7684 key \u9700\u8981\u8bbe\u7f6e\u540c\u4e00\u65f6\u95f4\u8fc7\u671f\uff0c\u4e00\u822c\u9700\u8981\u6ce8\u610f\u4ec0\u4e48\uff1f \u5982\u679c\u5927\u91cf\u7684 key \u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u7684\u8fc7\u4e8e\u96c6\u4e2d\uff0c\u5230\u8fc7\u671f\u7684\u90a3\u4e2a\u65f6\u95f4\u70b9\uff0cRedis \u53ef\u80fd\u4f1a\u51fa\u73b0\u77ed\u6682\u7684\u5361\u987f\u73b0\u8c61\u3002\u4e00\u822c\u9700\u8981\u5728\u65f6\u95f4\u4e0a\u52a0\u4e00\u4e2a\u968f\u673a\u503c\uff0c\u4f7f\u5f97\u8fc7\u671f\u65f6\u95f4\u5206\u6563\u4e00\u4e9b\u3002 39\u3001\u4f7f\u7528\u8fc7 Redis \u505a\u5f02\u6b65\u961f\u5217\u4e48\uff0c\u4f60\u662f\u600e\u4e48\u7528\u7684\uff1f \u7b54\uff1a\u4e00\u822c\u4f7f\u7528 list \u7ed3\u6784\u4f5c\u4e3a\u961f\u5217\uff0crpush \u751f\u4ea7\u6d88\u606f\uff0clpop \u6d88\u8d39\u6d88\u606f\u3002 \u5f53 lpop \u6ca1\u6709\u6d88\u606f\u7684\u65f6\u5019\uff0c\u8981\u9002\u5f53 sleep \u4e00\u4f1a\u518d\u91cd\u8bd5 \u3002 \u5982\u679c\u5bf9\u65b9\u8ffd\u95ee\u53ef\u4e0d\u53ef\u4ee5\u4e0d\u7528 sleep \u5462\uff1f list \u8fd8\u6709\u4e2a\u6307\u4ee4\u53eb blpop\uff0c\u5728\u6ca1\u6709\u6d88\u606f\u7684\u65f6\u5019\uff0c\u5b83\u4f1a\u963b\u585e\u4f4f\u76f4\u5230\u6d88\u606f\u5230\u6765\u3002\u5982\u679c\u5bf9\u65b9\u8ffd\u95ee\u80fd\u4e0d\u80fd\u751f\u4ea7\u4e00\u6b21\u6d88\u8d39\u591a\u6b21\u5462\uff1f\u4f7f\u7528 pub/sub \u4e3b\u9898\u8ba2\u9605\u8005\u6a21\u5f0f\uff0c\u53ef\u4ee5\u5b9e\u73b0 1:N \u7684\u6d88\u606f\u961f\u5217\u3002 \u5982\u679c\u5bf9\u65b9\u8ffd\u95ee pub/sub \u6709\u4ec0\u4e48\u7f3a\u70b9\uff1f \u5728\u6d88\u8d39\u8005\u4e0b\u7ebf\u7684\u60c5\u51b5\u4e0b\uff0c\u751f\u4ea7\u7684\u6d88\u606f\u4f1a\u4e22\u5931\uff0c\u5f97\u4f7f\u7528\u4e13\u4e1a\u7684\u6d88\u606f\u961f\u5217\u5982 RabbitMQ\u7b49\u3002 \u5982\u679c\u5bf9\u65b9\u8ffd\u95ee Redis \u5982\u4f55\u5b9e\u73b0\u5ef6\u65f6\u961f\u5217\uff1f \u4f7f\u7528 sortedset\uff0c\u62ff\u65f6\u95f4\u6233\u4f5c\u4e3ascore\uff0c\u6d88\u606f\u5185\u5bb9\u4f5c\u4e3a key \u8c03\u7528 zadd \u6765\u751f\u4ea7\u6d88\u606f\uff0c\u6d88\u8d39\u8005\u7528 zrangebyscore \u6307\u4ee4\u83b7\u53d6 N \u79d2\u4e4b\u524d\u7684\u6570\u636e\u8f6e\u8be2\u8fdb\u884c\u5904\u7406\u3002 40\u3001\u4f7f\u7528\u8fc7 Redis \u5206\u5e03\u5f0f\u9501\u4e48\uff0c\u5b83\u662f\u4ec0\u4e48\u56de\u4e8b\uff1f \u5148\u62ff setnx \u6765\u4e89\u62a2\u9501\uff0c\u62a2\u5230\u4e4b\u540e\uff0c\u518d\u7528 expire \u7ed9\u9501\u52a0\u4e00\u4e2a\u8fc7\u671f\u65f6\u95f4\u9632\u6b62\u9501\u5fd8\u8bb0\u4e86\u91ca\u653e\u3002","title":"40 \u9053Redis\u9762\u8bd5\u9898"},{"location":"chap10/2Redis_interview/#40-redis","text":"","title":"40 \u9053Redis\u9762\u8bd5\u9898"},{"location":"chap10/2Redis_interview/#1-redis","text":"Redis \u662f\u5b8c\u5168\u5f00\u6e90\u514d\u8d39\u7684\uff0c\u9075\u5b88 BSD \u534f\u8bae\uff0c\u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684 key-value \u6570\u636e\u5e93\u3002 Redis \u4e0e\u5176\u4ed6 key - value \u7f13\u5b58\u4ea7\u54c1\u76f8\u6bd4\u6709\u4ee5\u4e0b\u4e09\u4e2a\u7279\u70b9\uff1a Redis \u652f\u6301\u6570\u636e\u7684\u6301\u4e45\u5316\uff0c\u53ef\u4ee5\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u4fdd\u5b58\u5728\u78c1\u76d8\u4e2d\uff0c\u91cd\u542f\u7684\u65f6\u5019\u53ef\u4ee5\u518d\u6b21\u52a0\u8f7d\u8fdb\u884c\u4f7f\u7528 \u3002 Redis \u4e0d\u4ec5\u4ec5\u652f\u6301\u7b80\u5355\u7684 key-value \u7c7b\u578b\u7684\u6570\u636e\uff0c \u540c\u65f6\u8fd8\u63d0\u4f9b list\uff0cset\uff0czset\uff0chash \u7b49\u6570\u636e\u7ed3\u6784\u7684\u5b58\u50a8\u3002 Redis \u652f\u6301\u6570\u636e\u7684\u5907\u4efd\uff0c\u5373 master-slave \u6a21\u5f0f\u7684\u6570\u636e\u5907\u4efd\u3002 Redis \u4f18\u52bf\uff1a \u6027\u80fd\u6781\u9ad8\uff1aRedis \u80fd\u8bfb\u7684\u901f\u5ea6\u662f 110000 \u6b21/s\uff0c\u5199\u7684\u901f\u5ea6\u662f 81000 \u6b21/s\u3002 \u4e30\u5bcc\u7684\u6570\u636e\u7c7b\u578b\uff1aRedis \u652f\u6301\u4e8c\u8fdb\u5236\u6848\u4f8b\u7684 Strings\uff0cLists\uff0cHashes\uff0cSets \u53ca Ordered Sets \u6570\u636e\u7c7b\u578b\u64cd\u4f5c\u3002 \u539f\u5b50\uff1aRedis \u7684\u6240\u6709\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u6027\u7684\uff0c\u610f\u601d\u5c31\u662f\u8981\u4e48\u6210\u529f\u6267\u884c\u8981\u4e48\u5931\u8d25\u5b8c\u5168\u4e0d\u6267\u884c\u3002\u5355\u4e2a\u64cd\u4f5c\u662f\u539f\u5b50\u6027\u7684\u3002\u591a\u4e2a\u64cd\u4f5c\u4e5f\u652f\u6301\u4e8b\u52a1\uff0c\u5373\u539f\u5b50\u6027\uff0c\u901a\u8fc7 MULTI \u548c EXEC \u6307\u4ee4\u5305\u8d77\u6765 \u4e30\u5bcc\u7684\u7279\u6027\uff1aRedis \u8fd8\u652f\u6301 publish/subscribe\uff0c\u901a\u77e5\uff0ckey \u8fc7\u671f\u7b49\u7b49\u7279\u6027\u3002 Redis \u4e0e\u5176\u4ed6 key-value \u5b58\u50a8\u6709\u4ec0\u4e48\u4e0d\u540c\uff1f Redis \u6709\u7740\u66f4\u4e3a\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784\u5e76\u4e14\u63d0\u4f9b\u5bf9\u4ed6\u4eec\u7684\u539f\u5b50\u6027\u64cd\u4f5c\uff0c\u8fd9\u662f\u4e00\u4e2a\u4e0d\u540c\u4e8e\u5176\u4ed6\u6570\u636e\u5e93\u7684\u8fdb\u5316\u8def\u5f84\u3002 Redis \u7684\u6570\u636e\u7c7b\u578b\u90fd\u662f\u57fa\u4e8e\u57fa\u672c\u6570\u636e\u7ed3\u6784\u7684\u540c\u65f6\u5bf9\u7a0b\u5e8f\u5458\u900f\u660e\uff0c\u65e0\u9700\u8fdb\u884c\u989d\u5916\u7684\u62bd\u8c61\u3002 Redis \u8fd0\u884c\u5728\u5185\u5b58\u4e2d\u4f46\u662f\u53ef\u4ee5\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u6240\u4ee5\u5728\u5bf9\u4e0d\u540c\u6570\u636e\u96c6\u8fdb\u884c\u9ad8\u901f\u8bfb\u5199\u65f6\u9700\u8981\u6743\u8861\u5185\u5b58\uff0c\u56e0\u4e3a\u6570\u636e\u91cf\u4e0d\u80fd\u5927\u4e8e\u786c\u4ef6\u5185\u5b58\u3002 \u5728\u5185\u5b58\u6570\u636e\u5e93\u65b9\u9762\u7684\u53e6\u4e00\u4e2a\u4f18\u70b9\u662f\uff0c \u76f8\u6bd4\u5728\u78c1\u76d8\u4e0a\u76f8\u540c\u7684\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5728\u5185\u5b58\u4e2d\u64cd\u4f5c\u8d77\u6765\u975e\u5e38\u7b80\u5355\uff0c\u8fd9\u6837 Redis \u53ef\u4ee5\u505a\u5f88\u591a\u5185\u90e8\u590d\u6742\u6027\u5f88\u5f3a\u7684\u4e8b\u60c5 \u3002\u540c\u65f6\uff0c\u5728\u78c1\u76d8\u683c\u5f0f\u65b9\u9762\u4ed6\u4eec\u662f\u7d27\u51d1\u7684\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u4ea7\u751f\u7684\uff0c\u56e0\u4e3a\u4ed6\u4eec\u5e76\u4e0d\u9700\u8981\u8fdb\u884c\u968f\u673a\u8bbf\u95ee\u3002","title":"1\u3001\u4ec0\u4e48\u662f Redis\uff1f"},{"location":"chap10/2Redis_interview/#2redis","text":"Redis \u652f\u6301\u4e94\u79cd\u6570\u636e\u7c7b\u578b\uff1astring\uff08\u5b57\u7b26\u4e32\uff09\uff0chash\uff08\u54c8\u5e0c\uff09\uff0clist\uff08\u5217\u8868\uff09\uff0cset\uff08\u96c6\u5408\uff09\u53ca zsetsorted set\uff08\u6709\u5e8f\u96c6\u5408\uff09\u3002 \u6211\u4eec\u5b9e\u9645\u9879\u76ee\u4e2d\u6bd4\u8f83\u5e38\u7528\u7684\u662f string\uff0chash \u5982\u679c\u4f60\u662f Redis \u4e2d\u9ad8\u7ea7\u7528\u6237\uff0c\u8fd8\u9700\u8981\u52a0\u4e0a\u4e0b\u9762\u51e0\u79cd\u6570\u636e\u7ed3\u6784 HyperLogLog\u3001Geo\u3001Pub/Sub\u3002 \u5982\u679c\u4f60\u8bf4\u8fd8\u73a9\u8fc7 Redis Module\uff0c\u50cf BloomFilter\uff0cRedisSearch\uff0cRedis-ML\uff0c","title":"2\u3001Redis \u7684\u6570\u636e\u7c7b\u578b\uff1f"},{"location":"chap10/2Redis_interview/#3-redis","text":"\u901f\u5ea6\u5feb\uff0c\u56e0\u4e3a\u6570\u636e\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u7c7b\u4f3c\u4e8e HashMap\uff0cHashMap \u7684\u4f18\u52bf\u5c31\u662f\u67e5\u627e\u548c\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u662f O(1) \u652f\u6301\u4e30\u5bcc\u6570\u636e\u7c7b\u578b\uff0c\u652f\u6301 string\uff0clist\uff0cset\uff0cZset\uff0chash \u7b49 \u652f\u6301\u4e8b\u52a1\uff0c\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u6027\uff0c\u6240\u8c13\u7684\u539f\u5b50\u6027\u5c31\u662f\u5bf9\u6570\u636e\u7684\u66f4\u6539\u8981\u4e48\u5168\u90e8\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u6267\u884c \u4e30\u5bcc\u7684\u7279\u6027\uff0c\u53ef\u7528\u4e8e\u7f13\u5b58\uff0c\u6d88\u606f\uff0c\u6309 key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u8fc7\u671f\u540e\u5c06\u4f1a\u81ea\u52a8\u5220\u9664","title":"3\u3001\u4f7f\u7528 Redis \u6709\u54ea\u4e9b\u597d\u5904\uff1f"},{"location":"chap10/2Redis_interview/#4redis-memcached","text":"Memcached \u6240\u6709\u7684\u503c\u5747\u662f\u7b80\u5355\u7684\u5b57\u7b26\u4e32\uff0cRedis \u4f5c\u4e3a\u5176\u66ff\u4ee3\u8005\uff0c\u652f\u6301\u66f4\u4e3a\u4e30\u5bcc\u7684\u6570\u636e\u7c7b Redis \u7684\u901f\u5ea6\u6bd4 Memcached \u5feb\u5f88\u591a Redis \u53ef\u4ee5\u6301\u4e45\u5316\u5176\u6570\u636e","title":"4\u3001Redis \u76f8\u6bd4 Memcached \u6709\u54ea\u4e9b\u4f18\u52bf\uff1f"},{"location":"chap10/2Redis_interview/#5memcache-redis","text":"\u5b58\u50a8\u65b9\u5f0f Memecache \u628a\u6570\u636e\u5168\u90e8\u5b58\u5728\u5185\u5b58\u4e4b\u4e2d\uff0c\u65ad\u7535\u540e\u4f1a\u6302\u6389\uff0c\u6570\u636e\u4e0d\u80fd\u8d85\u8fc7\u5185\u5b58\u5927\u5c0f\u3002Redis \u6709\u90e8\u5206\u5b58\u5728\u786c\u76d8\u4e0a\uff0c\u8fd9\u6837\u80fd\u4fdd\u8bc1\u6570\u636e\u7684\u6301\u4e45\u6027\u3002 \u6570\u636e\u652f\u6301\u7c7b\u578b Memcache \u5bf9\u6570\u636e\u7c7b\u578b\u652f\u6301\u76f8\u5bf9\u7b80\u5355\u3002Redis \u6709\u590d\u6742\u7684\u6570\u636e\u7c7b\u578b\u3002 \u4f7f\u7528\u5e95\u5c42\u6a21\u578b\u4e0d\u540c \u5b83\u4eec\u4e4b\u95f4\u5e95\u5c42\u5b9e\u73b0\u65b9\u5f0f \u4ee5\u53ca\u4e0e\u5ba2\u6237\u7aef\u4e4b\u95f4\u901a\u4fe1\u7684\u5e94\u7528\u534f\u8bae\u4e0d\u4e00\u6837\u3002Redis \u76f4\u63a5\u81ea\u5df1\u6784\u5efa\u4e86 VM \u673a\u5236 \uff0c\u56e0\u4e3a\u4e00\u822c\u7684\u7cfb\u7edf\u8c03\u7528\u7cfb\u7edf\u51fd\u6570\u7684\u8bdd\uff0c\u4f1a\u6d6a\u8d39\u4e00\u5b9a\u7684\u65f6\u95f4\u53bb\u79fb\u52a8\u548c\u8bf7\u6c42\u3002","title":"5\u3001Memcache \u4e0e Redis \u7684\u533a\u522b\u90fd\u6709\u54ea\u4e9b\uff1f"},{"location":"chap10/2Redis_interview/#6redis","text":"Redis \u662f\u5355\u8fdb\u7a0b\u5355\u7ebf\u7a0b\u7684\uff0cRedis \u5229\u7528\u961f\u5217\u6280\u672f\u5c06\u5e76\u53d1\u8bbf\u95ee\u53d8\u4e3a\u4e32\u884c\u8bbf\u95ee\uff0c\u6d88\u9664\u4e86\u4f20\u7edf\u6570\u636e\u5e93\u4e32\u884c\u63a7\u5236\u7684\u5f00\u9500\u3002","title":"6\u3001Redis \u662f\u5355\u8fdb\u7a0b\u5355\u7ebf\u7a0b\u7684\uff1f"},{"location":"chap10/2Redis_interview/#7","text":"512M","title":"7\u3001\u4e00\u4e2a\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u667a\u80fd\u5b58\u50a8\u6700\u5927\u5bb9\u91cf\u662f\u591a\u5c11\uff1f"},{"location":"chap10/2Redis_interview/#8redis","text":"Redis\u63d0\u4f9b\u4e24\u79cd\u6301\u4e45\u5316\u673a\u5236 RDB \u548c AOF \u673a\u5236\uff1a RDB\uff08Redis DataBase\uff09\u6301\u4e45\u5316\u65b9\u5f0f\uff1a \u662f\u6307\u7528\u6570\u636e\u96c6\u5feb\u7167\u7684\u65b9\u5f0f\u534a\u6301\u4e45\u5316\u6a21\u5f0f\u8bb0\u5f55 Redis \u6570\u636e\u5e93\u7684\u6240\u6709\u952e\u503c\u5bf9\uff0c\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\u5c06\u6570\u636e\u5199\u5165\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6\uff0c\u6301\u4e45\u5316\u7ed3\u675f\u540e\uff0c\u7528\u8fd9\u4e2a\u4e34\u65f6\u6587\u4ef6\u66ff\u6362\u4e0a\u6b21\u6301\u4e45\u5316\u7684\u6587\u4ef6\uff0c\u8fbe\u5230\u6570\u636e\u6062\u590d\u3002","title":"8\u3001Redis \u7684\u6301\u4e45\u5316\u673a\u5236\u662f\u4ec0\u4e48\uff1f\u5404\u81ea\u7684\u4f18\u7f3a\u70b9\uff1f"},{"location":"chap10/2Redis_interview/#rdb","text":"\u53ea\u6709\u4e00\u4e2a\u6587\u4ef6 dump.rdb \uff0c\u65b9\u4fbf\u6301\u4e45\u5316\u3002 \u5bb9\u707e\u6027\u597d\uff0c\u4e00\u4e2a\u6587\u4ef6\u53ef\u4ee5\u4fdd\u5b58\u5230\u5b89\u5168\u7684\u78c1\u76d8\u3002 \u6027\u80fd\u6700\u5927\u5316\uff0cfork \u5b50\u8fdb\u7a0b\u6765\u5b8c\u6210\u5199\u64cd\u4f5c\uff0c\u8ba9\u4e3b\u8fdb\u7a0b\u7ee7\u7eed\u5904\u7406\u547d\u4ee4\uff0c\u6240\u4ee5\u662f IO \u6700\u5927\u5316\u3002\u4f7f\u7528\u5355\u72ec\u5b50\u8fdb\u7a0b\u6765\u8fdb\u884c\u6301\u4e45\u5316\uff0c\u4e3b\u8fdb\u7a0b\u4e0d\u4f1a\u8fdb\u884c\u4efb\u4f55 IO \u64cd\u4f5c\uff0c\u4fdd\u8bc1\u4e86 Redis\u7684\u9ad8\u6027\u80fd\u3002 \u76f8\u5bf9\u4e8e\u6570\u636e\u96c6\u5927\u65f6\uff0c\u6bd4 AOF \u7684\u542f\u52a8\u6548\u7387\u66f4\u9ad8\u3002","title":"RDB\u4f18\u70b9"},{"location":"chap10/2Redis_interview/#rdb_1","text":"\u6570\u636e\u5b89\u5168\u6027\u4f4e\u3002RDB \u662f\u95f4\u9694\u4e00\u6bb5\u65f6\u95f4\u8fdb\u884c\u6301\u4e45\u5316\uff0c\u5982\u679c\u6301\u4e45\u5316\u4e4b\u95f4 Redis \u53d1\u751f\u6545\u969c\uff0c\u4f1a\u53d1\u751f\u6570\u636e\u4e22\u5931\u3002\u6240\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u66f4\u9002\u5408\u6570\u636e\u8981\u6c42\u4e0d\u4e25\u8c28\u7684\u65f6\u5019 AOF\uff08Append-only file\uff09\u6301\u4e45\u5316\u65b9\u5f0f\uff1a\u662f\u6307\u6240\u6709\u7684\u547d\u4ee4\u884c\u8bb0\u5f55\u4ee5 Redis \u547d\u4ee4\u8bf7\u6c42\u534f\u8bae\u7684\u683c\u5f0f\u5b8c\u5168\u6301\u4e45\u5316\u5b58\u50a8\u4fdd\u5b58\u4e3a aof \u6587\u4ef6\u3002","title":"RDB\u7f3a\u70b9\uff1a"},{"location":"chap10/2Redis_interview/#aof","text":"\u6570\u636e\u5b89\u5168\uff0caof \u6301\u4e45\u5316\u53ef\u4ee5\u914d\u7f6e appendfsync \u5c5e\u6027\uff0c\u6709 always\uff0c\u6bcf\u8fdb\u884c\u4e00\u6b21\u547d\u4ee4\u64cd\u4f5c\u5c31\u8bb0\u5f55\u5230 aof \u6587\u4ef6\u4e2d\u4e00\u6b21\u3002 \u901a\u8fc7 append \u6a21\u5f0f\u5199\u6587\u4ef6\uff0c\u5373\u4f7f\u4e2d\u9014\u670d\u52a1\u5668\u5b95\u673a\uff0c\u53ef\u4ee5\u901a\u8fc7 redis-check-aof \u5de5\u5177\u89e3\u51b3\u6570\u636e\u4e00\u81f4\u6027\u95ee\u9898 \u3002 AOF \u673a\u5236\u7684 rewrite \u6a21\u5f0f\u3002AOF \u6587\u4ef6\u6ca1\u88ab rewrite \u4e4b\u524d\uff08\u6587\u4ef6\u8fc7\u5927\u65f6\u4f1a\u5bf9\u547d\u4ee4\u8fdb\u884c\u5408\u5e76\u91cd\u5199\uff09\uff0c\u53ef\u4ee5\u5220\u9664\u5176\u4e2d\u7684\u67d0\u4e9b\u547d\u4ee4\uff08\u6bd4\u5982\u8bef\u64cd\u4f5c\u7684 flushall\uff09","title":"AOF\u4f18\u70b9"},{"location":"chap10/2Redis_interview/#aof_1","text":"AOF \u6587\u4ef6\u6bd4 RDB \u6587\u4ef6\u5927\uff0c\u4e14\u6062\u590d\u901f\u5ea6\u6162\u3002 \u6570\u636e\u96c6\u5927\u7684\u65f6\u5019\uff0c\u6bd4 RDB \u542f\u52a8\u6548\u7387\u4f4e\u3002","title":"AOF\u7f3a\u70b9\uff1a"},{"location":"chap10/2Redis_interview/#9redis","text":"Master \u6700\u597d\u4e0d\u8981\u5199\u5185\u5b58\u5feb\u7167\uff0c \u5982\u679c Master \u5199\u5185\u5b58\u5feb\u7167\uff0csave \u547d\u4ee4\u8c03\u5ea6 rdbSave\u51fd\u6570\uff0c\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u7684\u5de5\u4f5c\uff0c\u5f53\u5feb\u7167\u6bd4\u8f83\u5927\u65f6\u5bf9\u6027\u80fd\u5f71\u54cd\u662f\u975e\u5e38\u5927\u7684\uff0c\u4f1a\u95f4\u65ad\u6027\u6682\u505c\u670d\u52a1 \u3002 \u5982\u679c\u6570\u636e\u6bd4\u8f83\u91cd\u8981\uff0c\u67d0\u4e2a Slave \u5f00\u542f AOF \u5907\u4efd\u6570\u636e\uff0c\u7b56\u7565\u8bbe\u7f6e\u4e3a\u6bcf\u79d2\u540c\u6b65\u4e00(Everysec)\u3002 \u4e3a\u4e86\u4e3b\u4ece\u590d\u5236\u7684\u901f\u5ea6\u548c\u8fde\u63a5\u7684\u7a33\u5b9a\u6027\uff0cMaster \u548c Slave \u6700\u597d\u5728\u540c\u4e00\u4e2a\u5c40\u57df\u7f51\u3002 \u5c3d\u91cf\u907f\u514d\u5728\u538b\u529b\u5f88\u5927\u7684\u4e3b\u5e93\u4e0a\u589e\u52a0\u4ece\u3002 \u4e3b\u4ece\u590d\u5236\u4e0d\u8981\u7528\u56fe\u72b6\u7ed3\u6784\uff0c\u7528\u5355\u5411\u94fe\u8868\u7ed3\u6784\u66f4\u4e3a\u7a33\u5b9a \uff0c\u5373\uff1a Master <- Slave1<- Slave2 <- Slave3\u2026\u2026 \u8fd9\u6837\u7684\u7ed3\u6784\u65b9\u4fbf\u89e3\u51b3\u5355\u70b9\u6545\u969c\u95ee\u9898\uff0c\u5b9e\u73b0 Slave \u5bf9 Master \u7684\u66ff\u6362\u3002\u5982\u679c Master \u6302\u4e86\uff0c\u53ef\u4ee5\u7acb\u523b\u542f\u7528 Slave1 \u505a Master\uff0c\u5176\u4ed6\u4e0d\u53d8\u3002","title":"9\u3001Redis \u5e38\u89c1\u6027\u80fd\u95ee\u9898\u548c\u89e3\u51b3\u65b9\u6848"},{"location":"chap10/2Redis_interview/#10redis","text":"\u5b9a\u65f6\u5220\u9664\uff1a\u5728\u8bbe\u7f6e\u952e\u7684\u8fc7\u671f\u65f6\u95f4\u7684\u540c\u65f6\uff0c\u521b\u5efa\u4e00\u4e2a\u5b9a\u65f6\u5668 timer\u3002\u8ba9\u5b9a\u65f6\u5668\u5728\u952e\u7684\u8fc7\u671f\u65f6\u95f4\u6765\u4e34\u65f6\uff0c\u7acb\u5373\u6267\u884c\u5bf9\u952e\u7684\u5220\u9664\u64cd\u4f5c\u3002 \u60f0\u6027\u5220\u9664\uff1a\u653e\u4efb\u952e\u8fc7\u671f\u4e0d\u7ba1\uff0c\u4f46\u662f\u6bcf\u6b21\u4ece\u952e\u7a7a\u95f4\u4e2d\u83b7\u53d6\u952e\u65f6\uff0c\u90fd\u68c0\u67e5\u53d6\u5f97\u7684\u952e\u662f\u5426\u8fc7\u671f\uff0c\u5982\u679c\u8fc7\u671f\u7684\u8bdd\uff0c\u5c31\u5220\u9664\u8be5\u952e;\u5982\u679c\u6ca1\u6709\u8fc7\u671f\uff0c\u5c31\u8fd4\u56de\u8be5\u952e\u3002 \u5b9a\u671f\u5220\u9664\uff1a\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u7a0b\u5e8f\u5c31\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u4e00\u6b21\u68c0\u67e5\uff0c\u5220\u9664\u91cc\u9762\u7684\u8fc7\u671f\u952e\u3002\u81f3 \u4e8e\u8981\u5220\u9664\u591a\u5c11\u8fc7\u671f\u952e\uff0c\u4ee5\u53ca\u8981\u68c0\u67e5\u591a\u5c11\u4e2a\u6570\u636e\u5e93\uff0c\u5219\u7531\u7b97\u6cd5\u51b3\u5b9a\u3002","title":"10\u3001Redis \u8fc7\u671f\u952e\u7684\u5220\u9664\u7b56\u7565\uff1f"},{"location":"chap10/2Redis_interview/#11redis","text":"volatile-lru \uff1a\u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6 \uff08server.db[i].expires\uff09 \u4e2d\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70 volatile-ttl \uff1a\u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6 \uff08server.db[i].expires\uff09 \u4e2d\u6311\u9009\u5c06\u8981\u8fc7\u671f\u7684\u6570\u636e\u6dd8\u6c70 volatile-random \uff1a\u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6 \uff08server.db[i].expires\uff09 \u4e2d\u4efb\u610f\u9009\u62e9\u6570\u636e\u6dd8\u6c70 allkeys-lru \uff1a\u4ece\u6570\u636e\u96c6\uff08 server.db[i].dict \uff09\u4e2d\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70 allkeys-random \uff1a\u4ece\u6570\u636e\u96c6\uff08 server.db[i].dict \uff09\u4e2d\u4efb\u610f\u9009\u62e9\u6570\u636e\u6dd8\u6c70 no-enviction \uff08\u9a71\u9010\uff09\uff1a\u7981\u6b62\u9a71\u9010\u6570\u636e \u6ce8\u610f\u8fd9\u91cc\u7684 6 \u79cd\u673a\u5236\uff0c volatile \u548c allkeys \u89c4\u5b9a\u4e86\u662f\u5bf9\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u6dd8\u6c70\u6570\u636e\u8fd8\u662f\u4ece\u5168\u90e8\u6570\u636e\u96c6\u6dd8\u6c70\u6570\u636e\uff0c\u540e\u9762\u7684 lru \u3001 ttl \u4ee5\u53ca random \u662f\u4e09\u79cd\u4e0d\u540c\u7684\u6dd8\u6c70\u7b56\u7565\uff0c\u518d\u52a0\u4e0a\u4e00\u79cd no-enviction \u6c38\u4e0d\u56de\u6536\u7684\u7b56\u7565\u3002 \u4f7f\u7528\u7b56\u7565\u89c4\u5219\uff1a \u5982\u679c\u6570\u636e\u5448\u73b0\u5e42\u5f8b\u5206\u5e03\uff0c\u4e5f\u5c31\u662f\u4e00\u90e8\u5206\u6570\u636e\u8bbf\u95ee\u9891\u7387\u9ad8\uff0c\u4e00\u90e8\u5206\u6570\u636e\u8bbf\u95ee\u9891\u7387\u4f4e\uff0c\u5219\u4f7f\u7528 allkeys-lru \u5982\u679c\u6570\u636e\u5448\u73b0\u5e73\u7b49\u5206\u5e03\uff0c\u4e5f\u5c31\u662f\u6240\u6709\u7684\u6570\u636e\u8bbf\u95ee\u9891\u7387\u90fd\u76f8\u540c\uff0c\u5219\u4f7f\u7528 allkeys-random","title":"11\u3001Redis \u7684\u56de\u6536\u7b56\u7565\uff08\u6dd8\u6c70\u7b56\u7565\uff09\uff1f"},{"location":"chap10/2Redis_interview/#12-redis","text":"Redis \u4e3a\u4e86\u8fbe\u5230\u6700\u5feb\u7684\u8bfb\u5199\u901f\u5ea6\u5c06\u6570\u636e\u90fd\u8bfb\u5230\u5185\u5b58\u4e2d\uff0c\u5e76\u901a\u8fc7\u5f02\u6b65\u7684\u65b9\u5f0f\u5c06\u6570\u636e\u5199\u5165\u78c1\u76d8\u3002 \u6240\u4ee5 Redis \u5177\u6709\u5feb\u901f\u548c\u6570\u636e\u6301\u4e45\u5316\u7684\u7279\u5f81 \u3002\u5982\u679c\u4e0d\u5c06\u6570\u636e\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u78c1\u76d8 I/O \u901f\u5ea6\u4e3a\u4e25\u91cd\u5f71\u54cd Redis \u7684\u6027\u80fd\u3002\u5728\u5185\u5b58\u8d8a\u6765\u8d8a\u4fbf\u5b9c\u7684\u4eca\u5929\uff0cRedis \u5c06\u4f1a\u8d8a\u6765\u8d8a\u53d7\u6b22\u8fce\u3002 \u5982\u679c\u8bbe\u7f6e\u4e86\u6700\u5927\u4f7f\u7528\u7684\u5185\u5b58\uff0c\u5219\u6570\u636e\u5df2\u6709\u8bb0\u5f55\u6570\u8fbe\u5230\u5185\u5b58\u9650\u503c\u540e\u4e0d\u80fd\u7ee7\u7eed\u63d2\u5165\u65b0\u503c\u3002","title":"12\u3001\u4e3a\u4ec0\u4e48 Redis \u9700\u8981\u628a\u6240\u6709\u6570\u636e\u653e\u5230\u5185\u5b58\u4e2d\uff1f"},{"location":"chap10/2Redis_interview/#13redis","text":"Redis \u53ef\u4ee5\u4f7f\u7528\u4e3b\u4ece\u540c\u6b65\uff0c\u4ece\u4ece\u540c\u6b65\u3002 \u7b2c\u4e00\u6b21\u540c\u6b65\u65f6\uff0c\u4e3b\u8282\u70b9\u505a\u4e00\u6b21 bgsave \uff0c\u5e76\u540c\u65f6\u5c06\u540e\u7eed\u4fee\u6539\u64cd\u4f5c\u8bb0\u5f55\u5230\u5185\u5b58 buffer \uff0c\u5f85\u5b8c\u6210\u540e\u5c06 rdb \u6587\u4ef6\u5168\u91cf\u540c\u6b65\u5230\u590d\u5236\u8282\u70b9\uff0c\u590d\u5236\u8282\u70b9\u63a5\u6536\u5b8c\u6210\u540e\u5c06 rdb \u955c\u50cf\u52a0\u8f7d\u5230\u5185\u5b58\u3002 \u52a0\u8f7d\u5b8c\u6210\u540e\uff0c\u518d\u901a\u77e5\u4e3b\u8282\u70b9\u5c06\u671f\u95f4\u4fee\u6539\u7684\u64cd\u4f5c\u8bb0\u5f55\u540c\u6b65\u5230\u590d\u5236\u8282\u70b9\u8fdb\u884c\u91cd\u653e\u5c31\u5b8c\u6210\u4e86\u540c\u6b65\u8fc7\u7a0b \u3002","title":"13\u3001Redis \u7684\u540c\u6b65\u673a\u5236\u4e86\u89e3\u4e48\uff1f"},{"location":"chap10/2Redis_interview/#14pipeline-pipeline","text":"\u53ef\u4ee5\u5c06\u591a\u6b21 IO \u5f80\u8fd4\u7684\u65f6\u95f4\u7f29\u51cf\u4e3a\u4e00\u6b21\uff0c\u524d\u63d0\u662f Pipeline \u6267\u884c\u7684\u6307\u4ee4\u4e4b\u95f4\u6ca1\u6709\u56e0\u679c\u76f8\u5173\u6027\u3002 \u4f7f\u7528 redis-benchmark \u8fdb\u884c\u538b\u6d4b\u7684\u65f6\u5019\u53ef\u4ee5\u53d1\u73b0\u5f71\u54cd Redis \u7684 QPS \u5cf0\u503c\u7684\u4e00\u4e2a\u91cd\u8981\u56e0\u7d20\u662f Pipeline \u6279\u6b21\u6307\u4ee4\u7684\u6570\u76ee\u3002","title":"14\u3001Pipeline \u6709\u4ec0\u4e48\u597d\u5904\uff0c\u4e3a\u4ec0\u4e48\u8981\u7528 Pipeline\uff1f"},{"location":"chap10/2Redis_interview/#15-redis","text":"Redis Sentinal \u7740\u773c\u4e8e\u9ad8\u53ef\u7528\uff0c\u5728 Master \u5b95\u673a\u65f6\u4f1a\u81ea\u52a8\u5c06 slave \u63d0\u5347\u4e3amaster\uff0c\u7ee7\u7eed\u63d0\u4f9b\u670d\u52a1\u3002 Redis Cluster \u7740\u773c\u4e8e\u6269\u5c55\u6027\uff0c\u5728\u5355\u4e2a Redis \u5185\u5b58\u4e0d\u8db3\u65f6\uff0c\u4f7f\u7528 Cluster \u8fdb\u884c\u5206\u7247\u5b58\u50a8\u3002","title":"15\u3001\u662f\u5426\u4f7f\u7528\u8fc7 Redis \u96c6\u7fa4\uff0c\u96c6\u7fa4\u7684\u539f\u7406\u662f\u4ec0\u4e48\uff1f"},{"location":"chap10/2Redis_interview/#16redis","text":"\u6709 A\uff0cB\uff0cC \u4e09\u4e2a\u8282\u70b9\u7684\u96c6\u7fa4\uff0c\u5728\u6ca1\u6709\u590d\u5236\u6a21\u578b\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u8282\u70b9 B \u5931\u8d25\u4e86\uff0c\u90a3\u4e48\u6574\u4e2a\u96c6\u7fa4\u5c31\u4f1a\u4ee5\u4e3a\u7f3a\u5c11 5501-11000 \u8fd9\u4e2a\u8303\u56f4\u7684\u69fd\u800c\u4e0d\u53ef\u7528\u3002","title":"16\u3001Redis \u96c6\u7fa4\u65b9\u6848\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u5bfc\u81f4\u6574\u4e2a\u96c6\u7fa4\u4e0d\u53ef\u7528\uff1f"},{"location":"chap10/2Redis_interview/#17redis-java","text":"Redisson\u3001Jedis\u3001lettuce \u7b49\u7b49\uff0c\u5b98\u65b9\u63a8\u8350\u4f7f\u7528 Redisson\u3002","title":"17\u3001Redis \u652f\u6301\u7684 Java \u5ba2\u6237\u7aef\u90fd\u6709\u54ea\u4e9b\uff1f\u5b98\u65b9\u63a8\u8350\u7528\u54ea\u4e2a\uff1f"},{"location":"chap10/2Redis_interview/#18jedis-redisson","text":"Jedis \u662f Redis \u7684 Java \u5b9e\u73b0\u7684\u5ba2\u6237\u7aef\uff0c\u5176 API \u63d0\u4f9b\u4e86\u6bd4\u8f83\u5168\u9762\u7684 Redis \u547d\u4ee4\u7684\u652f\u6301\uff1bRedisson \u5b9e\u73b0\u4e86\u5206\u5e03\u5f0f\u548c\u53ef\u6269\u5c55\u7684 Java \u6570\u636e\u7ed3\u6784\uff0c\u548c Jedis \u76f8\u6bd4\uff0c\u529f\u80fd\u8f83\u4e3a\u7b80\u5355\uff0c\u4e0d\u652f\u6301\u5b57\u7b26\u4e32\u64cd\u4f5c\uff0c\u4e0d\u652f\u6301\u6392\u5e8f\u3001\u4e8b\u52a1\u3001\u7ba1\u9053\u3001\u5206\u533a\u7b49 Redis \u7279\u6027\u3002 Redisson \u7684\u5b97\u65e8\u662f\u4fc3\u8fdb\u4f7f\u7528\u8005\u5bf9 Redis \u7684\u5173\u6ce8\u5206\u79bb\uff0c\u4ece\u800c\u8ba9\u4f7f\u7528\u8005\u80fd\u591f\u5c06\u7cbe\u529b\u66f4\u96c6\u4e2d\u5730\u653e\u5728\u5904\u7406\u4e1a\u52a1\u903b\u8f91\u4e0a\u3002","title":"18\u3001Jedis \u4e0e Redisson \u5bf9\u6bd4\u6709\u4ec0\u4e48\u4f18\u7f3a\u70b9\uff1f"},{"location":"chap10/2Redis_interview/#19redis","text":"\u8bbe\u7f6e\u5bc6\u7801\uff1a config set requirepass 123456 \u6388\u6743\u5bc6\u7801\uff1a auth 123456","title":"19\u3001Redis \u5982\u4f55\u8bbe\u7f6e\u5bc6\u7801\u53ca\u9a8c\u8bc1\u5bc6\u7801\uff1f"},{"location":"chap10/2Redis_interview/#20-redis","text":"Redis \u96c6\u7fa4\u6ca1\u6709\u4f7f\u7528\u4e00\u81f4\u6027 hash\uff0c\u800c\u662f\u5f15\u5165\u4e86\u54c8\u5e0c\u69fd\u7684\u6982\u5ff5 Redis \u96c6\u7fa4\u6709 16384 \u4e2a\u54c8\u5e0c\u69fd\uff0c\u6bcf\u4e2a key \u901a\u8fc7 CRC16 \u6821\u9a8c\u540e\u5bf9 16384 \u53d6\u6a21\u6765\u51b3\u5b9a\u653e\u7f6e\u54ea\u4e2a\u69fd\uff0c\u96c6\u7fa4\u7684\u6bcf\u4e2a\u8282\u70b9\u8d1f\u8d23\u4e00\u90e8\u5206 hash \u69fd\u3002","title":"20\u3001\u8bf4\u8bf4 Redis \u54c8\u5e0c\u69fd\u7684\u6982\u5ff5\uff1f"},{"location":"chap10/2Redis_interview/#21redis","text":"\u4e3a\u4e86\u4f7f\u5728\u90e8\u5206\u8282\u70b9\u5931\u8d25\u6216\u8005\u5927\u90e8\u5206\u8282\u70b9\u65e0\u6cd5\u901a\u4fe1\u7684\u60c5\u51b5\u4e0b\u96c6\u7fa4\u4ecd\u7136\u53ef\u7528\uff0c\u6240\u4ee5\u96c6\u7fa4\u4f7f\u7528\u4e86\u4e3b\u4ece\u590d\u5236\u6a21\u578b\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u4f1a\u6709 N-1 \u4e2a\u590d\u5236\u54c1\u3002","title":"21\u3001Redis \u96c6\u7fa4\u7684\u4e3b\u4ece\u590d\u5236\u6a21\u578b\u662f\u600e\u6837\u7684\uff1f"},{"location":"chap10/2Redis_interview/#22redis","text":"Redis \u5e76\u4e0d\u80fd\u4fdd\u8bc1\u6570\u636e\u7684\u5f3a\u4e00\u81f4\u6027\uff0c\u8fd9\u610f\u5473\u7740\u5728\u5b9e\u9645\u4e2d\u96c6\u7fa4\u5728\u7279\u5b9a\u7684\u6761\u4ef6\u4e0b\u53ef\u80fd\u4f1a\u4e22\u5931\u5199\u64cd\u4f5c\u3002","title":"22\u3001Redis \u96c6\u7fa4\u4f1a\u6709\u5199\u64cd\u4f5c\u4e22\u5931\u5417\uff1f\u4e3a\u4ec0\u4e48\uff1f"},{"location":"chap10/2Redis_interview/#23redis","text":"\u5f02\u6b65\u590d\u5236\u3002","title":"23\u3001Redis \u96c6\u7fa4\u4e4b\u95f4\u662f\u5982\u4f55\u590d\u5236\u7684\uff1f"},{"location":"chap10/2Redis_interview/#24redis","text":"16384 \u4e2a\u3002","title":"24\u3001Redis \u96c6\u7fa4\u6700\u5927\u8282\u70b9\u4e2a\u6570\u662f\u591a\u5c11\uff1f"},{"location":"chap10/2Redis_interview/#25redis","text":"Redis \u96c6\u7fa4\u76ee\u524d\u65e0\u6cd5\u505a\u6570\u636e\u5e93\u9009\u62e9\uff0c\u9ed8\u8ba4\u5728 0 \u6570\u636e\u5e93\u3002","title":"25\u3001Redis \u96c6\u7fa4\u5982\u4f55\u9009\u62e9\u6570\u636e\u5e93\uff1f"},{"location":"chap10/2Redis_interview/#26-redis","text":"\u4f7f\u7528 ping \u547d\u4ee4\u3002","title":"26\u3001\u600e\u4e48\u6d4b\u8bd5 Redis \u7684\u8fde\u901a\u6027\uff1f"},{"location":"chap10/2Redis_interview/#27-redis","text":"\u4e8b\u52a1\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u9694\u79bb\u64cd\u4f5c\uff1a\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u90fd\u4f1a\u5e8f\u5217\u5316\u3001\u6309\u987a\u5e8f\u5730\u6267\u884c\u3002\u4e8b\u52a1\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u4f1a\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u53d1\u9001\u6765\u7684\u547d\u4ee4\u8bf7\u6c42\u6240\u6253\u65ad\u3002 \u4e8b\u52a1\u662f\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\uff1a\u4e8b\u52a1\u4e2d\u7684\u547d\u4ee4\u8981\u4e48\u5168\u90e8\u88ab\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u90fd\u4e0d\u6267\u884c\u3002","title":"27\u3001\u600e\u4e48\u7406\u89e3 Redis \u4e8b\u52a1\uff1f"},{"location":"chap10/2Redis_interview/#28redis","text":"MULTI\u3001EXEC\u3001DISCARD\u3001WATCH\u3002","title":"28\u3001Redis \u4e8b\u52a1\u76f8\u5173\u7684\u547d\u4ee4\u6709\u54ea\u51e0\u4e2a\uff1f"},{"location":"chap10/2Redis_interview/#29redis-key","text":"EXPIRE \u548c PERSIST \u547d\u4ee4\u3002","title":"29\u3001Redis key \u7684\u8fc7\u671f\u65f6\u95f4\u548c\u6c38\u4e45\u6709\u6548\u5206\u522b\u600e\u4e48\u8bbe\u7f6e\uff1f"},{"location":"chap10/2Redis_interview/#30redis","text":"\u5c3d\u53ef\u80fd\u4f7f\u7528\u6563\u5217\u8868\uff08hashes\uff09\uff0c\u6563\u5217\u8868\uff08\u662f\u8bf4\u6563\u5217\u8868\u91cc\u9762\u5b58\u50a8\u7684\u6570\u5c11\uff09\u4f7f\u7528\u7684\u5185\u5b58\u975e\u5e38\u5c0f\uff0c\u6240\u4ee5\u4f60\u5e94\u8be5\u5c3d\u53ef\u80fd\u7684\u5c06\u4f60\u7684\u6570\u636e\u6a21\u578b\u62bd\u8c61\u5230\u4e00\u4e2a\u6563\u5217\u8868\u91cc\u9762\u3002\u6bd4\u5982\u4f60\u7684 Web \u7cfb\u7edf\u4e2d\u6709\u4e00\u4e2a\u7528\u6237\u5bf9\u8c61\uff0c\u4e0d\u8981\u4e3a\u8fd9\u4e2a\u7528\u6237\u7684\u540d\u79f0\uff0c\u59d3\u6c0f\uff0c\u90ae\u7bb1\uff0c\u5bc6\u7801\u8bbe\u7f6e\u5355\u72ec\u7684 key,\u800c\u662f\u5e94\u8be5\u628a\u8fd9\u4e2a\u7528\u6237\u7684\u6240\u6709\u4fe1\u606f\u5b58\u50a8\u5230\u4e00\u5f20\u6563\u5217\u8868\u91cc\u9762\u3002","title":"30\u3001Redis \u5982\u4f55\u505a\u5185\u5b58\u4f18\u5316\uff1f"},{"location":"chap10/2Redis_interview/#31redis","text":"\u4e00\u4e2a\u5ba2\u6237\u7aef\u8fd0\u884c\u4e86\u65b0\u7684\u547d\u4ee4\uff0c\u6dfb\u52a0\u4e86\u65b0\u7684\u6570\u636e\u3002 Redis \u68c0\u67e5\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\uff0c\u5982\u679c\u5927\u4e8e maxmemory \u7684\u9650\u5236\uff0c\u5219\u6839\u636e\u8bbe\u5b9a\u597d\u7684\u7b56\u7565\u8fdb\u884c\u56de\u6536\u3002 \u4e00\u4e2a\u65b0\u7684\u547d\u4ee4\u88ab\u6267\u884c\uff0c\u7b49\u7b49\u3002\u6240\u4ee5\u6211\u4eec\u4e0d\u65ad\u5730\u7a7f\u8d8a\u5185\u5b58\u9650\u5236\u7684\u8fb9\u754c\uff0c\u901a\u8fc7\u4e0d\u65ad\u8fbe\u5230\u8fb9\u754c\u7136\u540e\u4e0d\u65ad\u5730\u56de\u6536\u56de\u5230\u8fb9\u754c\u4ee5\u4e0b\u3002\u5982\u679c\u4e00\u4e2a\u547d\u4ee4\u7684\u7ed3\u679c\u5bfc\u81f4\u5927\u91cf\u5185\u5b58\u88ab\u4f7f\u7528\uff08\u4f8b\u5982\u5f88\u5927\u7684\u96c6\u5408\u7684\u4ea4\u96c6\u4fdd\u5b58\u5230\u4e00\u4e2a\u65b0\u7684\u952e\uff09\uff0c\u4e0d\u7528\u591a\u4e45\u5185\u5b58\u9650\u5236\u5c31\u4f1a\u88ab\u8fd9\u4e2a\u5185\u5b58\u4f7f\u7528\u91cf\u8d85\u8d8a\u3002","title":"31\u3001Redis \u56de\u6536\u8fdb\u7a0b\u5982\u4f55\u5de5\u4f5c\u7684\uff1f"},{"location":"chap10/2Redis_interview/#32-redis","text":"\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f 32 \u4f4d\u7684 Redis \u5b9e\u4f8b\uff0c\u53ef\u4ee5\u597d\u597d\u5229\u7528 Hash\uff0clist\uff0csorted set\uff0cset\u7b49\u96c6\u5408\u7c7b\u578b\u6570\u636e\uff0c\u56e0\u4e3a\u901a\u5e38\u60c5\u51b5\u4e0b\u5f88\u591a\u5c0f\u7684 Key-Value \u53ef\u4ee5\u7528\u66f4\u7d27\u51d1\u7684\u65b9\u5f0f\u5b58\u653e\u5230\u4e00\u8d77\u3002","title":"32\u3001\u90fd\u6709\u54ea\u4e9b\u529e\u6cd5\u53ef\u4ee5\u964d\u4f4e Redis \u7684\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u5462\uff1f"},{"location":"chap10/2Redis_interview/#33redis","text":"\u5982\u679c\u8fbe\u5230\u8bbe\u7f6e\u7684\u4e0a\u9650\uff0cRedis \u7684\u5199\u547d\u4ee4\u4f1a\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\uff08\u4f46\u662f\u8bfb\u547d\u4ee4\u8fd8\u53ef\u4ee5\u6b63\u5e38\u8fd4\u56de\u3002\uff09\u6216\u8005\u4f60\u53ef\u4ee5\u5c06 Redis \u5f53\u7f13\u5b58\u6765\u4f7f\u7528\u914d\u7f6e\u6dd8\u6c70\u673a\u5236\uff0c\u5f53 Redis \u8fbe\u5230\u5185\u5b58\u4e0a\u9650\u65f6\u4f1a\u51b2\u5237\u6389\u65e7\u7684\u5185\u5bb9\u3002","title":"33\u3001Redis \u7684\u5185\u5b58\u7528\u5b8c\u4e86\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f"},{"location":"chap10/2Redis_interview/#34-redis-keyslistsetsorted-set","text":"\u7406\u8bba\u4e0a Redis \u53ef\u4ee5\u5904\u7406\u591a\u8fbe 232 \u7684 keys\uff0c\u5e76\u4e14\u5728\u5b9e\u9645\u4e2d\u8fdb\u884c\u4e86\u6d4b\u8bd5\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u81f3\u5c11\u5b58\u653e\u4e86 2 \u4ebf 5 \u5343\u4e07\u7684 keys\u3002\u6211\u4eec\u6b63\u5728\u6d4b\u8bd5\u4e00\u4e9b\u8f83\u5927\u7684\u503c\u3002\u4efb\u4f55 list\u3001set\u3001\u548c sorted set \u90fd\u53ef\u4ee5\u653e 232 \u4e2a\u5143\u7d20\u3002 \u6362\u53e5\u8bdd\u8bf4\uff0cRedis \u7684\u5b58\u50a8\u6781\u9650\u662f\u7cfb\u7edf\u4e2d\u7684\u53ef\u7528\u5185\u5b58\u503c\u3002","title":"34\u3001\u4e00\u4e2a Redis \u5b9e\u4f8b\u6700\u591a\u80fd\u5b58\u653e\u591a\u5c11\u7684 keys\uff1fList\u3001Set\u3001Sorted Set \u4ed6\u4eec\u6700\u591a\u80fd\u5b58\u653e\u591a\u5c11\u5143\u7d20\uff1f"},{"location":"chap10/2Redis_interview/#35mysql-2000w-redis-20w-redis","text":"Redis \u5185\u5b58\u6570\u636e\u96c6\u5927\u5c0f\u4e0a\u5347\u5230\u4e00\u5b9a\u5927\u5c0f\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u65bd\u884c\u6570\u636e\u6dd8\u6c70\u7b56\u7565\u3002 \u76f8\u5173\u77e5\u8bc6\uff1aRedis \u63d0\u4f9b 6 \u79cd\u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff1a volatile-lru \uff1a\u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\uff08 server.db[i].expires \uff09\u4e2d\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70 volatile-ttl \uff1a\u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\uff08 server.db[i].expires \uff09\u4e2d\u6311\u9009\u5c06\u8981\u8fc7\u671f\u7684\u6570\u636e\u6dd8\u6c70 volatile-random \uff1a\u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\uff08 server.db[i].expires \uff09\u4e2d\u4efb\u610f\u9009\u62e9\u6570\u636e\u6dd8\u6c70 allkeys-lru \uff1a\u4ece\u6570\u636e\u96c6\uff08 server.db[i].dict \uff09\u4e2d\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70 allkeys-random \uff1a\u4ece\u6570\u636e\u96c6\uff08 server.db[i].dict \uff09\u4e2d\u4efb\u610f\u9009\u62e9\u6570\u636e\u6dd8\u6c70 no-enviction \uff08\u9a71\u9010\uff09\uff1a\u7981\u6b62\u9a71\u9010\u6570\u636e","title":"35\u3001MySQL \u91cc\u6709 2000w \u6570\u636e\uff0cRedis \u4e2d\u53ea\u5b58 20w \u7684\u6570\u636e\uff0c\u5982\u4f55\u4fdd\u8bc1 Redis \u4e2d\u7684\u6570\u636e\u90fd\u662f\u70ed\u70b9\u6570\u636e\uff1f"},{"location":"chap10/2Redis_interview/#36redis","text":"\u4f1a\u8bdd\u7f13\u5b58\uff08Session Cache\uff09\uff0c\u6700\u5e38\u7528\u7684\u4e00\u79cd\u4f7f\u7528 Redis \u7684\u60c5\u666f\u662f\u4f1a\u8bdd\u7f13\u5b58\uff08session cache\uff09\u3002\u7528 Redis \u7f13\u5b58\u4f1a\u8bdd\u6bd4\u5176\u4ed6\u5b58\u50a8\uff08\u5982 Memcached\uff09\u7684\u4f18\u52bf\u5728\u4e8e\uff1aRedis \u63d0\u4f9b\u6301\u4e45\u5316\u3002\u5f53\u7ef4\u62a4\u4e00\u4e2a\u4e0d\u662f\u4e25\u683c\u8981\u6c42\u4e00\u81f4\u6027\u7684\u7f13\u5b58\u65f6\uff0c\u5982\u679c\u7528\u6237\u7684\u8d2d\u7269\u8f66\u4fe1\u606f\u5168\u90e8\u4e22\u5931\uff0c\u5927\u90e8\u5206\u4eba\u90fd\u4f1a\u4e0d\u9ad8\u5174\u7684\uff0c\u73b0\u5728\uff0c\u4ed6\u4eec\u8fd8\u4f1a\u8fd9\u6837\u5417\uff1f\u5e78\u8fd0\u7684\u662f\uff0c\u968f\u7740 Redis \u8fd9\u4e9b\u5e74\u7684\u6539\u8fdb\uff0c\u5f88\u5bb9\u6613\u627e\u5230\u600e\u4e48\u6070\u5f53\u7684\u4f7f\u7528 Redis \u6765\u7f13\u5b58\u4f1a\u8bdd\u7684\u6587\u6863\u3002\u751a\u81f3\u5e7f\u4e3a\u4eba\u77e5\u7684\u5546\u4e1a\u5e73\u53f0Magento \u4e5f\u63d0\u4f9b Redis \u7684\u63d2\u4ef6\u3002 \u5168\u9875\u7f13\u5b58\uff08FPC\uff09\uff0c\u9664\u57fa\u672c\u7684\u4f1a\u8bdd token \u4e4b\u5916\uff0cRedis \u8fd8\u63d0\u4f9b\u5f88\u7b80\u4fbf\u7684 FPC \u5e73\u53f0\u3002\u56de\u5230\u4e00\u81f4\u6027\u95ee\u9898\uff0c\u5373\u4f7f\u91cd\u542f\u4e86 Redis \u5b9e\u4f8b\uff0c\u56e0\u4e3a\u6709\u78c1\u76d8\u7684\u6301\u4e45\u5316\uff0c\u7528\u6237\u4e5f\u4e0d\u4f1a\u770b\u5230\u9875\u9762\u52a0\u8f7d\u901f\u5ea6\u7684\u4e0b\u964d\uff0c\u8fd9\u662f\u4e00\u4e2a\u6781\u5927\u6539\u8fdb\uff0c\u7c7b\u4f3c PHP \u672c\u5730 FPC\u3002\u518d\u6b21\u4ee5 Magento \u4e3a\u4f8b\uff0cMagento\u63d0\u4f9b\u4e00\u4e2a\u63d2\u4ef6\u6765\u4f7f\u7528 Redis \u4f5c\u4e3a\u5168\u9875\u7f13\u5b58\u540e\u7aef\u3002\u6b64\u5916\uff0c\u5bf9 WordPress \u7684\u7528\u6237\u6765\u8bf4\uff0cPantheon \u6709\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u63d2\u4ef6 wp-redis\uff0c\u8fd9\u4e2a\u63d2\u4ef6\u80fd\u5e2e\u52a9\u4f60\u4ee5\u6700\u5feb\u901f\u5ea6\u52a0\u8f7d\u4f60\u66fe\u6d4f\u89c8\u8fc7\u7684\u9875\u9762\u3002 \u961f\u5217\uff0cReids \u5728\u5185\u5b58\u5b58\u50a8\u5f15\u64ce\u9886\u57df\u7684\u4e00\u5927\u4f18\u70b9\u662f\u63d0\u4f9b list \u548c set \u64cd\u4f5c\uff0c\u8fd9\u4f7f\u5f97 Redis\u80fd\u4f5c\u4e3a\u4e00\u4e2a\u5f88\u597d\u7684\u6d88\u606f\u961f\u5217\u5e73\u53f0\u6765\u4f7f\u7528\u3002Redis \u4f5c\u4e3a\u961f\u5217\u4f7f\u7528\u7684\u64cd\u4f5c\uff0c\u5c31\u7c7b\u4f3c\u4e8e\u672c\u5730\u7a0b\u5e8f\u8bed\u8a00\uff08\u5982 Python\uff09\u5bf9 list \u7684 push/pop \u64cd\u4f5c\u3002\u5982\u679c\u4f60\u5feb\u901f\u5730\u5728 Google\u4e2d\u641c\u7d22\u201cRedis queues\u201d\uff0c\u4f60\u9a6c\u4e0a\u5c31\u80fd\u627e\u5230\u5927\u91cf\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u8fd9\u4e9b\u9879\u76ee\u7684\u76ee\u7684\u5c31\u662f\u5229\u7528 Redis \u521b\u5efa\u975e\u5e38\u597d\u7684\u540e\u7aef\u5de5\u5177\uff0c\u4ee5\u6ee1\u8db3\u5404\u79cd\u961f\u5217\u9700\u6c42\u3002\u4f8b\u5982\uff0cCelery \u6709\u4e00\u4e2a\u540e\u53f0\u5c31\u662f\u4f7f\u7528 Redis \u4f5c\u4e3a broker\uff0c\u4f60\u53ef\u4ee5\u4ece\u8fd9\u91cc\u53bb\u67e5\u770b\u3002 \u6392\u884c\u699c/\u8ba1\u6570\u5668\uff0cRedis \u5728\u5185\u5b58\u4e2d\u5bf9\u6570\u5b57\u8fdb\u884c\u9012\u589e\u6216\u9012\u51cf\u7684\u64cd\u4f5c\u5b9e\u73b0\u7684\u975e\u5e38\u597d\u3002\u96c6\u5408\uff08Set\uff09\u548c\u6709\u5e8f\u96c6\u5408\uff08Sorted Set\uff09\u4e5f\u4f7f\u5f97\u6211\u4eec\u5728\u6267\u884c\u8fd9\u4e9b\u64cd\u4f5c\u7684\u65f6\u5019\u53d8\u7684\u975e\u5e38\u7b80\u5355\uff0cRedis \u53ea\u662f\u6b63\u597d\u63d0\u4f9b\u4e86\u8fd9\u4e24\u79cd\u6570\u636e\u7ed3\u6784\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u4ece\u6392\u5e8f\u96c6\u5408\u4e2d\u83b7\u53d6\u5230\u6392\u540d\u6700\u9760\u524d\u7684 10 \u4e2a\u7528\u6237\u2014\u2014\u6211\u4eec\u79f0\u4e4b\u4e3a\u201cuser_scores\u201d\uff0c\u6211\u4eec\u53ea\u9700\u8981\u50cf\u4e0b\u9762\u4e00\u6837\u6267\u884c\u5373\u53ef\uff1a\u5f53\u7136\uff0c\u8fd9\u662f\u5047\u5b9a\u4f60\u662f\u6839\u636e\u4f60\u7528\u6237\u7684\u5206\u6570\u505a\u9012\u589e\u7684\u6392\u5e8f\u3002\u5982\u679c\u4f60\u60f3\u8fd4\u56de\u7528\u6237\u53ca\u7528\u6237\u7684\u5206\u6570\uff0c\u4f60\u9700\u8981\u8fd9\u6837\u6267\u884c\uff1aZRANGE user_scores 0 10 WITHSCORES Agora Games \u5c31\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u4f8b\u5b50\uff0c\u7528 Ruby \u5b9e\u73b0\u7684\uff0c\u5b83\u7684\u6392\u884c\u699c\u5c31\u662f\u4f7f\u7528 Redis \u6765\u5b58\u50a8\u6570\u636e\u7684\uff0c\u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u770b\u5230\u3002 \u53d1\u5e03/\u8ba2\u9605\uff0c\u6700\u540e\uff08\u4f46\u80af\u5b9a\u4e0d\u662f\u6700\u4e0d\u91cd\u8981\u7684\uff09\u662f Redis \u7684\u53d1\u5e03/\u8ba2\u9605\u529f\u80fd\u3002\u53d1\u5e03/\u8ba2\u9605\u7684\u4f7f\u7528\u573a\u666f\u786e\u5b9e\u975e\u5e38\u591a\u3002\u6211\u5df2\u770b\u89c1\u4eba\u4eec\u5728\u793e\u4ea4\u7f51\u7edc\u8fde\u63a5\u4e2d\u4f7f\u7528\uff0c\u8fd8\u53ef\u4f5c\u4e3a\u57fa\u4e8e\u53d1\u5e03/\u8ba2\u9605\u7684\u811a\u672c\u89e6\u53d1\u5668\uff0c\u751a\u81f3\u7528 Redis \u7684\u53d1\u5e03/\u8ba2\u9605\u529f\u80fd\u6765\u5efa\u7acb\u804a\u5929\u7cfb\u7edf\uff01","title":"36\u3001Redis \u6700\u9002\u5408\u7684\u573a\u666f\uff1f"},{"location":"chap10/2Redis_interview/#37-redis-1-key-10w-key","text":"\u4f7f\u7528 keys \u6307\u4ee4\u53ef\u4ee5\u626b\u51fa\u6307\u5b9a\u6a21\u5f0f\u7684 key \u5217\u8868\u3002 \u5bf9\u65b9\u63a5\u7740\u8ffd\u95ee\uff1a\u5982\u679c\u8fd9\u4e2a Redis \u6b63\u5728\u7ed9\u7ebf\u4e0a\u7684\u4e1a\u52a1\u63d0\u4f9b\u670d\u52a1\uff0c\u90a3\u4f7f\u7528 keys \u6307\u4ee4\u4f1a\u6709\u4ec0\u4e48\u95ee\u9898\uff1f \u8fd9\u4e2a\u65f6\u5019\u4f60\u8981\u56de\u7b54 Redis \u5173\u952e\u7684\u4e00\u4e2a\u7279\u6027\uff1aRedis \u7684\u5355\u7ebf\u7a0b\u7684\u3002 keys \u6307\u4ee4\u4f1a\u5bfc\u81f4\u7ebf\u7a0b\u963b\u585e\u4e00\u6bb5\u65f6\u95f4\uff0c\u7ebf\u4e0a\u670d\u52a1\u4f1a\u505c\u987f\uff0c\u76f4\u5230\u6307\u4ee4\u6267\u884c\u5b8c\u6bd5\uff0c\u670d\u52a1\u624d\u80fd\u6062\u590d\u3002 \u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u4f7f\u7528 scan \u6307\u4ee4\uff0cscan \u6307\u4ee4\u53ef\u4ee5\u65e0\u963b\u585e\u5730\u63d0\u53d6\u51fa\u6307\u5b9a\u6a21\u5f0f\u7684 key \u5217\u8868\uff0c\u4f46\u662f\u4f1a\u6709\u4e00\u5b9a\u7684\u91cd\u590d\u6982\u7387\uff0c\u5728\u5ba2\u6237\u7aef\u505a\u4e00\u6b21\u53bb\u91cd\u5c31\u53ef\u4ee5\u4e86\uff0c\u4f46\u662f\u6574\u4f53\u6240\u82b1\u8d39\u7684\u65f6\u95f4\u4f1a\u6bd4\u76f4\u63a5\u7528 keys \u6307\u4ee4\u957f\u3002","title":"37\u3001\u5047\u5982 Redis \u91cc\u9762\u6709 1 \u4ebf\u4e2a key\uff0c\u5176\u4e2d\u6709 10w \u4e2a key \u662f\u4ee5\u67d0\u4e2a\u56fa\u5b9a\u7684\u5df2\u77e5\u7684\u524d\u7f00\u5f00\u5934\u7684\uff0c\u5982\u679c\u5c06\u5b83\u4eec\u5168\u90e8\u627e\u51fa\u6765\uff1f"},{"location":"chap10/2Redis_interview/#38-key","text":"\u5982\u679c\u5927\u91cf\u7684 key \u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u7684\u8fc7\u4e8e\u96c6\u4e2d\uff0c\u5230\u8fc7\u671f\u7684\u90a3\u4e2a\u65f6\u95f4\u70b9\uff0cRedis \u53ef\u80fd\u4f1a\u51fa\u73b0\u77ed\u6682\u7684\u5361\u987f\u73b0\u8c61\u3002\u4e00\u822c\u9700\u8981\u5728\u65f6\u95f4\u4e0a\u52a0\u4e00\u4e2a\u968f\u673a\u503c\uff0c\u4f7f\u5f97\u8fc7\u671f\u65f6\u95f4\u5206\u6563\u4e00\u4e9b\u3002","title":"38\u3001\u5982\u679c\u6709\u5927\u91cf\u7684 key \u9700\u8981\u8bbe\u7f6e\u540c\u4e00\u65f6\u95f4\u8fc7\u671f\uff0c\u4e00\u822c\u9700\u8981\u6ce8\u610f\u4ec0\u4e48\uff1f"},{"location":"chap10/2Redis_interview/#39-redis","text":"\u7b54\uff1a\u4e00\u822c\u4f7f\u7528 list \u7ed3\u6784\u4f5c\u4e3a\u961f\u5217\uff0crpush \u751f\u4ea7\u6d88\u606f\uff0clpop \u6d88\u8d39\u6d88\u606f\u3002 \u5f53 lpop \u6ca1\u6709\u6d88\u606f\u7684\u65f6\u5019\uff0c\u8981\u9002\u5f53 sleep \u4e00\u4f1a\u518d\u91cd\u8bd5 \u3002 \u5982\u679c\u5bf9\u65b9\u8ffd\u95ee\u53ef\u4e0d\u53ef\u4ee5\u4e0d\u7528 sleep \u5462\uff1f list \u8fd8\u6709\u4e2a\u6307\u4ee4\u53eb blpop\uff0c\u5728\u6ca1\u6709\u6d88\u606f\u7684\u65f6\u5019\uff0c\u5b83\u4f1a\u963b\u585e\u4f4f\u76f4\u5230\u6d88\u606f\u5230\u6765\u3002\u5982\u679c\u5bf9\u65b9\u8ffd\u95ee\u80fd\u4e0d\u80fd\u751f\u4ea7\u4e00\u6b21\u6d88\u8d39\u591a\u6b21\u5462\uff1f\u4f7f\u7528 pub/sub \u4e3b\u9898\u8ba2\u9605\u8005\u6a21\u5f0f\uff0c\u53ef\u4ee5\u5b9e\u73b0 1:N \u7684\u6d88\u606f\u961f\u5217\u3002 \u5982\u679c\u5bf9\u65b9\u8ffd\u95ee pub/sub \u6709\u4ec0\u4e48\u7f3a\u70b9\uff1f \u5728\u6d88\u8d39\u8005\u4e0b\u7ebf\u7684\u60c5\u51b5\u4e0b\uff0c\u751f\u4ea7\u7684\u6d88\u606f\u4f1a\u4e22\u5931\uff0c\u5f97\u4f7f\u7528\u4e13\u4e1a\u7684\u6d88\u606f\u961f\u5217\u5982 RabbitMQ\u7b49\u3002 \u5982\u679c\u5bf9\u65b9\u8ffd\u95ee Redis \u5982\u4f55\u5b9e\u73b0\u5ef6\u65f6\u961f\u5217\uff1f \u4f7f\u7528 sortedset\uff0c\u62ff\u65f6\u95f4\u6233\u4f5c\u4e3ascore\uff0c\u6d88\u606f\u5185\u5bb9\u4f5c\u4e3a key \u8c03\u7528 zadd \u6765\u751f\u4ea7\u6d88\u606f\uff0c\u6d88\u8d39\u8005\u7528 zrangebyscore \u6307\u4ee4\u83b7\u53d6 N \u79d2\u4e4b\u524d\u7684\u6570\u636e\u8f6e\u8be2\u8fdb\u884c\u5904\u7406\u3002","title":"39\u3001\u4f7f\u7528\u8fc7 Redis \u505a\u5f02\u6b65\u961f\u5217\u4e48\uff0c\u4f60\u662f\u600e\u4e48\u7528\u7684\uff1f"},{"location":"chap10/2Redis_interview/#40-redis_1","text":"\u5148\u62ff setnx \u6765\u4e89\u62a2\u9501\uff0c\u62a2\u5230\u4e4b\u540e\uff0c\u518d\u7528 expire \u7ed9\u9501\u52a0\u4e00\u4e2a\u8fc7\u671f\u65f6\u95f4\u9632\u6b62\u9501\u5fd8\u8bb0\u4e86\u91ca\u653e\u3002","title":"40\u3001\u4f7f\u7528\u8fc7 Redis \u5206\u5e03\u5f0f\u9501\u4e48\uff0c\u5b83\u662f\u4ec0\u4e48\u56de\u4e8b\uff1f"},{"location":"chap10/3Redis_basic/","text":"Redis \u57fa\u7840\u4f60\u638c\u63e1\u591a\u5c11\u4e86\uff1f\u6765\u4e2a\u67e5\u6f0f\u8865\u7f3a Redis \u662f\u5f00\u6e90\uff0c\u5185\u5b58\u4e2d\u7684\u6570\u636e\u7ed3\u6784\u5b58\u50a8\u7cfb\u7edf\uff0c\u5b83\u53ef\u4ee5\u7528 \u4f5c\u6570\u636e\u5e93\u3001\u7f13\u5b58\u548c\u6d88\u606f\u4e2d\u95f4\u4ef6 \u3002 \u5b83\u652f\u6301\u591a\u79cd\u7c7b\u578b\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5982\u5b57\u7b26\u4e32 strings \uff0c\u6563\u5217 hashes \uff0c\u5217\u8868 lists \uff0c\u96c6\u5408 sets \uff0c\u6709\u5e8f\u96c6\u5408 sorted sets \u4e0e\u8303\u56f4\u67e5\u8be2\uff0c bitmaps \uff0c hyperloglogs \u548c \u5730\u7406\u7a7a\u95f4\uff08geospatial\uff09\u7d22\u5f15\u534a\u5f84\u67e5\u8be2\u3002 Redis \u8fd8\u5185\u7f6e\u4e86\u590d\u5236\uff08 replication \uff09\uff0cLUA\u811a\u672c\uff08 Lua scripting \uff09\uff0c LRU\u9a71\u52a8\u4e8b\u4ef6\uff08 LRU eviction \uff09\uff0c\u4e8b\u52a1\uff08 transactions \uff09\u548c\u4e0d\u540c\u7ea7\u522b\u7684\u78c1\u76d8\u6301\u4e45\u5316\uff08 persistence \uff09\uff0c\u5e76\u901a\u8fc7 Redis \u54e8\u5175\uff08 Sentinel \uff09\u548c\u81ea\u52a8\u5206\u533a\uff08 Cluster \uff09\u63d0\u4f9b\u9ad8\u53ef\u7528\u6027\uff08 high availability \uff09 \u3002 NoSQL \u662f\u4ec0\u4e48 \u6211\u4eec\u77e5\u9053 Redis \u662f\u4e00\u79cd\u975e\u5173\u7cfb\u578b\u6570\u636e\u5e93 NoSQL\u3002\u800c\u4e3a\u4ec0\u4e48\u51fa\u73b0 NoSQL\uff1fNoSQL \u53c8\u662f\u4ec0\u4e48\u5462\uff1f \u5355\u673a\u6570\u636e\u5e93\u7684\u5e74\u4ee3 \u5728\u4e00\u4e2a\u7f51\u7ad9\u8bbf\u95ee\u91cf\u4e0d\u5927\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u6570\u636e\u5e93\u5c31\u8db3\u4ee5\u5e94\u5bf9\u6d41\u91cf\u8bf7\u6c42\u3002 \u7f13\u5b58 + \u62c6\u5206 \u968f\u7740\u8bbf\u95ee\u91cf\u7684\u4e0a\u5347\uff0c\u4e00\u4e2a\u6570\u636e\u5e93\u5df2\u7ecf\u4e0d\u80fd\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u6c42\u4e86\u3002\u4e3a\u4e86\u66f4\u9ad8\u7684\u6027\u80fd\uff0c\u6211\u4eec\u5728\u4e2d\u95f4\u52a0\u4e0a\u4e86\u4e00\u4e2a\u7f13\u5b58\u5c42\u5e76\u4e14\u5c06\u6570\u636e\u5e93\u505a\u4e86 \u96c6\u7fa4\u3001\u7ed3\u6784\u4f18\u5316\u548c\u8bfb\u5199\u5206\u79bb \u3002 \u800c\u8fd9\u91cc\u7684\u7f13\u5b58\u5c31\u662f NoSQL \uff0c\u5f53\u7136\u505a\u7f13\u5b58\u4e5f\u53ea\u662f NoSQL \u7684\u4e00\u79cd\u529f\u80fd\uff0c\u5c31\u50cf Redis \u5e76\u4e0d\u4ec5\u4ec5\u6709\u7f13\u5b58\u8fd9\u4e00\u79cd\u529f\u80fd\u3002 \u6bd4\u5982\u5b83\u8fd8\u80fd\u5b9e\u73b0 \u7b80\u5355\u7684\u6d88\u606f\u961f\u5217\uff0c\u89e3\u51b3 Session \u5171\u4eab\uff0c\u8ba1\u6570\u5668\uff0c\u6392\u884c\u699c\uff0c\u597d\u53cb\u5173\u7cfb\u5904\u7406 \u7b49\u7b49\u529f\u80fd\uff0c\u53ef\u89c1 Redis \u662f\u4e00\u4e2a\u975e\u5e38\u5f3a\u5927\u5de5\u5177\uff0c\u8ba9\u6211\u4eec\u6765\u5b66\u4e60\u5b83\u5427\uff01 Redis \u901a\u7528\u547d\u4ee4 \u9996\u5148\u6211\u4eec\u629b\u5f00\u6570\u636e\u7c7b\u578b\u6765\u8bb2\u5173\u4e8e Redis \u7684\u901a\u7528\u547d\u4ee4\u3002 \u64cd\u4f5c key \u548c value Redis \u662f\u4e00\u79cd key value \u5b58\u50a8\u7684\u7f13\u5b58\u6570\u636e\u5e93\uff0c\u6240\u6709\u7684\u6570\u636e\u90fd\u6709\u4e00\u4e2a\u81ea\u5df1\u552f\u4e00\u7684 key \u3002 \u8fd9\u91cc\u4e3a\u4e86\u65b9\u4fbf\u6f14\u793a\uff0c\u6211\u4f7f\u7528\u4e86\u5b57\u7b26\u4e32\u76f8\u5173\u7684\u8bbe\u7f6e\u547d\u4ee4\u3002 keys [pattern] \u83b7\u53d6\u7b26\u5408\u8981\u6c42\u7684\u6240\u6709 key \u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(n) \uff0c\u4e00\u822c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4e0d\u4f7f\u7528\uff0c\u56e0\u4e3a Redis \u662f\u5355\u7ebf\u7a0b \u7684\uff0c \u6267\u884c\u8017\u65f6\u7684\u4efb\u52a1\u4f1a\u963b\u585e\u5176\u4ed6\u4efb\u52a1 \u3002\u4e00\u822c\u4f1a\u4f7f\u7528 scan \u547d\u4ee4\u66ff\u4ee3\uff08\u975e\u963b\u585e\uff09\u3002 $ kubectl exec -it redis redis-cli -n redis 127.0.0.1:6379> keys * (empty list or set) 127.0.0.1:6379> set username jxi OK 127.0.0.1:6379> keys * 1) \"username\" 127.0.0.1:6379> set username1 jane OK 127.0.0.1:6379> keys * 1) \"username1\" 2) \"username\" 127.0.0.1:6379> keys u* 1) \"username1\" 2) \"username\" 127.0.0.1:6379> keys username1* 1) \"username1\" dbsize \u83b7\u53d6\u5f53\u524d\u5b58\u50a8\u6570\u636e\u4e2a\u6570\u3002 exists key \u5224\u65ad\u662f\u5426\u5b58\u5728\u8be5key del key \u5220\u9664\u6307\u5b9a\u6570\u636e type key \u83b7\u53d6\u6307\u5b9akey\u7684\u6570\u636e\u7c7b\u578b rename key newkey \u91cd\u547d\u540d 127.0.0.1:6379> dbsize (integer) 2 127.0.0.1:6379> exists username (integer) 1 127.0.0.1:6379> exists user (integer) 0 127.0.0.1:6379> del username (integer) 1 127.0.0.1:6379> keys * 1) \"username1\" 127.0.0.1:6379> type username1 string 127.0.0.1:6379> rename username1 username OK 127.0.0.1:6379> keys * 1) \"username\" \u8fc7\u671f\u65f6\u95f4 Redis \u4e2d\u5f88\u591a\u6570\u636e\u90fd\u662f\u7528\u6765\u4f5c\u4e3a \u7f13\u5b58\u6570\u636e \u7684\uff0c\u800c\u4f5c\u4e3a\u7f13\u5b58\u5c31\u9700\u8981\u6709\u8fc7\u671f\u65f6\u95f4\uff0c\u5728 Redis \u4e2d\u63d0\u4f9b\u4e86\u5f88\u5f3a\u5927\u7684 \u8fc7\u671f\u65f6\u95f4 \u8bbe\u7f6e\u529f\u80fd\u3002 expire key seconds \u4e3a\u67d0\u4e2a key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002 ttl key \u67e5\u770b\u67d0\u4e2a key \u7684\u5269\u4f59\u65f6\u95f4\uff0c\u8fd4\u56de\u6b63\u6570\u4ee3\u8868\u5269\u4f59\u7684\u65f6\u95f4\uff0c -1 \u4ee3\u8868\u6c38\u4e45\uff0c -2 \u4ee3\u8868\u5df2\u8fc7\u671f\u6216\u4e0d\u5b58\u5728\u3002 127.0.0.1:6379> expire username 10 (integer) 1 127.0.0.1:6379> ttl username (integer) 6 127.0.0.1:6379> ttl username (integer) 4 127.0.0.1:6379> ttl username (integer) 3 127.0.0.1:6379> ttl username (integer) 2 127.0.0.1:6379> ttl username (integer) 1 127.0.0.1:6379> ttl username (integer) -2 127.0.0.1:6379> set ttl 123 OK 127.0.0.1:6379> ttl ttl (integer) -1 Redis \u7684\u4e94\u79cd\u57fa\u672c\u6570\u636e\u7c7b\u578b \u5728\u4e0a\u9762\u6211\u8bf4\u5230\u4e86\u5f88\u591a Redis \u4f5c\u4e3a\u7f13\u5b58\u80fd\u5b9e\u73b0\u7684\u5176\u4ed6\u529f\u80fd\uff0c\u6bd4\u5982\u8ba1\u6570\u5668\uff0c\u6392\u884c\u699c\uff0c\u597d\u53cb\u5173\u7cfb\u7b49\uff0c\u8fd9\u4e9b\u5b9e\u73b0\u7684\u4f9d\u636e\u5c31\u662f\u9760\u7740 Redis \u7684\u6570\u636e\u7ed3\u6784\u3002\u5728\u6574\u4e2a Redis \u4e2d\u4e00\u5171\u6709\u4e94\u79cd\u57fa\u672c\u7684\u6570\u636e\u7ed3\u6784(\u8fd8\u6709\u4e9b\u9ad8\u7ea7\u6570\u636e\u7ed3\u6784\u4ee5\u540e\u4f1a\u8bb2)\uff0c\u4ed6\u4eec\u5206\u522b\u662f \u5b57\u7b26\u4e32 strings \uff0c \u6563\u5217 hashes \uff0c \u5217\u8868 lists \uff0c \u96c6\u5408 sets \uff0c \u6709\u5e8f\u96c6\u5408 sorted sets \u3002 \u5b57\u7b26\u4e32 string \u5728\u7edd\u5927\u90e8\u5206\u7f16\u7a0b\u8bed\u8a00\u4e2d\u90fd\u6709 String \u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u5bf9\u4e8e\u4f5c\u4e3a\u6570\u636e\u5e93\u7684 Redis \u4e5f\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u3002 set key value \u8bbe\u7f6e\u503c get key \u83b7\u53d6\u67d0\u4e2a key \u7684\u503c mset key1 value1 key2 value2 \u6279\u91cf\u8bbe\u7f6e\u5e76\u4e14\u662f \u539f\u5b50 \u7684\uff0c\u53ef\u4ee5\u7528\u6765\u51cf\u5c11\u7f51\u7edc\u65f6\u95f4\u6d88\u8017 mget key1 key2 \u6279\u91cf\u83b7\u53d6\u5e76\u4e14\u662f\u539f\u5b50\u7684\uff0c\u53ef\u4ee5\u7528\u6765\u51cf\u5c11\u7f51\u7edc\u65f6\u95f4\u6d88\u8017 127.0.0.1:6379> set username1 Jane OK 127.0.0.1:6379> set username2 Jacob OK 127.0.0.1:6379> del username2 (integer) 1 127.0.0.1:6379> mset username2 Jacob username3 Jason OK 127.0.0.1:6379> get username1 \"Jane\" 127.0.0.1:6379> mget username1 username2 username3 1) \"Jane\" 2) \"Jacob\" 3) \"Jason\" incr key \u81ea\u589e\u6307\u5b9akey\u7684\u503c decr key \u81ea\u51cf\u6307\u5b9akey\u7684\u503c incrby key value \u81ea\u589e\u6307\u5b9a\u6570\u503c decrby key value \u81ea\u51cf\u6307\u5b9a\u6570\u503c incrbyfloat key floatvalue \u589e\u52a0\u6307\u5b9a\u6d6e\u70b9\u6570,\u524d\u9762\u51e0\u4e2a\u64cd\u4f5c\u5c31\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0 \u8ba1\u6570\u5668 \u7684\u529f\u80fd\u3002 127.0.0.1:6379> set counter 1 OK 127.0.0.1:6379> incr counter (integer) 2 127.0.0.1:6379> decr counter (integer) 1 127.0.0.1:6379> get counter \"1\" 127.0.0.1:6379> incrby counter 99 (integer) 100 127.0.0.1:6379> get counter \"100\" 127.0.0.1:6379> decrby counter 100 (integer) 0 127.0.0.1:6379> get counter \"0\" 127.0.0.1:6379> incrbyfloat counter 0.5 \"0.5\" 127.0.0.1:6379> get counter \"0.5\" setnx key value \u5982\u679c\u4e0d\u5b58\u5728\u8be5 key \u5219\u53ef\u4ee5\u8bbe\u7f6e\u6210\u529f\uff0c\u5426\u5219\u4f1a\u5931\u8d25 \uff0c \u52a0\u4e0a\u8fc7\u671f\u65f6\u95f4\u9650\u5236\uff0c\u5219\u662fredis\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u7684\u4e00\u79cd\u65b9\u5f0f \uff08\u540e\u9762\u4f1a\u63d0\u5230\uff09 \u3002 set key value xx \u4e0e\u524d\u9762\u76f8\u53cd\uff0c\u5982\u679c\u5b58\u5728\u5219\u8bbe\u7f6e\u6210\u529f \uff0c\u5426\u5219\u5931\u8d25(\u76f8\u5f53\u4e8e\u66f4\u65b0\u64cd\u4f5c) 27.0.0.1:6379> keys * 1) \"username2\" 2) \"counter\" 3) \"ttl\" 4) \"username3\" 5) \"username1\" 127.0.0.1:6379> setnx username1 tt (integer) 0 127.0.0.1:6379> get username1 \"Jane\" 127.0.0.1:6379> setnx username4 john (integer) 1 127.0.0.1:6379> get username4 \"john\" 127.0.0.1:6379> set username5 jack xx (nil) 127.0.0.1:6379> get username5 (nil) 127.0.0.1:6379> set username4 jack xx OK 127.0.0.1:6379> get username4 \"jack\" getset key newvalue \u8bbe\u7f6e\u65b0\u503c\u5e76\u8fd4\u56de\u65e7\u503c append key value \u4e3a\u539f\u672c\u5185\u5bb9\u8ffd\u52a0\u5185\u5bb9 strlen key \u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6 getrange key start end \u83b7\u53d6\u6307\u5b9a\u8303\u56f4\u7684\u5185\u5bb9 setrange key index value \u8bbe\u7f6e\u6307\u5b9a\u8303\u56f4\u7684\u5185\u5bb9 127.0.0.1:6379> keys * 1) \"username4\" 2) \"username2\" 3) \"counter\" 4) \"ttl\" 5) \"username3\" 6) \"username1\" 127.0.0.1:6379> get username1 \"Jane\" 127.0.0.1:6379> getset username1 JaneDoe \"Jane\" 127.0.0.1:6379> get username1 \"JaneDoe\" 127.0.0.1:6379> append username1 love (integer) 11 127.0.0.1:6379> get username1 \"JaneDoelove\" 127.0.0.1:6379> strlen username1 (integer) 11 127.0.0.1:6379> getrange username1 0 5 \"JaneDo\" 127.0.0.1:6379> setrange username1 5 s (integer) 11 127.0.0.1:6379> get username1 \"JaneDselove\" setex key seconds value \u8bbe\u7f6e\u503c\u4e14\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4 set key value ex seconds nx \u4e3a\u4e0d\u5b58\u5728\u7684 key \u8bbe\u7f6e\u503c\u4e14\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c \u5206\u5e03\u5f0f\u9501\u7684\u5b9e\u73b0\u65b9\u5f0f \u3002 127.0.0.1:6379> keys * 1) \"username4\" 2) \"username2\" 3) \"counter\" 4) \"ttl\" 5) \"username3\" 6) \"username1\" 127.0.0.1:6379> setex user 10 jac OK 127.0.0.1:6379> ttl user (integer) 6 127.0.0.1:6379> ttl user (integer) 2 127.0.0.1:6379> set user1 snow ex seconds nx OK 127.0.0.1:6379> ttl user1 (integer) 5 127.0.0.1:6379> ttl user1 (integer) 2 127.0.0.1:6379> set username1 snow ex 10 nx (nil) hash \u5176\u5b9e\u6211\u4eec\u53ef\u4ee5\u7406\u89e3 hash \u4e3a \u5c0f\u578bRedis \uff0c Redis \u5728\u5e95\u5c42\u5b9e\u73b0\u4e0a\u548c Java \u4e2d\u7684 HashMap \u5dee\u4e0d\u591a\uff0c\u90fd\u662f\u4f7f\u7528 \u6570\u7ec4 + \u94fe\u8868 \u7684\u4e8c\u7ef4\u7ed3\u6784\u5b9e\u73b0\u7684\u3002 \u4e0d\u540c\u7684\u662f\uff0c\u5728 Redis \u4e2d\u5b57\u5178\u7684\u503c \u53ea\u80fd\u662f\u5b57\u7b26\u4e32 \uff0c\u800c\u4e14\u4ed6\u4eec rehash \u7684\u65b9\u5f0f\u4e0d\u4e00\u6837\uff0c\u5728 Redis \u4e2d\u4f7f\u7528\u7684\u662f \u6e10\u8fdb\u5f0frehash \u3002 \u5728 rehash \u7684\u65f6\u5019\u4f1a\u4fdd\u7559\u65b0\u65e7\u4e24\u4e2a hash \u5b57\u5178\uff0c\u5728\u6570\u636e\u8fc1\u79fb\u7684\u65f6\u5019\u4f1a\u5c06\u65e7\u5b57\u5178\u4e2d\u7684\u5185\u5bb9\u4e00\u70b9\u4e00\u70b9\u8fc1\u79fb\u5230\u65b0\u5b57\u5178\u4e2d\uff0c\u67e5\u8be2\u7684\u540c\u65f6\u4f1a\u67e5\u8be2\u4e24\u4e2a hash \u5b57\u5178\uff0c\u7b49\u6570\u636e\u5168\u90e8\u8fc1\u79fb\u5b8c\u6210\u624d\u4f1a\u5c06\u65b0\u5b57\u5178\u4ee3\u66ff\u5c31\u5b57\u5178\u3002 \u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u5173\u4e8e hash \u7684\u57fa\u672c\u64cd\u4f5c\u3002 hset key field value \u8bbe\u7f6e\u5b57\u5178\u4e2d\u67d0\u4e2a key \u7684\u503c hsetnx key field value \u8bbe\u7f6e\u5b57\u5178\u4e2d\u67d0\u4e2a key \u7684\u503c(\u4e0d\u5b58\u5728\u7684) hmset key field1 value1 field2 value2 ... \u6279\u91cf\u8bbe\u7f6e hget key field \u83b7\u53d6\u5b57\u5178\u4e2d\u67d0\u4e2akey\u7684\u503c hmget key field1 field2 \u6279\u91cf\u83b7\u53d6 hgetall key \u83b7\u53d6\u5168\u90e8 $ kubectl exec -it redis redis-cli -n redis 127.0.0.1:6379> hset userInfo name jacob (integer) 1 127.0.0.1:6379> hset userInfo name jane (integer) 0 127.0.0.1:6379> hsetnx userInfo name jane (integer) 0 127.0.0.1:6379> hsetnx userInfo qq 11111 (integer) 1 127.0.0.1:6379> hmset userInfo wecht we111 email 111@qq.com OK 127.0.0.1:6379> hget userInfo wecht \"we111\" 127.0.0.1:6379> hmget userInfo qq email 1) \"11111\" 2) \"111@qq.com\" 127.0.0.1:6379> hgetall userInfo 1) \"name\" 2) \"jane\" 3) \"qq\" 4) \"11111\" 5) \"wecht\" 6) \"we111\" 7) \"email\" 8) \"111@qq.com\" hdel key field \u5220\u9664\u67d0\u4e2a key hexists key field \u5224\u65ad\u662f\u5426\u5b58\u5728 hlen key \u83b7\u53d6\u6307\u5b9akey\u5bf9\u5e94\u7684\u5b57\u5178\u4e2d\u7684\u5b58\u50a8\u4e2a\u6570 hvals key \u8fd4\u56de\u6240\u6709\u7684 value hkeys key \u8fd4\u56de\u6240\u6709\u7684key 127.0.0.1:6379> hkeys userInfo 1) \"name\" 2) \"qq\" 3) \"wecht\" 4) \"email\" 127.0.0.1:6379> hdel userInfo name (integer) 1 127.0.0.1:6379> hkeys userInfo 1) \"qq\" 2) \"wecht\" 3) \"email\" 127.0.0.1:6379> hexists userInfo qq (integer) 1 127.0.0.1:6379> hlen userInfo (integer) 3 127.0.0.1:6379> hvals hvals (empty list or set) 127.0.0.1:6379> hvals userInfo 1) \"11111\" 2) \"we111\" 3) \"111@qq.com\" hincrby key field increValue \u589e\u52a0\u67d0\u4e2avalue\u7684\u503c(\u4e5f\u53ef\u4ee5\u589e\u52a0\u8d1f\u6570) hincrbyfloat key field floatValue \u589e\u52a0\u67d0\u4e2avalue\u7684\u503c(\u6d6e\u70b9\u6570) 127.0.0.1:6379> hset userInfo age 29 (integer) 1 127.0.0.1:6379> hincrby userInfo age 1 (integer) 30 127.0.0.1:6379> hget userInfo age \"30\" 127.0.0.1:6379> hincrbyfloat userInfo age 0.1 \"30.1\" 127.0.0.1:6379> hget userInfo age \"30.1\" list Redis \u4e2d\u7684\u5217\u8868\u76f8\u5f53\u4e8e Java \u4e2d\u7684 LinkedList (\u53cc\u5411\u94fe\u8868) \uff0c\u4e5f\u5c31\u662f\u5e95\u5c42\u662f\u901a\u8fc7 \u94fe\u8868 \u6765\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u5bf9\u4e8e list \u6765\u8bf4 \u63d2\u5165\u5220\u9664\u64cd\u4f5c\u5f88\u5feb\uff0c\u4f46 \u7d22\u5f15\u5b9a\u4f4d\u975e\u5e38\u6162 \u3002 Redis \u63d0\u4f9b\u4e86\u8bb8\u591a\u5bf9\u4e8e list \u7684\u64cd\u4f5c\uff0c\u5982 \u51fa\uff0c\u5165 \u7b49\u64cd\u4f5c\uff0c\u4f60\u53ef\u4ee5\u5145\u5206\u5229\u7528\u5b83\u4eec\u6765\u5b9e\u73b0\u4e00\u4e2a \u6808 \u6216\u8005 \u961f\u5217 \u3002 \u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u5173\u4e8e list \u7684\u57fa\u672c\u64cd\u4f5c\u3002 lpush key item1 item2 item3 ... \u4ece\u5de6\u5165\u6808 rpush key item1 item2 item3 ... \u4ece\u53f3\u5165\u6808 lpop key \u4ece\u5de6\u51fa\u6808 rpop key \u4ece\u53f3\u51fa\u6808 lindex key index \u83b7\u53d6\u6307\u5b9a\u7d22\u5f15\u7684\u5143\u7d20 O(n) \u8c28\u614e\u4f7f\u7528 lrange key start end \u83b7\u53d6\u6307\u5b9a\u8303\u56f4\u7684\u5143\u7d20 O(n) \u8c28\u614e\u4f7f\u7528 127.0.0.1:6379> lpush userlist jacob (integer) 1 127.0.0.1:6379> lpush userlist jane john (integer) 3 127.0.0.1:6379> lrange userlist 0 -1 # -1 \u4ee3\u8868\u672b\u5c3e 1) \"john\" 2) \"jane\" 3) \"jacob\" 127.0.0.1:6379> rpush userlist jake (integer) 4 127.0.0.1:6379> lrange userlist 0 -1 1) \"john\" 2) \"jane\" 3) \"jacob\" 4) \"jake\" 127.0.0.1:6379> lpop userlist \"john\" 127.0.0.1:6379> rpop userlist \"jake\" 127.0.0.1:6379> lrange userlist 0 -1 1) \"jane\" 2) \"jacob\" 127.0.0.1:6379> lindex userlist 1 \"jacob\" 127.0.0.1:6379> linsert key before|after item newitem \u5728\u6307\u5b9a\u5143\u7d20\u7684\u524d\u9762\u6216\u8005\u540e\u9762\u6dfb\u52a0\u65b0\u5143\u7d20 lrem key count value \u5220\u9664\u6307\u5b9a\u4e2a\u6570\u503c\u4e3a value \u7684\u5143\u7d20 count = 0 :\u5220\u9664\u6240\u6709\u503c\u4e3a value \u7684\u5143\u7d20 count > 0 :\u4ece\u5de6\u5230\u53f3\u5220\u9664 count \u4e2a\u503c\u4e3a value \u7684\u5143\u7d20 count < 0 :\u4ece\u53f3\u5230\u505a\u5220\u9664 |count| \u4e2a\u503c\u4e3a value \u7684\u5143\u7d20 ltrim key start end \u4fdd\u7559\u6307\u5b9a\u8303\u56f4\u7684\u5143\u7d20 lset key index newValue \u66f4\u65b0\u67d0\u4e2a\u7d22\u5f15\u7684\u503c 127.0.0.1:6379> lrange userlist 0 -1 1) \"jane\" 2) \"jacob\" 127.0.0.1:6379> linsert userlist before jacob jake (integer) 3 127.0.0.1:6379> lrange userlist 0 -1 1) \"jane\" 2) \"jake\" 3) \"jacob\" 127.0.0.1:6379> linsert userlist after jacob john (integer) 4 127.0.0.1:6379> lrange userlist 0 -1 1) \"jane\" 2) \"jake\" 3) \"jacob\" 4) \"john\" 127.0.0.1:6379> lrem userlist 0 jacob (integer) 1 127.0.0.1:6379> lrange userlist 0 -1 1) \"jane\" 2) \"jake\" 3) \"john\" 127.0.0.1:6379> lpush userlist jacob (integer) 4 127.0.0.1:6379> lrange userlist 0 -1 1) \"jacob\" 2) \"jane\" 3) \"jake\" 4) \"john\" 127.0.0.1:6379> lrange userlist 2 jane (error) ERR value is not an integer or out of range 127.0.0.1:6379> lrem userlist 2 jane (integer) 1 127.0.0.1:6379> lrange userlist 0 -1 1) \"jacob\" 2) \"jake\" 3) \"john\" 127.0.0.1:6379> lpush userlist jacob (integer) 4 127.0.0.1:6379> lrange userlist 0 -1 1) \"jacob\" 2) \"jacob\" 3) \"jake\" 4) \"john\" 127.0.0.1:6379> lrem userlist 2 jacob (integer) 2 127.0.0.1:6379> lrange userlist 0 -1 1) \"jake\" 2) \"john\" 127.0.0.1:6379> ltrim userlist 0 1 OK 127.0.0.1:6379> lrange userlist 0 -1 1) \"jake\" 2) \"john\" 127.0.0.1:6379> lset userlist 0 jason OK 127.0.0.1:6379> lrange userlist 0 -1 1) \"jason\" 2) \"john\" blpop key timeout \u6ca1\u6709\u5219\u963b\u585e( timeout \u6307\u5b9a\u963b\u585e\u65f6\u95f4 \u4e3a 0 \u4ee3\u8868\u6c38\u4e45) brpop key timeout \u6ca1\u6709\u5219\u963b\u585e( timeout \u6307\u5b9a\u963b\u585e\u65f6\u95f4 \u4e3a 0 \u4ee3\u8868\u6c38\u4e45) \u8fd9\u4e24\u4e2a\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0\u6d88\u8d39\u8005\u751f\u4ea7\u8005 127.0.0.1:6379> lpush messagelist message1 #\u751f\u4ea7\u8005\u5b58\u5165\u6d88\u606f (integer) 1 127.0.0.1:6379> lpush messagelist message2 (integer) 2 127.0.0.1:6379> rpop messagelist #\u6d88\u8d39\u8005\u83b7\u5f97\u6d88\u606f \"message1\" 127.0.0.1:6379> brpop messagelist 0 #\u6d88\u8d39\u8005\u83b7\u5f97\u6d88\u606f\uff08\u6b64\u65f6\u4e3a\u7a7a\u963b\u585e\uff09 1) \"messagelist\" # \u6b64\u65f6\u76d1\u542c\u5230\u6709\u6d88\u606f\u8fd4\u56de 2) \"message2\" \u603b\u7ed3\u6765\u8bf4\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 \u5de6\u5165\u53c8\u51fa\u6216\u8005\u53f3\u5165\u5de6\u51fa \u6765\u5b9e\u73b0\u961f\u5217\uff0c\u5de6\u5165\u5de6\u51fa\u6216\u8005\u53f3\u5165\u53f3\u51fa \u6765\u5b9e\u73b0\u6808 \u3002 lpush + lpop = Stack rpush + rpop = Stack** lpush + rpop = Queue rpush + lpop = Queue lpush/rpush + ltrim = Capped List (\u5b9a\u957f\u5217\u8868) lpush + brpop = Message Queue (\u6d88\u606f\u961f\u5217) rpush + blpop = Message Queue (\u6d88\u606f\u961f\u5217) set Redis \u4e2d\u7684 set \u76f8\u5f53\u4e8e Java \u4e2d\u7684 HashSet(\u65e0\u5e8f\u96c6\u5408 )\uff0c\u5176\u4e2d\u91cc\u9762\u7684\u5143\u7d20 \u4e0d\u53ef\u4ee5\u91cd\u590d \uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u5b83\u5b9e\u73b0\u4e00\u4e9b\u53bb\u91cd\u7684\u529f\u80fd\u3002\u6211\u4eec\u8fd8\u6709\u5bf9\u51e0\u4e2a\u96c6\u5408\u8fdb\u884c \u53d6\u4ea4\u96c6\uff0c\u53d6\u5e76\u96c6 \u7b49\u64cd\u4f5c\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u5c31\u53ef\u4ee5\u83b7\u53d6\u4e0d\u540c\u7528\u6237\u4e4b\u95f4\u7684\u5171\u540c\u597d\u53cb\uff0c\u5171\u540c\u7231\u597d\u7b49\u7b49\u3002 \u4e0b\u9762\u6211\u4eec\u5c31\u6765\u770b\u4e00\u4e0b\u5173\u4e8e set \u7684\u4e00\u4e9b\u57fa\u672c\u64cd\u4f5c\u3002 sadd key value \u6dfb\u52a0\u5143\u7d20 sdel key value \u5220\u9664\u67d0\u4e2a\u5143\u7d20 sismember key value \u5224\u65ad\u662f\u5426\u662f\u96c6\u5408\u4e2d\u7684\u5143\u7d20 srandmember key count \u968f\u673a\u83b7\u53d6\u6307\u5b9a\u4e2a\u6570\u7684\u5143\u7d20(\u4e0d\u4f1a\u5f71\u54cd\u96c6\u5408\u7ed3\u6784) spop key count \u4ece\u96c6\u5408\u4e2d\u968f\u673a\u5f39\u51fa\u5143\u7d20(\u4f1a\u7834\u574f\u7ed3\u5408\u7ed3\u6784) smembers key \u83b7\u53d6\u96c6\u5408\u6240\u6709\u5143\u7d20 O(n) \u590d\u6742\u5ea6 scard key \u83b7\u53d6\u96c6\u5408\u4e2a\u6570 127.0.0.1:6379> sadd userset jacob (integer) 1 127.0.0.1:6379> sadd userset jacob (integer) 0 127.0.0.1:6379> sadd userset jane (integer) 1 127.0.0.1:6379> sismember userset john (integer) 0 127.0.0.1:6379> sismember userset jacob (integer) 1 127.0.0.1:6379> sismember userset 1 (integer) 0 127.0.0.1:6379> srandmember userset 1 1) \"jacob\" 127.0.0.1:6379> smembers userset 1) \"jacob\" 2) \"jane\" 127.0.0.1:6379> spop userset 1 1) \"jane\" 127.0.0.1:6379> smembers userset 1) \"jacob\" 127.0.0.1:6379> scard userset (integer) 1 sinter set1 set2 ... \u83b7\u53d6\u6240\u6709\u96c6\u5408\u4e2d\u7684\u4ea4\u96c6 sdiff set1 set2 ... \u83b7\u53d6\u6240\u6709\u96c6\u5408\u4e2d\u7684\u5dee\u96c6 sunion set1 set2 ... \u83b7\u53d6\u6240\u6709\u96c6\u5408\u4e2d\u7684\u5e76\u96c6 127.0.0.1:6379> sadd set1 jacob jane john (integer) 3 127.0.0.1:6379> sadd set2 jason jake jane (integer) 3 127.0.0.1:6379> sdiff set1 set2 1) \"jacob\" 2) \"john\" 127.0.0.1:6379> sunion set1 set2 1) \"jane\" 2) \"john\" 3) \"jake\" 4) \"jacob\" 5) \"jason\" zset Redis \u4e2d\u7684 zset \u662f\u4e00\u4e2a \u6709\u5e8f\u96c6\u5408 \uff0c\u901a\u8fc7\u5b83\u53ef\u4ee5\u5b9e\u73b0\u5f88\u591a\u6709\u610f\u601d\u7684\u529f\u80fd\uff0c\u6bd4\u5982\u5b66\u751f\u6210\u7ee9\u6392\u884c\u699c\uff0c\u89c6\u9891\u64ad\u653e\u91cf\u6392\u884c\u699c\u7b49\u7b49\u3002 zset \u4e2d\u662f\u4f7f\u7528 \u8df3\u8868 \u6765\u5b9e\u73b0\u7684\uff0c\u6211\u4eec\u77e5\u9053\u53ea\u6709\u6570\u7ec4\u8fd9\u79cd\u8fde\u7eed\u7684\u7a7a\u95f4\u624d\u80fd\u4f7f\u7528 \u4e8c\u5206\u67e5\u627e \u8fdb\u884c\u5feb\u901f\u7684\u5b9a\u4f4d\uff0c\u800c\u94fe\u8868\u662f\u4e0d\u53ef\u4ee5\u7684\u3002\u8df3\u8868\u5e2e\u52a9\u94fe\u8868\u67e5\u627e\u7684\u65f6\u5019\u8282\u7701\u4e86\u5f88\u591a\u65f6\u95f4(\u4f7f\u7528\u8df3\u7684\u65b9\u5f0f\u6765\u904d\u5386\u7d22\u5f15\u6765\u8fdb\u884c\u6709\u5e8f\u63d2\u5165)\uff0c\u5982\u679c\u4e0d\u4e86\u89e3\u8df3\u8868\u7684\u540c\u5b66\u53ef\u4ee5\u8865\u4e60\u4e00\u4e0b\u3002 \u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u5173\u4e8e zset \u7684\u4e00\u4e9b\u57fa\u672c\u64cd\u4f5c\u3002 zadd key score element \u6dfb\u52a0\uff0cscore\u7528\u4e8e\u6392\u5e8f\uff0cvalue\u9700\u8981\u552f\u4e00\uff0c\u7531\u4e8e\u4f7f\u7528\u7684\u8df3\u8868\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(logn)\u3002 zrem key element \u5220\u9664\u67d0\u5143\u7d20 O(1)\u65f6\u95f4\u590d\u6742\u5ea6 zscore key element \u83b7\u53d6\u67d0\u4e2a\u5143\u7d20\u7684\u5206\u6570 zincrby key incrScore element \u589e\u52a0\u67d0\u4e2a\u5143\u7d20\u7684\u5206\u6570 zrange key start end [withscores] \u83b7\u53d6\u6307\u5b9a\u7d22\u5f15\u8303\u56f4\u7684\u5143\u7d20 \u52a0\u4e0a withscores \u5219\u8fd4\u56de\u5206\u6570 O(logn + m)\u65f6\u95f4\u590d\u6742\u5ea6 zrangebyscore key minScore maxScore [withscores] \u83b7\u53d6\u6307\u5b9a\u5206\u6570\u8303\u56f4\u7684\u5143\u7d20 \u52a0\u4e0awithscores\u5219\u8fd4\u56de\u5206\u6570\uff0c O(logn + m)\u65f6\u95f4\u590d\u6742\u5ea6 zcard key \u83b7\u53d6\u6709\u5e8f\u96c6\u5408\u957f\u5ea6 127.0.0.1:6379> zadd mathTest 88 mike (integer) 1 127.0.0.1:6379> zadd mathTest 99 tony (integer) 1 127.0.0.1:6379> zadd mathTest 66 zend (integer) 1 127.0.0.1:6379> zadd mathTest 77 yake (integer) 1 127.0.0.1:6379> zrange mathTest 0 -1 1) \"zend\" 2) \"yake\" 3) \"mike\" 4) \"tony\" 127.0.0.1:6379> zrangebyscore mathTest 0 100 1) \"zend\" 2) \"yake\" 3) \"mike\" 4) \"tony\" 127.0.0.1:6379> zincrby mathTest 10 yake \"87\" 127.0.0.1:6379> zrange mathTest 0 -1 1) \"zend\" 2) \"yake\" 3) \"mike\" 4) \"tony\" 127.0.0.1:6379> zrange mathTest 0 -1 withscores 1) \"zend\" 2) \"66\" 3) \"yake\" 4) \"87\" 5) \"mike\" 6) \"88\" 7) \"tony\" 8) \"99\" 127.0.0.1:6379> zrem mathTest zend (integer) 1 127.0.0.1:6379> zcard mathTest (integer) 3 Redis \u4e2d\u7684\u4e8b\u52a1\u548c\u7ba1\u9053 \u7ba1\u9053 Pipeline \u5728\u67d0\u4e9b\u573a\u666f\u4e0b\u6211\u4eec\u5728 \u4e00\u6b21\u64cd\u4f5c\u4e2d\u53ef\u80fd\u9700\u8981\u6267\u884c\u591a\u4e2a\u547d\u4ee4 \uff0c\u800c\u5982\u679c\u6211\u4eec\u53ea\u662f\u4e00\u4e2a\u547d\u4ee4\u4e00\u4e2a\u547d\u4ee4\u53bb\u6267\u884c\u5219\u4f1a\u6d6a\u8d39\u5f88\u591a\u7f51\u7edc\u6d88\u8017\u65f6\u95f4\uff0c\u5982\u679c\u5c06\u547d\u4ee4\u4e00\u6b21\u6027\u4f20\u8f93\u5230 Redis \u4e2d\u53bb\u518d\u6267\u884c\uff0c\u5219\u4f1a\u51cf\u5c11\u5f88\u591a\u5f00\u9500\u65f6\u95f4\u3002 \u4f46\u662f\u9700\u8981\u6ce8\u610f\u7684\u662f pipeline \u4e2d\u7684\u547d\u4ee4\u5e76\u4e0d\u662f\u539f\u5b50\u6027\u6267\u884c\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u7ba1\u9053\u4e2d\u7684\u547d\u4ee4\u5230\u8fbe Redis \u670d\u52a1\u5668\u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u88ab\u5176\u4ed6\u7684\u547d\u4ee4\u7a7f\u63d2\u3002 \u4e8b\u52a1 \u5173\u7cfb\u578b\u6570\u636e\u5e93\u5177\u6709 ACID \u7279\u6027\uff0c Redis \u80fd\u4fdd\u8bc1 A\uff08\u539f\u5b50\u6027\uff09\u548cI\uff08\u9694\u79bb\u6027\uff09 \uff0cD\uff08\u6301\u4e45\u6027\uff09\u770b\u662f\u5426\u6709\u914d\u7f6e RDB \u6216\u8005 AOF \u6301\u4e45\u5316\u64cd\u4f5c \uff0c\u4f46\u65e0\u6cd5\u4fdd\u8bc1\u4e00\u81f4\u6027\uff0c\u56e0\u4e3a Redis \u4e8b\u52a1\u4e0d\u652f\u6301\u56de\u6eda \u3002 \u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a Redis \u4e2d\u7684\u4e8b\u52a1\u53ea\u662f\u6bd4 Pipeline \u591a\u4e86\u4e2a\u539f\u5b50\u6027\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u4e0d\u4f1a\u88ab\u5176\u4ed6\u547d\u4ee4\u7ed9\u5206\u5272\uff0c\u5982\u4e0a\u56fe\u3002 multi \u4e8b\u52a1\u5f00\u59cb\u7684\u6807\u5fd7 exec \u4e8b\u52a1\u6267\u884c 127.0.0.1:6379> multi #\u5f00\u59cb\u6267\u884c OK 127.0.0.1:6379> zadd userset 88 jake # \u6dfb\u52a0\u64cd\u4f5c QUEUED 127.0.0.1:6379> zrange userset 0 -1 #\u63d0\u4ea4 QUEUED 127.0.0.1:6379> exec discard \u6e05\u9664\u5728\u8fd9\u4e2a\u4e8b\u52a1\u4e2d\u653e\u5165\u961f\u5217\u7684\u6240\u6709\u547d\u4ee4\uff0c\u5373\u89e3\u9664\u6574\u4e2a\u4e8b\u52a1\u3002 watch key \u5728\u4e8b\u52a1\u5f00\u59cb\u524d\u76d1\u63a7\u67d0\u4e2a\u5143\u7d20\uff0c\u5982\u679c\u5728\u63d0\u4ea4\u4e8b\u52a1\u7684\u65f6\u5019\u53d1\u73b0\u8fd9\u4e2a\u5143\u7d20\u7684\u503c\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u66f4\u6539\u4e86\u5219\u4e8b\u52a1\u4f1a\u8fd0\u884c\u5931\u8d25\u3002 unwatch key \u89e3\u9664\u76d1\u63a7","title":"Redis \u57fa\u7840\u4f60\u638c\u63e1\u591a\u5c11\u4e86\uff1f\u6765\u4e2a\u67e5\u6f0f\u8865\u7f3a"},{"location":"chap10/3Redis_basic/#redis","text":"Redis \u662f\u5f00\u6e90\uff0c\u5185\u5b58\u4e2d\u7684\u6570\u636e\u7ed3\u6784\u5b58\u50a8\u7cfb\u7edf\uff0c\u5b83\u53ef\u4ee5\u7528 \u4f5c\u6570\u636e\u5e93\u3001\u7f13\u5b58\u548c\u6d88\u606f\u4e2d\u95f4\u4ef6 \u3002 \u5b83\u652f\u6301\u591a\u79cd\u7c7b\u578b\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5982\u5b57\u7b26\u4e32 strings \uff0c\u6563\u5217 hashes \uff0c\u5217\u8868 lists \uff0c\u96c6\u5408 sets \uff0c\u6709\u5e8f\u96c6\u5408 sorted sets \u4e0e\u8303\u56f4\u67e5\u8be2\uff0c bitmaps \uff0c hyperloglogs \u548c \u5730\u7406\u7a7a\u95f4\uff08geospatial\uff09\u7d22\u5f15\u534a\u5f84\u67e5\u8be2\u3002 Redis \u8fd8\u5185\u7f6e\u4e86\u590d\u5236\uff08 replication \uff09\uff0cLUA\u811a\u672c\uff08 Lua scripting \uff09\uff0c LRU\u9a71\u52a8\u4e8b\u4ef6\uff08 LRU eviction \uff09\uff0c\u4e8b\u52a1\uff08 transactions \uff09\u548c\u4e0d\u540c\u7ea7\u522b\u7684\u78c1\u76d8\u6301\u4e45\u5316\uff08 persistence \uff09\uff0c\u5e76\u901a\u8fc7 Redis \u54e8\u5175\uff08 Sentinel \uff09\u548c\u81ea\u52a8\u5206\u533a\uff08 Cluster \uff09\u63d0\u4f9b\u9ad8\u53ef\u7528\u6027\uff08 high availability \uff09 \u3002","title":"Redis \u57fa\u7840\u4f60\u638c\u63e1\u591a\u5c11\u4e86\uff1f\u6765\u4e2a\u67e5\u6f0f\u8865\u7f3a"},{"location":"chap10/3Redis_basic/#nosql","text":"\u6211\u4eec\u77e5\u9053 Redis \u662f\u4e00\u79cd\u975e\u5173\u7cfb\u578b\u6570\u636e\u5e93 NoSQL\u3002\u800c\u4e3a\u4ec0\u4e48\u51fa\u73b0 NoSQL\uff1fNoSQL \u53c8\u662f\u4ec0\u4e48\u5462\uff1f \u5355\u673a\u6570\u636e\u5e93\u7684\u5e74\u4ee3 \u5728\u4e00\u4e2a\u7f51\u7ad9\u8bbf\u95ee\u91cf\u4e0d\u5927\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u6570\u636e\u5e93\u5c31\u8db3\u4ee5\u5e94\u5bf9\u6d41\u91cf\u8bf7\u6c42\u3002 \u7f13\u5b58 + \u62c6\u5206 \u968f\u7740\u8bbf\u95ee\u91cf\u7684\u4e0a\u5347\uff0c\u4e00\u4e2a\u6570\u636e\u5e93\u5df2\u7ecf\u4e0d\u80fd\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u6c42\u4e86\u3002\u4e3a\u4e86\u66f4\u9ad8\u7684\u6027\u80fd\uff0c\u6211\u4eec\u5728\u4e2d\u95f4\u52a0\u4e0a\u4e86\u4e00\u4e2a\u7f13\u5b58\u5c42\u5e76\u4e14\u5c06\u6570\u636e\u5e93\u505a\u4e86 \u96c6\u7fa4\u3001\u7ed3\u6784\u4f18\u5316\u548c\u8bfb\u5199\u5206\u79bb \u3002 \u800c\u8fd9\u91cc\u7684\u7f13\u5b58\u5c31\u662f NoSQL \uff0c\u5f53\u7136\u505a\u7f13\u5b58\u4e5f\u53ea\u662f NoSQL \u7684\u4e00\u79cd\u529f\u80fd\uff0c\u5c31\u50cf Redis \u5e76\u4e0d\u4ec5\u4ec5\u6709\u7f13\u5b58\u8fd9\u4e00\u79cd\u529f\u80fd\u3002 \u6bd4\u5982\u5b83\u8fd8\u80fd\u5b9e\u73b0 \u7b80\u5355\u7684\u6d88\u606f\u961f\u5217\uff0c\u89e3\u51b3 Session \u5171\u4eab\uff0c\u8ba1\u6570\u5668\uff0c\u6392\u884c\u699c\uff0c\u597d\u53cb\u5173\u7cfb\u5904\u7406 \u7b49\u7b49\u529f\u80fd\uff0c\u53ef\u89c1 Redis \u662f\u4e00\u4e2a\u975e\u5e38\u5f3a\u5927\u5de5\u5177\uff0c\u8ba9\u6211\u4eec\u6765\u5b66\u4e60\u5b83\u5427\uff01","title":"NoSQL \u662f\u4ec0\u4e48"},{"location":"chap10/3Redis_basic/#redis_1","text":"\u9996\u5148\u6211\u4eec\u629b\u5f00\u6570\u636e\u7c7b\u578b\u6765\u8bb2\u5173\u4e8e Redis \u7684\u901a\u7528\u547d\u4ee4\u3002 \u64cd\u4f5c key \u548c value Redis \u662f\u4e00\u79cd key value \u5b58\u50a8\u7684\u7f13\u5b58\u6570\u636e\u5e93\uff0c\u6240\u6709\u7684\u6570\u636e\u90fd\u6709\u4e00\u4e2a\u81ea\u5df1\u552f\u4e00\u7684 key \u3002 \u8fd9\u91cc\u4e3a\u4e86\u65b9\u4fbf\u6f14\u793a\uff0c\u6211\u4f7f\u7528\u4e86\u5b57\u7b26\u4e32\u76f8\u5173\u7684\u8bbe\u7f6e\u547d\u4ee4\u3002 keys [pattern] \u83b7\u53d6\u7b26\u5408\u8981\u6c42\u7684\u6240\u6709 key \u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(n) \uff0c\u4e00\u822c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4e0d\u4f7f\u7528\uff0c\u56e0\u4e3a Redis \u662f\u5355\u7ebf\u7a0b \u7684\uff0c \u6267\u884c\u8017\u65f6\u7684\u4efb\u52a1\u4f1a\u963b\u585e\u5176\u4ed6\u4efb\u52a1 \u3002\u4e00\u822c\u4f1a\u4f7f\u7528 scan \u547d\u4ee4\u66ff\u4ee3\uff08\u975e\u963b\u585e\uff09\u3002 $ kubectl exec -it redis redis-cli -n redis 127.0.0.1:6379> keys * (empty list or set) 127.0.0.1:6379> set username jxi OK 127.0.0.1:6379> keys * 1) \"username\" 127.0.0.1:6379> set username1 jane OK 127.0.0.1:6379> keys * 1) \"username1\" 2) \"username\" 127.0.0.1:6379> keys u* 1) \"username1\" 2) \"username\" 127.0.0.1:6379> keys username1* 1) \"username1\" dbsize \u83b7\u53d6\u5f53\u524d\u5b58\u50a8\u6570\u636e\u4e2a\u6570\u3002 exists key \u5224\u65ad\u662f\u5426\u5b58\u5728\u8be5key del key \u5220\u9664\u6307\u5b9a\u6570\u636e type key \u83b7\u53d6\u6307\u5b9akey\u7684\u6570\u636e\u7c7b\u578b rename key newkey \u91cd\u547d\u540d 127.0.0.1:6379> dbsize (integer) 2 127.0.0.1:6379> exists username (integer) 1 127.0.0.1:6379> exists user (integer) 0 127.0.0.1:6379> del username (integer) 1 127.0.0.1:6379> keys * 1) \"username1\" 127.0.0.1:6379> type username1 string 127.0.0.1:6379> rename username1 username OK 127.0.0.1:6379> keys * 1) \"username\"","title":"Redis \u901a\u7528\u547d\u4ee4"},{"location":"chap10/3Redis_basic/#_1","text":"Redis \u4e2d\u5f88\u591a\u6570\u636e\u90fd\u662f\u7528\u6765\u4f5c\u4e3a \u7f13\u5b58\u6570\u636e \u7684\uff0c\u800c\u4f5c\u4e3a\u7f13\u5b58\u5c31\u9700\u8981\u6709\u8fc7\u671f\u65f6\u95f4\uff0c\u5728 Redis \u4e2d\u63d0\u4f9b\u4e86\u5f88\u5f3a\u5927\u7684 \u8fc7\u671f\u65f6\u95f4 \u8bbe\u7f6e\u529f\u80fd\u3002 expire key seconds \u4e3a\u67d0\u4e2a key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002 ttl key \u67e5\u770b\u67d0\u4e2a key \u7684\u5269\u4f59\u65f6\u95f4\uff0c\u8fd4\u56de\u6b63\u6570\u4ee3\u8868\u5269\u4f59\u7684\u65f6\u95f4\uff0c -1 \u4ee3\u8868\u6c38\u4e45\uff0c -2 \u4ee3\u8868\u5df2\u8fc7\u671f\u6216\u4e0d\u5b58\u5728\u3002 127.0.0.1:6379> expire username 10 (integer) 1 127.0.0.1:6379> ttl username (integer) 6 127.0.0.1:6379> ttl username (integer) 4 127.0.0.1:6379> ttl username (integer) 3 127.0.0.1:6379> ttl username (integer) 2 127.0.0.1:6379> ttl username (integer) 1 127.0.0.1:6379> ttl username (integer) -2 127.0.0.1:6379> set ttl 123 OK 127.0.0.1:6379> ttl ttl (integer) -1","title":"\u8fc7\u671f\u65f6\u95f4"},{"location":"chap10/3Redis_basic/#redis_2","text":"\u5728\u4e0a\u9762\u6211\u8bf4\u5230\u4e86\u5f88\u591a Redis \u4f5c\u4e3a\u7f13\u5b58\u80fd\u5b9e\u73b0\u7684\u5176\u4ed6\u529f\u80fd\uff0c\u6bd4\u5982\u8ba1\u6570\u5668\uff0c\u6392\u884c\u699c\uff0c\u597d\u53cb\u5173\u7cfb\u7b49\uff0c\u8fd9\u4e9b\u5b9e\u73b0\u7684\u4f9d\u636e\u5c31\u662f\u9760\u7740 Redis \u7684\u6570\u636e\u7ed3\u6784\u3002\u5728\u6574\u4e2a Redis \u4e2d\u4e00\u5171\u6709\u4e94\u79cd\u57fa\u672c\u7684\u6570\u636e\u7ed3\u6784(\u8fd8\u6709\u4e9b\u9ad8\u7ea7\u6570\u636e\u7ed3\u6784\u4ee5\u540e\u4f1a\u8bb2)\uff0c\u4ed6\u4eec\u5206\u522b\u662f \u5b57\u7b26\u4e32 strings \uff0c \u6563\u5217 hashes \uff0c \u5217\u8868 lists \uff0c \u96c6\u5408 sets \uff0c \u6709\u5e8f\u96c6\u5408 sorted sets \u3002","title":"Redis \u7684\u4e94\u79cd\u57fa\u672c\u6570\u636e\u7c7b\u578b"},{"location":"chap10/3Redis_basic/#string","text":"\u5728\u7edd\u5927\u90e8\u5206\u7f16\u7a0b\u8bed\u8a00\u4e2d\u90fd\u6709 String \u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u5bf9\u4e8e\u4f5c\u4e3a\u6570\u636e\u5e93\u7684 Redis \u4e5f\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u3002 set key value \u8bbe\u7f6e\u503c get key \u83b7\u53d6\u67d0\u4e2a key \u7684\u503c mset key1 value1 key2 value2 \u6279\u91cf\u8bbe\u7f6e\u5e76\u4e14\u662f \u539f\u5b50 \u7684\uff0c\u53ef\u4ee5\u7528\u6765\u51cf\u5c11\u7f51\u7edc\u65f6\u95f4\u6d88\u8017 mget key1 key2 \u6279\u91cf\u83b7\u53d6\u5e76\u4e14\u662f\u539f\u5b50\u7684\uff0c\u53ef\u4ee5\u7528\u6765\u51cf\u5c11\u7f51\u7edc\u65f6\u95f4\u6d88\u8017 127.0.0.1:6379> set username1 Jane OK 127.0.0.1:6379> set username2 Jacob OK 127.0.0.1:6379> del username2 (integer) 1 127.0.0.1:6379> mset username2 Jacob username3 Jason OK 127.0.0.1:6379> get username1 \"Jane\" 127.0.0.1:6379> mget username1 username2 username3 1) \"Jane\" 2) \"Jacob\" 3) \"Jason\" incr key \u81ea\u589e\u6307\u5b9akey\u7684\u503c decr key \u81ea\u51cf\u6307\u5b9akey\u7684\u503c incrby key value \u81ea\u589e\u6307\u5b9a\u6570\u503c decrby key value \u81ea\u51cf\u6307\u5b9a\u6570\u503c incrbyfloat key floatvalue \u589e\u52a0\u6307\u5b9a\u6d6e\u70b9\u6570,\u524d\u9762\u51e0\u4e2a\u64cd\u4f5c\u5c31\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0 \u8ba1\u6570\u5668 \u7684\u529f\u80fd\u3002 127.0.0.1:6379> set counter 1 OK 127.0.0.1:6379> incr counter (integer) 2 127.0.0.1:6379> decr counter (integer) 1 127.0.0.1:6379> get counter \"1\" 127.0.0.1:6379> incrby counter 99 (integer) 100 127.0.0.1:6379> get counter \"100\" 127.0.0.1:6379> decrby counter 100 (integer) 0 127.0.0.1:6379> get counter \"0\" 127.0.0.1:6379> incrbyfloat counter 0.5 \"0.5\" 127.0.0.1:6379> get counter \"0.5\" setnx key value \u5982\u679c\u4e0d\u5b58\u5728\u8be5 key \u5219\u53ef\u4ee5\u8bbe\u7f6e\u6210\u529f\uff0c\u5426\u5219\u4f1a\u5931\u8d25 \uff0c \u52a0\u4e0a\u8fc7\u671f\u65f6\u95f4\u9650\u5236\uff0c\u5219\u662fredis\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u7684\u4e00\u79cd\u65b9\u5f0f \uff08\u540e\u9762\u4f1a\u63d0\u5230\uff09 \u3002 set key value xx \u4e0e\u524d\u9762\u76f8\u53cd\uff0c\u5982\u679c\u5b58\u5728\u5219\u8bbe\u7f6e\u6210\u529f \uff0c\u5426\u5219\u5931\u8d25(\u76f8\u5f53\u4e8e\u66f4\u65b0\u64cd\u4f5c) 27.0.0.1:6379> keys * 1) \"username2\" 2) \"counter\" 3) \"ttl\" 4) \"username3\" 5) \"username1\" 127.0.0.1:6379> setnx username1 tt (integer) 0 127.0.0.1:6379> get username1 \"Jane\" 127.0.0.1:6379> setnx username4 john (integer) 1 127.0.0.1:6379> get username4 \"john\" 127.0.0.1:6379> set username5 jack xx (nil) 127.0.0.1:6379> get username5 (nil) 127.0.0.1:6379> set username4 jack xx OK 127.0.0.1:6379> get username4 \"jack\" getset key newvalue \u8bbe\u7f6e\u65b0\u503c\u5e76\u8fd4\u56de\u65e7\u503c append key value \u4e3a\u539f\u672c\u5185\u5bb9\u8ffd\u52a0\u5185\u5bb9 strlen key \u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6 getrange key start end \u83b7\u53d6\u6307\u5b9a\u8303\u56f4\u7684\u5185\u5bb9 setrange key index value \u8bbe\u7f6e\u6307\u5b9a\u8303\u56f4\u7684\u5185\u5bb9 127.0.0.1:6379> keys * 1) \"username4\" 2) \"username2\" 3) \"counter\" 4) \"ttl\" 5) \"username3\" 6) \"username1\" 127.0.0.1:6379> get username1 \"Jane\" 127.0.0.1:6379> getset username1 JaneDoe \"Jane\" 127.0.0.1:6379> get username1 \"JaneDoe\" 127.0.0.1:6379> append username1 love (integer) 11 127.0.0.1:6379> get username1 \"JaneDoelove\" 127.0.0.1:6379> strlen username1 (integer) 11 127.0.0.1:6379> getrange username1 0 5 \"JaneDo\" 127.0.0.1:6379> setrange username1 5 s (integer) 11 127.0.0.1:6379> get username1 \"JaneDselove\" setex key seconds value \u8bbe\u7f6e\u503c\u4e14\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4 set key value ex seconds nx \u4e3a\u4e0d\u5b58\u5728\u7684 key \u8bbe\u7f6e\u503c\u4e14\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c \u5206\u5e03\u5f0f\u9501\u7684\u5b9e\u73b0\u65b9\u5f0f \u3002 127.0.0.1:6379> keys * 1) \"username4\" 2) \"username2\" 3) \"counter\" 4) \"ttl\" 5) \"username3\" 6) \"username1\" 127.0.0.1:6379> setex user 10 jac OK 127.0.0.1:6379> ttl user (integer) 6 127.0.0.1:6379> ttl user (integer) 2 127.0.0.1:6379> set user1 snow ex seconds nx OK 127.0.0.1:6379> ttl user1 (integer) 5 127.0.0.1:6379> ttl user1 (integer) 2 127.0.0.1:6379> set username1 snow ex 10 nx (nil)","title":"\u5b57\u7b26\u4e32 string"},{"location":"chap10/3Redis_basic/#hash","text":"\u5176\u5b9e\u6211\u4eec\u53ef\u4ee5\u7406\u89e3 hash \u4e3a \u5c0f\u578bRedis \uff0c Redis \u5728\u5e95\u5c42\u5b9e\u73b0\u4e0a\u548c Java \u4e2d\u7684 HashMap \u5dee\u4e0d\u591a\uff0c\u90fd\u662f\u4f7f\u7528 \u6570\u7ec4 + \u94fe\u8868 \u7684\u4e8c\u7ef4\u7ed3\u6784\u5b9e\u73b0\u7684\u3002 \u4e0d\u540c\u7684\u662f\uff0c\u5728 Redis \u4e2d\u5b57\u5178\u7684\u503c \u53ea\u80fd\u662f\u5b57\u7b26\u4e32 \uff0c\u800c\u4e14\u4ed6\u4eec rehash \u7684\u65b9\u5f0f\u4e0d\u4e00\u6837\uff0c\u5728 Redis \u4e2d\u4f7f\u7528\u7684\u662f \u6e10\u8fdb\u5f0frehash \u3002 \u5728 rehash \u7684\u65f6\u5019\u4f1a\u4fdd\u7559\u65b0\u65e7\u4e24\u4e2a hash \u5b57\u5178\uff0c\u5728\u6570\u636e\u8fc1\u79fb\u7684\u65f6\u5019\u4f1a\u5c06\u65e7\u5b57\u5178\u4e2d\u7684\u5185\u5bb9\u4e00\u70b9\u4e00\u70b9\u8fc1\u79fb\u5230\u65b0\u5b57\u5178\u4e2d\uff0c\u67e5\u8be2\u7684\u540c\u65f6\u4f1a\u67e5\u8be2\u4e24\u4e2a hash \u5b57\u5178\uff0c\u7b49\u6570\u636e\u5168\u90e8\u8fc1\u79fb\u5b8c\u6210\u624d\u4f1a\u5c06\u65b0\u5b57\u5178\u4ee3\u66ff\u5c31\u5b57\u5178\u3002 \u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u5173\u4e8e hash \u7684\u57fa\u672c\u64cd\u4f5c\u3002 hset key field value \u8bbe\u7f6e\u5b57\u5178\u4e2d\u67d0\u4e2a key \u7684\u503c hsetnx key field value \u8bbe\u7f6e\u5b57\u5178\u4e2d\u67d0\u4e2a key \u7684\u503c(\u4e0d\u5b58\u5728\u7684) hmset key field1 value1 field2 value2 ... \u6279\u91cf\u8bbe\u7f6e hget key field \u83b7\u53d6\u5b57\u5178\u4e2d\u67d0\u4e2akey\u7684\u503c hmget key field1 field2 \u6279\u91cf\u83b7\u53d6 hgetall key \u83b7\u53d6\u5168\u90e8 $ kubectl exec -it redis redis-cli -n redis 127.0.0.1:6379> hset userInfo name jacob (integer) 1 127.0.0.1:6379> hset userInfo name jane (integer) 0 127.0.0.1:6379> hsetnx userInfo name jane (integer) 0 127.0.0.1:6379> hsetnx userInfo qq 11111 (integer) 1 127.0.0.1:6379> hmset userInfo wecht we111 email 111@qq.com OK 127.0.0.1:6379> hget userInfo wecht \"we111\" 127.0.0.1:6379> hmget userInfo qq email 1) \"11111\" 2) \"111@qq.com\" 127.0.0.1:6379> hgetall userInfo 1) \"name\" 2) \"jane\" 3) \"qq\" 4) \"11111\" 5) \"wecht\" 6) \"we111\" 7) \"email\" 8) \"111@qq.com\" hdel key field \u5220\u9664\u67d0\u4e2a key hexists key field \u5224\u65ad\u662f\u5426\u5b58\u5728 hlen key \u83b7\u53d6\u6307\u5b9akey\u5bf9\u5e94\u7684\u5b57\u5178\u4e2d\u7684\u5b58\u50a8\u4e2a\u6570 hvals key \u8fd4\u56de\u6240\u6709\u7684 value hkeys key \u8fd4\u56de\u6240\u6709\u7684key 127.0.0.1:6379> hkeys userInfo 1) \"name\" 2) \"qq\" 3) \"wecht\" 4) \"email\" 127.0.0.1:6379> hdel userInfo name (integer) 1 127.0.0.1:6379> hkeys userInfo 1) \"qq\" 2) \"wecht\" 3) \"email\" 127.0.0.1:6379> hexists userInfo qq (integer) 1 127.0.0.1:6379> hlen userInfo (integer) 3 127.0.0.1:6379> hvals hvals (empty list or set) 127.0.0.1:6379> hvals userInfo 1) \"11111\" 2) \"we111\" 3) \"111@qq.com\" hincrby key field increValue \u589e\u52a0\u67d0\u4e2avalue\u7684\u503c(\u4e5f\u53ef\u4ee5\u589e\u52a0\u8d1f\u6570) hincrbyfloat key field floatValue \u589e\u52a0\u67d0\u4e2avalue\u7684\u503c(\u6d6e\u70b9\u6570) 127.0.0.1:6379> hset userInfo age 29 (integer) 1 127.0.0.1:6379> hincrby userInfo age 1 (integer) 30 127.0.0.1:6379> hget userInfo age \"30\" 127.0.0.1:6379> hincrbyfloat userInfo age 0.1 \"30.1\" 127.0.0.1:6379> hget userInfo age \"30.1\"","title":"hash"},{"location":"chap10/3Redis_basic/#list","text":"Redis \u4e2d\u7684\u5217\u8868\u76f8\u5f53\u4e8e Java \u4e2d\u7684 LinkedList (\u53cc\u5411\u94fe\u8868) \uff0c\u4e5f\u5c31\u662f\u5e95\u5c42\u662f\u901a\u8fc7 \u94fe\u8868 \u6765\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u5bf9\u4e8e list \u6765\u8bf4 \u63d2\u5165\u5220\u9664\u64cd\u4f5c\u5f88\u5feb\uff0c\u4f46 \u7d22\u5f15\u5b9a\u4f4d\u975e\u5e38\u6162 \u3002 Redis \u63d0\u4f9b\u4e86\u8bb8\u591a\u5bf9\u4e8e list \u7684\u64cd\u4f5c\uff0c\u5982 \u51fa\uff0c\u5165 \u7b49\u64cd\u4f5c\uff0c\u4f60\u53ef\u4ee5\u5145\u5206\u5229\u7528\u5b83\u4eec\u6765\u5b9e\u73b0\u4e00\u4e2a \u6808 \u6216\u8005 \u961f\u5217 \u3002 \u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u5173\u4e8e list \u7684\u57fa\u672c\u64cd\u4f5c\u3002 lpush key item1 item2 item3 ... \u4ece\u5de6\u5165\u6808 rpush key item1 item2 item3 ... \u4ece\u53f3\u5165\u6808 lpop key \u4ece\u5de6\u51fa\u6808 rpop key \u4ece\u53f3\u51fa\u6808 lindex key index \u83b7\u53d6\u6307\u5b9a\u7d22\u5f15\u7684\u5143\u7d20 O(n) \u8c28\u614e\u4f7f\u7528 lrange key start end \u83b7\u53d6\u6307\u5b9a\u8303\u56f4\u7684\u5143\u7d20 O(n) \u8c28\u614e\u4f7f\u7528 127.0.0.1:6379> lpush userlist jacob (integer) 1 127.0.0.1:6379> lpush userlist jane john (integer) 3 127.0.0.1:6379> lrange userlist 0 -1 # -1 \u4ee3\u8868\u672b\u5c3e 1) \"john\" 2) \"jane\" 3) \"jacob\" 127.0.0.1:6379> rpush userlist jake (integer) 4 127.0.0.1:6379> lrange userlist 0 -1 1) \"john\" 2) \"jane\" 3) \"jacob\" 4) \"jake\" 127.0.0.1:6379> lpop userlist \"john\" 127.0.0.1:6379> rpop userlist \"jake\" 127.0.0.1:6379> lrange userlist 0 -1 1) \"jane\" 2) \"jacob\" 127.0.0.1:6379> lindex userlist 1 \"jacob\" 127.0.0.1:6379> linsert key before|after item newitem \u5728\u6307\u5b9a\u5143\u7d20\u7684\u524d\u9762\u6216\u8005\u540e\u9762\u6dfb\u52a0\u65b0\u5143\u7d20 lrem key count value \u5220\u9664\u6307\u5b9a\u4e2a\u6570\u503c\u4e3a value \u7684\u5143\u7d20 count = 0 :\u5220\u9664\u6240\u6709\u503c\u4e3a value \u7684\u5143\u7d20 count > 0 :\u4ece\u5de6\u5230\u53f3\u5220\u9664 count \u4e2a\u503c\u4e3a value \u7684\u5143\u7d20 count < 0 :\u4ece\u53f3\u5230\u505a\u5220\u9664 |count| \u4e2a\u503c\u4e3a value \u7684\u5143\u7d20 ltrim key start end \u4fdd\u7559\u6307\u5b9a\u8303\u56f4\u7684\u5143\u7d20 lset key index newValue \u66f4\u65b0\u67d0\u4e2a\u7d22\u5f15\u7684\u503c 127.0.0.1:6379> lrange userlist 0 -1 1) \"jane\" 2) \"jacob\" 127.0.0.1:6379> linsert userlist before jacob jake (integer) 3 127.0.0.1:6379> lrange userlist 0 -1 1) \"jane\" 2) \"jake\" 3) \"jacob\" 127.0.0.1:6379> linsert userlist after jacob john (integer) 4 127.0.0.1:6379> lrange userlist 0 -1 1) \"jane\" 2) \"jake\" 3) \"jacob\" 4) \"john\" 127.0.0.1:6379> lrem userlist 0 jacob (integer) 1 127.0.0.1:6379> lrange userlist 0 -1 1) \"jane\" 2) \"jake\" 3) \"john\" 127.0.0.1:6379> lpush userlist jacob (integer) 4 127.0.0.1:6379> lrange userlist 0 -1 1) \"jacob\" 2) \"jane\" 3) \"jake\" 4) \"john\" 127.0.0.1:6379> lrange userlist 2 jane (error) ERR value is not an integer or out of range 127.0.0.1:6379> lrem userlist 2 jane (integer) 1 127.0.0.1:6379> lrange userlist 0 -1 1) \"jacob\" 2) \"jake\" 3) \"john\" 127.0.0.1:6379> lpush userlist jacob (integer) 4 127.0.0.1:6379> lrange userlist 0 -1 1) \"jacob\" 2) \"jacob\" 3) \"jake\" 4) \"john\" 127.0.0.1:6379> lrem userlist 2 jacob (integer) 2 127.0.0.1:6379> lrange userlist 0 -1 1) \"jake\" 2) \"john\" 127.0.0.1:6379> ltrim userlist 0 1 OK 127.0.0.1:6379> lrange userlist 0 -1 1) \"jake\" 2) \"john\" 127.0.0.1:6379> lset userlist 0 jason OK 127.0.0.1:6379> lrange userlist 0 -1 1) \"jason\" 2) \"john\" blpop key timeout \u6ca1\u6709\u5219\u963b\u585e( timeout \u6307\u5b9a\u963b\u585e\u65f6\u95f4 \u4e3a 0 \u4ee3\u8868\u6c38\u4e45) brpop key timeout \u6ca1\u6709\u5219\u963b\u585e( timeout \u6307\u5b9a\u963b\u585e\u65f6\u95f4 \u4e3a 0 \u4ee3\u8868\u6c38\u4e45) \u8fd9\u4e24\u4e2a\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0\u6d88\u8d39\u8005\u751f\u4ea7\u8005 127.0.0.1:6379> lpush messagelist message1 #\u751f\u4ea7\u8005\u5b58\u5165\u6d88\u606f (integer) 1 127.0.0.1:6379> lpush messagelist message2 (integer) 2 127.0.0.1:6379> rpop messagelist #\u6d88\u8d39\u8005\u83b7\u5f97\u6d88\u606f \"message1\" 127.0.0.1:6379> brpop messagelist 0 #\u6d88\u8d39\u8005\u83b7\u5f97\u6d88\u606f\uff08\u6b64\u65f6\u4e3a\u7a7a\u963b\u585e\uff09 1) \"messagelist\" # \u6b64\u65f6\u76d1\u542c\u5230\u6709\u6d88\u606f\u8fd4\u56de 2) \"message2\" \u603b\u7ed3\u6765\u8bf4\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 \u5de6\u5165\u53c8\u51fa\u6216\u8005\u53f3\u5165\u5de6\u51fa \u6765\u5b9e\u73b0\u961f\u5217\uff0c\u5de6\u5165\u5de6\u51fa\u6216\u8005\u53f3\u5165\u53f3\u51fa \u6765\u5b9e\u73b0\u6808 \u3002 lpush + lpop = Stack rpush + rpop = Stack** lpush + rpop = Queue rpush + lpop = Queue lpush/rpush + ltrim = Capped List (\u5b9a\u957f\u5217\u8868) lpush + brpop = Message Queue (\u6d88\u606f\u961f\u5217) rpush + blpop = Message Queue (\u6d88\u606f\u961f\u5217)","title":"list"},{"location":"chap10/3Redis_basic/#set","text":"Redis \u4e2d\u7684 set \u76f8\u5f53\u4e8e Java \u4e2d\u7684 HashSet(\u65e0\u5e8f\u96c6\u5408 )\uff0c\u5176\u4e2d\u91cc\u9762\u7684\u5143\u7d20 \u4e0d\u53ef\u4ee5\u91cd\u590d \uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u5b83\u5b9e\u73b0\u4e00\u4e9b\u53bb\u91cd\u7684\u529f\u80fd\u3002\u6211\u4eec\u8fd8\u6709\u5bf9\u51e0\u4e2a\u96c6\u5408\u8fdb\u884c \u53d6\u4ea4\u96c6\uff0c\u53d6\u5e76\u96c6 \u7b49\u64cd\u4f5c\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u5c31\u53ef\u4ee5\u83b7\u53d6\u4e0d\u540c\u7528\u6237\u4e4b\u95f4\u7684\u5171\u540c\u597d\u53cb\uff0c\u5171\u540c\u7231\u597d\u7b49\u7b49\u3002 \u4e0b\u9762\u6211\u4eec\u5c31\u6765\u770b\u4e00\u4e0b\u5173\u4e8e set \u7684\u4e00\u4e9b\u57fa\u672c\u64cd\u4f5c\u3002 sadd key value \u6dfb\u52a0\u5143\u7d20 sdel key value \u5220\u9664\u67d0\u4e2a\u5143\u7d20 sismember key value \u5224\u65ad\u662f\u5426\u662f\u96c6\u5408\u4e2d\u7684\u5143\u7d20 srandmember key count \u968f\u673a\u83b7\u53d6\u6307\u5b9a\u4e2a\u6570\u7684\u5143\u7d20(\u4e0d\u4f1a\u5f71\u54cd\u96c6\u5408\u7ed3\u6784) spop key count \u4ece\u96c6\u5408\u4e2d\u968f\u673a\u5f39\u51fa\u5143\u7d20(\u4f1a\u7834\u574f\u7ed3\u5408\u7ed3\u6784) smembers key \u83b7\u53d6\u96c6\u5408\u6240\u6709\u5143\u7d20 O(n) \u590d\u6742\u5ea6 scard key \u83b7\u53d6\u96c6\u5408\u4e2a\u6570 127.0.0.1:6379> sadd userset jacob (integer) 1 127.0.0.1:6379> sadd userset jacob (integer) 0 127.0.0.1:6379> sadd userset jane (integer) 1 127.0.0.1:6379> sismember userset john (integer) 0 127.0.0.1:6379> sismember userset jacob (integer) 1 127.0.0.1:6379> sismember userset 1 (integer) 0 127.0.0.1:6379> srandmember userset 1 1) \"jacob\" 127.0.0.1:6379> smembers userset 1) \"jacob\" 2) \"jane\" 127.0.0.1:6379> spop userset 1 1) \"jane\" 127.0.0.1:6379> smembers userset 1) \"jacob\" 127.0.0.1:6379> scard userset (integer) 1 sinter set1 set2 ... \u83b7\u53d6\u6240\u6709\u96c6\u5408\u4e2d\u7684\u4ea4\u96c6 sdiff set1 set2 ... \u83b7\u53d6\u6240\u6709\u96c6\u5408\u4e2d\u7684\u5dee\u96c6 sunion set1 set2 ... \u83b7\u53d6\u6240\u6709\u96c6\u5408\u4e2d\u7684\u5e76\u96c6 127.0.0.1:6379> sadd set1 jacob jane john (integer) 3 127.0.0.1:6379> sadd set2 jason jake jane (integer) 3 127.0.0.1:6379> sdiff set1 set2 1) \"jacob\" 2) \"john\" 127.0.0.1:6379> sunion set1 set2 1) \"jane\" 2) \"john\" 3) \"jake\" 4) \"jacob\" 5) \"jason\"","title":"set"},{"location":"chap10/3Redis_basic/#zset","text":"Redis \u4e2d\u7684 zset \u662f\u4e00\u4e2a \u6709\u5e8f\u96c6\u5408 \uff0c\u901a\u8fc7\u5b83\u53ef\u4ee5\u5b9e\u73b0\u5f88\u591a\u6709\u610f\u601d\u7684\u529f\u80fd\uff0c\u6bd4\u5982\u5b66\u751f\u6210\u7ee9\u6392\u884c\u699c\uff0c\u89c6\u9891\u64ad\u653e\u91cf\u6392\u884c\u699c\u7b49\u7b49\u3002 zset \u4e2d\u662f\u4f7f\u7528 \u8df3\u8868 \u6765\u5b9e\u73b0\u7684\uff0c\u6211\u4eec\u77e5\u9053\u53ea\u6709\u6570\u7ec4\u8fd9\u79cd\u8fde\u7eed\u7684\u7a7a\u95f4\u624d\u80fd\u4f7f\u7528 \u4e8c\u5206\u67e5\u627e \u8fdb\u884c\u5feb\u901f\u7684\u5b9a\u4f4d\uff0c\u800c\u94fe\u8868\u662f\u4e0d\u53ef\u4ee5\u7684\u3002\u8df3\u8868\u5e2e\u52a9\u94fe\u8868\u67e5\u627e\u7684\u65f6\u5019\u8282\u7701\u4e86\u5f88\u591a\u65f6\u95f4(\u4f7f\u7528\u8df3\u7684\u65b9\u5f0f\u6765\u904d\u5386\u7d22\u5f15\u6765\u8fdb\u884c\u6709\u5e8f\u63d2\u5165)\uff0c\u5982\u679c\u4e0d\u4e86\u89e3\u8df3\u8868\u7684\u540c\u5b66\u53ef\u4ee5\u8865\u4e60\u4e00\u4e0b\u3002 \u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u5173\u4e8e zset \u7684\u4e00\u4e9b\u57fa\u672c\u64cd\u4f5c\u3002 zadd key score element \u6dfb\u52a0\uff0cscore\u7528\u4e8e\u6392\u5e8f\uff0cvalue\u9700\u8981\u552f\u4e00\uff0c\u7531\u4e8e\u4f7f\u7528\u7684\u8df3\u8868\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(logn)\u3002 zrem key element \u5220\u9664\u67d0\u5143\u7d20 O(1)\u65f6\u95f4\u590d\u6742\u5ea6 zscore key element \u83b7\u53d6\u67d0\u4e2a\u5143\u7d20\u7684\u5206\u6570 zincrby key incrScore element \u589e\u52a0\u67d0\u4e2a\u5143\u7d20\u7684\u5206\u6570 zrange key start end [withscores] \u83b7\u53d6\u6307\u5b9a\u7d22\u5f15\u8303\u56f4\u7684\u5143\u7d20 \u52a0\u4e0a withscores \u5219\u8fd4\u56de\u5206\u6570 O(logn + m)\u65f6\u95f4\u590d\u6742\u5ea6 zrangebyscore key minScore maxScore [withscores] \u83b7\u53d6\u6307\u5b9a\u5206\u6570\u8303\u56f4\u7684\u5143\u7d20 \u52a0\u4e0awithscores\u5219\u8fd4\u56de\u5206\u6570\uff0c O(logn + m)\u65f6\u95f4\u590d\u6742\u5ea6 zcard key \u83b7\u53d6\u6709\u5e8f\u96c6\u5408\u957f\u5ea6 127.0.0.1:6379> zadd mathTest 88 mike (integer) 1 127.0.0.1:6379> zadd mathTest 99 tony (integer) 1 127.0.0.1:6379> zadd mathTest 66 zend (integer) 1 127.0.0.1:6379> zadd mathTest 77 yake (integer) 1 127.0.0.1:6379> zrange mathTest 0 -1 1) \"zend\" 2) \"yake\" 3) \"mike\" 4) \"tony\" 127.0.0.1:6379> zrangebyscore mathTest 0 100 1) \"zend\" 2) \"yake\" 3) \"mike\" 4) \"tony\" 127.0.0.1:6379> zincrby mathTest 10 yake \"87\" 127.0.0.1:6379> zrange mathTest 0 -1 1) \"zend\" 2) \"yake\" 3) \"mike\" 4) \"tony\" 127.0.0.1:6379> zrange mathTest 0 -1 withscores 1) \"zend\" 2) \"66\" 3) \"yake\" 4) \"87\" 5) \"mike\" 6) \"88\" 7) \"tony\" 8) \"99\" 127.0.0.1:6379> zrem mathTest zend (integer) 1 127.0.0.1:6379> zcard mathTest (integer) 3","title":"zset"},{"location":"chap10/3Redis_basic/#redis_3","text":"","title":"Redis \u4e2d\u7684\u4e8b\u52a1\u548c\u7ba1\u9053"},{"location":"chap10/3Redis_basic/#pipeline","text":"\u5728\u67d0\u4e9b\u573a\u666f\u4e0b\u6211\u4eec\u5728 \u4e00\u6b21\u64cd\u4f5c\u4e2d\u53ef\u80fd\u9700\u8981\u6267\u884c\u591a\u4e2a\u547d\u4ee4 \uff0c\u800c\u5982\u679c\u6211\u4eec\u53ea\u662f\u4e00\u4e2a\u547d\u4ee4\u4e00\u4e2a\u547d\u4ee4\u53bb\u6267\u884c\u5219\u4f1a\u6d6a\u8d39\u5f88\u591a\u7f51\u7edc\u6d88\u8017\u65f6\u95f4\uff0c\u5982\u679c\u5c06\u547d\u4ee4\u4e00\u6b21\u6027\u4f20\u8f93\u5230 Redis \u4e2d\u53bb\u518d\u6267\u884c\uff0c\u5219\u4f1a\u51cf\u5c11\u5f88\u591a\u5f00\u9500\u65f6\u95f4\u3002 \u4f46\u662f\u9700\u8981\u6ce8\u610f\u7684\u662f pipeline \u4e2d\u7684\u547d\u4ee4\u5e76\u4e0d\u662f\u539f\u5b50\u6027\u6267\u884c\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u7ba1\u9053\u4e2d\u7684\u547d\u4ee4\u5230\u8fbe Redis \u670d\u52a1\u5668\u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u88ab\u5176\u4ed6\u7684\u547d\u4ee4\u7a7f\u63d2\u3002","title":"\u7ba1\u9053 Pipeline"},{"location":"chap10/3Redis_basic/#_2","text":"\u5173\u7cfb\u578b\u6570\u636e\u5e93\u5177\u6709 ACID \u7279\u6027\uff0c Redis \u80fd\u4fdd\u8bc1 A\uff08\u539f\u5b50\u6027\uff09\u548cI\uff08\u9694\u79bb\u6027\uff09 \uff0cD\uff08\u6301\u4e45\u6027\uff09\u770b\u662f\u5426\u6709\u914d\u7f6e RDB \u6216\u8005 AOF \u6301\u4e45\u5316\u64cd\u4f5c \uff0c\u4f46\u65e0\u6cd5\u4fdd\u8bc1\u4e00\u81f4\u6027\uff0c\u56e0\u4e3a Redis \u4e8b\u52a1\u4e0d\u652f\u6301\u56de\u6eda \u3002 \u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a Redis \u4e2d\u7684\u4e8b\u52a1\u53ea\u662f\u6bd4 Pipeline \u591a\u4e86\u4e2a\u539f\u5b50\u6027\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u4e0d\u4f1a\u88ab\u5176\u4ed6\u547d\u4ee4\u7ed9\u5206\u5272\uff0c\u5982\u4e0a\u56fe\u3002 multi \u4e8b\u52a1\u5f00\u59cb\u7684\u6807\u5fd7 exec \u4e8b\u52a1\u6267\u884c 127.0.0.1:6379> multi #\u5f00\u59cb\u6267\u884c OK 127.0.0.1:6379> zadd userset 88 jake # \u6dfb\u52a0\u64cd\u4f5c QUEUED 127.0.0.1:6379> zrange userset 0 -1 #\u63d0\u4ea4 QUEUED 127.0.0.1:6379> exec discard \u6e05\u9664\u5728\u8fd9\u4e2a\u4e8b\u52a1\u4e2d\u653e\u5165\u961f\u5217\u7684\u6240\u6709\u547d\u4ee4\uff0c\u5373\u89e3\u9664\u6574\u4e2a\u4e8b\u52a1\u3002 watch key \u5728\u4e8b\u52a1\u5f00\u59cb\u524d\u76d1\u63a7\u67d0\u4e2a\u5143\u7d20\uff0c\u5982\u679c\u5728\u63d0\u4ea4\u4e8b\u52a1\u7684\u65f6\u5019\u53d1\u73b0\u8fd9\u4e2a\u5143\u7d20\u7684\u503c\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u66f4\u6539\u4e86\u5219\u4e8b\u52a1\u4f1a\u8fd0\u884c\u5931\u8d25\u3002 unwatch key \u89e3\u9664\u76d1\u63a7","title":"\u4e8b\u52a1"},{"location":"chap10/4Redis_int_all/","text":"115 \u9053 Redis \u9762\u8bd5\u9898\u89e3\u7b54 \u4e00\u3001Redis \u57fa\u7840\uff0827 \u9898\uff09 1. \u4ec0\u4e48\u662f Redis\uff1f Redis \u662f\u4e00\u4e2a\u5f00\u6e90\uff08BSD \u8bb8\u53ef\uff09\u3001\u57fa\u4e8e\u5185\u5b58\u3001\u652f\u6301\u591a\u79cd\u6570\u636e\u7ed3\u6784\u7684\u5b58\u50a8\u7cfb\u7edf\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u6570\u636e\u5e93\u3001\u7f13\u5b58\u548c\u6d88\u606f\u4e2d\u95f4\u4ef6\u3002 \u5b83\u652f\u6301\u7684\u6570\u636e\u7ed3\u6784\u6709\u5b57\u7b26\u4e32\uff08strings\uff09\u3001\u54c8\u5e0c\uff08hashes\uff09\u3001\u5217\u8868\uff08lists\uff09\u3001\u96c6\u5408\uff08sets\uff09\u3001\u6709\u5e8f\u96c6\u5408\uff08sorted sets\uff09\u7b49\uff0c\u9664\u6b64\u4e4b\u5916\u8fd8\u652f\u6301 bitmaps\u3001hyperloglogs \u548c\u5730\u7406\u7a7a\u95f4\uff08 geospatial \uff09\u7d22\u5f15\u534a\u5f84\u67e5\u8be2\u7b49\u529f\u80fd\u3002 \u5b83\u5185\u7f6e\u4e86\u590d\u5236\uff08Replication\uff09\u3001LUA \u811a\u672c\uff08Lua scripting\uff09\u3001LRU \u9a71\u52a8\u4e8b\u4ef6\uff08LRU eviction\uff09\u3001\u4e8b\u52a1\uff08Transactions\uff09\u548c\u4e0d\u540c\u7ea7\u522b\u7684\u78c1\u76d8\u6301\u4e45\u5316\uff08persistence\uff09\u529f\u80fd\uff0c\u5e76\u901a\u8fc7 Redis \u54e8\u5175\uff08\u54e8\u5175\uff09\u548c\u96c6\u7fa4\uff08Cluster\uff09\u4fdd\u8bc1\u7f13\u5b58\u7684\u9ad8\u53ef\u7528\u6027\uff08High availability\uff09\u3002 2. Redis \u7684\u6570\u636e\u7c7b\u578b\u6709\u54ea\u4e9b\uff1f Redis \u652f\u6301\u7684\u6570\u636e\u7c7b\u578b\u6709\uff1a 3. \u4f7f\u7528 Redis \u6709\u54ea\u4e9b\u597d\u5904\uff1f \u5177\u6709\u4ee5\u4e0b\u597d\u5904\uff1a \u8bfb\u53d6\u901f\u5ea6\u5feb\uff0c\u56e0\u4e3a\u6570\u636e\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u6240\u4ee5\u6570\u636e\u83b7\u53d6\u5feb \uff1b \u652f\u6301\u591a\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u5305\u62ec\u5b57\u7b26\u4e32\u3001\u5217\u8868\u3001\u96c6\u5408\u3001\u6709\u5e8f\u96c6\u5408\u3001\u54c8\u5e0c\u7b49 \uff1b \u652f\u6301\u4e8b\u52a1\uff0c\u4e14\u64cd\u4f5c\u9075\u5b88\u539f\u5b50\u6027\uff0c\u5373\u5bf9\u6570\u636e\u7684\u64cd\u4f5c\u8981\u4e48\u90fd\u6267\u884c\uff0c\u8981\u4e48\u90fd\u4e0d\u652f\u6301 \uff1b \u8fd8\u62e5\u6709\u5176\u4ed6\u4e30\u5bcc\u7684\u529f\u80fd\uff0c\u961f\u5217\u3001\u4e3b\u4ece\u590d\u5236\u3001\u96c6\u7fa4\u3001\u6570\u636e\u6301\u4e45\u5316\u7b49\u529f\u80fd \u3002 4. Redis \u76f8\u6bd4 Memcached \u6709\u54ea\u4e9b\u4f18\u52bf\uff1f Redis \u76f8\u6bd4 Memcache \u6709\u4ee5\u4e0b\u7684\u4f18\u52bf\uff1a \u6570\u636e\u7ed3\u6784 \uff1aMemcache \u53ea\u652f\u6301 key value \u5b58\u50a8\u65b9\u5f0f\uff0cRedis \u652f\u6301\u66f4\u591a\u7684\u6570\u636e\u7c7b\u578b\uff0c\u6bd4\u5982 Key value\u3001hash\u3001list\u3001set\u3001zset\uff1b \u591a\u7ebf\u7a0b \uff1aMemcache \u652f\u6301\u591a\u7ebf\u7a0b\uff0cRedis \u652f\u6301\u5355\u7ebf\u7a0b\uff1b CPU \u5229\u7528\u65b9\u9762 Memcache \u4f18\u4e8e Redis \uff1b \u6301\u4e45\u5316 \uff1aMemcache \u4e0d\u652f\u6301\u6301\u4e45\u5316\uff0cRedis \u652f\u6301\u6301\u4e45\u5316\uff1b \u5185\u5b58\u5229\u7528\u7387 \uff1aMemcache \u9ad8\uff0cRedis \u4f4e\uff08\u91c7\u7528\u538b\u7f29\u7684\u60c5\u51b5\u4e0b\u6bd4 Memcache \u9ad8\uff09\uff1b \u8fc7\u671f\u7b56\u7565 \uff1aMemcache \u8fc7\u671f\u540e\uff0c\u4e0d\u5220\u9664\u7f13\u5b58\uff0c\u4f1a\u5bfc\u81f4\u4e0b\u6b21\u53d6\u6570\u636e\u6570\u636e\u7684\u95ee\u9898\uff0cRedis \u6709\u4e13\u95e8\u7ebf\u7a0b\uff0c\u6e05\u9664\u7f13\u5b58\u6570\u636e\uff1b \u9002\u7528\u573a\u666f \uff1aRedis \u9002\u7528\u4e8e\u5bf9\u8bfb\u5199\u6548\u7387\u8981\u6c42\u90fd\u5f88\u9ad8\uff0c\u6570\u636e\u5904\u7406\u4e1a\u52a1\u590d\u6742\u548c\u5bf9\u5b89\u5168\u6027\u8981\u6c42\u8f83\u9ad8\u7684\u7cfb\u7edf\u3002 Redis \u53ea\u4f7f\u7528\u5355\u6838\uff0c\u800c Memcached \u53ef\u4ee5\u4f7f\u7528\u591a\u6838\uff0c\u6240\u4ee5\u5e73\u5747\u6bcf\u4e00\u4e2a\u6838\u4e0a Redis \u5728\u5b58\u50a8\u5c0f\u6570\u636e\u65f6\u6bd4 Memcached \u6027\u80fd\u66f4\u9ad8\u3002 Memcached \u9002\u7528\u4e8e\u5728\u52a8\u6001\u7cfb\u7edf\u4e2d\u51cf\u5c11\u6570\u636e\u5e93\u8d1f\u8f7d\uff0c\u63d0\u5347\u6027\u80fd\uff0c\u505a\u7f13\u5b58\uff0c\u63d0\u9ad8\u6027\u80fd\uff08\u9002\u5408\u8bfb\u591a\u5199\u5c11\uff0c\u5bf9\u4e8e\u6570\u636e\u91cf\u6bd4\u8f83\u5927\uff0c\u53ef\u4ee5\u91c7\u7528 sharding\uff09\u3002 5. Memcache \u4e0e Redis \u7684\u533a\u522b\u90fd\u6709\u54ea\u4e9b\uff1f \u5b83\u4eec\u7684\u4e3b\u8981\u533a\u522b\u6709\uff1a \u652f\u6301\u7684\u6570\u636e\u7c7b\u578b\u4e0d\u540c\uff0cMemcache \u652f\u6301\u7684\u6570\u636e\u7c7b\u578b\u7b80\u5355\uff0c\u53ea\u6709 key-value\uff0c\u800c Redis \u652f\u6301\u591a\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u5305\u62ec\u5b57\u7b26\u4e32\u3001\u5217\u8868\u3001\u96c6\u5408\u3001\u6709\u5e8f\u96c6\u5408\u3001\u54c8\u5e0c\u7b49\uff1b Redis \u652f\u6301\u6570\u636e\u6301\u4e45\u5316\uff0cMemcache \u4e0d\u652f\u6301\u6570\u636e\u6301\u4e45\u5316\u3002 \u5982\u679c\u670d\u52a1\u5668\u91cd\u542f\uff0cMemcache \u4e2d\u7684\u6570\u636e\u4f1a\u88ab\u6e05\u7a7a\uff0c\u800c Redis \u5f00\u542f\u6301\u4e45\u5316\u7684\u8bdd\uff0c\u91cd\u542f\u540e\u53ef\u4ee5\u81ea\u52a8\u52a0\u8f7d\u6570\u636e\u6062\u590d\u5230\u5185\u5b58\u4e2d\uff1b \u5b83\u4eec\u7684\u5e95\u5c42\u7ed3\u6784\u3001\u5b9e\u73b0\u65b9\u5f0f\u7684\u4e0d\u540c\uff0c\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u901a\u4fe1\u7684\u534f\u8bae\u4e5f\u4e0d\u540c\u3002 6. Redis \u662f\u5355\u8fdb\u7a0b\u5355\u7ebf\u7a0b\u7684\u5417\uff1f Redis \u662f\u5355\u8fdb\u7a0b\u5355\u7ebf\u7a0b\u7684\uff0c \u5b83\u53ef\u4ee5\u901a\u8fc7\u961f\u5217\u6280\u672f\u5c06\u5e76\u53d1\u8bbf\u95ee\u53d8\u4e3a\u4e32\u884c\u8bbf\u95ee\uff0c\u907f\u514d\u4e86\u4f20\u7edf\u6570\u636e\u5e93\u4e32\u884c\u63a7\u5236\u7684\u5f00\u9500\u3002 7. \u4e3a\u4ec0\u4e48 Redis \u9700\u8981\u628a\u6240\u6709\u6570\u636e\u653e\u5230\u5185\u5b58\u4e2d\uff1f Redis \u5c06\u6570\u636e\u653e\u5728\u5185\u5b58\u4e2d\u6709\u4e00\u4e2a\u597d\u5904\uff0c\u90a3\u5c31\u662f\u53ef\u4ee5\u5b9e\u73b0\u6700\u5feb\u7684\u5bf9\u6570\u636e\u8bfb\u53d6\uff0c\u5982\u679c\u6570\u636e\u5b58\u50a8\u5728\u786c\u76d8\u4e2d\uff0c\u78c1\u76d8 I/O \u4f1a\u4e25\u91cd\u5f71\u54cd Redis \u7684\u6027\u80fd\u3002 \u800c\u4e14 Redis \u8fd8\u63d0\u4f9b\u4e86\u6570\u636e\u6301\u4e45\u5316\u529f\u80fd\uff0c\u4e0d\u7528\u62c5\u5fc3\u670d\u52a1\u5668\u91cd\u542f\u5bf9\u5185\u5b58\u4e2d\u6570\u636e\u7684\u5f71\u54cd \u3002\u5176\u6b21\u73b0\u5728\u786c\u4ef6\u8d8a\u6765\u8d8a\u4fbf\u5b9c\u7684\u60c5\u51b5\u4e0b\uff0cRedis \u7684\u4f7f\u7528\u4e5f\u88ab\u5e94\u7528\u5f97\u8d8a\u6765\u8d8a\u591a\uff0c\u4f7f\u5f97\u5b83\u62e5\u6709\u5f88\u5927\u7684\u4f18\u52bf\u3002 8. Redis \u7684\u540c\u6b65\u673a\u5236\u4e86\u89e3\u662f\u4ec0\u4e48\uff1f Redis \u652f\u6301\u4e3b\u4ece\u540c\u6b65\u3001\u4ece\u4ece\u540c\u6b65\u3002 \u5982\u679c\u662f\u7b2c\u4e00\u6b21\u8fdb\u884c\u4e3b\u4ece\u540c\u6b65\uff0c\u4e3b\u8282\u70b9\u9700\u8981\u4f7f\u7528 bgsave \u547d\u4ee4\uff0c\u518d\u5c06\u540e\u7eed\u4fee\u6539\u64cd\u4f5c\u8bb0\u5f55\u5230\u5185\u5b58\u7684\u7f13\u51b2\u533a\uff0c\u7b49 RDB \u6587\u4ef6\u5168\u90e8\u540c\u6b65\u5230\u590d\u5236\u8282\u70b9\uff0c\u590d\u5236\u8282\u70b9\u63a5\u53d7\u5b8c\u6210\u540e\u5c06 RDB \u955c\u50cf\u8bb0\u8f7d\u5230\u5185\u5b58\u4e2d\u3002 \u7b49\u52a0\u8f7d\u5b8c\u6210\u540e\uff0c\u590d\u5236\u8282\u70b9\u901a\u77e5\u4e3b\u8282\u70b9\u5c06\u590d\u5236\u671f\u95f4\u4fee\u6539\u7684\u64cd\u4f5c\u8bb0\u5f55\u540c\u6b65\u5230\u590d\u5236\u8282\u70b9\uff0c\u5373\u53ef\u5b8c\u6210\u540c\u6b65\u8fc7\u7a0b\u3002 9. pipeline \u6709\u4ec0\u4e48\u597d\u5904\uff0c\u4e3a\u4ec0\u4e48\u8981\u7528 pipeline\uff1f \u4f7f\u7528 pipeline\uff08\u7ba1\u9053\uff09\u7684\u597d\u5904\u5728\u4e8e\u53ef\u4ee5\u5c06\u591a\u6b21 I/O \u5f80\u8fd4\u7684\u65f6\u95f4\u7f29\u77ed\u4e3a\u4e00\u6b21\uff0c\u4f46\u662f\u8981\u6c42\u7ba1\u9053\u4e2d\u6267\u884c\u7684\u6307\u4ee4\u95f4\u6ca1\u6709\u56e0\u679c\u5173\u7cfb\u3002 \u7528 pipeline \u7684\u539f\u56e0\u5728\u4e8e\u53ef\u4ee5\u5b9e\u73b0\u8bf7\u6c42/\u54cd\u5e94\u670d\u52a1\u5668\u7684\u529f\u80fd\uff0c\u5f53\u5ba2\u6237\u7aef\u5c1a\u672a\u8bfb\u53d6\u65e7\u54cd\u5e94\u65f6\uff0c\u5b83\u4e5f\u53ef\u4ee5\u5904\u7406\u65b0\u7684\u8bf7\u6c42\u3002\u5982\u679c\u5ba2\u6237\u7aef\u5b58\u5728\u591a\u4e2a\u547d\u4ee4\u53d1\u9001\u5230\u670d\u52a1\u5668\u65f6\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u65e0\u9700\u7b49\u5f85\u670d\u52a1\u7aef\u7684\u6bcf\u6b21\u54cd\u5e94\u624d\u80fd\u6267\u884c\u4e0b\u4e2a\u547d\u4ee4\uff0c\u53ea\u9700\u6700\u540e\u4e00\u6b65\u4ece\u670d\u52a1\u7aef\u8bfb\u53d6\u56de\u590d\u5373\u53ef\u3002 10. Redis \u6700\u9002\u5408\u7684\u573a\u666f\uff1f Redis \u662f\u4e00\u4e2a\u5f00\u6e90\uff08BSD \u8bb8\u53ef\uff09\uff0c\u57fa\u4e8e\u5185\u5b58\uff0c\u652f\u6301\u591a\u79cd\u6570\u636e\u7ed3\u6784\u7684\u5b58\u50a8\u7cfb\u7edf\u3002 \u53ef\u4ee5\u4f5c\u4e3a\u6570\u636e\u5e93\u3001\u7f13\u5b58\u548c\u6d88\u606f\u4e2d\u95f4\u4ef6\u3002\u5b83\u652f\u6301\u7684\u6570\u636e\u7ed3\u6784\u6709\u5b57\u7b26\u4e32\uff08strings\uff09\u3001\u54c8\u5e0c\uff08hashes\uff09\u3001\u5217\u8868\uff08lists\uff09\u3001\u96c6\u5408\uff08sets\uff09\u3001\u6709\u5e8f\u96c6\u5408\uff08sorted sets\uff09\u7b49\uff0c\u9664\u6b64\u4e4b\u5916\u8fd8\u652f\u6301 bitmaps\u3001hyperloglogs \u548c\u5730\u7406\u7a7a\u95f4\uff08 geospatial \uff09\u7d22\u5f15\u534a\u5f84\u67e5\u8be2\u7b49\u529f\u80fd\u3002\u6839\u636e\u5b83\u7684\u7279\u6027\uff0c\u5b83\u9002\u7528\u7684\u573a\u666f\u6709\uff1a 1. \u4f1a\u8bdd\u7f13\u5b58 \u4f1a\u8bdd\uff08Session\uff09\u662f\u5b58\u50a8\u5728\u670d\u52a1\u7aef\u7684\uff0c\u4f46\u662f\u53ef\u4ee5\u8bbe\u7f6e\u5b58\u50a8\u7684\u65f6\u5019\u4e0d\u4ee5\u6587\u4ef6\u7684\u65b9\u5f0f\u5b58\u50a8\uff0c\u800c\u662f\u5b58\u5230 Redis \u4e2d\uff0c\u800c\u4e14 Redis \u652f\u6301\u6570\u636e\u6301\u4e45\u5316\uff0c\u4e0d\u7528\u62c5\u5fc3\u6570\u636e\u56e0\u4e3a\u670d\u52a1\u5668\u91cd\u542f\u5bfc\u81f4 Session \u6570\u636e\u4e22\u5931\u7684\u95ee\u9898\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u4e0d\u53ea\u662f\u63d0\u9ad8\u83b7\u53d6\u4f1a\u8bdd\u7684\u901f\u5ea6\uff0c\u4e5f\u5bf9\u7f51\u7ad9\u7684\u6574\u4f53\u6027\u80fd\u6709\u5f88\u5927\u7684\u63d0\u5347\u3002 2. \u6570\u636e\u7f13\u5b58 Redis \u652f\u6301\u591a\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u7ecf\u5e38\u88ab\u7528\u6765\u505a\u7f13\u5b58\u4e2d\u95f4\u4ef6\u4f7f\u7528\u3002\u7f13\u5b58\u7684\u6570\u636e\u4e0d\u53ea\u662f\u5305\u62ec\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u7f13\u5b58\u4e00\u4e9b\u9700\u8981\u4e34\u65f6\u5b58\u50a8\u7684\u6570\u636e\uff0c\u4f8b\u5982 token\u3001\u4f1a\u8bdd\u6570\u636e\u7b49\u3002 3. \u961f\u5217 Redis \u662f\u652f\u6301\u5217\u8868\uff08lists\uff09\u529f\u80fd\u7684\uff0c\u53ef\u4ee5\u7b80\u5355\u5b9e\u73b0\u4e00\u4e2a\u961f\u5217\u7684\u529f\u80fd\uff0c\u5bf9\u6570\u636e\u8fdb\u884c\u5165\u961f\u3001\u51fa\u961f\u64cd\u4f5c\u3002\u5b9e\u73b0\u7684\u961f\u5217\u53ef\u4ee5\u5e94\u7528\u5230\u7535\u5546\u7684\u79d2\u6740\u573a\u666f\u4e2d\u3002 4. \u6392\u884c\u699c\u3001\u8ba1\u6570\u5668 Redis \u63d0\u4f9b\u4e86\u6709\u5e8f\u96c6\u5408\uff0c\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u6392\u540d\uff0c\u5b9e\u73b0\u6392\u884c\u699c\u529f\u80fd\u3002 \u5176\u6b21 Redis \u4e2d\u63d0\u4f9b\u4e86 incr \u5bf9\u6570\u5b57\u52a0 1 \u547d\u4ee4\uff0c\u4e5f\u63d0\u4f9b\u4e86 decr \u5bf9\u6570\u5b57\u51cf 1 \u547d\u4ee4\uff0c\u6240\u4ee5\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684\u8ba1\u6570\u5668\u529f\u80fd\u3002 5. \u53d1\u5e03\u3001\u8ba2\u9605\u529f\u80fd Redis \u4e2d\u63d0\u4f9b\u4e86\u53d1\u5e03\u8ba2\u9605\u76f8\u5173\u7684\u547d\u4ee4\uff0c\u53ef\u4ee5\u7528\u6765\u505a\u4e00\u4e9b\u8ddf\u53d1\u5e03\u8ba2\u9605\u76f8\u5173\u7684\u573a\u666f\u5e94\u7528\u7b49\u3002\u4f8b\u5982\u7b80\u5355\u7684\u6d88\u606f\u961f\u5217\u529f\u80fd\u7b49\u3002 11. \u4ec0\u4e48\u662f Redis \u4e8b\u52a1\uff1f\u539f\u7406\u662f\u4ec0\u4e48\uff1f Redis \u4e2d\u7684\u4e8b\u52a1\u662f\u4e00\u7ec4\u547d\u4ee4\u7684\u96c6\u5408\uff0c\u662f Redis \u7684\u6700\u5c0f\u6267\u884c\u5355\u4f4d\u3002 \u5b83\u53ef\u4ee5\u4fdd\u8bc1\u4e00\u6b21\u6267\u884c\u591a\u4e2a\u547d\u4ee4\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u9694\u79bb\u64cd\u4f5c\uff0c\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u90fd\u4f1a\u5e8f\u5217\u5316\u3001\u6309\u987a\u5e8f\u5730\u6267\u884c\u3002\u670d\u52a1\u7aef\u5728\u6267\u884c\u4e8b\u52a1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u4f1a\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u53d1\u9001\u6765\u7684\u547d\u4ee4\u8bf7\u6c42\u6253\u65ad\u3002 \u5b83\u7684\u539f\u7406\u662f\u5148\u5c06\u5c5e\u4e8e\u4e00\u4e2a\u4e8b\u52a1\u7684\u547d\u4ee4\u53d1\u9001\u7ed9 Redis\uff0c\u7136\u540e\u4f9d\u6b21\u6267\u884c\u8fd9\u4e9b\u547d\u4ee4\u3002 12. Redis \u4e8b\u52a1\u7684\u6ce8\u610f\u70b9\u6709\u54ea\u4e9b\uff1f \u9700\u8981\u6ce8\u610f\u7684\u70b9\u6709\uff1a Redis \u4e8b\u52a1\u662f\u4e0d\u652f\u6301\u56de\u6eda\u7684\uff0c\u4e0d\u50cf MySQL \u7684\u4e8b\u52a1\u4e00\u6837\uff0c\u8981\u4e48\u90fd\u6267\u884c\u8981\u4e48\u90fd\u4e0d\u6267\u884c \uff1b Redis \u670d\u52a1\u7aef\u5728\u6267\u884c\u4e8b\u52a1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u4f1a\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u53d1\u9001\u6765\u7684\u547d\u4ee4\u8bf7\u6c42\u6253\u65ad \u3002 \u76f4\u5230\u4e8b\u52a1\u547d\u4ee4\u5168\u90e8\u6267\u884c\u5b8c\u6bd5\u624d\u4f1a\u6267\u884c\u5176\u4ed6\u5ba2\u6237\u7aef\u7684\u547d\u4ee4\u3002 13. Redis \u4e3a\u4ec0\u4e48\u4e0d\u652f\u6301\u56de\u6eda\uff1f Redis \u7684\u4e8b\u52a1\u4e0d\u652f\u6301\u56de\u6eda\uff0c\u4f46\u662f\u6267\u884c\u7684\u547d\u4ee4\u6709\u8bed\u6cd5\u9519\u8bef\uff0cRedis \u4f1a\u6267\u884c\u5931\u8d25\uff0c\u8fd9\u4e9b\u95ee\u9898\u53ef\u4ee5\u4ece\u7a0b\u5e8f\u5c42\u9762\u6355\u83b7\u5e76\u89e3\u51b3\u3002 \u4f46\u662f\u5982\u679c\u51fa\u73b0\u5176\u4ed6\u95ee\u9898\uff0c\u5219\u4f9d\u7136\u4f1a\u7ee7\u7eed\u6267\u884c\u4f59\u4e0b\u7684\u547d\u4ee4 \u3002\u8fd9\u6837\u505a\u7684\u539f\u56e0\u662f\u56e0\u4e3a\u56de\u6eda\u9700\u8981\u589e\u52a0\u5f88\u591a\u5de5\u4f5c\uff0c\u800c\u4e0d\u652f\u6301\u56de\u6eda\u5219\u53ef\u4ee5\u4fdd\u6301\u7b80\u5355\u3001\u5feb\u901f\u7684\u7279\u6027\u3002 14. Redis \u5982\u4f55\u8bbe\u7f6e\u5bc6\u7801\u53ca\u9a8c\u8bc1\u5bc6\u7801\uff1f Redis \u5bc6\u7801\u8bbe\u7f6e\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a \u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u9700\u8981\u91cd\u542f Redis\u3002 \u5728 redis.conf \u4e2d\u53ef\u4ee5\u627e\u5230 requirepass \u53c2\u6570\uff0c\u8bbe\u7f6e Redis \u7684\u8bbf\u95ee\u5bc6\u7801 \u3002 \u914d\u7f6e\u65b9\u6cd5\u4e3a\uff1a requirepass \u8bbf\u95ee\u5bc6\u7801 \u3002 \u4f7f\u7528\u547d\u4ee4\u8bbe\u7f6e\uff0c\u4e0d\u9700\u8981\u91cd\u542f Redis\u3002 \u4f7f\u7528\u547d\u4ee4\u8bbe\u7f6e\u7684\u65b9\u6cd5\u4e3a\uff1a config set requirepass \u8bbf\u95ee\u5bc6\u7801\u3002 \u5982\u679c\u9700\u8981\u67e5\u8be2\u5bc6\u7801\uff0c\u53ef\u4ee5\u4f7f\u7528 config get requirepass \u547d\u4ee4 \u3002 \u5982\u679c\u9700\u8981\u9a8c\u8bc1\u5bc6\u7801\uff0c\u53ef\u4ee5\u4f7f\u7528 auth \u8bbf\u95ee\u5bc6\u7801\uff0c\u518d\u6267\u884c config get requirepass \u83b7\u53d6 \u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u8bbe\u7f6e\u8bbf\u95ee\u5bc6\u7801\uff0c\u5982\u679c redis.conf \u914d\u7f6e\u6587\u4ef6\u4e2d\u6ca1\u6709\u8bbe\u7f6e\u5bf9\u5e94\u7684\u8bbf\u95ee\u5bc6\u7801\uff0c\u90a3\u4e48\u670d\u52a1\u5668\u91cd\u542f\u540e\u8bbf\u95ee\u5bc6\u7801\u4f1a\u5931\u6548\u3002 15. Redis \u4e3a\u4ec0\u4e48\u8bbe\u8ba1\u6210\u5355\u7ebf\u7a0b\u7684\uff1f \u591a\u7ebf\u7a0b\u5904\u7406\u4f1a\u6d89\u53ca\u5230\u9501\uff0c\u5e76\u4e14\u591a\u7ebf\u7a0b\u5904\u7406\u4f1a\u6d89\u53ca\u5230\u7ebf\u7a0b\u5207\u6362\u800c\u6d88\u8017 CPU\u3002 \u91c7\u7528\u5355\u7ebf\u7a0b\uff0c\u907f\u514d\u4e86\u4e0d\u5fc5\u8981\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u548c\u7ade\u4e89\u6761\u4ef6 \u3002 \u5176\u6b21 CPU \u4e0d\u662f Redis \u7684\u74f6\u9888\uff0cRedis \u7684\u74f6\u9888\u6700\u6709\u53ef\u80fd\u662f\u673a\u5668\u5185\u5b58\u6216\u8005\u7f51\u7edc\u5e26\u5bbd\u3002 16. \u600e\u4e48\u6d4b\u8bd5 Redis \u7684\u8fde\u901a\u6027\uff1f \u901a\u8fc7\u547d\u4ee4 ping \u6267\u884c\u540e\uff0c\u4f1a\u5f97\u5230\u56de\u590d\u7ed3\u679c pong\u3002\u5982\u679c\u6ca1\u6709\u5f97\u5230 pong \u7684\u7ed3\u679c\u8bf4\u660e Redis \u6ca1\u6709\u6b63\u5e38\u8fde\u901a\u3002 17. \u600e\u4e48\u7406\u89e3 Redis \u4e8b\u52a1\uff1f \u5728 MySQL \u4e2d\uff0c\u4e8b\u52a1\u662f\u6307\u4e00\u7ec4\u64cd\u4f5c\u4e2d\uff0c\u8981\u4e48\u5168\u90e8\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u6267\u884c\u3002 \u800c\u5728 Redis \u4e5f\u5b58\u5728\u4e8b\u52a1\u7684\u6982\u5ff5\u3002Redis \u7684\u4e8b\u52a1\u53ef\u4ee5\u4fdd\u8bc1\u4e00\u6b21\u6267\u884c\u591a\u4e2a\u547d\u4ee4\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u9694\u79bb\u64cd\u4f5c\uff0c\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u90fd\u4f1a\u5e8f\u5217\u5316\u3001\u6309\u987a\u5e8f\u5730\u6267\u884c\u3002\u670d\u52a1\u7aef\u5728\u6267\u884c\u4e8b\u52a1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u4f1a\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u53d1\u9001\u6765\u7684\u547d\u4ee4\u8bf7\u6c42\u6253\u65ad\u3002 18. Redis \u901a\u8baf\u534f\u8bae\u662f\u4ec0\u4e48\uff1f\u6709\u4ec0\u4e48\u7279\u70b9\uff1f Redis \u5ba2\u6237\u7aef\u548c Redis \u670d\u52a1\u5668\u901a\u4fe1\u65f6\u4f7f\u7528\u7684\u662f RESP\uff08Redis \u5e8f\u5217\u5316\u534f\u8bae\uff09\u901a\u8baf\u534f\u8bae\uff0c\u8be5\u534f\u8bae\u662f\u4e13\u95e8\u4e3a Redis \u8bbe\u8ba1\u7684\uff0c\u4f46\u662f\u4e5f\u53ef\u4ee5\u7528\u4e8e\u5176\u4ed6\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u8f6f\u4ef6\u9879\u76ee\u4e2d\u3002 RESP \u7684\u7279\u70b9\u4e3a\uff1a\u5b9e\u73b0\u7b80\u5355\u3001\u5feb\u901f\u89e3\u6790\u3001\u53ef\u8bfb\u6027\u597d\u3002 19. Redis \u5355\u70b9\u541e\u5410\u91cf\u6709\u591a\u5c11\uff1f \u5355\u70b9 TPS \u8fbe\u5230 8 \u4e07/\u79d2\uff0cQPS \u8fbe\u5230 10 \u4e07/\u79d2\u3002TPS \u548c QPS \u7684\u610f\u601d\uff1a QPS\uff1a\u5e94\u7528\u7cfb\u7edf\u6bcf\u79d2\u949f\u6700\u5927\u80fd\u63a5\u53d7\u7684\u7528\u6237\u8bbf\u95ee\u91cf \u3002\u6bcf\u79d2\u949f\u5904\u7406\u5b8c\u8bf7\u6c42\u7684\u6b21\u6570\uff0c\u6ce8\u610f\u8fd9\u91cc\u662f\u5904\u7406\u5b8c\uff0c\u5177\u4f53\u662f\u6307\u53d1\u51fa\u8bf7\u6c42\u5230\u670d\u52a1\u5668\u5904\u7406\u5b8c\u6210\u529f\u8fd4\u56de\u7ed3\u679c\u3002\u53ef\u4ee5\u7406\u89e3\u5728 Server \u4e2d\u6709\u4e2a counter\uff0c\u6bcf\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\u52a0 1\uff0c1s \u540e counter=QPS \u3002 TPS\uff1a\u6bcf\u79d2\u949f\u6700\u5927\u80fd\u5904\u7406\u7684\u8bf7\u6c42\u6570 \u3002\u6bcf\u79d2\u949f\u5904\u7406\u5b8c\u7684\u4e8b\u52a1\u6b21\u6570\uff0c\u4e00\u4e2a\u5e94\u7528\u7cfb\u7edf 1s \u80fd\u5b8c\u6210\u591a\u5c11\u4e8b\u52a1\u5904\u7406\uff0c\u4e00\u4e2a\u4e8b\u52a1\u5728\u5206\u5e03\u5f0f\u5904\u7406\u4e2d\uff0c\u53ef\u80fd\u4f1a\u5bf9\u5e94\u591a\u4e2a\u8bf7\u6c42\uff0c\u5bf9\u4e8e\u8861\u91cf\u5355\u4e2a\u63a5\u53e3\u670d\u52a1\u7684\u5904\u7406\u80fd\u529b\uff0c\u7528 QPS \u6bd4\u8f83\u5408\u7406\u3002 20. Redis \u4e2d\u7ba1\u9053\u6709\u4ec0\u4e48\u7528\uff1f \u4f7f\u7528 pipeline\uff08\u7ba1\u9053\uff09\u7684\u597d\u5904\u5728\u4e8e\u53ef\u4ee5\u5c06\u591a\u6b21 I/O \u5f80\u8fd4\u7684\u65f6\u95f4\u7f29\u77ed\u4e3a\u4e00\u6b21\uff0c\u4f46\u662f\u8981\u6c42\u7ba1\u9053\u4e2d\u6267\u884c\u7684\u6307\u4ee4\u95f4\u6ca1\u6709\u56e0\u679c\u5173\u7cfb\u3002 21. \u4fee\u6539\u914d\u7f6e\u4e0d\u91cd\u542f Redis \u4f1a\u5b9e\u65f6\u751f\u6548\u5417\uff1f \u56e0\u4e3a Redis \u5728\u91cd\u542f\u624d\u80fd\u52a0\u8f7d\u914d\u7f6e\u9879\u4e2d\u7684\u914d\u7f6e\uff0c\u6240\u4ee5\u9700\u8981\u91cd\u542f\u624d\u80fd\u751f\u6548\u3002\u9488\u5bf9\u8fd0\u884c\u5b9e\u4f8b\uff0c\u6709\u8bb8\u591a\u914d\u7f6e\u9009\u9879\u53ef\u4ee5\u901a\u8fc7 CONFIG SET \u547d\u4ee4\u8fdb\u884c\u4fee\u6539\uff0c\u800c\u65e0\u9700\u6267\u884c\u4efb\u4f55\u5f62\u5f0f\u7684\u91cd\u542f\u3002 \u4ece Redis 2.2 \u5f00\u59cb\uff0c\u53ef\u4ee5\u4ece AOF \u5207\u6362\u5230 RDB \u7684\u5feb\u7167\u6301\u4e45\u6027\u6216\u5176\u4ed6\u65b9\u5f0f\u800c\u4e0d\u9700\u8981\u91cd\u542f Redis\u3002\u68c0\u7d22 'CONFIG GET *' \u547d\u4ee4\u83b7\u53d6\u66f4\u591a\u4fe1\u606f\u3002 \u4f46\u5076\u5c14\u91cd\u65b0\u542f\u52a8\u662f\u5fc5\u987b\u7684\uff0c\u5982\u4e3a\u5347\u7ea7 Redis \u7a0b\u5e8f\u5230\u65b0\u7684\u7248\u672c\uff0c\u6216\u8005\u5f53\u4f60\u9700\u8981\u4fee\u6539\u67d0\u4e9b\u76ee\u524d CONFIG \u547d\u4ee4\u8fd8\u4e0d\u652f\u6301\u7684\u914d\u7f6e\u53c2\u6570\u7684\u65f6\u5019\u3002 22. \u53ef\u4ee5\u4ecb\u7ecd\u4e00\u4e9b Redis \u5e38\u7528\u7684\u5b89\u5168\u8bbe\u7f6e\u5417\uff1f \u5e38\u7528\u7684\u8bbe\u7f6e\u6709\uff1a 1. \u7aef\u53e3\u8bbe\u7f6e \u53ea\u5141\u8bb8\u4fe1\u4efb\u7684\u5ba2\u6237\u7aef\u53d1\u9001\u8fc7\u6765\u7684\u8bf7\u6c42\uff0c\u5bf9\u5176\u4ed6\u6240\u6709\u8bf7\u6c42\u90fd\u62d2\u7edd\u3002\u5982\u679c\u5b58\u5728\u66b4\u9732\u5728\u5916\u7f51\u7684\u670d\u52a1\uff0c\u90a3\u4e48\u9700\u8981\u4f7f\u7528\u9632\u706b\u5899\u963b\u6b62\u5916\u90e8\u8bbf\u95ee Redis \u7aef\u53e3\u3002 2. \u8eab\u4efd\u9a8c\u8bc1 \u4f7f\u7528 Redis \u63d0\u4f9b\u7684\u8eab\u4efd\u9a8c\u8bc1\u529f\u80fd\uff0c \u5728 redis.conf \u6587\u4ef6\u4e2d\u8fdb\u884c\u914d\u7f6e\u751f\u6548\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u53d1\u9001\uff08AUTH \u5bc6\u7801\uff09\u547d\u4ee4\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1 \u3002 3. \u7981\u7528\u7279\u5b9a\u7684\u547d\u4ee4\u96c6 \u53ef\u4ee5\u8003\u8651\u7981\u6b62\u4e00\u4e9b\u5bb9\u6613\u4ea7\u751f\u5b89\u5168\u95ee\u9898\u7684\u547d\u4ee4\uff0c\u9884\u9632\u88ab\u4eba\u6076\u610f\u64cd\u4f5c\u3002 23. \u8bf7\u4ecb\u7ecd\u4e00\u4e0b Redis \u7684\u53d1\u5e03\u8ba2\u9605\u529f\u80fd \u53d1\u5e03\u8ba2\u9605\u662f\u4e00\u79cd\u6d88\u606f\u901a\u4fe1\u6a21\u5f0f\uff0c\u53d1\u9001\u8005\u53d1\u9001\u6d88\u606f\u5230\u67d0\u4e2a\u9891\u9053\uff0c\u8ba2\u9605\u4e86\u8be5\u9891\u9053\u7684\u7528\u6237\u90fd\u53ef\u4ee5\u63a5\u6536\u5230\u6d88\u606f\u3002\u8be5\u6a21\u5f0f\u7531\u53d1\u5e03\u8005\u3001\u63a5\u6536\u8005\u548c\u9891\u9053\u7ec4\u6210\u3002 24. \u8bf7\u8bf4\u660e\u4e00\u4e0b Redis \u7684\u6279\u91cf\u547d\u4ee4\u4e0e Pipeline \u6709\u4ec0\u4e48\u4e0d\u540c\uff1f \u5b83\u4eec\u4e3b\u8981\u7684\u4e0d\u540c\u6709\uff1a \u5b83\u4eec\u4e3b\u8981\u7684\u4e0d\u540c\u6709\uff1a \u539f\u5b50\u6027\u4e0d\u540c\uff1b\u6279\u91cf\u547d\u4ee4\u64cd\u4f5c\u9700\u8981\u4fdd\u8bc1\u539f\u5b50\u6027\u7684\uff0cPipeline \u6267\u884c\u662f\u975e\u539f\u5b50\u6027\u7684\uff1b \u652f\u6301\u7684\u547d\u4ee4\u4e0d\u540c\uff1b \u6279\u91cf\u547d\u4ee4\u64cd\u4f5c\u662f\u4e00\u4e2a\u547d\u4ee4\u5bf9\u5e94\u591a\u4e2a key\uff0cPipeline \u652f\u6301\u591a\u4e2a\u547d\u4ee4\u7684\u6267\u884c \uff1b \u5b9e\u73b0\u65b9\u5f0f\u7684\u4e0d\u540c\uff1b \u6279\u91cf\u547d\u4ee4\u64cd\u4f5c\u662f\u7531 Redis \u670d\u52a1\u7aef\u5b9e\u73b0\u7684\uff0c\u800c Pipeline \u662f\u9700\u8981\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u5171\u540c\u5b9e\u73b0\u7684 \u3002 25. \u8bf7\u4ecb\u7ecd\u4e00\u4e0b Redis \u7684 Pipeline\uff08\u7ba1\u9053\uff09\uff0c\u4ee5\u53ca\u4f7f\u7528\u573a\u666f \u56e0\u4e3a Redis \u662f\u57fa\u4e8e TCP \u534f\u8bae\u7684\u8bf7\u6c42/\u54cd\u5e94\u670d\u52a1\u5668\uff0c \u6bcf\u6b21\u901a\u4fe1\u90fd\u9700\u8981\u7ecf\u8fc7 TCP \u534f\u8bae\u7684\u4e09\u6b21\u63e1\u624b\uff0c\u6240\u4ee5\u5f53\u9700\u8981\u6267\u884c\u7684\u547d\u4ee4\u8db3\u591f\u5927\u65f6\uff0c\u4f1a\u4ea7\u751f\u5f88\u5927\u7684\u7f51\u7edc\u5ef6\u8fdf \u3002 \u5e76\u4e14\u7f51\u7edc\u7684\u4f20\u8f93\u65f6\u95f4\u6210\u672c\u548c\u670d\u52a1\u5668\u5f00\u9500\u6ca1\u6709\u8ba1\u5165\u5176\u4e2d\uff0c\u603b\u7684\u5ef6\u8fdf\u53ef\u80fd\u66f4\u5927\u3002Pipeline \u4e3b\u8981\u5c31\u662f\u4e3a\u4e86\u89e3\u51b3\u5b58\u5728\u8fd9\u79cd\u60c5\u51b5\u7684\u573a\u666f\uff0c\u5bf9\u6b64\u5b58\u5728\u7c7b\u4f3c\u7684\u573a\u666f\u90fd\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 Pipeline\u3002 \u53ef\u4ee5\u9002\u7528\u573a\u666f\u6709\uff1a\u5982\u679c\u5b58\u5728\u6279\u91cf\u6570\u636e\u9700\u8981\u5199\u5165 Redis\uff0c\u5e76\u4e14\u8fd9\u4e9b\u6570\u636e\u5141\u8bb8\u4e00\u5b9a\u6bd4\u4f8b\u7684\u5199\u5165\u5931\u8d25\uff0c\u90a3\u4e48\u53ef\u4ee5\u4f7f\u7528 Pipeline\uff0c\u540e\u671f\u518d\u5bf9\u5931\u8d25\u7684\u6570\u636e\u8fdb\u884c\u8865\u507f\u5373\u53ef\u3002 26. Redis \u5e38\u7528\u7684\u4e1a\u52a1\u573a\u666f\u6709\u54ea\u4e9b\uff1f \u4e3b\u8981\u5e38\u7528\u7684\u4e1a\u52a1\u573a\u666f\u6709\uff1a \u5bf9\u70ed\u70b9\u6570\u636e\u7684\u7f13\u5b58\uff1b\u56e0\u4e3a Redis \u652f\u6301\u591a\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u6570\u636e\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff0c\u8bbf\u95ee\u901f\u5ea6\u5757\uff0c\u6240\u4ee5 Redis \u5f88\u9002\u5408\u7528\u6765\u5b58\u50a8\u70ed\u70b9\u6570\u636e\uff1b \u9650\u65f6\u7c7b\u4e1a\u52a1\u7684\u5b9e\u73b0\uff1b\u53ef\u4ee5\u4f7f\u7528 expire \u547d\u4ee4\u8bbe\u7f6e key \u7684\u751f\u5b58\u65f6\u95f4\uff0c\u5230\u65f6\u95f4\u540e\u81ea\u52a8\u5220\u9664 key\u3002\u4f8b\u5982\u4f7f\u7528\u5728\u9a8c\u8bc1\u7801\u9a8c\u8bc1\u3001\u4f18\u60e0\u6d3b\u52a8\u7b49\u4e1a\u52a1\u573a\u666f\uff1b \u8ba1\u6570\u5668\u7684\u5b9e\u73b0\uff1b\u56e0\u4e3a incrby \u547d\u4ee4\u53ef\u4ee5\u5b9e\u73b0\u539f\u5b50\u6027\u7684\u9012\u589e\uff0c\u6240\u4ee5\u53ef\u4ee5\u8fd0\u7528\u4e8e\u9ad8\u5e76\u53d1\u7684\u79d2\u6740\u6d3b\u52a8\u3001\u5206\u5e03\u5f0f\u5e8f\u5217\u53f7\u7684\u751f\u6210\u3002\u4f8b\u5982\u9650\u5236\u4e00\u4e2a\u624b\u673a\u53f7\u53d1\u591a\u5c11\u6761\u77ed\u4fe1\u3001\u4e00\u4e2a\u63a5\u53e3\u4e00\u5206\u949f\u9650\u5236\u591a\u5c11\u8bf7\u6c42\u3001\u4e00\u4e2a\u63a5\u53e3\u4e00\u5929\u9650\u5236\u8c03\u7528\u591a\u5c11\u6b21\u7b49\u4e1a\u52a1\u573a\u666f\u3002 \u6392\u884c\u699c\u7684\u5b9e\u73b0\uff1b\u501f\u52a9 Sorted Set \u8fdb\u884c\u70ed\u70b9\u6570\u636e\u7684\u6392\u5e8f\u3002\u4f8b\u5982\uff1a\u4e0b\u5355\u91cf\u6700\u591a\u7684\u7528\u6237\u6392\u884c\u699c\uff0c\u6700\u70ed\u95e8\u7684\u5e16\u5b50\uff08\u56de\u590d\u6700\u591a\uff09\u7b49\u4e1a\u52a1\u573a\u666f\uff1b \u5206\u5e03\u5f0f\u9501\u5b9e\u73b0\uff1b\u53ef\u4ee5\u5229\u7528 Redis \u7684 setnx \u547d\u4ee4\u8fdb\u884c\u3002 \u961f\u5217\u673a\u5236\u5b9e\u73b0\uff1bRedis \u63d0\u4f9b\u4e86 list push \u548c list pop \u8fd9\u6837\u7684\u547d\u4ee4\uff0c\u6240\u4ee5\u80fd\u591f\u5f88\u65b9\u4fbf\u7684\u6267\u884c\u961f\u5217\u64cd\u4f5c\u3002 27. Redis \u9002\u7528\u573a\u666f\u6709\u54ea\u4e9b\uff1f \u9002\u7528\u7684\u573a\u666f\u6709\uff1a \u53ef\u4ee5\u5e94\u7528\u4e8e\u9ad8\u5e76\u53d1\u8bfb\u5199\u7684\u70ed\u6570\u636e\u4e2d \u6d77\u91cf\u6570\u636e\u7684\u8bfb\u5199 \u6570\u636e\u5904\u7406\u4e1a\u52a1\u590d\u6742\u548c\u5bf9\u5b89\u5168\u6027\u8981\u6c42\u8f83\u9ad8\u7684\u7cfb\u7edf \u6269\u5c55\u6027\u8981\u6c42\u9ad8\u7684\u6570\u636e\u4e2d \u4e8c\u3001Redis \u6570\u636e\u7ed3\u6784\u6307\u4ee4\uff0816 \u9898\uff09 1. Redis \u7684\u4e00\u4e2a\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u503c\u80fd\u5b58\u50a8\u6700\u5927\u5bb9\u91cf\u662f\u591a\u5c11\uff1f \u5b57\u7b26\u4e32\u7c7b\u578b\u662f\u6700\u57fa\u672c\u7684\u6570\u636e\u7c7b\u578b\uff0c \u662f\u4e8c\u8fdb\u5236\u5b89\u5168\u7684\u5b57\u7b26\u4e32\uff0c\u6700\u5927 512M \u3002 2. Redis \u5e38\u7528\u7684\u54c8\u5e0c\u547d\u4ee4\u6709\u54ea\u4e9b\uff1f \u54c8\u5e0c\u7c7b\u578b\u64cd\u4f5c\u547d\u4ee4\u548c\u65b9\u6cd5\u4e3a\uff1a 3. Redis \u5404\u4e2a\u6570\u636e\u7c7b\u578b\u6700\u5927\u5b58\u50a8\u91cf\u5206\u522b\u662f\u591a\u5c11\uff1f \u5b83\u4eec\u6700\u5927\u5b58\u50a8\u91cf\u5206\u522b\u4e3a\uff1a Strings \u7c7b\u578b\uff1a\u4e00\u4e2a String \u7c7b\u578b\u7684 value \u6700\u5927\u53ef\u4ee5\u5b58\u50a8 512M\uff1b List \u7c7b\u578b\uff1alist \u7684\u5143\u7d20\u4e2a\u6570\u6700\u591a\u4e3a 2^32-1 \u4e2a\uff0c\u4e5f\u5c31\u662f 429496729 5 \u4e2a\uff1b Sets \u7c7b\u578b\uff1a\u5143\u7d20\u4e2a\u6570\u6700\u591a\u4e3a 2^32-1 \u4e2a\uff0c\u4e5f\u5c31\u662f 4294967295 \u4e2a\uff1b Hashes \u7c7b\u578b\uff1a\u952e\u503c\u5bf9\u4e2a\u6570\u6700\u591a\u4e3a 2^32-1 \u4e2a\uff0c\u4e5f\u5c31\u662f 4294967295 \u4e2a\uff1b Sorted sets \u7c7b\u578b\uff1a\u8ddf Sets \u7c7b\u578b\u76f8\u4f3c\u3002\u5143\u7d20\u4e2a\u6570\u6700\u591a\u4e3a 2^32-1 \u4e2a\uff0c\u4e5f\u5c31\u662f 4294967295 \u4e2a\u3002 4. \u8bf7\u4ecb\u7ecd\u4e00\u4e0b Redis \u7684\u6570\u636e\u7c7b\u578b Sorted Set\uff08zset\uff09\u4ee5\u53ca\u5e95\u5c42\u5b9e\u73b0\u673a\u5236\uff1f zset \u7684\u529f\u80fd\u548c sets \u7c7b\u4f3c\uff0c\u4f46\u662f\u5b83\u5728\u96c6\u5408\u5185\u7684\u5143\u7d20\u662f\u6709\u987a\u5e8f\uff0c\u4e0d\u80fd\u91cd\u590d\u7684 \u3002\u6240\u4ee5\u9002\u5408\u505a\u6392\u884c\u699c\u4e4b\u7c7b\u7684\u529f\u80fd\u3002 \u5b83\u5e95\u5c42\u5b9e\u73b0\u673a\u5236\u7684\u5b9e\u73b0\u65b9\u5f0f\u6709\u4e24\u79cd\uff0c \u5206\u522b\u4e3a ziplist\uff08\u538b\u7f29\u5217\u8868\uff09 \u6216\u8005 skiplist\uff08\u8df3\u8dc3\u8868\uff09 \u3002\u5b83\u4eec\u7684\u533a\u522b\u4e3a\uff1a \u5e95\u5c42\u4f7f\u7528\u7684\u6570\u636e\u7ed3\u6784\u5b9e\u73b0\u4e0d\u540c\uff1a ziplist \u7f16\u7801\u7684\u6709\u5e8f\u96c6\u5408\u5bf9\u8c61\u4f7f\u7528\u538b\u7f29\u5217\u8868\u4f5c\u4e3a\u5e95\u5c42\u5b9e\u73b0\uff0c\u800c skiplist \u7f16\u7801\u7684\u6709\u5e8f\u96c6\u5408\u5bf9\u8c61\u4f7f\u7528 zset \u7ed3\u6784\u4f5c\u4e3a\u5e95\u5c42\u5b9e\u73b0 \u3002 \u5e95\u5c42\u96c6\u5408\u5143\u7d20\u4fdd\u5b58\u7684\u65b9\u5f0f\u4e0d\u540c\uff1bziplist \u4e2d\u7684\u6bcf\u4e2a\u96c6\u5408\u5143\u7d20\u4f7f\u7528\u4e24\u4e2a\u7d27\u6328\u5728\u4e00\u8d77\u7684\u538b\u7f29\u5217\u8868\u8282\u70b9\u6765\u4fdd\u5b58\uff0c\u7b2c\u4e00\u4e2a\u8282\u70b9\u4fdd\u5b58\u5143\u7d20\u7684\u6210\u5458\uff0c\u7b2c\u4e8c\u4e2a\u8282\u70b9\u4fdd\u5b58\u5143\u7d20\u7684\u5206\u503c\u3002\u5e76\u4e14\u538b\u7f29\u5217\u8868\u5185\u7684\u96c6\u5408\u5143\u7d20\u6309\u5206\u503c\u4ece\u5c0f\u5230\u5927\u7684\u987a\u5e8f\u8fdb\u884c\u6392\u5217\uff0c\u5c0f\u7684\u653e\u7f6e\u5728\u9760\u8fd1\u8868\u5934\u7684\u4f4d\u7f6e\uff0c\u5927\u7684\u653e\u7f6e\u5728\u9760\u8fd1\u8868\u5c3e\u7684\u4f4d\u7f6e\u3002skiplist \u7684\u4e00\u4e2a zset \u7ed3\u6784\u540c\u65f6\u5305\u542b\u4e00\u4e2a\u5b57\u5178\u548c\u4e00\u4e2a\u8df3\u8dc3\u8868\u3002\u5b57\u5178\u7684\u952e\u4fdd\u5b58\u5143\u7d20\u7684\u503c\uff0c\u5b57\u5178\u7684\u503c\u5219\u4fdd\u5b58\u5143\u7d20\u7684\u5206\u503c\uff1b\u8df3\u8dc3\u8868\u8282\u70b9\u7684 object \u5c5e\u6027\u4fdd\u5b58\u5143\u7d20\u7684\u6210\u5458\uff0c\u8df3\u8dc3\u8868\u8282\u70b9\u7684 score \u5c5e\u6027\u4fdd\u5b58\u5143\u7d20\u7684\u5206\u503c\u3002 \u5f53\u6709\u5e8f\u96c6\u5408\u5bf9\u8c61\u4fdd\u5b58\u7684\u5143\u7d20\u6570\u91cf\u5c0f\u4e8e 128 \u4e2a\uff0c\u5e76\u4e14\u4fdd\u5b58\u7684\u6240\u6709\u5143\u7d20\u957f\u5ea6\u90fd\u5c0f\u4e8e 64 \u5b57\u8282\u65f6\uff0c\u5bf9\u8c61\u4f7f\u7528 ziplist \u7f16\u7801\u3002\u5426\u5219\u4f7f\u7528 skiplist \u7f16\u7801\u3002 5. Redis \u4e8b\u52a1\u76f8\u5173\u7684\u547d\u4ee4\u6709\u54ea\u51e0\u4e2a\uff1f \u4e8b\u52a1\u4ece\u5f00\u59cb\u5230\u6267\u884c\u4f1a\u7ecf\u5386\u7684\u4e09\u4e2a\u9636\u6bb5\uff1a \u5f00\u59cb\u4e8b\u52a1\u3001\u547d\u4ee4\u5165\u961f\u3001 \u6267\u884c\u4e8b\u52a1 \u3002 \u5b83\u4ee5 MULTI \u5f00\u59cb\u4e00\u4e2a\u4e8b\u52a1\uff0c\u7136\u540e\u8ba9\u591a\u4e2a\u547d\u4ee4\u5165\u961f\u5230\u4e8b\u52a1\u4e2d\uff0c \u6700\u540e\u901a\u8fc7\u547d\u4ee4 EXEC \u89e6\u53d1\u6267\u884c\u4e8b\u52a1 \u3002\u5b83\u4eec\u7684\u6267\u884c\u547d\u4ee4\u6709\uff1a 6. Redis key \u7684\u8fc7\u671f\u65f6\u95f4\u548c\u6c38\u4e45\u6709\u6548\u5206\u522b\u600e\u4e48\u8bbe\u7f6e\uff1f \u53ef\u4ee5\u4f7f\u7528 EXPIRE \u548c PERSIST \u547d\u4ee4\u3002 \u5bf9\u4e00\u4e2a\u5df2\u7ecf\u5e26\u6709\u751f\u5b58\u65f6\u95f4\u7684 key \u6267\u884c EXPIRE \u547d\u4ee4\uff0c\u65b0\u6307\u5b9a\u7684\u751f\u5b58\u65f6\u95f4\u4f1a\u53d6\u4ee3\u65e7\u7684\u751f\u5b58\u65f6\u95f4\u3002 PERSIST \u547d\u4ee4\u53ef\u4ee5\u79fb\u9664\u7ed9\u5b9a key \u7684\u751f\u5b58\u65f6\u95f4\uff0c\u5c06\u8fd9\u4e2a key \u4ece\u5e26\u751f\u5b58\u65f6\u95f4\u8f6c\u6362\u6210\u6301\u4e45\u7684\u3002 7. \u4e00\u4e2a Redis \u5b9e\u4f8b\u6700\u591a\u80fd\u5b58\u653e\u591a\u5c11\u7684 keys\uff1fList\u3001Set\u3001Sorted Set \u4ed6\u4eec\u6700\u591a\u80fd\u5b58\u653e\u591a\u5c11\u5143\u7d20\uff1f Redis \u5b9e\u4f8b\u6700\u591a\u53ef\u4ee5\u5b58\u653e 2 \u7684 32 \u6b21\u65b9 -1 \u4e2a keys\uff0c\u53ea\u8981 Redis \u7684\u5185\u5b58\u7a7a\u95f4\u8db3\u591f\u53ef\u4ee5\u652f\u6301\uff0c\u4efb\u4f55\u7684 list\u3001set\u3001sorted set \u90fd\u53ef\u4ee5\u653e 2^32 -1 \u4e2a\u5143\u7d20\u3002 8. Redis \u652f\u6301\u54ea\u51e0\u79cd\u6570\u636e\u7ed3\u6784\uff1f Redis \u652f\u6301\u7684\u6570\u636e\u7ed3\u6784\u4e3b\u8981\u6709\uff1a\u5b57\u7b26\u4e32\uff08string\uff09\u3001\u54c8\u5e0c\uff08Hash\uff09\u3001\u5217\u8868\uff08List\uff09\u3001\u96c6\u5408\uff08Set\uff09\u3001\u6709\u5e8f\u96c6\u5408\uff08Sorted set\uff09\u7b49\u4e94\u79cd\u6570\u636e\u7ed3\u6784\u7c7b\u578b\u3002 9. \u5982\u4f55\u8bbe\u7f6e Redis \u7684\u6700\u5927\u8fde\u63a5\u6570\uff1f\u67e5\u770b Redis \u7684\u6700\u5927\u8fde\u63a5\u6570\uff1f\u67e5\u770b Redis \u7684\u5f53\u524d\u8fde\u63a5\u6570\uff1f \u8bbe\u7f6e Redis \u7684\u6700\u5927\u8fde\u63a5\u6570\u7684\u547d\u4ee4\u4e3a\uff1a redis-server -maxclients 100000\uff08\u8fde\u63a5\u6570\uff09; \u67e5\u770b Redis \u6700\u5927\u8fde\u63a5\u6570\u7684\u547d\u4ee4\u4e3a\uff1a config get maxclients \u67e5\u770b Redis \u8fde\u63a5\u6570\u7684\u547d\u4ee4\u4e3a\uff1a info \u547d\u4ee4 \u5728 redis-cli \u4e2d\u8f93\u5165 info \u547d\u4ee4\u5373\u53ef\u67e5\u770b\u3002 10. Redis \u8bbe\u7f6e\u952e\u7684\u751f\u5b58\u65f6\u95f4\u548c\u8fc7\u671f\u65f6\u95f4\u6709\u54ea\u4e9b\u547d\u4ee4\uff1f Redis \u63d0\u4f9b\u4e86\u8fc7\u671f\u65f6\u95f4\u5904\u7406\u51fd\u6570\uff0c\u53ef\u4ee5\u5bf9\u6307\u5b9a\u7684\u952e\u540d\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002\u5982\u679c\u5bf9\u952e\u540d\u4e0d\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u4e5f\u53ef\u4ee5\u4f7f\u7528 DEL \u51fd\u6570\u5bf9\u6570\u636e\u8fdb\u884c\u5220\u9664\u3002 \u5f53\u7528\u6237\u5bf9\u4e00\u4e2a\u952e\u540d\u8bbe\u7f6e\u4e86\u751f\u6548\u65f6\u95f4\uff0c\u6211\u4eec\u53ef\u4ee5\u8bf4\u8fd9\u4e2a\u952e\u540d\u5b58\u5728\u201c\u751f\u5b58\u65f6\u95f4\u201d\u6216\u201c\u5728\u6307\u5b9a\u65f6\u95f4\u540e\u8fc7\u671f\u201d\u3002\u5bf9\u952e\u540d\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u53ef\u4ee5\u6709\u6548\u5730\u91ca\u653e\u952e\u540d\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5728\u5b9e\u9645\u7684\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u662f\u975e\u5e38\u63d0\u5021\u7684\u4e00\u79cd\u505a\u6cd5\u3002\u76f8\u5173\u547d\u4ee4\u5982\u4e0b\uff1a 11. Redis \u7684 String \u7c7b\u578b\u4f7f\u7528 SSD \u65b9\u5f0f\u5b9e\u73b0\u7684\u597d\u5904\uff1f SDS \u5b9e\u73b0\u65b9\u5f0f\u76f8\u5bf9 C \u8bed\u8a00\u7684 String \u7684\u597d\u5904\u6709\uff1a \u907f\u514d\u7f13\u51b2\u533a\u6ea2\u51fa\uff1b\u5bf9\u5b57\u7b26\u4fee\u6539\u65f6\uff0c\u53ef\u4ee5\u6839\u636e len \u5c5e\u6027\u68c0\u67e5\u7a7a\u95f4\u662f\u5426\u6ee1\u8db3\u8981\u6c42\u3002 \u5e38\u6570\u590d\u6742\u5ea6\u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6 \uff1b\u83b7\u53d6\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u76f4\u63a5\u8bfb\u53d6 len \u5c5e\u6027\u5c31\u53ef\u4ee5\u83b7\u53d6\u3002\u800c C \u8bed\u8a00\u4e2d\uff0c\u56e0\u4e3a\u5b57\u7b26\u4e32\u662f\u7b80\u5355\u7684\u5b57\u7b26\u6570\u7ec4\uff0c\u6c42\u957f\u5ea6\u65f6\u5185\u90e8\u5176\u5b9e\u662f\u76f4\u63a5\u987a\u5e8f\u904d\u5386\u6570\u7ec4\u5185\u5bb9\uff0c\u627e\u5230 '\\0' \u5bf9\u5e94\u7684\u5b57\u7b26\uff0c\u8ba1\u7b97\u51fa\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u3002\u590d\u6742\u5ea6\u5373 O(N)\u3002 \u51cf\u5c11\u5185\u5b58\u5206\u914d\u6b21\u6570 \uff1b\u901a\u8fc7\u7ed3\u6784\u4e2d\u7684 len \u548c free \u4e24\u4e2a\u5c5e\u6027\uff0c\u66f4\u597d\u7684\u534f\u52a9\u7a7a\u95f4\u9884\u5206\u914d\u4ee5\u53ca\u60f0\u6027\u7a7a\u95f4\u91ca\u653e\u3002 \u4e8c\u8fdb\u5236\u5b89\u5168 \uff1bSSD \u4e0d\u662f\u4ee5\u7a7a\u5b57\u7b26\u4e32\u6765\u5224\u65ad\u662f\u5426\u7ed3\u675f\uff0c\u800c\u662f\u4ee5 len \u5c5e\u6027\u6765\u5224\u65ad\u5b57\u7b26\u4e32\u662f\u5426\u7ed3\u675f\u3002\u800c\u5728 C \u8bed\u8a00\u4e2d\uff0c\u5b57\u7b26\u4e32\u8981\u6c42\u9664\u4e86\u672b\u5c3e\u4e4b\u5916\u4e0d\u80fd\u51fa\u73b0\u7a7a\u5b57\u7b26\uff0c\u5426\u5219\u4f1a\u88ab\u7a0b\u5e8f\u8ba4\u4e3a\u662f\u5b57\u7b26\u4e32\u7684\u7ed3\u5c3e\u3002\u8fd9\u5c31\u4f7f\u5f97 C \u5b57\u7b26\u4e32\u53ea\u80fd\u5b58\u50a8\u6587\u672c\u6570\u636e\uff0c\u800c\u4e0d\u80fd\u4fdd\u5b58\u56fe\u50cf\uff0c\u97f3\u9891\u7b49\u4e8c\u8fdb\u5236\u6570\u636e\u3002 \u517c\u5bb9 C \u5b57\u7b26\u4e32\u51fd\u6570 \uff1b\u53ef\u4ee5\u91cd\u7528 C \u8bed\u8a00\u5e93\u7684 \u7684\u4e00\u90e8\u5206\u51fd\u6570\u3002 \u4ee5\u4e0a\u51e0\u70b9\u597d\u5904\u53ef\u4ee5\u6982\u62ec\u5982\u4e0b\uff1a 12. \u8bf7\u4ecb\u7ecd\u4e00\u4e0b Redis \u7684 String \u7c7b\u578b\u5e95\u5c42\u5b9e\u73b0\uff1f Redis \u5e95\u5c42\u5b9e\u73b0\u4e86\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\u7684\u7c7b\u578b\uff08SDS\uff09\uff0c\u6765\u8868\u793a String \u7c7b\u578b\u3002\u6ca1\u6709\u76f4\u63a5\u4f7f\u7528 C \u8bed\u8a00\u5b9a\u4e49\u7684\u5b57\u7b26\u4e32\u7c7b\u578b\u3002 Redis \u5e95\u5c42\u4f7f\u7528\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\uff08simple dynamic string\uff0cSDS\uff09\u7684\u62bd\u8c61\u7c7b\u578b\u5b9e\u73b0\u7684\u3002\u9ed8\u8ba4\u4ee5 SDS \u4f5c\u4e3a\u81ea\u5df1\u7684\u5b57\u7b26\u4e32\u8868\u793a\u3002\u800c\u6ca1\u6709\u76f4\u63a5\u4f7f\u7528 C \u8bed\u8a00\u5b9a\u4e49\u7684\u5b57\u7b26\u4e32\u7c7b\u578b\u3002 SDS \u7684\u5b9a\u4e49\u683c\u5f0f\u5982\u4e0b\uff1a struct sdshdr{ //\u8bb0\u5f55 buf \u6570\u7ec4\u4e2d\u5df2\u4f7f\u7528\u5b57\u8282\u7684\u6570\u91cf //\u7b49\u4e8e SDS \u4fdd\u5b58\u5b57\u7b26\u4e32\u7684\u957f\u5ea6 int len; //\u8bb0\u5f55 buf \u6570\u7ec4\u4e2d\u672a\u4f7f\u7528\u5b57\u8282\u7684\u6570\u91cf int free; //\u5b57\u8282\u6570\u7ec4\uff0c\u7528\u4e8e\u4fdd\u5b58\u5b57\u7b26\u4e32 char buf[]; //buf\u7684\u5927\u5c0f\u7b49\u4e8elen+free+1\uff0c\u5176\u4e2d\u591a\u4f59\u76841\u4e2a\u5b57\u8282\u662f\u7528\u6765\u5b58\u50a8\u2018\\0\u2019\u7684\u3002 } SDS \u7684\u5b58\u50a8\u793a\u4f8b\u5982\u4e0b\uff1a 13. Redis \u7684\u94fe\u8868\u6570\u636e\u7ed3\u6784\u7684\u7279\u5f81\u6709\u54ea\u4e9b\uff1f \u5177\u6709\u4ee5\u4e0b\u7279\u5f81\uff1a \u901a\u8fc7 len \u5c5e\u6027\u6765\u8bb0\u5f55\u94fe\u8868\u957f\u5ea6\uff1b \u94fe\u8868\u7684\u6700\u524d\u548c\u6700\u540e\u8282\u70b9\u90fd\u6709\u5f15\u7528\uff0c\u83b7\u53d6\u524d\u540e\u8282\u70b9\u7684\u590d\u6742\u5ea6\u90fd\u4e3a O(1)\uff1b \u5bf9\u94fe\u8868\u7684\u8bbf\u95ee\u90fd\u662f\u4ee5 null \u7ed3\u675f\u3002 14. Redis \u7684\u5185\u5b58\u6d88\u8017\u5206\u7c7b\u6709\u54ea\u4e9b\uff1f\u5185\u5b58\u7edf\u8ba1\u4f7f\u7528\u4ec0\u4e48\u547d\u4ee4\uff1f \u5185\u5b58\u6d88\u8017\u53ef\u4ee5\u5206\u7c7b\u4e3a\uff1a \u5bf9\u8c61\u5185\u5b58\uff1a\u8be5\u5185\u5b58\u5360\u7528\u6700\u5927\uff0c\u5b58\u50a8\u7528\u6237\u7684\u6240\u6709\u6570\u636e\u3002\u5305\u62ec\u6240\u6709 key \u7684\u5927\u5c0f\u548c value \u7684\u5927\u5c0f \u3002 \u7f13\u51b2\u5185\u5b58\uff1a\u4e3b\u8981\u6709\u5ba2\u6237\u7aef\u7f13\u5b58\u3001\u590d\u5236\u79ef\u538b\u7f13\u5b58\u3001AOF \u7f13\u5b58\u7b49\uff1b \u5185\u5b58\u788e\u7247\uff1a\u5bf9 key \u6570\u636e\u66f4\u65b0\uff0c\u6570\u636e\u8fc7\u671f\u7b49\u90fd\u53ef\u80fd\u4ea7\u751f\u5185\u5b58\u788e\u7247 \u3002 15. \u600e\u4e48\u53d1\u73b0 bigkey? \u53ef\u4ee5\u4f7f\u7528 redis-cli \u2013bigkeys \u547d\u4ee4\u7edf\u8ba1 bigkey \u7684\u5206\u5e03\u3002 \u4e5f\u53ef\u4ee5\u5728\u751f\u4ea7\u73af\u8282\u4e0b\u6267\u884c debug object key \u547d\u4ee4\u67e5\u770b serializedlength \u5c5e\u6027\uff0c\u83b7\u5f97 key \u5bf9\u5e94\u7684 value \u5e8f\u5217\u5316\u4e4b\u540e\u7684\u5b57\u8282\u6570\u3002 16. \u4ec0\u4e48\u662f bigkey\uff1f\u6709\u4ec0\u4e48\u5f71\u54cd\uff1f bigkey \u662f\u6307\u952e\u503c\u5360\u7528\u5185\u5b58\u7a7a\u95f4\u975e\u5e38\u5927\u7684 key\u3002\u4f8b\u5982\u4e00\u4e2a\u5b57\u7b26\u4e32 a \u5b58\u50a8\u4e86 200M \u7684\u6570\u636e \u3002 bigkey \u7684\u4e3b\u8981\u5f71\u54cd\u6709\uff1a \u7f51\u7edc\u963b\u585e \uff1b\u83b7\u53d6 bigkey \u65f6\uff0c\u4f20\u8f93\u7684\u6570\u636e\u91cf\u6bd4\u8f83\u5927\uff0c\u4f1a\u589e\u52a0\u5e26\u5bbd\u7684\u538b\u529b\u3002 \u8d85\u65f6\u963b\u585e \uff1b\u56e0\u4e3a bigkey \u5360\u7528\u7684\u7a7a\u95f4\u6bd4\u8f83\u5927\uff0c\u6240\u4ee5\u64cd\u4f5c\u8d77\u6765\u6548\u7387\u4f1a\u6bd4\u8f83\u4f4e\uff0c\u5bfc\u81f4\u51fa\u73b0\u963b\u585e\u7684\u53ef\u80fd\u6027\u589e\u52a0\u3002 \u5bfc\u81f4\u5185\u5b58\u7a7a\u95f4\u4e0d\u5e73\u8861\uff1b\u4e00\u4e2a bigkey \u5b58\u50a8\u6570\u636e\u91cf\u6bd4\u8f83\u5927\uff0c\u540c\u4e00\u4e2a key \u5728\u540c\u4e00\u4e2a\u8282\u70b9\u6216\u670d\u52a1\u5668\u4e2d\u5b58\u50a8\uff0c\u4f1a\u9020\u6210\u4e00\u5b9a\u5f71\u54cd\u3002 \u4e09\u3001\u9ad8\u5e76\u53d1\u5904\u7406\uff0821 \u9898\uff09 1. Redis \u5e38\u89c1\u6027\u80fd\u95ee\u9898\u548c\u89e3\u51b3\u65b9\u6848\u6709\u54ea\u4e9b\uff1f Redis \u5e38\u89c1\u6027\u80fd\u95ee\u9898\u548c\u89e3\u51b3\u65b9\u6848\u5982\u4e0b\uff1a Master \u6700\u597d\u4e0d\u8981\u505a\u4efb\u4f55\u6301\u4e45\u5316\u5de5\u4f5c\uff0c \u5982 RDB \u5185\u5b58\u5feb\u7167\u548c AOF \u65e5\u5fd7\u6587\u4ef6 \uff1b \u5982\u679c\u6570\u636e\u6bd4\u8f83\u91cd\u8981\uff0c\u67d0\u4e2a Slave \u5f00\u542f AOF \u5907\u4efd\u6570\u636e\uff0c\u7b56\u7565\u8bbe\u7f6e\u4e3a\u6bcf\u79d2\u540c\u6b65\u4e00\u6b21\uff1b \u4e3a\u4e86\u4e3b\u4ece\u590d\u5236\u7684\u901f\u5ea6\u548c\u8fde\u63a5\u7684\u7a33\u5b9a\u6027\uff0cMaster \u548c Slave \u6700\u597d\u5728\u540c\u4e00\u4e2a\u5c40\u57df\u7f51\u5185 \uff1b \u5c3d\u91cf\u907f\u514d\u5728\u538b\u529b\u5f88\u5927\u7684\u4e3b\u5e93\u4e0a\u589e\u52a0\u4ece\u5e93\uff1b \u4e3b \u4ece\u590d\u5236\u4e0d\u8981\u7528\u56fe\u72b6\u7ed3\u6784\uff0c\u7528\u5355\u5411\u94fe\u8868\u7ed3\u6784\u66f4\u4e3a\u7a33\u5b9a \uff0c\u5373\uff1a Master <- Slave1 <- Slave2 <- Slave3\u2026.\uff1b \u8fd9\u6837\u7684\u7ed3\u6784\u65b9\u4fbf\u89e3\u51b3\u5355\u70b9\u6545\u969c\u95ee\u9898\uff0c\u5b9e\u73b0 Slave \u5bf9 Master \u7684\u66ff\u6362\u3002\u5982\u679c Master \u6302\u4e86\uff0c\u53ef\u4ee5\u7acb\u523b\u542f\u7528 Slave1 \u505a Master\uff0c\u5176\u4ed6\u4e0d\u53d8\u3002 2. MySQL \u91cc\u6709 2000w \u6570\u636e\uff0cRedis \u4e2d\u53ea\u5b58 20w \u7684\u6570\u636e\uff0c\u5982\u4f55\u4fdd\u8bc1 Redis \u4e2d\u7684\u6570\u636e\u90fd\u662f\u70ed\u70b9\u6570\u636e\uff1f \u56e0\u4e3a\u5185\u5b58\u7684\u7a7a\u95f4\u662f\u6709\u9650\u7684\uff0c\u6240\u4ee5 Redis \u6dd8\u6c70\u673a\u5236\u4e3b\u8981\u4e3a\u4e86\u89e3\u51b3\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\uff0cRedis \u4e2d\u5b58\u5728\u5f88\u591a\u8fc7\u671f\u952e\uff0c\u5b9a\u671f\u5220\u9664\u7b56\u7565\u968f\u673a\u62bd\u67e5\u65f6\u6ca1\u6709\u62bd\u67e5\u5230\uff0c\u5e76\u4e14\u4e5f\u6ca1\u6709\u8d70\u60f0\u6027\u5220\u9664\u7b56\u7565\u65f6\uff0c\u5927\u91cf\u8fc7\u671f\u952e\u5360\u7528\u5185\u5b58\u7684\u95ee\u9898\u3002 \u5982\u679c\u5185\u5b58\u53ea\u80fd\u5b58 20w \u6570\u636e\uff0c\u800c\u6211\u4eec\u9700\u8981\u5b58\u50a8 2000w \u7684\u6570\u636e\u65f6\uff0c \u81ea\u7136\u5c31\u9700\u8981\u5bf9\u591a\u51fa\u6765\u7684\u6570\u636e\u8fdb\u884c\u5220\u9664\u6216\u8986\u76d6\uff0c\u4fdd\u8bc1\u5185\u5b58\u4e2d\u5b58\u50a8\u7684\u6570\u636e\u90fd\u662f\u70ed\u6570\u636e \u3002 \u6240\u4ee5\u5f53 Redis \u5185\u5b58\u6570\u636e\u96c6\u7684\u5927\u5c0f\u4e0a\u5347\u5230\u4e00\u5b9a\u6570\u91cf\u65f6\uff0c\u5c31\u4f1a\u6267\u884c\u6570\u636e\u6dd8\u6c70\u7b56\u7565\u3002 3. \u5047\u5982 Redis \u91cc\u9762\u6709 1 \u4ebf\u4e2a key\uff0c\u5176\u4e2d\u6709 10w \u4e2a key \u662f\u4ee5\u67d0\u4e2a\u56fa\u5b9a\u7684\u5df2\u77e5\u7684\u524d\u7f00\u5f00\u5934\u7684\uff0c\u5982\u679c\u5c06\u5b83\u4eec\u5168\u90e8\u627e\u51fa\u6765\uff1f \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 keys \u547d\u4ee4\u548c scan \u547d\u4ee4 \uff0c\u4f46\u662f\u4f1a\u53d1\u73b0\u4f7f\u7528 scan \u66f4\u597d\u3002 1. \u4f7f\u7528 keys \u547d\u4ee4 \u76f4\u63a5\u4f7f\u7528 keys \u547d\u4ee4\u67e5\u8be2\uff0c\u4f46\u662f\u5982\u679c\u662f\u5728\u751f\u4ea7\u73af\u5883\u4e0b\u4f7f\u7528\u4f1a\u51fa\u73b0\u4e00\u4e2a\u95ee\u9898\uff0ckeys \u547d\u4ee4\u662f\u904d\u5386\u67e5\u8be2\u7684\uff0c\u67e5\u8be2\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(n)\uff0c\u6570\u636e\u91cf\u8d8a\u5927\u67e5\u8be2\u65f6\u95f4\u8d8a\u957f\u3002 \u800c\u4e14 Redis \u662f\u5355\u7ebf\u7a0b\uff0ckeys \u6307\u4ee4\u4f1a\u5bfc\u81f4\u7ebf\u7a0b\u963b\u585e\u4e00\u6bb5\u65f6\u95f4\uff0c\u4f1a\u5bfc\u81f4\u7ebf\u4e0a Redis \u505c\u987f\u4e00\u6bb5\u65f6\u95f4\uff0c\u76f4\u5230 keys \u6267\u884c\u5b8c\u6bd5\u624d\u80fd\u6062\u590d\u3002\u8fd9\u5728\u751f\u4ea7\u73af\u5883\u662f\u4e0d\u5141\u8bb8\u7684\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u4e2a\u547d\u4ee4\u6ca1\u6709\u5206\u9875\u529f\u80fd\uff0c\u4f1a\u4e00\u6b21\u6027\u67e5\u8be2\u51fa\u6240\u6709\u7b26\u5408\u6761\u4ef6\u7684 key \u503c\uff0c\u4f1a\u53d1\u73b0\u67e5\u8be2\u7ed3\u679c\u975e\u5e38\u5927\uff0c\u8f93\u51fa\u7684\u4fe1\u606f\u975e\u5e38\u591a\u3002\u6240\u4ee5\u4e0d\u63a8\u8350\u4f7f\u7528\u8fd9\u4e2a\u547d\u4ee4\u3002 2. \u4f7f\u7528 scan \u547d\u4ee4 scan \u547d\u4ee4\u53ef\u4ee5\u5b9e\u73b0\u548c keys \u4e00\u6837\u7684\u5339\u914d\u529f\u80fd\uff0c\u4f46\u662f scan \u547d\u4ee4\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e0d\u4f1a\u963b\u585e\u7ebf\u7a0b\uff0c\u5e76\u4e14\u67e5\u627e\u7684\u6570\u636e\u53ef\u80fd\u5b58\u5728\u91cd\u590d\uff0c\u9700\u8981\u5ba2\u6237\u7aef\u64cd\u4f5c\u53bb\u91cd\u3002\u56e0\u4e3a scan \u662f\u901a\u8fc7\u6e38\u6807\u65b9\u5f0f\u67e5\u8be2\u7684\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5bfc\u81f4 Redis \u51fa\u73b0\u5047\u6b7b\u7684\u95ee\u9898\u3002 Redis \u67e5\u8be2\u8fc7\u7a0b\u4e2d\u4f1a\u628a\u6e38\u6807\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u5355\u6b21\u8fd4\u56de\u7a7a\u503c\u4e14\u6e38\u6807\u4e0d\u4e3a 0\uff0c\u5219\u8bf4\u660e\u904d\u5386\u8fd8\u6ca1\u7ed3\u675f\uff0c\u5ba2\u6237\u7aef\u7ee7\u7eed\u904d\u5386\u67e5\u8be2\u3002scan \u5728\u68c0\u7d22\u7684\u8fc7\u7a0b\u4e2d\uff0c\u88ab\u5220\u9664\u7684\u5143\u7d20\u662f\u4e0d\u4f1a\u88ab\u67e5\u8be2\u51fa\u6765\u7684\uff0c\u4f46\u662f\u5982\u679c\u5728\u8fed\u4ee3\u8fc7\u7a0b\u4e2d\u6709\u5143\u7d20\u88ab\u4fee\u6539\uff0cscan \u4e0d\u80fd\u4fdd\u8bc1\u67e5\u8be2\u51fa\u5bf9\u5e94\u5143\u7d20\u3002\u76f8\u5bf9\u6765\u8bf4\uff0cscan \u6307\u4ee4\u67e5\u627e\u82b1\u8d39\u7684\u65f6\u95f4\u4f1a\u6bd4 keys \u6307\u4ee4\u957f\u3002 4. \u4ec0\u4e48\u662f\u7f13\u5b58\u7a7f\u900f\uff1f\u600e\u4e48\u89e3\u51b3\uff1f \u5927\u91cf\u7684\u8bf7\u6c42\u77ac\u65f6\u6d8c\u5165\u7cfb\u7edf\uff0c\u800c\u8fd9\u4e2a\u6570\u636e\u5728 Redis \u4e2d\u4e0d\u5b58\u5728\uff0c\u6240\u6709\u7684\u8bf7\u6c42\u90fd\u843d\u5230\u4e86\u6570\u636e\u5e93\u4e0a\u628a\u6570\u636e\u5e93\u6253\u6b7b \u3002 \u9020\u6210\u8fd9\u79cd\u60c5\u51b5\u7684\u539f\u56e0\u6709\u7cfb\u7edf\u8bbe\u8ba1\u4e0d\u5408\u7406\u3001\u7f13\u5b58\u6570\u636e\u66f4\u65b0\u4e0d\u53ca\u65f6\uff0c\u6216\u722c\u866b\u7b49\u6076\u610f\u653b\u51fb \u3002 \u89e3\u51b3\u529e\u6cd5\u6709\uff1a 1. \u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668 \u5c06\u67e5\u8be2\u7684\u53c2\u6570\u90fd\u5b58\u50a8\u5230\u4e00\u4e2a bitmap \u4e2d\uff0c\u5728\u67e5\u8be2\u7f13\u5b58\u524d\uff0c\u518d\u627e\u4e2a\u65b0\u7684 bitmap\uff0c\u5728\u91cc\u9762\u5bf9\u53c2\u6570\u8fdb\u884c\u9a8c\u8bc1\u3002\u5982\u679c\u9a8c\u8bc1\u7684 bitmap \u4e2d\u5b58\u5728\uff0c\u5219\u8fdb\u884c\u5e95\u5c42\u7f13\u5b58\u7684\u6570\u636e\u67e5\u8be2\uff0c\u5982\u679c bitmap \u4e2d\u4e0d\u5b58\u5728\u67e5\u8be2\u53c2\u6570\uff0c\u5219\u8fdb\u884c\u62e6\u622a\uff0c\u4e0d\u518d\u8fdb\u884c\u7f13\u5b58\u7684\u6570\u636e\u67e5\u8be2\u3002 2. \u7f13\u5b58\u7a7a\u5bf9\u8c61 \u5982\u679c\u4ece\u6570\u636e\u5e93\u67e5\u8be2\u7684\u7ed3\u679c\u4e3a\u7a7a\uff0c\u4f9d\u7136\u628a\u8fd9\u4e2a\u7ed3\u679c\u8fdb\u884c\u7f13\u5b58\uff0c\u90a3\u4e48\u5f53\u7528 key \u83b7\u53d6\u6570\u636e\u65f6\uff0c\u5373\u4f7f\u6570\u636e\u4e0d\u5b58\u5728\uff0cRedis \u4e5f\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de\u7ed3\u679c\uff0c\u907f\u514d\u591a\u6b21\u8bbf\u95ee\u6570\u636e\u5e93\u3002 \u4f46\u662f\u7f13\u5b58\u7a7a\u503c\u7684\u7f3a\u70b9\u662f \uff1a \u5982\u679c\u5b58\u5728\u9ed1\u5ba2\u6076\u610f\u7684\u968f\u673a\u8bbf\u95ee\uff0c\u9020\u6210\u7f13\u5b58\u8fc7\u591a\u7684\u7a7a\u503c\uff0c\u90a3\u4e48\u53ef\u80fd\u9020\u6210\u5f88\u591a\u5185\u5b58\u7a7a\u95f4\u7684\u6d6a\u8d39 \u3002\u4f46\u662f\u4e5f\u53ef\u4ee5\u5bf9\u8fd9\u4e9b\u6570\u636e\u8bbe\u7f6e\u5f88\u77ed\u7684\u8fc7\u671f\u65f6\u95f4\u6765\u63a7\u5236\uff1b \u5982\u679c\u67e5\u8be2\u7684 key \u5bf9\u5e94\u7684 Redis \u7f13\u5b58\u7a7a\u503c\u6ca1\u6709\u8fc7\u671f\uff0c\u6570\u636e\u5e93\u8fd9\u65f6\u6709\u4e86\u65b0\u6570\u636e\uff0c\u90a3\u4e48\u4f1a\u51fa\u73b0\u6570\u636e\u5e93\u548c\u7f13\u5b58\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898 \u3002\u4f46\u662f\u53ef\u4ee5\u4fdd\u8bc1\u5f53\u6570\u636e\u5e93\u6709\u6570\u636e\u540e\u66f4\u65b0\u7f13\u5b58\u8fdb\u884c\u89e3\u51b3\u3002 5. \u4ec0\u4e48\u662f\u7f13\u5b58\u96ea\u5d29\uff1f\u600e\u4e48\u89e3\u51b3\uff1f \u7f13\u5b58\u96ea\u5d29\u662f\u6307\u5f53\u5927\u91cf\u7f13\u5b58\u5931\u6548\u65f6\uff0c\u5927\u91cf\u7684\u8bf7\u6c42\u8bbf\u95ee\u76f4\u63a5\u8bf7\u6c42\u6570\u636e\u5e93\uff0c\u5bfc\u81f4\u6570\u636e\u5e93\u670d\u52a1\u5668\u65e0\u6cd5\u6297\u4f4f\u8bf7\u6c42\u6216\u6302\u6389\u7684\u60c5\u51b5\u3002\u8fd9\u65f6\u7f51\u7ad9\u5e38\u5e38\u4f1a\u51fa\u73b0 502 \u9519\u8bef\uff0c\u5bfc\u81f4\u7f51\u7ad9\u4e0d\u53ef\u7528\u95ee\u9898 \u3002 \u5728\u9884\u9632\u7f13\u5b58\u96ea\u5d29\u65f6\uff0c\u5efa\u8bae\u9075\u5b88\u4ee5\u4e0b\u51e0\u4e2a\u539f\u5219\uff1a \u5408\u7406\u89c4\u5212\u7f13\u5b58\u7684\u5931\u6548\u65f6\u95f4\uff0c\u53ef\u4ee5\u7ed9\u7f13\u5b58\u65f6\u95f4\u52a0\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u9632\u6b62\u7edf\u4e00\u65f6\u95f4\u8fc7\u671f\uff1b \u5408\u7406\u8bc4\u4f30\u6570\u636e\u5e93\u7684\u8d1f\u8f7d\u538b\u529b\uff0c\u8fd9\u6709\u5229\u4e8e\u5728\u5408\u7406\u8303\u56f4\u5185\u90e8\u5206\u7f13\u5b58\u5931\uff0c\u6570\u636e\u5e93\u4e5f\u53ef\u4ee5\u6b63\u5e38\u8bbf\u95ee\uff1b \u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u8fc7\u8f7d\u4fdd\u62a4\u6216\u5e94\u7528\u5c42\u9650\u6d41\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4e00\u822c\u662f\u5728\u7f51\u7ad9\u5904\u4e8e\u5927\u6d41\u91cf\u3001\u9ad8\u5e76\u53d1\u65f6\uff0c\u670d\u52a1\u5668\u6574\u4f53\u4e0d\u80fd\u627f\u53d7\u65f6\uff0c\u53ef\u4ee5\u91c7\u7528\u7684\u4e00\u79cd\u9650\u6d41\u4fdd\u62a4\u63aa\u65bd\uff1b \u6700\u540e\u8fd8\u53ef\u4ee5\u8003\u8651\u591a\u7ea7\u7f13\u5b58\u8bbe\u8ba1\uff0c\u5b9e\u73b0\u7f13\u5b58\u7684\u9ad8\u53ef\u7528\u3002 6. \u5982\u679c\u6709\u5927\u91cf\u7684 key \u9700\u8981\u8bbe\u7f6e\u540c\u4e00\u65f6\u95f4\u8fc7\u671f\uff0c\u4e00\u822c\u9700\u8981\u6ce8\u610f\u4ec0\u4e48\uff1f \u5982\u679c\u6709\u5927\u91cf\u7684 key \u5728\u540c\u4e00\u65f6\u95f4\u8fc7\u671f\uff0c\u90a3\u4e48\u53ef\u80fd\u540c\u4e00\u79d2\u90fd\u4ece\u6570\u636e\u5e93\u83b7\u53d6\u6570\u636e\uff0c\u7ed9\u6570\u636e\u5e93\u9020\u6210\u5f88\u5927\u7684\u538b\u529b\uff0c\u5bfc\u81f4\u6570\u636e\u5e93\u5d29\u6e83\uff0c\u7cfb\u7edf\u51fa\u73b0 502 \u95ee\u9898\u3002 \u4e5f\u6709\u53ef\u80fd\u540c\u65f6\u5931\u6548\uff0c\u90a3\u4e00\u523b\u4e0d\u7528\u90fd\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u538b\u529b\u4e0d\u591f\u5927\u7684\u8bdd\uff0c\u90a3\u4e48 Redis \u4f1a\u51fa\u73b0\u77ed\u6682\u7684\u5361\u987f\u95ee\u9898\u3002\u6240\u4ee5\u4e3a\u4e86\u9884\u9632\u8fd9\u79cd\u95ee\u9898\u7684\u53d1\u751f\uff0c\u6700\u597d\u7ed9\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u52a0\u4e00\u4e2a\u968f\u673a\u503c\uff0c\u8ba9\u8fc7\u671f\u65f6\u95f4\u66f4\u52a0\u5206\u6563\u3002 7. Redis \u54e8\u5175\u548c\u96c6\u7fa4\u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f Redis \u7684\u54e8\u5175\u4f5c\u7528\u662f\u7ba1\u7406\u591a\u4e2a Redis \u670d\u52a1\u5668\uff0c\u63d0\u4f9b\u4e86\u76d1\u63a7\u3001\u63d0\u9192\u4ee5\u53ca\u81ea\u52a8\u7684\u6545\u969c\u8f6c\u79fb\u7684\u529f\u80fd \u3002 \u54e8\u5175\u53ef\u4ee5\u4fdd\u8bc1\u5f53\u4e3b\u670d\u52a1\u5668\u6302\u4e86\u540e\uff0c\u53ef\u4ee5\u4ece\u4ece\u670d\u52a1\u5668\u9009\u62e9\u4e00\u53f0\u5f53\u4e3b\u670d\u52a1\u5668\uff0c\u628a\u522b\u7684\u4ece\u670d\u52a1\u5668\u8f6c\u79fb\u5230\u8bfb\u65b0\u7684\u4e3b\u673a \u3002 Redis \u54e8\u5175\u7684\u4e3b\u8981\u529f\u80fd\u6709\uff1a \u96c6\u7fa4\u76d1\u63a7 \uff1a \u5bf9 Redis \u96c6\u7fa4\u7684\u4e3b\u4ece\u8fdb\u7a0b\u8fdb\u884c\u76d1\u63a7\uff0c\u5224\u65ad\u662f\u5426\u6b63\u5e38\u5de5\u4f5c \u3002 \u6d88\u606f\u901a\u77e5 \uff1a\u5982\u679c\u5b58\u5728 Redis \u5b9e\u4f8b\u6709\u6545\u969c\uff0c\u90a3\u4e48\u54e8\u5175\u53ef\u4ee5\u53d1\u9001\u62a5\u8b66\u6d88\u606f\u901a\u77e5\u7ba1\u7406\u5458\u3002 \u6545\u969c\u8f6c\u79fb \uff1a \u5982\u679c\u4e3b\u673a\uff08master\uff09\u8282\u70b9\u6302\u4e86\uff0c\u90a3\u4e48\u53ef\u4ee5\u81ea\u52a8\u8f6c\u79fb\u5230\u4ece\uff08slave\uff09\u8282\u70b9\u4e0a \u3002 \u914d\u7f6e\u4e2d\u5fc3 \uff1a\u5f53\u5b58\u5728\u6545\u969c\u65f6\uff0c\u5bf9\u6545\u969c\u8fdb\u884c\u8f6c\u79fb\u540e\uff0c\u914d\u7f6e\u4e2d\u5fc3\u4f1a\u901a\u77e5\u5ba2\u6237\u7aef\u65b0\u7684\u4e3b\u673a\uff08master\uff09\u5730\u5740\u3002 Redis \u7684\u96c6\u7fa4\u7684\u529f\u80fd\u662f\u4e3a\u4e86\u89e3\u51b3\u5355\u673a Redis \u5bb9\u91cf\u6709\u9650\u7684\u95ee\u9898\uff0c\u5c06\u6570\u636e\u6309\u4e00\u5b9a\u7684\u89c4\u5219\u5206\u914d\u5230\u591a\u53f0\u673a\u5668\uff0c\u5bf9\u5185\u5b58\u7684\u6bcf\u79d2\u8bbf\u95ee\u4e0d\u53d7\u9650\u4e8e\u5355\u53f0\u670d\u52a1\u5668\uff0c\u53ef\u53d7\u76ca\u4e8e\u5206\u5e03\u5f0f\u96c6\u7fa4\u9ad8\u6269\u5c55\u6027\u3002 8. Redis \u7684\u54e8\u5175\u6709\u4ec0\u4e48\u529f\u80fd\uff1f \u54e8\u5175\u662f Redis \u96c6\u7fa4\u67b6\u6784\u4e2d\u975e\u5e38\u91cd\u8981\u7684\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u4e3b\u8981\u529f\u80fd\u5982\u4e0b\uff1a \u96c6\u7fa4\u76d1\u63a7\uff0c\u8d1f\u8d23\u76d1\u63a7 Redis Master \u548c Slave \u8fdb\u7a0b\u662f\u5426\u6b63\u5e38\u5de5\u4f5c\uff1b \u6d88\u606f\u901a\u77e5\uff0c\u5982\u679c\u67d0\u4e2a Redis \u5b9e\u4f8b\u6709\u6545\u969c\uff0c\u90a3\u4e48\u54e8\u5175\u8d1f\u8d23\u53d1\u9001\u6d88\u606f\u4f5c\u4e3a\u62a5\u8b66\u901a\u77e5\u7ed9\u7ba1\u7406\u5458 \uff1b \u6545\u969c\u8f6c\u79fb\uff0c\u5982\u679c Master node \u6302\u6389\u4e86\uff0c\u4f1a\u81ea\u52a8\u8f6c\u79fb\u5230 Slave node \u4e0a \uff1b \u914d\u7f6e\u4e2d\u5fc3\uff0c\u5982\u679c\u6545\u969c\u8f6c\u79fb\u53d1\u751f\u4e86\uff0c\u901a\u77e5 Client \u5ba2\u6237\u7aef\u65b0\u7684 Master \u5730\u5740 \u3002 9. \u8bf7\u4ecb\u7ecd\u51e0\u4e2a\u53ef\u80fd\u5bfc\u81f4 Redis \u963b\u585e\u7684\u539f\u56e0 Redis \u4ea7\u751f\u963b\u585e\u7684\u539f\u56e0\u4e3b\u8981\u6709\u5185\u90e8\u548c\u5916\u90e8\u4e24\u4e2a\u539f\u56e0\u5bfc\u81f4\uff1a 1. \u5185\u90e8\u539f\u56e0 \u5982\u679c Redis \u4e3b\u673a\u7684 CPU \u8d1f\u8f7d\u8fc7\u9ad8\uff0c\u4e5f\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u5d29\u6e83\uff1b \u6570\u636e\u6301\u4e45\u5316\u5360\u7528\u8d44\u6e90\u8fc7\u591a\uff1b \u5bf9 Redis \u7684 API \u6216\u6307\u4ee4\u4f7f\u7528\u4e0d\u5408\u7406\uff0c\u5bfc\u81f4 Redis \u51fa\u73b0\u95ee\u9898\u3002 2. \u5916\u90e8\u539f\u56e0 \u5916\u90e8\u539f\u56e0\u4e3b\u8981\u662f\u670d\u52a1\u5668\u7684\u539f\u56e0\uff0c\u4f8b\u5982\u670d\u52a1\u5668\u7684 CPU \u7ebf\u7a0b\u5728\u5207\u6362\u8fc7\u7a0b\u4e2d\u7ade\u4e89\u8fc7\u5927\uff0c\u5185\u5b58\u51fa\u73b0\u95ee\u9898\u3001\u7f51\u7edc\u95ee\u9898\u7b49\u3002 10. Redis \u7684\u540c\u6b65\u673a\u5236\u4e86\u89e3\u4e48\uff1f Redis \u53ef\u4ee5\u4f7f\u7528\u4e3b\u4ece\u540c\u6b65\u3001\u4ece\u4ece\u540c\u6b65 \u3002 \u7b2c\u4e00\u6b21\u540c\u6b65\u65f6\uff0c\u4e3b\u8282\u70b9\u505a\u4e00\u6b21 bgsave\uff0c\u5e76\u540c\u65f6\u5c06\u540e\u7eed\u4fee\u6539\u64cd\u4f5c\u8bb0\u5f55\u5230\u5185\u5b58 buffer\uff0c\u5f85\u5b8c\u6210\u540e\u5c06 RDB \u6587\u4ef6\u5168\u91cf\u540c\u6b65\u5230\u590d\u5236\u8282\u70b9\uff0c\u590d\u5236\u8282\u70b9\u63a5\u53d7\u5b8c\u6210\u540e\u5c06 RDB \u955c\u50cf\u52a0\u8f7d\u5230\u5185\u5b58 \u3002 \u52a0\u8f7d\u5b8c\u6210\u540e\uff0c\u518d\u901a\u77e5\u4e3b\u8282\u70b9\u5c06\u671f\u95f4\u4fee\u6539\u7684\u64cd\u4f5c\u8bb0\u5f55\u540c\u6b65\u5230\u590d\u5236\u8282\u70b9\u8fdb\u884c\u91cd\u653e\u5c31\u5b8c\u6210\u4e86\u540c\u6b65\u8fc7\u7a0b\u3002 11. \u5982\u4f55\u5904\u7406 Redis \u96c6\u7fa4\u4e2d big key \u548c hot key\uff1f \u5bf9\u4e8e big key \u5148\u5206\u6790\u4e1a\u52a1\u5b58\u5728\u5927\u952e\u503c\u662f\u5426\u5408\u7406\uff0c\u5982\u679c\u4e0d\u5408\u7406\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u4eec\u62c6\u5206\u4e3a\u591a\u4e2a\u5c0f\u7684\u5b58\u50a8 \u3002\u6216\u8005\u770b\u662f\u5426\u53ef\u4ee5\u4f7f\u7528\u522b\u7684\u5b58\u50a8\u4ecb\u8d28\u5b58\u50a8\u8fd9\u79cd big key \u89e3\u51b3\u5360\u7528\u5185\u5b58\u7a7a\u95f4\u5927\u7684\u95ee\u9898\u3002 \u5bf9\u4e8e hot key \u6211\u4eec\u53ef\u4ee5\u5728\u5176\u4ed6\u673a\u5668\u4e0a\u590d\u5236\u8fd9\u4e2a key \u7684\u5907\u4efd\uff0c\u8ba9\u8bf7\u6c42\u8fdb\u6765\u7684\u65f6\u5019\uff0c\u53bb\u968f\u673a\u7684\u5230\u5404\u53f0\u673a\u5668\u4e0a\u8bbf\u95ee\u7f13\u5b58 \u3002\u6240\u4ee5\u5269\u4e0b\u7684\u95ee\u9898\u5c31\u662f\u5982\u4f55\u505a\u5230\u8ba9\u8bf7\u6c42\u5e73\u5747\u7684\u5206\u5e03\u5230\u5404\u53f0\u673a\u5668\u4e0a\u3002 12. \u600e\u4e48\u53bb\u53d1\u73b0 Redis \u963b\u585e\u5f02\u5e38\u60c5\u51b5\uff1f \u53ef\u4ee5\u4ece\u4ee5\u4e0b\u4e24\u65b9\u9762\u51c6\u5907\uff1a 1. \u4f7f\u7528 Redis \u81ea\u8eab\u76d1\u63a7\u7cfb\u7edf \u4f7f\u7528 Redis \u81ea\u8eab\u76d1\u63a7\u7cfb\u7edf\uff0c\u53ef\u4ee5\u5bf9 CPU\u3001\u5185\u5b58\u3001\u78c1\u76d8\u3001\u547d\u4ee4\u8017\u65f6\u7b49\u963b\u585e\u95ee\u9898\u8fdb\u884c\u76d1\u63a7\uff0c\u5f53\u76d1\u63a7\u7cfb\u7edf\u53d1\u73b0\u5404\u4e2a\u76d1\u63a7\u6307\u6807\u5b58\u5728\u5f02\u5e38\u7684\u65f6\u5019\uff0c\u53d1\u9001\u62a5\u8b66\u3002 2. \u4f7f\u7528\u5e94\u7528\u670d\u52a1\u76d1\u63a7 \u5f53 Redis \u5b58\u5728\u963b\u585e\u65f6\uff0c\u5e94\u7528\u54cd\u5e94\u65f6\u95f4\u5c31\u4f1a\u5ef6\u957f\uff0c\u5e94\u7528\u53ef\u4ee5\u611f\u77e5\u53d1\u73b0\u95ee\u9898\uff0c\u5e76\u53d1\u9001\u62a5\u8b66\u7ed9\u7ba1\u7406\u4eba\u5458\u3002 13. \u4f60\u77e5\u9053\u6709\u54ea\u4e9b Redis \u5206\u533a\u5b9e\u73b0\u65b9\u6848\uff1f \u5ba2\u6237\u7aef\u5206\u533a\u5c31\u662f\u5728\u5ba2\u6237\u7aef\u5c31\u5df2\u7ecf\u51b3\u5b9a\u6570\u636e\u4f1a\u88ab\u5b58\u50a8\u5230\u54ea\u4e2a Redis \u8282\u70b9\u6216\u8005\u4ece\u54ea\u4e2a Redis \u8282\u70b9\u8bfb\u53d6\u3002\u5927\u591a\u6570\u5ba2\u6237\u7aef\u5df2\u7ecf\u5b9e\u73b0\u4e86\u5ba2\u6237\u7aef\u5206\u533a\u3002 \u4ee3\u7406\u5206\u533a\u610f\u5473\u7740\u5ba2\u6237\u7aef\u5c06\u8bf7\u6c42\u53d1\u9001\u7ed9\u4ee3\u7406\uff0c\u7136\u540e\u4ee3\u7406\u51b3\u5b9a\u53bb\u54ea\u4e2a\u8282\u70b9\u5199\u6570\u636e\u6216\u8005\u8bfb\u6570\u636e\u3002\u4ee3\u7406\u6839\u636e\u5206\u533a\u89c4\u5219\u51b3\u5b9a\u8bf7\u6c42\u54ea\u4e9b Redis \u5b9e\u4f8b\uff0c\u7136\u540e\u6839\u636e Redis \u7684\u54cd\u5e94\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002Redis \u548c Memcached \u7684\u4e00\u79cd\u4ee3\u7406\u5b9e\u73b0\u5c31\u662f Twemproxy\u3002 \u67e5\u8be2\u8def\u7531\uff08Query routing\uff09\u7684\u610f\u601d\u662f\u5ba2\u6237\u7aef\u968f\u673a\u5730\u8bf7\u6c42\u4efb\u610f\u4e00\u4e2a Redis \u5b9e\u4f8b\uff0c\u7136\u540e\u7531 Redis \u5c06\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u6b63\u786e\u7684 Redis \u8282\u70b9\u3002 Redis Cluster \u5b9e\u73b0\u4e86\u4e00\u79cd\u6df7\u5408\u5f62\u5f0f\u7684\u67e5\u8be2\u8def\u7531\uff0c\u4f46\u5e76\u4e0d\u662f\u76f4\u63a5\u5c06\u8bf7\u6c42\u4ece\u4e00\u4e2a Redis \u8282\u70b9\u8f6c\u53d1\u5230\u53e6\u4e00\u4e2a Redis \u8282\u70b9\uff0c\u800c\u662f\u5728\u5ba2\u6237\u7aef\u7684\u5e2e\u52a9\u4e0b\u76f4\u63a5 redirected \u5230\u6b63\u786e\u7684 Redis \u8282\u70b9\u3002 14. Redis \u96c6\u7fa4\u4e4b\u95f4\u7684\u590d\u5236\u65b9\u5f0f\u662f\uff1f \u9700\u8981\u77e5\u9053 Redis \u7684\u590d\u5236\u65b9\u5f0f\u524d\uff0c\u9700\u8981\u77e5\u9053\u4e3b\u4ece\u590d\u5236\uff08Master-Slave Replication\uff09\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u5177\u4f53\u4e3a\uff1a Slave \u4ece\u8282\u70b9\u670d\u52a1\u542f\u52a8\u5e76\u8fde\u63a5\u5230 Master \u4e4b\u540e\uff0c\u5b83\u5c06\u4e3b\u52a8\u53d1\u9001\u4e00\u4e2a SYNC \u547d\u4ee4\uff1b Master \u670d\u52a1\u4e3b\u8282\u70b9\u6536\u5230\u540c\u6b65\u547d\u4ee4\u540e\u5c06\u542f\u52a8\u540e\u53f0\u5b58\u76d8\u8fdb\u7a0b\uff0c\u540c\u65f6\u6536\u96c6\u6240\u6709\u63a5\u6536\u5230\u7684\u7528\u4e8e\u4fee\u6539\u6570\u636e\u96c6\u7684\u547d\u4ee4\uff0c\u5728\u540e\u53f0\u8fdb\u7a0b\u6267\u884c\u5b8c\u6bd5\u540e\uff0cMaster \u5c06\u4f20\u9001\u6574\u4e2a\u6570\u636e\u5e93\u6587\u4ef6\u5230 Slave\uff0c\u4ee5\u5b8c\u6210\u4e00\u6b21\u5b8c\u5168\u540c\u6b65\uff1b Slave \u4ece\u8282\u70b9\u670d\u52a1\u5728\u63a5\u6536\u5230\u6570\u636e\u5e93\u6587\u4ef6\u6570\u636e\u4e4b\u540e\u5c06\u5176\u5b58\u76d8\u5e76\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d \uff1b \u6b64\u540e\uff0cMaster \u4e3b\u8282\u70b9\u7ee7\u7eed\u5c06\u6240\u6709\u5df2\u7ecf\u6536\u96c6\u5230\u7684\u4fee\u6539\u547d\u4ee4\uff0c\u548c\u65b0\u7684\u4fee\u6539\u547d\u4ee4\u4f9d\u6b21\u4f20\u9001\u7ed9 Slaves\uff0cSlave \u5c06\u5728\u672c\u6b21\u6267\u884c\u8fd9\u4e9b\u6570\u636e\u4fee\u6539\u547d\u4ee4\uff0c\u4ece\u800c\u8fbe\u5230\u6700\u7ec8\u7684\u6570\u636e\u540c\u6b65\u3002 \u6574\u4e2a\u6267\u884c\u7684\u8fc7\u7a0b\u90fd\u662f\u4f7f\u7528\u5f02\u6b65\u590d\u5236\u7684\u65b9\u5f0f\u8fdb\u884c\u590d\u5236\u3002 15. \u4ec0\u4e48\u662f\u6570\u636e\u5e93\u7f13\u5b58\u53cc\u5199\u4e00\u81f4\u6027\uff1f \u5f53\u4e00\u4e2a\u6570\u636e\u9700\u8981\u66f4\u65b0\u65f6\uff0c\u56e0\u4e3a\u4e0d\u53ef\u80fd\u505a\u5230\u540c\u65f6\u66f4\u65b0\u6570\u636e\u5e93\u548c\u7f13\u5b58\uff0c\u90a3\u4e48\u6b64\u65f6\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\u5c31\u4e00\u5b9a\u4f1a\u53d1\u751f\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\uff0c\u800c\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\u5728\u91d1\u878d\u4ea4\u6613\u9886\u57df\u7684\u7cfb\u7edf\u4e2d\u662f\u80af\u5b9a\u4e0d\u5141\u8bb8\u7684\u3002 \u89e3\u51b3\u529e\u6cd5\uff1a\u8bfb\u7684\u65f6\u5019\u5148\u8bfb\u7f13\u5b58\uff0c\u7f13\u5b58\u6ca1\u6709\u7684\u8bdd\uff0c\u5c31\u8bfb\u6570\u636e\u5e93\uff0c\u7136\u540e\u53d6\u51fa\u6570\u636e\u540e\u653e\u5165\u7f13\u5b58\uff0c\u540c\u65f6\u8fd4\u56de\u54cd\u5e94\u3002\u66f4\u65b0\u7684\u65f6\u5019\uff0c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u7136\u540e\u518d\u5220\u9664\u7f13\u5b58\u3002 16. \u4e3a\u4ec0\u4e48\u8981\u505a Redis \u5206\u533a\uff1f \u5206\u533a\u53ef\u4ee5\u8ba9 Redis \u7ba1\u7406\u66f4\u5927\u7684\u5185\u5b58\uff0cRedis \u5c06\u53ef\u4ee5\u4f7f\u7528\u6240\u6709\u673a\u5668\u7684\u5185\u5b58\u3002\u5982 \u679c\u6ca1\u6709\u5206\u533a\uff0c\u4f60\u6700\u591a\u53ea\u80fd\u4f7f\u7528\u4e00\u53f0\u673a\u5668\u7684\u5185\u5b58 \u3002 \u5206\u533a\u4f7f Redis \u7684\u8ba1\u7b97\u80fd\u529b\u901a\u8fc7\u7b80\u5355\u5730\u589e\u52a0\u8ba1\u7b97\u673a\u5f97\u5230\u6210\u500d\u63d0\u5347\uff0cRedis \u7684\u7f51\u7edc\u5e26\u5bbd\u4e5f\u4f1a\u968f\u7740\u8ba1\u7b97\u673a\u548c\u7f51\u5361\u7684\u589e\u52a0\u800c\u6210\u500d\u589e\u957f\u3002 17. \u5206\u5e03\u5f0f Redis \u662f\u524d\u671f\u505a\u8fd8\u662f\u540e\u671f\u89c4\u6a21\u4e0a\u6765\u4e86\u518d\u505a\u597d\uff0c\u4e3a\u4ec0\u4e48\uff1f \u4e3a\u9632\u6b62\u4ee5\u540e\u6269\u5bb9\u589e\u52a0\u96be\u5ea6\uff0c\u6700\u597d\u7684\u529e\u6cd5\u5c31\u662f\u4e00\u5f00\u59cb\u5c31\u4f7f\u7528\u5206\u5e03\u5f0f\u3002 \u5373\u4fbf\u53ea\u6709\u4e00\u53f0\u670d\u52a1\u5668\uff0c\u4e5f\u53ef\u4ee5\u4e00\u5f00\u59cb\u5c31\u8ba9 Redis \u4ee5\u5206\u5e03\u5f0f\u7684\u65b9\u5f0f\u8fd0\u884c\uff0c\u4f7f\u7528\u5206\u533a\uff0c\u5728\u540c\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u542f\u52a8\u591a\u4e2a\u5b9e\u4f8b\u3002 \u521a\u5f00\u59cb\u64cd\u4f5c\u65f6\u6bd4\u8f83\u9ebb\u70e6\uff0c\u4f46\u662f\u5f53\u6570\u636e\u4e0d\u65ad\u589e\u957f\uff0c\u9700\u8981\u66f4\u591a\u7684 Redis \u670d\u52a1\u5668\u65f6\uff0c\u53ea\u9700\u8981\u5c06 Redis \u5b9e\u4f8b\u4ece\u4e00\u53f0\u670d\u52a1\u8fc1\u79fb\u5230\u53e6\u5916\u4e00\u53f0\u670d\u52a1\u5668\u5373\u53ef\uff0c\u800c\u4e0d\u7528\u8003\u8651\u91cd\u65b0\u5206\u533a\u7684\u95ee\u9898\u3002\u4e00\u65e6\u6dfb\u52a0\u4e86\u53e6\u4e00\u53f0\u670d\u52a1\u5668\uff0c\u53ea\u9700\u8981\u5c06\u4e00\u534a\u7684 Redis \u5b9e\u4f8b\u4ece\u7b2c\u4e00\u53f0\u673a\u5668\u8fc1\u79fb\u5230\u7b2c\u4e8c\u53f0\u673a\u5668\u3002 18. \u5982\u679c\u6709\u5927\u91cf\u7684 key \u9700\u8981\u8bbe\u7f6e\u540c\u4e00\u65f6\u95f4\u8fc7\u671f\uff0c\u4e00\u822c\u9700\u8981\u6ce8\u610f\u4ec0\u4e48\uff1f \u5982\u679c\u5927\u91cf\u7684 key \u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u7684\u8fc7\u4e8e\u96c6\u4e2d\uff0c\u5230\u8fc7\u671f\u7684\u90a3\u4e2a\u65f6\u95f4\u70b9\uff0credis \u53ef\u80fd\u4f1a\u51fa\u73b0\u77ed\u6682\u7684\u5361\u987f\u73b0\u8c61\u3002 \u4e00\u822c\u9700\u8981\u5728\u65f6\u95f4\u4e0a\u52a0\u4e00\u4e2a\u968f\u673a\u503c\uff0c\u4f7f\u5f97\u8fc7\u671f\u65f6\u95f4\u5206\u6563\u4e00\u4e9b\u3002 19. \u4ec0\u4e48\u662f\u5206\u5e03\u5f0f\u9501\uff1f\u6709\u4ec0\u4e48\u4f5c\u7528\uff1f \u5206\u5e03\u5f0f\u9501\u662f\u63a7\u5236\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e4b\u95f4\u540c\u6b65\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u7684\u4e00\u79cd\u65b9\u5f0f\u3002 \u5728\u5355\u673a\u6216\u8005\u5355\u8fdb\u7a0b\u73af\u5883\u4e0b\uff0c\u591a\u7ebf\u7a0b\u5e76\u53d1\u7684\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u9501\u6765\u4fdd\u8bc1\u4e00\u4e2a\u4ee3\u7801\u5757\u5728\u540c\u4e00\u65f6\u95f4\u5185\u53ea\u80fd\u7531\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u3002 \u6bd4\u5982 Java \u7684 Synchronized \u5173\u952e\u5b57\u548c Reentrantlock \u7c7b \u3002 \u5206\u5e03\u5f0f\u9501\u7684\u4f5c\u7528\u662f\u5f53\u591a\u4e2a\u8fdb\u7a0b\u4e0d\u5728\u540c\u4e00\u4e2a\u7cfb\u7edf\u4e2d\uff0c\u7528\u5206\u5e03\u5f0f\u9501\u53ef\u4ee5\u63a7\u5236\u591a\u4e2a\u8fdb\u7a0b\u5bf9\u8d44\u6e90\u7684\u8bbf\u95ee\u3002 20. \u5206\u5e03\u5f0f\u9501\u53ef\u4ee5\u901a\u8fc7\u4ec0\u4e48\u6765\u5b9e\u73b0\uff1f \u53ef\u4ee5\u4f7f\u7528 Memcached \u5b9e\u73b0\u5206\u5e03\u5f0f\u9501 \uff1aMemcached \u63d0\u4f9b\u4e86\u539f\u5b50\u6027\u64cd\u4f5c\u547d\u4ee4 add\uff0c\u7ebf\u7a0b\u83b7\u53d6\u5230\u9501\u3002key \u5df2\u5b58\u5728\u7684\u60c5\u51b5\u4e0b\uff0c\u5219 add \u5931\u8d25\uff0c\u83b7\u53d6\u9501\u4e5f\u5931\u8d25\u3002 \u4e5f\u53ef\u4ee5\u4f7f\u7528 Redis \u5b9e\u73b0\u5206\u5e03\u5f0f\u9501 \uff1aRedis \u7684 setnx \u547d\u4ee4\u4e3a\u539f\u5b50\u6027\u64cd\u4f5c\u547d\u4ee4\u3002\u53ea\u6709\u5728 key \u4e0d\u5b58\u5728\u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u80fd set \u6210\u529f\u3002\u548c Memcached \u7684 add \u65b9\u6cd5\u6bd4\u8f83\u7c7b\u4f3c\u3002 \u8fd8\u53ef\u4ee5\u4f7f\u7528 ZooKeeper \u5206\u5e03\u5f0f\u9501 \uff1a\u5229\u7528 ZooKeeper \u7684\u987a\u5e8f\u4e34\u65f6\u8282\u70b9\uff0c\u6765\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u548c\u7b49\u5f85\u961f\u5217\u3002 \u8fd8\u6709 Chubby \u5b9e\u73b0\u5206\u5e03\u5f0f\u9501 \uff1aChubby \u5e95\u5c42\u5229\u7528\u4e86 Paxos \u4e00\u81f4\u6027\u7b97\u6cd5\uff0c\u5b9e\u73b0\u7c97\u7c92\u5ea6\u5206\u5e03\u5f0f\u9501\u670d\u52a1\u3002 21. \u4ecb\u7ecd\u4e00\u4e0b\u5206\u5e03\u5f0f\u9501\u5b9e\u73b0\u9700\u8981\u6ce8\u610f\u7684\u4e8b\u9879\uff1f \u5206\u5e03\u5f0f\u9501\u5b9e\u73b0\u9700\u8981\u4fdd\u8bc1\u4ee5\u4e0b\u51e0\u70b9\uff1a \u4e92\u65a5\u6027\uff1a\u4efb\u610f\u65f6\u523b\uff0c\u53ea\u6709\u4e00\u4e2a\u8d44\u6e90\u80fd\u591f\u83b7\u53d6\u5230\u9501\uff1b \u5bb9\u707e\u6027\uff1a\u5728\u672a\u6210\u529f\u91ca\u653e\u9501\u7684\u7684\u60c5\u51b5\u4e0b\uff0c\u4e00\u5b9a\u65f6\u9650\u5185\u80fd\u591f\u6062\u590d\u9501\u7684\u6b63\u5e38\u529f\u80fd\uff1b \u7edf\u4e00\u6027\uff1a\u52a0\u9501\u548c\u89e3\u9501\u4fdd\u8bc1\u540c\u4e00\u8d44\u6e90\u6765\u8fdb\u884c\u64cd\u4f5c\u3002 \u56db\u3001\u6301\u4e45\u5316\uff088 \u9898\uff09 1. Redis \u4e2d\u7684 bgsave \u7684\u539f\u7406\u662f\u4ec0\u4e48\uff1f \u4f60\u7ed9\u51fa\u4e24\u4e2a\u8bcd\u6c47\u5c31\u53ef\u4ee5\u4e86\uff0cfork \u548c cow\u3002 fork \u662f\u6307 Redis \u901a\u8fc7\u521b\u5efa\u5b50\u8fdb\u7a0b\u6765\u8fdb\u884c bgsave \u64cd\u4f5c\uff0ccow \u6307\u7684\u662f copy on write\uff0c\u5b50\u8fdb\u7a0b\u521b\u5efa\u540e\uff0c\u7236\u5b50\u8fdb\u7a0b\u5171\u4eab\u6570\u636e\u6bb5\uff0c\u7236\u8fdb\u7a0b\u7ee7\u7eed\u63d0\u4f9b\u8bfb\u5199\u670d\u52a1\uff0c\u5199\u810f\u7684\u9875\u9762\u6570\u636e\u4f1a\u9010\u6e10\u548c\u5b50\u8fdb\u7a0b\u5206\u79bb\u5f00\u6765\u3002 2. \u5982\u4f55\u9009\u62e9\u5408\u9002\u7684\u6301\u4e45\u5316\u65b9\u5f0f\uff1f \u5728\u5b9e\u9645\u7684\u751f\u4ea7\u73af\u5883\u5f53\u4e2d\u5bf9\u4e8e\u9009\u62e9 RDB \u6301\u4e45\u5316\u65b9\u5f0f\u8fd8\u662f AOF \u6301\u4e45\u5316\u65b9\u5f0f\u90fd\u9700\u8981\u6839\u636e\u6570\u636e\u91cf\u3001\u5e94\u7528\u5bf9\u6570\u636e\u7684\u5b89\u5168\u8981\u6c42\u3001\u786c\u4ef6\u76f8\u5173\u9884\u7b97\u7b49\u60c5\u51b5\u7efc\u5408\u8003\u8651\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u8003\u8651\u4e3b\u4ece\u590d\u5236\u7684\u7b56\u7565\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e3b\u673a\uff08master\uff09\u548c\u4ece\u673a\uff08slave\uff09\u4f7f\u7528\u4e0d\u540c\u7684\u6301\u4e45\u5316\u65b9\u6848\u3002\u5bf9\u6b64\u4ee5\u4e0b\u53ea\u662f\u7b80\u5355\u7684\u8fdb\u884c\u4e00\u4e2a\u9009\u62e9\u7684\u4ecb\u7ecd\uff0c\u5177\u4f53\u5728\u5b9e\u9645\u7684\u5f00\u53d1\u5e94\u7528\u8fc7\u7a0b\u4e2d\u8fd8\u9700\u8981\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u7efc\u5408\u9009\u62e9\u3002 \u5982\u679c\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\u5bf9 Redis \u91cc\u7684\u6570\u636e\u5b8c\u5168\u4e22\u5f03\u4e5f\u4e0d\u4f1a\u6709\u4ec0\u4e48\u5f71\u54cd\u7684\u60c5\u51b5\uff0c\u90a3\u4e48\u9009\u62e9 RDB \u6301\u4e45\u5316\u65b9\u5f0f\u6bd4\u9009\u62e9 AOF \u6301\u4e45\u5316\u66f4\u6709\u5229\uff1b \u4f46\u662f\u5982\u679c\u9700\u8981\u9884\u9632\u6570\u636e\u79d2\u7ea7\u522b\u7684\u4e22\u5931\u65f6\uff0c\u5c31\u53ea\u80fd\u9009\u62e9 AOF \u6301\u4e45\u5316\u65b9\u5f0f\u4e86 \u3002 \u5f53 Redis \u7684\u7ed3\u6784\u662f\u4e3b\u4ece\u67b6\u6784\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u8bfb\u5199\u5206\u79bb\u6765\u5206\u62c5 Redis \u7684\u8bfb\u8bf7\u6c42\u538b\u529b\uff0c\u4e5f\u9884\u9632\u4e3b\u673a\uff08master\uff09\u5b95\u673a\u540e\u7ee7\u7eed\u63d0\u4f9b\u670d\u52a1\u3002 \u8fd9\u65f6\u5019\u53ef\u4ee5\u91c7\u7528\u8fd9\u6837\u4e00\u79cd\u7b56\u7565\uff1a\u5173\u95ed\u4e3b\u673a\uff08master\uff09\u7684\u6301\u4e45\u5316\u529f\u80fd\uff0c\u8fd9\u6837\u4fdd\u6301\u4e3b\u673a\uff08master\uff09\u7684\u9ad8\u6548\u6027\uff0c\u7136\u540e\u5173\u95ed\u4ece\u673a\uff08slave\uff09\u7684 RDB \u6301\u4e45\u5316\uff0c\u5f00\u542f AOF \u6301\u4e45\u5316\uff0c\u540c\u65f6\u5efa\u8bae\u5173\u95ed AOF \u7684\u81ea\u52a8\u91cd\u5199\u529f\u80fd\uff0c\u901a\u8fc7\u8bbe\u7f6e\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\uff0c\u5728\u5e94\u7528\u8bbf\u95ee\u6b21\u6570\u6bd4\u8f83\u5c11\u7684\u65f6\u95f4\u70b9\u518d\u901a\u8fc7\u8c03\u7528 bgrewriteaof \u547d\u4ee4\u8fdb\u884c\u81ea\u52a8\u91cd\u5199\uff0c\u4e3a\u4e86\u9632\u6b62\u6301\u4e45\u5316\u6570\u636e\u7684\u4e22\u5931\uff0c\u5efa\u8bae\u8bbe\u7f6e\u4e00\u4e2a\u5b9a\u65f6\u5668\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\u5bf9\u6301\u4e45\u5316\u6587\u4ef6\u8fdb\u884c\u5907\u4efd\u5e76\u6807\u8bb0\u597d\u5907\u4efd\u65f6\u95f4\u70b9\u3002 3. Redis \u6301\u4e45\u5316\u6570\u636e\u548c\u7f13\u5b58\u600e\u4e48\u505a\u6269\u5bb9\uff1f \u5982\u679c Redis \u88ab\u5f53\u505a\u7f13\u5b58\u4f7f\u7528\uff0c\u4f7f\u7528\u4e00\u81f4\u6027\u54c8\u5e0c\u5b9e\u73b0\u52a8\u6001\u6269\u5bb9\u7f29\u5bb9\u3002 \u5982\u679c Redis \u88ab\u5f53\u505a\u4e00\u4e2a\u6301\u4e45\u5316\u5b58\u50a8\u4f7f\u7528\uff0c \u5fc5\u987b\u4f7f\u7528\u56fa\u5b9a\u7684 keys-to-nodes \u6620\u5c04\u5173\u7cfb\uff0c\u8282\u70b9\u7684\u6570\u91cf\u4e00\u65e6\u786e\u5b9a\u4e0d\u80fd\u53d8\u5316\u3002 \u5426\u5219\u7684\u8bdd\uff08\u5373 Redis \u8282\u70b9\u9700\u8981\u52a8\u6001\u53d8\u5316\u7684\u60c5\u51b5\uff09\uff0c\u5fc5\u987b\u4f7f\u7528\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u8fdb\u884c\u6570\u636e\u518d\u5e73\u8861\u7684\u4e00\u5957\u7cfb\u7edf\uff0c\u800c\u5f53\u524d\u53ea\u6709 Redis \u96c6\u7fa4\u53ef\u4ee5\u505a\u5230\u8fd9\u6837\u3002 4. Redis \u6301\u4e45\u5316\u673a\u5236\u6709\u54ea\u4e9b\uff1f Redis \u4e3b\u8981\u652f\u6301\u7684\u6301\u4e45\u5316\u673a\u5236\u4e3a RDB\uff08\u5feb\u7167\uff09\u548c AOF\uff08\u8ffd\u52a0\u6587\u4ef6\uff09 \u3002 RDB \u6301\u4e45\u5316\u662f\u5728\u6307\u5b9a\u65f6\u95f4\u95f4\u9694\u5185\u4fdd\u5b58\u6570\u636e\u5feb\u7167\u5230\u786c\u76d8\u4e2d\u3002\u4f46 RDB \u7684\u6301\u4e45\u5316\u65b9\u5f0f\u6ca1\u6709\u529e\u6cd5\u5b9e\u73b0\u5b9e\u65f6\u6027\u7684\u6301\u4e45\u5316 \u3002 \u5f53\u5e94\u7528\u4f7f\u7528 RDB \u6301\u4e45\u5316\u540e\uff0c\u5982\u679c Redis \u7cfb\u7edf\u53d1\u751f\u5d29\u6e83\uff0c\u90a3\u4e48\u4f7f\u7528 RDB \u6062\u590d\u6570\u636e\u65f6\uff0c\u6062\u590d\u540e\u7684\u6570\u636e\u4e2d\uff0c\u5b58\u5728\u4e22\u5931\u6700\u8fd1\u4e00\u6b21\u751f\u6210\u5feb\u7167\u4e4b\u540e\u66f4\u6539\u7684\u6240\u6709\u6570\u636e\u3002\u6240\u4ee5 RDB \u6301\u4e45\u5316\u4e0d\u9002\u7528\u4e8e\u4e22\u5931\u4e00\u90e8\u5206\u6570\u636e\u4e5f\u4f1a\u5bf9\u5e94\u7528\u9020\u6210\u5f88\u5927\u5f71\u54cd\u7684\u5907\u4efd\u4e2d\u3002 AOF \u6301\u4e45\u5316\u662f\u628a\u547d\u4ee4\u8ffd\u52a0\u5230\u64cd\u4f5c\u65e5\u5fd7\u7684\u5c3e\u90e8\uff0c\u7136\u540e\u4fdd\u5b58\u6240\u6709\u5386\u53f2\u64cd\u4f5c\u3002AOF \u4e3b\u8981\u662f\u89e3\u51b3\u6570\u636e\u6301\u4e45\u5316\u7684\u5b9e\u65f6\u6027 \u3002 Redis \u670d\u52a1\u5668\u9ed8\u8ba4\u5f00\u542f RDB\uff0c\u5173\u95ed AOF\uff1b\u8981\u5f00\u542f AOF\uff0c\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\uff1a appendonly yes \u3002 AOF \u6301\u4e45\u5316\u76f8\u5bf9\u4e8e RDB \u6301\u4e45\u5316\u7684\u4f18\u70b9\u5728\u4e8e\u53ef\u4ee5\u5b9e\u65f6\u7684\u5bf9 Redis \u7f13\u5b58\u8fdb\u884c\u5199\u5165\u8bb0\u5f55\uff0c\u4fdd\u8bc1\u5feb\u901f\u6062\u590d\u7f13\u5b58\u65f6\u7684\u5b8c\u6574\u6027\u3002 5. Redis \u6301\u4e45\u5316\u673a\u5236 AOF \u548c RDB \u6709\u54ea\u4e9b\u4e0d\u540c\u4e4b\u5904\uff1f RDB \u548c AOF \u7684\u533a\u522b\uff1a \u6301\u4e45\u5316\u7684\u65b9\u5f0f\u4e0d\u540c \uff1a RDB \u6301\u4e45\u5316\u662f\u5728\u6307\u5b9a\u65f6\u95f4\u95f4\u9694\u5185\u4fdd\u5b58\u6570\u636e\u5feb\u7167\u5230\u786c\u76d8\u4e2d\uff08\u5feb\u7167\u7684\u65b9\u5f0f\uff09\u3002 AOF \u6301\u4e45\u5316\u662f\u628a\u547d\u4ee4\u8ffd\u52a0\u5230\u64cd\u4f5c\u65e5\u5fd7\u7684\u5c3e\u90e8\uff0c\u7136\u540e\u4fdd\u5b58\u6240\u6709\u5386\u53f2\u64cd\u4f5c\uff08\u8ffd\u52a0\u6587\u4ef6\uff09\u3002 \u6062\u590d\u7684\u6570\u636e\u5b89\u5168\u6027\u4e0d\u540c \uff1a RDB \u6062\u590d\u6570\u636e\u65f6\uff0c\u6062\u590d\u540e\u7684\u6570\u636e\u4e2d\uff0c\u5b58\u5728\u4e22\u5931\u6700\u8fd1\u4e00\u6b21\u751f\u6210\u5feb\u7167\u4e4b\u540e\u66f4\u6539\u7684\u6240\u6709\u6570\u636e\uff1b AOF \u6301\u4e45\u5316\u7684\u6570\u636e\u5b9e\u65f6\u6027\u548c\u5b89\u5168\u6027\u66f4\u9ad8 \u3002 \u7f13\u5b58\u6062\u590d\u7684\u901f\u5ea6\u4e0d\u540c \uff1a RDB \u4ea7\u751f\u7684\u6587\u4ef6\u7d27\u51d1\u538b\u7f29\u9ad8\uff0c\u8bfb\u53d6 RDB \u6587\u4ef6\u6062\u590d\u65f6\u901f\u5ea6\u6bd4 AOF \u5feb\uff1b \u7531\u4e8e AOF \u5b9e\u65f6\u8ffd\u52a0\u5199\u547d\u4ee4\uff0c\u6240\u4ee5 AOF \u7684\u7f13\u5b58\u6587\u4ef6\u4f53\u79ef\u6bd4\u8f83\u5927\uff0c \u4f46\u662f\u53ef\u4ee5\u901a\u8fc7\u91cd\u5199\uff08rewrite\uff09\u538b\u7f29 AOF \u6301\u4e45\u5316\u6587\u4ef6\u4f53\u79ef \u3002 6. \u8bf7\u4ecb\u7ecd\u4e00\u4e0b RDB \u6301\u4e45\u5316\u673a\u5236\u7684\u4f18\u7f3a\u70b9 \u5b83\u7684\u4f18\u70b9\u6709\uff1a RDB \u662f\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\u4e0a\u7684\u6570\u636e\u5feb\u7167\uff0c\u975e\u5e38\u9002\u5408\u4f7f\u7528\u5728\u5168\u91cf\u5907\u4efd\u7684\u60c5\u51b5\uff0c\u751f\u6210\u7684 RDB \u662f\u4e00\u4e2a\u7d27\u51d1\u538b\u7f29\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6 \u3002\u5feb\u7167\u4ea7\u751f\u7684 RDB \u6587\u4ef6\u53ef\u4ee5\u62f7\u8d1d\u5230\u8fdc\u7a0b\u673a\u5668\u6216\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u7528\u4e8e\u707e\u96be\u6062\u590d\uff1b RDB \u7684\u52a0\u8f7d\u6062\u590d\u6570\u636e\u901f\u5ea6\u5feb\u4e8e AOF \u7684\u6062\u590d\u65b9\u5f0f\u3002 \u5b83\u7684\u7f3a\u70b9\u6709\uff1a \u56e0\u4e3a bgsave \u6bcf\u6b21\u8fd0\u884c\u90fd\u8981\u6267\u884c fork \u64cd\u4f5c\u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u64cd\u4f5c\u6bd4\u8f83\u7e41\u7410 \uff0c\u5982\u679c\u5b9e\u65f6\u5b58\u50a8\u5feb\u7167\u4f1a\u5bfc\u81f4\u6210\u672c\u8fc7\u9ad8\uff0c\u6240\u4ee5 RDB \u53ea\u80fd\u5728\u7279\u5b9a\u6761\u4ef6\u4e0b\u8fdb\u884c\u4e00\u6b21\u6301\u4e45\u5316\uff0c\u4ece\u800c\u5bb9\u6613\u51fa\u73b0\u6570\u636e\u4e22\u5931\u7684\u60c5\u51b5\uff1b RDB \u6587\u4ef6\u662f\u4e00\u4e2a\u7279\u5b9a\u4e8c\u8fdb\u5236\u683c\u5f0f\u4fdd\u5b58\u7684\u6587\u4ef6\uff0cRedis \u7684\u7248\u672c\u66f4\u65b0\u8fc7\u7a0b\u4e2d\uff0c\u6709\u5bf9 RDB \u7684\u7248\u672c\u683c\u5f0f\u4fee\u6539 \uff0c\u4f1a\u51fa\u73b0\u8001\u7248\u672c\u7684 RDB \u6587\u4ef6\u65e0\u6cd5\u517c\u5bb9\u65b0\u7248\u672c\u7684 RDB \u683c\u5f0f\u95ee\u9898\u3002 7. \u8bf7\u4ecb\u7ecd\u4e00\u4e0b AOF \u6301\u4e45\u5316\u673a\u5236\u7684\u4f18\u7f3a\u70b9 \u5b83\u7684\u4f18\u70b9\u6709\uff1a AOF \u6301\u4e45\u5316\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u975e\u5e38\u5b8c\u6574\uff0c\u6545\u969c\u6062\u590d\u65f6\u76f8\u5bf9 RDB \u6301\u4e45\u5316\u4e22\u5931\u7684\u6570\u636e\u6700\u5c11\uff1b \u7531\u4e8e AOF \u662f\u53ef\u4ee5\u5b9e\u65f6\u5bf9\u7f13\u5b58\u547d\u4ee4\u8ffd\u52a0\u5230 AOF \u6587\u4ef6\u7684\u672b\u5c3e\uff0c\u6240\u4ee5\u53ef\u4ee5\u5bf9\u5386\u53f2\u64cd\u4f5c\u7684\u7f13\u5b58\u547d\u4ee4\u8fdb\u884c\u5904\u7406\u3002 \u5b83\u7684\u7f3a\u70b9\u6709\uff1a \u7531\u4e8e AOF \u6301\u4e45\u5316\u662f\u4e0d\u65ad\u5bf9 AOF \u6587\u4ef6\u8fdb\u884c\u8ffd\u52a0\u8bb0\u5f55\u7684\uff0c\u4f1a\u5bfc\u81f4 AOF \u6587\u4ef6\u4f53\u79ef\u5f88\u5927\uff0c\u6781\u7aef\u7684\u60c5\u51b5\u4e0b\u53ef\u80fd\u4f1a\u51fa\u73b0 AOF \u6587\u4ef6\u7528\u5b8c\u786c\u76d8\u7684\u53ef\u7528\u7a7a\u95f4\uff1b\u4f46\u662f Redis 2.4 \u7248\u672c\u4ee5\u540e\u652f\u6301 AOF \u81ea\u52a8\u91cd\u5199\uff0c\u6709\u6548\u7684\u89e3\u51b3 AOF \u6587\u4ef6\u8fc7\u5927\u7684\u95ee\u9898\uff1b \u5f53 AOF \u6587\u4ef6\u4f53\u79ef\u5f88\u5927\u65f6\uff0c\u4f1a\u51fa\u73b0\u6062\u590d\u901f\u5ea6\u6162\uff0c\u5bf9\u6027\u80fd\u5f71\u54cd\u5927\u7684\u95ee\u9898\uff1b \u5f53\u5f00\u542f AOF \u540e\uff0c\u5bf9 QPS \u4f1a\u6709\u4e00\u5b9a\u5f71\u54cd\uff0c\u76f8\u5bf9 RDB \u6765\u8bf4\uff0c\u5199 QPS \u4f1a\u4e0b\u964d\u3002 8. \u5982\u679c AOF \u6587\u4ef6\u7684\u6570\u636e\u51fa\u73b0\u5f02\u5e38\uff0cRedis \u670d\u52a1\u600e\u4e48\u5904\u7406\uff1f \u5982\u679c AOF \u6587\u4ef6\u6570\u636e\u51fa\u73b0\u5f02\u5e38\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u7684\u4e00\u81f4\u6027\uff0cRedis \u670d\u52a1\u5668\u4f1a\u62d2\u7edd\u52a0\u8f7d AOF \u6587\u4ef6\u3002\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528 redis-check-aof -fix \u547d\u4ee4\u4fee\u590d\u3002 \u4e94\u3001\u96c6\u7fa4\u3001\u590d\u5236\uff0812 \u9898\uff09 1. \u662f\u5426\u4f7f\u7528\u8fc7 Redis \u96c6\u7fa4\uff0c\u96c6\u7fa4\u7684\u539f\u7406\u662f\u4ec0\u4e48\uff1f \u4f7f\u7528\u8fc7 Redis \u96c6\u7fa4\uff0c\u5b83\u7684\u539f\u7406\u662f\uff1a \u6240\u6709\u7684\u8282\u70b9\u76f8\u4e92\u8fde\u63a5 \u96c6\u7fa4\u6d88\u606f\u901a\u4fe1\u901a\u8fc7\u96c6\u7fa4\u603b\u7ebf\u901a\u4fe1\uff0c\u96c6\u7fa4\u603b\u7ebf\u7aef\u53e3\u5927\u5c0f\u4e3a\u5ba2\u6237\u7aef\u670d\u52a1\u7aef\u53e3 + 10000\uff08\u56fa\u5b9a\u503c\uff09 \u8282\u70b9\u4e0e\u8282\u70b9\u4e4b\u95f4\u901a\u8fc7\u4e8c\u8fdb\u5236\u534f\u8bae\u8fdb\u884c\u901a\u4fe1 \u5ba2\u6237\u7aef\u548c\u96c6\u7fa4\u8282\u70b9\u4e4b\u95f4\u901a\u4fe1\u548c\u901a\u5e38\u4e00\u6837\uff0c\u901a\u8fc7\u6587\u672c\u534f\u8bae\u8fdb\u884c \u96c6\u7fa4\u8282\u70b9\u4e0d\u4f1a\u4ee3\u7406\u67e5\u8be2 \u6570\u636e\u6309\u7167 Slot \u5b58\u50a8\u5206\u5e03\u5728\u591a\u4e2a Redis \u5b9e\u4f8b\u4e0a \u96c6\u7fa4\u8282\u70b9\u6302\u6389\u4f1a\u81ea\u52a8\u6545\u969c\u8f6c\u79fb \u53ef\u4ee5\u76f8\u5bf9\u5e73\u6ed1\u6269/\u7f29\u5bb9\u8282\u70b9 Redis \u96c6\u7fa4\u4e2d\u5185\u7f6e\u4e86 16384 \u4e2a\u54c8\u5e0c\u69fd\uff0c\u5f53\u9700\u8981\u5728 Redis \u96c6\u7fa4\u4e2d\u653e\u7f6e\u4e00\u4e2a key-value \u65f6\uff0credis \u5148\u5bf9 key \u4f7f\u7528 crc16 \u7b97\u6cd5\u7b97\u51fa\u4e00\u4e2a\u7ed3\u679c\uff0c\u7136\u540e\u628a\u7ed3\u679c\u5bf9 16384 \u6c42\u4f59\u6570\uff0c\u8fd9\u6837\u6bcf\u4e2a key \u90fd\u4f1a\u5bf9\u5e94\u4e00\u4e2a\u7f16\u53f7\u5728 0~16383 \u4e4b\u95f4\u7684\u54c8\u5e0c\u69fd\uff0credis \u4f1a\u6839\u636e\u8282\u70b9\u6570\u91cf\u5927\u81f4\u5747\u7b49\u7684\u5c06\u54c8\u5e0c\u69fd\u6620\u5c04\u5230\u4e0d\u540c\u7684\u8282\u70b9\u3002 2. Redis \u96c6\u7fa4\u65b9\u6848\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u5bfc\u81f4\u6574\u4e2a\u96c6\u7fa4\u4e0d\u53ef\u7528\uff1f Redis \u6ca1\u6709\u4f7f\u7528\u54c8\u5e0c\u4e00\u81f4\u6027\u7b97\u6cd5\uff0c\u800c\u662f\u4f7f\u7528\u54c8\u5e0c\u69fd\u3002Redis \u4e2d\u7684\u54c8\u5e0c\u69fd\u4e00\u5171\u6709 16384 \u4e2a\uff0c\u8ba1\u7b97\u7ed9\u5b9a\u5bc6\u94a5\u7684\u54c8\u5e0c\u69fd\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5bf9\u5bc6\u94a5\u7684 CRC16 \u53d6\u6478 16384\u3002\u5047\u8bbe\u96c6\u7fa4\u4e2d\u6709 A\u3001B\u3001C \u4e09\u4e2a\u96c6\u7fa4\u8282\u70b9\uff0c\u4e0d\u5b58\u5728\u590d\u5236\u6a21\u5f0f\u4e0b\uff0c\u6bcf\u4e2a\u96c6\u7fa4\u7684\u8282\u70b9\u5305\u542b\u7684\u54c8\u5e0c\u69fd\u5982\u4e0b\uff1a \u8282\u70b9 A \u5305\u542b\u4ece 0 \u5230 5500 \u7684\u54c8\u5e0c\u69fd\uff1b \u8282\u70b9 B \u5305\u542b\u4ece 5501 \u5230 11000 \u7684\u54c8\u5e0c\u69fd\uff1b \u8282\u70b9 C \u5305\u542b\u4ece 11001 \u5230 16383 \u7684\u54c8\u5e0c\u69fd\uff1b \u8fd9\u65f6\uff0c\u5982\u679c\u8282\u70b9 B \u51fa\u73b0\u6545\u969c\uff0c\u6574\u4e2a\u96c6\u7fa4\u5c31\u4f1a\u51fa\u73b0\u7f3a\u5c11 5501 \u5230 11000 \u7684\u54c8\u5e0c\u69fd\u8303\u56f4\u800c\u4e0d\u53ef\u7528\u3002 3. Redis \u96c6\u7fa4\u67b6\u6784\u6a21\u5f0f\u6709\u54ea\u51e0\u79cd\uff1f Redis \u96c6\u7fa4\u67b6\u6784\u662f\u652f\u6301\u5355\u8282\u70b9\u5355\u673a\u6a21\u5f0f\u7684\uff0c\u4e5f\u652f\u6301\u4e00\u4e3b\u591a\u4ece\u7684\u4e3b\u4ece\u7ed3\u6784\uff0c\u8fd8\u652f\u6301\u5e26\u6709\u54e8\u5175\u7684\u96c6\u7fa4\u90e8\u7f72\u6a21\u5f0f\u3002 4. \u8bf4\u8bf4 Redis \u54c8\u5e0c\u69fd\u7684\u6982\u5ff5\uff1f Redis \u96c6\u7fa4\u5e76\u6ca1\u6709\u4f7f\u7528\u4e00\u81f4\u6027 hash\uff0c\u800c\u662f\u5f15\u5165\u4e86\u54c8\u5e0c\u69fd\u7684\u6982\u5ff5\u3002Redis \u96c6\u7fa4\u6709 16384\uff082^14\uff09\u4e2a\u54c8\u5e0c\u69fd\uff0c\u6bcf\u4e2a key \u901a\u8fc7 CRC16 \u6821\u9a8c\u540e\u5bf9 16384 \u53d6\u6a21\u6765\u51b3\u5b9a\u653e\u7f6e\u54ea\u4e2a\u69fd\uff0c\u96c6\u7fa4\u7684\u6bcf\u4e2a\u8282\u70b9\u8d1f\u8d23\u4e00\u90e8\u5206 hash \u69fd\u3002 5. Redis \u96c6\u7fa4\u7684\u4e3b\u4ece\u590d\u5236\u6a21\u578b\u662f\u600e\u6837\u7684\uff1f Redis \u96c6\u7fa4\u652f\u6301\u7684\u4e3b\u4ece\u590d\u5236\uff0c\u6570\u636e\u540c\u6b65\u4e3b\u8981\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a \u4e00\u79cd\u662f\u5168\u91cf\u540c\u6b65\uff0c\u4e00\u79cd\u662f\u589e\u91cf\u540c\u6b65 \u3002 1. \u5168\u91cf\u540c\u6b65 \u521a\u5f00\u59cb\u642d\u5efa\u4e3b\u4ece\u6a21\u5f0f\u65f6\uff0c\u4ece\u673a\u9700\u8981\u4ece\u4e3b\u673a\u4e0a\u83b7\u53d6\u6240\u6709\u6570\u636e\uff0c\u8fd9\u65f6\u5c31\u9700\u8981 Slave \u5c06 Master \u4e0a\u6240\u6709\u7684\u6570\u636e\u8fdb\u884c\u540c\u6b65\u590d\u5236\u3002\u590d\u5236\u7684\u6b65\u9aa4\u4e3a\uff1a \u4ece\u670d\u52a1\u5668\u53d1\u9001 SYNC \u547d\u4ee4\uff0c\u94fe\u63a5\u4e3b\u670d\u52a1\u5668 \uff1b \u4e3b\u670d\u52a1\u5668\u6536\u5230 SYNC \u547d\u4ee4\u540e\uff0c\u8fdb\u884c\u5b58\u76d8\u7684\u64cd\u4f5c\uff0c\u5e76\u7ee7\u7eed\u6536\u96c6\u540e\u7eed\u7684\u5199\u547d\u4ee4\uff0c\u5b58\u50a8\u7f13\u51b2\u533a \uff1b \u5b58\u76d8\u7ed3\u675f\u540e\uff0c\u5c06\u5bf9\u5e94\u7684\u6570\u636e\u6587\u4ef6\u53d1\u9001\u5230 Slave \u4e2d\uff0c\u5b8c\u6210\u4e00\u6b21\u5168\u91cf\u540c\u6b65 \uff1b \u4e3b\u670d\u52a1\u6570\u636e\u53d1\u9001\u5b8c\u6bd5\u540e\uff0c\u5c06\u8fdb\u884c\u589e\u91cf\u7684\u7f13\u51b2\u533a\u6570\u636e\u540c\u6b65\uff1b Slave \u52a0\u8f7d\u6570\u636e\u6587\u4ef6\u548c\u7f13\u51b2\u533a\u6570\u636e\uff0c\u5f00\u59cb\u63a5\u53d7\u547d\u4ee4\u8bf7\u6c42\uff0c\u63d0\u4f9b\u64cd\u4f5c \u3002 2. \u589e\u91cf\u540c\u6b65 \u4ece\u8282\u70b9\u5b8c\u6210\u4e86\u5168\u91cf\u540c\u6b65\u540e\uff0c\u5c31\u53ef\u4ee5\u6b63\u5f0f\u7684\u5f00\u542f\u589e\u91cf\u5907\u4efd\u3002 \u5f53 Master \u8282\u70b9\u6709\u5199\u64cd\u4f5c\u65f6\uff0c\u90fd\u4f1a\u81ea\u52a8\u540c\u6b65\u5230 Slave \u8282\u70b9\u4e0a\u3002Master \u8282\u70b9\u6bcf\u6267\u884c\u4e00\u4e2a\u547d\u4ee4\uff0c\u90fd\u4f1a\u540c\u6b65\u5411 Slave \u670d\u52a1\u5668\u53d1\u9001\u76f8\u540c\u7684\u5199\u547d\u4ee4\uff0c\u5f53\u4ece\u670d\u52a1\u5668\u63a5\u6536\u5230\u547d\u4ee4\uff0c\u4f1a\u540c\u6b65\u6267\u884c\u3002 6. Redis \u96c6\u7fa4\u4f1a\u6709\u5199\u64cd\u4f5c\u4e22\u5931\u5417\uff1f\u4e3a\u4ec0\u4e48\uff1f Redis \u96c6\u7fa4\u4e2d\u6709\u53ef\u80fd\u5b58\u5728\u5199\u64cd\u4f5c\u4e22\u5931\u7684\u95ee\u9898\uff0c\u4f46\u662f\u4e22\u5931\u6982\u7387\u4e00\u822c\u53ef\u4ee5\u5ffd\u7565\u4e0d\u8ba1\u3002\u4e3b\u8981\u662f Redis \u5e76\u6ca1\u6709\u4e00\u4e2a\u673a\u5236\u4fdd\u8bc1\u6570\u636e\u4e00\u5b9a\u5199\u4e0d\u4e22\u5931\u3002\u5728\u4ee5\u4e0b\u95ee\u9898\u4e2d\u53ef\u80fd\u51fa\u73b0\u952e\u503c\u4e22\u5931\u7684\u95ee\u9898\uff1a 1. \u8d85\u8fc7\u5185\u5b58\u7684\u6700\u5927\u503c\uff0c\u952e\u503c\u88ab\u6e05\u7406 Redis \u4e2d\u53ef\u4ee5\u8bbe\u7f6e\u7f13\u5b58\u7684\u6700\u5927\u5185\u5b58\u503c\uff0c\u5f53\u5185\u5b58\u4e2d\u7684\u6570\u636e\u603b\u91cf\u5927\u4e8e\u8bbe\u7f6e\u7684\u6700\u5927\u5185\u5b58\u503c\uff0c\u4f1a\u5bfc\u81f4 Redis \u5bf9\u90e8\u5206\u6570\u636e\u8fdb\u884c\u6e05\u7406\uff0c\u5bfc\u81f4\u952e\u503c\u4e22\u5931\u7684\u95ee\u9898\u3002 2. \u5927\u91cf\u7684 key \u8fc7\u671f\uff0c\u88ab\u6e05\u7406 \u8fd9\u79cd\u60c5\u51b5\u6bd4\u8f83\u6b63\u5e38\uff0c\u53ea\u662f\u56e0\u4e3a\u952e\u503c\u8bbe\u7f6e\u7684\u65f6\u95f4\u8fc7\u671f\u4e86\uff0c\u88ab\u81ea\u52a8\u6e05\u7406\u4e86\u3002 3. Redis \u4e3b\u5e93\u670d\u52a1\u5668\u6545\u969c\u91cd\u542f \u7531\u4e8e Redis \u7684\u6570\u636e\u662f\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u5982\u679c Redis \u4e3b\u5e93\u670d\u52a1\u5668\u51fa\u73b0\u6545\u969c\u91cd\u542f\uff0c\u4f1a\u51fa\u73b0\u6570\u636e\u88ab\u6e05\u7a7a\u7684\u95ee\u9898\u3002 \u8fd9\u65f6\u53ef\u80fd\u5bfc\u81f4\u4ece\u5e93\u7684\u6570\u636e\u540c\u6b65\u88ab\u6e05\u7a7a\u3002\u5982\u679c\u6709\u4f7f\u7528\u6570\u636e\u6301\u4e45\u5316\uff0c\u90a3\u4e48\u6545\u969c\u91cd\u542f\u540e\u6570\u636e\u662f\u53ef\u4ee5\u81ea\u52a8\u6062\u590d\u7684\u3002 4. \u7f51\u7edc\u95ee\u9898 \u53ef\u80fd\u51fa\u73b0\u7f51\u7edc\u6545\u969c\uff0c\u5bfc\u81f4\u77ed\u65f6\u95f4\u5185\u6570\u636e\u5199\u5165\u5931\u8d25\u3002 7. Redis \u96c6\u7fa4\u4e4b\u95f4\u662f\u5982\u4f55\u590d\u5236\u7684\uff1f \u4f7f\u7528\u5f02\u6b65\u590d\u5236\u3002 8. Redis \u96c6\u7fa4\u6700\u5927\u8282\u70b9\u4e2a\u6570\u662f\u591a\u5c11\uff1f Redis \u96c6\u7fa4\u6709 16384 \u4e2a\u54c8\u5e0c\u69fd\u3002 9. Redis \u96c6\u7fa4\u5982\u4f55\u9009\u62e9\u6570\u636e\u5e93\uff1f Redis \u96c6\u7fa4\u4e0d\u652f\u6301\u9009\u62e9\u6570\u636e\u5e93\u64cd\u4f5c\uff0c\u9ed8\u8ba4\u5728 0 \u6570\u636e\u5e93\u3002 10. Redis \u96c6\u7fa4\u65b9\u6848\u5e94\u8be5\u600e\u4e48\u505a\uff0c\u6709\u54ea\u4e9b\u65b9\u6848\uff1f Redis \u53ef\u4ee5\u4f7f\u7528\u7684\u96c6\u7fa4\u65b9\u6cd5\u6709\uff1a Redis cluster 3.0\uff1a\u8fd9\u662f Redis \u81ea\u5e26\u7684\u96c6\u7fa4\u529f\u80fd\uff0c\u5b83\u91c7\u7528\u7684\u5206\u5e03\u5f0f\u7b97\u6cd5\u662f\u54c8\u5e0c\u69fd\uff0c\u800c\u4e0d\u662f\u4e00\u81f4\u6027 hash\u3002\u652f\u6301\u4e3b\u4ece\u7ed3\u6784\uff0c\u53ef\u4ee5\u6269\u5c55\u591a\u4e2a\u4ece\u670d\u52a1\u5668\uff0c\u5f53\u4e3b\u8282\u70b9\u6302\u4e86\u53ef\u4ee5\u5f88\u5feb\u7684\u5207\u6362\u5230\u4e00\u4e2a\u4ece\u8282\u70b9\u505a\u4e3b\u8282\u70b9\uff0c\u7136\u540e\u4ece\u8282\u70b9\u90fd\u8bfb\u53d6\u5230\u65b0\u7684\u4e3b\u8282\u70b9\u3002 Twemproxy\uff0c\u5b83\u662f Twitter \u5f00\u6e90\u7684\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u540e\u7aef\u4ee3\u7406\uff0c\u53ef\u4ee5\u7ba1\u7406 Redis \u6216 Memcache \u96c6\u7fa4\u3002\u5b83\u76f8\u5bf9\u4e8e Redis \u96c6\u7fa4\u6765\u8bf4\uff0c\u6613\u4e8e\u7ba1\u7406\u3002\u5b83\u7684\u4f7f\u7528\u65b9\u6cd5\u548c Redis \u96c6\u7fa4\u6ca1\u6709\u4efb\u4f55\u533a\u522b\uff0c\u53ea\u9700\u8981\u8bbe\u7f6e\u597d\u591a\u4e2a Redis \u5b9e\u4f8b\u540e\uff0c\u5728\u672c\u9700\u8981\u8fde\u63a5 redis \u7684\u5730\u65b9\u6539\u4e3a\u8fde\u63a5 Twemproxy\uff0c\u5b83\u4f1a\u4ee5\u4e00\u4e2a\u4ee3\u7406\u7684\u8eab\u4efd\u63a5\u6536\u8bf7\u6c42\u5e76\u4f7f\u7528\u4e00\u81f4\u6027 hash \u7b97\u6cd5\uff0c\u5c06\u8bf7\u6c42\u8f6c\u63a5\u5230\u5177\u4f53 Redis \u8282\u70b9\uff0c\u5c06\u7ed3\u679c\u518d\u8fd4\u56de Twemproxy\u3002\u5bf9\u4e8e\u5ba2\u6237\u7aef\u6765\u8bf4\uff0cTwemproxy \u76f8\u5f53\u4e8e\u662f\u7f13\u5b58\u6570\u636e\u5e93\u7684\u5165\u53e3\uff0c\u5b83\u4e0d\u9700\u8981\u77e5\u9053\u540e\u7aef\u5982\u4f55\u90e8\u7f72\u7684\u3002Twemproxy \u4f1a\u68c0\u6d4b\u4e0e\u6bcf\u4e2a\u8282\u70b9\u7684\u8fde\u63a5\u662f\u5426\u6b63\u5e38\uff0c\u5982\u679c\u5b58\u5728\u5f02\u5e38\u8282\u70b9\uff0c\u5219\u4f1a\u88ab\u5254\u9664\uff0c\u7b49\u4e00\u6bb5\u65f6\u95f4\u540e\uff0cTwemproxy \u8fd8\u4f1a\u518d\u6b21\u5c1d\u8bd5\u8fde\u63a5\u88ab\u5254\u9664\u7684\u8282\u70b9\u3002 Codis\uff0c\u5b83\u662f\u4e00\u4e2a Redis \u5206\u5e03\u5f0f\u7684\u89e3\u51b3\u65b9\u5f0f\uff0c\u5bf9\u4e8e\u5e94\u7528\u4f7f\u7528 Codis Proxy \u7684\u8fde\u63a5\u548c\u4f7f\u7528 Redis \u670d\u52a1\u7684\u6ca1\u6709\u660e\u663e\u5dee\u522b\uff0c\u5e94\u7528\u80fd\u591f\u50cf\u4f7f\u7528\u5355\u673a Redis \u4e00\u6837\uff0c\u8ba9 Codis \u5e95\u5c42\u5904\u7406\u8bf7\u6c42\u8f6c\u53d1\uff0c\u4e0d\u505c\u673a\u7684\u6570\u636e\u8fc1\u79fb\u7b49\u5de5\u4f5c\u3002 11. Redis sentinel\uff08\u54e8\u5175\uff09\u6a21\u5f0f\u4f18\u7f3a\u70b9\u6709\u54ea\u4e9b\uff1f Redis \u54e8\u5175\u7684\u597d\u5904\u5728\u4e8e\u53ef\u4ee5\u4fdd\u8bc1\u7cfb\u7edf\u7684\u9ad8\u53ef\u7528\uff0c\u5404\u4e2a\u8282\u70b9\u53ef\u4ee5\u5bf9\u6545\u969c\u81ea\u52a8\u8f6c\u79fb \u3002 \u4f46\u7f3a\u70b9\u662f\u4f7f\u7528\u7684\u4e3b\u4ece\u6a21\u5f0f\uff0c\u4e3b\u8282\u70b9\u5355\u70b9\u98ce\u9669\u9ad8\uff0c\u4e3b\u4ece\u5207\u6362\u8fc7\u7a0b\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e22\u5931\u6570\u636e\u7684\u95ee\u9898\u3002 12. Redis \u7684\u4e3b\u4ece\u590d\u5236\u6a21\u5f0f\u6709\u4ec0\u4e48\u4f18\u7f3a\u70b9\uff1f \u4e3b\u4ece\u590d\u5236\u7684\u6a21\u5f0f\u76f8\u5bf9\u4e8e\u5355\u8282\u70b9\u7684\u597d\u5904\u5728\u4e8e\uff0c\u5b9e\u884c\u8bfb\u5199\u5206\u79bb\u63d0\u9ad8\u4e86\u7cfb\u7edf\u7684\u8bfb\u5199\u6548\u7387\uff0c\u63d0\u9ad8\u4e86\u7f51\u7ad9\u6570\u636e\u7684\u8bfb\u53d6\u52a0\u8f7d\u901f\u5ea6\u3002 \u4f46\u662f\u7f3a\u70b9\u662f\u7531\u4e8e\u5199\u6570\u636e\u4e3b\u8981\u5728\u4e3b\u8282\u70b9\u4e0a\u64cd\u4f5c\uff0c\u4e3b\u8282\u70b9\u5185\u5b58\u7a7a\u95f4\u6709\u9650\uff0c\u5e76\u4e14\u4e3b\u8282\u70b9\u5b58\u5728\u5355\u70b9\u98ce\u9669\u3002 \u516d\u3001\u6027\u80fd\u4f18\u5316\uff0820 \u9898\uff09 1. Redis \u5e38\u89c1\u6027\u80fd\u95ee\u9898\u548c\u89e3\u51b3\u65b9\u6848\u6709\u54ea\u4e9b\uff1f \u5e38\u89c1\u95ee\u9898\u53ca\u89e3\u51b3\u529e\u6cd5\u6709\uff1a Master \u6700\u597d\u4e0d\u8981\u5199\u5185\u5b58\u5feb\u7167\uff0c\u5982\u679c Master \u5199\u5185\u5b58\u5feb\u7167\uff0csave \u547d\u4ee4\u8c03\u5ea6 rdbSave \u51fd\u6570\uff0c\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u7684\u5de5\u4f5c\uff0c\u5f53\u5feb\u7167\u6bd4\u8f83\u5927\u65f6\u5bf9\u6027\u80fd\u5f71\u54cd\u662f\u975e\u5e38\u5927\u7684\uff0c\u4f1a\u95f4\u65ad\u6027\u6682\u505c\u670d\u52a1 \u5982\u679c\u6570\u636e\u6bd4\u8f83\u91cd\u8981\uff0c\u67d0\u4e2a Slave \u5f00\u542f AOF \u5907\u4efd\u6570\u636e\uff0c\u7b56\u7565\u8bbe\u7f6e\u4e3a\u6bcf\u79d2\u540c\u6b65\u4e00 \u4e3a\u4e86\u4e3b\u4ece\u590d\u5236\u7684\u901f\u5ea6\u548c\u8fde\u63a5\u7684\u7a33\u5b9a\u6027\uff0cMaster \u548c Slave \u6700\u597d\u5728\u540c\u4e00\u4e2a\u5c40\u57df\u7f51 \u5c3d\u91cf\u907f\u514d\u5728\u538b\u529b\u5f88\u5927\u7684\u4e3b\u5e93\u4e0a\u589e\u52a0\u4ece \u4e3b\u4ece\u590d\u5236\u4e0d\u8981\u7528\u56fe\u72b6\u7ed3\u6784\uff0c\u7528\u5355\u5411\u94fe\u8868\u7ed3\u6784\u66f4\u4e3a\u7a33\u5b9a\uff0c\u5373\uff1aMaster <- Slave1<- Slave2 <- Slave3\u2026 \u8fd9\u6837\u7684\u7ed3\u6784\u65b9\u4fbf\u89e3\u51b3\u5355\u70b9\u6545\u969c\u95ee\u9898\uff0c\u5b9e\u73b0 Slave \u5bf9 Master \u7684\u66ff\u6362\u3002\u5982\u679c Master \u6302\u4e86\uff0c\u53ef\u4ee5\u7acb\u523b\u542f\u7528 Slave1 \u505a Master\uff0c\u5176\u4ed6\u4e0d\u53d8\u3002 2. Redis \u8fc7\u671f\u952e\u7684\u5220\u9664\u7b56\u7565\uff1f \u8fc7\u671f\u952e\u7684\u5220\u9664\u7b56\u7565\u662f\u5c06\u60f0\u6027\u5220\u9664\u7b56\u7565\u548c\u5b9a\u671f\u5220\u9664\u7b56\u7565\u7ec4\u5408\u4f7f\u7528\u3002 1. \u5b9a\u65f6\u5220\u9664\u7b56\u7565 \u8be5\u7b56\u7565\u7684\u4f5c\u7528\u662f\u7ed9 key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u540c\u65f6\uff0c\u7ed9 key \u521b\u5efa\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u5b9a\u65f6\u5668\u5728 key \u7684\u8fc7\u671f\u65f6\u95f4\u6765\u4e34\u65f6\uff0c\u5bf9\u8fd9\u4e9b key \u8fdb\u884c\u5220\u9664\u3002 \u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u4fdd\u8bc1\u5185\u5b58\u7a7a\u95f4\u5f97\u4ee5\u91ca\u653e\u3002\u4f46\u662f\u7f3a\u70b9\u662f\u7ed9 key \u521b\u5efa\u4e00\u4e2a\u5b9a\u65f6\u5668\u4f1a\u6709\u4e00\u5b9a\u7684\u6027\u80fd\u635f\u5931\u3002\u5982\u679c key \u5f88\u591a\uff0c\u5220\u9664\u8fd9\u4e9b key \u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u4e5f\u4f1a\u5360\u7528 CPU \u5f88\u591a\u65f6\u95f4\u3002 2. \u60f0\u6027\u5220\u9664\u7b56\u7565 \u6bcf\u6b21\u4ece\u6570\u636e\u5e93\u53d6 key \u7684\u65f6\u5019\u68c0\u67e5 key \u662f\u5426\u8fc7\u671f\uff0c\u5982\u679c\u8fc7\u671f\u5219\u5220\u9664\uff0c\u5e76\u8fd4\u56de null\uff0c\u5982\u679c key \u6ca1\u6709\u8fc7\u671f\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\u6570\u636e\u3002 \u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u5360\u7528 CPU \u7684\u65f6\u95f4\u6bd4\u8f83\u5c11\u3002 \u4f46\u662f\u7f3a\u70b9\u662f\u5982\u679c key \u5f88\u957f\u65f6\u95f4\u6ca1\u6709\u88ab\u83b7\u53d6\uff0c\u5c06\u4e0d\u4f1a\u88ab\u5220\u9664\uff0c\u5bb9\u6613\u9020\u6210\u5185\u5b58\u6cc4\u9732 \u3002 3. \u5b9a\u671f\u5220\u9664\u7b56\u7565 \u8be5\u7b56\u7565\u7684\u4f5c\u7528\u662f\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u6267\u884c\u4e00\u6b21\u5220\u9664\u8fc7\u671f key \u7684\u64cd\u4f5c\uff0c\u8be5\u5220\u9664\u9891\u7387\u53ef\u4ee5\u5728 redis.conf \u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u3002 \u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u53ef\u4ee5\u907f\u514d\u60f0\u6027\u5220\u9664\u65f6\u51fa\u73b0\u5185\u5b58\u6cc4\u9732\u7684\u95ee\u9898\uff0c\u901a\u8fc7\u8bbe\u7f6e\u5220\u9664\u64cd\u4f5c\u7684\u65f6\u957f\u9891\u7387\uff0c\u53ef\u4ee5\u51cf\u5c11 CPU \u65f6\u95f4\u7684\u5360\u7528\u3002 \u4f46\u662f\u7f3a\u70b9\u662f\u76f8\u5bf9\u5185\u5b58\u6027\u80fd\u53cb\u597d\u6765\u8bf4\uff0c\u8be5\u7b56\u7565\u4e0d\u5982\u5b9a\u65f6\u5220\u9664\u7b56\u7565\uff0c\u76f8\u5bf9 CPU \u6027\u80fd\u53cb\u597d\u6765\u8bf4\uff0c\u8be5\u7b56\u7565\u4e0d\u5982\u60f0\u6027\u5220\u9664\u7b56\u7565\u3002 Redis \u91c7\u7528\u7684\u5220\u9664\u7b56\u7565\u662f\u5c06\u60f0\u6027\u5220\u9664\u7b56\u7565\u548c\u5b9a\u671f\u5220\u9664\u7b56\u7565\u7ec4\u5408\u4f7f\u7528\u3002 3. Redis \u7684\u56de\u6536\u7b56\u7565\uff08\u6dd8\u6c70\u7b56\u7565\uff09\uff1f Redis \u63d0\u4f9b\u4e86 6 \u79cd\u6dd8\u6c70\u7b56\u7565\uff1a volatile-lru \uff1a\u8be5\u6dd8\u6c70\u7b56\u7565\u662f\u88ab\u4f7f\u7528\u6700\u591a\u7684\u4e00\u79cd\uff0c\u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6 \uff08server.db [i].expires\uff09 \u4e2d\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70 \uff1b\u800c\u6ca1\u6709\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684 key \u4e0d\u4f1a\u88ab\u6dd8\u6c70\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u9700\u8981\u6301\u4e45\u5316\u7684\u6570\u636e\u4e0d\u4f1a\u7a81\u7136\u4e22\u5931\uff1b volatile-ttl \uff1a\u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\uff08 server.db [i].expires \uff09\u4e2d\u6311\u9009\u5c06\u8981\u8fc7\u671f\u7684\u6570\u636e\u6dd8\u6c70 \uff0c\u5b83\u548c volatile-lru \u7684\u533a\u522b\u5728\u4e8e key \u7684\u5269\u4f59\u751f\u5b58\u65f6\u95f4 ttl \u7684\u503c\u8d8a\u5c0f\u8d8a\u4f18\u5148\u88ab\u6dd8\u6c70\uff0c\u800c volatile-lru \u662f\u6839\u636e\u4f7f\u7528\u7a0b\u5ea6\u8d8a\u5c0f\u8d8a\u88ab\u6dd8\u6c70\uff1b volatile-random \uff1a\u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\uff08 server.db [i].expires \uff09\u4e2d\u968f\u673a\u9009\u62e9\u6570\u636e\u6dd8\u6c70 \uff1b allkeys-lru \uff1a\u4ece\u6570\u636e\u96c6\uff08 server.db [i].dic t\uff09\u4e2d\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70\uff1b\u5b83\u548c volatile-lru \u6dd8\u6c70\u673a\u5236\u7684\u533a\u522b\u5728\u4e8e allkeys-lru \u9488\u5bf9\u7684\u662f\u5168\u4f53 key \u5bf9\u8c61\uff0c\u6dd8\u6c70\u7684 key \u4e0d\u53ea\u662f\u5305\u62ec\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684 key \uff0c\u4e5f\u5305\u62ec\u4e86\u6ca1\u6709\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684 key\u3002\u800c volatile-lru \u4e3b\u8981\u662f\u9488\u5bf9\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684 key \u8fdb\u884c\u6dd8\u6c70\uff1b allkeys-random \uff1a\u4ece\u6570\u636e\u96c6\uff08server.db [i].dict\uff09\u4e2d\u968f\u673a\u9009\u62e9\u6570\u636e\u6dd8\u6c70 \uff1b no-enviction \uff1aRedis \u9ed8\u8ba4\u4f7f\u7528\u8fd9\u79cd\u6dd8\u6c70\u7b56\u7565\uff0c\u5f53\u5185\u5b58\u8fbe\u5230\u9650\u5236\u7684\u65f6\u5019\uff0c\u4e0d\u6dd8\u6c70\u4efb\u4f55\u6570\u636e\uff0c\u4e0d\u53ef\u5199\u5165\u4efb\u4f55\u6570\u636e\u96c6\uff0c\u6240\u6709\u5f15\u8d77\u7533\u8bf7\u5185\u5b58\u7684\u547d\u4ee4\u4f1a\u62a5\u9519\u3002 \u5b83\u7684\u4f18\u70b9\u5728\u4e8e\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u4e0d\u88ab\u4e22\u5931\uff0c\u4f46\u662f\u5b83\u7684\u7f3a\u70b9\u662f\u4f1a\u5bfc\u81f4\u7ebf\u4e0a\u7684\u4e1a\u52a1\u4e0d\u80fd\u6301\u7eed\u8fdb\u884c\u7684\u95ee\u9898\u3002\u8fd9\u4e2a\u6dd8\u6c70\u7b56\u7565\u4e0b\u9664\u4e86 DEL \u8bf7\u6c42\u548c\u8bfb\u8bf7\u6c42\u670d\u52a1\u53ef\u4ee5\u7ee7\u7eed\u88ab\u6267\u884c\u5916\uff0c\u4e0d\u80fd\u7ee7\u7eed\u6267\u884c\u5199\u8bf7\u6c42\u3002 4. \u5982\u4f55\u4f18\u5316 Redis \u670d\u52a1\u7684\u6027\u80fd\uff1f \u4e3b\u8981\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u51e0\u70b9\u8fdb\u884c\u4f18\u5316\uff1a \u5bf9 Master \u8282\u70b9\u4e0d\u8fdb\u884c\u6301\u4e45\u5316\u5de5\u4f5c\uff0c \u8ba9 Slave \u8282\u70b9\u8fdb\u884c AOF \u5907\u4efd\uff0c\u5bf9\u6570\u636e\u505a\u6301\u4e45\u5316\u64cd\u4f5c \uff1b * \u53ef\u4ee5\u628a\u4e3b\u4ece\u8282\u70b9\u90fd\u90e8\u7f72\u5728\u540c\u4e00\u4e2a\u5c40\u57df\u7f51\u5185\uff0c\u4ece\u800c\u4fdd\u8bc1\u590d\u5236\u901f\u5ea6\u4e0e\u7a33\u5b9a\u6027 \uff1b \u6839\u636e\u4e3b\u5e93\u7684\u538b\u529b\u60c5\u51b5\u6765\u8bbe\u7f6e\u6216\u8005\u589e\u52a0\u4ece\u5e93\uff1b \u4e3b\u4ece\u590d\u5236\u7684\u7ed3\u6784\u4e00\u5b9a\u8981\u4f7f\u7528\u5355\u5411\u7ed3\u6784\uff0c\u907f\u514d\u4f7f\u7528\u56fe\u72b6\u7ed3\u6784\u3002 5. Redis \u56de\u6536\u8fdb\u7a0b\u5982\u4f55\u5de5\u4f5c\u7684\uff1f \u5f53\u5ba2\u6237\u7aef\u8fd0\u884c\u4e86\u65b0\u547d\u4ee4\u6dfb\u52a0\u65b0\u6570\u636e\uff0c Redis \u90fd\u4f1a\u68c0\u67e5\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\uff0c\u5982\u679c\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u5927\u4e8e maxmemory \u7684\u9650\u5236\uff0c\u90a3\u4e48\u56de\u6839\u636e\u8bbe\u7f6e\u7684\u6dd8\u6c70\u7b56\u7565\u8fdb\u884c\u56de\u6536 \u3002 \u6240\u4ee5\u4f1a\u51fa\u73b0\u5185\u5b58\u7684\u4f7f\u7528\u9650\u5236\u4e0d\u65ad\u7684\u8d85\u8fc7\u8fb9\u754c\u53c8\u88ab\u56de\u6536\u5230\u8fb9\u754c\u4ee5\u4e0b\u3002 6. \u90fd\u6709\u54ea\u4e9b\u529e\u6cd5\u53ef\u4ee5\u964d\u4f4e Redis \u7684\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u5462\uff1f \u53ef\u4ee5\u4f7f\u7528 Hash\u3001list\u3001sorted set\u3001set \u7b49\u96c6\u5408\u7c7b\u578b\u6570\u636e \uff0c\u66f4\u6709\u5229\u4e8e\u5c06\u6570\u636e\u5b58\u50a8\u5f97\u66f4\u7d27\u51d1\uff0c\u66f4\u6709\u5229\u4e8e\u5185\u5b58\u7a7a\u95f4\u7684\u4f7f\u7528\u3002 7. Redis \u7684\u6162\u67e5\u8be2\u4fee\u590d\u7ecf\u9a8c\u6709\u54ea\u4e9b\uff1f\u600e\u4e48\u4fee\u590d\u7684\uff1f \u53ef\u4ee5\u5bf9\u5927\u5bf9\u8c61\u6570\u636e\u8fdb\u884c\u62c6\u5206\uff0c \u9632\u6b62\u6267\u884c\u4e00\u6b21\u547d\u4ee4\u64cd\u4f5c\u8fc7\u591a\u7684\u6570\u636e \u3002\u4e5f\u53ef\u4ee5\u5c06\u4e00\u4e9b\u7b97\u6cd5\u590d\u6742\u5ea6\u9ad8\u7684\u547d\u4ee4\u6216\u6267\u884c\u6548\u7387\u4f4e\u7684\u547d\u4ee4\uff0c\u7981\u7528\u6216\u8005\u66ff\u6362\u6210\u9ad8\u7684\u6307\u4ee4\u3002 8. Redis \u6162\u67e5\u8be2\u662f\u4ec0\u4e48\uff1f\u901a\u8fc7\u4ec0\u4e48\u914d\u7f6e\uff1f \u6162\u67e5\u8be2\u662f\u6307\u7cfb\u7edf\u6267\u884c\u547d\u4ee4\u4e4b\u540e\uff0c\u5f53\u8ba1\u7b97\u7cfb\u7edf\u6267\u884c\u7684\u6307\u4ee4\u65f6\u95f4\u8d85\u8fc7\u8bbe\u7f6e\u7684\u9600\u503c\uff0c\u8be5\u547d\u4ee4\u5c31\u4f1a\u88ab\u8bb0\u5f55\u5230\u6162\u67e5\u8be2\u4e2d\uff0c\u8be5\u547d\u4ee4\u53eb\u505a\u6162\u6307\u4ee4\u3002 Redis \u6162\u67e5\u8be2\u7684\u53c2\u6570\u914d\u7f6e\u6709\uff1a 1. slowlog-log-slower-than \u8be5\u53c2\u6570\u7684\u4f5c\u7528\u4e3a\u8bbe\u7f6e\u6162\u67e5\u8be2\u7684\u9608\u503c\uff0c\u5f53\u547d\u4ee4\u6267\u884c\u65f6\u95f4\u8d85\u8fc7\u8fd9\u4e2a\u9608\u503c\u5c31\u8ba4\u4e3a\u662f\u6162\u67e5\u8be2 \u3002\u5355\u4f4d\u4e3a\u5fae\u5999\uff0c\u9ed8\u8ba4\u4e3a 10000\u3002 \u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7ebf\u4e0a\u7684\u5e76\u53d1\u91cf\u8fdb\u884c\u8c03\u6574\u8fd9\u4e2a\u503c\u3002\u5982\u679c\u5b58\u5728\u9ad8\u6d41\u91cf\u7684\u573a\u666f\uff0c\u90a3\u4e48\u5efa\u8bae\u8bbe\u7f6e\u8fd9\u4e2a\u503c\u4e3a 1 \u6beb\u79d2\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u547d\u4ee4\u6267\u884c\u7684\u65f6\u95f4\u5982\u679c\u8d85\u8fc7 1 \u6beb\u79d2\uff0c\u90a3\u4e48 Redis \u7684\u6bcf\u79d2\u64cd\u4f5c\u6570\u6700\u591a\u53ea\u80fd\u5230 1000\u3002 2. slowlog-max-len \u8be5\u53c2\u6570\u7684\u4f5c\u7528\u4e3a\u8bbe\u7f6e\u6162\u67e5\u8be2\u65e5\u5fd7\u5217\u8868\u7684\u6700\u5927\u957f\u5ea6\uff0c\u5f53\u6162\u67e5\u8be2\u65e5\u5fd7\u5217\u8868\u5904\u4e8e\u6700\u5927\u957f\u5ea6\u65f6\uff0c\u6700\u65e9\u63d2\u5165\u7684\u4e00\u4e2a\u547d\u4ee4\u5c06\u4f1a\u88ab\u4ece\u5217\u8868\u4e2d\u79fb\u9664\u3002 9. Redis \u5982\u4f55\u505a\u5185\u5b58\u4f18\u5316\uff1f \u5185\u5b58\u4f18\u5316\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u51e0\u70b9\u8fdb\u884c\uff1a Redis \u5bf9\u6240\u6709\u6570\u636e\u90fd\u8fdb\u884c redisObject \u5c01\u88c5\uff1b \u5bf9\u952e\u3001\u503c\u5bf9\u8c61\u7684\u957f\u5ea6\u8fdb\u884c\u7f29\u51cf\uff0c\u7b80\u5316\u952e\u540d\uff0c\u63d0\u9ad8\u5185\u5b58\u4f7f\u7528\u6548\u7387\uff1b \u51cf\u5c11 key \u7684\u6570\u91cf\uff0c\u5c3d\u91cf\u4f7f\u7528\u54c8\u5e0c\u6570\u636e\u7c7b\u578b\uff1b \u5171\u4eab\u5bf9\u8c61\u6c60\uff0c\u5e76\u8bbe\u7f6e\u7a7a\u95f4\u6781\u9650\u503c\u3002 10. Redis \u7684\u5185\u5b58\u7528\u5b8c\u4e86\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f \u5982\u679c Redis \u7684\u5185\u5b58\u4f7f\u7528\u8fbe\u5230\u4e86 redis.conf \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u8bbe\u7f6e\u4e0a\u9650\uff0c\u6267\u884c Redis \u7684\u5199\u547d\u4ee4\u4f1a\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\uff0c\u4f46\u662f\u8fd8\u662f\u652f\u6301\u8bfb\u64cd\u4f5c\u3002 \u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u529e\u6cd5\u662f\uff0c\u53ef\u4ee5\u5f00\u542f Redis \u7684\u6dd8\u6c70\u673a\u5236\uff0c\u5f53 Redis \u5185\u5b58\u8fbe\u5230\u4e0a\u9650\u65f6\u53ef\u4ee5\u6839\u636e\u914d\u7f6e\u7684\u7b56\u7565\u5220\u9664\u4e00\u4e9b\u6570\u636e\uff0c\u9632\u6b62\u5185\u5b58\u7528\u5b8c\u3002 11. \u7f13\u5b58\u7684\u66f4\u65b0\u7b56\u7565\u6709\u51e0\u79cd\uff1f\u5206\u522b\u6709\u4ec0\u4e48\u6ce8\u610f\u4e8b\u9879\uff1f \u7f13\u5b58\u7684\u66f4\u65b0\u7b56\u7565\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a \u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u66f4\u65b0\u7f13\u5b58\uff1b \u5148\u5220\u9664\u7f13\u5b58\uff0c\u518d\u66f4\u65b0\u6570\u636e\u5e93\uff1b \u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58\uff1b \u5bf9\u5e94\u7684\u7b56\u7565\u5206\u522b\u9700\u8981\u6ce8\u610f\u7684\u4e8b\u9879\u4e3a\uff1a 1. \u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u66f4\u65b0\u7f13\u5b58 \u4f7f\u7528\u8fd9\u79cd\u7b56\u7565\u53ef\u80fd\u4f1a\u5b58\u5728\u4ee5\u4e0b\u4e24\u79cd\u95ee\u9898\uff1a \u7f13\u5b58\u590d\u6742\u5ea6\u53d8\u9ad8\uff1a\u5199\u5165\u7f13\u5b58\u7684\u6570\u636e\u5982\u679c\u9700\u8981\u7ecf\u8fc7\u7279\u6b8a\u7684\u8ba1\u7b97\uff0c\u90a3\u4e48\u8fd9\u65f6\u5019\u66f4\u65b0\u7f13\u5b58\u64cd\u4f5c\u6bd4\u5220\u9664\u7f13\u5b58\u8981\u590d\u6742\u5f97\u591a\u3002\u56e0\u4e3a\u66f4\u65b0\u5b8c\u6570\u636e\u5e93\u540e\uff0c\u5f97\u5230\u7684\u6570\u636e\u9700\u8981\u6267\u884c\u4e00\u6b21\u52a0\u5de5\uff0c\u6700\u540e\u5f97\u5230\u7684\u503c\u624d\u80fd\u66f4\u65b0\u7f13\u5b58\u3002 \u7ebf\u7a0b\u5b89\u5168\u5b58\u5728\u95ee\u9898\uff1a\u5982\u679c\u5b58\u5728\u7ebf\u7a0b 1 \u548c\u7ebf\u7a0b 2 \u540c\u65f6\u64cd\u4f5c\u6570\u636e\u5e93\u548c\u7f13\u5b58\uff0c\u7ebf\u7a0b 1 \u5148\u66f4\u65b0\u4e86\u6570\u636e\u5e93\uff0c\u7ebf\u7a0b 2 \u518d\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u8fd9\u65f6\u5019\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\uff0c\u7ebf\u7a0b 2 \u9996\u5148\u66f4\u65b0\u4e86\u7f13\u5b58\uff0c\u7ebf\u7a0b 1 \u518d\u66f4\u65b0\u3002\u90a3\u4e48\u8fd9\u6837\u4f1a\u5bfc\u81f4\u4ea7\u751f\u810f\u6570\u636e\u7684\u95ee\u9898\u3002\u56e0\u4e3a\u6570\u636e\u5e93\u5b58\u50a8\u7684\u662f\u7ebf\u7a0b 2 \u66f4\u65b0\u540e\u7684\u6570\u636e\uff0c\u800c\u7f13\u5b58\u5b58\u50a8\u7684\u662f\u7ebf\u7a0b 1 \u66f4\u65b0\u7684\u8001\u6570\u636e\u3002 2. \u5148\u5220\u9664\u7f13\u5b58\uff0c\u518d\u66f4\u65b0\u6570\u636e\u5e93 \u8fd9\u79cd\u7b56\u7565\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u5e93\u6570\u636e\u548c\u7f13\u5b58\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002\u5982\u679c\u5b58\u5728\u7ebf\u7a0b 1 \u548c\u7ebf\u7a0b 2\uff0c\u7ebf\u7a0b 1 \u5199\u6570\u636e\u5148\u5220\u9664\u7f13\u5b58\uff0c\u6709\u4e00\u4e2a\u7ebf\u7a0b 2 \u6b63\u597d\u9700\u8981\u67e5\u8be2\u8be5\u7f13\u5b58\uff0c\u53d1\u73b0\u7f13\u5b58\u4e0d\u5b58\u5728\uff0c\u53bb\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u5e76\u5f97\u5230\u65e7\u503c\u653e\u5165\u7f13\u5b58\u91cd\uff0c\u7ebf\u7a0b 1 \u518d\u66f4\u65b0\u6570\u636e\u5e93\u3002\u90a3\u4e48\u8fd9\u65f6\u5c31\u51fa\u73b0\u4e86\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002\u5982\u679c\u7f13\u5b58\u6ca1\u6709\u8fc7\u671f\u65f6\u95f4\uff0c\u90a3\u4e48\u8fd9\u4e2a\u810f\u6570\u636e\u4e00\u76f4\u5b58\u5728\u3002\u5982\u679c\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u90a3\u4e48\u53ef\u4ee5\u5728\u66f4\u65b0\u5b8c\u6570\u636e\u5e93\u540e\uff0c\u5bf9\u7f13\u5b58\u518d\u6dd8\u6c70\u4e00\u6b21\u3002 3. \u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58 \u8fd9\u79cd\u7b56\u7565\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u5e93\u6570\u636e\u548c\u7f13\u5b58\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002\u5982\u679c\u5728\u66f4\u65b0\u5b8c\u6570\u636e\u5e93\u8fd8\u6ca1\u6765\u5f97\u53ca\u5220\u9664\u7f13\u5b58\u7684\u65f6\u5019\uff0c\u6709\u8bf7\u6c42\u8fc7\u6765\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u6570\u636e\uff0c\u90a3\u4e48\u53ef\u80fd\u4f1a\u9020\u6210\u7f13\u5b58\u548c\u6570\u636e\u5e93\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002 \u4f46\u662f\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u673a\u5668\u4e0d\u51fa\u73b0\u6545\u969c\u6216\u5176\u4ed6\u5f71\u54cd\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0d\u4e00\u81f4\u6027\u7684\u53ef\u80fd\u6027\u76f8\u5bf9\u8f83\u4f4e\u3002 12. Redis \u5355\u673a\u4f1a\u6709\u74f6\u9888\uff0c\u90a3\u4e48\u600e\u4e48\u89e3\u51b3\u8fd9\u4e2a\u74f6\u9888\uff1f \u53ef\u4ee5\u5bf9 Redis \u8fdb\u884c\u96c6\u7fa4\u90e8\u7f72\uff0c\u5b9e\u884c\u4e3b\u4ece\u540c\u6b65\u8bfb\u5199\u5206\u79bb\uff0c\u53ef\u4ee5\u65b9\u4fbf\u7684\u5bf9 Redis \u8fdb\u884c\u6a2a\u5411\u6269\u5bb9\uff0c\u53ef\u4ee5\u652f\u6491\u7cfb\u7edf\u66f4\u5927\u6570\u636e\u91cf\u7684\u7f13\u5b58\u548c\u63d0\u9ad8\u7cfb\u7edf\u7684\u53ef\u7528\u6027\u3002 13. \u60f0\u6027\u5220\u9664\u6709\u4ec0\u4e48\u4f18\u70b9\u548c\u7f3a\u70b9\uff1f \u60f0\u6027\u5220\u9664\u7684\u4f18\u70b9\u4e3a \uff1a\u5bf9 CPU \u6bd4\u8f83\u53cb\u597d\uff0c\u56e0\u4e3a\u6bcf\u6b21\u952e\u7a7a\u95f4\u83b7\u53d6\u952e\u65f6\uff0c\u68c0\u67e5\u83b7\u53d6\u5230\u7684\u952e\u662f\u5426\u8fc7\u671f\u5220\u9664\uff0c\u5220\u9664\u7684\u952e\u53ea\u5728\u9009\u4e2d\u4e2d\u997f\u952e\uff0c\u4e0d\u7528\u82b1\u8d39\u8fc7\u591a\u7684\u65f6\u95f4\u548c\u8d44\u6e90\u5728\u5176\u5b83\u4efb\u52a1\u4e0a\uff0c\u4e0d\u4f1a\u589e\u52a0 CPU \u7684\u8d1f\u62c5\u3002\u6240\u4ee5\u5bf9 CPU \u6bd4\u8f83\u53cb\u597d\u3002 \u60f0\u6027\u5220\u9664\u7684\u7f3a\u70b9\u4e3a \uff1a\u4f46\u662f\u5bf9\u5185\u5b58\u5e76\u4e0d\u53cb\u597d\uff0c\u6ca1\u6709\u88ab\u9009\u4e2d\u7684\u952e\u4e5f\u6709\u53ef\u80fd\u5b58\u5728\u8fc7\u671f\u7684\uff0c\u4f46\u662f\u672a\u88ab\u9009\u4e2d\u5220\u9664\u4e00\u76f4\u5b58\u5728\u5185\u5b58\u4e2d\u3002\u5f53\u5b58\u5728\u5f88\u591a\u8fd9\u4e9b\u8fc7\u671f\u952e\u4e00\u76f4\u672a\u88ab\u83b7\u53d6\u548c\u672a\u88ab\u9009\u4e2d\u5220\u9664\uff0c\u5c31\u4f1a\u4e00\u76f4\u5728\u5185\u5b58\u4e2d\u3002\u6240\u4ee5\u5bf9\u5185\u5b58\u5e76\u4e0d\u53cb\u597d\u3002 14. Redis \u662f\u5355\u7ebf\u7a0b\u7684\uff0c\u5982\u4f55\u63d0\u9ad8\u591a\u6838 CPU \u7684\u5229\u7528\u7387\uff1f \u53ef\u4ee5\u5728\u540c\u4e00\u4e2a\u670d\u52a1\u5668\u90e8\u7f72\u591a\u4e2a Redis \u7684\u5b9e\u4f8b\uff0c\u5e76\u628a\u4ed6\u4eec\u5f53\u4f5c\u4e0d\u540c\u7684\u670d\u52a1\u5668\u6765\u4f7f\u7528\uff0c\u5728\u67d0\u4e9b\u65f6\u5019\uff0c\u65e0\u8bba\u5982\u4f55\u4e00\u4e2a\u670d\u52a1\u5668\u662f\u4e0d\u591f\u7684\uff0c \u6240\u4ee5\uff0c\u5982\u679c\u4f60\u60f3\u4f7f\u7528\u591a\u4e2a CPU\uff0c\u4f60\u53ef\u4ee5\u8003\u8651\u4e00\u4e0b\u5206\u7247\uff08shard\uff09 \u3002 15. \u4ec0\u4e48\u662f\u7f13\u5b58\u6dd8\u6c70\uff1f \u56e0\u4e3a\u5185\u5b58\u7684\u7a7a\u95f4\u662f\u6709\u9650\u7684\uff0c\u6240\u4ee5 Redis \u5f15\u5165\u4e86\u6dd8\u6c70\u673a\u5236\uff0c\u4e3b\u8981\u4e3a\u4e86\u89e3\u51b3\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\uff0cRedis \u4e2d\u5b58\u5728\u5f88\u591a\u8fc7\u671f\u952e\uff0c\u5b9a\u671f\u5220\u9664\u7b56\u7565\u968f\u673a\u62bd\u67e5\u65f6\u6ca1\u6709\u62bd\u67e5\u5230\uff0c\u5e76\u4e14\u4e5f\u6ca1\u6709\u8d70\u60f0\u6027\u5220\u9664\u7b56\u7565\u65f6\uff0c\u5927\u91cf\u8fc7\u671f\u952e\u5360\u7528\u5185\u5b58\u7684\u95ee\u9898\u3002 16. Redis \u62a5\u5185\u5b58\u4e0d\u8db3\u600e\u4e48\u5904\u7406\uff1f Redis \u5185\u5b58\u4e0d\u8db3\u53ef\u4ee5\u8fd9\u6837\u5904\u7406\uff1a \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 redis.conf \u7684` maxmemory \u53c2\u6570\uff0c\u589e\u52a0 Redis \u53ef\u7528\u5185\u5b58\uff1b \u8bbe\u7f6e\u7f13\u5b58\u6dd8\u6c70\u7b56\u7565\uff0c\u63d0\u9ad8\u5185\u5b58\u7684\u4f7f\u7528\u6548\u7387\uff1b \u4f7f\u7528 Redis \u96c6\u7fa4\u6a21\u5f0f\uff0c\u63d0\u9ad8\u5b58\u50a8\u91cf\u3002 17. \u5982\u4f55\u8bbe\u7f6e Redis \u7684\u5185\u5b58\u4e0a\u9650\uff1f\u6709\u4ec0\u4e48\u4f5c\u7528\uff1f \u8bbe\u7f6e\u65b9\u6cd5\u4e3a\uff1a\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 redis.conf \u7684 maxmemory \u53c2\u6570\uff0c\u8be5\u53c2\u6570\u53ef\u4ee5\u9650\u5236\u6700\u5927\u53ef\u7528\u5185\u5b58\u3002 18. \u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b Redis \u7684\u5185\u5b58\u7ba1\u7406\u65b9\u5f0f\u6709\u54ea\u4e9b\uff1f \u5185\u5b58\u7ba1\u7406\u65b9\u5f0f\u4e3b\u8981\u6709\u4e24\u4e2a\uff0c\u4e00\u662f\u63a7\u5236\u5185\u5b58\u4e0a\u9650\uff1b\u4e8c\u662f\u4f18\u5316\u56de\u6536\u7b56\u7565\uff0c\u5bf9\u5185\u5b58\u56de\u6536\u3002 19. \u5e38\u89c1\u7684\u6dd8\u6c70\u7b97\u6cd5\u6709\u54ea\u4e9b\uff1f \u4e3b\u8981\u5e38\u89c1\u7684\u6dd8\u6c70\u7b97\u6cd5\u6709\uff1a 1. \u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7b97\u6cd5\uff08LRU\uff09 LRU \u662f Least Recently Used \u7684\u7f29\u5199\uff0c\u4e2d\u6587\u610f\u601d\u662f\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\uff0c\u5b83\u662f\u4e00\u79cd\u5e38\u7528\u7684\u9875\u9762\u7f6e\u6362\u7b97\u6cd5\uff0c\u9009\u62e9\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\u7684\u9875\u9762\u4e88\u4ee5\u6dd8\u6c70\u3002 2. \u5148\u8fdb\u5148\u51fa\u7b97\u6cd5\uff08FIFO\uff09 FIFO \u662f First Input First Output \u7684\u7f29\u5199\uff0c\u5373\u5148\u5165\u5148\u51fa\u961f\u5217\uff0c\u8fd9\u662f\u4e00\u79cd\u4f20\u7edf\u7684\u6309\u5e8f\u6267\u884c\u65b9\u6cd5\uff0c\u5148\u8fdb\u5165\u7684\u6307\u4ee4\u5148\u5b8c\u6210\u5e76\u5f15\u9000\uff0c\u8ddf\u7740\u624d\u6267\u884c\u7b2c\u4e8c\u6761\u6307\u4ee4\u3002 3. \u6700\u4e0d\u7ecf\u5e38\u4f7f\u7528\u7b97\u6cd5\uff08LFU\uff09 LFU \u662f Least Frequently Used \u7684\u7f29\u5199\uff0c\u4e2d\u6587\u610f\u601d\u662f\u6700\u4e0d\u7ecf\u5e38\u4f7f\u7528\u3002\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\uff0c\u6570\u636e\u88ab\u4f7f\u7528\u6b21\u6570\u6700\u5c11\u7684\uff0c\u4f18\u5148\u88ab\u6dd8\u6c70\u3002 20. \u4ee5\u4e0b\u5173\u4e8e NoSQL \u7684\u8bf4\u6cd5\uff0c\u4e0d\u5bf9\u7684\u662f\uff1a A. Redis \u652f\u6301\u5b57\u7b26\u4e32\u3001\u54c8\u5e0c\u3001\u5217\u8868\u3001\u96c6\u5408\u3001\u6709\u5e8f\u96c6\u5408\u7b49\u6570\u636e\u7ed3\u6784\uff0c\u76ee\u524d Redis \u4e0d\u652f\u6301\u4e8b\u52a1\u3002 B. MongoDB \u652f\u6301 CAP \u5b9a\u7406\u4e2d\u7684 AP\uff0cMySQL \u652f\u6301 CAP \u4e2d\u7684 CA\uff0c\u5168\u90e8\u90fd\u652f\u6301\u4e0d\u53ef\u80fd\u5b58\u5728\u3002 C. MongoDB \u4e0d\u7528\u5148\u521b\u5efa Collection \u7684\u7ed3\u6784\u5c31\u53ef\u4ee5\u76f4\u63a5\u63d2\u5165\u6570\u636e\uff0c\u76ee\u524d MongoDB \u4e0d\u652f\u6301\u4e8b\u52a1\u3002 D. Memcache \u65e2\u652f\u6301 TCP \u534f\u8bae\uff0c\u4e5f\u652f\u6301UDP\u534f\u8bae\uff0c\u6211\u4eec\u53ef\u4ee5\u628a PHP\u7684 Session \u5b58\u653e\u5230 Memcache \u4e2d\u3002 \u7b54\u6848\uff1aA \u672c\u9898\u89e3\u6790\uff1aRedis \u662f\u652f\u6301\u4e8b\u52a1\u7684\u3002\u9009\u9879 A \u8bf4\u6cd5\u9519\u8bef\uff0c\u6240\u4ee5\u9009\u9879 A \u6b63\u786e\u3002 \u4e03\u3001Redis \u5e94\u7528\uff0812 \u9898\uff09 1. Redis \u652f\u6301\u7684 Java \u5ba2\u6237\u7aef\u90fd\u6709\u54ea\u4e9b\uff1f\u5b98\u65b9\u63a8\u8350\u7528\u54ea\u4e2a\uff1f \u4e3b\u8981\u652f\u6301\u7684 Java \u5ba2\u6237\u7aef\u6709\uff1aRedisson\u3001Jedis\u3001lettuce \u7b49\uff0c\u5b98\u65b9\u63a8\u8350\u4f7f\u7528 Redisson\u3002 2. Twemproxy \u6709\u4ec0\u4e48\u7279\u70b9\uff1f Twemproxy \u5177\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a \u8f6f\u4ef6\u5feb\u3001\u8f7b\u91cf\uff0c\u914d\u7f6e\u7b80\u5355\u3002 \u53ef\u4ee5\u7ef4\u62a4\u6301\u4e45\u8fde\u63a5\uff0c\u4f7f\u7f13\u5b58\u670d\u52a1\u5668\u7684\u8fde\u63a5\u6570\u5f88\u4f4e\u3002 \u652f\u6301\u4e00\u81f4\u6027 Hash \u7b49\u591a\u79cd hash \u6a21\u5f0f\u3002 \u8de8\u670d\u52a1\u5668\u81ea\u52a8\u5206\u7247\u3002 \u547d\u4ee4\u8bf7\u6c42\u4e0e\u54cd\u5e94\u7684\u6d41\u6c34\u7ebf\u5316\uff0c\u63d0\u5347\u6027\u80fd\u3002 \u53ef\u4ee5\u7981\u7528\u5931\u8d25\u8282\u70b9\uff0c\u6216\u76d1\u63a7\u7aef\u53e3\u5bf9\u5176\u8fdb\u884c\u72b6\u6001\u76d1\u6d4b\u3002 3. \u4f7f\u7528 Redis\uff0c\u8bbe\u8ba1\u4e00\u4e0b\u5728\u4ea4\u6613\u7f51\u7ad9\u9996\u9875\u5c55\u793a\u5f53\u5929\u6700\u70ed\u95e8\u552e\u5356\u5546\u54c1\u7684\u524d\u4e94\u5341\u540d\u5546\u54c1\u5217\u8868\uff1f \u6211\u4eec\u4ece\u9898\u76ee\u4e2d\u5206\u6790\u77e5\u9053\uff0c\u9996\u9875\u7684\u70ed\u95e8\u552e\u5356\u5546\u54c1\u77e5\u9053\uff0c\u8bbf\u95ee\u7684\u6570\u636e\u662f\u70ed\u6570\u636e\uff0c\u4e14\u8bbf\u95ee\u91cf\u5f88\u5927\uff0c\u8fd8\u9700\u8981\u5bf9\u5f53\u5929\u7684\u70ed\u95e8\u552e\u5356\u5546\u54c1\u8fdb\u884c\u6392\u884c\u3002 \u53ef\u4ee5\u4f7f\u7528 zset \u6570\u636e\u7c7b\u578b\u5bf9\u70ed\u6570\u636e\u8fdb\u884c\u7f13\u5b58\uff0czset \u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u6392\u884c\uff0c\u628a key \u4f5c\u4e3a\u5546\u54c1\u7684 ID\uff0cvalue \u4f5c\u4e3a\u5546\u54c1\u5f53\u5929\u9500\u552e\u7684\u6570\u91cf\uff0c\u53ef\u4ee5\u6839\u636e value \u5bf9\u5546\u54c1\u6392\u884c\u3002 4. Redis \u548c Redisson \u6709\u4ec0\u4e48\u5173\u7cfb\uff1f Redisson \u662f\u67b6\u8bbe\u5728 Redis \u57fa\u7840\u4e0a\u7684\u4e00\u4e2a Java \u9a7b\u5185\u5b58\u6570\u636e\u7f51\u683c\uff0c\u5b83\u5145\u5206\u7684\u5229\u7528\u4e86 Redis \u952e\u503c\u6570\u636e\u5e93\u63d0\u4f9b\u7684\u4e00\u7cfb\u5217\u4f18\u52bf\uff0c\u57fa\u4e8e Java \u5b9e\u7528\u5de5\u5177\u5305\u4e2d\u5e38\u7528\u63a5\u53e3\uff0c\u4e3a\u4f7f\u7528\u8005\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u5177\u6709\u5206\u5e03\u5f0f\u7279\u6027\u7684\u5e38\u7528\u5de5\u5177\u7c7b\u3002\u4f7f\u5f97\u539f\u672c\u4f5c\u4e3a\u534f\u8c03\u5355\u673a\u591a\u7ebf\u7a0b\u5e76\u53d1\u7a0b\u5e8f\u7684\u5de5\u5177\u5305\u83b7\u5f97\u4e86\u534f\u8c03\u5206\u5e03\u5f0f\u591a\u673a\u591a\u7ebf\u7a0b\u5e76\u53d1\u7cfb\u7edf\u7684\u80fd\u529b\uff0c\u5927\u5927\u964d\u4f4e\u4e86\u8bbe\u8ba1\u548c\u7814\u53d1\u5927\u89c4\u6a21\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u96be\u5ea6\u3002\u540c\u65f6\u7ed3\u5408\u5404\u5bcc\u7279\u8272\u7684\u5206\u5e03\u5f0f\u670d\u52a1\uff0c\u66f4\u8fdb\u4e00\u6b65\u7b80\u5316\u4e86\u5206\u5e03\u5f0f\u73af\u5883\u4e2d\u7a0b\u5e8f\u76f8\u4e92\u4e4b\u95f4\u7684\u534f\u4f5c\u3002 Redisson \u91c7\u7528\u4e86\u57fa\u4e8e NIO \u7684 Netty \u6846\u67b6\uff0c\u4e0d\u4ec5\u80fd\u4f5c\u4e3a Redis \u5e95\u5c42\u9a71\u52a8\u5ba2\u6237\u7aef\uff0c\u5177\u5907\u63d0\u4f9b\u5bf9 Redis \u5404\u79cd\u7ec4\u6001\u5f62\u5f0f\u7684\u8fde\u63a5\u529f\u80fd\uff0c\u5bf9 Redis \u547d\u4ee4\u80fd\u4ee5\u540c\u6b65\u53d1\u9001\u3001\u5f02\u6b65\u5f62\u5f0f\u53d1\u9001\u3001\u5f02\u6b65\u6d41\u5f62\u5f0f\u53d1\u9001\u6216\u7ba1\u9053\u5f62\u5f0f\u53d1\u9001\u7684\u529f\u80fd\uff0cLUA \u811a\u672c\u6267\u884c\u5904\u7406\uff0c\u4ee5\u53ca\u5904\u7406\u8fd4\u56de\u7ed3\u679c\u7684\u529f\u80fd\uff0c\u8fd8\u5728\u6b64\u57fa\u7840\u4e0a\u878d\u5165\u4e86\u66f4\u9ad8\u7ea7\u7684\u5e94\u7528\u65b9\u6848\u3002 5. Jedis \u4e0e Redisson \u5bf9\u6bd4\u6709\u4ec0\u4e48\u4f18\u7f3a\u70b9\uff1f \u5b83\u4eec\u7684\u4e3b\u8981\u4f18\u7f3a\u70b9\u6709\uff1a Jedis \u76f8\u5bf9 Redisson \u6765\u8bf4\uff0c\u5176 API \u63d0\u4f9b\u4e86\u6bd4\u8f83\u5168\u9762\u7684 Redis \u547d\u4ee4\u652f\u6301\uff1b \u56e0\u4e3a Jedis \u4e2d\u7684 Java \u65b9\u6cd5\u57fa\u672c\u548c Redis \u7684 API \u4fdd\u6301\u4e00\u81f4\uff0c\u6240\u4ee5\u4e86\u89e3\u4e86 Redis \u7684 API\uff0c\u4e5f\u80fd\u719f\u7ec3\u7684\u4f7f\u7528 Jedis\uff1b Jedis \u53ea\u652f\u6301\u57fa\u672c\u7684\u6570\u636e\u7c7b\u578b\uff0c\u4f8b\u5982 String\u3001Hash\u3001List\u3001Set\u3001Sorted Set \u7b49\uff1b Jedis \u4f7f\u7528\u7684\u662f\u963b\u585e\u7684 I/O\uff0c\u4e14\u5176\u65b9\u6cd5\u8c03\u7528\u90fd\u662f\u540c\u6b65\u7684\uff0c\u4e0d\u652f\u6301\u5f02\u6b65\uff0c\u7a0b\u5e8f\u6d41\u9700\u8981\u7b49\u5230 sockets \u5904\u7406\u5b8c I/O \u624d\u80fd\u6267\u884c\u3002Jedis \u5ba2\u6237\u7aef\u5b9e\u4f8b\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u6240\u4ee5\u9700\u8981\u901a\u8fc7\u8fde\u63a5\u6c60\u6765\u4f7f\u7528 Jedis\uff1b Redisson \u5b9e\u73b0\u4e86\u5206\u5e03\u5f0f\u548c\u53ef\u6269\u5c55\u7684 Java \u6570\u636e\u7ed3\u6784\uff0c\u7ae5\u5de5\u4e86\u5f88\u591a\u5206\u5e03\u5f0f\u76f8\u5173\u7684\u64cd\u4f5c\u670d\u52a1\uff0c\u4f8b\u5982\u5206\u5e03\u5f0f\u96c6\u5408\u3001\u5206\u5e03\u5f0f\u9501\uff0c\u53ef\u901a\u8fc7 Redis \u652f\u6301\u5ef6\u8fdf\u961f\u5217\u3002\u5b83\u548c Jedis \u76f8\u6bd4\uff0c\u529f\u80fd\u8f83\u4e3a\u7b80\u5355\uff0c\u4e0d\u652f\u6301\u5b57\u7b26\u4e32\u64cd\u4f5c\uff0c\u4e0d\u652f\u6301\u6392\u5e8f\u3001\u4e8b\u52a1\u3001\u7ba1\u9053\u3001\u5206\u533a\u7b49 Redis \u7279\u6027\u3002\u8fd9\u6837\u505a\u7684\u539f\u56e0\u662f\uff0cRedisson \u53ef\u4ee5\u8ba9\u4f7f\u7528\u8005\u5c06\u7cbe\u529b\u96c6\u4e2d\u653e\u5728\u5904\u7406\u4e1a\u52a1\u903b\u8f91\u4e0a\u3002 Redisson \u662f\u57fa\u4e8e Netty \u6846\u67b6\u7684\u4e8b\u4ef6\u9a71\u52a8\u7684\u901a\u4fe1\u5c42\uff0c\u65b9\u6cd5\u8c03\u7528\u662f\u5f02\u6b65\u7684\u3002\u5b83\u7684 API \u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u53ef\u4ee5\u64cd\u4f5c\u5355\u4e2a Redisson \u8fde\u63a5\u6765\u5b8c\u6210\u5404\u79cd\u64cd\u4f5c\u3002 6. Redis \u4e3b\u8981\u6d88\u8017\u4ec0\u4e48\u7269\u7406\u8d44\u6e90\uff1f Redis \u4e3b\u8981\u5c06\u6570\u636e\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff0c\u5b83\u662f\u5355\u8fdb\u7a0b\u5355\u7ebf\u7a0b\u7684\uff0c\u6240\u4ee5\u4e3b\u8981\u6d88\u8017\u7684\u8d44\u6e90\u548c\u74f6\u9888\u662f\u5185\u5b58\u800c\u4e0d\u662f CPU\u3002 7. Redis \u5ba2\u6237\u7aef\u4f7f\u7528\u7684\u901a\u8baf\u534f\u8bae\u662f RESP\uff08Redis Serialization Protocol\uff09\uff0c\u4ee5\u4e0b\u662f\u5b83\u7684\u7279\u70b9\u7684\u662f A. \u4e8c\u8fdb\u5236\u5b89\u5168 B. \u5728 TCP \u5c42 C. \u57fa\u4e8e\u8bf7\u6c42\u2014\u54cd\u5e94\u6a21\u5f0f D. \u4e0d\u53ef\u4ee5\u5e8f\u5217\u5316\u4e0d\u540c\u7684\u6570\u636e\u7c7b\u578b \u7b54\u6848\uff1aABC \u5206\u6790\uff1aRedis \u5ba2\u6237\u7aef\u548c Redis \u670d\u52a1\u5668\u901a\u4fe1\u65f6\u4f7f\u7528\u7684\u662f RESP\uff08REdis \u5e8f\u5217\u5316\u534f\u8bae\uff09\u901a\u8baf\u534f\u8bae\uff0c\u8be5\u534f\u8bae\u662f\u4e13\u95e8\u4e3a Redis \u8bbe\u8ba1\u7684\uff0c\u4f46\u662f\u4e5f\u53ef\u4ee5\u7528\u4e8e\u5176\u4ed6\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u8f6f\u4ef6\u9879\u76ee\u4e2d\u3002 \u5bf9\u4e8e\u9009\u9879 A\uff0cRESP \u662f\u4e8c\u8fdb\u5236\u5b89\u5168\u7684\uff0c\u5e76\u4e14\u4e0d\u9700\u8981\u5904\u7406\u4ece\u4e00\u4e2a\u8fdb\u7a0b\u4f20\u8f93\u5230\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u7684\u6279\u91cf\u6570\u636e\uff0c\u56e0\u4e3a\u5b83\u4f7f\u7528\u524d\u7f00\u957f\u5ea6\u6765\u4f20\u8f93\u6279\u91cf\u6570\u636e\u3002\u6240\u4ee5\u9009\u9879 A \u6b63\u786e\u3002 \u5bf9\u4e8e\u9009\u9879 B\uff0cRedis \u5ba2\u6237\u7aef\u8fde\u63a5\u5230 Redis \u670d\u52a1\u5668\uff0c\u5e76\u521b\u5efa\u4e0e\u7aef\u53e3 6379 \u7684 TCP \u8fde\u63a5\u3002\u5c3d\u7ba1 RESP \u5728\u6280\u672f\u4e0a\u4e0d\u662f\u7279\u5b9a\u4e8e TCP \u7684\uff0c\u4f46\u5728 Redis \u7684\u4e0a\u4e0b\u6587\u4e2d\uff0c\u8be5\u534f\u8bae\u4ec5\u7528\u4e8e TCP \u8fde\u63a5\uff08\u6216\u7b49\u6548\u7684\u9762\u5411\u6d41\u7684\u8fde\u63a5\uff0c\u5982 Unix \u5957\u63a5\u5b57\uff09\u3002\u6240\u4ee5\u9009\u9879 B \u6b63\u786e\u3002 \u5bf9\u4e8e\u9009\u9879 C\uff0cRedis \u63a5\u53d7\u7531\u4e0d\u540c\u53c2\u6570\u7ec4\u6210\u7684\u547d\u4ee4\u3002\u6536\u5230\u547d\u4ee4\u540e\uff0c\u5c06\u5bf9\u5176\u8fdb\u884c\u5904\u7406\u5e76\u5c06\u7b54\u590d\u53d1\u9001\u56de\u5ba2\u6237\u7aef\u3002\u6240\u4ee5\u9009\u9879 C \u6b63\u786e\u3002 \u5bf9\u4e8e\u9009\u9879 D\uff0cRESP \u53ef\u4ee5\u5e8f\u5217\u5316\u4e0d\u540c\u7684\u6570\u636e\u7c7b\u578b\uff0c\u4f8b\u5982\u6574\u6570\uff0c\u5b57\u7b26\u4e32\uff0c\u6570\u7ec4\u3002\u8fd8\u6709\u4e00\u79cd\u7279\u5b9a\u7684\u9519\u8bef\u7c7b\u578b\u3002\u8bf7\u6c42\u4ee5\u5b57\u7b26\u4e32\u6570\u7ec4\u7684\u5f62\u5f0f\u4ece\u5ba2\u6237\u7aef\u53d1\u9001\u5230 Redis \u670d\u52a1\u5668\uff0c\u8fd9\u4e9b\u5b57\u7b26\u4e32\u8868\u793a\u8981\u6267\u884c\u7684\u547d\u4ee4\u7684\u53c2\u6570\u3002Redis \u4f7f\u7528\u7279\u5b9a\u4e8e\u547d\u4ee4\u7684\u6570\u636e\u7c7b\u578b\u8fdb\u884c\u56de\u590d\u3002\u6240\u4ee5\u9009\u9879 D \u9519\u8bef\u3002 \u6240\u4ee5\u672c\u9898\u7684\u7b54\u6848\u4e3a ABC\u3002 8. \u600e\u4e48\u63d0\u9ad8\u7f13\u5b58\u547d\u4e2d\u7387\uff1f \u4e3b\u8981\u5e38\u7528\u7684\u624b\u6bb5\u6709\uff1a \u63d0\u524d\u52a0\u8f7d\u6570\u636e\u5230\u7f13\u5b58\u4e2d\uff1b \u589e\u52a0\u7f13\u5b58\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u63d0\u9ad8\u7f13\u5b58\u7684\u6570\u636e\uff1b \u8c03\u6574\u7f13\u5b58\u7684\u5b58\u50a8\u6570\u636e\u7c7b\u578b\uff1b \u63d0\u5347\u7f13\u5b58\u7684\u66f4\u65b0\u9891\u7387\u3002 9. \u7f13\u5b58\u547d\u4e2d\u7387\u8868\u793a\u4ec0\u4e48\uff1f \u7f13\u5b58\u547d\u4e2d\u7387\u8868\u793a\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u6570\u636e\u65f6\u53ef\u4ee5\u83b7\u53d6\u5230\u6570\u636e\u7684\u6b21\u6570\uff0c\u547d\u4e2d\u7387\u8d8a\u9ad8\u4ee3\u8868\u7f13\u5b58\u7684\u4f7f\u7528\u6548\u7387\u8d8a\u9ad8\uff0c\u5e94\u7528\u7684\u6027\u80fd\u8d8a\u597d\u3002 \u5b83\u7684\u516c\u5f0f\u4e3a\uff1a \u7f13\u5b58\u547d\u4e2d\u7387 = \u7f13\u5b58\u4e2d\u83b7\u53d6\u6570\u636e\u6b21\u6570/\u83b7\u53d6\u6570\u636e\u603b\u6b21\u6570 \u7f13\u5b58\u547d\u4e2d\u7684\u610f\u601d\u662f\uff1a\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u5230\u9700\u8981\u7684\u6570\u636e\u7684\u6b21\u6570\uff1b \u7f13\u5b58\u4e0d\u547d\u4e2d\u7684\u610f\u601d\u662f\uff1a\u4ece\u7f13\u5b58\u4e2d\u65e0\u6cd5\u83b7\u53d6\u6240\u9700\u6570\u636e\uff0c\u9700\u8981\u518d\u6b21\u67e5\u8be2\u6570\u636e\u5e93\u6216\u8005\u5176\u4ed6\u6570\u636e\u5b58\u50a8\u8f7d\u4f53\u7684\u6b21\u6570\u3002 10. Redis \u662f\u4e00\u4e2a\u57fa\u4e8e\u5185\u5b58\u4e14\u652f\u6301\u6301\u4e45\u5316\u7684\u9ad8\u6027\u80fd key-value \u6570\u636e\u5e93\uff0c\u5b83\u652f\u6301\u7684\u529f\u80fd\u6709\u54ea\u4e9b\uff1f Redis\uff08\u5373 Remote Dictionary Server \u7684\u7f29\u5199\uff0c\u4e2d\u6587\u610f\u601d\u4e3a\u8fdc\u7a0b\u5b57\u5178\u670d\u52a1\uff09\u662f\u4e00\u4e2a\u4f7f\u7528 ANSI C \u8bed\u8a00\u7f16\u5199\uff0c\u5f00\u6e90\u7684\u3001\u652f\u6301\u7f51\u7edc\u3001\u53ef\u57fa\u4e8e\u5185\u5b58\u4ea6\u53ef\u6301\u4e45\u5316\u7684\u65e5\u5fd7\u578b\u3001Key-Value \u6570\u636e\u5e93\uff0c\u5b83\u63d0\u4f9b\u4e86\u591a\u79cd\u8bed\u8a00\u7684 API\u3002 \u5b83\u5185\u90e8\u652f\u6301\u591a\u79cd\u6570\u636e\u7ed3\u6784\u3001\u6570\u636e\u6301\u4e45\u5316\u673a\u5236\u3001\u4e3b\u4ece\u7ed3\u6784\u3001Redis \u96c6\u7fa4\u7b49\u529f\u80fd\u3002 11. Redis \u5982\u4f55\u89e3\u51b3 key \u51b2\u7a81\uff1f Redis \u5982\u679c key \u76f8\u540c\uff0c\u540e\u4e00\u4e2a key \u4f1a\u8986\u76d6\u524d\u4e00\u4e2a key\u3002\u5982\u679c\u8981\u89e3\u51b3 key \u51b2\u7a81\uff0c\u6700\u597d\u7ed9 key \u53d6\u597d\u540d\u533a\u5206\u5f00\uff0c\u53ef\u4ee5\u6309\u4e1a\u52a1\u540d\u548c\u53c2\u6570\u533a\u5206\u5f00\u53d6\u540d\uff0c\u907f\u514d\u91cd\u590d key \u5bfc\u81f4\u7684\u51b2\u7a81\u3002","title":"115 \u9053 Redis \u9762\u8bd5\u9898\u89e3\u7b54"},{"location":"chap10/4Redis_int_all/#115-redis","text":"","title":"115 \u9053 Redis \u9762\u8bd5\u9898\u89e3\u7b54"},{"location":"chap10/4Redis_int_all/#redis-27","text":"","title":"\u4e00\u3001Redis \u57fa\u7840\uff0827 \u9898\uff09"},{"location":"chap10/4Redis_int_all/#1-redis","text":"Redis \u662f\u4e00\u4e2a\u5f00\u6e90\uff08BSD \u8bb8\u53ef\uff09\u3001\u57fa\u4e8e\u5185\u5b58\u3001\u652f\u6301\u591a\u79cd\u6570\u636e\u7ed3\u6784\u7684\u5b58\u50a8\u7cfb\u7edf\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u6570\u636e\u5e93\u3001\u7f13\u5b58\u548c\u6d88\u606f\u4e2d\u95f4\u4ef6\u3002 \u5b83\u652f\u6301\u7684\u6570\u636e\u7ed3\u6784\u6709\u5b57\u7b26\u4e32\uff08strings\uff09\u3001\u54c8\u5e0c\uff08hashes\uff09\u3001\u5217\u8868\uff08lists\uff09\u3001\u96c6\u5408\uff08sets\uff09\u3001\u6709\u5e8f\u96c6\u5408\uff08sorted sets\uff09\u7b49\uff0c\u9664\u6b64\u4e4b\u5916\u8fd8\u652f\u6301 bitmaps\u3001hyperloglogs \u548c\u5730\u7406\u7a7a\u95f4\uff08 geospatial \uff09\u7d22\u5f15\u534a\u5f84\u67e5\u8be2\u7b49\u529f\u80fd\u3002 \u5b83\u5185\u7f6e\u4e86\u590d\u5236\uff08Replication\uff09\u3001LUA \u811a\u672c\uff08Lua scripting\uff09\u3001LRU \u9a71\u52a8\u4e8b\u4ef6\uff08LRU eviction\uff09\u3001\u4e8b\u52a1\uff08Transactions\uff09\u548c\u4e0d\u540c\u7ea7\u522b\u7684\u78c1\u76d8\u6301\u4e45\u5316\uff08persistence\uff09\u529f\u80fd\uff0c\u5e76\u901a\u8fc7 Redis \u54e8\u5175\uff08\u54e8\u5175\uff09\u548c\u96c6\u7fa4\uff08Cluster\uff09\u4fdd\u8bc1\u7f13\u5b58\u7684\u9ad8\u53ef\u7528\u6027\uff08High availability\uff09\u3002","title":"1. \u4ec0\u4e48\u662f Redis\uff1f"},{"location":"chap10/4Redis_int_all/#2-redis","text":"Redis \u652f\u6301\u7684\u6570\u636e\u7c7b\u578b\u6709\uff1a","title":"2. Redis \u7684\u6570\u636e\u7c7b\u578b\u6709\u54ea\u4e9b\uff1f"},{"location":"chap10/4Redis_int_all/#3-redis","text":"\u5177\u6709\u4ee5\u4e0b\u597d\u5904\uff1a \u8bfb\u53d6\u901f\u5ea6\u5feb\uff0c\u56e0\u4e3a\u6570\u636e\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u6240\u4ee5\u6570\u636e\u83b7\u53d6\u5feb \uff1b \u652f\u6301\u591a\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u5305\u62ec\u5b57\u7b26\u4e32\u3001\u5217\u8868\u3001\u96c6\u5408\u3001\u6709\u5e8f\u96c6\u5408\u3001\u54c8\u5e0c\u7b49 \uff1b \u652f\u6301\u4e8b\u52a1\uff0c\u4e14\u64cd\u4f5c\u9075\u5b88\u539f\u5b50\u6027\uff0c\u5373\u5bf9\u6570\u636e\u7684\u64cd\u4f5c\u8981\u4e48\u90fd\u6267\u884c\uff0c\u8981\u4e48\u90fd\u4e0d\u652f\u6301 \uff1b \u8fd8\u62e5\u6709\u5176\u4ed6\u4e30\u5bcc\u7684\u529f\u80fd\uff0c\u961f\u5217\u3001\u4e3b\u4ece\u590d\u5236\u3001\u96c6\u7fa4\u3001\u6570\u636e\u6301\u4e45\u5316\u7b49\u529f\u80fd \u3002","title":"3. \u4f7f\u7528 Redis \u6709\u54ea\u4e9b\u597d\u5904\uff1f"},{"location":"chap10/4Redis_int_all/#4-redis-memcached","text":"Redis \u76f8\u6bd4 Memcache \u6709\u4ee5\u4e0b\u7684\u4f18\u52bf\uff1a \u6570\u636e\u7ed3\u6784 \uff1aMemcache \u53ea\u652f\u6301 key value \u5b58\u50a8\u65b9\u5f0f\uff0cRedis \u652f\u6301\u66f4\u591a\u7684\u6570\u636e\u7c7b\u578b\uff0c\u6bd4\u5982 Key value\u3001hash\u3001list\u3001set\u3001zset\uff1b \u591a\u7ebf\u7a0b \uff1aMemcache \u652f\u6301\u591a\u7ebf\u7a0b\uff0cRedis \u652f\u6301\u5355\u7ebf\u7a0b\uff1b CPU \u5229\u7528\u65b9\u9762 Memcache \u4f18\u4e8e Redis \uff1b \u6301\u4e45\u5316 \uff1aMemcache \u4e0d\u652f\u6301\u6301\u4e45\u5316\uff0cRedis \u652f\u6301\u6301\u4e45\u5316\uff1b \u5185\u5b58\u5229\u7528\u7387 \uff1aMemcache \u9ad8\uff0cRedis \u4f4e\uff08\u91c7\u7528\u538b\u7f29\u7684\u60c5\u51b5\u4e0b\u6bd4 Memcache \u9ad8\uff09\uff1b \u8fc7\u671f\u7b56\u7565 \uff1aMemcache \u8fc7\u671f\u540e\uff0c\u4e0d\u5220\u9664\u7f13\u5b58\uff0c\u4f1a\u5bfc\u81f4\u4e0b\u6b21\u53d6\u6570\u636e\u6570\u636e\u7684\u95ee\u9898\uff0cRedis \u6709\u4e13\u95e8\u7ebf\u7a0b\uff0c\u6e05\u9664\u7f13\u5b58\u6570\u636e\uff1b \u9002\u7528\u573a\u666f \uff1aRedis \u9002\u7528\u4e8e\u5bf9\u8bfb\u5199\u6548\u7387\u8981\u6c42\u90fd\u5f88\u9ad8\uff0c\u6570\u636e\u5904\u7406\u4e1a\u52a1\u590d\u6742\u548c\u5bf9\u5b89\u5168\u6027\u8981\u6c42\u8f83\u9ad8\u7684\u7cfb\u7edf\u3002 Redis \u53ea\u4f7f\u7528\u5355\u6838\uff0c\u800c Memcached \u53ef\u4ee5\u4f7f\u7528\u591a\u6838\uff0c\u6240\u4ee5\u5e73\u5747\u6bcf\u4e00\u4e2a\u6838\u4e0a Redis \u5728\u5b58\u50a8\u5c0f\u6570\u636e\u65f6\u6bd4 Memcached \u6027\u80fd\u66f4\u9ad8\u3002 Memcached \u9002\u7528\u4e8e\u5728\u52a8\u6001\u7cfb\u7edf\u4e2d\u51cf\u5c11\u6570\u636e\u5e93\u8d1f\u8f7d\uff0c\u63d0\u5347\u6027\u80fd\uff0c\u505a\u7f13\u5b58\uff0c\u63d0\u9ad8\u6027\u80fd\uff08\u9002\u5408\u8bfb\u591a\u5199\u5c11\uff0c\u5bf9\u4e8e\u6570\u636e\u91cf\u6bd4\u8f83\u5927\uff0c\u53ef\u4ee5\u91c7\u7528 sharding\uff09\u3002","title":"4. Redis \u76f8\u6bd4 Memcached \u6709\u54ea\u4e9b\u4f18\u52bf\uff1f"},{"location":"chap10/4Redis_int_all/#5-memcache-redis","text":"\u5b83\u4eec\u7684\u4e3b\u8981\u533a\u522b\u6709\uff1a \u652f\u6301\u7684\u6570\u636e\u7c7b\u578b\u4e0d\u540c\uff0cMemcache \u652f\u6301\u7684\u6570\u636e\u7c7b\u578b\u7b80\u5355\uff0c\u53ea\u6709 key-value\uff0c\u800c Redis \u652f\u6301\u591a\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u5305\u62ec\u5b57\u7b26\u4e32\u3001\u5217\u8868\u3001\u96c6\u5408\u3001\u6709\u5e8f\u96c6\u5408\u3001\u54c8\u5e0c\u7b49\uff1b Redis \u652f\u6301\u6570\u636e\u6301\u4e45\u5316\uff0cMemcache \u4e0d\u652f\u6301\u6570\u636e\u6301\u4e45\u5316\u3002 \u5982\u679c\u670d\u52a1\u5668\u91cd\u542f\uff0cMemcache \u4e2d\u7684\u6570\u636e\u4f1a\u88ab\u6e05\u7a7a\uff0c\u800c Redis \u5f00\u542f\u6301\u4e45\u5316\u7684\u8bdd\uff0c\u91cd\u542f\u540e\u53ef\u4ee5\u81ea\u52a8\u52a0\u8f7d\u6570\u636e\u6062\u590d\u5230\u5185\u5b58\u4e2d\uff1b \u5b83\u4eec\u7684\u5e95\u5c42\u7ed3\u6784\u3001\u5b9e\u73b0\u65b9\u5f0f\u7684\u4e0d\u540c\uff0c\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u901a\u4fe1\u7684\u534f\u8bae\u4e5f\u4e0d\u540c\u3002","title":"5. Memcache \u4e0e Redis \u7684\u533a\u522b\u90fd\u6709\u54ea\u4e9b\uff1f"},{"location":"chap10/4Redis_int_all/#6-redis","text":"Redis \u662f\u5355\u8fdb\u7a0b\u5355\u7ebf\u7a0b\u7684\uff0c \u5b83\u53ef\u4ee5\u901a\u8fc7\u961f\u5217\u6280\u672f\u5c06\u5e76\u53d1\u8bbf\u95ee\u53d8\u4e3a\u4e32\u884c\u8bbf\u95ee\uff0c\u907f\u514d\u4e86\u4f20\u7edf\u6570\u636e\u5e93\u4e32\u884c\u63a7\u5236\u7684\u5f00\u9500\u3002","title":"6. Redis \u662f\u5355\u8fdb\u7a0b\u5355\u7ebf\u7a0b\u7684\u5417\uff1f"},{"location":"chap10/4Redis_int_all/#7-redis","text":"Redis \u5c06\u6570\u636e\u653e\u5728\u5185\u5b58\u4e2d\u6709\u4e00\u4e2a\u597d\u5904\uff0c\u90a3\u5c31\u662f\u53ef\u4ee5\u5b9e\u73b0\u6700\u5feb\u7684\u5bf9\u6570\u636e\u8bfb\u53d6\uff0c\u5982\u679c\u6570\u636e\u5b58\u50a8\u5728\u786c\u76d8\u4e2d\uff0c\u78c1\u76d8 I/O \u4f1a\u4e25\u91cd\u5f71\u54cd Redis \u7684\u6027\u80fd\u3002 \u800c\u4e14 Redis \u8fd8\u63d0\u4f9b\u4e86\u6570\u636e\u6301\u4e45\u5316\u529f\u80fd\uff0c\u4e0d\u7528\u62c5\u5fc3\u670d\u52a1\u5668\u91cd\u542f\u5bf9\u5185\u5b58\u4e2d\u6570\u636e\u7684\u5f71\u54cd \u3002\u5176\u6b21\u73b0\u5728\u786c\u4ef6\u8d8a\u6765\u8d8a\u4fbf\u5b9c\u7684\u60c5\u51b5\u4e0b\uff0cRedis \u7684\u4f7f\u7528\u4e5f\u88ab\u5e94\u7528\u5f97\u8d8a\u6765\u8d8a\u591a\uff0c\u4f7f\u5f97\u5b83\u62e5\u6709\u5f88\u5927\u7684\u4f18\u52bf\u3002","title":"7. \u4e3a\u4ec0\u4e48 Redis \u9700\u8981\u628a\u6240\u6709\u6570\u636e\u653e\u5230\u5185\u5b58\u4e2d\uff1f"},{"location":"chap10/4Redis_int_all/#8-redis","text":"Redis \u652f\u6301\u4e3b\u4ece\u540c\u6b65\u3001\u4ece\u4ece\u540c\u6b65\u3002 \u5982\u679c\u662f\u7b2c\u4e00\u6b21\u8fdb\u884c\u4e3b\u4ece\u540c\u6b65\uff0c\u4e3b\u8282\u70b9\u9700\u8981\u4f7f\u7528 bgsave \u547d\u4ee4\uff0c\u518d\u5c06\u540e\u7eed\u4fee\u6539\u64cd\u4f5c\u8bb0\u5f55\u5230\u5185\u5b58\u7684\u7f13\u51b2\u533a\uff0c\u7b49 RDB \u6587\u4ef6\u5168\u90e8\u540c\u6b65\u5230\u590d\u5236\u8282\u70b9\uff0c\u590d\u5236\u8282\u70b9\u63a5\u53d7\u5b8c\u6210\u540e\u5c06 RDB \u955c\u50cf\u8bb0\u8f7d\u5230\u5185\u5b58\u4e2d\u3002 \u7b49\u52a0\u8f7d\u5b8c\u6210\u540e\uff0c\u590d\u5236\u8282\u70b9\u901a\u77e5\u4e3b\u8282\u70b9\u5c06\u590d\u5236\u671f\u95f4\u4fee\u6539\u7684\u64cd\u4f5c\u8bb0\u5f55\u540c\u6b65\u5230\u590d\u5236\u8282\u70b9\uff0c\u5373\u53ef\u5b8c\u6210\u540c\u6b65\u8fc7\u7a0b\u3002","title":"8. Redis \u7684\u540c\u6b65\u673a\u5236\u4e86\u89e3\u662f\u4ec0\u4e48\uff1f"},{"location":"chap10/4Redis_int_all/#9-pipeline-pipeline","text":"\u4f7f\u7528 pipeline\uff08\u7ba1\u9053\uff09\u7684\u597d\u5904\u5728\u4e8e\u53ef\u4ee5\u5c06\u591a\u6b21 I/O \u5f80\u8fd4\u7684\u65f6\u95f4\u7f29\u77ed\u4e3a\u4e00\u6b21\uff0c\u4f46\u662f\u8981\u6c42\u7ba1\u9053\u4e2d\u6267\u884c\u7684\u6307\u4ee4\u95f4\u6ca1\u6709\u56e0\u679c\u5173\u7cfb\u3002 \u7528 pipeline \u7684\u539f\u56e0\u5728\u4e8e\u53ef\u4ee5\u5b9e\u73b0\u8bf7\u6c42/\u54cd\u5e94\u670d\u52a1\u5668\u7684\u529f\u80fd\uff0c\u5f53\u5ba2\u6237\u7aef\u5c1a\u672a\u8bfb\u53d6\u65e7\u54cd\u5e94\u65f6\uff0c\u5b83\u4e5f\u53ef\u4ee5\u5904\u7406\u65b0\u7684\u8bf7\u6c42\u3002\u5982\u679c\u5ba2\u6237\u7aef\u5b58\u5728\u591a\u4e2a\u547d\u4ee4\u53d1\u9001\u5230\u670d\u52a1\u5668\u65f6\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u65e0\u9700\u7b49\u5f85\u670d\u52a1\u7aef\u7684\u6bcf\u6b21\u54cd\u5e94\u624d\u80fd\u6267\u884c\u4e0b\u4e2a\u547d\u4ee4\uff0c\u53ea\u9700\u6700\u540e\u4e00\u6b65\u4ece\u670d\u52a1\u7aef\u8bfb\u53d6\u56de\u590d\u5373\u53ef\u3002","title":"9. pipeline \u6709\u4ec0\u4e48\u597d\u5904\uff0c\u4e3a\u4ec0\u4e48\u8981\u7528 pipeline\uff1f"},{"location":"chap10/4Redis_int_all/#10-redis","text":"Redis \u662f\u4e00\u4e2a\u5f00\u6e90\uff08BSD \u8bb8\u53ef\uff09\uff0c\u57fa\u4e8e\u5185\u5b58\uff0c\u652f\u6301\u591a\u79cd\u6570\u636e\u7ed3\u6784\u7684\u5b58\u50a8\u7cfb\u7edf\u3002 \u53ef\u4ee5\u4f5c\u4e3a\u6570\u636e\u5e93\u3001\u7f13\u5b58\u548c\u6d88\u606f\u4e2d\u95f4\u4ef6\u3002\u5b83\u652f\u6301\u7684\u6570\u636e\u7ed3\u6784\u6709\u5b57\u7b26\u4e32\uff08strings\uff09\u3001\u54c8\u5e0c\uff08hashes\uff09\u3001\u5217\u8868\uff08lists\uff09\u3001\u96c6\u5408\uff08sets\uff09\u3001\u6709\u5e8f\u96c6\u5408\uff08sorted sets\uff09\u7b49\uff0c\u9664\u6b64\u4e4b\u5916\u8fd8\u652f\u6301 bitmaps\u3001hyperloglogs \u548c\u5730\u7406\u7a7a\u95f4\uff08 geospatial \uff09\u7d22\u5f15\u534a\u5f84\u67e5\u8be2\u7b49\u529f\u80fd\u3002\u6839\u636e\u5b83\u7684\u7279\u6027\uff0c\u5b83\u9002\u7528\u7684\u573a\u666f\u6709\uff1a","title":"10. Redis \u6700\u9002\u5408\u7684\u573a\u666f\uff1f"},{"location":"chap10/4Redis_int_all/#1","text":"\u4f1a\u8bdd\uff08Session\uff09\u662f\u5b58\u50a8\u5728\u670d\u52a1\u7aef\u7684\uff0c\u4f46\u662f\u53ef\u4ee5\u8bbe\u7f6e\u5b58\u50a8\u7684\u65f6\u5019\u4e0d\u4ee5\u6587\u4ef6\u7684\u65b9\u5f0f\u5b58\u50a8\uff0c\u800c\u662f\u5b58\u5230 Redis \u4e2d\uff0c\u800c\u4e14 Redis \u652f\u6301\u6570\u636e\u6301\u4e45\u5316\uff0c\u4e0d\u7528\u62c5\u5fc3\u6570\u636e\u56e0\u4e3a\u670d\u52a1\u5668\u91cd\u542f\u5bfc\u81f4 Session \u6570\u636e\u4e22\u5931\u7684\u95ee\u9898\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u4e0d\u53ea\u662f\u63d0\u9ad8\u83b7\u53d6\u4f1a\u8bdd\u7684\u901f\u5ea6\uff0c\u4e5f\u5bf9\u7f51\u7ad9\u7684\u6574\u4f53\u6027\u80fd\u6709\u5f88\u5927\u7684\u63d0\u5347\u3002","title":"1. \u4f1a\u8bdd\u7f13\u5b58"},{"location":"chap10/4Redis_int_all/#2","text":"Redis \u652f\u6301\u591a\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u7ecf\u5e38\u88ab\u7528\u6765\u505a\u7f13\u5b58\u4e2d\u95f4\u4ef6\u4f7f\u7528\u3002\u7f13\u5b58\u7684\u6570\u636e\u4e0d\u53ea\u662f\u5305\u62ec\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u7f13\u5b58\u4e00\u4e9b\u9700\u8981\u4e34\u65f6\u5b58\u50a8\u7684\u6570\u636e\uff0c\u4f8b\u5982 token\u3001\u4f1a\u8bdd\u6570\u636e\u7b49\u3002","title":"2. \u6570\u636e\u7f13\u5b58"},{"location":"chap10/4Redis_int_all/#3","text":"Redis \u662f\u652f\u6301\u5217\u8868\uff08lists\uff09\u529f\u80fd\u7684\uff0c\u53ef\u4ee5\u7b80\u5355\u5b9e\u73b0\u4e00\u4e2a\u961f\u5217\u7684\u529f\u80fd\uff0c\u5bf9\u6570\u636e\u8fdb\u884c\u5165\u961f\u3001\u51fa\u961f\u64cd\u4f5c\u3002\u5b9e\u73b0\u7684\u961f\u5217\u53ef\u4ee5\u5e94\u7528\u5230\u7535\u5546\u7684\u79d2\u6740\u573a\u666f\u4e2d\u3002","title":"3. \u961f\u5217"},{"location":"chap10/4Redis_int_all/#4","text":"Redis \u63d0\u4f9b\u4e86\u6709\u5e8f\u96c6\u5408\uff0c\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u6392\u540d\uff0c\u5b9e\u73b0\u6392\u884c\u699c\u529f\u80fd\u3002 \u5176\u6b21 Redis \u4e2d\u63d0\u4f9b\u4e86 incr \u5bf9\u6570\u5b57\u52a0 1 \u547d\u4ee4\uff0c\u4e5f\u63d0\u4f9b\u4e86 decr \u5bf9\u6570\u5b57\u51cf 1 \u547d\u4ee4\uff0c\u6240\u4ee5\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684\u8ba1\u6570\u5668\u529f\u80fd\u3002","title":"4. \u6392\u884c\u699c\u3001\u8ba1\u6570\u5668"},{"location":"chap10/4Redis_int_all/#5","text":"Redis \u4e2d\u63d0\u4f9b\u4e86\u53d1\u5e03\u8ba2\u9605\u76f8\u5173\u7684\u547d\u4ee4\uff0c\u53ef\u4ee5\u7528\u6765\u505a\u4e00\u4e9b\u8ddf\u53d1\u5e03\u8ba2\u9605\u76f8\u5173\u7684\u573a\u666f\u5e94\u7528\u7b49\u3002\u4f8b\u5982\u7b80\u5355\u7684\u6d88\u606f\u961f\u5217\u529f\u80fd\u7b49\u3002","title":"5. \u53d1\u5e03\u3001\u8ba2\u9605\u529f\u80fd"},{"location":"chap10/4Redis_int_all/#11-redis","text":"Redis \u4e2d\u7684\u4e8b\u52a1\u662f\u4e00\u7ec4\u547d\u4ee4\u7684\u96c6\u5408\uff0c\u662f Redis \u7684\u6700\u5c0f\u6267\u884c\u5355\u4f4d\u3002 \u5b83\u53ef\u4ee5\u4fdd\u8bc1\u4e00\u6b21\u6267\u884c\u591a\u4e2a\u547d\u4ee4\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u9694\u79bb\u64cd\u4f5c\uff0c\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u90fd\u4f1a\u5e8f\u5217\u5316\u3001\u6309\u987a\u5e8f\u5730\u6267\u884c\u3002\u670d\u52a1\u7aef\u5728\u6267\u884c\u4e8b\u52a1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u4f1a\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u53d1\u9001\u6765\u7684\u547d\u4ee4\u8bf7\u6c42\u6253\u65ad\u3002 \u5b83\u7684\u539f\u7406\u662f\u5148\u5c06\u5c5e\u4e8e\u4e00\u4e2a\u4e8b\u52a1\u7684\u547d\u4ee4\u53d1\u9001\u7ed9 Redis\uff0c\u7136\u540e\u4f9d\u6b21\u6267\u884c\u8fd9\u4e9b\u547d\u4ee4\u3002","title":"11. \u4ec0\u4e48\u662f Redis \u4e8b\u52a1\uff1f\u539f\u7406\u662f\u4ec0\u4e48\uff1f"},{"location":"chap10/4Redis_int_all/#12-redis","text":"\u9700\u8981\u6ce8\u610f\u7684\u70b9\u6709\uff1a Redis \u4e8b\u52a1\u662f\u4e0d\u652f\u6301\u56de\u6eda\u7684\uff0c\u4e0d\u50cf MySQL \u7684\u4e8b\u52a1\u4e00\u6837\uff0c\u8981\u4e48\u90fd\u6267\u884c\u8981\u4e48\u90fd\u4e0d\u6267\u884c \uff1b Redis \u670d\u52a1\u7aef\u5728\u6267\u884c\u4e8b\u52a1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u4f1a\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u53d1\u9001\u6765\u7684\u547d\u4ee4\u8bf7\u6c42\u6253\u65ad \u3002 \u76f4\u5230\u4e8b\u52a1\u547d\u4ee4\u5168\u90e8\u6267\u884c\u5b8c\u6bd5\u624d\u4f1a\u6267\u884c\u5176\u4ed6\u5ba2\u6237\u7aef\u7684\u547d\u4ee4\u3002","title":"12. Redis \u4e8b\u52a1\u7684\u6ce8\u610f\u70b9\u6709\u54ea\u4e9b\uff1f"},{"location":"chap10/4Redis_int_all/#13-redis","text":"Redis \u7684\u4e8b\u52a1\u4e0d\u652f\u6301\u56de\u6eda\uff0c\u4f46\u662f\u6267\u884c\u7684\u547d\u4ee4\u6709\u8bed\u6cd5\u9519\u8bef\uff0cRedis \u4f1a\u6267\u884c\u5931\u8d25\uff0c\u8fd9\u4e9b\u95ee\u9898\u53ef\u4ee5\u4ece\u7a0b\u5e8f\u5c42\u9762\u6355\u83b7\u5e76\u89e3\u51b3\u3002 \u4f46\u662f\u5982\u679c\u51fa\u73b0\u5176\u4ed6\u95ee\u9898\uff0c\u5219\u4f9d\u7136\u4f1a\u7ee7\u7eed\u6267\u884c\u4f59\u4e0b\u7684\u547d\u4ee4 \u3002\u8fd9\u6837\u505a\u7684\u539f\u56e0\u662f\u56e0\u4e3a\u56de\u6eda\u9700\u8981\u589e\u52a0\u5f88\u591a\u5de5\u4f5c\uff0c\u800c\u4e0d\u652f\u6301\u56de\u6eda\u5219\u53ef\u4ee5\u4fdd\u6301\u7b80\u5355\u3001\u5feb\u901f\u7684\u7279\u6027\u3002","title":"13. Redis \u4e3a\u4ec0\u4e48\u4e0d\u652f\u6301\u56de\u6eda\uff1f"},{"location":"chap10/4Redis_int_all/#14-redis","text":"Redis \u5bc6\u7801\u8bbe\u7f6e\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a \u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u9700\u8981\u91cd\u542f Redis\u3002 \u5728 redis.conf \u4e2d\u53ef\u4ee5\u627e\u5230 requirepass \u53c2\u6570\uff0c\u8bbe\u7f6e Redis \u7684\u8bbf\u95ee\u5bc6\u7801 \u3002 \u914d\u7f6e\u65b9\u6cd5\u4e3a\uff1a requirepass \u8bbf\u95ee\u5bc6\u7801 \u3002 \u4f7f\u7528\u547d\u4ee4\u8bbe\u7f6e\uff0c\u4e0d\u9700\u8981\u91cd\u542f Redis\u3002 \u4f7f\u7528\u547d\u4ee4\u8bbe\u7f6e\u7684\u65b9\u6cd5\u4e3a\uff1a config set requirepass \u8bbf\u95ee\u5bc6\u7801\u3002 \u5982\u679c\u9700\u8981\u67e5\u8be2\u5bc6\u7801\uff0c\u53ef\u4ee5\u4f7f\u7528 config get requirepass \u547d\u4ee4 \u3002 \u5982\u679c\u9700\u8981\u9a8c\u8bc1\u5bc6\u7801\uff0c\u53ef\u4ee5\u4f7f\u7528 auth \u8bbf\u95ee\u5bc6\u7801\uff0c\u518d\u6267\u884c config get requirepass \u83b7\u53d6 \u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u8bbe\u7f6e\u8bbf\u95ee\u5bc6\u7801\uff0c\u5982\u679c redis.conf \u914d\u7f6e\u6587\u4ef6\u4e2d\u6ca1\u6709\u8bbe\u7f6e\u5bf9\u5e94\u7684\u8bbf\u95ee\u5bc6\u7801\uff0c\u90a3\u4e48\u670d\u52a1\u5668\u91cd\u542f\u540e\u8bbf\u95ee\u5bc6\u7801\u4f1a\u5931\u6548\u3002","title":"14. Redis \u5982\u4f55\u8bbe\u7f6e\u5bc6\u7801\u53ca\u9a8c\u8bc1\u5bc6\u7801\uff1f"},{"location":"chap10/4Redis_int_all/#15-redis","text":"\u591a\u7ebf\u7a0b\u5904\u7406\u4f1a\u6d89\u53ca\u5230\u9501\uff0c\u5e76\u4e14\u591a\u7ebf\u7a0b\u5904\u7406\u4f1a\u6d89\u53ca\u5230\u7ebf\u7a0b\u5207\u6362\u800c\u6d88\u8017 CPU\u3002 \u91c7\u7528\u5355\u7ebf\u7a0b\uff0c\u907f\u514d\u4e86\u4e0d\u5fc5\u8981\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u548c\u7ade\u4e89\u6761\u4ef6 \u3002 \u5176\u6b21 CPU \u4e0d\u662f Redis \u7684\u74f6\u9888\uff0cRedis \u7684\u74f6\u9888\u6700\u6709\u53ef\u80fd\u662f\u673a\u5668\u5185\u5b58\u6216\u8005\u7f51\u7edc\u5e26\u5bbd\u3002","title":"15. Redis \u4e3a\u4ec0\u4e48\u8bbe\u8ba1\u6210\u5355\u7ebf\u7a0b\u7684\uff1f"},{"location":"chap10/4Redis_int_all/#16-redis","text":"\u901a\u8fc7\u547d\u4ee4 ping \u6267\u884c\u540e\uff0c\u4f1a\u5f97\u5230\u56de\u590d\u7ed3\u679c pong\u3002\u5982\u679c\u6ca1\u6709\u5f97\u5230 pong \u7684\u7ed3\u679c\u8bf4\u660e Redis \u6ca1\u6709\u6b63\u5e38\u8fde\u901a\u3002","title":"16. \u600e\u4e48\u6d4b\u8bd5 Redis \u7684\u8fde\u901a\u6027\uff1f"},{"location":"chap10/4Redis_int_all/#17-redis","text":"\u5728 MySQL \u4e2d\uff0c\u4e8b\u52a1\u662f\u6307\u4e00\u7ec4\u64cd\u4f5c\u4e2d\uff0c\u8981\u4e48\u5168\u90e8\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u6267\u884c\u3002 \u800c\u5728 Redis \u4e5f\u5b58\u5728\u4e8b\u52a1\u7684\u6982\u5ff5\u3002Redis \u7684\u4e8b\u52a1\u53ef\u4ee5\u4fdd\u8bc1\u4e00\u6b21\u6267\u884c\u591a\u4e2a\u547d\u4ee4\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u9694\u79bb\u64cd\u4f5c\uff0c\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u90fd\u4f1a\u5e8f\u5217\u5316\u3001\u6309\u987a\u5e8f\u5730\u6267\u884c\u3002\u670d\u52a1\u7aef\u5728\u6267\u884c\u4e8b\u52a1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u4f1a\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u53d1\u9001\u6765\u7684\u547d\u4ee4\u8bf7\u6c42\u6253\u65ad\u3002","title":"17. \u600e\u4e48\u7406\u89e3 Redis \u4e8b\u52a1\uff1f"},{"location":"chap10/4Redis_int_all/#18-redis","text":"Redis \u5ba2\u6237\u7aef\u548c Redis \u670d\u52a1\u5668\u901a\u4fe1\u65f6\u4f7f\u7528\u7684\u662f RESP\uff08Redis \u5e8f\u5217\u5316\u534f\u8bae\uff09\u901a\u8baf\u534f\u8bae\uff0c\u8be5\u534f\u8bae\u662f\u4e13\u95e8\u4e3a Redis \u8bbe\u8ba1\u7684\uff0c\u4f46\u662f\u4e5f\u53ef\u4ee5\u7528\u4e8e\u5176\u4ed6\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u8f6f\u4ef6\u9879\u76ee\u4e2d\u3002 RESP \u7684\u7279\u70b9\u4e3a\uff1a\u5b9e\u73b0\u7b80\u5355\u3001\u5feb\u901f\u89e3\u6790\u3001\u53ef\u8bfb\u6027\u597d\u3002","title":"18. Redis \u901a\u8baf\u534f\u8bae\u662f\u4ec0\u4e48\uff1f\u6709\u4ec0\u4e48\u7279\u70b9\uff1f"},{"location":"chap10/4Redis_int_all/#19-redis","text":"\u5355\u70b9 TPS \u8fbe\u5230 8 \u4e07/\u79d2\uff0cQPS \u8fbe\u5230 10 \u4e07/\u79d2\u3002TPS \u548c QPS \u7684\u610f\u601d\uff1a QPS\uff1a\u5e94\u7528\u7cfb\u7edf\u6bcf\u79d2\u949f\u6700\u5927\u80fd\u63a5\u53d7\u7684\u7528\u6237\u8bbf\u95ee\u91cf \u3002\u6bcf\u79d2\u949f\u5904\u7406\u5b8c\u8bf7\u6c42\u7684\u6b21\u6570\uff0c\u6ce8\u610f\u8fd9\u91cc\u662f\u5904\u7406\u5b8c\uff0c\u5177\u4f53\u662f\u6307\u53d1\u51fa\u8bf7\u6c42\u5230\u670d\u52a1\u5668\u5904\u7406\u5b8c\u6210\u529f\u8fd4\u56de\u7ed3\u679c\u3002\u53ef\u4ee5\u7406\u89e3\u5728 Server \u4e2d\u6709\u4e2a counter\uff0c\u6bcf\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\u52a0 1\uff0c1s \u540e counter=QPS \u3002 TPS\uff1a\u6bcf\u79d2\u949f\u6700\u5927\u80fd\u5904\u7406\u7684\u8bf7\u6c42\u6570 \u3002\u6bcf\u79d2\u949f\u5904\u7406\u5b8c\u7684\u4e8b\u52a1\u6b21\u6570\uff0c\u4e00\u4e2a\u5e94\u7528\u7cfb\u7edf 1s \u80fd\u5b8c\u6210\u591a\u5c11\u4e8b\u52a1\u5904\u7406\uff0c\u4e00\u4e2a\u4e8b\u52a1\u5728\u5206\u5e03\u5f0f\u5904\u7406\u4e2d\uff0c\u53ef\u80fd\u4f1a\u5bf9\u5e94\u591a\u4e2a\u8bf7\u6c42\uff0c\u5bf9\u4e8e\u8861\u91cf\u5355\u4e2a\u63a5\u53e3\u670d\u52a1\u7684\u5904\u7406\u80fd\u529b\uff0c\u7528 QPS \u6bd4\u8f83\u5408\u7406\u3002","title":"19. Redis \u5355\u70b9\u541e\u5410\u91cf\u6709\u591a\u5c11\uff1f"},{"location":"chap10/4Redis_int_all/#20-redis","text":"\u4f7f\u7528 pipeline\uff08\u7ba1\u9053\uff09\u7684\u597d\u5904\u5728\u4e8e\u53ef\u4ee5\u5c06\u591a\u6b21 I/O \u5f80\u8fd4\u7684\u65f6\u95f4\u7f29\u77ed\u4e3a\u4e00\u6b21\uff0c\u4f46\u662f\u8981\u6c42\u7ba1\u9053\u4e2d\u6267\u884c\u7684\u6307\u4ee4\u95f4\u6ca1\u6709\u56e0\u679c\u5173\u7cfb\u3002","title":"20. Redis \u4e2d\u7ba1\u9053\u6709\u4ec0\u4e48\u7528\uff1f"},{"location":"chap10/4Redis_int_all/#21-redis","text":"\u56e0\u4e3a Redis \u5728\u91cd\u542f\u624d\u80fd\u52a0\u8f7d\u914d\u7f6e\u9879\u4e2d\u7684\u914d\u7f6e\uff0c\u6240\u4ee5\u9700\u8981\u91cd\u542f\u624d\u80fd\u751f\u6548\u3002\u9488\u5bf9\u8fd0\u884c\u5b9e\u4f8b\uff0c\u6709\u8bb8\u591a\u914d\u7f6e\u9009\u9879\u53ef\u4ee5\u901a\u8fc7 CONFIG SET \u547d\u4ee4\u8fdb\u884c\u4fee\u6539\uff0c\u800c\u65e0\u9700\u6267\u884c\u4efb\u4f55\u5f62\u5f0f\u7684\u91cd\u542f\u3002 \u4ece Redis 2.2 \u5f00\u59cb\uff0c\u53ef\u4ee5\u4ece AOF \u5207\u6362\u5230 RDB \u7684\u5feb\u7167\u6301\u4e45\u6027\u6216\u5176\u4ed6\u65b9\u5f0f\u800c\u4e0d\u9700\u8981\u91cd\u542f Redis\u3002\u68c0\u7d22 'CONFIG GET *' \u547d\u4ee4\u83b7\u53d6\u66f4\u591a\u4fe1\u606f\u3002 \u4f46\u5076\u5c14\u91cd\u65b0\u542f\u52a8\u662f\u5fc5\u987b\u7684\uff0c\u5982\u4e3a\u5347\u7ea7 Redis \u7a0b\u5e8f\u5230\u65b0\u7684\u7248\u672c\uff0c\u6216\u8005\u5f53\u4f60\u9700\u8981\u4fee\u6539\u67d0\u4e9b\u76ee\u524d CONFIG \u547d\u4ee4\u8fd8\u4e0d\u652f\u6301\u7684\u914d\u7f6e\u53c2\u6570\u7684\u65f6\u5019\u3002","title":"21. \u4fee\u6539\u914d\u7f6e\u4e0d\u91cd\u542f Redis \u4f1a\u5b9e\u65f6\u751f\u6548\u5417\uff1f"},{"location":"chap10/4Redis_int_all/#22-redis","text":"\u5e38\u7528\u7684\u8bbe\u7f6e\u6709\uff1a 1. \u7aef\u53e3\u8bbe\u7f6e \u53ea\u5141\u8bb8\u4fe1\u4efb\u7684\u5ba2\u6237\u7aef\u53d1\u9001\u8fc7\u6765\u7684\u8bf7\u6c42\uff0c\u5bf9\u5176\u4ed6\u6240\u6709\u8bf7\u6c42\u90fd\u62d2\u7edd\u3002\u5982\u679c\u5b58\u5728\u66b4\u9732\u5728\u5916\u7f51\u7684\u670d\u52a1\uff0c\u90a3\u4e48\u9700\u8981\u4f7f\u7528\u9632\u706b\u5899\u963b\u6b62\u5916\u90e8\u8bbf\u95ee Redis \u7aef\u53e3\u3002 2. \u8eab\u4efd\u9a8c\u8bc1 \u4f7f\u7528 Redis \u63d0\u4f9b\u7684\u8eab\u4efd\u9a8c\u8bc1\u529f\u80fd\uff0c \u5728 redis.conf \u6587\u4ef6\u4e2d\u8fdb\u884c\u914d\u7f6e\u751f\u6548\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u53d1\u9001\uff08AUTH \u5bc6\u7801\uff09\u547d\u4ee4\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1 \u3002 3. \u7981\u7528\u7279\u5b9a\u7684\u547d\u4ee4\u96c6 \u53ef\u4ee5\u8003\u8651\u7981\u6b62\u4e00\u4e9b\u5bb9\u6613\u4ea7\u751f\u5b89\u5168\u95ee\u9898\u7684\u547d\u4ee4\uff0c\u9884\u9632\u88ab\u4eba\u6076\u610f\u64cd\u4f5c\u3002","title":"22. \u53ef\u4ee5\u4ecb\u7ecd\u4e00\u4e9b Redis \u5e38\u7528\u7684\u5b89\u5168\u8bbe\u7f6e\u5417\uff1f"},{"location":"chap10/4Redis_int_all/#23-redis","text":"\u53d1\u5e03\u8ba2\u9605\u662f\u4e00\u79cd\u6d88\u606f\u901a\u4fe1\u6a21\u5f0f\uff0c\u53d1\u9001\u8005\u53d1\u9001\u6d88\u606f\u5230\u67d0\u4e2a\u9891\u9053\uff0c\u8ba2\u9605\u4e86\u8be5\u9891\u9053\u7684\u7528\u6237\u90fd\u53ef\u4ee5\u63a5\u6536\u5230\u6d88\u606f\u3002\u8be5\u6a21\u5f0f\u7531\u53d1\u5e03\u8005\u3001\u63a5\u6536\u8005\u548c\u9891\u9053\u7ec4\u6210\u3002","title":"23. \u8bf7\u4ecb\u7ecd\u4e00\u4e0b Redis \u7684\u53d1\u5e03\u8ba2\u9605\u529f\u80fd"},{"location":"chap10/4Redis_int_all/#24-redis-pipeline","text":"\u5b83\u4eec\u4e3b\u8981\u7684\u4e0d\u540c\u6709\uff1a \u5b83\u4eec\u4e3b\u8981\u7684\u4e0d\u540c\u6709\uff1a \u539f\u5b50\u6027\u4e0d\u540c\uff1b\u6279\u91cf\u547d\u4ee4\u64cd\u4f5c\u9700\u8981\u4fdd\u8bc1\u539f\u5b50\u6027\u7684\uff0cPipeline \u6267\u884c\u662f\u975e\u539f\u5b50\u6027\u7684\uff1b \u652f\u6301\u7684\u547d\u4ee4\u4e0d\u540c\uff1b \u6279\u91cf\u547d\u4ee4\u64cd\u4f5c\u662f\u4e00\u4e2a\u547d\u4ee4\u5bf9\u5e94\u591a\u4e2a key\uff0cPipeline \u652f\u6301\u591a\u4e2a\u547d\u4ee4\u7684\u6267\u884c \uff1b \u5b9e\u73b0\u65b9\u5f0f\u7684\u4e0d\u540c\uff1b \u6279\u91cf\u547d\u4ee4\u64cd\u4f5c\u662f\u7531 Redis \u670d\u52a1\u7aef\u5b9e\u73b0\u7684\uff0c\u800c Pipeline \u662f\u9700\u8981\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u5171\u540c\u5b9e\u73b0\u7684 \u3002","title":"24. \u8bf7\u8bf4\u660e\u4e00\u4e0b Redis \u7684\u6279\u91cf\u547d\u4ee4\u4e0e Pipeline \u6709\u4ec0\u4e48\u4e0d\u540c\uff1f"},{"location":"chap10/4Redis_int_all/#25-redis-pipeline","text":"\u56e0\u4e3a Redis \u662f\u57fa\u4e8e TCP \u534f\u8bae\u7684\u8bf7\u6c42/\u54cd\u5e94\u670d\u52a1\u5668\uff0c \u6bcf\u6b21\u901a\u4fe1\u90fd\u9700\u8981\u7ecf\u8fc7 TCP \u534f\u8bae\u7684\u4e09\u6b21\u63e1\u624b\uff0c\u6240\u4ee5\u5f53\u9700\u8981\u6267\u884c\u7684\u547d\u4ee4\u8db3\u591f\u5927\u65f6\uff0c\u4f1a\u4ea7\u751f\u5f88\u5927\u7684\u7f51\u7edc\u5ef6\u8fdf \u3002 \u5e76\u4e14\u7f51\u7edc\u7684\u4f20\u8f93\u65f6\u95f4\u6210\u672c\u548c\u670d\u52a1\u5668\u5f00\u9500\u6ca1\u6709\u8ba1\u5165\u5176\u4e2d\uff0c\u603b\u7684\u5ef6\u8fdf\u53ef\u80fd\u66f4\u5927\u3002Pipeline \u4e3b\u8981\u5c31\u662f\u4e3a\u4e86\u89e3\u51b3\u5b58\u5728\u8fd9\u79cd\u60c5\u51b5\u7684\u573a\u666f\uff0c\u5bf9\u6b64\u5b58\u5728\u7c7b\u4f3c\u7684\u573a\u666f\u90fd\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 Pipeline\u3002 \u53ef\u4ee5\u9002\u7528\u573a\u666f\u6709\uff1a\u5982\u679c\u5b58\u5728\u6279\u91cf\u6570\u636e\u9700\u8981\u5199\u5165 Redis\uff0c\u5e76\u4e14\u8fd9\u4e9b\u6570\u636e\u5141\u8bb8\u4e00\u5b9a\u6bd4\u4f8b\u7684\u5199\u5165\u5931\u8d25\uff0c\u90a3\u4e48\u53ef\u4ee5\u4f7f\u7528 Pipeline\uff0c\u540e\u671f\u518d\u5bf9\u5931\u8d25\u7684\u6570\u636e\u8fdb\u884c\u8865\u507f\u5373\u53ef\u3002","title":"25. \u8bf7\u4ecb\u7ecd\u4e00\u4e0b Redis \u7684 Pipeline\uff08\u7ba1\u9053\uff09\uff0c\u4ee5\u53ca\u4f7f\u7528\u573a\u666f"},{"location":"chap10/4Redis_int_all/#26-redis","text":"\u4e3b\u8981\u5e38\u7528\u7684\u4e1a\u52a1\u573a\u666f\u6709\uff1a \u5bf9\u70ed\u70b9\u6570\u636e\u7684\u7f13\u5b58\uff1b\u56e0\u4e3a Redis \u652f\u6301\u591a\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u6570\u636e\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff0c\u8bbf\u95ee\u901f\u5ea6\u5757\uff0c\u6240\u4ee5 Redis \u5f88\u9002\u5408\u7528\u6765\u5b58\u50a8\u70ed\u70b9\u6570\u636e\uff1b \u9650\u65f6\u7c7b\u4e1a\u52a1\u7684\u5b9e\u73b0\uff1b\u53ef\u4ee5\u4f7f\u7528 expire \u547d\u4ee4\u8bbe\u7f6e key \u7684\u751f\u5b58\u65f6\u95f4\uff0c\u5230\u65f6\u95f4\u540e\u81ea\u52a8\u5220\u9664 key\u3002\u4f8b\u5982\u4f7f\u7528\u5728\u9a8c\u8bc1\u7801\u9a8c\u8bc1\u3001\u4f18\u60e0\u6d3b\u52a8\u7b49\u4e1a\u52a1\u573a\u666f\uff1b \u8ba1\u6570\u5668\u7684\u5b9e\u73b0\uff1b\u56e0\u4e3a incrby \u547d\u4ee4\u53ef\u4ee5\u5b9e\u73b0\u539f\u5b50\u6027\u7684\u9012\u589e\uff0c\u6240\u4ee5\u53ef\u4ee5\u8fd0\u7528\u4e8e\u9ad8\u5e76\u53d1\u7684\u79d2\u6740\u6d3b\u52a8\u3001\u5206\u5e03\u5f0f\u5e8f\u5217\u53f7\u7684\u751f\u6210\u3002\u4f8b\u5982\u9650\u5236\u4e00\u4e2a\u624b\u673a\u53f7\u53d1\u591a\u5c11\u6761\u77ed\u4fe1\u3001\u4e00\u4e2a\u63a5\u53e3\u4e00\u5206\u949f\u9650\u5236\u591a\u5c11\u8bf7\u6c42\u3001\u4e00\u4e2a\u63a5\u53e3\u4e00\u5929\u9650\u5236\u8c03\u7528\u591a\u5c11\u6b21\u7b49\u4e1a\u52a1\u573a\u666f\u3002 \u6392\u884c\u699c\u7684\u5b9e\u73b0\uff1b\u501f\u52a9 Sorted Set \u8fdb\u884c\u70ed\u70b9\u6570\u636e\u7684\u6392\u5e8f\u3002\u4f8b\u5982\uff1a\u4e0b\u5355\u91cf\u6700\u591a\u7684\u7528\u6237\u6392\u884c\u699c\uff0c\u6700\u70ed\u95e8\u7684\u5e16\u5b50\uff08\u56de\u590d\u6700\u591a\uff09\u7b49\u4e1a\u52a1\u573a\u666f\uff1b \u5206\u5e03\u5f0f\u9501\u5b9e\u73b0\uff1b\u53ef\u4ee5\u5229\u7528 Redis \u7684 setnx \u547d\u4ee4\u8fdb\u884c\u3002 \u961f\u5217\u673a\u5236\u5b9e\u73b0\uff1bRedis \u63d0\u4f9b\u4e86 list push \u548c list pop \u8fd9\u6837\u7684\u547d\u4ee4\uff0c\u6240\u4ee5\u80fd\u591f\u5f88\u65b9\u4fbf\u7684\u6267\u884c\u961f\u5217\u64cd\u4f5c\u3002","title":"26. Redis \u5e38\u7528\u7684\u4e1a\u52a1\u573a\u666f\u6709\u54ea\u4e9b\uff1f"},{"location":"chap10/4Redis_int_all/#27-redis","text":"\u9002\u7528\u7684\u573a\u666f\u6709\uff1a \u53ef\u4ee5\u5e94\u7528\u4e8e\u9ad8\u5e76\u53d1\u8bfb\u5199\u7684\u70ed\u6570\u636e\u4e2d \u6d77\u91cf\u6570\u636e\u7684\u8bfb\u5199 \u6570\u636e\u5904\u7406\u4e1a\u52a1\u590d\u6742\u548c\u5bf9\u5b89\u5168\u6027\u8981\u6c42\u8f83\u9ad8\u7684\u7cfb\u7edf \u6269\u5c55\u6027\u8981\u6c42\u9ad8\u7684\u6570\u636e\u4e2d","title":"27. Redis \u9002\u7528\u573a\u666f\u6709\u54ea\u4e9b\uff1f"},{"location":"chap10/4Redis_int_all/#redis-16","text":"","title":"\u4e8c\u3001Redis \u6570\u636e\u7ed3\u6784\u6307\u4ee4\uff0816 \u9898\uff09"},{"location":"chap10/4Redis_int_all/#1-redis_1","text":"\u5b57\u7b26\u4e32\u7c7b\u578b\u662f\u6700\u57fa\u672c\u7684\u6570\u636e\u7c7b\u578b\uff0c \u662f\u4e8c\u8fdb\u5236\u5b89\u5168\u7684\u5b57\u7b26\u4e32\uff0c\u6700\u5927 512M \u3002","title":"1. Redis \u7684\u4e00\u4e2a\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u503c\u80fd\u5b58\u50a8\u6700\u5927\u5bb9\u91cf\u662f\u591a\u5c11\uff1f"},{"location":"chap10/4Redis_int_all/#2-redis_1","text":"\u54c8\u5e0c\u7c7b\u578b\u64cd\u4f5c\u547d\u4ee4\u548c\u65b9\u6cd5\u4e3a\uff1a","title":"2. Redis \u5e38\u7528\u7684\u54c8\u5e0c\u547d\u4ee4\u6709\u54ea\u4e9b\uff1f"},{"location":"chap10/4Redis_int_all/#3-redis_1","text":"\u5b83\u4eec\u6700\u5927\u5b58\u50a8\u91cf\u5206\u522b\u4e3a\uff1a Strings \u7c7b\u578b\uff1a\u4e00\u4e2a String \u7c7b\u578b\u7684 value \u6700\u5927\u53ef\u4ee5\u5b58\u50a8 512M\uff1b List \u7c7b\u578b\uff1alist \u7684\u5143\u7d20\u4e2a\u6570\u6700\u591a\u4e3a 2^32-1 \u4e2a\uff0c\u4e5f\u5c31\u662f 429496729 5 \u4e2a\uff1b Sets \u7c7b\u578b\uff1a\u5143\u7d20\u4e2a\u6570\u6700\u591a\u4e3a 2^32-1 \u4e2a\uff0c\u4e5f\u5c31\u662f 4294967295 \u4e2a\uff1b Hashes \u7c7b\u578b\uff1a\u952e\u503c\u5bf9\u4e2a\u6570\u6700\u591a\u4e3a 2^32-1 \u4e2a\uff0c\u4e5f\u5c31\u662f 4294967295 \u4e2a\uff1b Sorted sets \u7c7b\u578b\uff1a\u8ddf Sets \u7c7b\u578b\u76f8\u4f3c\u3002\u5143\u7d20\u4e2a\u6570\u6700\u591a\u4e3a 2^32-1 \u4e2a\uff0c\u4e5f\u5c31\u662f 4294967295 \u4e2a\u3002","title":"3. Redis \u5404\u4e2a\u6570\u636e\u7c7b\u578b\u6700\u5927\u5b58\u50a8\u91cf\u5206\u522b\u662f\u591a\u5c11\uff1f"},{"location":"chap10/4Redis_int_all/#4-redis-sorted-setzset","text":"zset \u7684\u529f\u80fd\u548c sets \u7c7b\u4f3c\uff0c\u4f46\u662f\u5b83\u5728\u96c6\u5408\u5185\u7684\u5143\u7d20\u662f\u6709\u987a\u5e8f\uff0c\u4e0d\u80fd\u91cd\u590d\u7684 \u3002\u6240\u4ee5\u9002\u5408\u505a\u6392\u884c\u699c\u4e4b\u7c7b\u7684\u529f\u80fd\u3002 \u5b83\u5e95\u5c42\u5b9e\u73b0\u673a\u5236\u7684\u5b9e\u73b0\u65b9\u5f0f\u6709\u4e24\u79cd\uff0c \u5206\u522b\u4e3a ziplist\uff08\u538b\u7f29\u5217\u8868\uff09 \u6216\u8005 skiplist\uff08\u8df3\u8dc3\u8868\uff09 \u3002\u5b83\u4eec\u7684\u533a\u522b\u4e3a\uff1a \u5e95\u5c42\u4f7f\u7528\u7684\u6570\u636e\u7ed3\u6784\u5b9e\u73b0\u4e0d\u540c\uff1a ziplist \u7f16\u7801\u7684\u6709\u5e8f\u96c6\u5408\u5bf9\u8c61\u4f7f\u7528\u538b\u7f29\u5217\u8868\u4f5c\u4e3a\u5e95\u5c42\u5b9e\u73b0\uff0c\u800c skiplist \u7f16\u7801\u7684\u6709\u5e8f\u96c6\u5408\u5bf9\u8c61\u4f7f\u7528 zset \u7ed3\u6784\u4f5c\u4e3a\u5e95\u5c42\u5b9e\u73b0 \u3002 \u5e95\u5c42\u96c6\u5408\u5143\u7d20\u4fdd\u5b58\u7684\u65b9\u5f0f\u4e0d\u540c\uff1bziplist \u4e2d\u7684\u6bcf\u4e2a\u96c6\u5408\u5143\u7d20\u4f7f\u7528\u4e24\u4e2a\u7d27\u6328\u5728\u4e00\u8d77\u7684\u538b\u7f29\u5217\u8868\u8282\u70b9\u6765\u4fdd\u5b58\uff0c\u7b2c\u4e00\u4e2a\u8282\u70b9\u4fdd\u5b58\u5143\u7d20\u7684\u6210\u5458\uff0c\u7b2c\u4e8c\u4e2a\u8282\u70b9\u4fdd\u5b58\u5143\u7d20\u7684\u5206\u503c\u3002\u5e76\u4e14\u538b\u7f29\u5217\u8868\u5185\u7684\u96c6\u5408\u5143\u7d20\u6309\u5206\u503c\u4ece\u5c0f\u5230\u5927\u7684\u987a\u5e8f\u8fdb\u884c\u6392\u5217\uff0c\u5c0f\u7684\u653e\u7f6e\u5728\u9760\u8fd1\u8868\u5934\u7684\u4f4d\u7f6e\uff0c\u5927\u7684\u653e\u7f6e\u5728\u9760\u8fd1\u8868\u5c3e\u7684\u4f4d\u7f6e\u3002skiplist \u7684\u4e00\u4e2a zset \u7ed3\u6784\u540c\u65f6\u5305\u542b\u4e00\u4e2a\u5b57\u5178\u548c\u4e00\u4e2a\u8df3\u8dc3\u8868\u3002\u5b57\u5178\u7684\u952e\u4fdd\u5b58\u5143\u7d20\u7684\u503c\uff0c\u5b57\u5178\u7684\u503c\u5219\u4fdd\u5b58\u5143\u7d20\u7684\u5206\u503c\uff1b\u8df3\u8dc3\u8868\u8282\u70b9\u7684 object \u5c5e\u6027\u4fdd\u5b58\u5143\u7d20\u7684\u6210\u5458\uff0c\u8df3\u8dc3\u8868\u8282\u70b9\u7684 score \u5c5e\u6027\u4fdd\u5b58\u5143\u7d20\u7684\u5206\u503c\u3002 \u5f53\u6709\u5e8f\u96c6\u5408\u5bf9\u8c61\u4fdd\u5b58\u7684\u5143\u7d20\u6570\u91cf\u5c0f\u4e8e 128 \u4e2a\uff0c\u5e76\u4e14\u4fdd\u5b58\u7684\u6240\u6709\u5143\u7d20\u957f\u5ea6\u90fd\u5c0f\u4e8e 64 \u5b57\u8282\u65f6\uff0c\u5bf9\u8c61\u4f7f\u7528 ziplist \u7f16\u7801\u3002\u5426\u5219\u4f7f\u7528 skiplist \u7f16\u7801\u3002","title":"4. \u8bf7\u4ecb\u7ecd\u4e00\u4e0b Redis \u7684\u6570\u636e\u7c7b\u578b Sorted Set\uff08zset\uff09\u4ee5\u53ca\u5e95\u5c42\u5b9e\u73b0\u673a\u5236\uff1f"},{"location":"chap10/4Redis_int_all/#5-redis","text":"\u4e8b\u52a1\u4ece\u5f00\u59cb\u5230\u6267\u884c\u4f1a\u7ecf\u5386\u7684\u4e09\u4e2a\u9636\u6bb5\uff1a \u5f00\u59cb\u4e8b\u52a1\u3001\u547d\u4ee4\u5165\u961f\u3001 \u6267\u884c\u4e8b\u52a1 \u3002 \u5b83\u4ee5 MULTI \u5f00\u59cb\u4e00\u4e2a\u4e8b\u52a1\uff0c\u7136\u540e\u8ba9\u591a\u4e2a\u547d\u4ee4\u5165\u961f\u5230\u4e8b\u52a1\u4e2d\uff0c \u6700\u540e\u901a\u8fc7\u547d\u4ee4 EXEC \u89e6\u53d1\u6267\u884c\u4e8b\u52a1 \u3002\u5b83\u4eec\u7684\u6267\u884c\u547d\u4ee4\u6709\uff1a","title":"5. Redis \u4e8b\u52a1\u76f8\u5173\u7684\u547d\u4ee4\u6709\u54ea\u51e0\u4e2a\uff1f"},{"location":"chap10/4Redis_int_all/#6-redis-key","text":"\u53ef\u4ee5\u4f7f\u7528 EXPIRE \u548c PERSIST \u547d\u4ee4\u3002 \u5bf9\u4e00\u4e2a\u5df2\u7ecf\u5e26\u6709\u751f\u5b58\u65f6\u95f4\u7684 key \u6267\u884c EXPIRE \u547d\u4ee4\uff0c\u65b0\u6307\u5b9a\u7684\u751f\u5b58\u65f6\u95f4\u4f1a\u53d6\u4ee3\u65e7\u7684\u751f\u5b58\u65f6\u95f4\u3002 PERSIST \u547d\u4ee4\u53ef\u4ee5\u79fb\u9664\u7ed9\u5b9a key \u7684\u751f\u5b58\u65f6\u95f4\uff0c\u5c06\u8fd9\u4e2a key \u4ece\u5e26\u751f\u5b58\u65f6\u95f4\u8f6c\u6362\u6210\u6301\u4e45\u7684\u3002","title":"6. Redis key \u7684\u8fc7\u671f\u65f6\u95f4\u548c\u6c38\u4e45\u6709\u6548\u5206\u522b\u600e\u4e48\u8bbe\u7f6e\uff1f"},{"location":"chap10/4Redis_int_all/#7-redis-keyslistsetsorted-set","text":"Redis \u5b9e\u4f8b\u6700\u591a\u53ef\u4ee5\u5b58\u653e 2 \u7684 32 \u6b21\u65b9 -1 \u4e2a keys\uff0c\u53ea\u8981 Redis \u7684\u5185\u5b58\u7a7a\u95f4\u8db3\u591f\u53ef\u4ee5\u652f\u6301\uff0c\u4efb\u4f55\u7684 list\u3001set\u3001sorted set \u90fd\u53ef\u4ee5\u653e 2^32 -1 \u4e2a\u5143\u7d20\u3002","title":"7. \u4e00\u4e2a Redis \u5b9e\u4f8b\u6700\u591a\u80fd\u5b58\u653e\u591a\u5c11\u7684 keys\uff1fList\u3001Set\u3001Sorted Set \u4ed6\u4eec\u6700\u591a\u80fd\u5b58\u653e\u591a\u5c11\u5143\u7d20\uff1f"},{"location":"chap10/4Redis_int_all/#8-redis_1","text":"Redis \u652f\u6301\u7684\u6570\u636e\u7ed3\u6784\u4e3b\u8981\u6709\uff1a\u5b57\u7b26\u4e32\uff08string\uff09\u3001\u54c8\u5e0c\uff08Hash\uff09\u3001\u5217\u8868\uff08List\uff09\u3001\u96c6\u5408\uff08Set\uff09\u3001\u6709\u5e8f\u96c6\u5408\uff08Sorted set\uff09\u7b49\u4e94\u79cd\u6570\u636e\u7ed3\u6784\u7c7b\u578b\u3002","title":"8. Redis \u652f\u6301\u54ea\u51e0\u79cd\u6570\u636e\u7ed3\u6784\uff1f"},{"location":"chap10/4Redis_int_all/#9-redis-redis-redis","text":"\u8bbe\u7f6e Redis \u7684\u6700\u5927\u8fde\u63a5\u6570\u7684\u547d\u4ee4\u4e3a\uff1a redis-server -maxclients 100000\uff08\u8fde\u63a5\u6570\uff09; \u67e5\u770b Redis \u6700\u5927\u8fde\u63a5\u6570\u7684\u547d\u4ee4\u4e3a\uff1a config get maxclients \u67e5\u770b Redis \u8fde\u63a5\u6570\u7684\u547d\u4ee4\u4e3a\uff1a info \u547d\u4ee4 \u5728 redis-cli \u4e2d\u8f93\u5165 info \u547d\u4ee4\u5373\u53ef\u67e5\u770b\u3002","title":"9. \u5982\u4f55\u8bbe\u7f6e Redis \u7684\u6700\u5927\u8fde\u63a5\u6570\uff1f\u67e5\u770b Redis \u7684\u6700\u5927\u8fde\u63a5\u6570\uff1f\u67e5\u770b Redis \u7684\u5f53\u524d\u8fde\u63a5\u6570\uff1f"},{"location":"chap10/4Redis_int_all/#10-redis_1","text":"Redis \u63d0\u4f9b\u4e86\u8fc7\u671f\u65f6\u95f4\u5904\u7406\u51fd\u6570\uff0c\u53ef\u4ee5\u5bf9\u6307\u5b9a\u7684\u952e\u540d\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002\u5982\u679c\u5bf9\u952e\u540d\u4e0d\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u4e5f\u53ef\u4ee5\u4f7f\u7528 DEL \u51fd\u6570\u5bf9\u6570\u636e\u8fdb\u884c\u5220\u9664\u3002 \u5f53\u7528\u6237\u5bf9\u4e00\u4e2a\u952e\u540d\u8bbe\u7f6e\u4e86\u751f\u6548\u65f6\u95f4\uff0c\u6211\u4eec\u53ef\u4ee5\u8bf4\u8fd9\u4e2a\u952e\u540d\u5b58\u5728\u201c\u751f\u5b58\u65f6\u95f4\u201d\u6216\u201c\u5728\u6307\u5b9a\u65f6\u95f4\u540e\u8fc7\u671f\u201d\u3002\u5bf9\u952e\u540d\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u53ef\u4ee5\u6709\u6548\u5730\u91ca\u653e\u952e\u540d\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5728\u5b9e\u9645\u7684\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u662f\u975e\u5e38\u63d0\u5021\u7684\u4e00\u79cd\u505a\u6cd5\u3002\u76f8\u5173\u547d\u4ee4\u5982\u4e0b\uff1a","title":"10. Redis \u8bbe\u7f6e\u952e\u7684\u751f\u5b58\u65f6\u95f4\u548c\u8fc7\u671f\u65f6\u95f4\u6709\u54ea\u4e9b\u547d\u4ee4\uff1f"},{"location":"chap10/4Redis_int_all/#11-redis-string-ssd","text":"SDS \u5b9e\u73b0\u65b9\u5f0f\u76f8\u5bf9 C \u8bed\u8a00\u7684 String \u7684\u597d\u5904\u6709\uff1a \u907f\u514d\u7f13\u51b2\u533a\u6ea2\u51fa\uff1b\u5bf9\u5b57\u7b26\u4fee\u6539\u65f6\uff0c\u53ef\u4ee5\u6839\u636e len \u5c5e\u6027\u68c0\u67e5\u7a7a\u95f4\u662f\u5426\u6ee1\u8db3\u8981\u6c42\u3002 \u5e38\u6570\u590d\u6742\u5ea6\u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6 \uff1b\u83b7\u53d6\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u76f4\u63a5\u8bfb\u53d6 len \u5c5e\u6027\u5c31\u53ef\u4ee5\u83b7\u53d6\u3002\u800c C \u8bed\u8a00\u4e2d\uff0c\u56e0\u4e3a\u5b57\u7b26\u4e32\u662f\u7b80\u5355\u7684\u5b57\u7b26\u6570\u7ec4\uff0c\u6c42\u957f\u5ea6\u65f6\u5185\u90e8\u5176\u5b9e\u662f\u76f4\u63a5\u987a\u5e8f\u904d\u5386\u6570\u7ec4\u5185\u5bb9\uff0c\u627e\u5230 '\\0' \u5bf9\u5e94\u7684\u5b57\u7b26\uff0c\u8ba1\u7b97\u51fa\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u3002\u590d\u6742\u5ea6\u5373 O(N)\u3002 \u51cf\u5c11\u5185\u5b58\u5206\u914d\u6b21\u6570 \uff1b\u901a\u8fc7\u7ed3\u6784\u4e2d\u7684 len \u548c free \u4e24\u4e2a\u5c5e\u6027\uff0c\u66f4\u597d\u7684\u534f\u52a9\u7a7a\u95f4\u9884\u5206\u914d\u4ee5\u53ca\u60f0\u6027\u7a7a\u95f4\u91ca\u653e\u3002 \u4e8c\u8fdb\u5236\u5b89\u5168 \uff1bSSD \u4e0d\u662f\u4ee5\u7a7a\u5b57\u7b26\u4e32\u6765\u5224\u65ad\u662f\u5426\u7ed3\u675f\uff0c\u800c\u662f\u4ee5 len \u5c5e\u6027\u6765\u5224\u65ad\u5b57\u7b26\u4e32\u662f\u5426\u7ed3\u675f\u3002\u800c\u5728 C \u8bed\u8a00\u4e2d\uff0c\u5b57\u7b26\u4e32\u8981\u6c42\u9664\u4e86\u672b\u5c3e\u4e4b\u5916\u4e0d\u80fd\u51fa\u73b0\u7a7a\u5b57\u7b26\uff0c\u5426\u5219\u4f1a\u88ab\u7a0b\u5e8f\u8ba4\u4e3a\u662f\u5b57\u7b26\u4e32\u7684\u7ed3\u5c3e\u3002\u8fd9\u5c31\u4f7f\u5f97 C \u5b57\u7b26\u4e32\u53ea\u80fd\u5b58\u50a8\u6587\u672c\u6570\u636e\uff0c\u800c\u4e0d\u80fd\u4fdd\u5b58\u56fe\u50cf\uff0c\u97f3\u9891\u7b49\u4e8c\u8fdb\u5236\u6570\u636e\u3002 \u517c\u5bb9 C \u5b57\u7b26\u4e32\u51fd\u6570 \uff1b\u53ef\u4ee5\u91cd\u7528 C \u8bed\u8a00\u5e93\u7684 \u7684\u4e00\u90e8\u5206\u51fd\u6570\u3002 \u4ee5\u4e0a\u51e0\u70b9\u597d\u5904\u53ef\u4ee5\u6982\u62ec\u5982\u4e0b\uff1a","title":"11. Redis \u7684 String \u7c7b\u578b\u4f7f\u7528 SSD \u65b9\u5f0f\u5b9e\u73b0\u7684\u597d\u5904\uff1f"},{"location":"chap10/4Redis_int_all/#12-redis-string","text":"Redis \u5e95\u5c42\u5b9e\u73b0\u4e86\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\u7684\u7c7b\u578b\uff08SDS\uff09\uff0c\u6765\u8868\u793a String \u7c7b\u578b\u3002\u6ca1\u6709\u76f4\u63a5\u4f7f\u7528 C \u8bed\u8a00\u5b9a\u4e49\u7684\u5b57\u7b26\u4e32\u7c7b\u578b\u3002 Redis \u5e95\u5c42\u4f7f\u7528\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\uff08simple dynamic string\uff0cSDS\uff09\u7684\u62bd\u8c61\u7c7b\u578b\u5b9e\u73b0\u7684\u3002\u9ed8\u8ba4\u4ee5 SDS \u4f5c\u4e3a\u81ea\u5df1\u7684\u5b57\u7b26\u4e32\u8868\u793a\u3002\u800c\u6ca1\u6709\u76f4\u63a5\u4f7f\u7528 C \u8bed\u8a00\u5b9a\u4e49\u7684\u5b57\u7b26\u4e32\u7c7b\u578b\u3002 SDS \u7684\u5b9a\u4e49\u683c\u5f0f\u5982\u4e0b\uff1a struct sdshdr{ //\u8bb0\u5f55 buf \u6570\u7ec4\u4e2d\u5df2\u4f7f\u7528\u5b57\u8282\u7684\u6570\u91cf //\u7b49\u4e8e SDS \u4fdd\u5b58\u5b57\u7b26\u4e32\u7684\u957f\u5ea6 int len; //\u8bb0\u5f55 buf \u6570\u7ec4\u4e2d\u672a\u4f7f\u7528\u5b57\u8282\u7684\u6570\u91cf int free; //\u5b57\u8282\u6570\u7ec4\uff0c\u7528\u4e8e\u4fdd\u5b58\u5b57\u7b26\u4e32 char buf[]; //buf\u7684\u5927\u5c0f\u7b49\u4e8elen+free+1\uff0c\u5176\u4e2d\u591a\u4f59\u76841\u4e2a\u5b57\u8282\u662f\u7528\u6765\u5b58\u50a8\u2018\\0\u2019\u7684\u3002 } SDS \u7684\u5b58\u50a8\u793a\u4f8b\u5982\u4e0b\uff1a","title":"12. \u8bf7\u4ecb\u7ecd\u4e00\u4e0b Redis \u7684 String \u7c7b\u578b\u5e95\u5c42\u5b9e\u73b0\uff1f"},{"location":"chap10/4Redis_int_all/#13-redis_1","text":"\u5177\u6709\u4ee5\u4e0b\u7279\u5f81\uff1a \u901a\u8fc7 len \u5c5e\u6027\u6765\u8bb0\u5f55\u94fe\u8868\u957f\u5ea6\uff1b \u94fe\u8868\u7684\u6700\u524d\u548c\u6700\u540e\u8282\u70b9\u90fd\u6709\u5f15\u7528\uff0c\u83b7\u53d6\u524d\u540e\u8282\u70b9\u7684\u590d\u6742\u5ea6\u90fd\u4e3a O(1)\uff1b \u5bf9\u94fe\u8868\u7684\u8bbf\u95ee\u90fd\u662f\u4ee5 null \u7ed3\u675f\u3002","title":"13. Redis \u7684\u94fe\u8868\u6570\u636e\u7ed3\u6784\u7684\u7279\u5f81\u6709\u54ea\u4e9b\uff1f"},{"location":"chap10/4Redis_int_all/#14-redis_1","text":"\u5185\u5b58\u6d88\u8017\u53ef\u4ee5\u5206\u7c7b\u4e3a\uff1a \u5bf9\u8c61\u5185\u5b58\uff1a\u8be5\u5185\u5b58\u5360\u7528\u6700\u5927\uff0c\u5b58\u50a8\u7528\u6237\u7684\u6240\u6709\u6570\u636e\u3002\u5305\u62ec\u6240\u6709 key \u7684\u5927\u5c0f\u548c value \u7684\u5927\u5c0f \u3002 \u7f13\u51b2\u5185\u5b58\uff1a\u4e3b\u8981\u6709\u5ba2\u6237\u7aef\u7f13\u5b58\u3001\u590d\u5236\u79ef\u538b\u7f13\u5b58\u3001AOF \u7f13\u5b58\u7b49\uff1b \u5185\u5b58\u788e\u7247\uff1a\u5bf9 key \u6570\u636e\u66f4\u65b0\uff0c\u6570\u636e\u8fc7\u671f\u7b49\u90fd\u53ef\u80fd\u4ea7\u751f\u5185\u5b58\u788e\u7247 \u3002","title":"14. Redis \u7684\u5185\u5b58\u6d88\u8017\u5206\u7c7b\u6709\u54ea\u4e9b\uff1f\u5185\u5b58\u7edf\u8ba1\u4f7f\u7528\u4ec0\u4e48\u547d\u4ee4\uff1f"},{"location":"chap10/4Redis_int_all/#15-bigkey","text":"\u53ef\u4ee5\u4f7f\u7528 redis-cli \u2013bigkeys \u547d\u4ee4\u7edf\u8ba1 bigkey \u7684\u5206\u5e03\u3002 \u4e5f\u53ef\u4ee5\u5728\u751f\u4ea7\u73af\u8282\u4e0b\u6267\u884c debug object key \u547d\u4ee4\u67e5\u770b serializedlength \u5c5e\u6027\uff0c\u83b7\u5f97 key \u5bf9\u5e94\u7684 value \u5e8f\u5217\u5316\u4e4b\u540e\u7684\u5b57\u8282\u6570\u3002","title":"15. \u600e\u4e48\u53d1\u73b0 bigkey?"},{"location":"chap10/4Redis_int_all/#16-bigkey","text":"bigkey \u662f\u6307\u952e\u503c\u5360\u7528\u5185\u5b58\u7a7a\u95f4\u975e\u5e38\u5927\u7684 key\u3002\u4f8b\u5982\u4e00\u4e2a\u5b57\u7b26\u4e32 a \u5b58\u50a8\u4e86 200M \u7684\u6570\u636e \u3002 bigkey \u7684\u4e3b\u8981\u5f71\u54cd\u6709\uff1a \u7f51\u7edc\u963b\u585e \uff1b\u83b7\u53d6 bigkey \u65f6\uff0c\u4f20\u8f93\u7684\u6570\u636e\u91cf\u6bd4\u8f83\u5927\uff0c\u4f1a\u589e\u52a0\u5e26\u5bbd\u7684\u538b\u529b\u3002 \u8d85\u65f6\u963b\u585e \uff1b\u56e0\u4e3a bigkey \u5360\u7528\u7684\u7a7a\u95f4\u6bd4\u8f83\u5927\uff0c\u6240\u4ee5\u64cd\u4f5c\u8d77\u6765\u6548\u7387\u4f1a\u6bd4\u8f83\u4f4e\uff0c\u5bfc\u81f4\u51fa\u73b0\u963b\u585e\u7684\u53ef\u80fd\u6027\u589e\u52a0\u3002 \u5bfc\u81f4\u5185\u5b58\u7a7a\u95f4\u4e0d\u5e73\u8861\uff1b\u4e00\u4e2a bigkey \u5b58\u50a8\u6570\u636e\u91cf\u6bd4\u8f83\u5927\uff0c\u540c\u4e00\u4e2a key \u5728\u540c\u4e00\u4e2a\u8282\u70b9\u6216\u670d\u52a1\u5668\u4e2d\u5b58\u50a8\uff0c\u4f1a\u9020\u6210\u4e00\u5b9a\u5f71\u54cd\u3002","title":"16. \u4ec0\u4e48\u662f bigkey\uff1f\u6709\u4ec0\u4e48\u5f71\u54cd\uff1f"},{"location":"chap10/4Redis_int_all/#21","text":"","title":"\u4e09\u3001\u9ad8\u5e76\u53d1\u5904\u7406\uff0821 \u9898\uff09"},{"location":"chap10/4Redis_int_all/#1-redis_2","text":"Redis \u5e38\u89c1\u6027\u80fd\u95ee\u9898\u548c\u89e3\u51b3\u65b9\u6848\u5982\u4e0b\uff1a Master \u6700\u597d\u4e0d\u8981\u505a\u4efb\u4f55\u6301\u4e45\u5316\u5de5\u4f5c\uff0c \u5982 RDB \u5185\u5b58\u5feb\u7167\u548c AOF \u65e5\u5fd7\u6587\u4ef6 \uff1b \u5982\u679c\u6570\u636e\u6bd4\u8f83\u91cd\u8981\uff0c\u67d0\u4e2a Slave \u5f00\u542f AOF \u5907\u4efd\u6570\u636e\uff0c\u7b56\u7565\u8bbe\u7f6e\u4e3a\u6bcf\u79d2\u540c\u6b65\u4e00\u6b21\uff1b \u4e3a\u4e86\u4e3b\u4ece\u590d\u5236\u7684\u901f\u5ea6\u548c\u8fde\u63a5\u7684\u7a33\u5b9a\u6027\uff0cMaster \u548c Slave \u6700\u597d\u5728\u540c\u4e00\u4e2a\u5c40\u57df\u7f51\u5185 \uff1b \u5c3d\u91cf\u907f\u514d\u5728\u538b\u529b\u5f88\u5927\u7684\u4e3b\u5e93\u4e0a\u589e\u52a0\u4ece\u5e93\uff1b \u4e3b \u4ece\u590d\u5236\u4e0d\u8981\u7528\u56fe\u72b6\u7ed3\u6784\uff0c\u7528\u5355\u5411\u94fe\u8868\u7ed3\u6784\u66f4\u4e3a\u7a33\u5b9a \uff0c\u5373\uff1a Master <- Slave1 <- Slave2 <- Slave3\u2026.\uff1b \u8fd9\u6837\u7684\u7ed3\u6784\u65b9\u4fbf\u89e3\u51b3\u5355\u70b9\u6545\u969c\u95ee\u9898\uff0c\u5b9e\u73b0 Slave \u5bf9 Master \u7684\u66ff\u6362\u3002\u5982\u679c Master \u6302\u4e86\uff0c\u53ef\u4ee5\u7acb\u523b\u542f\u7528 Slave1 \u505a Master\uff0c\u5176\u4ed6\u4e0d\u53d8\u3002","title":"1. Redis \u5e38\u89c1\u6027\u80fd\u95ee\u9898\u548c\u89e3\u51b3\u65b9\u6848\u6709\u54ea\u4e9b\uff1f"},{"location":"chap10/4Redis_int_all/#2-mysql-2000w-redis-20w-redis","text":"\u56e0\u4e3a\u5185\u5b58\u7684\u7a7a\u95f4\u662f\u6709\u9650\u7684\uff0c\u6240\u4ee5 Redis \u6dd8\u6c70\u673a\u5236\u4e3b\u8981\u4e3a\u4e86\u89e3\u51b3\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\uff0cRedis \u4e2d\u5b58\u5728\u5f88\u591a\u8fc7\u671f\u952e\uff0c\u5b9a\u671f\u5220\u9664\u7b56\u7565\u968f\u673a\u62bd\u67e5\u65f6\u6ca1\u6709\u62bd\u67e5\u5230\uff0c\u5e76\u4e14\u4e5f\u6ca1\u6709\u8d70\u60f0\u6027\u5220\u9664\u7b56\u7565\u65f6\uff0c\u5927\u91cf\u8fc7\u671f\u952e\u5360\u7528\u5185\u5b58\u7684\u95ee\u9898\u3002 \u5982\u679c\u5185\u5b58\u53ea\u80fd\u5b58 20w \u6570\u636e\uff0c\u800c\u6211\u4eec\u9700\u8981\u5b58\u50a8 2000w \u7684\u6570\u636e\u65f6\uff0c \u81ea\u7136\u5c31\u9700\u8981\u5bf9\u591a\u51fa\u6765\u7684\u6570\u636e\u8fdb\u884c\u5220\u9664\u6216\u8986\u76d6\uff0c\u4fdd\u8bc1\u5185\u5b58\u4e2d\u5b58\u50a8\u7684\u6570\u636e\u90fd\u662f\u70ed\u6570\u636e \u3002 \u6240\u4ee5\u5f53 Redis \u5185\u5b58\u6570\u636e\u96c6\u7684\u5927\u5c0f\u4e0a\u5347\u5230\u4e00\u5b9a\u6570\u91cf\u65f6\uff0c\u5c31\u4f1a\u6267\u884c\u6570\u636e\u6dd8\u6c70\u7b56\u7565\u3002","title":"2. MySQL \u91cc\u6709 2000w \u6570\u636e\uff0cRedis \u4e2d\u53ea\u5b58 20w \u7684\u6570\u636e\uff0c\u5982\u4f55\u4fdd\u8bc1 Redis \u4e2d\u7684\u6570\u636e\u90fd\u662f\u70ed\u70b9\u6570\u636e\uff1f"},{"location":"chap10/4Redis_int_all/#3-redis-1-key-10w-key","text":"\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 keys \u547d\u4ee4\u548c scan \u547d\u4ee4 \uff0c\u4f46\u662f\u4f1a\u53d1\u73b0\u4f7f\u7528 scan \u66f4\u597d\u3002 1. \u4f7f\u7528 keys \u547d\u4ee4 \u76f4\u63a5\u4f7f\u7528 keys \u547d\u4ee4\u67e5\u8be2\uff0c\u4f46\u662f\u5982\u679c\u662f\u5728\u751f\u4ea7\u73af\u5883\u4e0b\u4f7f\u7528\u4f1a\u51fa\u73b0\u4e00\u4e2a\u95ee\u9898\uff0ckeys \u547d\u4ee4\u662f\u904d\u5386\u67e5\u8be2\u7684\uff0c\u67e5\u8be2\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(n)\uff0c\u6570\u636e\u91cf\u8d8a\u5927\u67e5\u8be2\u65f6\u95f4\u8d8a\u957f\u3002 \u800c\u4e14 Redis \u662f\u5355\u7ebf\u7a0b\uff0ckeys \u6307\u4ee4\u4f1a\u5bfc\u81f4\u7ebf\u7a0b\u963b\u585e\u4e00\u6bb5\u65f6\u95f4\uff0c\u4f1a\u5bfc\u81f4\u7ebf\u4e0a Redis \u505c\u987f\u4e00\u6bb5\u65f6\u95f4\uff0c\u76f4\u5230 keys \u6267\u884c\u5b8c\u6bd5\u624d\u80fd\u6062\u590d\u3002\u8fd9\u5728\u751f\u4ea7\u73af\u5883\u662f\u4e0d\u5141\u8bb8\u7684\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u4e2a\u547d\u4ee4\u6ca1\u6709\u5206\u9875\u529f\u80fd\uff0c\u4f1a\u4e00\u6b21\u6027\u67e5\u8be2\u51fa\u6240\u6709\u7b26\u5408\u6761\u4ef6\u7684 key \u503c\uff0c\u4f1a\u53d1\u73b0\u67e5\u8be2\u7ed3\u679c\u975e\u5e38\u5927\uff0c\u8f93\u51fa\u7684\u4fe1\u606f\u975e\u5e38\u591a\u3002\u6240\u4ee5\u4e0d\u63a8\u8350\u4f7f\u7528\u8fd9\u4e2a\u547d\u4ee4\u3002 2. \u4f7f\u7528 scan \u547d\u4ee4 scan \u547d\u4ee4\u53ef\u4ee5\u5b9e\u73b0\u548c keys \u4e00\u6837\u7684\u5339\u914d\u529f\u80fd\uff0c\u4f46\u662f scan \u547d\u4ee4\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e0d\u4f1a\u963b\u585e\u7ebf\u7a0b\uff0c\u5e76\u4e14\u67e5\u627e\u7684\u6570\u636e\u53ef\u80fd\u5b58\u5728\u91cd\u590d\uff0c\u9700\u8981\u5ba2\u6237\u7aef\u64cd\u4f5c\u53bb\u91cd\u3002\u56e0\u4e3a scan \u662f\u901a\u8fc7\u6e38\u6807\u65b9\u5f0f\u67e5\u8be2\u7684\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5bfc\u81f4 Redis \u51fa\u73b0\u5047\u6b7b\u7684\u95ee\u9898\u3002 Redis \u67e5\u8be2\u8fc7\u7a0b\u4e2d\u4f1a\u628a\u6e38\u6807\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u5355\u6b21\u8fd4\u56de\u7a7a\u503c\u4e14\u6e38\u6807\u4e0d\u4e3a 0\uff0c\u5219\u8bf4\u660e\u904d\u5386\u8fd8\u6ca1\u7ed3\u675f\uff0c\u5ba2\u6237\u7aef\u7ee7\u7eed\u904d\u5386\u67e5\u8be2\u3002scan \u5728\u68c0\u7d22\u7684\u8fc7\u7a0b\u4e2d\uff0c\u88ab\u5220\u9664\u7684\u5143\u7d20\u662f\u4e0d\u4f1a\u88ab\u67e5\u8be2\u51fa\u6765\u7684\uff0c\u4f46\u662f\u5982\u679c\u5728\u8fed\u4ee3\u8fc7\u7a0b\u4e2d\u6709\u5143\u7d20\u88ab\u4fee\u6539\uff0cscan \u4e0d\u80fd\u4fdd\u8bc1\u67e5\u8be2\u51fa\u5bf9\u5e94\u5143\u7d20\u3002\u76f8\u5bf9\u6765\u8bf4\uff0cscan \u6307\u4ee4\u67e5\u627e\u82b1\u8d39\u7684\u65f6\u95f4\u4f1a\u6bd4 keys \u6307\u4ee4\u957f\u3002","title":"3. \u5047\u5982 Redis \u91cc\u9762\u6709 1 \u4ebf\u4e2a key\uff0c\u5176\u4e2d\u6709 10w \u4e2a key \u662f\u4ee5\u67d0\u4e2a\u56fa\u5b9a\u7684\u5df2\u77e5\u7684\u524d\u7f00\u5f00\u5934\u7684\uff0c\u5982\u679c\u5c06\u5b83\u4eec\u5168\u90e8\u627e\u51fa\u6765\uff1f"},{"location":"chap10/4Redis_int_all/#4_1","text":"\u5927\u91cf\u7684\u8bf7\u6c42\u77ac\u65f6\u6d8c\u5165\u7cfb\u7edf\uff0c\u800c\u8fd9\u4e2a\u6570\u636e\u5728 Redis \u4e2d\u4e0d\u5b58\u5728\uff0c\u6240\u6709\u7684\u8bf7\u6c42\u90fd\u843d\u5230\u4e86\u6570\u636e\u5e93\u4e0a\u628a\u6570\u636e\u5e93\u6253\u6b7b \u3002 \u9020\u6210\u8fd9\u79cd\u60c5\u51b5\u7684\u539f\u56e0\u6709\u7cfb\u7edf\u8bbe\u8ba1\u4e0d\u5408\u7406\u3001\u7f13\u5b58\u6570\u636e\u66f4\u65b0\u4e0d\u53ca\u65f6\uff0c\u6216\u722c\u866b\u7b49\u6076\u610f\u653b\u51fb \u3002 \u89e3\u51b3\u529e\u6cd5\u6709\uff1a 1. \u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668 \u5c06\u67e5\u8be2\u7684\u53c2\u6570\u90fd\u5b58\u50a8\u5230\u4e00\u4e2a bitmap \u4e2d\uff0c\u5728\u67e5\u8be2\u7f13\u5b58\u524d\uff0c\u518d\u627e\u4e2a\u65b0\u7684 bitmap\uff0c\u5728\u91cc\u9762\u5bf9\u53c2\u6570\u8fdb\u884c\u9a8c\u8bc1\u3002\u5982\u679c\u9a8c\u8bc1\u7684 bitmap \u4e2d\u5b58\u5728\uff0c\u5219\u8fdb\u884c\u5e95\u5c42\u7f13\u5b58\u7684\u6570\u636e\u67e5\u8be2\uff0c\u5982\u679c bitmap \u4e2d\u4e0d\u5b58\u5728\u67e5\u8be2\u53c2\u6570\uff0c\u5219\u8fdb\u884c\u62e6\u622a\uff0c\u4e0d\u518d\u8fdb\u884c\u7f13\u5b58\u7684\u6570\u636e\u67e5\u8be2\u3002 2. \u7f13\u5b58\u7a7a\u5bf9\u8c61 \u5982\u679c\u4ece\u6570\u636e\u5e93\u67e5\u8be2\u7684\u7ed3\u679c\u4e3a\u7a7a\uff0c\u4f9d\u7136\u628a\u8fd9\u4e2a\u7ed3\u679c\u8fdb\u884c\u7f13\u5b58\uff0c\u90a3\u4e48\u5f53\u7528 key \u83b7\u53d6\u6570\u636e\u65f6\uff0c\u5373\u4f7f\u6570\u636e\u4e0d\u5b58\u5728\uff0cRedis \u4e5f\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de\u7ed3\u679c\uff0c\u907f\u514d\u591a\u6b21\u8bbf\u95ee\u6570\u636e\u5e93\u3002 \u4f46\u662f\u7f13\u5b58\u7a7a\u503c\u7684\u7f3a\u70b9\u662f \uff1a \u5982\u679c\u5b58\u5728\u9ed1\u5ba2\u6076\u610f\u7684\u968f\u673a\u8bbf\u95ee\uff0c\u9020\u6210\u7f13\u5b58\u8fc7\u591a\u7684\u7a7a\u503c\uff0c\u90a3\u4e48\u53ef\u80fd\u9020\u6210\u5f88\u591a\u5185\u5b58\u7a7a\u95f4\u7684\u6d6a\u8d39 \u3002\u4f46\u662f\u4e5f\u53ef\u4ee5\u5bf9\u8fd9\u4e9b\u6570\u636e\u8bbe\u7f6e\u5f88\u77ed\u7684\u8fc7\u671f\u65f6\u95f4\u6765\u63a7\u5236\uff1b \u5982\u679c\u67e5\u8be2\u7684 key \u5bf9\u5e94\u7684 Redis \u7f13\u5b58\u7a7a\u503c\u6ca1\u6709\u8fc7\u671f\uff0c\u6570\u636e\u5e93\u8fd9\u65f6\u6709\u4e86\u65b0\u6570\u636e\uff0c\u90a3\u4e48\u4f1a\u51fa\u73b0\u6570\u636e\u5e93\u548c\u7f13\u5b58\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898 \u3002\u4f46\u662f\u53ef\u4ee5\u4fdd\u8bc1\u5f53\u6570\u636e\u5e93\u6709\u6570\u636e\u540e\u66f4\u65b0\u7f13\u5b58\u8fdb\u884c\u89e3\u51b3\u3002","title":"4. \u4ec0\u4e48\u662f\u7f13\u5b58\u7a7f\u900f\uff1f\u600e\u4e48\u89e3\u51b3\uff1f"},{"location":"chap10/4Redis_int_all/#5_1","text":"\u7f13\u5b58\u96ea\u5d29\u662f\u6307\u5f53\u5927\u91cf\u7f13\u5b58\u5931\u6548\u65f6\uff0c\u5927\u91cf\u7684\u8bf7\u6c42\u8bbf\u95ee\u76f4\u63a5\u8bf7\u6c42\u6570\u636e\u5e93\uff0c\u5bfc\u81f4\u6570\u636e\u5e93\u670d\u52a1\u5668\u65e0\u6cd5\u6297\u4f4f\u8bf7\u6c42\u6216\u6302\u6389\u7684\u60c5\u51b5\u3002\u8fd9\u65f6\u7f51\u7ad9\u5e38\u5e38\u4f1a\u51fa\u73b0 502 \u9519\u8bef\uff0c\u5bfc\u81f4\u7f51\u7ad9\u4e0d\u53ef\u7528\u95ee\u9898 \u3002 \u5728\u9884\u9632\u7f13\u5b58\u96ea\u5d29\u65f6\uff0c\u5efa\u8bae\u9075\u5b88\u4ee5\u4e0b\u51e0\u4e2a\u539f\u5219\uff1a \u5408\u7406\u89c4\u5212\u7f13\u5b58\u7684\u5931\u6548\u65f6\u95f4\uff0c\u53ef\u4ee5\u7ed9\u7f13\u5b58\u65f6\u95f4\u52a0\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u9632\u6b62\u7edf\u4e00\u65f6\u95f4\u8fc7\u671f\uff1b \u5408\u7406\u8bc4\u4f30\u6570\u636e\u5e93\u7684\u8d1f\u8f7d\u538b\u529b\uff0c\u8fd9\u6709\u5229\u4e8e\u5728\u5408\u7406\u8303\u56f4\u5185\u90e8\u5206\u7f13\u5b58\u5931\uff0c\u6570\u636e\u5e93\u4e5f\u53ef\u4ee5\u6b63\u5e38\u8bbf\u95ee\uff1b \u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u8fc7\u8f7d\u4fdd\u62a4\u6216\u5e94\u7528\u5c42\u9650\u6d41\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4e00\u822c\u662f\u5728\u7f51\u7ad9\u5904\u4e8e\u5927\u6d41\u91cf\u3001\u9ad8\u5e76\u53d1\u65f6\uff0c\u670d\u52a1\u5668\u6574\u4f53\u4e0d\u80fd\u627f\u53d7\u65f6\uff0c\u53ef\u4ee5\u91c7\u7528\u7684\u4e00\u79cd\u9650\u6d41\u4fdd\u62a4\u63aa\u65bd\uff1b \u6700\u540e\u8fd8\u53ef\u4ee5\u8003\u8651\u591a\u7ea7\u7f13\u5b58\u8bbe\u8ba1\uff0c\u5b9e\u73b0\u7f13\u5b58\u7684\u9ad8\u53ef\u7528\u3002","title":"5. \u4ec0\u4e48\u662f\u7f13\u5b58\u96ea\u5d29\uff1f\u600e\u4e48\u89e3\u51b3\uff1f"},{"location":"chap10/4Redis_int_all/#6-key","text":"\u5982\u679c\u6709\u5927\u91cf\u7684 key \u5728\u540c\u4e00\u65f6\u95f4\u8fc7\u671f\uff0c\u90a3\u4e48\u53ef\u80fd\u540c\u4e00\u79d2\u90fd\u4ece\u6570\u636e\u5e93\u83b7\u53d6\u6570\u636e\uff0c\u7ed9\u6570\u636e\u5e93\u9020\u6210\u5f88\u5927\u7684\u538b\u529b\uff0c\u5bfc\u81f4\u6570\u636e\u5e93\u5d29\u6e83\uff0c\u7cfb\u7edf\u51fa\u73b0 502 \u95ee\u9898\u3002 \u4e5f\u6709\u53ef\u80fd\u540c\u65f6\u5931\u6548\uff0c\u90a3\u4e00\u523b\u4e0d\u7528\u90fd\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u538b\u529b\u4e0d\u591f\u5927\u7684\u8bdd\uff0c\u90a3\u4e48 Redis \u4f1a\u51fa\u73b0\u77ed\u6682\u7684\u5361\u987f\u95ee\u9898\u3002\u6240\u4ee5\u4e3a\u4e86\u9884\u9632\u8fd9\u79cd\u95ee\u9898\u7684\u53d1\u751f\uff0c\u6700\u597d\u7ed9\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u52a0\u4e00\u4e2a\u968f\u673a\u503c\uff0c\u8ba9\u8fc7\u671f\u65f6\u95f4\u66f4\u52a0\u5206\u6563\u3002","title":"6. \u5982\u679c\u6709\u5927\u91cf\u7684 key \u9700\u8981\u8bbe\u7f6e\u540c\u4e00\u65f6\u95f4\u8fc7\u671f\uff0c\u4e00\u822c\u9700\u8981\u6ce8\u610f\u4ec0\u4e48\uff1f"},{"location":"chap10/4Redis_int_all/#7-redis_1","text":"Redis \u7684\u54e8\u5175\u4f5c\u7528\u662f\u7ba1\u7406\u591a\u4e2a Redis \u670d\u52a1\u5668\uff0c\u63d0\u4f9b\u4e86\u76d1\u63a7\u3001\u63d0\u9192\u4ee5\u53ca\u81ea\u52a8\u7684\u6545\u969c\u8f6c\u79fb\u7684\u529f\u80fd \u3002 \u54e8\u5175\u53ef\u4ee5\u4fdd\u8bc1\u5f53\u4e3b\u670d\u52a1\u5668\u6302\u4e86\u540e\uff0c\u53ef\u4ee5\u4ece\u4ece\u670d\u52a1\u5668\u9009\u62e9\u4e00\u53f0\u5f53\u4e3b\u670d\u52a1\u5668\uff0c\u628a\u522b\u7684\u4ece\u670d\u52a1\u5668\u8f6c\u79fb\u5230\u8bfb\u65b0\u7684\u4e3b\u673a \u3002 Redis \u54e8\u5175\u7684\u4e3b\u8981\u529f\u80fd\u6709\uff1a \u96c6\u7fa4\u76d1\u63a7 \uff1a \u5bf9 Redis \u96c6\u7fa4\u7684\u4e3b\u4ece\u8fdb\u7a0b\u8fdb\u884c\u76d1\u63a7\uff0c\u5224\u65ad\u662f\u5426\u6b63\u5e38\u5de5\u4f5c \u3002 \u6d88\u606f\u901a\u77e5 \uff1a\u5982\u679c\u5b58\u5728 Redis \u5b9e\u4f8b\u6709\u6545\u969c\uff0c\u90a3\u4e48\u54e8\u5175\u53ef\u4ee5\u53d1\u9001\u62a5\u8b66\u6d88\u606f\u901a\u77e5\u7ba1\u7406\u5458\u3002 \u6545\u969c\u8f6c\u79fb \uff1a \u5982\u679c\u4e3b\u673a\uff08master\uff09\u8282\u70b9\u6302\u4e86\uff0c\u90a3\u4e48\u53ef\u4ee5\u81ea\u52a8\u8f6c\u79fb\u5230\u4ece\uff08slave\uff09\u8282\u70b9\u4e0a \u3002 \u914d\u7f6e\u4e2d\u5fc3 \uff1a\u5f53\u5b58\u5728\u6545\u969c\u65f6\uff0c\u5bf9\u6545\u969c\u8fdb\u884c\u8f6c\u79fb\u540e\uff0c\u914d\u7f6e\u4e2d\u5fc3\u4f1a\u901a\u77e5\u5ba2\u6237\u7aef\u65b0\u7684\u4e3b\u673a\uff08master\uff09\u5730\u5740\u3002 Redis \u7684\u96c6\u7fa4\u7684\u529f\u80fd\u662f\u4e3a\u4e86\u89e3\u51b3\u5355\u673a Redis \u5bb9\u91cf\u6709\u9650\u7684\u95ee\u9898\uff0c\u5c06\u6570\u636e\u6309\u4e00\u5b9a\u7684\u89c4\u5219\u5206\u914d\u5230\u591a\u53f0\u673a\u5668\uff0c\u5bf9\u5185\u5b58\u7684\u6bcf\u79d2\u8bbf\u95ee\u4e0d\u53d7\u9650\u4e8e\u5355\u53f0\u670d\u52a1\u5668\uff0c\u53ef\u53d7\u76ca\u4e8e\u5206\u5e03\u5f0f\u96c6\u7fa4\u9ad8\u6269\u5c55\u6027\u3002","title":"7. Redis \u54e8\u5175\u548c\u96c6\u7fa4\u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f"},{"location":"chap10/4Redis_int_all/#8-redis_2","text":"\u54e8\u5175\u662f Redis \u96c6\u7fa4\u67b6\u6784\u4e2d\u975e\u5e38\u91cd\u8981\u7684\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u4e3b\u8981\u529f\u80fd\u5982\u4e0b\uff1a \u96c6\u7fa4\u76d1\u63a7\uff0c\u8d1f\u8d23\u76d1\u63a7 Redis Master \u548c Slave \u8fdb\u7a0b\u662f\u5426\u6b63\u5e38\u5de5\u4f5c\uff1b \u6d88\u606f\u901a\u77e5\uff0c\u5982\u679c\u67d0\u4e2a Redis \u5b9e\u4f8b\u6709\u6545\u969c\uff0c\u90a3\u4e48\u54e8\u5175\u8d1f\u8d23\u53d1\u9001\u6d88\u606f\u4f5c\u4e3a\u62a5\u8b66\u901a\u77e5\u7ed9\u7ba1\u7406\u5458 \uff1b \u6545\u969c\u8f6c\u79fb\uff0c\u5982\u679c Master node \u6302\u6389\u4e86\uff0c\u4f1a\u81ea\u52a8\u8f6c\u79fb\u5230 Slave node \u4e0a \uff1b \u914d\u7f6e\u4e2d\u5fc3\uff0c\u5982\u679c\u6545\u969c\u8f6c\u79fb\u53d1\u751f\u4e86\uff0c\u901a\u77e5 Client \u5ba2\u6237\u7aef\u65b0\u7684 Master \u5730\u5740 \u3002","title":"8. Redis \u7684\u54e8\u5175\u6709\u4ec0\u4e48\u529f\u80fd\uff1f"},{"location":"chap10/4Redis_int_all/#9-redis","text":"Redis \u4ea7\u751f\u963b\u585e\u7684\u539f\u56e0\u4e3b\u8981\u6709\u5185\u90e8\u548c\u5916\u90e8\u4e24\u4e2a\u539f\u56e0\u5bfc\u81f4\uff1a 1. \u5185\u90e8\u539f\u56e0 \u5982\u679c Redis \u4e3b\u673a\u7684 CPU \u8d1f\u8f7d\u8fc7\u9ad8\uff0c\u4e5f\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u5d29\u6e83\uff1b \u6570\u636e\u6301\u4e45\u5316\u5360\u7528\u8d44\u6e90\u8fc7\u591a\uff1b \u5bf9 Redis \u7684 API \u6216\u6307\u4ee4\u4f7f\u7528\u4e0d\u5408\u7406\uff0c\u5bfc\u81f4 Redis \u51fa\u73b0\u95ee\u9898\u3002 2. \u5916\u90e8\u539f\u56e0 \u5916\u90e8\u539f\u56e0\u4e3b\u8981\u662f\u670d\u52a1\u5668\u7684\u539f\u56e0\uff0c\u4f8b\u5982\u670d\u52a1\u5668\u7684 CPU \u7ebf\u7a0b\u5728\u5207\u6362\u8fc7\u7a0b\u4e2d\u7ade\u4e89\u8fc7\u5927\uff0c\u5185\u5b58\u51fa\u73b0\u95ee\u9898\u3001\u7f51\u7edc\u95ee\u9898\u7b49\u3002","title":"9. \u8bf7\u4ecb\u7ecd\u51e0\u4e2a\u53ef\u80fd\u5bfc\u81f4 Redis \u963b\u585e\u7684\u539f\u56e0"},{"location":"chap10/4Redis_int_all/#10-redis_2","text":"Redis \u53ef\u4ee5\u4f7f\u7528\u4e3b\u4ece\u540c\u6b65\u3001\u4ece\u4ece\u540c\u6b65 \u3002 \u7b2c\u4e00\u6b21\u540c\u6b65\u65f6\uff0c\u4e3b\u8282\u70b9\u505a\u4e00\u6b21 bgsave\uff0c\u5e76\u540c\u65f6\u5c06\u540e\u7eed\u4fee\u6539\u64cd\u4f5c\u8bb0\u5f55\u5230\u5185\u5b58 buffer\uff0c\u5f85\u5b8c\u6210\u540e\u5c06 RDB \u6587\u4ef6\u5168\u91cf\u540c\u6b65\u5230\u590d\u5236\u8282\u70b9\uff0c\u590d\u5236\u8282\u70b9\u63a5\u53d7\u5b8c\u6210\u540e\u5c06 RDB \u955c\u50cf\u52a0\u8f7d\u5230\u5185\u5b58 \u3002 \u52a0\u8f7d\u5b8c\u6210\u540e\uff0c\u518d\u901a\u77e5\u4e3b\u8282\u70b9\u5c06\u671f\u95f4\u4fee\u6539\u7684\u64cd\u4f5c\u8bb0\u5f55\u540c\u6b65\u5230\u590d\u5236\u8282\u70b9\u8fdb\u884c\u91cd\u653e\u5c31\u5b8c\u6210\u4e86\u540c\u6b65\u8fc7\u7a0b\u3002","title":"10. Redis \u7684\u540c\u6b65\u673a\u5236\u4e86\u89e3\u4e48\uff1f"},{"location":"chap10/4Redis_int_all/#11-redis-big-key-hot-key","text":"\u5bf9\u4e8e big key \u5148\u5206\u6790\u4e1a\u52a1\u5b58\u5728\u5927\u952e\u503c\u662f\u5426\u5408\u7406\uff0c\u5982\u679c\u4e0d\u5408\u7406\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u4eec\u62c6\u5206\u4e3a\u591a\u4e2a\u5c0f\u7684\u5b58\u50a8 \u3002\u6216\u8005\u770b\u662f\u5426\u53ef\u4ee5\u4f7f\u7528\u522b\u7684\u5b58\u50a8\u4ecb\u8d28\u5b58\u50a8\u8fd9\u79cd big key \u89e3\u51b3\u5360\u7528\u5185\u5b58\u7a7a\u95f4\u5927\u7684\u95ee\u9898\u3002 \u5bf9\u4e8e hot key \u6211\u4eec\u53ef\u4ee5\u5728\u5176\u4ed6\u673a\u5668\u4e0a\u590d\u5236\u8fd9\u4e2a key \u7684\u5907\u4efd\uff0c\u8ba9\u8bf7\u6c42\u8fdb\u6765\u7684\u65f6\u5019\uff0c\u53bb\u968f\u673a\u7684\u5230\u5404\u53f0\u673a\u5668\u4e0a\u8bbf\u95ee\u7f13\u5b58 \u3002\u6240\u4ee5\u5269\u4e0b\u7684\u95ee\u9898\u5c31\u662f\u5982\u4f55\u505a\u5230\u8ba9\u8bf7\u6c42\u5e73\u5747\u7684\u5206\u5e03\u5230\u5404\u53f0\u673a\u5668\u4e0a\u3002","title":"11. \u5982\u4f55\u5904\u7406 Redis \u96c6\u7fa4\u4e2d big key \u548c hot key\uff1f"},{"location":"chap10/4Redis_int_all/#12-redis_1","text":"\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u4e24\u65b9\u9762\u51c6\u5907\uff1a 1. \u4f7f\u7528 Redis \u81ea\u8eab\u76d1\u63a7\u7cfb\u7edf \u4f7f\u7528 Redis \u81ea\u8eab\u76d1\u63a7\u7cfb\u7edf\uff0c\u53ef\u4ee5\u5bf9 CPU\u3001\u5185\u5b58\u3001\u78c1\u76d8\u3001\u547d\u4ee4\u8017\u65f6\u7b49\u963b\u585e\u95ee\u9898\u8fdb\u884c\u76d1\u63a7\uff0c\u5f53\u76d1\u63a7\u7cfb\u7edf\u53d1\u73b0\u5404\u4e2a\u76d1\u63a7\u6307\u6807\u5b58\u5728\u5f02\u5e38\u7684\u65f6\u5019\uff0c\u53d1\u9001\u62a5\u8b66\u3002 2. \u4f7f\u7528\u5e94\u7528\u670d\u52a1\u76d1\u63a7 \u5f53 Redis \u5b58\u5728\u963b\u585e\u65f6\uff0c\u5e94\u7528\u54cd\u5e94\u65f6\u95f4\u5c31\u4f1a\u5ef6\u957f\uff0c\u5e94\u7528\u53ef\u4ee5\u611f\u77e5\u53d1\u73b0\u95ee\u9898\uff0c\u5e76\u53d1\u9001\u62a5\u8b66\u7ed9\u7ba1\u7406\u4eba\u5458\u3002","title":"12. \u600e\u4e48\u53bb\u53d1\u73b0 Redis \u963b\u585e\u5f02\u5e38\u60c5\u51b5\uff1f"},{"location":"chap10/4Redis_int_all/#13-redis_2","text":"\u5ba2\u6237\u7aef\u5206\u533a\u5c31\u662f\u5728\u5ba2\u6237\u7aef\u5c31\u5df2\u7ecf\u51b3\u5b9a\u6570\u636e\u4f1a\u88ab\u5b58\u50a8\u5230\u54ea\u4e2a Redis \u8282\u70b9\u6216\u8005\u4ece\u54ea\u4e2a Redis \u8282\u70b9\u8bfb\u53d6\u3002\u5927\u591a\u6570\u5ba2\u6237\u7aef\u5df2\u7ecf\u5b9e\u73b0\u4e86\u5ba2\u6237\u7aef\u5206\u533a\u3002 \u4ee3\u7406\u5206\u533a\u610f\u5473\u7740\u5ba2\u6237\u7aef\u5c06\u8bf7\u6c42\u53d1\u9001\u7ed9\u4ee3\u7406\uff0c\u7136\u540e\u4ee3\u7406\u51b3\u5b9a\u53bb\u54ea\u4e2a\u8282\u70b9\u5199\u6570\u636e\u6216\u8005\u8bfb\u6570\u636e\u3002\u4ee3\u7406\u6839\u636e\u5206\u533a\u89c4\u5219\u51b3\u5b9a\u8bf7\u6c42\u54ea\u4e9b Redis \u5b9e\u4f8b\uff0c\u7136\u540e\u6839\u636e Redis \u7684\u54cd\u5e94\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002Redis \u548c Memcached \u7684\u4e00\u79cd\u4ee3\u7406\u5b9e\u73b0\u5c31\u662f Twemproxy\u3002 \u67e5\u8be2\u8def\u7531\uff08Query routing\uff09\u7684\u610f\u601d\u662f\u5ba2\u6237\u7aef\u968f\u673a\u5730\u8bf7\u6c42\u4efb\u610f\u4e00\u4e2a Redis \u5b9e\u4f8b\uff0c\u7136\u540e\u7531 Redis \u5c06\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u6b63\u786e\u7684 Redis \u8282\u70b9\u3002 Redis Cluster \u5b9e\u73b0\u4e86\u4e00\u79cd\u6df7\u5408\u5f62\u5f0f\u7684\u67e5\u8be2\u8def\u7531\uff0c\u4f46\u5e76\u4e0d\u662f\u76f4\u63a5\u5c06\u8bf7\u6c42\u4ece\u4e00\u4e2a Redis \u8282\u70b9\u8f6c\u53d1\u5230\u53e6\u4e00\u4e2a Redis \u8282\u70b9\uff0c\u800c\u662f\u5728\u5ba2\u6237\u7aef\u7684\u5e2e\u52a9\u4e0b\u76f4\u63a5 redirected \u5230\u6b63\u786e\u7684 Redis \u8282\u70b9\u3002","title":"13. \u4f60\u77e5\u9053\u6709\u54ea\u4e9b Redis \u5206\u533a\u5b9e\u73b0\u65b9\u6848\uff1f"},{"location":"chap10/4Redis_int_all/#14-redis_2","text":"\u9700\u8981\u77e5\u9053 Redis \u7684\u590d\u5236\u65b9\u5f0f\u524d\uff0c\u9700\u8981\u77e5\u9053\u4e3b\u4ece\u590d\u5236\uff08Master-Slave Replication\uff09\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u5177\u4f53\u4e3a\uff1a Slave \u4ece\u8282\u70b9\u670d\u52a1\u542f\u52a8\u5e76\u8fde\u63a5\u5230 Master \u4e4b\u540e\uff0c\u5b83\u5c06\u4e3b\u52a8\u53d1\u9001\u4e00\u4e2a SYNC \u547d\u4ee4\uff1b Master \u670d\u52a1\u4e3b\u8282\u70b9\u6536\u5230\u540c\u6b65\u547d\u4ee4\u540e\u5c06\u542f\u52a8\u540e\u53f0\u5b58\u76d8\u8fdb\u7a0b\uff0c\u540c\u65f6\u6536\u96c6\u6240\u6709\u63a5\u6536\u5230\u7684\u7528\u4e8e\u4fee\u6539\u6570\u636e\u96c6\u7684\u547d\u4ee4\uff0c\u5728\u540e\u53f0\u8fdb\u7a0b\u6267\u884c\u5b8c\u6bd5\u540e\uff0cMaster \u5c06\u4f20\u9001\u6574\u4e2a\u6570\u636e\u5e93\u6587\u4ef6\u5230 Slave\uff0c\u4ee5\u5b8c\u6210\u4e00\u6b21\u5b8c\u5168\u540c\u6b65\uff1b Slave \u4ece\u8282\u70b9\u670d\u52a1\u5728\u63a5\u6536\u5230\u6570\u636e\u5e93\u6587\u4ef6\u6570\u636e\u4e4b\u540e\u5c06\u5176\u5b58\u76d8\u5e76\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d \uff1b \u6b64\u540e\uff0cMaster \u4e3b\u8282\u70b9\u7ee7\u7eed\u5c06\u6240\u6709\u5df2\u7ecf\u6536\u96c6\u5230\u7684\u4fee\u6539\u547d\u4ee4\uff0c\u548c\u65b0\u7684\u4fee\u6539\u547d\u4ee4\u4f9d\u6b21\u4f20\u9001\u7ed9 Slaves\uff0cSlave \u5c06\u5728\u672c\u6b21\u6267\u884c\u8fd9\u4e9b\u6570\u636e\u4fee\u6539\u547d\u4ee4\uff0c\u4ece\u800c\u8fbe\u5230\u6700\u7ec8\u7684\u6570\u636e\u540c\u6b65\u3002 \u6574\u4e2a\u6267\u884c\u7684\u8fc7\u7a0b\u90fd\u662f\u4f7f\u7528\u5f02\u6b65\u590d\u5236\u7684\u65b9\u5f0f\u8fdb\u884c\u590d\u5236\u3002","title":"14. Redis \u96c6\u7fa4\u4e4b\u95f4\u7684\u590d\u5236\u65b9\u5f0f\u662f\uff1f"},{"location":"chap10/4Redis_int_all/#15","text":"\u5f53\u4e00\u4e2a\u6570\u636e\u9700\u8981\u66f4\u65b0\u65f6\uff0c\u56e0\u4e3a\u4e0d\u53ef\u80fd\u505a\u5230\u540c\u65f6\u66f4\u65b0\u6570\u636e\u5e93\u548c\u7f13\u5b58\uff0c\u90a3\u4e48\u6b64\u65f6\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\u5c31\u4e00\u5b9a\u4f1a\u53d1\u751f\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\uff0c\u800c\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\u5728\u91d1\u878d\u4ea4\u6613\u9886\u57df\u7684\u7cfb\u7edf\u4e2d\u662f\u80af\u5b9a\u4e0d\u5141\u8bb8\u7684\u3002 \u89e3\u51b3\u529e\u6cd5\uff1a\u8bfb\u7684\u65f6\u5019\u5148\u8bfb\u7f13\u5b58\uff0c\u7f13\u5b58\u6ca1\u6709\u7684\u8bdd\uff0c\u5c31\u8bfb\u6570\u636e\u5e93\uff0c\u7136\u540e\u53d6\u51fa\u6570\u636e\u540e\u653e\u5165\u7f13\u5b58\uff0c\u540c\u65f6\u8fd4\u56de\u54cd\u5e94\u3002\u66f4\u65b0\u7684\u65f6\u5019\uff0c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u7136\u540e\u518d\u5220\u9664\u7f13\u5b58\u3002","title":"15. \u4ec0\u4e48\u662f\u6570\u636e\u5e93\u7f13\u5b58\u53cc\u5199\u4e00\u81f4\u6027\uff1f"},{"location":"chap10/4Redis_int_all/#16-redis_1","text":"\u5206\u533a\u53ef\u4ee5\u8ba9 Redis \u7ba1\u7406\u66f4\u5927\u7684\u5185\u5b58\uff0cRedis \u5c06\u53ef\u4ee5\u4f7f\u7528\u6240\u6709\u673a\u5668\u7684\u5185\u5b58\u3002\u5982 \u679c\u6ca1\u6709\u5206\u533a\uff0c\u4f60\u6700\u591a\u53ea\u80fd\u4f7f\u7528\u4e00\u53f0\u673a\u5668\u7684\u5185\u5b58 \u3002 \u5206\u533a\u4f7f Redis \u7684\u8ba1\u7b97\u80fd\u529b\u901a\u8fc7\u7b80\u5355\u5730\u589e\u52a0\u8ba1\u7b97\u673a\u5f97\u5230\u6210\u500d\u63d0\u5347\uff0cRedis \u7684\u7f51\u7edc\u5e26\u5bbd\u4e5f\u4f1a\u968f\u7740\u8ba1\u7b97\u673a\u548c\u7f51\u5361\u7684\u589e\u52a0\u800c\u6210\u500d\u589e\u957f\u3002","title":"16. \u4e3a\u4ec0\u4e48\u8981\u505a Redis \u5206\u533a\uff1f"},{"location":"chap10/4Redis_int_all/#17-redis_1","text":"\u4e3a\u9632\u6b62\u4ee5\u540e\u6269\u5bb9\u589e\u52a0\u96be\u5ea6\uff0c\u6700\u597d\u7684\u529e\u6cd5\u5c31\u662f\u4e00\u5f00\u59cb\u5c31\u4f7f\u7528\u5206\u5e03\u5f0f\u3002 \u5373\u4fbf\u53ea\u6709\u4e00\u53f0\u670d\u52a1\u5668\uff0c\u4e5f\u53ef\u4ee5\u4e00\u5f00\u59cb\u5c31\u8ba9 Redis \u4ee5\u5206\u5e03\u5f0f\u7684\u65b9\u5f0f\u8fd0\u884c\uff0c\u4f7f\u7528\u5206\u533a\uff0c\u5728\u540c\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u542f\u52a8\u591a\u4e2a\u5b9e\u4f8b\u3002 \u521a\u5f00\u59cb\u64cd\u4f5c\u65f6\u6bd4\u8f83\u9ebb\u70e6\uff0c\u4f46\u662f\u5f53\u6570\u636e\u4e0d\u65ad\u589e\u957f\uff0c\u9700\u8981\u66f4\u591a\u7684 Redis \u670d\u52a1\u5668\u65f6\uff0c\u53ea\u9700\u8981\u5c06 Redis \u5b9e\u4f8b\u4ece\u4e00\u53f0\u670d\u52a1\u8fc1\u79fb\u5230\u53e6\u5916\u4e00\u53f0\u670d\u52a1\u5668\u5373\u53ef\uff0c\u800c\u4e0d\u7528\u8003\u8651\u91cd\u65b0\u5206\u533a\u7684\u95ee\u9898\u3002\u4e00\u65e6\u6dfb\u52a0\u4e86\u53e6\u4e00\u53f0\u670d\u52a1\u5668\uff0c\u53ea\u9700\u8981\u5c06\u4e00\u534a\u7684 Redis \u5b9e\u4f8b\u4ece\u7b2c\u4e00\u53f0\u673a\u5668\u8fc1\u79fb\u5230\u7b2c\u4e8c\u53f0\u673a\u5668\u3002","title":"17. \u5206\u5e03\u5f0f Redis \u662f\u524d\u671f\u505a\u8fd8\u662f\u540e\u671f\u89c4\u6a21\u4e0a\u6765\u4e86\u518d\u505a\u597d\uff0c\u4e3a\u4ec0\u4e48\uff1f"},{"location":"chap10/4Redis_int_all/#18-key","text":"\u5982\u679c\u5927\u91cf\u7684 key \u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u7684\u8fc7\u4e8e\u96c6\u4e2d\uff0c\u5230\u8fc7\u671f\u7684\u90a3\u4e2a\u65f6\u95f4\u70b9\uff0credis \u53ef\u80fd\u4f1a\u51fa\u73b0\u77ed\u6682\u7684\u5361\u987f\u73b0\u8c61\u3002 \u4e00\u822c\u9700\u8981\u5728\u65f6\u95f4\u4e0a\u52a0\u4e00\u4e2a\u968f\u673a\u503c\uff0c\u4f7f\u5f97\u8fc7\u671f\u65f6\u95f4\u5206\u6563\u4e00\u4e9b\u3002","title":"18. \u5982\u679c\u6709\u5927\u91cf\u7684 key \u9700\u8981\u8bbe\u7f6e\u540c\u4e00\u65f6\u95f4\u8fc7\u671f\uff0c\u4e00\u822c\u9700\u8981\u6ce8\u610f\u4ec0\u4e48\uff1f"},{"location":"chap10/4Redis_int_all/#19","text":"\u5206\u5e03\u5f0f\u9501\u662f\u63a7\u5236\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e4b\u95f4\u540c\u6b65\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u7684\u4e00\u79cd\u65b9\u5f0f\u3002 \u5728\u5355\u673a\u6216\u8005\u5355\u8fdb\u7a0b\u73af\u5883\u4e0b\uff0c\u591a\u7ebf\u7a0b\u5e76\u53d1\u7684\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u9501\u6765\u4fdd\u8bc1\u4e00\u4e2a\u4ee3\u7801\u5757\u5728\u540c\u4e00\u65f6\u95f4\u5185\u53ea\u80fd\u7531\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u3002 \u6bd4\u5982 Java \u7684 Synchronized \u5173\u952e\u5b57\u548c Reentrantlock \u7c7b \u3002 \u5206\u5e03\u5f0f\u9501\u7684\u4f5c\u7528\u662f\u5f53\u591a\u4e2a\u8fdb\u7a0b\u4e0d\u5728\u540c\u4e00\u4e2a\u7cfb\u7edf\u4e2d\uff0c\u7528\u5206\u5e03\u5f0f\u9501\u53ef\u4ee5\u63a7\u5236\u591a\u4e2a\u8fdb\u7a0b\u5bf9\u8d44\u6e90\u7684\u8bbf\u95ee\u3002","title":"19. \u4ec0\u4e48\u662f\u5206\u5e03\u5f0f\u9501\uff1f\u6709\u4ec0\u4e48\u4f5c\u7528\uff1f"},{"location":"chap10/4Redis_int_all/#20","text":"\u53ef\u4ee5\u4f7f\u7528 Memcached \u5b9e\u73b0\u5206\u5e03\u5f0f\u9501 \uff1aMemcached \u63d0\u4f9b\u4e86\u539f\u5b50\u6027\u64cd\u4f5c\u547d\u4ee4 add\uff0c\u7ebf\u7a0b\u83b7\u53d6\u5230\u9501\u3002key \u5df2\u5b58\u5728\u7684\u60c5\u51b5\u4e0b\uff0c\u5219 add \u5931\u8d25\uff0c\u83b7\u53d6\u9501\u4e5f\u5931\u8d25\u3002 \u4e5f\u53ef\u4ee5\u4f7f\u7528 Redis \u5b9e\u73b0\u5206\u5e03\u5f0f\u9501 \uff1aRedis \u7684 setnx \u547d\u4ee4\u4e3a\u539f\u5b50\u6027\u64cd\u4f5c\u547d\u4ee4\u3002\u53ea\u6709\u5728 key \u4e0d\u5b58\u5728\u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u80fd set \u6210\u529f\u3002\u548c Memcached \u7684 add \u65b9\u6cd5\u6bd4\u8f83\u7c7b\u4f3c\u3002 \u8fd8\u53ef\u4ee5\u4f7f\u7528 ZooKeeper \u5206\u5e03\u5f0f\u9501 \uff1a\u5229\u7528 ZooKeeper \u7684\u987a\u5e8f\u4e34\u65f6\u8282\u70b9\uff0c\u6765\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u548c\u7b49\u5f85\u961f\u5217\u3002 \u8fd8\u6709 Chubby \u5b9e\u73b0\u5206\u5e03\u5f0f\u9501 \uff1aChubby \u5e95\u5c42\u5229\u7528\u4e86 Paxos \u4e00\u81f4\u6027\u7b97\u6cd5\uff0c\u5b9e\u73b0\u7c97\u7c92\u5ea6\u5206\u5e03\u5f0f\u9501\u670d\u52a1\u3002","title":"20. \u5206\u5e03\u5f0f\u9501\u53ef\u4ee5\u901a\u8fc7\u4ec0\u4e48\u6765\u5b9e\u73b0\uff1f"},{"location":"chap10/4Redis_int_all/#21_1","text":"\u5206\u5e03\u5f0f\u9501\u5b9e\u73b0\u9700\u8981\u4fdd\u8bc1\u4ee5\u4e0b\u51e0\u70b9\uff1a \u4e92\u65a5\u6027\uff1a\u4efb\u610f\u65f6\u523b\uff0c\u53ea\u6709\u4e00\u4e2a\u8d44\u6e90\u80fd\u591f\u83b7\u53d6\u5230\u9501\uff1b \u5bb9\u707e\u6027\uff1a\u5728\u672a\u6210\u529f\u91ca\u653e\u9501\u7684\u7684\u60c5\u51b5\u4e0b\uff0c\u4e00\u5b9a\u65f6\u9650\u5185\u80fd\u591f\u6062\u590d\u9501\u7684\u6b63\u5e38\u529f\u80fd\uff1b \u7edf\u4e00\u6027\uff1a\u52a0\u9501\u548c\u89e3\u9501\u4fdd\u8bc1\u540c\u4e00\u8d44\u6e90\u6765\u8fdb\u884c\u64cd\u4f5c\u3002","title":"21. \u4ecb\u7ecd\u4e00\u4e0b\u5206\u5e03\u5f0f\u9501\u5b9e\u73b0\u9700\u8981\u6ce8\u610f\u7684\u4e8b\u9879\uff1f"},{"location":"chap10/4Redis_int_all/#8","text":"","title":"\u56db\u3001\u6301\u4e45\u5316\uff088 \u9898\uff09"},{"location":"chap10/4Redis_int_all/#1-redis-bgsave","text":"\u4f60\u7ed9\u51fa\u4e24\u4e2a\u8bcd\u6c47\u5c31\u53ef\u4ee5\u4e86\uff0cfork \u548c cow\u3002 fork \u662f\u6307 Redis \u901a\u8fc7\u521b\u5efa\u5b50\u8fdb\u7a0b\u6765\u8fdb\u884c bgsave \u64cd\u4f5c\uff0ccow \u6307\u7684\u662f copy on write\uff0c\u5b50\u8fdb\u7a0b\u521b\u5efa\u540e\uff0c\u7236\u5b50\u8fdb\u7a0b\u5171\u4eab\u6570\u636e\u6bb5\uff0c\u7236\u8fdb\u7a0b\u7ee7\u7eed\u63d0\u4f9b\u8bfb\u5199\u670d\u52a1\uff0c\u5199\u810f\u7684\u9875\u9762\u6570\u636e\u4f1a\u9010\u6e10\u548c\u5b50\u8fdb\u7a0b\u5206\u79bb\u5f00\u6765\u3002","title":"1. Redis \u4e2d\u7684 bgsave \u7684\u539f\u7406\u662f\u4ec0\u4e48\uff1f"},{"location":"chap10/4Redis_int_all/#2_1","text":"\u5728\u5b9e\u9645\u7684\u751f\u4ea7\u73af\u5883\u5f53\u4e2d\u5bf9\u4e8e\u9009\u62e9 RDB \u6301\u4e45\u5316\u65b9\u5f0f\u8fd8\u662f AOF \u6301\u4e45\u5316\u65b9\u5f0f\u90fd\u9700\u8981\u6839\u636e\u6570\u636e\u91cf\u3001\u5e94\u7528\u5bf9\u6570\u636e\u7684\u5b89\u5168\u8981\u6c42\u3001\u786c\u4ef6\u76f8\u5173\u9884\u7b97\u7b49\u60c5\u51b5\u7efc\u5408\u8003\u8651\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u8003\u8651\u4e3b\u4ece\u590d\u5236\u7684\u7b56\u7565\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e3b\u673a\uff08master\uff09\u548c\u4ece\u673a\uff08slave\uff09\u4f7f\u7528\u4e0d\u540c\u7684\u6301\u4e45\u5316\u65b9\u6848\u3002\u5bf9\u6b64\u4ee5\u4e0b\u53ea\u662f\u7b80\u5355\u7684\u8fdb\u884c\u4e00\u4e2a\u9009\u62e9\u7684\u4ecb\u7ecd\uff0c\u5177\u4f53\u5728\u5b9e\u9645\u7684\u5f00\u53d1\u5e94\u7528\u8fc7\u7a0b\u4e2d\u8fd8\u9700\u8981\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u7efc\u5408\u9009\u62e9\u3002 \u5982\u679c\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\u5bf9 Redis \u91cc\u7684\u6570\u636e\u5b8c\u5168\u4e22\u5f03\u4e5f\u4e0d\u4f1a\u6709\u4ec0\u4e48\u5f71\u54cd\u7684\u60c5\u51b5\uff0c\u90a3\u4e48\u9009\u62e9 RDB \u6301\u4e45\u5316\u65b9\u5f0f\u6bd4\u9009\u62e9 AOF \u6301\u4e45\u5316\u66f4\u6709\u5229\uff1b \u4f46\u662f\u5982\u679c\u9700\u8981\u9884\u9632\u6570\u636e\u79d2\u7ea7\u522b\u7684\u4e22\u5931\u65f6\uff0c\u5c31\u53ea\u80fd\u9009\u62e9 AOF \u6301\u4e45\u5316\u65b9\u5f0f\u4e86 \u3002 \u5f53 Redis \u7684\u7ed3\u6784\u662f\u4e3b\u4ece\u67b6\u6784\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u8bfb\u5199\u5206\u79bb\u6765\u5206\u62c5 Redis \u7684\u8bfb\u8bf7\u6c42\u538b\u529b\uff0c\u4e5f\u9884\u9632\u4e3b\u673a\uff08master\uff09\u5b95\u673a\u540e\u7ee7\u7eed\u63d0\u4f9b\u670d\u52a1\u3002 \u8fd9\u65f6\u5019\u53ef\u4ee5\u91c7\u7528\u8fd9\u6837\u4e00\u79cd\u7b56\u7565\uff1a\u5173\u95ed\u4e3b\u673a\uff08master\uff09\u7684\u6301\u4e45\u5316\u529f\u80fd\uff0c\u8fd9\u6837\u4fdd\u6301\u4e3b\u673a\uff08master\uff09\u7684\u9ad8\u6548\u6027\uff0c\u7136\u540e\u5173\u95ed\u4ece\u673a\uff08slave\uff09\u7684 RDB \u6301\u4e45\u5316\uff0c\u5f00\u542f AOF \u6301\u4e45\u5316\uff0c\u540c\u65f6\u5efa\u8bae\u5173\u95ed AOF \u7684\u81ea\u52a8\u91cd\u5199\u529f\u80fd\uff0c\u901a\u8fc7\u8bbe\u7f6e\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\uff0c\u5728\u5e94\u7528\u8bbf\u95ee\u6b21\u6570\u6bd4\u8f83\u5c11\u7684\u65f6\u95f4\u70b9\u518d\u901a\u8fc7\u8c03\u7528 bgrewriteaof \u547d\u4ee4\u8fdb\u884c\u81ea\u52a8\u91cd\u5199\uff0c\u4e3a\u4e86\u9632\u6b62\u6301\u4e45\u5316\u6570\u636e\u7684\u4e22\u5931\uff0c\u5efa\u8bae\u8bbe\u7f6e\u4e00\u4e2a\u5b9a\u65f6\u5668\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\u5bf9\u6301\u4e45\u5316\u6587\u4ef6\u8fdb\u884c\u5907\u4efd\u5e76\u6807\u8bb0\u597d\u5907\u4efd\u65f6\u95f4\u70b9\u3002","title":"2. \u5982\u4f55\u9009\u62e9\u5408\u9002\u7684\u6301\u4e45\u5316\u65b9\u5f0f\uff1f"},{"location":"chap10/4Redis_int_all/#3-redis_2","text":"\u5982\u679c Redis \u88ab\u5f53\u505a\u7f13\u5b58\u4f7f\u7528\uff0c\u4f7f\u7528\u4e00\u81f4\u6027\u54c8\u5e0c\u5b9e\u73b0\u52a8\u6001\u6269\u5bb9\u7f29\u5bb9\u3002 \u5982\u679c Redis \u88ab\u5f53\u505a\u4e00\u4e2a\u6301\u4e45\u5316\u5b58\u50a8\u4f7f\u7528\uff0c \u5fc5\u987b\u4f7f\u7528\u56fa\u5b9a\u7684 keys-to-nodes \u6620\u5c04\u5173\u7cfb\uff0c\u8282\u70b9\u7684\u6570\u91cf\u4e00\u65e6\u786e\u5b9a\u4e0d\u80fd\u53d8\u5316\u3002 \u5426\u5219\u7684\u8bdd\uff08\u5373 Redis \u8282\u70b9\u9700\u8981\u52a8\u6001\u53d8\u5316\u7684\u60c5\u51b5\uff09\uff0c\u5fc5\u987b\u4f7f\u7528\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u8fdb\u884c\u6570\u636e\u518d\u5e73\u8861\u7684\u4e00\u5957\u7cfb\u7edf\uff0c\u800c\u5f53\u524d\u53ea\u6709 Redis \u96c6\u7fa4\u53ef\u4ee5\u505a\u5230\u8fd9\u6837\u3002","title":"3. Redis \u6301\u4e45\u5316\u6570\u636e\u548c\u7f13\u5b58\u600e\u4e48\u505a\u6269\u5bb9\uff1f"},{"location":"chap10/4Redis_int_all/#4-redis","text":"Redis \u4e3b\u8981\u652f\u6301\u7684\u6301\u4e45\u5316\u673a\u5236\u4e3a RDB\uff08\u5feb\u7167\uff09\u548c AOF\uff08\u8ffd\u52a0\u6587\u4ef6\uff09 \u3002 RDB \u6301\u4e45\u5316\u662f\u5728\u6307\u5b9a\u65f6\u95f4\u95f4\u9694\u5185\u4fdd\u5b58\u6570\u636e\u5feb\u7167\u5230\u786c\u76d8\u4e2d\u3002\u4f46 RDB \u7684\u6301\u4e45\u5316\u65b9\u5f0f\u6ca1\u6709\u529e\u6cd5\u5b9e\u73b0\u5b9e\u65f6\u6027\u7684\u6301\u4e45\u5316 \u3002 \u5f53\u5e94\u7528\u4f7f\u7528 RDB \u6301\u4e45\u5316\u540e\uff0c\u5982\u679c Redis \u7cfb\u7edf\u53d1\u751f\u5d29\u6e83\uff0c\u90a3\u4e48\u4f7f\u7528 RDB \u6062\u590d\u6570\u636e\u65f6\uff0c\u6062\u590d\u540e\u7684\u6570\u636e\u4e2d\uff0c\u5b58\u5728\u4e22\u5931\u6700\u8fd1\u4e00\u6b21\u751f\u6210\u5feb\u7167\u4e4b\u540e\u66f4\u6539\u7684\u6240\u6709\u6570\u636e\u3002\u6240\u4ee5 RDB \u6301\u4e45\u5316\u4e0d\u9002\u7528\u4e8e\u4e22\u5931\u4e00\u90e8\u5206\u6570\u636e\u4e5f\u4f1a\u5bf9\u5e94\u7528\u9020\u6210\u5f88\u5927\u5f71\u54cd\u7684\u5907\u4efd\u4e2d\u3002 AOF \u6301\u4e45\u5316\u662f\u628a\u547d\u4ee4\u8ffd\u52a0\u5230\u64cd\u4f5c\u65e5\u5fd7\u7684\u5c3e\u90e8\uff0c\u7136\u540e\u4fdd\u5b58\u6240\u6709\u5386\u53f2\u64cd\u4f5c\u3002AOF \u4e3b\u8981\u662f\u89e3\u51b3\u6570\u636e\u6301\u4e45\u5316\u7684\u5b9e\u65f6\u6027 \u3002 Redis \u670d\u52a1\u5668\u9ed8\u8ba4\u5f00\u542f RDB\uff0c\u5173\u95ed AOF\uff1b\u8981\u5f00\u542f AOF\uff0c\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\uff1a appendonly yes \u3002 AOF \u6301\u4e45\u5316\u76f8\u5bf9\u4e8e RDB \u6301\u4e45\u5316\u7684\u4f18\u70b9\u5728\u4e8e\u53ef\u4ee5\u5b9e\u65f6\u7684\u5bf9 Redis \u7f13\u5b58\u8fdb\u884c\u5199\u5165\u8bb0\u5f55\uff0c\u4fdd\u8bc1\u5feb\u901f\u6062\u590d\u7f13\u5b58\u65f6\u7684\u5b8c\u6574\u6027\u3002","title":"4. Redis \u6301\u4e45\u5316\u673a\u5236\u6709\u54ea\u4e9b\uff1f"},{"location":"chap10/4Redis_int_all/#5-redis-aof-rdb","text":"RDB \u548c AOF \u7684\u533a\u522b\uff1a \u6301\u4e45\u5316\u7684\u65b9\u5f0f\u4e0d\u540c \uff1a RDB \u6301\u4e45\u5316\u662f\u5728\u6307\u5b9a\u65f6\u95f4\u95f4\u9694\u5185\u4fdd\u5b58\u6570\u636e\u5feb\u7167\u5230\u786c\u76d8\u4e2d\uff08\u5feb\u7167\u7684\u65b9\u5f0f\uff09\u3002 AOF \u6301\u4e45\u5316\u662f\u628a\u547d\u4ee4\u8ffd\u52a0\u5230\u64cd\u4f5c\u65e5\u5fd7\u7684\u5c3e\u90e8\uff0c\u7136\u540e\u4fdd\u5b58\u6240\u6709\u5386\u53f2\u64cd\u4f5c\uff08\u8ffd\u52a0\u6587\u4ef6\uff09\u3002 \u6062\u590d\u7684\u6570\u636e\u5b89\u5168\u6027\u4e0d\u540c \uff1a RDB \u6062\u590d\u6570\u636e\u65f6\uff0c\u6062\u590d\u540e\u7684\u6570\u636e\u4e2d\uff0c\u5b58\u5728\u4e22\u5931\u6700\u8fd1\u4e00\u6b21\u751f\u6210\u5feb\u7167\u4e4b\u540e\u66f4\u6539\u7684\u6240\u6709\u6570\u636e\uff1b AOF \u6301\u4e45\u5316\u7684\u6570\u636e\u5b9e\u65f6\u6027\u548c\u5b89\u5168\u6027\u66f4\u9ad8 \u3002 \u7f13\u5b58\u6062\u590d\u7684\u901f\u5ea6\u4e0d\u540c \uff1a RDB \u4ea7\u751f\u7684\u6587\u4ef6\u7d27\u51d1\u538b\u7f29\u9ad8\uff0c\u8bfb\u53d6 RDB \u6587\u4ef6\u6062\u590d\u65f6\u901f\u5ea6\u6bd4 AOF \u5feb\uff1b \u7531\u4e8e AOF \u5b9e\u65f6\u8ffd\u52a0\u5199\u547d\u4ee4\uff0c\u6240\u4ee5 AOF \u7684\u7f13\u5b58\u6587\u4ef6\u4f53\u79ef\u6bd4\u8f83\u5927\uff0c \u4f46\u662f\u53ef\u4ee5\u901a\u8fc7\u91cd\u5199\uff08rewrite\uff09\u538b\u7f29 AOF \u6301\u4e45\u5316\u6587\u4ef6\u4f53\u79ef \u3002","title":"5. Redis \u6301\u4e45\u5316\u673a\u5236 AOF \u548c RDB \u6709\u54ea\u4e9b\u4e0d\u540c\u4e4b\u5904\uff1f"},{"location":"chap10/4Redis_int_all/#6-rdb","text":"\u5b83\u7684\u4f18\u70b9\u6709\uff1a RDB \u662f\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\u4e0a\u7684\u6570\u636e\u5feb\u7167\uff0c\u975e\u5e38\u9002\u5408\u4f7f\u7528\u5728\u5168\u91cf\u5907\u4efd\u7684\u60c5\u51b5\uff0c\u751f\u6210\u7684 RDB \u662f\u4e00\u4e2a\u7d27\u51d1\u538b\u7f29\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6 \u3002\u5feb\u7167\u4ea7\u751f\u7684 RDB \u6587\u4ef6\u53ef\u4ee5\u62f7\u8d1d\u5230\u8fdc\u7a0b\u673a\u5668\u6216\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u7528\u4e8e\u707e\u96be\u6062\u590d\uff1b RDB \u7684\u52a0\u8f7d\u6062\u590d\u6570\u636e\u901f\u5ea6\u5feb\u4e8e AOF \u7684\u6062\u590d\u65b9\u5f0f\u3002 \u5b83\u7684\u7f3a\u70b9\u6709\uff1a \u56e0\u4e3a bgsave \u6bcf\u6b21\u8fd0\u884c\u90fd\u8981\u6267\u884c fork \u64cd\u4f5c\u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u64cd\u4f5c\u6bd4\u8f83\u7e41\u7410 \uff0c\u5982\u679c\u5b9e\u65f6\u5b58\u50a8\u5feb\u7167\u4f1a\u5bfc\u81f4\u6210\u672c\u8fc7\u9ad8\uff0c\u6240\u4ee5 RDB \u53ea\u80fd\u5728\u7279\u5b9a\u6761\u4ef6\u4e0b\u8fdb\u884c\u4e00\u6b21\u6301\u4e45\u5316\uff0c\u4ece\u800c\u5bb9\u6613\u51fa\u73b0\u6570\u636e\u4e22\u5931\u7684\u60c5\u51b5\uff1b RDB \u6587\u4ef6\u662f\u4e00\u4e2a\u7279\u5b9a\u4e8c\u8fdb\u5236\u683c\u5f0f\u4fdd\u5b58\u7684\u6587\u4ef6\uff0cRedis \u7684\u7248\u672c\u66f4\u65b0\u8fc7\u7a0b\u4e2d\uff0c\u6709\u5bf9 RDB \u7684\u7248\u672c\u683c\u5f0f\u4fee\u6539 \uff0c\u4f1a\u51fa\u73b0\u8001\u7248\u672c\u7684 RDB \u6587\u4ef6\u65e0\u6cd5\u517c\u5bb9\u65b0\u7248\u672c\u7684 RDB \u683c\u5f0f\u95ee\u9898\u3002","title":"6. \u8bf7\u4ecb\u7ecd\u4e00\u4e0b RDB \u6301\u4e45\u5316\u673a\u5236\u7684\u4f18\u7f3a\u70b9"},{"location":"chap10/4Redis_int_all/#7-aof","text":"\u5b83\u7684\u4f18\u70b9\u6709\uff1a AOF \u6301\u4e45\u5316\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u975e\u5e38\u5b8c\u6574\uff0c\u6545\u969c\u6062\u590d\u65f6\u76f8\u5bf9 RDB \u6301\u4e45\u5316\u4e22\u5931\u7684\u6570\u636e\u6700\u5c11\uff1b \u7531\u4e8e AOF \u662f\u53ef\u4ee5\u5b9e\u65f6\u5bf9\u7f13\u5b58\u547d\u4ee4\u8ffd\u52a0\u5230 AOF \u6587\u4ef6\u7684\u672b\u5c3e\uff0c\u6240\u4ee5\u53ef\u4ee5\u5bf9\u5386\u53f2\u64cd\u4f5c\u7684\u7f13\u5b58\u547d\u4ee4\u8fdb\u884c\u5904\u7406\u3002 \u5b83\u7684\u7f3a\u70b9\u6709\uff1a \u7531\u4e8e AOF \u6301\u4e45\u5316\u662f\u4e0d\u65ad\u5bf9 AOF \u6587\u4ef6\u8fdb\u884c\u8ffd\u52a0\u8bb0\u5f55\u7684\uff0c\u4f1a\u5bfc\u81f4 AOF \u6587\u4ef6\u4f53\u79ef\u5f88\u5927\uff0c\u6781\u7aef\u7684\u60c5\u51b5\u4e0b\u53ef\u80fd\u4f1a\u51fa\u73b0 AOF \u6587\u4ef6\u7528\u5b8c\u786c\u76d8\u7684\u53ef\u7528\u7a7a\u95f4\uff1b\u4f46\u662f Redis 2.4 \u7248\u672c\u4ee5\u540e\u652f\u6301 AOF \u81ea\u52a8\u91cd\u5199\uff0c\u6709\u6548\u7684\u89e3\u51b3 AOF \u6587\u4ef6\u8fc7\u5927\u7684\u95ee\u9898\uff1b \u5f53 AOF \u6587\u4ef6\u4f53\u79ef\u5f88\u5927\u65f6\uff0c\u4f1a\u51fa\u73b0\u6062\u590d\u901f\u5ea6\u6162\uff0c\u5bf9\u6027\u80fd\u5f71\u54cd\u5927\u7684\u95ee\u9898\uff1b \u5f53\u5f00\u542f AOF \u540e\uff0c\u5bf9 QPS \u4f1a\u6709\u4e00\u5b9a\u5f71\u54cd\uff0c\u76f8\u5bf9 RDB \u6765\u8bf4\uff0c\u5199 QPS \u4f1a\u4e0b\u964d\u3002","title":"7. \u8bf7\u4ecb\u7ecd\u4e00\u4e0b AOF \u6301\u4e45\u5316\u673a\u5236\u7684\u4f18\u7f3a\u70b9"},{"location":"chap10/4Redis_int_all/#8-aof-redis","text":"\u5982\u679c AOF \u6587\u4ef6\u6570\u636e\u51fa\u73b0\u5f02\u5e38\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u7684\u4e00\u81f4\u6027\uff0cRedis \u670d\u52a1\u5668\u4f1a\u62d2\u7edd\u52a0\u8f7d AOF \u6587\u4ef6\u3002\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528 redis-check-aof -fix \u547d\u4ee4\u4fee\u590d\u3002","title":"8. \u5982\u679c AOF \u6587\u4ef6\u7684\u6570\u636e\u51fa\u73b0\u5f02\u5e38\uff0cRedis \u670d\u52a1\u600e\u4e48\u5904\u7406\uff1f"},{"location":"chap10/4Redis_int_all/#12","text":"","title":"\u4e94\u3001\u96c6\u7fa4\u3001\u590d\u5236\uff0812 \u9898\uff09"},{"location":"chap10/4Redis_int_all/#1-redis_3","text":"\u4f7f\u7528\u8fc7 Redis \u96c6\u7fa4\uff0c\u5b83\u7684\u539f\u7406\u662f\uff1a \u6240\u6709\u7684\u8282\u70b9\u76f8\u4e92\u8fde\u63a5 \u96c6\u7fa4\u6d88\u606f\u901a\u4fe1\u901a\u8fc7\u96c6\u7fa4\u603b\u7ebf\u901a\u4fe1\uff0c\u96c6\u7fa4\u603b\u7ebf\u7aef\u53e3\u5927\u5c0f\u4e3a\u5ba2\u6237\u7aef\u670d\u52a1\u7aef\u53e3 + 10000\uff08\u56fa\u5b9a\u503c\uff09 \u8282\u70b9\u4e0e\u8282\u70b9\u4e4b\u95f4\u901a\u8fc7\u4e8c\u8fdb\u5236\u534f\u8bae\u8fdb\u884c\u901a\u4fe1 \u5ba2\u6237\u7aef\u548c\u96c6\u7fa4\u8282\u70b9\u4e4b\u95f4\u901a\u4fe1\u548c\u901a\u5e38\u4e00\u6837\uff0c\u901a\u8fc7\u6587\u672c\u534f\u8bae\u8fdb\u884c \u96c6\u7fa4\u8282\u70b9\u4e0d\u4f1a\u4ee3\u7406\u67e5\u8be2 \u6570\u636e\u6309\u7167 Slot \u5b58\u50a8\u5206\u5e03\u5728\u591a\u4e2a Redis \u5b9e\u4f8b\u4e0a \u96c6\u7fa4\u8282\u70b9\u6302\u6389\u4f1a\u81ea\u52a8\u6545\u969c\u8f6c\u79fb \u53ef\u4ee5\u76f8\u5bf9\u5e73\u6ed1\u6269/\u7f29\u5bb9\u8282\u70b9 Redis \u96c6\u7fa4\u4e2d\u5185\u7f6e\u4e86 16384 \u4e2a\u54c8\u5e0c\u69fd\uff0c\u5f53\u9700\u8981\u5728 Redis \u96c6\u7fa4\u4e2d\u653e\u7f6e\u4e00\u4e2a key-value \u65f6\uff0credis \u5148\u5bf9 key \u4f7f\u7528 crc16 \u7b97\u6cd5\u7b97\u51fa\u4e00\u4e2a\u7ed3\u679c\uff0c\u7136\u540e\u628a\u7ed3\u679c\u5bf9 16384 \u6c42\u4f59\u6570\uff0c\u8fd9\u6837\u6bcf\u4e2a key \u90fd\u4f1a\u5bf9\u5e94\u4e00\u4e2a\u7f16\u53f7\u5728 0~16383 \u4e4b\u95f4\u7684\u54c8\u5e0c\u69fd\uff0credis \u4f1a\u6839\u636e\u8282\u70b9\u6570\u91cf\u5927\u81f4\u5747\u7b49\u7684\u5c06\u54c8\u5e0c\u69fd\u6620\u5c04\u5230\u4e0d\u540c\u7684\u8282\u70b9\u3002","title":"1. \u662f\u5426\u4f7f\u7528\u8fc7 Redis \u96c6\u7fa4\uff0c\u96c6\u7fa4\u7684\u539f\u7406\u662f\u4ec0\u4e48\uff1f"},{"location":"chap10/4Redis_int_all/#2-redis_2","text":"Redis \u6ca1\u6709\u4f7f\u7528\u54c8\u5e0c\u4e00\u81f4\u6027\u7b97\u6cd5\uff0c\u800c\u662f\u4f7f\u7528\u54c8\u5e0c\u69fd\u3002Redis \u4e2d\u7684\u54c8\u5e0c\u69fd\u4e00\u5171\u6709 16384 \u4e2a\uff0c\u8ba1\u7b97\u7ed9\u5b9a\u5bc6\u94a5\u7684\u54c8\u5e0c\u69fd\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5bf9\u5bc6\u94a5\u7684 CRC16 \u53d6\u6478 16384\u3002\u5047\u8bbe\u96c6\u7fa4\u4e2d\u6709 A\u3001B\u3001C \u4e09\u4e2a\u96c6\u7fa4\u8282\u70b9\uff0c\u4e0d\u5b58\u5728\u590d\u5236\u6a21\u5f0f\u4e0b\uff0c\u6bcf\u4e2a\u96c6\u7fa4\u7684\u8282\u70b9\u5305\u542b\u7684\u54c8\u5e0c\u69fd\u5982\u4e0b\uff1a \u8282\u70b9 A \u5305\u542b\u4ece 0 \u5230 5500 \u7684\u54c8\u5e0c\u69fd\uff1b \u8282\u70b9 B \u5305\u542b\u4ece 5501 \u5230 11000 \u7684\u54c8\u5e0c\u69fd\uff1b \u8282\u70b9 C \u5305\u542b\u4ece 11001 \u5230 16383 \u7684\u54c8\u5e0c\u69fd\uff1b \u8fd9\u65f6\uff0c\u5982\u679c\u8282\u70b9 B \u51fa\u73b0\u6545\u969c\uff0c\u6574\u4e2a\u96c6\u7fa4\u5c31\u4f1a\u51fa\u73b0\u7f3a\u5c11 5501 \u5230 11000 \u7684\u54c8\u5e0c\u69fd\u8303\u56f4\u800c\u4e0d\u53ef\u7528\u3002","title":"2. Redis \u96c6\u7fa4\u65b9\u6848\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u5bfc\u81f4\u6574\u4e2a\u96c6\u7fa4\u4e0d\u53ef\u7528\uff1f"},{"location":"chap10/4Redis_int_all/#3-redis_3","text":"Redis \u96c6\u7fa4\u67b6\u6784\u662f\u652f\u6301\u5355\u8282\u70b9\u5355\u673a\u6a21\u5f0f\u7684\uff0c\u4e5f\u652f\u6301\u4e00\u4e3b\u591a\u4ece\u7684\u4e3b\u4ece\u7ed3\u6784\uff0c\u8fd8\u652f\u6301\u5e26\u6709\u54e8\u5175\u7684\u96c6\u7fa4\u90e8\u7f72\u6a21\u5f0f\u3002","title":"3. Redis \u96c6\u7fa4\u67b6\u6784\u6a21\u5f0f\u6709\u54ea\u51e0\u79cd\uff1f"},{"location":"chap10/4Redis_int_all/#4-redis_1","text":"Redis \u96c6\u7fa4\u5e76\u6ca1\u6709\u4f7f\u7528\u4e00\u81f4\u6027 hash\uff0c\u800c\u662f\u5f15\u5165\u4e86\u54c8\u5e0c\u69fd\u7684\u6982\u5ff5\u3002Redis \u96c6\u7fa4\u6709 16384\uff082^14\uff09\u4e2a\u54c8\u5e0c\u69fd\uff0c\u6bcf\u4e2a key \u901a\u8fc7 CRC16 \u6821\u9a8c\u540e\u5bf9 16384 \u53d6\u6a21\u6765\u51b3\u5b9a\u653e\u7f6e\u54ea\u4e2a\u69fd\uff0c\u96c6\u7fa4\u7684\u6bcf\u4e2a\u8282\u70b9\u8d1f\u8d23\u4e00\u90e8\u5206 hash \u69fd\u3002","title":"4. \u8bf4\u8bf4 Redis \u54c8\u5e0c\u69fd\u7684\u6982\u5ff5\uff1f"},{"location":"chap10/4Redis_int_all/#5-redis_1","text":"Redis \u96c6\u7fa4\u652f\u6301\u7684\u4e3b\u4ece\u590d\u5236\uff0c\u6570\u636e\u540c\u6b65\u4e3b\u8981\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a \u4e00\u79cd\u662f\u5168\u91cf\u540c\u6b65\uff0c\u4e00\u79cd\u662f\u589e\u91cf\u540c\u6b65 \u3002 1. \u5168\u91cf\u540c\u6b65 \u521a\u5f00\u59cb\u642d\u5efa\u4e3b\u4ece\u6a21\u5f0f\u65f6\uff0c\u4ece\u673a\u9700\u8981\u4ece\u4e3b\u673a\u4e0a\u83b7\u53d6\u6240\u6709\u6570\u636e\uff0c\u8fd9\u65f6\u5c31\u9700\u8981 Slave \u5c06 Master \u4e0a\u6240\u6709\u7684\u6570\u636e\u8fdb\u884c\u540c\u6b65\u590d\u5236\u3002\u590d\u5236\u7684\u6b65\u9aa4\u4e3a\uff1a \u4ece\u670d\u52a1\u5668\u53d1\u9001 SYNC \u547d\u4ee4\uff0c\u94fe\u63a5\u4e3b\u670d\u52a1\u5668 \uff1b \u4e3b\u670d\u52a1\u5668\u6536\u5230 SYNC \u547d\u4ee4\u540e\uff0c\u8fdb\u884c\u5b58\u76d8\u7684\u64cd\u4f5c\uff0c\u5e76\u7ee7\u7eed\u6536\u96c6\u540e\u7eed\u7684\u5199\u547d\u4ee4\uff0c\u5b58\u50a8\u7f13\u51b2\u533a \uff1b \u5b58\u76d8\u7ed3\u675f\u540e\uff0c\u5c06\u5bf9\u5e94\u7684\u6570\u636e\u6587\u4ef6\u53d1\u9001\u5230 Slave \u4e2d\uff0c\u5b8c\u6210\u4e00\u6b21\u5168\u91cf\u540c\u6b65 \uff1b \u4e3b\u670d\u52a1\u6570\u636e\u53d1\u9001\u5b8c\u6bd5\u540e\uff0c\u5c06\u8fdb\u884c\u589e\u91cf\u7684\u7f13\u51b2\u533a\u6570\u636e\u540c\u6b65\uff1b Slave \u52a0\u8f7d\u6570\u636e\u6587\u4ef6\u548c\u7f13\u51b2\u533a\u6570\u636e\uff0c\u5f00\u59cb\u63a5\u53d7\u547d\u4ee4\u8bf7\u6c42\uff0c\u63d0\u4f9b\u64cd\u4f5c \u3002 2. \u589e\u91cf\u540c\u6b65 \u4ece\u8282\u70b9\u5b8c\u6210\u4e86\u5168\u91cf\u540c\u6b65\u540e\uff0c\u5c31\u53ef\u4ee5\u6b63\u5f0f\u7684\u5f00\u542f\u589e\u91cf\u5907\u4efd\u3002 \u5f53 Master \u8282\u70b9\u6709\u5199\u64cd\u4f5c\u65f6\uff0c\u90fd\u4f1a\u81ea\u52a8\u540c\u6b65\u5230 Slave \u8282\u70b9\u4e0a\u3002Master \u8282\u70b9\u6bcf\u6267\u884c\u4e00\u4e2a\u547d\u4ee4\uff0c\u90fd\u4f1a\u540c\u6b65\u5411 Slave \u670d\u52a1\u5668\u53d1\u9001\u76f8\u540c\u7684\u5199\u547d\u4ee4\uff0c\u5f53\u4ece\u670d\u52a1\u5668\u63a5\u6536\u5230\u547d\u4ee4\uff0c\u4f1a\u540c\u6b65\u6267\u884c\u3002","title":"5. Redis \u96c6\u7fa4\u7684\u4e3b\u4ece\u590d\u5236\u6a21\u578b\u662f\u600e\u6837\u7684\uff1f"},{"location":"chap10/4Redis_int_all/#6-redis_1","text":"Redis \u96c6\u7fa4\u4e2d\u6709\u53ef\u80fd\u5b58\u5728\u5199\u64cd\u4f5c\u4e22\u5931\u7684\u95ee\u9898\uff0c\u4f46\u662f\u4e22\u5931\u6982\u7387\u4e00\u822c\u53ef\u4ee5\u5ffd\u7565\u4e0d\u8ba1\u3002\u4e3b\u8981\u662f Redis \u5e76\u6ca1\u6709\u4e00\u4e2a\u673a\u5236\u4fdd\u8bc1\u6570\u636e\u4e00\u5b9a\u5199\u4e0d\u4e22\u5931\u3002\u5728\u4ee5\u4e0b\u95ee\u9898\u4e2d\u53ef\u80fd\u51fa\u73b0\u952e\u503c\u4e22\u5931\u7684\u95ee\u9898\uff1a 1. \u8d85\u8fc7\u5185\u5b58\u7684\u6700\u5927\u503c\uff0c\u952e\u503c\u88ab\u6e05\u7406 Redis \u4e2d\u53ef\u4ee5\u8bbe\u7f6e\u7f13\u5b58\u7684\u6700\u5927\u5185\u5b58\u503c\uff0c\u5f53\u5185\u5b58\u4e2d\u7684\u6570\u636e\u603b\u91cf\u5927\u4e8e\u8bbe\u7f6e\u7684\u6700\u5927\u5185\u5b58\u503c\uff0c\u4f1a\u5bfc\u81f4 Redis \u5bf9\u90e8\u5206\u6570\u636e\u8fdb\u884c\u6e05\u7406\uff0c\u5bfc\u81f4\u952e\u503c\u4e22\u5931\u7684\u95ee\u9898\u3002 2. \u5927\u91cf\u7684 key \u8fc7\u671f\uff0c\u88ab\u6e05\u7406 \u8fd9\u79cd\u60c5\u51b5\u6bd4\u8f83\u6b63\u5e38\uff0c\u53ea\u662f\u56e0\u4e3a\u952e\u503c\u8bbe\u7f6e\u7684\u65f6\u95f4\u8fc7\u671f\u4e86\uff0c\u88ab\u81ea\u52a8\u6e05\u7406\u4e86\u3002 3. Redis \u4e3b\u5e93\u670d\u52a1\u5668\u6545\u969c\u91cd\u542f \u7531\u4e8e Redis \u7684\u6570\u636e\u662f\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u5982\u679c Redis \u4e3b\u5e93\u670d\u52a1\u5668\u51fa\u73b0\u6545\u969c\u91cd\u542f\uff0c\u4f1a\u51fa\u73b0\u6570\u636e\u88ab\u6e05\u7a7a\u7684\u95ee\u9898\u3002 \u8fd9\u65f6\u53ef\u80fd\u5bfc\u81f4\u4ece\u5e93\u7684\u6570\u636e\u540c\u6b65\u88ab\u6e05\u7a7a\u3002\u5982\u679c\u6709\u4f7f\u7528\u6570\u636e\u6301\u4e45\u5316\uff0c\u90a3\u4e48\u6545\u969c\u91cd\u542f\u540e\u6570\u636e\u662f\u53ef\u4ee5\u81ea\u52a8\u6062\u590d\u7684\u3002 4. \u7f51\u7edc\u95ee\u9898 \u53ef\u80fd\u51fa\u73b0\u7f51\u7edc\u6545\u969c\uff0c\u5bfc\u81f4\u77ed\u65f6\u95f4\u5185\u6570\u636e\u5199\u5165\u5931\u8d25\u3002","title":"6. Redis \u96c6\u7fa4\u4f1a\u6709\u5199\u64cd\u4f5c\u4e22\u5931\u5417\uff1f\u4e3a\u4ec0\u4e48\uff1f"},{"location":"chap10/4Redis_int_all/#7-redis_2","text":"\u4f7f\u7528\u5f02\u6b65\u590d\u5236\u3002","title":"7. Redis \u96c6\u7fa4\u4e4b\u95f4\u662f\u5982\u4f55\u590d\u5236\u7684\uff1f"},{"location":"chap10/4Redis_int_all/#8-redis_3","text":"Redis \u96c6\u7fa4\u6709 16384 \u4e2a\u54c8\u5e0c\u69fd\u3002","title":"8. Redis \u96c6\u7fa4\u6700\u5927\u8282\u70b9\u4e2a\u6570\u662f\u591a\u5c11\uff1f"},{"location":"chap10/4Redis_int_all/#9-redis_1","text":"Redis \u96c6\u7fa4\u4e0d\u652f\u6301\u9009\u62e9\u6570\u636e\u5e93\u64cd\u4f5c\uff0c\u9ed8\u8ba4\u5728 0 \u6570\u636e\u5e93\u3002","title":"9. Redis \u96c6\u7fa4\u5982\u4f55\u9009\u62e9\u6570\u636e\u5e93\uff1f"},{"location":"chap10/4Redis_int_all/#10-redis_3","text":"Redis \u53ef\u4ee5\u4f7f\u7528\u7684\u96c6\u7fa4\u65b9\u6cd5\u6709\uff1a Redis cluster 3.0\uff1a\u8fd9\u662f Redis \u81ea\u5e26\u7684\u96c6\u7fa4\u529f\u80fd\uff0c\u5b83\u91c7\u7528\u7684\u5206\u5e03\u5f0f\u7b97\u6cd5\u662f\u54c8\u5e0c\u69fd\uff0c\u800c\u4e0d\u662f\u4e00\u81f4\u6027 hash\u3002\u652f\u6301\u4e3b\u4ece\u7ed3\u6784\uff0c\u53ef\u4ee5\u6269\u5c55\u591a\u4e2a\u4ece\u670d\u52a1\u5668\uff0c\u5f53\u4e3b\u8282\u70b9\u6302\u4e86\u53ef\u4ee5\u5f88\u5feb\u7684\u5207\u6362\u5230\u4e00\u4e2a\u4ece\u8282\u70b9\u505a\u4e3b\u8282\u70b9\uff0c\u7136\u540e\u4ece\u8282\u70b9\u90fd\u8bfb\u53d6\u5230\u65b0\u7684\u4e3b\u8282\u70b9\u3002 Twemproxy\uff0c\u5b83\u662f Twitter \u5f00\u6e90\u7684\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u540e\u7aef\u4ee3\u7406\uff0c\u53ef\u4ee5\u7ba1\u7406 Redis \u6216 Memcache \u96c6\u7fa4\u3002\u5b83\u76f8\u5bf9\u4e8e Redis \u96c6\u7fa4\u6765\u8bf4\uff0c\u6613\u4e8e\u7ba1\u7406\u3002\u5b83\u7684\u4f7f\u7528\u65b9\u6cd5\u548c Redis \u96c6\u7fa4\u6ca1\u6709\u4efb\u4f55\u533a\u522b\uff0c\u53ea\u9700\u8981\u8bbe\u7f6e\u597d\u591a\u4e2a Redis \u5b9e\u4f8b\u540e\uff0c\u5728\u672c\u9700\u8981\u8fde\u63a5 redis \u7684\u5730\u65b9\u6539\u4e3a\u8fde\u63a5 Twemproxy\uff0c\u5b83\u4f1a\u4ee5\u4e00\u4e2a\u4ee3\u7406\u7684\u8eab\u4efd\u63a5\u6536\u8bf7\u6c42\u5e76\u4f7f\u7528\u4e00\u81f4\u6027 hash \u7b97\u6cd5\uff0c\u5c06\u8bf7\u6c42\u8f6c\u63a5\u5230\u5177\u4f53 Redis \u8282\u70b9\uff0c\u5c06\u7ed3\u679c\u518d\u8fd4\u56de Twemproxy\u3002\u5bf9\u4e8e\u5ba2\u6237\u7aef\u6765\u8bf4\uff0cTwemproxy \u76f8\u5f53\u4e8e\u662f\u7f13\u5b58\u6570\u636e\u5e93\u7684\u5165\u53e3\uff0c\u5b83\u4e0d\u9700\u8981\u77e5\u9053\u540e\u7aef\u5982\u4f55\u90e8\u7f72\u7684\u3002Twemproxy \u4f1a\u68c0\u6d4b\u4e0e\u6bcf\u4e2a\u8282\u70b9\u7684\u8fde\u63a5\u662f\u5426\u6b63\u5e38\uff0c\u5982\u679c\u5b58\u5728\u5f02\u5e38\u8282\u70b9\uff0c\u5219\u4f1a\u88ab\u5254\u9664\uff0c\u7b49\u4e00\u6bb5\u65f6\u95f4\u540e\uff0cTwemproxy \u8fd8\u4f1a\u518d\u6b21\u5c1d\u8bd5\u8fde\u63a5\u88ab\u5254\u9664\u7684\u8282\u70b9\u3002 Codis\uff0c\u5b83\u662f\u4e00\u4e2a Redis \u5206\u5e03\u5f0f\u7684\u89e3\u51b3\u65b9\u5f0f\uff0c\u5bf9\u4e8e\u5e94\u7528\u4f7f\u7528 Codis Proxy \u7684\u8fde\u63a5\u548c\u4f7f\u7528 Redis \u670d\u52a1\u7684\u6ca1\u6709\u660e\u663e\u5dee\u522b\uff0c\u5e94\u7528\u80fd\u591f\u50cf\u4f7f\u7528\u5355\u673a Redis \u4e00\u6837\uff0c\u8ba9 Codis \u5e95\u5c42\u5904\u7406\u8bf7\u6c42\u8f6c\u53d1\uff0c\u4e0d\u505c\u673a\u7684\u6570\u636e\u8fc1\u79fb\u7b49\u5de5\u4f5c\u3002","title":"10. Redis \u96c6\u7fa4\u65b9\u6848\u5e94\u8be5\u600e\u4e48\u505a\uff0c\u6709\u54ea\u4e9b\u65b9\u6848\uff1f"},{"location":"chap10/4Redis_int_all/#11-redis-sentinel","text":"Redis \u54e8\u5175\u7684\u597d\u5904\u5728\u4e8e\u53ef\u4ee5\u4fdd\u8bc1\u7cfb\u7edf\u7684\u9ad8\u53ef\u7528\uff0c\u5404\u4e2a\u8282\u70b9\u53ef\u4ee5\u5bf9\u6545\u969c\u81ea\u52a8\u8f6c\u79fb \u3002 \u4f46\u7f3a\u70b9\u662f\u4f7f\u7528\u7684\u4e3b\u4ece\u6a21\u5f0f\uff0c\u4e3b\u8282\u70b9\u5355\u70b9\u98ce\u9669\u9ad8\uff0c\u4e3b\u4ece\u5207\u6362\u8fc7\u7a0b\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e22\u5931\u6570\u636e\u7684\u95ee\u9898\u3002","title":"11. Redis sentinel\uff08\u54e8\u5175\uff09\u6a21\u5f0f\u4f18\u7f3a\u70b9\u6709\u54ea\u4e9b\uff1f"},{"location":"chap10/4Redis_int_all/#12-redis_2","text":"\u4e3b\u4ece\u590d\u5236\u7684\u6a21\u5f0f\u76f8\u5bf9\u4e8e\u5355\u8282\u70b9\u7684\u597d\u5904\u5728\u4e8e\uff0c\u5b9e\u884c\u8bfb\u5199\u5206\u79bb\u63d0\u9ad8\u4e86\u7cfb\u7edf\u7684\u8bfb\u5199\u6548\u7387\uff0c\u63d0\u9ad8\u4e86\u7f51\u7ad9\u6570\u636e\u7684\u8bfb\u53d6\u52a0\u8f7d\u901f\u5ea6\u3002 \u4f46\u662f\u7f3a\u70b9\u662f\u7531\u4e8e\u5199\u6570\u636e\u4e3b\u8981\u5728\u4e3b\u8282\u70b9\u4e0a\u64cd\u4f5c\uff0c\u4e3b\u8282\u70b9\u5185\u5b58\u7a7a\u95f4\u6709\u9650\uff0c\u5e76\u4e14\u4e3b\u8282\u70b9\u5b58\u5728\u5355\u70b9\u98ce\u9669\u3002","title":"12. Redis \u7684\u4e3b\u4ece\u590d\u5236\u6a21\u5f0f\u6709\u4ec0\u4e48\u4f18\u7f3a\u70b9\uff1f"},{"location":"chap10/4Redis_int_all/#20_1","text":"","title":"\u516d\u3001\u6027\u80fd\u4f18\u5316\uff0820 \u9898\uff09"},{"location":"chap10/4Redis_int_all/#1-redis_4","text":"\u5e38\u89c1\u95ee\u9898\u53ca\u89e3\u51b3\u529e\u6cd5\u6709\uff1a Master \u6700\u597d\u4e0d\u8981\u5199\u5185\u5b58\u5feb\u7167\uff0c\u5982\u679c Master \u5199\u5185\u5b58\u5feb\u7167\uff0csave \u547d\u4ee4\u8c03\u5ea6 rdbSave \u51fd\u6570\uff0c\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u7684\u5de5\u4f5c\uff0c\u5f53\u5feb\u7167\u6bd4\u8f83\u5927\u65f6\u5bf9\u6027\u80fd\u5f71\u54cd\u662f\u975e\u5e38\u5927\u7684\uff0c\u4f1a\u95f4\u65ad\u6027\u6682\u505c\u670d\u52a1 \u5982\u679c\u6570\u636e\u6bd4\u8f83\u91cd\u8981\uff0c\u67d0\u4e2a Slave \u5f00\u542f AOF \u5907\u4efd\u6570\u636e\uff0c\u7b56\u7565\u8bbe\u7f6e\u4e3a\u6bcf\u79d2\u540c\u6b65\u4e00 \u4e3a\u4e86\u4e3b\u4ece\u590d\u5236\u7684\u901f\u5ea6\u548c\u8fde\u63a5\u7684\u7a33\u5b9a\u6027\uff0cMaster \u548c Slave \u6700\u597d\u5728\u540c\u4e00\u4e2a\u5c40\u57df\u7f51 \u5c3d\u91cf\u907f\u514d\u5728\u538b\u529b\u5f88\u5927\u7684\u4e3b\u5e93\u4e0a\u589e\u52a0\u4ece \u4e3b\u4ece\u590d\u5236\u4e0d\u8981\u7528\u56fe\u72b6\u7ed3\u6784\uff0c\u7528\u5355\u5411\u94fe\u8868\u7ed3\u6784\u66f4\u4e3a\u7a33\u5b9a\uff0c\u5373\uff1aMaster <- Slave1<- Slave2 <- Slave3\u2026 \u8fd9\u6837\u7684\u7ed3\u6784\u65b9\u4fbf\u89e3\u51b3\u5355\u70b9\u6545\u969c\u95ee\u9898\uff0c\u5b9e\u73b0 Slave \u5bf9 Master \u7684\u66ff\u6362\u3002\u5982\u679c Master \u6302\u4e86\uff0c\u53ef\u4ee5\u7acb\u523b\u542f\u7528 Slave1 \u505a Master\uff0c\u5176\u4ed6\u4e0d\u53d8\u3002","title":"1. Redis \u5e38\u89c1\u6027\u80fd\u95ee\u9898\u548c\u89e3\u51b3\u65b9\u6848\u6709\u54ea\u4e9b\uff1f"},{"location":"chap10/4Redis_int_all/#2-redis_3","text":"\u8fc7\u671f\u952e\u7684\u5220\u9664\u7b56\u7565\u662f\u5c06\u60f0\u6027\u5220\u9664\u7b56\u7565\u548c\u5b9a\u671f\u5220\u9664\u7b56\u7565\u7ec4\u5408\u4f7f\u7528\u3002","title":"2. Redis \u8fc7\u671f\u952e\u7684\u5220\u9664\u7b56\u7565\uff1f"},{"location":"chap10/4Redis_int_all/#1_1","text":"\u8be5\u7b56\u7565\u7684\u4f5c\u7528\u662f\u7ed9 key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u540c\u65f6\uff0c\u7ed9 key \u521b\u5efa\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u5b9a\u65f6\u5668\u5728 key \u7684\u8fc7\u671f\u65f6\u95f4\u6765\u4e34\u65f6\uff0c\u5bf9\u8fd9\u4e9b key \u8fdb\u884c\u5220\u9664\u3002 \u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u4fdd\u8bc1\u5185\u5b58\u7a7a\u95f4\u5f97\u4ee5\u91ca\u653e\u3002\u4f46\u662f\u7f3a\u70b9\u662f\u7ed9 key \u521b\u5efa\u4e00\u4e2a\u5b9a\u65f6\u5668\u4f1a\u6709\u4e00\u5b9a\u7684\u6027\u80fd\u635f\u5931\u3002\u5982\u679c key \u5f88\u591a\uff0c\u5220\u9664\u8fd9\u4e9b key \u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u4e5f\u4f1a\u5360\u7528 CPU \u5f88\u591a\u65f6\u95f4\u3002","title":"1. \u5b9a\u65f6\u5220\u9664\u7b56\u7565"},{"location":"chap10/4Redis_int_all/#2_2","text":"\u6bcf\u6b21\u4ece\u6570\u636e\u5e93\u53d6 key \u7684\u65f6\u5019\u68c0\u67e5 key \u662f\u5426\u8fc7\u671f\uff0c\u5982\u679c\u8fc7\u671f\u5219\u5220\u9664\uff0c\u5e76\u8fd4\u56de null\uff0c\u5982\u679c key \u6ca1\u6709\u8fc7\u671f\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\u6570\u636e\u3002 \u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u5360\u7528 CPU \u7684\u65f6\u95f4\u6bd4\u8f83\u5c11\u3002 \u4f46\u662f\u7f3a\u70b9\u662f\u5982\u679c key \u5f88\u957f\u65f6\u95f4\u6ca1\u6709\u88ab\u83b7\u53d6\uff0c\u5c06\u4e0d\u4f1a\u88ab\u5220\u9664\uff0c\u5bb9\u6613\u9020\u6210\u5185\u5b58\u6cc4\u9732 \u3002","title":"2. \u60f0\u6027\u5220\u9664\u7b56\u7565"},{"location":"chap10/4Redis_int_all/#3_1","text":"\u8be5\u7b56\u7565\u7684\u4f5c\u7528\u662f\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u6267\u884c\u4e00\u6b21\u5220\u9664\u8fc7\u671f key \u7684\u64cd\u4f5c\uff0c\u8be5\u5220\u9664\u9891\u7387\u53ef\u4ee5\u5728 redis.conf \u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u3002 \u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u53ef\u4ee5\u907f\u514d\u60f0\u6027\u5220\u9664\u65f6\u51fa\u73b0\u5185\u5b58\u6cc4\u9732\u7684\u95ee\u9898\uff0c\u901a\u8fc7\u8bbe\u7f6e\u5220\u9664\u64cd\u4f5c\u7684\u65f6\u957f\u9891\u7387\uff0c\u53ef\u4ee5\u51cf\u5c11 CPU \u65f6\u95f4\u7684\u5360\u7528\u3002 \u4f46\u662f\u7f3a\u70b9\u662f\u76f8\u5bf9\u5185\u5b58\u6027\u80fd\u53cb\u597d\u6765\u8bf4\uff0c\u8be5\u7b56\u7565\u4e0d\u5982\u5b9a\u65f6\u5220\u9664\u7b56\u7565\uff0c\u76f8\u5bf9 CPU \u6027\u80fd\u53cb\u597d\u6765\u8bf4\uff0c\u8be5\u7b56\u7565\u4e0d\u5982\u60f0\u6027\u5220\u9664\u7b56\u7565\u3002 Redis \u91c7\u7528\u7684\u5220\u9664\u7b56\u7565\u662f\u5c06\u60f0\u6027\u5220\u9664\u7b56\u7565\u548c\u5b9a\u671f\u5220\u9664\u7b56\u7565\u7ec4\u5408\u4f7f\u7528\u3002","title":"3. \u5b9a\u671f\u5220\u9664\u7b56\u7565"},{"location":"chap10/4Redis_int_all/#3-redis_4","text":"Redis \u63d0\u4f9b\u4e86 6 \u79cd\u6dd8\u6c70\u7b56\u7565\uff1a volatile-lru \uff1a\u8be5\u6dd8\u6c70\u7b56\u7565\u662f\u88ab\u4f7f\u7528\u6700\u591a\u7684\u4e00\u79cd\uff0c\u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6 \uff08server.db [i].expires\uff09 \u4e2d\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70 \uff1b\u800c\u6ca1\u6709\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684 key \u4e0d\u4f1a\u88ab\u6dd8\u6c70\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u9700\u8981\u6301\u4e45\u5316\u7684\u6570\u636e\u4e0d\u4f1a\u7a81\u7136\u4e22\u5931\uff1b volatile-ttl \uff1a\u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\uff08 server.db [i].expires \uff09\u4e2d\u6311\u9009\u5c06\u8981\u8fc7\u671f\u7684\u6570\u636e\u6dd8\u6c70 \uff0c\u5b83\u548c volatile-lru \u7684\u533a\u522b\u5728\u4e8e key \u7684\u5269\u4f59\u751f\u5b58\u65f6\u95f4 ttl \u7684\u503c\u8d8a\u5c0f\u8d8a\u4f18\u5148\u88ab\u6dd8\u6c70\uff0c\u800c volatile-lru \u662f\u6839\u636e\u4f7f\u7528\u7a0b\u5ea6\u8d8a\u5c0f\u8d8a\u88ab\u6dd8\u6c70\uff1b volatile-random \uff1a\u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\uff08 server.db [i].expires \uff09\u4e2d\u968f\u673a\u9009\u62e9\u6570\u636e\u6dd8\u6c70 \uff1b allkeys-lru \uff1a\u4ece\u6570\u636e\u96c6\uff08 server.db [i].dic t\uff09\u4e2d\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70\uff1b\u5b83\u548c volatile-lru \u6dd8\u6c70\u673a\u5236\u7684\u533a\u522b\u5728\u4e8e allkeys-lru \u9488\u5bf9\u7684\u662f\u5168\u4f53 key \u5bf9\u8c61\uff0c\u6dd8\u6c70\u7684 key \u4e0d\u53ea\u662f\u5305\u62ec\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684 key \uff0c\u4e5f\u5305\u62ec\u4e86\u6ca1\u6709\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684 key\u3002\u800c volatile-lru \u4e3b\u8981\u662f\u9488\u5bf9\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684 key \u8fdb\u884c\u6dd8\u6c70\uff1b allkeys-random \uff1a\u4ece\u6570\u636e\u96c6\uff08server.db [i].dict\uff09\u4e2d\u968f\u673a\u9009\u62e9\u6570\u636e\u6dd8\u6c70 \uff1b no-enviction \uff1aRedis \u9ed8\u8ba4\u4f7f\u7528\u8fd9\u79cd\u6dd8\u6c70\u7b56\u7565\uff0c\u5f53\u5185\u5b58\u8fbe\u5230\u9650\u5236\u7684\u65f6\u5019\uff0c\u4e0d\u6dd8\u6c70\u4efb\u4f55\u6570\u636e\uff0c\u4e0d\u53ef\u5199\u5165\u4efb\u4f55\u6570\u636e\u96c6\uff0c\u6240\u6709\u5f15\u8d77\u7533\u8bf7\u5185\u5b58\u7684\u547d\u4ee4\u4f1a\u62a5\u9519\u3002 \u5b83\u7684\u4f18\u70b9\u5728\u4e8e\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u4e0d\u88ab\u4e22\u5931\uff0c\u4f46\u662f\u5b83\u7684\u7f3a\u70b9\u662f\u4f1a\u5bfc\u81f4\u7ebf\u4e0a\u7684\u4e1a\u52a1\u4e0d\u80fd\u6301\u7eed\u8fdb\u884c\u7684\u95ee\u9898\u3002\u8fd9\u4e2a\u6dd8\u6c70\u7b56\u7565\u4e0b\u9664\u4e86 DEL \u8bf7\u6c42\u548c\u8bfb\u8bf7\u6c42\u670d\u52a1\u53ef\u4ee5\u7ee7\u7eed\u88ab\u6267\u884c\u5916\uff0c\u4e0d\u80fd\u7ee7\u7eed\u6267\u884c\u5199\u8bf7\u6c42\u3002","title":"3. Redis \u7684\u56de\u6536\u7b56\u7565\uff08\u6dd8\u6c70\u7b56\u7565\uff09\uff1f"},{"location":"chap10/4Redis_int_all/#4-redis_2","text":"\u4e3b\u8981\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u51e0\u70b9\u8fdb\u884c\u4f18\u5316\uff1a \u5bf9 Master \u8282\u70b9\u4e0d\u8fdb\u884c\u6301\u4e45\u5316\u5de5\u4f5c\uff0c \u8ba9 Slave \u8282\u70b9\u8fdb\u884c AOF \u5907\u4efd\uff0c\u5bf9\u6570\u636e\u505a\u6301\u4e45\u5316\u64cd\u4f5c \uff1b * \u53ef\u4ee5\u628a\u4e3b\u4ece\u8282\u70b9\u90fd\u90e8\u7f72\u5728\u540c\u4e00\u4e2a\u5c40\u57df\u7f51\u5185\uff0c\u4ece\u800c\u4fdd\u8bc1\u590d\u5236\u901f\u5ea6\u4e0e\u7a33\u5b9a\u6027 \uff1b \u6839\u636e\u4e3b\u5e93\u7684\u538b\u529b\u60c5\u51b5\u6765\u8bbe\u7f6e\u6216\u8005\u589e\u52a0\u4ece\u5e93\uff1b \u4e3b\u4ece\u590d\u5236\u7684\u7ed3\u6784\u4e00\u5b9a\u8981\u4f7f\u7528\u5355\u5411\u7ed3\u6784\uff0c\u907f\u514d\u4f7f\u7528\u56fe\u72b6\u7ed3\u6784\u3002","title":"4. \u5982\u4f55\u4f18\u5316 Redis \u670d\u52a1\u7684\u6027\u80fd\uff1f"},{"location":"chap10/4Redis_int_all/#5-redis_2","text":"\u5f53\u5ba2\u6237\u7aef\u8fd0\u884c\u4e86\u65b0\u547d\u4ee4\u6dfb\u52a0\u65b0\u6570\u636e\uff0c Redis \u90fd\u4f1a\u68c0\u67e5\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\uff0c\u5982\u679c\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u5927\u4e8e maxmemory \u7684\u9650\u5236\uff0c\u90a3\u4e48\u56de\u6839\u636e\u8bbe\u7f6e\u7684\u6dd8\u6c70\u7b56\u7565\u8fdb\u884c\u56de\u6536 \u3002 \u6240\u4ee5\u4f1a\u51fa\u73b0\u5185\u5b58\u7684\u4f7f\u7528\u9650\u5236\u4e0d\u65ad\u7684\u8d85\u8fc7\u8fb9\u754c\u53c8\u88ab\u56de\u6536\u5230\u8fb9\u754c\u4ee5\u4e0b\u3002","title":"5. Redis \u56de\u6536\u8fdb\u7a0b\u5982\u4f55\u5de5\u4f5c\u7684\uff1f"},{"location":"chap10/4Redis_int_all/#6-redis_2","text":"\u53ef\u4ee5\u4f7f\u7528 Hash\u3001list\u3001sorted set\u3001set \u7b49\u96c6\u5408\u7c7b\u578b\u6570\u636e \uff0c\u66f4\u6709\u5229\u4e8e\u5c06\u6570\u636e\u5b58\u50a8\u5f97\u66f4\u7d27\u51d1\uff0c\u66f4\u6709\u5229\u4e8e\u5185\u5b58\u7a7a\u95f4\u7684\u4f7f\u7528\u3002","title":"6. \u90fd\u6709\u54ea\u4e9b\u529e\u6cd5\u53ef\u4ee5\u964d\u4f4e Redis \u7684\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u5462\uff1f"},{"location":"chap10/4Redis_int_all/#7-redis_3","text":"\u53ef\u4ee5\u5bf9\u5927\u5bf9\u8c61\u6570\u636e\u8fdb\u884c\u62c6\u5206\uff0c \u9632\u6b62\u6267\u884c\u4e00\u6b21\u547d\u4ee4\u64cd\u4f5c\u8fc7\u591a\u7684\u6570\u636e \u3002\u4e5f\u53ef\u4ee5\u5c06\u4e00\u4e9b\u7b97\u6cd5\u590d\u6742\u5ea6\u9ad8\u7684\u547d\u4ee4\u6216\u6267\u884c\u6548\u7387\u4f4e\u7684\u547d\u4ee4\uff0c\u7981\u7528\u6216\u8005\u66ff\u6362\u6210\u9ad8\u7684\u6307\u4ee4\u3002","title":"7. Redis \u7684\u6162\u67e5\u8be2\u4fee\u590d\u7ecf\u9a8c\u6709\u54ea\u4e9b\uff1f\u600e\u4e48\u4fee\u590d\u7684\uff1f"},{"location":"chap10/4Redis_int_all/#8-redis_4","text":"\u6162\u67e5\u8be2\u662f\u6307\u7cfb\u7edf\u6267\u884c\u547d\u4ee4\u4e4b\u540e\uff0c\u5f53\u8ba1\u7b97\u7cfb\u7edf\u6267\u884c\u7684\u6307\u4ee4\u65f6\u95f4\u8d85\u8fc7\u8bbe\u7f6e\u7684\u9600\u503c\uff0c\u8be5\u547d\u4ee4\u5c31\u4f1a\u88ab\u8bb0\u5f55\u5230\u6162\u67e5\u8be2\u4e2d\uff0c\u8be5\u547d\u4ee4\u53eb\u505a\u6162\u6307\u4ee4\u3002 Redis \u6162\u67e5\u8be2\u7684\u53c2\u6570\u914d\u7f6e\u6709\uff1a 1. slowlog-log-slower-than \u8be5\u53c2\u6570\u7684\u4f5c\u7528\u4e3a\u8bbe\u7f6e\u6162\u67e5\u8be2\u7684\u9608\u503c\uff0c\u5f53\u547d\u4ee4\u6267\u884c\u65f6\u95f4\u8d85\u8fc7\u8fd9\u4e2a\u9608\u503c\u5c31\u8ba4\u4e3a\u662f\u6162\u67e5\u8be2 \u3002\u5355\u4f4d\u4e3a\u5fae\u5999\uff0c\u9ed8\u8ba4\u4e3a 10000\u3002 \u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7ebf\u4e0a\u7684\u5e76\u53d1\u91cf\u8fdb\u884c\u8c03\u6574\u8fd9\u4e2a\u503c\u3002\u5982\u679c\u5b58\u5728\u9ad8\u6d41\u91cf\u7684\u573a\u666f\uff0c\u90a3\u4e48\u5efa\u8bae\u8bbe\u7f6e\u8fd9\u4e2a\u503c\u4e3a 1 \u6beb\u79d2\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u547d\u4ee4\u6267\u884c\u7684\u65f6\u95f4\u5982\u679c\u8d85\u8fc7 1 \u6beb\u79d2\uff0c\u90a3\u4e48 Redis \u7684\u6bcf\u79d2\u64cd\u4f5c\u6570\u6700\u591a\u53ea\u80fd\u5230 1000\u3002 2. slowlog-max-len \u8be5\u53c2\u6570\u7684\u4f5c\u7528\u4e3a\u8bbe\u7f6e\u6162\u67e5\u8be2\u65e5\u5fd7\u5217\u8868\u7684\u6700\u5927\u957f\u5ea6\uff0c\u5f53\u6162\u67e5\u8be2\u65e5\u5fd7\u5217\u8868\u5904\u4e8e\u6700\u5927\u957f\u5ea6\u65f6\uff0c\u6700\u65e9\u63d2\u5165\u7684\u4e00\u4e2a\u547d\u4ee4\u5c06\u4f1a\u88ab\u4ece\u5217\u8868\u4e2d\u79fb\u9664\u3002","title":"8. Redis \u6162\u67e5\u8be2\u662f\u4ec0\u4e48\uff1f\u901a\u8fc7\u4ec0\u4e48\u914d\u7f6e\uff1f"},{"location":"chap10/4Redis_int_all/#9-redis_2","text":"\u5185\u5b58\u4f18\u5316\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u51e0\u70b9\u8fdb\u884c\uff1a Redis \u5bf9\u6240\u6709\u6570\u636e\u90fd\u8fdb\u884c redisObject \u5c01\u88c5\uff1b \u5bf9\u952e\u3001\u503c\u5bf9\u8c61\u7684\u957f\u5ea6\u8fdb\u884c\u7f29\u51cf\uff0c\u7b80\u5316\u952e\u540d\uff0c\u63d0\u9ad8\u5185\u5b58\u4f7f\u7528\u6548\u7387\uff1b \u51cf\u5c11 key \u7684\u6570\u91cf\uff0c\u5c3d\u91cf\u4f7f\u7528\u54c8\u5e0c\u6570\u636e\u7c7b\u578b\uff1b \u5171\u4eab\u5bf9\u8c61\u6c60\uff0c\u5e76\u8bbe\u7f6e\u7a7a\u95f4\u6781\u9650\u503c\u3002","title":"9. Redis \u5982\u4f55\u505a\u5185\u5b58\u4f18\u5316\uff1f"},{"location":"chap10/4Redis_int_all/#10-redis_4","text":"\u5982\u679c Redis \u7684\u5185\u5b58\u4f7f\u7528\u8fbe\u5230\u4e86 redis.conf \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u8bbe\u7f6e\u4e0a\u9650\uff0c\u6267\u884c Redis \u7684\u5199\u547d\u4ee4\u4f1a\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\uff0c\u4f46\u662f\u8fd8\u662f\u652f\u6301\u8bfb\u64cd\u4f5c\u3002 \u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u529e\u6cd5\u662f\uff0c\u53ef\u4ee5\u5f00\u542f Redis \u7684\u6dd8\u6c70\u673a\u5236\uff0c\u5f53 Redis \u5185\u5b58\u8fbe\u5230\u4e0a\u9650\u65f6\u53ef\u4ee5\u6839\u636e\u914d\u7f6e\u7684\u7b56\u7565\u5220\u9664\u4e00\u4e9b\u6570\u636e\uff0c\u9632\u6b62\u5185\u5b58\u7528\u5b8c\u3002","title":"10. Redis \u7684\u5185\u5b58\u7528\u5b8c\u4e86\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f"},{"location":"chap10/4Redis_int_all/#11","text":"\u7f13\u5b58\u7684\u66f4\u65b0\u7b56\u7565\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a \u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u66f4\u65b0\u7f13\u5b58\uff1b \u5148\u5220\u9664\u7f13\u5b58\uff0c\u518d\u66f4\u65b0\u6570\u636e\u5e93\uff1b \u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58\uff1b \u5bf9\u5e94\u7684\u7b56\u7565\u5206\u522b\u9700\u8981\u6ce8\u610f\u7684\u4e8b\u9879\u4e3a\uff1a 1. \u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u66f4\u65b0\u7f13\u5b58 \u4f7f\u7528\u8fd9\u79cd\u7b56\u7565\u53ef\u80fd\u4f1a\u5b58\u5728\u4ee5\u4e0b\u4e24\u79cd\u95ee\u9898\uff1a \u7f13\u5b58\u590d\u6742\u5ea6\u53d8\u9ad8\uff1a\u5199\u5165\u7f13\u5b58\u7684\u6570\u636e\u5982\u679c\u9700\u8981\u7ecf\u8fc7\u7279\u6b8a\u7684\u8ba1\u7b97\uff0c\u90a3\u4e48\u8fd9\u65f6\u5019\u66f4\u65b0\u7f13\u5b58\u64cd\u4f5c\u6bd4\u5220\u9664\u7f13\u5b58\u8981\u590d\u6742\u5f97\u591a\u3002\u56e0\u4e3a\u66f4\u65b0\u5b8c\u6570\u636e\u5e93\u540e\uff0c\u5f97\u5230\u7684\u6570\u636e\u9700\u8981\u6267\u884c\u4e00\u6b21\u52a0\u5de5\uff0c\u6700\u540e\u5f97\u5230\u7684\u503c\u624d\u80fd\u66f4\u65b0\u7f13\u5b58\u3002 \u7ebf\u7a0b\u5b89\u5168\u5b58\u5728\u95ee\u9898\uff1a\u5982\u679c\u5b58\u5728\u7ebf\u7a0b 1 \u548c\u7ebf\u7a0b 2 \u540c\u65f6\u64cd\u4f5c\u6570\u636e\u5e93\u548c\u7f13\u5b58\uff0c\u7ebf\u7a0b 1 \u5148\u66f4\u65b0\u4e86\u6570\u636e\u5e93\uff0c\u7ebf\u7a0b 2 \u518d\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u8fd9\u65f6\u5019\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\uff0c\u7ebf\u7a0b 2 \u9996\u5148\u66f4\u65b0\u4e86\u7f13\u5b58\uff0c\u7ebf\u7a0b 1 \u518d\u66f4\u65b0\u3002\u90a3\u4e48\u8fd9\u6837\u4f1a\u5bfc\u81f4\u4ea7\u751f\u810f\u6570\u636e\u7684\u95ee\u9898\u3002\u56e0\u4e3a\u6570\u636e\u5e93\u5b58\u50a8\u7684\u662f\u7ebf\u7a0b 2 \u66f4\u65b0\u540e\u7684\u6570\u636e\uff0c\u800c\u7f13\u5b58\u5b58\u50a8\u7684\u662f\u7ebf\u7a0b 1 \u66f4\u65b0\u7684\u8001\u6570\u636e\u3002 2. \u5148\u5220\u9664\u7f13\u5b58\uff0c\u518d\u66f4\u65b0\u6570\u636e\u5e93 \u8fd9\u79cd\u7b56\u7565\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u5e93\u6570\u636e\u548c\u7f13\u5b58\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002\u5982\u679c\u5b58\u5728\u7ebf\u7a0b 1 \u548c\u7ebf\u7a0b 2\uff0c\u7ebf\u7a0b 1 \u5199\u6570\u636e\u5148\u5220\u9664\u7f13\u5b58\uff0c\u6709\u4e00\u4e2a\u7ebf\u7a0b 2 \u6b63\u597d\u9700\u8981\u67e5\u8be2\u8be5\u7f13\u5b58\uff0c\u53d1\u73b0\u7f13\u5b58\u4e0d\u5b58\u5728\uff0c\u53bb\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u5e76\u5f97\u5230\u65e7\u503c\u653e\u5165\u7f13\u5b58\u91cd\uff0c\u7ebf\u7a0b 1 \u518d\u66f4\u65b0\u6570\u636e\u5e93\u3002\u90a3\u4e48\u8fd9\u65f6\u5c31\u51fa\u73b0\u4e86\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002\u5982\u679c\u7f13\u5b58\u6ca1\u6709\u8fc7\u671f\u65f6\u95f4\uff0c\u90a3\u4e48\u8fd9\u4e2a\u810f\u6570\u636e\u4e00\u76f4\u5b58\u5728\u3002\u5982\u679c\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u90a3\u4e48\u53ef\u4ee5\u5728\u66f4\u65b0\u5b8c\u6570\u636e\u5e93\u540e\uff0c\u5bf9\u7f13\u5b58\u518d\u6dd8\u6c70\u4e00\u6b21\u3002 3. \u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58 \u8fd9\u79cd\u7b56\u7565\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u5e93\u6570\u636e\u548c\u7f13\u5b58\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002\u5982\u679c\u5728\u66f4\u65b0\u5b8c\u6570\u636e\u5e93\u8fd8\u6ca1\u6765\u5f97\u53ca\u5220\u9664\u7f13\u5b58\u7684\u65f6\u5019\uff0c\u6709\u8bf7\u6c42\u8fc7\u6765\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u6570\u636e\uff0c\u90a3\u4e48\u53ef\u80fd\u4f1a\u9020\u6210\u7f13\u5b58\u548c\u6570\u636e\u5e93\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002 \u4f46\u662f\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u673a\u5668\u4e0d\u51fa\u73b0\u6545\u969c\u6216\u5176\u4ed6\u5f71\u54cd\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0d\u4e00\u81f4\u6027\u7684\u53ef\u80fd\u6027\u76f8\u5bf9\u8f83\u4f4e\u3002","title":"11. \u7f13\u5b58\u7684\u66f4\u65b0\u7b56\u7565\u6709\u51e0\u79cd\uff1f\u5206\u522b\u6709\u4ec0\u4e48\u6ce8\u610f\u4e8b\u9879\uff1f"},{"location":"chap10/4Redis_int_all/#12-redis_3","text":"\u53ef\u4ee5\u5bf9 Redis \u8fdb\u884c\u96c6\u7fa4\u90e8\u7f72\uff0c\u5b9e\u884c\u4e3b\u4ece\u540c\u6b65\u8bfb\u5199\u5206\u79bb\uff0c\u53ef\u4ee5\u65b9\u4fbf\u7684\u5bf9 Redis \u8fdb\u884c\u6a2a\u5411\u6269\u5bb9\uff0c\u53ef\u4ee5\u652f\u6491\u7cfb\u7edf\u66f4\u5927\u6570\u636e\u91cf\u7684\u7f13\u5b58\u548c\u63d0\u9ad8\u7cfb\u7edf\u7684\u53ef\u7528\u6027\u3002","title":"12. Redis \u5355\u673a\u4f1a\u6709\u74f6\u9888\uff0c\u90a3\u4e48\u600e\u4e48\u89e3\u51b3\u8fd9\u4e2a\u74f6\u9888\uff1f"},{"location":"chap10/4Redis_int_all/#13","text":"\u60f0\u6027\u5220\u9664\u7684\u4f18\u70b9\u4e3a \uff1a\u5bf9 CPU \u6bd4\u8f83\u53cb\u597d\uff0c\u56e0\u4e3a\u6bcf\u6b21\u952e\u7a7a\u95f4\u83b7\u53d6\u952e\u65f6\uff0c\u68c0\u67e5\u83b7\u53d6\u5230\u7684\u952e\u662f\u5426\u8fc7\u671f\u5220\u9664\uff0c\u5220\u9664\u7684\u952e\u53ea\u5728\u9009\u4e2d\u4e2d\u997f\u952e\uff0c\u4e0d\u7528\u82b1\u8d39\u8fc7\u591a\u7684\u65f6\u95f4\u548c\u8d44\u6e90\u5728\u5176\u5b83\u4efb\u52a1\u4e0a\uff0c\u4e0d\u4f1a\u589e\u52a0 CPU \u7684\u8d1f\u62c5\u3002\u6240\u4ee5\u5bf9 CPU \u6bd4\u8f83\u53cb\u597d\u3002 \u60f0\u6027\u5220\u9664\u7684\u7f3a\u70b9\u4e3a \uff1a\u4f46\u662f\u5bf9\u5185\u5b58\u5e76\u4e0d\u53cb\u597d\uff0c\u6ca1\u6709\u88ab\u9009\u4e2d\u7684\u952e\u4e5f\u6709\u53ef\u80fd\u5b58\u5728\u8fc7\u671f\u7684\uff0c\u4f46\u662f\u672a\u88ab\u9009\u4e2d\u5220\u9664\u4e00\u76f4\u5b58\u5728\u5185\u5b58\u4e2d\u3002\u5f53\u5b58\u5728\u5f88\u591a\u8fd9\u4e9b\u8fc7\u671f\u952e\u4e00\u76f4\u672a\u88ab\u83b7\u53d6\u548c\u672a\u88ab\u9009\u4e2d\u5220\u9664\uff0c\u5c31\u4f1a\u4e00\u76f4\u5728\u5185\u5b58\u4e2d\u3002\u6240\u4ee5\u5bf9\u5185\u5b58\u5e76\u4e0d\u53cb\u597d\u3002","title":"13. \u60f0\u6027\u5220\u9664\u6709\u4ec0\u4e48\u4f18\u70b9\u548c\u7f3a\u70b9\uff1f"},{"location":"chap10/4Redis_int_all/#14-redis-cpu","text":"\u53ef\u4ee5\u5728\u540c\u4e00\u4e2a\u670d\u52a1\u5668\u90e8\u7f72\u591a\u4e2a Redis \u7684\u5b9e\u4f8b\uff0c\u5e76\u628a\u4ed6\u4eec\u5f53\u4f5c\u4e0d\u540c\u7684\u670d\u52a1\u5668\u6765\u4f7f\u7528\uff0c\u5728\u67d0\u4e9b\u65f6\u5019\uff0c\u65e0\u8bba\u5982\u4f55\u4e00\u4e2a\u670d\u52a1\u5668\u662f\u4e0d\u591f\u7684\uff0c \u6240\u4ee5\uff0c\u5982\u679c\u4f60\u60f3\u4f7f\u7528\u591a\u4e2a CPU\uff0c\u4f60\u53ef\u4ee5\u8003\u8651\u4e00\u4e0b\u5206\u7247\uff08shard\uff09 \u3002","title":"14. Redis \u662f\u5355\u7ebf\u7a0b\u7684\uff0c\u5982\u4f55\u63d0\u9ad8\u591a\u6838 CPU \u7684\u5229\u7528\u7387\uff1f"},{"location":"chap10/4Redis_int_all/#15_1","text":"\u56e0\u4e3a\u5185\u5b58\u7684\u7a7a\u95f4\u662f\u6709\u9650\u7684\uff0c\u6240\u4ee5 Redis \u5f15\u5165\u4e86\u6dd8\u6c70\u673a\u5236\uff0c\u4e3b\u8981\u4e3a\u4e86\u89e3\u51b3\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\uff0cRedis \u4e2d\u5b58\u5728\u5f88\u591a\u8fc7\u671f\u952e\uff0c\u5b9a\u671f\u5220\u9664\u7b56\u7565\u968f\u673a\u62bd\u67e5\u65f6\u6ca1\u6709\u62bd\u67e5\u5230\uff0c\u5e76\u4e14\u4e5f\u6ca1\u6709\u8d70\u60f0\u6027\u5220\u9664\u7b56\u7565\u65f6\uff0c\u5927\u91cf\u8fc7\u671f\u952e\u5360\u7528\u5185\u5b58\u7684\u95ee\u9898\u3002","title":"15. \u4ec0\u4e48\u662f\u7f13\u5b58\u6dd8\u6c70\uff1f"},{"location":"chap10/4Redis_int_all/#16-redis_2","text":"Redis \u5185\u5b58\u4e0d\u8db3\u53ef\u4ee5\u8fd9\u6837\u5904\u7406\uff1a \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 redis.conf \u7684` maxmemory \u53c2\u6570\uff0c\u589e\u52a0 Redis \u53ef\u7528\u5185\u5b58\uff1b \u8bbe\u7f6e\u7f13\u5b58\u6dd8\u6c70\u7b56\u7565\uff0c\u63d0\u9ad8\u5185\u5b58\u7684\u4f7f\u7528\u6548\u7387\uff1b \u4f7f\u7528 Redis \u96c6\u7fa4\u6a21\u5f0f\uff0c\u63d0\u9ad8\u5b58\u50a8\u91cf\u3002","title":"16. Redis \u62a5\u5185\u5b58\u4e0d\u8db3\u600e\u4e48\u5904\u7406\uff1f"},{"location":"chap10/4Redis_int_all/#17-redis_2","text":"\u8bbe\u7f6e\u65b9\u6cd5\u4e3a\uff1a\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 redis.conf \u7684 maxmemory \u53c2\u6570\uff0c\u8be5\u53c2\u6570\u53ef\u4ee5\u9650\u5236\u6700\u5927\u53ef\u7528\u5185\u5b58\u3002","title":"17. \u5982\u4f55\u8bbe\u7f6e Redis \u7684\u5185\u5b58\u4e0a\u9650\uff1f\u6709\u4ec0\u4e48\u4f5c\u7528\uff1f"},{"location":"chap10/4Redis_int_all/#18-redis_1","text":"\u5185\u5b58\u7ba1\u7406\u65b9\u5f0f\u4e3b\u8981\u6709\u4e24\u4e2a\uff0c\u4e00\u662f\u63a7\u5236\u5185\u5b58\u4e0a\u9650\uff1b\u4e8c\u662f\u4f18\u5316\u56de\u6536\u7b56\u7565\uff0c\u5bf9\u5185\u5b58\u56de\u6536\u3002 19. \u5e38\u89c1\u7684\u6dd8\u6c70\u7b97\u6cd5\u6709\u54ea\u4e9b\uff1f \u4e3b\u8981\u5e38\u89c1\u7684\u6dd8\u6c70\u7b97\u6cd5\u6709\uff1a 1. \u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7b97\u6cd5\uff08LRU\uff09 LRU \u662f Least Recently Used \u7684\u7f29\u5199\uff0c\u4e2d\u6587\u610f\u601d\u662f\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\uff0c\u5b83\u662f\u4e00\u79cd\u5e38\u7528\u7684\u9875\u9762\u7f6e\u6362\u7b97\u6cd5\uff0c\u9009\u62e9\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\u7684\u9875\u9762\u4e88\u4ee5\u6dd8\u6c70\u3002 2. \u5148\u8fdb\u5148\u51fa\u7b97\u6cd5\uff08FIFO\uff09 FIFO \u662f First Input First Output \u7684\u7f29\u5199\uff0c\u5373\u5148\u5165\u5148\u51fa\u961f\u5217\uff0c\u8fd9\u662f\u4e00\u79cd\u4f20\u7edf\u7684\u6309\u5e8f\u6267\u884c\u65b9\u6cd5\uff0c\u5148\u8fdb\u5165\u7684\u6307\u4ee4\u5148\u5b8c\u6210\u5e76\u5f15\u9000\uff0c\u8ddf\u7740\u624d\u6267\u884c\u7b2c\u4e8c\u6761\u6307\u4ee4\u3002 3. \u6700\u4e0d\u7ecf\u5e38\u4f7f\u7528\u7b97\u6cd5\uff08LFU\uff09 LFU \u662f Least Frequently Used \u7684\u7f29\u5199\uff0c\u4e2d\u6587\u610f\u601d\u662f\u6700\u4e0d\u7ecf\u5e38\u4f7f\u7528\u3002\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\uff0c\u6570\u636e\u88ab\u4f7f\u7528\u6b21\u6570\u6700\u5c11\u7684\uff0c\u4f18\u5148\u88ab\u6dd8\u6c70\u3002","title":"18. \u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b Redis \u7684\u5185\u5b58\u7ba1\u7406\u65b9\u5f0f\u6709\u54ea\u4e9b\uff1f"},{"location":"chap10/4Redis_int_all/#20-nosql","text":"A. Redis \u652f\u6301\u5b57\u7b26\u4e32\u3001\u54c8\u5e0c\u3001\u5217\u8868\u3001\u96c6\u5408\u3001\u6709\u5e8f\u96c6\u5408\u7b49\u6570\u636e\u7ed3\u6784\uff0c\u76ee\u524d Redis \u4e0d\u652f\u6301\u4e8b\u52a1\u3002 B. MongoDB \u652f\u6301 CAP \u5b9a\u7406\u4e2d\u7684 AP\uff0cMySQL \u652f\u6301 CAP \u4e2d\u7684 CA\uff0c\u5168\u90e8\u90fd\u652f\u6301\u4e0d\u53ef\u80fd\u5b58\u5728\u3002 C. MongoDB \u4e0d\u7528\u5148\u521b\u5efa Collection \u7684\u7ed3\u6784\u5c31\u53ef\u4ee5\u76f4\u63a5\u63d2\u5165\u6570\u636e\uff0c\u76ee\u524d MongoDB \u4e0d\u652f\u6301\u4e8b\u52a1\u3002 D. Memcache \u65e2\u652f\u6301 TCP \u534f\u8bae\uff0c\u4e5f\u652f\u6301UDP\u534f\u8bae\uff0c\u6211\u4eec\u53ef\u4ee5\u628a PHP\u7684 Session \u5b58\u653e\u5230 Memcache \u4e2d\u3002 \u7b54\u6848\uff1aA \u672c\u9898\u89e3\u6790\uff1aRedis \u662f\u652f\u6301\u4e8b\u52a1\u7684\u3002\u9009\u9879 A \u8bf4\u6cd5\u9519\u8bef\uff0c\u6240\u4ee5\u9009\u9879 A \u6b63\u786e\u3002","title":"20. \u4ee5\u4e0b\u5173\u4e8e NoSQL \u7684\u8bf4\u6cd5\uff0c\u4e0d\u5bf9\u7684\u662f\uff1a"},{"location":"chap10/4Redis_int_all/#redis-12","text":"1. Redis \u652f\u6301\u7684 Java \u5ba2\u6237\u7aef\u90fd\u6709\u54ea\u4e9b\uff1f\u5b98\u65b9\u63a8\u8350\u7528\u54ea\u4e2a\uff1f \u4e3b\u8981\u652f\u6301\u7684 Java \u5ba2\u6237\u7aef\u6709\uff1aRedisson\u3001Jedis\u3001lettuce \u7b49\uff0c\u5b98\u65b9\u63a8\u8350\u4f7f\u7528 Redisson\u3002","title":"\u4e03\u3001Redis \u5e94\u7528\uff0812 \u9898\uff09"},{"location":"chap10/4Redis_int_all/#2-twemproxy","text":"Twemproxy \u5177\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a \u8f6f\u4ef6\u5feb\u3001\u8f7b\u91cf\uff0c\u914d\u7f6e\u7b80\u5355\u3002 \u53ef\u4ee5\u7ef4\u62a4\u6301\u4e45\u8fde\u63a5\uff0c\u4f7f\u7f13\u5b58\u670d\u52a1\u5668\u7684\u8fde\u63a5\u6570\u5f88\u4f4e\u3002 \u652f\u6301\u4e00\u81f4\u6027 Hash \u7b49\u591a\u79cd hash \u6a21\u5f0f\u3002 \u8de8\u670d\u52a1\u5668\u81ea\u52a8\u5206\u7247\u3002 \u547d\u4ee4\u8bf7\u6c42\u4e0e\u54cd\u5e94\u7684\u6d41\u6c34\u7ebf\u5316\uff0c\u63d0\u5347\u6027\u80fd\u3002 \u53ef\u4ee5\u7981\u7528\u5931\u8d25\u8282\u70b9\uff0c\u6216\u76d1\u63a7\u7aef\u53e3\u5bf9\u5176\u8fdb\u884c\u72b6\u6001\u76d1\u6d4b\u3002","title":"2. Twemproxy \u6709\u4ec0\u4e48\u7279\u70b9\uff1f"},{"location":"chap10/4Redis_int_all/#3-redis_5","text":"\u6211\u4eec\u4ece\u9898\u76ee\u4e2d\u5206\u6790\u77e5\u9053\uff0c\u9996\u9875\u7684\u70ed\u95e8\u552e\u5356\u5546\u54c1\u77e5\u9053\uff0c\u8bbf\u95ee\u7684\u6570\u636e\u662f\u70ed\u6570\u636e\uff0c\u4e14\u8bbf\u95ee\u91cf\u5f88\u5927\uff0c\u8fd8\u9700\u8981\u5bf9\u5f53\u5929\u7684\u70ed\u95e8\u552e\u5356\u5546\u54c1\u8fdb\u884c\u6392\u884c\u3002 \u53ef\u4ee5\u4f7f\u7528 zset \u6570\u636e\u7c7b\u578b\u5bf9\u70ed\u6570\u636e\u8fdb\u884c\u7f13\u5b58\uff0czset \u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u6392\u884c\uff0c\u628a key \u4f5c\u4e3a\u5546\u54c1\u7684 ID\uff0cvalue \u4f5c\u4e3a\u5546\u54c1\u5f53\u5929\u9500\u552e\u7684\u6570\u91cf\uff0c\u53ef\u4ee5\u6839\u636e value \u5bf9\u5546\u54c1\u6392\u884c\u3002","title":"3. \u4f7f\u7528 Redis\uff0c\u8bbe\u8ba1\u4e00\u4e0b\u5728\u4ea4\u6613\u7f51\u7ad9\u9996\u9875\u5c55\u793a\u5f53\u5929\u6700\u70ed\u95e8\u552e\u5356\u5546\u54c1\u7684\u524d\u4e94\u5341\u540d\u5546\u54c1\u5217\u8868\uff1f"},{"location":"chap10/4Redis_int_all/#4-redis-redisson","text":"Redisson \u662f\u67b6\u8bbe\u5728 Redis \u57fa\u7840\u4e0a\u7684\u4e00\u4e2a Java \u9a7b\u5185\u5b58\u6570\u636e\u7f51\u683c\uff0c\u5b83\u5145\u5206\u7684\u5229\u7528\u4e86 Redis \u952e\u503c\u6570\u636e\u5e93\u63d0\u4f9b\u7684\u4e00\u7cfb\u5217\u4f18\u52bf\uff0c\u57fa\u4e8e Java \u5b9e\u7528\u5de5\u5177\u5305\u4e2d\u5e38\u7528\u63a5\u53e3\uff0c\u4e3a\u4f7f\u7528\u8005\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u5177\u6709\u5206\u5e03\u5f0f\u7279\u6027\u7684\u5e38\u7528\u5de5\u5177\u7c7b\u3002\u4f7f\u5f97\u539f\u672c\u4f5c\u4e3a\u534f\u8c03\u5355\u673a\u591a\u7ebf\u7a0b\u5e76\u53d1\u7a0b\u5e8f\u7684\u5de5\u5177\u5305\u83b7\u5f97\u4e86\u534f\u8c03\u5206\u5e03\u5f0f\u591a\u673a\u591a\u7ebf\u7a0b\u5e76\u53d1\u7cfb\u7edf\u7684\u80fd\u529b\uff0c\u5927\u5927\u964d\u4f4e\u4e86\u8bbe\u8ba1\u548c\u7814\u53d1\u5927\u89c4\u6a21\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u96be\u5ea6\u3002\u540c\u65f6\u7ed3\u5408\u5404\u5bcc\u7279\u8272\u7684\u5206\u5e03\u5f0f\u670d\u52a1\uff0c\u66f4\u8fdb\u4e00\u6b65\u7b80\u5316\u4e86\u5206\u5e03\u5f0f\u73af\u5883\u4e2d\u7a0b\u5e8f\u76f8\u4e92\u4e4b\u95f4\u7684\u534f\u4f5c\u3002 Redisson \u91c7\u7528\u4e86\u57fa\u4e8e NIO \u7684 Netty \u6846\u67b6\uff0c\u4e0d\u4ec5\u80fd\u4f5c\u4e3a Redis \u5e95\u5c42\u9a71\u52a8\u5ba2\u6237\u7aef\uff0c\u5177\u5907\u63d0\u4f9b\u5bf9 Redis \u5404\u79cd\u7ec4\u6001\u5f62\u5f0f\u7684\u8fde\u63a5\u529f\u80fd\uff0c\u5bf9 Redis \u547d\u4ee4\u80fd\u4ee5\u540c\u6b65\u53d1\u9001\u3001\u5f02\u6b65\u5f62\u5f0f\u53d1\u9001\u3001\u5f02\u6b65\u6d41\u5f62\u5f0f\u53d1\u9001\u6216\u7ba1\u9053\u5f62\u5f0f\u53d1\u9001\u7684\u529f\u80fd\uff0cLUA \u811a\u672c\u6267\u884c\u5904\u7406\uff0c\u4ee5\u53ca\u5904\u7406\u8fd4\u56de\u7ed3\u679c\u7684\u529f\u80fd\uff0c\u8fd8\u5728\u6b64\u57fa\u7840\u4e0a\u878d\u5165\u4e86\u66f4\u9ad8\u7ea7\u7684\u5e94\u7528\u65b9\u6848\u3002","title":"4. Redis \u548c Redisson \u6709\u4ec0\u4e48\u5173\u7cfb\uff1f"},{"location":"chap10/4Redis_int_all/#5-jedis-redisson","text":"\u5b83\u4eec\u7684\u4e3b\u8981\u4f18\u7f3a\u70b9\u6709\uff1a Jedis \u76f8\u5bf9 Redisson \u6765\u8bf4\uff0c\u5176 API \u63d0\u4f9b\u4e86\u6bd4\u8f83\u5168\u9762\u7684 Redis \u547d\u4ee4\u652f\u6301\uff1b \u56e0\u4e3a Jedis \u4e2d\u7684 Java \u65b9\u6cd5\u57fa\u672c\u548c Redis \u7684 API \u4fdd\u6301\u4e00\u81f4\uff0c\u6240\u4ee5\u4e86\u89e3\u4e86 Redis \u7684 API\uff0c\u4e5f\u80fd\u719f\u7ec3\u7684\u4f7f\u7528 Jedis\uff1b Jedis \u53ea\u652f\u6301\u57fa\u672c\u7684\u6570\u636e\u7c7b\u578b\uff0c\u4f8b\u5982 String\u3001Hash\u3001List\u3001Set\u3001Sorted Set \u7b49\uff1b Jedis \u4f7f\u7528\u7684\u662f\u963b\u585e\u7684 I/O\uff0c\u4e14\u5176\u65b9\u6cd5\u8c03\u7528\u90fd\u662f\u540c\u6b65\u7684\uff0c\u4e0d\u652f\u6301\u5f02\u6b65\uff0c\u7a0b\u5e8f\u6d41\u9700\u8981\u7b49\u5230 sockets \u5904\u7406\u5b8c I/O \u624d\u80fd\u6267\u884c\u3002Jedis \u5ba2\u6237\u7aef\u5b9e\u4f8b\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u6240\u4ee5\u9700\u8981\u901a\u8fc7\u8fde\u63a5\u6c60\u6765\u4f7f\u7528 Jedis\uff1b Redisson \u5b9e\u73b0\u4e86\u5206\u5e03\u5f0f\u548c\u53ef\u6269\u5c55\u7684 Java \u6570\u636e\u7ed3\u6784\uff0c\u7ae5\u5de5\u4e86\u5f88\u591a\u5206\u5e03\u5f0f\u76f8\u5173\u7684\u64cd\u4f5c\u670d\u52a1\uff0c\u4f8b\u5982\u5206\u5e03\u5f0f\u96c6\u5408\u3001\u5206\u5e03\u5f0f\u9501\uff0c\u53ef\u901a\u8fc7 Redis \u652f\u6301\u5ef6\u8fdf\u961f\u5217\u3002\u5b83\u548c Jedis \u76f8\u6bd4\uff0c\u529f\u80fd\u8f83\u4e3a\u7b80\u5355\uff0c\u4e0d\u652f\u6301\u5b57\u7b26\u4e32\u64cd\u4f5c\uff0c\u4e0d\u652f\u6301\u6392\u5e8f\u3001\u4e8b\u52a1\u3001\u7ba1\u9053\u3001\u5206\u533a\u7b49 Redis \u7279\u6027\u3002\u8fd9\u6837\u505a\u7684\u539f\u56e0\u662f\uff0cRedisson \u53ef\u4ee5\u8ba9\u4f7f\u7528\u8005\u5c06\u7cbe\u529b\u96c6\u4e2d\u653e\u5728\u5904\u7406\u4e1a\u52a1\u903b\u8f91\u4e0a\u3002 Redisson \u662f\u57fa\u4e8e Netty \u6846\u67b6\u7684\u4e8b\u4ef6\u9a71\u52a8\u7684\u901a\u4fe1\u5c42\uff0c\u65b9\u6cd5\u8c03\u7528\u662f\u5f02\u6b65\u7684\u3002\u5b83\u7684 API \u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u53ef\u4ee5\u64cd\u4f5c\u5355\u4e2a Redisson \u8fde\u63a5\u6765\u5b8c\u6210\u5404\u79cd\u64cd\u4f5c\u3002","title":"5. Jedis \u4e0e Redisson \u5bf9\u6bd4\u6709\u4ec0\u4e48\u4f18\u7f3a\u70b9\uff1f"},{"location":"chap10/4Redis_int_all/#6-redis_3","text":"Redis \u4e3b\u8981\u5c06\u6570\u636e\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff0c\u5b83\u662f\u5355\u8fdb\u7a0b\u5355\u7ebf\u7a0b\u7684\uff0c\u6240\u4ee5\u4e3b\u8981\u6d88\u8017\u7684\u8d44\u6e90\u548c\u74f6\u9888\u662f\u5185\u5b58\u800c\u4e0d\u662f CPU\u3002","title":"6. Redis \u4e3b\u8981\u6d88\u8017\u4ec0\u4e48\u7269\u7406\u8d44\u6e90\uff1f"},{"location":"chap10/4Redis_int_all/#7-redis-respredis-serialization-protocol","text":"A. \u4e8c\u8fdb\u5236\u5b89\u5168 B. \u5728 TCP \u5c42 C. \u57fa\u4e8e\u8bf7\u6c42\u2014\u54cd\u5e94\u6a21\u5f0f D. \u4e0d\u53ef\u4ee5\u5e8f\u5217\u5316\u4e0d\u540c\u7684\u6570\u636e\u7c7b\u578b \u7b54\u6848\uff1aABC \u5206\u6790\uff1aRedis \u5ba2\u6237\u7aef\u548c Redis \u670d\u52a1\u5668\u901a\u4fe1\u65f6\u4f7f\u7528\u7684\u662f RESP\uff08REdis \u5e8f\u5217\u5316\u534f\u8bae\uff09\u901a\u8baf\u534f\u8bae\uff0c\u8be5\u534f\u8bae\u662f\u4e13\u95e8\u4e3a Redis \u8bbe\u8ba1\u7684\uff0c\u4f46\u662f\u4e5f\u53ef\u4ee5\u7528\u4e8e\u5176\u4ed6\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u8f6f\u4ef6\u9879\u76ee\u4e2d\u3002 \u5bf9\u4e8e\u9009\u9879 A\uff0cRESP \u662f\u4e8c\u8fdb\u5236\u5b89\u5168\u7684\uff0c\u5e76\u4e14\u4e0d\u9700\u8981\u5904\u7406\u4ece\u4e00\u4e2a\u8fdb\u7a0b\u4f20\u8f93\u5230\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u7684\u6279\u91cf\u6570\u636e\uff0c\u56e0\u4e3a\u5b83\u4f7f\u7528\u524d\u7f00\u957f\u5ea6\u6765\u4f20\u8f93\u6279\u91cf\u6570\u636e\u3002\u6240\u4ee5\u9009\u9879 A \u6b63\u786e\u3002 \u5bf9\u4e8e\u9009\u9879 B\uff0cRedis \u5ba2\u6237\u7aef\u8fde\u63a5\u5230 Redis \u670d\u52a1\u5668\uff0c\u5e76\u521b\u5efa\u4e0e\u7aef\u53e3 6379 \u7684 TCP \u8fde\u63a5\u3002\u5c3d\u7ba1 RESP \u5728\u6280\u672f\u4e0a\u4e0d\u662f\u7279\u5b9a\u4e8e TCP \u7684\uff0c\u4f46\u5728 Redis \u7684\u4e0a\u4e0b\u6587\u4e2d\uff0c\u8be5\u534f\u8bae\u4ec5\u7528\u4e8e TCP \u8fde\u63a5\uff08\u6216\u7b49\u6548\u7684\u9762\u5411\u6d41\u7684\u8fde\u63a5\uff0c\u5982 Unix \u5957\u63a5\u5b57\uff09\u3002\u6240\u4ee5\u9009\u9879 B \u6b63\u786e\u3002 \u5bf9\u4e8e\u9009\u9879 C\uff0cRedis \u63a5\u53d7\u7531\u4e0d\u540c\u53c2\u6570\u7ec4\u6210\u7684\u547d\u4ee4\u3002\u6536\u5230\u547d\u4ee4\u540e\uff0c\u5c06\u5bf9\u5176\u8fdb\u884c\u5904\u7406\u5e76\u5c06\u7b54\u590d\u53d1\u9001\u56de\u5ba2\u6237\u7aef\u3002\u6240\u4ee5\u9009\u9879 C \u6b63\u786e\u3002 \u5bf9\u4e8e\u9009\u9879 D\uff0cRESP \u53ef\u4ee5\u5e8f\u5217\u5316\u4e0d\u540c\u7684\u6570\u636e\u7c7b\u578b\uff0c\u4f8b\u5982\u6574\u6570\uff0c\u5b57\u7b26\u4e32\uff0c\u6570\u7ec4\u3002\u8fd8\u6709\u4e00\u79cd\u7279\u5b9a\u7684\u9519\u8bef\u7c7b\u578b\u3002\u8bf7\u6c42\u4ee5\u5b57\u7b26\u4e32\u6570\u7ec4\u7684\u5f62\u5f0f\u4ece\u5ba2\u6237\u7aef\u53d1\u9001\u5230 Redis \u670d\u52a1\u5668\uff0c\u8fd9\u4e9b\u5b57\u7b26\u4e32\u8868\u793a\u8981\u6267\u884c\u7684\u547d\u4ee4\u7684\u53c2\u6570\u3002Redis \u4f7f\u7528\u7279\u5b9a\u4e8e\u547d\u4ee4\u7684\u6570\u636e\u7c7b\u578b\u8fdb\u884c\u56de\u590d\u3002\u6240\u4ee5\u9009\u9879 D \u9519\u8bef\u3002 \u6240\u4ee5\u672c\u9898\u7684\u7b54\u6848\u4e3a ABC\u3002","title":"7. Redis \u5ba2\u6237\u7aef\u4f7f\u7528\u7684\u901a\u8baf\u534f\u8bae\u662f RESP\uff08Redis Serialization Protocol\uff09\uff0c\u4ee5\u4e0b\u662f\u5b83\u7684\u7279\u70b9\u7684\u662f"},{"location":"chap10/4Redis_int_all/#8_1","text":"\u4e3b\u8981\u5e38\u7528\u7684\u624b\u6bb5\u6709\uff1a \u63d0\u524d\u52a0\u8f7d\u6570\u636e\u5230\u7f13\u5b58\u4e2d\uff1b \u589e\u52a0\u7f13\u5b58\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u63d0\u9ad8\u7f13\u5b58\u7684\u6570\u636e\uff1b \u8c03\u6574\u7f13\u5b58\u7684\u5b58\u50a8\u6570\u636e\u7c7b\u578b\uff1b \u63d0\u5347\u7f13\u5b58\u7684\u66f4\u65b0\u9891\u7387\u3002","title":"8. \u600e\u4e48\u63d0\u9ad8\u7f13\u5b58\u547d\u4e2d\u7387\uff1f"},{"location":"chap10/4Redis_int_all/#9","text":"\u7f13\u5b58\u547d\u4e2d\u7387\u8868\u793a\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u6570\u636e\u65f6\u53ef\u4ee5\u83b7\u53d6\u5230\u6570\u636e\u7684\u6b21\u6570\uff0c\u547d\u4e2d\u7387\u8d8a\u9ad8\u4ee3\u8868\u7f13\u5b58\u7684\u4f7f\u7528\u6548\u7387\u8d8a\u9ad8\uff0c\u5e94\u7528\u7684\u6027\u80fd\u8d8a\u597d\u3002 \u5b83\u7684\u516c\u5f0f\u4e3a\uff1a \u7f13\u5b58\u547d\u4e2d\u7387 = \u7f13\u5b58\u4e2d\u83b7\u53d6\u6570\u636e\u6b21\u6570/\u83b7\u53d6\u6570\u636e\u603b\u6b21\u6570 \u7f13\u5b58\u547d\u4e2d\u7684\u610f\u601d\u662f\uff1a\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u5230\u9700\u8981\u7684\u6570\u636e\u7684\u6b21\u6570\uff1b \u7f13\u5b58\u4e0d\u547d\u4e2d\u7684\u610f\u601d\u662f\uff1a\u4ece\u7f13\u5b58\u4e2d\u65e0\u6cd5\u83b7\u53d6\u6240\u9700\u6570\u636e\uff0c\u9700\u8981\u518d\u6b21\u67e5\u8be2\u6570\u636e\u5e93\u6216\u8005\u5176\u4ed6\u6570\u636e\u5b58\u50a8\u8f7d\u4f53\u7684\u6b21\u6570\u3002","title":"9. \u7f13\u5b58\u547d\u4e2d\u7387\u8868\u793a\u4ec0\u4e48\uff1f"},{"location":"chap10/4Redis_int_all/#10-redis-key-value","text":"Redis\uff08\u5373 Remote Dictionary Server \u7684\u7f29\u5199\uff0c\u4e2d\u6587\u610f\u601d\u4e3a\u8fdc\u7a0b\u5b57\u5178\u670d\u52a1\uff09\u662f\u4e00\u4e2a\u4f7f\u7528 ANSI C \u8bed\u8a00\u7f16\u5199\uff0c\u5f00\u6e90\u7684\u3001\u652f\u6301\u7f51\u7edc\u3001\u53ef\u57fa\u4e8e\u5185\u5b58\u4ea6\u53ef\u6301\u4e45\u5316\u7684\u65e5\u5fd7\u578b\u3001Key-Value \u6570\u636e\u5e93\uff0c\u5b83\u63d0\u4f9b\u4e86\u591a\u79cd\u8bed\u8a00\u7684 API\u3002 \u5b83\u5185\u90e8\u652f\u6301\u591a\u79cd\u6570\u636e\u7ed3\u6784\u3001\u6570\u636e\u6301\u4e45\u5316\u673a\u5236\u3001\u4e3b\u4ece\u7ed3\u6784\u3001Redis \u96c6\u7fa4\u7b49\u529f\u80fd\u3002","title":"10. Redis \u662f\u4e00\u4e2a\u57fa\u4e8e\u5185\u5b58\u4e14\u652f\u6301\u6301\u4e45\u5316\u7684\u9ad8\u6027\u80fd key-value \u6570\u636e\u5e93\uff0c\u5b83\u652f\u6301\u7684\u529f\u80fd\u6709\u54ea\u4e9b\uff1f"},{"location":"chap10/4Redis_int_all/#11-redis-key","text":"Redis \u5982\u679c key \u76f8\u540c\uff0c\u540e\u4e00\u4e2a key \u4f1a\u8986\u76d6\u524d\u4e00\u4e2a key\u3002\u5982\u679c\u8981\u89e3\u51b3 key \u51b2\u7a81\uff0c\u6700\u597d\u7ed9 key \u53d6\u597d\u540d\u533a\u5206\u5f00\uff0c\u53ef\u4ee5\u6309\u4e1a\u52a1\u540d\u548c\u53c2\u6570\u533a\u5206\u5f00\u53d6\u540d\uff0c\u907f\u514d\u91cd\u590d key \u5bfc\u81f4\u7684\u51b2\u7a81\u3002","title":"11. Redis \u5982\u4f55\u89e3\u51b3 key \u51b2\u7a81\uff1f"},{"location":"chap10/5redis6_int/","text":"\u7b2c\u4e94\u7ae0 Redis6.0\u4e0e\u7f13\u5b58\u5927\u5168\u57fa\u7840\u9762\u8bd5 1 \u95ee\u9898\uff1a\u4ec0\u4e48\u662fredis? Redis \u662f\u4e00\u4e2a\u57fa\u4e8e \u5185\u5b58\u7684\u9ad8\u6027\u80fdkey-value\u6570\u636e\u5e93 \u3002 2 \u95ee\u9898\uff1aredis\u53ef\u4ee5\u7528\u5728\u54ea\u4e9b\u4e1a\u52a1\u4e0a\uff1f \u7b54\uff1aredis\u53ef\u4ee5\u505a\u5f88\u591a\u4e8b\u60c5\uff0c\u6bd4\u5982\uff1a \u7f13\u5b58 / \u5206\u5e03\u5f0f\u9501 \uff08setnx\uff09 / \u7b80\u6613\u7684\u6d88\u606f\u961f\u5217\uff08List/Streams\uff09 / \u7b80\u6613\u8ba2\u9605\u901a\u77e5\uff08Pub/Sub\uff09 / \u5ef6\u65f6\u901a\u77e5\uff08\u952e\u8fc7\u671f\u4e8b\u4ef6\u901a\u77e5\uff09 / \u9644\u8fd1\u7684\u4eba\uff08GEO\uff09 \u4ee5\u4e0b\u662f\u5177\u4f53\u4e1a\u52a1\u573a\u666f\uff1a \u8bb0\u5f55\u5e16\u5b50\u7684\u70b9\u8d5e\u6570\u3001\u8bc4\u8bba\u6570\u548c\u70b9\u51fb\u6570 (hash)\u3002 \u8bb0\u5f55\u7528\u6237\u7684\u5e16\u5b50 ID \u5217\u8868 (\u6392\u5e8f)\uff0c\u4fbf\u4e8e\u5feb\u901f\u663e\u793a\u7528\u6237\u7684\u5e16\u5b50\u5217\u8868 (zset)\u3002 \u8bb0\u5f55\u5e16\u5b50\u7684\u6807\u9898\u3001\u6458\u8981\u3001\u4f5c\u8005\u548c\u5c01\u9762\u4fe1\u606f\uff0c\u7528\u4e8e\u5217\u8868\u9875\u5c55\u793a (hash)\u3002 \u8bb0\u5f55\u5e16\u5b50\u7684\u70b9\u8d5e\u7528\u6237 ID \u5217\u8868\uff0c\u8bc4\u8bba ID \u5217\u8868\uff0c\u7528\u4e8e\u663e\u793a\u548c\u53bb\u91cd\u8ba1\u6570 (zset)\u3002 \u7f13\u5b58\u8fd1\u671f\u70ed\u5e16\u5185\u5bb9 (\u5e16\u5b50\u5185\u5bb9\u7a7a\u95f4\u5360\u7528\u6bd4\u8f83\u5927)\uff0c\u51cf\u5c11\u6570\u636e\u5e93\u538b\u529b (hash)\u3002 \u8bb0\u5f55\u5e16\u5b50\u7684\u76f8\u5173\u6587\u7ae0 ID\uff0c\u6839\u636e\u5185\u5bb9\u63a8\u8350\u76f8\u5173\u5e16\u5b50 (list)\u3002 \u5982\u679c\u5e16\u5b50 ID \u662f\u6574\u6570\u81ea\u589e\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528 Redis \u6765\u5206\u914d\u5e16\u5b50 ID(\u8ba1\u6570\u5668)\u3002 \u6536\u85cf\u96c6\u548c\u5e16\u5b50\u4e4b\u95f4\u7684\u5173\u7cfb (zset)\u3002 \u8bb0\u5f55\u70ed\u699c\u5e16\u5b50 ID \u5217\u8868\uff0c\u603b\u70ed\u699c\u548c\u5206\u7c7b\u70ed\u699c (zset)\u3002 \u7f13\u5b58\u7528\u6237\u884c\u4e3a\u5386\u53f2\uff0c\u8fdb\u884c\u6076\u610f\u884c\u4e3a\u8fc7\u6ee4 (zset,hash)\u3002 3 \u95ee\u9898\uff1aRedis\u6709\u54ea\u4e9b\u6570\u636e\u7ed3\u6784\uff1f \u7b54\uff1aRedis\u662f\u4e00\u79cd Key-Value \u7684\u6a21\u578b\uff0ckey\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u800c\u5e38\u8bf4\u7684\u6570\u636e\u7ed3\u6784\u4e00\u822c\u662f\u6307value\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4e00\u822c\u5305\u542b\u4ee5\u4e0b\u7c7b\u578b\u3002 \u6700\u666e\u901a\u5e38\u89c1\u7684\uff0c\u5b57\u7b26\u4e32(String)\uff0c\u5b57\u5178(Hash)\uff0c\u5217\u8868(List)\uff0c\u96c6\u5408(Set)\uff0c\u6709\u5e8f\u96c6\u5408(SortedSet)\u3002 \u9ad8\u7ea7\u6570\u636e\u7ed3\u6784\uff0cHyperLogLog\uff0cGeo\uff0cbitmap \u66f4\u9ad8\u7ea7\u7528\u6237\u53ef\u80fd\u8fd8\u77e5\u9053Redis Module\uff0c\u50cf BloomFilter\uff0cRedisSearch\uff0cRedis-ML\u3002 4 \u95ee\u9898\uff1a\u4f7f\u7528Redis\u6709\u54ea\u4e9b\u597d\u5904\uff1f \u901f\u5ea6\u5feb\uff0c\u56e0\u4e3a\u6570\u636e\u5b58\u5728\u5185\u5b58\u4e2d \uff0c\u7c7b\u4f3c\u4e8eHashMap\uff0cHashMap\u7684\u4f18\u52bf\u5c31\u662f\u67e5\u627e\u548c\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u662fO(1) \u652f\u6301\u4e30\u5bcc\u6570\u636e\u7c7b\u578b \uff0c\u652f\u6301string\uff0clist\uff0cset\uff0csorted set\uff0chash \u652f\u6301\u4e8b\u52a1\uff0c\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u6027 \uff0c\u6240\u8c13\u7684\u539f\u5b50\u6027\u5c31\u662f\u5bf9\u6570\u636e\u7684\u66f4\u6539\u8981\u4e48\u5168\u90e8\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u6267\u884c \u4e30\u5bcc\u7684\u7279\u6027 \uff1a\u53ef\u7528\u4e8e\u7f13\u5b58\uff0c\u6d88\u606f\uff0c\u6309key\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u8fc7\u671f\u540e\u5c06\u4f1a\u81ea\u52a8\u5220\u9664\u3002 5 \u95ee\u9898\uff1aredis\u76f8\u6bd4memcached\u6709\u54ea\u4e9b\u4f18\u52bf\uff1f memcached\u6240\u6709\u7684\u503c\u5747\u662f\u7b80\u5355\u7684\u5b57\u7b26\u4e32\uff0credis\u4f5c\u4e3a\u5176\u66ff\u4ee3\u8005\uff0c\u652f\u6301\u66f4\u4e3a\u4e30\u5bcc\u7684\u6570\u636e\u7c7b\u578b redis\u7684\u901f\u5ea6\u6bd4memcached\u5feb\u5f88\u591a redis\u53ef\u4ee5\u6301\u4e45\u5316\u5176\u6570\u636e 6 \u4f7f\u7528redis\u6709\u4ec0\u4e48\u7f3a\u70b9\uff1f \u7b54\uff1a\u4e3b\u8981\u6709\u4ee5\u4e0b\u56db\u70b9\u7f3a\u70b9\uff1a \u7f13\u5b58\u548c\u6570\u636e\u5e93\u53cc\u5199\u4e00\u81f4\u6027\u95ee\u9898 \u5f53\u4e00\u4e2a\u6570\u636e\u9700\u8981\u66f4\u65b0\u65f6\uff0c\u56e0\u4e3a\u4e0d\u53ef\u80fd\u505a\u5230\u540c\u65f6\u66f4\u65b0\u6570\u636e\u5e93\u548c\u7f13\u5b58\uff0c\u90a3\u4e48\u6b64\u65f6\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\u5c31\u4e00\u5b9a\u4f1a\u53d1\u751f\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\uff0c\u800c\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\u5728\u91d1\u878d\u4ea4\u6613\u9886\u57df\u7684\u7cfb\u7edf\u4e2d\u662f\u80af\u5b9a\u4e0d\u5141\u8bb8\u7684\u3002 \u89e3\u51b3\u529e\u6cd5\uff1a\u8bfb\u7684\u65f6\u5019\u5148\u8bfb\u7f13\u5b58\uff0c\u7f13\u5b58\u6ca1\u6709\u7684\u8bdd\uff0c\u5c31\u8bfb\u6570\u636e\u5e93\uff0c\u7136\u540e\u53d6\u51fa\u6570\u636e\u540e\u653e\u5165\u7f13\u5b58\uff0c\u540c\u65f6\u8fd4\u56de\u54cd\u5e94\u3002\u66f4\u65b0\u7684\u65f6\u5019\uff0c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u7136\u540e\u518d\u5220\u9664\u7f13\u5b58\u3002 \u7f13\u5b58\u96ea\u5d29\u95ee\u9898 \u7f13\u5b58\u96ea\u5d29\u662f\u6307\u5f53\u5927\u91cf\u7f13\u5b58\u5931\u6548\u65f6\uff0c\u5927\u91cf\u7684\u8bf7\u6c42\u8bbf\u95ee\u76f4\u63a5\u8bf7\u6c42\u6570\u636e\u5e93\uff0c\u5bfc\u81f4\u6570\u636e\u5e93\u670d\u52a1\u5668\u65e0\u6cd5\u6297\u4f4f\u8bf7\u6c42\u6216\u6302\u6389\u7684\u60c5\u51b5\u3002\u8fd9\u65f6\u7f51\u7ad9\u5e38\u5e38\u4f1a\u51fa\u73b0 502 \u9519\u8bef\uff0c\u5bfc\u81f4\u7f51\u7ad9\u4e0d\u53ef\u7528\u95ee\u9898\u3002 \u5408\u7406\u89c4\u5212\u7f13\u5b58\u7684\u5931\u6548\u65f6\u95f4\uff0c\u53ef\u4ee5\u7ed9\u7f13\u5b58\u65f6\u95f4\u52a0\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u9632\u6b62\u7edf\u4e00\u65f6\u95f4\u8fc7\u671f \u7f13\u5b58\u51fb\u7a7f\u95ee\u9898 \u7f13\u5b58\u51fb\u7a7f\u662f\u6307\uff0c\u9488\u5bf9\u67d0\u4e2a\u8bbf\u95ee\u975e\u5e38\u9891\u7e41\u7684\u70ed\u70b9\u6570\u636e\u7684\u8bf7\u6c42\uff0c\u65e0\u6cd5\u5728\u7f13\u5b58\u4e2d\u8fdb\u884c\u5904\u7406\uff0c\u7d27\u63a5\u7740\uff0c\u8bbf\u95ee\u8be5\u6570\u636e\u7684\u5927\u91cf\u8bf7\u6c42\uff0c \u4e00\u4e0b\u5b50\u90fd\u53d1\u9001\u5230\u4e86\u540e\u7aef\u6570\u636e\u5e93\uff0c\u5bfc\u81f4\u4e86\u6570\u636e\u5e93\u538b\u529b\u6fc0\u589e\uff0c\u4f1a\u5f71\u54cd\u6570\u636e\u5e93\u5904\u7406\u5176\u4ed6\u8bf7\u6c42 \u5bf9\u4e8e\u8bbf\u95ee\u7279\u522b\u9891\u7e41\u7684\u70ed\u70b9\u6570\u636e\uff0c\u6211\u4eec\u5c31\u4e0d\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u4e86 \u7f13\u5b58\u7a7f\u900f\u95ee\u9898 \u7f13\u5b58\u7a7f\u900f\u662f\u6307\u8981\u8bbf\u95ee\u7684\u6570\u636e\u65e2\u4e0d\u5728 Redis \u7f13\u5b58\u4e2d\uff0c\u4e5f\u4e0d\u5728\u6570\u636e\u5e93\u4e2d\uff0c\u5bfc\u81f4\u8bf7\u6c42\u5728\u8bbf\u95ee\u7f13\u5b58\u65f6\uff0c\u53d1\u751f\u7f13\u5b58\u7f3a\u5931\uff0c\u518d\u53bb\u8bbf\u95ee\u6570\u636e\u5e93\u65f6\uff0c\u53d1\u73b0\u6570\u636e\u5e93\u4e2d\u4e5f\u6ca1\u6709\u8981\u8bbf\u95ee\u7684\u6570\u636e \u4e1a\u52a1\u5c42\u8bef\u64cd\u4f5c\uff1a \u7f13\u5b58\u4e2d\u7684\u6570\u636e\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u88ab\u8bef\u5220\u9664\u4e86\uff0c\u6240\u4ee5\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u90fd\u6ca1\u6709\u6570\u636e\uff1b \u6076\u610f\u653b\u51fb\uff1a \u4e13\u95e8\u8bbf\u95ee\u6570\u636e\u5e93\u4e2d\u6ca1\u6709\u7684\u6570\u636e \u3002 7 \u95ee\u9898\uff1aRedis\u63d0\u4f9b\u4e86\u51e0\u79cd\u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff1f\u8be5\u600e\u4e48\u9009\u62e9\uff1f volatile-lru(Least Recently Used) \uff1a\u4ece\u5df2\u7ecf\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u4e2d\uff0c\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70\u3002 volatile-ttl \uff1a\u4ece\u5df2\u7ecf\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u4e2d\uff0c\u6311\u9009\u5373\u5c06\u8981\u8fc7\u671f\u7684\u6570\u636e\u6dd8\u6c70\u3002 volatile-random \uff1a\u4ece\u5df2\u7ecf\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u4e2d\uff0c\u968f\u673a\u6311\u9009\u6570\u636e\u6dd8\u6c70\u3002 volatile-lfu(Least Frequently Used) \uff1a\u4ece\u5df2\u7ecf\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u4e2d\uff0c\u4f1a\u4f7f\u7528LFU\u7b97\u6cd5\u9009\u62e9\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u503c\u5bf9\u3002 allkeys-lru \uff1a\u4ece\u6240\u6709\u7684\u6570\u636e\u96c6\u4e2d\uff0c\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70\u3002 allkeys-random \uff1a\u4ece\u6240\u6709\u7684\u6570\u636e\u96c6\u4e2d\uff0c\u968f\u673a\u6311\u9009\u6570\u636e\u6dd8\u6c70\u3002 no-eviction \uff1a\u7981\u6b62\u6dd8\u6c70\u6570\u636e\uff0c\u5982\u679credis\u5199\u6ee1\u4e86\u5c06\u4e0d\u63d0\u4f9b\u5199\u8bf7\u6c42\uff0c\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\u3002 \u6ce8\u610f\u8fd9\u91cc\u76846\u79cd\u673a\u5236\uff0cvolatile\u548callkeys\u89c4\u5b9a\u4e86\u662f\u5bf9\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u6dd8\u6c70\u6570\u636e\u8fd8\u662f\u4ece\u5168\u90e8\u6570\u636e\u96c6\u6dd8\u6c70\u6570\u636e\uff0c\u540e\u9762\u7684lru\u3001ttl\u4ee5\u53carandom\u662f\u4e09\u79cd\u4e0d\u540c\u7684\u6dd8\u6c70\u7b56\u7565\uff0c\u518d\u52a0\u4e0a\u4e00\u79cd no-eviction \u6c38\u4e0d\u56de\u6536\u7684\u7b56\u7565\u3002 \u4f7f\u7528\u7b56\u7565\u89c4\u5219\uff1a \u5982\u679c\u6570\u636e\u5448\u73b0\u5e42\u5f8b\u5206\u5e03\uff0c\u4e5f\u5c31\u662f\u4e00\u90e8\u5206\u6570\u636e\u8bbf\u95ee\u9891\u7387\u9ad8\uff0c\u4e00\u90e8\u5206\u6570\u636e\u8bbf\u95ee\u9891\u7387\u4f4e\uff0c\u5219\u4f7f\u7528 allkeys-lru \u5982\u679c\u6570\u636e\u5448\u73b0\u5e73\u7b49\u5206\u5e03\uff0c\u4e5f\u5c31\u662f\u6240\u6709\u7684\u6570\u636e\u8bbf\u95ee\u9891\u7387\u90fd\u76f8\u540c\uff0c\u5219\u4f7f\u7528 allkeys-random 8 \u95ee\u9898\uff1a\u4e3a\u4ec0\u4e48redis\u9700\u8981\u628a\u6240\u6709\u6570\u636e\u653e\u5230\u5185\u5b58\u4e2d\uff1f \u7b54\uff1a Redi \u4e3a\u4e86\u8fbe\u5230\u6700\u5feb\u7684\u8bfb\u5199\u901f\u5ea6\u5c06\u6570\u636e\u90fd\u8bfb\u5230\u5185\u5b58\u4e2d\uff0c\u5e76\u901a\u8fc7\u5f02\u6b65\u7684\u65b9\u5f0f\u5c06\u6570\u636e\u5199\u5165\u78c1\u76d8\u3002\u6240\u4ee5redis\u5177\u6709\u5feb\u901f\u548c\u6570\u636e\u6301\u4e45\u5316\u7684\u7279\u5f81\u3002 \u5982\u679c\u4e0d\u5c06\u6570\u636e\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u78c1\u76d8 I/O \u901f\u5ea6\u4e3a\u4e25\u91cd\u5f71\u54cd redis \u7684\u6027\u80fd\u3002 \u5728\u5185\u5b58\u8d8a\u6765\u8d8a\u4fbf\u5b9c\u7684\u4eca\u5929\uff0credis\u5c06\u4f1a\u8d8a\u6765\u8d8a\u53d7\u6b22\u8fce\u3002 9 \u95ee\u9898\uff1aRedis\u662f\u5355\u7ebf\u7a0b\u7684\u5417\uff1f \u7b54\uff1aRedis\u662f\u5355\u7ebf\u7a0b\u7684\uff0c \u4e3b\u8981\u662f\u6307Redis\u7684\u7f51\u7edcIO\u548c\u952e\u503c\u5bf9\u8bfb\u5199\u662f\u7531\u4e00\u4e2a\u7ebf\u7a0b\u6765\u5b8c\u6210\u7684 \uff0c\u8fd9\u4e5f\u662fRedis\u5bf9\u5916\u63d0\u4f9b\u952e\u503c\u5b58\u50a8\u670d\u52a1\u7684\u4e3b\u8981\u6d41\u7a0b\u3002 \u4f46Redis\u7684\u5176\u4ed6\u529f\u80fd\uff0c\u6bd4\u5982\u6301\u4e45\u5316\u3001\u5f02\u6b65\u5220\u9664\u3001\u96c6\u7fa4\u6570\u636e\u540c\u6b65\u7b49\uff0c\u5176\u5b9e\u662f\u7531\u989d\u5916\u7684\u7ebf\u7a0b\u6267\u884c\u7684\u3002 10 \u95ee\u9898\uff1aRedis6.0\u4e3a\u4ec0\u4e48\u8981\u5f15\u5165\u591a\u7ebf\u7a0b\u5462\uff1f \u7b54\uff1aRedis\u5c06\u6240\u6709\u6570\u636e\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u5185\u5b58\u7684\u54cd\u5e94\u65f6\u957f\u5927\u7ea6\u4e3a100\u7eb3\u79d2\uff0c\u5bf9\u4e8e\u5c0f\u6570\u636e\u5305\uff0cRedis\u670d\u52a1\u5668\u53ef\u4ee5\u5904\u74068\u4e07\u523010\u4e07QPS\uff0c\u8fd9\u4e5f\u662fRedis\u5904\u7406\u7684\u6781\u9650\u4e86\uff0c\u5bf9\u4e8e80%\u7684\u516c\u53f8\u6765\u8bf4\uff0c\u5355\u7ebf\u7a0b\u7684Redis\u5df2\u7ecf\u8db3\u591f\u4f7f\u7528\u4e86\u3002 \u4eceRedis\u81ea\u8eab\u89d2\u5ea6\u6765\u8bf4\uff0c\u56e0\u4e3a\u8bfb\u5199\u7f51\u7edc\u7684read/write\u7cfb\u7edf\u8c03\u7528\u5360\u7528\u4e86Redis\u6267\u884c\u671f\u95f4\u5927\u90e8\u5206CPU\u65f6\u95f4\uff0c\u74f6\u9888\u4e3b\u8981\u5728\u4e8e\u7f51\u7edc\u7684 IO \u6d88\u8017, \u4f18\u5316\u4e3b\u8981\u6709\u4e24\u4e2a\u65b9\u5411: \u63d0\u9ad8\u7f51\u7edc IO \u6027\u80fd\uff0c\u5178\u578b\u7684\u5b9e\u73b0\u6bd4\u5982\u4f7f\u7528 DPDK \u6765\u66ff\u4ee3\u5185\u6838\u7f51\u7edc\u6808\u7684\u65b9\u5f0f \u4f7f\u7528\u591a\u7ebf\u7a0b\u5145\u5206\u5229\u7528\u591a\u6838\uff0c\u5178\u578b\u7684\u5b9e\u73b0\u6bd4\u5982 Memcached\u3002 \u534f\u8bae\u6808\u4f18\u5316\u7684\u8fd9\u79cd\u65b9\u5f0f\u8ddf Redis \u5173\u7cfb\u4e0d\u5927\uff0c\u652f\u6301\u591a\u7ebf\u7a0b\u662f\u4e00\u79cd\u6700\u6709\u6548\u6700\u4fbf\u6377\u7684\u64cd\u4f5c\u65b9\u5f0f\u3002\u6240\u4ee5\u603b\u7ed3\u8d77\u6765\uff0credis\u652f\u6301\u591a\u7ebf\u7a0b\u4e3b\u8981\u5c31\u662f\u4e24\u4e2a\u539f\u56e0\uff1a \u53ef\u4ee5\u5145\u5206\u5229\u7528\u670d\u52a1\u5668 CPU \u8d44\u6e90\uff0c\u76ee\u524d\u4e3b\u7ebf\u7a0b\u53ea\u80fd\u5229\u7528\u4e00\u4e2a\u6838 \u591a\u7ebf\u7a0b\u4efb\u52a1\u53ef\u4ee5\u5206\u644a Redis \u540c\u6b65 IO \u8bfb\u5199\u8d1f\u8377 11 \u95ee\u9898\uff1aRedis6.0\u9ed8\u8ba4\u662f\u5426\u5f00\u542f\u4e86\u591a\u7ebf\u7a0b\uff1f \u7b54\uff1a Redis6.0\u7684\u591a\u7ebf\u7a0b\u9ed8\u8ba4\u662f\u7981\u7528\u7684\uff0c\u53ea\u4f7f\u7528\u4e3b\u7ebf\u7a0b \u3002\u5982\u9700\u5f00\u542f\u9700\u8981\u4fee\u6539redis.conf\u914d\u7f6e\u6587\u4ef6\uff1a io-threads-do-reads yes 12 \u95ee\u9898\uff1aRedis6.0\u591a\u7ebf\u7a0b\u5f00\u542f\u65f6\uff0c\u7ebf\u7a0b\u6570\u5982\u4f55\u8bbe\u7f6e\uff1f \u7b54\uff1a\u5f00\u542f\u591a\u7ebf\u7a0b\u540e\uff0c\u8fd8\u9700\u8981\u8bbe\u7f6e\u7ebf\u7a0b\u6570\uff0c\u5426\u5219\u662f\u4e0d\u751f\u6548\u7684\u3002\u540c\u6837\u4fee\u6539 redis.conf \u914d\u7f6e\u6587\u4ef6 \u5173\u4e8e\u7ebf\u7a0b\u6570\u7684\u8bbe\u7f6e\uff0c\u5b98\u65b9\u6709\u4e00\u4e2a\u5efa\u8bae\uff1a 4\u6838\u7684\u673a\u5668\u5efa\u8bae\u8bbe\u7f6e\u4e3a2\u62163\u4e2a\u7ebf\u7a0b\uff0c8\u6838\u7684\u5efa\u8bae\u8bbe\u7f6e\u4e3a6\u4e2a\u7ebf\u7a0b\uff0c\u7ebf\u7a0b\u6570\u4e00\u5b9a\u8981\u5c0f\u4e8e\u673a\u5668\u6838\u6570 \u3002 \u8fd8\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7ebf\u7a0b\u6570\u5e76\u4e0d\u662f\u8d8a\u5927\u8d8a\u597d\uff0c\u5b98\u65b9\u8ba4\u4e3a\u8d85\u8fc7\u4e868\u4e2a\u57fa\u672c\u5c31\u6ca1\u4ec0\u4e48\u610f\u4e49\u4e86 \u3002 13 \u95ee\u9898\uff1aRedis6.0\u591a\u7ebf\u7a0b\u7684\u5b9e\u73b0\u673a\u5236\uff1f \u6d41\u7a0b\u7b80\u8ff0\u5982\u4e0b\uff1a \u4e3b\u7ebf\u7a0b\u8d1f\u8d23\u63a5\u6536\u5efa\u7acb\u8fde\u63a5\u8bf7\u6c42\uff0c\u83b7\u53d6 socket \u653e\u5165\u5168\u5c40\u7b49\u5f85\u8bfb\u5904\u7406\u961f\u5217 \u4e3b\u7ebf\u7a0b\u5904\u7406\u5b8c\u8bfb\u4e8b\u4ef6\u4e4b\u540e\uff0c\u901a\u8fc7 RR(Round Robin) \u5c06\u8fd9\u4e9b\u8fde\u63a5\u5206\u914d\u7ed9\u8fd9\u4e9b IO \u7ebf\u7a0b \u4e3b\u7ebf\u7a0b\u963b\u585e\u7b49\u5f85 IO \u7ebf\u7a0b\u8bfb\u53d6 socket \u5b8c\u6bd5 \u4e3b\u7ebf\u7a0b\u901a\u8fc7\u5355\u7ebf\u7a0b\u7684\u65b9\u5f0f\u6267\u884c\u8bf7\u6c42\u547d\u4ee4\uff0c\u8bf7\u6c42\u6570\u636e\u8bfb\u53d6\u5e76\u89e3\u6790\u5b8c\u6210\uff0c\u4f46\u5e76\u4e0d\u6267\u884c \u4e3b\u7ebf\u7a0b\u963b\u585e\u7b49\u5f85 IO \u7ebf\u7a0b\u5c06\u6570\u636e\u56de\u5199 socket \u5b8c\u6bd5 \u89e3\u9664\u7ed1\u5b9a\uff0c\u6e05\u7a7a\u7b49\u5f85\u961f\u5217 14 \u95ee\u9898\uff1aredis\u5982\u4f55\u505a\u5230\u9ad8\u53ef\u7528\uff1f \u7b54\uff1aredis\u5177\u5907\u7684\u9ad8\u53ef\u7528\uff0c\u5176\u5b9e\u5305\u542b\u4e24\u5c42\u542b\u4e49\uff1a \u4e00\u662f\u6570\u636e\u5c3d\u91cf\u5c11\u4e22\u5931\uff0c\u4e8c\u662f\u670d\u52a1\u5c3d\u91cf\u5c11\u4e2d\u65ad\u3002\u5bf9\u4e8e\u524d\u8005redis\u4f7f\u7528AOF\u548cRDB\u4e24\u79cd\u6301\u4e45\u5316\u65b9\u5f0f\u4fdd\u8bc1\uff0c\u5bf9\u4e8e\u540e\u8005Redis\u7684\u505a\u6cd5\u5c31\u662f\u589e\u52a0\u526f\u672c\u5197\u4f59\u91cf\uff0c\u5c06\u4e00\u4efd\u6570\u636e\u540c\u65f6\u4fdd\u5b58\u5728\u591a\u4e2a\u5b9e\u4f8b\u4e0a\u3002","title":"Redis6.0\u4e0e\u7f13\u5b58\u5927\u5168\u57fa\u7840\u9762\u8bd5"},{"location":"chap10/5redis6_int/#redis60","text":"","title":"\u7b2c\u4e94\u7ae0 Redis6.0\u4e0e\u7f13\u5b58\u5927\u5168\u57fa\u7840\u9762\u8bd5"},{"location":"chap10/5redis6_int/#1-redis","text":"Redis \u662f\u4e00\u4e2a\u57fa\u4e8e \u5185\u5b58\u7684\u9ad8\u6027\u80fdkey-value\u6570\u636e\u5e93 \u3002","title":"1 \u95ee\u9898\uff1a\u4ec0\u4e48\u662fredis?"},{"location":"chap10/5redis6_int/#2-redis","text":"\u7b54\uff1aredis\u53ef\u4ee5\u505a\u5f88\u591a\u4e8b\u60c5\uff0c\u6bd4\u5982\uff1a \u7f13\u5b58 / \u5206\u5e03\u5f0f\u9501 \uff08setnx\uff09 / \u7b80\u6613\u7684\u6d88\u606f\u961f\u5217\uff08List/Streams\uff09 / \u7b80\u6613\u8ba2\u9605\u901a\u77e5\uff08Pub/Sub\uff09 / \u5ef6\u65f6\u901a\u77e5\uff08\u952e\u8fc7\u671f\u4e8b\u4ef6\u901a\u77e5\uff09 / \u9644\u8fd1\u7684\u4eba\uff08GEO\uff09 \u4ee5\u4e0b\u662f\u5177\u4f53\u4e1a\u52a1\u573a\u666f\uff1a \u8bb0\u5f55\u5e16\u5b50\u7684\u70b9\u8d5e\u6570\u3001\u8bc4\u8bba\u6570\u548c\u70b9\u51fb\u6570 (hash)\u3002 \u8bb0\u5f55\u7528\u6237\u7684\u5e16\u5b50 ID \u5217\u8868 (\u6392\u5e8f)\uff0c\u4fbf\u4e8e\u5feb\u901f\u663e\u793a\u7528\u6237\u7684\u5e16\u5b50\u5217\u8868 (zset)\u3002 \u8bb0\u5f55\u5e16\u5b50\u7684\u6807\u9898\u3001\u6458\u8981\u3001\u4f5c\u8005\u548c\u5c01\u9762\u4fe1\u606f\uff0c\u7528\u4e8e\u5217\u8868\u9875\u5c55\u793a (hash)\u3002 \u8bb0\u5f55\u5e16\u5b50\u7684\u70b9\u8d5e\u7528\u6237 ID \u5217\u8868\uff0c\u8bc4\u8bba ID \u5217\u8868\uff0c\u7528\u4e8e\u663e\u793a\u548c\u53bb\u91cd\u8ba1\u6570 (zset)\u3002 \u7f13\u5b58\u8fd1\u671f\u70ed\u5e16\u5185\u5bb9 (\u5e16\u5b50\u5185\u5bb9\u7a7a\u95f4\u5360\u7528\u6bd4\u8f83\u5927)\uff0c\u51cf\u5c11\u6570\u636e\u5e93\u538b\u529b (hash)\u3002 \u8bb0\u5f55\u5e16\u5b50\u7684\u76f8\u5173\u6587\u7ae0 ID\uff0c\u6839\u636e\u5185\u5bb9\u63a8\u8350\u76f8\u5173\u5e16\u5b50 (list)\u3002 \u5982\u679c\u5e16\u5b50 ID \u662f\u6574\u6570\u81ea\u589e\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528 Redis \u6765\u5206\u914d\u5e16\u5b50 ID(\u8ba1\u6570\u5668)\u3002 \u6536\u85cf\u96c6\u548c\u5e16\u5b50\u4e4b\u95f4\u7684\u5173\u7cfb (zset)\u3002 \u8bb0\u5f55\u70ed\u699c\u5e16\u5b50 ID \u5217\u8868\uff0c\u603b\u70ed\u699c\u548c\u5206\u7c7b\u70ed\u699c (zset)\u3002 \u7f13\u5b58\u7528\u6237\u884c\u4e3a\u5386\u53f2\uff0c\u8fdb\u884c\u6076\u610f\u884c\u4e3a\u8fc7\u6ee4 (zset,hash)\u3002","title":"2 \u95ee\u9898\uff1aredis\u53ef\u4ee5\u7528\u5728\u54ea\u4e9b\u4e1a\u52a1\u4e0a\uff1f"},{"location":"chap10/5redis6_int/#3-redis","text":"\u7b54\uff1aRedis\u662f\u4e00\u79cd Key-Value \u7684\u6a21\u578b\uff0ckey\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u800c\u5e38\u8bf4\u7684\u6570\u636e\u7ed3\u6784\u4e00\u822c\u662f\u6307value\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4e00\u822c\u5305\u542b\u4ee5\u4e0b\u7c7b\u578b\u3002 \u6700\u666e\u901a\u5e38\u89c1\u7684\uff0c\u5b57\u7b26\u4e32(String)\uff0c\u5b57\u5178(Hash)\uff0c\u5217\u8868(List)\uff0c\u96c6\u5408(Set)\uff0c\u6709\u5e8f\u96c6\u5408(SortedSet)\u3002 \u9ad8\u7ea7\u6570\u636e\u7ed3\u6784\uff0cHyperLogLog\uff0cGeo\uff0cbitmap \u66f4\u9ad8\u7ea7\u7528\u6237\u53ef\u80fd\u8fd8\u77e5\u9053Redis Module\uff0c\u50cf BloomFilter\uff0cRedisSearch\uff0cRedis-ML\u3002","title":"3 \u95ee\u9898\uff1aRedis\u6709\u54ea\u4e9b\u6570\u636e\u7ed3\u6784\uff1f"},{"location":"chap10/5redis6_int/#4-redis","text":"\u901f\u5ea6\u5feb\uff0c\u56e0\u4e3a\u6570\u636e\u5b58\u5728\u5185\u5b58\u4e2d \uff0c\u7c7b\u4f3c\u4e8eHashMap\uff0cHashMap\u7684\u4f18\u52bf\u5c31\u662f\u67e5\u627e\u548c\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u662fO(1) \u652f\u6301\u4e30\u5bcc\u6570\u636e\u7c7b\u578b \uff0c\u652f\u6301string\uff0clist\uff0cset\uff0csorted set\uff0chash \u652f\u6301\u4e8b\u52a1\uff0c\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u6027 \uff0c\u6240\u8c13\u7684\u539f\u5b50\u6027\u5c31\u662f\u5bf9\u6570\u636e\u7684\u66f4\u6539\u8981\u4e48\u5168\u90e8\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u6267\u884c \u4e30\u5bcc\u7684\u7279\u6027 \uff1a\u53ef\u7528\u4e8e\u7f13\u5b58\uff0c\u6d88\u606f\uff0c\u6309key\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u8fc7\u671f\u540e\u5c06\u4f1a\u81ea\u52a8\u5220\u9664\u3002","title":"4 \u95ee\u9898\uff1a\u4f7f\u7528Redis\u6709\u54ea\u4e9b\u597d\u5904\uff1f"},{"location":"chap10/5redis6_int/#5-redismemcached","text":"memcached\u6240\u6709\u7684\u503c\u5747\u662f\u7b80\u5355\u7684\u5b57\u7b26\u4e32\uff0credis\u4f5c\u4e3a\u5176\u66ff\u4ee3\u8005\uff0c\u652f\u6301\u66f4\u4e3a\u4e30\u5bcc\u7684\u6570\u636e\u7c7b\u578b redis\u7684\u901f\u5ea6\u6bd4memcached\u5feb\u5f88\u591a redis\u53ef\u4ee5\u6301\u4e45\u5316\u5176\u6570\u636e","title":"5 \u95ee\u9898\uff1aredis\u76f8\u6bd4memcached\u6709\u54ea\u4e9b\u4f18\u52bf\uff1f"},{"location":"chap10/5redis6_int/#6-redis","text":"\u7b54\uff1a\u4e3b\u8981\u6709\u4ee5\u4e0b\u56db\u70b9\u7f3a\u70b9\uff1a \u7f13\u5b58\u548c\u6570\u636e\u5e93\u53cc\u5199\u4e00\u81f4\u6027\u95ee\u9898 \u5f53\u4e00\u4e2a\u6570\u636e\u9700\u8981\u66f4\u65b0\u65f6\uff0c\u56e0\u4e3a\u4e0d\u53ef\u80fd\u505a\u5230\u540c\u65f6\u66f4\u65b0\u6570\u636e\u5e93\u548c\u7f13\u5b58\uff0c\u90a3\u4e48\u6b64\u65f6\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\u5c31\u4e00\u5b9a\u4f1a\u53d1\u751f\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\uff0c\u800c\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\u5728\u91d1\u878d\u4ea4\u6613\u9886\u57df\u7684\u7cfb\u7edf\u4e2d\u662f\u80af\u5b9a\u4e0d\u5141\u8bb8\u7684\u3002 \u89e3\u51b3\u529e\u6cd5\uff1a\u8bfb\u7684\u65f6\u5019\u5148\u8bfb\u7f13\u5b58\uff0c\u7f13\u5b58\u6ca1\u6709\u7684\u8bdd\uff0c\u5c31\u8bfb\u6570\u636e\u5e93\uff0c\u7136\u540e\u53d6\u51fa\u6570\u636e\u540e\u653e\u5165\u7f13\u5b58\uff0c\u540c\u65f6\u8fd4\u56de\u54cd\u5e94\u3002\u66f4\u65b0\u7684\u65f6\u5019\uff0c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u7136\u540e\u518d\u5220\u9664\u7f13\u5b58\u3002 \u7f13\u5b58\u96ea\u5d29\u95ee\u9898 \u7f13\u5b58\u96ea\u5d29\u662f\u6307\u5f53\u5927\u91cf\u7f13\u5b58\u5931\u6548\u65f6\uff0c\u5927\u91cf\u7684\u8bf7\u6c42\u8bbf\u95ee\u76f4\u63a5\u8bf7\u6c42\u6570\u636e\u5e93\uff0c\u5bfc\u81f4\u6570\u636e\u5e93\u670d\u52a1\u5668\u65e0\u6cd5\u6297\u4f4f\u8bf7\u6c42\u6216\u6302\u6389\u7684\u60c5\u51b5\u3002\u8fd9\u65f6\u7f51\u7ad9\u5e38\u5e38\u4f1a\u51fa\u73b0 502 \u9519\u8bef\uff0c\u5bfc\u81f4\u7f51\u7ad9\u4e0d\u53ef\u7528\u95ee\u9898\u3002 \u5408\u7406\u89c4\u5212\u7f13\u5b58\u7684\u5931\u6548\u65f6\u95f4\uff0c\u53ef\u4ee5\u7ed9\u7f13\u5b58\u65f6\u95f4\u52a0\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u9632\u6b62\u7edf\u4e00\u65f6\u95f4\u8fc7\u671f \u7f13\u5b58\u51fb\u7a7f\u95ee\u9898 \u7f13\u5b58\u51fb\u7a7f\u662f\u6307\uff0c\u9488\u5bf9\u67d0\u4e2a\u8bbf\u95ee\u975e\u5e38\u9891\u7e41\u7684\u70ed\u70b9\u6570\u636e\u7684\u8bf7\u6c42\uff0c\u65e0\u6cd5\u5728\u7f13\u5b58\u4e2d\u8fdb\u884c\u5904\u7406\uff0c\u7d27\u63a5\u7740\uff0c\u8bbf\u95ee\u8be5\u6570\u636e\u7684\u5927\u91cf\u8bf7\u6c42\uff0c \u4e00\u4e0b\u5b50\u90fd\u53d1\u9001\u5230\u4e86\u540e\u7aef\u6570\u636e\u5e93\uff0c\u5bfc\u81f4\u4e86\u6570\u636e\u5e93\u538b\u529b\u6fc0\u589e\uff0c\u4f1a\u5f71\u54cd\u6570\u636e\u5e93\u5904\u7406\u5176\u4ed6\u8bf7\u6c42 \u5bf9\u4e8e\u8bbf\u95ee\u7279\u522b\u9891\u7e41\u7684\u70ed\u70b9\u6570\u636e\uff0c\u6211\u4eec\u5c31\u4e0d\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u4e86 \u7f13\u5b58\u7a7f\u900f\u95ee\u9898 \u7f13\u5b58\u7a7f\u900f\u662f\u6307\u8981\u8bbf\u95ee\u7684\u6570\u636e\u65e2\u4e0d\u5728 Redis \u7f13\u5b58\u4e2d\uff0c\u4e5f\u4e0d\u5728\u6570\u636e\u5e93\u4e2d\uff0c\u5bfc\u81f4\u8bf7\u6c42\u5728\u8bbf\u95ee\u7f13\u5b58\u65f6\uff0c\u53d1\u751f\u7f13\u5b58\u7f3a\u5931\uff0c\u518d\u53bb\u8bbf\u95ee\u6570\u636e\u5e93\u65f6\uff0c\u53d1\u73b0\u6570\u636e\u5e93\u4e2d\u4e5f\u6ca1\u6709\u8981\u8bbf\u95ee\u7684\u6570\u636e \u4e1a\u52a1\u5c42\u8bef\u64cd\u4f5c\uff1a \u7f13\u5b58\u4e2d\u7684\u6570\u636e\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u88ab\u8bef\u5220\u9664\u4e86\uff0c\u6240\u4ee5\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u90fd\u6ca1\u6709\u6570\u636e\uff1b \u6076\u610f\u653b\u51fb\uff1a \u4e13\u95e8\u8bbf\u95ee\u6570\u636e\u5e93\u4e2d\u6ca1\u6709\u7684\u6570\u636e \u3002","title":"6 \u4f7f\u7528redis\u6709\u4ec0\u4e48\u7f3a\u70b9\uff1f"},{"location":"chap10/5redis6_int/#7-redis","text":"volatile-lru(Least Recently Used) \uff1a\u4ece\u5df2\u7ecf\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u4e2d\uff0c\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70\u3002 volatile-ttl \uff1a\u4ece\u5df2\u7ecf\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u4e2d\uff0c\u6311\u9009\u5373\u5c06\u8981\u8fc7\u671f\u7684\u6570\u636e\u6dd8\u6c70\u3002 volatile-random \uff1a\u4ece\u5df2\u7ecf\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u4e2d\uff0c\u968f\u673a\u6311\u9009\u6570\u636e\u6dd8\u6c70\u3002 volatile-lfu(Least Frequently Used) \uff1a\u4ece\u5df2\u7ecf\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u4e2d\uff0c\u4f1a\u4f7f\u7528LFU\u7b97\u6cd5\u9009\u62e9\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u503c\u5bf9\u3002 allkeys-lru \uff1a\u4ece\u6240\u6709\u7684\u6570\u636e\u96c6\u4e2d\uff0c\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70\u3002 allkeys-random \uff1a\u4ece\u6240\u6709\u7684\u6570\u636e\u96c6\u4e2d\uff0c\u968f\u673a\u6311\u9009\u6570\u636e\u6dd8\u6c70\u3002 no-eviction \uff1a\u7981\u6b62\u6dd8\u6c70\u6570\u636e\uff0c\u5982\u679credis\u5199\u6ee1\u4e86\u5c06\u4e0d\u63d0\u4f9b\u5199\u8bf7\u6c42\uff0c\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\u3002 \u6ce8\u610f\u8fd9\u91cc\u76846\u79cd\u673a\u5236\uff0cvolatile\u548callkeys\u89c4\u5b9a\u4e86\u662f\u5bf9\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u6dd8\u6c70\u6570\u636e\u8fd8\u662f\u4ece\u5168\u90e8\u6570\u636e\u96c6\u6dd8\u6c70\u6570\u636e\uff0c\u540e\u9762\u7684lru\u3001ttl\u4ee5\u53carandom\u662f\u4e09\u79cd\u4e0d\u540c\u7684\u6dd8\u6c70\u7b56\u7565\uff0c\u518d\u52a0\u4e0a\u4e00\u79cd no-eviction \u6c38\u4e0d\u56de\u6536\u7684\u7b56\u7565\u3002 \u4f7f\u7528\u7b56\u7565\u89c4\u5219\uff1a \u5982\u679c\u6570\u636e\u5448\u73b0\u5e42\u5f8b\u5206\u5e03\uff0c\u4e5f\u5c31\u662f\u4e00\u90e8\u5206\u6570\u636e\u8bbf\u95ee\u9891\u7387\u9ad8\uff0c\u4e00\u90e8\u5206\u6570\u636e\u8bbf\u95ee\u9891\u7387\u4f4e\uff0c\u5219\u4f7f\u7528 allkeys-lru \u5982\u679c\u6570\u636e\u5448\u73b0\u5e73\u7b49\u5206\u5e03\uff0c\u4e5f\u5c31\u662f\u6240\u6709\u7684\u6570\u636e\u8bbf\u95ee\u9891\u7387\u90fd\u76f8\u540c\uff0c\u5219\u4f7f\u7528 allkeys-random","title":"7 \u95ee\u9898\uff1aRedis\u63d0\u4f9b\u4e86\u51e0\u79cd\u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff1f\u8be5\u600e\u4e48\u9009\u62e9\uff1f"},{"location":"chap10/5redis6_int/#8-redis","text":"\u7b54\uff1a Redi \u4e3a\u4e86\u8fbe\u5230\u6700\u5feb\u7684\u8bfb\u5199\u901f\u5ea6\u5c06\u6570\u636e\u90fd\u8bfb\u5230\u5185\u5b58\u4e2d\uff0c\u5e76\u901a\u8fc7\u5f02\u6b65\u7684\u65b9\u5f0f\u5c06\u6570\u636e\u5199\u5165\u78c1\u76d8\u3002\u6240\u4ee5redis\u5177\u6709\u5feb\u901f\u548c\u6570\u636e\u6301\u4e45\u5316\u7684\u7279\u5f81\u3002 \u5982\u679c\u4e0d\u5c06\u6570\u636e\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u78c1\u76d8 I/O \u901f\u5ea6\u4e3a\u4e25\u91cd\u5f71\u54cd redis \u7684\u6027\u80fd\u3002 \u5728\u5185\u5b58\u8d8a\u6765\u8d8a\u4fbf\u5b9c\u7684\u4eca\u5929\uff0credis\u5c06\u4f1a\u8d8a\u6765\u8d8a\u53d7\u6b22\u8fce\u3002","title":"8 \u95ee\u9898\uff1a\u4e3a\u4ec0\u4e48redis\u9700\u8981\u628a\u6240\u6709\u6570\u636e\u653e\u5230\u5185\u5b58\u4e2d\uff1f"},{"location":"chap10/5redis6_int/#9-redis","text":"\u7b54\uff1aRedis\u662f\u5355\u7ebf\u7a0b\u7684\uff0c \u4e3b\u8981\u662f\u6307Redis\u7684\u7f51\u7edcIO\u548c\u952e\u503c\u5bf9\u8bfb\u5199\u662f\u7531\u4e00\u4e2a\u7ebf\u7a0b\u6765\u5b8c\u6210\u7684 \uff0c\u8fd9\u4e5f\u662fRedis\u5bf9\u5916\u63d0\u4f9b\u952e\u503c\u5b58\u50a8\u670d\u52a1\u7684\u4e3b\u8981\u6d41\u7a0b\u3002 \u4f46Redis\u7684\u5176\u4ed6\u529f\u80fd\uff0c\u6bd4\u5982\u6301\u4e45\u5316\u3001\u5f02\u6b65\u5220\u9664\u3001\u96c6\u7fa4\u6570\u636e\u540c\u6b65\u7b49\uff0c\u5176\u5b9e\u662f\u7531\u989d\u5916\u7684\u7ebf\u7a0b\u6267\u884c\u7684\u3002","title":"9 \u95ee\u9898\uff1aRedis\u662f\u5355\u7ebf\u7a0b\u7684\u5417\uff1f"},{"location":"chap10/5redis6_int/#10-redis60","text":"\u7b54\uff1aRedis\u5c06\u6240\u6709\u6570\u636e\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u5185\u5b58\u7684\u54cd\u5e94\u65f6\u957f\u5927\u7ea6\u4e3a100\u7eb3\u79d2\uff0c\u5bf9\u4e8e\u5c0f\u6570\u636e\u5305\uff0cRedis\u670d\u52a1\u5668\u53ef\u4ee5\u5904\u74068\u4e07\u523010\u4e07QPS\uff0c\u8fd9\u4e5f\u662fRedis\u5904\u7406\u7684\u6781\u9650\u4e86\uff0c\u5bf9\u4e8e80%\u7684\u516c\u53f8\u6765\u8bf4\uff0c\u5355\u7ebf\u7a0b\u7684Redis\u5df2\u7ecf\u8db3\u591f\u4f7f\u7528\u4e86\u3002 \u4eceRedis\u81ea\u8eab\u89d2\u5ea6\u6765\u8bf4\uff0c\u56e0\u4e3a\u8bfb\u5199\u7f51\u7edc\u7684read/write\u7cfb\u7edf\u8c03\u7528\u5360\u7528\u4e86Redis\u6267\u884c\u671f\u95f4\u5927\u90e8\u5206CPU\u65f6\u95f4\uff0c\u74f6\u9888\u4e3b\u8981\u5728\u4e8e\u7f51\u7edc\u7684 IO \u6d88\u8017, \u4f18\u5316\u4e3b\u8981\u6709\u4e24\u4e2a\u65b9\u5411: \u63d0\u9ad8\u7f51\u7edc IO \u6027\u80fd\uff0c\u5178\u578b\u7684\u5b9e\u73b0\u6bd4\u5982\u4f7f\u7528 DPDK \u6765\u66ff\u4ee3\u5185\u6838\u7f51\u7edc\u6808\u7684\u65b9\u5f0f \u4f7f\u7528\u591a\u7ebf\u7a0b\u5145\u5206\u5229\u7528\u591a\u6838\uff0c\u5178\u578b\u7684\u5b9e\u73b0\u6bd4\u5982 Memcached\u3002 \u534f\u8bae\u6808\u4f18\u5316\u7684\u8fd9\u79cd\u65b9\u5f0f\u8ddf Redis \u5173\u7cfb\u4e0d\u5927\uff0c\u652f\u6301\u591a\u7ebf\u7a0b\u662f\u4e00\u79cd\u6700\u6709\u6548\u6700\u4fbf\u6377\u7684\u64cd\u4f5c\u65b9\u5f0f\u3002\u6240\u4ee5\u603b\u7ed3\u8d77\u6765\uff0credis\u652f\u6301\u591a\u7ebf\u7a0b\u4e3b\u8981\u5c31\u662f\u4e24\u4e2a\u539f\u56e0\uff1a \u53ef\u4ee5\u5145\u5206\u5229\u7528\u670d\u52a1\u5668 CPU \u8d44\u6e90\uff0c\u76ee\u524d\u4e3b\u7ebf\u7a0b\u53ea\u80fd\u5229\u7528\u4e00\u4e2a\u6838 \u591a\u7ebf\u7a0b\u4efb\u52a1\u53ef\u4ee5\u5206\u644a Redis \u540c\u6b65 IO \u8bfb\u5199\u8d1f\u8377","title":"10 \u95ee\u9898\uff1aRedis6.0\u4e3a\u4ec0\u4e48\u8981\u5f15\u5165\u591a\u7ebf\u7a0b\u5462\uff1f"},{"location":"chap10/5redis6_int/#11-redis60","text":"\u7b54\uff1a Redis6.0\u7684\u591a\u7ebf\u7a0b\u9ed8\u8ba4\u662f\u7981\u7528\u7684\uff0c\u53ea\u4f7f\u7528\u4e3b\u7ebf\u7a0b \u3002\u5982\u9700\u5f00\u542f\u9700\u8981\u4fee\u6539redis.conf\u914d\u7f6e\u6587\u4ef6\uff1a io-threads-do-reads yes","title":"11 \u95ee\u9898\uff1aRedis6.0\u9ed8\u8ba4\u662f\u5426\u5f00\u542f\u4e86\u591a\u7ebf\u7a0b\uff1f"},{"location":"chap10/5redis6_int/#12-redis60","text":"\u7b54\uff1a\u5f00\u542f\u591a\u7ebf\u7a0b\u540e\uff0c\u8fd8\u9700\u8981\u8bbe\u7f6e\u7ebf\u7a0b\u6570\uff0c\u5426\u5219\u662f\u4e0d\u751f\u6548\u7684\u3002\u540c\u6837\u4fee\u6539 redis.conf \u914d\u7f6e\u6587\u4ef6 \u5173\u4e8e\u7ebf\u7a0b\u6570\u7684\u8bbe\u7f6e\uff0c\u5b98\u65b9\u6709\u4e00\u4e2a\u5efa\u8bae\uff1a 4\u6838\u7684\u673a\u5668\u5efa\u8bae\u8bbe\u7f6e\u4e3a2\u62163\u4e2a\u7ebf\u7a0b\uff0c8\u6838\u7684\u5efa\u8bae\u8bbe\u7f6e\u4e3a6\u4e2a\u7ebf\u7a0b\uff0c\u7ebf\u7a0b\u6570\u4e00\u5b9a\u8981\u5c0f\u4e8e\u673a\u5668\u6838\u6570 \u3002 \u8fd8\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7ebf\u7a0b\u6570\u5e76\u4e0d\u662f\u8d8a\u5927\u8d8a\u597d\uff0c\u5b98\u65b9\u8ba4\u4e3a\u8d85\u8fc7\u4e868\u4e2a\u57fa\u672c\u5c31\u6ca1\u4ec0\u4e48\u610f\u4e49\u4e86 \u3002","title":"12 \u95ee\u9898\uff1aRedis6.0\u591a\u7ebf\u7a0b\u5f00\u542f\u65f6\uff0c\u7ebf\u7a0b\u6570\u5982\u4f55\u8bbe\u7f6e\uff1f"},{"location":"chap10/5redis6_int/#13-redis60","text":"\u6d41\u7a0b\u7b80\u8ff0\u5982\u4e0b\uff1a \u4e3b\u7ebf\u7a0b\u8d1f\u8d23\u63a5\u6536\u5efa\u7acb\u8fde\u63a5\u8bf7\u6c42\uff0c\u83b7\u53d6 socket \u653e\u5165\u5168\u5c40\u7b49\u5f85\u8bfb\u5904\u7406\u961f\u5217 \u4e3b\u7ebf\u7a0b\u5904\u7406\u5b8c\u8bfb\u4e8b\u4ef6\u4e4b\u540e\uff0c\u901a\u8fc7 RR(Round Robin) \u5c06\u8fd9\u4e9b\u8fde\u63a5\u5206\u914d\u7ed9\u8fd9\u4e9b IO \u7ebf\u7a0b \u4e3b\u7ebf\u7a0b\u963b\u585e\u7b49\u5f85 IO \u7ebf\u7a0b\u8bfb\u53d6 socket \u5b8c\u6bd5 \u4e3b\u7ebf\u7a0b\u901a\u8fc7\u5355\u7ebf\u7a0b\u7684\u65b9\u5f0f\u6267\u884c\u8bf7\u6c42\u547d\u4ee4\uff0c\u8bf7\u6c42\u6570\u636e\u8bfb\u53d6\u5e76\u89e3\u6790\u5b8c\u6210\uff0c\u4f46\u5e76\u4e0d\u6267\u884c \u4e3b\u7ebf\u7a0b\u963b\u585e\u7b49\u5f85 IO \u7ebf\u7a0b\u5c06\u6570\u636e\u56de\u5199 socket \u5b8c\u6bd5 \u89e3\u9664\u7ed1\u5b9a\uff0c\u6e05\u7a7a\u7b49\u5f85\u961f\u5217","title":"13 \u95ee\u9898\uff1aRedis6.0\u591a\u7ebf\u7a0b\u7684\u5b9e\u73b0\u673a\u5236\uff1f"},{"location":"chap10/5redis6_int/#14-redis","text":"\u7b54\uff1aredis\u5177\u5907\u7684\u9ad8\u53ef\u7528\uff0c\u5176\u5b9e\u5305\u542b\u4e24\u5c42\u542b\u4e49\uff1a \u4e00\u662f\u6570\u636e\u5c3d\u91cf\u5c11\u4e22\u5931\uff0c\u4e8c\u662f\u670d\u52a1\u5c3d\u91cf\u5c11\u4e2d\u65ad\u3002\u5bf9\u4e8e\u524d\u8005redis\u4f7f\u7528AOF\u548cRDB\u4e24\u79cd\u6301\u4e45\u5316\u65b9\u5f0f\u4fdd\u8bc1\uff0c\u5bf9\u4e8e\u540e\u8005Redis\u7684\u505a\u6cd5\u5c31\u662f\u589e\u52a0\u526f\u672c\u5197\u4f59\u91cf\uff0c\u5c06\u4e00\u4efd\u6570\u636e\u540c\u65f6\u4fdd\u5b58\u5728\u591a\u4e2a\u5b9e\u4f8b\u4e0a\u3002","title":"14 \u95ee\u9898\uff1aredis\u5982\u4f55\u505a\u5230\u9ad8\u53ef\u7528\uff1f"},{"location":"chap2/10redis_basic_sum/","text":"\u7b2c\u4e8c\u7ae0 Redis\u6838\u5fc3\u6280\u672f\u57fa\u7840\u603b\u7ed3\u7bc7 1\u3001Redis \u57fa\u7840\u77e5\u8bc6\u603b\u7ed3 \u7b2c\u4e00\u8282 \u57fa\u672c\u67b6\u6784\uff1a \u952e\u503c\u6570\u636e\u5e93 \u4e3a\u4e86\u652f\u6301\u66f4\u52a0\u4e30\u5bcc\u7684\u4e1a\u52a1\u573a\u666f\uff0cRedis \u5bf9\u8fd9\u4e9b\u7ec4\u4ef6\u6216\u8005\u529f\u80fd\u8fdb\u884c\u4e86\u6269\u5c55\uff0c\u6216\u8005\u8bf4\u662f\u8fdb\u884c\u4e86\u7cbe\u7ec6\u4f18\u5316\uff0c\u4ece\u800c\u6ee1\u8db3\u4e86\u529f\u80fd\u548c\u6027\u80fd\u7b49\u65b9\u9762\u7684\u8981\u6c42\u3002 \u4ece\u8fd9\u5f20\u5bf9\u6bd4\u56fe\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u4ece SimpleKV \u6f14\u8fdb\u5230 Redis\uff0c\u6709\u4ee5\u4e0b\u51e0\u4e2a\u91cd\u8981\u53d8\u5316\uff1a Redis \u4e3b\u8981\u901a\u8fc7\u7f51\u7edc\u6846\u67b6\u8fdb\u884c\u8bbf\u95ee\uff0c\u800c\u4e0d\u518d\u662f\u52a8\u6001\u5e93\u4e86 \uff0c\u8fd9\u4e5f\u4f7f\u5f97 Redis \u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u57fa\u7840\u6027\u7684\u7f51\u7edc\u670d\u52a1\u8fdb\u884c\u8bbf\u95ee\uff0c\u6269\u5927\u4e86 Redis \u7684\u5e94\u7528\u8303\u56f4\u3002 Redis \u6570\u636e\u6a21\u578b\u4e2d\u7684 value \u7c7b\u578b\u5f88\u4e30\u5bcc\uff0c\u56e0\u6b64\u4e5f\u5e26\u6765\u4e86\u66f4\u591a\u7684\u64cd\u4f5c\u63a5\u53e3\uff0c\u4f8b\u5982\u9762\u5411\u5217\u8868\u7684 LPUSH/LPOP\uff0c\u9762\u5411\u96c6\u5408\u7684 SADD/SREM \u7b49\u3002 Redis \u7684\u6301\u4e45\u5316\u6a21\u5757\u80fd\u652f\u6301\u4e24\u79cd\u65b9\u5f0f\uff1a\u65e5\u5fd7\uff08AOF\uff09\u548c\u5feb\u7167\uff08RDB\uff09 \uff0c\u8fd9\u4e24\u79cd\u6301\u4e45\u5316\u65b9\u5f0f\u5177\u6709\u4e0d\u540c\u7684\u4f18\u52a3\u52bf\uff0c\u5f71\u54cd\u5230 Redis \u7684\u8bbf\u95ee\u6027\u80fd\u548c\u53ef\u9760\u6027\u3002 SimpleKV \u662f\u4e2a\u7b80\u5355\u7684\u5355\u673a\u952e\u503c\u6570\u636e\u5e93\uff0c\u4f46\u662f\uff0cRedis \u652f\u6301\u9ad8\u53ef\u9760\u96c6\u7fa4\u548c\u9ad8\u53ef\u6269\u5c55\u96c6\u7fa4\uff0c\u56e0\u6b64\uff0cRedis \u4e2d\u5305\u542b\u4e86\u76f8\u5e94\u7684\u96c6\u7fa4\u529f\u80fd\u652f\u6491\u6a21\u5757\u3002 \u7b2c\u4e8c\u8282 \u6570\u636e\u7ed3\u6784\uff1aRedis\u4e3a\u4ec0\u4e48\u90a3\u4e48\u5feb\uff1f Redis \u4e4b\u6240\u4ee5\u80fd\u5feb\u901f\u64cd\u4f5c\u952e\u503c\u5bf9\uff0c \u4e00\u65b9\u9762\u662f\u56e0\u4e3a O(1) \u590d\u6742\u5ea6\u7684\u54c8\u5e0c\u8868\u88ab\u5e7f\u6cdb\u4f7f\u7528\uff0c\u5305\u62ec String\u3001Hash \u548c Set\uff0c\u5b83\u4eec\u7684\u64cd\u4f5c\u590d\u6742\u5ea6\u57fa\u672c\u7531\u54c8\u5e0c\u8868\u51b3\u5b9a\uff0c\u53e6\u4e00\u65b9\u9762\uff0cSorted Set \u4e5f\u91c7\u7528\u4e86 O(logN) \u590d\u6742\u5ea6\u7684\u8df3\u8868\u3002 \u4e0d\u8fc7\uff0c\u96c6\u5408\u7c7b\u578b\u7684\u8303\u56f4\u64cd\u4f5c\uff0c\u56e0\u4e3a\u8981\u904d\u5386\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff0c\u590d\u6742\u5ea6\u901a\u5e38\u662f O(N) \u3002 \u8fd9\u91cc\uff0c\u6211\u7684\u5efa\u8bae\u662f\uff1a \u7528\u5176\u4ed6\u547d\u4ee4\u6765\u66ff\u4ee3\uff0c\u4f8b\u5982\u53ef\u4ee5\u7528 SCAN \u6765\u4ee3\u66ff\uff0c\u907f\u514d\u5728 Redis \u5185\u90e8\u4ea7\u751f\u8d39\u65f6\u7684\u5168\u96c6\u5408\u904d\u5386\u64cd\u4f5c\u3002 \u5f53\u7136\uff0c\u6211\u4eec\u4e0d\u80fd\u5fd8\u4e86\u590d\u6742\u5ea6\u8f83\u9ad8\u7684 List \u7c7b\u578b\uff0c\u5b83\u7684\u4e24\u79cd\u5e95\u5c42\u5b9e\u73b0\u7ed3\u6784\uff1a\u53cc\u5411\u94fe\u8868\u548c\u538b\u7f29\u5217\u8868\u7684\u64cd\u4f5c\u590d\u6742\u5ea6\u90fd\u662f O(N)\u3002\u56e0\u6b64\uff0c\u6211\u7684\u5efa\u8bae\u662f\uff1a \u56e0\u5730\u5236\u5b9c\u5730\u4f7f\u7528 List \u7c7b\u578b \u3002\u4f8b\u5982\uff0c\u65e2\u7136\u5b83\u7684 POP/PUSH \u6548\u7387\u5f88\u9ad8\uff0c\u90a3\u4e48\u5c31\u5c06\u5b83\u4e3b\u8981\u7528\u4e8e FIFO \u961f\u5217\u573a\u666f\uff0c\u800c\u4e0d\u662f\u4f5c\u4e3a\u4e00\u4e2a\u53ef\u4ee5\u968f\u673a\u8bfb\u5199\u7684\u96c6\u5408\u3002 \u8bb2\u4e86\u4ec0\u4e48\uff1f Redis\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784 Redis\u7684\u6570\u636e\u7ed3\u6784\uff1a\u6570\u636e\u7684\u4fdd\u5b58\u5f62\u5f0f\u4e0e\u5e95\u5c42\u6570\u636e\u7ed3\u6784 \u7531\u6570\u636e\u7ed3\u6784\u7684\u5f02\u540c\u70b9\uff0c\u5f15\u51fa\u6570\u636e\u64cd\u4f5c\u7684\u5feb\u6162\u539f\u56e0 \u8981\u70b9\u77e5\u8bc6 string\uff0clist\uff0cset\uff0chast, sortset\u90fd\u53ea\u662f\u6570\u636e\u7684\u4fdd\u5b58\u5f62\u5f0f \u5e95\u5c42\u7684\u6570\u636e\u7ed3\u6784\u662f\uff1a\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\uff0c\u53cc\u5411\u94fe\u8868\uff0c\u538b\u7f29\u5217\u8868\uff0c\u54c8\u5e0c\u8868\uff0c\u8df3\u8868\uff0c\u6574\u6570\u6570\u7ec4 Redis\u4f7f\u7528\u4e86\u4e00\u4e2a\u54c8\u5e0c\u8868\u4fdd\u5b58\u6240\u6709\u7684\u952e\u503c\u5bf9 \u4e94\u79cd\u6570\u636e\u5f62\u5f0f\u7684\u5e95\u5c42\u5b9e\u73b0 string\uff1a\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32 list\uff1a\u53cc\u5411\u94fe\u8868\uff0c\u538b\u7f29\u5217\u8868 hash\uff1a\u538b\u7f29\u5217\u8868\uff0c\u54c8\u5e0c\u8868 Sorted Set\uff1a\u538b\u7f29\u5217\u8868\uff0c\u8df3\u8868 set\uff1a\u54c8\u5e0c\u8868\uff0c\u6574\u6570\u6570\u7ec4 List ,hash\uff0cset ,sorted set \u88ab\u7edf\u79f0\u4e3a\u96c6\u5408\u7c7b\u578b\uff0c\u4e00\u4e2a\u952e\u5bf9\u5e94\u4e86\u4e00\u4e2a\u96c6\u5408\u7684\u6570\u636e \u96c6\u5408\u7c7b\u578b\u7684\u952e\u548c\u503c\u4e4b\u95f4\u7684\u7ed3\u6784\u7ec4\u7ec7 redis\u4f7f\u7528\u4e00\u4e2a\u54c8\u5e0c\u8868\u4fdd\u5b58\u6240\u6709\u952e\u503c\u5bf9\uff0c\u4e00\u4e2a\u54c8\u5e0c\u8868\u5b9e\u5219\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u7684\u6bcf\u4e2a\u5143\u7d20\u79f0\u4e3a\u54c8\u5e0c\u6876\u3002 \u54c8\u5e0c\u6876\u4e2d\u7684\u5143\u7d20\u4fdd\u5b58\u7684\u4e0d\u662f\u503c\u7684\u672c\u8eab\uff0c\u800c\u662f\u6307\u5411\u5177\u4f53\u503c\u7684\u6307\u9488 \u54c8\u5e0c\u51b2\u7a81\u89e3\u51b3 Redis\u7684hash\u8868\u662f\u5168\u5c40\u7684\uff0c\u6240\u4ee5\u5f53\u5199\u5165\u5927\u91cf\u7684key\u65f6\uff0c\u5c06\u4f1a\u5e26\u6765\u54c8\u5e0c\u51b2\u7a81\uff0c\u5df2\u7ecfrehash\u53ef\u80fd\u5e26\u6765\u7684\u64cd\u4f5c\u963b\u585e Redis\u89e3\u51b3hash\u51b2\u7a81\u7684\u65b9\u5f0f\uff0c\u662f\u94fe\u5f0f\u54c8\u5e0c\uff1a\u540c\u4e00\u4e2a\u54c8\u5e0c\u6876\u4e2d\u7684\u591a\u4e2a\u5143\u7d20\u7528\u4e00\u4e2a\u94fe\u8868\u6765\u4fdd\u5b58 \u5f53\u54c8\u5e0c\u51b2\u7a81\u94fe\u8fc7\u957f\u65f6\uff0cRedis\u4f1a\u5bf9hash\u8868\u8fdb\u884crehash\u64cd\u4f5c\u3002rehash\u5c31\u662f\u589e\u52a0\u73b0\u6709\u7684hash\u6876\u6570\u91cf\uff0c\u5206\u6563entry\u5143\u7d20\u3002 rehash\u673a\u5236 \u4e86\u4f7frehash\u64cd\u4f5c\u66f4\u9ad8\u6548\uff0cRedis\u9ed8\u8ba4\u4f7f\u7528\u4e86\u4e24\u4e2a\u5168\u5c40\u54c8\u5e0c\u8868\uff1a\u54c8\u5e0c\u88681\u548c\u54c8\u5e0c\u88682\uff0c\u8d77\u59cb\u65f6hash2\u6ca1\u6709\u5206\u914d\u7a7a\u95f4 \u968f\u7740\u6570\u636e\u589e\u591a\uff0cRedis\u6267\u884c\u5206\u4e09\u6b65\u6267\u884crehash; \u7ed9hash2\u5206\u914d\u66f4\u5927\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5982\u662fhash1\u7684\u4e24\u500d \u628ahash1\u4e2d\u7684\u6570\u636e\u91cd\u65b0\u6620\u5c04\u5e76\u62f7\u8d1d\u5230\u54c8\u5e0c\u88682\u4e2d \u91ca\u653ehash1\u7684\u7a7a\u95f4 \u6e10\u8fdb\u5f0frehash \u7531\u4e8e\u6b65\u9aa42\u91cd\u65b0\u6620\u5c04\u975e\u5e38\u8017\u65f6\uff0c\u4f1a\u963b\u585eredis \u8bb2\u96c6\u4e2d\u8fc1\u79fb\u6570\u636e\uff0c\u6539\u6210\u6bcf\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\u65f6\uff0c\u5c31\u4ecehash1\u4e2d\u7684\u7b2c\u4e00\u4e2a\u7d22\u5f15\u4f4d\u7f6e\uff0c\u987a\u5e26\u5c06\u8fd9\u4e2a\u7d22\u5f15\u4f4d\u7f6e\u4e0a\u7684\u6240\u6709entries\u62f7\u8d1d\u5230hash2\u4e2d\u3002 \u538b\u7f29\u5217\u8868\uff0c\u8df3\u8868\u7684\u7279\u70b9 \u538b\u7f29\u5217\u8868\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u6570\u7ec4\uff0c\u4e0d\u540c\u7684\u662f:\u538b\u7f29\u5217\u8868\u5728\u8868\u5934\u6709\u4e09\u4e2a\u5b57\u6bb5zlbytes,zltail\u548czllen\u5206\u522b\u8868\u793a\u957f\u5ea6\uff0c\u5217\u8868\u5c3e\u7684\u504f\u79fb\u91cf\u548c\u5217\u8868\u4e2d\u7684entry\u7684\u4e2a\u6570\uff0c\u538b\u7f29\u5217\u8868\u5c3e\u90e8\u8fd8\u6709\u4e00\u4e2azlend\uff0c\u8868\u793a\u5217\u8868\u7ed3\u675f\u6240\u4ee5\u538b\u7f29\u5217\u8868\u5b9a\u4f4d\u7b2c\u4e00\u4e2a\u548c\u6700\u540e\u4e00\u4e2a\u662fO(1),\u4f46\u5176\u4ed6\u5c31\u662fO(n) \u8df3\u8868\uff1a\u662f\u5728\u94fe\u8868\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u591a\u7ea7\u7d22\u5f15\uff0c\u901a\u8fc7\u7d22\u5f15\u7684\u51e0\u6b21\u8df3\u8f6c\uff0c\u5b9e\u73b0\u6570\u636e\u5feb\u901f\u5b9a\u4f4d \u7b2c\u4e09\u8282 \u9ad8\u6027\u80fdIO\u6a21\u578b\uff1aRedis\u4e3a\u4ec0\u4e48\u90a3\u4e48\u5feb\uff1f Redis \u5355\u7ebf\u7a0b\u662f\u6307\u5b83\u5bf9\u7f51\u7edc IO \u548c\u6570\u636e\u8bfb\u5199\u7684\u64cd\u4f5c\u91c7\u7528\u4e86\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u800c\u91c7\u7528\u5355\u7ebf\u7a0b\u7684\u4e00\u4e2a\u6838\u5fc3\u539f\u56e0\u662f\u907f\u514d\u591a\u7ebf\u7a0b\u5f00\u53d1\u7684\u5e76\u53d1\u63a7\u5236\u95ee\u9898\u3002 \u5355\u7ebf\u7a0b\u7684 Redis \u4e5f\u80fd\u83b7\u5f97\u9ad8\u6027\u80fd\uff0c\u8ddf\u591a\u8def\u590d\u7528\u7684 IO \u6a21\u578b\u5bc6\u5207\u76f8\u5173\uff0c\u56e0\u4e3a\u8fd9\u907f\u514d\u4e86 accept() \u548c send()/recv() \u6f5c\u5728\u7684\u7f51\u7edc IO \u64cd\u4f5c\u963b\u585e\u70b9\u3002 \u672c\u7ae0\u9996\u5148\u4ece\u7b80\u5355\u7684\u7f51\u7edc\u901a\u4fe1socket\u8bb2\u8d77\uff0c\u5f15\u51fa\u4e86\u975e\u963b\u585esocket\uff0c\u7531\u6b64\u8c08\u5230\u4e86\u8457\u540d\u7684I/O\u591a\u8def\u590d\u7528\uff0cLinux\u5185\u6838\u7684select/epoll\u673a\u5236 \u672c\u7ae0\u7684\u5173\u952e\u5728\u4e8e\u5173\u952e\u70b9\u5728\u4e8eaccpet\u548crecv\u65f6\u53ef\u80fd\u4f1a\u963b\u585e\u7ebf\u7a0b\uff0c\u4f7f\u7528IO\u591a\u8def\u590d\u7528\u6280\u672f\u53ef\u4ee5\u8ba9\u7ebf\u7a0b\u5148\u5904\u7406\u5176\u4ed6\u4e8b\u60c5\uff0c\u7b49\u9700\u8981\u7684\u8d44\u6e90\u5230\u4f4d\u540eepoll\u4f1a\u8c03\u7528\u56de\u8c03\u51fd\u6570\u901a\u77e5\u7ebf\u7a0b\uff0c\u7136\u540e\u7ebf\u7a0b\u518d\u53bb\u5904\u7406\u5b58/\u53d6\u6570\u636e\uff1b\u8fd9\u6837\u4e00\u4e2aredis\u670d\u52a1\u7aef\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u540c\u65f6\u5904\u7406\u591a\u4e2a\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e86\u3002 \u7b2c\u56db\u8282 Redis\u5b95\u673a\uff0c\u5982\u4f55\u907f\u514d\u6570\u636e\u4e22\u5931\uff1aAOF(Append Only File)\u65e5\u5fd7 Redis \u7528\u4e8e\u907f\u514d\u6570\u636e\u4e22\u5931\u7684 AOF \u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u901a\u8fc7\u9010\u4e00\u8bb0\u5f55\u64cd\u4f5c\u547d\u4ee4\uff0c\u5728\u6062\u590d\u65f6\u518d\u9010\u4e00\u6267\u884c\u547d\u4ee4\u7684\u65b9\u5f0f\uff0c\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u53ef\u9760\u6027 \u603b\u7ed3\u6765\u8bf4\uff0c\u5b83\u63d0\u4f9b\u4e86 AOF \u65e5\u5fd7\u7684\u4e09\u79cd\u5199\u56de\u7b56\u7565\uff0c\u5206\u522b\u662f Always\u3001Everysec \u548c No\uff0c\u8fd9\u4e09\u79cd\u7b56\u7565\u5728\u53ef\u9760\u6027\u4e0a\u662f\u4ece\u9ad8\u5230\u4f4e\uff0c\u800c\u5728\u6027\u80fd\u4e0a\u5219\u662f\u4ece\u4f4e\u5230\u9ad8\u3002 \u6b64\u5916\uff0c\u4e3a\u4e86\u907f\u514d\u65e5\u5fd7\u6587\u4ef6\u8fc7\u5927\uff0cRedis \u8fd8\u63d0\u4f9b\u4e86 AOF \u91cd\u5199\u673a\u5236\uff0c\u76f4\u63a5\u6839\u636e\u6570\u636e\u5e93\u91cc\u6570\u636e\u7684\u6700\u65b0\u72b6\u6001\uff0c\u751f\u6210\u8fd9\u4e9b\u6570\u636e\u7684\u63d2\u5165\u547d\u4ee4\uff0c\u4f5c\u4e3a\u65b0\u65e5\u5fd7\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u901a\u8fc7\u540e\u53f0\u7ebf\u7a0b\u5b8c\u6210\uff0c\u907f\u514d\u4e86\u5bf9\u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\u3002 AOF \u65e5\u5fd7\u91cd\u5199\u7684\u65f6\u5019\uff0c\u662f\u7531 bgrewriteaof \u5b50\u8fdb\u7a0b\u6765\u5b8c\u6210\u7684\uff0c\u4e0d\u7528\u4e3b\u7ebf\u7a0b\u53c2\u4e0e\uff0c\u6211\u4eec\u4eca\u5929\u8bf4\u7684\u975e\u963b\u585e\u4e5f\u662f\u6307\u5b50\u8fdb\u7a0b\u7684\u6267\u884c\u4e0d\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002\u4f46\u662f\uff0c\u4f60\u89c9\u5f97\uff0c\u8fd9\u4e2a\u91cd\u5199\u8fc7\u7a0b\u6709\u6ca1\u6709\u5176\u4ed6\u6f5c\u5728\u7684\u963b\u585e\u98ce\u9669\u5462\uff1f\u5982\u679c\u6709\u7684\u8bdd\uff0c\u4f1a\u5728\u54ea\u91cc\u963b\u585e\uff1f \u6f5c\u5728\u7684\u963b\u585e\u98ce\u9669\u5305\u62ec\uff1afork\u5b50\u8fdb\u7a0b \u548c AOF\u91cd\u5199\u8fc7\u7a0b\u4e2d\u7236\u8fdb\u7a0b\u4ea7\u751f\u5199\u5165 \u7b2c\u4e94\u8282 Redis\u5b95\u673a\uff0cRedis\u5982\u4f55\u5b9e\u73b0\u5feb\u901f\u6062\u590dRDB \u6211\u4eec\u5b66\u4e60\u4e86 Redis \u7528\u4e8e\u907f\u514d\u6570\u636e\u4e22\u5931\u7684\u5185\u5b58\u5feb\u7167\u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u7684\u4f18\u52bf\u5728\u4e8e\uff0c\u53ef\u4ee5\u5feb\u901f\u6062\u590d\u6570\u636e\u5e93\uff0c\u4e5f\u5c31\u662f\u53ea\u9700\u8981\u628a RDB \u6587\u4ef6\u76f4\u63a5\u8bfb\u5165\u5185\u5b58\uff0c\u8fd9\u5c31\u907f\u514d\u4e86 AOF \u9700\u8981\u987a\u5e8f\u3001\u9010\u4e00\u91cd\u65b0\u6267\u884c\u64cd\u4f5c\u547d\u4ee4\u5e26\u6765\u7684\u4f4e\u6548\u6027\u80fd\u95ee\u9898\u3002 Redis \u8bbe\u8ba1\u4e86 bgsave \u548c\u5199\u65f6\u590d\u5236\u65b9\u5f0f\uff0c\u5c3d\u53ef\u80fd\u51cf\u5c11\u4e86\u5185\u5b58\u5feb\u7167\u5bf9\u6b63\u5e38\u8bfb\u5199\u7684\u5f71\u54cd\uff0c\u4f46\u662f\uff0c\u9891\u7e41\u5feb\u7167\u4ecd\u7136\u662f\u4e0d\u592a\u80fd\u63a5\u53d7\u7684\u3002\u800c\u6df7\u5408\u4f7f\u7528 RDB \u548c AOF\uff0c\u4ee5\u8f83\u5c0f\u7684\u6027\u80fd\u5f00\u9500\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\u548c\u6027\u80fd\u3002 \u5173\u4e8e AOF \u548c RDB \u7684\u9009\u62e9\u95ee\u9898 \u4e09\u70b9\u5efa\u8bae\uff1a \u6570\u636e\u4e0d\u80fd\u4e22\u5931\u65f6\uff0c\u5185\u5b58\u5feb\u7167\u548c AOF \u7684\u6df7\u5408\u4f7f\u7528\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\uff1b \u5982\u679c\u5141\u8bb8\u5206\u949f\u7ea7\u522b\u7684\u6570\u636e\u4e22\u5931\uff0c\u53ef\u4ee5\u53ea\u4f7f\u7528 RDB\uff1b \u5982\u679c\u53ea\u7528 AOF\uff0c\u4f18\u5148\u4f7f\u7528 everysec \u7684\u914d\u7f6e\u9009\u9879\uff0c\u56e0\u4e3a\u5b83\u5728\u53ef\u9760\u6027\u548c\u6027\u80fd\u4e4b\u95f4\u53d6\u4e86\u4e00\u4e2a\u5e73\u8861\u3002 \u5230\u5e95\u662f\u4e3b\u8fdb\u7a0b\u8fd8\u662f\u4e3b\u7ebf\u7a0b Redis\u542f\u52a8\u540e\u672c\u8eab\u662f\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5b83\u7684\u4e3b\u4f53\u5de5\u4f5c\uff08\u63a5\u6536\u8bf7\u6c42\u3001\u670d\u52a1\u8bf7\u6c42\u8bfb\u5199\u6570\u636e\uff09\u4e5f\u662f\u5728\u8fd9\u4e2a\u8fdb\u7a0b\u4e2d\u5b8c\u6210\u7684\uff0c\u79f0Redis\u4e3a\u4e3b\u8fdb\u7a0b\u662f\u53ef\u4ee5\u7684 \u3002 \u540c\u65f6\uff0c Redis\u8fd9\u4e2a\u8fdb\u7a0b\u5c5e\u4e8e\u5355\u7ebf\u7a0b\u7684\u8fdb\u7a0b\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fdb\u7a0b\u4e3b\u4f53\u5de5\u4f5c\u6ca1\u6709\u7528\u591a\u4e2a\u7ebf\u7a0b\u6765\u8fd0\u884c\uff0c\u6240\u4ee5\u6211\u4e00\u822c\u628a\u5b83\u4e5f\u79f0\u4e3a\u4e3b\u7ebf\u7a0b\uff0c\u7a81\u663e\u5b83\u7684\u5355\u7ebf\u7a0b\u6a21\u5f0f \u3002 \u6709\u7684\u7a0b\u5e8f\u542f\u52a8\u540e\uff0c\u4f1a\u5728\u8fdb\u7a0b\u4e2d\u542f\u52a8\u591a\u4e2a\u7ebf\u7a0b\u6765\u5904\u7406\u5de5\u4f5c\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u5c31\u4e0d\u4f1a\u79f0\u5b83\u4e3a\u4e3b\u7ebf\u7a0b\u4e86\uff0c\u56e0\u4e3a\u6ca1\u6709\u4e00\u4e2a\u7ebf\u7a0b\u662f\u5355\u72ec\u505a\u4e3b\u8981\u5de5\u4f5c\u7684 \u7b2c\u516d\u8282 \u6570\u636e\u540c\u6b65\uff1a\u4e3b\u4ece\u5e93\u6570\u636e\u4e00\u81f4 Redis \u7684\u4e3b\u4ece\u5e93\u540c\u6b65\u7684\u57fa\u672c\u539f\u7406\uff0c\u603b\u7ed3\u6765\u8bf4\uff0c\u6709\u4e09\u79cd\u6a21\u5f0f\uff1a \u5168\u91cf\u590d\u5236\u3001\u57fa\u4e8e\u957f\u8fde\u63a5\u7684\u547d\u4ee4\u4f20\u64ad\uff0c\u4ee5\u53ca\u589e\u91cf\u590d\u5236 \u5168\u91cf\u590d\u5236\u867d\u7136\u8017\u65f6\uff0c\u4f46\u662f\u5bf9\u4e8e\u4ece\u5e93\u6765\u8bf4\uff0c\u5982\u679c\u662f\u7b2c\u4e00\u6b21\u540c\u6b65\uff0c\u5168\u91cf\u590d\u5236\u662f\u65e0\u6cd5\u907f\u514d\u7684 \u4e00\u4e2a Redis \u5b9e\u4f8b\u7684\u6570\u636e\u5e93\u4e0d\u8981\u592a\u5927\uff0c\u4e00\u4e2a\u5b9e\u4f8b\u5927\u5c0f\u5728\u51e0 GB \u7ea7\u522b\u6bd4\u8f83\u5408\u9002\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11 RDB \u6587\u4ef6\u751f\u6210\u3001\u4f20\u8f93\u548c\u91cd\u65b0\u52a0\u8f7d\u7684\u5f00\u9500 \u4e3a\u4e86\u907f\u514d\u591a\u4e2a\u4ece\u5e93\u540c\u65f6\u548c\u4e3b\u5e93\u8fdb\u884c\u5168\u91cf\u590d\u5236\uff0c\u7ed9\u4e3b\u5e93\u8fc7\u5927\u7684\u540c\u6b65\u538b\u529b\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u91c7\u7528\u201c\u4e3b - \u4ece - \u4ece\u201d\u8fd9\u4e00\u7ea7\u8054\u6a21\u5f0f\uff0c\u6765\u7f13\u89e3\u4e3b\u5e93\u7684\u538b\u529b\u3002 \u957f\u8fde\u63a5\u590d\u5236\u662f\u4e3b\u4ece\u5e93\u6b63\u5e38\u8fd0\u884c\u540e\u7684\u5e38\u89c4\u540c\u6b65\u9636\u6bb5\u3002\u5728\u8fd9\u4e2a\u9636\u6bb5\u4e2d\uff0c\u4e3b\u4ece\u5e93\u4e4b\u95f4\u901a\u8fc7\u547d\u4ee4\u4f20\u64ad\u5b9e\u73b0\u540c\u6b65\u3002 \u671f\u95f4\u5982\u679c\u9047\u5230\u4e86\u7f51\u7edc\u65ad\u8fde\uff0c\u589e\u91cf\u590d\u5236\u5c31\u6d3e\u4e0a\u7528\u573a\u4e86\u3002 \u7559\u610f\u4e00\u4e0b repl_backlog_size \u8fd9\u4e2a\u914d\u7f6e\u53c2\u6570\u3002 \u5982\u679c\u5b83\u914d\u7f6e\u5f97\u8fc7\u5c0f\uff0c\u5728\u589e\u91cf\u590d\u5236\u9636\u6bb5\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4ece\u5e93\u7684\u590d\u5236\u8fdb\u5ea6\u8d76\u4e0d\u4e0a\u4e3b\u5e93\uff0c\u8fdb\u800c\u5bfc\u81f4\u4ece\u5e93\u91cd\u65b0\u8fdb\u884c\u5168\u91cf\u590d\u5236 \u3002 \u6240\u4ee5\uff0c\u901a\u8fc7\u8c03\u5927\u8fd9\u4e2a\u53c2\u6570\uff0c\u53ef\u4ee5\u51cf\u5c11\u4ece\u5e93\u5728\u7f51\u7edc\u65ad\u8fde\u65f6\u5168\u91cf\u590d\u5236\u7684\u98ce\u9669\u3002 \u672c\u8282\u4eae\u70b9\uff1a Redis\u91c7\u7528\u8bfb\u5199\u5206\u79bb\u7684\u597d\u5904\uff1a\u907f\u514d\u4e86\u52a0\u9501\uff0c\u5b9e\u4f8b\u95f4\u534f\u5546\u662f\u5426\u5b8c\u6210\u4fee\u6539\u7b49\u590d\u6742\u64cd\u4f5c \u5168\u91cf\u540c\u6b65\u7684\u53d1\u751f\u65f6\u673a\uff1a\u9996\u6b21\u4e0a\u7ebf \u548c \u4ece\u5e93\u7684\u73af\u5f62\u7f13\u51b2\u533a\u4f4d\u7f6e\u6807\u8bc6\u88ab\u8986\u76d6 \u589e\u91cf\u540c\u6b65\u4fdd\u969c\u673a\u5236\u4f9d\u8d56\u4e8e\u4e00\u4e2a\u7279\u6b8a\u7684\u6570\u636e\u7ed3\u6784\uff1a\u73af\u5f62\u7f13\u51b2\u533a \u9996\u6b21\u540c\u6b65\u5206\u4e3a\u4e09\u4e2a\u9636\u6bb5\uff0c\u2460\uff1a\u5efa\u7acb\u8fde\u63a5\uff0c\u2461\uff1a\u540c\u6b65RDB\u6587\u4ef6\uff0c\u2462\uff1a\u540c\u6b65\u589e\u91cf\u6570\u636e \u5168\u91cf\u540c\u6b65\u9700\u8981\u4e3b\u673afork\u5b50\u8fdb\u7a0b\uff0c\u4ea7\u751f\u5168\u91cfRDB\u6587\u4ef6\uff0c\u5e76\u53d1\u9001\uff0c\u4e3a\u4e86\u51cf\u8f7b\u4e3b\u673a\u7684\u538b\u529b\uff0c\u4ece\u673a\u4e4b\u95f4\u4e5f\u53ef\u7528\u4e92\u76f8\u540c\u6b65 \u589e\u91cf\u540c\u6b65\u53ef\u4ee5\u7f13\u89e3\u4e3b\u673a\u5168\u91cf\u540c\u6b65\u7684\u538b\u529b\uff0c\u5b83\u9700\u8981\u7279\u6b8a\u673a\u5236\u4fdd\u969c\uff1a replication buffer \uff0c\u73af\u5f62\u7f13\u51b2\u533a\uff0c master_repl_offset \uff0c slave_repl_offset \u4ece\u673a\u7684\u540c\u6b65\u4f4d\u7f6e\u6807\u8bc6\uff0c\u5728\u73af\u5f62\u7f13\u51b2\u533a\u88ab\u8986\u76d6\u540e\uff0c\u4f1a\u89e6\u53d1\u65b0\u7684\u4e00\u8f6e\u5168\u91cf\u540c\u6b65\uff0c\u6240 repl_backlog_buffer \u7684\u5927\u5c0f\u662fredis\u91cd\u8981\u7684\u8c03\u4f18\u53c2\u6570 \u4e3b\u4ece\u540c\u6b65\u6709\u4e09\u79cd\u673a\u5236\uff1a\u5168\u91cf\u540c\u6b65\uff0c\u57fa\u4e8e\u957f\u94fe\u63a5\u7684\u547d\u4ee4\u4f20\u64ad\uff0c\u589e\u91cf\u540c\u6b65 \u7b2c\u4e03\u8282 \u54e8\u5175\u673a\u5236\uff1a\u4e3b\u5e93\u4e0d\u95f4\u65ad\u670d\u52a1 \u54e8\u5175\u673a\u5236\uff0c\u5b83\u662f\u5b9e\u73b0 Redis \u4e0d\u95f4\u65ad\u670d\u52a1\u7684\u91cd\u8981\u4fdd\u8bc1\u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u4e3b\u4ece\u96c6\u7fa4\u7684\u6570\u636e\u540c\u6b65\uff0c\u662f\u6570\u636e\u53ef\u9760\u7684\u57fa\u7840\u4fdd\u8bc1\uff1b\u800c\u5728\u4e3b\u5e93\u53d1\u751f\u6545\u969c\u65f6\uff0c\u81ea\u52a8\u7684\u4e3b\u4ece\u5207\u6362\u662f\u670d\u52a1\u4e0d\u95f4\u65ad\u7684\u5173\u952e\u652f\u6491\u3002 Redis \u7684\u54e8\u5175\u673a\u5236\u81ea\u52a8\u5b8c\u6210\u4e86\u4ee5\u4e0b\u4e09\u5927\u529f\u80fd\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u4e3b\u4ece\u5e93\u7684\u81ea\u52a8\u5207\u6362\uff0c\u53ef\u4ee5\u964d\u4f4e Redis \u96c6\u7fa4\u7684\u8fd0\u7ef4\u5f00\u9500\uff1a \u76d1\u63a7\u4e3b\u5e93\u8fd0\u884c\u72b6\u6001\uff0c\u5e76\u5224\u65ad\u4e3b\u5e93\u662f\u5426\u5ba2\u89c2\u4e0b\u7ebf\uff1b \u5728\u4e3b\u5e93\u5ba2\u89c2\u4e0b\u7ebf\u540e\uff0c\u9009\u53d6\u65b0\u4e3b\u5e93\uff1b \u9009\u51fa\u65b0\u4e3b\u5e93\u540e\uff0c\u901a\u77e5\u4ece\u5e93\u548c\u5ba2\u6237\u7aef\u3002 \u4e3a\u4e86\u964d\u4f4e\u8bef\u5224\u7387\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u65f6\uff0c\u54e8\u5175\u673a\u5236\u901a\u5e38\u91c7\u7528\u591a\u5b9e\u4f8b\u7684\u65b9\u5f0f\u8fdb\u884c\u90e8\u7f72\uff0c\u591a\u4e2a\u54e8\u5175\u5b9e\u4f8b\u901a\u8fc7\u201c\u5c11\u6570\u670d\u4ece\u591a\u6570\u201d\u7684\u539f\u5219\uff0c\u6765\u5224\u65ad\u4e3b\u5e93\u662f\u5426\u5ba2\u89c2\u4e0b\u7ebf \u4eae\u70b9 \u54e8\u5175\u7684\u672c\u8d28\uff1a\u662f\u4e00\u4e2aredis\u5b9e\u4f8b\uff0c\u8981\u505a\u4e09\u4ef6\u4e8b\uff1a\u76d1\u63a7\u4e3b\u5e93\uff0c\u9009\u4e3e\u65b0\u4e3b\u5e93\uff0c\u901a\u77e5\u5ba2\u6237\u7aef\u548c\u4ece\u673a \u54e8\u5175\u662f\u901a\u8fc7\u5fc3\u8df3\u68c0\u6d4b\uff0c\u76d1\u63a7\u4e3b\u5e93\u72b6\u6001\uff0c\u4e3b\u5e93\u4e0b\u7ebf\u88ab\u5206\u4e3a\uff1a\u4e3b\u89c2\u4e0b\u7ebf\u548c\u5ba2\u89c2\u4e0b\u7ebf\u3001 \u54e8\u5175\u76d1\u63a7\u662f\u53ef\u80fd\u8bef\u5224\u7684\uff0c\u6240\u4ee5\u54e8\u5175\u4e00\u822c\u662f\u96c6\u7fa4\u90e8\u7f72\uff0c\u91c7\u53d6\u6295\u7968\u7684\u5f62\u5f0f\u51cf\u5c11\u8bef\u5224 \u9009\u5b9a\u65b0\u4e3b\u5e93\u89c4\u5219\u662f\u5148\u7b5b\u9009\u5728\u6253\u5206\uff0c\u5f97\u5206\u9ad8\u7684\u4f1a\u88ab\u9009\u4e3a\u65b0\u4e3b\u5e93 \u7b5b\u9009\u89c4\u5219\uff1a\u4ece\u5e93\u5f53\u524d\u7684\u7f51\u7edc\u8fde\u63a5\u72b6\u51b5\uff0c\u4ee5\u53ca\u4e4b\u524d\u7684\u7f51\u7edc\u8fde\u63a5\u72b6\u51b5\uff0c\u7b5b\u9009\u4e2d\u65ad\u6b21\u6570\u6807\u51c6\u53ef\u4ee5\u914d\u7f6e \u6253\u5206\u89c4\u5219\uff1a\u4ece\u5e93\u7684\u4f18\u5148\u7ea7\uff0c\u6570\u636e\u540c\u6b65\u72b6\u51b5\uff0cId\u53f7\u5927\u5c0f\uff0c\u53ef\u4ee5\u5206\u4e3a\u4e09\u8f6e\uff0c\u53ea\u8981\u6709\u4e00\u8f6e\u51fa\u73b0\u5f97\u5206\u9ad8\u7684\uff0c\u5c31\u80fd\u9009\u51fa \u5224\u65ad\u54ea\u4e2a\u4ece\u5e93\u7684\u6570\u636e\u540c\u6b65\u6700\u63a5\u8fd1\u4e3b\u5e93\uff0c\u4e0d\u662f\u62ff\u4ece\u5e93\u4e0e\u4e3b\u5e93\u6bd4\u8f83\uff0c\u800c\u662f\u4ece\u5e93\u4e4b\u95f4\u4e92\u76f8\u6bd4\u8f83\uff0c\u8c01\u5927\u8c01\u5c31\u662f\u6700\u63a5\u8fd1\u7684 \u7b2c\u516b\u8282 \u54e8\u5175\u96c6\u7fa4\uff1a\u54e8\u5175\u6302\u4e86\uff0c\u4e3b\u4ece\u5e93\u5207\u6362 \u4e3a\u4e86\u5b9e\u73b0\u4e3b\u4ece\u5207\u6362\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u54e8\u5175\uff1b \u4e3a\u4e86\u907f\u514d\u5355\u4e2a\u54e8\u5175\u6545\u969c\u540e\u65e0\u6cd5\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u4ee5\u53ca\u4e3a\u4e86\u51cf\u5c11\u8bef\u5224\u7387\uff0c\u53c8\u5f15\u5165\u4e86\u54e8\u5175\u96c6\u7fa4\uff1b \u54e8\u5175\u96c6\u7fa4\u53c8\u9700\u8981\u6709\u4e00\u4e9b\u673a\u5236\u6765\u652f\u6491\u5b83\u7684\u6b63\u5e38\u8fd0\u884c\u3002 \u8fd9\u8282\u8bfe\u4e0a\uff0c\u6211\u5c31\u5411\u4f60\u4ecb\u7ecd\u4e86\u652f\u6301\u54e8\u5175\u96c6\u7fa4\u7684\u8fd9\u4e9b\u5173\u952e\u673a\u5236\uff0c\u5305\u62ec\uff1a \u57fa\u4e8e pub/sub \u673a\u5236\u7684\u54e8\u5175\u96c6\u7fa4\u7ec4\u6210\u8fc7\u7a0b\uff1b \u57fa\u4e8e INFO \u547d\u4ee4\u7684\u4ece\u5e93\u5217\u8868\uff0c\u8fd9\u53ef\u4ee5\u5e2e\u52a9\u54e8\u5175\u548c\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5\uff1b \u57fa\u4e8e\u54e8\u5175\u81ea\u8eab\u7684 pub/sub \u529f\u80fd\uff0c\u8fd9\u5b9e\u73b0\u4e86\u5ba2\u6237\u7aef\u548c\u54e8\u5175\u4e4b\u95f4\u7684\u4e8b\u4ef6\u901a\u77e5\u3002 \u5bf9\u4e8e\u4e3b\u4ece\u5207\u6362\uff0c\u5f53\u7136\u4e0d\u662f\u54ea\u4e2a\u54e8\u5175\u60f3\u6267\u884c\u5c31\u53ef\u4ee5\u6267\u884c\u7684\uff0c\u5426\u5219\u5c31\u4e71\u5957\u4e86\u3002\u6240\u4ee5\uff0c\u8fd9\u5c31\u9700\u8981\u54e8\u5175\u96c6\u7fa4\u5728\u5224\u65ad\u4e86\u4e3b\u5e93\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u540e\uff0c\u7ecf\u8fc7\u6295\u7968\u4ef2\u88c1\uff0c\u9009\u4e3e\u4e00\u4e2a Leader \u51fa\u6765\uff0c\u7531\u5b83\u8d1f\u8d23\u5b9e\u9645\u7684\u4e3b\u4ece\u5207\u6362\uff0c\u5373\u7531\u5b83\u6765\u5b8c\u6210\u65b0\u4e3b\u5e93\u7684\u9009\u62e9\u4ee5\u53ca\u901a\u77e5\u4ece\u5e93\u4e0e\u5ba2\u6237\u7aef\u3002 \u8981\u4fdd\u8bc1\u6240\u6709\u54e8\u5175\u5b9e\u4f8b\u7684\u914d\u7f6e\u662f\u4e00\u81f4\u7684\uff0c\u5c24\u5176\u662f\u4e3b\u89c2\u4e0b\u7ebf\u7684\u5224\u65ad\u503c down-after-milliseconds\u3002 down-after-milliseconds \u662f\u6211\u4eec\u8ba4\u5b9a\u4e3b\u4ece\u5e93\u65ad\u8fde\u7684\u6700\u5927\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4 \u56e0\u4e3a\u8fd9\u4e2a\u503c\u5728\u4e0d\u540c\u7684\u54e8\u5175\u5b9e\u4f8b\u4e0a\u914d\u7f6e\u4e0d\u4e00\u81f4\uff0c\u5bfc\u81f4\u54e8\u5175\u96c6\u7fa4\u4e00\u76f4\u6ca1\u6709\u5bf9\u6709\u6545\u969c\u7684\u4e3b\u5e93\u5f62\u6210\u5171\u8bc6\uff0c\u4e5f\u5c31\u6ca1\u6709\u53ca\u65f6\u5207\u6362\u4e3b\u5e93\uff0c\u6700\u7ec8\u7684\u7ed3\u679c\u5c31\u662f\u96c6\u7fa4\u670d\u52a1\u4e0d\u7a33\u5b9a\u3002 \u54e8\u5175\u96c6\u7fa4\u7684\u5de5\u4f5c\u673a\u5236 \u54e8\u5175\u4e4b\u95f4\u4e92\u901a\u673a\u5236\uff1a\u57fa\u4e8epub/sub\u673a\u5236\uff0c\u5728\u4e3b\u5e93\u4e2d\u6709\u4e00\u4e2a \"__sentinel__:hello\" \u7684\u9891\u9053\uff0c\u54e8\u5175\u4e4b\u95f4\u4e92\u76f8\u53d1\u73b0\u901a\u4fe1 \u54e8\u5175\u4e0e\u4e3b\u4ece\u5e93\u4e92\u901a\u673a\u5236\uff1a\u54e8\u5175\u5411\u4e3b\u5e93\u53d1\u9001INFO\u6307\u4ee4\uff0c\u53ef\u4ee5\u83b7\u53d6\u6240\u6709\u4ece\u5e93\u7684\u4fe1\u606f\uff0c\u5b9e\u73b0\u5bf9\u4e3b\u5e93\uff0c\u4ece\u5e93\u7684\u76d1\u63a7 \u54e8\u5175\u5224\u5b9a\u4e3b\u5e93\u5f02\u5e38\u673a\u5236\uff1a \u54e8\u5175\u96c6\u7fa4\u4e2d\u4efb\u610f\u4e00\u4e2a\u5b9e\u4f8b\u90fd\u53ef\u4ee5\u53d1\u8d77\u4e3b\u5e93\u5f02\u5e38\u201c\u6295\u7968\u4ef2\u88c1\u201d\u6d41\u7a0b \u54e8\u5175\u4e4b\u95f4\u7684\u4e92\u52a8\u662f\u901a\u8fc7\u53d1\u5e03\u8ba2\u9605\u673a\u5236\u5b8c\u6210\u7684\uff0c\u5229\u7528\u81ea\u8eab\u7684\u7279\u6027\u6765\u5b9e\u73b0\u3002 \u54e8\u5175\u4e4b\u95f4\u901a\u4fe1\u4e0d\u662f\u54e8\u5175\u4e4b\u95f4\u4e4b\u95f4\u8054\u7cfb\uff0c\u800c\u662f\u901a\u8fc7\u8ba2\u9605\u4e3b\u5e93\u7684\u540c\u4e00\u9891\u9053\u6765\u83b7\u53d6\u5f7c\u6b64\u7684\u4fe1\u606f \u54e8\u5175\u662f\u901a\u8fc7INFO\u6307\u4ee4\uff0c\u4ece\u4e3b\u5e93\u83b7\u53d6\u4ece\u5e93\u4fe1\u606f\uff0c\u5e76\u4e0e\u6bcf\u4e2a\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5\uff0c\u76d1\u63a7\u6240\u6709\u4e3b\u4ece\u5e93\u72b6\u6001 \u54e8\u5175\u662f\u4e00\u4e2a\u7279\u6b8a\u7684redis\u5b9e\u4f8b\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u53ef\u4ee5\u8ba2\u9605\u54e8\u5175\u7684\u6307\u5b9a\u9891\u9053\u83b7\u5f97redis\u4e3b\u4ece\u5e93\u7684\u4fe1\u606f \u54e8\u5175\u96c6\u7fa4\u6267\u884c\u4e3b\u4ece\u5207\u6362\u673a\u5236\uff1a\u8c01\u53d1\u73b0\uff0c\u8c01\u5c31\u53d1\u8d77\u6295\u7968\u6d41\u7a0b\uff0c\u8c01\u83b7\u5f97\u591a\u6570\u7968\uff0c\u8c01\u5c31\u662f\u54e8\u5175Leader\uff0c\u7531Leader\u8d1f\u8d23\u4e3b\u4ece\u5e93\u5207\u6362 \u54e8\u5175\u96c6\u7fa4Leader\u9009\u4e3e\u6210\u529f\u4e0e\u5426\uff0c\u4f9d\u8d56\u4e8e\u7f51\u7edc\u901a\u4fe1\u72b6\u51b5\uff0c\u7f51\u7edc\u62e5\u585e\u4f1a\u5bfc\u81f4\u9009\u4e3e\u5931\u8d25\uff0c\u91cd\u65b0\u8fdb\u884c\u65b0\u4e00\u8f6e\u9009\u4e3e \u7b2c\u4e5d\u8282 \u5207\u7247\u96c6\u7fa4\uff1a\u6570\u636e\u589e\u591a\u4e86\uff0c\u662f\u8be5\u52a0\u5185\u5b58\u8fd8\u662f\u52a0\u5b9e\u4f8b \u5207\u7247\u96c6\u7fa4\u5728\u4fdd\u5b58\u5927\u91cf\u6570\u636e\u65b9\u9762\u7684\u4f18\u52bf\uff0c\u4ee5\u53ca\u57fa\u4e8e\u54c8\u5e0c\u69fd\u7684\u6570\u636e\u5206\u5e03\u673a\u5236\u548c\u5ba2\u6237\u7aef\u5b9a\u4f4d\u952e\u503c\u5bf9\u7684\u65b9\u6cd5\u3002 \u5728\u5e94\u5bf9\u6570\u636e\u91cf\u6269\u5bb9\u65f6\uff0c\u867d\u7136\u589e\u52a0\u5185\u5b58\u8fd9\u79cd\u7eb5\u5411\u6269\u5c55\u7684\u65b9\u6cd5\u7b80\u5355\u76f4\u63a5\uff0c\u4f46\u662f\u4f1a\u9020\u6210\u6570\u636e\u5e93\u7684\u5185\u5b58\u8fc7\u5927\uff0c\u5bfc\u81f4\u6027\u80fd\u53d8\u6162\u3002 Redis \u5207\u7247\u96c6\u7fa4\u63d0\u4f9b\u4e86\u6a2a\u5411\u6269\u5c55\u7684\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f\u4f7f\u7528\u591a\u4e2a\u5b9e\u4f8b\uff0c\u5e76\u7ed9\u6bcf\u4e2a\u5b9e\u4f8b\u914d\u7f6e\u4e00\u5b9a\u6570\u91cf\u7684\u54c8\u5e0c\u69fd\uff0c\u6570\u636e\u53ef\u4ee5\u901a\u8fc7\u952e\u7684\u54c8\u5e0c\u503c\u6620\u5c04\u5230\u54c8\u5e0c\u69fd\uff0c\u518d\u901a\u8fc7\u54c8\u5e0c\u69fd\u5206\u6563\u4fdd\u5b58\u5230\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\u3002 \u96c6\u7fa4\u7684\u5b9e\u4f8b\u589e\u51cf\uff0c\u6216\u8005\u662f\u4e3a\u4e86\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861\u800c\u8fdb\u884c\u7684\u6570\u636e\u91cd\u65b0\u5206\u5e03\uff0c\u4f1a\u5bfc\u81f4\u54c8\u5e0c\u69fd\u548c\u5b9e\u4f8b\u7684\u6620\u5c04\u5173\u7cfb\u53d1\u751f\u53d8\u5316\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u4f1a\u6536\u5230\u547d\u4ee4\u6267\u884c\u62a5\u9519\u4fe1\u606f\u3002 \u672c\u8282\u4eae\u70b9 \u8fd9\u4e00\u8bfe\u6211\u66f4\u52a0\u6e05\u6670\u7684\u660e\u767d\u4e86\u4e4b\u524d\u522b\u4eba\u804aRedis\u6269\u5bb9\u4e2d\u7684\u7eb5\u5411\u6269\u5bb9\u548c\u6a2a\u5411\u6269\u5bb9\u7684\u771f\u5b9e\u542b\u4e49\u548c\u533a\u522b \u6570\u636e\u5206\u7247\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\u5efa\u7acb\uff1a\u6309\u7167CRC16\u7b97\u6cd5\u8ba1\u7b97\u4e00\u4e2akey\u768416bit\u7684\u503c\uff0c\u5728\u5c06\u8fd9\u503c\u5bf916384\u53d6\u6a21 \u4e00\u4e2a\u5207\u7247\u96c6\u7fa4\u7684\u69fd\u4f4d\u662f\u56fa\u5b9a\u768416384\u4e2a\uff0c\u53ef\u624b\u52a8\u5206\u914d\u6bcf\u4e2a\u5b9e\u4f8b\u7684\u69fd\u4f4d\uff0c\u4f46\u5fc5\u987b\u5c06\u69fd\u4f4d\u5168\u90e8\u5206\u5b8c \u5ba2\u6237\u7aef\u5982\u4f55\u786e\u5b9a\u8981\u8bbf\u95ee\u90a3\u4e2a\u5b9e\u4f8b\u83b7\u53d6\u6570\u636e\uff1a \u4ece\u4efb\u610f\u4e2a\u5b9e\u4f8b\u83b7\u53d6\u5e76\u7f13\u5b58\u5728\u81ea\u5df1\u672c\u5730\uff0c \u91cd\u5b9a\u5411\u673a\u5236 \u91cd\u5b9a\u5411\u673a\u5236\uff1a\u5ba2\u6237\u7aef\u8bbf\u95ee\u7684\u5b9e\u4f8b\u6ca1\u6709\u6570\u636e\uff0c\u88ab\u8bbf\u95ee\u5b9e\u4f8b\u54cd\u5e94move\u547d\u4ee4\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\u6307\u5411\u65b0\u7684\u5b9e\u4f8b\u5730\u5740 ASK\u547d\u4ee4\uff1a1\uff0c\u8868\u660e\u6570\u636e\u6b63\u5728\u8fc1\u79fb 2\uff0c\u544a\u77e5\u5ba2\u6237\u7aef\u6570\u636e\u6240\u5728\u7684\u5b9e\u4f8b ASK\u547d\u4ee4\u548cMOVE\u547d\u4ee4\u7684\u533a\u522b\uff1a move\u547d\u4ee4\u662f\u5728\u6570\u636e\u8fc1\u79fb\u5b8c\u6bd5\u540e\u88ab\u54cd\u5e94\uff0c\u5ba2\u6237\u7aef\u4f1a\u66f4\u65b0\u672c\u5730\u7f13\u5b58\u3002 ASK\u547d\u4ee4\u662f\u5728\u6570\u636e\u8fc1\u79fb\u4e2d\u88ab\u54cd\u5e94\uff0c\u4e0d\u4f1a\u8ba9\u5ba2\u6237\u7aef\u66f4\u65b0\u7f13\u5b58 2\u3001\u8bfe\u540e\u601d\u8003\u9898\u7b54\u6848 2-1 \u95ee\u9898\uff1a\u548c\u8ddf Redis \u76f8\u6bd4\uff0cSimpleKV \u8fd8\u7f3a\u5c11\u4ec0\u4e48\uff1f \u6570\u636e\u7ed3\u6784\uff1a\u7f3a\u4e4f\u5e7f\u6cdb\u7684\u6570\u636e\u7ed3\u6784\u652f\u6301\uff0c\u6bd4\u5982\u652f\u6301\u8303\u56f4\u67e5\u8be2\u7684 SkipList \u548c Stream \u7b49\u6570\u636e\u7ed3\u6784\u3002 \u9ad8\u53ef\u7528\uff1a\u7f3a\u4e4f\u54e8\u5175\u6216\u8005 master-slave \u6a21\u5f0f\u7684\u9ad8\u53ef\u7528\u8bbe\u8ba1\uff1b \u6a2a\u5411\u6269\u5c55\uff1a\u7f3a\u4e4f\u96c6\u7fa4\u548c\u5206\u7247\u529f\u80fd\uff1b\u5185\u5b58\u5b89\u5168\u6027\uff1a\u7f3a\u4e4f\u5185\u5b58\u8fc7\u8f7d\u65f6\u7684 key \u6dd8\u6c70\u7b97\u6cd5\u7684\u652f\u6301\uff1b \u5185\u5b58\u5229\u7528\u7387\uff1a\u6ca1\u6709\u5145\u5206\u5bf9\u6570\u636e\u7ed3\u6784\u8fdb\u884c\u4f18\u5316\uff0c\u63d0\u9ad8\u5185\u5b58\u5229\u7528\u7387\uff0c\u4f8b\u5982\u4f7f\u7528\u538b\u7f29\u6027\u7684\u6570\u636e\u7ed3\u6784\uff1b \u529f\u80fd\u6269\u5c55\uff1a\u9700\u8981\u5177\u5907\u540e\u7eed\u529f\u80fd\u7684\u62d3\u5c55\uff1b \u4e0d\u5177\u5907\u4e8b\u52a1\u6027\uff1a\u65e0\u6cd5\u4fdd\u8bc1\u591a\u4e2a\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002 2-2 \u95ee\u9898\uff1a\u6574\u6570\u6570\u7ec4\u548c\u538b\u7f29\u5217\u8868\u4f5c\u4e3a\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u7684\u4f18\u52bf\u662f\u4ec0\u4e48\uff1f \u6574\u6570\u6570\u7ec4\u548c\u538b\u7f29\u5217\u8868\u7684\u8bbe\u8ba1\uff0c\u5145\u5206\u4f53\u73b0\u4e86 Redis\u201c\u53c8\u5feb\u53c8\u7701\u201d\u7279\u70b9\u4e2d\u7684\u201c\u7701\u201d\uff0c\u4e5f\u5c31\u662f\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u3002\u6574\u6570\u6570\u7ec4\u548c\u538b\u7f29\u5217\u8868\u90fd\u662f\u5728\u5185\u5b58\u4e2d\u5206\u914d\u4e00\u5757\u5730\u5740\u8fde\u7eed\u7684\u7a7a\u95f4\uff0c\u7136\u540e\u628a\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u4e00\u4e2a\u63a5\u4e00\u4e2a\u5730\u653e\u5728\u8fd9\u5757\u7a7a\u95f4\u5185\uff0c\u975e\u5e38\u7d27\u51d1\u3002\u56e0\u4e3a\u5143\u7d20\u662f\u6328\u4e2a\u8fde\u7eed\u653e\u7f6e\u7684\uff0c\u6211\u4eec\u4e0d\u7528\u518d\u901a\u8fc7\u989d\u5916\u7684\u6307\u9488\u628a\u5143\u7d20\u4e32\u63a5\u8d77\u6765\uff0c\u8fd9\u5c31\u907f\u514d\u4e86\u989d\u5916\u6307\u9488\u5e26\u6765\u7684\u7a7a\u95f4\u5f00\u9500\u3002 \u6574\u6570\u6570\u7ec4\u548c\u538b\u7f29\u5217\u8868\u4e2d\u7684 entry \u90fd\u662f\u5b9e\u9645\u7684\u96c6\u5408\u5143\u7d20\uff0c\u5b83\u4eec\u4e00\u4e2a\u6328\u4e00\u4e2a\u4fdd\u5b58\uff0c\u975e\u5e38\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u3002 Redis \u4e4b\u6240\u4ee5\u91c7\u7528\u4e0d\u540c\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5176\u5b9e\u662f\u5728\u6027\u80fd\u548c\u5185\u5b58\u4f7f\u7528\u6548\u7387\u4e4b\u95f4\u8fdb\u884c\u7684\u5e73\u8861\u3002 2-3 \u95ee\u9898\uff1aRedis \u57fa\u672c IO \u6a21\u578b\u4e2d\u8fd8\u6709\u54ea\u4e9b\u6f5c\u5728\u7684\u6027\u80fd\u74f6\u9888\uff1f \u5728 Redis \u57fa\u672c IO \u6a21\u578b\u4e2d\uff0c\u4e3b\u8981\u662f\u4e3b\u7ebf\u7a0b\u5728\u6267\u884c\u64cd\u4f5c\uff0c\u4efb\u4f55\u8017\u65f6\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982 bigkey\u3001\u5168\u91cf\u8fd4\u56de\u7b49\u64cd\u4f5c\uff0c\u90fd\u662f\u6f5c\u5728\u7684\u6027\u80fd\u74f6\u9888\u3002 2-4 \u95ee\u9898 1\uff1aAOF \u91cd\u5199\u8fc7\u7a0b\u4e2d\u6709\u6ca1\u6709\u5176\u4ed6\u6f5c\u5728\u7684\u963b\u585e\u98ce\u9669\uff1f \u8fd9\u91cc\u6709\u4e24\u4e2a\u98ce\u9669\u3002 \u98ce\u9669\u4e00\uff1aRedis \u4e3b\u7ebf\u7a0b fork \u521b\u5efa bgrewriteaof \u5b50\u8fdb\u7a0b\u65f6\uff0c\u5185\u6838\u9700\u8981\u521b\u5efa\u7528\u4e8e\u7ba1\u7406\u5b50\u8fdb\u7a0b\u7684\u76f8\u5173\u6570\u636e\u7ed3\u6784 \uff0c\u8fd9\u4e9b\u6570\u636e\u7ed3\u6784\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u901a\u5e38\u53eb\u4f5c\u8fdb\u7a0b\u63a7\u5236\u5757\uff08 Process Control Block \uff0c\u7b80\u79f0\u4e3a PCB\uff09\u3002\u5185\u6838\u8981\u628a\u4e3b\u7ebf\u7a0b\u7684 PCB \u5185\u5bb9\u62f7\u8d1d\u7ed9\u5b50\u8fdb\u7a0b\u3002\u8fd9\u4e2a\u521b\u5efa\u548c\u62f7\u8d1d\u8fc7\u7a0b\u7531\u5185\u6838\u6267\u884c\uff0c\u662f\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u7684\u3002\u800c\u4e14\uff0c\u5728\u62f7\u8d1d\u8fc7\u7a0b\u4e2d\uff0c\u5b50\u8fdb\u7a0b\u8981\u62f7\u8d1d\u7236\u8fdb\u7a0b\u7684\u9875\u8868\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u8017\u65f6\u548c Redis \u5b9e\u4f8b\u7684\u5185\u5b58\u5927\u5c0f\u6709\u5173\u3002\u5982\u679c Redis \u5b9e\u4f8b\u5185\u5b58\u5927\uff0c\u9875\u8868\u5c31\u4f1a\u5927\uff0cfork \u6267\u884c\u65f6\u95f4\u5c31\u4f1a\u957f\uff0c\u8fd9\u5c31\u4f1a\u7ed9\u4e3b\u7ebf\u7a0b\u5e26\u6765\u963b\u585e\u98ce\u9669\u3002 \u98ce\u9669\u4e8c\uff1a bgrewriteaof \u5b50\u8fdb\u7a0b\u4f1a\u548c\u4e3b\u7ebf\u7a0b\u5171\u4eab\u5185\u5b58 \u3002\u5f53\u4e3b\u7ebf\u7a0b\u6536\u5230\u65b0\u5199\u6216\u4fee\u6539\u7684\u64cd\u4f5c\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u7533\u8bf7\u65b0\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u7528\u6765\u4fdd\u5b58\u65b0\u5199\u6216\u4fee\u6539\u7684\u6570\u636e\uff0c\u5982\u679c\u64cd\u4f5c\u7684\u662f bigkey\uff0c\u4e5f\u5c31\u662f\u6570\u636e\u91cf\u5927\u7684\u96c6\u5408\u7c7b\u578b\u6570\u636e\uff0c\u90a3\u4e48\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u56e0\u4e3a\u7533\u8bf7\u5927\u7a7a\u95f4\u800c\u9762\u4e34\u963b\u585e\u98ce\u9669\u3002\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u5728\u5206\u914d\u5185\u5b58\u7a7a\u95f4\u65f6\uff0c\u6709\u67e5\u627e\u548c\u9501\u7684\u5f00\u9500\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u963b\u585e\u3002 2-4 \u95ee\u9898 2\uff1aAOF \u91cd\u5199\u4e3a\u4ec0\u4e48\u4e0d\u5171\u4eab\u4f7f\u7528 AOF \u672c\u8eab\u7684\u65e5\u5fd7\uff1f \u5982\u679c\u90fd\u7528 AOF \u65e5\u5fd7\u7684\u8bdd\uff0c\u4e3b\u7ebf\u7a0b\u8981\u5199\uff0c bgrewriteaof \u5b50\u8fdb\u7a0b\u4e5f\u8981\u5199\uff0c\u8fd9\u4e24\u8005\u4f1a\u7ade\u4e89\u6587\u4ef6\u7cfb\u7edf\u7684\u9501\uff0c\u8fd9\u5c31\u4f1a\u5bf9 Redis \u4e3b\u7ebf\u7a0b\u7684\u6027\u80fd\u9020\u6210\u5f71\u54cd\u3002 2-5 \u95ee\u9898\uff1a\u4f7f\u7528\u4e00\u4e2a 2 \u6838 CPU\u30014GB \u5185\u5b58\u3001500GB \u78c1\u76d8\u7684\u4e91\u4e3b\u673a\u8fd0\u884c Redis\uff0cRedis \u6570\u636e\u5e93\u7684\u6570\u636e\u91cf\u5927\u5c0f\u5dee\u4e0d\u591a\u662f 2GB\u3002\u5f53\u65f6 Redis \u4e3b\u8981\u4ee5\u4fee\u6539\u64cd\u4f5c\u4e3a\u4e3b\uff0c\u5199\u8bfb\u6bd4\u4f8b\u5dee\u4e0d\u591a\u5728 8:2 \u5de6\u53f3\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6709 100 \u4e2a\u8bf7\u6c42\uff0c80 \u4e2a\u8bf7\u6c42\u6267\u884c\u7684\u662f\u4fee\u6539\u64cd\u4f5c\u3002\u5728\u8fd9\u4e2a\u573a\u666f\u4e0b\uff0c\u7528 RDB \u505a\u6301\u4e45\u5316\u6709\u4ec0\u4e48\u98ce\u9669\u5417\uff1f \u5185\u5b58\u4e0d\u8db3\u7684\u98ce\u9669\uff1a Redis fork \u4e00\u4e2a bgsave \u5b50\u8fdb\u7a0b\u8fdb\u884c RDB \u5199\u5165\uff0c\u5982\u679c\u4e3b\u7ebf\u7a0b\u518d\u63a5\u6536\u5230\u5199\u64cd\u4f5c\uff0c\u5c31\u4f1a\u91c7\u7528\u5199\u65f6\u590d\u5236\u3002\u5199\u65f6\u590d\u5236\u9700\u8981\u7ed9\u5199\u64cd\u4f5c\u7684\u6570\u636e\u5206\u914d\u65b0\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u672c\u95ee\u9898\u4e2d\u5199\u7684\u6bd4\u4f8b\u4e3a 80%\uff0c\u90a3\u4e48\uff0c\u5728\u6301\u4e45\u5316\u8fc7\u7a0b\u4e2d\uff0c\u4e3a\u4e86\u4fdd\u5b58 80% \u5199\u64cd\u4f5c\u6d89\u53ca\u7684\u6570\u636e\uff0c\u5199\u65f6\u590d\u5236\u673a\u5236\u4f1a\u5728\u5b9e\u4f8b\u5185\u5b58\u4e2d\uff0c\u4e3a\u8fd9\u4e9b\u6570\u636e\u518d\u5206\u914d\u65b0\u5185\u5b58\u7a7a\u95f4\uff0c\u5206\u914d\u7684\u5185\u5b58\u91cf\u76f8\u5f53\u4e8e\u6574\u4e2a\u5b9e\u4f8b\u6570\u636e\u91cf\u7684 80%\uff0c\u5927\u7ea6\u662f 1.6GB\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u6574\u4e2a\u7cfb\u7edf\u5185\u5b58\u7684\u4f7f\u7528\u91cf\u5c31\u63a5\u8fd1\u9971\u548c\u4e86\u3002\u6b64\u65f6\uff0c\u5982\u679c\u5b9e\u4f8b\u8fd8\u6709\u5927\u91cf\u7684\u65b0 key \u5199\u5165\u6216 key \u4fee\u6539\uff0c\u4e91\u4e3b\u673a\u5185\u5b58\u5f88\u5feb\u5c31\u4f1a\u88ab\u5403\u5149\u3002\u5982\u679c\u4e91\u4e3b\u673a\u5f00\u542f\u4e86 Swap \u673a\u5236\uff0c\u5c31\u4f1a\u6709\u4e00\u90e8\u5206\u6570\u636e\u88ab\u6362\u5230\u78c1\u76d8\u4e0a\uff0c\u5f53\u8bbf\u95ee\u78c1\u76d8\u4e0a\u7684\u8fd9\u90e8\u5206\u6570\u636e\u65f6\uff0c\u6027\u80fd\u4f1a\u6025\u5267\u4e0b\u964d\u3002\u5982\u679c\u4e91\u4e3b\u673a\u6ca1\u6709\u5f00\u542f Swap\uff0c\u4f1a\u76f4\u63a5\u89e6\u53d1 OOM\uff0c\u6574\u4e2a Redis \u5b9e\u4f8b\u4f1a\u9762\u4e34\u88ab\u7cfb\u7edf kill \u6389\u7684\u98ce\u9669\u3002 \u4e3b\u7ebf\u7a0b\u548c\u5b50\u8fdb\u7a0b\u7ade\u4e89\u4f7f\u7528 CPU \u7684\u98ce\u9669 \uff1a\u751f\u6210 RDB \u7684\u5b50\u8fdb\u7a0b\u9700\u8981 CPU \u6838\u8fd0\u884c\uff0c\u4e3b\u7ebf\u7a0b\u672c\u8eab\u4e5f\u9700\u8981 CPU \u6838\u8fd0\u884c\uff0c\u800c\u4e14\uff0c\u5982\u679c Redis \u8fd8\u542f\u7528\u4e86\u540e\u53f0\u7ebf\u7a0b\uff0c\u6b64\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u3001\u5b50\u8fdb\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\u90fd\u4f1a\u7ade\u4e89 CPU \u8d44\u6e90\u3002\u7531\u4e8e\u4e91\u4e3b\u673a\u53ea\u6709 2 \u6838 CPU\uff0c\u8fd9\u5c31\u4f1a\u5f71\u54cd\u5230\u4e3b\u7ebf\u7a0b\u5904\u7406\u8bf7\u6c42\u7684\u901f\u5ea6\u3002 2-6 \u4e3a\u4ec0\u4e48\u4e3b\u4ece\u5e93\u95f4\u7684\u590d\u5236\u4e0d\u4f7f\u7528 AOF\uff1f \u7b54\u6848\uff1a\u6709\u4e24\u4e2a\u539f\u56e0\u3002 RDB \u6587\u4ef6\u662f\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u65e0\u8bba\u662f\u8981\u628a RDB \u5199\u5165\u78c1\u76d8\uff0c\u8fd8\u662f\u8981\u901a\u8fc7\u7f51\u7edc\u4f20\u8f93 RDB\uff0cIO \u6548\u7387\u90fd\u6bd4\u8bb0\u5f55\u548c\u4f20\u8f93 AOF \u7684\u9ad8\u3002 \u5728\u4ece\u5e93\u7aef\u8fdb\u884c\u6062\u590d\u65f6\uff0c\u7528 RDB \u7684\u6062\u590d\u6548\u7387\u8981\u9ad8\u4e8e\u7528 AOF\u3002 2-7 \uff1a\u5728\u4e3b\u4ece\u5207\u6362\u8fc7\u7a0b\u4e2d\uff0c\u5ba2\u6237\u7aef\u80fd\u5426\u6b63\u5e38\u5730\u8fdb\u884c\u8bf7\u6c42\u64cd\u4f5c\u5462\uff1f \u4e3b\u4ece\u96c6\u7fa4\u4e00\u822c\u662f\u91c7\u7528\u8bfb\u5199\u5206\u79bb\u6a21\u5f0f\uff0c\u5f53\u4e3b\u5e93\u6545\u969c\u540e\uff0c\u5ba2\u6237\u7aef\u4ecd\u7136\u53ef\u4ee5\u628a\u8bfb\u8bf7\u6c42\u53d1\u9001\u7ed9\u4ece\u5e93\uff0c\u8ba9\u4ece\u5e93\u670d\u52a1\u3002\u4f46\u662f\uff0c\u5bf9\u4e8e\u5199\u8bf7\u6c42\u64cd\u4f5c\uff0c\u5ba2\u6237\u7aef\u5c31\u65e0\u6cd5\u6267\u884c\u4e86\u3002 \u5982\u679c\u60f3\u8981\u5e94\u7528\u7a0b\u5e8f\u4e0d\u611f\u77e5\u670d\u52a1\u7684\u4e2d\u65ad\uff0c\u8fd8\u9700\u8981\u54e8\u5175\u6216\u5ba2\u6237\u7aef\u518d\u505a\u4e9b\u4ec0\u4e48\u5417\uff1f \u4e00\u65b9\u9762\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u80fd\u7f13\u5b58\u5e94\u7528\u53d1\u9001\u7684\u5199\u8bf7\u6c42\u3002\u53ea\u8981\u4e0d\u662f\u540c\u6b65\u5199\u64cd\u4f5c\uff08Redis \u5e94\u7528\u573a\u666f\u4e00\u822c\u4e5f\u6ca1\u6709\u540c\u6b65\u5199\uff09\uff0c\u5199\u8bf7\u6c42\u901a\u5e38\u4e0d\u4f1a\u5728\u5e94\u7528\u7a0b\u5e8f\u7684\u5173\u952e\u8def\u5f84\u4e0a\uff0c\u6240\u4ee5\uff0c\u5ba2\u6237\u7aef\u7f13\u5b58\u5199\u8bf7\u6c42\u540e\uff0c\u7ed9\u5e94\u7528\u7a0b\u5e8f\u8fd4\u56de\u4e00\u4e2a\u786e\u8ba4\u5c31\u884c\u3002 \u53e6\u4e00\u65b9\u9762\uff0c\u4e3b\u4ece\u5207\u6362\u5b8c\u6210\u540e\uff0c\u5ba2\u6237\u7aef\u8981\u80fd\u548c\u65b0\u4e3b\u5e93\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5\uff0c\u54e8\u5175\u9700\u8981\u63d0\u4f9b\u8ba2\u9605\u9891\u9053\uff0c\u8ba9\u5ba2\u6237\u7aef\u80fd\u591f\u8ba2\u9605\u5230\u65b0\u4e3b\u5e93\u7684\u4fe1\u606f\u3002\u540c\u65f6\uff0c\u5ba2\u6237\u7aef\u4e5f\u9700\u8981\u80fd\u4e3b\u52a8\u548c\u54e8\u5175\u901a\u4fe1\uff0c\u8be2\u95ee\u65b0\u4e3b\u5e93\u7684\u4fe1\u606f\u3002 2-8 5 \u4e2a\u54e8\u5175\u5b9e\u4f8b\u7684\u96c6\u7fa4\uff0cquorum \u503c\u8bbe\u4e3a 2\u3002\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u6709 3 \u4e2a\u54e8\u5175\u5b9e\u4f8b\u90fd\u53d1\u751f\u6545\u969c\u4e86\uff0c\u6b64\u65f6\uff0cRedis \u4e3b\u5e93\u5982\u679c\u6709\u6545\u969c\uff0c\u8fd8\u80fd\u6b63\u786e\u5730\u5224\u65ad\u4e3b\u5e93\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u5417\uff1f\u5982\u679c\u53ef\u4ee5\u7684\u8bdd\uff0c\u8fd8\u80fd\u8fdb\u884c\u4e3b\u4ece\u5e93\u81ea\u52a8\u5207\u6362\u5417\uff1f \u56e0\u4e3a\u5224\u5b9a\u4e3b\u5e93\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u7684\u4f9d\u636e\u662f\uff0c\u8ba4\u4e3a\u4e3b\u5e93\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u7684\u54e8\u5175\u4e2a\u6570\u8981\u5927\u4e8e\u7b49\u4e8e quorum \u503c\uff0c\u73b0\u5728\u8fd8\u5269 2 \u4e2a\u54e8\u5175\u5b9e\u4f8b\uff0c\u4e2a\u6570\u6b63\u597d\u7b49\u4e8e quorum \u503c\uff0c\u6240\u4ee5\u8fd8\u80fd\u6b63\u5e38\u5224\u65ad\u4e3b\u5e93\u662f\u5426\u5904\u4e8e\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u72b6\u6001\u3002\u5982\u679c\u4e00\u4e2a\u54e8\u5175\u60f3\u8981\u6267\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u5c31\u8981\u83b7\u5230\u534a\u6570\u4ee5\u4e0a\u7684\u54e8\u5175\u6295\u7968\u8d5e\u6210\uff0c\u4e5f\u5c31\u662f\u81f3\u5c11\u9700\u8981 3 \u4e2a\u54e8\u5175\u6295\u7968\u8d5e\u6210\u3002\u4f46\u662f\uff0c\u73b0\u5728\u53ea\u6709 2 \u4e2a\u54e8\u5175\u4e86\uff0c\u6240\u4ee5\u5c31\u65e0\u6cd5\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\u4e86\u3002 \u54e8\u5175\u5b9e\u4f8b\u662f\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\u5462\uff1f\u5982\u679c\u540c\u65f6\u8c03\u5927 down-after-milliseconds \u503c\uff0c\u5bf9\u51cf\u5c11\u8bef\u5224\u662f\u4e0d\u662f\u4e5f\u6709\u597d\u5904\uff1f \u54e8\u5175\u5b9e\u4f8b\u8d8a\u591a\uff0c\u8bef\u5224\u7387\u4f1a\u8d8a\u4f4e\uff0c\u4f46\u662f\u5728\u5224\u5b9a\u4e3b\u5e93\u4e0b\u7ebf\u548c\u9009\u4e3e Leader \u65f6\uff0c\u5b9e\u4f8b\u9700\u8981\u62ff\u5230\u7684\u8d5e\u6210\u7968\u6570\u4e5f\u8d8a\u591a\uff0c\u7b49\u5f85\u6240\u6709\u54e8\u5175\u6295\u5b8c\u7968\u7684\u65f6\u95f4\u53ef\u80fd\u4e5f\u4f1a\u76f8\u5e94\u589e\u52a0\uff0c\u4e3b\u4ece\u5e93\u5207\u6362\u7684\u65f6\u95f4\u4e5f\u4f1a\u53d8\u957f\uff0c\u5ba2\u6237\u7aef\u5bb9\u6613\u5806\u79ef\u8f83\u591a\u7684\u8bf7\u6c42\u64cd\u4f5c\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5ba2\u6237\u7aef\u8bf7\u6c42\u6ea2\u51fa\uff0c\u4ece\u800c\u9020\u6210\u8bf7\u6c42\u4e22\u5931\u3002\u5982\u679c\u4e1a\u52a1\u5c42\u5bf9 Redis \u7684\u64cd\u4f5c\u6709\u54cd\u5e94\u65f6\u95f4\u8981\u6c42\uff0c\u5c31\u53ef\u80fd\u4f1a\u56e0\u4e3a\u65b0\u4e3b\u5e93\u4e00\u76f4\u6ca1\u6709\u9009\u5b9a\uff0c\u65b0\u64cd\u4f5c\u65e0\u6cd5\u6267\u884c\u800c\u53d1\u751f\u8d85\u65f6\u62a5\u8b66\u3002 \u8c03\u5927 down-after-milliseconds \u540e\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8fd9\u6837\u7684\u60c5\u51b5\uff1a \u4e3b\u5e93\u5b9e\u9645\u5df2\u7ecf\u53d1\u751f\u6545\u969c\u4e86\uff0c\u4f46\u662f\u54e8\u5175\u8fc7\u4e86\u5f88\u957f\u65f6\u95f4\u624d\u5224\u65ad\u51fa\u6765\uff0c\u8fd9\u5c31\u4f1a\u5f71\u54cd\u5230 Redis \u5bf9\u4e1a\u52a1\u7684\u53ef\u7528\u6027\u3002 2-9 \u4e3a\u4ec0\u4e48 Redis \u4e0d\u76f4\u63a5\u7528\u4e00\u4e2a\u8868\uff0c\u628a\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\u8bb0\u5f55\u4e0b\u6765\uff1f \u5982\u679c\u4f7f\u7528\u8868\u8bb0\u5f55\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u4e00\u65e6\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\u53d1\u751f\u4e86\u53d8\u5316\uff08\u4f8b\u5982\u5b9e\u4f8b\u6709\u589e\u51cf\u6216\u8005\u6570\u636e\u91cd\u65b0\u5206\u5e03\uff09\uff0c\u5c31\u8981\u4fee\u6539\u8868\u3002\u5982\u679c\u662f\u5355\u7ebf\u7a0b\u64cd\u4f5c\u8868\uff0c\u90a3\u4e48\u6240\u6709\u64cd\u4f5c\u90fd\u8981\u4e32\u884c\u6267\u884c\uff0c\u6027\u80fd\u6162\uff1b\u5982\u679c\u662f\u591a\u7ebf\u7a0b\u64cd\u4f5c\u8868\uff0c\u5c31\u6d89\u53ca\u5230\u52a0\u9501\u5f00\u9500\u3002\u6b64\u5916\uff0c\u5982\u679c\u6570\u636e\u91cf\u975e\u5e38\u5927\uff0c\u4f7f\u7528\u8868\u8bb0\u5f55\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u9700\u8981\u7684\u989d\u5916\u5b58\u50a8\u7a7a\u95f4\u4e5f\u4f1a\u589e\u52a0\u3002 \u57fa\u4e8e\u54c8\u5e0c\u69fd\u8ba1\u7b97\u65f6\uff0c\u867d\u7136\u4e5f\u8981\u8bb0\u5f55\u54c8\u5e0c\u69fd\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u4f46\u662f\u54c8\u5e0c\u69fd\u7684\u4e2a\u6570\u8981\u6bd4\u952e\u503c\u5bf9\u7684\u4e2a\u6570\u5c11\u5f88\u591a\uff0c\u65e0\u8bba\u662f\u4fee\u6539\u54c8\u5e0c\u69fd\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u8fd8\u662f\u4f7f\u7528\u989d\u5916\u7a7a\u95f4\u5b58\u50a8\u54c8\u5e0c\u69fd\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u90fd\u6bd4\u76f4\u63a5\u8bb0\u5f55\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5173\u7cfb\u7684\u5f00\u9500\u5c0f\u5f97\u591a\u3002 3\u3001\u5178\u578b\u95ee\u9898\u8bb2\u89e3 3-1 rehash \u7684\u89e6\u53d1\u65f6\u673a\u548c\u6e10\u8fdb\u5f0f\u6267\u884c\u673a\u5236 1.Redis \u4ec0\u4e48\u65f6\u5019\u505a rehash\uff1f Redis \u4f1a\u4f7f\u7528\u88c5\u8f7d\u56e0\u5b50\uff08load factor\uff09\u6765\u5224\u65ad\u662f\u5426\u9700\u8981\u505a rehash\u3002\u88c5\u8f7d\u56e0\u5b50\u7684\u8ba1\u7b97\u65b9\u5f0f\u662f\uff0c\u54c8\u5e0c\u8868\u4e2d\u6240\u6709 entry \u7684\u4e2a\u6570\u9664\u4ee5\u54c8\u5e0c\u8868\u7684\u54c8\u5e0c\u6876\u4e2a\u6570\u3002Redis \u4f1a\u6839\u636e\u88c5\u8f7d\u56e0\u5b50\u7684\u4e24\u79cd\u60c5\u51b5\uff0c\u6765\u89e6\u53d1 rehash \u64cd\u4f5c\uff1a \u88c5\u8f7d\u56e0\u5b50 \u22651 \uff0c\u540c\u65f6\uff0c\u54c8\u5e0c\u8868\u88ab\u5141\u8bb8\u8fdb\u884c rehash \uff1b \u88c5\u8f7d\u56e0\u5b50 \u22655 \u3002 \u5728\u7b2c\u4e00\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u88c5\u8f7d\u56e0\u5b50\u7b49\u4e8e 1\uff0c\u540c\u65f6\u6211\u4eec\u5047\u8bbe\uff0c\u6240\u6709\u952e\u503c\u5bf9\u662f\u5e73\u5747\u5206\u5e03\u5728\u54c8\u5e0c\u8868\u7684\u5404\u4e2a\u6876\u4e2d\u7684\uff0c\u90a3\u4e48\uff0c\u6b64\u65f6\uff0c\u54c8\u5e0c\u8868\u53ef\u4ee5\u4e0d\u7528\u94fe\u5f0f\u54c8\u5e0c\uff0c\u56e0\u4e3a\u4e00\u4e2a\u54c8\u5e0c\u6876\u6b63\u597d\u4fdd\u5b58\u4e86\u4e00\u4e2a\u952e\u503c\u5bf9\u3002 \u4f46\u662f\uff0c\u5982\u679c\u6b64\u65f6\u518d\u6709\u65b0\u7684\u6570\u636e\u5199\u5165\uff0c\u54c8\u5e0c\u8868\u5c31\u8981\u4f7f\u7528\u94fe\u5f0f\u54c8\u5e0c\u4e86\uff0c\u8fd9\u4f1a\u5bf9\u67e5\u8be2\u6027\u80fd\u4ea7\u751f\u5f71\u54cd\u3002\u5728\u8fdb\u884c RDB \u751f\u6210\u548c AOF \u91cd\u5199\u65f6\uff0c\u54c8\u5e0c\u8868\u7684 rehash \u662f\u88ab\u7981\u6b62\u7684\uff0c\u8fd9\u662f\u4e3a\u4e86\u907f\u514d\u5bf9 RDB \u548c AOF \u91cd\u5199\u9020\u6210\u5f71\u54cd\u3002\u5982\u679c\u6b64\u65f6\uff0cRedis \u6ca1\u6709\u5728\u751f\u6210 RDB \u548c\u91cd\u5199 AOF\uff0c\u90a3\u4e48\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c rehash\u3002\u5426\u5219\u7684\u8bdd\uff0c\u518d\u6709\u6570\u636e\u5199\u5165\u65f6\uff0c\u54c8\u5e0c\u8868\u5c31\u8981\u5f00\u59cb\u4f7f\u7528\u67e5\u8be2\u8f83\u6162\u7684\u94fe\u5f0f\u54c8\u5e0c\u4e86\u3002 \u5728\u7b2c\u4e8c\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e5f\u5c31\u662f\u88c5\u8f7d\u56e0\u5b50\u5927\u4e8e\u7b49\u4e8e 5 \u65f6\uff0c\u5c31\u8868\u660e\u5f53\u524d\u4fdd\u5b58\u7684\u6570\u636e\u91cf\u5df2\u7ecf\u8fdc\u8fdc\u5927\u4e8e\u54c8\u5e0c\u6876\u7684\u4e2a\u6570\uff0c\u54c8\u5e0c\u6876\u91cc\u4f1a\u6709\u5927\u91cf\u7684\u94fe\u5f0f\u54c8\u5e0c\u5b58\u5728\uff0c\u6027\u80fd\u4f1a\u53d7\u5230\u4e25\u91cd\u5f71\u54cd\uff0c\u6b64\u65f6\uff0c\u5c31\u7acb\u9a6c\u5f00\u59cb\u505a rehash\u3002 \u521a\u521a\u8bf4\u7684\u662f\u89e6\u53d1 rehash \u7684\u60c5\u51b5\uff0c\u5982\u679c\u88c5\u8f7d\u56e0\u5b50\u5c0f\u4e8e 1\uff0c\u6216\u8005\u88c5\u8f7d\u56e0\u5b50\u5927\u4e8e 1 \u4f46\u662f\u5c0f\u4e8e 5\uff0c\u540c\u65f6\u54c8\u5e0c\u8868\u6682\u65f6\u4e0d\u88ab\u5141\u8bb8\u8fdb\u884c rehash\uff08\u4f8b\u5982\uff0c\u5b9e\u4f8b\u6b63\u5728\u751f\u6210 RDB \u6216\u8005\u91cd\u5199 AOF\uff09\uff0c\u6b64\u65f6\uff0c\u54c8\u5e0c\u8868\u662f\u4e0d\u4f1a\u8fdb\u884c rehash \u64cd\u4f5c\u7684\u3002 2. \u91c7\u7528\u6e10\u8fdb\u5f0f hash \u65f6\uff0c\u5982\u679c\u5b9e\u4f8b\u6682\u65f6\u6ca1\u6709\u6536\u5230\u65b0\u8bf7\u6c42\uff0c\u662f\u4e0d\u662f\u5c31\u4e0d\u505a rehash \u4e86\uff1f \u5176\u5b9e\u4e0d\u662f\u7684\u3002Redis \u4f1a\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\uff0c\u5b9a\u65f6\u4efb\u52a1\u4e2d\u5c31\u5305\u542b\u4e86 rehash \u64cd\u4f5c\u3002\u6240\u8c13\u7684\u5b9a\u65f6\u4efb\u52a1\uff0c\u5c31\u662f\u6309\u7167\u4e00\u5b9a\u9891\u7387\uff08\u4f8b\u5982\u6bcf 100ms/ \u6b21\uff09\u6267\u884c\u7684\u4efb\u52a1\u3002 \u5728 rehash \u88ab\u89e6\u53d1\u540e\uff0c\u5373\u4f7f\u6ca1\u6709\u6536\u5230\u65b0\u8bf7\u6c42\uff0cRedis \u4e5f\u4f1a\u5b9a\u65f6\u6267\u884c\u4e00\u6b21 rehash \u64cd\u4f5c\uff0c\u800c\u4e14\uff0c\u6bcf\u6b21\u6267\u884c\u65f6\u957f\u4e0d\u4f1a\u8d85\u8fc7 1ms\uff0c\u4ee5\u514d\u5bf9\u5176\u4ed6\u4efb\u52a1\u9020\u6210\u5f71\u54cd\u3002 3-2 \u4e3b\u7ebf\u7a0b\u3001\u5b50\u8fdb\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\u7684\u8054\u7cfb\u4e0e\u533a\u522b \u9996\u5148\uff0c\u6211\u6765\u89e3\u91ca\u4e00\u4e0b\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7684\u533a\u522b\u3002 \u4ece\u64cd\u4f5c\u7cfb\u7edf\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u8fdb\u7a0b\u4e00\u822c\u662f\u6307\u8d44\u6e90\u5206\u914d\u5355\u5143\uff0c\u4f8b\u5982\u4e00\u4e2a\u8fdb\u7a0b\u62e5\u6709\u81ea\u5df1\u7684\u5806\u3001\u6808\u3001\u865a\u5b58\u7a7a\u95f4\uff08\u9875\u8868\uff09\u3001\u6587\u4ef6\u63cf\u8ff0\u7b26\u7b49\uff1b \u7ebf\u7a0b\u4e00\u822c\u662f\u6307 CPU \u8fdb\u884c\u8c03\u5ea6\u548c\u6267\u884c\u7684\u5b9e\u4f53\u3002 \u5982\u679c\u4e00\u4e2a\u8fdb\u7a0b\u542f\u52a8\u540e\uff0c\u6ca1\u6709\u518d\u521b\u5efa\u989d\u5916\u7684\u7ebf\u7a0b\uff0c\u90a3\u4e48\uff0c \u8fd9\u6837\u7684\u8fdb\u7a0b\u4e00\u822c\u79f0\u4e3a\u4e3b\u8fdb\u7a0b\u6216\u4e3b\u7ebf\u7a0b \u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e0b\u9762\u662f\u6211\u5199\u7684\u4e00\u4e2a C \u7a0b\u5e8f\u7247\u6bb5\uff0cmain \u51fd\u6570\u4f1a\u76f4\u63a5\u8c03\u7528\u4e00\u4e2a worker \u51fd\u6570\uff0c\u51fd\u6570 worker \u5c31\u662f\u6267\u884c\u4e00\u4e2a for \u5faa\u73af\u8ba1\u7b97\u3002\u4e0b\u9762\u8fd9\u4e2a\u7a0b\u5e8f\u8fd0\u884c\u540e\uff0c \u5b83\u81ea\u5df1\u5c31\u662f\u4e00\u4e2a\u4e3b\u8fdb\u7a0b\uff0c\u540c\u65f6\u4e5f\u662f\u4e2a\u4e3b\u7ebf\u7a0b \u3002 int counter = 0; void *worker() { for (int i=0;i<10;i++) { counter++; } return NULL; } int main(int argc, char *argv[]) { worker(); } \u548c\u8fd9\u6bb5\u4ee3\u7801\u7c7b\u4f3c\uff0cRedis \u542f\u52a8\u4ee5\u540e\uff0c\u672c\u8eab\u5c31\u662f\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5b83\u4f1a\u63a5\u6536\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\uff0c\u5e76\u5904\u7406\u8bfb\u5199\u64cd\u4f5c\u8bf7\u6c42\u3002\u800c\u4e14\uff0c\u63a5\u6536\u8bf7\u6c42\u548c\u5904\u7406\u8bf7\u6c42\u64cd\u4f5c\u662f Redis \u7684\u4e3b\u8981\u5de5\u4f5c\uff0cRedis \u6ca1\u6709\u518d\u4f9d\u8d56\u4e8e\u5176\u4ed6\u7ebf\u7a0b\uff0c\u6240\u4ee5\uff0c\u6211\u4e00\u822c\u628a\u5b8c\u6210\u8fd9\u4e2a\u4e3b\u8981\u5de5\u4f5c\u7684 Redis \u8fdb\u7a0b\uff0c\u79f0\u4e3a\u4e3b\u8fdb\u7a0b\u6216\u4e3b\u7ebf\u7a0b\u3002 \u5728\u4e3b\u7ebf\u7a0b\u4e2d\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4f7f\u7528 fork \u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u6216\u662f\u4f7f\u7528 pthread_create \u521b\u5efa\u7ebf\u7a0b\u3002\u4e0b\u9762\u6211\u5148\u4ecb\u7ecd\u4e0b Redis \u4e2d\u7528 fork \u521b\u5efa\u7684\u5b50\u8fdb\u7a0b\u6709\u54ea\u4e9b\u3002 \u521b\u5efa RDB \u7684\u540e\u53f0\u5b50\u8fdb\u7a0b\uff0c\u540c\u65f6\u7531\u5b83\u8d1f\u8d23\u5728\u4e3b\u4ece\u540c\u6b65\u65f6\u4f20\u8f93 RDB \u7ed9\u4ece\u5e93\uff1b \u901a\u8fc7\u65e0\u76d8\u590d\u5236\u65b9\u5f0f\u4f20\u8f93 RDB \u7684\u5b50\u8fdb\u7a0b\uff1b bgrewriteaof \u5b50\u8fdb\u7a0b\u3002 \u7136\u540e\uff0c\u6211\u4eec\u518d\u770b\u4e0b Redis \u4f7f\u7528\u7684\u7ebf\u7a0b\u3002\u4ece 4.0 \u7248\u672c\u5f00\u59cb\uff0cRedis \u4e5f\u5f00\u59cb\u4f7f\u7528 pthread_create \u521b\u5efa\u7ebf\u7a0b\uff0c\u8fd9\u4e9b\u7ebf\u7a0b\u5728\u521b\u5efa\u540e\uff0c\u4e00\u822c\u4f1a\u81ea\u884c\u6267\u884c\u4e00\u4e9b\u4efb\u52a1\uff0c\u4f8b\u5982\u6267\u884c\u5f02\u6b65\u5220\u9664\u4efb\u52a1\u3002\u76f8\u5bf9\u4e8e\u5b8c\u6210\u4e3b\u8981\u5de5\u4f5c\u7684\u4e3b\u7ebf\u7a0b\u6765\u8bf4\uff0c\u6211\u4eec\u4e00\u822c\u53ef\u4ee5\u79f0\u8fd9\u4e9b\u7ebf\u7a0b\u4e3a\u540e\u53f0\u7ebf\u7a0b\u3002 3-3 \u5199\u65f6\u590d\u5236\u7684\u5e95\u5c42\u5b9e\u73b0\u673a\u5236 Redis \u5728\u4f7f\u7528 RDB \u65b9\u5f0f\u8fdb\u884c\u6301\u4e45\u5316\u65f6\uff0c\u4f1a\u7528\u5230\u5199\u65f6\u590d\u5236\u673a\u5236\u3002 bgsave \u5b50\u8fdb\u7a0b\u76f8\u5f53\u4e8e\u590d\u5236\u4e86\u539f\u59cb\u6570\u636e\uff0c\u800c\u4e3b\u7ebf\u7a0b\u4ecd\u7136\u53ef\u4ee5\u4fee\u6539\u539f\u6765\u7684\u6570\u636e\u3002 \u5bf9 Redis \u6765\u8bf4\uff0c\u4e3b\u7ebf\u7a0b fork \u51fa bgsave \u5b50\u8fdb\u7a0b\u540e\uff0cbgsave \u5b50\u8fdb\u7a0b\u5b9e\u9645\u662f\u590d\u5236\u4e86\u4e3b\u7ebf\u7a0b\u7684\u9875\u8868\u3002 \u8fd9\u4e9b\u9875\u8868\u4e2d\uff0c\u5c31\u4fdd\u5b58\u4e86\u5728\u6267\u884c bgsave \u547d\u4ee4\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u7684\u6240\u6709\u6570\u636e\u5757\u5728\u5185\u5b58\u4e2d\u7684\u7269\u7406\u5730\u5740\u3002 \u8fd9\u6837\u4e00\u6765\uff0cbgsave \u5b50\u8fdb\u7a0b\u751f\u6210 RDB \u65f6\uff0c\u5c31\u53ef\u4ee5\u6839\u636e\u9875\u8868\u8bfb\u53d6\u8fd9\u4e9b\u6570\u636e\uff0c\u518d\u5199\u5165\u78c1\u76d8\u4e2d\u3002 \u5982\u679c\u6b64\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u63a5\u6536\u5230\u4e86\u65b0\u5199\u6216\u4fee\u6539\u64cd\u4f5c\uff0c\u90a3\u4e48\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u4f7f\u7528\u5199\u65f6\u590d\u5236\u673a\u5236\u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u5199\u65f6\u590d\u5236\u5c31\u662f\u6307\uff0c\u4e3b\u7ebf\u7a0b\u5728\u6709\u5199\u64cd\u4f5c\u65f6\uff0c\u624d\u4f1a\u628a\u8fd9\u4e2a\u65b0\u5199\u6216\u4fee\u6539\u540e\u7684\u6570\u636e\u5199\u5165\u5230\u4e00\u4e2a\u65b0\u7684\u7269\u7406\u5730\u5740\u4e2d\uff0c\u5e76\u4fee\u6539\u81ea\u5df1\u7684\u9875\u8868\u6620\u5c04\u3002 bgsave \u5b50\u8fdb\u7a0b\u590d\u5236\u4e3b\u7ebf\u7a0b\u7684\u9875\u8868\u4ee5\u540e\uff0c\u5047\u5982\u4e3b\u7ebf\u7a0b\u9700\u8981\u4fee\u6539\u865a\u9875 7 \u91cc\u7684\u6570\u636e\uff0c\u90a3\u4e48\uff0c\u4e3b\u7ebf\u7a0b\u5c31\u9700\u8981\u65b0\u5206\u914d\u4e00\u4e2a\u7269\u7406\u9875\uff08\u5047\u8bbe\u662f\u7269\u7406\u9875 53\uff09\uff0c \u7136\u540e\u628a\u4fee\u6539\u540e\u7684\u865a\u9875 7 \u91cc\u7684\u6570\u636e\u5199\u5230\u7269\u7406\u9875 53 \u4e0a\uff0c\u800c\u865a\u9875 7 \u91cc\u539f\u6765\u7684\u6570\u636e\u4ecd\u7136\u4fdd\u5b58\u5728\u7269\u7406\u9875 33 \u4e0a \u8fd9\u4e2a\u65f6\u5019\uff0c\u865a\u9875 7 \u5230\u7269\u7406\u9875 33 \u7684\u6620\u5c04\u5173\u7cfb\uff0c\u4ecd\u7136\u4fdd\u7559\u5728 bgsave \u5b50\u8fdb\u7a0b\u4e2d\u3002 bgsave \u5b50\u8fdb\u7a0b\u53ef\u4ee5\u65e0\u8bef\u5730\u628a\u865a\u9875 7 \u7684\u539f\u59cb\u6570\u636e\u5199\u5165 RDB \u6587\u4ef6\u3002 3-4 replication buffer \u548c repl_backlog_buffer \u7684\u533a\u522b \u5728\u8fdb\u884c\u4e3b\u4ece\u590d\u5236\u65f6\uff0cRedis \u4f1a\u4f7f\u7528 replication buffer \u548c repl_backlog_buffer replication buffer \u662f\u4e3b\u4ece\u5e93\u5728\u8fdb\u884c\u5168\u91cf\u590d\u5236\u65f6\uff0c\u4e3b\u5e93\u4e0a\u7528\u4e8e\u548c\u4ece\u5e93\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u7684 buffer \uff0c \u800c repl_backlog_buffer \u662f\u4e3a\u4e86\u652f\u6301\u4ece\u5e93\u589e\u91cf\u590d\u5236\uff0c\u4e3b\u5e93\u4e0a\u7528\u4e8e\u6301\u7eed\u4fdd\u5b58\u5199\u64cd\u4f5c\u7684\u4e00\u5757\u4e13\u7528 buffer\u3002 Redis \u4e3b\u4ece\u5e93\u5728\u8fdb\u884c\u590d\u5236\u65f6\uff0c\u5f53\u4e3b\u5e93\u8981\u628a\u5168\u91cf\u590d\u5236\u671f\u95f4\u7684\u5199\u64cd\u4f5c\u547d\u4ee4\u53d1\u7ed9\u4ece\u5e93\u65f6\uff0c \u4e3b\u5e93\u4f1a\u5148\u521b\u5efa\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u7528\u6765\u8fde\u63a5\u4ece\u5e93\uff0c\u7136\u540e\u901a\u8fc7\u8fd9\u4e2a\u5ba2\u6237\u7aef\uff0c\u628a\u5199\u64cd\u4f5c\u547d\u4ee4\u53d1\u7ed9\u4ece\u5e93\u3002 \u5728\u5185\u5b58\u4e2d\uff0c\u4e3b\u5e93\u4e0a\u7684\u5ba2\u6237\u7aef\u5c31\u4f1a\u5bf9\u5e94\u4e00\u4e2a buffer\uff0c\u8fd9\u4e2a buffer \u5c31\u88ab\u79f0\u4e3a replication buffer\u3002 Redis \u901a\u8fc7 client_buffer \u914d\u7f6e\u9879\u6765\u63a7\u5236\u8fd9\u4e2a buffer \u7684\u5927\u5c0f\u3002 \u4e3b\u5e93\u4f1a\u7ed9\u6bcf\u4e2a\u4ece\u5e93\u5efa\u7acb\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u6240\u4ee5 replication buffer \u4e0d\u662f\u5171\u4eab\u7684\uff0c\u800c\u662f\u6bcf\u4e2a\u4ece\u5e93\u90fd\u6709\u4e00\u4e2a\u5bf9\u5e94\u7684\u5ba2\u6237\u7aef repl_backlog_buffer \u662f\u4e00\u5757\u4e13\u7528 buffer\uff0c\u5728 Redis \u670d\u52a1\u5668\u542f\u52a8\u540e\uff0c\u5f00\u59cb\u4e00\u76f4\u63a5\u6536\u5199\u64cd\u4f5c\u547d\u4ee4\uff0c\u8fd9\u662f\u6240\u6709\u4ece\u5e93\u5171\u4eab\u7684\u3002\u4e3b\u5e93\u548c\u4ece\u5e93\u4f1a\u5404\u81ea\u8bb0\u5f55\u81ea\u5df1\u7684\u590d\u5236\u8fdb\u5ea6\uff0c\u6240\u4ee5\uff0c\u4e0d\u540c\u7684\u4ece\u5e93\u5728\u8fdb\u884c\u6062\u590d\u65f6\uff0c\u4f1a\u628a\u81ea\u5df1\u7684\u590d\u5236\u8fdb\u5ea6\uff08 slave_repl_offset \uff09\u53d1\u7ed9\u4e3b\u5e93\uff0c\u4e3b\u5e93\u5c31\u53ef\u4ee5\u548c\u5b83\u72ec\u7acb\u540c\u6b65\u3002","title":"\u7b2c\u4e8c\u7ae0 Redis\u6838\u5fc3\u6280\u672f\u57fa\u7840\u603b\u7ed3\u7bc7"},{"location":"chap2/10redis_basic_sum/#redis","text":"","title":"\u7b2c\u4e8c\u7ae0 Redis\u6838\u5fc3\u6280\u672f\u57fa\u7840\u603b\u7ed3\u7bc7"},{"location":"chap2/10redis_basic_sum/#1redis","text":"","title":"1\u3001Redis \u57fa\u7840\u77e5\u8bc6\u603b\u7ed3"},{"location":"chap2/10redis_basic_sum/#_1","text":"\u4e3a\u4e86\u652f\u6301\u66f4\u52a0\u4e30\u5bcc\u7684\u4e1a\u52a1\u573a\u666f\uff0cRedis \u5bf9\u8fd9\u4e9b\u7ec4\u4ef6\u6216\u8005\u529f\u80fd\u8fdb\u884c\u4e86\u6269\u5c55\uff0c\u6216\u8005\u8bf4\u662f\u8fdb\u884c\u4e86\u7cbe\u7ec6\u4f18\u5316\uff0c\u4ece\u800c\u6ee1\u8db3\u4e86\u529f\u80fd\u548c\u6027\u80fd\u7b49\u65b9\u9762\u7684\u8981\u6c42\u3002 \u4ece\u8fd9\u5f20\u5bf9\u6bd4\u56fe\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u4ece SimpleKV \u6f14\u8fdb\u5230 Redis\uff0c\u6709\u4ee5\u4e0b\u51e0\u4e2a\u91cd\u8981\u53d8\u5316\uff1a Redis \u4e3b\u8981\u901a\u8fc7\u7f51\u7edc\u6846\u67b6\u8fdb\u884c\u8bbf\u95ee\uff0c\u800c\u4e0d\u518d\u662f\u52a8\u6001\u5e93\u4e86 \uff0c\u8fd9\u4e5f\u4f7f\u5f97 Redis \u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u57fa\u7840\u6027\u7684\u7f51\u7edc\u670d\u52a1\u8fdb\u884c\u8bbf\u95ee\uff0c\u6269\u5927\u4e86 Redis \u7684\u5e94\u7528\u8303\u56f4\u3002 Redis \u6570\u636e\u6a21\u578b\u4e2d\u7684 value \u7c7b\u578b\u5f88\u4e30\u5bcc\uff0c\u56e0\u6b64\u4e5f\u5e26\u6765\u4e86\u66f4\u591a\u7684\u64cd\u4f5c\u63a5\u53e3\uff0c\u4f8b\u5982\u9762\u5411\u5217\u8868\u7684 LPUSH/LPOP\uff0c\u9762\u5411\u96c6\u5408\u7684 SADD/SREM \u7b49\u3002 Redis \u7684\u6301\u4e45\u5316\u6a21\u5757\u80fd\u652f\u6301\u4e24\u79cd\u65b9\u5f0f\uff1a\u65e5\u5fd7\uff08AOF\uff09\u548c\u5feb\u7167\uff08RDB\uff09 \uff0c\u8fd9\u4e24\u79cd\u6301\u4e45\u5316\u65b9\u5f0f\u5177\u6709\u4e0d\u540c\u7684\u4f18\u52a3\u52bf\uff0c\u5f71\u54cd\u5230 Redis \u7684\u8bbf\u95ee\u6027\u80fd\u548c\u53ef\u9760\u6027\u3002 SimpleKV \u662f\u4e2a\u7b80\u5355\u7684\u5355\u673a\u952e\u503c\u6570\u636e\u5e93\uff0c\u4f46\u662f\uff0cRedis \u652f\u6301\u9ad8\u53ef\u9760\u96c6\u7fa4\u548c\u9ad8\u53ef\u6269\u5c55\u96c6\u7fa4\uff0c\u56e0\u6b64\uff0cRedis \u4e2d\u5305\u542b\u4e86\u76f8\u5e94\u7684\u96c6\u7fa4\u529f\u80fd\u652f\u6491\u6a21\u5757\u3002","title":"\u7b2c\u4e00\u8282 \u57fa\u672c\u67b6\u6784\uff1a \u952e\u503c\u6570\u636e\u5e93"},{"location":"chap2/10redis_basic_sum/#redis_1","text":"Redis \u4e4b\u6240\u4ee5\u80fd\u5feb\u901f\u64cd\u4f5c\u952e\u503c\u5bf9\uff0c \u4e00\u65b9\u9762\u662f\u56e0\u4e3a O(1) \u590d\u6742\u5ea6\u7684\u54c8\u5e0c\u8868\u88ab\u5e7f\u6cdb\u4f7f\u7528\uff0c\u5305\u62ec String\u3001Hash \u548c Set\uff0c\u5b83\u4eec\u7684\u64cd\u4f5c\u590d\u6742\u5ea6\u57fa\u672c\u7531\u54c8\u5e0c\u8868\u51b3\u5b9a\uff0c\u53e6\u4e00\u65b9\u9762\uff0cSorted Set \u4e5f\u91c7\u7528\u4e86 O(logN) \u590d\u6742\u5ea6\u7684\u8df3\u8868\u3002 \u4e0d\u8fc7\uff0c\u96c6\u5408\u7c7b\u578b\u7684\u8303\u56f4\u64cd\u4f5c\uff0c\u56e0\u4e3a\u8981\u904d\u5386\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff0c\u590d\u6742\u5ea6\u901a\u5e38\u662f O(N) \u3002 \u8fd9\u91cc\uff0c\u6211\u7684\u5efa\u8bae\u662f\uff1a \u7528\u5176\u4ed6\u547d\u4ee4\u6765\u66ff\u4ee3\uff0c\u4f8b\u5982\u53ef\u4ee5\u7528 SCAN \u6765\u4ee3\u66ff\uff0c\u907f\u514d\u5728 Redis \u5185\u90e8\u4ea7\u751f\u8d39\u65f6\u7684\u5168\u96c6\u5408\u904d\u5386\u64cd\u4f5c\u3002 \u5f53\u7136\uff0c\u6211\u4eec\u4e0d\u80fd\u5fd8\u4e86\u590d\u6742\u5ea6\u8f83\u9ad8\u7684 List \u7c7b\u578b\uff0c\u5b83\u7684\u4e24\u79cd\u5e95\u5c42\u5b9e\u73b0\u7ed3\u6784\uff1a\u53cc\u5411\u94fe\u8868\u548c\u538b\u7f29\u5217\u8868\u7684\u64cd\u4f5c\u590d\u6742\u5ea6\u90fd\u662f O(N)\u3002\u56e0\u6b64\uff0c\u6211\u7684\u5efa\u8bae\u662f\uff1a \u56e0\u5730\u5236\u5b9c\u5730\u4f7f\u7528 List \u7c7b\u578b \u3002\u4f8b\u5982\uff0c\u65e2\u7136\u5b83\u7684 POP/PUSH \u6548\u7387\u5f88\u9ad8\uff0c\u90a3\u4e48\u5c31\u5c06\u5b83\u4e3b\u8981\u7528\u4e8e FIFO \u961f\u5217\u573a\u666f\uff0c\u800c\u4e0d\u662f\u4f5c\u4e3a\u4e00\u4e2a\u53ef\u4ee5\u968f\u673a\u8bfb\u5199\u7684\u96c6\u5408\u3002 \u8bb2\u4e86\u4ec0\u4e48\uff1f Redis\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784 Redis\u7684\u6570\u636e\u7ed3\u6784\uff1a\u6570\u636e\u7684\u4fdd\u5b58\u5f62\u5f0f\u4e0e\u5e95\u5c42\u6570\u636e\u7ed3\u6784 \u7531\u6570\u636e\u7ed3\u6784\u7684\u5f02\u540c\u70b9\uff0c\u5f15\u51fa\u6570\u636e\u64cd\u4f5c\u7684\u5feb\u6162\u539f\u56e0 \u8981\u70b9\u77e5\u8bc6 string\uff0clist\uff0cset\uff0chast, sortset\u90fd\u53ea\u662f\u6570\u636e\u7684\u4fdd\u5b58\u5f62\u5f0f \u5e95\u5c42\u7684\u6570\u636e\u7ed3\u6784\u662f\uff1a\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\uff0c\u53cc\u5411\u94fe\u8868\uff0c\u538b\u7f29\u5217\u8868\uff0c\u54c8\u5e0c\u8868\uff0c\u8df3\u8868\uff0c\u6574\u6570\u6570\u7ec4 Redis\u4f7f\u7528\u4e86\u4e00\u4e2a\u54c8\u5e0c\u8868\u4fdd\u5b58\u6240\u6709\u7684\u952e\u503c\u5bf9 \u4e94\u79cd\u6570\u636e\u5f62\u5f0f\u7684\u5e95\u5c42\u5b9e\u73b0 string\uff1a\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32 list\uff1a\u53cc\u5411\u94fe\u8868\uff0c\u538b\u7f29\u5217\u8868 hash\uff1a\u538b\u7f29\u5217\u8868\uff0c\u54c8\u5e0c\u8868 Sorted Set\uff1a\u538b\u7f29\u5217\u8868\uff0c\u8df3\u8868 set\uff1a\u54c8\u5e0c\u8868\uff0c\u6574\u6570\u6570\u7ec4 List ,hash\uff0cset ,sorted set \u88ab\u7edf\u79f0\u4e3a\u96c6\u5408\u7c7b\u578b\uff0c\u4e00\u4e2a\u952e\u5bf9\u5e94\u4e86\u4e00\u4e2a\u96c6\u5408\u7684\u6570\u636e \u96c6\u5408\u7c7b\u578b\u7684\u952e\u548c\u503c\u4e4b\u95f4\u7684\u7ed3\u6784\u7ec4\u7ec7 redis\u4f7f\u7528\u4e00\u4e2a\u54c8\u5e0c\u8868\u4fdd\u5b58\u6240\u6709\u952e\u503c\u5bf9\uff0c\u4e00\u4e2a\u54c8\u5e0c\u8868\u5b9e\u5219\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u7684\u6bcf\u4e2a\u5143\u7d20\u79f0\u4e3a\u54c8\u5e0c\u6876\u3002 \u54c8\u5e0c\u6876\u4e2d\u7684\u5143\u7d20\u4fdd\u5b58\u7684\u4e0d\u662f\u503c\u7684\u672c\u8eab\uff0c\u800c\u662f\u6307\u5411\u5177\u4f53\u503c\u7684\u6307\u9488 \u54c8\u5e0c\u51b2\u7a81\u89e3\u51b3 Redis\u7684hash\u8868\u662f\u5168\u5c40\u7684\uff0c\u6240\u4ee5\u5f53\u5199\u5165\u5927\u91cf\u7684key\u65f6\uff0c\u5c06\u4f1a\u5e26\u6765\u54c8\u5e0c\u51b2\u7a81\uff0c\u5df2\u7ecfrehash\u53ef\u80fd\u5e26\u6765\u7684\u64cd\u4f5c\u963b\u585e Redis\u89e3\u51b3hash\u51b2\u7a81\u7684\u65b9\u5f0f\uff0c\u662f\u94fe\u5f0f\u54c8\u5e0c\uff1a\u540c\u4e00\u4e2a\u54c8\u5e0c\u6876\u4e2d\u7684\u591a\u4e2a\u5143\u7d20\u7528\u4e00\u4e2a\u94fe\u8868\u6765\u4fdd\u5b58 \u5f53\u54c8\u5e0c\u51b2\u7a81\u94fe\u8fc7\u957f\u65f6\uff0cRedis\u4f1a\u5bf9hash\u8868\u8fdb\u884crehash\u64cd\u4f5c\u3002rehash\u5c31\u662f\u589e\u52a0\u73b0\u6709\u7684hash\u6876\u6570\u91cf\uff0c\u5206\u6563entry\u5143\u7d20\u3002 rehash\u673a\u5236 \u4e86\u4f7frehash\u64cd\u4f5c\u66f4\u9ad8\u6548\uff0cRedis\u9ed8\u8ba4\u4f7f\u7528\u4e86\u4e24\u4e2a\u5168\u5c40\u54c8\u5e0c\u8868\uff1a\u54c8\u5e0c\u88681\u548c\u54c8\u5e0c\u88682\uff0c\u8d77\u59cb\u65f6hash2\u6ca1\u6709\u5206\u914d\u7a7a\u95f4 \u968f\u7740\u6570\u636e\u589e\u591a\uff0cRedis\u6267\u884c\u5206\u4e09\u6b65\u6267\u884crehash; \u7ed9hash2\u5206\u914d\u66f4\u5927\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5982\u662fhash1\u7684\u4e24\u500d \u628ahash1\u4e2d\u7684\u6570\u636e\u91cd\u65b0\u6620\u5c04\u5e76\u62f7\u8d1d\u5230\u54c8\u5e0c\u88682\u4e2d \u91ca\u653ehash1\u7684\u7a7a\u95f4 \u6e10\u8fdb\u5f0frehash \u7531\u4e8e\u6b65\u9aa42\u91cd\u65b0\u6620\u5c04\u975e\u5e38\u8017\u65f6\uff0c\u4f1a\u963b\u585eredis \u8bb2\u96c6\u4e2d\u8fc1\u79fb\u6570\u636e\uff0c\u6539\u6210\u6bcf\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\u65f6\uff0c\u5c31\u4ecehash1\u4e2d\u7684\u7b2c\u4e00\u4e2a\u7d22\u5f15\u4f4d\u7f6e\uff0c\u987a\u5e26\u5c06\u8fd9\u4e2a\u7d22\u5f15\u4f4d\u7f6e\u4e0a\u7684\u6240\u6709entries\u62f7\u8d1d\u5230hash2\u4e2d\u3002 \u538b\u7f29\u5217\u8868\uff0c\u8df3\u8868\u7684\u7279\u70b9 \u538b\u7f29\u5217\u8868\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u6570\u7ec4\uff0c\u4e0d\u540c\u7684\u662f:\u538b\u7f29\u5217\u8868\u5728\u8868\u5934\u6709\u4e09\u4e2a\u5b57\u6bb5zlbytes,zltail\u548czllen\u5206\u522b\u8868\u793a\u957f\u5ea6\uff0c\u5217\u8868\u5c3e\u7684\u504f\u79fb\u91cf\u548c\u5217\u8868\u4e2d\u7684entry\u7684\u4e2a\u6570\uff0c\u538b\u7f29\u5217\u8868\u5c3e\u90e8\u8fd8\u6709\u4e00\u4e2azlend\uff0c\u8868\u793a\u5217\u8868\u7ed3\u675f\u6240\u4ee5\u538b\u7f29\u5217\u8868\u5b9a\u4f4d\u7b2c\u4e00\u4e2a\u548c\u6700\u540e\u4e00\u4e2a\u662fO(1),\u4f46\u5176\u4ed6\u5c31\u662fO(n) \u8df3\u8868\uff1a\u662f\u5728\u94fe\u8868\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u591a\u7ea7\u7d22\u5f15\uff0c\u901a\u8fc7\u7d22\u5f15\u7684\u51e0\u6b21\u8df3\u8f6c\uff0c\u5b9e\u73b0\u6570\u636e\u5feb\u901f\u5b9a\u4f4d","title":"\u7b2c\u4e8c\u8282 \u6570\u636e\u7ed3\u6784\uff1aRedis\u4e3a\u4ec0\u4e48\u90a3\u4e48\u5feb\uff1f"},{"location":"chap2/10redis_basic_sum/#ioredis","text":"Redis \u5355\u7ebf\u7a0b\u662f\u6307\u5b83\u5bf9\u7f51\u7edc IO \u548c\u6570\u636e\u8bfb\u5199\u7684\u64cd\u4f5c\u91c7\u7528\u4e86\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u800c\u91c7\u7528\u5355\u7ebf\u7a0b\u7684\u4e00\u4e2a\u6838\u5fc3\u539f\u56e0\u662f\u907f\u514d\u591a\u7ebf\u7a0b\u5f00\u53d1\u7684\u5e76\u53d1\u63a7\u5236\u95ee\u9898\u3002 \u5355\u7ebf\u7a0b\u7684 Redis \u4e5f\u80fd\u83b7\u5f97\u9ad8\u6027\u80fd\uff0c\u8ddf\u591a\u8def\u590d\u7528\u7684 IO \u6a21\u578b\u5bc6\u5207\u76f8\u5173\uff0c\u56e0\u4e3a\u8fd9\u907f\u514d\u4e86 accept() \u548c send()/recv() \u6f5c\u5728\u7684\u7f51\u7edc IO \u64cd\u4f5c\u963b\u585e\u70b9\u3002 \u672c\u7ae0\u9996\u5148\u4ece\u7b80\u5355\u7684\u7f51\u7edc\u901a\u4fe1socket\u8bb2\u8d77\uff0c\u5f15\u51fa\u4e86\u975e\u963b\u585esocket\uff0c\u7531\u6b64\u8c08\u5230\u4e86\u8457\u540d\u7684I/O\u591a\u8def\u590d\u7528\uff0cLinux\u5185\u6838\u7684select/epoll\u673a\u5236 \u672c\u7ae0\u7684\u5173\u952e\u5728\u4e8e\u5173\u952e\u70b9\u5728\u4e8eaccpet\u548crecv\u65f6\u53ef\u80fd\u4f1a\u963b\u585e\u7ebf\u7a0b\uff0c\u4f7f\u7528IO\u591a\u8def\u590d\u7528\u6280\u672f\u53ef\u4ee5\u8ba9\u7ebf\u7a0b\u5148\u5904\u7406\u5176\u4ed6\u4e8b\u60c5\uff0c\u7b49\u9700\u8981\u7684\u8d44\u6e90\u5230\u4f4d\u540eepoll\u4f1a\u8c03\u7528\u56de\u8c03\u51fd\u6570\u901a\u77e5\u7ebf\u7a0b\uff0c\u7136\u540e\u7ebf\u7a0b\u518d\u53bb\u5904\u7406\u5b58/\u53d6\u6570\u636e\uff1b\u8fd9\u6837\u4e00\u4e2aredis\u670d\u52a1\u7aef\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u540c\u65f6\u5904\u7406\u591a\u4e2a\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e86\u3002","title":"\u7b2c\u4e09\u8282 \u9ad8\u6027\u80fdIO\u6a21\u578b\uff1aRedis\u4e3a\u4ec0\u4e48\u90a3\u4e48\u5feb\uff1f"},{"location":"chap2/10redis_basic_sum/#redisaofappend-only-file","text":"Redis \u7528\u4e8e\u907f\u514d\u6570\u636e\u4e22\u5931\u7684 AOF \u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u901a\u8fc7\u9010\u4e00\u8bb0\u5f55\u64cd\u4f5c\u547d\u4ee4\uff0c\u5728\u6062\u590d\u65f6\u518d\u9010\u4e00\u6267\u884c\u547d\u4ee4\u7684\u65b9\u5f0f\uff0c\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u53ef\u9760\u6027 \u603b\u7ed3\u6765\u8bf4\uff0c\u5b83\u63d0\u4f9b\u4e86 AOF \u65e5\u5fd7\u7684\u4e09\u79cd\u5199\u56de\u7b56\u7565\uff0c\u5206\u522b\u662f Always\u3001Everysec \u548c No\uff0c\u8fd9\u4e09\u79cd\u7b56\u7565\u5728\u53ef\u9760\u6027\u4e0a\u662f\u4ece\u9ad8\u5230\u4f4e\uff0c\u800c\u5728\u6027\u80fd\u4e0a\u5219\u662f\u4ece\u4f4e\u5230\u9ad8\u3002 \u6b64\u5916\uff0c\u4e3a\u4e86\u907f\u514d\u65e5\u5fd7\u6587\u4ef6\u8fc7\u5927\uff0cRedis \u8fd8\u63d0\u4f9b\u4e86 AOF \u91cd\u5199\u673a\u5236\uff0c\u76f4\u63a5\u6839\u636e\u6570\u636e\u5e93\u91cc\u6570\u636e\u7684\u6700\u65b0\u72b6\u6001\uff0c\u751f\u6210\u8fd9\u4e9b\u6570\u636e\u7684\u63d2\u5165\u547d\u4ee4\uff0c\u4f5c\u4e3a\u65b0\u65e5\u5fd7\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u901a\u8fc7\u540e\u53f0\u7ebf\u7a0b\u5b8c\u6210\uff0c\u907f\u514d\u4e86\u5bf9\u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\u3002 AOF \u65e5\u5fd7\u91cd\u5199\u7684\u65f6\u5019\uff0c\u662f\u7531 bgrewriteaof \u5b50\u8fdb\u7a0b\u6765\u5b8c\u6210\u7684\uff0c\u4e0d\u7528\u4e3b\u7ebf\u7a0b\u53c2\u4e0e\uff0c\u6211\u4eec\u4eca\u5929\u8bf4\u7684\u975e\u963b\u585e\u4e5f\u662f\u6307\u5b50\u8fdb\u7a0b\u7684\u6267\u884c\u4e0d\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002\u4f46\u662f\uff0c\u4f60\u89c9\u5f97\uff0c\u8fd9\u4e2a\u91cd\u5199\u8fc7\u7a0b\u6709\u6ca1\u6709\u5176\u4ed6\u6f5c\u5728\u7684\u963b\u585e\u98ce\u9669\u5462\uff1f\u5982\u679c\u6709\u7684\u8bdd\uff0c\u4f1a\u5728\u54ea\u91cc\u963b\u585e\uff1f \u6f5c\u5728\u7684\u963b\u585e\u98ce\u9669\u5305\u62ec\uff1afork\u5b50\u8fdb\u7a0b \u548c AOF\u91cd\u5199\u8fc7\u7a0b\u4e2d\u7236\u8fdb\u7a0b\u4ea7\u751f\u5199\u5165","title":"\u7b2c\u56db\u8282 Redis\u5b95\u673a\uff0c\u5982\u4f55\u907f\u514d\u6570\u636e\u4e22\u5931\uff1aAOF(Append Only File)\u65e5\u5fd7"},{"location":"chap2/10redis_basic_sum/#redisredisrdb","text":"\u6211\u4eec\u5b66\u4e60\u4e86 Redis \u7528\u4e8e\u907f\u514d\u6570\u636e\u4e22\u5931\u7684\u5185\u5b58\u5feb\u7167\u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u7684\u4f18\u52bf\u5728\u4e8e\uff0c\u53ef\u4ee5\u5feb\u901f\u6062\u590d\u6570\u636e\u5e93\uff0c\u4e5f\u5c31\u662f\u53ea\u9700\u8981\u628a RDB \u6587\u4ef6\u76f4\u63a5\u8bfb\u5165\u5185\u5b58\uff0c\u8fd9\u5c31\u907f\u514d\u4e86 AOF \u9700\u8981\u987a\u5e8f\u3001\u9010\u4e00\u91cd\u65b0\u6267\u884c\u64cd\u4f5c\u547d\u4ee4\u5e26\u6765\u7684\u4f4e\u6548\u6027\u80fd\u95ee\u9898\u3002 Redis \u8bbe\u8ba1\u4e86 bgsave \u548c\u5199\u65f6\u590d\u5236\u65b9\u5f0f\uff0c\u5c3d\u53ef\u80fd\u51cf\u5c11\u4e86\u5185\u5b58\u5feb\u7167\u5bf9\u6b63\u5e38\u8bfb\u5199\u7684\u5f71\u54cd\uff0c\u4f46\u662f\uff0c\u9891\u7e41\u5feb\u7167\u4ecd\u7136\u662f\u4e0d\u592a\u80fd\u63a5\u53d7\u7684\u3002\u800c\u6df7\u5408\u4f7f\u7528 RDB \u548c AOF\uff0c\u4ee5\u8f83\u5c0f\u7684\u6027\u80fd\u5f00\u9500\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\u548c\u6027\u80fd\u3002 \u5173\u4e8e AOF \u548c RDB \u7684\u9009\u62e9\u95ee\u9898 \u4e09\u70b9\u5efa\u8bae\uff1a \u6570\u636e\u4e0d\u80fd\u4e22\u5931\u65f6\uff0c\u5185\u5b58\u5feb\u7167\u548c AOF \u7684\u6df7\u5408\u4f7f\u7528\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\uff1b \u5982\u679c\u5141\u8bb8\u5206\u949f\u7ea7\u522b\u7684\u6570\u636e\u4e22\u5931\uff0c\u53ef\u4ee5\u53ea\u4f7f\u7528 RDB\uff1b \u5982\u679c\u53ea\u7528 AOF\uff0c\u4f18\u5148\u4f7f\u7528 everysec \u7684\u914d\u7f6e\u9009\u9879\uff0c\u56e0\u4e3a\u5b83\u5728\u53ef\u9760\u6027\u548c\u6027\u80fd\u4e4b\u95f4\u53d6\u4e86\u4e00\u4e2a\u5e73\u8861\u3002 \u5230\u5e95\u662f\u4e3b\u8fdb\u7a0b\u8fd8\u662f\u4e3b\u7ebf\u7a0b Redis\u542f\u52a8\u540e\u672c\u8eab\u662f\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5b83\u7684\u4e3b\u4f53\u5de5\u4f5c\uff08\u63a5\u6536\u8bf7\u6c42\u3001\u670d\u52a1\u8bf7\u6c42\u8bfb\u5199\u6570\u636e\uff09\u4e5f\u662f\u5728\u8fd9\u4e2a\u8fdb\u7a0b\u4e2d\u5b8c\u6210\u7684\uff0c\u79f0Redis\u4e3a\u4e3b\u8fdb\u7a0b\u662f\u53ef\u4ee5\u7684 \u3002 \u540c\u65f6\uff0c Redis\u8fd9\u4e2a\u8fdb\u7a0b\u5c5e\u4e8e\u5355\u7ebf\u7a0b\u7684\u8fdb\u7a0b\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fdb\u7a0b\u4e3b\u4f53\u5de5\u4f5c\u6ca1\u6709\u7528\u591a\u4e2a\u7ebf\u7a0b\u6765\u8fd0\u884c\uff0c\u6240\u4ee5\u6211\u4e00\u822c\u628a\u5b83\u4e5f\u79f0\u4e3a\u4e3b\u7ebf\u7a0b\uff0c\u7a81\u663e\u5b83\u7684\u5355\u7ebf\u7a0b\u6a21\u5f0f \u3002 \u6709\u7684\u7a0b\u5e8f\u542f\u52a8\u540e\uff0c\u4f1a\u5728\u8fdb\u7a0b\u4e2d\u542f\u52a8\u591a\u4e2a\u7ebf\u7a0b\u6765\u5904\u7406\u5de5\u4f5c\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u5c31\u4e0d\u4f1a\u79f0\u5b83\u4e3a\u4e3b\u7ebf\u7a0b\u4e86\uff0c\u56e0\u4e3a\u6ca1\u6709\u4e00\u4e2a\u7ebf\u7a0b\u662f\u5355\u72ec\u505a\u4e3b\u8981\u5de5\u4f5c\u7684","title":"\u7b2c\u4e94\u8282 Redis\u5b95\u673a\uff0cRedis\u5982\u4f55\u5b9e\u73b0\u5feb\u901f\u6062\u590dRDB"},{"location":"chap2/10redis_basic_sum/#_2","text":"Redis \u7684\u4e3b\u4ece\u5e93\u540c\u6b65\u7684\u57fa\u672c\u539f\u7406\uff0c\u603b\u7ed3\u6765\u8bf4\uff0c\u6709\u4e09\u79cd\u6a21\u5f0f\uff1a \u5168\u91cf\u590d\u5236\u3001\u57fa\u4e8e\u957f\u8fde\u63a5\u7684\u547d\u4ee4\u4f20\u64ad\uff0c\u4ee5\u53ca\u589e\u91cf\u590d\u5236 \u5168\u91cf\u590d\u5236\u867d\u7136\u8017\u65f6\uff0c\u4f46\u662f\u5bf9\u4e8e\u4ece\u5e93\u6765\u8bf4\uff0c\u5982\u679c\u662f\u7b2c\u4e00\u6b21\u540c\u6b65\uff0c\u5168\u91cf\u590d\u5236\u662f\u65e0\u6cd5\u907f\u514d\u7684 \u4e00\u4e2a Redis \u5b9e\u4f8b\u7684\u6570\u636e\u5e93\u4e0d\u8981\u592a\u5927\uff0c\u4e00\u4e2a\u5b9e\u4f8b\u5927\u5c0f\u5728\u51e0 GB \u7ea7\u522b\u6bd4\u8f83\u5408\u9002\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11 RDB \u6587\u4ef6\u751f\u6210\u3001\u4f20\u8f93\u548c\u91cd\u65b0\u52a0\u8f7d\u7684\u5f00\u9500 \u4e3a\u4e86\u907f\u514d\u591a\u4e2a\u4ece\u5e93\u540c\u65f6\u548c\u4e3b\u5e93\u8fdb\u884c\u5168\u91cf\u590d\u5236\uff0c\u7ed9\u4e3b\u5e93\u8fc7\u5927\u7684\u540c\u6b65\u538b\u529b\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u91c7\u7528\u201c\u4e3b - \u4ece - \u4ece\u201d\u8fd9\u4e00\u7ea7\u8054\u6a21\u5f0f\uff0c\u6765\u7f13\u89e3\u4e3b\u5e93\u7684\u538b\u529b\u3002 \u957f\u8fde\u63a5\u590d\u5236\u662f\u4e3b\u4ece\u5e93\u6b63\u5e38\u8fd0\u884c\u540e\u7684\u5e38\u89c4\u540c\u6b65\u9636\u6bb5\u3002\u5728\u8fd9\u4e2a\u9636\u6bb5\u4e2d\uff0c\u4e3b\u4ece\u5e93\u4e4b\u95f4\u901a\u8fc7\u547d\u4ee4\u4f20\u64ad\u5b9e\u73b0\u540c\u6b65\u3002 \u671f\u95f4\u5982\u679c\u9047\u5230\u4e86\u7f51\u7edc\u65ad\u8fde\uff0c\u589e\u91cf\u590d\u5236\u5c31\u6d3e\u4e0a\u7528\u573a\u4e86\u3002 \u7559\u610f\u4e00\u4e0b repl_backlog_size \u8fd9\u4e2a\u914d\u7f6e\u53c2\u6570\u3002 \u5982\u679c\u5b83\u914d\u7f6e\u5f97\u8fc7\u5c0f\uff0c\u5728\u589e\u91cf\u590d\u5236\u9636\u6bb5\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4ece\u5e93\u7684\u590d\u5236\u8fdb\u5ea6\u8d76\u4e0d\u4e0a\u4e3b\u5e93\uff0c\u8fdb\u800c\u5bfc\u81f4\u4ece\u5e93\u91cd\u65b0\u8fdb\u884c\u5168\u91cf\u590d\u5236 \u3002 \u6240\u4ee5\uff0c\u901a\u8fc7\u8c03\u5927\u8fd9\u4e2a\u53c2\u6570\uff0c\u53ef\u4ee5\u51cf\u5c11\u4ece\u5e93\u5728\u7f51\u7edc\u65ad\u8fde\u65f6\u5168\u91cf\u590d\u5236\u7684\u98ce\u9669\u3002 \u672c\u8282\u4eae\u70b9\uff1a Redis\u91c7\u7528\u8bfb\u5199\u5206\u79bb\u7684\u597d\u5904\uff1a\u907f\u514d\u4e86\u52a0\u9501\uff0c\u5b9e\u4f8b\u95f4\u534f\u5546\u662f\u5426\u5b8c\u6210\u4fee\u6539\u7b49\u590d\u6742\u64cd\u4f5c \u5168\u91cf\u540c\u6b65\u7684\u53d1\u751f\u65f6\u673a\uff1a\u9996\u6b21\u4e0a\u7ebf \u548c \u4ece\u5e93\u7684\u73af\u5f62\u7f13\u51b2\u533a\u4f4d\u7f6e\u6807\u8bc6\u88ab\u8986\u76d6 \u589e\u91cf\u540c\u6b65\u4fdd\u969c\u673a\u5236\u4f9d\u8d56\u4e8e\u4e00\u4e2a\u7279\u6b8a\u7684\u6570\u636e\u7ed3\u6784\uff1a\u73af\u5f62\u7f13\u51b2\u533a \u9996\u6b21\u540c\u6b65\u5206\u4e3a\u4e09\u4e2a\u9636\u6bb5\uff0c\u2460\uff1a\u5efa\u7acb\u8fde\u63a5\uff0c\u2461\uff1a\u540c\u6b65RDB\u6587\u4ef6\uff0c\u2462\uff1a\u540c\u6b65\u589e\u91cf\u6570\u636e \u5168\u91cf\u540c\u6b65\u9700\u8981\u4e3b\u673afork\u5b50\u8fdb\u7a0b\uff0c\u4ea7\u751f\u5168\u91cfRDB\u6587\u4ef6\uff0c\u5e76\u53d1\u9001\uff0c\u4e3a\u4e86\u51cf\u8f7b\u4e3b\u673a\u7684\u538b\u529b\uff0c\u4ece\u673a\u4e4b\u95f4\u4e5f\u53ef\u7528\u4e92\u76f8\u540c\u6b65 \u589e\u91cf\u540c\u6b65\u53ef\u4ee5\u7f13\u89e3\u4e3b\u673a\u5168\u91cf\u540c\u6b65\u7684\u538b\u529b\uff0c\u5b83\u9700\u8981\u7279\u6b8a\u673a\u5236\u4fdd\u969c\uff1a replication buffer \uff0c\u73af\u5f62\u7f13\u51b2\u533a\uff0c master_repl_offset \uff0c slave_repl_offset \u4ece\u673a\u7684\u540c\u6b65\u4f4d\u7f6e\u6807\u8bc6\uff0c\u5728\u73af\u5f62\u7f13\u51b2\u533a\u88ab\u8986\u76d6\u540e\uff0c\u4f1a\u89e6\u53d1\u65b0\u7684\u4e00\u8f6e\u5168\u91cf\u540c\u6b65\uff0c\u6240 repl_backlog_buffer \u7684\u5927\u5c0f\u662fredis\u91cd\u8981\u7684\u8c03\u4f18\u53c2\u6570 \u4e3b\u4ece\u540c\u6b65\u6709\u4e09\u79cd\u673a\u5236\uff1a\u5168\u91cf\u540c\u6b65\uff0c\u57fa\u4e8e\u957f\u94fe\u63a5\u7684\u547d\u4ee4\u4f20\u64ad\uff0c\u589e\u91cf\u540c\u6b65","title":"\u7b2c\u516d\u8282 \u6570\u636e\u540c\u6b65\uff1a\u4e3b\u4ece\u5e93\u6570\u636e\u4e00\u81f4"},{"location":"chap2/10redis_basic_sum/#_3","text":"\u54e8\u5175\u673a\u5236\uff0c\u5b83\u662f\u5b9e\u73b0 Redis \u4e0d\u95f4\u65ad\u670d\u52a1\u7684\u91cd\u8981\u4fdd\u8bc1\u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u4e3b\u4ece\u96c6\u7fa4\u7684\u6570\u636e\u540c\u6b65\uff0c\u662f\u6570\u636e\u53ef\u9760\u7684\u57fa\u7840\u4fdd\u8bc1\uff1b\u800c\u5728\u4e3b\u5e93\u53d1\u751f\u6545\u969c\u65f6\uff0c\u81ea\u52a8\u7684\u4e3b\u4ece\u5207\u6362\u662f\u670d\u52a1\u4e0d\u95f4\u65ad\u7684\u5173\u952e\u652f\u6491\u3002 Redis \u7684\u54e8\u5175\u673a\u5236\u81ea\u52a8\u5b8c\u6210\u4e86\u4ee5\u4e0b\u4e09\u5927\u529f\u80fd\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u4e3b\u4ece\u5e93\u7684\u81ea\u52a8\u5207\u6362\uff0c\u53ef\u4ee5\u964d\u4f4e Redis \u96c6\u7fa4\u7684\u8fd0\u7ef4\u5f00\u9500\uff1a \u76d1\u63a7\u4e3b\u5e93\u8fd0\u884c\u72b6\u6001\uff0c\u5e76\u5224\u65ad\u4e3b\u5e93\u662f\u5426\u5ba2\u89c2\u4e0b\u7ebf\uff1b \u5728\u4e3b\u5e93\u5ba2\u89c2\u4e0b\u7ebf\u540e\uff0c\u9009\u53d6\u65b0\u4e3b\u5e93\uff1b \u9009\u51fa\u65b0\u4e3b\u5e93\u540e\uff0c\u901a\u77e5\u4ece\u5e93\u548c\u5ba2\u6237\u7aef\u3002 \u4e3a\u4e86\u964d\u4f4e\u8bef\u5224\u7387\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u65f6\uff0c\u54e8\u5175\u673a\u5236\u901a\u5e38\u91c7\u7528\u591a\u5b9e\u4f8b\u7684\u65b9\u5f0f\u8fdb\u884c\u90e8\u7f72\uff0c\u591a\u4e2a\u54e8\u5175\u5b9e\u4f8b\u901a\u8fc7\u201c\u5c11\u6570\u670d\u4ece\u591a\u6570\u201d\u7684\u539f\u5219\uff0c\u6765\u5224\u65ad\u4e3b\u5e93\u662f\u5426\u5ba2\u89c2\u4e0b\u7ebf \u4eae\u70b9 \u54e8\u5175\u7684\u672c\u8d28\uff1a\u662f\u4e00\u4e2aredis\u5b9e\u4f8b\uff0c\u8981\u505a\u4e09\u4ef6\u4e8b\uff1a\u76d1\u63a7\u4e3b\u5e93\uff0c\u9009\u4e3e\u65b0\u4e3b\u5e93\uff0c\u901a\u77e5\u5ba2\u6237\u7aef\u548c\u4ece\u673a \u54e8\u5175\u662f\u901a\u8fc7\u5fc3\u8df3\u68c0\u6d4b\uff0c\u76d1\u63a7\u4e3b\u5e93\u72b6\u6001\uff0c\u4e3b\u5e93\u4e0b\u7ebf\u88ab\u5206\u4e3a\uff1a\u4e3b\u89c2\u4e0b\u7ebf\u548c\u5ba2\u89c2\u4e0b\u7ebf\u3001 \u54e8\u5175\u76d1\u63a7\u662f\u53ef\u80fd\u8bef\u5224\u7684\uff0c\u6240\u4ee5\u54e8\u5175\u4e00\u822c\u662f\u96c6\u7fa4\u90e8\u7f72\uff0c\u91c7\u53d6\u6295\u7968\u7684\u5f62\u5f0f\u51cf\u5c11\u8bef\u5224 \u9009\u5b9a\u65b0\u4e3b\u5e93\u89c4\u5219\u662f\u5148\u7b5b\u9009\u5728\u6253\u5206\uff0c\u5f97\u5206\u9ad8\u7684\u4f1a\u88ab\u9009\u4e3a\u65b0\u4e3b\u5e93 \u7b5b\u9009\u89c4\u5219\uff1a\u4ece\u5e93\u5f53\u524d\u7684\u7f51\u7edc\u8fde\u63a5\u72b6\u51b5\uff0c\u4ee5\u53ca\u4e4b\u524d\u7684\u7f51\u7edc\u8fde\u63a5\u72b6\u51b5\uff0c\u7b5b\u9009\u4e2d\u65ad\u6b21\u6570\u6807\u51c6\u53ef\u4ee5\u914d\u7f6e \u6253\u5206\u89c4\u5219\uff1a\u4ece\u5e93\u7684\u4f18\u5148\u7ea7\uff0c\u6570\u636e\u540c\u6b65\u72b6\u51b5\uff0cId\u53f7\u5927\u5c0f\uff0c\u53ef\u4ee5\u5206\u4e3a\u4e09\u8f6e\uff0c\u53ea\u8981\u6709\u4e00\u8f6e\u51fa\u73b0\u5f97\u5206\u9ad8\u7684\uff0c\u5c31\u80fd\u9009\u51fa \u5224\u65ad\u54ea\u4e2a\u4ece\u5e93\u7684\u6570\u636e\u540c\u6b65\u6700\u63a5\u8fd1\u4e3b\u5e93\uff0c\u4e0d\u662f\u62ff\u4ece\u5e93\u4e0e\u4e3b\u5e93\u6bd4\u8f83\uff0c\u800c\u662f\u4ece\u5e93\u4e4b\u95f4\u4e92\u76f8\u6bd4\u8f83\uff0c\u8c01\u5927\u8c01\u5c31\u662f\u6700\u63a5\u8fd1\u7684","title":"\u7b2c\u4e03\u8282   \u54e8\u5175\u673a\u5236\uff1a\u4e3b\u5e93\u4e0d\u95f4\u65ad\u670d\u52a1"},{"location":"chap2/10redis_basic_sum/#_4","text":"\u4e3a\u4e86\u5b9e\u73b0\u4e3b\u4ece\u5207\u6362\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u54e8\u5175\uff1b \u4e3a\u4e86\u907f\u514d\u5355\u4e2a\u54e8\u5175\u6545\u969c\u540e\u65e0\u6cd5\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u4ee5\u53ca\u4e3a\u4e86\u51cf\u5c11\u8bef\u5224\u7387\uff0c\u53c8\u5f15\u5165\u4e86\u54e8\u5175\u96c6\u7fa4\uff1b \u54e8\u5175\u96c6\u7fa4\u53c8\u9700\u8981\u6709\u4e00\u4e9b\u673a\u5236\u6765\u652f\u6491\u5b83\u7684\u6b63\u5e38\u8fd0\u884c\u3002 \u8fd9\u8282\u8bfe\u4e0a\uff0c\u6211\u5c31\u5411\u4f60\u4ecb\u7ecd\u4e86\u652f\u6301\u54e8\u5175\u96c6\u7fa4\u7684\u8fd9\u4e9b\u5173\u952e\u673a\u5236\uff0c\u5305\u62ec\uff1a \u57fa\u4e8e pub/sub \u673a\u5236\u7684\u54e8\u5175\u96c6\u7fa4\u7ec4\u6210\u8fc7\u7a0b\uff1b \u57fa\u4e8e INFO \u547d\u4ee4\u7684\u4ece\u5e93\u5217\u8868\uff0c\u8fd9\u53ef\u4ee5\u5e2e\u52a9\u54e8\u5175\u548c\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5\uff1b \u57fa\u4e8e\u54e8\u5175\u81ea\u8eab\u7684 pub/sub \u529f\u80fd\uff0c\u8fd9\u5b9e\u73b0\u4e86\u5ba2\u6237\u7aef\u548c\u54e8\u5175\u4e4b\u95f4\u7684\u4e8b\u4ef6\u901a\u77e5\u3002 \u5bf9\u4e8e\u4e3b\u4ece\u5207\u6362\uff0c\u5f53\u7136\u4e0d\u662f\u54ea\u4e2a\u54e8\u5175\u60f3\u6267\u884c\u5c31\u53ef\u4ee5\u6267\u884c\u7684\uff0c\u5426\u5219\u5c31\u4e71\u5957\u4e86\u3002\u6240\u4ee5\uff0c\u8fd9\u5c31\u9700\u8981\u54e8\u5175\u96c6\u7fa4\u5728\u5224\u65ad\u4e86\u4e3b\u5e93\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u540e\uff0c\u7ecf\u8fc7\u6295\u7968\u4ef2\u88c1\uff0c\u9009\u4e3e\u4e00\u4e2a Leader \u51fa\u6765\uff0c\u7531\u5b83\u8d1f\u8d23\u5b9e\u9645\u7684\u4e3b\u4ece\u5207\u6362\uff0c\u5373\u7531\u5b83\u6765\u5b8c\u6210\u65b0\u4e3b\u5e93\u7684\u9009\u62e9\u4ee5\u53ca\u901a\u77e5\u4ece\u5e93\u4e0e\u5ba2\u6237\u7aef\u3002 \u8981\u4fdd\u8bc1\u6240\u6709\u54e8\u5175\u5b9e\u4f8b\u7684\u914d\u7f6e\u662f\u4e00\u81f4\u7684\uff0c\u5c24\u5176\u662f\u4e3b\u89c2\u4e0b\u7ebf\u7684\u5224\u65ad\u503c down-after-milliseconds\u3002 down-after-milliseconds \u662f\u6211\u4eec\u8ba4\u5b9a\u4e3b\u4ece\u5e93\u65ad\u8fde\u7684\u6700\u5927\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4 \u56e0\u4e3a\u8fd9\u4e2a\u503c\u5728\u4e0d\u540c\u7684\u54e8\u5175\u5b9e\u4f8b\u4e0a\u914d\u7f6e\u4e0d\u4e00\u81f4\uff0c\u5bfc\u81f4\u54e8\u5175\u96c6\u7fa4\u4e00\u76f4\u6ca1\u6709\u5bf9\u6709\u6545\u969c\u7684\u4e3b\u5e93\u5f62\u6210\u5171\u8bc6\uff0c\u4e5f\u5c31\u6ca1\u6709\u53ca\u65f6\u5207\u6362\u4e3b\u5e93\uff0c\u6700\u7ec8\u7684\u7ed3\u679c\u5c31\u662f\u96c6\u7fa4\u670d\u52a1\u4e0d\u7a33\u5b9a\u3002 \u54e8\u5175\u96c6\u7fa4\u7684\u5de5\u4f5c\u673a\u5236 \u54e8\u5175\u4e4b\u95f4\u4e92\u901a\u673a\u5236\uff1a\u57fa\u4e8epub/sub\u673a\u5236\uff0c\u5728\u4e3b\u5e93\u4e2d\u6709\u4e00\u4e2a \"__sentinel__:hello\" \u7684\u9891\u9053\uff0c\u54e8\u5175\u4e4b\u95f4\u4e92\u76f8\u53d1\u73b0\u901a\u4fe1 \u54e8\u5175\u4e0e\u4e3b\u4ece\u5e93\u4e92\u901a\u673a\u5236\uff1a\u54e8\u5175\u5411\u4e3b\u5e93\u53d1\u9001INFO\u6307\u4ee4\uff0c\u53ef\u4ee5\u83b7\u53d6\u6240\u6709\u4ece\u5e93\u7684\u4fe1\u606f\uff0c\u5b9e\u73b0\u5bf9\u4e3b\u5e93\uff0c\u4ece\u5e93\u7684\u76d1\u63a7 \u54e8\u5175\u5224\u5b9a\u4e3b\u5e93\u5f02\u5e38\u673a\u5236\uff1a \u54e8\u5175\u96c6\u7fa4\u4e2d\u4efb\u610f\u4e00\u4e2a\u5b9e\u4f8b\u90fd\u53ef\u4ee5\u53d1\u8d77\u4e3b\u5e93\u5f02\u5e38\u201c\u6295\u7968\u4ef2\u88c1\u201d\u6d41\u7a0b \u54e8\u5175\u4e4b\u95f4\u7684\u4e92\u52a8\u662f\u901a\u8fc7\u53d1\u5e03\u8ba2\u9605\u673a\u5236\u5b8c\u6210\u7684\uff0c\u5229\u7528\u81ea\u8eab\u7684\u7279\u6027\u6765\u5b9e\u73b0\u3002 \u54e8\u5175\u4e4b\u95f4\u901a\u4fe1\u4e0d\u662f\u54e8\u5175\u4e4b\u95f4\u4e4b\u95f4\u8054\u7cfb\uff0c\u800c\u662f\u901a\u8fc7\u8ba2\u9605\u4e3b\u5e93\u7684\u540c\u4e00\u9891\u9053\u6765\u83b7\u53d6\u5f7c\u6b64\u7684\u4fe1\u606f \u54e8\u5175\u662f\u901a\u8fc7INFO\u6307\u4ee4\uff0c\u4ece\u4e3b\u5e93\u83b7\u53d6\u4ece\u5e93\u4fe1\u606f\uff0c\u5e76\u4e0e\u6bcf\u4e2a\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5\uff0c\u76d1\u63a7\u6240\u6709\u4e3b\u4ece\u5e93\u72b6\u6001 \u54e8\u5175\u662f\u4e00\u4e2a\u7279\u6b8a\u7684redis\u5b9e\u4f8b\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u53ef\u4ee5\u8ba2\u9605\u54e8\u5175\u7684\u6307\u5b9a\u9891\u9053\u83b7\u5f97redis\u4e3b\u4ece\u5e93\u7684\u4fe1\u606f \u54e8\u5175\u96c6\u7fa4\u6267\u884c\u4e3b\u4ece\u5207\u6362\u673a\u5236\uff1a\u8c01\u53d1\u73b0\uff0c\u8c01\u5c31\u53d1\u8d77\u6295\u7968\u6d41\u7a0b\uff0c\u8c01\u83b7\u5f97\u591a\u6570\u7968\uff0c\u8c01\u5c31\u662f\u54e8\u5175Leader\uff0c\u7531Leader\u8d1f\u8d23\u4e3b\u4ece\u5e93\u5207\u6362 \u54e8\u5175\u96c6\u7fa4Leader\u9009\u4e3e\u6210\u529f\u4e0e\u5426\uff0c\u4f9d\u8d56\u4e8e\u7f51\u7edc\u901a\u4fe1\u72b6\u51b5\uff0c\u7f51\u7edc\u62e5\u585e\u4f1a\u5bfc\u81f4\u9009\u4e3e\u5931\u8d25\uff0c\u91cd\u65b0\u8fdb\u884c\u65b0\u4e00\u8f6e\u9009\u4e3e","title":"\u7b2c\u516b\u8282   \u54e8\u5175\u96c6\u7fa4\uff1a\u54e8\u5175\u6302\u4e86\uff0c\u4e3b\u4ece\u5e93\u5207\u6362"},{"location":"chap2/10redis_basic_sum/#_5","text":"\u5207\u7247\u96c6\u7fa4\u5728\u4fdd\u5b58\u5927\u91cf\u6570\u636e\u65b9\u9762\u7684\u4f18\u52bf\uff0c\u4ee5\u53ca\u57fa\u4e8e\u54c8\u5e0c\u69fd\u7684\u6570\u636e\u5206\u5e03\u673a\u5236\u548c\u5ba2\u6237\u7aef\u5b9a\u4f4d\u952e\u503c\u5bf9\u7684\u65b9\u6cd5\u3002 \u5728\u5e94\u5bf9\u6570\u636e\u91cf\u6269\u5bb9\u65f6\uff0c\u867d\u7136\u589e\u52a0\u5185\u5b58\u8fd9\u79cd\u7eb5\u5411\u6269\u5c55\u7684\u65b9\u6cd5\u7b80\u5355\u76f4\u63a5\uff0c\u4f46\u662f\u4f1a\u9020\u6210\u6570\u636e\u5e93\u7684\u5185\u5b58\u8fc7\u5927\uff0c\u5bfc\u81f4\u6027\u80fd\u53d8\u6162\u3002 Redis \u5207\u7247\u96c6\u7fa4\u63d0\u4f9b\u4e86\u6a2a\u5411\u6269\u5c55\u7684\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f\u4f7f\u7528\u591a\u4e2a\u5b9e\u4f8b\uff0c\u5e76\u7ed9\u6bcf\u4e2a\u5b9e\u4f8b\u914d\u7f6e\u4e00\u5b9a\u6570\u91cf\u7684\u54c8\u5e0c\u69fd\uff0c\u6570\u636e\u53ef\u4ee5\u901a\u8fc7\u952e\u7684\u54c8\u5e0c\u503c\u6620\u5c04\u5230\u54c8\u5e0c\u69fd\uff0c\u518d\u901a\u8fc7\u54c8\u5e0c\u69fd\u5206\u6563\u4fdd\u5b58\u5230\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\u3002 \u96c6\u7fa4\u7684\u5b9e\u4f8b\u589e\u51cf\uff0c\u6216\u8005\u662f\u4e3a\u4e86\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861\u800c\u8fdb\u884c\u7684\u6570\u636e\u91cd\u65b0\u5206\u5e03\uff0c\u4f1a\u5bfc\u81f4\u54c8\u5e0c\u69fd\u548c\u5b9e\u4f8b\u7684\u6620\u5c04\u5173\u7cfb\u53d1\u751f\u53d8\u5316\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u4f1a\u6536\u5230\u547d\u4ee4\u6267\u884c\u62a5\u9519\u4fe1\u606f\u3002 \u672c\u8282\u4eae\u70b9 \u8fd9\u4e00\u8bfe\u6211\u66f4\u52a0\u6e05\u6670\u7684\u660e\u767d\u4e86\u4e4b\u524d\u522b\u4eba\u804aRedis\u6269\u5bb9\u4e2d\u7684\u7eb5\u5411\u6269\u5bb9\u548c\u6a2a\u5411\u6269\u5bb9\u7684\u771f\u5b9e\u542b\u4e49\u548c\u533a\u522b \u6570\u636e\u5206\u7247\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\u5efa\u7acb\uff1a\u6309\u7167CRC16\u7b97\u6cd5\u8ba1\u7b97\u4e00\u4e2akey\u768416bit\u7684\u503c\uff0c\u5728\u5c06\u8fd9\u503c\u5bf916384\u53d6\u6a21 \u4e00\u4e2a\u5207\u7247\u96c6\u7fa4\u7684\u69fd\u4f4d\u662f\u56fa\u5b9a\u768416384\u4e2a\uff0c\u53ef\u624b\u52a8\u5206\u914d\u6bcf\u4e2a\u5b9e\u4f8b\u7684\u69fd\u4f4d\uff0c\u4f46\u5fc5\u987b\u5c06\u69fd\u4f4d\u5168\u90e8\u5206\u5b8c \u5ba2\u6237\u7aef\u5982\u4f55\u786e\u5b9a\u8981\u8bbf\u95ee\u90a3\u4e2a\u5b9e\u4f8b\u83b7\u53d6\u6570\u636e\uff1a \u4ece\u4efb\u610f\u4e2a\u5b9e\u4f8b\u83b7\u53d6\u5e76\u7f13\u5b58\u5728\u81ea\u5df1\u672c\u5730\uff0c \u91cd\u5b9a\u5411\u673a\u5236 \u91cd\u5b9a\u5411\u673a\u5236\uff1a\u5ba2\u6237\u7aef\u8bbf\u95ee\u7684\u5b9e\u4f8b\u6ca1\u6709\u6570\u636e\uff0c\u88ab\u8bbf\u95ee\u5b9e\u4f8b\u54cd\u5e94move\u547d\u4ee4\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\u6307\u5411\u65b0\u7684\u5b9e\u4f8b\u5730\u5740 ASK\u547d\u4ee4\uff1a1\uff0c\u8868\u660e\u6570\u636e\u6b63\u5728\u8fc1\u79fb 2\uff0c\u544a\u77e5\u5ba2\u6237\u7aef\u6570\u636e\u6240\u5728\u7684\u5b9e\u4f8b ASK\u547d\u4ee4\u548cMOVE\u547d\u4ee4\u7684\u533a\u522b\uff1a move\u547d\u4ee4\u662f\u5728\u6570\u636e\u8fc1\u79fb\u5b8c\u6bd5\u540e\u88ab\u54cd\u5e94\uff0c\u5ba2\u6237\u7aef\u4f1a\u66f4\u65b0\u672c\u5730\u7f13\u5b58\u3002 ASK\u547d\u4ee4\u662f\u5728\u6570\u636e\u8fc1\u79fb\u4e2d\u88ab\u54cd\u5e94\uff0c\u4e0d\u4f1a\u8ba9\u5ba2\u6237\u7aef\u66f4\u65b0\u7f13\u5b58","title":"\u7b2c\u4e5d\u8282 \u5207\u7247\u96c6\u7fa4\uff1a\u6570\u636e\u589e\u591a\u4e86\uff0c\u662f\u8be5\u52a0\u5185\u5b58\u8fd8\u662f\u52a0\u5b9e\u4f8b"},{"location":"chap2/10redis_basic_sum/#2","text":"","title":"2\u3001\u8bfe\u540e\u601d\u8003\u9898\u7b54\u6848"},{"location":"chap2/10redis_basic_sum/#2-1-redis-simplekv","text":"\u6570\u636e\u7ed3\u6784\uff1a\u7f3a\u4e4f\u5e7f\u6cdb\u7684\u6570\u636e\u7ed3\u6784\u652f\u6301\uff0c\u6bd4\u5982\u652f\u6301\u8303\u56f4\u67e5\u8be2\u7684 SkipList \u548c Stream \u7b49\u6570\u636e\u7ed3\u6784\u3002 \u9ad8\u53ef\u7528\uff1a\u7f3a\u4e4f\u54e8\u5175\u6216\u8005 master-slave \u6a21\u5f0f\u7684\u9ad8\u53ef\u7528\u8bbe\u8ba1\uff1b \u6a2a\u5411\u6269\u5c55\uff1a\u7f3a\u4e4f\u96c6\u7fa4\u548c\u5206\u7247\u529f\u80fd\uff1b\u5185\u5b58\u5b89\u5168\u6027\uff1a\u7f3a\u4e4f\u5185\u5b58\u8fc7\u8f7d\u65f6\u7684 key \u6dd8\u6c70\u7b97\u6cd5\u7684\u652f\u6301\uff1b \u5185\u5b58\u5229\u7528\u7387\uff1a\u6ca1\u6709\u5145\u5206\u5bf9\u6570\u636e\u7ed3\u6784\u8fdb\u884c\u4f18\u5316\uff0c\u63d0\u9ad8\u5185\u5b58\u5229\u7528\u7387\uff0c\u4f8b\u5982\u4f7f\u7528\u538b\u7f29\u6027\u7684\u6570\u636e\u7ed3\u6784\uff1b \u529f\u80fd\u6269\u5c55\uff1a\u9700\u8981\u5177\u5907\u540e\u7eed\u529f\u80fd\u7684\u62d3\u5c55\uff1b \u4e0d\u5177\u5907\u4e8b\u52a1\u6027\uff1a\u65e0\u6cd5\u4fdd\u8bc1\u591a\u4e2a\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002","title":"2-1 \u95ee\u9898\uff1a\u548c\u8ddf Redis \u76f8\u6bd4\uff0cSimpleKV \u8fd8\u7f3a\u5c11\u4ec0\u4e48\uff1f"},{"location":"chap2/10redis_basic_sum/#2-2","text":"\u6574\u6570\u6570\u7ec4\u548c\u538b\u7f29\u5217\u8868\u7684\u8bbe\u8ba1\uff0c\u5145\u5206\u4f53\u73b0\u4e86 Redis\u201c\u53c8\u5feb\u53c8\u7701\u201d\u7279\u70b9\u4e2d\u7684\u201c\u7701\u201d\uff0c\u4e5f\u5c31\u662f\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u3002\u6574\u6570\u6570\u7ec4\u548c\u538b\u7f29\u5217\u8868\u90fd\u662f\u5728\u5185\u5b58\u4e2d\u5206\u914d\u4e00\u5757\u5730\u5740\u8fde\u7eed\u7684\u7a7a\u95f4\uff0c\u7136\u540e\u628a\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u4e00\u4e2a\u63a5\u4e00\u4e2a\u5730\u653e\u5728\u8fd9\u5757\u7a7a\u95f4\u5185\uff0c\u975e\u5e38\u7d27\u51d1\u3002\u56e0\u4e3a\u5143\u7d20\u662f\u6328\u4e2a\u8fde\u7eed\u653e\u7f6e\u7684\uff0c\u6211\u4eec\u4e0d\u7528\u518d\u901a\u8fc7\u989d\u5916\u7684\u6307\u9488\u628a\u5143\u7d20\u4e32\u63a5\u8d77\u6765\uff0c\u8fd9\u5c31\u907f\u514d\u4e86\u989d\u5916\u6307\u9488\u5e26\u6765\u7684\u7a7a\u95f4\u5f00\u9500\u3002 \u6574\u6570\u6570\u7ec4\u548c\u538b\u7f29\u5217\u8868\u4e2d\u7684 entry \u90fd\u662f\u5b9e\u9645\u7684\u96c6\u5408\u5143\u7d20\uff0c\u5b83\u4eec\u4e00\u4e2a\u6328\u4e00\u4e2a\u4fdd\u5b58\uff0c\u975e\u5e38\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u3002 Redis \u4e4b\u6240\u4ee5\u91c7\u7528\u4e0d\u540c\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5176\u5b9e\u662f\u5728\u6027\u80fd\u548c\u5185\u5b58\u4f7f\u7528\u6548\u7387\u4e4b\u95f4\u8fdb\u884c\u7684\u5e73\u8861\u3002","title":"2-2 \u95ee\u9898\uff1a\u6574\u6570\u6570\u7ec4\u548c\u538b\u7f29\u5217\u8868\u4f5c\u4e3a\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u7684\u4f18\u52bf\u662f\u4ec0\u4e48\uff1f"},{"location":"chap2/10redis_basic_sum/#2-3-redis-io","text":"\u5728 Redis \u57fa\u672c IO \u6a21\u578b\u4e2d\uff0c\u4e3b\u8981\u662f\u4e3b\u7ebf\u7a0b\u5728\u6267\u884c\u64cd\u4f5c\uff0c\u4efb\u4f55\u8017\u65f6\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982 bigkey\u3001\u5168\u91cf\u8fd4\u56de\u7b49\u64cd\u4f5c\uff0c\u90fd\u662f\u6f5c\u5728\u7684\u6027\u80fd\u74f6\u9888\u3002","title":"2-3 \u95ee\u9898\uff1aRedis \u57fa\u672c IO \u6a21\u578b\u4e2d\u8fd8\u6709\u54ea\u4e9b\u6f5c\u5728\u7684\u6027\u80fd\u74f6\u9888\uff1f"},{"location":"chap2/10redis_basic_sum/#2-4-1aof","text":"\u8fd9\u91cc\u6709\u4e24\u4e2a\u98ce\u9669\u3002 \u98ce\u9669\u4e00\uff1aRedis \u4e3b\u7ebf\u7a0b fork \u521b\u5efa bgrewriteaof \u5b50\u8fdb\u7a0b\u65f6\uff0c\u5185\u6838\u9700\u8981\u521b\u5efa\u7528\u4e8e\u7ba1\u7406\u5b50\u8fdb\u7a0b\u7684\u76f8\u5173\u6570\u636e\u7ed3\u6784 \uff0c\u8fd9\u4e9b\u6570\u636e\u7ed3\u6784\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u901a\u5e38\u53eb\u4f5c\u8fdb\u7a0b\u63a7\u5236\u5757\uff08 Process Control Block \uff0c\u7b80\u79f0\u4e3a PCB\uff09\u3002\u5185\u6838\u8981\u628a\u4e3b\u7ebf\u7a0b\u7684 PCB \u5185\u5bb9\u62f7\u8d1d\u7ed9\u5b50\u8fdb\u7a0b\u3002\u8fd9\u4e2a\u521b\u5efa\u548c\u62f7\u8d1d\u8fc7\u7a0b\u7531\u5185\u6838\u6267\u884c\uff0c\u662f\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u7684\u3002\u800c\u4e14\uff0c\u5728\u62f7\u8d1d\u8fc7\u7a0b\u4e2d\uff0c\u5b50\u8fdb\u7a0b\u8981\u62f7\u8d1d\u7236\u8fdb\u7a0b\u7684\u9875\u8868\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u8017\u65f6\u548c Redis \u5b9e\u4f8b\u7684\u5185\u5b58\u5927\u5c0f\u6709\u5173\u3002\u5982\u679c Redis \u5b9e\u4f8b\u5185\u5b58\u5927\uff0c\u9875\u8868\u5c31\u4f1a\u5927\uff0cfork \u6267\u884c\u65f6\u95f4\u5c31\u4f1a\u957f\uff0c\u8fd9\u5c31\u4f1a\u7ed9\u4e3b\u7ebf\u7a0b\u5e26\u6765\u963b\u585e\u98ce\u9669\u3002 \u98ce\u9669\u4e8c\uff1a bgrewriteaof \u5b50\u8fdb\u7a0b\u4f1a\u548c\u4e3b\u7ebf\u7a0b\u5171\u4eab\u5185\u5b58 \u3002\u5f53\u4e3b\u7ebf\u7a0b\u6536\u5230\u65b0\u5199\u6216\u4fee\u6539\u7684\u64cd\u4f5c\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u7533\u8bf7\u65b0\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u7528\u6765\u4fdd\u5b58\u65b0\u5199\u6216\u4fee\u6539\u7684\u6570\u636e\uff0c\u5982\u679c\u64cd\u4f5c\u7684\u662f bigkey\uff0c\u4e5f\u5c31\u662f\u6570\u636e\u91cf\u5927\u7684\u96c6\u5408\u7c7b\u578b\u6570\u636e\uff0c\u90a3\u4e48\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u56e0\u4e3a\u7533\u8bf7\u5927\u7a7a\u95f4\u800c\u9762\u4e34\u963b\u585e\u98ce\u9669\u3002\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u5728\u5206\u914d\u5185\u5b58\u7a7a\u95f4\u65f6\uff0c\u6709\u67e5\u627e\u548c\u9501\u7684\u5f00\u9500\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u963b\u585e\u3002","title":"2-4 \u95ee\u9898 1\uff1aAOF \u91cd\u5199\u8fc7\u7a0b\u4e2d\u6709\u6ca1\u6709\u5176\u4ed6\u6f5c\u5728\u7684\u963b\u585e\u98ce\u9669\uff1f"},{"location":"chap2/10redis_basic_sum/#2-4-2aof-aof","text":"\u5982\u679c\u90fd\u7528 AOF \u65e5\u5fd7\u7684\u8bdd\uff0c\u4e3b\u7ebf\u7a0b\u8981\u5199\uff0c bgrewriteaof \u5b50\u8fdb\u7a0b\u4e5f\u8981\u5199\uff0c\u8fd9\u4e24\u8005\u4f1a\u7ade\u4e89\u6587\u4ef6\u7cfb\u7edf\u7684\u9501\uff0c\u8fd9\u5c31\u4f1a\u5bf9 Redis \u4e3b\u7ebf\u7a0b\u7684\u6027\u80fd\u9020\u6210\u5f71\u54cd\u3002","title":"2-4  \u95ee\u9898 2\uff1aAOF \u91cd\u5199\u4e3a\u4ec0\u4e48\u4e0d\u5171\u4eab\u4f7f\u7528 AOF \u672c\u8eab\u7684\u65e5\u5fd7\uff1f"},{"location":"chap2/10redis_basic_sum/#2-5","text":"\u95ee\u9898\uff1a\u4f7f\u7528\u4e00\u4e2a 2 \u6838 CPU\u30014GB \u5185\u5b58\u3001500GB \u78c1\u76d8\u7684\u4e91\u4e3b\u673a\u8fd0\u884c Redis\uff0cRedis \u6570\u636e\u5e93\u7684\u6570\u636e\u91cf\u5927\u5c0f\u5dee\u4e0d\u591a\u662f 2GB\u3002\u5f53\u65f6 Redis \u4e3b\u8981\u4ee5\u4fee\u6539\u64cd\u4f5c\u4e3a\u4e3b\uff0c\u5199\u8bfb\u6bd4\u4f8b\u5dee\u4e0d\u591a\u5728 8:2 \u5de6\u53f3\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6709 100 \u4e2a\u8bf7\u6c42\uff0c80 \u4e2a\u8bf7\u6c42\u6267\u884c\u7684\u662f\u4fee\u6539\u64cd\u4f5c\u3002\u5728\u8fd9\u4e2a\u573a\u666f\u4e0b\uff0c\u7528 RDB \u505a\u6301\u4e45\u5316\u6709\u4ec0\u4e48\u98ce\u9669\u5417\uff1f \u5185\u5b58\u4e0d\u8db3\u7684\u98ce\u9669\uff1a Redis fork \u4e00\u4e2a bgsave \u5b50\u8fdb\u7a0b\u8fdb\u884c RDB \u5199\u5165\uff0c\u5982\u679c\u4e3b\u7ebf\u7a0b\u518d\u63a5\u6536\u5230\u5199\u64cd\u4f5c\uff0c\u5c31\u4f1a\u91c7\u7528\u5199\u65f6\u590d\u5236\u3002\u5199\u65f6\u590d\u5236\u9700\u8981\u7ed9\u5199\u64cd\u4f5c\u7684\u6570\u636e\u5206\u914d\u65b0\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u672c\u95ee\u9898\u4e2d\u5199\u7684\u6bd4\u4f8b\u4e3a 80%\uff0c\u90a3\u4e48\uff0c\u5728\u6301\u4e45\u5316\u8fc7\u7a0b\u4e2d\uff0c\u4e3a\u4e86\u4fdd\u5b58 80% \u5199\u64cd\u4f5c\u6d89\u53ca\u7684\u6570\u636e\uff0c\u5199\u65f6\u590d\u5236\u673a\u5236\u4f1a\u5728\u5b9e\u4f8b\u5185\u5b58\u4e2d\uff0c\u4e3a\u8fd9\u4e9b\u6570\u636e\u518d\u5206\u914d\u65b0\u5185\u5b58\u7a7a\u95f4\uff0c\u5206\u914d\u7684\u5185\u5b58\u91cf\u76f8\u5f53\u4e8e\u6574\u4e2a\u5b9e\u4f8b\u6570\u636e\u91cf\u7684 80%\uff0c\u5927\u7ea6\u662f 1.6GB\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u6574\u4e2a\u7cfb\u7edf\u5185\u5b58\u7684\u4f7f\u7528\u91cf\u5c31\u63a5\u8fd1\u9971\u548c\u4e86\u3002\u6b64\u65f6\uff0c\u5982\u679c\u5b9e\u4f8b\u8fd8\u6709\u5927\u91cf\u7684\u65b0 key \u5199\u5165\u6216 key \u4fee\u6539\uff0c\u4e91\u4e3b\u673a\u5185\u5b58\u5f88\u5feb\u5c31\u4f1a\u88ab\u5403\u5149\u3002\u5982\u679c\u4e91\u4e3b\u673a\u5f00\u542f\u4e86 Swap \u673a\u5236\uff0c\u5c31\u4f1a\u6709\u4e00\u90e8\u5206\u6570\u636e\u88ab\u6362\u5230\u78c1\u76d8\u4e0a\uff0c\u5f53\u8bbf\u95ee\u78c1\u76d8\u4e0a\u7684\u8fd9\u90e8\u5206\u6570\u636e\u65f6\uff0c\u6027\u80fd\u4f1a\u6025\u5267\u4e0b\u964d\u3002\u5982\u679c\u4e91\u4e3b\u673a\u6ca1\u6709\u5f00\u542f Swap\uff0c\u4f1a\u76f4\u63a5\u89e6\u53d1 OOM\uff0c\u6574\u4e2a Redis \u5b9e\u4f8b\u4f1a\u9762\u4e34\u88ab\u7cfb\u7edf kill \u6389\u7684\u98ce\u9669\u3002 \u4e3b\u7ebf\u7a0b\u548c\u5b50\u8fdb\u7a0b\u7ade\u4e89\u4f7f\u7528 CPU \u7684\u98ce\u9669 \uff1a\u751f\u6210 RDB \u7684\u5b50\u8fdb\u7a0b\u9700\u8981 CPU \u6838\u8fd0\u884c\uff0c\u4e3b\u7ebf\u7a0b\u672c\u8eab\u4e5f\u9700\u8981 CPU \u6838\u8fd0\u884c\uff0c\u800c\u4e14\uff0c\u5982\u679c Redis \u8fd8\u542f\u7528\u4e86\u540e\u53f0\u7ebf\u7a0b\uff0c\u6b64\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u3001\u5b50\u8fdb\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\u90fd\u4f1a\u7ade\u4e89 CPU \u8d44\u6e90\u3002\u7531\u4e8e\u4e91\u4e3b\u673a\u53ea\u6709 2 \u6838 CPU\uff0c\u8fd9\u5c31\u4f1a\u5f71\u54cd\u5230\u4e3b\u7ebf\u7a0b\u5904\u7406\u8bf7\u6c42\u7684\u901f\u5ea6\u3002","title":"2-5"},{"location":"chap2/10redis_basic_sum/#2-6-aof","text":"\u7b54\u6848\uff1a\u6709\u4e24\u4e2a\u539f\u56e0\u3002 RDB \u6587\u4ef6\u662f\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u65e0\u8bba\u662f\u8981\u628a RDB \u5199\u5165\u78c1\u76d8\uff0c\u8fd8\u662f\u8981\u901a\u8fc7\u7f51\u7edc\u4f20\u8f93 RDB\uff0cIO \u6548\u7387\u90fd\u6bd4\u8bb0\u5f55\u548c\u4f20\u8f93 AOF \u7684\u9ad8\u3002 \u5728\u4ece\u5e93\u7aef\u8fdb\u884c\u6062\u590d\u65f6\uff0c\u7528 RDB \u7684\u6062\u590d\u6548\u7387\u8981\u9ad8\u4e8e\u7528 AOF\u3002","title":"2-6 \u4e3a\u4ec0\u4e48\u4e3b\u4ece\u5e93\u95f4\u7684\u590d\u5236\u4e0d\u4f7f\u7528 AOF\uff1f"},{"location":"chap2/10redis_basic_sum/#2-7","text":"\u4e3b\u4ece\u96c6\u7fa4\u4e00\u822c\u662f\u91c7\u7528\u8bfb\u5199\u5206\u79bb\u6a21\u5f0f\uff0c\u5f53\u4e3b\u5e93\u6545\u969c\u540e\uff0c\u5ba2\u6237\u7aef\u4ecd\u7136\u53ef\u4ee5\u628a\u8bfb\u8bf7\u6c42\u53d1\u9001\u7ed9\u4ece\u5e93\uff0c\u8ba9\u4ece\u5e93\u670d\u52a1\u3002\u4f46\u662f\uff0c\u5bf9\u4e8e\u5199\u8bf7\u6c42\u64cd\u4f5c\uff0c\u5ba2\u6237\u7aef\u5c31\u65e0\u6cd5\u6267\u884c\u4e86\u3002 \u5982\u679c\u60f3\u8981\u5e94\u7528\u7a0b\u5e8f\u4e0d\u611f\u77e5\u670d\u52a1\u7684\u4e2d\u65ad\uff0c\u8fd8\u9700\u8981\u54e8\u5175\u6216\u5ba2\u6237\u7aef\u518d\u505a\u4e9b\u4ec0\u4e48\u5417\uff1f \u4e00\u65b9\u9762\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u80fd\u7f13\u5b58\u5e94\u7528\u53d1\u9001\u7684\u5199\u8bf7\u6c42\u3002\u53ea\u8981\u4e0d\u662f\u540c\u6b65\u5199\u64cd\u4f5c\uff08Redis \u5e94\u7528\u573a\u666f\u4e00\u822c\u4e5f\u6ca1\u6709\u540c\u6b65\u5199\uff09\uff0c\u5199\u8bf7\u6c42\u901a\u5e38\u4e0d\u4f1a\u5728\u5e94\u7528\u7a0b\u5e8f\u7684\u5173\u952e\u8def\u5f84\u4e0a\uff0c\u6240\u4ee5\uff0c\u5ba2\u6237\u7aef\u7f13\u5b58\u5199\u8bf7\u6c42\u540e\uff0c\u7ed9\u5e94\u7528\u7a0b\u5e8f\u8fd4\u56de\u4e00\u4e2a\u786e\u8ba4\u5c31\u884c\u3002 \u53e6\u4e00\u65b9\u9762\uff0c\u4e3b\u4ece\u5207\u6362\u5b8c\u6210\u540e\uff0c\u5ba2\u6237\u7aef\u8981\u80fd\u548c\u65b0\u4e3b\u5e93\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5\uff0c\u54e8\u5175\u9700\u8981\u63d0\u4f9b\u8ba2\u9605\u9891\u9053\uff0c\u8ba9\u5ba2\u6237\u7aef\u80fd\u591f\u8ba2\u9605\u5230\u65b0\u4e3b\u5e93\u7684\u4fe1\u606f\u3002\u540c\u65f6\uff0c\u5ba2\u6237\u7aef\u4e5f\u9700\u8981\u80fd\u4e3b\u52a8\u548c\u54e8\u5175\u901a\u4fe1\uff0c\u8be2\u95ee\u65b0\u4e3b\u5e93\u7684\u4fe1\u606f\u3002","title":"2-7 \uff1a\u5728\u4e3b\u4ece\u5207\u6362\u8fc7\u7a0b\u4e2d\uff0c\u5ba2\u6237\u7aef\u80fd\u5426\u6b63\u5e38\u5730\u8fdb\u884c\u8bf7\u6c42\u64cd\u4f5c\u5462\uff1f"},{"location":"chap2/10redis_basic_sum/#2-8","text":"5 \u4e2a\u54e8\u5175\u5b9e\u4f8b\u7684\u96c6\u7fa4\uff0cquorum \u503c\u8bbe\u4e3a 2\u3002\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u6709 3 \u4e2a\u54e8\u5175\u5b9e\u4f8b\u90fd\u53d1\u751f\u6545\u969c\u4e86\uff0c\u6b64\u65f6\uff0cRedis \u4e3b\u5e93\u5982\u679c\u6709\u6545\u969c\uff0c\u8fd8\u80fd\u6b63\u786e\u5730\u5224\u65ad\u4e3b\u5e93\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u5417\uff1f\u5982\u679c\u53ef\u4ee5\u7684\u8bdd\uff0c\u8fd8\u80fd\u8fdb\u884c\u4e3b\u4ece\u5e93\u81ea\u52a8\u5207\u6362\u5417\uff1f \u56e0\u4e3a\u5224\u5b9a\u4e3b\u5e93\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u7684\u4f9d\u636e\u662f\uff0c\u8ba4\u4e3a\u4e3b\u5e93\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u7684\u54e8\u5175\u4e2a\u6570\u8981\u5927\u4e8e\u7b49\u4e8e quorum \u503c\uff0c\u73b0\u5728\u8fd8\u5269 2 \u4e2a\u54e8\u5175\u5b9e\u4f8b\uff0c\u4e2a\u6570\u6b63\u597d\u7b49\u4e8e quorum \u503c\uff0c\u6240\u4ee5\u8fd8\u80fd\u6b63\u5e38\u5224\u65ad\u4e3b\u5e93\u662f\u5426\u5904\u4e8e\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u72b6\u6001\u3002\u5982\u679c\u4e00\u4e2a\u54e8\u5175\u60f3\u8981\u6267\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u5c31\u8981\u83b7\u5230\u534a\u6570\u4ee5\u4e0a\u7684\u54e8\u5175\u6295\u7968\u8d5e\u6210\uff0c\u4e5f\u5c31\u662f\u81f3\u5c11\u9700\u8981 3 \u4e2a\u54e8\u5175\u6295\u7968\u8d5e\u6210\u3002\u4f46\u662f\uff0c\u73b0\u5728\u53ea\u6709 2 \u4e2a\u54e8\u5175\u4e86\uff0c\u6240\u4ee5\u5c31\u65e0\u6cd5\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\u4e86\u3002 \u54e8\u5175\u5b9e\u4f8b\u662f\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\u5462\uff1f\u5982\u679c\u540c\u65f6\u8c03\u5927 down-after-milliseconds \u503c\uff0c\u5bf9\u51cf\u5c11\u8bef\u5224\u662f\u4e0d\u662f\u4e5f\u6709\u597d\u5904\uff1f \u54e8\u5175\u5b9e\u4f8b\u8d8a\u591a\uff0c\u8bef\u5224\u7387\u4f1a\u8d8a\u4f4e\uff0c\u4f46\u662f\u5728\u5224\u5b9a\u4e3b\u5e93\u4e0b\u7ebf\u548c\u9009\u4e3e Leader \u65f6\uff0c\u5b9e\u4f8b\u9700\u8981\u62ff\u5230\u7684\u8d5e\u6210\u7968\u6570\u4e5f\u8d8a\u591a\uff0c\u7b49\u5f85\u6240\u6709\u54e8\u5175\u6295\u5b8c\u7968\u7684\u65f6\u95f4\u53ef\u80fd\u4e5f\u4f1a\u76f8\u5e94\u589e\u52a0\uff0c\u4e3b\u4ece\u5e93\u5207\u6362\u7684\u65f6\u95f4\u4e5f\u4f1a\u53d8\u957f\uff0c\u5ba2\u6237\u7aef\u5bb9\u6613\u5806\u79ef\u8f83\u591a\u7684\u8bf7\u6c42\u64cd\u4f5c\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5ba2\u6237\u7aef\u8bf7\u6c42\u6ea2\u51fa\uff0c\u4ece\u800c\u9020\u6210\u8bf7\u6c42\u4e22\u5931\u3002\u5982\u679c\u4e1a\u52a1\u5c42\u5bf9 Redis \u7684\u64cd\u4f5c\u6709\u54cd\u5e94\u65f6\u95f4\u8981\u6c42\uff0c\u5c31\u53ef\u80fd\u4f1a\u56e0\u4e3a\u65b0\u4e3b\u5e93\u4e00\u76f4\u6ca1\u6709\u9009\u5b9a\uff0c\u65b0\u64cd\u4f5c\u65e0\u6cd5\u6267\u884c\u800c\u53d1\u751f\u8d85\u65f6\u62a5\u8b66\u3002 \u8c03\u5927 down-after-milliseconds \u540e\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8fd9\u6837\u7684\u60c5\u51b5\uff1a \u4e3b\u5e93\u5b9e\u9645\u5df2\u7ecf\u53d1\u751f\u6545\u969c\u4e86\uff0c\u4f46\u662f\u54e8\u5175\u8fc7\u4e86\u5f88\u957f\u65f6\u95f4\u624d\u5224\u65ad\u51fa\u6765\uff0c\u8fd9\u5c31\u4f1a\u5f71\u54cd\u5230 Redis \u5bf9\u4e1a\u52a1\u7684\u53ef\u7528\u6027\u3002","title":"2-8"},{"location":"chap2/10redis_basic_sum/#2-9","text":"\u4e3a\u4ec0\u4e48 Redis \u4e0d\u76f4\u63a5\u7528\u4e00\u4e2a\u8868\uff0c\u628a\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\u8bb0\u5f55\u4e0b\u6765\uff1f \u5982\u679c\u4f7f\u7528\u8868\u8bb0\u5f55\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u4e00\u65e6\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\u53d1\u751f\u4e86\u53d8\u5316\uff08\u4f8b\u5982\u5b9e\u4f8b\u6709\u589e\u51cf\u6216\u8005\u6570\u636e\u91cd\u65b0\u5206\u5e03\uff09\uff0c\u5c31\u8981\u4fee\u6539\u8868\u3002\u5982\u679c\u662f\u5355\u7ebf\u7a0b\u64cd\u4f5c\u8868\uff0c\u90a3\u4e48\u6240\u6709\u64cd\u4f5c\u90fd\u8981\u4e32\u884c\u6267\u884c\uff0c\u6027\u80fd\u6162\uff1b\u5982\u679c\u662f\u591a\u7ebf\u7a0b\u64cd\u4f5c\u8868\uff0c\u5c31\u6d89\u53ca\u5230\u52a0\u9501\u5f00\u9500\u3002\u6b64\u5916\uff0c\u5982\u679c\u6570\u636e\u91cf\u975e\u5e38\u5927\uff0c\u4f7f\u7528\u8868\u8bb0\u5f55\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u9700\u8981\u7684\u989d\u5916\u5b58\u50a8\u7a7a\u95f4\u4e5f\u4f1a\u589e\u52a0\u3002 \u57fa\u4e8e\u54c8\u5e0c\u69fd\u8ba1\u7b97\u65f6\uff0c\u867d\u7136\u4e5f\u8981\u8bb0\u5f55\u54c8\u5e0c\u69fd\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u4f46\u662f\u54c8\u5e0c\u69fd\u7684\u4e2a\u6570\u8981\u6bd4\u952e\u503c\u5bf9\u7684\u4e2a\u6570\u5c11\u5f88\u591a\uff0c\u65e0\u8bba\u662f\u4fee\u6539\u54c8\u5e0c\u69fd\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u8fd8\u662f\u4f7f\u7528\u989d\u5916\u7a7a\u95f4\u5b58\u50a8\u54c8\u5e0c\u69fd\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u90fd\u6bd4\u76f4\u63a5\u8bb0\u5f55\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5173\u7cfb\u7684\u5f00\u9500\u5c0f\u5f97\u591a\u3002","title":"2-9"},{"location":"chap2/10redis_basic_sum/#3","text":"","title":"3\u3001\u5178\u578b\u95ee\u9898\u8bb2\u89e3"},{"location":"chap2/10redis_basic_sum/#3-1-rehash","text":"1.Redis \u4ec0\u4e48\u65f6\u5019\u505a rehash\uff1f Redis \u4f1a\u4f7f\u7528\u88c5\u8f7d\u56e0\u5b50\uff08load factor\uff09\u6765\u5224\u65ad\u662f\u5426\u9700\u8981\u505a rehash\u3002\u88c5\u8f7d\u56e0\u5b50\u7684\u8ba1\u7b97\u65b9\u5f0f\u662f\uff0c\u54c8\u5e0c\u8868\u4e2d\u6240\u6709 entry \u7684\u4e2a\u6570\u9664\u4ee5\u54c8\u5e0c\u8868\u7684\u54c8\u5e0c\u6876\u4e2a\u6570\u3002Redis \u4f1a\u6839\u636e\u88c5\u8f7d\u56e0\u5b50\u7684\u4e24\u79cd\u60c5\u51b5\uff0c\u6765\u89e6\u53d1 rehash \u64cd\u4f5c\uff1a \u88c5\u8f7d\u56e0\u5b50 \u22651 \uff0c\u540c\u65f6\uff0c\u54c8\u5e0c\u8868\u88ab\u5141\u8bb8\u8fdb\u884c rehash \uff1b \u88c5\u8f7d\u56e0\u5b50 \u22655 \u3002 \u5728\u7b2c\u4e00\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u88c5\u8f7d\u56e0\u5b50\u7b49\u4e8e 1\uff0c\u540c\u65f6\u6211\u4eec\u5047\u8bbe\uff0c\u6240\u6709\u952e\u503c\u5bf9\u662f\u5e73\u5747\u5206\u5e03\u5728\u54c8\u5e0c\u8868\u7684\u5404\u4e2a\u6876\u4e2d\u7684\uff0c\u90a3\u4e48\uff0c\u6b64\u65f6\uff0c\u54c8\u5e0c\u8868\u53ef\u4ee5\u4e0d\u7528\u94fe\u5f0f\u54c8\u5e0c\uff0c\u56e0\u4e3a\u4e00\u4e2a\u54c8\u5e0c\u6876\u6b63\u597d\u4fdd\u5b58\u4e86\u4e00\u4e2a\u952e\u503c\u5bf9\u3002 \u4f46\u662f\uff0c\u5982\u679c\u6b64\u65f6\u518d\u6709\u65b0\u7684\u6570\u636e\u5199\u5165\uff0c\u54c8\u5e0c\u8868\u5c31\u8981\u4f7f\u7528\u94fe\u5f0f\u54c8\u5e0c\u4e86\uff0c\u8fd9\u4f1a\u5bf9\u67e5\u8be2\u6027\u80fd\u4ea7\u751f\u5f71\u54cd\u3002\u5728\u8fdb\u884c RDB \u751f\u6210\u548c AOF \u91cd\u5199\u65f6\uff0c\u54c8\u5e0c\u8868\u7684 rehash \u662f\u88ab\u7981\u6b62\u7684\uff0c\u8fd9\u662f\u4e3a\u4e86\u907f\u514d\u5bf9 RDB \u548c AOF \u91cd\u5199\u9020\u6210\u5f71\u54cd\u3002\u5982\u679c\u6b64\u65f6\uff0cRedis \u6ca1\u6709\u5728\u751f\u6210 RDB \u548c\u91cd\u5199 AOF\uff0c\u90a3\u4e48\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c rehash\u3002\u5426\u5219\u7684\u8bdd\uff0c\u518d\u6709\u6570\u636e\u5199\u5165\u65f6\uff0c\u54c8\u5e0c\u8868\u5c31\u8981\u5f00\u59cb\u4f7f\u7528\u67e5\u8be2\u8f83\u6162\u7684\u94fe\u5f0f\u54c8\u5e0c\u4e86\u3002 \u5728\u7b2c\u4e8c\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e5f\u5c31\u662f\u88c5\u8f7d\u56e0\u5b50\u5927\u4e8e\u7b49\u4e8e 5 \u65f6\uff0c\u5c31\u8868\u660e\u5f53\u524d\u4fdd\u5b58\u7684\u6570\u636e\u91cf\u5df2\u7ecf\u8fdc\u8fdc\u5927\u4e8e\u54c8\u5e0c\u6876\u7684\u4e2a\u6570\uff0c\u54c8\u5e0c\u6876\u91cc\u4f1a\u6709\u5927\u91cf\u7684\u94fe\u5f0f\u54c8\u5e0c\u5b58\u5728\uff0c\u6027\u80fd\u4f1a\u53d7\u5230\u4e25\u91cd\u5f71\u54cd\uff0c\u6b64\u65f6\uff0c\u5c31\u7acb\u9a6c\u5f00\u59cb\u505a rehash\u3002 \u521a\u521a\u8bf4\u7684\u662f\u89e6\u53d1 rehash \u7684\u60c5\u51b5\uff0c\u5982\u679c\u88c5\u8f7d\u56e0\u5b50\u5c0f\u4e8e 1\uff0c\u6216\u8005\u88c5\u8f7d\u56e0\u5b50\u5927\u4e8e 1 \u4f46\u662f\u5c0f\u4e8e 5\uff0c\u540c\u65f6\u54c8\u5e0c\u8868\u6682\u65f6\u4e0d\u88ab\u5141\u8bb8\u8fdb\u884c rehash\uff08\u4f8b\u5982\uff0c\u5b9e\u4f8b\u6b63\u5728\u751f\u6210 RDB \u6216\u8005\u91cd\u5199 AOF\uff09\uff0c\u6b64\u65f6\uff0c\u54c8\u5e0c\u8868\u662f\u4e0d\u4f1a\u8fdb\u884c rehash \u64cd\u4f5c\u7684\u3002 2. \u91c7\u7528\u6e10\u8fdb\u5f0f hash \u65f6\uff0c\u5982\u679c\u5b9e\u4f8b\u6682\u65f6\u6ca1\u6709\u6536\u5230\u65b0\u8bf7\u6c42\uff0c\u662f\u4e0d\u662f\u5c31\u4e0d\u505a rehash \u4e86\uff1f \u5176\u5b9e\u4e0d\u662f\u7684\u3002Redis \u4f1a\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\uff0c\u5b9a\u65f6\u4efb\u52a1\u4e2d\u5c31\u5305\u542b\u4e86 rehash \u64cd\u4f5c\u3002\u6240\u8c13\u7684\u5b9a\u65f6\u4efb\u52a1\uff0c\u5c31\u662f\u6309\u7167\u4e00\u5b9a\u9891\u7387\uff08\u4f8b\u5982\u6bcf 100ms/ \u6b21\uff09\u6267\u884c\u7684\u4efb\u52a1\u3002 \u5728 rehash \u88ab\u89e6\u53d1\u540e\uff0c\u5373\u4f7f\u6ca1\u6709\u6536\u5230\u65b0\u8bf7\u6c42\uff0cRedis \u4e5f\u4f1a\u5b9a\u65f6\u6267\u884c\u4e00\u6b21 rehash \u64cd\u4f5c\uff0c\u800c\u4e14\uff0c\u6bcf\u6b21\u6267\u884c\u65f6\u957f\u4e0d\u4f1a\u8d85\u8fc7 1ms\uff0c\u4ee5\u514d\u5bf9\u5176\u4ed6\u4efb\u52a1\u9020\u6210\u5f71\u54cd\u3002","title":"3-1 rehash \u7684\u89e6\u53d1\u65f6\u673a\u548c\u6e10\u8fdb\u5f0f\u6267\u884c\u673a\u5236"},{"location":"chap2/10redis_basic_sum/#3-2","text":"\u9996\u5148\uff0c\u6211\u6765\u89e3\u91ca\u4e00\u4e0b\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7684\u533a\u522b\u3002 \u4ece\u64cd\u4f5c\u7cfb\u7edf\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u8fdb\u7a0b\u4e00\u822c\u662f\u6307\u8d44\u6e90\u5206\u914d\u5355\u5143\uff0c\u4f8b\u5982\u4e00\u4e2a\u8fdb\u7a0b\u62e5\u6709\u81ea\u5df1\u7684\u5806\u3001\u6808\u3001\u865a\u5b58\u7a7a\u95f4\uff08\u9875\u8868\uff09\u3001\u6587\u4ef6\u63cf\u8ff0\u7b26\u7b49\uff1b \u7ebf\u7a0b\u4e00\u822c\u662f\u6307 CPU \u8fdb\u884c\u8c03\u5ea6\u548c\u6267\u884c\u7684\u5b9e\u4f53\u3002 \u5982\u679c\u4e00\u4e2a\u8fdb\u7a0b\u542f\u52a8\u540e\uff0c\u6ca1\u6709\u518d\u521b\u5efa\u989d\u5916\u7684\u7ebf\u7a0b\uff0c\u90a3\u4e48\uff0c \u8fd9\u6837\u7684\u8fdb\u7a0b\u4e00\u822c\u79f0\u4e3a\u4e3b\u8fdb\u7a0b\u6216\u4e3b\u7ebf\u7a0b \u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e0b\u9762\u662f\u6211\u5199\u7684\u4e00\u4e2a C \u7a0b\u5e8f\u7247\u6bb5\uff0cmain \u51fd\u6570\u4f1a\u76f4\u63a5\u8c03\u7528\u4e00\u4e2a worker \u51fd\u6570\uff0c\u51fd\u6570 worker \u5c31\u662f\u6267\u884c\u4e00\u4e2a for \u5faa\u73af\u8ba1\u7b97\u3002\u4e0b\u9762\u8fd9\u4e2a\u7a0b\u5e8f\u8fd0\u884c\u540e\uff0c \u5b83\u81ea\u5df1\u5c31\u662f\u4e00\u4e2a\u4e3b\u8fdb\u7a0b\uff0c\u540c\u65f6\u4e5f\u662f\u4e2a\u4e3b\u7ebf\u7a0b \u3002 int counter = 0; void *worker() { for (int i=0;i<10;i++) { counter++; } return NULL; } int main(int argc, char *argv[]) { worker(); } \u548c\u8fd9\u6bb5\u4ee3\u7801\u7c7b\u4f3c\uff0cRedis \u542f\u52a8\u4ee5\u540e\uff0c\u672c\u8eab\u5c31\u662f\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5b83\u4f1a\u63a5\u6536\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\uff0c\u5e76\u5904\u7406\u8bfb\u5199\u64cd\u4f5c\u8bf7\u6c42\u3002\u800c\u4e14\uff0c\u63a5\u6536\u8bf7\u6c42\u548c\u5904\u7406\u8bf7\u6c42\u64cd\u4f5c\u662f Redis \u7684\u4e3b\u8981\u5de5\u4f5c\uff0cRedis \u6ca1\u6709\u518d\u4f9d\u8d56\u4e8e\u5176\u4ed6\u7ebf\u7a0b\uff0c\u6240\u4ee5\uff0c\u6211\u4e00\u822c\u628a\u5b8c\u6210\u8fd9\u4e2a\u4e3b\u8981\u5de5\u4f5c\u7684 Redis \u8fdb\u7a0b\uff0c\u79f0\u4e3a\u4e3b\u8fdb\u7a0b\u6216\u4e3b\u7ebf\u7a0b\u3002 \u5728\u4e3b\u7ebf\u7a0b\u4e2d\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4f7f\u7528 fork \u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u6216\u662f\u4f7f\u7528 pthread_create \u521b\u5efa\u7ebf\u7a0b\u3002\u4e0b\u9762\u6211\u5148\u4ecb\u7ecd\u4e0b Redis \u4e2d\u7528 fork \u521b\u5efa\u7684\u5b50\u8fdb\u7a0b\u6709\u54ea\u4e9b\u3002 \u521b\u5efa RDB \u7684\u540e\u53f0\u5b50\u8fdb\u7a0b\uff0c\u540c\u65f6\u7531\u5b83\u8d1f\u8d23\u5728\u4e3b\u4ece\u540c\u6b65\u65f6\u4f20\u8f93 RDB \u7ed9\u4ece\u5e93\uff1b \u901a\u8fc7\u65e0\u76d8\u590d\u5236\u65b9\u5f0f\u4f20\u8f93 RDB \u7684\u5b50\u8fdb\u7a0b\uff1b bgrewriteaof \u5b50\u8fdb\u7a0b\u3002 \u7136\u540e\uff0c\u6211\u4eec\u518d\u770b\u4e0b Redis \u4f7f\u7528\u7684\u7ebf\u7a0b\u3002\u4ece 4.0 \u7248\u672c\u5f00\u59cb\uff0cRedis \u4e5f\u5f00\u59cb\u4f7f\u7528 pthread_create \u521b\u5efa\u7ebf\u7a0b\uff0c\u8fd9\u4e9b\u7ebf\u7a0b\u5728\u521b\u5efa\u540e\uff0c\u4e00\u822c\u4f1a\u81ea\u884c\u6267\u884c\u4e00\u4e9b\u4efb\u52a1\uff0c\u4f8b\u5982\u6267\u884c\u5f02\u6b65\u5220\u9664\u4efb\u52a1\u3002\u76f8\u5bf9\u4e8e\u5b8c\u6210\u4e3b\u8981\u5de5\u4f5c\u7684\u4e3b\u7ebf\u7a0b\u6765\u8bf4\uff0c\u6211\u4eec\u4e00\u822c\u53ef\u4ee5\u79f0\u8fd9\u4e9b\u7ebf\u7a0b\u4e3a\u540e\u53f0\u7ebf\u7a0b\u3002","title":"3-2 \u4e3b\u7ebf\u7a0b\u3001\u5b50\u8fdb\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\u7684\u8054\u7cfb\u4e0e\u533a\u522b"},{"location":"chap2/10redis_basic_sum/#3-3","text":"Redis \u5728\u4f7f\u7528 RDB \u65b9\u5f0f\u8fdb\u884c\u6301\u4e45\u5316\u65f6\uff0c\u4f1a\u7528\u5230\u5199\u65f6\u590d\u5236\u673a\u5236\u3002 bgsave \u5b50\u8fdb\u7a0b\u76f8\u5f53\u4e8e\u590d\u5236\u4e86\u539f\u59cb\u6570\u636e\uff0c\u800c\u4e3b\u7ebf\u7a0b\u4ecd\u7136\u53ef\u4ee5\u4fee\u6539\u539f\u6765\u7684\u6570\u636e\u3002 \u5bf9 Redis \u6765\u8bf4\uff0c\u4e3b\u7ebf\u7a0b fork \u51fa bgsave \u5b50\u8fdb\u7a0b\u540e\uff0cbgsave \u5b50\u8fdb\u7a0b\u5b9e\u9645\u662f\u590d\u5236\u4e86\u4e3b\u7ebf\u7a0b\u7684\u9875\u8868\u3002 \u8fd9\u4e9b\u9875\u8868\u4e2d\uff0c\u5c31\u4fdd\u5b58\u4e86\u5728\u6267\u884c bgsave \u547d\u4ee4\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u7684\u6240\u6709\u6570\u636e\u5757\u5728\u5185\u5b58\u4e2d\u7684\u7269\u7406\u5730\u5740\u3002 \u8fd9\u6837\u4e00\u6765\uff0cbgsave \u5b50\u8fdb\u7a0b\u751f\u6210 RDB \u65f6\uff0c\u5c31\u53ef\u4ee5\u6839\u636e\u9875\u8868\u8bfb\u53d6\u8fd9\u4e9b\u6570\u636e\uff0c\u518d\u5199\u5165\u78c1\u76d8\u4e2d\u3002 \u5982\u679c\u6b64\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u63a5\u6536\u5230\u4e86\u65b0\u5199\u6216\u4fee\u6539\u64cd\u4f5c\uff0c\u90a3\u4e48\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u4f7f\u7528\u5199\u65f6\u590d\u5236\u673a\u5236\u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u5199\u65f6\u590d\u5236\u5c31\u662f\u6307\uff0c\u4e3b\u7ebf\u7a0b\u5728\u6709\u5199\u64cd\u4f5c\u65f6\uff0c\u624d\u4f1a\u628a\u8fd9\u4e2a\u65b0\u5199\u6216\u4fee\u6539\u540e\u7684\u6570\u636e\u5199\u5165\u5230\u4e00\u4e2a\u65b0\u7684\u7269\u7406\u5730\u5740\u4e2d\uff0c\u5e76\u4fee\u6539\u81ea\u5df1\u7684\u9875\u8868\u6620\u5c04\u3002 bgsave \u5b50\u8fdb\u7a0b\u590d\u5236\u4e3b\u7ebf\u7a0b\u7684\u9875\u8868\u4ee5\u540e\uff0c\u5047\u5982\u4e3b\u7ebf\u7a0b\u9700\u8981\u4fee\u6539\u865a\u9875 7 \u91cc\u7684\u6570\u636e\uff0c\u90a3\u4e48\uff0c\u4e3b\u7ebf\u7a0b\u5c31\u9700\u8981\u65b0\u5206\u914d\u4e00\u4e2a\u7269\u7406\u9875\uff08\u5047\u8bbe\u662f\u7269\u7406\u9875 53\uff09\uff0c \u7136\u540e\u628a\u4fee\u6539\u540e\u7684\u865a\u9875 7 \u91cc\u7684\u6570\u636e\u5199\u5230\u7269\u7406\u9875 53 \u4e0a\uff0c\u800c\u865a\u9875 7 \u91cc\u539f\u6765\u7684\u6570\u636e\u4ecd\u7136\u4fdd\u5b58\u5728\u7269\u7406\u9875 33 \u4e0a \u8fd9\u4e2a\u65f6\u5019\uff0c\u865a\u9875 7 \u5230\u7269\u7406\u9875 33 \u7684\u6620\u5c04\u5173\u7cfb\uff0c\u4ecd\u7136\u4fdd\u7559\u5728 bgsave \u5b50\u8fdb\u7a0b\u4e2d\u3002 bgsave \u5b50\u8fdb\u7a0b\u53ef\u4ee5\u65e0\u8bef\u5730\u628a\u865a\u9875 7 \u7684\u539f\u59cb\u6570\u636e\u5199\u5165 RDB \u6587\u4ef6\u3002","title":"3-3 \u5199\u65f6\u590d\u5236\u7684\u5e95\u5c42\u5b9e\u73b0\u673a\u5236"},{"location":"chap2/10redis_basic_sum/#3-4-replication-buffer-repl_backlog_buffer","text":"\u5728\u8fdb\u884c\u4e3b\u4ece\u590d\u5236\u65f6\uff0cRedis \u4f1a\u4f7f\u7528 replication buffer \u548c repl_backlog_buffer replication buffer \u662f\u4e3b\u4ece\u5e93\u5728\u8fdb\u884c\u5168\u91cf\u590d\u5236\u65f6\uff0c\u4e3b\u5e93\u4e0a\u7528\u4e8e\u548c\u4ece\u5e93\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u7684 buffer \uff0c \u800c repl_backlog_buffer \u662f\u4e3a\u4e86\u652f\u6301\u4ece\u5e93\u589e\u91cf\u590d\u5236\uff0c\u4e3b\u5e93\u4e0a\u7528\u4e8e\u6301\u7eed\u4fdd\u5b58\u5199\u64cd\u4f5c\u7684\u4e00\u5757\u4e13\u7528 buffer\u3002 Redis \u4e3b\u4ece\u5e93\u5728\u8fdb\u884c\u590d\u5236\u65f6\uff0c\u5f53\u4e3b\u5e93\u8981\u628a\u5168\u91cf\u590d\u5236\u671f\u95f4\u7684\u5199\u64cd\u4f5c\u547d\u4ee4\u53d1\u7ed9\u4ece\u5e93\u65f6\uff0c \u4e3b\u5e93\u4f1a\u5148\u521b\u5efa\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u7528\u6765\u8fde\u63a5\u4ece\u5e93\uff0c\u7136\u540e\u901a\u8fc7\u8fd9\u4e2a\u5ba2\u6237\u7aef\uff0c\u628a\u5199\u64cd\u4f5c\u547d\u4ee4\u53d1\u7ed9\u4ece\u5e93\u3002 \u5728\u5185\u5b58\u4e2d\uff0c\u4e3b\u5e93\u4e0a\u7684\u5ba2\u6237\u7aef\u5c31\u4f1a\u5bf9\u5e94\u4e00\u4e2a buffer\uff0c\u8fd9\u4e2a buffer \u5c31\u88ab\u79f0\u4e3a replication buffer\u3002 Redis \u901a\u8fc7 client_buffer \u914d\u7f6e\u9879\u6765\u63a7\u5236\u8fd9\u4e2a buffer \u7684\u5927\u5c0f\u3002 \u4e3b\u5e93\u4f1a\u7ed9\u6bcf\u4e2a\u4ece\u5e93\u5efa\u7acb\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u6240\u4ee5 replication buffer \u4e0d\u662f\u5171\u4eab\u7684\uff0c\u800c\u662f\u6bcf\u4e2a\u4ece\u5e93\u90fd\u6709\u4e00\u4e2a\u5bf9\u5e94\u7684\u5ba2\u6237\u7aef repl_backlog_buffer \u662f\u4e00\u5757\u4e13\u7528 buffer\uff0c\u5728 Redis \u670d\u52a1\u5668\u542f\u52a8\u540e\uff0c\u5f00\u59cb\u4e00\u76f4\u63a5\u6536\u5199\u64cd\u4f5c\u547d\u4ee4\uff0c\u8fd9\u662f\u6240\u6709\u4ece\u5e93\u5171\u4eab\u7684\u3002\u4e3b\u5e93\u548c\u4ece\u5e93\u4f1a\u5404\u81ea\u8bb0\u5f55\u81ea\u5df1\u7684\u590d\u5236\u8fdb\u5ea6\uff0c\u6240\u4ee5\uff0c\u4e0d\u540c\u7684\u4ece\u5e93\u5728\u8fdb\u884c\u6062\u590d\u65f6\uff0c\u4f1a\u628a\u81ea\u5df1\u7684\u590d\u5236\u8fdb\u5ea6\uff08 slave_repl_offset \uff09\u53d1\u7ed9\u4e3b\u5e93\uff0c\u4e3b\u5e93\u5c31\u53ef\u4ee5\u548c\u5b83\u72ec\u7acb\u540c\u6b65\u3002","title":"3-4 replication buffer \u548c repl_backlog_buffer \u7684\u533a\u522b"},{"location":"chap2/1redis_kv/","text":"\u7b2c\u4e00\u8282 \u57fa\u672c\u67b6\u6784\uff1a \u952e\u503c\u6570\u636e\u5e93 1\u3001\u6784\u5efa\u7b80\u5355\u7684\u952e\u503c\u6570\u636e\u5e93\u79f0 SimpleKV \u6784\u9020 SimpleKV \u65f6\uff0c \u9996\u5148\u5c31\u8981\u8003\u8651\u91cc\u9762\u53ef\u4ee5\u5b58\u4ec0\u4e48\u6837\u7684\u6570\u636e\uff0c \u5bf9\u6570\u636e\u53ef\u4ee5\u505a\u4ec0\u4e48\u6837\u7684\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u6570\u636e\u6a21\u578b\u548c\u64cd\u4f5c\u63a5\u53e3 \u5b9e\u9645\u4e0a\u5374\u662f\u6211\u4eec\u7406\u89e3 Redis \u7ecf\u5e38\u88ab\u7528\u4e8e\u7f13\u5b58\u3001\u79d2\u6740\u3001\u5206\u5e03\u5f0f\u9501\u7b49\u573a\u666f\u7684\u91cd\u8981\u57fa\u7840\u3002 \u4f46\u662f\uff0c\u5982\u679c\u4f60\u8981\u5bf9\u591a\u4e2a\u7528\u6237\u7684\u5e74\u9f84\u8ba1\u7b97\u5747\u503c\uff0c\u952e\u503c\u6570\u636e\u5e93\u5c31\u65e0\u6cd5\u5b8c\u6210\u4e86\u3002\u56e0\u4e3a\u5b83\u53ea\u63d0\u4f9b\u7b80\u5355\u7684\u64cd\u4f5c\u63a5\u53e3\uff0c\u65e0\u6cd5\u652f\u6301\u590d\u6742\u7684\u805a\u5408\u8ba1\u7b97 2\u3001\u53ef\u4ee5\u5b58\u54ea\u4e9b\u6570\u636e\uff1f \u5bf9\u4e8e\u952e\u503c\u6570\u636e\u5e93\u800c\u8a00\uff0c\u57fa\u672c\u7684\u6570\u636e\u6a21\u578b\u662f key-value \u6a21\u578b\u3002 \u4f8b\u5982\uff0c\u201chello\u201d: \u201cworld\u201d\u5c31\u662f\u4e00\u4e2a\u57fa\u672c\u7684 KV \u5bf9\uff0c\u5176\u4e2d\uff0c\u201chello\u201d\u662f key\uff0c\u201cworld\u201d\u662f value\u3002SimpleKV \u4e5f\u4e0d\u4f8b\u5916\u3002 \u5728 SimpleKV \u4e2d\uff0ckey \u662f String \u7c7b\u578b\uff0c\u800c value \u662f\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff0c\u4f8b\u5982 String\u3001\u6574\u578b\u7b49\u3002\u4f46\u662f\uff0cSimpleKV \u6bd5\u7adf\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u952e\u503c\u6570\u636e\u5e93\uff0c\u5bf9\u4e8e\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e2d\u7684\u952e\u503c\u6570\u636e\u5e93\u6765\u8bf4\uff0cvalue \u7c7b\u578b\u8fd8\u53ef\u4ee5\u662f\u590d\u6742\u7c7b\u578b\u3002 \u4e0d\u540c\u952e\u503c\u6570\u636e\u5e93\u652f\u6301\u7684 key \u7c7b\u578b\u4e00\u822c\u5dee\u5f02\u4e0d\u5927\uff0c\u800c value \u7c7b\u578b\u5219\u6709\u8f83\u5927\u5dee\u522b\u3002\u6211\u4eec\u5728\u5bf9\u952e\u503c\u6570\u636e\u5e93\u8fdb\u884c\u9009\u578b\u65f6\uff0c \u4e00\u4e2a\u91cd\u8981\u7684\u8003\u8651\u56e0\u7d20\u662f\u5b83\u652f\u6301\u7684 value \u7c7b\u578b\u3002 \u4f8b\u5982\uff0c Memcached \u652f\u6301\u7684 value \u7c7b\u578b\u4ec5\u4e3a String \u7c7b\u578b\uff0c\u800c Redis \u652f\u6301\u7684 value \u7c7b\u578b\u5305\u62ec\u4e86 String\u3001\u54c8\u5e0c\u8868\u3001\u5217\u8868\u3001\u96c6\u5408\u7b49 \u3002 Redis \u80fd\u591f\u5728\u5b9e\u9645\u4e1a\u52a1\u573a\u666f\u4e2d\u5f97\u5230\u5e7f\u6cdb\u7684\u5e94\u7528\uff0c\u5c31\u662f\u5f97\u76ca\u4e8e\u652f\u6301\u591a\u6837\u5316\u7c7b\u578b\u7684 value\u3002 3\u3001\u53ef\u4ee5\u5bf9\u6570\u636e\u505a\u4ec0\u4e48\u64cd\u4f5c\uff1f 3-1 SimpleKV\u7684\u64cd\u4f5c SimpleKV \u9700\u8981\u652f\u6301\u7684 3 \u79cd\u57fa\u672c\u64cd\u4f5c\uff0c\u5373 PUT\u3001GET \u548c DELETE\u3002 PUT\uff1a\u65b0\u5199\u5165\u6216\u66f4\u65b0\u4e00\u4e2a key-value \u5bf9\uff1b GET\uff1a\u6839\u636e\u4e00\u4e2a key \u8bfb\u53d6\u76f8\u5e94\u7684 value \u503c\uff1b DELETE\uff1a\u6839\u636e\u4e00\u4e2a key \u5220\u9664\u6574\u4e2a key-value \u5bf9\u3002 \u6709\u4e9b\u952e\u503c\u6570\u636e\u5e93\u7684\u65b0\u5199 / \u66f4\u65b0\u64cd\u4f5c\u53eb SET \u65b0\u5199\u5165\u548c\u66f4\u65b0\u867d\u7136\u662f\u7528\u4e00\u4e2a\u64cd\u4f5c\u63a5\u53e3\uff0c\u4f46\u5728\u5b9e\u9645\u6267\u884c\u65f6\uff0c\u4f1a\u6839\u636e key \u662f\u5426\u5b58\u5728\u800c\u6267\u884c\u76f8\u5e94\u7684\u65b0\u5199\u6216\u66f4\u65b0\u6d41\u7a0b\u3002 \u5728\u5b9e\u9645\u7684\u4e1a\u52a1\u573a\u666f\u4e2d. \u67e5\u8be2\u4e00\u4e2a\u7528\u6237\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\u7684\u8bbf\u95ee\u8bb0\u5f55\u3002\u8fd9\u79cd\u64cd\u4f5c\u5728\u952e\u503c\u6570\u636e\u5e93\u4e2d\u5c5e\u4e8e SCAN \u64cd\u4f5c\uff0c\u5373\u6839\u636e\u4e00\u6bb5 key \u7684\u8303\u56f4\u8fd4\u56de\u76f8\u5e94\u7684 value \u503c\u3002\u56e0\u6b64\uff0c PUT/GET/DELETE/SCAN \u662f\u4e00\u4e2a\u952e\u503c\u6570\u636e\u5e93\u7684\u57fa\u672c\u64cd\u4f5c\u96c6\u5408\u3002 \u5b9e\u9645\u4e1a\u52a1\u573a\u666f\u901a\u5e38\u8fd8\u6709\u66f4\u52a0\u4e30\u5bcc\u7684\u9700\u6c42\uff0c\u4f8b\u5982\uff0c \u5728\u9ed1\u767d\u540d\u5355\u5e94\u7528\u4e2d\uff0c\u9700\u8981\u5224\u65ad\u67d0\u4e2a\u7528\u6237\u662f\u5426\u5b58\u5728\u3002\u5982\u679c\u5c06\u8be5\u7528\u6237\u7684 ID \u4f5c\u4e3a key\uff0c\u90a3\u4e48\uff0c\u53ef\u4ee5\u589e\u52a0 EXISTS \u64cd\u4f5c\u63a5\u53e3\uff0c\u7528\u4e8e\u5224\u65ad\u67d0\u4e2a key \u662f\u5426\u5b58\u5728 \u5f53\u4e00\u4e2a\u952e\u503c\u6570\u636e\u5e93\u7684 value \u7c7b\u578b\u591a\u6837\u5316\u65f6\uff0c\u5c31\u9700\u8981\u5305\u542b\u76f8\u5e94\u7684\u64cd\u4f5c\u63a5\u53e3\u3002 \u4f8b\u5982\uff0cRedis \u7684 value \u6709\u5217\u8868\u7c7b\u578b\uff0c\u56e0\u6b64\u5b83\u7684\u63a5\u53e3\u5c31\u8981\u5305\u62ec\u5bf9\u5217\u8868 value \u7684\u64cd\u4f5c\u3002 3-2 \u952e\u503c\u5bf9\u4fdd\u5b58\u5728\u5185\u5b58\u8fd8\u662f\u5916\u5b58 \u4fdd\u5b58\u5728\u5185\u5b58\u7684\u597d\u5904\u662f\u8bfb\u5199\u5f88\u5feb\uff0c\u6bd5\u7adf\u5185\u5b58\u7684\u8bbf\u95ee\u901f\u5ea6\u4e00\u822c\u90fd\u5728\u767e ns \u7ea7\u522b\u3002\u4f46\u662f\uff0c\u6f5c\u5728\u7684\u98ce\u9669\u662f\u4e00\u65e6\u6389\u7535\uff0c\u6240\u6709\u7684\u6570\u636e\u90fd\u4f1a\u4e22\u5931\u3002 \u4fdd\u5b58\u5728\u5916\u5b58\uff0c\u867d\u7136\u53ef\u4ee5\u907f\u514d\u6570\u636e\u4e22\u5931\uff0c\u4f46\u662f\u53d7\u9650\u4e8e\u78c1\u76d8\u7684\u6162\u901f\u8bfb\u5199\uff08\u901a\u5e38\u5728\u51e0 ms \u7ea7\u522b\uff09\uff0c\u952e\u503c\u6570\u636e\u5e93\u7684\u6574\u4f53\u6027\u80fd\u4f1a\u88ab\u62c9\u4f4e\u3002 \u770b\u9700\u8981\u573a\u666f\uff1b\u4f5c\u4e3a\u7f13\u5b58\uff0c\u80fd\u591f\u63a5\u6536\u6570\u636e\u4e22\u5931\uff0c\u5219\u7528\u5185\u5b58\uff1b\u4e0d\u80fd\u63a5\u53d7\u6570\u636e\u4e22\u5931\uff0c\u6027\u80fd\u8981\u6c42\u4e0d\u8981\uff0c\u7528\u5916\u5b58\u3002 \u5982\u4f55\u8fdb\u884c\u8bbe\u8ba1\u9009\u62e9\uff0c\u6211\u4eec\u901a\u5e38\u9700\u8981\u8003\u8651\u952e\u503c\u6570\u636e\u5e93\u7684\u4e3b\u8981\u5e94\u7528\u573a\u666f \u7f13\u5b58\u573a\u666f\u4e0b\u7684\u6570\u636e\u9700\u8981\u80fd\u5feb\u901f\u8bbf\u95ee\u4f46\u5141\u8bb8\u4e22\u5931\uff0c\u90a3\u4e48\uff0c\u7528\u4e8e\u6b64\u573a\u666f\u7684\u952e\u503c\u6570\u636e\u5e93\u901a\u5e38\u91c7\u7528\u5185\u5b58\u4fdd\u5b58\u952e\u503c\u6570\u636e\u3002Memcached \u548c Redis \u90fd\u662f\u5c5e\u4e8e\u5185\u5b58\u952e\u503c\u6570\u636e\u5e93\u3002\u5bf9\u4e8e Redis \u800c\u8a00\uff0c\u7f13\u5b58\u662f\u975e\u5e38\u91cd\u8981\u7684\u4e00\u4e2a\u5e94\u7528\u573a\u666f\u3002 \u5927\u4f53\u6765\u8bf4\uff0c\u4e00\u4e2a\u952e\u503c\u6570\u636e\u5e93\u5305\u62ec\u4e86 \u8bbf\u95ee\u6846\u67b6\u3001\u7d22\u5f15\u6a21\u5757\u3001\u64cd\u4f5c\u6a21\u5757\u548c\u5b58\u50a8\u6a21\u5757 \u56db\u90e8\u5206\uff08\u89c1\u4e0b\u56fe\uff09 4\u3001\u91c7\u7528\u4ec0\u4e48\u8bbf\u95ee\u6a21\u5f0f\uff1f \u8bbf\u95ee\u6a21\u5f0f\u901a\u5e38\u6709\u4e24\u79cd\uff1a \u4e00\u79cd\u662f\u901a\u8fc7 \u51fd\u6570\u5e93\u8c03\u7528\u7684\u65b9\u5f0f\u4f9b\u5916\u90e8\u5e94\u7528\u4f7f\u7528 \uff0c\u6bd4\u5982\uff0c\u4e0a\u56fe\u4e2d\u7684 libsimplekv.so \uff0c\u5c31\u662f\u4ee5 \u52a8\u6001\u94fe\u63a5\u5e93\u7684\u5f62\u5f0f\u94fe\u63a5\u5230\u6211\u4eec\u81ea\u5df1\u7684\u7a0b\u5e8f\u4e2d \uff0c\u63d0\u4f9b\u952e\u503c\u5b58\u50a8\u529f\u80fd\uff1b \u4e00\u79cd\u662f\u901a\u8fc7 \u7f51\u7edc\u6846\u67b6\u4ee5 Socket \u901a\u4fe1\u7684\u5f62\u5f0f\u5bf9\u5916\u63d0\u4f9b\u952e\u503c\u5bf9\u64cd\u4f5c \uff0c\u8fd9\u79cd\u5f62\u5f0f\u53ef\u4ee5\u63d0\u4f9b\u5e7f\u6cdb\u7684\u952e\u503c\u5b58\u50a8\u670d\u52a1\u3002\u7f51\u7edc\u6846\u67b6\u4e2d\u5305\u62ec Socket Server \u548c\u534f\u8bae\u89e3\u6790\u3002 \u5b9e\u9645\u7684\u952e\u503c\u6570\u636e\u5e93\u4e5f\u57fa\u672c\u91c7\u7528\u4e0a\u8ff0\u4e24\u79cd\u65b9\u5f0f\uff0c\u4f8b\u5982\uff0cRocksDB \u4ee5\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u5f62\u5f0f\u4f7f\u7528\uff0c\u800c Memcached \u548c Redis \u5219\u662f\u901a\u8fc7\u7f51\u7edc\u6846\u67b6\u8bbf\u95ee \u901a\u8fc7\u7f51\u7edc\u6846\u67b6\u63d0\u4f9b\u952e\u503c\u5b58\u50a8\u670d\u52a1\uff0c\u4e00\u65b9\u9762\u6269\u5927\u4e86\u952e\u503c\u6570\u636e\u5e93\u7684\u53d7\u7528\u9762\uff0c\u4f46\u53e6\u4e00\u65b9\u9762\uff0c\u4e5f\u7ed9\u952e\u503c\u6570\u636e\u5e93\u7684\u6027\u80fd\u3001\u8fd0\u884c\u6a21\u578b\u63d0\u4f9b\u4e86\u4e0d\u540c\u7684\u8bbe\u8ba1\u9009\u62e9\uff0c\u5e26\u6765\u4e86\u4e00\u4e9b\u6f5c\u5728\u7684\u95ee\u9898\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5f53\u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u4e2a\u5982\u4e0b\u7684\u547d\u4ee4\u540e\uff0c\u8be5\u547d\u4ee4\u4f1a\u88ab\u5c01\u88c5\u5728\u7f51\u7edc\u5305\u4e2d\u53d1\u9001\u7ed9\u952e\u503c\u6570\u636e\u5e93\uff1a PUT hello world 5\u3001\u5982\u4f55\u5b9a\u4f4d\u952e\u503c\u5bf9\u7684\u4f4d\u7f6e\uff1f \u5f53 SimpleKV \u89e3\u6790\u4e86\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u8bf7\u6c42\uff0c\u77e5\u9053\u4e86\u8981\u8fdb\u884c\u7684\u952e\u503c\u5bf9\u64cd\u4f5c\uff0c\u6b64\u65f6\uff0cSimpleKV \u9700\u8981\u67e5\u627e\u6240\u8981\u64cd\u4f5c\u7684\u952e\u503c\u5bf9\u662f\u5426\u5b58\u5728\uff0c\u8fd9\u4f9d\u8d56\u4e8e\u952e\u503c\u6570\u636e\u5e93\u7684\u7d22\u5f15\u6a21\u5757\u3002 \u7d22\u5f15\u7684\u4f5c\u7528\u662f\u8ba9\u952e\u503c\u6570\u636e\u5e93\u6839\u636e key \u627e\u5230\u76f8\u5e94 value \u7684\u5b58\u50a8\u4f4d\u7f6e\uff0c\u8fdb\u800c\u6267\u884c\u64cd\u4f5c\u3002 \u7d22\u5f15\u7684\u7c7b\u578b\u6709\u5f88\u591a\uff0c\u5e38\u89c1\u7684\u6709\u54c8\u5e0c\u8868\u3001B+ \u6811\u3001\u5b57\u5178\u6811\u7b49\u3002\u4e0d\u540c\u7684\u7d22\u5f15\u7ed3\u6784\u5728\u6027\u80fd\u3001\u7a7a\u95f4\u6d88\u8017\u3001\u5e76\u53d1\u63a7\u5236\u7b49\u65b9\u9762\u5177\u6709\u4e0d\u540c\u7684\u7279\u5f81\u3002 \u4e0d\u540c\u952e\u503c\u6570\u636e\u5e93\u91c7\u7528\u7684\u7d22\u5f15\u5e76\u4e0d\u76f8\u540c \uff0c\u4f8b\u5982\uff0cMemcached \u548c Redis \u91c7\u7528\u54c8\u5e0c\u8868\u4f5c\u4e3a key-value \u7d22\u5f15\uff0c\u800c RocksDB \u5219\u91c7\u7528\u8df3\u8868\u4f5c\u4e3a\u5185\u5b58\u4e2d key-value \u7684\u7d22\u5f15\u3002 \u5185\u5b58\u952e\u503c\u6570\u636e\u5e93\uff08\u4f8b\u5982 Redis\uff09\u91c7\u7528\u54c8\u5e0c\u8868\u4f5c\u4e3a\u7d22\u5f15\uff0c\u5f88\u5927\u4e00\u90e8\u5206\u539f\u56e0\u5728\u4e8e\uff0c \u5176\u952e\u503c\u6570\u636e\u57fa\u672c\u90fd\u662f\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u800c\u5185\u5b58\u7684\u9ad8\u6027\u80fd\u968f\u673a\u8bbf\u95ee\u7279\u6027\u53ef\u4ee5\u5f88\u597d\u5730\u4e0e\u54c8\u5e0c\u8868 O(1) \u7684\u64cd\u4f5c\u590d\u6742\u5ea6\u76f8\u5339\u914d\u3002 6\u3001\u4e0d\u540c\u64cd\u4f5c\u7684\u5177\u4f53\u903b\u8f91\u662f\u600e\u6837\u7684\uff1f SimpleKV \u7684\u7d22\u5f15\u6a21\u5757\u8d1f\u8d23\u6839\u636e key \u627e\u5230\u76f8\u5e94\u7684 value \u7684\u5b58\u50a8\u4f4d\u7f6e\u3002\u5bf9\u4e8e\u4e0d\u540c\u7684\u64cd\u4f5c\u6765\u8bf4\uff0c\u627e\u5230\u5b58\u50a8\u4f4d\u7f6e\u4e4b\u540e\uff0c\u9700\u8981\u8fdb\u4e00\u6b65\u6267\u884c\u7684\u64cd\u4f5c\u7684\u5177\u4f53\u903b\u8f91\u4f1a\u6709\u6240\u5dee\u5f02\u3002 SimpleKV \u7684\u64cd\u4f5c\u6a21\u5757\u5c31\u5b9e\u73b0\u4e86\u4e0d\u540c\u64cd\u4f5c\u7684\u5177\u4f53\u903b\u8f91\uff1a \u5bf9\u4e8e GET/SCAN \u64cd\u4f5c\u800c\u8a00\uff0c\u6b64\u65f6\u6839\u636e value \u7684\u5b58\u50a8\u4f4d\u7f6e\u8fd4\u56de value \u503c\u5373\u53ef\uff1b \u5bf9\u4e8e PUT \u4e00\u4e2a\u65b0\u7684\u952e\u503c\u5bf9\u6570\u636e\u800c\u8a00\uff0cSimpleKV \u9700\u8981\u4e3a\u8be5\u952e\u503c\u5bf9\u5206\u914d\u5185\u5b58\u7a7a\u95f4\uff1b \u5bf9\u4e8e DELETE \u64cd\u4f5c\uff0cSimpleKV \u9700\u8981\u5220\u9664\u952e\u503c\u5bf9\uff0c\u5e76\u91ca\u653e\u76f8\u5e94\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u7531\u5206\u914d\u5668\u5b8c\u6210\u3002 7\u3001\u5982\u4f55\u5b9e\u73b0\u91cd\u542f\u540e\u5feb\u901f\u63d0\u4f9b\u670d\u52a1\uff1f SimpleKV \u91c7\u7528\u4e86\u5e38\u7528\u7684 \u5185\u5b58\u5206\u914d\u5668 glibc \u7684 malloc \u548c free \uff0c\u56e0\u6b64\uff0cSimpleKV \u5e76\u4e0d\u9700\u8981\u7279\u522b\u8003\u8651\u5185\u5b58\u7a7a\u95f4\u7684\u7ba1\u7406\u95ee\u9898\u3002 \u4f46\u662f\uff0c\u952e\u503c\u6570\u636e\u5e93\u7684\u952e\u503c\u5bf9\u901a\u5e38\u5927\u5c0f\u4e0d\u4e00\uff0cglibc \u7684\u5206\u914d\u5668\u5728\u5904\u7406\u968f\u673a\u7684\u5927\u5c0f\u5185\u5b58\u5757\u5206\u914d\u65f6\uff0c\u8868\u73b0\u5e76\u4e0d\u597d\u3002\u4e00\u65e6\u4fdd\u5b58\u7684\u952e\u503c\u5bf9\u6570\u636e\u89c4\u6a21\u8fc7\u5927\uff0c\u5c31\u53ef\u80fd\u4f1a\u9020\u6210\u8f83\u4e25\u91cd\u7684\u5185\u5b58\u788e\u7247\u95ee\u9898\u3002 malloc() \u5728\u8fd0\u884c\u671f\u52a8\u6001\u5206\u914d\u5206\u914d\u5185\u5b58, free() \u91ca\u653e\u7531\u5176\u5206\u914d\u7684\u5185\u5b58\u3002 \u5206\u914d\u5668\u662f\u952e\u503c\u6570\u636e\u5e93\u4e2d\u7684\u4e00\u4e2a\u5173\u952e\u56e0\u7d20 \u5bf9\u4e8e\u4ee5\u5185\u5b58\u5b58\u50a8\u4e3a\u4e3b\u7684 Redis \u800c\u8a00\uff0c\u8fd9\u70b9\u5c24\u4e3a\u91cd\u8981\u3002 SimpleKV \u867d\u7136\u4f9d\u8d56\u4e8e\u5185\u5b58\u4fdd\u5b58\u6570\u636e\uff0c\u63d0\u4f9b\u5feb\u901f\u8bbf\u95ee\uff0c\u4f46\u662f\uff0c\u6211\u4e5f\u5e0c\u671b SimpleKV \u91cd\u542f\u540e\u80fd\u5feb\u901f\u91cd\u65b0\u63d0\u4f9b\u670d\u52a1\uff0c\u6240\u4ee5\uff0c\u6211\u5728 SimpleKV \u7684\u5b58\u50a8\u6a21\u5757\u4e2d\u589e\u52a0\u4e86\u6301\u4e45\u5316\u529f\u80fd\u3002 SimpleKV \u76f4\u63a5\u91c7\u7528\u4e86\u6587\u4ef6\u5f62\u5f0f\uff0c\u5c06\u952e\u503c\u6570\u636e\u901a\u8fc7\u8c03\u7528\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u7684\u64cd\u4f5c\u63a5\u53e3\u4fdd\u5b58\u5728\u78c1\u76d8\u4e0a\u3002\u6b64\u65f6\uff0cSimpleKV \u53ea\u9700\u8981\u8003\u8651\u4f55\u65f6\u5c06\u5185\u5b58\u4e2d\u7684\u952e\u503c\u6570\u636e\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\uff0c\u5c31\u53ef\u4ee5\u4e86\u3002 \u4e00\u79cd\u65b9\u5f0f\u662f\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u952e\u503c\u5bf9\uff0cSimpleKV \u90fd\u5bf9\u5176\u8fdb\u884c\u843d\u76d8\u4fdd\u5b58\uff0c\u8fd9\u867d\u7136\u8ba9 SimpleKV \u7684\u6570\u636e\u66f4\u52a0\u53ef\u9760\uff0c\u4f46\u662f\uff0c\u56e0\u4e3a\u6bcf\u6b21\u90fd\u8981\u5199\u76d8\uff0cSimpleKV \u7684\u6027\u80fd\u4f1a\u53d7\u5230\u5f88\u5927\u5f71\u54cd\u3002 \u53e6\u4e00\u79cd\u65b9\u5f0f\u662f\uff0cSimpleKV \u53ea\u662f\u5468\u671f\u6027\u5730\u628a\u5185\u5b58\u4e2d\u7684\u952e\u503c\u6570\u636e\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u9891\u7e41\u5199\u76d8\u64cd\u4f5c\u7684\u6027\u80fd\u5f71\u54cd\u3002\u4f46\u662f\uff0c\u4e00\u4e2a\u6f5c\u5728\u7684\u4ee3\u4ef7\u662f SimpleKV \u7684\u6570\u636e\u4ecd\u7136\u6709\u4e22\u5931\u7684\u98ce\u9669\u3002 7\u3001\u672c\u8282\u5c0f\u7ed3 \u81f3\u6b64\uff0c\u6211\u4eec\u6784\u9020\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u952e\u503c\u6570\u636e\u5e93 SimpleKV\u3002 \u4e3a\u4e86\u652f\u6301\u66f4\u52a0\u4e30\u5bcc\u7684\u4e1a\u52a1\u573a\u666f\uff0cRedis \u5bf9\u8fd9\u4e9b\u7ec4\u4ef6\u6216\u8005\u529f\u80fd\u8fdb\u884c\u4e86\u6269\u5c55\uff0c\u6216\u8005\u8bf4\u662f\u8fdb\u884c\u4e86\u7cbe\u7ec6\u4f18\u5316\uff0c\u4ece\u800c\u6ee1\u8db3\u4e86\u529f\u80fd\u548c\u6027\u80fd\u7b49\u65b9\u9762\u7684\u8981\u6c42\u3002 \u4ece\u8fd9\u5f20\u5bf9\u6bd4\u56fe\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u4ece SimpleKV \u6f14\u8fdb\u5230 Redis\uff0c\u6709\u4ee5\u4e0b\u51e0\u4e2a\u91cd\u8981\u53d8\u5316\uff1a Redis \u4e3b\u8981\u901a\u8fc7\u7f51\u7edc\u6846\u67b6\u8fdb\u884c\u8bbf\u95ee\uff0c\u800c\u4e0d\u518d\u662f\u52a8\u6001\u5e93\u4e86 \uff0c\u8fd9\u4e5f\u4f7f\u5f97 Redis \u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u57fa\u7840\u6027\u7684\u7f51\u7edc\u670d\u52a1\u8fdb\u884c\u8bbf\u95ee\uff0c\u6269\u5927\u4e86 Redis \u7684\u5e94\u7528\u8303\u56f4\u3002 Redis \u6570\u636e\u6a21\u578b\u4e2d\u7684 value \u7c7b\u578b\u5f88\u4e30\u5bcc\uff0c\u56e0\u6b64\u4e5f\u5e26\u6765\u4e86\u66f4\u591a\u7684\u64cd\u4f5c\u63a5\u53e3\uff0c\u4f8b\u5982\u9762\u5411\u5217\u8868\u7684 LPUSH/LPOP\uff0c\u9762\u5411\u96c6\u5408\u7684 SADD/SREM \u7b49\u3002 Redis \u7684\u6301\u4e45\u5316\u6a21\u5757\u80fd\u652f\u6301\u4e24\u79cd\u65b9\u5f0f\uff1a\u65e5\u5fd7\uff08AOF\uff09\u548c\u5feb\u7167\uff08RDB\uff09 \uff0c\u8fd9\u4e24\u79cd\u6301\u4e45\u5316\u65b9\u5f0f\u5177\u6709\u4e0d\u540c\u7684\u4f18\u52a3\u52bf\uff0c\u5f71\u54cd\u5230 Redis \u7684\u8bbf\u95ee\u6027\u80fd\u548c\u53ef\u9760\u6027\u3002 SimpleKV \u662f\u4e2a\u7b80\u5355\u7684\u5355\u673a\u952e\u503c\u6570\u636e\u5e93\uff0c\u4f46\u662f\uff0cRedis \u652f\u6301\u9ad8\u53ef\u9760\u96c6\u7fa4\u548c\u9ad8\u53ef\u6269\u5c55\u96c6\u7fa4\uff0c\u56e0\u6b64\uff0cRedis \u4e2d\u5305\u542b\u4e86\u76f8\u5e94\u7684\u96c6\u7fa4\u529f\u80fd\u652f\u6491\u6a21\u5757\u3002","title":"\u7b2c\u4e00\u8282 \u57fa\u672c\u67b6\u6784\uff1a \u952e\u503c\u6570\u636e\u5e93"},{"location":"chap2/1redis_kv/#_1","text":"","title":"\u7b2c\u4e00\u8282 \u57fa\u672c\u67b6\u6784\uff1a \u952e\u503c\u6570\u636e\u5e93"},{"location":"chap2/1redis_kv/#1-simplekv","text":"\u6784\u9020 SimpleKV \u65f6\uff0c \u9996\u5148\u5c31\u8981\u8003\u8651\u91cc\u9762\u53ef\u4ee5\u5b58\u4ec0\u4e48\u6837\u7684\u6570\u636e\uff0c \u5bf9\u6570\u636e\u53ef\u4ee5\u505a\u4ec0\u4e48\u6837\u7684\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u6570\u636e\u6a21\u578b\u548c\u64cd\u4f5c\u63a5\u53e3 \u5b9e\u9645\u4e0a\u5374\u662f\u6211\u4eec\u7406\u89e3 Redis \u7ecf\u5e38\u88ab\u7528\u4e8e\u7f13\u5b58\u3001\u79d2\u6740\u3001\u5206\u5e03\u5f0f\u9501\u7b49\u573a\u666f\u7684\u91cd\u8981\u57fa\u7840\u3002 \u4f46\u662f\uff0c\u5982\u679c\u4f60\u8981\u5bf9\u591a\u4e2a\u7528\u6237\u7684\u5e74\u9f84\u8ba1\u7b97\u5747\u503c\uff0c\u952e\u503c\u6570\u636e\u5e93\u5c31\u65e0\u6cd5\u5b8c\u6210\u4e86\u3002\u56e0\u4e3a\u5b83\u53ea\u63d0\u4f9b\u7b80\u5355\u7684\u64cd\u4f5c\u63a5\u53e3\uff0c\u65e0\u6cd5\u652f\u6301\u590d\u6742\u7684\u805a\u5408\u8ba1\u7b97","title":"1\u3001\u6784\u5efa\u7b80\u5355\u7684\u952e\u503c\u6570\u636e\u5e93\u79f0 SimpleKV"},{"location":"chap2/1redis_kv/#2","text":"\u5bf9\u4e8e\u952e\u503c\u6570\u636e\u5e93\u800c\u8a00\uff0c\u57fa\u672c\u7684\u6570\u636e\u6a21\u578b\u662f key-value \u6a21\u578b\u3002 \u4f8b\u5982\uff0c\u201chello\u201d: \u201cworld\u201d\u5c31\u662f\u4e00\u4e2a\u57fa\u672c\u7684 KV \u5bf9\uff0c\u5176\u4e2d\uff0c\u201chello\u201d\u662f key\uff0c\u201cworld\u201d\u662f value\u3002SimpleKV \u4e5f\u4e0d\u4f8b\u5916\u3002 \u5728 SimpleKV \u4e2d\uff0ckey \u662f String \u7c7b\u578b\uff0c\u800c value \u662f\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff0c\u4f8b\u5982 String\u3001\u6574\u578b\u7b49\u3002\u4f46\u662f\uff0cSimpleKV \u6bd5\u7adf\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u952e\u503c\u6570\u636e\u5e93\uff0c\u5bf9\u4e8e\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e2d\u7684\u952e\u503c\u6570\u636e\u5e93\u6765\u8bf4\uff0cvalue \u7c7b\u578b\u8fd8\u53ef\u4ee5\u662f\u590d\u6742\u7c7b\u578b\u3002 \u4e0d\u540c\u952e\u503c\u6570\u636e\u5e93\u652f\u6301\u7684 key \u7c7b\u578b\u4e00\u822c\u5dee\u5f02\u4e0d\u5927\uff0c\u800c value \u7c7b\u578b\u5219\u6709\u8f83\u5927\u5dee\u522b\u3002\u6211\u4eec\u5728\u5bf9\u952e\u503c\u6570\u636e\u5e93\u8fdb\u884c\u9009\u578b\u65f6\uff0c \u4e00\u4e2a\u91cd\u8981\u7684\u8003\u8651\u56e0\u7d20\u662f\u5b83\u652f\u6301\u7684 value \u7c7b\u578b\u3002 \u4f8b\u5982\uff0c Memcached \u652f\u6301\u7684 value \u7c7b\u578b\u4ec5\u4e3a String \u7c7b\u578b\uff0c\u800c Redis \u652f\u6301\u7684 value \u7c7b\u578b\u5305\u62ec\u4e86 String\u3001\u54c8\u5e0c\u8868\u3001\u5217\u8868\u3001\u96c6\u5408\u7b49 \u3002 Redis \u80fd\u591f\u5728\u5b9e\u9645\u4e1a\u52a1\u573a\u666f\u4e2d\u5f97\u5230\u5e7f\u6cdb\u7684\u5e94\u7528\uff0c\u5c31\u662f\u5f97\u76ca\u4e8e\u652f\u6301\u591a\u6837\u5316\u7c7b\u578b\u7684 value\u3002","title":"2\u3001\u53ef\u4ee5\u5b58\u54ea\u4e9b\u6570\u636e\uff1f"},{"location":"chap2/1redis_kv/#3","text":"","title":"3\u3001\u53ef\u4ee5\u5bf9\u6570\u636e\u505a\u4ec0\u4e48\u64cd\u4f5c\uff1f"},{"location":"chap2/1redis_kv/#3-1-simplekv","text":"SimpleKV \u9700\u8981\u652f\u6301\u7684 3 \u79cd\u57fa\u672c\u64cd\u4f5c\uff0c\u5373 PUT\u3001GET \u548c DELETE\u3002 PUT\uff1a\u65b0\u5199\u5165\u6216\u66f4\u65b0\u4e00\u4e2a key-value \u5bf9\uff1b GET\uff1a\u6839\u636e\u4e00\u4e2a key \u8bfb\u53d6\u76f8\u5e94\u7684 value \u503c\uff1b DELETE\uff1a\u6839\u636e\u4e00\u4e2a key \u5220\u9664\u6574\u4e2a key-value \u5bf9\u3002 \u6709\u4e9b\u952e\u503c\u6570\u636e\u5e93\u7684\u65b0\u5199 / \u66f4\u65b0\u64cd\u4f5c\u53eb SET \u65b0\u5199\u5165\u548c\u66f4\u65b0\u867d\u7136\u662f\u7528\u4e00\u4e2a\u64cd\u4f5c\u63a5\u53e3\uff0c\u4f46\u5728\u5b9e\u9645\u6267\u884c\u65f6\uff0c\u4f1a\u6839\u636e key \u662f\u5426\u5b58\u5728\u800c\u6267\u884c\u76f8\u5e94\u7684\u65b0\u5199\u6216\u66f4\u65b0\u6d41\u7a0b\u3002 \u5728\u5b9e\u9645\u7684\u4e1a\u52a1\u573a\u666f\u4e2d. \u67e5\u8be2\u4e00\u4e2a\u7528\u6237\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\u7684\u8bbf\u95ee\u8bb0\u5f55\u3002\u8fd9\u79cd\u64cd\u4f5c\u5728\u952e\u503c\u6570\u636e\u5e93\u4e2d\u5c5e\u4e8e SCAN \u64cd\u4f5c\uff0c\u5373\u6839\u636e\u4e00\u6bb5 key \u7684\u8303\u56f4\u8fd4\u56de\u76f8\u5e94\u7684 value \u503c\u3002\u56e0\u6b64\uff0c PUT/GET/DELETE/SCAN \u662f\u4e00\u4e2a\u952e\u503c\u6570\u636e\u5e93\u7684\u57fa\u672c\u64cd\u4f5c\u96c6\u5408\u3002 \u5b9e\u9645\u4e1a\u52a1\u573a\u666f\u901a\u5e38\u8fd8\u6709\u66f4\u52a0\u4e30\u5bcc\u7684\u9700\u6c42\uff0c\u4f8b\u5982\uff0c \u5728\u9ed1\u767d\u540d\u5355\u5e94\u7528\u4e2d\uff0c\u9700\u8981\u5224\u65ad\u67d0\u4e2a\u7528\u6237\u662f\u5426\u5b58\u5728\u3002\u5982\u679c\u5c06\u8be5\u7528\u6237\u7684 ID \u4f5c\u4e3a key\uff0c\u90a3\u4e48\uff0c\u53ef\u4ee5\u589e\u52a0 EXISTS \u64cd\u4f5c\u63a5\u53e3\uff0c\u7528\u4e8e\u5224\u65ad\u67d0\u4e2a key \u662f\u5426\u5b58\u5728 \u5f53\u4e00\u4e2a\u952e\u503c\u6570\u636e\u5e93\u7684 value \u7c7b\u578b\u591a\u6837\u5316\u65f6\uff0c\u5c31\u9700\u8981\u5305\u542b\u76f8\u5e94\u7684\u64cd\u4f5c\u63a5\u53e3\u3002 \u4f8b\u5982\uff0cRedis \u7684 value \u6709\u5217\u8868\u7c7b\u578b\uff0c\u56e0\u6b64\u5b83\u7684\u63a5\u53e3\u5c31\u8981\u5305\u62ec\u5bf9\u5217\u8868 value \u7684\u64cd\u4f5c\u3002","title":"3-1 SimpleKV\u7684\u64cd\u4f5c"},{"location":"chap2/1redis_kv/#3-2","text":"\u4fdd\u5b58\u5728\u5185\u5b58\u7684\u597d\u5904\u662f\u8bfb\u5199\u5f88\u5feb\uff0c\u6bd5\u7adf\u5185\u5b58\u7684\u8bbf\u95ee\u901f\u5ea6\u4e00\u822c\u90fd\u5728\u767e ns \u7ea7\u522b\u3002\u4f46\u662f\uff0c\u6f5c\u5728\u7684\u98ce\u9669\u662f\u4e00\u65e6\u6389\u7535\uff0c\u6240\u6709\u7684\u6570\u636e\u90fd\u4f1a\u4e22\u5931\u3002 \u4fdd\u5b58\u5728\u5916\u5b58\uff0c\u867d\u7136\u53ef\u4ee5\u907f\u514d\u6570\u636e\u4e22\u5931\uff0c\u4f46\u662f\u53d7\u9650\u4e8e\u78c1\u76d8\u7684\u6162\u901f\u8bfb\u5199\uff08\u901a\u5e38\u5728\u51e0 ms \u7ea7\u522b\uff09\uff0c\u952e\u503c\u6570\u636e\u5e93\u7684\u6574\u4f53\u6027\u80fd\u4f1a\u88ab\u62c9\u4f4e\u3002 \u770b\u9700\u8981\u573a\u666f\uff1b\u4f5c\u4e3a\u7f13\u5b58\uff0c\u80fd\u591f\u63a5\u6536\u6570\u636e\u4e22\u5931\uff0c\u5219\u7528\u5185\u5b58\uff1b\u4e0d\u80fd\u63a5\u53d7\u6570\u636e\u4e22\u5931\uff0c\u6027\u80fd\u8981\u6c42\u4e0d\u8981\uff0c\u7528\u5916\u5b58\u3002 \u5982\u4f55\u8fdb\u884c\u8bbe\u8ba1\u9009\u62e9\uff0c\u6211\u4eec\u901a\u5e38\u9700\u8981\u8003\u8651\u952e\u503c\u6570\u636e\u5e93\u7684\u4e3b\u8981\u5e94\u7528\u573a\u666f \u7f13\u5b58\u573a\u666f\u4e0b\u7684\u6570\u636e\u9700\u8981\u80fd\u5feb\u901f\u8bbf\u95ee\u4f46\u5141\u8bb8\u4e22\u5931\uff0c\u90a3\u4e48\uff0c\u7528\u4e8e\u6b64\u573a\u666f\u7684\u952e\u503c\u6570\u636e\u5e93\u901a\u5e38\u91c7\u7528\u5185\u5b58\u4fdd\u5b58\u952e\u503c\u6570\u636e\u3002Memcached \u548c Redis \u90fd\u662f\u5c5e\u4e8e\u5185\u5b58\u952e\u503c\u6570\u636e\u5e93\u3002\u5bf9\u4e8e Redis \u800c\u8a00\uff0c\u7f13\u5b58\u662f\u975e\u5e38\u91cd\u8981\u7684\u4e00\u4e2a\u5e94\u7528\u573a\u666f\u3002 \u5927\u4f53\u6765\u8bf4\uff0c\u4e00\u4e2a\u952e\u503c\u6570\u636e\u5e93\u5305\u62ec\u4e86 \u8bbf\u95ee\u6846\u67b6\u3001\u7d22\u5f15\u6a21\u5757\u3001\u64cd\u4f5c\u6a21\u5757\u548c\u5b58\u50a8\u6a21\u5757 \u56db\u90e8\u5206\uff08\u89c1\u4e0b\u56fe\uff09","title":"3-2 \u952e\u503c\u5bf9\u4fdd\u5b58\u5728\u5185\u5b58\u8fd8\u662f\u5916\u5b58"},{"location":"chap2/1redis_kv/#4","text":"\u8bbf\u95ee\u6a21\u5f0f\u901a\u5e38\u6709\u4e24\u79cd\uff1a \u4e00\u79cd\u662f\u901a\u8fc7 \u51fd\u6570\u5e93\u8c03\u7528\u7684\u65b9\u5f0f\u4f9b\u5916\u90e8\u5e94\u7528\u4f7f\u7528 \uff0c\u6bd4\u5982\uff0c\u4e0a\u56fe\u4e2d\u7684 libsimplekv.so \uff0c\u5c31\u662f\u4ee5 \u52a8\u6001\u94fe\u63a5\u5e93\u7684\u5f62\u5f0f\u94fe\u63a5\u5230\u6211\u4eec\u81ea\u5df1\u7684\u7a0b\u5e8f\u4e2d \uff0c\u63d0\u4f9b\u952e\u503c\u5b58\u50a8\u529f\u80fd\uff1b \u4e00\u79cd\u662f\u901a\u8fc7 \u7f51\u7edc\u6846\u67b6\u4ee5 Socket \u901a\u4fe1\u7684\u5f62\u5f0f\u5bf9\u5916\u63d0\u4f9b\u952e\u503c\u5bf9\u64cd\u4f5c \uff0c\u8fd9\u79cd\u5f62\u5f0f\u53ef\u4ee5\u63d0\u4f9b\u5e7f\u6cdb\u7684\u952e\u503c\u5b58\u50a8\u670d\u52a1\u3002\u7f51\u7edc\u6846\u67b6\u4e2d\u5305\u62ec Socket Server \u548c\u534f\u8bae\u89e3\u6790\u3002 \u5b9e\u9645\u7684\u952e\u503c\u6570\u636e\u5e93\u4e5f\u57fa\u672c\u91c7\u7528\u4e0a\u8ff0\u4e24\u79cd\u65b9\u5f0f\uff0c\u4f8b\u5982\uff0cRocksDB \u4ee5\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u5f62\u5f0f\u4f7f\u7528\uff0c\u800c Memcached \u548c Redis \u5219\u662f\u901a\u8fc7\u7f51\u7edc\u6846\u67b6\u8bbf\u95ee \u901a\u8fc7\u7f51\u7edc\u6846\u67b6\u63d0\u4f9b\u952e\u503c\u5b58\u50a8\u670d\u52a1\uff0c\u4e00\u65b9\u9762\u6269\u5927\u4e86\u952e\u503c\u6570\u636e\u5e93\u7684\u53d7\u7528\u9762\uff0c\u4f46\u53e6\u4e00\u65b9\u9762\uff0c\u4e5f\u7ed9\u952e\u503c\u6570\u636e\u5e93\u7684\u6027\u80fd\u3001\u8fd0\u884c\u6a21\u578b\u63d0\u4f9b\u4e86\u4e0d\u540c\u7684\u8bbe\u8ba1\u9009\u62e9\uff0c\u5e26\u6765\u4e86\u4e00\u4e9b\u6f5c\u5728\u7684\u95ee\u9898\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5f53\u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u4e2a\u5982\u4e0b\u7684\u547d\u4ee4\u540e\uff0c\u8be5\u547d\u4ee4\u4f1a\u88ab\u5c01\u88c5\u5728\u7f51\u7edc\u5305\u4e2d\u53d1\u9001\u7ed9\u952e\u503c\u6570\u636e\u5e93\uff1a PUT hello world","title":"4\u3001\u91c7\u7528\u4ec0\u4e48\u8bbf\u95ee\u6a21\u5f0f\uff1f"},{"location":"chap2/1redis_kv/#5","text":"\u5f53 SimpleKV \u89e3\u6790\u4e86\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u8bf7\u6c42\uff0c\u77e5\u9053\u4e86\u8981\u8fdb\u884c\u7684\u952e\u503c\u5bf9\u64cd\u4f5c\uff0c\u6b64\u65f6\uff0cSimpleKV \u9700\u8981\u67e5\u627e\u6240\u8981\u64cd\u4f5c\u7684\u952e\u503c\u5bf9\u662f\u5426\u5b58\u5728\uff0c\u8fd9\u4f9d\u8d56\u4e8e\u952e\u503c\u6570\u636e\u5e93\u7684\u7d22\u5f15\u6a21\u5757\u3002 \u7d22\u5f15\u7684\u4f5c\u7528\u662f\u8ba9\u952e\u503c\u6570\u636e\u5e93\u6839\u636e key \u627e\u5230\u76f8\u5e94 value \u7684\u5b58\u50a8\u4f4d\u7f6e\uff0c\u8fdb\u800c\u6267\u884c\u64cd\u4f5c\u3002 \u7d22\u5f15\u7684\u7c7b\u578b\u6709\u5f88\u591a\uff0c\u5e38\u89c1\u7684\u6709\u54c8\u5e0c\u8868\u3001B+ \u6811\u3001\u5b57\u5178\u6811\u7b49\u3002\u4e0d\u540c\u7684\u7d22\u5f15\u7ed3\u6784\u5728\u6027\u80fd\u3001\u7a7a\u95f4\u6d88\u8017\u3001\u5e76\u53d1\u63a7\u5236\u7b49\u65b9\u9762\u5177\u6709\u4e0d\u540c\u7684\u7279\u5f81\u3002 \u4e0d\u540c\u952e\u503c\u6570\u636e\u5e93\u91c7\u7528\u7684\u7d22\u5f15\u5e76\u4e0d\u76f8\u540c \uff0c\u4f8b\u5982\uff0cMemcached \u548c Redis \u91c7\u7528\u54c8\u5e0c\u8868\u4f5c\u4e3a key-value \u7d22\u5f15\uff0c\u800c RocksDB \u5219\u91c7\u7528\u8df3\u8868\u4f5c\u4e3a\u5185\u5b58\u4e2d key-value \u7684\u7d22\u5f15\u3002 \u5185\u5b58\u952e\u503c\u6570\u636e\u5e93\uff08\u4f8b\u5982 Redis\uff09\u91c7\u7528\u54c8\u5e0c\u8868\u4f5c\u4e3a\u7d22\u5f15\uff0c\u5f88\u5927\u4e00\u90e8\u5206\u539f\u56e0\u5728\u4e8e\uff0c \u5176\u952e\u503c\u6570\u636e\u57fa\u672c\u90fd\u662f\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u800c\u5185\u5b58\u7684\u9ad8\u6027\u80fd\u968f\u673a\u8bbf\u95ee\u7279\u6027\u53ef\u4ee5\u5f88\u597d\u5730\u4e0e\u54c8\u5e0c\u8868 O(1) \u7684\u64cd\u4f5c\u590d\u6742\u5ea6\u76f8\u5339\u914d\u3002","title":"5\u3001\u5982\u4f55\u5b9a\u4f4d\u952e\u503c\u5bf9\u7684\u4f4d\u7f6e\uff1f"},{"location":"chap2/1redis_kv/#6","text":"SimpleKV \u7684\u7d22\u5f15\u6a21\u5757\u8d1f\u8d23\u6839\u636e key \u627e\u5230\u76f8\u5e94\u7684 value \u7684\u5b58\u50a8\u4f4d\u7f6e\u3002\u5bf9\u4e8e\u4e0d\u540c\u7684\u64cd\u4f5c\u6765\u8bf4\uff0c\u627e\u5230\u5b58\u50a8\u4f4d\u7f6e\u4e4b\u540e\uff0c\u9700\u8981\u8fdb\u4e00\u6b65\u6267\u884c\u7684\u64cd\u4f5c\u7684\u5177\u4f53\u903b\u8f91\u4f1a\u6709\u6240\u5dee\u5f02\u3002 SimpleKV \u7684\u64cd\u4f5c\u6a21\u5757\u5c31\u5b9e\u73b0\u4e86\u4e0d\u540c\u64cd\u4f5c\u7684\u5177\u4f53\u903b\u8f91\uff1a \u5bf9\u4e8e GET/SCAN \u64cd\u4f5c\u800c\u8a00\uff0c\u6b64\u65f6\u6839\u636e value \u7684\u5b58\u50a8\u4f4d\u7f6e\u8fd4\u56de value \u503c\u5373\u53ef\uff1b \u5bf9\u4e8e PUT \u4e00\u4e2a\u65b0\u7684\u952e\u503c\u5bf9\u6570\u636e\u800c\u8a00\uff0cSimpleKV \u9700\u8981\u4e3a\u8be5\u952e\u503c\u5bf9\u5206\u914d\u5185\u5b58\u7a7a\u95f4\uff1b \u5bf9\u4e8e DELETE \u64cd\u4f5c\uff0cSimpleKV \u9700\u8981\u5220\u9664\u952e\u503c\u5bf9\uff0c\u5e76\u91ca\u653e\u76f8\u5e94\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u7531\u5206\u914d\u5668\u5b8c\u6210\u3002","title":"6\u3001\u4e0d\u540c\u64cd\u4f5c\u7684\u5177\u4f53\u903b\u8f91\u662f\u600e\u6837\u7684\uff1f"},{"location":"chap2/1redis_kv/#7","text":"SimpleKV \u91c7\u7528\u4e86\u5e38\u7528\u7684 \u5185\u5b58\u5206\u914d\u5668 glibc \u7684 malloc \u548c free \uff0c\u56e0\u6b64\uff0cSimpleKV \u5e76\u4e0d\u9700\u8981\u7279\u522b\u8003\u8651\u5185\u5b58\u7a7a\u95f4\u7684\u7ba1\u7406\u95ee\u9898\u3002 \u4f46\u662f\uff0c\u952e\u503c\u6570\u636e\u5e93\u7684\u952e\u503c\u5bf9\u901a\u5e38\u5927\u5c0f\u4e0d\u4e00\uff0cglibc \u7684\u5206\u914d\u5668\u5728\u5904\u7406\u968f\u673a\u7684\u5927\u5c0f\u5185\u5b58\u5757\u5206\u914d\u65f6\uff0c\u8868\u73b0\u5e76\u4e0d\u597d\u3002\u4e00\u65e6\u4fdd\u5b58\u7684\u952e\u503c\u5bf9\u6570\u636e\u89c4\u6a21\u8fc7\u5927\uff0c\u5c31\u53ef\u80fd\u4f1a\u9020\u6210\u8f83\u4e25\u91cd\u7684\u5185\u5b58\u788e\u7247\u95ee\u9898\u3002 malloc() \u5728\u8fd0\u884c\u671f\u52a8\u6001\u5206\u914d\u5206\u914d\u5185\u5b58, free() \u91ca\u653e\u7531\u5176\u5206\u914d\u7684\u5185\u5b58\u3002 \u5206\u914d\u5668\u662f\u952e\u503c\u6570\u636e\u5e93\u4e2d\u7684\u4e00\u4e2a\u5173\u952e\u56e0\u7d20 \u5bf9\u4e8e\u4ee5\u5185\u5b58\u5b58\u50a8\u4e3a\u4e3b\u7684 Redis \u800c\u8a00\uff0c\u8fd9\u70b9\u5c24\u4e3a\u91cd\u8981\u3002 SimpleKV \u867d\u7136\u4f9d\u8d56\u4e8e\u5185\u5b58\u4fdd\u5b58\u6570\u636e\uff0c\u63d0\u4f9b\u5feb\u901f\u8bbf\u95ee\uff0c\u4f46\u662f\uff0c\u6211\u4e5f\u5e0c\u671b SimpleKV \u91cd\u542f\u540e\u80fd\u5feb\u901f\u91cd\u65b0\u63d0\u4f9b\u670d\u52a1\uff0c\u6240\u4ee5\uff0c\u6211\u5728 SimpleKV \u7684\u5b58\u50a8\u6a21\u5757\u4e2d\u589e\u52a0\u4e86\u6301\u4e45\u5316\u529f\u80fd\u3002 SimpleKV \u76f4\u63a5\u91c7\u7528\u4e86\u6587\u4ef6\u5f62\u5f0f\uff0c\u5c06\u952e\u503c\u6570\u636e\u901a\u8fc7\u8c03\u7528\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u7684\u64cd\u4f5c\u63a5\u53e3\u4fdd\u5b58\u5728\u78c1\u76d8\u4e0a\u3002\u6b64\u65f6\uff0cSimpleKV \u53ea\u9700\u8981\u8003\u8651\u4f55\u65f6\u5c06\u5185\u5b58\u4e2d\u7684\u952e\u503c\u6570\u636e\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\uff0c\u5c31\u53ef\u4ee5\u4e86\u3002 \u4e00\u79cd\u65b9\u5f0f\u662f\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u952e\u503c\u5bf9\uff0cSimpleKV \u90fd\u5bf9\u5176\u8fdb\u884c\u843d\u76d8\u4fdd\u5b58\uff0c\u8fd9\u867d\u7136\u8ba9 SimpleKV \u7684\u6570\u636e\u66f4\u52a0\u53ef\u9760\uff0c\u4f46\u662f\uff0c\u56e0\u4e3a\u6bcf\u6b21\u90fd\u8981\u5199\u76d8\uff0cSimpleKV \u7684\u6027\u80fd\u4f1a\u53d7\u5230\u5f88\u5927\u5f71\u54cd\u3002 \u53e6\u4e00\u79cd\u65b9\u5f0f\u662f\uff0cSimpleKV \u53ea\u662f\u5468\u671f\u6027\u5730\u628a\u5185\u5b58\u4e2d\u7684\u952e\u503c\u6570\u636e\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u9891\u7e41\u5199\u76d8\u64cd\u4f5c\u7684\u6027\u80fd\u5f71\u54cd\u3002\u4f46\u662f\uff0c\u4e00\u4e2a\u6f5c\u5728\u7684\u4ee3\u4ef7\u662f SimpleKV \u7684\u6570\u636e\u4ecd\u7136\u6709\u4e22\u5931\u7684\u98ce\u9669\u3002","title":"7\u3001\u5982\u4f55\u5b9e\u73b0\u91cd\u542f\u540e\u5feb\u901f\u63d0\u4f9b\u670d\u52a1\uff1f"},{"location":"chap2/1redis_kv/#7_1","text":"\u81f3\u6b64\uff0c\u6211\u4eec\u6784\u9020\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u952e\u503c\u6570\u636e\u5e93 SimpleKV\u3002 \u4e3a\u4e86\u652f\u6301\u66f4\u52a0\u4e30\u5bcc\u7684\u4e1a\u52a1\u573a\u666f\uff0cRedis \u5bf9\u8fd9\u4e9b\u7ec4\u4ef6\u6216\u8005\u529f\u80fd\u8fdb\u884c\u4e86\u6269\u5c55\uff0c\u6216\u8005\u8bf4\u662f\u8fdb\u884c\u4e86\u7cbe\u7ec6\u4f18\u5316\uff0c\u4ece\u800c\u6ee1\u8db3\u4e86\u529f\u80fd\u548c\u6027\u80fd\u7b49\u65b9\u9762\u7684\u8981\u6c42\u3002 \u4ece\u8fd9\u5f20\u5bf9\u6bd4\u56fe\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u4ece SimpleKV \u6f14\u8fdb\u5230 Redis\uff0c\u6709\u4ee5\u4e0b\u51e0\u4e2a\u91cd\u8981\u53d8\u5316\uff1a Redis \u4e3b\u8981\u901a\u8fc7\u7f51\u7edc\u6846\u67b6\u8fdb\u884c\u8bbf\u95ee\uff0c\u800c\u4e0d\u518d\u662f\u52a8\u6001\u5e93\u4e86 \uff0c\u8fd9\u4e5f\u4f7f\u5f97 Redis \u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u57fa\u7840\u6027\u7684\u7f51\u7edc\u670d\u52a1\u8fdb\u884c\u8bbf\u95ee\uff0c\u6269\u5927\u4e86 Redis \u7684\u5e94\u7528\u8303\u56f4\u3002 Redis \u6570\u636e\u6a21\u578b\u4e2d\u7684 value \u7c7b\u578b\u5f88\u4e30\u5bcc\uff0c\u56e0\u6b64\u4e5f\u5e26\u6765\u4e86\u66f4\u591a\u7684\u64cd\u4f5c\u63a5\u53e3\uff0c\u4f8b\u5982\u9762\u5411\u5217\u8868\u7684 LPUSH/LPOP\uff0c\u9762\u5411\u96c6\u5408\u7684 SADD/SREM \u7b49\u3002 Redis \u7684\u6301\u4e45\u5316\u6a21\u5757\u80fd\u652f\u6301\u4e24\u79cd\u65b9\u5f0f\uff1a\u65e5\u5fd7\uff08AOF\uff09\u548c\u5feb\u7167\uff08RDB\uff09 \uff0c\u8fd9\u4e24\u79cd\u6301\u4e45\u5316\u65b9\u5f0f\u5177\u6709\u4e0d\u540c\u7684\u4f18\u52a3\u52bf\uff0c\u5f71\u54cd\u5230 Redis \u7684\u8bbf\u95ee\u6027\u80fd\u548c\u53ef\u9760\u6027\u3002 SimpleKV \u662f\u4e2a\u7b80\u5355\u7684\u5355\u673a\u952e\u503c\u6570\u636e\u5e93\uff0c\u4f46\u662f\uff0cRedis \u652f\u6301\u9ad8\u53ef\u9760\u96c6\u7fa4\u548c\u9ad8\u53ef\u6269\u5c55\u96c6\u7fa4\uff0c\u56e0\u6b64\uff0cRedis \u4e2d\u5305\u542b\u4e86\u76f8\u5e94\u7684\u96c6\u7fa4\u529f\u80fd\u652f\u6491\u6a21\u5757\u3002","title":"7\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap2/2redis_slowquery/","text":"\u7b2c\u4e8c\u8282 \u6570\u636e\u7ed3\u6784\uff1aRedis\u4e3a\u4ec0\u4e48\u90a3\u4e48\u5feb\uff1f Redis \u7684\u5feb\uff0c\u5230\u5e95\u662f\u5feb\u5728\u54ea\u91cc\u5462\uff1f\u5b9e\u9645\u4e0a\uff0c\u8fd9\u91cc\u6709\u4e00\u4e2a\u91cd\u8981\u7684\u8868\u73b0\uff1a \u5b83\u63a5\u6536\u5230\u4e00\u4e2a\u952e\u503c\u5bf9\u64cd\u4f5c\u540e\uff0c\u80fd\u4ee5\u5fae\u79d2\u7ea7\u522b\u7684\u901f\u5ea6\u627e\u5230\u6570\u636e\uff0c\u5e76\u5feb\u901f\u5b8c\u6210\u64cd\u4f5c\u3002 redis\u8868\u73b0\u7a81\u51fa\u7684\u539f\u56e0\uff1a 1\u3001\u5728\u5185\u5b58\u4e2d\u8fdb\u884c\u64cd\u4f5c 2\u3001\u9ad8\u6548\u7684\u6570\u636e\u7ed3\u6784 \u8fd9\u662f\u56e0\u4e3a\uff0c\u952e\u503c\u5bf9\u662f\u6309\u4e00\u5b9a\u7684\u6570\u636e\u7ed3\u6784\u6765\u7ec4\u7ec7\u7684\uff0c\u64cd\u4f5c\u952e\u503c\u5bf9\u6700\u7ec8\u5c31\u662f\u5bf9\u6570\u636e\u7ed3\u6784\u8fdb\u884c\u589e\u5220\u6539\u67e5\u64cd\u4f5c\uff0c\u6240\u4ee5\u9ad8\u6548\u7684\u6570\u636e\u7ed3\u6784\u662f Redis \u5feb\u901f\u5904\u7406\u6570\u636e\u7684\u57fa\u7840 Redis \u952e\u503c\u5bf9\u4e2d\u503c\u7684\u6570\u636e\u7c7b\u578b\u5305\u542b\uff1a String\uff08\u5b57\u7b26\u4e32\uff09\u3001List\uff08\u5217\u8868\uff09\u3001Hash\uff08\u54c8\u5e0c\uff09\u3001Set\uff08\u96c6\u5408\uff09\u548c Sorted Set\uff08\u6709\u5e8f\u96c6\u5408\uff09 \u7b80\u5355\u6765\u8bf4\uff0c\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u4e00\u5171\u6709 6 \u79cd\uff0c\u5206\u522b\u662f\u7b80 \u5355\u52a8\u6001\u5b57\u7b26\u4e32\u3001\u53cc\u5411\u94fe\u8868\u3001\u538b\u7f29\u5217\u8868\u3001\u54c8\u5e0c\u8868\u3001\u8df3\u8868\u548c\u6574\u6570\u6570\u7ec4 String \u7c7b\u578b\u7684\u5e95\u5c42\u5b9e\u73b0\u53ea\u6709\u4e00\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u4e5f\u5c31\u662f\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\u3002 \u800c List\u3001Hash\u3001Set \u548c Sorted Set \u8fd9\u56db\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u90fd\u6709\u4e24\u79cd\u5e95\u5c42\u5b9e\u73b0\u7ed3\u6784\u3002 \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c \u6211\u4eec\u4f1a\u628a\u8fd9\u56db\u79cd\u7c7b\u578b\u79f0\u4e3a\u96c6\u5408\u7c7b\u578b\uff0c\u5b83\u4eec\u7684\u7279\u70b9\u662f\u4e00\u4e2a\u952e\u5bf9\u5e94\u4e86\u4e00\u4e2a\u96c6\u5408\u7684\u6570\u636e \u3002 1\u3001\u952e\u548c\u503c\u7528\u4ec0\u4e48\u7ed3\u6784\u7ec4\u7ec7\uff1f \u4e3a\u4e86\u5b9e\u73b0\u4ece\u952e\u5230\u503c\u7684\u5feb\u901f\u8bbf\u95ee\uff0c Redis \u4f7f\u7528\u4e86\u4e00\u4e2a\u54c8\u5e0c\u8868\u6765\u4fdd\u5b58\u6240\u6709\u952e\u503c\u5bf9 \u3002 \u4e00\u4e2a\u54c8\u5e0c\u8868\uff0c\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u7684\u6bcf\u4e2a\u5143\u7d20\u79f0\u4e3a\u4e00\u4e2a\u54c8\u5e0c\u6876 \u4e00\u4e2a\u54c8\u5e0c\u8868\u662f\u7531\u591a\u4e2a\u54c8\u5e0c\u6876\u7ec4\u6210\u7684\uff0c \u6bcf\u4e2a\u54c8\u5e0c\u6876\u4e2d\u4fdd\u5b58\u4e86\u952e\u503c\u5bf9\u6570\u636e\u3002 \u5176\u5b9e\uff0c\u54c8\u5e0c\u6876\u4e2d\u7684\u5143\u7d20\u4fdd\u5b58\u7684\u5e76\u4e0d\u662f\u503c\u672c\u8eab\uff0c\u800c\u662f \u6307\u5411\u5177\u4f53\u503c\u7684\u6307\u9488 \u3002 \u4e0d\u7ba1\u503c\u662f String\uff0c\u8fd8\u662f\u96c6\u5408\u7c7b\u578b\uff0c \u54c8\u5e0c\u6876\u4e2d\u7684\u5143\u7d20\u90fd\u662f\u6307\u5411\u5b83\u4eec\u7684\u6307\u9488 \u3002 \u54c8\u5e0c\u6876\u4e2d\u7684 entry \u5143\u7d20\u4e2d\u4fdd\u5b58\u4e86 *key \u548c *value \u6307\u9488\uff0c \u5206\u522b\u6307\u5411\u4e86\u5b9e\u9645\u7684\u952e\u548c\u503c \uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u503c\u662f\u4e00\u4e2a\u96c6\u5408\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 *value \u6307\u9488\u88ab\u67e5\u627e\u5230\u3002 \u8fd9\u4e2a\u54c8\u5e0c\u8868\u4fdd\u5b58\u4e86\u6240\u6709\u7684\u952e\u503c\u5bf9\uff0c\u6240\u4ee5\uff0c\u6211\u4e5f\u628a\u5b83\u79f0\u4e3a \u5168\u5c40\u54c8\u5e0c\u8868\u3002 \u54c8\u5e0c\u8868\u7684\u6700\u5927\u597d\u5904\u5f88\u660e\u663e\uff0c\u5c31\u662f\u8ba9\u6211\u4eec\u53ef\u4ee5\u7528 O(1) \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u6765\u5feb\u901f\u67e5\u627e\u5230\u952e\u503c\u5bf9\u2014\u2014 \u6211\u4eec\u53ea\u9700\u8981\u8ba1\u7b97\u952e\u7684\u54c8\u5e0c\u503c\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053\u5b83\u6240\u5bf9\u5e94\u7684\u54c8\u5e0c\u6876\u4f4d\u7f6e\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u8bbf\u95ee\u76f8\u5e94\u7684 entry \u5143\u7d20\u3002 \u4e2a\u67e5\u627e\u8fc7\u7a0b\u4e3b\u8981\u4f9d\u8d56\u4e8e\u54c8\u5e0c\u8ba1\u7b97\uff0c\u548c\u6570\u636e\u91cf\u7684\u591a\u5c11\u5e76\u6ca1\u6709\u76f4\u63a5\u5173\u7cfb\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e0d\u7ba1\u54c8\u5e0c\u8868\u91cc\u6709 10 \u4e07\u4e2a\u952e\u8fd8\u662f 100 \u4e07\u4e2a\u952e\uff0c\u6211\u4eec\u53ea\u9700\u8981\u4e00\u6b21\u8ba1\u7b97\u5c31\u80fd\u627e\u5230\u76f8\u5e94\u7684\u952e\u3002 \u4f46\u662f\uff0c\u5f53\u4f60\u5f80 Redis \u4e2d\u5199\u5165\u5927\u91cf\u6570\u636e\u540e\uff0c\u5c31\u53ef\u80fd\u53d1\u73b0\u64cd\u4f5c\u6709\u65f6\u5019\u4f1a\u7a81\u7136\u53d8\u6162\u4e86\uff0c\u8fd9\u5176\u5b9e\u662f\u56e0\u4e3a\u4f60\u5ffd\u7565\u4e86\u4e00\u4e2a\u6f5c\u5728\u7684\u98ce\u9669\u70b9\uff0c \u90a3\u5c31\u662f\u54c8\u5e0c\u8868\u7684\u51b2\u7a81\u95ee\u9898\u548c rehash \u53ef\u80fd\u5e26\u6765\u7684\u64cd\u4f5c\u963b\u585e \u3002 2\u3001\u5982\u4f55\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\u7b49\u95ee\u9898 \u4f60\u5f80\u54c8\u5e0c\u8868\u4e2d\u5199\u5165\u66f4\u591a\u6570\u636e\u65f6\uff0c\u54c8\u5e0c\u51b2\u7a81\u662f\u4e0d\u53ef\u907f\u514d\u7684\u95ee\u9898\u3002 \u8fd9\u91cc\u7684\u54c8\u5e0c\u51b2\u7a81\uff0c\u4e5f\u5c31\u662f\u6307\uff0c\u4e24\u4e2a key \u7684\u54c8\u5e0c\u503c\u548c\u54c8\u5e0c\u6876\u8ba1\u7b97\u5bf9\u5e94\u5173\u7cfb\u65f6\uff0c\u6b63\u597d\u843d\u5728\u4e86\u540c\u4e00\u4e2a\u54c8\u5e0c\u6876\u4e2d \u3002 \u6bd5\u7adf\uff0c\u54c8\u5e0c\u6876\u7684\u4e2a\u6570\u901a\u5e38\u8981\u5c11\u4e8e key \u7684\u6570\u91cf\uff0c\u8fd9\u4e5f\u5c31\u662f\u8bf4\uff0c\u96be\u514d\u4f1a\u6709\u4e00\u4e9b key \u7684\u54c8\u5e0c\u503c\u5bf9\u5e94\u5230\u4e86\u540c\u4e00\u4e2a\u54c8\u5e0c\u6876\u4e2d\u3002 2-1 \u94fe\u5f0f\u54c8\u5e0c Redis \u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\u7684\u65b9\u5f0f\uff0c\u5c31\u662f\u94fe\u5f0f\u54c8\u5e0c \u3002 \u94fe\u5f0f\u54c8\u5e0c\u4e5f\u5f88\u5bb9\u6613\u7406\u89e3\uff0c\u5c31\u662f\u6307\u540c\u4e00\u4e2a\u54c8\u5e0c\u6876\u4e2d\u7684\u591a\u4e2a\u5143\u7d20\u7528\u4e00\u4e2a\u94fe\u8868\u6765\u4fdd\u5b58\uff0c\u5b83\u4eec\u4e4b\u95f4\u4f9d\u6b21\u7528\u6307\u9488\u8fde\u63a5\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff1aentry1\u3001entry2 \u548c entry3 \u90fd\u9700\u8981\u4fdd\u5b58\u5728\u54c8\u5e0c\u6876 3 \u4e2d\uff0c\u5bfc\u81f4\u4e86\u54c8\u5e0c\u51b2\u7a81\u3002 \u6b64\u65f6\uff0c entry1 \u5143\u7d20\u4f1a\u901a\u8fc7\u4e00\u4e2a *next \u6307\u9488\u6307\u5411 entry2 \uff0c\u540c\u6837\uff0c entry2 \u4e5f\u4f1a\u901a\u8fc7 *next \u6307\u9488\u6307\u5411 entry3\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u54c8\u5e0c\u6876 3 \u4e2d\u7684\u5143\u7d20\u6709 100 \u4e2a\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 entry \u5143\u7d20\u4e2d\u7684\u6307\u9488\uff0c\u628a\u5b83\u4eec\u8fde\u8d77\u6765\u3002\u8fd9\u5c31\u5f62\u6210\u4e86\u4e00\u4e2a\u94fe\u8868\uff0c\u4e5f\u53eb\u4f5c\u54c8\u5e0c\u51b2\u7a81\u94fe\u3002 \u4f46\u662f\uff0c\u8fd9\u91cc\u4f9d\u7136\u5b58\u5728\u4e00\u4e2a\u95ee\u9898\uff0c\u54c8\u5e0c\u51b2\u7a81\u94fe\u4e0a\u7684\u5143\u7d20\u53ea\u80fd\u901a\u8fc7\u6307\u9488\u9010\u4e00\u67e5\u627e\u518d\u64cd\u4f5c\u3002\u5982\u679c\u54c8\u5e0c\u8868\u91cc\u5199\u5165\u7684\u6570\u636e\u8d8a\u6765\u8d8a\u591a\uff0c\u54c8\u5e0c\u51b2\u7a81\u53ef\u80fd\u4e5f\u4f1a\u8d8a\u6765\u8d8a\u591a\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u67d0\u4e9b\u54c8\u5e0c\u51b2\u7a81\u94fe\u8fc7\u957f\uff0c\u8fdb\u800c\u5bfc\u81f4\u8fd9\u4e2a\u94fe\u4e0a\u7684\u5143\u7d20\u67e5\u627e\u8017\u65f6\u957f\uff0c\u6548\u7387\u964d\u4f4e\u3002 2-2 Rehash \u6240\u4ee5\uff0cRedis \u4f1a\u5bf9\u54c8\u5e0c\u8868\u505a rehash \u64cd\u4f5c\u3002 rehash \u4e5f\u5c31\u662f\u589e\u52a0\u73b0\u6709\u7684\u54c8\u5e0c\u6876\u6570\u91cf\uff0c\u8ba9\u9010\u6e10\u589e\u591a\u7684 entry \u5143\u7d20\u80fd\u5728\u66f4\u591a\u7684\u6876\u4e4b\u95f4\u5206\u6563\u4fdd\u5b58\uff0c\u51cf\u5c11\u5355\u4e2a\u6876\u4e2d\u7684\u5143\u7d20\u6570\u91cf\uff0c\u4ece\u800c\u51cf\u5c11\u5355\u4e2a\u6876\u4e2d\u7684\u51b2\u7a81\u3002 \u4e3a\u4e86\u4f7f rehash \u64cd\u4f5c\u66f4\u9ad8\u6548\uff0cRedis \u9ed8\u8ba4\u4f7f\u7528\u4e86\u4e24\u4e2a\u5168\u5c40\u54c8\u5e0c\u8868\uff1a\u54c8\u5e0c\u8868 1 \u548c\u54c8\u5e0c\u8868 2\u3002\u4e00\u5f00\u59cb\uff0c\u5f53\u4f60\u521a\u63d2\u5165\u6570\u636e\u65f6\uff0c\u9ed8\u8ba4\u4f7f\u7528\u54c8\u5e0c\u8868 1\uff0c\u6b64\u65f6\u7684\u54c8\u5e0c\u8868 2 \u5e76\u6ca1\u6709\u88ab\u5206\u914d\u7a7a\u95f4\u3002\u968f\u7740\u6570\u636e\u9010\u6b65\u589e\u591a\uff0cRedis \u5f00\u59cb\u6267\u884c rehash\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5206\u4e3a\u4e09\u6b65\uff1a \u7ed9\u54c8\u5e0c\u8868 2 \u5206\u914d\u66f4\u5927\u7684\u7a7a\u95f4\uff0c\u4f8b\u5982\u662f\u5f53\u524d\u54c8\u5e0c\u8868 1 \u5927\u5c0f\u7684\u4e24\u500d\uff1b \u628a\u54c8\u5e0c\u8868 1 \u4e2d\u7684\u6570\u636e\u91cd\u65b0\u6620\u5c04\u5e76\u62f7\u8d1d\u5230\u54c8\u5e0c\u8868 2 \u4e2d\uff1b \u91ca\u653e\u54c8\u5e0c\u8868 1 \u7684\u7a7a\u95f4\u3002 \u5230\u6b64\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4ece\u54c8\u5e0c\u8868 1 \u5207\u6362\u5230\u54c8\u5e0c\u8868 2\uff0c\u7528\u589e\u5927\u7684\u54c8\u5e0c\u8868 2 \u4fdd\u5b58\u66f4\u591a\u6570\u636e\uff0c\u800c\u539f\u6765\u7684\u54c8\u5e0c\u8868 1 \u7559\u4f5c\u4e0b\u4e00\u6b21 rehash \u6269\u5bb9\u5907\u7528\u3002 2-3 \u6e10\u8fdb\u5f0f rehash \u8fd9\u4e2a\u8fc7\u7a0b\u770b\u4f3c\u7b80\u5355\uff0c\u4f46\u662f\u7b2c\u4e8c\u6b65\u6d89\u53ca\u5927\u91cf\u7684\u6570\u636e\u62f7\u8d1d\uff0c \u5982\u679c\u4e00\u6b21\u6027\u628a\u54c8\u5e0c\u8868 1 \u4e2d\u7684\u6570\u636e\u90fd\u8fc1\u79fb\u5b8c\uff0c\u4f1a\u9020\u6210 Redis \u7ebf\u7a0b\u963b\u585e\uff0c\u65e0\u6cd5\u670d\u52a1\u5176\u4ed6\u8bf7\u6c42 \u3002\u6b64\u65f6\uff0cRedis \u5c31\u65e0\u6cd5\u5feb\u901f\u8bbf\u95ee\u6570\u636e\u4e86\u3002 \u4e3a\u4e86\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\uff0cRedis \u91c7\u7528\u4e86\u6e10\u8fdb\u5f0f rehash\u3002 \u7b80\u5355\u6765\u8bf4\u5c31\u662f\u5728\u7b2c\u4e8c\u6b65\u62f7\u8d1d\u6570\u636e\u65f6\uff0cRedis \u4ecd\u7136\u6b63\u5e38\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u6bcf\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\u65f6\uff0c\u4ece\u54c8\u5e0c\u8868 1 \u4e2d\u7684\u7b2c\u4e00\u4e2a\u7d22\u5f15\u4f4d\u7f6e\u5f00\u59cb\uff0c\u987a\u5e26\u7740\u5c06\u8fd9\u4e2a\u7d22\u5f15\u4f4d\u7f6e\u4e0a\u7684\u6240\u6709 entries \u62f7\u8d1d\u5230\u54c8\u5e0c\u8868 2 \u4e2d\uff1b \u7b49\u5904\u7406\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u65f6\uff0c\u518d\u987a\u5e26\u62f7\u8d1d\u54c8\u5e0c\u8868 1 \u4e2d\u7684\u4e0b\u4e00\u4e2a\u7d22\u5f15\u4f4d\u7f6e\u7684 entries\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff1a \u8fd9\u6837\u5c31\u5de7\u5999\u5730\u628a\u4e00\u6b21\u6027\u5927\u91cf\u62f7\u8d1d\u7684\u5f00\u9500\uff0c\u5206\u644a\u5230\u4e86\u591a\u6b21\u5904\u7406\u8bf7\u6c42\u7684\u8fc7\u7a0b\u4e2d\uff0c\u907f\u514d\u4e86\u8017\u65f6\u64cd\u4f5c\uff0c\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u5feb\u901f\u8bbf\u95ee\u3002 \u5bf9\u4e8e String \u7c7b\u578b\u6765\u8bf4\uff0c\u627e\u5230\u54c8\u5e0c\u6876\u5c31\u80fd\u76f4\u63a5\u589e\u5220\u6539\u67e5\u4e86\uff0c \u6240\u4ee5\uff0c\u54c8\u5e0c\u8868\u7684 O(1) \u64cd\u4f5c\u590d\u6742\u5ea6\u4e5f\u5c31\u662f\u5b83\u7684\u590d\u6742\u5ea6\u4e86\u3002 \u4f46\u662f\uff0c\u5bf9\u4e8e\u96c6\u5408\u7c7b\u578b\u6765\u8bf4\uff0c\u5373\u4f7f\u627e\u5230\u54c8\u5e0c\u6876\u4e86\uff0c\u8fd8\u8981\u5728\u96c6\u5408\u4e2d\u518d\u8fdb\u4e00\u6b65\u64cd\u4f5c\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6765\u770b\u96c6\u5408\u7c7b\u578b\u7684\u64cd\u4f5c\u6548\u7387\u53c8\u662f\u600e\u6837\u7684\u3002 3\u3001\u96c6\u5408\u6570\u636e\u64cd\u4f5c\u6548\u7387 \u548c String \u7c7b\u578b\u4e0d\u540c\uff0c\u4e00\u4e2a\u96c6\u5408\u7c7b\u578b\u7684\u503c \uff0c \u7b2c\u4e00\u6b65\u662f\u901a\u8fc7\u5168\u5c40\u54c8\u5e0c\u8868\u627e\u5230\u5bf9\u5e94\u7684\u54c8\u5e0c\u6876\u4f4d\u7f6e\uff0c \u7b2c\u4e8c\u6b65\u662f\u5728\u96c6\u5408\u4e2d\u518d\u589e\u5220\u6539\u67e5\u3002 \u96c6\u5408\u7684\u64cd\u4f5c\u6548\u7387\u548c\u54ea\u4e9b\u56e0\u7d20\u76f8\u5173\u5462\uff1f \u9996\u5148\uff0c\u4e0e\u96c6\u5408\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u6709\u5173\u3002\u4f8b\u5982\uff0c\u4f7f\u7528\u54c8\u5e0c\u8868\u5b9e\u73b0\u7684\u96c6\u5408\uff0c\u8981\u6bd4\u4f7f\u7528\u94fe\u8868\u5b9e\u73b0\u7684\u96c6\u5408\u8bbf\u95ee\u6548\u7387\u66f4\u9ad8\u3002 \u5176\u6b21\uff0c\u64cd\u4f5c\u6548\u7387\u548c\u8fd9\u4e9b\u64cd\u4f5c\u672c\u8eab\u7684\u6267\u884c\u7279\u70b9\u6709\u5173\uff0c\u6bd4\u5982\u8bfb\u5199\u4e00\u4e2a\u5143\u7d20\u7684\u64cd\u4f5c\u8981\u6bd4\u8bfb\u5199\u6240\u6709\u5143\u7d20\u7684\u6548\u7387\u9ad8\u3002 4\u3001\u6709\u54ea\u4e9b\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff1f \u96c6\u5408\u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u4e3b\u8981\u6709 5 \u79cd\uff1a\u6574\u6570\u6570\u7ec4\u3001\u53cc\u5411\u94fe\u8868\u3001\u54c8\u5e0c\u8868\u3001\u538b\u7f29\u5217\u8868\u548c\u8df3\u8868\u3002 \u6574\u6570\u6570\u7ec4\u548c\u53cc\u5411\u94fe\u8868\u4e5f\u5f88\u5e38\u89c1\uff0c\u5b83\u4eec\u7684\u64cd\u4f5c\u7279\u5f81\u90fd\u662f\u987a\u5e8f\u8bfb\u5199\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u6570\u7ec4\u4e0b\u6807\u6216\u8005\u94fe\u8868\u7684\u6307\u9488\u9010\u4e2a\u5143\u7d20\u8bbf\u95ee\uff0c \u64cd\u4f5c\u590d\u6742\u5ea6\u57fa\u672c\u662f O(N)\uff0c\u64cd\u4f5c\u6548\u7387\u6bd4\u8f83\u4f4e 4-1 \u538b\u7f29\u5217\u8868 \u538b\u7f29\u5217\u8868\u5b9e\u9645\u4e0a\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u90fd\u5bf9\u5e94\u4fdd\u5b58\u4e00\u4e2a\u6570\u636e\u3002 \u548c\u6570\u7ec4\u4e0d\u540c\u7684\u662f\uff0c\u538b\u7f29\u5217\u8868\u5728\u8868\u5934\u6709\u4e09\u4e2a\u5b57\u6bb5 zlbytes\u3001zltail \u548c zllen\uff0c\u5206\u522b\u8868\u793a\u5217\u8868\u957f\u5ea6\u3001\u5217\u8868\u5c3e\u7684\u504f\u79fb\u91cf\u548c\u5217\u8868\u4e2d\u7684 entry \u4e2a\u6570\uff1b\u538b\u7f29\u5217\u8868\u5728\u8868\u5c3e\u8fd8\u6709\u4e00\u4e2a zlend\uff0c\u8868\u793a\u5217\u8868\u7ed3\u675f\u3002 zlbytes\uff1a \u5217\u8868\u957f\u5ea6 zltail\uff1a \u5217\u8868\u5c3e\u7684\u504f\u79fb\u91cf zllen\uff1a \u5217\u8868\u4e2d\u7684 entry \u4e2a\u6570 \u538b\u7f29\u5217\u8868\u5728\u8868\u5c3e\u8fd8\u6709\u4e00\u4e2a zlend\uff1a \u8868\u7ed3\u675f \u5728\u538b\u7f29\u5217\u8868\u4e2d\uff0c\u5982\u679c\u6211\u4eec\u8981\u67e5\u627e\u5b9a\u4f4d\u7b2c\u4e00\u4e2a\u5143\u7d20\u548c\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u53ef\u4ee5\u901a\u8fc7\u8868\u5934\u4e09\u4e2a\u5b57\u6bb5\u7684\u957f\u5ea6\u76f4\u63a5\u5b9a\u4f4d\uff0c\u590d\u6742\u5ea6\u662f O(1) \u800c\u67e5\u627e\u5176\u4ed6\u5143\u7d20\u65f6\uff0c\u5c31\u6ca1\u6709\u8fd9\u4e48\u9ad8\u6548\u4e86\uff0c\u53ea\u80fd\u9010\u4e2a\u67e5\u627e\uff0c\u6b64\u65f6\u7684\u590d\u6742\u5ea6\u5c31\u662f O(N) \u4e86\u3002 4-2 \u8df3\u8868 \u6709\u5e8f\u94fe\u8868\u53ea\u80fd\u9010\u4e00\u67e5\u627e\u5143\u7d20\uff0c\u5bfc\u81f4\u64cd\u4f5c\u8d77\u6765\u975e\u5e38\u7f13\u6162\uff0c\u4e8e\u662f\u5c31\u51fa\u73b0\u4e86\u8df3\u8868\u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u8df3\u8868\u5728\u94fe\u8868\u7684\u57fa\u7840\u4e0a\uff0c\u589e\u52a0\u4e86\u591a\u7ea7\u7d22\u5f15\uff0c\u901a\u8fc7\u7d22\u5f15\u4f4d\u7f6e\u7684\u51e0\u4e2a\u8df3\u8f6c\uff0c\u5b9e\u73b0\u6570\u636e\u7684\u5feb\u901f\u5b9a\u4f4d \u5982\u679c\u6211\u4eec\u8981\u5728\u94fe\u8868\u4e2d\u67e5\u627e 33 \u8fd9\u4e2a\u5143\u7d20\uff0c\u53ea\u80fd\u4ece\u5934\u5f00\u59cb\u904d\u5386\u94fe\u8868\uff0c\u67e5\u627e 6 \u6b21\uff0c\u76f4\u5230\u627e\u5230 33 \u4e3a\u6b62\u3002\u6b64\u65f6\uff0c\u590d\u6742\u5ea6\u662f O(N)\uff0c\u67e5\u627e\u6548\u7387\u5f88\u4f4e\u3002 \u4e3a\u4e86\u63d0\u9ad8\u67e5\u627e\u901f\u5ea6\uff0c\u6211\u4eec\u6765\u589e\u52a0\u4e00\u7ea7\u7d22\u5f15 \u4ece\u7b2c\u4e00\u4e2a\u5143\u7d20\u5f00\u59cb\uff0c\u6bcf\u4e24\u4e2a\u5143\u7d20\u9009\u4e00\u4e2a\u51fa\u6765\u4f5c\u4e3a\u7d22\u5f15\u3002\u8fd9\u4e9b\u7d22\u5f15\u518d\u901a\u8fc7\u6307\u9488\u6307\u5411\u539f\u59cb\u7684\u94fe\u8868\u3002 \u4f8b\u5982\uff0c\u4ece\u524d\u4e24\u4e2a\u5143\u7d20\u4e2d\u62bd\u53d6\u5143\u7d20 1 \u4f5c\u4e3a\u4e00\u7ea7\u7d22\u5f15\uff0c\u4ece\u7b2c\u4e09\u3001\u56db\u4e2a\u5143\u7d20\u4e2d\u62bd\u53d6\u5143\u7d20 11 \u4f5c\u4e3a\u4e00\u7ea7\u7d22\u5f15\u3002\u6b64\u65f6\uff0c\u6211\u4eec\u53ea\u9700\u8981 4 \u6b21\u67e5\u627e\u5c31\u80fd\u5b9a\u4f4d\u5230\u5143\u7d20 33 \u4e86\u3002 \u5982\u679c\u6211\u4eec\u8fd8\u60f3\u518d\u5feb\uff0c\u53ef\u4ee5\u518d\u589e\u52a0\u4e8c\u7ea7\u7d22\u5f15 \u4ece\u4e00\u7ea7\u7d22\u5f15\u4e2d\uff0c\u518d\u62bd\u53d6\u90e8\u5206\u5143\u7d20\u4f5c\u4e3a\u4e8c\u7ea7\u7d22\u5f15\u3002 \u4f8b\u5982\uff0c\u4ece\u4e00\u7ea7\u7d22\u5f15\u4e2d\u62bd\u53d6 1\u300127\u3001100 \u4f5c\u4e3a\u4e8c\u7ea7\u7d22\u5f15\uff0c\u4e8c\u7ea7\u7d22\u5f15\u6307\u5411\u4e00\u7ea7\u7d22\u5f15\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u53ea\u9700\u8981 3 \u6b21\u67e5\u627e\uff0c\u5c31\u80fd\u5b9a\u4f4d\u5230\u5143\u7d20 33 \u4e86\u3002 \u5f53\u6570\u636e\u91cf\u5f88\u5927\u65f6\uff0c\u8df3\u8868\u7684\u67e5\u627e\u590d\u6742\u5ea6\u5c31\u662f O(logN)\u3002 5\u3001\u4e0d\u540c\u64cd\u4f5c\u7684\u590d\u6742\u5ea6 \u96c6\u5408\u7c7b\u578b\u7684\u64cd\u4f5c\u7c7b\u578b\u5f88\u591a\uff0c\u6709\u8bfb\u5199\u5355\u4e2a\u96c6\u5408\u5143\u7d20\u7684\uff0c\u4f8b\u5982 HGET\u3001HSET\uff0c \u4e5f\u6709\u64cd\u4f5c\u591a\u4e2a\u5143\u7d20\u7684\uff0c\u4f8b\u5982 SADD\uff0c\u8fd8\u6709\u5bf9\u6574\u4e2a\u96c6\u5408\u8fdb\u884c\u904d\u5386\u64cd\u4f5c\u7684\uff0c\u4f8b\u5982 SMEMBERS\u3002 \u8fd9\u4e48\u591a\u64cd\u4f5c\uff0c\u5b83\u4eec\u7684\u590d\u6742\u5ea6\u4e5f\u5404\u4e0d\u76f8\u540c\u3002\u800c\u590d\u6742\u5ea6\u7684\u9ad8\u4f4e\u53c8\u662f\u6211\u4eec\u9009\u62e9\u96c6\u5408\u7c7b\u578b\u7684\u91cd\u8981\u4f9d\u636e\u3002 \u5355\u5143\u7d20\u64cd\u4f5c\u662f\u57fa\u7840\uff1b \u8303\u56f4\u64cd\u4f5c\u975e\u5e38\u8017\u65f6\uff1b \u7edf\u8ba1\u64cd\u4f5c\u901a\u5e38\u9ad8\u6548\uff1b \u4f8b\u5916\u60c5\u51b5\u53ea\u6709\u51e0\u4e2a\u3002 \u7b2c\u4e00\uff0c\u5355\u5143\u7d20\u64cd\u4f5c\uff0c\u662f\u6307\u6bcf\u4e00\u79cd\u96c6\u5408\u7c7b\u578b\u5bf9\u5355\u4e2a\u6570\u636e\u5b9e\u73b0\u7684\u589e\u5220\u6539\u67e5\u64cd\u4f5c\u3002 \u4f8b\u5982\uff0cHash \u7c7b\u578b\u7684 HGET\u3001HSET \u548c HDEL\uff0cSet \u7c7b\u578b\u7684 SADD\u3001SREM\u3001SRANDMEMBER \u7b49\u3002\u8fd9\u4e9b\u64cd\u4f5c\u7684\u590d\u6742\u5ea6\u7531\u96c6\u5408\u91c7\u7528\u7684\u6570\u636e\u7ed3\u6784\u51b3\u5b9a\uff0c \u4f8b\u5982\uff0cHGET\u3001HSET \u548c HDEL \u662f\u5bf9\u54c8\u5e0c\u8868\u505a\u64cd\u4f5c\uff0c\u6240\u4ee5\u5b83\u4eec\u7684\u590d\u6742\u5ea6\u90fd\u662f O(1)\uff1b Set \u7c7b\u578b\u7528\u54c8\u5e0c\u8868\u4f5c\u4e3a\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u65f6\uff0c\u5b83\u7684 SADD\u3001SREM\u3001SRANDMEMBER \u590d\u6742\u5ea6\u4e5f\u662f O(1)\u3002 \u96c6\u5408\u7c7b\u578b\u652f\u6301\u540c\u65f6\u5bf9\u591a\u4e2a\u5143\u7d20\u8fdb\u884c\u589e\u5220\u6539\u67e5\uff0c\u4f8b\u5982 Hash \u7c7b\u578b\u7684 HMGET \u548c HMSET\uff0cSet \u7c7b\u578b\u7684 SADD \u4e5f\u652f\u6301\u540c\u65f6\u589e\u52a0\u591a\u4e2a\u5143\u7d20\u3002 \u6b64\u65f6\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u7684\u590d\u6742\u5ea6\uff0c\u5c31\u662f\u7531\u5355\u4e2a\u5143\u7d20\u64cd\u4f5c\u590d\u6742\u5ea6\u548c\u5143\u7d20\u4e2a\u6570\u51b3\u5b9a\u7684\u3002\u4f8b\u5982\uff0cHMSET \u589e\u52a0 M \u4e2a\u5143\u7d20\u65f6\uff0c\u590d\u6742\u5ea6\u5c31\u4ece O(1) \u53d8\u6210 O(M) \u4e86\u3002 \u7b2c\u4e8c\uff0c\u8303\u56f4\u64cd\u4f5c\uff0c\u662f\u6307\u96c6\u5408\u7c7b\u578b\u4e2d\u7684\u904d\u5386\u64cd\u4f5c\uff0c\u53ef\u4ee5\u8fd4\u56de\u96c6\u5408\u4e2d\u7684\u6240\u6709\u6570\u636e \u6bd4\u5982 Hash \u7c7b\u578b\u7684 HGETALL \u548c Set \u7c7b\u578b\u7684 SMEMBERS \uff0c\u6216\u8005\u8fd4\u56de\u4e00\u4e2a\u8303\u56f4\u5185\u7684\u90e8\u5206\u6570\u636e\uff0c\u6bd4\u5982 List \u7c7b\u578b\u7684 LRANGE \u548c ZSet \u7c7b\u578b\u7684 ZRANGE \u3002 \u8fd9\u7c7b\u64cd\u4f5c\u7684\u590d\u6742\u5ea6\u4e00\u822c\u662f O(N)\uff0c\u6bd4\u8f83\u8017\u65f6\uff0c\u6211\u4eec\u5e94\u8be5\u5c3d\u91cf\u907f\u514d\u3002 Redis \u4ece 2.8 \u7248\u672c\u5f00\u59cb\u63d0\u4f9b\u4e86 SCAN \u7cfb\u5217\u64cd\u4f5c\uff08\u5305\u62ec HSCAN \uff0c SSCAN \u548c ZSCAN \uff09\uff0c\u8fd9\u7c7b\u64cd\u4f5c\u5b9e\u73b0\u4e86\u6e10\u8fdb\u5f0f\u904d\u5386\uff0c\u6bcf\u6b21\u53ea\u8fd4\u56de\u6709\u9650\u6570\u91cf\u7684\u6570\u636e\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u76f8\u6bd4\u4e8e HGETALL\u3001SMEMBERS \u8fd9\u7c7b\u64cd\u4f5c\u6765\u8bf4\uff0c\u5c31\u907f\u514d\u4e86\u4e00\u6b21\u6027\u8fd4\u56de\u6240\u6709\u5143\u7d20\u800c\u5bfc\u81f4\u7684 Redis \u963b\u585e\u3002 \u7b2c\u4e09\uff0c\u7edf\u8ba1\u64cd\u4f5c\uff0c\u662f\u6307\u96c6\u5408\u7c7b\u578b\u5bf9\u96c6\u5408\u4e2d\u6240\u6709\u5143\u7d20\u4e2a\u6570\u7684\u8bb0\u5f55 \u4f8b\u5982 LLEN \u548c SCARD\u3002 \u8fd9\u7c7b\u64cd\u4f5c\u590d\u6742\u5ea6\u53ea\u6709 O(1) \uff0c\u8fd9\u662f\u56e0\u4e3a\u5f53\u96c6\u5408\u7c7b\u578b\u91c7\u7528\u538b\u7f29\u5217\u8868\u3001\u53cc\u5411\u94fe\u8868\u3001\u6574\u6570\u6570\u7ec4\u8fd9\u4e9b\u6570\u636e\u7ed3\u6784\u65f6\uff0c\u8fd9\u4e9b\u7ed3\u6784\u4e2d\u4e13\u95e8\u8bb0\u5f55\u4e86\u5143\u7d20\u7684\u4e2a\u6570\u7edf\u8ba1\uff0c\u56e0\u6b64\u53ef\u4ee5\u9ad8\u6548\u5730\u5b8c\u6210\u76f8\u5173\u64cd\u4f5c\u3002 \u7b2c\u56db\uff0c\u4f8b\u5916\u60c5\u51b5\uff0c\u662f\u6307\u67d0\u4e9b\u6570\u636e\u7ed3\u6784\u7684\u7279\u6b8a\u8bb0\u5f55\uff0c\u4f8b\u5982\u538b\u7f29\u5217\u8868\u548c\u53cc\u5411\u94fe\u8868\u90fd\u4f1a\u8bb0\u5f55\u8868\u5934\u548c\u8868\u5c3e\u7684\u504f\u79fb\u91cf\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5bf9\u4e8e List \u7c7b\u578b\u7684 LPOP\u3001RPOP\u3001LPUSH\u3001RPUSH \u8fd9\u56db\u4e2a\u64cd\u4f5c\u6765\u8bf4\uff0c\u5b83\u4eec\u662f\u5728\u5217\u8868\u7684\u5934\u5c3e\u589e\u5220\u5143\u7d20\uff0c\u8fd9\u5c31\u53ef\u4ee5\u901a\u8fc7\u504f\u79fb\u91cf\u76f4\u63a5\u5b9a\u4f4d\uff0c\u6240\u4ee5\u5b83\u4eec\u7684\u590d\u6742\u5ea6\u4e5f\u53ea\u6709 O(1) \uff0c\u53ef\u4ee5\u5b9e\u73b0\u5feb\u901f\u64cd\u4f5c\u3002 6\u3001\u672c\u8282\u5c0f\u7ed3 Redis \u4e4b\u6240\u4ee5\u80fd\u5feb\u901f\u64cd\u4f5c\u952e\u503c\u5bf9\uff0c \u4e00\u65b9\u9762\u662f\u56e0\u4e3a O(1) \u590d\u6742\u5ea6\u7684\u54c8\u5e0c\u8868\u88ab\u5e7f\u6cdb\u4f7f\u7528\uff0c\u5305\u62ec String\u3001Hash \u548c Set\uff0c\u5b83\u4eec\u7684\u64cd\u4f5c\u590d\u6742\u5ea6\u57fa\u672c\u7531\u54c8\u5e0c\u8868\u51b3\u5b9a\uff0c\u53e6\u4e00\u65b9\u9762\uff0cSorted Set \u4e5f\u91c7\u7528\u4e86 O(logN) \u590d\u6742\u5ea6\u7684\u8df3\u8868\u3002 \u4e0d\u8fc7\uff0c\u96c6\u5408\u7c7b\u578b\u7684\u8303\u56f4\u64cd\u4f5c\uff0c\u56e0\u4e3a\u8981\u904d\u5386\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff0c\u590d\u6742\u5ea6\u901a\u5e38\u662f O(N) \u3002 \u8fd9\u91cc\uff0c\u6211\u7684\u5efa\u8bae\u662f\uff1a \u7528\u5176\u4ed6\u547d\u4ee4\u6765\u66ff\u4ee3\uff0c\u4f8b\u5982\u53ef\u4ee5\u7528 SCAN \u6765\u4ee3\u66ff\uff0c\u907f\u514d\u5728 Redis \u5185\u90e8\u4ea7\u751f\u8d39\u65f6\u7684\u5168\u96c6\u5408\u904d\u5386\u64cd\u4f5c\u3002 \u5f53\u7136\uff0c\u6211\u4eec\u4e0d\u80fd\u5fd8\u4e86\u590d\u6742\u5ea6\u8f83\u9ad8\u7684 List \u7c7b\u578b\uff0c\u5b83\u7684\u4e24\u79cd\u5e95\u5c42\u5b9e\u73b0\u7ed3\u6784\uff1a\u53cc\u5411\u94fe\u8868\u548c\u538b\u7f29\u5217\u8868\u7684\u64cd\u4f5c\u590d\u6742\u5ea6\u90fd\u662f O(N)\u3002\u56e0\u6b64\uff0c\u6211\u7684\u5efa\u8bae\u662f\uff1a \u56e0\u5730\u5236\u5b9c\u5730\u4f7f\u7528 List \u7c7b\u578b \u3002\u4f8b\u5982\uff0c\u65e2\u7136\u5b83\u7684 POP/PUSH \u6548\u7387\u5f88\u9ad8\uff0c\u90a3\u4e48\u5c31\u5c06\u5b83\u4e3b\u8981\u7528\u4e8e FIFO \u961f\u5217\u573a\u666f\uff0c\u800c\u4e0d\u662f\u4f5c\u4e3a\u4e00\u4e2a\u53ef\u4ee5\u968f\u673a\u8bfb\u5199\u7684\u96c6\u5408\u3002 6-1 \u8bb2\u4e86\u4ec0\u4e48\uff1f Redis\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784 Redis\u7684\u6570\u636e\u7ed3\u6784\uff1a\u6570\u636e\u7684\u4fdd\u5b58\u5f62\u5f0f\u4e0e\u5e95\u5c42\u6570\u636e\u7ed3\u6784 \u7531\u6570\u636e\u7ed3\u6784\u7684\u5f02\u540c\u70b9\uff0c\u5f15\u51fa\u6570\u636e\u64cd\u4f5c\u7684\u5feb\u6162\u539f\u56e0 6-1 \u8981\u70b9\u77e5\u8bc6 string\uff0clist\uff0cset\uff0chast, sortset\u90fd\u53ea\u662f\u6570\u636e\u7684\u4fdd\u5b58\u5f62\u5f0f \u5e95\u5c42\u7684\u6570\u636e\u7ed3\u6784\u662f\uff1a\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\uff0c\u53cc\u5411\u94fe\u8868\uff0c\u538b\u7f29\u5217\u8868\uff0c\u54c8\u5e0c\u8868\uff0c\u8df3\u8868\uff0c\u6574\u6570\u6570\u7ec4 Redis\u4f7f\u7528\u4e86\u4e00\u4e2a\u54c8\u5e0c\u8868\u4fdd\u5b58\u6240\u6709\u7684\u952e\u503c\u5bf9 \u4e94\u79cd\u6570\u636e\u5f62\u5f0f\u7684\u5e95\u5c42\u5b9e\u73b0 string\uff1a\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32 list\uff1a\u53cc\u5411\u94fe\u8868\uff0c\u538b\u7f29\u5217\u8868 hash\uff1a\u538b\u7f29\u5217\u8868\uff0c\u54c8\u5e0c\u8868 Sorted Set\uff1a\u538b\u7f29\u5217\u8868\uff0c\u8df3\u8868 set\uff1a\u54c8\u5e0c\u8868\uff0c\u6574\u6570\u6570\u7ec4 List ,hash\uff0cset ,sorted set \u88ab\u7edf\u79f0\u4e3a\u96c6\u5408\u7c7b\u578b\uff0c\u4e00\u4e2a\u952e\u5bf9\u5e94\u4e86\u4e00\u4e2a\u96c6\u5408\u7684\u6570\u636e \u96c6\u5408\u7c7b\u578b\u7684\u952e\u548c\u503c\u4e4b\u95f4\u7684\u7ed3\u6784\u7ec4\u7ec7 redis\u4f7f\u7528\u4e00\u4e2a\u54c8\u5e0c\u8868\u4fdd\u5b58\u6240\u6709\u952e\u503c\u5bf9\uff0c\u4e00\u4e2a\u54c8\u5e0c\u8868\u5b9e\u5219\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u7684\u6bcf\u4e2a\u5143\u7d20\u79f0\u4e3a\u54c8\u5e0c\u6876\u3002 \u54c8\u5e0c\u6876\u4e2d\u7684\u5143\u7d20\u4fdd\u5b58\u7684\u4e0d\u662f\u503c\u7684\u672c\u8eab\uff0c\u800c\u662f\u6307\u5411\u5177\u4f53\u503c\u7684\u6307\u9488 \u54c8\u5e0c\u51b2\u7a81\u89e3\u51b3 Redis\u7684hash\u8868\u662f\u5168\u5c40\u7684\uff0c\u6240\u4ee5\u5f53\u5199\u5165\u5927\u91cf\u7684key\u65f6\uff0c\u5c06\u4f1a\u5e26\u6765\u54c8\u5e0c\u51b2\u7a81\uff0c\u5df2\u7ecfrehash\u53ef\u80fd\u5e26\u6765\u7684\u64cd\u4f5c\u963b\u585e Redis\u89e3\u51b3hash\u51b2\u7a81\u7684\u65b9\u5f0f\uff0c\u662f\u94fe\u5f0f\u54c8\u5e0c\uff1a\u540c\u4e00\u4e2a\u54c8\u5e0c\u6876\u4e2d\u7684\u591a\u4e2a\u5143\u7d20\u7528\u4e00\u4e2a\u94fe\u8868\u6765\u4fdd\u5b58 \u5f53\u54c8\u5e0c\u51b2\u7a81\u94fe\u8fc7\u957f\u65f6\uff0cRedis\u4f1a\u5bf9hash\u8868\u8fdb\u884crehash\u64cd\u4f5c\u3002rehash\u5c31\u662f\u589e\u52a0\u73b0\u6709\u7684hash\u6876\u6570\u91cf\uff0c\u5206\u6563entry\u5143\u7d20\u3002 rehash\u673a\u5236 \u4e86\u4f7frehash\u64cd\u4f5c\u66f4\u9ad8\u6548\uff0cRedis\u9ed8\u8ba4\u4f7f\u7528\u4e86\u4e24\u4e2a\u5168\u5c40\u54c8\u5e0c\u8868\uff1a\u54c8\u5e0c\u88681\u548c\u54c8\u5e0c\u88682\uff0c\u8d77\u59cb\u65f6hash2\u6ca1\u6709\u5206\u914d\u7a7a\u95f4 \u968f\u7740\u6570\u636e\u589e\u591a\uff0cRedis\u6267\u884c\u5206\u4e09\u6b65\u6267\u884crehash; \u7ed9hash2\u5206\u914d\u66f4\u5927\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5982\u662fhash1\u7684\u4e24\u500d \u628ahash1\u4e2d\u7684\u6570\u636e\u91cd\u65b0\u6620\u5c04\u5e76\u62f7\u8d1d\u5230\u54c8\u5e0c\u88682\u4e2d \u91ca\u653ehash1\u7684\u7a7a\u95f4 \u6e10\u8fdb\u5f0frehash \u7531\u4e8e\u6b65\u9aa42\u91cd\u65b0\u6620\u5c04\u975e\u5e38\u8017\u65f6\uff0c\u4f1a\u963b\u585eredis \u8bb2\u96c6\u4e2d\u8fc1\u79fb\u6570\u636e\uff0c\u6539\u6210\u6bcf\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\u65f6\uff0c\u5c31\u4ecehash1\u4e2d\u7684\u7b2c\u4e00\u4e2a\u7d22\u5f15\u4f4d\u7f6e\uff0c\u987a\u5e26\u5c06\u8fd9\u4e2a\u7d22\u5f15\u4f4d\u7f6e\u4e0a\u7684\u6240\u6709entries\u62f7\u8d1d\u5230hash2\u4e2d\u3002 \u538b\u7f29\u5217\u8868\uff0c\u8df3\u8868\u7684\u7279\u70b9 \u538b\u7f29\u5217\u8868\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u6570\u7ec4\uff0c\u4e0d\u540c\u7684\u662f:\u538b\u7f29\u5217\u8868\u5728\u8868\u5934\u6709\u4e09\u4e2a\u5b57\u6bb5zlbytes,zltail\u548czllen\u5206\u522b\u8868\u793a\u957f\u5ea6\uff0c\u5217\u8868\u5c3e\u7684\u504f\u79fb\u91cf\u548c\u5217\u8868\u4e2d\u7684entry\u7684\u4e2a\u6570\uff0c\u538b\u7f29\u5217\u8868\u5c3e\u90e8\u8fd8\u6709\u4e00\u4e2azlend\uff0c\u8868\u793a\u5217\u8868\u7ed3\u675f\u6240\u4ee5\u538b\u7f29\u5217\u8868\u5b9a\u4f4d\u7b2c\u4e00\u4e2a\u548c\u6700\u540e\u4e00\u4e2a\u662fO(1),\u4f46\u5176\u4ed6\u5c31\u662fO(n) \u8df3\u8868\uff1a\u662f\u5728\u94fe\u8868\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u591a\u7ea7\u7d22\u5f15\uff0c\u901a\u8fc7\u7d22\u5f15\u7684\u51e0\u6b21\u8df3\u8f6c\uff0c\u5b9e\u73b0\u6570\u636e\u5feb\u901f\u5b9a\u4f4d \u63d0\u95ee \uff1a \u6574\u6570\u6570\u7ec4\u548c\u538b\u7f29\u5217\u8868\u5728\u67e5\u627e\u65f6\u95f4\u590d\u6742\u5ea6\u65b9\u9762\u5e76\u6ca1\u6709\u5f88\u5927\u7684\u4f18\u52bf\uff0c\u90a3\u4e3a\u4ec0\u4e48 Redis \u8fd8\u4f1a\u628a\u5b83\u4eec\u4f5c\u4e3a\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5462\uff1f \u5185\u5b58\u5229\u7528\u7387\uff0c\u6570\u7ec4\u548c\u538b\u7f29\u5217\u8868\u90fd\u662f\u975e\u5e38\u7d27\u51d1\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u6bd4\u94fe\u8868\u5360\u7528\u7684\u5185\u5b58\u8981\u66f4\u5c11\u3002Redis\u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u5927\u91cf\u6570\u636e\u5b58\u5230\u5185\u5b58\u4e2d\uff0c\u6b64\u65f6\u9700\u8981\u505a\u5c3d\u53ef\u80fd\u7684\u4f18\u5316\uff0c\u63d0\u9ad8\u5185\u5b58\u7684\u5229\u7528\u7387\u3002 \u6570\u7ec4\u5bf9CPU\u9ad8\u901f\u7f13\u5b58\u652f\u6301\u66f4\u53cb\u597d\uff0c\u6240\u4ee5Redis\u5728\u8bbe\u8ba1\u65f6\uff0c\u96c6\u5408\u6570\u636e\u5143\u7d20\u8f83\u5c11\u60c5\u51b5\u4e0b\uff0c\u9ed8\u8ba4\u91c7\u7528\u5185\u5b58\u7d27\u51d1\u6392\u5217\u7684\u65b9\u5f0f\u5b58\u50a8\uff0c\u540c\u65f6\u5229\u7528CPU\u9ad8\u901f\u7f13\u5b58\u4e0d\u4f1a\u964d\u4f4e\u8bbf\u95ee\u901f\u5ea6\u3002\u5f53\u6570\u636e\u5143\u7d20\u8d85\u8fc7\u8bbe\u5b9a\u9608\u503c\u540e\uff0c\u907f\u514d\u67e5\u8be2\u65f6\u95f4\u590d\u6742\u5ea6\u592a\u9ad8\uff0c\u8f6c\u4e3a\u54c8\u5e0c\u548c\u8df3\u8868\u6570\u636e\u7ed3\u6784\u5b58\u50a8\uff0c\u4fdd\u8bc1\u67e5\u8be2\u6548\u7387\u3002","title":"\u7b2c\u4e8c\u8282 \u6570\u636e\u7ed3\u6784\uff1aRedis\u4e3a\u4ec0\u4e48\u90a3\u4e48\u5feb\uff1f"},{"location":"chap2/2redis_slowquery/#redis","text":"Redis \u7684\u5feb\uff0c\u5230\u5e95\u662f\u5feb\u5728\u54ea\u91cc\u5462\uff1f\u5b9e\u9645\u4e0a\uff0c\u8fd9\u91cc\u6709\u4e00\u4e2a\u91cd\u8981\u7684\u8868\u73b0\uff1a \u5b83\u63a5\u6536\u5230\u4e00\u4e2a\u952e\u503c\u5bf9\u64cd\u4f5c\u540e\uff0c\u80fd\u4ee5\u5fae\u79d2\u7ea7\u522b\u7684\u901f\u5ea6\u627e\u5230\u6570\u636e\uff0c\u5e76\u5feb\u901f\u5b8c\u6210\u64cd\u4f5c\u3002 redis\u8868\u73b0\u7a81\u51fa\u7684\u539f\u56e0\uff1a 1\u3001\u5728\u5185\u5b58\u4e2d\u8fdb\u884c\u64cd\u4f5c 2\u3001\u9ad8\u6548\u7684\u6570\u636e\u7ed3\u6784 \u8fd9\u662f\u56e0\u4e3a\uff0c\u952e\u503c\u5bf9\u662f\u6309\u4e00\u5b9a\u7684\u6570\u636e\u7ed3\u6784\u6765\u7ec4\u7ec7\u7684\uff0c\u64cd\u4f5c\u952e\u503c\u5bf9\u6700\u7ec8\u5c31\u662f\u5bf9\u6570\u636e\u7ed3\u6784\u8fdb\u884c\u589e\u5220\u6539\u67e5\u64cd\u4f5c\uff0c\u6240\u4ee5\u9ad8\u6548\u7684\u6570\u636e\u7ed3\u6784\u662f Redis \u5feb\u901f\u5904\u7406\u6570\u636e\u7684\u57fa\u7840 Redis \u952e\u503c\u5bf9\u4e2d\u503c\u7684\u6570\u636e\u7c7b\u578b\u5305\u542b\uff1a String\uff08\u5b57\u7b26\u4e32\uff09\u3001List\uff08\u5217\u8868\uff09\u3001Hash\uff08\u54c8\u5e0c\uff09\u3001Set\uff08\u96c6\u5408\uff09\u548c Sorted Set\uff08\u6709\u5e8f\u96c6\u5408\uff09 \u7b80\u5355\u6765\u8bf4\uff0c\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u4e00\u5171\u6709 6 \u79cd\uff0c\u5206\u522b\u662f\u7b80 \u5355\u52a8\u6001\u5b57\u7b26\u4e32\u3001\u53cc\u5411\u94fe\u8868\u3001\u538b\u7f29\u5217\u8868\u3001\u54c8\u5e0c\u8868\u3001\u8df3\u8868\u548c\u6574\u6570\u6570\u7ec4 String \u7c7b\u578b\u7684\u5e95\u5c42\u5b9e\u73b0\u53ea\u6709\u4e00\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u4e5f\u5c31\u662f\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\u3002 \u800c List\u3001Hash\u3001Set \u548c Sorted Set \u8fd9\u56db\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u90fd\u6709\u4e24\u79cd\u5e95\u5c42\u5b9e\u73b0\u7ed3\u6784\u3002 \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c \u6211\u4eec\u4f1a\u628a\u8fd9\u56db\u79cd\u7c7b\u578b\u79f0\u4e3a\u96c6\u5408\u7c7b\u578b\uff0c\u5b83\u4eec\u7684\u7279\u70b9\u662f\u4e00\u4e2a\u952e\u5bf9\u5e94\u4e86\u4e00\u4e2a\u96c6\u5408\u7684\u6570\u636e \u3002","title":"\u7b2c\u4e8c\u8282 \u6570\u636e\u7ed3\u6784\uff1aRedis\u4e3a\u4ec0\u4e48\u90a3\u4e48\u5feb\uff1f"},{"location":"chap2/2redis_slowquery/#1","text":"\u4e3a\u4e86\u5b9e\u73b0\u4ece\u952e\u5230\u503c\u7684\u5feb\u901f\u8bbf\u95ee\uff0c Redis \u4f7f\u7528\u4e86\u4e00\u4e2a\u54c8\u5e0c\u8868\u6765\u4fdd\u5b58\u6240\u6709\u952e\u503c\u5bf9 \u3002 \u4e00\u4e2a\u54c8\u5e0c\u8868\uff0c\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u7684\u6bcf\u4e2a\u5143\u7d20\u79f0\u4e3a\u4e00\u4e2a\u54c8\u5e0c\u6876 \u4e00\u4e2a\u54c8\u5e0c\u8868\u662f\u7531\u591a\u4e2a\u54c8\u5e0c\u6876\u7ec4\u6210\u7684\uff0c \u6bcf\u4e2a\u54c8\u5e0c\u6876\u4e2d\u4fdd\u5b58\u4e86\u952e\u503c\u5bf9\u6570\u636e\u3002 \u5176\u5b9e\uff0c\u54c8\u5e0c\u6876\u4e2d\u7684\u5143\u7d20\u4fdd\u5b58\u7684\u5e76\u4e0d\u662f\u503c\u672c\u8eab\uff0c\u800c\u662f \u6307\u5411\u5177\u4f53\u503c\u7684\u6307\u9488 \u3002 \u4e0d\u7ba1\u503c\u662f String\uff0c\u8fd8\u662f\u96c6\u5408\u7c7b\u578b\uff0c \u54c8\u5e0c\u6876\u4e2d\u7684\u5143\u7d20\u90fd\u662f\u6307\u5411\u5b83\u4eec\u7684\u6307\u9488 \u3002 \u54c8\u5e0c\u6876\u4e2d\u7684 entry \u5143\u7d20\u4e2d\u4fdd\u5b58\u4e86 *key \u548c *value \u6307\u9488\uff0c \u5206\u522b\u6307\u5411\u4e86\u5b9e\u9645\u7684\u952e\u548c\u503c \uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u503c\u662f\u4e00\u4e2a\u96c6\u5408\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 *value \u6307\u9488\u88ab\u67e5\u627e\u5230\u3002 \u8fd9\u4e2a\u54c8\u5e0c\u8868\u4fdd\u5b58\u4e86\u6240\u6709\u7684\u952e\u503c\u5bf9\uff0c\u6240\u4ee5\uff0c\u6211\u4e5f\u628a\u5b83\u79f0\u4e3a \u5168\u5c40\u54c8\u5e0c\u8868\u3002 \u54c8\u5e0c\u8868\u7684\u6700\u5927\u597d\u5904\u5f88\u660e\u663e\uff0c\u5c31\u662f\u8ba9\u6211\u4eec\u53ef\u4ee5\u7528 O(1) \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u6765\u5feb\u901f\u67e5\u627e\u5230\u952e\u503c\u5bf9\u2014\u2014 \u6211\u4eec\u53ea\u9700\u8981\u8ba1\u7b97\u952e\u7684\u54c8\u5e0c\u503c\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053\u5b83\u6240\u5bf9\u5e94\u7684\u54c8\u5e0c\u6876\u4f4d\u7f6e\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u8bbf\u95ee\u76f8\u5e94\u7684 entry \u5143\u7d20\u3002 \u4e2a\u67e5\u627e\u8fc7\u7a0b\u4e3b\u8981\u4f9d\u8d56\u4e8e\u54c8\u5e0c\u8ba1\u7b97\uff0c\u548c\u6570\u636e\u91cf\u7684\u591a\u5c11\u5e76\u6ca1\u6709\u76f4\u63a5\u5173\u7cfb\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e0d\u7ba1\u54c8\u5e0c\u8868\u91cc\u6709 10 \u4e07\u4e2a\u952e\u8fd8\u662f 100 \u4e07\u4e2a\u952e\uff0c\u6211\u4eec\u53ea\u9700\u8981\u4e00\u6b21\u8ba1\u7b97\u5c31\u80fd\u627e\u5230\u76f8\u5e94\u7684\u952e\u3002 \u4f46\u662f\uff0c\u5f53\u4f60\u5f80 Redis \u4e2d\u5199\u5165\u5927\u91cf\u6570\u636e\u540e\uff0c\u5c31\u53ef\u80fd\u53d1\u73b0\u64cd\u4f5c\u6709\u65f6\u5019\u4f1a\u7a81\u7136\u53d8\u6162\u4e86\uff0c\u8fd9\u5176\u5b9e\u662f\u56e0\u4e3a\u4f60\u5ffd\u7565\u4e86\u4e00\u4e2a\u6f5c\u5728\u7684\u98ce\u9669\u70b9\uff0c \u90a3\u5c31\u662f\u54c8\u5e0c\u8868\u7684\u51b2\u7a81\u95ee\u9898\u548c rehash \u53ef\u80fd\u5e26\u6765\u7684\u64cd\u4f5c\u963b\u585e \u3002","title":"1\u3001\u952e\u548c\u503c\u7528\u4ec0\u4e48\u7ed3\u6784\u7ec4\u7ec7\uff1f"},{"location":"chap2/2redis_slowquery/#2","text":"\u4f60\u5f80\u54c8\u5e0c\u8868\u4e2d\u5199\u5165\u66f4\u591a\u6570\u636e\u65f6\uff0c\u54c8\u5e0c\u51b2\u7a81\u662f\u4e0d\u53ef\u907f\u514d\u7684\u95ee\u9898\u3002 \u8fd9\u91cc\u7684\u54c8\u5e0c\u51b2\u7a81\uff0c\u4e5f\u5c31\u662f\u6307\uff0c\u4e24\u4e2a key \u7684\u54c8\u5e0c\u503c\u548c\u54c8\u5e0c\u6876\u8ba1\u7b97\u5bf9\u5e94\u5173\u7cfb\u65f6\uff0c\u6b63\u597d\u843d\u5728\u4e86\u540c\u4e00\u4e2a\u54c8\u5e0c\u6876\u4e2d \u3002 \u6bd5\u7adf\uff0c\u54c8\u5e0c\u6876\u7684\u4e2a\u6570\u901a\u5e38\u8981\u5c11\u4e8e key \u7684\u6570\u91cf\uff0c\u8fd9\u4e5f\u5c31\u662f\u8bf4\uff0c\u96be\u514d\u4f1a\u6709\u4e00\u4e9b key \u7684\u54c8\u5e0c\u503c\u5bf9\u5e94\u5230\u4e86\u540c\u4e00\u4e2a\u54c8\u5e0c\u6876\u4e2d\u3002","title":"2\u3001\u5982\u4f55\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\u7b49\u95ee\u9898"},{"location":"chap2/2redis_slowquery/#2-1","text":"Redis \u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\u7684\u65b9\u5f0f\uff0c\u5c31\u662f\u94fe\u5f0f\u54c8\u5e0c \u3002 \u94fe\u5f0f\u54c8\u5e0c\u4e5f\u5f88\u5bb9\u6613\u7406\u89e3\uff0c\u5c31\u662f\u6307\u540c\u4e00\u4e2a\u54c8\u5e0c\u6876\u4e2d\u7684\u591a\u4e2a\u5143\u7d20\u7528\u4e00\u4e2a\u94fe\u8868\u6765\u4fdd\u5b58\uff0c\u5b83\u4eec\u4e4b\u95f4\u4f9d\u6b21\u7528\u6307\u9488\u8fde\u63a5\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff1aentry1\u3001entry2 \u548c entry3 \u90fd\u9700\u8981\u4fdd\u5b58\u5728\u54c8\u5e0c\u6876 3 \u4e2d\uff0c\u5bfc\u81f4\u4e86\u54c8\u5e0c\u51b2\u7a81\u3002 \u6b64\u65f6\uff0c entry1 \u5143\u7d20\u4f1a\u901a\u8fc7\u4e00\u4e2a *next \u6307\u9488\u6307\u5411 entry2 \uff0c\u540c\u6837\uff0c entry2 \u4e5f\u4f1a\u901a\u8fc7 *next \u6307\u9488\u6307\u5411 entry3\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u54c8\u5e0c\u6876 3 \u4e2d\u7684\u5143\u7d20\u6709 100 \u4e2a\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 entry \u5143\u7d20\u4e2d\u7684\u6307\u9488\uff0c\u628a\u5b83\u4eec\u8fde\u8d77\u6765\u3002\u8fd9\u5c31\u5f62\u6210\u4e86\u4e00\u4e2a\u94fe\u8868\uff0c\u4e5f\u53eb\u4f5c\u54c8\u5e0c\u51b2\u7a81\u94fe\u3002 \u4f46\u662f\uff0c\u8fd9\u91cc\u4f9d\u7136\u5b58\u5728\u4e00\u4e2a\u95ee\u9898\uff0c\u54c8\u5e0c\u51b2\u7a81\u94fe\u4e0a\u7684\u5143\u7d20\u53ea\u80fd\u901a\u8fc7\u6307\u9488\u9010\u4e00\u67e5\u627e\u518d\u64cd\u4f5c\u3002\u5982\u679c\u54c8\u5e0c\u8868\u91cc\u5199\u5165\u7684\u6570\u636e\u8d8a\u6765\u8d8a\u591a\uff0c\u54c8\u5e0c\u51b2\u7a81\u53ef\u80fd\u4e5f\u4f1a\u8d8a\u6765\u8d8a\u591a\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u67d0\u4e9b\u54c8\u5e0c\u51b2\u7a81\u94fe\u8fc7\u957f\uff0c\u8fdb\u800c\u5bfc\u81f4\u8fd9\u4e2a\u94fe\u4e0a\u7684\u5143\u7d20\u67e5\u627e\u8017\u65f6\u957f\uff0c\u6548\u7387\u964d\u4f4e\u3002","title":"2-1 \u94fe\u5f0f\u54c8\u5e0c"},{"location":"chap2/2redis_slowquery/#2-2-rehash","text":"\u6240\u4ee5\uff0cRedis \u4f1a\u5bf9\u54c8\u5e0c\u8868\u505a rehash \u64cd\u4f5c\u3002 rehash \u4e5f\u5c31\u662f\u589e\u52a0\u73b0\u6709\u7684\u54c8\u5e0c\u6876\u6570\u91cf\uff0c\u8ba9\u9010\u6e10\u589e\u591a\u7684 entry \u5143\u7d20\u80fd\u5728\u66f4\u591a\u7684\u6876\u4e4b\u95f4\u5206\u6563\u4fdd\u5b58\uff0c\u51cf\u5c11\u5355\u4e2a\u6876\u4e2d\u7684\u5143\u7d20\u6570\u91cf\uff0c\u4ece\u800c\u51cf\u5c11\u5355\u4e2a\u6876\u4e2d\u7684\u51b2\u7a81\u3002 \u4e3a\u4e86\u4f7f rehash \u64cd\u4f5c\u66f4\u9ad8\u6548\uff0cRedis \u9ed8\u8ba4\u4f7f\u7528\u4e86\u4e24\u4e2a\u5168\u5c40\u54c8\u5e0c\u8868\uff1a\u54c8\u5e0c\u8868 1 \u548c\u54c8\u5e0c\u8868 2\u3002\u4e00\u5f00\u59cb\uff0c\u5f53\u4f60\u521a\u63d2\u5165\u6570\u636e\u65f6\uff0c\u9ed8\u8ba4\u4f7f\u7528\u54c8\u5e0c\u8868 1\uff0c\u6b64\u65f6\u7684\u54c8\u5e0c\u8868 2 \u5e76\u6ca1\u6709\u88ab\u5206\u914d\u7a7a\u95f4\u3002\u968f\u7740\u6570\u636e\u9010\u6b65\u589e\u591a\uff0cRedis \u5f00\u59cb\u6267\u884c rehash\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5206\u4e3a\u4e09\u6b65\uff1a \u7ed9\u54c8\u5e0c\u8868 2 \u5206\u914d\u66f4\u5927\u7684\u7a7a\u95f4\uff0c\u4f8b\u5982\u662f\u5f53\u524d\u54c8\u5e0c\u8868 1 \u5927\u5c0f\u7684\u4e24\u500d\uff1b \u628a\u54c8\u5e0c\u8868 1 \u4e2d\u7684\u6570\u636e\u91cd\u65b0\u6620\u5c04\u5e76\u62f7\u8d1d\u5230\u54c8\u5e0c\u8868 2 \u4e2d\uff1b \u91ca\u653e\u54c8\u5e0c\u8868 1 \u7684\u7a7a\u95f4\u3002 \u5230\u6b64\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4ece\u54c8\u5e0c\u8868 1 \u5207\u6362\u5230\u54c8\u5e0c\u8868 2\uff0c\u7528\u589e\u5927\u7684\u54c8\u5e0c\u8868 2 \u4fdd\u5b58\u66f4\u591a\u6570\u636e\uff0c\u800c\u539f\u6765\u7684\u54c8\u5e0c\u8868 1 \u7559\u4f5c\u4e0b\u4e00\u6b21 rehash \u6269\u5bb9\u5907\u7528\u3002","title":"2-2 Rehash"},{"location":"chap2/2redis_slowquery/#2-3-rehash","text":"\u8fd9\u4e2a\u8fc7\u7a0b\u770b\u4f3c\u7b80\u5355\uff0c\u4f46\u662f\u7b2c\u4e8c\u6b65\u6d89\u53ca\u5927\u91cf\u7684\u6570\u636e\u62f7\u8d1d\uff0c \u5982\u679c\u4e00\u6b21\u6027\u628a\u54c8\u5e0c\u8868 1 \u4e2d\u7684\u6570\u636e\u90fd\u8fc1\u79fb\u5b8c\uff0c\u4f1a\u9020\u6210 Redis \u7ebf\u7a0b\u963b\u585e\uff0c\u65e0\u6cd5\u670d\u52a1\u5176\u4ed6\u8bf7\u6c42 \u3002\u6b64\u65f6\uff0cRedis \u5c31\u65e0\u6cd5\u5feb\u901f\u8bbf\u95ee\u6570\u636e\u4e86\u3002 \u4e3a\u4e86\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\uff0cRedis \u91c7\u7528\u4e86\u6e10\u8fdb\u5f0f rehash\u3002 \u7b80\u5355\u6765\u8bf4\u5c31\u662f\u5728\u7b2c\u4e8c\u6b65\u62f7\u8d1d\u6570\u636e\u65f6\uff0cRedis \u4ecd\u7136\u6b63\u5e38\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u6bcf\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\u65f6\uff0c\u4ece\u54c8\u5e0c\u8868 1 \u4e2d\u7684\u7b2c\u4e00\u4e2a\u7d22\u5f15\u4f4d\u7f6e\u5f00\u59cb\uff0c\u987a\u5e26\u7740\u5c06\u8fd9\u4e2a\u7d22\u5f15\u4f4d\u7f6e\u4e0a\u7684\u6240\u6709 entries \u62f7\u8d1d\u5230\u54c8\u5e0c\u8868 2 \u4e2d\uff1b \u7b49\u5904\u7406\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u65f6\uff0c\u518d\u987a\u5e26\u62f7\u8d1d\u54c8\u5e0c\u8868 1 \u4e2d\u7684\u4e0b\u4e00\u4e2a\u7d22\u5f15\u4f4d\u7f6e\u7684 entries\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff1a \u8fd9\u6837\u5c31\u5de7\u5999\u5730\u628a\u4e00\u6b21\u6027\u5927\u91cf\u62f7\u8d1d\u7684\u5f00\u9500\uff0c\u5206\u644a\u5230\u4e86\u591a\u6b21\u5904\u7406\u8bf7\u6c42\u7684\u8fc7\u7a0b\u4e2d\uff0c\u907f\u514d\u4e86\u8017\u65f6\u64cd\u4f5c\uff0c\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u5feb\u901f\u8bbf\u95ee\u3002 \u5bf9\u4e8e String \u7c7b\u578b\u6765\u8bf4\uff0c\u627e\u5230\u54c8\u5e0c\u6876\u5c31\u80fd\u76f4\u63a5\u589e\u5220\u6539\u67e5\u4e86\uff0c \u6240\u4ee5\uff0c\u54c8\u5e0c\u8868\u7684 O(1) \u64cd\u4f5c\u590d\u6742\u5ea6\u4e5f\u5c31\u662f\u5b83\u7684\u590d\u6742\u5ea6\u4e86\u3002 \u4f46\u662f\uff0c\u5bf9\u4e8e\u96c6\u5408\u7c7b\u578b\u6765\u8bf4\uff0c\u5373\u4f7f\u627e\u5230\u54c8\u5e0c\u6876\u4e86\uff0c\u8fd8\u8981\u5728\u96c6\u5408\u4e2d\u518d\u8fdb\u4e00\u6b65\u64cd\u4f5c\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6765\u770b\u96c6\u5408\u7c7b\u578b\u7684\u64cd\u4f5c\u6548\u7387\u53c8\u662f\u600e\u6837\u7684\u3002","title":"2-3 \u6e10\u8fdb\u5f0f rehash"},{"location":"chap2/2redis_slowquery/#3","text":"\u548c String \u7c7b\u578b\u4e0d\u540c\uff0c\u4e00\u4e2a\u96c6\u5408\u7c7b\u578b\u7684\u503c \uff0c \u7b2c\u4e00\u6b65\u662f\u901a\u8fc7\u5168\u5c40\u54c8\u5e0c\u8868\u627e\u5230\u5bf9\u5e94\u7684\u54c8\u5e0c\u6876\u4f4d\u7f6e\uff0c \u7b2c\u4e8c\u6b65\u662f\u5728\u96c6\u5408\u4e2d\u518d\u589e\u5220\u6539\u67e5\u3002 \u96c6\u5408\u7684\u64cd\u4f5c\u6548\u7387\u548c\u54ea\u4e9b\u56e0\u7d20\u76f8\u5173\u5462\uff1f \u9996\u5148\uff0c\u4e0e\u96c6\u5408\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u6709\u5173\u3002\u4f8b\u5982\uff0c\u4f7f\u7528\u54c8\u5e0c\u8868\u5b9e\u73b0\u7684\u96c6\u5408\uff0c\u8981\u6bd4\u4f7f\u7528\u94fe\u8868\u5b9e\u73b0\u7684\u96c6\u5408\u8bbf\u95ee\u6548\u7387\u66f4\u9ad8\u3002 \u5176\u6b21\uff0c\u64cd\u4f5c\u6548\u7387\u548c\u8fd9\u4e9b\u64cd\u4f5c\u672c\u8eab\u7684\u6267\u884c\u7279\u70b9\u6709\u5173\uff0c\u6bd4\u5982\u8bfb\u5199\u4e00\u4e2a\u5143\u7d20\u7684\u64cd\u4f5c\u8981\u6bd4\u8bfb\u5199\u6240\u6709\u5143\u7d20\u7684\u6548\u7387\u9ad8\u3002","title":"3\u3001\u96c6\u5408\u6570\u636e\u64cd\u4f5c\u6548\u7387"},{"location":"chap2/2redis_slowquery/#4","text":"\u96c6\u5408\u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u4e3b\u8981\u6709 5 \u79cd\uff1a\u6574\u6570\u6570\u7ec4\u3001\u53cc\u5411\u94fe\u8868\u3001\u54c8\u5e0c\u8868\u3001\u538b\u7f29\u5217\u8868\u548c\u8df3\u8868\u3002 \u6574\u6570\u6570\u7ec4\u548c\u53cc\u5411\u94fe\u8868\u4e5f\u5f88\u5e38\u89c1\uff0c\u5b83\u4eec\u7684\u64cd\u4f5c\u7279\u5f81\u90fd\u662f\u987a\u5e8f\u8bfb\u5199\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u6570\u7ec4\u4e0b\u6807\u6216\u8005\u94fe\u8868\u7684\u6307\u9488\u9010\u4e2a\u5143\u7d20\u8bbf\u95ee\uff0c \u64cd\u4f5c\u590d\u6742\u5ea6\u57fa\u672c\u662f O(N)\uff0c\u64cd\u4f5c\u6548\u7387\u6bd4\u8f83\u4f4e","title":"4\u3001\u6709\u54ea\u4e9b\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff1f"},{"location":"chap2/2redis_slowquery/#4-1","text":"\u538b\u7f29\u5217\u8868\u5b9e\u9645\u4e0a\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u90fd\u5bf9\u5e94\u4fdd\u5b58\u4e00\u4e2a\u6570\u636e\u3002 \u548c\u6570\u7ec4\u4e0d\u540c\u7684\u662f\uff0c\u538b\u7f29\u5217\u8868\u5728\u8868\u5934\u6709\u4e09\u4e2a\u5b57\u6bb5 zlbytes\u3001zltail \u548c zllen\uff0c\u5206\u522b\u8868\u793a\u5217\u8868\u957f\u5ea6\u3001\u5217\u8868\u5c3e\u7684\u504f\u79fb\u91cf\u548c\u5217\u8868\u4e2d\u7684 entry \u4e2a\u6570\uff1b\u538b\u7f29\u5217\u8868\u5728\u8868\u5c3e\u8fd8\u6709\u4e00\u4e2a zlend\uff0c\u8868\u793a\u5217\u8868\u7ed3\u675f\u3002 zlbytes\uff1a \u5217\u8868\u957f\u5ea6 zltail\uff1a \u5217\u8868\u5c3e\u7684\u504f\u79fb\u91cf zllen\uff1a \u5217\u8868\u4e2d\u7684 entry \u4e2a\u6570 \u538b\u7f29\u5217\u8868\u5728\u8868\u5c3e\u8fd8\u6709\u4e00\u4e2a zlend\uff1a \u8868\u7ed3\u675f \u5728\u538b\u7f29\u5217\u8868\u4e2d\uff0c\u5982\u679c\u6211\u4eec\u8981\u67e5\u627e\u5b9a\u4f4d\u7b2c\u4e00\u4e2a\u5143\u7d20\u548c\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u53ef\u4ee5\u901a\u8fc7\u8868\u5934\u4e09\u4e2a\u5b57\u6bb5\u7684\u957f\u5ea6\u76f4\u63a5\u5b9a\u4f4d\uff0c\u590d\u6742\u5ea6\u662f O(1) \u800c\u67e5\u627e\u5176\u4ed6\u5143\u7d20\u65f6\uff0c\u5c31\u6ca1\u6709\u8fd9\u4e48\u9ad8\u6548\u4e86\uff0c\u53ea\u80fd\u9010\u4e2a\u67e5\u627e\uff0c\u6b64\u65f6\u7684\u590d\u6742\u5ea6\u5c31\u662f O(N) \u4e86\u3002","title":"4-1 \u538b\u7f29\u5217\u8868"},{"location":"chap2/2redis_slowquery/#4-2","text":"\u6709\u5e8f\u94fe\u8868\u53ea\u80fd\u9010\u4e00\u67e5\u627e\u5143\u7d20\uff0c\u5bfc\u81f4\u64cd\u4f5c\u8d77\u6765\u975e\u5e38\u7f13\u6162\uff0c\u4e8e\u662f\u5c31\u51fa\u73b0\u4e86\u8df3\u8868\u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u8df3\u8868\u5728\u94fe\u8868\u7684\u57fa\u7840\u4e0a\uff0c\u589e\u52a0\u4e86\u591a\u7ea7\u7d22\u5f15\uff0c\u901a\u8fc7\u7d22\u5f15\u4f4d\u7f6e\u7684\u51e0\u4e2a\u8df3\u8f6c\uff0c\u5b9e\u73b0\u6570\u636e\u7684\u5feb\u901f\u5b9a\u4f4d \u5982\u679c\u6211\u4eec\u8981\u5728\u94fe\u8868\u4e2d\u67e5\u627e 33 \u8fd9\u4e2a\u5143\u7d20\uff0c\u53ea\u80fd\u4ece\u5934\u5f00\u59cb\u904d\u5386\u94fe\u8868\uff0c\u67e5\u627e 6 \u6b21\uff0c\u76f4\u5230\u627e\u5230 33 \u4e3a\u6b62\u3002\u6b64\u65f6\uff0c\u590d\u6742\u5ea6\u662f O(N)\uff0c\u67e5\u627e\u6548\u7387\u5f88\u4f4e\u3002 \u4e3a\u4e86\u63d0\u9ad8\u67e5\u627e\u901f\u5ea6\uff0c\u6211\u4eec\u6765\u589e\u52a0\u4e00\u7ea7\u7d22\u5f15 \u4ece\u7b2c\u4e00\u4e2a\u5143\u7d20\u5f00\u59cb\uff0c\u6bcf\u4e24\u4e2a\u5143\u7d20\u9009\u4e00\u4e2a\u51fa\u6765\u4f5c\u4e3a\u7d22\u5f15\u3002\u8fd9\u4e9b\u7d22\u5f15\u518d\u901a\u8fc7\u6307\u9488\u6307\u5411\u539f\u59cb\u7684\u94fe\u8868\u3002 \u4f8b\u5982\uff0c\u4ece\u524d\u4e24\u4e2a\u5143\u7d20\u4e2d\u62bd\u53d6\u5143\u7d20 1 \u4f5c\u4e3a\u4e00\u7ea7\u7d22\u5f15\uff0c\u4ece\u7b2c\u4e09\u3001\u56db\u4e2a\u5143\u7d20\u4e2d\u62bd\u53d6\u5143\u7d20 11 \u4f5c\u4e3a\u4e00\u7ea7\u7d22\u5f15\u3002\u6b64\u65f6\uff0c\u6211\u4eec\u53ea\u9700\u8981 4 \u6b21\u67e5\u627e\u5c31\u80fd\u5b9a\u4f4d\u5230\u5143\u7d20 33 \u4e86\u3002 \u5982\u679c\u6211\u4eec\u8fd8\u60f3\u518d\u5feb\uff0c\u53ef\u4ee5\u518d\u589e\u52a0\u4e8c\u7ea7\u7d22\u5f15 \u4ece\u4e00\u7ea7\u7d22\u5f15\u4e2d\uff0c\u518d\u62bd\u53d6\u90e8\u5206\u5143\u7d20\u4f5c\u4e3a\u4e8c\u7ea7\u7d22\u5f15\u3002 \u4f8b\u5982\uff0c\u4ece\u4e00\u7ea7\u7d22\u5f15\u4e2d\u62bd\u53d6 1\u300127\u3001100 \u4f5c\u4e3a\u4e8c\u7ea7\u7d22\u5f15\uff0c\u4e8c\u7ea7\u7d22\u5f15\u6307\u5411\u4e00\u7ea7\u7d22\u5f15\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u53ea\u9700\u8981 3 \u6b21\u67e5\u627e\uff0c\u5c31\u80fd\u5b9a\u4f4d\u5230\u5143\u7d20 33 \u4e86\u3002 \u5f53\u6570\u636e\u91cf\u5f88\u5927\u65f6\uff0c\u8df3\u8868\u7684\u67e5\u627e\u590d\u6742\u5ea6\u5c31\u662f O(logN)\u3002","title":"4-2 \u8df3\u8868"},{"location":"chap2/2redis_slowquery/#5","text":"\u96c6\u5408\u7c7b\u578b\u7684\u64cd\u4f5c\u7c7b\u578b\u5f88\u591a\uff0c\u6709\u8bfb\u5199\u5355\u4e2a\u96c6\u5408\u5143\u7d20\u7684\uff0c\u4f8b\u5982 HGET\u3001HSET\uff0c \u4e5f\u6709\u64cd\u4f5c\u591a\u4e2a\u5143\u7d20\u7684\uff0c\u4f8b\u5982 SADD\uff0c\u8fd8\u6709\u5bf9\u6574\u4e2a\u96c6\u5408\u8fdb\u884c\u904d\u5386\u64cd\u4f5c\u7684\uff0c\u4f8b\u5982 SMEMBERS\u3002 \u8fd9\u4e48\u591a\u64cd\u4f5c\uff0c\u5b83\u4eec\u7684\u590d\u6742\u5ea6\u4e5f\u5404\u4e0d\u76f8\u540c\u3002\u800c\u590d\u6742\u5ea6\u7684\u9ad8\u4f4e\u53c8\u662f\u6211\u4eec\u9009\u62e9\u96c6\u5408\u7c7b\u578b\u7684\u91cd\u8981\u4f9d\u636e\u3002 \u5355\u5143\u7d20\u64cd\u4f5c\u662f\u57fa\u7840\uff1b \u8303\u56f4\u64cd\u4f5c\u975e\u5e38\u8017\u65f6\uff1b \u7edf\u8ba1\u64cd\u4f5c\u901a\u5e38\u9ad8\u6548\uff1b \u4f8b\u5916\u60c5\u51b5\u53ea\u6709\u51e0\u4e2a\u3002 \u7b2c\u4e00\uff0c\u5355\u5143\u7d20\u64cd\u4f5c\uff0c\u662f\u6307\u6bcf\u4e00\u79cd\u96c6\u5408\u7c7b\u578b\u5bf9\u5355\u4e2a\u6570\u636e\u5b9e\u73b0\u7684\u589e\u5220\u6539\u67e5\u64cd\u4f5c\u3002 \u4f8b\u5982\uff0cHash \u7c7b\u578b\u7684 HGET\u3001HSET \u548c HDEL\uff0cSet \u7c7b\u578b\u7684 SADD\u3001SREM\u3001SRANDMEMBER \u7b49\u3002\u8fd9\u4e9b\u64cd\u4f5c\u7684\u590d\u6742\u5ea6\u7531\u96c6\u5408\u91c7\u7528\u7684\u6570\u636e\u7ed3\u6784\u51b3\u5b9a\uff0c \u4f8b\u5982\uff0cHGET\u3001HSET \u548c HDEL \u662f\u5bf9\u54c8\u5e0c\u8868\u505a\u64cd\u4f5c\uff0c\u6240\u4ee5\u5b83\u4eec\u7684\u590d\u6742\u5ea6\u90fd\u662f O(1)\uff1b Set \u7c7b\u578b\u7528\u54c8\u5e0c\u8868\u4f5c\u4e3a\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u65f6\uff0c\u5b83\u7684 SADD\u3001SREM\u3001SRANDMEMBER \u590d\u6742\u5ea6\u4e5f\u662f O(1)\u3002 \u96c6\u5408\u7c7b\u578b\u652f\u6301\u540c\u65f6\u5bf9\u591a\u4e2a\u5143\u7d20\u8fdb\u884c\u589e\u5220\u6539\u67e5\uff0c\u4f8b\u5982 Hash \u7c7b\u578b\u7684 HMGET \u548c HMSET\uff0cSet \u7c7b\u578b\u7684 SADD \u4e5f\u652f\u6301\u540c\u65f6\u589e\u52a0\u591a\u4e2a\u5143\u7d20\u3002 \u6b64\u65f6\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u7684\u590d\u6742\u5ea6\uff0c\u5c31\u662f\u7531\u5355\u4e2a\u5143\u7d20\u64cd\u4f5c\u590d\u6742\u5ea6\u548c\u5143\u7d20\u4e2a\u6570\u51b3\u5b9a\u7684\u3002\u4f8b\u5982\uff0cHMSET \u589e\u52a0 M \u4e2a\u5143\u7d20\u65f6\uff0c\u590d\u6742\u5ea6\u5c31\u4ece O(1) \u53d8\u6210 O(M) \u4e86\u3002 \u7b2c\u4e8c\uff0c\u8303\u56f4\u64cd\u4f5c\uff0c\u662f\u6307\u96c6\u5408\u7c7b\u578b\u4e2d\u7684\u904d\u5386\u64cd\u4f5c\uff0c\u53ef\u4ee5\u8fd4\u56de\u96c6\u5408\u4e2d\u7684\u6240\u6709\u6570\u636e \u6bd4\u5982 Hash \u7c7b\u578b\u7684 HGETALL \u548c Set \u7c7b\u578b\u7684 SMEMBERS \uff0c\u6216\u8005\u8fd4\u56de\u4e00\u4e2a\u8303\u56f4\u5185\u7684\u90e8\u5206\u6570\u636e\uff0c\u6bd4\u5982 List \u7c7b\u578b\u7684 LRANGE \u548c ZSet \u7c7b\u578b\u7684 ZRANGE \u3002 \u8fd9\u7c7b\u64cd\u4f5c\u7684\u590d\u6742\u5ea6\u4e00\u822c\u662f O(N)\uff0c\u6bd4\u8f83\u8017\u65f6\uff0c\u6211\u4eec\u5e94\u8be5\u5c3d\u91cf\u907f\u514d\u3002 Redis \u4ece 2.8 \u7248\u672c\u5f00\u59cb\u63d0\u4f9b\u4e86 SCAN \u7cfb\u5217\u64cd\u4f5c\uff08\u5305\u62ec HSCAN \uff0c SSCAN \u548c ZSCAN \uff09\uff0c\u8fd9\u7c7b\u64cd\u4f5c\u5b9e\u73b0\u4e86\u6e10\u8fdb\u5f0f\u904d\u5386\uff0c\u6bcf\u6b21\u53ea\u8fd4\u56de\u6709\u9650\u6570\u91cf\u7684\u6570\u636e\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u76f8\u6bd4\u4e8e HGETALL\u3001SMEMBERS \u8fd9\u7c7b\u64cd\u4f5c\u6765\u8bf4\uff0c\u5c31\u907f\u514d\u4e86\u4e00\u6b21\u6027\u8fd4\u56de\u6240\u6709\u5143\u7d20\u800c\u5bfc\u81f4\u7684 Redis \u963b\u585e\u3002 \u7b2c\u4e09\uff0c\u7edf\u8ba1\u64cd\u4f5c\uff0c\u662f\u6307\u96c6\u5408\u7c7b\u578b\u5bf9\u96c6\u5408\u4e2d\u6240\u6709\u5143\u7d20\u4e2a\u6570\u7684\u8bb0\u5f55 \u4f8b\u5982 LLEN \u548c SCARD\u3002 \u8fd9\u7c7b\u64cd\u4f5c\u590d\u6742\u5ea6\u53ea\u6709 O(1) \uff0c\u8fd9\u662f\u56e0\u4e3a\u5f53\u96c6\u5408\u7c7b\u578b\u91c7\u7528\u538b\u7f29\u5217\u8868\u3001\u53cc\u5411\u94fe\u8868\u3001\u6574\u6570\u6570\u7ec4\u8fd9\u4e9b\u6570\u636e\u7ed3\u6784\u65f6\uff0c\u8fd9\u4e9b\u7ed3\u6784\u4e2d\u4e13\u95e8\u8bb0\u5f55\u4e86\u5143\u7d20\u7684\u4e2a\u6570\u7edf\u8ba1\uff0c\u56e0\u6b64\u53ef\u4ee5\u9ad8\u6548\u5730\u5b8c\u6210\u76f8\u5173\u64cd\u4f5c\u3002 \u7b2c\u56db\uff0c\u4f8b\u5916\u60c5\u51b5\uff0c\u662f\u6307\u67d0\u4e9b\u6570\u636e\u7ed3\u6784\u7684\u7279\u6b8a\u8bb0\u5f55\uff0c\u4f8b\u5982\u538b\u7f29\u5217\u8868\u548c\u53cc\u5411\u94fe\u8868\u90fd\u4f1a\u8bb0\u5f55\u8868\u5934\u548c\u8868\u5c3e\u7684\u504f\u79fb\u91cf\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5bf9\u4e8e List \u7c7b\u578b\u7684 LPOP\u3001RPOP\u3001LPUSH\u3001RPUSH \u8fd9\u56db\u4e2a\u64cd\u4f5c\u6765\u8bf4\uff0c\u5b83\u4eec\u662f\u5728\u5217\u8868\u7684\u5934\u5c3e\u589e\u5220\u5143\u7d20\uff0c\u8fd9\u5c31\u53ef\u4ee5\u901a\u8fc7\u504f\u79fb\u91cf\u76f4\u63a5\u5b9a\u4f4d\uff0c\u6240\u4ee5\u5b83\u4eec\u7684\u590d\u6742\u5ea6\u4e5f\u53ea\u6709 O(1) \uff0c\u53ef\u4ee5\u5b9e\u73b0\u5feb\u901f\u64cd\u4f5c\u3002","title":"5\u3001\u4e0d\u540c\u64cd\u4f5c\u7684\u590d\u6742\u5ea6"},{"location":"chap2/2redis_slowquery/#6","text":"Redis \u4e4b\u6240\u4ee5\u80fd\u5feb\u901f\u64cd\u4f5c\u952e\u503c\u5bf9\uff0c \u4e00\u65b9\u9762\u662f\u56e0\u4e3a O(1) \u590d\u6742\u5ea6\u7684\u54c8\u5e0c\u8868\u88ab\u5e7f\u6cdb\u4f7f\u7528\uff0c\u5305\u62ec String\u3001Hash \u548c Set\uff0c\u5b83\u4eec\u7684\u64cd\u4f5c\u590d\u6742\u5ea6\u57fa\u672c\u7531\u54c8\u5e0c\u8868\u51b3\u5b9a\uff0c\u53e6\u4e00\u65b9\u9762\uff0cSorted Set \u4e5f\u91c7\u7528\u4e86 O(logN) \u590d\u6742\u5ea6\u7684\u8df3\u8868\u3002 \u4e0d\u8fc7\uff0c\u96c6\u5408\u7c7b\u578b\u7684\u8303\u56f4\u64cd\u4f5c\uff0c\u56e0\u4e3a\u8981\u904d\u5386\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff0c\u590d\u6742\u5ea6\u901a\u5e38\u662f O(N) \u3002 \u8fd9\u91cc\uff0c\u6211\u7684\u5efa\u8bae\u662f\uff1a \u7528\u5176\u4ed6\u547d\u4ee4\u6765\u66ff\u4ee3\uff0c\u4f8b\u5982\u53ef\u4ee5\u7528 SCAN \u6765\u4ee3\u66ff\uff0c\u907f\u514d\u5728 Redis \u5185\u90e8\u4ea7\u751f\u8d39\u65f6\u7684\u5168\u96c6\u5408\u904d\u5386\u64cd\u4f5c\u3002 \u5f53\u7136\uff0c\u6211\u4eec\u4e0d\u80fd\u5fd8\u4e86\u590d\u6742\u5ea6\u8f83\u9ad8\u7684 List \u7c7b\u578b\uff0c\u5b83\u7684\u4e24\u79cd\u5e95\u5c42\u5b9e\u73b0\u7ed3\u6784\uff1a\u53cc\u5411\u94fe\u8868\u548c\u538b\u7f29\u5217\u8868\u7684\u64cd\u4f5c\u590d\u6742\u5ea6\u90fd\u662f O(N)\u3002\u56e0\u6b64\uff0c\u6211\u7684\u5efa\u8bae\u662f\uff1a \u56e0\u5730\u5236\u5b9c\u5730\u4f7f\u7528 List \u7c7b\u578b \u3002\u4f8b\u5982\uff0c\u65e2\u7136\u5b83\u7684 POP/PUSH \u6548\u7387\u5f88\u9ad8\uff0c\u90a3\u4e48\u5c31\u5c06\u5b83\u4e3b\u8981\u7528\u4e8e FIFO \u961f\u5217\u573a\u666f\uff0c\u800c\u4e0d\u662f\u4f5c\u4e3a\u4e00\u4e2a\u53ef\u4ee5\u968f\u673a\u8bfb\u5199\u7684\u96c6\u5408\u3002","title":"6\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap2/2redis_slowquery/#6-1","text":"Redis\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784 Redis\u7684\u6570\u636e\u7ed3\u6784\uff1a\u6570\u636e\u7684\u4fdd\u5b58\u5f62\u5f0f\u4e0e\u5e95\u5c42\u6570\u636e\u7ed3\u6784 \u7531\u6570\u636e\u7ed3\u6784\u7684\u5f02\u540c\u70b9\uff0c\u5f15\u51fa\u6570\u636e\u64cd\u4f5c\u7684\u5feb\u6162\u539f\u56e0","title":"6-1 \u8bb2\u4e86\u4ec0\u4e48\uff1f"},{"location":"chap2/2redis_slowquery/#6-1_1","text":"string\uff0clist\uff0cset\uff0chast, sortset\u90fd\u53ea\u662f\u6570\u636e\u7684\u4fdd\u5b58\u5f62\u5f0f \u5e95\u5c42\u7684\u6570\u636e\u7ed3\u6784\u662f\uff1a\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\uff0c\u53cc\u5411\u94fe\u8868\uff0c\u538b\u7f29\u5217\u8868\uff0c\u54c8\u5e0c\u8868\uff0c\u8df3\u8868\uff0c\u6574\u6570\u6570\u7ec4 Redis\u4f7f\u7528\u4e86\u4e00\u4e2a\u54c8\u5e0c\u8868\u4fdd\u5b58\u6240\u6709\u7684\u952e\u503c\u5bf9 \u4e94\u79cd\u6570\u636e\u5f62\u5f0f\u7684\u5e95\u5c42\u5b9e\u73b0 string\uff1a\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32 list\uff1a\u53cc\u5411\u94fe\u8868\uff0c\u538b\u7f29\u5217\u8868 hash\uff1a\u538b\u7f29\u5217\u8868\uff0c\u54c8\u5e0c\u8868 Sorted Set\uff1a\u538b\u7f29\u5217\u8868\uff0c\u8df3\u8868 set\uff1a\u54c8\u5e0c\u8868\uff0c\u6574\u6570\u6570\u7ec4 List ,hash\uff0cset ,sorted set \u88ab\u7edf\u79f0\u4e3a\u96c6\u5408\u7c7b\u578b\uff0c\u4e00\u4e2a\u952e\u5bf9\u5e94\u4e86\u4e00\u4e2a\u96c6\u5408\u7684\u6570\u636e \u96c6\u5408\u7c7b\u578b\u7684\u952e\u548c\u503c\u4e4b\u95f4\u7684\u7ed3\u6784\u7ec4\u7ec7 redis\u4f7f\u7528\u4e00\u4e2a\u54c8\u5e0c\u8868\u4fdd\u5b58\u6240\u6709\u952e\u503c\u5bf9\uff0c\u4e00\u4e2a\u54c8\u5e0c\u8868\u5b9e\u5219\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u7684\u6bcf\u4e2a\u5143\u7d20\u79f0\u4e3a\u54c8\u5e0c\u6876\u3002 \u54c8\u5e0c\u6876\u4e2d\u7684\u5143\u7d20\u4fdd\u5b58\u7684\u4e0d\u662f\u503c\u7684\u672c\u8eab\uff0c\u800c\u662f\u6307\u5411\u5177\u4f53\u503c\u7684\u6307\u9488 \u54c8\u5e0c\u51b2\u7a81\u89e3\u51b3 Redis\u7684hash\u8868\u662f\u5168\u5c40\u7684\uff0c\u6240\u4ee5\u5f53\u5199\u5165\u5927\u91cf\u7684key\u65f6\uff0c\u5c06\u4f1a\u5e26\u6765\u54c8\u5e0c\u51b2\u7a81\uff0c\u5df2\u7ecfrehash\u53ef\u80fd\u5e26\u6765\u7684\u64cd\u4f5c\u963b\u585e Redis\u89e3\u51b3hash\u51b2\u7a81\u7684\u65b9\u5f0f\uff0c\u662f\u94fe\u5f0f\u54c8\u5e0c\uff1a\u540c\u4e00\u4e2a\u54c8\u5e0c\u6876\u4e2d\u7684\u591a\u4e2a\u5143\u7d20\u7528\u4e00\u4e2a\u94fe\u8868\u6765\u4fdd\u5b58 \u5f53\u54c8\u5e0c\u51b2\u7a81\u94fe\u8fc7\u957f\u65f6\uff0cRedis\u4f1a\u5bf9hash\u8868\u8fdb\u884crehash\u64cd\u4f5c\u3002rehash\u5c31\u662f\u589e\u52a0\u73b0\u6709\u7684hash\u6876\u6570\u91cf\uff0c\u5206\u6563entry\u5143\u7d20\u3002 rehash\u673a\u5236 \u4e86\u4f7frehash\u64cd\u4f5c\u66f4\u9ad8\u6548\uff0cRedis\u9ed8\u8ba4\u4f7f\u7528\u4e86\u4e24\u4e2a\u5168\u5c40\u54c8\u5e0c\u8868\uff1a\u54c8\u5e0c\u88681\u548c\u54c8\u5e0c\u88682\uff0c\u8d77\u59cb\u65f6hash2\u6ca1\u6709\u5206\u914d\u7a7a\u95f4 \u968f\u7740\u6570\u636e\u589e\u591a\uff0cRedis\u6267\u884c\u5206\u4e09\u6b65\u6267\u884crehash; \u7ed9hash2\u5206\u914d\u66f4\u5927\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5982\u662fhash1\u7684\u4e24\u500d \u628ahash1\u4e2d\u7684\u6570\u636e\u91cd\u65b0\u6620\u5c04\u5e76\u62f7\u8d1d\u5230\u54c8\u5e0c\u88682\u4e2d \u91ca\u653ehash1\u7684\u7a7a\u95f4 \u6e10\u8fdb\u5f0frehash \u7531\u4e8e\u6b65\u9aa42\u91cd\u65b0\u6620\u5c04\u975e\u5e38\u8017\u65f6\uff0c\u4f1a\u963b\u585eredis \u8bb2\u96c6\u4e2d\u8fc1\u79fb\u6570\u636e\uff0c\u6539\u6210\u6bcf\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\u65f6\uff0c\u5c31\u4ecehash1\u4e2d\u7684\u7b2c\u4e00\u4e2a\u7d22\u5f15\u4f4d\u7f6e\uff0c\u987a\u5e26\u5c06\u8fd9\u4e2a\u7d22\u5f15\u4f4d\u7f6e\u4e0a\u7684\u6240\u6709entries\u62f7\u8d1d\u5230hash2\u4e2d\u3002 \u538b\u7f29\u5217\u8868\uff0c\u8df3\u8868\u7684\u7279\u70b9 \u538b\u7f29\u5217\u8868\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u6570\u7ec4\uff0c\u4e0d\u540c\u7684\u662f:\u538b\u7f29\u5217\u8868\u5728\u8868\u5934\u6709\u4e09\u4e2a\u5b57\u6bb5zlbytes,zltail\u548czllen\u5206\u522b\u8868\u793a\u957f\u5ea6\uff0c\u5217\u8868\u5c3e\u7684\u504f\u79fb\u91cf\u548c\u5217\u8868\u4e2d\u7684entry\u7684\u4e2a\u6570\uff0c\u538b\u7f29\u5217\u8868\u5c3e\u90e8\u8fd8\u6709\u4e00\u4e2azlend\uff0c\u8868\u793a\u5217\u8868\u7ed3\u675f\u6240\u4ee5\u538b\u7f29\u5217\u8868\u5b9a\u4f4d\u7b2c\u4e00\u4e2a\u548c\u6700\u540e\u4e00\u4e2a\u662fO(1),\u4f46\u5176\u4ed6\u5c31\u662fO(n) \u8df3\u8868\uff1a\u662f\u5728\u94fe\u8868\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u591a\u7ea7\u7d22\u5f15\uff0c\u901a\u8fc7\u7d22\u5f15\u7684\u51e0\u6b21\u8df3\u8f6c\uff0c\u5b9e\u73b0\u6570\u636e\u5feb\u901f\u5b9a\u4f4d \u63d0\u95ee \uff1a \u6574\u6570\u6570\u7ec4\u548c\u538b\u7f29\u5217\u8868\u5728\u67e5\u627e\u65f6\u95f4\u590d\u6742\u5ea6\u65b9\u9762\u5e76\u6ca1\u6709\u5f88\u5927\u7684\u4f18\u52bf\uff0c\u90a3\u4e3a\u4ec0\u4e48 Redis \u8fd8\u4f1a\u628a\u5b83\u4eec\u4f5c\u4e3a\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5462\uff1f \u5185\u5b58\u5229\u7528\u7387\uff0c\u6570\u7ec4\u548c\u538b\u7f29\u5217\u8868\u90fd\u662f\u975e\u5e38\u7d27\u51d1\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u6bd4\u94fe\u8868\u5360\u7528\u7684\u5185\u5b58\u8981\u66f4\u5c11\u3002Redis\u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u5927\u91cf\u6570\u636e\u5b58\u5230\u5185\u5b58\u4e2d\uff0c\u6b64\u65f6\u9700\u8981\u505a\u5c3d\u53ef\u80fd\u7684\u4f18\u5316\uff0c\u63d0\u9ad8\u5185\u5b58\u7684\u5229\u7528\u7387\u3002 \u6570\u7ec4\u5bf9CPU\u9ad8\u901f\u7f13\u5b58\u652f\u6301\u66f4\u53cb\u597d\uff0c\u6240\u4ee5Redis\u5728\u8bbe\u8ba1\u65f6\uff0c\u96c6\u5408\u6570\u636e\u5143\u7d20\u8f83\u5c11\u60c5\u51b5\u4e0b\uff0c\u9ed8\u8ba4\u91c7\u7528\u5185\u5b58\u7d27\u51d1\u6392\u5217\u7684\u65b9\u5f0f\u5b58\u50a8\uff0c\u540c\u65f6\u5229\u7528CPU\u9ad8\u901f\u7f13\u5b58\u4e0d\u4f1a\u964d\u4f4e\u8bbf\u95ee\u901f\u5ea6\u3002\u5f53\u6570\u636e\u5143\u7d20\u8d85\u8fc7\u8bbe\u5b9a\u9608\u503c\u540e\uff0c\u907f\u514d\u67e5\u8be2\u65f6\u95f4\u590d\u6742\u5ea6\u592a\u9ad8\uff0c\u8f6c\u4e3a\u54c8\u5e0c\u548c\u8df3\u8868\u6570\u636e\u7ed3\u6784\u5b58\u50a8\uff0c\u4fdd\u8bc1\u67e5\u8be2\u6548\u7387\u3002","title":"6-1 \u8981\u70b9\u77e5\u8bc6"},{"location":"chap2/3redis_io/","text":"\u7b2c\u4e09\u8282 \u9ad8\u6027\u80fdIO\u6a21\u578b\uff1aRedis\u4e3a\u4ec0\u4e48\u90a3\u4e48\u5feb\uff1f Redis \u662f\u5355\u7ebf\u7a0b\uff0c \u4e3b\u8981\u662f\u6307 Redis \u7684\u7f51\u7edc IO \u548c\u952e\u503c\u5bf9\u8bfb\u5199\u662f\u7531\u4e00\u4e2a\u7ebf\u7a0b\u6765\u5b8c\u6210\u7684\uff0c\u8fd9\u4e5f\u662f Redis \u5bf9\u5916\u63d0\u4f9b\u952e\u503c\u5b58\u50a8\u670d\u52a1\u7684\u4e3b\u8981\u6d41\u7a0b\u3002 \u4f46 Redis \u7684\u5176\u4ed6\u529f\u80fd\uff0c\u6bd4\u5982\u6301\u4e45\u5316\u3001\u5f02\u6b65\u5220\u9664\u3001\u96c6\u7fa4\u6570\u636e\u540c\u6b65\u7b49\uff0c\u5176\u5b9e\u662f\u7531\u989d\u5916\u7684\u7ebf\u7a0b\u6267\u884c\u7684\u3002 \u7f51\u7edcIO\u548c\u952e\u503c\u5bf9\u8bfb\u5199\u662f\u5355\u7ebf\u7a0b\uff0c\u5176\u4f59\u64cd\u4f5c\u5219\u53ef\u80fd\u4f1a\u6709\u5b50\u8fdb\u7a0b\u6216\u5b50\u7ebf\u7a0b \u6240\u4ee5\uff0c\u4e25\u683c\u6765\u8bf4\uff0cRedis \u5e76\u4e0d\u662f\u5355\u7ebf\u7a0b 1\u3001Redis \u4e3a\u4ec0\u4e48\u7528\u5355\u7ebf\u7a0b\uff1f 1-1 \u591a\u7ebf\u7a0b\u7684\u5f00\u9500 \u4f7f\u7528\u591a\u7ebf\u7a0b\uff0c\u53ef\u4ee5\u589e\u52a0\u7cfb\u7edf\u541e\u5410\u7387\uff0c\u6216\u662f\u53ef\u4ee5\u589e\u52a0\u7cfb\u7edf\u6269\u5c55\u6027\u3002 \u7684\u786e\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u591a\u7ebf\u7a0b\u7684\u7cfb\u7edf\u6765\u8bf4\uff0c\u5728\u6709\u5408\u7406\u7684\u8d44\u6e90\u5206\u914d\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u589e\u52a0\u7cfb\u7edf\u4e2d\u5904\u7406\u8bf7\u6c42\u64cd\u4f5c\u7684\u8d44\u6e90\u5b9e\u4f53\uff0c\u8fdb\u800c\u63d0\u5347\u7cfb\u7edf\u80fd\u591f\u540c\u65f6\u5904\u7406\u7684\u8bf7\u6c42\u6570\uff0c \u5373\u541e\u5410\u7387 \u3002 \u4f46\u662f\uff0c\u91c7\u7528\u591a\u7ebf\u7a0b\u540e\uff0c\u5982\u679c\u6ca1\u6709\u826f\u597d\u7684\u7cfb\u7edf\u8bbe\u8ba1\uff0c\u5b9e\u9645\u5f97\u5230\u7684\u7ed3\u679c\uff0c\u5176\u5b9e\u662f\u53f3\u56fe\u6240\u5c55\u793a\u7684\u90a3\u6837\u3002 \u6211\u4eec\u521a\u5f00\u59cb\u589e\u52a0\u7ebf\u7a0b\u6570\u65f6\uff0c\u7cfb\u7edf\u541e\u5410\u7387\u4f1a\u589e\u52a0\uff0c\u4f46\u662f\uff0c\u518d\u8fdb\u4e00\u6b65\u589e\u52a0\u7ebf\u7a0b\u65f6\uff0c\u7cfb\u7edf\u541e\u5410\u7387\u5c31\u589e\u957f\u8fdf\u7f13\u4e86\uff0c\u6709\u65f6\u751a\u81f3\u8fd8\u4f1a\u51fa\u73b0\u4e0b\u964d\u7684\u60c5\u51b5\u3002 \u63d0\u9ad8\u5e76\u53d1\u5ea6\uff0c\u5e76\u4e0d\u4e00\u5b9a\u975e\u5f97\u91c7\u7528\u591a\u7ebf\u7a0b\u7684\u65b9\u5f0f\uff1b\u91c7\u7528\u591a\u8def\u590d\u7528\u3001\u4e8b\u4ef6\u9a71\u52a8\u7684\u65b9\u5f0f\u4e5f\u53ef\u4ee5\u3002 \u4e00\u4e2a\u5173\u952e\u7684\u74f6\u9888\u5728\u4e8e\uff0c \u7cfb\u7edf\u4e2d\u901a\u5e38\u4f1a\u5b58\u5728\u88ab\u591a\u7ebf\u7a0b\u540c\u65f6\u8bbf\u95ee\u7684\u5171\u4eab\u8d44\u6e90\uff0c\u6bd4\u5982\u4e00\u4e2a\u5171\u4eab\u7684\u6570\u636e\u7ed3\u6784 \u3002 \u5f53\u6709\u591a\u4e2a\u7ebf\u7a0b\u8981\u4fee\u6539\u8fd9\u4e2a\u5171\u4eab\u8d44\u6e90\u65f6\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u5171\u4eab\u8d44\u6e90\u7684\u6b63\u786e\u6027\uff0c\u5c31\u9700\u8981\u6709\u989d\u5916\u7684\u673a\u5236\u8fdb\u884c\u4fdd\u8bc1\uff0c\u800c\u8fd9\u4e2a\u989d\u5916\u7684\u673a\u5236\uff0c\u5c31\u4f1a\u5e26\u6765\u989d\u5916\u7684\u5f00\u9500\u3002 \u62ff Redis \u6765\u8bf4\uff0c\u5728\u4e0a\u8282\uff0c\u63d0\u5230\u8fc7\uff0c Redis \u6709 List \u7684\u6570\u636e\u7c7b\u578b\uff0c\u5e76\u63d0\u4f9b\u51fa\u961f\uff08LPOP\uff09\u548c\u5165\u961f\uff08LPUSH\uff09\u64cd\u4f5c \u3002 \u5047\u8bbe Redis \u91c7\u7528\u591a\u7ebf\u7a0b\u8bbe\u8ba1\uff0c\u73b0\u5728\u6709\u4e24\u4e2a\u7ebf\u7a0b A \u548c B\uff0c \u7ebf\u7a0b A \u5bf9\u4e00\u4e2a List \u505a LPUSH \u64cd\u4f5c\uff0c\u5e76\u5bf9\u961f\u5217\u957f\u5ea6\u52a0 1\u3002 \u540c\u65f6\uff0c\u7ebf\u7a0b B \u5bf9\u8be5 List \u6267\u884c LPOP \u64cd\u4f5c\uff0c\u5e76\u5bf9\u961f\u5217\u957f\u5ea6\u51cf 1\u3002 \u4e3a\u4e86\u4fdd\u8bc1\u961f\u5217\u957f\u5ea6\u7684\u6b63\u786e\u6027\uff0cRedis \u9700\u8981\u8ba9\u7ebf\u7a0b A \u548c B \u7684 LPUSH \u548c LPOP \u4e32\u884c\u6267\u884c\uff0c\u8fd9\u6837\u4e00\u6765\uff0cRedis \u53ef\u4ee5\u65e0\u8bef\u5730\u8bb0\u5f55\u5b83\u4eec\u5bf9 List \u957f\u5ea6\u7684\u4fee\u6539\u3002 \u5426\u5219\uff0c\u6211\u4eec\u53ef\u80fd\u5c31\u4f1a\u5f97\u5230\u9519\u8bef\u7684\u957f\u5ea6\u7ed3\u679c\u3002 \u8fd9\u5c31\u662f\u591a\u7ebf\u7a0b\u7f16\u7a0b\u6a21\u5f0f\u9762\u4e34\u7684\u5171\u4eab\u8d44\u6e90\u7684\u5e76\u53d1\u8bbf\u95ee\u63a7\u5236\u95ee\u9898\u3002 \u591a\u7ebf\u7a0b\u5e76\u53d1\u8bbf\u95eeRedis \u5e76\u53d1\u8bbf\u95ee\u63a7\u5236\u4e00\u76f4\u662f\u591a\u7ebf\u7a0b\u5f00\u53d1\u4e2d\u7684\u4e00\u4e2a\u96be\u70b9\u95ee\u9898\uff0c\u5982\u679c\u6ca1\u6709\u7cbe\u7ec6\u7684\u8bbe\u8ba1\uff0c\u6bd4\u5982\u8bf4\uff0c \u53ea\u662f\u7b80\u5355\u5730\u91c7\u7528\u4e00\u4e2a\u7c97\u7c92\u5ea6\u4e92\u65a5\u9501\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e0d\u7406\u60f3\u7684\u7ed3\u679c \uff1a \u5373\u4f7f\u589e\u52a0\u4e86\u7ebf\u7a0b\uff0c\u5927\u90e8\u5206\u7ebf\u7a0b\u4e5f\u5728\u7b49\u5f85\u83b7\u53d6\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u7684\u4e92\u65a5\u9501\uff0c\u5e76\u884c\u53d8\u4e32\u884c\uff0c\u7cfb\u7edf\u541e\u5410\u7387\u5e76\u6ca1\u6709\u968f\u7740\u7ebf\u7a0b\u7684\u589e\u52a0\u800c\u589e\u52a0\u3002 \u4e3a\u4e86\u907f\u514d\u8fd9\u4e9b\u95ee\u9898\uff0cRedis \u76f4\u63a5\u91c7\u7528\u4e86\u5355\u7ebf\u7a0b\u6a21\u5f0f\u3002 2\u3001\u5355\u7ebf\u7a0b Redis \u4e3a\u4ec0\u4e48\u90a3\u4e48\u5feb\uff1f \u4e00\u65b9\u9762\uff0c Redis \u7684\u5927\u90e8\u5206\u64cd\u4f5c\u5728\u5185\u5b58\u4e0a\u5b8c\u6210\uff0c\u518d\u52a0\u4e0a\u5b83\u91c7\u7528\u4e86\u9ad8\u6548\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4f8b\u5982\u54c8\u5e0c\u8868\u548c\u8df3\u8868\uff0c\u8fd9\u662f\u5b83\u5b9e\u73b0\u9ad8\u6027\u80fd\u7684\u4e00\u4e2a\u91cd\u8981\u539f\u56e0\u3002 \u53e6\u4e00\u65b9\u9762\uff0c \u5c31\u662f Redis \u91c7\u7528\u4e86 \u591a\u8def\u590d\u7528\u673a\u5236 \uff0c\u4f7f\u5176\u5728\u7f51\u7edc IO \u64cd\u4f5c\u4e2d\u80fd\u5e76\u53d1\u5904\u7406\u5927\u91cf\u7684\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u5b9e\u73b0\u9ad8\u541e\u5410\u7387\u3002 2-1 \u57fa\u672c IO \u6a21\u578b\u4e0e\u963b\u585e\u70b9 \u9996\u5148\uff0c \u6211\u4eec\u8981\u5f04\u660e\u767d\u7f51\u7edc\u64cd\u4f5c\u7684\u57fa\u672c IO \u6a21\u578b\u548c\u6f5c\u5728\u7684\u963b\u585e\u70b9 \u3002\u6bd5\u7adf\uff0cRedis \u91c7\u7528\u5355\u7ebf\u7a0b\u8fdb\u884c IO\uff0c\u5982\u679c\u7ebf\u7a0b\u88ab\u963b\u585e\u4e86\uff0c\u5c31\u65e0\u6cd5\u8fdb\u884c\u591a\u8def\u590d\u7528\u4e86\u3002 \u4f8b\u5982\uff0c\u7f51\u7edc\u6846\u67b6\u7684 SimpleKV \u4ee5 Get \u8bf7\u6c42\u4e3a\u4f8b\uff0cSimpleKV \u4e3a\u4e86\u5904\u7406\u4e00\u4e2a Get \u8bf7\u6c42\uff0c \u9700\u8981\u76d1\u542c\u5ba2\u6237\u7aef\u8bf7\u6c42\uff08bind/listen\uff09 \u548c\u5ba2\u6237\u7aef\u5efa\u7acb\u8fde\u63a5\uff08accept\uff09 \u4ece socket \u4e2d\u8bfb\u53d6\u8bf7\u6c42\uff08recv\uff09 \u89e3\u6790\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\uff08parse\uff09 \u6839\u636e\u8bf7\u6c42\u7c7b\u578b\u8bfb\u53d6\u952e\u503c\u6570\u636e\uff08get\uff09 \u6700\u540e\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u7ed3\u679c\uff0c\u5373\u5411 socket \u4e2d\u5199\u56de\u6570\u636e\uff08send\uff09\u3002 \u5176\u4e2d\uff0cbind/listen\u3001accept\u3001recv\u3001parse \u548c send \u5c5e\u4e8e\u7f51\u7edc IO \u5904\u7406\uff0c\u800c get \u5c5e\u4e8e\u952e\u503c\u6570\u636e\u64cd\u4f5c \u3002 \u65e2\u7136 Redis \u662f\u5355\u7ebf\u7a0b\uff0c\u90a3\u4e48\uff0c\u6700\u57fa\u672c\u7684\u4e00\u79cd\u5b9e\u73b0\u662f\u5728\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u4f9d\u6b21\u6267\u884c\u4e0a\u9762\u8bf4\u7684\u8fd9\u4e9b\u64cd\u4f5c\u3002 \u4f46\u662f\uff0c\u5728\u8fd9\u91cc\u7684\u7f51\u7edc IO \u64cd\u4f5c\u4e2d\uff0c\u6709\u6f5c\u5728\u7684\u963b\u585e\u70b9\uff0c\u5206\u522b\u662f accept() \u548c recv()\u3002 \u5f53 Redis \u76d1\u542c\u5230\u4e00\u4e2a\u5ba2\u6237\u7aef\u6709\u8fde\u63a5\u8bf7\u6c42\uff0c\u4f46\u4e00\u76f4\u672a\u80fd\u6210\u529f\u5efa\u7acb\u8d77\u8fde\u63a5\u65f6\uff0c\u4f1a\u963b\u585e\u5728 accept() \u51fd\u6570\u8fd9\u91cc\uff0c\u5bfc\u81f4\u5176\u4ed6\u5ba2\u6237\u7aef\u65e0\u6cd5\u548c Redis \u5efa\u7acb\u8fde\u63a5\u3002 \u7c7b\u4f3c\u7684\uff0c\u5f53 Redis \u901a\u8fc7 recv() \u4ece\u4e00\u4e2a\u5ba2\u6237\u7aef\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u5982\u679c\u6570\u636e\u4e00\u76f4\u6ca1\u6709\u5230\u8fbe\uff0cRedis \u4e5f\u4f1a\u4e00\u76f4\u963b\u585e\u5728 recv()\u3002 \u5bfc\u81f4 Redis \u6574\u4e2a\u7ebf\u7a0b\u963b\u585e\uff0c\u65e0\u6cd5\u5904\u7406\u5176\u4ed6\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u6548\u7387\u5f88\u4f4e\u3002 \u4e0d\u8fc7\uff0c\u5e78\u8fd0\u7684\u662f\uff0csocket \u7f51\u7edc\u6a21\u578b\u672c\u8eab\u652f\u6301\u975e\u963b\u585e\u6a21\u5f0f\u3002 2-2 \u975e\u963b\u585e\u6a21\u5f0f Socket \u7f51\u7edc\u6a21\u578b\u7684\u975e\u963b\u585e\u6a21\u5f0f\u8bbe\u7f6e\uff0c\u4e3b\u8981\u4f53\u73b0\u5728\u4e09\u4e2a\u5173\u952e\u7684\u51fd\u6570\u8c03\u7528\u4e0a \u5728 socket \u6a21\u578b\u4e2d\uff0c\u4e0d\u540c\u64cd\u4f5c\u8c03\u7528\u540e\u4f1a\u8fd4\u56de\u4e0d\u540c\u7684\u5957\u63a5\u5b57\u7c7b\u578b\u3002 socket() \u65b9\u6cd5\u4f1a\u8fd4\u56de\u4e3b\u52a8\u5957\u63a5\u5b57\uff0c\u7136\u540e\u8c03\u7528 listen() \u65b9\u6cd5\uff0c\u5c06\u4e3b\u52a8\u5957\u63a5\u5b57\u8f6c\u5316\u4e3a\u76d1\u542c\u5957\u63a5\u5b57 \uff0c\u6b64\u65f6\uff0c\u53ef\u4ee5\u76d1\u542c\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u8bf7\u6c42\u3002 \u6700\u540e\uff0c\u8c03\u7528 accept() \u65b9\u6cd5\u63a5\u6536\u5230\u8fbe\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\uff0c\u5e76\u8fd4\u56de\u5df2\u8fde\u63a5\u5957\u63a5\u5b57\u3002 2-3 \u76d1\u542c\u5957\u63a5\u5b57 - \u975e\u963b\u585e\u6a21\u5f0f \u9488\u5bf9\u76d1\u542c\u5957\u63a5\u5b57\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e\u975e\u963b\u585e\u6a21\u5f0f\uff1a \u5f53 Redis \u8c03\u7528 accept() \u4f46\u4e00\u76f4\u672a\u6709\u8fde\u63a5\u8bf7\u6c42\u5230\u8fbe\u65f6\uff0cRedis \u7ebf\u7a0b\u53ef\u4ee5\u8fd4\u56de\u5904\u7406\u5176\u4ed6\u64cd\u4f5c\uff0c\u800c\u4e0d\u7528\u4e00\u76f4\u7b49\u5f85 \u3002 \u8c03\u7528 accept() \u65f6\uff0c\u5df2\u7ecf\u5b58\u5728\u76d1\u542c\u5957\u63a5\u5b57\u4e86\u3002 \u867d\u7136 Redis \u7ebf\u7a0b\u53ef\u4ee5\u4e0d\u7528\u7ee7\u7eed\u7b49\u5f85\uff0c\u4f46\u662f\u603b\u5f97\u6709\u673a\u5236\u7ee7\u7eed\u5728\u76d1\u542c\u5957\u63a5\u5b57\u4e0a\u7b49\u5f85\u540e\u7eed\u8fde\u63a5\u8bf7\u6c42\uff0c\u5e76\u5728\u6709\u8bf7\u6c42\u65f6\u901a\u77e5 Redis\u3002 Linux\u4e2dSocket\u7f51\u7edc\u6a21\u578b\u7684\u975e\u963b\u585e\u6a21\u5f0f\u7684\u8bbe\u7f6e 2-4 \u8fde\u63a5\u5957\u63a5\u5b57 - \u975e\u963b\u585e\u6a21\u5f0f \u7c7b\u4f3c\u7684\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u9488\u5bf9\u5df2\u8fde\u63a5\u5957\u63a5\u5b57\u8bbe\u7f6e\u975e\u963b\u585e\u6a21\u5f0f\uff1aRedis \u8c03\u7528 recv() \u540e\uff0c\u5982\u679c\u5df2\u8fde\u63a5\u5957\u63a5\u5b57\u4e0a\u4e00\u76f4\u6ca1\u6709\u6570\u636e\u5230\u8fbe\uff0cRedis \u7ebf\u7a0b\u540c\u6837\u53ef\u4ee5\u8fd4\u56de\u5904\u7406\u5176\u4ed6\u64cd\u4f5c\u3002 \u4e5f\u9700\u8981\u6709\u673a\u5236\u7ee7\u7eed\u76d1\u542c\u8be5\u5df2\u8fde\u63a5\u5957\u63a5\u5b57\uff0c\u5e76\u5728\u6709\u6570\u636e\u8fbe\u5230\u65f6\u901a\u77e5 Redis\u3002 \u8fd9\u6837\u624d\u80fd\u4fdd\u8bc1 Redis \u7ebf\u7a0b\uff0c\u65e2\u4e0d\u4f1a\u50cf\u57fa\u672c IO \u6a21\u578b\u4e2d\u4e00\u76f4\u5728\u963b\u585e\u70b9\u7b49\u5f85\uff0c\u4e5f\u4e0d\u4f1a\u5bfc\u81f4 Redis \u65e0\u6cd5\u5904\u7406\u5b9e\u9645\u5230\u8fbe\u7684\u8fde\u63a5\u8bf7\u6c42\u6216\u6570\u636e\u3002 Linux \u4e2d\u7684 IO \u591a\u8def\u590d\u7528\u673a\u5236\u5c31\u8981\u767b\u573a\u4e86\u3002 3\u3001\u57fa\u4e8e\u591a\u8def\u590d\u7528\u7684\u9ad8\u6027\u80fd I/O \u6a21\u578b Linux \u4e2d\u7684 IO \u591a\u8def\u590d\u7528\u673a\u5236\u662f\u6307 \u4e00\u4e2a\u7ebf\u7a0b\u5904\u7406\u591a\u4e2a IO \u6d41 \uff0c \u5c31\u662f\u6211\u4eec\u7ecf\u5e38\u542c\u5230\u7684 select/epoll \u673a\u5236 \u3002 \u7b80\u5355\u6765\u8bf4\uff0c \u5728 Redis \u53ea\u8fd0\u884c\u5355\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\uff0c\u8be5\u673a\u5236\u5141\u8bb8\u5185\u6838\u4e2d\uff0c\u540c\u65f6\u5b58\u5728\u591a\u4e2a\u76d1\u542c\u5957\u63a5\u5b57\u548c\u5df2\u8fde\u63a5\u5957\u63a5\u5b57\u3002 \u5185\u6838\u4f1a\u4e00\u76f4\u76d1\u542c\u8fd9\u4e9b\u5957\u63a5\u5b57\u4e0a\u7684\u8fde\u63a5\u8bf7\u6c42\u6216\u6570\u636e\u8bf7\u6c42\u3002\u4e00\u65e6\u6709\u8bf7\u6c42\u5230\u8fbe\uff0c\u5c31\u4f1a\u4ea4\u7ed9 Redis \u7ebf\u7a0b\u5904\u7406\uff0c\u8fd9\u5c31\u5b9e\u73b0\u4e86\u4e00\u4e2a Redis \u7ebf\u7a0b\u5904\u7406\u591a\u4e2a IO \u6d41\u7684\u6548\u679c\u3002 \u56fe\u4e2d\u7684\u591a\u4e2a FD \u5c31\u662f\u521a\u624d\u6240\u8bf4\u7684\u591a\u4e2a\u5957\u63a5\u5b57\u3002Redis \u7f51\u7edc\u6846\u67b6\u8c03\u7528 epoll \u673a\u5236\uff0c\u8ba9\u5185\u6838\u76d1\u542c\u8fd9\u4e9b\u5957\u63a5\u5b57\u3002 \u6b64\u65f6\uff0cRedis \u7ebf\u7a0b\u4e0d\u4f1a\u963b\u585e\u5728\u67d0\u4e00\u4e2a\u7279\u5b9a\u7684\u76d1\u542c\u6216\u5df2\u8fde\u63a5\u5957\u63a5\u5b57\u4e0a\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e0d\u4f1a\u963b\u585e\u5728\u67d0\u4e00\u4e2a\u7279\u5b9a\u7684\u5ba2\u6237\u7aef\u8bf7\u6c42\u5904\u7406\u4e0a\u3002 \u6b63\u56e0\u4e3a\u6b64\uff0cRedis \u53ef\u4ee5\u540c\u65f6\u548c\u591a\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u5e76\u5904\u7406\u8bf7\u6c42\uff0c\u4ece\u800c\u63d0\u5347\u5e76\u53d1\u6027\u3002 \u4e3a\u4e86\u5728\u8bf7\u6c42\u5230\u8fbe\u65f6\u80fd\u901a\u77e5\u5230 Redis \u7ebf\u7a0b\uff0c select/epoll \u63d0\u4f9b\u4e86\u57fa\u4e8e\u4e8b\u4ef6\u7684\u56de\u8c03\u673a\u5236\uff0c\u5373\u9488\u5bf9\u4e0d\u540c\u4e8b\u4ef6\u7684\u53d1\u751f\uff0c\u8c03\u7528\u76f8\u5e94\u7684\u5904\u7406\u51fd\u6570\u3002 \u6240\u6709\u6dfb\u52a0\u5230epoll\u4e2d\u7684\u4e8b\u4ef6\u90fd\u4f1a\u4e0e\u8bbe\u5907(\u7f51\u5361)\u9a71\u52a8\u7a0b\u5e8f\u5efa\u7acb\u56de\u8c03\u5173\u7cfb\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u76f8\u5e94\u7684\u4e8b\u4ef6\u53d1\u751f\u65f6\u4f1a\u8c03\u7528\u8fd9\u4e2a\u56de\u8c03\u65b9\u6cd5\u3002 \u8fd9\u4e2a\u56de\u8c03\u65b9\u6cd5\u5728\u5185\u6838\u4e2d\u53eb ep_poll_callback ,\u5b83\u4f1a\u5c06\u53d1\u751f\u7684\u4e8b\u4ef6\u6dfb\u52a0\u5230rdlist\u53cc\u94fe\u8868\u4e2d\u3002 3-1 \u56de\u8c03\u673a\u5236\u7684\u5de5\u4f5c\u539f\u7406 \u5176\u5b9e\uff0cselect/epoll \u4e00\u65e6\u76d1\u6d4b\u5230 FD \u4e0a\u6709\u8bf7\u6c42\u5230\u8fbe\u65f6\uff0c\u5c31\u4f1a\u89e6\u53d1\u76f8\u5e94\u7684\u4e8b\u4ef6\u3002 \u8fd9\u4e9b\u4e8b\u4ef6\u4f1a\u88ab\u653e\u8fdb\u4e00\u4e2a\u4e8b\u4ef6\u961f\u5217\uff0cRedis \u5355\u7ebf\u7a0b\u5bf9\u8be5\u4e8b\u4ef6\u961f\u5217\u4e0d\u65ad\u8fdb\u884c\u5904\u7406\u3002\u8fd9\u6837\u4e00\u6765\uff0cRedis \u65e0\u9700\u4e00\u76f4\u8f6e\u8be2\u662f\u5426\u6709\u8bf7\u6c42\u5b9e\u9645\u53d1\u751f\uff0c\u8fd9\u5c31\u53ef\u4ee5\u907f\u514d\u9020\u6210 CPU \u8d44\u6e90\u6d6a\u8d39 \u540c\u65f6\uff0cRedis \u5728\u5bf9\u4e8b\u4ef6\u961f\u5217\u4e2d\u7684\u4e8b\u4ef6\u8fdb\u884c\u5904\u7406\u65f6\uff0c\u4f1a\u8c03\u7528\u76f8\u5e94\u7684\u5904\u7406\u51fd\u6570\uff0c\u8fd9\u5c31\u5b9e\u73b0\u4e86\u57fa\u4e8e\u4e8b\u4ef6\u7684\u56de\u8c03\u3002 \u56e0\u4e3a Redis \u4e00\u76f4\u5728\u5bf9\u4e8b\u4ef6\u961f\u5217\u8fdb\u884c\u5904\u7406\uff0c\u6240\u4ee5\u80fd\u53ca\u65f6\u54cd\u5e94\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u63d0\u5347 Redis \u7684\u54cd\u5e94\u6027\u80fd\u3002 \u4f8b\u5982\uff0c\u8bf7\u6c42\u548c\u8bfb\u6570\u636e\uff1a \u8fd9\u4e24\u4e2a\u8bf7\u6c42\u5206\u522b\u5bf9\u5e94 Accept \u4e8b\u4ef6\u548c Read \u4e8b\u4ef6\uff0cRedis \u5206\u522b\u5bf9\u8fd9\u4e24\u4e2a\u4e8b\u4ef6\u6ce8\u518c accept \u548c get \u56de\u8c03\u51fd\u6570\u3002 \u5f53 Linux \u5185\u6838\u76d1\u542c\u5230\u6709\u8fde\u63a5\u8bf7\u6c42\u6216\u8bfb\u6570\u636e\u8bf7\u6c42\u65f6\uff0c\u5c31\u4f1a\u89e6\u53d1 Accept \u4e8b\u4ef6\u548c Read \u4e8b\u4ef6\uff0c\u6b64\u65f6\uff0c\u5185\u6838\u5c31\u4f1a\u56de\u8c03 Redis \u76f8\u5e94\u7684 accept \u548c get \u51fd\u6570\u8fdb\u884c\u5904\u7406\u3002 \u8fd9\u5c31\u50cf\u75c5\u4eba\u53bb\u533b\u9662\u77a7\u75c5\u3002\u5728\u533b\u751f\u5b9e\u9645\u8bca\u65ad\u524d\uff0c\u6bcf\u4e2a\u75c5\u4eba\uff08\u7b49\u540c\u4e8e\u8bf7\u6c42\uff09\u90fd\u9700\u8981\u5148\u5206\u8bca\u3001\u6d4b\u4f53\u6e29\u3001\u767b\u8bb0\u7b49\u3002\u5982\u679c\u8fd9\u4e9b\u5de5\u4f5c\u90fd\u7531\u533b\u751f\u6765\u5b8c\u6210\uff0c\u533b\u751f\u7684\u5de5\u4f5c\u6548\u7387\u5c31\u4f1a\u5f88\u4f4e\u3002\u6240\u4ee5\uff0c\u533b\u9662\u90fd\u8bbe\u7f6e\u4e86\u5206\u8bca\u53f0\uff0c\u5206\u8bca\u53f0\u4f1a\u4e00\u76f4\u5904\u7406\u8fd9\u4e9b\u8bca\u65ad\u524d\u7684\u5de5\u4f5c\uff08\u7c7b\u4f3c\u4e8e Linux \u5185\u6838\u76d1\u542c\u8bf7\u6c42\uff09\uff0c\u7136\u540e\u518d\u8f6c\u4ea4\u7ed9\u533b\u751f\u505a\u5b9e\u9645\u8bca\u65ad\u3002\u8fd9\u6837\u5373\u4f7f\u4e00\u4e2a\u533b\u751f\uff08\u76f8\u5f53\u4e8e Redis \u5355\u7ebf\u7a0b\uff09\uff0c\u6548\u7387\u4e5f\u80fd\u63d0\u5347\u3002 \u4e0d\u8fc7\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5373\u4f7f\u4f60\u7684\u5e94\u7528\u573a\u666f\u4e2d\u90e8\u7f72\u4e86\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u591a\u8def\u590d\u7528\u673a\u5236\u4e5f\u662f\u9002\u7528\u7684\u3002\u56e0\u4e3a\u8fd9\u4e2a\u673a\u5236\u7684\u5b9e\u73b0\u6709\u5f88\u591a\u79cd\uff0c \u65e2\u6709\u57fa\u4e8e Linux \u7cfb\u7edf\u4e0b\u7684 select \u548c epoll \u5b9e\u73b0\uff0c\u4e5f\u6709\u57fa\u4e8e FreeBSD \u7684 kqueue \u5b9e\u73b0\uff0c\u4ee5\u53ca\u57fa\u4e8e Solaris \u7684 evport \u5b9e\u73b0 \u4e0d\u8fc7\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5373\u4f7f\u4f60\u7684\u5e94\u7528\u573a\u666f\u4e2d\u90e8\u7f72\u4e86\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u591a\u8def\u590d\u7528\u673a\u5236\u4e5f\u662f\u9002\u7528\u7684\u3002\u56e0\u4e3a\u8fd9\u4e2a\u673a\u5236\u7684\u5b9e\u73b0\u6709\u5f88\u591a\u79cd\uff0c\u65e2\u6709\u57fa\u4e8e Linux \u7cfb\u7edf\u4e0b\u7684 select \u548c epoll \u5b9e\u73b0\uff0c\u4e5f\u6709\u57fa\u4e8e FreeBSD \u7684 kqueue \u5b9e\u73b0\uff0c\u4ee5\u53ca\u57fa\u4e8e Solaris \u7684 evport \u5b9e\u73b0 4\u3001\u672c\u8282\u5c0f\u8282 Redis \u5355\u7ebf\u7a0b\u662f\u6307\u5b83\u5bf9\u7f51\u7edc IO \u548c\u6570\u636e\u8bfb\u5199\u7684\u64cd\u4f5c\u91c7\u7528\u4e86\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u800c\u91c7\u7528\u5355\u7ebf\u7a0b\u7684\u4e00\u4e2a\u6838\u5fc3\u539f\u56e0\u662f\u907f\u514d\u591a\u7ebf\u7a0b\u5f00\u53d1\u7684\u5e76\u53d1\u63a7\u5236\u95ee\u9898\u3002 \u5355\u7ebf\u7a0b\u7684 Redis \u4e5f\u80fd\u83b7\u5f97\u9ad8\u6027\u80fd\uff0c\u8ddf\u591a\u8def\u590d\u7528\u7684 IO \u6a21\u578b\u5bc6\u5207\u76f8\u5173\uff0c\u56e0\u4e3a\u8fd9\u907f\u514d\u4e86 accept() \u548c send()/recv() \u6f5c\u5728\u7684\u7f51\u7edc IO \u64cd\u4f5c\u963b\u585e\u70b9\u3002 \u672c\u7ae0\u9996\u5148\u4ece\u7b80\u5355\u7684\u7f51\u7edc\u901a\u4fe1socket\u8bb2\u8d77\uff0c\u5f15\u51fa\u4e86\u975e\u963b\u585esocket\uff0c\u7531\u6b64\u8c08\u5230\u4e86\u8457\u540d\u7684I/O\u591a\u8def\u590d\u7528\uff0cLinux\u5185\u6838\u7684select/epoll\u673a\u5236 \u672c\u7ae0\u7684\u5173\u952e\u5728\u4e8e\u5173\u952e\u70b9\u5728\u4e8eaccpet\u548crecv\u65f6\u53ef\u80fd\u4f1a\u963b\u585e\u7ebf\u7a0b\uff0c\u4f7f\u7528IO\u591a\u8def\u590d\u7528\u6280\u672f\u53ef\u4ee5\u8ba9\u7ebf\u7a0b\u5148\u5904\u7406\u5176\u4ed6\u4e8b\u60c5\uff0c\u7b49\u9700\u8981\u7684\u8d44\u6e90\u5230\u4f4d\u540eepoll\u4f1a\u8c03\u7528\u56de\u8c03\u51fd\u6570\u901a\u77e5\u7ebf\u7a0b\uff0c\u7136\u540e\u7ebf\u7a0b\u518d\u53bb\u5904\u7406\u5b58/\u53d6\u6570\u636e\uff1b\u8fd9\u6837\u4e00\u4e2aredis\u670d\u52a1\u7aef\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u540c\u65f6\u5904\u7406\u591a\u4e2a\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e86\u3002","title":"\u7b2c\u4e09\u8282 \u9ad8\u6027\u80fdIO\u6a21\u578b\uff1aRedis\u4e3a\u4ec0\u4e48\u90a3\u4e48\u5feb\uff1f"},{"location":"chap2/3redis_io/#ioredis","text":"Redis \u662f\u5355\u7ebf\u7a0b\uff0c \u4e3b\u8981\u662f\u6307 Redis \u7684\u7f51\u7edc IO \u548c\u952e\u503c\u5bf9\u8bfb\u5199\u662f\u7531\u4e00\u4e2a\u7ebf\u7a0b\u6765\u5b8c\u6210\u7684\uff0c\u8fd9\u4e5f\u662f Redis \u5bf9\u5916\u63d0\u4f9b\u952e\u503c\u5b58\u50a8\u670d\u52a1\u7684\u4e3b\u8981\u6d41\u7a0b\u3002 \u4f46 Redis \u7684\u5176\u4ed6\u529f\u80fd\uff0c\u6bd4\u5982\u6301\u4e45\u5316\u3001\u5f02\u6b65\u5220\u9664\u3001\u96c6\u7fa4\u6570\u636e\u540c\u6b65\u7b49\uff0c\u5176\u5b9e\u662f\u7531\u989d\u5916\u7684\u7ebf\u7a0b\u6267\u884c\u7684\u3002 \u7f51\u7edcIO\u548c\u952e\u503c\u5bf9\u8bfb\u5199\u662f\u5355\u7ebf\u7a0b\uff0c\u5176\u4f59\u64cd\u4f5c\u5219\u53ef\u80fd\u4f1a\u6709\u5b50\u8fdb\u7a0b\u6216\u5b50\u7ebf\u7a0b \u6240\u4ee5\uff0c\u4e25\u683c\u6765\u8bf4\uff0cRedis \u5e76\u4e0d\u662f\u5355\u7ebf\u7a0b","title":"\u7b2c\u4e09\u8282 \u9ad8\u6027\u80fdIO\u6a21\u578b\uff1aRedis\u4e3a\u4ec0\u4e48\u90a3\u4e48\u5feb\uff1f"},{"location":"chap2/3redis_io/#1redis","text":"","title":"1\u3001Redis \u4e3a\u4ec0\u4e48\u7528\u5355\u7ebf\u7a0b\uff1f"},{"location":"chap2/3redis_io/#1-1","text":"\u4f7f\u7528\u591a\u7ebf\u7a0b\uff0c\u53ef\u4ee5\u589e\u52a0\u7cfb\u7edf\u541e\u5410\u7387\uff0c\u6216\u662f\u53ef\u4ee5\u589e\u52a0\u7cfb\u7edf\u6269\u5c55\u6027\u3002 \u7684\u786e\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u591a\u7ebf\u7a0b\u7684\u7cfb\u7edf\u6765\u8bf4\uff0c\u5728\u6709\u5408\u7406\u7684\u8d44\u6e90\u5206\u914d\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u589e\u52a0\u7cfb\u7edf\u4e2d\u5904\u7406\u8bf7\u6c42\u64cd\u4f5c\u7684\u8d44\u6e90\u5b9e\u4f53\uff0c\u8fdb\u800c\u63d0\u5347\u7cfb\u7edf\u80fd\u591f\u540c\u65f6\u5904\u7406\u7684\u8bf7\u6c42\u6570\uff0c \u5373\u541e\u5410\u7387 \u3002 \u4f46\u662f\uff0c\u91c7\u7528\u591a\u7ebf\u7a0b\u540e\uff0c\u5982\u679c\u6ca1\u6709\u826f\u597d\u7684\u7cfb\u7edf\u8bbe\u8ba1\uff0c\u5b9e\u9645\u5f97\u5230\u7684\u7ed3\u679c\uff0c\u5176\u5b9e\u662f\u53f3\u56fe\u6240\u5c55\u793a\u7684\u90a3\u6837\u3002 \u6211\u4eec\u521a\u5f00\u59cb\u589e\u52a0\u7ebf\u7a0b\u6570\u65f6\uff0c\u7cfb\u7edf\u541e\u5410\u7387\u4f1a\u589e\u52a0\uff0c\u4f46\u662f\uff0c\u518d\u8fdb\u4e00\u6b65\u589e\u52a0\u7ebf\u7a0b\u65f6\uff0c\u7cfb\u7edf\u541e\u5410\u7387\u5c31\u589e\u957f\u8fdf\u7f13\u4e86\uff0c\u6709\u65f6\u751a\u81f3\u8fd8\u4f1a\u51fa\u73b0\u4e0b\u964d\u7684\u60c5\u51b5\u3002 \u63d0\u9ad8\u5e76\u53d1\u5ea6\uff0c\u5e76\u4e0d\u4e00\u5b9a\u975e\u5f97\u91c7\u7528\u591a\u7ebf\u7a0b\u7684\u65b9\u5f0f\uff1b\u91c7\u7528\u591a\u8def\u590d\u7528\u3001\u4e8b\u4ef6\u9a71\u52a8\u7684\u65b9\u5f0f\u4e5f\u53ef\u4ee5\u3002 \u4e00\u4e2a\u5173\u952e\u7684\u74f6\u9888\u5728\u4e8e\uff0c \u7cfb\u7edf\u4e2d\u901a\u5e38\u4f1a\u5b58\u5728\u88ab\u591a\u7ebf\u7a0b\u540c\u65f6\u8bbf\u95ee\u7684\u5171\u4eab\u8d44\u6e90\uff0c\u6bd4\u5982\u4e00\u4e2a\u5171\u4eab\u7684\u6570\u636e\u7ed3\u6784 \u3002 \u5f53\u6709\u591a\u4e2a\u7ebf\u7a0b\u8981\u4fee\u6539\u8fd9\u4e2a\u5171\u4eab\u8d44\u6e90\u65f6\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u5171\u4eab\u8d44\u6e90\u7684\u6b63\u786e\u6027\uff0c\u5c31\u9700\u8981\u6709\u989d\u5916\u7684\u673a\u5236\u8fdb\u884c\u4fdd\u8bc1\uff0c\u800c\u8fd9\u4e2a\u989d\u5916\u7684\u673a\u5236\uff0c\u5c31\u4f1a\u5e26\u6765\u989d\u5916\u7684\u5f00\u9500\u3002 \u62ff Redis \u6765\u8bf4\uff0c\u5728\u4e0a\u8282\uff0c\u63d0\u5230\u8fc7\uff0c Redis \u6709 List \u7684\u6570\u636e\u7c7b\u578b\uff0c\u5e76\u63d0\u4f9b\u51fa\u961f\uff08LPOP\uff09\u548c\u5165\u961f\uff08LPUSH\uff09\u64cd\u4f5c \u3002 \u5047\u8bbe Redis \u91c7\u7528\u591a\u7ebf\u7a0b\u8bbe\u8ba1\uff0c\u73b0\u5728\u6709\u4e24\u4e2a\u7ebf\u7a0b A \u548c B\uff0c \u7ebf\u7a0b A \u5bf9\u4e00\u4e2a List \u505a LPUSH \u64cd\u4f5c\uff0c\u5e76\u5bf9\u961f\u5217\u957f\u5ea6\u52a0 1\u3002 \u540c\u65f6\uff0c\u7ebf\u7a0b B \u5bf9\u8be5 List \u6267\u884c LPOP \u64cd\u4f5c\uff0c\u5e76\u5bf9\u961f\u5217\u957f\u5ea6\u51cf 1\u3002 \u4e3a\u4e86\u4fdd\u8bc1\u961f\u5217\u957f\u5ea6\u7684\u6b63\u786e\u6027\uff0cRedis \u9700\u8981\u8ba9\u7ebf\u7a0b A \u548c B \u7684 LPUSH \u548c LPOP \u4e32\u884c\u6267\u884c\uff0c\u8fd9\u6837\u4e00\u6765\uff0cRedis \u53ef\u4ee5\u65e0\u8bef\u5730\u8bb0\u5f55\u5b83\u4eec\u5bf9 List \u957f\u5ea6\u7684\u4fee\u6539\u3002 \u5426\u5219\uff0c\u6211\u4eec\u53ef\u80fd\u5c31\u4f1a\u5f97\u5230\u9519\u8bef\u7684\u957f\u5ea6\u7ed3\u679c\u3002 \u8fd9\u5c31\u662f\u591a\u7ebf\u7a0b\u7f16\u7a0b\u6a21\u5f0f\u9762\u4e34\u7684\u5171\u4eab\u8d44\u6e90\u7684\u5e76\u53d1\u8bbf\u95ee\u63a7\u5236\u95ee\u9898\u3002 \u591a\u7ebf\u7a0b\u5e76\u53d1\u8bbf\u95eeRedis \u5e76\u53d1\u8bbf\u95ee\u63a7\u5236\u4e00\u76f4\u662f\u591a\u7ebf\u7a0b\u5f00\u53d1\u4e2d\u7684\u4e00\u4e2a\u96be\u70b9\u95ee\u9898\uff0c\u5982\u679c\u6ca1\u6709\u7cbe\u7ec6\u7684\u8bbe\u8ba1\uff0c\u6bd4\u5982\u8bf4\uff0c \u53ea\u662f\u7b80\u5355\u5730\u91c7\u7528\u4e00\u4e2a\u7c97\u7c92\u5ea6\u4e92\u65a5\u9501\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e0d\u7406\u60f3\u7684\u7ed3\u679c \uff1a \u5373\u4f7f\u589e\u52a0\u4e86\u7ebf\u7a0b\uff0c\u5927\u90e8\u5206\u7ebf\u7a0b\u4e5f\u5728\u7b49\u5f85\u83b7\u53d6\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u7684\u4e92\u65a5\u9501\uff0c\u5e76\u884c\u53d8\u4e32\u884c\uff0c\u7cfb\u7edf\u541e\u5410\u7387\u5e76\u6ca1\u6709\u968f\u7740\u7ebf\u7a0b\u7684\u589e\u52a0\u800c\u589e\u52a0\u3002 \u4e3a\u4e86\u907f\u514d\u8fd9\u4e9b\u95ee\u9898\uff0cRedis \u76f4\u63a5\u91c7\u7528\u4e86\u5355\u7ebf\u7a0b\u6a21\u5f0f\u3002","title":"1-1 \u591a\u7ebf\u7a0b\u7684\u5f00\u9500"},{"location":"chap2/3redis_io/#2-redis","text":"\u4e00\u65b9\u9762\uff0c Redis \u7684\u5927\u90e8\u5206\u64cd\u4f5c\u5728\u5185\u5b58\u4e0a\u5b8c\u6210\uff0c\u518d\u52a0\u4e0a\u5b83\u91c7\u7528\u4e86\u9ad8\u6548\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4f8b\u5982\u54c8\u5e0c\u8868\u548c\u8df3\u8868\uff0c\u8fd9\u662f\u5b83\u5b9e\u73b0\u9ad8\u6027\u80fd\u7684\u4e00\u4e2a\u91cd\u8981\u539f\u56e0\u3002 \u53e6\u4e00\u65b9\u9762\uff0c \u5c31\u662f Redis \u91c7\u7528\u4e86 \u591a\u8def\u590d\u7528\u673a\u5236 \uff0c\u4f7f\u5176\u5728\u7f51\u7edc IO \u64cd\u4f5c\u4e2d\u80fd\u5e76\u53d1\u5904\u7406\u5927\u91cf\u7684\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u5b9e\u73b0\u9ad8\u541e\u5410\u7387\u3002","title":"2\u3001\u5355\u7ebf\u7a0b Redis \u4e3a\u4ec0\u4e48\u90a3\u4e48\u5feb\uff1f"},{"location":"chap2/3redis_io/#2-1-io","text":"\u9996\u5148\uff0c \u6211\u4eec\u8981\u5f04\u660e\u767d\u7f51\u7edc\u64cd\u4f5c\u7684\u57fa\u672c IO \u6a21\u578b\u548c\u6f5c\u5728\u7684\u963b\u585e\u70b9 \u3002\u6bd5\u7adf\uff0cRedis \u91c7\u7528\u5355\u7ebf\u7a0b\u8fdb\u884c IO\uff0c\u5982\u679c\u7ebf\u7a0b\u88ab\u963b\u585e\u4e86\uff0c\u5c31\u65e0\u6cd5\u8fdb\u884c\u591a\u8def\u590d\u7528\u4e86\u3002 \u4f8b\u5982\uff0c\u7f51\u7edc\u6846\u67b6\u7684 SimpleKV \u4ee5 Get \u8bf7\u6c42\u4e3a\u4f8b\uff0cSimpleKV \u4e3a\u4e86\u5904\u7406\u4e00\u4e2a Get \u8bf7\u6c42\uff0c \u9700\u8981\u76d1\u542c\u5ba2\u6237\u7aef\u8bf7\u6c42\uff08bind/listen\uff09 \u548c\u5ba2\u6237\u7aef\u5efa\u7acb\u8fde\u63a5\uff08accept\uff09 \u4ece socket \u4e2d\u8bfb\u53d6\u8bf7\u6c42\uff08recv\uff09 \u89e3\u6790\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\uff08parse\uff09 \u6839\u636e\u8bf7\u6c42\u7c7b\u578b\u8bfb\u53d6\u952e\u503c\u6570\u636e\uff08get\uff09 \u6700\u540e\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u7ed3\u679c\uff0c\u5373\u5411 socket \u4e2d\u5199\u56de\u6570\u636e\uff08send\uff09\u3002 \u5176\u4e2d\uff0cbind/listen\u3001accept\u3001recv\u3001parse \u548c send \u5c5e\u4e8e\u7f51\u7edc IO \u5904\u7406\uff0c\u800c get \u5c5e\u4e8e\u952e\u503c\u6570\u636e\u64cd\u4f5c \u3002 \u65e2\u7136 Redis \u662f\u5355\u7ebf\u7a0b\uff0c\u90a3\u4e48\uff0c\u6700\u57fa\u672c\u7684\u4e00\u79cd\u5b9e\u73b0\u662f\u5728\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u4f9d\u6b21\u6267\u884c\u4e0a\u9762\u8bf4\u7684\u8fd9\u4e9b\u64cd\u4f5c\u3002 \u4f46\u662f\uff0c\u5728\u8fd9\u91cc\u7684\u7f51\u7edc IO \u64cd\u4f5c\u4e2d\uff0c\u6709\u6f5c\u5728\u7684\u963b\u585e\u70b9\uff0c\u5206\u522b\u662f accept() \u548c recv()\u3002 \u5f53 Redis \u76d1\u542c\u5230\u4e00\u4e2a\u5ba2\u6237\u7aef\u6709\u8fde\u63a5\u8bf7\u6c42\uff0c\u4f46\u4e00\u76f4\u672a\u80fd\u6210\u529f\u5efa\u7acb\u8d77\u8fde\u63a5\u65f6\uff0c\u4f1a\u963b\u585e\u5728 accept() \u51fd\u6570\u8fd9\u91cc\uff0c\u5bfc\u81f4\u5176\u4ed6\u5ba2\u6237\u7aef\u65e0\u6cd5\u548c Redis \u5efa\u7acb\u8fde\u63a5\u3002 \u7c7b\u4f3c\u7684\uff0c\u5f53 Redis \u901a\u8fc7 recv() \u4ece\u4e00\u4e2a\u5ba2\u6237\u7aef\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u5982\u679c\u6570\u636e\u4e00\u76f4\u6ca1\u6709\u5230\u8fbe\uff0cRedis \u4e5f\u4f1a\u4e00\u76f4\u963b\u585e\u5728 recv()\u3002 \u5bfc\u81f4 Redis \u6574\u4e2a\u7ebf\u7a0b\u963b\u585e\uff0c\u65e0\u6cd5\u5904\u7406\u5176\u4ed6\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u6548\u7387\u5f88\u4f4e\u3002 \u4e0d\u8fc7\uff0c\u5e78\u8fd0\u7684\u662f\uff0csocket \u7f51\u7edc\u6a21\u578b\u672c\u8eab\u652f\u6301\u975e\u963b\u585e\u6a21\u5f0f\u3002","title":"2-1 \u57fa\u672c IO \u6a21\u578b\u4e0e\u963b\u585e\u70b9"},{"location":"chap2/3redis_io/#2-2","text":"Socket \u7f51\u7edc\u6a21\u578b\u7684\u975e\u963b\u585e\u6a21\u5f0f\u8bbe\u7f6e\uff0c\u4e3b\u8981\u4f53\u73b0\u5728\u4e09\u4e2a\u5173\u952e\u7684\u51fd\u6570\u8c03\u7528\u4e0a \u5728 socket \u6a21\u578b\u4e2d\uff0c\u4e0d\u540c\u64cd\u4f5c\u8c03\u7528\u540e\u4f1a\u8fd4\u56de\u4e0d\u540c\u7684\u5957\u63a5\u5b57\u7c7b\u578b\u3002 socket() \u65b9\u6cd5\u4f1a\u8fd4\u56de\u4e3b\u52a8\u5957\u63a5\u5b57\uff0c\u7136\u540e\u8c03\u7528 listen() \u65b9\u6cd5\uff0c\u5c06\u4e3b\u52a8\u5957\u63a5\u5b57\u8f6c\u5316\u4e3a\u76d1\u542c\u5957\u63a5\u5b57 \uff0c\u6b64\u65f6\uff0c\u53ef\u4ee5\u76d1\u542c\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u8bf7\u6c42\u3002 \u6700\u540e\uff0c\u8c03\u7528 accept() \u65b9\u6cd5\u63a5\u6536\u5230\u8fbe\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\uff0c\u5e76\u8fd4\u56de\u5df2\u8fde\u63a5\u5957\u63a5\u5b57\u3002","title":"2-2 \u975e\u963b\u585e\u6a21\u5f0f"},{"location":"chap2/3redis_io/#2-3-","text":"\u9488\u5bf9\u76d1\u542c\u5957\u63a5\u5b57\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e\u975e\u963b\u585e\u6a21\u5f0f\uff1a \u5f53 Redis \u8c03\u7528 accept() \u4f46\u4e00\u76f4\u672a\u6709\u8fde\u63a5\u8bf7\u6c42\u5230\u8fbe\u65f6\uff0cRedis \u7ebf\u7a0b\u53ef\u4ee5\u8fd4\u56de\u5904\u7406\u5176\u4ed6\u64cd\u4f5c\uff0c\u800c\u4e0d\u7528\u4e00\u76f4\u7b49\u5f85 \u3002 \u8c03\u7528 accept() \u65f6\uff0c\u5df2\u7ecf\u5b58\u5728\u76d1\u542c\u5957\u63a5\u5b57\u4e86\u3002 \u867d\u7136 Redis \u7ebf\u7a0b\u53ef\u4ee5\u4e0d\u7528\u7ee7\u7eed\u7b49\u5f85\uff0c\u4f46\u662f\u603b\u5f97\u6709\u673a\u5236\u7ee7\u7eed\u5728\u76d1\u542c\u5957\u63a5\u5b57\u4e0a\u7b49\u5f85\u540e\u7eed\u8fde\u63a5\u8bf7\u6c42\uff0c\u5e76\u5728\u6709\u8bf7\u6c42\u65f6\u901a\u77e5 Redis\u3002 Linux\u4e2dSocket\u7f51\u7edc\u6a21\u578b\u7684\u975e\u963b\u585e\u6a21\u5f0f\u7684\u8bbe\u7f6e","title":"2-3 \u76d1\u542c\u5957\u63a5\u5b57 - \u975e\u963b\u585e\u6a21\u5f0f"},{"location":"chap2/3redis_io/#2-4-","text":"\u7c7b\u4f3c\u7684\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u9488\u5bf9\u5df2\u8fde\u63a5\u5957\u63a5\u5b57\u8bbe\u7f6e\u975e\u963b\u585e\u6a21\u5f0f\uff1aRedis \u8c03\u7528 recv() \u540e\uff0c\u5982\u679c\u5df2\u8fde\u63a5\u5957\u63a5\u5b57\u4e0a\u4e00\u76f4\u6ca1\u6709\u6570\u636e\u5230\u8fbe\uff0cRedis \u7ebf\u7a0b\u540c\u6837\u53ef\u4ee5\u8fd4\u56de\u5904\u7406\u5176\u4ed6\u64cd\u4f5c\u3002 \u4e5f\u9700\u8981\u6709\u673a\u5236\u7ee7\u7eed\u76d1\u542c\u8be5\u5df2\u8fde\u63a5\u5957\u63a5\u5b57\uff0c\u5e76\u5728\u6709\u6570\u636e\u8fbe\u5230\u65f6\u901a\u77e5 Redis\u3002 \u8fd9\u6837\u624d\u80fd\u4fdd\u8bc1 Redis \u7ebf\u7a0b\uff0c\u65e2\u4e0d\u4f1a\u50cf\u57fa\u672c IO \u6a21\u578b\u4e2d\u4e00\u76f4\u5728\u963b\u585e\u70b9\u7b49\u5f85\uff0c\u4e5f\u4e0d\u4f1a\u5bfc\u81f4 Redis \u65e0\u6cd5\u5904\u7406\u5b9e\u9645\u5230\u8fbe\u7684\u8fde\u63a5\u8bf7\u6c42\u6216\u6570\u636e\u3002 Linux \u4e2d\u7684 IO \u591a\u8def\u590d\u7528\u673a\u5236\u5c31\u8981\u767b\u573a\u4e86\u3002","title":"2-4 \u8fde\u63a5\u5957\u63a5\u5b57 - \u975e\u963b\u585e\u6a21\u5f0f"},{"location":"chap2/3redis_io/#3-io","text":"Linux \u4e2d\u7684 IO \u591a\u8def\u590d\u7528\u673a\u5236\u662f\u6307 \u4e00\u4e2a\u7ebf\u7a0b\u5904\u7406\u591a\u4e2a IO \u6d41 \uff0c \u5c31\u662f\u6211\u4eec\u7ecf\u5e38\u542c\u5230\u7684 select/epoll \u673a\u5236 \u3002 \u7b80\u5355\u6765\u8bf4\uff0c \u5728 Redis \u53ea\u8fd0\u884c\u5355\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\uff0c\u8be5\u673a\u5236\u5141\u8bb8\u5185\u6838\u4e2d\uff0c\u540c\u65f6\u5b58\u5728\u591a\u4e2a\u76d1\u542c\u5957\u63a5\u5b57\u548c\u5df2\u8fde\u63a5\u5957\u63a5\u5b57\u3002 \u5185\u6838\u4f1a\u4e00\u76f4\u76d1\u542c\u8fd9\u4e9b\u5957\u63a5\u5b57\u4e0a\u7684\u8fde\u63a5\u8bf7\u6c42\u6216\u6570\u636e\u8bf7\u6c42\u3002\u4e00\u65e6\u6709\u8bf7\u6c42\u5230\u8fbe\uff0c\u5c31\u4f1a\u4ea4\u7ed9 Redis \u7ebf\u7a0b\u5904\u7406\uff0c\u8fd9\u5c31\u5b9e\u73b0\u4e86\u4e00\u4e2a Redis \u7ebf\u7a0b\u5904\u7406\u591a\u4e2a IO \u6d41\u7684\u6548\u679c\u3002 \u56fe\u4e2d\u7684\u591a\u4e2a FD \u5c31\u662f\u521a\u624d\u6240\u8bf4\u7684\u591a\u4e2a\u5957\u63a5\u5b57\u3002Redis \u7f51\u7edc\u6846\u67b6\u8c03\u7528 epoll \u673a\u5236\uff0c\u8ba9\u5185\u6838\u76d1\u542c\u8fd9\u4e9b\u5957\u63a5\u5b57\u3002 \u6b64\u65f6\uff0cRedis \u7ebf\u7a0b\u4e0d\u4f1a\u963b\u585e\u5728\u67d0\u4e00\u4e2a\u7279\u5b9a\u7684\u76d1\u542c\u6216\u5df2\u8fde\u63a5\u5957\u63a5\u5b57\u4e0a\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e0d\u4f1a\u963b\u585e\u5728\u67d0\u4e00\u4e2a\u7279\u5b9a\u7684\u5ba2\u6237\u7aef\u8bf7\u6c42\u5904\u7406\u4e0a\u3002 \u6b63\u56e0\u4e3a\u6b64\uff0cRedis \u53ef\u4ee5\u540c\u65f6\u548c\u591a\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u5e76\u5904\u7406\u8bf7\u6c42\uff0c\u4ece\u800c\u63d0\u5347\u5e76\u53d1\u6027\u3002 \u4e3a\u4e86\u5728\u8bf7\u6c42\u5230\u8fbe\u65f6\u80fd\u901a\u77e5\u5230 Redis \u7ebf\u7a0b\uff0c select/epoll \u63d0\u4f9b\u4e86\u57fa\u4e8e\u4e8b\u4ef6\u7684\u56de\u8c03\u673a\u5236\uff0c\u5373\u9488\u5bf9\u4e0d\u540c\u4e8b\u4ef6\u7684\u53d1\u751f\uff0c\u8c03\u7528\u76f8\u5e94\u7684\u5904\u7406\u51fd\u6570\u3002 \u6240\u6709\u6dfb\u52a0\u5230epoll\u4e2d\u7684\u4e8b\u4ef6\u90fd\u4f1a\u4e0e\u8bbe\u5907(\u7f51\u5361)\u9a71\u52a8\u7a0b\u5e8f\u5efa\u7acb\u56de\u8c03\u5173\u7cfb\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u76f8\u5e94\u7684\u4e8b\u4ef6\u53d1\u751f\u65f6\u4f1a\u8c03\u7528\u8fd9\u4e2a\u56de\u8c03\u65b9\u6cd5\u3002 \u8fd9\u4e2a\u56de\u8c03\u65b9\u6cd5\u5728\u5185\u6838\u4e2d\u53eb ep_poll_callback ,\u5b83\u4f1a\u5c06\u53d1\u751f\u7684\u4e8b\u4ef6\u6dfb\u52a0\u5230rdlist\u53cc\u94fe\u8868\u4e2d\u3002","title":"3\u3001\u57fa\u4e8e\u591a\u8def\u590d\u7528\u7684\u9ad8\u6027\u80fd I/O \u6a21\u578b"},{"location":"chap2/3redis_io/#3-1","text":"\u5176\u5b9e\uff0cselect/epoll \u4e00\u65e6\u76d1\u6d4b\u5230 FD \u4e0a\u6709\u8bf7\u6c42\u5230\u8fbe\u65f6\uff0c\u5c31\u4f1a\u89e6\u53d1\u76f8\u5e94\u7684\u4e8b\u4ef6\u3002 \u8fd9\u4e9b\u4e8b\u4ef6\u4f1a\u88ab\u653e\u8fdb\u4e00\u4e2a\u4e8b\u4ef6\u961f\u5217\uff0cRedis \u5355\u7ebf\u7a0b\u5bf9\u8be5\u4e8b\u4ef6\u961f\u5217\u4e0d\u65ad\u8fdb\u884c\u5904\u7406\u3002\u8fd9\u6837\u4e00\u6765\uff0cRedis \u65e0\u9700\u4e00\u76f4\u8f6e\u8be2\u662f\u5426\u6709\u8bf7\u6c42\u5b9e\u9645\u53d1\u751f\uff0c\u8fd9\u5c31\u53ef\u4ee5\u907f\u514d\u9020\u6210 CPU \u8d44\u6e90\u6d6a\u8d39 \u540c\u65f6\uff0cRedis \u5728\u5bf9\u4e8b\u4ef6\u961f\u5217\u4e2d\u7684\u4e8b\u4ef6\u8fdb\u884c\u5904\u7406\u65f6\uff0c\u4f1a\u8c03\u7528\u76f8\u5e94\u7684\u5904\u7406\u51fd\u6570\uff0c\u8fd9\u5c31\u5b9e\u73b0\u4e86\u57fa\u4e8e\u4e8b\u4ef6\u7684\u56de\u8c03\u3002 \u56e0\u4e3a Redis \u4e00\u76f4\u5728\u5bf9\u4e8b\u4ef6\u961f\u5217\u8fdb\u884c\u5904\u7406\uff0c\u6240\u4ee5\u80fd\u53ca\u65f6\u54cd\u5e94\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u63d0\u5347 Redis \u7684\u54cd\u5e94\u6027\u80fd\u3002 \u4f8b\u5982\uff0c\u8bf7\u6c42\u548c\u8bfb\u6570\u636e\uff1a \u8fd9\u4e24\u4e2a\u8bf7\u6c42\u5206\u522b\u5bf9\u5e94 Accept \u4e8b\u4ef6\u548c Read \u4e8b\u4ef6\uff0cRedis \u5206\u522b\u5bf9\u8fd9\u4e24\u4e2a\u4e8b\u4ef6\u6ce8\u518c accept \u548c get \u56de\u8c03\u51fd\u6570\u3002 \u5f53 Linux \u5185\u6838\u76d1\u542c\u5230\u6709\u8fde\u63a5\u8bf7\u6c42\u6216\u8bfb\u6570\u636e\u8bf7\u6c42\u65f6\uff0c\u5c31\u4f1a\u89e6\u53d1 Accept \u4e8b\u4ef6\u548c Read \u4e8b\u4ef6\uff0c\u6b64\u65f6\uff0c\u5185\u6838\u5c31\u4f1a\u56de\u8c03 Redis \u76f8\u5e94\u7684 accept \u548c get \u51fd\u6570\u8fdb\u884c\u5904\u7406\u3002 \u8fd9\u5c31\u50cf\u75c5\u4eba\u53bb\u533b\u9662\u77a7\u75c5\u3002\u5728\u533b\u751f\u5b9e\u9645\u8bca\u65ad\u524d\uff0c\u6bcf\u4e2a\u75c5\u4eba\uff08\u7b49\u540c\u4e8e\u8bf7\u6c42\uff09\u90fd\u9700\u8981\u5148\u5206\u8bca\u3001\u6d4b\u4f53\u6e29\u3001\u767b\u8bb0\u7b49\u3002\u5982\u679c\u8fd9\u4e9b\u5de5\u4f5c\u90fd\u7531\u533b\u751f\u6765\u5b8c\u6210\uff0c\u533b\u751f\u7684\u5de5\u4f5c\u6548\u7387\u5c31\u4f1a\u5f88\u4f4e\u3002\u6240\u4ee5\uff0c\u533b\u9662\u90fd\u8bbe\u7f6e\u4e86\u5206\u8bca\u53f0\uff0c\u5206\u8bca\u53f0\u4f1a\u4e00\u76f4\u5904\u7406\u8fd9\u4e9b\u8bca\u65ad\u524d\u7684\u5de5\u4f5c\uff08\u7c7b\u4f3c\u4e8e Linux \u5185\u6838\u76d1\u542c\u8bf7\u6c42\uff09\uff0c\u7136\u540e\u518d\u8f6c\u4ea4\u7ed9\u533b\u751f\u505a\u5b9e\u9645\u8bca\u65ad\u3002\u8fd9\u6837\u5373\u4f7f\u4e00\u4e2a\u533b\u751f\uff08\u76f8\u5f53\u4e8e Redis \u5355\u7ebf\u7a0b\uff09\uff0c\u6548\u7387\u4e5f\u80fd\u63d0\u5347\u3002 \u4e0d\u8fc7\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5373\u4f7f\u4f60\u7684\u5e94\u7528\u573a\u666f\u4e2d\u90e8\u7f72\u4e86\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u591a\u8def\u590d\u7528\u673a\u5236\u4e5f\u662f\u9002\u7528\u7684\u3002\u56e0\u4e3a\u8fd9\u4e2a\u673a\u5236\u7684\u5b9e\u73b0\u6709\u5f88\u591a\u79cd\uff0c \u65e2\u6709\u57fa\u4e8e Linux \u7cfb\u7edf\u4e0b\u7684 select \u548c epoll \u5b9e\u73b0\uff0c\u4e5f\u6709\u57fa\u4e8e FreeBSD \u7684 kqueue \u5b9e\u73b0\uff0c\u4ee5\u53ca\u57fa\u4e8e Solaris \u7684 evport \u5b9e\u73b0 \u4e0d\u8fc7\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5373\u4f7f\u4f60\u7684\u5e94\u7528\u573a\u666f\u4e2d\u90e8\u7f72\u4e86\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u591a\u8def\u590d\u7528\u673a\u5236\u4e5f\u662f\u9002\u7528\u7684\u3002\u56e0\u4e3a\u8fd9\u4e2a\u673a\u5236\u7684\u5b9e\u73b0\u6709\u5f88\u591a\u79cd\uff0c\u65e2\u6709\u57fa\u4e8e Linux \u7cfb\u7edf\u4e0b\u7684 select \u548c epoll \u5b9e\u73b0\uff0c\u4e5f\u6709\u57fa\u4e8e FreeBSD \u7684 kqueue \u5b9e\u73b0\uff0c\u4ee5\u53ca\u57fa\u4e8e Solaris \u7684 evport \u5b9e\u73b0","title":"3-1 \u56de\u8c03\u673a\u5236\u7684\u5de5\u4f5c\u539f\u7406"},{"location":"chap2/3redis_io/#4","text":"Redis \u5355\u7ebf\u7a0b\u662f\u6307\u5b83\u5bf9\u7f51\u7edc IO \u548c\u6570\u636e\u8bfb\u5199\u7684\u64cd\u4f5c\u91c7\u7528\u4e86\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u800c\u91c7\u7528\u5355\u7ebf\u7a0b\u7684\u4e00\u4e2a\u6838\u5fc3\u539f\u56e0\u662f\u907f\u514d\u591a\u7ebf\u7a0b\u5f00\u53d1\u7684\u5e76\u53d1\u63a7\u5236\u95ee\u9898\u3002 \u5355\u7ebf\u7a0b\u7684 Redis \u4e5f\u80fd\u83b7\u5f97\u9ad8\u6027\u80fd\uff0c\u8ddf\u591a\u8def\u590d\u7528\u7684 IO \u6a21\u578b\u5bc6\u5207\u76f8\u5173\uff0c\u56e0\u4e3a\u8fd9\u907f\u514d\u4e86 accept() \u548c send()/recv() \u6f5c\u5728\u7684\u7f51\u7edc IO \u64cd\u4f5c\u963b\u585e\u70b9\u3002 \u672c\u7ae0\u9996\u5148\u4ece\u7b80\u5355\u7684\u7f51\u7edc\u901a\u4fe1socket\u8bb2\u8d77\uff0c\u5f15\u51fa\u4e86\u975e\u963b\u585esocket\uff0c\u7531\u6b64\u8c08\u5230\u4e86\u8457\u540d\u7684I/O\u591a\u8def\u590d\u7528\uff0cLinux\u5185\u6838\u7684select/epoll\u673a\u5236 \u672c\u7ae0\u7684\u5173\u952e\u5728\u4e8e\u5173\u952e\u70b9\u5728\u4e8eaccpet\u548crecv\u65f6\u53ef\u80fd\u4f1a\u963b\u585e\u7ebf\u7a0b\uff0c\u4f7f\u7528IO\u591a\u8def\u590d\u7528\u6280\u672f\u53ef\u4ee5\u8ba9\u7ebf\u7a0b\u5148\u5904\u7406\u5176\u4ed6\u4e8b\u60c5\uff0c\u7b49\u9700\u8981\u7684\u8d44\u6e90\u5230\u4f4d\u540eepoll\u4f1a\u8c03\u7528\u56de\u8c03\u51fd\u6570\u901a\u77e5\u7ebf\u7a0b\uff0c\u7136\u540e\u7ebf\u7a0b\u518d\u53bb\u5904\u7406\u5b58/\u53d6\u6570\u636e\uff1b\u8fd9\u6837\u4e00\u4e2aredis\u670d\u52a1\u7aef\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u540c\u65f6\u5904\u7406\u591a\u4e2a\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e86\u3002","title":"4\u3001\u672c\u8282\u5c0f\u8282"},{"location":"chap2/4redis_aof_log/","text":"\u7b2c\u56db\u8282 Redis\u5b95\u673a\uff0c\u5982\u4f55\u907f\u514d\u6570\u636e\u4e22\u5931\uff1aAOF(Append Only File)\u65e5\u5fd7 Redis\u7528\u5728\u4ec0\u4e48\u4e1a\u52a1\u573a\u666f\uff0c\u4f5c\u7f13\u5b58\u4f7f\u7528\uff0c\u56e0\u4e3a\u5b83\u628a\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u76f4\u63a5\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u54cd\u5e94\u901f\u5ea6\u4f1a\u975e\u5e38\u5feb \u4e00\u65e6\u670d\u52a1\u5668\u5b95\u673a\uff0c\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5c06\u5168\u90e8\u4e22\u5931\u3002 \u4e00\u4e2a\u89e3\u51b3\u65b9\u6848\u662f\uff0c\u4ece\u540e\u7aef\u6570\u636e\u5e93\u6062\u590d\u8fd9\u4e9b\u6570\u636e\uff0c\u4f46\u8fd9\u79cd\u65b9\u5f0f\u5b58\u5728\u4e24\u4e2a\u95ee\u9898\uff1a \u9700\u8981\u9891\u7e41\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u4f1a\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u5de8\u5927\u7684\u538b\u529b \u8fd9\u4e9b\u6570\u636e\u662f\u4ece\u6162\u901f\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u51fa\u6765\u7684\uff0c\u6027\u80fd\u80af\u5b9a\u6bd4\u4e0d\u4e0a\u4ece Redis \u4e2d\u8bfb\u53d6\uff0c\u5bfc\u81f4\u4f7f\u7528\u8fd9\u4e9b\u6570\u636e\u7684\u5e94\u7528\u7a0b\u5e8f\u54cd\u5e94\u53d8\u6162 \u5bf9 Redis \u6765\u8bf4\uff0c\u5b9e\u73b0\u6570\u636e\u7684\u6301\u4e45\u5316\uff0c\u907f\u514d\u4ece\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u8fdb\u884c\u6062\u590d\uff0c\u662f\u81f3\u5173\u91cd\u8981\u7684\u3002 Redis \u7684\u6301\u4e45\u5316\u4e3b\u8981\u6709\u4e24\u5927\u673a\u5236\uff0c \u5373 AOF\uff08Append Only File\uff09\u65e5\u5fd7\u548c RDB \u5feb\u7167 \u3002 1\u3001AOF \u65e5\u5fd7\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff1f \u6570\u636e\u5e93\u7684\u5199\u524d\u65e5\u5fd7\uff08Write Ahead Log, WAL\uff09\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c \u5728\u5b9e\u9645\u5199\u6570\u636e\u524d\uff0c\u5148\u628a\u4fee\u6539\u7684\u6570\u636e\u8bb0\u5230\u65e5\u5fd7\u6587\u4ef6\u4e2d \uff0c\u4ee5\u4fbf\u6545\u969c\u65f6\u8fdb\u884c\u6062\u590d\u3002 1-1 AOF \u65e5\u5fd7: \u5199\u540e\u65e5\u5fd7 \u4e0d\u8fc7\uff0c AOF \u65e5\u5fd7\u6b63\u597d\u76f8\u53cd\uff0c\u5b83\u662f\u5199\u540e\u65e5\u5fd7 \uff0c\u201c\u5199\u540e\u201d\u7684\u610f\u601d\u662f Redis \u662f\u5148\u6267\u884c\u547d\u4ee4\uff0c\u628a\u6570\u636e\u5199\u5165\u5185\u5b58\uff0c\u7136\u540e\u624d\u8bb0\u5f55\u65e5\u5fd7 \uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u90a3 AOF \u4e3a\u4ec0\u4e48\u8981\u5148\u6267\u884c\u547d\u4ee4\u518d\u8bb0\u65e5\u5fd7\u5462\uff1f\u6211\u4eec\u8981\u5148\u77e5\u9053 AOF \u91cc\u8bb0\u5f55\u4e86\u4ec0\u4e48\u5185\u5bb9\u3002 \u4f20\u7edf\u6570\u636e\u5e93\u7684\u65e5\u5fd7\uff0c\u4f8b\u5982 redo log \uff08\u91cd\u505a\u65e5\u5fd7\uff09\uff0c\u8bb0\u5f55\u7684\u662f\u4fee\u6539\u540e\u7684\u6570\u636e\uff0c\u800c AOF \u91cc\u8bb0\u5f55\u7684\u662f Redis \u6536\u5230\u7684\u6bcf\u4e00\u6761\u547d\u4ee4\uff0c\u8fd9\u4e9b\u547d\u4ee4\u662f\u4ee5\u6587\u672c\u5f62\u5f0f\u4fdd\u5b58\u7684\u3002 \u8fd9\u76f8\u5f53\u4e8emysql binlog\u4e2d\u7684statement\u683c\u5f0f\u3002 \u4ee5 Redis \u6536\u5230 set testkey testvalue \u547d\u4ee4\u540e\u8bb0\u5f55\u7684\u65e5\u5fd7\u4e3a\u4f8b\uff0c\u770b\u770b AOF \u65e5\u5fd7\u7684\u5185\u5bb9\u3002 \u5176\u4e2d\uff0c \u201c*3\u201d \u8868\u793a\u5f53\u524d\u547d\u4ee4\u6709\u4e09\u4e2a\u90e8\u5206\uff0c \u6bcf\u90e8\u5206\u90fd\u662f\u7531 $+\u6570\u5b57 \u5f00\u5934\uff0c\u540e\u9762\u7d27\u8ddf\u7740\u5177\u4f53\u7684\u547d\u4ee4\u3001\u952e\u6216\u503c\u3002 \u8fd9\u91cc\uff0c \u201c\u6570\u5b57\u201d \u8868\u793a\u8fd9\u90e8\u5206\u4e2d\u7684\u547d\u4ee4\u3001\u952e\u6216\u503c\u4e00\u5171\u6709\u591a\u5c11\u5b57\u8282\u3002 \u4f8b\u5982\uff0c $3 set \u8868\u793a\u8fd9\u90e8\u5206\u6709 3 \u4e2a\u5b57\u8282\uff0c\u4e5f\u5c31\u662f set \u547d\u4ee4\u3002 \u4e3a\u4e86\u907f\u514d\u989d\u5916\u7684\u68c0\u67e5\u5f00\u9500\uff0c Redis \u5728\u5411 AOF \u91cc\u9762\u8bb0\u5f55\u65e5\u5fd7\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u4f1a\u5148\u53bb\u5bf9\u8fd9\u4e9b\u547d\u4ee4\u8fdb\u884c\u8bed\u6cd5\u68c0\u67e5\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u5148\u8bb0\u65e5\u5fd7\u518d\u6267\u884c\u547d\u4ee4\u7684\u8bdd\uff08\u5199\u524d\u65e5\u5fd7\uff09\uff0c\u65e5\u5fd7\u4e2d\u5c31\u6709\u53ef\u80fd\u8bb0\u5f55\u4e86\u9519\u8bef\u7684\u547d\u4ee4\uff0cRedis \u5728\u4f7f\u7528\u65e5\u5fd7\u6062\u590d\u6570\u636e\u65f6\uff0c\u5c31\u53ef\u80fd\u4f1a\u51fa\u9519\u3002 \u91cd\u8981\u7684\u65e5\u5fd7\u6a21\u5757\uff1aredo log \u5c31\u662f\u5199\u524d\u65e5\u5fd7 Mysql \u62e5\u6709SQL \u8bed\u53e5\u7684\u89e3\u6790\u5668 \u5199\u540e\u65e5\u5fd7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u5c31\u662f\u5148\u8ba9\u7cfb\u7edf\u6267\u884c\u547d\u4ee4\uff0c\u53ea\u6709\u547d\u4ee4\u80fd\u6267\u884c\u6210\u529f\uff0c\u624d\u4f1a\u88ab\u8bb0\u5f55\u5230\u65e5\u5fd7\u4e2d\uff0c\u5426\u5219\uff0c\u7cfb\u7edf\u5c31\u4f1a\u76f4\u63a5\u5411\u5ba2\u6237\u7aef\u62a5\u9519 \u3002\u6240\u4ee5\uff0cRedis \u4f7f\u7528\u5199\u540e\u65e5\u5fd7\u8fd9\u4e00\u65b9\u5f0f\u7684\u4e00\u5927\u597d\u5904\u662f\uff0c\u53ef\u4ee5 \u907f\u514d\u51fa\u73b0\u8bb0\u5f55\u9519\u8bef\u547d\u4ee4\u7684\u60c5\u51b5 \u3002 AOF \u8fd8\u6709\u4e00\u4e2a\u597d\u5904\uff1a\u5b83\u662f\u5728\u547d\u4ee4\u6267\u884c\u540e\u624d\u8bb0\u5f55\u65e5\u5fd7\uff0c\u6240\u4ee5\u4e0d\u4f1a\u963b\u585e\u5f53\u524d\u7684\u5199\u64cd\u4f5c\u3002 1-2 AOF \u6f5c\u5728\u7684\u98ce\u9669 AOF \u4e5f\u6709\u4e24\u4e2a\u6f5c\u5728\u7684\u98ce\u9669\u3002 \u9996\u5148\uff0c\u53ef\u80fd\u4f1a\u6570\u636e\u4e22\u5931: \u5982\u679c\u521a\u6267\u884c\u5b8c\u4e00\u4e2a\u547d\u4ee4\uff0c\u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u8bb0\u65e5\u5fd7\u5c31\u5b95\u673a\u4e86\uff0c\u90a3\u4e48\u8fd9\u4e2a\u547d\u4ee4\u548c\u76f8\u5e94\u7684\u6570\u636e\u5c31\u6709\u4e22\u5931\u7684\u98ce\u9669\u3002\u5982\u679c\u6b64\u65f6 Redis \u662f\u7528\u4f5c\u7f13\u5b58\uff0c\u8fd8\u53ef\u4ee5\u4ece\u540e\u7aef\u6570\u636e\u5e93\u91cd\u65b0\u8bfb\u5165\u6570\u636e\u8fdb\u884c\u6062\u590d\uff0c\u4f46\u662f\uff0c\u5982\u679c Redis \u662f\u76f4\u63a5\u7528\u4f5c\u6570\u636e\u5e93\u7684\u8bdd\uff0c\u6b64\u65f6\uff0c\u56e0\u4e3a\u547d\u4ee4\u6ca1\u6709\u8bb0\u5165\u65e5\u5fd7\uff0c\u6240\u4ee5\u5c31\u65e0\u6cd5\u7528\u65e5\u5fd7\u8fdb\u884c\u6062\u590d\u4e86\u3002 \u5176\u6b21,\u53ef\u80fd\u963b\u585e\u5176\u4ed6\u64cd\u4f5c AOF \u867d\u7136\u907f\u514d\u4e86\u5bf9\u5f53\u524d\u547d\u4ee4\u7684\u963b\u585e\uff0c\u4f46\u53ef\u80fd\u4f1a\u7ed9\u4e0b\u4e00\u4e2a\u64cd\u4f5c\u5e26\u6765\u963b\u585e\u98ce\u9669\u3002\u8fd9\u662f\u56e0\u4e3a\uff0cAOF \u65e5\u5fd7\u4e5f\u662f\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\u7684\uff0c \u5982\u679c\u5728\u628a\u65e5\u5fd7\u6587\u4ef6\u5199\u5165\u78c1\u76d8\u65f6\uff0c\u78c1\u76d8\u5199\u538b\u529b\u5927\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5199\u76d8\u5f88\u6162\uff0c\u8fdb\u800c\u5bfc\u81f4\u540e\u7eed\u7684\u64cd\u4f5c\u4e5f\u65e0\u6cd5\u6267\u884c\u4e86 \u3002 \u4e24\u4e2a\u98ce\u9669\u90fd\u662f\u548c AOF \u5199\u56de\u78c1\u76d8\u7684\u65f6\u673a\u76f8\u5173\u7684\u3002\u8fd9\u4e5f\u5c31\u610f\u5473\u7740\uff0c\u5982\u679c\u6211\u4eec\u80fd\u591f\u63a7\u5236\u4e00\u4e2a\u5199\u547d\u4ee4\u6267\u884c\u5b8c\u540e AOF \u65e5\u5fd7\u5199\u56de\u78c1\u76d8\u7684\u65f6\u673a\uff0c\u8fd9\u4e24\u4e2a\u98ce\u9669\u5c31\u89e3\u9664\u4e86\u3002 1-3 \u4e09\u79cd\u5199\u56de\u7b56\u7565 \u5176\u5b9e\uff0c\u5bf9\u4e8e\u8fd9\u4e2a\u95ee\u9898\uff0cAOF \u673a\u5236\u7ed9\u6211\u4eec\u63d0\u4f9b\u4e86\u4e09\u4e2a\u9009\u62e9\uff0c\u4e5f\u5c31\u662f AOF \u914d\u7f6e\u9879 appendfsync \u7684\u4e09\u4e2a\u53ef\u9009\u503c\u3002 Always\uff0c\u540c\u6b65\u5199\u56de \uff1a\u6bcf\u4e2a\u5199\u547d\u4ee4\u6267\u884c\u5b8c\uff0c \u7acb\u9a6c\u540c\u6b65\u5730\u5c06\u65e5\u5fd7\u5199\u56de\u78c1\u76d8 \uff1b Everysec\uff0c\u6bcf\u79d2\u5199\u56de \uff1a\u6bcf\u4e2a\u5199\u547d\u4ee4\u6267\u884c\u5b8c\uff0c\u53ea \u662f\u5148\u628a\u65e5\u5fd7\u5199\u5230 AOF \u6587\u4ef6\u7684\u5185\u5b58\u7f13\u51b2\u533a\uff0c\u6bcf\u9694\u4e00\u79d2\u628a\u7f13\u51b2\u533a\u4e2d\u7684\u5185\u5bb9\u5199\u5165\u78c1\u76d8 \uff1b No\uff0c\u64cd\u4f5c\u7cfb\u7edf\u63a7\u5236\u7684\u5199\u56de \uff1a\u6bcf\u4e2a\u5199\u547d\u4ee4\u6267\u884c\u5b8c\uff0c\u53ea\u662f\u5148\u628a\u65e5\u5fd7\u5199\u5230 AOF \u6587\u4ef6\u7684\u5185\u5b58\u7f13\u51b2\u533a\uff0c \u7531\u64cd\u4f5c\u7cfb\u7edf\u51b3\u5b9a\u4f55\u65f6\u5c06\u7f13\u51b2\u533a\u5185\u5bb9\u5199\u56de\u78c1\u76d8 \u3002 \u8fd9\u4e09\u79cd\u5199\u56de\u7b56\u7565\u90fd\u65e0\u6cd5\u505a\u5230\u4e24\u5168\u5176\u7f8e\u3002\u6211\u4eec\u6765\u5206\u6790\u4e0b\u5176\u4e2d\u7684\u539f\u56e0\u3002 \u201cAlways \u540c\u6b65\u5199\u56de\u201d\u53ef\u4ee5\u505a\u5230\u57fa\u672c\u4e0d\u4e22\u6570\u636e\uff0c\u4f46\u662f\u5b83\u5728\u6bcf\u4e00\u4e2a\u5199\u547d\u4ee4\u540e\u90fd\u6709\u4e00\u4e2a\u6162\u901f\u7684\u843d\u76d8\u64cd\u4f5c\uff0c \u4e0d\u53ef\u907f\u514d\u5730\u4f1a\u5f71\u54cd\u4e3b\u7ebf\u7a0b\u6027\u80fd \uff1b No \u867d\u7136\u201c\u64cd\u4f5c\u7cfb\u7edf\u63a7\u5236\u7684\u5199\u56de\u201d\u5728\u5199\u5b8c\u7f13\u51b2\u533a\u540e\uff0c\u5c31\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\u540e\u7eed\u7684\u547d\u4ee4\uff0c \u4f46\u662f\u843d\u76d8\u7684\u65f6\u673a\u5df2\u7ecf\u4e0d\u5728 Redis \u624b\u4e2d\u4e86\uff0c\u53ea\u8981 AOF \u8bb0\u5f55\u6ca1\u6709\u5199\u56de\u78c1\u76d8\uff0c\u4e00\u65e6\u5b95\u673a\u5bf9\u5e94\u7684\u6570\u636e\u5c31\u4e22\u5931\u4e86 \uff1b \u201cEverysec \u6bcf\u79d2\u5199\u56de\u201d\u91c7\u7528\u4e00\u79d2\u5199\u56de\u4e00\u6b21\u7684\u9891 \u7387\uff0c\u907f\u514d\u4e86\u201c\u540c\u6b65\u5199\u56de\u201d\u7684\u6027\u80fd\u5f00\u9500\uff0c\u867d\u7136\u51cf\u5c11\u4e86\u5bf9\u7cfb\u7edf\u6027\u80fd\u7684\u5f71\u54cd\uff0c\u4f46\u662f\u5982\u679c\u53d1\u751f\u5b95\u673a\uff0c \u4e0a\u4e00\u79d2\u5185\u672a\u843d\u76d8\u7684\u547d\u4ee4\u64cd\u4f5c\u4ecd\u7136\u4f1a\u4e22\u5931\u3002\u6240\u4ee5\uff0c\u8fd9\u53ea\u80fd\u7b97\u662f\uff0c\u5728\u907f\u514d\u5f71\u54cd\u4e3b\u7ebf\u7a0b\u6027\u80fd\u548c\u907f\u514d\u6570\u636e\u4e22\u5931\u4e24\u8005\u95f4\u53d6\u4e86\u4e2a\u6298\u4e2d\u3002 \u6211\u4eec\u5c31\u53ef\u4ee5\u6839\u636e\u7cfb\u7edf\u5bf9\u9ad8\u6027\u80fd\u548c\u9ad8\u53ef\u9760\u6027\u7684\u8981\u6c42\uff0c\u6765\u9009\u62e9\u4f7f\u7528\u54ea\u79cd\u5199\u56de\u7b56\u7565\u4e86\u3002\u603b\u7ed3\u4e00\u4e0b\u5c31\u662f\uff1a \u60f3\u8981\u83b7\u5f97\u9ad8\u6027\u80fd\uff0c\u5c31\u9009\u62e9 No \u7b56\u7565\uff1b\u5982\u679c\u60f3\u8981\u5f97\u5230\u9ad8\u53ef\u9760\u6027\u4fdd\u8bc1\uff0c\u5c31\u9009\u62e9 Always \u7b56\u7565\uff1b\u5982\u679c\u5141\u8bb8\u6570\u636e\u6709\u4e00\u70b9\u4e22\u5931\uff0c\u53c8\u5e0c\u671b\u6027\u80fd\u522b\u53d7\u592a\u5927\u5f71\u54cd\u7684\u8bdd\uff0c\u90a3\u4e48\u5c31\u9009\u62e9 Everysec \u7b56\u7565\u3002 2\u3001 AOF \u6587\u4ef6\u8fc7\u5927\u5e26\u6765\u7684\u95ee\u9898 \u6309\u7167\u7cfb\u7edf\u7684\u6027\u80fd\u9700\u6c42\u9009\u5b9a\u4e86\u5199\u56de\u7b56\u7565\uff0c\u5e76\u4e0d\u662f\u201c\u9ad8\u6795\u65e0\u5fe7\u201d\u4e86\u3002\u6bd5\u7adf\uff0cAOF \u662f\u4ee5\u6587\u4ef6\u7684\u5f62\u5f0f\u5728\u8bb0\u5f55\u63a5\u6536\u5230\u7684\u6240\u6709\u5199\u547d\u4ee4\u3002\u968f\u7740\u63a5\u6536\u7684\u5199\u547d\u4ee4\u8d8a\u6765\u8d8a\u591a\uff0cAOF \u6587\u4ef6\u4f1a\u8d8a\u6765\u8d8a\u5927\u3002\u8fd9\u4e5f\u5c31\u610f\u5473\u7740\uff0c\u6211\u4eec\u4e00\u5b9a\u8981\u5c0f\u5fc3 AOF \u6587\u4ef6\u8fc7\u5927\u5e26\u6765\u7684\u6027\u80fd\u95ee\u9898\u3002 \u6587\u4ef6\u7cfb\u7edf\u672c\u8eab\u5bf9\u6587\u4ef6\u5927\u5c0f\u6709\u9650\u5236\uff0c\u65e0\u6cd5\u4fdd\u5b58\u8fc7\u5927\u7684\u6587\u4ef6\uff1b \u5982\u679c\u6587\u4ef6\u592a\u5927\uff0c\u4e4b\u540e\u518d\u5f80\u91cc\u9762\u8ffd\u52a0\u547d\u4ee4\u8bb0\u5f55\u7684\u8bdd\uff0c\u6548\u7387\u4e5f\u4f1a\u53d8\u4f4e \u5982\u679c\u53d1\u751f\u5b95\u673a\uff0cAOF \u4e2d\u8bb0\u5f55\u7684\u547d\u4ee4\u8981\u4e00\u4e2a\u4e2a\u88ab\u91cd\u65b0\u6267\u884c\uff0c\u7528\u4e8e\u6545\u969c\u6062\u590d\uff0c\u5982\u679c\u65e5\u5fd7\u6587\u4ef6\u592a\u5927\uff0c\u6574\u4e2a\u6062\u590d\u8fc7\u7a0b\u5c31\u4f1a\u975e\u5e38\u7f13\u6162\uff0c\u8fd9\u5c31\u4f1a\u5f71\u54cd\u5230 Redis \u7684\u6b63\u5e38\u4f7f\u7528 2-1 \u65e5\u5fd7\u6587\u4ef6\u592a\u5927\u4e86\u600e\u4e48\u529e\uff1fAOF \u91cd\u5199\u673a\u5236 AOF \u91cd\u5199\u673a\u5236\u5c31\u662f\u5728\u91cd\u5199\u65f6\uff0cRedis \u6839\u636e\u6570\u636e\u5e93\u7684\u73b0\u72b6\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 AOF \u6587\u4ef6\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8bfb\u53d6\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u952e\u503c\u5bf9\uff0c\u7136\u540e\u5bf9\u6bcf\u4e00\u4e2a\u952e\u503c\u5bf9\u7528\u4e00\u6761\u547d\u4ee4\u8bb0\u5f55\u5b83\u7684\u5199\u5165 \u3002 \u6bd4\u5982\u8bf4\uff0c\u5f53\u8bfb\u53d6\u4e86\u952e\u503c\u5bf9\u201ctestkey\u201d: \u201ctestvalue\u201d\u4e4b\u540e\uff0c\u91cd\u5199\u673a\u5236\u4f1a\u8bb0\u5f55 set testkey testvalue \u8fd9\u6761\u547d\u4ee4\u3002\u8fd9\u6837\uff0c\u5f53\u9700\u8981\u6062\u590d\u65f6\uff0c\u53ef\u4ee5\u91cd\u65b0\u6267\u884c\u8be5\u547d\u4ee4\uff0c\u5b9e\u73b0 \u201ctestkey\u201d: \u201ctestvalue\u201d \u7684\u5199\u5165\u3002 \u4e3a\u4ec0\u4e48\u91cd\u5199\u673a\u5236\u53ef\u4ee5\u628a\u65e5\u5fd7\u6587\u4ef6\u53d8\u5c0f\u5462? \u5b9e\u9645\u4e0a\uff0c \u91cd\u5199\u673a\u5236\u5177\u6709\u201c\u591a\u53d8\u4e00\u201d\u529f\u80fd\u3002\u6240\u8c13\u7684\u201c\u591a\u53d8\u4e00\u201d\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u65e7\u65e5\u5fd7\u6587\u4ef6\u4e2d\u7684\u591a\u6761\u547d\u4ee4\uff0c\u5728\u91cd\u5199\u540e\u7684\u65b0\u65e5\u5fd7\u4e2d\u53d8\u6210\u4e86\u4e00\u6761\u547d\u4ee4\u3002 AOF \u6587\u4ef6\u662f\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\uff0c\u9010\u4e00\u8bb0\u5f55\u63a5\u6536\u5230\u7684\u5199\u547d\u4ee4\u7684\u3002\u5f53\u4e00\u4e2a\u952e\u503c\u5bf9\u88ab\u591a\u6761\u5199\u547d\u4ee4\u53cd\u590d\u4fee\u6539\u65f6\uff0cAOF \u6587\u4ef6\u4f1a\u8bb0\u5f55\u76f8\u5e94\u7684\u591a\u6761\u547d\u4ee4 \u5728\u91cd\u5199\u7684\u65f6\u5019\uff0c\u662f\u6839\u636e\u8fd9\u4e2a\u952e\u503c\u5bf9\u5f53\u524d\u7684\u6700\u65b0\u72b6\u6001\uff0c\u4e3a\u5b83\u751f\u6210\u5bf9\u5e94\u7684\u5199\u5165\u547d\u4ee4 \u4e00\u4e2a\u952e\u503c\u5bf9\u5728\u91cd\u5199\u65e5\u5fd7\u4e2d\u53ea\u7528\u4e00\u6761\u547d\u4ee4\u5c31\u884c\u4e86\uff0c\u800c\u4e14\uff0c\u5728\u65e5\u5fd7\u6062\u590d\u65f6\uff0c\u53ea\u7528\u6267\u884c\u8fd9\u6761\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u5b8c\u6210\u8fd9\u4e2a\u952e\u503c\u5bf9\u7684\u5199\u5165\u4e86\u3002 \u5f53\u6211\u4eec\u5bf9\u4e00\u4e2a\u5217\u8868\u5148\u540e\u505a\u4e86 6 \u6b21\u4fee\u6539\u64cd\u4f5c\u540e\uff0c\u5217\u8868\u7684\u6700\u540e\u72b6\u6001\u662f [\u201cD\u201d, \u201cC\u201d, \u201cN\u201d] \uff0c\u6b64\u65f6\uff0c\u53ea\u7528 LPUSH u:list \u201cN\u201d, \u201cC\u201d, \"D\" \u8fd9\u4e00\u6761\u547d\u4ee4\u5c31\u80fd\u5b9e\u73b0\u8be5\u6570\u636e\u7684\u6062\u590d\uff0c\u8fd9\u5c31\u8282\u7701\u4e86\u4e94\u6761\u547d\u4ee4\u7684\u7a7a\u95f4\u3002 \u4e0d\u8fc7\uff0c\u867d\u7136 AOF \u91cd\u5199\u540e\uff0c\u65e5\u5fd7\u6587\u4ef6\u4f1a\u7f29\u5c0f\uff0c\u4f46\u662f\uff0c\u8981\u628a\u6574\u4e2a\u6570\u636e\u5e93\u7684\u6700\u65b0\u6570\u636e\u7684\u64cd\u4f5c\u65e5\u5fd7\u90fd\u5199\u56de\u78c1\u76d8\uff0c\u4ecd\u7136\u662f\u4e00\u4e2a\u975e\u5e38\u8017\u65f6\u7684\u8fc7\u7a0b, \u91cd\u5199\u4f1a\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\uff1f 2-2 AOF \u91cd\u5199\u4f1a\u963b\u585e\u5417? \u548c AOF \u65e5\u5fd7\u7531\u4e3b\u7ebf\u7a0b\u5199\u56de\u4e0d\u540c\uff0c \u91cd\u5199\u8fc7\u7a0b\u662f\u7531\u540e\u53f0\u5b50\u8fdb\u7a0b bgrewriteaof \u6765\u5b8c\u6210\u7684\uff0c\u8fd9\u4e5f\u662f\u4e3a\u4e86\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u5bfc\u81f4\u6570\u636e\u5e93\u6027\u80fd\u4e0b\u964d \u3002 Aof\u91cd\u5199\u65e5\u5fd7\u603b\u7ed3\u4e3a\uff0c\u4e00\u6b21\u62f7\u8d1d\uff0c\u4e24\u5904\u65e5\u5fd7\u3002 \u4e00\u6b21\u62f7\u8d1d: \u6bcf\u6b21\u6267\u884c\u91cd\u5199\u65f6\uff0c\u4e3b\u7ebf\u7a0b fork \u51fa\u540e\u53f0\u7684 bgrewriteaof \u5b50\u8fdb\u7a0b\u3002 \u6b64\u65f6\uff0c fork \u4f1a\u628a\u4e3b\u7ebf\u7a0b\u7684\u5185\u5b58\u62f7\u8d1d\u4e00\u4efd\u7ed9 bgrewriteaof \u5b50\u8fdb\u7a0b\uff0c\u8fd9\u91cc\u9762\u5c31\u5305\u542b\u4e86\u6570\u636e\u5e93\u7684\u6700\u65b0\u6570\u636e\u3002 \u7136\u540e\uff0c bgrewriteaof \u5b50\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u5728\u4e0d\u5f71\u54cd\u4e3b\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\uff0c\u9010\u4e00\u628a\u62f7\u8d1d\u7684\u6570\u636e\u5199\u6210\u64cd\u4f5c\uff0c\u8bb0\u5165\u91cd\u5199\u65e5\u5fd7\u3002 \u4e24\u5904\u65e5\u5fd7: \u56e0\u4e3a\u4e3b\u7ebf\u7a0b\u672a\u963b\u585e\uff0c\u4ecd\u7136\u53ef\u4ee5\u5904\u7406\u65b0\u6765\u7684\u64cd\u4f5c\u3002\u6b64\u65f6\uff0c\u5982\u679c\u6709\u5199\u64cd\u4f5c\uff0c \u7b2c\u4e00\u5904\u65e5\u5fd7\u5c31\u662f\u6307\u6b63\u5728\u4f7f\u7528\u7684 AOF \u65e5\u5fd7 \uff0cRedis \u4f1a\u628a\u8fd9\u4e2a\u64cd\u4f5c\u5199\u5230\u5b83\u7684\u7f13\u51b2\u533a\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u5b95\u673a\u4e86\uff0c\u8fd9\u4e2a AOF \u65e5\u5fd7\u7684\u64cd\u4f5c\u4ecd\u7136\u662f\u9f50\u5168\u7684\uff0c\u53ef\u4ee5\u7528\u4e8e\u6062\u590d\u3002 \u800c\u7b2c\u4e8c\u5904\u65e5\u5fd7\uff0c\u5c31\u662f\u6307\u65b0\u7684 AOF \u91cd\u5199\u65e5\u5fd7 \u3002\u8fd9\u4e2a\u64cd\u4f5c\u4e5f\u4f1a\u88ab\u5199\u5230\u91cd\u5199\u65e5\u5fd7\u7684\u7f13\u51b2\u533a\u3002\u8fd9\u6837\uff0c\u91cd\u5199\u65e5\u5fd7\u4e5f\u4e0d\u4f1a\u4e22\u5931\u6700\u65b0\u7684\u64cd\u4f5c\u3002\u7b49\u5230\u62f7\u8d1d\u6570\u636e\u7684\u6240\u6709\u64cd\u4f5c\u8bb0\u5f55\u91cd\u5199\u5b8c\u6210\u540e\uff0c\u91cd\u5199\u65e5\u5fd7\u8bb0\u5f55\u7684\u8fd9\u4e9b\u6700\u65b0\u64cd\u4f5c\u4e5f\u4f1a\u5199\u5165\u65b0\u7684 AOF \u6587\u4ef6\uff0c\u4ee5\u4fdd\u8bc1\u6570\u636e\u5e93\u6700\u65b0\u72b6\u6001\u7684\u8bb0\u5f55\u3002\u6b64\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u65b0\u7684 AOF \u6587\u4ef6\u66ff\u4ee3\u65e7\u6587\u4ef6\u4e86\u3002 \u603b\u7ed3\u6765\u8bf4 \u6bcf\u6b21 AOF \u91cd\u5199\u65f6\uff0cRedis \u4f1a\u5148\u6267\u884c\u4e00\u4e2a\u5185\u5b58\u62f7\u8d1d\uff0c\u7528\u4e8e\u91cd\u5199\uff1b \u7136\u540e\uff0c\u4f7f\u7528\u4e24\u4e2a\u65e5\u5fd7\u4fdd\u8bc1\u5728\u91cd\u5199\u8fc7\u7a0b\u4e2d\uff0c\u65b0\u5199\u5165\u7684\u6570\u636e\u4e0d\u4f1a\u4e22\u5931\u3002 \u800c\u4e14\uff0c\u56e0\u4e3a Redis \u91c7\u7528\u989d\u5916\u7684\u7ebf\u7a0b\u8fdb\u884c\u6570\u636e\u91cd\u5199\uff0c\u6240\u4ee5\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5e76\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b \u3002 2-3 \u4ec0\u4e48\u65f6\u5019\u4f1a\u89e6\u53d1AOF \u91cd\u5199\u5462\uff1f \u6709\u4e24\u4e2a\u914d\u7f6e\u9879\u5728\u63a7\u5236AOF\u91cd\u5199\u7684\u89e6\u53d1\u65f6\u673a\uff1a auto-aof-rewrite-min-size : \u8868\u793a\u8fd0\u884cAOF\u91cd\u5199\u65f6\u6587\u4ef6\u7684\u6700\u5c0f\u5927\u5c0f\uff0c \u9ed8\u8ba4\u4e3a64MB auto-aof-rewrite-percentage : \u8fd9\u4e2a\u503c\u7684\u8ba1\u7b97\u65b9\u6cd5\u662f\uff1a\u5f53\u524dAOF\u6587\u4ef6\u5927\u5c0f\u548c\u4e0a\u4e00\u6b21\u91cd\u5199\u540eAOF\u6587\u4ef6\u5927\u5c0f\u7684\u5dee\u503c\uff0c\u518d\u9664\u4ee5\u4e0a\u4e00\u6b21\u91cd\u5199\u540eAOF\u6587\u4ef6\u5927\u5c0f\u3002\u4e5f\u5c31\u662f\u5f53\u524dAOF\u6587\u4ef6\u6bd4\u4e0a\u4e00\u6b21\u91cd\u5199\u540eAOF\u6587\u4ef6\u7684\u589e\u91cf\u5927\u5c0f\uff0c\u548c\u4e0a\u4e00\u6b21\u91cd\u5199\u540eAOF\u6587\u4ef6\u5927\u5c0f\u7684\u6bd4\u503c\u3002 AOF\u6587\u4ef6\u5927\u5c0f\u540c\u65f6\u8d85\u51fa\u4e0a\u9762\u8fd9\u4e24\u4e2a\u914d\u7f6e\u9879\u65f6\uff0c\u4f1a\u89e6\u53d1AOF\u91cd\u5199\u3002 3\u3001\u672c\u8282\u5c0f\u7ed3 Redis \u7528\u4e8e\u907f\u514d\u6570\u636e\u4e22\u5931\u7684 AOF \u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u901a\u8fc7\u9010\u4e00\u8bb0\u5f55\u64cd\u4f5c\u547d\u4ee4\uff0c\u5728\u6062\u590d\u65f6\u518d\u9010\u4e00\u6267\u884c\u547d\u4ee4\u7684\u65b9\u5f0f\uff0c\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u53ef\u9760\u6027 \u603b\u7ed3\u6765\u8bf4\uff0c\u5b83\u63d0\u4f9b\u4e86 AOF \u65e5\u5fd7\u7684\u4e09\u79cd\u5199\u56de\u7b56\u7565\uff0c\u5206\u522b\u662f Always\u3001Everysec \u548c No\uff0c\u8fd9\u4e09\u79cd\u7b56\u7565\u5728\u53ef\u9760\u6027\u4e0a\u662f\u4ece\u9ad8\u5230\u4f4e\uff0c\u800c\u5728\u6027\u80fd\u4e0a\u5219\u662f\u4ece\u4f4e\u5230\u9ad8\u3002 \u6b64\u5916\uff0c\u4e3a\u4e86\u907f\u514d\u65e5\u5fd7\u6587\u4ef6\u8fc7\u5927\uff0cRedis \u8fd8\u63d0\u4f9b\u4e86 AOF \u91cd\u5199\u673a\u5236\uff0c\u76f4\u63a5\u6839\u636e\u6570\u636e\u5e93\u91cc\u6570\u636e\u7684\u6700\u65b0\u72b6\u6001\uff0c\u751f\u6210\u8fd9\u4e9b\u6570\u636e\u7684\u63d2\u5165\u547d\u4ee4\uff0c\u4f5c\u4e3a\u65b0\u65e5\u5fd7\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u901a\u8fc7\u540e\u53f0\u7ebf\u7a0b\u5b8c\u6210\uff0c\u907f\u514d\u4e86\u5bf9\u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\u3002 AOF \u65e5\u5fd7\u91cd\u5199\u7684\u65f6\u5019\uff0c\u662f\u7531 bgrewriteaof \u5b50\u8fdb\u7a0b\u6765\u5b8c\u6210\u7684\uff0c\u4e0d\u7528\u4e3b\u7ebf\u7a0b\u53c2\u4e0e\uff0c\u6211\u4eec\u4eca\u5929\u8bf4\u7684\u975e\u963b\u585e\u4e5f\u662f\u6307\u5b50\u8fdb\u7a0b\u7684\u6267\u884c\u4e0d\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002\u4f46\u662f\uff0c\u4f60\u89c9\u5f97\uff0c\u8fd9\u4e2a\u91cd\u5199\u8fc7\u7a0b\u6709\u6ca1\u6709\u5176\u4ed6\u6f5c\u5728\u7684\u963b\u585e\u98ce\u9669\u5462\uff1f\u5982\u679c\u6709\u7684\u8bdd\uff0c\u4f1a\u5728\u54ea\u91cc\u963b\u585e\uff1f \u6f5c\u5728\u7684\u963b\u585e\u98ce\u9669\u5305\u62ec\uff1afork\u5b50\u8fdb\u7a0b \u548c AOF\u91cd\u5199\u8fc7\u7a0b\u4e2d\u7236\u8fdb\u7a0b\u4ea7\u751f\u5199\u5165 AOF \u91cd\u5199\u4e5f\u6709\u4e00\u4e2a\u91cd\u5199\u65e5\u5fd7\uff0c\u4e3a\u4ec0\u4e48\u5b83\u4e0d\u5171\u4eab\u4f7f\u7528 AOF \u672c\u8eab\u7684\u65e5\u5fd7\u5462\uff1f \u63d0\u95ee\uff1a AOF\u91cd\u5199\u4e0d\u590d\u7528AOF\u672c\u8eab\u7684\u65e5\u5fd7\uff0c \u4e00\u4e2a\u539f\u56e0\u662f\u7236 \u5b50\u8fdb\u7a0b\u5199\u540c\u4e00\u4e2a\u6587\u4ef6\u5fc5\u7136\u4f1a\u4ea7\u751f\u7ade\u4e89\u95ee\u9898\uff0c\u63a7\u5236\u7ade\u4e89\u5c31\u610f\u5473\u7740\u4f1a\u5f71\u54cd\u7236\u8fdb\u7a0b\u7684\u6027\u80fd \u4e8c\u662f\u5982\u679cAOF\u91cd\u5199\u8fc7\u7a0b\u4e2d\u5931\u8d25\u4e86\uff0c\u90a3\u4e48\u539f\u672c\u7684AOF\u6587\u4ef6\u76f8\u5f53\u4e8e\u88ab\u6c61\u67d3\u4e86\uff0c\u65e0\u6cd5\u505a\u6062\u590d\u4f7f\u7528\u3002\u6240\u4ee5Redis AOF\u91cd\u5199\u4e00\u4e2a\u65b0\u6587\u4ef6\uff0c\u91cd\u5199\u5931\u8d25\u7684\u8bdd\uff0c\u76f4\u63a5\u5220\u9664\u8fd9\u4e2a\u6587\u4ef6\u5c31\u597d\u4e86\uff0c\u4e0d\u4f1a\u5bf9\u539f\u5148\u7684AOF\u6587\u4ef6\u4ea7\u751f\u5f71\u54cd\u3002 \u7b49\u91cd\u5199\u5b8c\u6210\u4e4b\u540e\uff0c\u76f4\u63a5\u66ff\u6362\u65e7\u6587\u4ef6\u5373\u53ef\u3002","title":"\u7b2c\u56db\u8282 Redis\u5b95\u673a\uff0c\u5982\u4f55\u907f\u514d\u6570\u636e\u4e22\u5931\uff1aAOF\u65e5\u5fd7"},{"location":"chap2/4redis_aof_log/#redisaofappend-only-file","text":"Redis\u7528\u5728\u4ec0\u4e48\u4e1a\u52a1\u573a\u666f\uff0c\u4f5c\u7f13\u5b58\u4f7f\u7528\uff0c\u56e0\u4e3a\u5b83\u628a\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u76f4\u63a5\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u54cd\u5e94\u901f\u5ea6\u4f1a\u975e\u5e38\u5feb \u4e00\u65e6\u670d\u52a1\u5668\u5b95\u673a\uff0c\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5c06\u5168\u90e8\u4e22\u5931\u3002 \u4e00\u4e2a\u89e3\u51b3\u65b9\u6848\u662f\uff0c\u4ece\u540e\u7aef\u6570\u636e\u5e93\u6062\u590d\u8fd9\u4e9b\u6570\u636e\uff0c\u4f46\u8fd9\u79cd\u65b9\u5f0f\u5b58\u5728\u4e24\u4e2a\u95ee\u9898\uff1a \u9700\u8981\u9891\u7e41\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u4f1a\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u5de8\u5927\u7684\u538b\u529b \u8fd9\u4e9b\u6570\u636e\u662f\u4ece\u6162\u901f\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u51fa\u6765\u7684\uff0c\u6027\u80fd\u80af\u5b9a\u6bd4\u4e0d\u4e0a\u4ece Redis \u4e2d\u8bfb\u53d6\uff0c\u5bfc\u81f4\u4f7f\u7528\u8fd9\u4e9b\u6570\u636e\u7684\u5e94\u7528\u7a0b\u5e8f\u54cd\u5e94\u53d8\u6162 \u5bf9 Redis \u6765\u8bf4\uff0c\u5b9e\u73b0\u6570\u636e\u7684\u6301\u4e45\u5316\uff0c\u907f\u514d\u4ece\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u8fdb\u884c\u6062\u590d\uff0c\u662f\u81f3\u5173\u91cd\u8981\u7684\u3002 Redis \u7684\u6301\u4e45\u5316\u4e3b\u8981\u6709\u4e24\u5927\u673a\u5236\uff0c \u5373 AOF\uff08Append Only File\uff09\u65e5\u5fd7\u548c RDB \u5feb\u7167 \u3002","title":"\u7b2c\u56db\u8282 Redis\u5b95\u673a\uff0c\u5982\u4f55\u907f\u514d\u6570\u636e\u4e22\u5931\uff1aAOF(Append Only File)\u65e5\u5fd7"},{"location":"chap2/4redis_aof_log/#1aof","text":"\u6570\u636e\u5e93\u7684\u5199\u524d\u65e5\u5fd7\uff08Write Ahead Log, WAL\uff09\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c \u5728\u5b9e\u9645\u5199\u6570\u636e\u524d\uff0c\u5148\u628a\u4fee\u6539\u7684\u6570\u636e\u8bb0\u5230\u65e5\u5fd7\u6587\u4ef6\u4e2d \uff0c\u4ee5\u4fbf\u6545\u969c\u65f6\u8fdb\u884c\u6062\u590d\u3002","title":"1\u3001AOF \u65e5\u5fd7\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff1f"},{"location":"chap2/4redis_aof_log/#1-1-aof","text":"\u4e0d\u8fc7\uff0c AOF \u65e5\u5fd7\u6b63\u597d\u76f8\u53cd\uff0c\u5b83\u662f\u5199\u540e\u65e5\u5fd7 \uff0c\u201c\u5199\u540e\u201d\u7684\u610f\u601d\u662f Redis \u662f\u5148\u6267\u884c\u547d\u4ee4\uff0c\u628a\u6570\u636e\u5199\u5165\u5185\u5b58\uff0c\u7136\u540e\u624d\u8bb0\u5f55\u65e5\u5fd7 \uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u90a3 AOF \u4e3a\u4ec0\u4e48\u8981\u5148\u6267\u884c\u547d\u4ee4\u518d\u8bb0\u65e5\u5fd7\u5462\uff1f\u6211\u4eec\u8981\u5148\u77e5\u9053 AOF \u91cc\u8bb0\u5f55\u4e86\u4ec0\u4e48\u5185\u5bb9\u3002 \u4f20\u7edf\u6570\u636e\u5e93\u7684\u65e5\u5fd7\uff0c\u4f8b\u5982 redo log \uff08\u91cd\u505a\u65e5\u5fd7\uff09\uff0c\u8bb0\u5f55\u7684\u662f\u4fee\u6539\u540e\u7684\u6570\u636e\uff0c\u800c AOF \u91cc\u8bb0\u5f55\u7684\u662f Redis \u6536\u5230\u7684\u6bcf\u4e00\u6761\u547d\u4ee4\uff0c\u8fd9\u4e9b\u547d\u4ee4\u662f\u4ee5\u6587\u672c\u5f62\u5f0f\u4fdd\u5b58\u7684\u3002 \u8fd9\u76f8\u5f53\u4e8emysql binlog\u4e2d\u7684statement\u683c\u5f0f\u3002 \u4ee5 Redis \u6536\u5230 set testkey testvalue \u547d\u4ee4\u540e\u8bb0\u5f55\u7684\u65e5\u5fd7\u4e3a\u4f8b\uff0c\u770b\u770b AOF \u65e5\u5fd7\u7684\u5185\u5bb9\u3002 \u5176\u4e2d\uff0c \u201c*3\u201d \u8868\u793a\u5f53\u524d\u547d\u4ee4\u6709\u4e09\u4e2a\u90e8\u5206\uff0c \u6bcf\u90e8\u5206\u90fd\u662f\u7531 $+\u6570\u5b57 \u5f00\u5934\uff0c\u540e\u9762\u7d27\u8ddf\u7740\u5177\u4f53\u7684\u547d\u4ee4\u3001\u952e\u6216\u503c\u3002 \u8fd9\u91cc\uff0c \u201c\u6570\u5b57\u201d \u8868\u793a\u8fd9\u90e8\u5206\u4e2d\u7684\u547d\u4ee4\u3001\u952e\u6216\u503c\u4e00\u5171\u6709\u591a\u5c11\u5b57\u8282\u3002 \u4f8b\u5982\uff0c $3 set \u8868\u793a\u8fd9\u90e8\u5206\u6709 3 \u4e2a\u5b57\u8282\uff0c\u4e5f\u5c31\u662f set \u547d\u4ee4\u3002 \u4e3a\u4e86\u907f\u514d\u989d\u5916\u7684\u68c0\u67e5\u5f00\u9500\uff0c Redis \u5728\u5411 AOF \u91cc\u9762\u8bb0\u5f55\u65e5\u5fd7\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u4f1a\u5148\u53bb\u5bf9\u8fd9\u4e9b\u547d\u4ee4\u8fdb\u884c\u8bed\u6cd5\u68c0\u67e5\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u5148\u8bb0\u65e5\u5fd7\u518d\u6267\u884c\u547d\u4ee4\u7684\u8bdd\uff08\u5199\u524d\u65e5\u5fd7\uff09\uff0c\u65e5\u5fd7\u4e2d\u5c31\u6709\u53ef\u80fd\u8bb0\u5f55\u4e86\u9519\u8bef\u7684\u547d\u4ee4\uff0cRedis \u5728\u4f7f\u7528\u65e5\u5fd7\u6062\u590d\u6570\u636e\u65f6\uff0c\u5c31\u53ef\u80fd\u4f1a\u51fa\u9519\u3002 \u91cd\u8981\u7684\u65e5\u5fd7\u6a21\u5757\uff1aredo log \u5c31\u662f\u5199\u524d\u65e5\u5fd7 Mysql \u62e5\u6709SQL \u8bed\u53e5\u7684\u89e3\u6790\u5668 \u5199\u540e\u65e5\u5fd7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u5c31\u662f\u5148\u8ba9\u7cfb\u7edf\u6267\u884c\u547d\u4ee4\uff0c\u53ea\u6709\u547d\u4ee4\u80fd\u6267\u884c\u6210\u529f\uff0c\u624d\u4f1a\u88ab\u8bb0\u5f55\u5230\u65e5\u5fd7\u4e2d\uff0c\u5426\u5219\uff0c\u7cfb\u7edf\u5c31\u4f1a\u76f4\u63a5\u5411\u5ba2\u6237\u7aef\u62a5\u9519 \u3002\u6240\u4ee5\uff0cRedis \u4f7f\u7528\u5199\u540e\u65e5\u5fd7\u8fd9\u4e00\u65b9\u5f0f\u7684\u4e00\u5927\u597d\u5904\u662f\uff0c\u53ef\u4ee5 \u907f\u514d\u51fa\u73b0\u8bb0\u5f55\u9519\u8bef\u547d\u4ee4\u7684\u60c5\u51b5 \u3002 AOF \u8fd8\u6709\u4e00\u4e2a\u597d\u5904\uff1a\u5b83\u662f\u5728\u547d\u4ee4\u6267\u884c\u540e\u624d\u8bb0\u5f55\u65e5\u5fd7\uff0c\u6240\u4ee5\u4e0d\u4f1a\u963b\u585e\u5f53\u524d\u7684\u5199\u64cd\u4f5c\u3002","title":"1-1 AOF \u65e5\u5fd7: \u5199\u540e\u65e5\u5fd7"},{"location":"chap2/4redis_aof_log/#1-2-aof","text":"AOF \u4e5f\u6709\u4e24\u4e2a\u6f5c\u5728\u7684\u98ce\u9669\u3002 \u9996\u5148\uff0c\u53ef\u80fd\u4f1a\u6570\u636e\u4e22\u5931: \u5982\u679c\u521a\u6267\u884c\u5b8c\u4e00\u4e2a\u547d\u4ee4\uff0c\u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u8bb0\u65e5\u5fd7\u5c31\u5b95\u673a\u4e86\uff0c\u90a3\u4e48\u8fd9\u4e2a\u547d\u4ee4\u548c\u76f8\u5e94\u7684\u6570\u636e\u5c31\u6709\u4e22\u5931\u7684\u98ce\u9669\u3002\u5982\u679c\u6b64\u65f6 Redis \u662f\u7528\u4f5c\u7f13\u5b58\uff0c\u8fd8\u53ef\u4ee5\u4ece\u540e\u7aef\u6570\u636e\u5e93\u91cd\u65b0\u8bfb\u5165\u6570\u636e\u8fdb\u884c\u6062\u590d\uff0c\u4f46\u662f\uff0c\u5982\u679c Redis \u662f\u76f4\u63a5\u7528\u4f5c\u6570\u636e\u5e93\u7684\u8bdd\uff0c\u6b64\u65f6\uff0c\u56e0\u4e3a\u547d\u4ee4\u6ca1\u6709\u8bb0\u5165\u65e5\u5fd7\uff0c\u6240\u4ee5\u5c31\u65e0\u6cd5\u7528\u65e5\u5fd7\u8fdb\u884c\u6062\u590d\u4e86\u3002 \u5176\u6b21,\u53ef\u80fd\u963b\u585e\u5176\u4ed6\u64cd\u4f5c AOF \u867d\u7136\u907f\u514d\u4e86\u5bf9\u5f53\u524d\u547d\u4ee4\u7684\u963b\u585e\uff0c\u4f46\u53ef\u80fd\u4f1a\u7ed9\u4e0b\u4e00\u4e2a\u64cd\u4f5c\u5e26\u6765\u963b\u585e\u98ce\u9669\u3002\u8fd9\u662f\u56e0\u4e3a\uff0cAOF \u65e5\u5fd7\u4e5f\u662f\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\u7684\uff0c \u5982\u679c\u5728\u628a\u65e5\u5fd7\u6587\u4ef6\u5199\u5165\u78c1\u76d8\u65f6\uff0c\u78c1\u76d8\u5199\u538b\u529b\u5927\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5199\u76d8\u5f88\u6162\uff0c\u8fdb\u800c\u5bfc\u81f4\u540e\u7eed\u7684\u64cd\u4f5c\u4e5f\u65e0\u6cd5\u6267\u884c\u4e86 \u3002 \u4e24\u4e2a\u98ce\u9669\u90fd\u662f\u548c AOF \u5199\u56de\u78c1\u76d8\u7684\u65f6\u673a\u76f8\u5173\u7684\u3002\u8fd9\u4e5f\u5c31\u610f\u5473\u7740\uff0c\u5982\u679c\u6211\u4eec\u80fd\u591f\u63a7\u5236\u4e00\u4e2a\u5199\u547d\u4ee4\u6267\u884c\u5b8c\u540e AOF \u65e5\u5fd7\u5199\u56de\u78c1\u76d8\u7684\u65f6\u673a\uff0c\u8fd9\u4e24\u4e2a\u98ce\u9669\u5c31\u89e3\u9664\u4e86\u3002","title":"1-2 AOF \u6f5c\u5728\u7684\u98ce\u9669"},{"location":"chap2/4redis_aof_log/#1-3","text":"\u5176\u5b9e\uff0c\u5bf9\u4e8e\u8fd9\u4e2a\u95ee\u9898\uff0cAOF \u673a\u5236\u7ed9\u6211\u4eec\u63d0\u4f9b\u4e86\u4e09\u4e2a\u9009\u62e9\uff0c\u4e5f\u5c31\u662f AOF \u914d\u7f6e\u9879 appendfsync \u7684\u4e09\u4e2a\u53ef\u9009\u503c\u3002 Always\uff0c\u540c\u6b65\u5199\u56de \uff1a\u6bcf\u4e2a\u5199\u547d\u4ee4\u6267\u884c\u5b8c\uff0c \u7acb\u9a6c\u540c\u6b65\u5730\u5c06\u65e5\u5fd7\u5199\u56de\u78c1\u76d8 \uff1b Everysec\uff0c\u6bcf\u79d2\u5199\u56de \uff1a\u6bcf\u4e2a\u5199\u547d\u4ee4\u6267\u884c\u5b8c\uff0c\u53ea \u662f\u5148\u628a\u65e5\u5fd7\u5199\u5230 AOF \u6587\u4ef6\u7684\u5185\u5b58\u7f13\u51b2\u533a\uff0c\u6bcf\u9694\u4e00\u79d2\u628a\u7f13\u51b2\u533a\u4e2d\u7684\u5185\u5bb9\u5199\u5165\u78c1\u76d8 \uff1b No\uff0c\u64cd\u4f5c\u7cfb\u7edf\u63a7\u5236\u7684\u5199\u56de \uff1a\u6bcf\u4e2a\u5199\u547d\u4ee4\u6267\u884c\u5b8c\uff0c\u53ea\u662f\u5148\u628a\u65e5\u5fd7\u5199\u5230 AOF \u6587\u4ef6\u7684\u5185\u5b58\u7f13\u51b2\u533a\uff0c \u7531\u64cd\u4f5c\u7cfb\u7edf\u51b3\u5b9a\u4f55\u65f6\u5c06\u7f13\u51b2\u533a\u5185\u5bb9\u5199\u56de\u78c1\u76d8 \u3002 \u8fd9\u4e09\u79cd\u5199\u56de\u7b56\u7565\u90fd\u65e0\u6cd5\u505a\u5230\u4e24\u5168\u5176\u7f8e\u3002\u6211\u4eec\u6765\u5206\u6790\u4e0b\u5176\u4e2d\u7684\u539f\u56e0\u3002 \u201cAlways \u540c\u6b65\u5199\u56de\u201d\u53ef\u4ee5\u505a\u5230\u57fa\u672c\u4e0d\u4e22\u6570\u636e\uff0c\u4f46\u662f\u5b83\u5728\u6bcf\u4e00\u4e2a\u5199\u547d\u4ee4\u540e\u90fd\u6709\u4e00\u4e2a\u6162\u901f\u7684\u843d\u76d8\u64cd\u4f5c\uff0c \u4e0d\u53ef\u907f\u514d\u5730\u4f1a\u5f71\u54cd\u4e3b\u7ebf\u7a0b\u6027\u80fd \uff1b No \u867d\u7136\u201c\u64cd\u4f5c\u7cfb\u7edf\u63a7\u5236\u7684\u5199\u56de\u201d\u5728\u5199\u5b8c\u7f13\u51b2\u533a\u540e\uff0c\u5c31\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\u540e\u7eed\u7684\u547d\u4ee4\uff0c \u4f46\u662f\u843d\u76d8\u7684\u65f6\u673a\u5df2\u7ecf\u4e0d\u5728 Redis \u624b\u4e2d\u4e86\uff0c\u53ea\u8981 AOF \u8bb0\u5f55\u6ca1\u6709\u5199\u56de\u78c1\u76d8\uff0c\u4e00\u65e6\u5b95\u673a\u5bf9\u5e94\u7684\u6570\u636e\u5c31\u4e22\u5931\u4e86 \uff1b \u201cEverysec \u6bcf\u79d2\u5199\u56de\u201d\u91c7\u7528\u4e00\u79d2\u5199\u56de\u4e00\u6b21\u7684\u9891 \u7387\uff0c\u907f\u514d\u4e86\u201c\u540c\u6b65\u5199\u56de\u201d\u7684\u6027\u80fd\u5f00\u9500\uff0c\u867d\u7136\u51cf\u5c11\u4e86\u5bf9\u7cfb\u7edf\u6027\u80fd\u7684\u5f71\u54cd\uff0c\u4f46\u662f\u5982\u679c\u53d1\u751f\u5b95\u673a\uff0c \u4e0a\u4e00\u79d2\u5185\u672a\u843d\u76d8\u7684\u547d\u4ee4\u64cd\u4f5c\u4ecd\u7136\u4f1a\u4e22\u5931\u3002\u6240\u4ee5\uff0c\u8fd9\u53ea\u80fd\u7b97\u662f\uff0c\u5728\u907f\u514d\u5f71\u54cd\u4e3b\u7ebf\u7a0b\u6027\u80fd\u548c\u907f\u514d\u6570\u636e\u4e22\u5931\u4e24\u8005\u95f4\u53d6\u4e86\u4e2a\u6298\u4e2d\u3002 \u6211\u4eec\u5c31\u53ef\u4ee5\u6839\u636e\u7cfb\u7edf\u5bf9\u9ad8\u6027\u80fd\u548c\u9ad8\u53ef\u9760\u6027\u7684\u8981\u6c42\uff0c\u6765\u9009\u62e9\u4f7f\u7528\u54ea\u79cd\u5199\u56de\u7b56\u7565\u4e86\u3002\u603b\u7ed3\u4e00\u4e0b\u5c31\u662f\uff1a \u60f3\u8981\u83b7\u5f97\u9ad8\u6027\u80fd\uff0c\u5c31\u9009\u62e9 No \u7b56\u7565\uff1b\u5982\u679c\u60f3\u8981\u5f97\u5230\u9ad8\u53ef\u9760\u6027\u4fdd\u8bc1\uff0c\u5c31\u9009\u62e9 Always \u7b56\u7565\uff1b\u5982\u679c\u5141\u8bb8\u6570\u636e\u6709\u4e00\u70b9\u4e22\u5931\uff0c\u53c8\u5e0c\u671b\u6027\u80fd\u522b\u53d7\u592a\u5927\u5f71\u54cd\u7684\u8bdd\uff0c\u90a3\u4e48\u5c31\u9009\u62e9 Everysec \u7b56\u7565\u3002","title":"1-3 \u4e09\u79cd\u5199\u56de\u7b56\u7565"},{"location":"chap2/4redis_aof_log/#2-aof","text":"\u6309\u7167\u7cfb\u7edf\u7684\u6027\u80fd\u9700\u6c42\u9009\u5b9a\u4e86\u5199\u56de\u7b56\u7565\uff0c\u5e76\u4e0d\u662f\u201c\u9ad8\u6795\u65e0\u5fe7\u201d\u4e86\u3002\u6bd5\u7adf\uff0cAOF \u662f\u4ee5\u6587\u4ef6\u7684\u5f62\u5f0f\u5728\u8bb0\u5f55\u63a5\u6536\u5230\u7684\u6240\u6709\u5199\u547d\u4ee4\u3002\u968f\u7740\u63a5\u6536\u7684\u5199\u547d\u4ee4\u8d8a\u6765\u8d8a\u591a\uff0cAOF \u6587\u4ef6\u4f1a\u8d8a\u6765\u8d8a\u5927\u3002\u8fd9\u4e5f\u5c31\u610f\u5473\u7740\uff0c\u6211\u4eec\u4e00\u5b9a\u8981\u5c0f\u5fc3 AOF \u6587\u4ef6\u8fc7\u5927\u5e26\u6765\u7684\u6027\u80fd\u95ee\u9898\u3002 \u6587\u4ef6\u7cfb\u7edf\u672c\u8eab\u5bf9\u6587\u4ef6\u5927\u5c0f\u6709\u9650\u5236\uff0c\u65e0\u6cd5\u4fdd\u5b58\u8fc7\u5927\u7684\u6587\u4ef6\uff1b \u5982\u679c\u6587\u4ef6\u592a\u5927\uff0c\u4e4b\u540e\u518d\u5f80\u91cc\u9762\u8ffd\u52a0\u547d\u4ee4\u8bb0\u5f55\u7684\u8bdd\uff0c\u6548\u7387\u4e5f\u4f1a\u53d8\u4f4e \u5982\u679c\u53d1\u751f\u5b95\u673a\uff0cAOF \u4e2d\u8bb0\u5f55\u7684\u547d\u4ee4\u8981\u4e00\u4e2a\u4e2a\u88ab\u91cd\u65b0\u6267\u884c\uff0c\u7528\u4e8e\u6545\u969c\u6062\u590d\uff0c\u5982\u679c\u65e5\u5fd7\u6587\u4ef6\u592a\u5927\uff0c\u6574\u4e2a\u6062\u590d\u8fc7\u7a0b\u5c31\u4f1a\u975e\u5e38\u7f13\u6162\uff0c\u8fd9\u5c31\u4f1a\u5f71\u54cd\u5230 Redis \u7684\u6b63\u5e38\u4f7f\u7528","title":"2\u3001 AOF \u6587\u4ef6\u8fc7\u5927\u5e26\u6765\u7684\u95ee\u9898"},{"location":"chap2/4redis_aof_log/#2-1-aof","text":"AOF \u91cd\u5199\u673a\u5236\u5c31\u662f\u5728\u91cd\u5199\u65f6\uff0cRedis \u6839\u636e\u6570\u636e\u5e93\u7684\u73b0\u72b6\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 AOF \u6587\u4ef6\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8bfb\u53d6\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u952e\u503c\u5bf9\uff0c\u7136\u540e\u5bf9\u6bcf\u4e00\u4e2a\u952e\u503c\u5bf9\u7528\u4e00\u6761\u547d\u4ee4\u8bb0\u5f55\u5b83\u7684\u5199\u5165 \u3002 \u6bd4\u5982\u8bf4\uff0c\u5f53\u8bfb\u53d6\u4e86\u952e\u503c\u5bf9\u201ctestkey\u201d: \u201ctestvalue\u201d\u4e4b\u540e\uff0c\u91cd\u5199\u673a\u5236\u4f1a\u8bb0\u5f55 set testkey testvalue \u8fd9\u6761\u547d\u4ee4\u3002\u8fd9\u6837\uff0c\u5f53\u9700\u8981\u6062\u590d\u65f6\uff0c\u53ef\u4ee5\u91cd\u65b0\u6267\u884c\u8be5\u547d\u4ee4\uff0c\u5b9e\u73b0 \u201ctestkey\u201d: \u201ctestvalue\u201d \u7684\u5199\u5165\u3002 \u4e3a\u4ec0\u4e48\u91cd\u5199\u673a\u5236\u53ef\u4ee5\u628a\u65e5\u5fd7\u6587\u4ef6\u53d8\u5c0f\u5462? \u5b9e\u9645\u4e0a\uff0c \u91cd\u5199\u673a\u5236\u5177\u6709\u201c\u591a\u53d8\u4e00\u201d\u529f\u80fd\u3002\u6240\u8c13\u7684\u201c\u591a\u53d8\u4e00\u201d\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u65e7\u65e5\u5fd7\u6587\u4ef6\u4e2d\u7684\u591a\u6761\u547d\u4ee4\uff0c\u5728\u91cd\u5199\u540e\u7684\u65b0\u65e5\u5fd7\u4e2d\u53d8\u6210\u4e86\u4e00\u6761\u547d\u4ee4\u3002 AOF \u6587\u4ef6\u662f\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\uff0c\u9010\u4e00\u8bb0\u5f55\u63a5\u6536\u5230\u7684\u5199\u547d\u4ee4\u7684\u3002\u5f53\u4e00\u4e2a\u952e\u503c\u5bf9\u88ab\u591a\u6761\u5199\u547d\u4ee4\u53cd\u590d\u4fee\u6539\u65f6\uff0cAOF \u6587\u4ef6\u4f1a\u8bb0\u5f55\u76f8\u5e94\u7684\u591a\u6761\u547d\u4ee4 \u5728\u91cd\u5199\u7684\u65f6\u5019\uff0c\u662f\u6839\u636e\u8fd9\u4e2a\u952e\u503c\u5bf9\u5f53\u524d\u7684\u6700\u65b0\u72b6\u6001\uff0c\u4e3a\u5b83\u751f\u6210\u5bf9\u5e94\u7684\u5199\u5165\u547d\u4ee4 \u4e00\u4e2a\u952e\u503c\u5bf9\u5728\u91cd\u5199\u65e5\u5fd7\u4e2d\u53ea\u7528\u4e00\u6761\u547d\u4ee4\u5c31\u884c\u4e86\uff0c\u800c\u4e14\uff0c\u5728\u65e5\u5fd7\u6062\u590d\u65f6\uff0c\u53ea\u7528\u6267\u884c\u8fd9\u6761\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u5b8c\u6210\u8fd9\u4e2a\u952e\u503c\u5bf9\u7684\u5199\u5165\u4e86\u3002 \u5f53\u6211\u4eec\u5bf9\u4e00\u4e2a\u5217\u8868\u5148\u540e\u505a\u4e86 6 \u6b21\u4fee\u6539\u64cd\u4f5c\u540e\uff0c\u5217\u8868\u7684\u6700\u540e\u72b6\u6001\u662f [\u201cD\u201d, \u201cC\u201d, \u201cN\u201d] \uff0c\u6b64\u65f6\uff0c\u53ea\u7528 LPUSH u:list \u201cN\u201d, \u201cC\u201d, \"D\" \u8fd9\u4e00\u6761\u547d\u4ee4\u5c31\u80fd\u5b9e\u73b0\u8be5\u6570\u636e\u7684\u6062\u590d\uff0c\u8fd9\u5c31\u8282\u7701\u4e86\u4e94\u6761\u547d\u4ee4\u7684\u7a7a\u95f4\u3002 \u4e0d\u8fc7\uff0c\u867d\u7136 AOF \u91cd\u5199\u540e\uff0c\u65e5\u5fd7\u6587\u4ef6\u4f1a\u7f29\u5c0f\uff0c\u4f46\u662f\uff0c\u8981\u628a\u6574\u4e2a\u6570\u636e\u5e93\u7684\u6700\u65b0\u6570\u636e\u7684\u64cd\u4f5c\u65e5\u5fd7\u90fd\u5199\u56de\u78c1\u76d8\uff0c\u4ecd\u7136\u662f\u4e00\u4e2a\u975e\u5e38\u8017\u65f6\u7684\u8fc7\u7a0b, \u91cd\u5199\u4f1a\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\uff1f 2-2 AOF \u91cd\u5199\u4f1a\u963b\u585e\u5417? \u548c AOF \u65e5\u5fd7\u7531\u4e3b\u7ebf\u7a0b\u5199\u56de\u4e0d\u540c\uff0c \u91cd\u5199\u8fc7\u7a0b\u662f\u7531\u540e\u53f0\u5b50\u8fdb\u7a0b bgrewriteaof \u6765\u5b8c\u6210\u7684\uff0c\u8fd9\u4e5f\u662f\u4e3a\u4e86\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u5bfc\u81f4\u6570\u636e\u5e93\u6027\u80fd\u4e0b\u964d \u3002 Aof\u91cd\u5199\u65e5\u5fd7\u603b\u7ed3\u4e3a\uff0c\u4e00\u6b21\u62f7\u8d1d\uff0c\u4e24\u5904\u65e5\u5fd7\u3002 \u4e00\u6b21\u62f7\u8d1d: \u6bcf\u6b21\u6267\u884c\u91cd\u5199\u65f6\uff0c\u4e3b\u7ebf\u7a0b fork \u51fa\u540e\u53f0\u7684 bgrewriteaof \u5b50\u8fdb\u7a0b\u3002 \u6b64\u65f6\uff0c fork \u4f1a\u628a\u4e3b\u7ebf\u7a0b\u7684\u5185\u5b58\u62f7\u8d1d\u4e00\u4efd\u7ed9 bgrewriteaof \u5b50\u8fdb\u7a0b\uff0c\u8fd9\u91cc\u9762\u5c31\u5305\u542b\u4e86\u6570\u636e\u5e93\u7684\u6700\u65b0\u6570\u636e\u3002 \u7136\u540e\uff0c bgrewriteaof \u5b50\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u5728\u4e0d\u5f71\u54cd\u4e3b\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\uff0c\u9010\u4e00\u628a\u62f7\u8d1d\u7684\u6570\u636e\u5199\u6210\u64cd\u4f5c\uff0c\u8bb0\u5165\u91cd\u5199\u65e5\u5fd7\u3002 \u4e24\u5904\u65e5\u5fd7: \u56e0\u4e3a\u4e3b\u7ebf\u7a0b\u672a\u963b\u585e\uff0c\u4ecd\u7136\u53ef\u4ee5\u5904\u7406\u65b0\u6765\u7684\u64cd\u4f5c\u3002\u6b64\u65f6\uff0c\u5982\u679c\u6709\u5199\u64cd\u4f5c\uff0c \u7b2c\u4e00\u5904\u65e5\u5fd7\u5c31\u662f\u6307\u6b63\u5728\u4f7f\u7528\u7684 AOF \u65e5\u5fd7 \uff0cRedis \u4f1a\u628a\u8fd9\u4e2a\u64cd\u4f5c\u5199\u5230\u5b83\u7684\u7f13\u51b2\u533a\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u5b95\u673a\u4e86\uff0c\u8fd9\u4e2a AOF \u65e5\u5fd7\u7684\u64cd\u4f5c\u4ecd\u7136\u662f\u9f50\u5168\u7684\uff0c\u53ef\u4ee5\u7528\u4e8e\u6062\u590d\u3002 \u800c\u7b2c\u4e8c\u5904\u65e5\u5fd7\uff0c\u5c31\u662f\u6307\u65b0\u7684 AOF \u91cd\u5199\u65e5\u5fd7 \u3002\u8fd9\u4e2a\u64cd\u4f5c\u4e5f\u4f1a\u88ab\u5199\u5230\u91cd\u5199\u65e5\u5fd7\u7684\u7f13\u51b2\u533a\u3002\u8fd9\u6837\uff0c\u91cd\u5199\u65e5\u5fd7\u4e5f\u4e0d\u4f1a\u4e22\u5931\u6700\u65b0\u7684\u64cd\u4f5c\u3002\u7b49\u5230\u62f7\u8d1d\u6570\u636e\u7684\u6240\u6709\u64cd\u4f5c\u8bb0\u5f55\u91cd\u5199\u5b8c\u6210\u540e\uff0c\u91cd\u5199\u65e5\u5fd7\u8bb0\u5f55\u7684\u8fd9\u4e9b\u6700\u65b0\u64cd\u4f5c\u4e5f\u4f1a\u5199\u5165\u65b0\u7684 AOF \u6587\u4ef6\uff0c\u4ee5\u4fdd\u8bc1\u6570\u636e\u5e93\u6700\u65b0\u72b6\u6001\u7684\u8bb0\u5f55\u3002\u6b64\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u65b0\u7684 AOF \u6587\u4ef6\u66ff\u4ee3\u65e7\u6587\u4ef6\u4e86\u3002 \u603b\u7ed3\u6765\u8bf4 \u6bcf\u6b21 AOF \u91cd\u5199\u65f6\uff0cRedis \u4f1a\u5148\u6267\u884c\u4e00\u4e2a\u5185\u5b58\u62f7\u8d1d\uff0c\u7528\u4e8e\u91cd\u5199\uff1b \u7136\u540e\uff0c\u4f7f\u7528\u4e24\u4e2a\u65e5\u5fd7\u4fdd\u8bc1\u5728\u91cd\u5199\u8fc7\u7a0b\u4e2d\uff0c\u65b0\u5199\u5165\u7684\u6570\u636e\u4e0d\u4f1a\u4e22\u5931\u3002 \u800c\u4e14\uff0c\u56e0\u4e3a Redis \u91c7\u7528\u989d\u5916\u7684\u7ebf\u7a0b\u8fdb\u884c\u6570\u636e\u91cd\u5199\uff0c\u6240\u4ee5\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5e76\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b \u3002 2-3 \u4ec0\u4e48\u65f6\u5019\u4f1a\u89e6\u53d1AOF \u91cd\u5199\u5462\uff1f \u6709\u4e24\u4e2a\u914d\u7f6e\u9879\u5728\u63a7\u5236AOF\u91cd\u5199\u7684\u89e6\u53d1\u65f6\u673a\uff1a auto-aof-rewrite-min-size : \u8868\u793a\u8fd0\u884cAOF\u91cd\u5199\u65f6\u6587\u4ef6\u7684\u6700\u5c0f\u5927\u5c0f\uff0c \u9ed8\u8ba4\u4e3a64MB auto-aof-rewrite-percentage : \u8fd9\u4e2a\u503c\u7684\u8ba1\u7b97\u65b9\u6cd5\u662f\uff1a\u5f53\u524dAOF\u6587\u4ef6\u5927\u5c0f\u548c\u4e0a\u4e00\u6b21\u91cd\u5199\u540eAOF\u6587\u4ef6\u5927\u5c0f\u7684\u5dee\u503c\uff0c\u518d\u9664\u4ee5\u4e0a\u4e00\u6b21\u91cd\u5199\u540eAOF\u6587\u4ef6\u5927\u5c0f\u3002\u4e5f\u5c31\u662f\u5f53\u524dAOF\u6587\u4ef6\u6bd4\u4e0a\u4e00\u6b21\u91cd\u5199\u540eAOF\u6587\u4ef6\u7684\u589e\u91cf\u5927\u5c0f\uff0c\u548c\u4e0a\u4e00\u6b21\u91cd\u5199\u540eAOF\u6587\u4ef6\u5927\u5c0f\u7684\u6bd4\u503c\u3002 AOF\u6587\u4ef6\u5927\u5c0f\u540c\u65f6\u8d85\u51fa\u4e0a\u9762\u8fd9\u4e24\u4e2a\u914d\u7f6e\u9879\u65f6\uff0c\u4f1a\u89e6\u53d1AOF\u91cd\u5199\u3002","title":"2-1 \u65e5\u5fd7\u6587\u4ef6\u592a\u5927\u4e86\u600e\u4e48\u529e\uff1fAOF \u91cd\u5199\u673a\u5236"},{"location":"chap2/4redis_aof_log/#3","text":"Redis \u7528\u4e8e\u907f\u514d\u6570\u636e\u4e22\u5931\u7684 AOF \u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u901a\u8fc7\u9010\u4e00\u8bb0\u5f55\u64cd\u4f5c\u547d\u4ee4\uff0c\u5728\u6062\u590d\u65f6\u518d\u9010\u4e00\u6267\u884c\u547d\u4ee4\u7684\u65b9\u5f0f\uff0c\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u53ef\u9760\u6027 \u603b\u7ed3\u6765\u8bf4\uff0c\u5b83\u63d0\u4f9b\u4e86 AOF \u65e5\u5fd7\u7684\u4e09\u79cd\u5199\u56de\u7b56\u7565\uff0c\u5206\u522b\u662f Always\u3001Everysec \u548c No\uff0c\u8fd9\u4e09\u79cd\u7b56\u7565\u5728\u53ef\u9760\u6027\u4e0a\u662f\u4ece\u9ad8\u5230\u4f4e\uff0c\u800c\u5728\u6027\u80fd\u4e0a\u5219\u662f\u4ece\u4f4e\u5230\u9ad8\u3002 \u6b64\u5916\uff0c\u4e3a\u4e86\u907f\u514d\u65e5\u5fd7\u6587\u4ef6\u8fc7\u5927\uff0cRedis \u8fd8\u63d0\u4f9b\u4e86 AOF \u91cd\u5199\u673a\u5236\uff0c\u76f4\u63a5\u6839\u636e\u6570\u636e\u5e93\u91cc\u6570\u636e\u7684\u6700\u65b0\u72b6\u6001\uff0c\u751f\u6210\u8fd9\u4e9b\u6570\u636e\u7684\u63d2\u5165\u547d\u4ee4\uff0c\u4f5c\u4e3a\u65b0\u65e5\u5fd7\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u901a\u8fc7\u540e\u53f0\u7ebf\u7a0b\u5b8c\u6210\uff0c\u907f\u514d\u4e86\u5bf9\u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\u3002 AOF \u65e5\u5fd7\u91cd\u5199\u7684\u65f6\u5019\uff0c\u662f\u7531 bgrewriteaof \u5b50\u8fdb\u7a0b\u6765\u5b8c\u6210\u7684\uff0c\u4e0d\u7528\u4e3b\u7ebf\u7a0b\u53c2\u4e0e\uff0c\u6211\u4eec\u4eca\u5929\u8bf4\u7684\u975e\u963b\u585e\u4e5f\u662f\u6307\u5b50\u8fdb\u7a0b\u7684\u6267\u884c\u4e0d\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002\u4f46\u662f\uff0c\u4f60\u89c9\u5f97\uff0c\u8fd9\u4e2a\u91cd\u5199\u8fc7\u7a0b\u6709\u6ca1\u6709\u5176\u4ed6\u6f5c\u5728\u7684\u963b\u585e\u98ce\u9669\u5462\uff1f\u5982\u679c\u6709\u7684\u8bdd\uff0c\u4f1a\u5728\u54ea\u91cc\u963b\u585e\uff1f \u6f5c\u5728\u7684\u963b\u585e\u98ce\u9669\u5305\u62ec\uff1afork\u5b50\u8fdb\u7a0b \u548c AOF\u91cd\u5199\u8fc7\u7a0b\u4e2d\u7236\u8fdb\u7a0b\u4ea7\u751f\u5199\u5165 AOF \u91cd\u5199\u4e5f\u6709\u4e00\u4e2a\u91cd\u5199\u65e5\u5fd7\uff0c\u4e3a\u4ec0\u4e48\u5b83\u4e0d\u5171\u4eab\u4f7f\u7528 AOF \u672c\u8eab\u7684\u65e5\u5fd7\u5462\uff1f \u63d0\u95ee\uff1a AOF\u91cd\u5199\u4e0d\u590d\u7528AOF\u672c\u8eab\u7684\u65e5\u5fd7\uff0c \u4e00\u4e2a\u539f\u56e0\u662f\u7236 \u5b50\u8fdb\u7a0b\u5199\u540c\u4e00\u4e2a\u6587\u4ef6\u5fc5\u7136\u4f1a\u4ea7\u751f\u7ade\u4e89\u95ee\u9898\uff0c\u63a7\u5236\u7ade\u4e89\u5c31\u610f\u5473\u7740\u4f1a\u5f71\u54cd\u7236\u8fdb\u7a0b\u7684\u6027\u80fd \u4e8c\u662f\u5982\u679cAOF\u91cd\u5199\u8fc7\u7a0b\u4e2d\u5931\u8d25\u4e86\uff0c\u90a3\u4e48\u539f\u672c\u7684AOF\u6587\u4ef6\u76f8\u5f53\u4e8e\u88ab\u6c61\u67d3\u4e86\uff0c\u65e0\u6cd5\u505a\u6062\u590d\u4f7f\u7528\u3002\u6240\u4ee5Redis AOF\u91cd\u5199\u4e00\u4e2a\u65b0\u6587\u4ef6\uff0c\u91cd\u5199\u5931\u8d25\u7684\u8bdd\uff0c\u76f4\u63a5\u5220\u9664\u8fd9\u4e2a\u6587\u4ef6\u5c31\u597d\u4e86\uff0c\u4e0d\u4f1a\u5bf9\u539f\u5148\u7684AOF\u6587\u4ef6\u4ea7\u751f\u5f71\u54cd\u3002 \u7b49\u91cd\u5199\u5b8c\u6210\u4e4b\u540e\uff0c\u76f4\u63a5\u66ff\u6362\u65e7\u6587\u4ef6\u5373\u53ef\u3002","title":"3\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap2/5redis_rdb_snapshot/","text":"\u7b2c\u4e94\u8282 Redis\u5b95\u673a\uff0cRedis\u5982\u4f55\u5b9e\u73b0\u5feb\u901f\u6062\u590dRDB 1\u3001\u4ec0\u4e48\u662f\u5185\u5b58\u5feb\u7167 Redis \u907f\u514d\u6570\u636e\u4e22\u5931\u7684 AOF \u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u7684\u597d\u5904\uff0c\u662f\u6bcf\u6b21\u6267\u884c\u53ea\u9700\u8981\u8bb0\u5f55\u64cd\u4f5c\u547d\u4ee4\uff0c\u9700\u8981\u6301\u4e45\u5316\u7684\u6570\u636e\u91cf\u4e0d\u5927\u3002\u4e00\u822c\u800c\u8a00\uff0c\u53ea\u8981\u4f60\u91c7\u7528\u7684\u4e0d\u662f always \u7684\u6301\u4e45\u5316\u7b56\u7565\uff0c\u5c31\u4e0d\u4f1a\u5bf9\u6027\u80fd\u9020\u6210\u592a\u5927\u5f71\u54cd\u3002 \u4f46\u662f\uff0c\u4e5f\u6b63\u56e0\u4e3a\u8bb0\u5f55\u7684\u662f\u64cd\u4f5c\u547d\u4ee4\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u7684\u6570\u636e\uff0c \u6240\u4ee5\uff0c\u7528 AOF \u65b9\u6cd5\u8fdb\u884c\u6545\u969c\u6062\u590d\u7684\u65f6\u5019\uff0c\u9700\u8981\u9010\u4e00\u628a\u64cd\u4f5c\u65e5\u5fd7\u90fd\u6267\u884c\u4e00\u904d\u3002\u5982\u679c\u64cd\u4f5c\u65e5\u5fd7\u975e\u5e38\u591a\uff0cRedis \u5c31\u4f1a\u6062\u590d\u5f97\u5f88\u7f13\u6162\uff0c\u5f71\u54cd\u5230\u6b63\u5e38\u4f7f\u7528 \u3002 \u8fd8\u6709\u6ca1\u6709\u65e2\u53ef\u4ee5\u4fdd\u8bc1\u53ef\u9760\u6027\uff0c\u8fd8\u80fd\u5728\u5b95\u673a\u65f6\u5b9e\u73b0\u5feb\u901f\u6062\u590d\u7684\u5176\u4ed6\u65b9\u6cd5\u5462\uff1f \u5185\u5b58\u5feb\u7167 \u5bf9 Redis \u6765\u8bf4\uff0c\u5b83\u5b9e\u73b0\u7c7b\u4f3c\u7167\u7247\u8bb0\u5f55\u6548\u679c\u7684\u65b9\u5f0f\uff0c\u5c31\u662f\u628a\u67d0\u4e00\u65f6\u523b\u7684\u72b6\u6001\u4ee5\u6587\u4ef6\u7684\u5f62\u5f0f\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u4e5f\u5c31\u662f\u5feb\u7167\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u5b95\u673a\uff0c\u5feb\u7167\u6587\u4ef6\u4e5f\u4e0d\u4f1a\u4e22\u5931\uff0c\u6570\u636e\u7684\u53ef\u9760\u6027\u4e5f\u5c31\u5f97\u5230\u4e86\u4fdd\u8bc1\u3002\u8fd9\u4e2a\u5feb\u7167\u6587\u4ef6\u5c31\u79f0\u4e3a RDB \u6587\u4ef6\uff0c\u5176\u4e2d\uff0cRDB \u5c31\u662f Redis DataBase \u7684\u7f29\u5199 \u548c AOF \u76f8\u6bd4\uff0cRDB \u8bb0\u5f55\u7684\u662f\u67d0\u4e00\u65f6\u523b\u7684\u6570\u636e\uff0c\u5e76\u4e0d\u662f\u64cd\u4f5c\uff0c\u6240\u4ee5\uff0c\u5728\u505a\u6570\u636e\u6062\u590d\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u628a RDB \u6587\u4ef6\u8bfb\u5165\u5185\u5b58\uff0c\u5f88\u5feb\u5730\u5b8c\u6210\u6062\u590d\u3002 \u6211\u4eec\u8fd8\u8981\u8003\u8651\u4e24\u4e2a\u5173\u952e\u95ee\u9898\uff1a \u5bf9\u54ea\u4e9b\u6570\u636e\u505a\u5feb\u7167\uff1f\u8fd9\u5173\u7cfb\u5230\u5feb\u7167\u7684\u6267\u884c\u6548\u7387\u95ee\u9898\uff1b \u505a\u5feb\u7167\u65f6\uff0c\u6570\u636e\u8fd8\u80fd\u88ab\u589e\u5220\u6539\u5417\uff1f\u8fd9\u5173\u7cfb\u5230 Redis \u662f\u5426\u88ab\u963b\u585e\uff0c\u80fd\u5426\u540c\u65f6\u6b63\u5e38\u5904\u7406\u8bf7\u6c42\u3002 2\u3001\u7ed9\u54ea\u4e9b\u5185\u5b58\u6570\u636e\u505a\u5feb\u7167\uff1f Redis \u7684\u6570\u636e\u90fd\u5728\u5185\u5b58\u4e2d\uff0c\u4e3a\u4e86\u63d0\u4f9b\u6240\u6709\u6570\u636e\u7684\u53ef\u9760\u6027\u4fdd\u8bc1\uff0c \u5b83\u6267\u884c\u7684\u662f\u5168\u91cf\u5feb\u7167 \uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u628a\u5185\u5b58\u4e2d\u7684\u6240\u6709\u6570\u636e\u90fd\u8bb0\u5f55\u5230\u78c1\u76d8\u4e2d\uff0c\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u4e00\u6b21\u6027\u8bb0\u5f55\u4e86\u6240\u6709\u6570\u636e\uff0c\u4e00\u4e2a\u90fd\u4e0d\u5c11 \u7ed9\u5185\u5b58\u7684\u5168\u91cf\u6570\u636e\u505a\u5feb\u7167\uff0c\u628a\u5b83\u4eec\u5168\u90e8\u5199\u5165\u78c1\u76d8\u4e5f\u4f1a\u82b1\u8d39\u5f88\u591a\u65f6\u95f4\u3002 \u800c\u4e14\uff0c\u5168\u91cf\u6570\u636e\u8d8a\u591a\uff0cRDB \u6587\u4ef6\u5c31\u8d8a\u5927\uff0c\u5f80\u78c1\u76d8\u4e0a\u5199\u6570\u636e\u7684\u65f6\u95f4\u5f00\u9500\u5c31\u8d8a\u5927\u3002 \u5bf9\u4e8e Redis \u800c\u8a00\uff0c\u5b83\u7684\u5355\u7ebf\u7a0b\u6a21\u578b\u5c31\u51b3\u5b9a\u4e86\uff0c\u6211\u4eec\u8981\u5c3d\u91cf\u907f\u514d\u6240\u6709\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u7684\u64cd\u4f5c 2-1 RDB \u6587\u4ef6\u7684\u751f\u6210\u662f\u5426\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\uff1f Redis \u63d0\u4f9b\u4e86\u4e24\u4e2a\u547d\u4ee4\u6765\u751f\u6210 RDB \u6587\u4ef6\uff0c\u5206\u522b\u662f save \u548c bgsave \u3002 save\uff1a\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\uff0c\u4f1a\u5bfc\u81f4\u963b\u585e\uff1b bgsave\uff1a \u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u4e13\u95e8\u7528\u4e8e\u5199\u5165 RDB \u6587\u4ef6\uff0c\u907f\u514d\u4e86\u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\uff0c\u8fd9\u4e5f\u662f Redis RDB \u6587\u4ef6\u751f\u6210\u7684\u9ed8\u8ba4\u914d\u7f6e\u3002 \u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7 bgsave \u547d\u4ee4\u6765\u6267\u884c\u5168\u91cf\u5feb\u7167\uff0c\u8fd9\u65e2\u63d0\u4f9b\u4e86\u6570\u636e\u7684\u53ef\u9760\u6027\u4fdd\u8bc1\uff0c\u4e5f\u907f\u514d\u4e86\u5bf9 Redis \u7684\u6027\u80fd\u5f71\u54cd 3\u3001\u5feb\u7167\u65f6\u6570\u636e\u80fd\u4fee\u6539\u5417? \u5bf9\u4e8e\u5185\u5b58\u5feb\u7167\u800c\u8a00\uff0c\u6211\u4eec\u4e0d\u5e0c\u671b\u6570\u636e\u201c\u52a8\u201d\u3002 \u4e3e\u4e2a\u4f8b\u5b50\u3002\u6211\u4eec\u5728\u65f6\u523b t \u7ed9\u5185\u5b58\u505a\u5feb\u7167\uff0c\u5047\u8bbe\u5185\u5b58\u6570\u636e\u91cf\u662f 4GB\uff0c\u78c1\u76d8\u7684\u5199\u5165\u5e26\u5bbd\u662f 0.2GB/s\uff0c\u7b80\u5355\u6765\u8bf4\uff0c\u81f3\u5c11\u9700\u8981 20s\uff084/0.2 = 20\uff09 \u624d\u80fd\u505a\u5b8c\u3002 \u5982\u679c\u5728\u65f6\u523b t+5s \u65f6\uff0c\u4e00\u4e2a\u8fd8\u6ca1\u6709\u88ab\u5199\u5165\u78c1\u76d8\u7684\u5185\u5b58\u6570\u636e A\uff0c\u88ab\u4fee\u6539\u6210\u4e86 A\u2019 \uff0c\u90a3\u4e48\u5c31\u4f1a\u7834\u574f\u5feb\u7167\u7684\u5b8c\u6574\u6027\uff0c\u56e0\u4e3a A\u2019\u4e0d\u662f\u65f6\u523b t \u65f6\u7684\u72b6\u6001\u3002\u56e0\u6b64\uff0c\u548c\u62cd\u7167\u7c7b\u4f3c\uff0c\u6211\u4eec\u5728\u505a\u5feb\u7167\u65f6\u4e5f\u4e0d\u5e0c\u671b\u6570\u636e\u201c\u52a8\u201d\uff0c\u4e5f\u5c31\u662f\u4e0d\u80fd\u88ab\u4fee\u6539\u3002 \u4f46\u662f\uff0c\u5982\u679c\u5feb\u7167\u6267\u884c\u671f\u95f4\u6570\u636e\u4e0d\u80fd\u88ab\u4fee\u6539\uff0c\u662f\u4f1a\u6709\u6f5c\u5728\u95ee\u9898\u7684\u3002\u5bf9\u4e8e\u521a\u521a\u7684\u4f8b\u5b50\u6765\u8bf4\uff0c\u5728\u505a\u5feb\u7167\u7684 20s \u65f6\u95f4\u91cc\uff0c\u5982\u679c\u8fd9 4GB \u7684\u6570\u636e\u90fd\u4e0d\u80fd\u88ab\u4fee\u6539\uff0cRedis \u5c31\u4e0d\u80fd\u5904\u7406\u5bf9\u8fd9\u4e9b\u6570\u636e\u7684\u5199\u64cd\u4f5c\uff0c\u90a3\u65e0\u7591\u5c31\u4f1a\u7ed9\u4e1a\u52a1\u670d\u52a1\u9020\u6210\u5de8\u5927\u7684\u5f71\u54cd\u3002 \u4f60\u53ef\u80fd\u4f1a\u60f3\u5230\uff0c\u53ef\u4ee5\u7528 bgsave \u907f\u514d\u963b\u585e\u554a : \u907f\u514d\u963b\u585e\u548c\u6b63\u5e38\u5904\u7406\u5199\u64cd\u4f5c\u5e76\u4e0d\u662f\u4e00\u56de\u4e8b \u3002\u6b64\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u7684\u786e\u6ca1\u6709\u963b\u585e\uff0c\u53ef\u4ee5\u6b63\u5e38\u63a5\u6536\u8bf7\u6c42\uff0c\u4f46\u662f\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u5feb\u7167\u5b8c\u6574\u6027\uff0c\u5b83\u53ea\u80fd\u5904\u7406\u8bfb\u64cd\u4f5c\uff0c\u56e0\u4e3a\u4e0d\u80fd\u4fee\u6539\u6b63\u5728\u6267\u884c\u5feb\u7167\u7684\u6570\u636e\u3002 RDB\u91c7\u7528\u5199\u65f6\u590d\u5236\uff08COW\uff0ccopy on write\uff09\u7b56\u7565\u3002 \u4e3b\u7ebf\u7a0b\u5982\u679c\u90fd\u662f\u8bfb\u53d6\u64cd\u4f5c\uff0c\u90a3\u4e48\u5b50\u7ebf\u7a0b\u4e0d\u9700\u8981\u590d\u5236\u6570\u636e\u5757\u3002 \u5982\u679c\u4e3b\u7ebf\u7a0b\u7684\u67d0\u5757\u6570\u636e\u6709\u4fee\u6539\uff0c \u90a3\u4e48\u5b50\u7ebf\u7a0b\u9700\u8981\u590d\u5236\u6570\u636e\u5757\uff0c\u4ece\u800c\u4e0d\u4f1a\u5f71\u54cd\u4e3b\u7ebf\u7a0b\u7684\u4fee\u6539\u64cd\u4f5c\u3002 \u5feb\u7167\u800c\u6682\u505c\u5199\u64cd\u4f5c\uff0c\u80af\u5b9a\u662f\u4e0d\u80fd\u63a5\u53d7\u7684\u3002\u6240\u4ee5\u8fd9\u4e2a\u65f6\u5019\uff0c Redis \u5c31\u4f1a\u501f\u52a9\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u5199\u65f6\u590d\u5236\u6280\u672f\uff08Copy-On-Write, COW\uff09\uff0c\u5728\u6267\u884c\u5feb\u7167\u7684\u540c\u65f6\uff0c\u6b63\u5e38\u5904\u7406\u5199\u64cd\u4f5c \u3002 bgsave \u5b50\u8fdb\u7a0b\u662f\u7531\u4e3b\u7ebf\u7a0b fork \u751f\u6210\u7684\uff0c\u53ef\u4ee5\u5171\u4eab\u4e3b\u7ebf\u7a0b\u7684\u6240\u6709\u5185\u5b58\u6570\u636e\u3002bgsave \u5b50\u8fdb\u7a0b\u8fd0\u884c\u540e\uff0c\u5f00\u59cb\u8bfb\u53d6\u4e3b\u7ebf\u7a0b\u7684\u5185\u5b58\u6570\u636e\uff0c\u5e76\u628a\u5b83\u4eec\u5199\u5165 RDB \u6587\u4ef6\u3002 \u5982\u679c\u4e3b\u7ebf\u7a0b\u5bf9\u8fd9\u4e9b\u6570\u636e\u4e5f\u90fd\u662f\u8bfb\u64cd\u4f5c \uff08\u4f8b\u5982\u56fe\u4e2d\u7684\u952e\u503c\u5bf9 A\uff09\uff0c\u90a3\u4e48\uff0c\u4e3b\u7ebf\u7a0b\u548c bgsave \u5b50\u8fdb\u7a0b\u76f8\u4e92\u4e0d\u5f71\u54cd\u3002 \u5982\u679c\u4e3b\u7ebf\u7a0b\u8981\u4fee\u6539\u4e00\u5757\u6570\u636e\uff08\u4f8b\u5982\u56fe\u4e2d\u7684\u952e\u503c\u5bf9 C\uff09\uff0c\u90a3\u4e48\uff0c\u8fd9\u5757\u6570\u636e\u5c31\u4f1a\u88ab\u590d\u5236\u4e00\u4efd\uff0c\u751f\u6210\u8be5\u6570\u636e\u7684\u526f\u672c\u3002 \u7136\u540e\uff0cbgsave \u5b50\u8fdb\u7a0b\u4f1a\u628a\u8fd9\u4e2a\u526f\u672c\u6570\u636e\u5199\u5165 RDB \u6587\u4ef6\uff0c\u800c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4e3b\u7ebf\u7a0b\u4ecd\u7136\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539\u539f\u6765\u7684\u6570\u636e \u3002 \u8fd9\u65e2\u4fdd\u8bc1\u4e86\u5feb\u7167\u7684\u5b8c\u6574\u6027\uff0c\u4e5f\u5141\u8bb8\u4e3b\u7ebf\u7a0b\u540c\u65f6\u5bf9\u6570\u636e\u8fdb\u884c\u4fee\u6539\uff0c\u907f\u514d\u4e86\u5bf9\u6b63\u5e38\u4e1a\u52a1\u7684\u5f71\u54cd\u3002 4\u3001\u591a\u4e45\u505a\u4e00\u6b21\u5feb\u7167 4-1 \u8fde\u62cd\u5168\u91cf\u5feb\u7167\u5e26\u6765\u7684\u95ee\u9898 \u5bf9\u4e8e\u5feb\u7167\u6765\u8bf4\uff0c\u6240\u8c13\u201c\u8fde\u62cd\u201d\u5c31\u662f\u6307\u8fde\u7eed\u5730\u505a\u5feb\u7167\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5feb\u7167\u7684\u95f4\u9694\u65f6\u95f4\u53d8\u5f97\u5f88\u77ed\uff0c\u5373\u4f7f\u67d0\u4e00\u65f6\u523b\u53d1\u751f\u5b95\u673a\u4e86\uff0c\u56e0\u4e3a\u4e0a\u4e00\u65f6\u523b\u5feb\u7167\u521a\u6267\u884c\uff0c\u4e22\u5931\u7684\u6570\u636e\u4e5f\u4e0d\u4f1a\u592a\u591a\u3002\u4f46\u662f\uff0c\u8fd9\u5176\u4e2d\u7684\u5feb\u7167\u95f4\u9694\u65f6\u95f4\u5c31\u5f88\u5173\u952e\u4e86\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff0c\u6211\u4eec\u5148\u5728 T0 \u65f6\u523b\u505a\u4e86\u4e00\u6b21\u5feb\u7167\uff0c\u7136\u540e\u53c8\u5728 T0+t \u65f6\u523b\u505a\u4e86\u4e00\u6b21\u5feb\u7167\uff0c\u5728\u8fd9\u671f\u95f4\uff0c\u6570\u636e\u5757 5 \u548c 9 \u88ab\u4fee\u6539\u4e86\u3002\u5982\u679c\u5728 t \u8fd9\u6bb5\u65f6\u95f4\u5185\uff0c\u673a\u5668\u5b95\u673a\u4e86\uff0c\u90a3\u4e48\uff0c\u53ea\u80fd\u6309\u7167 T0 \u65f6\u523b\u7684\u5feb\u7167\u8fdb\u884c\u6062\u590d\u3002 \u6b64\u65f6\uff0c\u6570\u636e\u5757 5 \u548c 9 \u7684\u4fee\u6539\u503c\u56e0\u4e3a\u6ca1\u6709\u5feb\u7167\u8bb0\u5f55\uff0c\u5c31\u65e0\u6cd5\u6062\u590d\u4e86\u3002 \u8981\u60f3\u5c3d\u53ef\u80fd\u6062\u590d\u6570\u636e\uff0ct \u503c\u5c31\u8981\u5c3d\u53ef\u80fd\u5c0f\uff0ct \u8d8a\u5c0f\uff0c\u5c31\u8d8a\u50cf\u201c\u8fde\u62cd\u201d \u867d\u7136 bgsave \u6267\u884c\u65f6\u4e0d\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u4f46\u662f\uff0c \u5982\u679c\u9891\u7e41\u5730\u6267\u884c\u5168\u91cf\u5feb\u7167\uff0c\u4e5f\u4f1a\u5e26\u6765\u4e24\u65b9\u9762\u7684\u5f00\u9500\u3002 \u4e00\u65b9\u9762\uff0c\u9891\u7e41\u5c06\u5168\u91cf\u6570\u636e\u5199\u5165\u78c1\u76d8\uff0c\u4f1a\u7ed9\u78c1\u76d8\u5e26\u6765\u5f88\u5927\u538b\u529b\uff0c\u591a\u4e2a\u5feb\u7167\u7ade\u4e89\u6709\u9650\u7684\u78c1\u76d8\u5e26\u5bbd\uff0c\u524d\u4e00\u4e2a\u5feb\u7167\u8fd8\u6ca1\u6709\u505a\u5b8c\uff0c\u540e\u4e00\u4e2a\u53c8\u5f00\u59cb\u505a\u4e86\uff0c\u5bb9\u6613\u9020\u6210\u6076\u6027\u5faa\u73af\u3002 \u53e6\u4e00\u65b9\u9762\uff0c bgsave \u5b50\u8fdb\u7a0b\u9700\u8981\u901a\u8fc7 fork \u64cd\u4f5c\u4ece\u4e3b\u7ebf\u7a0b\u521b\u5efa\u51fa\u6765\u3002 \u867d\u7136\uff0c\u5b50\u8fdb\u7a0b\u5728\u521b\u5efa\u540e\u4e0d\u4f1a\u518d\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u4f46\u662f\uff0cfork \u8fd9\u4e2a\u521b\u5efa\u8fc7\u7a0b\u672c\u8eab\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u800c\u4e14\u4e3b\u7ebf\u7a0b\u7684\u5185\u5b58\u8d8a\u5927\uff0c\u963b\u585e\u65f6\u95f4\u8d8a\u957f \u3002 \u5982\u679c\u9891\u7e41 fork \u51fa bgsave \u5b50\u8fdb\u7a0b\uff0c\u8fd9\u5c31\u4f1a\u9891\u7e41\u963b\u585e\u4e3b\u7ebf\u7a0b\u4e86 fork\u64cd\u4f5c\u6267\u884c\u65f6\uff0c\u5185\u6838\u9700\u8981\u7ed9\u5b50\u8fdb\u7a0b\u62f7\u8d1d\u4e3b\u7ebf\u7a0b\u7684\u9875\u8868\u3002\u5982\u679c\u4e3b\u7ebf\u7a0b\u7684\u5185\u5b58\u5927\uff0c\u9875\u8868\u4e5f\u76f8\u5e94\u5927\uff0c\u62f7\u8d1d\u9875\u8868\u8017\u65f6\u957f\uff0c\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002 4-2 \u589e\u91cf\u5feb\u7167 \u6211\u4eec\u53ef\u4ee5\u505a\u589e\u91cf\u5feb\u7167\uff0c\u6240\u8c13\u589e\u91cf\u5feb\u7167\uff0c\u5c31\u662f\u6307\uff0c \u505a\u4e86\u4e00\u6b21\u5168\u91cf\u5feb\u7167\u540e\uff0c\u540e\u7eed\u7684\u5feb\u7167\u53ea\u5bf9\u4fee\u6539\u7684\u6570\u636e\u8fdb\u884c\u5feb\u7167\u8bb0\u5f55\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u6bcf\u6b21\u5168\u91cf\u5feb\u7167\u7684\u5f00\u9500\u3002 \u5728\u7b2c\u4e00\u6b21\u505a\u5b8c\u5168\u91cf\u5feb\u7167\u540e\uff0cT1 \u548c T2 \u65f6\u523b\u5982\u679c\u518d\u505a\u5feb\u7167\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5c06\u88ab\u4fee\u6539\u7684\u6570\u636e\u5199\u5165\u5feb\u7167\u6587\u4ef6\u5c31\u884c\u3002 \u4f46\u662f\uff0c\u8fd9\u4e48\u505a\u7684\u524d\u63d0\u662f\uff0c\u6211\u4eec\u9700\u8981\u8bb0\u4f4f\u54ea\u4e9b\u6570\u636e\u88ab\u4fee\u6539\u4e86 \u201c\u8bb0\u4f4f\u201d\u529f\u80fd\uff0c\u5b83\u9700\u8981\u6211\u4eec\u4f7f\u7528\u989d\u5916\u7684\u5143\u6570\u636e\u4fe1\u606f\u53bb\u8bb0\u5f55\u54ea\u4e9b\u6570\u636e\u88ab\u4fee\u6539\u4e86\uff0c\u8fd9\u4f1a\u5e26\u6765\u989d\u5916\u7684\u7a7a\u95f4\u5f00\u9500\u95ee\u9898 \u589e\u91cf\u5feb\u7167\u5e26\u6765\u7684\u95ee\u9898 \u5982\u679c\u6211\u4eec\u5bf9\u6bcf\u4e00\u4e2a\u952e\u503c\u5bf9\u7684\u4fee\u6539\uff0c\u90fd\u505a\u4e2a\u8bb0\u5f55\uff0c\u90a3\u4e48\uff0c\u5982\u679c\u6709 1 \u4e07\u4e2a\u88ab\u4fee\u6539\u7684\u952e\u503c\u5bf9\uff0c\u6211\u4eec\u5c31\u9700\u8981\u6709 1 \u4e07\u6761\u989d\u5916\u7684\u8bb0\u5f55\u3002 \u800c\u4e14\uff0c\u6709\u7684\u65f6\u5019\uff0c\u952e\u503c\u5bf9\u975e\u5e38\u5c0f\uff0c\u6bd4\u5982\u53ea\u6709 32 \u5b57\u8282\uff0c\u800c\u8bb0\u5f55\u5b83\u88ab\u4fee\u6539\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u53ef\u80fd\u5c31\u9700\u8981 8 \u5b57\u8282\uff0c\u8fd9\u6837\u7684\u753b\uff0c\u4e3a\u4e86\u201c\u8bb0\u4f4f\u201d\u4fee\u6539\uff0c\u5f15\u5165\u7684\u989d\u5916\u7a7a\u95f4\u5f00\u9500\u6bd4\u8f83\u5927\u3002\u8fd9\u5bf9\u4e8e\u5185\u5b58\u8d44\u6e90\u5b9d\u8d35\u7684 Redis \u6765\u8bf4\uff0c\u6709\u4e9b\u5f97\u4e0d\u507f\u5931\u3002 \u867d\u7136\u8ddf AOF \u76f8\u6bd4\uff0c\u5feb\u7167\u7684\u6062\u590d\u901f\u5ea6\u5feb\uff0c\u4f46\u662f\uff0c\u5feb\u7167\u7684\u9891\u7387\u4e0d\u597d\u628a\u63e1\uff0c\u5982\u679c\u9891\u7387\u592a\u4f4e\uff0c\u4e24\u6b21\u5feb\u7167\u95f4\u4e00\u65e6\u5b95\u673a\uff0c\u5c31\u53ef\u80fd\u6709\u6bd4\u8f83\u591a\u7684\u6570\u636e\u4e22\u5931\u3002\u5982\u679c\u9891\u7387\u592a\u9ad8\uff0c\u53c8\u4f1a\u4ea7\u751f\u989d\u5916\u5f00\u9500 5\u3001\u6df7\u5408\u4f7f\u7528 AOF \u65e5\u5fd7\u548c\u5185\u5b58\u5feb\u7167 Redis 4.0 \u4e2d\u63d0\u51fa\u4e86\u4e00\u4e2a\u6df7\u5408\u4f7f\u7528 AOF \u65e5\u5fd7\u548c\u5185\u5b58\u5feb\u7167\u7684\u65b9\u6cd5\u3002 \u7b80\u5355\u6765\u8bf4\uff0c\u5185\u5b58\u5feb\u7167\u4ee5\u4e00\u5b9a\u7684\u9891\u7387\u6267\u884c\uff0c\u5728\u4e24\u6b21\u5feb\u7167\u4e4b\u95f4\uff0c\u4f7f\u7528 AOF \u65e5\u5fd7\u8bb0\u5f55\u8fd9\u671f\u95f4\u7684\u6240\u6709\u547d\u4ee4\u64cd\u4f5c\u3002 \u5feb\u7167\u4e0d\u7528\u5f88\u9891\u7e41\u5730\u6267\u884c\uff0c\u8fd9\u5c31\u907f\u514d\u4e86\u9891\u7e41 fork \u5bf9\u4e3b\u7ebf\u7a0b\u7684\u5f71\u54cd\u3002\u800c\u4e14\uff0cAOF \u65e5\u5fd7\u4e5f\u53ea\u7528\u8bb0\u5f55\u4e24\u6b21\u5feb\u7167\u95f4\u7684\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e0d\u9700\u8981\u8bb0\u5f55\u6240\u6709\u64cd\u4f5c\u4e86\uff0c\u56e0\u6b64\uff0c\u5c31\u4e0d\u4f1a\u51fa\u73b0\u6587\u4ef6\u8fc7\u5927\u7684\u60c5\u51b5\u4e86\uff0c\u4e5f\u53ef\u4ee5\u907f\u514d\u91cd\u5199\u5f00\u9500\u3002 T1 \u548c T2 \u65f6\u523b\u7684\u4fee\u6539\uff0c\u7528 AOF \u65e5\u5fd7\u8bb0\u5f55\uff0c\u7b49\u5230\u7b2c\u4e8c\u6b21\u505a\u5168\u91cf\u5feb\u7167\u65f6\uff0c\u5c31\u53ef\u4ee5\u6e05\u7a7a AOF \u65e5\u5fd7\uff0c\u56e0\u4e3a\u6b64\u65f6\u7684\u4fee\u6539\u90fd\u5df2\u7ecf\u8bb0\u5f55\u5230\u5feb\u7167\u4e2d\u4e86\uff0c\u6062\u590d\u65f6\u5c31\u4e0d\u518d\u7528\u65e5\u5fd7\u4e86\u3002 6\u3001\u672c\u8282\u5c0f\u7ed3 \u4eec\u5b66\u4e60\u4e86 Redis \u7528\u4e8e\u907f\u514d\u6570\u636e\u4e22\u5931\u7684\u5185\u5b58\u5feb\u7167\u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u7684\u4f18\u52bf\u5728\u4e8e\uff0c\u53ef\u4ee5\u5feb\u901f\u6062\u590d\u6570\u636e\u5e93\uff0c\u4e5f\u5c31\u662f\u53ea\u9700\u8981\u628a RDB \u6587\u4ef6\u76f4\u63a5\u8bfb\u5165\u5185\u5b58\uff0c\u8fd9\u5c31\u907f\u514d\u4e86 AOF \u9700\u8981\u987a\u5e8f\u3001\u9010\u4e00\u91cd\u65b0\u6267\u884c\u64cd\u4f5c\u547d\u4ee4\u5e26\u6765\u7684\u4f4e\u6548\u6027\u80fd\u95ee\u9898\u3002 Redis \u8bbe\u8ba1\u4e86 bgsave \u548c\u5199\u65f6\u590d\u5236\u65b9\u5f0f\uff0c\u5c3d\u53ef\u80fd\u51cf\u5c11\u4e86\u5185\u5b58\u5feb\u7167\u5bf9\u6b63\u5e38\u8bfb\u5199\u7684\u5f71\u54cd\uff0c\u4f46\u662f\uff0c\u9891\u7e41\u5feb\u7167\u4ecd\u7136\u662f\u4e0d\u592a\u80fd\u63a5\u53d7\u7684\u3002\u800c\u6df7\u5408\u4f7f\u7528 RDB \u548c AOF\uff0c\u4ee5\u8f83\u5c0f\u7684\u6027\u80fd\u5f00\u9500\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\u548c\u6027\u80fd\u3002 6-1 \u5173\u4e8e AOF \u548c RDB \u7684\u9009\u62e9\u95ee\u9898\uff0c \u4e09\u70b9\u5efa\u8bae\uff1a \u6570\u636e\u4e0d\u80fd\u4e22\u5931\u65f6\uff0c\u5185\u5b58\u5feb\u7167\u548c AOF \u7684\u6df7\u5408\u4f7f\u7528\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\uff1b \u5982\u679c\u5141\u8bb8\u5206\u949f\u7ea7\u522b\u7684\u6570\u636e\u4e22\u5931\uff0c\u53ef\u4ee5\u53ea\u4f7f\u7528 RDB\uff1b \u5982\u679c\u53ea\u7528 AOF\uff0c\u4f18\u5148\u4f7f\u7528 everysec \u7684\u914d\u7f6e\u9009\u9879\uff0c\u56e0\u4e3a\u5b83\u5728\u53ef\u9760\u6027\u548c\u6027\u80fd\u4e4b\u95f4\u53d6\u4e86\u4e00\u4e2a\u5e73\u8861\u3002 6-2 \u6bcf\u8282\u4e00\u95ee \u4f7f\u7528\u4e00\u4e2a 2 \u6838 CPU\u30014GB \u5185\u5b58\u3001500GB \u78c1\u76d8\u7684\u4e91\u4e3b\u673a\u8fd0\u884c Redis\uff0cRedis \u6570\u636e\u5e93\u7684\u6570\u636e\u91cf\u5927\u5c0f\u5dee\u4e0d\u591a\u662f 2GB\uff0c\u6211\u4eec\u4f7f\u7528\u4e86 RDB \u505a\u6301\u4e45\u5316\u4fdd\u8bc1\u3002 \u5f53\u65f6 Redis \u7684\u8fd0\u884c\u8d1f\u8f7d\u4ee5\u4fee\u6539\u64cd\u4f5c\u4e3a\u4e3b\uff0c\u5199\u8bfb\u6bd4\u4f8b\u5dee\u4e0d\u591a\u5728 8:2 \u5de6\u53f3\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6709 100 \u4e2a\u8bf7\u6c42\uff0c80 \u4e2a\u8bf7\u6c42\u6267\u884c\u7684\u662f\u4fee\u6539\u64cd\u4f5c\u3002\u4f60\u89c9\u5f97\uff0c\u5728\u8fd9\u4e2a\u573a\u666f\u4e0b\uff0c\u7528 RDB \u505a\u6301\u4e45\u5316\u6709\u4ec0\u4e48\u98ce\u9669\u5417\uff1f\u4f60\u80fd\u5e2e\u7740\u4e00\u8d77\u5206\u6790\u5206\u6790\u5417\uff1f \u7b54\u6848 \u5185\u5b58\u8d44\u6e90\u98ce\u9669\uff1aRedis fork\u5b50\u8fdb\u7a0b\u505aRDB\u6301\u4e45\u5316\uff0c\u7531\u4e8e\u5199\u7684\u6bd4\u4f8b\u4e3a80%\uff0c\u90a3\u4e48\u5728\u6301\u4e45\u5316\u8fc7\u7a0b\u4e2d\uff0c\u201c\u5199\u5b9e\u590d\u5236\u201d\u4f1a\u91cd\u65b0\u5206\u914d\u6574\u4e2a\u5b9e\u4f8b80%\u7684\u5185\u5b58\u526f\u672c\uff0c\u5927\u7ea6\u9700\u8981\u91cd\u65b0\u5206\u914d1.6GB\u5185\u5b58\u7a7a\u95f4\uff0c\u8fd9\u6837\u6574\u4e2a\u7cfb\u7edf\u7684\u5185\u5b58\u4f7f\u7528\u63a5\u8fd1\u9971\u548c\uff0c\u5982\u679c\u6b64\u65f6\u7236\u8fdb\u7a0b\u53c8\u6709\u5927\u91cf\u65b0key\u5199\u5165\uff0c\u5f88\u5feb\u673a\u5668\u5185\u5b58\u5c31\u4f1a\u88ab\u5403\u5149\uff0c\u5982\u679c\u673a\u5668\u5f00\u542f\u4e86Swap\u673a\u5236\uff0c\u90a3\u4e48Redis\u4f1a\u6709\u4e00\u90e8\u5206\u6570\u636e\u88ab\u6362\u5230\u78c1\u76d8\u4e0a\uff0c\u5f53Redis\u8bbf\u95ee\u8fd9\u90e8\u5206\u5728\u78c1\u76d8\u4e0a\u7684\u6570\u636e\u65f6\uff0c\u6027\u80fd\u4f1a\u6025\u5267\u4e0b\u964d\uff0c\u5df2\u7ecf\u8fbe\u4e0d\u5230\u9ad8\u6027\u80fd\u7684\u6807\u51c6\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a\u6b66\u529f\u88ab\u5e9f\uff09\u3002\u5982\u679c\u673a\u5668\u6ca1\u6709\u5f00\u542fSwap\uff0c\u4f1a\u76f4\u63a5\u89e6\u53d1OOM\uff0c\u7236\u5b50\u8fdb\u7a0b\u4f1a\u9762\u4e34\u88ab\u7cfb\u7edfkill\u6389\u7684\u98ce\u9669\u3002 CPU\u8d44\u6e90\u98ce\u9669\uff1a\u867d\u7136\u5b50\u8fdb\u7a0b\u5728\u505aRDB\u6301\u4e45\u5316\uff0c\u4f46\u751f\u6210RDB\u5feb\u7167\u8fc7\u7a0b\u4f1a\u6d88\u8017\u5927\u91cf\u7684CPU\u8d44\u6e90\uff0c\u867d\u7136Redis\u5904\u7406\u5904\u7406\u8bf7\u6c42\u662f\u5355\u7ebf\u7a0b\u7684\uff0c\u4f46Redis Server\u8fd8\u6709\u5176\u4ed6\u7ebf\u7a0b\u5728\u540e\u53f0\u5de5\u4f5c\uff0c\u4f8b\u5982AOF\u6bcf\u79d2\u5237\u76d8\u3001\u5f02\u6b65\u5173\u95ed\u6587\u4ef6\u63cf\u8ff0\u7b26\u8fd9\u4e9b\u64cd\u4f5c\u3002\u7531\u4e8e\u673a\u5668\u53ea\u67092\u6838CPU\uff0c\u8fd9\u4e5f\u5c31\u610f\u5473\u7740\u7236\u8fdb\u7a0b\u5360\u7528\u4e86\u8d85\u8fc7\u4e00\u534a\u7684CPU\u8d44\u6e90\uff0c\u6b64\u65f6\u5b50\u8fdb\u7a0b\u505aRDB\u6301\u4e45\u5316\uff0c\u53ef\u80fd\u4f1a\u4ea7\u751fCPU\u7ade\u4e89\uff0c\u5bfc\u81f4\u7684\u7ed3\u679c\u5c31\u662f\u7236\u8fdb\u7a0b\u5904\u7406\u8bf7\u6c42\u5ef6\u8fdf\u589e\u5927\uff0c\u5b50\u8fdb\u7a0b\u751f\u6210RDB\u5feb\u7167\u7684\u65f6\u95f4\u4e5f\u4f1a\u53d8\u957f\uff0c\u6574\u4e2aRedis Server\u6027\u80fd\u4e0b\u964d\u3002 6-3 \u5230\u5e95\u662f\u4e3b\u8fdb\u7a0b\u8fd8\u662f\u4e3b\u7ebf\u7a0b Redis\u542f\u52a8\u540e\u672c\u8eab\u662f\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5b83\u7684\u4e3b\u4f53\u5de5\u4f5c\uff08\u63a5\u6536\u8bf7\u6c42\u3001\u670d\u52a1\u8bf7\u6c42\u8bfb\u5199\u6570\u636e\uff09\u4e5f\u662f\u5728\u8fd9\u4e2a\u8fdb\u7a0b\u4e2d\u5b8c\u6210\u7684\uff0c\u79f0Redis\u4e3a\u4e3b\u8fdb\u7a0b\u662f\u53ef\u4ee5\u7684 \u3002 \u540c\u65f6\uff0c Redis\u8fd9\u4e2a\u8fdb\u7a0b\u5c5e\u4e8e\u5355\u7ebf\u7a0b\u7684\u8fdb\u7a0b\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fdb\u7a0b\u4e3b\u4f53\u5de5\u4f5c\u6ca1\u6709\u7528\u591a\u4e2a\u7ebf\u7a0b\u6765\u8fd0\u884c\uff0c\u6240\u4ee5\u6211\u4e00\u822c\u628a\u5b83\u4e5f\u79f0\u4e3a\u4e3b\u7ebf\u7a0b\uff0c\u7a81\u663e\u5b83\u7684\u5355\u7ebf\u7a0b\u6a21\u5f0f \u3002 \u6709\u7684\u7a0b\u5e8f\u542f\u52a8\u540e\uff0c\u4f1a\u5728\u8fdb\u7a0b\u4e2d\u542f\u52a8\u591a\u4e2a\u7ebf\u7a0b\u6765\u5904\u7406\u5de5\u4f5c\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u5c31\u4e0d\u4f1a\u79f0\u5b83\u4e3a\u4e3b\u7ebf\u7a0b\u4e86\uff0c\u56e0\u4e3a\u6ca1\u6709\u4e00\u4e2a\u7ebf\u7a0b\u662f\u5355\u72ec\u505a\u4e3b\u8981\u5de5\u4f5c\u7684\u3002","title":"\u7b2c\u4e94\u8282 Redis\u5b95\u673a\uff0cRedis\u5982\u4f55\u5b9e\u73b0\u5feb\u901f\u6062\u590dRDB"},{"location":"chap2/5redis_rdb_snapshot/#redisredisrdb","text":"","title":"\u7b2c\u4e94\u8282 Redis\u5b95\u673a\uff0cRedis\u5982\u4f55\u5b9e\u73b0\u5feb\u901f\u6062\u590dRDB"},{"location":"chap2/5redis_rdb_snapshot/#1","text":"Redis \u907f\u514d\u6570\u636e\u4e22\u5931\u7684 AOF \u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u7684\u597d\u5904\uff0c\u662f\u6bcf\u6b21\u6267\u884c\u53ea\u9700\u8981\u8bb0\u5f55\u64cd\u4f5c\u547d\u4ee4\uff0c\u9700\u8981\u6301\u4e45\u5316\u7684\u6570\u636e\u91cf\u4e0d\u5927\u3002\u4e00\u822c\u800c\u8a00\uff0c\u53ea\u8981\u4f60\u91c7\u7528\u7684\u4e0d\u662f always \u7684\u6301\u4e45\u5316\u7b56\u7565\uff0c\u5c31\u4e0d\u4f1a\u5bf9\u6027\u80fd\u9020\u6210\u592a\u5927\u5f71\u54cd\u3002 \u4f46\u662f\uff0c\u4e5f\u6b63\u56e0\u4e3a\u8bb0\u5f55\u7684\u662f\u64cd\u4f5c\u547d\u4ee4\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u7684\u6570\u636e\uff0c \u6240\u4ee5\uff0c\u7528 AOF \u65b9\u6cd5\u8fdb\u884c\u6545\u969c\u6062\u590d\u7684\u65f6\u5019\uff0c\u9700\u8981\u9010\u4e00\u628a\u64cd\u4f5c\u65e5\u5fd7\u90fd\u6267\u884c\u4e00\u904d\u3002\u5982\u679c\u64cd\u4f5c\u65e5\u5fd7\u975e\u5e38\u591a\uff0cRedis \u5c31\u4f1a\u6062\u590d\u5f97\u5f88\u7f13\u6162\uff0c\u5f71\u54cd\u5230\u6b63\u5e38\u4f7f\u7528 \u3002 \u8fd8\u6709\u6ca1\u6709\u65e2\u53ef\u4ee5\u4fdd\u8bc1\u53ef\u9760\u6027\uff0c\u8fd8\u80fd\u5728\u5b95\u673a\u65f6\u5b9e\u73b0\u5feb\u901f\u6062\u590d\u7684\u5176\u4ed6\u65b9\u6cd5\u5462\uff1f \u5185\u5b58\u5feb\u7167 \u5bf9 Redis \u6765\u8bf4\uff0c\u5b83\u5b9e\u73b0\u7c7b\u4f3c\u7167\u7247\u8bb0\u5f55\u6548\u679c\u7684\u65b9\u5f0f\uff0c\u5c31\u662f\u628a\u67d0\u4e00\u65f6\u523b\u7684\u72b6\u6001\u4ee5\u6587\u4ef6\u7684\u5f62\u5f0f\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u4e5f\u5c31\u662f\u5feb\u7167\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u5b95\u673a\uff0c\u5feb\u7167\u6587\u4ef6\u4e5f\u4e0d\u4f1a\u4e22\u5931\uff0c\u6570\u636e\u7684\u53ef\u9760\u6027\u4e5f\u5c31\u5f97\u5230\u4e86\u4fdd\u8bc1\u3002\u8fd9\u4e2a\u5feb\u7167\u6587\u4ef6\u5c31\u79f0\u4e3a RDB \u6587\u4ef6\uff0c\u5176\u4e2d\uff0cRDB \u5c31\u662f Redis DataBase \u7684\u7f29\u5199 \u548c AOF \u76f8\u6bd4\uff0cRDB \u8bb0\u5f55\u7684\u662f\u67d0\u4e00\u65f6\u523b\u7684\u6570\u636e\uff0c\u5e76\u4e0d\u662f\u64cd\u4f5c\uff0c\u6240\u4ee5\uff0c\u5728\u505a\u6570\u636e\u6062\u590d\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u628a RDB \u6587\u4ef6\u8bfb\u5165\u5185\u5b58\uff0c\u5f88\u5feb\u5730\u5b8c\u6210\u6062\u590d\u3002 \u6211\u4eec\u8fd8\u8981\u8003\u8651\u4e24\u4e2a\u5173\u952e\u95ee\u9898\uff1a \u5bf9\u54ea\u4e9b\u6570\u636e\u505a\u5feb\u7167\uff1f\u8fd9\u5173\u7cfb\u5230\u5feb\u7167\u7684\u6267\u884c\u6548\u7387\u95ee\u9898\uff1b \u505a\u5feb\u7167\u65f6\uff0c\u6570\u636e\u8fd8\u80fd\u88ab\u589e\u5220\u6539\u5417\uff1f\u8fd9\u5173\u7cfb\u5230 Redis \u662f\u5426\u88ab\u963b\u585e\uff0c\u80fd\u5426\u540c\u65f6\u6b63\u5e38\u5904\u7406\u8bf7\u6c42\u3002","title":"1\u3001\u4ec0\u4e48\u662f\u5185\u5b58\u5feb\u7167"},{"location":"chap2/5redis_rdb_snapshot/#2","text":"Redis \u7684\u6570\u636e\u90fd\u5728\u5185\u5b58\u4e2d\uff0c\u4e3a\u4e86\u63d0\u4f9b\u6240\u6709\u6570\u636e\u7684\u53ef\u9760\u6027\u4fdd\u8bc1\uff0c \u5b83\u6267\u884c\u7684\u662f\u5168\u91cf\u5feb\u7167 \uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u628a\u5185\u5b58\u4e2d\u7684\u6240\u6709\u6570\u636e\u90fd\u8bb0\u5f55\u5230\u78c1\u76d8\u4e2d\uff0c\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u4e00\u6b21\u6027\u8bb0\u5f55\u4e86\u6240\u6709\u6570\u636e\uff0c\u4e00\u4e2a\u90fd\u4e0d\u5c11 \u7ed9\u5185\u5b58\u7684\u5168\u91cf\u6570\u636e\u505a\u5feb\u7167\uff0c\u628a\u5b83\u4eec\u5168\u90e8\u5199\u5165\u78c1\u76d8\u4e5f\u4f1a\u82b1\u8d39\u5f88\u591a\u65f6\u95f4\u3002 \u800c\u4e14\uff0c\u5168\u91cf\u6570\u636e\u8d8a\u591a\uff0cRDB \u6587\u4ef6\u5c31\u8d8a\u5927\uff0c\u5f80\u78c1\u76d8\u4e0a\u5199\u6570\u636e\u7684\u65f6\u95f4\u5f00\u9500\u5c31\u8d8a\u5927\u3002 \u5bf9\u4e8e Redis \u800c\u8a00\uff0c\u5b83\u7684\u5355\u7ebf\u7a0b\u6a21\u578b\u5c31\u51b3\u5b9a\u4e86\uff0c\u6211\u4eec\u8981\u5c3d\u91cf\u907f\u514d\u6240\u6709\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u7684\u64cd\u4f5c","title":"2\u3001\u7ed9\u54ea\u4e9b\u5185\u5b58\u6570\u636e\u505a\u5feb\u7167\uff1f"},{"location":"chap2/5redis_rdb_snapshot/#2-1-rdb","text":"Redis \u63d0\u4f9b\u4e86\u4e24\u4e2a\u547d\u4ee4\u6765\u751f\u6210 RDB \u6587\u4ef6\uff0c\u5206\u522b\u662f save \u548c bgsave \u3002 save\uff1a\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\uff0c\u4f1a\u5bfc\u81f4\u963b\u585e\uff1b bgsave\uff1a \u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u4e13\u95e8\u7528\u4e8e\u5199\u5165 RDB \u6587\u4ef6\uff0c\u907f\u514d\u4e86\u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\uff0c\u8fd9\u4e5f\u662f Redis RDB \u6587\u4ef6\u751f\u6210\u7684\u9ed8\u8ba4\u914d\u7f6e\u3002 \u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7 bgsave \u547d\u4ee4\u6765\u6267\u884c\u5168\u91cf\u5feb\u7167\uff0c\u8fd9\u65e2\u63d0\u4f9b\u4e86\u6570\u636e\u7684\u53ef\u9760\u6027\u4fdd\u8bc1\uff0c\u4e5f\u907f\u514d\u4e86\u5bf9 Redis \u7684\u6027\u80fd\u5f71\u54cd","title":"2-1 RDB \u6587\u4ef6\u7684\u751f\u6210\u662f\u5426\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\uff1f"},{"location":"chap2/5redis_rdb_snapshot/#3","text":"\u5bf9\u4e8e\u5185\u5b58\u5feb\u7167\u800c\u8a00\uff0c\u6211\u4eec\u4e0d\u5e0c\u671b\u6570\u636e\u201c\u52a8\u201d\u3002 \u4e3e\u4e2a\u4f8b\u5b50\u3002\u6211\u4eec\u5728\u65f6\u523b t \u7ed9\u5185\u5b58\u505a\u5feb\u7167\uff0c\u5047\u8bbe\u5185\u5b58\u6570\u636e\u91cf\u662f 4GB\uff0c\u78c1\u76d8\u7684\u5199\u5165\u5e26\u5bbd\u662f 0.2GB/s\uff0c\u7b80\u5355\u6765\u8bf4\uff0c\u81f3\u5c11\u9700\u8981 20s\uff084/0.2 = 20\uff09 \u624d\u80fd\u505a\u5b8c\u3002 \u5982\u679c\u5728\u65f6\u523b t+5s \u65f6\uff0c\u4e00\u4e2a\u8fd8\u6ca1\u6709\u88ab\u5199\u5165\u78c1\u76d8\u7684\u5185\u5b58\u6570\u636e A\uff0c\u88ab\u4fee\u6539\u6210\u4e86 A\u2019 \uff0c\u90a3\u4e48\u5c31\u4f1a\u7834\u574f\u5feb\u7167\u7684\u5b8c\u6574\u6027\uff0c\u56e0\u4e3a A\u2019\u4e0d\u662f\u65f6\u523b t \u65f6\u7684\u72b6\u6001\u3002\u56e0\u6b64\uff0c\u548c\u62cd\u7167\u7c7b\u4f3c\uff0c\u6211\u4eec\u5728\u505a\u5feb\u7167\u65f6\u4e5f\u4e0d\u5e0c\u671b\u6570\u636e\u201c\u52a8\u201d\uff0c\u4e5f\u5c31\u662f\u4e0d\u80fd\u88ab\u4fee\u6539\u3002 \u4f46\u662f\uff0c\u5982\u679c\u5feb\u7167\u6267\u884c\u671f\u95f4\u6570\u636e\u4e0d\u80fd\u88ab\u4fee\u6539\uff0c\u662f\u4f1a\u6709\u6f5c\u5728\u95ee\u9898\u7684\u3002\u5bf9\u4e8e\u521a\u521a\u7684\u4f8b\u5b50\u6765\u8bf4\uff0c\u5728\u505a\u5feb\u7167\u7684 20s \u65f6\u95f4\u91cc\uff0c\u5982\u679c\u8fd9 4GB \u7684\u6570\u636e\u90fd\u4e0d\u80fd\u88ab\u4fee\u6539\uff0cRedis \u5c31\u4e0d\u80fd\u5904\u7406\u5bf9\u8fd9\u4e9b\u6570\u636e\u7684\u5199\u64cd\u4f5c\uff0c\u90a3\u65e0\u7591\u5c31\u4f1a\u7ed9\u4e1a\u52a1\u670d\u52a1\u9020\u6210\u5de8\u5927\u7684\u5f71\u54cd\u3002 \u4f60\u53ef\u80fd\u4f1a\u60f3\u5230\uff0c\u53ef\u4ee5\u7528 bgsave \u907f\u514d\u963b\u585e\u554a : \u907f\u514d\u963b\u585e\u548c\u6b63\u5e38\u5904\u7406\u5199\u64cd\u4f5c\u5e76\u4e0d\u662f\u4e00\u56de\u4e8b \u3002\u6b64\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u7684\u786e\u6ca1\u6709\u963b\u585e\uff0c\u53ef\u4ee5\u6b63\u5e38\u63a5\u6536\u8bf7\u6c42\uff0c\u4f46\u662f\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u5feb\u7167\u5b8c\u6574\u6027\uff0c\u5b83\u53ea\u80fd\u5904\u7406\u8bfb\u64cd\u4f5c\uff0c\u56e0\u4e3a\u4e0d\u80fd\u4fee\u6539\u6b63\u5728\u6267\u884c\u5feb\u7167\u7684\u6570\u636e\u3002 RDB\u91c7\u7528\u5199\u65f6\u590d\u5236\uff08COW\uff0ccopy on write\uff09\u7b56\u7565\u3002 \u4e3b\u7ebf\u7a0b\u5982\u679c\u90fd\u662f\u8bfb\u53d6\u64cd\u4f5c\uff0c\u90a3\u4e48\u5b50\u7ebf\u7a0b\u4e0d\u9700\u8981\u590d\u5236\u6570\u636e\u5757\u3002 \u5982\u679c\u4e3b\u7ebf\u7a0b\u7684\u67d0\u5757\u6570\u636e\u6709\u4fee\u6539\uff0c \u90a3\u4e48\u5b50\u7ebf\u7a0b\u9700\u8981\u590d\u5236\u6570\u636e\u5757\uff0c\u4ece\u800c\u4e0d\u4f1a\u5f71\u54cd\u4e3b\u7ebf\u7a0b\u7684\u4fee\u6539\u64cd\u4f5c\u3002 \u5feb\u7167\u800c\u6682\u505c\u5199\u64cd\u4f5c\uff0c\u80af\u5b9a\u662f\u4e0d\u80fd\u63a5\u53d7\u7684\u3002\u6240\u4ee5\u8fd9\u4e2a\u65f6\u5019\uff0c Redis \u5c31\u4f1a\u501f\u52a9\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u5199\u65f6\u590d\u5236\u6280\u672f\uff08Copy-On-Write, COW\uff09\uff0c\u5728\u6267\u884c\u5feb\u7167\u7684\u540c\u65f6\uff0c\u6b63\u5e38\u5904\u7406\u5199\u64cd\u4f5c \u3002 bgsave \u5b50\u8fdb\u7a0b\u662f\u7531\u4e3b\u7ebf\u7a0b fork \u751f\u6210\u7684\uff0c\u53ef\u4ee5\u5171\u4eab\u4e3b\u7ebf\u7a0b\u7684\u6240\u6709\u5185\u5b58\u6570\u636e\u3002bgsave \u5b50\u8fdb\u7a0b\u8fd0\u884c\u540e\uff0c\u5f00\u59cb\u8bfb\u53d6\u4e3b\u7ebf\u7a0b\u7684\u5185\u5b58\u6570\u636e\uff0c\u5e76\u628a\u5b83\u4eec\u5199\u5165 RDB \u6587\u4ef6\u3002 \u5982\u679c\u4e3b\u7ebf\u7a0b\u5bf9\u8fd9\u4e9b\u6570\u636e\u4e5f\u90fd\u662f\u8bfb\u64cd\u4f5c \uff08\u4f8b\u5982\u56fe\u4e2d\u7684\u952e\u503c\u5bf9 A\uff09\uff0c\u90a3\u4e48\uff0c\u4e3b\u7ebf\u7a0b\u548c bgsave \u5b50\u8fdb\u7a0b\u76f8\u4e92\u4e0d\u5f71\u54cd\u3002 \u5982\u679c\u4e3b\u7ebf\u7a0b\u8981\u4fee\u6539\u4e00\u5757\u6570\u636e\uff08\u4f8b\u5982\u56fe\u4e2d\u7684\u952e\u503c\u5bf9 C\uff09\uff0c\u90a3\u4e48\uff0c\u8fd9\u5757\u6570\u636e\u5c31\u4f1a\u88ab\u590d\u5236\u4e00\u4efd\uff0c\u751f\u6210\u8be5\u6570\u636e\u7684\u526f\u672c\u3002 \u7136\u540e\uff0cbgsave \u5b50\u8fdb\u7a0b\u4f1a\u628a\u8fd9\u4e2a\u526f\u672c\u6570\u636e\u5199\u5165 RDB \u6587\u4ef6\uff0c\u800c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4e3b\u7ebf\u7a0b\u4ecd\u7136\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539\u539f\u6765\u7684\u6570\u636e \u3002 \u8fd9\u65e2\u4fdd\u8bc1\u4e86\u5feb\u7167\u7684\u5b8c\u6574\u6027\uff0c\u4e5f\u5141\u8bb8\u4e3b\u7ebf\u7a0b\u540c\u65f6\u5bf9\u6570\u636e\u8fdb\u884c\u4fee\u6539\uff0c\u907f\u514d\u4e86\u5bf9\u6b63\u5e38\u4e1a\u52a1\u7684\u5f71\u54cd\u3002","title":"3\u3001\u5feb\u7167\u65f6\u6570\u636e\u80fd\u4fee\u6539\u5417?"},{"location":"chap2/5redis_rdb_snapshot/#4","text":"","title":"4\u3001\u591a\u4e45\u505a\u4e00\u6b21\u5feb\u7167"},{"location":"chap2/5redis_rdb_snapshot/#4-1","text":"\u5bf9\u4e8e\u5feb\u7167\u6765\u8bf4\uff0c\u6240\u8c13\u201c\u8fde\u62cd\u201d\u5c31\u662f\u6307\u8fde\u7eed\u5730\u505a\u5feb\u7167\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5feb\u7167\u7684\u95f4\u9694\u65f6\u95f4\u53d8\u5f97\u5f88\u77ed\uff0c\u5373\u4f7f\u67d0\u4e00\u65f6\u523b\u53d1\u751f\u5b95\u673a\u4e86\uff0c\u56e0\u4e3a\u4e0a\u4e00\u65f6\u523b\u5feb\u7167\u521a\u6267\u884c\uff0c\u4e22\u5931\u7684\u6570\u636e\u4e5f\u4e0d\u4f1a\u592a\u591a\u3002\u4f46\u662f\uff0c\u8fd9\u5176\u4e2d\u7684\u5feb\u7167\u95f4\u9694\u65f6\u95f4\u5c31\u5f88\u5173\u952e\u4e86\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff0c\u6211\u4eec\u5148\u5728 T0 \u65f6\u523b\u505a\u4e86\u4e00\u6b21\u5feb\u7167\uff0c\u7136\u540e\u53c8\u5728 T0+t \u65f6\u523b\u505a\u4e86\u4e00\u6b21\u5feb\u7167\uff0c\u5728\u8fd9\u671f\u95f4\uff0c\u6570\u636e\u5757 5 \u548c 9 \u88ab\u4fee\u6539\u4e86\u3002\u5982\u679c\u5728 t \u8fd9\u6bb5\u65f6\u95f4\u5185\uff0c\u673a\u5668\u5b95\u673a\u4e86\uff0c\u90a3\u4e48\uff0c\u53ea\u80fd\u6309\u7167 T0 \u65f6\u523b\u7684\u5feb\u7167\u8fdb\u884c\u6062\u590d\u3002 \u6b64\u65f6\uff0c\u6570\u636e\u5757 5 \u548c 9 \u7684\u4fee\u6539\u503c\u56e0\u4e3a\u6ca1\u6709\u5feb\u7167\u8bb0\u5f55\uff0c\u5c31\u65e0\u6cd5\u6062\u590d\u4e86\u3002 \u8981\u60f3\u5c3d\u53ef\u80fd\u6062\u590d\u6570\u636e\uff0ct \u503c\u5c31\u8981\u5c3d\u53ef\u80fd\u5c0f\uff0ct \u8d8a\u5c0f\uff0c\u5c31\u8d8a\u50cf\u201c\u8fde\u62cd\u201d \u867d\u7136 bgsave \u6267\u884c\u65f6\u4e0d\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u4f46\u662f\uff0c \u5982\u679c\u9891\u7e41\u5730\u6267\u884c\u5168\u91cf\u5feb\u7167\uff0c\u4e5f\u4f1a\u5e26\u6765\u4e24\u65b9\u9762\u7684\u5f00\u9500\u3002 \u4e00\u65b9\u9762\uff0c\u9891\u7e41\u5c06\u5168\u91cf\u6570\u636e\u5199\u5165\u78c1\u76d8\uff0c\u4f1a\u7ed9\u78c1\u76d8\u5e26\u6765\u5f88\u5927\u538b\u529b\uff0c\u591a\u4e2a\u5feb\u7167\u7ade\u4e89\u6709\u9650\u7684\u78c1\u76d8\u5e26\u5bbd\uff0c\u524d\u4e00\u4e2a\u5feb\u7167\u8fd8\u6ca1\u6709\u505a\u5b8c\uff0c\u540e\u4e00\u4e2a\u53c8\u5f00\u59cb\u505a\u4e86\uff0c\u5bb9\u6613\u9020\u6210\u6076\u6027\u5faa\u73af\u3002 \u53e6\u4e00\u65b9\u9762\uff0c bgsave \u5b50\u8fdb\u7a0b\u9700\u8981\u901a\u8fc7 fork \u64cd\u4f5c\u4ece\u4e3b\u7ebf\u7a0b\u521b\u5efa\u51fa\u6765\u3002 \u867d\u7136\uff0c\u5b50\u8fdb\u7a0b\u5728\u521b\u5efa\u540e\u4e0d\u4f1a\u518d\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u4f46\u662f\uff0cfork \u8fd9\u4e2a\u521b\u5efa\u8fc7\u7a0b\u672c\u8eab\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u800c\u4e14\u4e3b\u7ebf\u7a0b\u7684\u5185\u5b58\u8d8a\u5927\uff0c\u963b\u585e\u65f6\u95f4\u8d8a\u957f \u3002 \u5982\u679c\u9891\u7e41 fork \u51fa bgsave \u5b50\u8fdb\u7a0b\uff0c\u8fd9\u5c31\u4f1a\u9891\u7e41\u963b\u585e\u4e3b\u7ebf\u7a0b\u4e86 fork\u64cd\u4f5c\u6267\u884c\u65f6\uff0c\u5185\u6838\u9700\u8981\u7ed9\u5b50\u8fdb\u7a0b\u62f7\u8d1d\u4e3b\u7ebf\u7a0b\u7684\u9875\u8868\u3002\u5982\u679c\u4e3b\u7ebf\u7a0b\u7684\u5185\u5b58\u5927\uff0c\u9875\u8868\u4e5f\u76f8\u5e94\u5927\uff0c\u62f7\u8d1d\u9875\u8868\u8017\u65f6\u957f\uff0c\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002","title":"4-1 \u8fde\u62cd\u5168\u91cf\u5feb\u7167\u5e26\u6765\u7684\u95ee\u9898"},{"location":"chap2/5redis_rdb_snapshot/#4-2","text":"\u6211\u4eec\u53ef\u4ee5\u505a\u589e\u91cf\u5feb\u7167\uff0c\u6240\u8c13\u589e\u91cf\u5feb\u7167\uff0c\u5c31\u662f\u6307\uff0c \u505a\u4e86\u4e00\u6b21\u5168\u91cf\u5feb\u7167\u540e\uff0c\u540e\u7eed\u7684\u5feb\u7167\u53ea\u5bf9\u4fee\u6539\u7684\u6570\u636e\u8fdb\u884c\u5feb\u7167\u8bb0\u5f55\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u6bcf\u6b21\u5168\u91cf\u5feb\u7167\u7684\u5f00\u9500\u3002 \u5728\u7b2c\u4e00\u6b21\u505a\u5b8c\u5168\u91cf\u5feb\u7167\u540e\uff0cT1 \u548c T2 \u65f6\u523b\u5982\u679c\u518d\u505a\u5feb\u7167\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5c06\u88ab\u4fee\u6539\u7684\u6570\u636e\u5199\u5165\u5feb\u7167\u6587\u4ef6\u5c31\u884c\u3002 \u4f46\u662f\uff0c\u8fd9\u4e48\u505a\u7684\u524d\u63d0\u662f\uff0c\u6211\u4eec\u9700\u8981\u8bb0\u4f4f\u54ea\u4e9b\u6570\u636e\u88ab\u4fee\u6539\u4e86 \u201c\u8bb0\u4f4f\u201d\u529f\u80fd\uff0c\u5b83\u9700\u8981\u6211\u4eec\u4f7f\u7528\u989d\u5916\u7684\u5143\u6570\u636e\u4fe1\u606f\u53bb\u8bb0\u5f55\u54ea\u4e9b\u6570\u636e\u88ab\u4fee\u6539\u4e86\uff0c\u8fd9\u4f1a\u5e26\u6765\u989d\u5916\u7684\u7a7a\u95f4\u5f00\u9500\u95ee\u9898 \u589e\u91cf\u5feb\u7167\u5e26\u6765\u7684\u95ee\u9898 \u5982\u679c\u6211\u4eec\u5bf9\u6bcf\u4e00\u4e2a\u952e\u503c\u5bf9\u7684\u4fee\u6539\uff0c\u90fd\u505a\u4e2a\u8bb0\u5f55\uff0c\u90a3\u4e48\uff0c\u5982\u679c\u6709 1 \u4e07\u4e2a\u88ab\u4fee\u6539\u7684\u952e\u503c\u5bf9\uff0c\u6211\u4eec\u5c31\u9700\u8981\u6709 1 \u4e07\u6761\u989d\u5916\u7684\u8bb0\u5f55\u3002 \u800c\u4e14\uff0c\u6709\u7684\u65f6\u5019\uff0c\u952e\u503c\u5bf9\u975e\u5e38\u5c0f\uff0c\u6bd4\u5982\u53ea\u6709 32 \u5b57\u8282\uff0c\u800c\u8bb0\u5f55\u5b83\u88ab\u4fee\u6539\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u53ef\u80fd\u5c31\u9700\u8981 8 \u5b57\u8282\uff0c\u8fd9\u6837\u7684\u753b\uff0c\u4e3a\u4e86\u201c\u8bb0\u4f4f\u201d\u4fee\u6539\uff0c\u5f15\u5165\u7684\u989d\u5916\u7a7a\u95f4\u5f00\u9500\u6bd4\u8f83\u5927\u3002\u8fd9\u5bf9\u4e8e\u5185\u5b58\u8d44\u6e90\u5b9d\u8d35\u7684 Redis \u6765\u8bf4\uff0c\u6709\u4e9b\u5f97\u4e0d\u507f\u5931\u3002 \u867d\u7136\u8ddf AOF \u76f8\u6bd4\uff0c\u5feb\u7167\u7684\u6062\u590d\u901f\u5ea6\u5feb\uff0c\u4f46\u662f\uff0c\u5feb\u7167\u7684\u9891\u7387\u4e0d\u597d\u628a\u63e1\uff0c\u5982\u679c\u9891\u7387\u592a\u4f4e\uff0c\u4e24\u6b21\u5feb\u7167\u95f4\u4e00\u65e6\u5b95\u673a\uff0c\u5c31\u53ef\u80fd\u6709\u6bd4\u8f83\u591a\u7684\u6570\u636e\u4e22\u5931\u3002\u5982\u679c\u9891\u7387\u592a\u9ad8\uff0c\u53c8\u4f1a\u4ea7\u751f\u989d\u5916\u5f00\u9500","title":"4-2 \u589e\u91cf\u5feb\u7167"},{"location":"chap2/5redis_rdb_snapshot/#5-aof","text":"Redis 4.0 \u4e2d\u63d0\u51fa\u4e86\u4e00\u4e2a\u6df7\u5408\u4f7f\u7528 AOF \u65e5\u5fd7\u548c\u5185\u5b58\u5feb\u7167\u7684\u65b9\u6cd5\u3002 \u7b80\u5355\u6765\u8bf4\uff0c\u5185\u5b58\u5feb\u7167\u4ee5\u4e00\u5b9a\u7684\u9891\u7387\u6267\u884c\uff0c\u5728\u4e24\u6b21\u5feb\u7167\u4e4b\u95f4\uff0c\u4f7f\u7528 AOF \u65e5\u5fd7\u8bb0\u5f55\u8fd9\u671f\u95f4\u7684\u6240\u6709\u547d\u4ee4\u64cd\u4f5c\u3002 \u5feb\u7167\u4e0d\u7528\u5f88\u9891\u7e41\u5730\u6267\u884c\uff0c\u8fd9\u5c31\u907f\u514d\u4e86\u9891\u7e41 fork \u5bf9\u4e3b\u7ebf\u7a0b\u7684\u5f71\u54cd\u3002\u800c\u4e14\uff0cAOF \u65e5\u5fd7\u4e5f\u53ea\u7528\u8bb0\u5f55\u4e24\u6b21\u5feb\u7167\u95f4\u7684\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e0d\u9700\u8981\u8bb0\u5f55\u6240\u6709\u64cd\u4f5c\u4e86\uff0c\u56e0\u6b64\uff0c\u5c31\u4e0d\u4f1a\u51fa\u73b0\u6587\u4ef6\u8fc7\u5927\u7684\u60c5\u51b5\u4e86\uff0c\u4e5f\u53ef\u4ee5\u907f\u514d\u91cd\u5199\u5f00\u9500\u3002 T1 \u548c T2 \u65f6\u523b\u7684\u4fee\u6539\uff0c\u7528 AOF \u65e5\u5fd7\u8bb0\u5f55\uff0c\u7b49\u5230\u7b2c\u4e8c\u6b21\u505a\u5168\u91cf\u5feb\u7167\u65f6\uff0c\u5c31\u53ef\u4ee5\u6e05\u7a7a AOF \u65e5\u5fd7\uff0c\u56e0\u4e3a\u6b64\u65f6\u7684\u4fee\u6539\u90fd\u5df2\u7ecf\u8bb0\u5f55\u5230\u5feb\u7167\u4e2d\u4e86\uff0c\u6062\u590d\u65f6\u5c31\u4e0d\u518d\u7528\u65e5\u5fd7\u4e86\u3002","title":"5\u3001\u6df7\u5408\u4f7f\u7528 AOF \u65e5\u5fd7\u548c\u5185\u5b58\u5feb\u7167"},{"location":"chap2/5redis_rdb_snapshot/#6","text":"\u4eec\u5b66\u4e60\u4e86 Redis \u7528\u4e8e\u907f\u514d\u6570\u636e\u4e22\u5931\u7684\u5185\u5b58\u5feb\u7167\u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u7684\u4f18\u52bf\u5728\u4e8e\uff0c\u53ef\u4ee5\u5feb\u901f\u6062\u590d\u6570\u636e\u5e93\uff0c\u4e5f\u5c31\u662f\u53ea\u9700\u8981\u628a RDB \u6587\u4ef6\u76f4\u63a5\u8bfb\u5165\u5185\u5b58\uff0c\u8fd9\u5c31\u907f\u514d\u4e86 AOF \u9700\u8981\u987a\u5e8f\u3001\u9010\u4e00\u91cd\u65b0\u6267\u884c\u64cd\u4f5c\u547d\u4ee4\u5e26\u6765\u7684\u4f4e\u6548\u6027\u80fd\u95ee\u9898\u3002 Redis \u8bbe\u8ba1\u4e86 bgsave \u548c\u5199\u65f6\u590d\u5236\u65b9\u5f0f\uff0c\u5c3d\u53ef\u80fd\u51cf\u5c11\u4e86\u5185\u5b58\u5feb\u7167\u5bf9\u6b63\u5e38\u8bfb\u5199\u7684\u5f71\u54cd\uff0c\u4f46\u662f\uff0c\u9891\u7e41\u5feb\u7167\u4ecd\u7136\u662f\u4e0d\u592a\u80fd\u63a5\u53d7\u7684\u3002\u800c\u6df7\u5408\u4f7f\u7528 RDB \u548c AOF\uff0c\u4ee5\u8f83\u5c0f\u7684\u6027\u80fd\u5f00\u9500\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\u548c\u6027\u80fd\u3002","title":"6\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap2/5redis_rdb_snapshot/#6-1-aof-rdb","text":"\u4e09\u70b9\u5efa\u8bae\uff1a \u6570\u636e\u4e0d\u80fd\u4e22\u5931\u65f6\uff0c\u5185\u5b58\u5feb\u7167\u548c AOF \u7684\u6df7\u5408\u4f7f\u7528\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\uff1b \u5982\u679c\u5141\u8bb8\u5206\u949f\u7ea7\u522b\u7684\u6570\u636e\u4e22\u5931\uff0c\u53ef\u4ee5\u53ea\u4f7f\u7528 RDB\uff1b \u5982\u679c\u53ea\u7528 AOF\uff0c\u4f18\u5148\u4f7f\u7528 everysec \u7684\u914d\u7f6e\u9009\u9879\uff0c\u56e0\u4e3a\u5b83\u5728\u53ef\u9760\u6027\u548c\u6027\u80fd\u4e4b\u95f4\u53d6\u4e86\u4e00\u4e2a\u5e73\u8861\u3002","title":"6-1 \u5173\u4e8e AOF \u548c RDB \u7684\u9009\u62e9\u95ee\u9898\uff0c"},{"location":"chap2/5redis_rdb_snapshot/#6-2","text":"\u4f7f\u7528\u4e00\u4e2a 2 \u6838 CPU\u30014GB \u5185\u5b58\u3001500GB \u78c1\u76d8\u7684\u4e91\u4e3b\u673a\u8fd0\u884c Redis\uff0cRedis \u6570\u636e\u5e93\u7684\u6570\u636e\u91cf\u5927\u5c0f\u5dee\u4e0d\u591a\u662f 2GB\uff0c\u6211\u4eec\u4f7f\u7528\u4e86 RDB \u505a\u6301\u4e45\u5316\u4fdd\u8bc1\u3002 \u5f53\u65f6 Redis \u7684\u8fd0\u884c\u8d1f\u8f7d\u4ee5\u4fee\u6539\u64cd\u4f5c\u4e3a\u4e3b\uff0c\u5199\u8bfb\u6bd4\u4f8b\u5dee\u4e0d\u591a\u5728 8:2 \u5de6\u53f3\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6709 100 \u4e2a\u8bf7\u6c42\uff0c80 \u4e2a\u8bf7\u6c42\u6267\u884c\u7684\u662f\u4fee\u6539\u64cd\u4f5c\u3002\u4f60\u89c9\u5f97\uff0c\u5728\u8fd9\u4e2a\u573a\u666f\u4e0b\uff0c\u7528 RDB \u505a\u6301\u4e45\u5316\u6709\u4ec0\u4e48\u98ce\u9669\u5417\uff1f\u4f60\u80fd\u5e2e\u7740\u4e00\u8d77\u5206\u6790\u5206\u6790\u5417\uff1f \u7b54\u6848 \u5185\u5b58\u8d44\u6e90\u98ce\u9669\uff1aRedis fork\u5b50\u8fdb\u7a0b\u505aRDB\u6301\u4e45\u5316\uff0c\u7531\u4e8e\u5199\u7684\u6bd4\u4f8b\u4e3a80%\uff0c\u90a3\u4e48\u5728\u6301\u4e45\u5316\u8fc7\u7a0b\u4e2d\uff0c\u201c\u5199\u5b9e\u590d\u5236\u201d\u4f1a\u91cd\u65b0\u5206\u914d\u6574\u4e2a\u5b9e\u4f8b80%\u7684\u5185\u5b58\u526f\u672c\uff0c\u5927\u7ea6\u9700\u8981\u91cd\u65b0\u5206\u914d1.6GB\u5185\u5b58\u7a7a\u95f4\uff0c\u8fd9\u6837\u6574\u4e2a\u7cfb\u7edf\u7684\u5185\u5b58\u4f7f\u7528\u63a5\u8fd1\u9971\u548c\uff0c\u5982\u679c\u6b64\u65f6\u7236\u8fdb\u7a0b\u53c8\u6709\u5927\u91cf\u65b0key\u5199\u5165\uff0c\u5f88\u5feb\u673a\u5668\u5185\u5b58\u5c31\u4f1a\u88ab\u5403\u5149\uff0c\u5982\u679c\u673a\u5668\u5f00\u542f\u4e86Swap\u673a\u5236\uff0c\u90a3\u4e48Redis\u4f1a\u6709\u4e00\u90e8\u5206\u6570\u636e\u88ab\u6362\u5230\u78c1\u76d8\u4e0a\uff0c\u5f53Redis\u8bbf\u95ee\u8fd9\u90e8\u5206\u5728\u78c1\u76d8\u4e0a\u7684\u6570\u636e\u65f6\uff0c\u6027\u80fd\u4f1a\u6025\u5267\u4e0b\u964d\uff0c\u5df2\u7ecf\u8fbe\u4e0d\u5230\u9ad8\u6027\u80fd\u7684\u6807\u51c6\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a\u6b66\u529f\u88ab\u5e9f\uff09\u3002\u5982\u679c\u673a\u5668\u6ca1\u6709\u5f00\u542fSwap\uff0c\u4f1a\u76f4\u63a5\u89e6\u53d1OOM\uff0c\u7236\u5b50\u8fdb\u7a0b\u4f1a\u9762\u4e34\u88ab\u7cfb\u7edfkill\u6389\u7684\u98ce\u9669\u3002 CPU\u8d44\u6e90\u98ce\u9669\uff1a\u867d\u7136\u5b50\u8fdb\u7a0b\u5728\u505aRDB\u6301\u4e45\u5316\uff0c\u4f46\u751f\u6210RDB\u5feb\u7167\u8fc7\u7a0b\u4f1a\u6d88\u8017\u5927\u91cf\u7684CPU\u8d44\u6e90\uff0c\u867d\u7136Redis\u5904\u7406\u5904\u7406\u8bf7\u6c42\u662f\u5355\u7ebf\u7a0b\u7684\uff0c\u4f46Redis Server\u8fd8\u6709\u5176\u4ed6\u7ebf\u7a0b\u5728\u540e\u53f0\u5de5\u4f5c\uff0c\u4f8b\u5982AOF\u6bcf\u79d2\u5237\u76d8\u3001\u5f02\u6b65\u5173\u95ed\u6587\u4ef6\u63cf\u8ff0\u7b26\u8fd9\u4e9b\u64cd\u4f5c\u3002\u7531\u4e8e\u673a\u5668\u53ea\u67092\u6838CPU\uff0c\u8fd9\u4e5f\u5c31\u610f\u5473\u7740\u7236\u8fdb\u7a0b\u5360\u7528\u4e86\u8d85\u8fc7\u4e00\u534a\u7684CPU\u8d44\u6e90\uff0c\u6b64\u65f6\u5b50\u8fdb\u7a0b\u505aRDB\u6301\u4e45\u5316\uff0c\u53ef\u80fd\u4f1a\u4ea7\u751fCPU\u7ade\u4e89\uff0c\u5bfc\u81f4\u7684\u7ed3\u679c\u5c31\u662f\u7236\u8fdb\u7a0b\u5904\u7406\u8bf7\u6c42\u5ef6\u8fdf\u589e\u5927\uff0c\u5b50\u8fdb\u7a0b\u751f\u6210RDB\u5feb\u7167\u7684\u65f6\u95f4\u4e5f\u4f1a\u53d8\u957f\uff0c\u6574\u4e2aRedis Server\u6027\u80fd\u4e0b\u964d\u3002","title":"6-2 \u6bcf\u8282\u4e00\u95ee"},{"location":"chap2/5redis_rdb_snapshot/#6-3","text":"Redis\u542f\u52a8\u540e\u672c\u8eab\u662f\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5b83\u7684\u4e3b\u4f53\u5de5\u4f5c\uff08\u63a5\u6536\u8bf7\u6c42\u3001\u670d\u52a1\u8bf7\u6c42\u8bfb\u5199\u6570\u636e\uff09\u4e5f\u662f\u5728\u8fd9\u4e2a\u8fdb\u7a0b\u4e2d\u5b8c\u6210\u7684\uff0c\u79f0Redis\u4e3a\u4e3b\u8fdb\u7a0b\u662f\u53ef\u4ee5\u7684 \u3002 \u540c\u65f6\uff0c Redis\u8fd9\u4e2a\u8fdb\u7a0b\u5c5e\u4e8e\u5355\u7ebf\u7a0b\u7684\u8fdb\u7a0b\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fdb\u7a0b\u4e3b\u4f53\u5de5\u4f5c\u6ca1\u6709\u7528\u591a\u4e2a\u7ebf\u7a0b\u6765\u8fd0\u884c\uff0c\u6240\u4ee5\u6211\u4e00\u822c\u628a\u5b83\u4e5f\u79f0\u4e3a\u4e3b\u7ebf\u7a0b\uff0c\u7a81\u663e\u5b83\u7684\u5355\u7ebf\u7a0b\u6a21\u5f0f \u3002 \u6709\u7684\u7a0b\u5e8f\u542f\u52a8\u540e\uff0c\u4f1a\u5728\u8fdb\u7a0b\u4e2d\u542f\u52a8\u591a\u4e2a\u7ebf\u7a0b\u6765\u5904\u7406\u5de5\u4f5c\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u5c31\u4e0d\u4f1a\u79f0\u5b83\u4e3a\u4e3b\u7ebf\u7a0b\u4e86\uff0c\u56e0\u4e3a\u6ca1\u6709\u4e00\u4e2a\u7ebf\u7a0b\u662f\u5355\u72ec\u505a\u4e3b\u8981\u5de5\u4f5c\u7684\u3002","title":"6-3 \u5230\u5e95\u662f\u4e3b\u8fdb\u7a0b\u8fd8\u662f\u4e3b\u7ebf\u7a0b"},{"location":"chap2/6redis_master_slave_replicate/","text":"\u7b2c\u516d\u8282 \u6570\u636e\u540c\u6b65\uff1a\u4e3b\u4ece\u5e93\u6570\u636e\u4e00\u81f4 \u5982\u679c Redis \u53d1\u751f\u4e86\u5b95\u673a\uff0c\u5b83\u4eec\u53ef\u4ee5\u5206\u522b\u901a\u8fc7\u56de\u653e\u65e5\u5fd7AOF \u548c\u91cd\u65b0\u8bfb\u5165 RDB \u6587\u4ef6\u7684\u65b9\u5f0f\u6062\u590d\u6570\u636e\uff0c\u4ece\u800c\u4fdd\u8bc1\u5c3d\u91cf\u5c11\u4e22\u5931\u6570\u636e\uff0c\u63d0\u5347\u53ef\u9760\u6027 \u6211\u4eec\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\u53ea\u8fd0\u884c\u4e86\u4e00\u4e2a Redis \u5b9e\u4f8b\uff0c\u90a3\u4e48\uff0c\u5982\u679c\u8fd9\u4e2a\u5b9e\u4f8b\u5b95\u673a\u4e86\uff0c\u5b83\u5728\u6062\u590d\u671f\u95f4\uff0c\u662f\u65e0\u6cd5\u670d\u52a1\u65b0\u6765\u7684\u6570\u636e\u5b58\u53d6\u8bf7\u6c42\u7684\u3002 Redis \u5177\u6709\u9ad8\u53ef\u9760\u6027 \u4e00\u662f\u6570\u636e\u5c3d\u91cf\u5c11\u4e22\u5931 \u4e8c\u662f\u670d\u52a1\u5c3d\u91cf\u5c11\u4e2d\u65ad AOF \u548c RDB \u4fdd\u8bc1\u4e86\u524d\u8005\uff0c\u800c\u5bf9\u4e8e\u540e\u8005\uff0c Redis \u7684\u505a\u6cd5\u5c31\u662f\u589e\u52a0\u526f\u672c\u5197\u4f59\u91cf\uff0c\u5c06\u4e00\u4efd\u6570\u636e\u540c\u65f6\u4fdd\u5b58\u5728\u591a\u4e2a\u5b9e\u4f8b\u4e0a \u5373\u4f7f\u6709\u4e00\u4e2a\u5b9e\u4f8b\u51fa\u73b0\u4e86\u6545\u969c\uff0c\u9700\u8981\u8fc7\u4e00\u6bb5\u65f6\u95f4\u624d\u80fd\u6062\u590d\uff0c\u5176\u4ed6\u5b9e\u4f8b\u4e5f\u53ef\u4ee5\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u4e0d\u4f1a\u5f71\u54cd\u4e1a\u52a1\u4f7f\u7528\u3002 1\u3001Redis\u4e3b\u4ece\u5e93\u6a21\u5f0f Redis \u63d0\u4f9b\u4e86\u4e3b\u4ece\u5e93\u6a21\u5f0f\uff0c\u4ee5\u4fdd\u8bc1\u6570\u636e\u526f\u672c\u7684\u4e00\u81f4\uff0c \u4e3b\u4ece\u5e93\u4e4b\u95f4\u91c7\u7528\u7684\u662f\u8bfb\u5199\u5206\u79bb\u7684\u65b9\u5f0f \u3002 \u8bfb\u64cd\u4f5c\uff1a\u4e3b\u5e93\u3001\u4ece\u5e93\u90fd\u53ef\u4ee5\u63a5\u6536\uff1b \u5199\u64cd\u4f5c\uff1a\u9996\u5148\u5230\u4e3b\u5e93\u6267\u884c\uff0c\u7136\u540e\uff0c\u4e3b\u5e93\u5c06\u5199\u64cd\u4f5c\u540c\u6b65\u7ed9\u4ece\u5e93 \u3002 1-1 \u4e3a\u4ec0\u4e48\u91c7\u7528\u8bfb\u5199\u5206\u79bb \u4e0d\u7ba1\u662f\u4e3b\u5e93\u8fd8\u662f\u4ece\u5e93\uff0c\u90fd\u80fd\u63a5\u6536\u5ba2\u6237\u7aef\u7684\u5199\u64cd\u4f5c\uff0c\u90a3\u4e48\uff0c\u4e00\u4e2a\u76f4\u63a5\u7684\u95ee\u9898\u5c31\u662f\uff1a \u5982\u679c\u5ba2\u6237\u7aef\u5bf9\u540c\u4e00\u4e2a\u6570\u636e\uff08\u4f8b\u5982 k1\uff09\u524d\u540e\u4fee\u6539\u4e86\u4e09\u6b21\uff0c\u6bcf\u4e00\u6b21\u7684\u4fee\u6539\u8bf7\u6c42\u90fd\u53d1\u9001\u5230\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\uff0c\u5728\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\u6267\u884c\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e2a\u6570\u636e\u5728\u8fd9\u4e09\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u526f\u672c\u5c31\u4e0d\u4e00\u81f4\u4e86\uff08\u5206\u522b\u662f v1\u3001v2 \u548c v3\uff09\u3002\u5728\u8bfb\u53d6\u8fd9\u4e2a\u6570\u636e\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u80fd\u8bfb\u53d6\u5230\u65e7\u7684\u503c\u3002 \u5982\u679c\u6211\u4eec\u975e\u8981\u4fdd\u6301\u8fd9\u4e2a\u6570\u636e\u5728\u4e09\u4e2a\u5b9e\u4f8b\u4e0a\u4e00\u81f4\uff0c\u5c31\u8981\u6d89\u53ca\u5230\u52a0\u9501\u3001\u5b9e\u4f8b\u95f4\u534f\u5546\u662f\u5426\u5b8c\u6210\u4fee\u6539\u7b49\u4e00\u7cfb\u5217\u64cd\u4f5c\uff0c\u4f46\u8fd9\u4f1a\u5e26\u6765\u5de8\u989d\u7684\u5f00\u9500\uff0c\u5f53\u7136\u662f\u4e0d\u592a\u80fd\u63a5\u53d7\u7684\u3002 \u800c\u4e3b\u4ece\u5e93\u6a21\u5f0f\u4e00\u65e6\u91c7\u7528\u4e86\u8bfb\u5199\u5206\u79bb\uff0c\u6240\u6709\u6570\u636e\u7684\u4fee\u6539\u53ea\u4f1a\u5728\u4e3b\u5e93\u4e0a\u8fdb\u884c\uff0c\u4e0d\u7528\u534f\u8c03\u4e09\u4e2a\u5b9e\u4f8b\u3002\u4e3b\u5e93\u6709\u4e86\u6700\u65b0\u7684\u6570\u636e\u540e\uff0c\u4f1a\u540c\u6b65\u7ed9\u4ece\u5e93\uff0c\u8fd9\u6837\uff0c\u4e3b\u4ece\u5e93\u7684\u6570\u636e\u5c31\u662f\u4e00\u81f4\u7684\u3002 2\u3001\u4e3b\u4ece\u5e93\u95f4\u5982\u4f55\u8fdb\u884c\u7b2c\u4e00\u6b21\u540c\u6b65\uff1f \u5f53\u6211\u4eec\u542f\u52a8\u591a\u4e2a Redis \u5b9e\u4f8b\u7684\u65f6\u5019\uff0c \u5b83\u4eec\u76f8\u4e92\u4e4b\u95f4\u5c31\u53ef\u4ee5\u901a\u8fc7 replicaof \uff08Redis 5.0 \u4e4b\u524d\u4f7f\u7528 slaveof\uff09\u547d\u4ee4\u5f62\u6210\u4e3b\u5e93\u548c\u4ece\u5e93\u7684\u5173\u7cfb \uff0c\u4e4b\u540e\u4f1a\u6309\u7167\u4e09\u4e2a\u9636\u6bb5\u5b8c\u6210\u6570\u636e\u7684\u7b2c\u4e00\u6b21\u540c\u6b65\u3002 \u4f8b\u5982\uff0c\u73b0\u5728\u6709\u5b9e\u4f8b 1\uff08ip\uff1a172.16.19.3\uff09\u548c\u5b9e\u4f8b 2\uff08ip\uff1a172.16.19.5\uff09\uff0c\u6211\u4eec\u5728\u5b9e\u4f8b 2 \u4e0a\u6267\u884c\u4ee5\u4e0b\u8fd9\u4e2a\u547d\u4ee4\u540e\uff0c\u5b9e\u4f8b 2 \u5c31\u53d8\u6210\u4e86\u5b9e\u4f8b 1 \u7684\u4ece\u5e93\uff0c\u5e76\u4ece\u5b9e\u4f8b 1 \u4e0a\u590d\u5236\u6570\u636e\uff1a replicaof 172.16.19.3 6379 2-1 \u4e3b\u4ece\u5e93\u95f4\u6570\u636e\u7b2c\u4e00\u6b21\u540c\u6b65\u7684\u4e09\u4e2a\u9636\u6bb5 \u7b2c\u4e00\u9636\u6bb5\u662f\u4e3b\u4ece\u5e93\u95f4\u5efa\u7acb\u8fde\u63a5\u3001\u534f\u5546\u540c\u6b65\u7684\u8fc7\u7a0b\uff0c\u4e3b\u8981\u662f\u4e3a\u5168\u91cf\u590d\u5236\u505a\u51c6\u5907 \u3002 \u5728\u8fd9\u4e00\u6b65\uff0c\u4ece\u5e93\u548c\u4e3b\u5e93\u5efa\u7acb\u8d77\u8fde\u63a5\uff0c\u5e76\u544a\u8bc9\u4e3b\u5e93\u5373\u5c06\u8fdb\u884c\u540c\u6b65\uff0c\u4e3b\u5e93\u786e\u8ba4\u56de\u590d\u540e\uff0c\u4e3b\u4ece\u5e93\u95f4\u5c31\u53ef\u4ee5\u5f00\u59cb\u540c\u6b65\u4e86\u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u4ece\u5e93\u7ed9\u4e3b\u5e93\u53d1\u9001 psync \u547d\u4ee4\uff0c\u8868\u793a\u8981\u8fdb\u884c\u6570\u636e\u540c\u6b65\uff0c\u4e3b\u5e93\u6839\u636e\u8fd9\u4e2a\u547d\u4ee4\u7684\u53c2\u6570\u6765\u542f\u52a8\u590d\u5236\u3002 1. psync \u547d\u4ee4\u5305\u542b\u4e86\u4e3b\u5e93\u7684 runID \u548c\u590d\u5236\u8fdb\u5ea6 offset \u4e24\u4e2a\u53c2\u6570\u3002 runID \uff0c\u662f\u6bcf\u4e2a Redis \u5b9e\u4f8b\u542f\u52a8\u65f6\u90fd\u4f1a\u81ea\u52a8\u751f\u6210\u7684\u4e00\u4e2a\u968f\u673a ID\uff0c\u7528\u6765\u552f\u4e00\u6807\u8bb0\u8fd9\u4e2a\u5b9e\u4f8b\u3002\u5f53\u4ece\u5e93\u548c\u4e3b\u5e93\u7b2c\u4e00\u6b21\u590d\u5236\u65f6\uff0c\u56e0\u4e3a\u4e0d\u77e5\u9053\u4e3b\u5e93\u7684 runID\uff0c\u6240\u4ee5\u5c06 runID \u8bbe\u4e3a \u201c\uff1f\u201d \u3002 offset \uff0c\u6b64\u65f6\u8bbe\u4e3a -1 \uff0c\u8868\u793a\u7b2c\u4e00\u6b21\u590d\u5236\u3002 psync ? -1 2.\u4e3b\u5e93\u6536\u5230 psync \u547d\u4ee4\u540e\uff0c\u4f1a\u7528 FULLRESYNC \u54cd\u5e94\u547d\u4ee4\u5e26\u4e0a\u4e24\u4e2a\u53c2\u6570\uff1a \u4e3b\u5e93 runID \u548c\u4e3b\u5e93\u76ee\u524d\u7684\u590d\u5236\u8fdb\u5ea6 offset\uff0c\u8fd4\u56de\u7ed9\u4ece\u5e93\u3002\u4ece\u5e93\u6536\u5230\u54cd\u5e94\u540e\uff0c\u4f1a\u8bb0\u5f55\u4e0b\u8fd9\u4e24\u4e2a\u53c2\u6570\u3002 FULLRESYNC {runID} {offset} FULLRESYNC \u54cd\u5e94\u8868\u793a\u7b2c\u4e00\u6b21\u590d\u5236\u91c7\u7528\u7684\u5168\u91cf\u590d\u5236\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e3b\u5e93\u4f1a\u628a\u5f53\u524d\u6240\u6709\u7684\u6570\u636e\u90fd\u590d\u5236\u7ed9\u4ece\u5e93\u3002 \u7b2c\u4e8c\u9636\u6bb5\uff0c\u4e3b\u5e93\u5c06\u6240\u6709\u6570\u636e\u540c\u6b65\u7ed9\u4ece\u5e93\u3002\u4ece\u5e93\u6536\u5230\u6570\u636e\u540e\uff0c\u5728\u672c\u5730\u5b8c\u6210\u6570\u636e\u52a0\u8f7d\u3002 \u8fd9\u4e2a\u8fc7\u7a0b\u4f9d\u8d56\u4e8e\u5185\u5b58\u5feb\u7167\u751f\u6210\u7684 RDB \u6587\u4ef6\u3002 \u4e3b\u5e93\u6267\u884c bgsave \u547d\u4ee4\uff0c\u751f\u6210 RDB \u6587\u4ef6\uff0c\u63a5\u7740\u5c06\u6587\u4ef6\u53d1\u7ed9\u4ece\u5e93\u3002 \u5e93\u63a5\u6536\u5230 RDB \u6587\u4ef6\u540e\uff0c\u4f1a\u5148\u6e05\u7a7a\u5f53\u524d\u6570\u636e\u5e93\uff0c\u7136\u540e\u52a0\u8f7d RDB \u6587\u4ef6\u3002 \u8fd9\u662f\u56e0\u4e3a\u4ece\u5e93\u5728\u901a\u8fc7 replicaof \u547d\u4ee4\u5f00\u59cb\u548c\u4e3b\u5e93\u540c\u6b65\u524d\uff0c\u53ef\u80fd\u4fdd\u5b58\u4e86\u5176\u4ed6\u6570\u636e \u3002\u4e3a\u4e86\u907f\u514d\u4e4b\u524d\u6570\u636e\u7684\u5f71\u54cd\uff0c\u4ece\u5e93\u9700\u8981\u5148\u628a\u5f53\u524d\u6570\u636e\u5e93\u6e05\u7a7a\u3002 \u5728\u4e3b\u5e93\u5c06\u6570\u636e\u540c\u6b65\u7ed9\u4ece\u5e93\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e3b\u5e93\u4e0d\u4f1a\u88ab\u963b\u585e\uff0c\u4ecd\u7136\u53ef\u4ee5\u6b63\u5e38\u63a5\u6536\u8bf7\u6c42\u3002 \u8fd9\u4e9b\u8bf7\u6c42\u4e2d\u7684\u5199\u64cd\u4f5c\u5e76\u6ca1\u6709\u8bb0\u5f55\u5230\u521a\u521a\u751f\u6210\u7684 RDB \u6587\u4ef6\u4e2d\u3002 \u4e3a\u4e86\u4fdd\u8bc1\u4e3b\u4ece\u5e93\u7684\u6570\u636e\u4e00\u81f4\u6027\uff0c\u4e3b\u5e93\u4f1a\u5728\u5185\u5b58\u4e2d\u7528\u4e13\u95e8\u7684 replication buffer \uff0c\u8bb0\u5f55 RDB \u6587\u4ef6\u751f\u6210\u540e\u6536\u5230\u7684\u6240\u6709\u5199\u64cd\u4f5c\u3002 \u7b2c\u4e09\u4e2a\u9636\u6bb5\uff0c\u4e3b\u5e93\u4f1a\u628a\u7b2c\u4e8c\u9636\u6bb5\u6267\u884c\u8fc7\u7a0b\u4e2d\u65b0\u6536\u5230\u7684\u5199\u547d\u4ee4\uff0c\u518d\u53d1\u9001\u7ed9\u4ece\u5e93 \u5f53\u4e3b\u5e93\u5b8c\u6210 RDB \u6587\u4ef6\u53d1\u9001\u540e\uff0c\u5c31\u4f1a\u628a\u6b64\u65f6 replication buffer \u4e2d\u7684\u4fee\u6539\u64cd\u4f5c\u53d1\u7ed9\u4ece\u5e93\uff0c\u4ece\u5e93\u518d\u91cd\u65b0\u6267\u884c\u8fd9\u4e9b\u64cd\u4f5c\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4e3b\u4ece\u5e93\u5c31\u5b9e\u73b0\u540c\u6b65\u4e86 3\u3001\u4e3b\u4ece\u7ea7\u8054\u6a21\u5f0f\u5206\u62c5\u5168\u91cf\u590d\u5236\u65f6\u7684\u4e3b\u5e93\u538b\u529b \u4e00\u6b21\u5168\u91cf\u590d\u5236\u4e2d\uff0c\u5bf9\u4e8e\u4e3b\u5e93\u6765\u8bf4\uff0c\u9700\u8981\u5b8c\u6210\u4e24\u4e2a\u8017\u65f6\u7684\u64cd\u4f5c\uff1a \u751f\u6210 RDB \u6587\u4ef6\u548c\u4f20\u8f93 RDB \u6587\u4ef6 \u3002 \u5982\u679c\u4ece\u5e93\u6570\u91cf\u5f88\u591a\uff0c\u800c\u4e14\u90fd\u8981\u548c\u4e3b\u5e93\u8fdb\u884c\u5168\u91cf\u590d\u5236\u7684\u8bdd\uff0c\u5c31\u4f1a\u5bfc\u81f4\u4e3b\u5e93\u5fd9\u4e8e fork \u5b50\u8fdb\u7a0b\u751f\u6210 RDB \u6587\u4ef6\uff0c\u8fdb\u884c\u6570\u636e\u5168\u91cf\u540c\u6b65 \u3002 fork \u8fd9\u4e2a\u64cd\u4f5c\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u5904\u7406\u6b63\u5e38\u8bf7\u6c42\uff0c\u4ece\u800c\u5bfc\u81f4\u4e3b\u5e93\u54cd\u5e94\u5e94\u7528\u7a0b\u5e8f\u7684\u8bf7\u6c42\u901f\u5ea6\u53d8\u6162\u3002 \u4f20\u8f93 RDB \u6587\u4ef6\u4e5f\u4f1a\u5360\u7528\u4e3b\u5e93\u7684\u7f51\u7edc\u5e26\u5bbd\uff0c\u540c\u6837\u4f1a\u7ed9\u4e3b\u5e93\u7684\u8d44\u6e90\u4f7f\u7528\u5e26\u6765\u538b\u529b\u3002 3-1 \u201c\u4e3b - \u4ece - \u4ece\u201d\u6a21\u5f0f\u5206\u62c5\u4e3b\u5e93\u538b\u529b \u901a\u8fc7\u201c\u4e3b - \u4ece - \u4ece\u201d\u6a21\u5f0f\u5c06\u4e3b\u5e93\u751f\u6210 RDB \u548c\u4f20\u8f93 RDB \u7684\u538b\u529b\uff0c\u4ee5\u7ea7\u8054\u7684\u65b9\u5f0f\u5206\u6563\u5230\u4ece\u5e93\u4e0a\u3002 \uff0c\u6211\u4eec\u5728\u90e8\u7f72\u4e3b\u4ece\u96c6\u7fa4\u7684\u65f6\u5019\uff0c \u53ef\u4ee5\u624b\u52a8\u9009\u62e9\u4e00\u4e2a\u4ece\u5e93\uff08\u6bd4\u5982\u9009\u62e9\u5185\u5b58\u8d44\u6e90\u914d\u7f6e\u8f83\u9ad8\u7684\u4ece\u5e93\uff09 \uff0c\u7528\u4e8e\u7ea7\u8054\u5176\u4ed6\u7684\u4ece\u5e93 \u518d\u9009\u62e9\u4e00\u4e9b\u4ece\u5e93\uff08\u4f8b\u5982\u4e09\u5206\u4e4b\u4e00\u7684\u4ece\u5e93\uff09\uff0c\u5728\u8fd9\u4e9b\u4ece\u5e93\u4e0a\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u8ba9\u5b83\u4eec\u548c\u521a\u624d\u6240\u9009\u7684\u4ece\u5e93\uff0c\u5efa\u7acb\u8d77\u4e3b\u4ece\u5173\u7cfb \u3002 replicaof \u6240\u9009\u4ece\u5e93\u7684IP 6379 \u8fd9\u4e9b\u4ece\u5e93\u5c31\u4f1a\u77e5\u9053\uff0c\u5728\u8fdb\u884c\u540c\u6b65\u65f6\uff0c\u4e0d\u7528\u518d\u548c\u4e3b\u5e93\u8fdb\u884c\u4ea4\u4e92\u4e86\uff0c\u53ea\u8981\u548c\u7ea7\u8054\u7684\u4ece\u5e93\u8fdb\u884c\u5199\u64cd\u4f5c\u540c\u6b65\u5c31\u884c\u4e86\uff0c\u8fd9\u5c31\u53ef\u4ee5\u51cf\u8f7b\u4e3b\u5e93\u4e0a\u7684\u538b\u529b\uff0c \u4e00\u65e6\u4e3b\u4ece\u5e93\u5b8c\u6210\u4e86\u5168\u91cf\u590d\u5236\uff0c\u5b83\u4eec\u4e4b\u95f4\u5c31\u4f1a\u4e00\u76f4\u7ef4\u62a4\u4e00\u4e2a\u7f51\u7edc\u8fde\u63a5\uff0c\u4e3b\u5e93\u4f1a\u901a\u8fc7\u8fd9\u4e2a\u8fde\u63a5\u5c06\u540e\u7eed\u9646\u7eed\u6536\u5230\u7684\u547d\u4ee4\u64cd\u4f5c\u518d\u540c\u6b65\u7ed9\u4ece\u5e93\uff0c \u8fd9\u4e2a\u8fc7\u7a0b\u4e5f\u79f0\u4e3a\u57fa\u4e8e\u957f\u8fde\u63a5\u7684\u547d\u4ee4\u4f20\u64ad\uff0c\u53ef\u4ee5\u907f\u514d\u9891\u7e41\u5efa\u7acb\u8fde\u63a5\u7684\u5f00\u9500\u3002 \u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u5b58\u5728\u7740\u98ce\u9669\u70b9\uff0c\u6700\u5e38\u89c1\u7684\u5c31\u662f\u7f51\u7edc\u65ad\u8fde\u6216\u963b\u585e\u3002\u5982\u679c\u7f51\u7edc\u65ad\u8fde\uff0c\u4e3b\u4ece\u5e93\u4e4b\u95f4\u5c31\u65e0\u6cd5\u8fdb\u884c\u547d\u4ee4\u4f20\u64ad\u4e86\uff0c\u4ece\u5e93\u7684\u6570\u636e\u81ea\u7136\u4e5f\u5c31\u6ca1\u529e\u6cd5\u548c\u4e3b\u5e93\u4fdd\u6301\u4e00\u81f4\u4e86\uff0c\u5ba2\u6237\u7aef\u5c31\u53ef\u80fd\u4ece\u4ece\u5e93\u8bfb\u5230\u65e7\u6570\u636e 3\u3001\u4e3b\u4ece\u5e93\u95f4\u7f51\u7edc\u65ad\u4e86\u600e\u4e48\u529e\uff1f \u5728 Redis 2.8 \u4e4b\u524d\uff0c\u5982\u679c\u4e3b\u4ece\u5e93\u5728\u547d\u4ee4\u4f20\u64ad\u65f6\u51fa\u73b0\u4e86\u7f51\u7edc\u95ea\u65ad\uff0c\u90a3\u4e48\uff0c\u4ece\u5e93\u5c31\u4f1a\u548c\u4e3b\u5e93\u91cd\u65b0\u8fdb\u884c\u4e00\u6b21\u5168\u91cf\u590d\u5236\uff0c\u5f00\u9500\u975e\u5e38\u5927\u3002 3-1 \u589e\u91cf\u590d\u5236 \u4ece Redis 2.8 \u5f00\u59cb\uff0c\u7f51\u7edc\u65ad\u4e86\u4e4b\u540e\uff0c\u4e3b\u4ece\u5e93\u4f1a\u91c7\u7528\u589e\u91cf\u590d\u5236\u7684\u65b9\u5f0f\u7ee7\u7eed\u540c\u6b65\u3002 \u548c\u5168\u91cf\u590d\u5236\u7684\u4e0d\u540c\uff1a \u5168\u91cf\u590d\u5236\u662f\u540c\u6b65\u6240\u6709\u6570\u636e\uff0c\u800c\u589e\u91cf\u590d\u5236\u53ea\u4f1a\u628a\u4e3b\u4ece\u5e93\u7f51\u7edc\u65ad\u8fde\u671f\u95f4\u4e3b\u5e93\u6536\u5230\u7684\u547d\u4ee4\uff0c\u540c\u6b65\u7ed9\u4ece\u5e93\u3002 \u90a3\u4e48\uff0c\u589e\u91cf\u590d\u5236\u65f6\uff0c\u4e3b\u4ece\u5e93\u4e4b\u95f4\u5177\u4f53\u662f\u600e\u4e48\u4fdd\u6301\u540c\u6b65\u7684\u5462\uff1f \u8fd9\u91cc\u7684\u5c31\u5728\u4e8e repl_backlog_buffer \u8fd9\u4e2a\u7f13\u51b2\u533a\u3002 \u4e3b\u5e93\u4e00\u76f4\u5728\u5199\u5165 repl_backlog_buffer \uff0c\u5f53\u4ece\u5e93\u65ad\u8fde\u53c8\u91cd\u8fde\u4e4b\u540e\uff0c\u901a\u8fc7 psync \u547d\u4ee4\u544a\u8bc9\u4e3b\u5e93\u81ea\u5df1\u7684 slave_repl_offset \uff0c\u7136\u540e\u4e3b\u5e93\u6839\u636e\u81ea\u5df1\u7684 master_repl_offset \u548c slave_repl_offset \u6765\u5224\u65ad\u662f\u9700\u8981\u5168\u91cf\u540c\u6b65\u8fd8\u662f\u628a\u4e24\u8005\u4e4b\u95f4\u7684\u547d\u4ee4\u589e\u91cf\u540c\u6b65\u7ed9\u4ece\u5e93\uff08\u540c\u6b65\u7684\u65b9\u5f0f\u5c31\u662f\u901a\u8fc7\u4e3b\u5e93\u4e0e\u6bcf\u4e2a\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5\u4e4b\u540e\u7684\u8fd9\u4e2a\u6240\u8c13\u7684 replication buffer \uff09 repl_backlog_buffer \u662f\u4e00\u4e2a\u73af\u5f62\u7f13\u51b2\u533a\uff0c\u4e3b\u5e93\u4f1a\u8bb0\u5f55\u81ea\u5df1\u5199\u5230\u7684\u4f4d\u7f6e\uff0c\u4ece\u5e93\u5219\u4f1a\u8bb0\u5f55\u81ea\u5df1\u5df2\u7ecf\u8bfb\u5230\u7684\u4f4d\u7f6e\u3002 3-2 \u4e3b\u5e93\u504f\u79fb \u521a\u5f00\u59cb\u7684\u65f6\u5019\uff0c\u4e3b\u5e93\u548c\u4ece\u5e93\u7684\u5199\u8bfb\u4f4d\u7f6e\u5728\u4e00\u8d77\uff0c\u8fd9\u7b97\u662f\u5b83\u4eec\u7684\u8d77\u59cb\u4f4d\u7f6e \u968f\u7740\u4e3b\u5e93\u4e0d\u65ad\u63a5\u6536\u65b0\u7684\u5199\u64cd\u4f5c\uff0c\u5b83\u5728\u7f13\u51b2\u533a\u4e2d\u7684\u5199\u4f4d\u7f6e\u4f1a\u9010\u6b65\u504f\u79bb\u8d77\u59cb\u4f4d\u7f6e \uff0c\u6211\u4eec\u901a\u5e38\u7528\u504f\u79fb\u91cf\u6765\u8861\u91cf\u8fd9\u4e2a\u504f\u79fb\u8ddd\u79bb\u7684\u5927\u5c0f \u5bf9\u4e3b\u5e93\u6765\u8bf4\uff0c\u5bf9\u5e94\u7684\u504f\u79fb\u91cf\u5c31\u662f master_repl_offset \u4e3b\u5e93\u63a5\u6536\u7684\u65b0\u5199\u64cd\u4f5c\u8d8a\u591a\uff0c\u8fd9\u4e2a\u503c\u5c31\u4f1a\u8d8a\u5927\u3002 3-3 \u4ece\u5e93\u504f\u79fb \u4ece\u5e93\u5728\u590d\u5236\u5b8c\u5199\u64cd\u4f5c\u547d\u4ee4\u540e\uff0c\u5b83\u5728\u7f13\u51b2\u533a\u4e2d\u7684\u8bfb\u4f4d\u7f6e\u4e5f\u5f00\u59cb\u9010\u6b65\u504f\u79fb\u521a\u624d\u7684\u8d77\u59cb\u4f4d\u7f6e\uff0c\u6b64\u65f6\uff0c\u4ece\u5e93\u5df2\u590d\u5236\u7684\u504f\u79fb\u91cf slave_repl_offset \u4e5f\u5728\u4e0d\u65ad\u589e\u52a0\u3002 \u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e24\u4e2a\u504f\u79fb\u91cf\u57fa\u672c\u76f8\u7b49\u3002 \u4e3b\u4ece\u5e93\u7684\u8fde\u63a5\u6062\u590d\u4e4b\u540e\uff0c\u4ece\u5e93\u9996\u5148\u4f1a\u7ed9\u4e3b\u5e93\u53d1\u9001 psync \u547d\u4ee4\uff0c\u5e76\u628a\u81ea\u5df1\u5f53\u524d\u7684 slave_repl_offset \u53d1\u7ed9\u4e3b\u5e93\uff0c \u4e3b\u5e93\u4f1a\u5224\u65ad\u81ea\u5df1\u7684 master_repl_offset \u548c slave_repl_offset \u4e4b\u95f4\u7684\u5dee\u8ddd\u3002 \u5728\u7f51\u7edc\u65ad\u8fde\u9636\u6bb5\uff0c\u4e3b\u5e93\u53ef\u80fd\u4f1a\u6536\u5230\u65b0\u7684\u5199\u64cd\u4f5c\u547d\u4ee4 \uff0c\u6240\u4ee5\uff0c \u4e00\u822c\u6765\u8bf4\uff0c master_repl_offset \u4f1a\u5927\u4e8e slave_repl_offset \u3002 \u6b64\u65f6\uff0c\u4e3b\u5e93\u53ea\u7528\u628a master_repl_offset \u548c slave_repl_offset \u4e4b\u95f4\u7684\u547d\u4ee4\u64cd\u4f5c\u540c\u6b65\u7ed9\u4ece\u5e93\u5c31\u884c\u3002 \u4e3b\u5e93\u548c\u4ece\u5e93\u4e4b\u95f4\u76f8\u5dee\u4e86 put d e \u548c put d f \u4e24\u4e2a\u64cd\u4f5c\uff0c\u5728\u589e\u91cf\u590d\u5236\u65f6\uff0c\u4e3b\u5e93\u53ea\u9700\u8981\u628a\u5b83\u4eec\u540c\u6b65\u7ed9\u4ece\u5e93\uff0c\u5c31\u884c\u4e86 3-4 repl_backlog_size \u56e0\u4e3a repl_backlog_buffer \u662f\u4e00\u4e2a\u73af\u5f62\u7f13\u51b2\u533a\uff0c\u6240\u4ee5\u5728\u7f13\u51b2\u533a\u5199\u6ee1\u540e\uff0c\u4e3b\u5e93\u4f1a\u7ee7\u7eed\u5199\u5165\uff0c\u6b64\u65f6\uff0c\u5c31\u4f1a\u8986\u76d6\u6389\u4e4b\u524d\u5199\u5165\u7684\u64cd\u4f5c\u3002 \u5982\u679c\u4ece\u5e93\u7684\u8bfb\u53d6\u901f\u5ea6\u6bd4\u8f83\u6162\uff0c\u5c31\u6709\u53ef\u80fd\u5bfc\u81f4\u4ece\u5e93\u8fd8\u672a\u8bfb\u53d6\u7684\u64cd\u4f5c\u88ab\u4e3b\u5e93\u65b0\u5199\u7684\u64cd\u4f5c\u8986\u76d6\u4e86\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u4e3b\u4ece\u5e93\u95f4\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u3002 \u907f\u514d\u8fd9\u4e00\u60c5\u51b5 \u4e00\u822c\u800c\u8a00\uff0c\u6211\u4eec\u53ef\u4ee5\u8c03\u6574 repl_backlog_size \u8fd9\u4e2a\u53c2\u6570 \u3002\u8fd9\u4e2a\u53c2\u6570\u548c\u6240\u9700\u7684\u7f13\u51b2\u7a7a\u95f4\u5927\u5c0f\u6709\u5173\u3002\u7f13\u51b2\u7a7a\u95f4\u7684\u8ba1\u7b97\u516c\u5f0f\u662f\uff1a \u7f13\u51b2\u7a7a\u95f4\u5927\u5c0f = \u4e3b\u5e93\u5199\u5165\u547d\u4ee4\u901f\u5ea6 * \u64cd\u4f5c\u5927\u5c0f - \u4e3b\u4ece\u5e93\u95f4\u7f51\u7edc\u4f20\u8f93\u547d\u4ee4\u901f\u5ea6 * \u64cd\u4f5c\u5927\u5c0f \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u8003\u8651\u5230\u53ef\u80fd\u5b58\u5728\u4e00\u4e9b\u7a81\u53d1\u7684\u8bf7\u6c42\u538b\u529b\uff0c \u6211\u4eec\u901a\u5e38\u9700\u8981\u628a\u8fd9\u4e2a\u7f13\u51b2\u7a7a\u95f4\u6269\u5927\u4e00\u500d \u5373 repl_backlog_size = \u7f13\u51b2\u7a7a\u95f4\u5927\u5c0f * 2 \uff0c\u8fd9\u4e5f\u5c31\u662f repl_backlog_size \u7684\u6700\u7ec8\u503c\u3002 \u4e3e\u4e2a\u6817\u5b50\ud83c\udf30 \u5982\u679c\u4e3b\u5e93\u6bcf\u79d2\u5199\u5165 2000 \u4e2a\u64cd\u4f5c\uff0c\u6bcf\u4e2a\u64cd\u4f5c\u7684\u5927\u5c0f\u4e3a 2KB \u7f51\u7edc\u6bcf\u79d2\u80fd\u4f20\u8f93 1000 \u4e2a\u64cd\u4f5c\uff0c\u90a3\u4e48\uff0c\u6709 1000 \u4e2a\u64cd\u4f5c\u9700\u8981\u7f13\u51b2\u8d77\u6765\uff0c\u8fd9\u5c31\u81f3\u5c11\u9700\u8981 2MB \u7684\u7f13\u51b2\u7a7a\u95f4\u3002 \u5426\u5219\uff0c\u65b0\u5199\u7684\u547d\u4ee4\u5c31\u4f1a\u8986\u76d6\u6389\u65e7\u64cd\u4f5c\u4e86\u3002\u4e3a\u4e86\u5e94\u5bf9\u53ef\u80fd\u7684\u7a81\u53d1\u538b\u529b\uff0c\u6211\u4eec\u6700\u7ec8\u628a repl_backlog_size \u8bbe\u4e3a 4MB \u3002 \u589e\u91cf\u590d\u5236\u65f6\u4e3b\u4ece\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u98ce\u9669\u5c31\u964d\u4f4e\u4e86\u3002\u4e0d\u8fc7\uff0c\u5982\u679c\u5e76\u53d1\u8bf7\u6c42\u91cf\u975e\u5e38\u5927\uff0c \u8fde\u4e24\u500d\u7684\u7f13\u51b2\u7a7a\u95f4\u90fd\u5b58\u4e0d\u4e0b\u65b0\u64cd\u4f5c\u8bf7\u6c42\u7684\u8bdd\uff0c\u6b64\u65f6\uff0c\u4e3b\u4ece\u5e93\u6570\u636e\u4ecd\u7136\u53ef\u80fd\u4e0d\u4e00\u81f4\u3002 \u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0c \u4e00\u65b9\u9762\uff0c\u4f60\u53ef\u4ee5\u6839\u636e Redis \u6240\u5728\u670d\u52a1\u5668\u7684\u5185\u5b58\u8d44\u6e90\u518d\u9002\u5f53\u589e\u52a0 repl_backlog_size \u503c\uff0c\u6bd4\u5982\u8bf4\u8bbe\u7f6e\u6210\u7f13\u51b2\u7a7a\u95f4\u5927\u5c0f\u7684 4 \u500d\uff0c \u53e6\u4e00\u65b9\u9762\uff0c\u4f60\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u5207\u7247\u96c6\u7fa4\u6765\u5206\u62c5\u5355\u4e2a\u4e3b\u5e93\u7684\u8bf7\u6c42\u538b\u529b\u3002 4\u3001\u672c\u8282\u5c0f\u7ed3 Redis \u7684\u4e3b\u4ece\u5e93\u540c\u6b65\u7684\u57fa\u672c\u539f\u7406\uff0c\u603b\u7ed3\u6765\u8bf4\uff0c\u6709\u4e09\u79cd\u6a21\u5f0f\uff1a \u5168\u91cf\u590d\u5236\u3001\u57fa\u4e8e\u957f\u8fde\u63a5\u7684\u547d\u4ee4\u4f20\u64ad\uff0c\u4ee5\u53ca\u589e\u91cf\u590d\u5236 \u5168\u91cf\u590d\u5236\u867d\u7136\u8017\u65f6\uff0c\u4f46\u662f\u5bf9\u4e8e\u4ece\u5e93\u6765\u8bf4\uff0c\u5982\u679c\u662f\u7b2c\u4e00\u6b21\u540c\u6b65\uff0c\u5168\u91cf\u590d\u5236\u662f\u65e0\u6cd5\u907f\u514d\u7684 \u4e00\u4e2a Redis \u5b9e\u4f8b\u7684\u6570\u636e\u5e93\u4e0d\u8981\u592a\u5927\uff0c\u4e00\u4e2a\u5b9e\u4f8b\u5927\u5c0f\u5728\u51e0 GB \u7ea7\u522b\u6bd4\u8f83\u5408\u9002\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11 RDB \u6587\u4ef6\u751f\u6210\u3001\u4f20\u8f93\u548c\u91cd\u65b0\u52a0\u8f7d\u7684\u5f00\u9500 \u4e3a\u4e86\u907f\u514d\u591a\u4e2a\u4ece\u5e93\u540c\u65f6\u548c\u4e3b\u5e93\u8fdb\u884c\u5168\u91cf\u590d\u5236\uff0c\u7ed9\u4e3b\u5e93\u8fc7\u5927\u7684\u540c\u6b65\u538b\u529b\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u91c7\u7528\u201c\u4e3b - \u4ece - \u4ece\u201d\u8fd9\u4e00\u7ea7\u8054\u6a21\u5f0f\uff0c\u6765\u7f13\u89e3\u4e3b\u5e93\u7684\u538b\u529b\u3002 \u957f\u8fde\u63a5\u590d\u5236\u662f\u4e3b\u4ece\u5e93\u6b63\u5e38\u8fd0\u884c\u540e\u7684\u5e38\u89c4\u540c\u6b65\u9636\u6bb5\u3002\u5728\u8fd9\u4e2a\u9636\u6bb5\u4e2d\uff0c\u4e3b\u4ece\u5e93\u4e4b\u95f4\u901a\u8fc7\u547d\u4ee4\u4f20\u64ad\u5b9e\u73b0\u540c\u6b65\u3002 \u671f\u95f4\u5982\u679c\u9047\u5230\u4e86\u7f51\u7edc\u65ad\u8fde\uff0c\u589e\u91cf\u590d\u5236\u5c31\u6d3e\u4e0a\u7528\u573a\u4e86\u3002 \u7559\u610f\u4e00\u4e0b repl_backlog_size \u8fd9\u4e2a\u914d\u7f6e\u53c2\u6570\u3002 \u5982\u679c\u5b83\u914d\u7f6e\u5f97\u8fc7\u5c0f\uff0c\u5728\u589e\u91cf\u590d\u5236\u9636\u6bb5\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4ece\u5e93\u7684\u590d\u5236\u8fdb\u5ea6\u8d76\u4e0d\u4e0a\u4e3b\u5e93\uff0c\u8fdb\u800c\u5bfc\u81f4\u4ece\u5e93\u91cd\u65b0\u8fdb\u884c\u5168\u91cf\u590d\u5236 \u3002 \u6240\u4ee5\uff0c\u901a\u8fc7\u8c03\u5927\u8fd9\u4e2a\u53c2\u6570\uff0c\u53ef\u4ee5\u51cf\u5c11\u4ece\u5e93\u5728\u7f51\u7edc\u65ad\u8fde\u65f6\u5168\u91cf\u590d\u5236\u7684\u98ce\u9669\u3002 4-1 \u672c\u8282\u4eae\u70b9 Redis\u91c7\u7528\u8bfb\u5199\u5206\u79bb\u7684\u597d\u5904\uff1a\u907f\u514d\u4e86\u52a0\u9501\uff0c\u5b9e\u4f8b\u95f4\u534f\u5546\u662f\u5426\u5b8c\u6210\u4fee\u6539\u7b49\u590d\u6742\u64cd\u4f5c \u5168\u91cf\u540c\u6b65\u7684\u53d1\u751f\u65f6\u673a\uff1a\u9996\u6b21\u4e0a\u7ebf \u548c \u4ece\u5e93\u7684\u73af\u5f62\u7f13\u51b2\u533a\u4f4d\u7f6e\u6807\u8bc6\u88ab\u8986\u76d6 \u589e\u91cf\u540c\u6b65\u4fdd\u969c\u673a\u5236\u4f9d\u8d56\u4e8e\u4e00\u4e2a\u7279\u6b8a\u7684\u6570\u636e\u7ed3\u6784\uff1a\u73af\u5f62\u7f13\u51b2\u533a \u9996\u6b21\u540c\u6b65\u5206\u4e3a\u4e09\u4e2a\u9636\u6bb5\uff0c\u2460\uff1a\u5efa\u7acb\u8fde\u63a5\uff0c\u2461\uff1a\u540c\u6b65RDB\u6587\u4ef6\uff0c\u2462\uff1a\u540c\u6b65\u589e\u91cf\u6570\u636e \u5168\u91cf\u540c\u6b65\u9700\u8981\u4e3b\u673afork\u5b50\u8fdb\u7a0b\uff0c\u4ea7\u751f\u5168\u91cfRDB\u6587\u4ef6\uff0c\u5e76\u53d1\u9001\uff0c\u4e3a\u4e86\u51cf\u8f7b\u4e3b\u673a\u7684\u538b\u529b\uff0c\u4ece\u673a\u4e4b\u95f4\u4e5f\u53ef\u7528\u4e92\u76f8\u540c\u6b65 \u589e\u91cf\u540c\u6b65\u53ef\u4ee5\u7f13\u89e3\u4e3b\u673a\u5168\u91cf\u540c\u6b65\u7684\u538b\u529b\uff0c\u5b83\u9700\u8981\u7279\u6b8a\u673a\u5236\u4fdd\u969c\uff1a replication buffer \uff0c\u73af\u5f62\u7f13\u51b2\u533a\uff0c master_repl_offset \uff0c slave_repl_offset \u4ece\u673a\u7684\u540c\u6b65\u4f4d\u7f6e\u6807\u8bc6\uff0c\u5728\u73af\u5f62\u7f13\u51b2\u533a\u88ab\u8986\u76d6\u540e\uff0c\u4f1a\u89e6\u53d1\u65b0\u7684\u4e00\u8f6e\u5168\u91cf\u540c\u6b65\uff0c\u6240 repl_backlog_buffer \u7684\u5927\u5c0f\u662fredis\u91cd\u8981\u7684\u8c03\u4f18\u53c2\u6570 \u4e3b\u4ece\u540c\u6b65\u6709\u4e09\u79cd\u673a\u5236\uff1a\u5168\u91cf\u540c\u6b65\uff0c\u57fa\u4e8e\u957f\u94fe\u63a5\u7684\u547d\u4ee4\u4f20\u64ad\uff0c\u589e\u91cf\u540c\u6b65 4-2 \u6bcf\u8282\u4e00\u95ee \u4e3b\u4ece\u5e93\u95f4\u7684\u6570\u636e\u590d\u5236\u540c\u6b65\u4f7f\u7528\u7684\u662f RDB \u6587\u4ef6\uff0c\u524d\u9762\u6211\u4eec\u5b66\u4e60\u8fc7\uff0cAOF \u8bb0\u5f55\u7684\u64cd\u4f5c\u547d\u4ee4\u66f4\u5168\uff0c\u76f8\u6bd4\u4e8e RDB \u4e22\u5931\u7684\u6570\u636e\u66f4\u5c11\u3002\u90a3\u4e48\uff0c\u4e3a\u4ec0\u4e48\u4e3b\u4ece\u5e93\u95f4\u7684\u590d\u5236\u4e0d\u4f7f\u7528 AOF \u5462\uff1f RDB\u8bfb\u53d6\u5feb\uff0c\u8fd9\u6837\u4ece\u5e93\u53ef\u4ee5\u5c3d\u5feb\u5b8c\u6210RDB\u7684\u8bfb\u53d6\uff0c\u7136\u540e\u5165\u53bb\u6d88\u8d39replication buffer\u7684\u6570\u636e\u3002\u5982\u679c\u662fAOF\u7684\u8bdd\uff0cA OF\u4f53\u79ef\u5927\uff0c\u8bfb\u53d6\u6162\uff0c\u9700\u8981\u66f4\u5927\u7684replication buffer\uff0c\u5982\u679c\u4e00\u4e2a\u4e3b\u8282\u70b9\u7684\u4ece\u8282\u70b9\u591a\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u66f4\u5927\u7684\u5185\u5b58\u53bb\u5904\u7406\uff1b AOF\u6587\u4ef6\u662fappend\u8ffd\u52a0\u6a21\u5f0f\uff0c\u540c\u65f6\u8bfb\u5199\u9700\u8981\u8003\u8651\u5e76\u53d1\u5b89\u5168\u95ee\u9898\uff0c\u5e76\u4e14AOF\u662f\u6587\u672c\u6587\u4ef6\uff0c\u4f53\u79ef\u8f83\u5927\uff0c\u6d6a\u8d39\u7f51\u7edc\u5e26\u5bbd\u3002","title":"\u7b2c\u516d\u8282 \u6570\u636e\u540c\u6b65\uff1a\u4e3b\u4ece\u5e93\u6570\u636e\u4e00\u81f4"},{"location":"chap2/6redis_master_slave_replicate/#_1","text":"\u5982\u679c Redis \u53d1\u751f\u4e86\u5b95\u673a\uff0c\u5b83\u4eec\u53ef\u4ee5\u5206\u522b\u901a\u8fc7\u56de\u653e\u65e5\u5fd7AOF \u548c\u91cd\u65b0\u8bfb\u5165 RDB \u6587\u4ef6\u7684\u65b9\u5f0f\u6062\u590d\u6570\u636e\uff0c\u4ece\u800c\u4fdd\u8bc1\u5c3d\u91cf\u5c11\u4e22\u5931\u6570\u636e\uff0c\u63d0\u5347\u53ef\u9760\u6027 \u6211\u4eec\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\u53ea\u8fd0\u884c\u4e86\u4e00\u4e2a Redis \u5b9e\u4f8b\uff0c\u90a3\u4e48\uff0c\u5982\u679c\u8fd9\u4e2a\u5b9e\u4f8b\u5b95\u673a\u4e86\uff0c\u5b83\u5728\u6062\u590d\u671f\u95f4\uff0c\u662f\u65e0\u6cd5\u670d\u52a1\u65b0\u6765\u7684\u6570\u636e\u5b58\u53d6\u8bf7\u6c42\u7684\u3002 Redis \u5177\u6709\u9ad8\u53ef\u9760\u6027 \u4e00\u662f\u6570\u636e\u5c3d\u91cf\u5c11\u4e22\u5931 \u4e8c\u662f\u670d\u52a1\u5c3d\u91cf\u5c11\u4e2d\u65ad AOF \u548c RDB \u4fdd\u8bc1\u4e86\u524d\u8005\uff0c\u800c\u5bf9\u4e8e\u540e\u8005\uff0c Redis \u7684\u505a\u6cd5\u5c31\u662f\u589e\u52a0\u526f\u672c\u5197\u4f59\u91cf\uff0c\u5c06\u4e00\u4efd\u6570\u636e\u540c\u65f6\u4fdd\u5b58\u5728\u591a\u4e2a\u5b9e\u4f8b\u4e0a \u5373\u4f7f\u6709\u4e00\u4e2a\u5b9e\u4f8b\u51fa\u73b0\u4e86\u6545\u969c\uff0c\u9700\u8981\u8fc7\u4e00\u6bb5\u65f6\u95f4\u624d\u80fd\u6062\u590d\uff0c\u5176\u4ed6\u5b9e\u4f8b\u4e5f\u53ef\u4ee5\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u4e0d\u4f1a\u5f71\u54cd\u4e1a\u52a1\u4f7f\u7528\u3002","title":"\u7b2c\u516d\u8282 \u6570\u636e\u540c\u6b65\uff1a\u4e3b\u4ece\u5e93\u6570\u636e\u4e00\u81f4"},{"location":"chap2/6redis_master_slave_replicate/#1redis","text":"Redis \u63d0\u4f9b\u4e86\u4e3b\u4ece\u5e93\u6a21\u5f0f\uff0c\u4ee5\u4fdd\u8bc1\u6570\u636e\u526f\u672c\u7684\u4e00\u81f4\uff0c \u4e3b\u4ece\u5e93\u4e4b\u95f4\u91c7\u7528\u7684\u662f\u8bfb\u5199\u5206\u79bb\u7684\u65b9\u5f0f \u3002 \u8bfb\u64cd\u4f5c\uff1a\u4e3b\u5e93\u3001\u4ece\u5e93\u90fd\u53ef\u4ee5\u63a5\u6536\uff1b \u5199\u64cd\u4f5c\uff1a\u9996\u5148\u5230\u4e3b\u5e93\u6267\u884c\uff0c\u7136\u540e\uff0c\u4e3b\u5e93\u5c06\u5199\u64cd\u4f5c\u540c\u6b65\u7ed9\u4ece\u5e93 \u3002","title":"1\u3001Redis\u4e3b\u4ece\u5e93\u6a21\u5f0f"},{"location":"chap2/6redis_master_slave_replicate/#1-1","text":"\u4e0d\u7ba1\u662f\u4e3b\u5e93\u8fd8\u662f\u4ece\u5e93\uff0c\u90fd\u80fd\u63a5\u6536\u5ba2\u6237\u7aef\u7684\u5199\u64cd\u4f5c\uff0c\u90a3\u4e48\uff0c\u4e00\u4e2a\u76f4\u63a5\u7684\u95ee\u9898\u5c31\u662f\uff1a \u5982\u679c\u5ba2\u6237\u7aef\u5bf9\u540c\u4e00\u4e2a\u6570\u636e\uff08\u4f8b\u5982 k1\uff09\u524d\u540e\u4fee\u6539\u4e86\u4e09\u6b21\uff0c\u6bcf\u4e00\u6b21\u7684\u4fee\u6539\u8bf7\u6c42\u90fd\u53d1\u9001\u5230\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\uff0c\u5728\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\u6267\u884c\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e2a\u6570\u636e\u5728\u8fd9\u4e09\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u526f\u672c\u5c31\u4e0d\u4e00\u81f4\u4e86\uff08\u5206\u522b\u662f v1\u3001v2 \u548c v3\uff09\u3002\u5728\u8bfb\u53d6\u8fd9\u4e2a\u6570\u636e\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u80fd\u8bfb\u53d6\u5230\u65e7\u7684\u503c\u3002 \u5982\u679c\u6211\u4eec\u975e\u8981\u4fdd\u6301\u8fd9\u4e2a\u6570\u636e\u5728\u4e09\u4e2a\u5b9e\u4f8b\u4e0a\u4e00\u81f4\uff0c\u5c31\u8981\u6d89\u53ca\u5230\u52a0\u9501\u3001\u5b9e\u4f8b\u95f4\u534f\u5546\u662f\u5426\u5b8c\u6210\u4fee\u6539\u7b49\u4e00\u7cfb\u5217\u64cd\u4f5c\uff0c\u4f46\u8fd9\u4f1a\u5e26\u6765\u5de8\u989d\u7684\u5f00\u9500\uff0c\u5f53\u7136\u662f\u4e0d\u592a\u80fd\u63a5\u53d7\u7684\u3002 \u800c\u4e3b\u4ece\u5e93\u6a21\u5f0f\u4e00\u65e6\u91c7\u7528\u4e86\u8bfb\u5199\u5206\u79bb\uff0c\u6240\u6709\u6570\u636e\u7684\u4fee\u6539\u53ea\u4f1a\u5728\u4e3b\u5e93\u4e0a\u8fdb\u884c\uff0c\u4e0d\u7528\u534f\u8c03\u4e09\u4e2a\u5b9e\u4f8b\u3002\u4e3b\u5e93\u6709\u4e86\u6700\u65b0\u7684\u6570\u636e\u540e\uff0c\u4f1a\u540c\u6b65\u7ed9\u4ece\u5e93\uff0c\u8fd9\u6837\uff0c\u4e3b\u4ece\u5e93\u7684\u6570\u636e\u5c31\u662f\u4e00\u81f4\u7684\u3002","title":"1-1 \u4e3a\u4ec0\u4e48\u91c7\u7528\u8bfb\u5199\u5206\u79bb"},{"location":"chap2/6redis_master_slave_replicate/#2","text":"\u5f53\u6211\u4eec\u542f\u52a8\u591a\u4e2a Redis \u5b9e\u4f8b\u7684\u65f6\u5019\uff0c \u5b83\u4eec\u76f8\u4e92\u4e4b\u95f4\u5c31\u53ef\u4ee5\u901a\u8fc7 replicaof \uff08Redis 5.0 \u4e4b\u524d\u4f7f\u7528 slaveof\uff09\u547d\u4ee4\u5f62\u6210\u4e3b\u5e93\u548c\u4ece\u5e93\u7684\u5173\u7cfb \uff0c\u4e4b\u540e\u4f1a\u6309\u7167\u4e09\u4e2a\u9636\u6bb5\u5b8c\u6210\u6570\u636e\u7684\u7b2c\u4e00\u6b21\u540c\u6b65\u3002 \u4f8b\u5982\uff0c\u73b0\u5728\u6709\u5b9e\u4f8b 1\uff08ip\uff1a172.16.19.3\uff09\u548c\u5b9e\u4f8b 2\uff08ip\uff1a172.16.19.5\uff09\uff0c\u6211\u4eec\u5728\u5b9e\u4f8b 2 \u4e0a\u6267\u884c\u4ee5\u4e0b\u8fd9\u4e2a\u547d\u4ee4\u540e\uff0c\u5b9e\u4f8b 2 \u5c31\u53d8\u6210\u4e86\u5b9e\u4f8b 1 \u7684\u4ece\u5e93\uff0c\u5e76\u4ece\u5b9e\u4f8b 1 \u4e0a\u590d\u5236\u6570\u636e\uff1a replicaof 172.16.19.3 6379","title":"2\u3001\u4e3b\u4ece\u5e93\u95f4\u5982\u4f55\u8fdb\u884c\u7b2c\u4e00\u6b21\u540c\u6b65\uff1f"},{"location":"chap2/6redis_master_slave_replicate/#2-1","text":"\u7b2c\u4e00\u9636\u6bb5\u662f\u4e3b\u4ece\u5e93\u95f4\u5efa\u7acb\u8fde\u63a5\u3001\u534f\u5546\u540c\u6b65\u7684\u8fc7\u7a0b\uff0c\u4e3b\u8981\u662f\u4e3a\u5168\u91cf\u590d\u5236\u505a\u51c6\u5907 \u3002 \u5728\u8fd9\u4e00\u6b65\uff0c\u4ece\u5e93\u548c\u4e3b\u5e93\u5efa\u7acb\u8d77\u8fde\u63a5\uff0c\u5e76\u544a\u8bc9\u4e3b\u5e93\u5373\u5c06\u8fdb\u884c\u540c\u6b65\uff0c\u4e3b\u5e93\u786e\u8ba4\u56de\u590d\u540e\uff0c\u4e3b\u4ece\u5e93\u95f4\u5c31\u53ef\u4ee5\u5f00\u59cb\u540c\u6b65\u4e86\u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u4ece\u5e93\u7ed9\u4e3b\u5e93\u53d1\u9001 psync \u547d\u4ee4\uff0c\u8868\u793a\u8981\u8fdb\u884c\u6570\u636e\u540c\u6b65\uff0c\u4e3b\u5e93\u6839\u636e\u8fd9\u4e2a\u547d\u4ee4\u7684\u53c2\u6570\u6765\u542f\u52a8\u590d\u5236\u3002 1. psync \u547d\u4ee4\u5305\u542b\u4e86\u4e3b\u5e93\u7684 runID \u548c\u590d\u5236\u8fdb\u5ea6 offset \u4e24\u4e2a\u53c2\u6570\u3002 runID \uff0c\u662f\u6bcf\u4e2a Redis \u5b9e\u4f8b\u542f\u52a8\u65f6\u90fd\u4f1a\u81ea\u52a8\u751f\u6210\u7684\u4e00\u4e2a\u968f\u673a ID\uff0c\u7528\u6765\u552f\u4e00\u6807\u8bb0\u8fd9\u4e2a\u5b9e\u4f8b\u3002\u5f53\u4ece\u5e93\u548c\u4e3b\u5e93\u7b2c\u4e00\u6b21\u590d\u5236\u65f6\uff0c\u56e0\u4e3a\u4e0d\u77e5\u9053\u4e3b\u5e93\u7684 runID\uff0c\u6240\u4ee5\u5c06 runID \u8bbe\u4e3a \u201c\uff1f\u201d \u3002 offset \uff0c\u6b64\u65f6\u8bbe\u4e3a -1 \uff0c\u8868\u793a\u7b2c\u4e00\u6b21\u590d\u5236\u3002 psync ? -1 2.\u4e3b\u5e93\u6536\u5230 psync \u547d\u4ee4\u540e\uff0c\u4f1a\u7528 FULLRESYNC \u54cd\u5e94\u547d\u4ee4\u5e26\u4e0a\u4e24\u4e2a\u53c2\u6570\uff1a \u4e3b\u5e93 runID \u548c\u4e3b\u5e93\u76ee\u524d\u7684\u590d\u5236\u8fdb\u5ea6 offset\uff0c\u8fd4\u56de\u7ed9\u4ece\u5e93\u3002\u4ece\u5e93\u6536\u5230\u54cd\u5e94\u540e\uff0c\u4f1a\u8bb0\u5f55\u4e0b\u8fd9\u4e24\u4e2a\u53c2\u6570\u3002 FULLRESYNC {runID} {offset} FULLRESYNC \u54cd\u5e94\u8868\u793a\u7b2c\u4e00\u6b21\u590d\u5236\u91c7\u7528\u7684\u5168\u91cf\u590d\u5236\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e3b\u5e93\u4f1a\u628a\u5f53\u524d\u6240\u6709\u7684\u6570\u636e\u90fd\u590d\u5236\u7ed9\u4ece\u5e93\u3002 \u7b2c\u4e8c\u9636\u6bb5\uff0c\u4e3b\u5e93\u5c06\u6240\u6709\u6570\u636e\u540c\u6b65\u7ed9\u4ece\u5e93\u3002\u4ece\u5e93\u6536\u5230\u6570\u636e\u540e\uff0c\u5728\u672c\u5730\u5b8c\u6210\u6570\u636e\u52a0\u8f7d\u3002 \u8fd9\u4e2a\u8fc7\u7a0b\u4f9d\u8d56\u4e8e\u5185\u5b58\u5feb\u7167\u751f\u6210\u7684 RDB \u6587\u4ef6\u3002 \u4e3b\u5e93\u6267\u884c bgsave \u547d\u4ee4\uff0c\u751f\u6210 RDB \u6587\u4ef6\uff0c\u63a5\u7740\u5c06\u6587\u4ef6\u53d1\u7ed9\u4ece\u5e93\u3002 \u5e93\u63a5\u6536\u5230 RDB \u6587\u4ef6\u540e\uff0c\u4f1a\u5148\u6e05\u7a7a\u5f53\u524d\u6570\u636e\u5e93\uff0c\u7136\u540e\u52a0\u8f7d RDB \u6587\u4ef6\u3002 \u8fd9\u662f\u56e0\u4e3a\u4ece\u5e93\u5728\u901a\u8fc7 replicaof \u547d\u4ee4\u5f00\u59cb\u548c\u4e3b\u5e93\u540c\u6b65\u524d\uff0c\u53ef\u80fd\u4fdd\u5b58\u4e86\u5176\u4ed6\u6570\u636e \u3002\u4e3a\u4e86\u907f\u514d\u4e4b\u524d\u6570\u636e\u7684\u5f71\u54cd\uff0c\u4ece\u5e93\u9700\u8981\u5148\u628a\u5f53\u524d\u6570\u636e\u5e93\u6e05\u7a7a\u3002 \u5728\u4e3b\u5e93\u5c06\u6570\u636e\u540c\u6b65\u7ed9\u4ece\u5e93\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e3b\u5e93\u4e0d\u4f1a\u88ab\u963b\u585e\uff0c\u4ecd\u7136\u53ef\u4ee5\u6b63\u5e38\u63a5\u6536\u8bf7\u6c42\u3002 \u8fd9\u4e9b\u8bf7\u6c42\u4e2d\u7684\u5199\u64cd\u4f5c\u5e76\u6ca1\u6709\u8bb0\u5f55\u5230\u521a\u521a\u751f\u6210\u7684 RDB \u6587\u4ef6\u4e2d\u3002 \u4e3a\u4e86\u4fdd\u8bc1\u4e3b\u4ece\u5e93\u7684\u6570\u636e\u4e00\u81f4\u6027\uff0c\u4e3b\u5e93\u4f1a\u5728\u5185\u5b58\u4e2d\u7528\u4e13\u95e8\u7684 replication buffer \uff0c\u8bb0\u5f55 RDB \u6587\u4ef6\u751f\u6210\u540e\u6536\u5230\u7684\u6240\u6709\u5199\u64cd\u4f5c\u3002 \u7b2c\u4e09\u4e2a\u9636\u6bb5\uff0c\u4e3b\u5e93\u4f1a\u628a\u7b2c\u4e8c\u9636\u6bb5\u6267\u884c\u8fc7\u7a0b\u4e2d\u65b0\u6536\u5230\u7684\u5199\u547d\u4ee4\uff0c\u518d\u53d1\u9001\u7ed9\u4ece\u5e93 \u5f53\u4e3b\u5e93\u5b8c\u6210 RDB \u6587\u4ef6\u53d1\u9001\u540e\uff0c\u5c31\u4f1a\u628a\u6b64\u65f6 replication buffer \u4e2d\u7684\u4fee\u6539\u64cd\u4f5c\u53d1\u7ed9\u4ece\u5e93\uff0c\u4ece\u5e93\u518d\u91cd\u65b0\u6267\u884c\u8fd9\u4e9b\u64cd\u4f5c\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4e3b\u4ece\u5e93\u5c31\u5b9e\u73b0\u540c\u6b65\u4e86","title":"2-1 \u4e3b\u4ece\u5e93\u95f4\u6570\u636e\u7b2c\u4e00\u6b21\u540c\u6b65\u7684\u4e09\u4e2a\u9636\u6bb5"},{"location":"chap2/6redis_master_slave_replicate/#3","text":"\u4e00\u6b21\u5168\u91cf\u590d\u5236\u4e2d\uff0c\u5bf9\u4e8e\u4e3b\u5e93\u6765\u8bf4\uff0c\u9700\u8981\u5b8c\u6210\u4e24\u4e2a\u8017\u65f6\u7684\u64cd\u4f5c\uff1a \u751f\u6210 RDB \u6587\u4ef6\u548c\u4f20\u8f93 RDB \u6587\u4ef6 \u3002 \u5982\u679c\u4ece\u5e93\u6570\u91cf\u5f88\u591a\uff0c\u800c\u4e14\u90fd\u8981\u548c\u4e3b\u5e93\u8fdb\u884c\u5168\u91cf\u590d\u5236\u7684\u8bdd\uff0c\u5c31\u4f1a\u5bfc\u81f4\u4e3b\u5e93\u5fd9\u4e8e fork \u5b50\u8fdb\u7a0b\u751f\u6210 RDB \u6587\u4ef6\uff0c\u8fdb\u884c\u6570\u636e\u5168\u91cf\u540c\u6b65 \u3002 fork \u8fd9\u4e2a\u64cd\u4f5c\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u5904\u7406\u6b63\u5e38\u8bf7\u6c42\uff0c\u4ece\u800c\u5bfc\u81f4\u4e3b\u5e93\u54cd\u5e94\u5e94\u7528\u7a0b\u5e8f\u7684\u8bf7\u6c42\u901f\u5ea6\u53d8\u6162\u3002 \u4f20\u8f93 RDB \u6587\u4ef6\u4e5f\u4f1a\u5360\u7528\u4e3b\u5e93\u7684\u7f51\u7edc\u5e26\u5bbd\uff0c\u540c\u6837\u4f1a\u7ed9\u4e3b\u5e93\u7684\u8d44\u6e90\u4f7f\u7528\u5e26\u6765\u538b\u529b\u3002","title":"3\u3001\u4e3b\u4ece\u7ea7\u8054\u6a21\u5f0f\u5206\u62c5\u5168\u91cf\u590d\u5236\u65f6\u7684\u4e3b\u5e93\u538b\u529b"},{"location":"chap2/6redis_master_slave_replicate/#3-1-","text":"\u901a\u8fc7\u201c\u4e3b - \u4ece - \u4ece\u201d\u6a21\u5f0f\u5c06\u4e3b\u5e93\u751f\u6210 RDB \u548c\u4f20\u8f93 RDB \u7684\u538b\u529b\uff0c\u4ee5\u7ea7\u8054\u7684\u65b9\u5f0f\u5206\u6563\u5230\u4ece\u5e93\u4e0a\u3002 \uff0c\u6211\u4eec\u5728\u90e8\u7f72\u4e3b\u4ece\u96c6\u7fa4\u7684\u65f6\u5019\uff0c \u53ef\u4ee5\u624b\u52a8\u9009\u62e9\u4e00\u4e2a\u4ece\u5e93\uff08\u6bd4\u5982\u9009\u62e9\u5185\u5b58\u8d44\u6e90\u914d\u7f6e\u8f83\u9ad8\u7684\u4ece\u5e93\uff09 \uff0c\u7528\u4e8e\u7ea7\u8054\u5176\u4ed6\u7684\u4ece\u5e93 \u518d\u9009\u62e9\u4e00\u4e9b\u4ece\u5e93\uff08\u4f8b\u5982\u4e09\u5206\u4e4b\u4e00\u7684\u4ece\u5e93\uff09\uff0c\u5728\u8fd9\u4e9b\u4ece\u5e93\u4e0a\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u8ba9\u5b83\u4eec\u548c\u521a\u624d\u6240\u9009\u7684\u4ece\u5e93\uff0c\u5efa\u7acb\u8d77\u4e3b\u4ece\u5173\u7cfb \u3002 replicaof \u6240\u9009\u4ece\u5e93\u7684IP 6379 \u8fd9\u4e9b\u4ece\u5e93\u5c31\u4f1a\u77e5\u9053\uff0c\u5728\u8fdb\u884c\u540c\u6b65\u65f6\uff0c\u4e0d\u7528\u518d\u548c\u4e3b\u5e93\u8fdb\u884c\u4ea4\u4e92\u4e86\uff0c\u53ea\u8981\u548c\u7ea7\u8054\u7684\u4ece\u5e93\u8fdb\u884c\u5199\u64cd\u4f5c\u540c\u6b65\u5c31\u884c\u4e86\uff0c\u8fd9\u5c31\u53ef\u4ee5\u51cf\u8f7b\u4e3b\u5e93\u4e0a\u7684\u538b\u529b\uff0c \u4e00\u65e6\u4e3b\u4ece\u5e93\u5b8c\u6210\u4e86\u5168\u91cf\u590d\u5236\uff0c\u5b83\u4eec\u4e4b\u95f4\u5c31\u4f1a\u4e00\u76f4\u7ef4\u62a4\u4e00\u4e2a\u7f51\u7edc\u8fde\u63a5\uff0c\u4e3b\u5e93\u4f1a\u901a\u8fc7\u8fd9\u4e2a\u8fde\u63a5\u5c06\u540e\u7eed\u9646\u7eed\u6536\u5230\u7684\u547d\u4ee4\u64cd\u4f5c\u518d\u540c\u6b65\u7ed9\u4ece\u5e93\uff0c \u8fd9\u4e2a\u8fc7\u7a0b\u4e5f\u79f0\u4e3a\u57fa\u4e8e\u957f\u8fde\u63a5\u7684\u547d\u4ee4\u4f20\u64ad\uff0c\u53ef\u4ee5\u907f\u514d\u9891\u7e41\u5efa\u7acb\u8fde\u63a5\u7684\u5f00\u9500\u3002 \u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u5b58\u5728\u7740\u98ce\u9669\u70b9\uff0c\u6700\u5e38\u89c1\u7684\u5c31\u662f\u7f51\u7edc\u65ad\u8fde\u6216\u963b\u585e\u3002\u5982\u679c\u7f51\u7edc\u65ad\u8fde\uff0c\u4e3b\u4ece\u5e93\u4e4b\u95f4\u5c31\u65e0\u6cd5\u8fdb\u884c\u547d\u4ee4\u4f20\u64ad\u4e86\uff0c\u4ece\u5e93\u7684\u6570\u636e\u81ea\u7136\u4e5f\u5c31\u6ca1\u529e\u6cd5\u548c\u4e3b\u5e93\u4fdd\u6301\u4e00\u81f4\u4e86\uff0c\u5ba2\u6237\u7aef\u5c31\u53ef\u80fd\u4ece\u4ece\u5e93\u8bfb\u5230\u65e7\u6570\u636e","title":"3-1 \u201c\u4e3b - \u4ece - \u4ece\u201d\u6a21\u5f0f\u5206\u62c5\u4e3b\u5e93\u538b\u529b"},{"location":"chap2/6redis_master_slave_replicate/#3_1","text":"\u5728 Redis 2.8 \u4e4b\u524d\uff0c\u5982\u679c\u4e3b\u4ece\u5e93\u5728\u547d\u4ee4\u4f20\u64ad\u65f6\u51fa\u73b0\u4e86\u7f51\u7edc\u95ea\u65ad\uff0c\u90a3\u4e48\uff0c\u4ece\u5e93\u5c31\u4f1a\u548c\u4e3b\u5e93\u91cd\u65b0\u8fdb\u884c\u4e00\u6b21\u5168\u91cf\u590d\u5236\uff0c\u5f00\u9500\u975e\u5e38\u5927\u3002","title":"3\u3001\u4e3b\u4ece\u5e93\u95f4\u7f51\u7edc\u65ad\u4e86\u600e\u4e48\u529e\uff1f"},{"location":"chap2/6redis_master_slave_replicate/#3-1","text":"\u4ece Redis 2.8 \u5f00\u59cb\uff0c\u7f51\u7edc\u65ad\u4e86\u4e4b\u540e\uff0c\u4e3b\u4ece\u5e93\u4f1a\u91c7\u7528\u589e\u91cf\u590d\u5236\u7684\u65b9\u5f0f\u7ee7\u7eed\u540c\u6b65\u3002 \u548c\u5168\u91cf\u590d\u5236\u7684\u4e0d\u540c\uff1a \u5168\u91cf\u590d\u5236\u662f\u540c\u6b65\u6240\u6709\u6570\u636e\uff0c\u800c\u589e\u91cf\u590d\u5236\u53ea\u4f1a\u628a\u4e3b\u4ece\u5e93\u7f51\u7edc\u65ad\u8fde\u671f\u95f4\u4e3b\u5e93\u6536\u5230\u7684\u547d\u4ee4\uff0c\u540c\u6b65\u7ed9\u4ece\u5e93\u3002 \u90a3\u4e48\uff0c\u589e\u91cf\u590d\u5236\u65f6\uff0c\u4e3b\u4ece\u5e93\u4e4b\u95f4\u5177\u4f53\u662f\u600e\u4e48\u4fdd\u6301\u540c\u6b65\u7684\u5462\uff1f \u8fd9\u91cc\u7684\u5c31\u5728\u4e8e repl_backlog_buffer \u8fd9\u4e2a\u7f13\u51b2\u533a\u3002 \u4e3b\u5e93\u4e00\u76f4\u5728\u5199\u5165 repl_backlog_buffer \uff0c\u5f53\u4ece\u5e93\u65ad\u8fde\u53c8\u91cd\u8fde\u4e4b\u540e\uff0c\u901a\u8fc7 psync \u547d\u4ee4\u544a\u8bc9\u4e3b\u5e93\u81ea\u5df1\u7684 slave_repl_offset \uff0c\u7136\u540e\u4e3b\u5e93\u6839\u636e\u81ea\u5df1\u7684 master_repl_offset \u548c slave_repl_offset \u6765\u5224\u65ad\u662f\u9700\u8981\u5168\u91cf\u540c\u6b65\u8fd8\u662f\u628a\u4e24\u8005\u4e4b\u95f4\u7684\u547d\u4ee4\u589e\u91cf\u540c\u6b65\u7ed9\u4ece\u5e93\uff08\u540c\u6b65\u7684\u65b9\u5f0f\u5c31\u662f\u901a\u8fc7\u4e3b\u5e93\u4e0e\u6bcf\u4e2a\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5\u4e4b\u540e\u7684\u8fd9\u4e2a\u6240\u8c13\u7684 replication buffer \uff09 repl_backlog_buffer \u662f\u4e00\u4e2a\u73af\u5f62\u7f13\u51b2\u533a\uff0c\u4e3b\u5e93\u4f1a\u8bb0\u5f55\u81ea\u5df1\u5199\u5230\u7684\u4f4d\u7f6e\uff0c\u4ece\u5e93\u5219\u4f1a\u8bb0\u5f55\u81ea\u5df1\u5df2\u7ecf\u8bfb\u5230\u7684\u4f4d\u7f6e\u3002","title":"3-1 \u589e\u91cf\u590d\u5236"},{"location":"chap2/6redis_master_slave_replicate/#3-2","text":"\u521a\u5f00\u59cb\u7684\u65f6\u5019\uff0c\u4e3b\u5e93\u548c\u4ece\u5e93\u7684\u5199\u8bfb\u4f4d\u7f6e\u5728\u4e00\u8d77\uff0c\u8fd9\u7b97\u662f\u5b83\u4eec\u7684\u8d77\u59cb\u4f4d\u7f6e \u968f\u7740\u4e3b\u5e93\u4e0d\u65ad\u63a5\u6536\u65b0\u7684\u5199\u64cd\u4f5c\uff0c\u5b83\u5728\u7f13\u51b2\u533a\u4e2d\u7684\u5199\u4f4d\u7f6e\u4f1a\u9010\u6b65\u504f\u79bb\u8d77\u59cb\u4f4d\u7f6e \uff0c\u6211\u4eec\u901a\u5e38\u7528\u504f\u79fb\u91cf\u6765\u8861\u91cf\u8fd9\u4e2a\u504f\u79fb\u8ddd\u79bb\u7684\u5927\u5c0f \u5bf9\u4e3b\u5e93\u6765\u8bf4\uff0c\u5bf9\u5e94\u7684\u504f\u79fb\u91cf\u5c31\u662f master_repl_offset \u4e3b\u5e93\u63a5\u6536\u7684\u65b0\u5199\u64cd\u4f5c\u8d8a\u591a\uff0c\u8fd9\u4e2a\u503c\u5c31\u4f1a\u8d8a\u5927\u3002","title":"3-2 \u4e3b\u5e93\u504f\u79fb"},{"location":"chap2/6redis_master_slave_replicate/#3-3","text":"\u4ece\u5e93\u5728\u590d\u5236\u5b8c\u5199\u64cd\u4f5c\u547d\u4ee4\u540e\uff0c\u5b83\u5728\u7f13\u51b2\u533a\u4e2d\u7684\u8bfb\u4f4d\u7f6e\u4e5f\u5f00\u59cb\u9010\u6b65\u504f\u79fb\u521a\u624d\u7684\u8d77\u59cb\u4f4d\u7f6e\uff0c\u6b64\u65f6\uff0c\u4ece\u5e93\u5df2\u590d\u5236\u7684\u504f\u79fb\u91cf slave_repl_offset \u4e5f\u5728\u4e0d\u65ad\u589e\u52a0\u3002 \u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e24\u4e2a\u504f\u79fb\u91cf\u57fa\u672c\u76f8\u7b49\u3002 \u4e3b\u4ece\u5e93\u7684\u8fde\u63a5\u6062\u590d\u4e4b\u540e\uff0c\u4ece\u5e93\u9996\u5148\u4f1a\u7ed9\u4e3b\u5e93\u53d1\u9001 psync \u547d\u4ee4\uff0c\u5e76\u628a\u81ea\u5df1\u5f53\u524d\u7684 slave_repl_offset \u53d1\u7ed9\u4e3b\u5e93\uff0c \u4e3b\u5e93\u4f1a\u5224\u65ad\u81ea\u5df1\u7684 master_repl_offset \u548c slave_repl_offset \u4e4b\u95f4\u7684\u5dee\u8ddd\u3002 \u5728\u7f51\u7edc\u65ad\u8fde\u9636\u6bb5\uff0c\u4e3b\u5e93\u53ef\u80fd\u4f1a\u6536\u5230\u65b0\u7684\u5199\u64cd\u4f5c\u547d\u4ee4 \uff0c\u6240\u4ee5\uff0c \u4e00\u822c\u6765\u8bf4\uff0c master_repl_offset \u4f1a\u5927\u4e8e slave_repl_offset \u3002 \u6b64\u65f6\uff0c\u4e3b\u5e93\u53ea\u7528\u628a master_repl_offset \u548c slave_repl_offset \u4e4b\u95f4\u7684\u547d\u4ee4\u64cd\u4f5c\u540c\u6b65\u7ed9\u4ece\u5e93\u5c31\u884c\u3002 \u4e3b\u5e93\u548c\u4ece\u5e93\u4e4b\u95f4\u76f8\u5dee\u4e86 put d e \u548c put d f \u4e24\u4e2a\u64cd\u4f5c\uff0c\u5728\u589e\u91cf\u590d\u5236\u65f6\uff0c\u4e3b\u5e93\u53ea\u9700\u8981\u628a\u5b83\u4eec\u540c\u6b65\u7ed9\u4ece\u5e93\uff0c\u5c31\u884c\u4e86","title":"3-3 \u4ece\u5e93\u504f\u79fb"},{"location":"chap2/6redis_master_slave_replicate/#3-4-repl_backlog_size","text":"\u56e0\u4e3a repl_backlog_buffer \u662f\u4e00\u4e2a\u73af\u5f62\u7f13\u51b2\u533a\uff0c\u6240\u4ee5\u5728\u7f13\u51b2\u533a\u5199\u6ee1\u540e\uff0c\u4e3b\u5e93\u4f1a\u7ee7\u7eed\u5199\u5165\uff0c\u6b64\u65f6\uff0c\u5c31\u4f1a\u8986\u76d6\u6389\u4e4b\u524d\u5199\u5165\u7684\u64cd\u4f5c\u3002 \u5982\u679c\u4ece\u5e93\u7684\u8bfb\u53d6\u901f\u5ea6\u6bd4\u8f83\u6162\uff0c\u5c31\u6709\u53ef\u80fd\u5bfc\u81f4\u4ece\u5e93\u8fd8\u672a\u8bfb\u53d6\u7684\u64cd\u4f5c\u88ab\u4e3b\u5e93\u65b0\u5199\u7684\u64cd\u4f5c\u8986\u76d6\u4e86\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u4e3b\u4ece\u5e93\u95f4\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u3002 \u907f\u514d\u8fd9\u4e00\u60c5\u51b5 \u4e00\u822c\u800c\u8a00\uff0c\u6211\u4eec\u53ef\u4ee5\u8c03\u6574 repl_backlog_size \u8fd9\u4e2a\u53c2\u6570 \u3002\u8fd9\u4e2a\u53c2\u6570\u548c\u6240\u9700\u7684\u7f13\u51b2\u7a7a\u95f4\u5927\u5c0f\u6709\u5173\u3002\u7f13\u51b2\u7a7a\u95f4\u7684\u8ba1\u7b97\u516c\u5f0f\u662f\uff1a \u7f13\u51b2\u7a7a\u95f4\u5927\u5c0f = \u4e3b\u5e93\u5199\u5165\u547d\u4ee4\u901f\u5ea6 * \u64cd\u4f5c\u5927\u5c0f - \u4e3b\u4ece\u5e93\u95f4\u7f51\u7edc\u4f20\u8f93\u547d\u4ee4\u901f\u5ea6 * \u64cd\u4f5c\u5927\u5c0f \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u8003\u8651\u5230\u53ef\u80fd\u5b58\u5728\u4e00\u4e9b\u7a81\u53d1\u7684\u8bf7\u6c42\u538b\u529b\uff0c \u6211\u4eec\u901a\u5e38\u9700\u8981\u628a\u8fd9\u4e2a\u7f13\u51b2\u7a7a\u95f4\u6269\u5927\u4e00\u500d \u5373 repl_backlog_size = \u7f13\u51b2\u7a7a\u95f4\u5927\u5c0f * 2 \uff0c\u8fd9\u4e5f\u5c31\u662f repl_backlog_size \u7684\u6700\u7ec8\u503c\u3002 \u4e3e\u4e2a\u6817\u5b50\ud83c\udf30 \u5982\u679c\u4e3b\u5e93\u6bcf\u79d2\u5199\u5165 2000 \u4e2a\u64cd\u4f5c\uff0c\u6bcf\u4e2a\u64cd\u4f5c\u7684\u5927\u5c0f\u4e3a 2KB \u7f51\u7edc\u6bcf\u79d2\u80fd\u4f20\u8f93 1000 \u4e2a\u64cd\u4f5c\uff0c\u90a3\u4e48\uff0c\u6709 1000 \u4e2a\u64cd\u4f5c\u9700\u8981\u7f13\u51b2\u8d77\u6765\uff0c\u8fd9\u5c31\u81f3\u5c11\u9700\u8981 2MB \u7684\u7f13\u51b2\u7a7a\u95f4\u3002 \u5426\u5219\uff0c\u65b0\u5199\u7684\u547d\u4ee4\u5c31\u4f1a\u8986\u76d6\u6389\u65e7\u64cd\u4f5c\u4e86\u3002\u4e3a\u4e86\u5e94\u5bf9\u53ef\u80fd\u7684\u7a81\u53d1\u538b\u529b\uff0c\u6211\u4eec\u6700\u7ec8\u628a repl_backlog_size \u8bbe\u4e3a 4MB \u3002 \u589e\u91cf\u590d\u5236\u65f6\u4e3b\u4ece\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u98ce\u9669\u5c31\u964d\u4f4e\u4e86\u3002\u4e0d\u8fc7\uff0c\u5982\u679c\u5e76\u53d1\u8bf7\u6c42\u91cf\u975e\u5e38\u5927\uff0c \u8fde\u4e24\u500d\u7684\u7f13\u51b2\u7a7a\u95f4\u90fd\u5b58\u4e0d\u4e0b\u65b0\u64cd\u4f5c\u8bf7\u6c42\u7684\u8bdd\uff0c\u6b64\u65f6\uff0c\u4e3b\u4ece\u5e93\u6570\u636e\u4ecd\u7136\u53ef\u80fd\u4e0d\u4e00\u81f4\u3002 \u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0c \u4e00\u65b9\u9762\uff0c\u4f60\u53ef\u4ee5\u6839\u636e Redis \u6240\u5728\u670d\u52a1\u5668\u7684\u5185\u5b58\u8d44\u6e90\u518d\u9002\u5f53\u589e\u52a0 repl_backlog_size \u503c\uff0c\u6bd4\u5982\u8bf4\u8bbe\u7f6e\u6210\u7f13\u51b2\u7a7a\u95f4\u5927\u5c0f\u7684 4 \u500d\uff0c \u53e6\u4e00\u65b9\u9762\uff0c\u4f60\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u5207\u7247\u96c6\u7fa4\u6765\u5206\u62c5\u5355\u4e2a\u4e3b\u5e93\u7684\u8bf7\u6c42\u538b\u529b\u3002","title":"3-4 repl_backlog_size"},{"location":"chap2/6redis_master_slave_replicate/#4","text":"Redis \u7684\u4e3b\u4ece\u5e93\u540c\u6b65\u7684\u57fa\u672c\u539f\u7406\uff0c\u603b\u7ed3\u6765\u8bf4\uff0c\u6709\u4e09\u79cd\u6a21\u5f0f\uff1a \u5168\u91cf\u590d\u5236\u3001\u57fa\u4e8e\u957f\u8fde\u63a5\u7684\u547d\u4ee4\u4f20\u64ad\uff0c\u4ee5\u53ca\u589e\u91cf\u590d\u5236 \u5168\u91cf\u590d\u5236\u867d\u7136\u8017\u65f6\uff0c\u4f46\u662f\u5bf9\u4e8e\u4ece\u5e93\u6765\u8bf4\uff0c\u5982\u679c\u662f\u7b2c\u4e00\u6b21\u540c\u6b65\uff0c\u5168\u91cf\u590d\u5236\u662f\u65e0\u6cd5\u907f\u514d\u7684 \u4e00\u4e2a Redis \u5b9e\u4f8b\u7684\u6570\u636e\u5e93\u4e0d\u8981\u592a\u5927\uff0c\u4e00\u4e2a\u5b9e\u4f8b\u5927\u5c0f\u5728\u51e0 GB \u7ea7\u522b\u6bd4\u8f83\u5408\u9002\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11 RDB \u6587\u4ef6\u751f\u6210\u3001\u4f20\u8f93\u548c\u91cd\u65b0\u52a0\u8f7d\u7684\u5f00\u9500 \u4e3a\u4e86\u907f\u514d\u591a\u4e2a\u4ece\u5e93\u540c\u65f6\u548c\u4e3b\u5e93\u8fdb\u884c\u5168\u91cf\u590d\u5236\uff0c\u7ed9\u4e3b\u5e93\u8fc7\u5927\u7684\u540c\u6b65\u538b\u529b\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u91c7\u7528\u201c\u4e3b - \u4ece - \u4ece\u201d\u8fd9\u4e00\u7ea7\u8054\u6a21\u5f0f\uff0c\u6765\u7f13\u89e3\u4e3b\u5e93\u7684\u538b\u529b\u3002 \u957f\u8fde\u63a5\u590d\u5236\u662f\u4e3b\u4ece\u5e93\u6b63\u5e38\u8fd0\u884c\u540e\u7684\u5e38\u89c4\u540c\u6b65\u9636\u6bb5\u3002\u5728\u8fd9\u4e2a\u9636\u6bb5\u4e2d\uff0c\u4e3b\u4ece\u5e93\u4e4b\u95f4\u901a\u8fc7\u547d\u4ee4\u4f20\u64ad\u5b9e\u73b0\u540c\u6b65\u3002 \u671f\u95f4\u5982\u679c\u9047\u5230\u4e86\u7f51\u7edc\u65ad\u8fde\uff0c\u589e\u91cf\u590d\u5236\u5c31\u6d3e\u4e0a\u7528\u573a\u4e86\u3002 \u7559\u610f\u4e00\u4e0b repl_backlog_size \u8fd9\u4e2a\u914d\u7f6e\u53c2\u6570\u3002 \u5982\u679c\u5b83\u914d\u7f6e\u5f97\u8fc7\u5c0f\uff0c\u5728\u589e\u91cf\u590d\u5236\u9636\u6bb5\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4ece\u5e93\u7684\u590d\u5236\u8fdb\u5ea6\u8d76\u4e0d\u4e0a\u4e3b\u5e93\uff0c\u8fdb\u800c\u5bfc\u81f4\u4ece\u5e93\u91cd\u65b0\u8fdb\u884c\u5168\u91cf\u590d\u5236 \u3002 \u6240\u4ee5\uff0c\u901a\u8fc7\u8c03\u5927\u8fd9\u4e2a\u53c2\u6570\uff0c\u53ef\u4ee5\u51cf\u5c11\u4ece\u5e93\u5728\u7f51\u7edc\u65ad\u8fde\u65f6\u5168\u91cf\u590d\u5236\u7684\u98ce\u9669\u3002","title":"4\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap2/6redis_master_slave_replicate/#4-1","text":"Redis\u91c7\u7528\u8bfb\u5199\u5206\u79bb\u7684\u597d\u5904\uff1a\u907f\u514d\u4e86\u52a0\u9501\uff0c\u5b9e\u4f8b\u95f4\u534f\u5546\u662f\u5426\u5b8c\u6210\u4fee\u6539\u7b49\u590d\u6742\u64cd\u4f5c \u5168\u91cf\u540c\u6b65\u7684\u53d1\u751f\u65f6\u673a\uff1a\u9996\u6b21\u4e0a\u7ebf \u548c \u4ece\u5e93\u7684\u73af\u5f62\u7f13\u51b2\u533a\u4f4d\u7f6e\u6807\u8bc6\u88ab\u8986\u76d6 \u589e\u91cf\u540c\u6b65\u4fdd\u969c\u673a\u5236\u4f9d\u8d56\u4e8e\u4e00\u4e2a\u7279\u6b8a\u7684\u6570\u636e\u7ed3\u6784\uff1a\u73af\u5f62\u7f13\u51b2\u533a \u9996\u6b21\u540c\u6b65\u5206\u4e3a\u4e09\u4e2a\u9636\u6bb5\uff0c\u2460\uff1a\u5efa\u7acb\u8fde\u63a5\uff0c\u2461\uff1a\u540c\u6b65RDB\u6587\u4ef6\uff0c\u2462\uff1a\u540c\u6b65\u589e\u91cf\u6570\u636e \u5168\u91cf\u540c\u6b65\u9700\u8981\u4e3b\u673afork\u5b50\u8fdb\u7a0b\uff0c\u4ea7\u751f\u5168\u91cfRDB\u6587\u4ef6\uff0c\u5e76\u53d1\u9001\uff0c\u4e3a\u4e86\u51cf\u8f7b\u4e3b\u673a\u7684\u538b\u529b\uff0c\u4ece\u673a\u4e4b\u95f4\u4e5f\u53ef\u7528\u4e92\u76f8\u540c\u6b65 \u589e\u91cf\u540c\u6b65\u53ef\u4ee5\u7f13\u89e3\u4e3b\u673a\u5168\u91cf\u540c\u6b65\u7684\u538b\u529b\uff0c\u5b83\u9700\u8981\u7279\u6b8a\u673a\u5236\u4fdd\u969c\uff1a replication buffer \uff0c\u73af\u5f62\u7f13\u51b2\u533a\uff0c master_repl_offset \uff0c slave_repl_offset \u4ece\u673a\u7684\u540c\u6b65\u4f4d\u7f6e\u6807\u8bc6\uff0c\u5728\u73af\u5f62\u7f13\u51b2\u533a\u88ab\u8986\u76d6\u540e\uff0c\u4f1a\u89e6\u53d1\u65b0\u7684\u4e00\u8f6e\u5168\u91cf\u540c\u6b65\uff0c\u6240 repl_backlog_buffer \u7684\u5927\u5c0f\u662fredis\u91cd\u8981\u7684\u8c03\u4f18\u53c2\u6570 \u4e3b\u4ece\u540c\u6b65\u6709\u4e09\u79cd\u673a\u5236\uff1a\u5168\u91cf\u540c\u6b65\uff0c\u57fa\u4e8e\u957f\u94fe\u63a5\u7684\u547d\u4ee4\u4f20\u64ad\uff0c\u589e\u91cf\u540c\u6b65","title":"4-1 \u672c\u8282\u4eae\u70b9"},{"location":"chap2/6redis_master_slave_replicate/#4-2","text":"\u4e3b\u4ece\u5e93\u95f4\u7684\u6570\u636e\u590d\u5236\u540c\u6b65\u4f7f\u7528\u7684\u662f RDB \u6587\u4ef6\uff0c\u524d\u9762\u6211\u4eec\u5b66\u4e60\u8fc7\uff0cAOF \u8bb0\u5f55\u7684\u64cd\u4f5c\u547d\u4ee4\u66f4\u5168\uff0c\u76f8\u6bd4\u4e8e RDB \u4e22\u5931\u7684\u6570\u636e\u66f4\u5c11\u3002\u90a3\u4e48\uff0c\u4e3a\u4ec0\u4e48\u4e3b\u4ece\u5e93\u95f4\u7684\u590d\u5236\u4e0d\u4f7f\u7528 AOF \u5462\uff1f RDB\u8bfb\u53d6\u5feb\uff0c\u8fd9\u6837\u4ece\u5e93\u53ef\u4ee5\u5c3d\u5feb\u5b8c\u6210RDB\u7684\u8bfb\u53d6\uff0c\u7136\u540e\u5165\u53bb\u6d88\u8d39replication buffer\u7684\u6570\u636e\u3002\u5982\u679c\u662fAOF\u7684\u8bdd\uff0cA OF\u4f53\u79ef\u5927\uff0c\u8bfb\u53d6\u6162\uff0c\u9700\u8981\u66f4\u5927\u7684replication buffer\uff0c\u5982\u679c\u4e00\u4e2a\u4e3b\u8282\u70b9\u7684\u4ece\u8282\u70b9\u591a\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u66f4\u5927\u7684\u5185\u5b58\u53bb\u5904\u7406\uff1b AOF\u6587\u4ef6\u662fappend\u8ffd\u52a0\u6a21\u5f0f\uff0c\u540c\u65f6\u8bfb\u5199\u9700\u8981\u8003\u8651\u5e76\u53d1\u5b89\u5168\u95ee\u9898\uff0c\u5e76\u4e14AOF\u662f\u6587\u672c\u6587\u4ef6\uff0c\u4f53\u79ef\u8f83\u5927\uff0c\u6d6a\u8d39\u7f51\u7edc\u5e26\u5bbd\u3002","title":"4-2 \u6bcf\u8282\u4e00\u95ee"},{"location":"chap2/7redis_master_rescue/","text":"\u7b2c\u4e03\u8282 \u54e8\u5175\u673a\u5236\uff1a\u4e3b\u5e93\u4e0d\u95f4\u65ad\u670d\u52a1 \u4e3b\u4ece\u5e93\u96c6\u7fa4\u6a21\u5f0f\u4e0b\uff0c\u5982\u679c\u4ece\u5e93\u53d1\u751f\u6545\u969c\u4e86\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u7ee7\u7eed\u5411\u4e3b\u5e93\u6216\u5176\u4ed6\u4ece\u5e93\u53d1\u9001\u8bf7\u6c42\uff0c\u8fdb\u884c\u76f8\u5173\u7684\u64cd\u4f5c\uff0c\u4f46\u662f\u5982\u679c\u4e3b\u5e93\u53d1\u751f\u6545\u969c\u4e86\uff0c\u90a3\u5c31\u76f4\u63a5\u4f1a\u5f71\u54cd\u5230\u4ece\u5e93\u7684\u540c\u6b65\uff0c\u56e0\u4e3a\u4ece\u5e93\u6ca1\u6709\u76f8\u5e94\u7684\u4e3b\u5e93\u53ef\u4ee5\u8fdb\u884c\u6570\u636e\u590d\u5236\u64cd\u4f5c\u4e86\u3002 \u5982\u679c\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u90fd\u662f\u8bfb\u64cd\u4f5c\u8bf7\u6c42\uff0c\u90a3\u8fd8\u53ef\u4ee5\u7531\u4ece\u5e93\u7ee7\u7eed\u63d0\u4f9b\u670d\u52a1\uff0c\u8fd9\u5728\u7eaf\u8bfb\u7684\u4e1a\u52a1\u573a\u666f\u4e0b\u8fd8\u80fd\u88ab\u63a5\u53d7 \u4e00\u65e6\u6709\u5199\u64cd\u4f5c\u8bf7\u6c42\u4e86\uff0c\u6309\u7167\u4e3b\u4ece\u5e93\u6a21\u5f0f\u4e0b\u7684\u8bfb\u5199\u5206\u79bb\u8981\u6c42\uff0c\u9700\u8981\u7531\u4e3b\u5e93\u6765\u5b8c\u6210\u5199\u64cd\u4f5c \uff0c\u6b64\u65f6\uff0c\u4e5f\u6ca1\u6709\u5b9e\u4f8b\u53ef\u4ee5\u6765\u670d\u52a1\u5ba2\u6237\u7aef\u7684\u5199\u64cd\u4f5c\u8bf7\u6c42\u4e86 \u65e0\u8bba\u662f\u5199\u670d\u52a1\u4e2d\u65ad\uff0c\u8fd8\u662f\u4ece\u5e93\u65e0\u6cd5\u8fdb\u884c\u6570\u636e\u540c\u6b65\uff0c\u90fd\u662f\u4e0d\u80fd\u63a5\u53d7\u7684\u3002 \u5982\u679c\u4e3b\u5e93\u6302\u4e86\uff0c\u6211\u4eec\u5c31\u9700\u8981\u8fd0\u884c\u4e00\u4e2a\u65b0\u4e3b\u5e93\uff0c\u6bd4\u5982\u8bf4\u628a\u4e00\u4e2a\u4ece\u5e93\u5207\u6362\u4e3a\u4e3b\u5e93\uff0c\u628a\u5b83\u5f53\u6210\u4e3b\u5e93 \u4e3b\u5e93\u771f\u7684\u6302\u4e86\u5417\uff1f \u8be5\u9009\u62e9\u54ea\u4e2a\u4ece\u5e93\u4f5c\u4e3a\u4e3b\u5e93\uff1f \u600e\u4e48\u628a\u65b0\u4e3b\u5e93\u7684\u76f8\u5173\u4fe1\u606f\u901a\u77e5\u7ed9\u4ece\u5e93\u548c\u5ba2\u6237\u7aef\u5462\uff1f \u8fd9\u5c31\u8981\u63d0\u5230\u54e8\u5175\u673a\u5236\u4e86\u3002\u5728 Redis \u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c \u54e8\u5175\u673a\u5236\u662f\u5b9e\u73b0\u4e3b\u4ece\u5e93\u81ea\u52a8\u5207\u6362\u7684\u5173\u952e\u673a\u5236 \uff0c\u5b83\u6709\u6548\u5730\u89e3\u51b3\u4e86\u4e3b\u4ece\u590d\u5236\u6a21\u5f0f\u4e0b\u6545\u969c\u8f6c\u79fb\u7684\u8fd9\u4e09\u4e2a\u95ee\u9898\u3002 1\u3001\u54e8\u5175\u673a\u5236\u7684\u57fa\u672c\u6d41\u7a0b \u54e8\u5175\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u8fd0\u884c\u5728\u7279\u6b8a\u6a21\u5f0f\u4e0b\u7684 Redis \u8fdb\u7a0b\uff0c\u4e3b\u4ece\u5e93\u5b9e\u4f8b\u8fd0\u884c\u7684\u540c\u65f6\uff0c\u5b83\u4e5f\u5728\u8fd0\u884c\u3002\u54e8\u5175\u4e3b\u8981\u8d1f\u8d23\u7684\u5c31\u662f\u4e09\u4e2a\u4efb\u52a1\uff1a\u76d1\u63a7\u3001\u9009\u4e3b\uff08\u9009\u62e9\u4e3b\u5e93\uff09\u548c\u901a\u77e5\u3002 \u54e8\u5175\u7684\u4e3b\u8981\u804c\u8d23\uff1a \u76d1\u63a7\uff1a\u901a\u8fc7PING\u6765\u76d1\u63a7\u4e3b\u4ece \u9009\u4e3b\uff1a\u4e3b\u5e93\u6302\u4e86\uff0c\u4ece\u4ece\u5e93\u4e2d\u6309\u4e00\u5b9a\u7684\u673a\u5236\u9009\u62e9\u4e00\u4e2a\u65b0\u4e3b\u5e93 \u901a\u77e5\uff1a\u901a\u77e5\u5176\u4ed6\u4ece\u5e93\u548c\u5ba2\u6237\u7aef\u65b0\u7684\u4e3b\u5e93\u4fe1\u606f 1-1 \u76d1\u63a7 \u76d1\u63a7\u662f\u6307\u54e8\u5175\u8fdb\u7a0b\u5728\u8fd0\u884c\u65f6\uff0c\u5468\u671f\u6027\u5730\u7ed9\u6240\u6709\u7684\u4e3b\u4ece\u5e93\u53d1\u9001 PING \u547d\u4ee4\uff0c\u68c0\u6d4b\u5b83\u4eec\u662f\u5426\u4ecd\u7136\u5728\u7ebf\u8fd0\u884c\u3002 \u5982\u679c \u4ece\u5e93\u6ca1\u6709\u5728\u89c4\u5b9a\u65f6\u95f4\u5185\u54cd\u5e94\u54e8\u5175\u7684 PING \u547d\u4ee4 \uff0c\u54e8\u5175\u5c31\u4f1a\u628a\u5b83\u6807\u8bb0\u4e3a\u201c\u4e0b\u7ebf\u72b6\u6001\u201d\uff1b \u5982\u679c\u4e3b\u5e93\u4e5f\u6ca1\u6709\u5728\u89c4\u5b9a\u65f6\u95f4\u5185\u54cd\u5e94\u54e8\u5175\u7684 PING \u547d\u4ee4\uff0c\u54e8\u5175\u5c31\u4f1a\u5224\u5b9a\u4e3b\u5e93\u4e0b\u7ebf\uff0c\u7136\u540e\u5f00\u59cb \u81ea\u52a8\u5207\u6362\u4e3b\u5e93\u7684\u6d41\u7a0b \u3002 \u8fd9\u4e2a\u6d41\u7a0b\u9996\u5148\u662f\u6267\u884c\u54e8\u5175\u7684\u7b2c\u4e8c\u4e2a\u4efb\u52a1\uff0c\u9009\u4e3b 1-2 \u9009\u4e3b \u4e3b\u5e93\u6302\u4e86\u4ee5\u540e\uff0c\u54e8\u5175\u5c31\u9700\u8981\u4ece\u5f88\u591a\u4e2a\u4ece\u5e93\u91cc\uff0c\u6309\u7167\u4e00\u5b9a\u7684\u89c4\u5219\u9009\u62e9\u4e00\u4e2a\u4ece\u5e93\u5b9e\u4f8b\uff0c\u628a\u5b83\u4f5c\u4e3a\u65b0\u7684\u4e3b\u5e93\u3002 \u8fd9\u4e00\u6b65\u5b8c\u6210\u540e\uff0c\u73b0\u5728\u7684\u96c6\u7fa4\u91cc\u5c31\u6709\u4e86\u65b0\u4e3b\u5e93\u3002 1-3 \u901a\u77e5 \u5728\u6267\u884c\u901a\u77e5\u4efb\u52a1\u65f6\uff0c\u54e8\u5175\u4f1a\u628a\u65b0\u4e3b\u5e93\u7684\u8fde\u63a5\u4fe1\u606f\u53d1\u7ed9\u5176\u4ed6\u4ece\u5e93\uff0c\u8ba9\u5b83\u4eec\u6267\u884c replicaof \u547d\u4ee4\uff0c\u548c\u65b0\u4e3b\u5e93\u5efa\u7acb\u8fde\u63a5\uff0c\u5e76\u8fdb\u884c\u6570\u636e\u590d\u5236 \u540c\u65f6\uff0c\u54e8\u5175\u4f1a\u628a\u65b0\u4e3b\u5e93\u7684\u8fde\u63a5\u4fe1\u606f\u901a\u77e5\u7ed9\u5ba2\u6237\u7aef\uff0c\u8ba9\u5b83\u4eec\u628a\u8bf7\u6c42\u64cd\u4f5c\u53d1\u5230\u65b0\u4e3b\u5e93\u4e0a \u3002 \u901a\u77e5\u4efb\u52a1\u76f8\u5bf9\u6765\u8bf4\u6bd4\u8f83\u7b80\u5355\uff0c\u54e8\u5175\u53ea\u9700\u8981\u628a\u65b0\u4e3b\u5e93\u4fe1\u606f\u53d1\u7ed9\u4ece\u5e93\u548c\u5ba2\u6237\u7aef\uff0c\u8ba9\u5b83\u4eec\u548c\u65b0\u4e3b\u5e93\u5efa\u7acb\u8fde\u63a5\u5c31\u884c\uff0c\u5e76\u4e0d\u6d89\u53ca\u51b3\u7b56\u7684\u903b\u8f91\u3002 \u4f46\u662f\uff0c\u5728\u76d1\u63a7\u548c\u9009\u4e3b\u8fd9\u4e24\u4e2a\u4efb\u52a1\u4e2d\uff0c\u54e8\u5175\u9700\u8981\u505a\u51fa\u4e24\u4e2a\u51b3\u7b56\uff1a \u5728\u76d1\u63a7\u4efb\u52a1\u4e2d\uff0c\u54e8\u5175\u9700\u8981\u5224\u65ad\u4e3b\u5e93\u662f\u5426\u5904\u4e8e\u4e0b\u7ebf\u72b6\u6001\uff1b \u5728\u9009\u4e3b\u4efb\u52a1\u4e2d\uff0c\u54e8\u5175\u4e5f\u8981\u51b3\u5b9a\u9009\u62e9\u54ea\u4e2a\u4ece\u5e93\u5b9e\u4f8b\u4f5c\u4e3a\u4e3b\u5e93\u3002 \u54e8\u5175\u5bf9\u4e3b\u5e93\u7684\u4e0b\u7ebf\u5224\u65ad\u6709\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u548c\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u4e24\u79cd 2\u3001\u4e3b\u89c2\u4e0b\u7ebf\u548c\u5ba2\u89c2\u4e0b\u7ebf 2-1 \u4e3b\u89c2\u4e0b\u7ebf \u54e8\u5175\u8fdb\u7a0b\u4f1a\u4f7f\u7528 PING \u547d\u4ee4\u68c0\u6d4b\u5b83\u81ea\u5df1\u548c\u4e3b\u3001\u4ece\u5e93\u7684\u7f51\u7edc\u8fde\u63a5\u60c5\u51b5\uff0c\u7528\u6765\u5224\u65ad\u5b9e\u4f8b\u7684\u72b6\u6001\u3002 \u5982\u679c\u54e8\u5175\u53d1\u73b0\u4e3b\u5e93\u6216\u4ece\u5e93\u5bf9 PING \u547d\u4ee4\u7684\u54cd\u5e94\u8d85\u65f6\u4e86\uff0c\u90a3\u4e48\uff0c\u54e8\u5175\u5c31\u4f1a\u5148\u628a\u5b83\u6807\u8bb0\u4e3a\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d \u54e8\u5175\u8fdb\u7a0b\u4f1a\u4f7f\u7528 PING \u547d\u4ee4\u68c0\u6d4b\u5b83\u81ea\u5df1\u548c\u4e3b\u3001\u4ece\u5e93\u7684\u7f51\u7edc\u8fde\u63a5\u60c5\u51b5\uff0c\u7528\u6765\u5224\u65ad\u5b9e\u4f8b\u7684\u72b6\u6001\u3002 \u679c\u54e8\u5175\u53d1\u73b0\u4e3b\u5e93\u6216\u4ece\u5e93\u5bf9 PING \u547d\u4ee4\u7684\u54cd\u5e94\u8d85\u65f6\u4e86\uff0c\u90a3\u4e48 \uff0c\u54e8\u5175\u5c31\u4f1a\u5148\u628a\u5b83\u6807\u8bb0\u4e3a\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d \u3002 \u5982\u679c\u68c0\u6d4b\u7684\u662f\u4ece\u5e93\uff0c\u90a3\u4e48\uff0c\u54e8\u5175\u7b80\u5355\u5730\u628a\u5b83\u6807\u8bb0\u4e3a\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u5c31\u884c\u4e86\uff0c\u56e0\u4e3a\u4ece\u5e93\u7684\u4e0b\u7ebf\u5f71\u54cd\u4e00\u822c\u4e0d\u592a\u5927\uff0c\u96c6\u7fa4\u7684\u5bf9\u5916\u670d\u52a1\u4e0d\u4f1a\u95f4\u65ad\u3002 \u5982\u679c\u68c0\u6d4b\u7684\u662f\u4e3b\u5e93\uff0c\u90a3\u4e48\uff0c\u54e8\u5175\u8fd8\u4e0d\u80fd\u7b80\u5355\u5730\u628a\u5b83\u6807\u8bb0\u4e3a\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\uff0c\u5f00\u542f\u4e3b\u4ece\u5207\u6362\u3002 \u56e0\u4e3a\u5f88\u6709\u53ef\u80fd\u5b58\u5728\u8fd9\u4e48\u4e00\u4e2a\u60c5\u51b5\uff1a\u90a3\u5c31\u662f\u54e8\u5175\u8bef\u5224\u4e86\uff0c\u5176\u5b9e\u4e3b\u5e93\u5e76\u6ca1\u6709\u6545\u969c\u3002 \u4e00\u65e6\u542f\u52a8\u4e86\u4e3b\u4ece\u5207\u6362\uff0c\u540e\u7eed\u7684\u9009\u4e3b\u548c\u901a\u77e5\u64cd\u4f5c\u90fd\u4f1a\u5e26\u6765\u989d\u5916\u7684\u8ba1\u7b97\u548c\u901a\u4fe1\u5f00\u9500\u3002 \u9996\u5148\uff0c\u6211\u4eec\u8981\u77e5\u9053\u5565\u53eb\u8bef\u5224\u3002\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u4e3b\u5e93\u5b9e\u9645\u5e76\u6ca1\u6709\u4e0b\u7ebf\uff0c\u4f46\u662f\u54e8\u5175\u8bef\u4ee5\u4e3a\u5b83\u4e0b\u7ebf\u4e86\u3002 \u8bef\u5224\u4e00\u822c\u4f1a\u53d1\u751f\u5728\u96c6\u7fa4\u7f51\u7edc\u538b\u529b\u8f83\u5927\u3001\u7f51\u7edc\u62e5\u585e\uff0c\u6216\u8005\u662f\u4e3b\u5e93\u672c\u8eab\u538b\u529b\u8f83\u5927\u7684\u60c5\u51b5\u4e0b \u3002 \u4e00\u65e6\u54e8\u5175\u5224\u65ad\u4e3b\u5e93\u4e0b\u7ebf\u4e86\uff0c\u5c31\u4f1a\u5f00\u59cb\u9009\u62e9\u65b0\u4e3b\u5e93\uff0c\u5e76\u8ba9\u4ece\u5e93\u548c\u65b0\u4e3b\u5e93\u8fdb\u884c\u6570\u636e\u540c\u6b65\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u672c\u8eab\u5c31\u4f1a\u6709\u5f00\u9500\uff0c\u4f8b\u5982\uff0c\u54e8\u5175\u8981\u82b1\u65f6\u95f4\u9009\u51fa\u65b0\u4e3b\u5e93\uff0c\u4ece\u5e93\u4e5f\u9700\u8981\u82b1\u65f6\u95f4\u548c\u65b0\u4e3b\u5e93\u540c\u6b65\u3002 \u90a3\u600e\u4e48\u51cf\u5c11\u8bef\u5224\u5462\uff1f 2-2 \u54e8\u5175\u96c6\u7fa4 \u54e8\u5175\u673a\u5236\u901a\u5e38\u4f1a\u91c7\u7528\u591a\u5b9e\u4f8b\u7ec4\u6210\u7684\u96c6\u7fa4\u6a21\u5f0f\u8fdb\u884c\u90e8\u7f72\uff0c\u8fd9\u4e5f\u88ab\u79f0\u4e3a\u54e8\u5175\u96c6\u7fa4\u3002 \u5f15\u5165\u591a\u4e2a\u54e8\u5175\u5b9e\u4f8b\u4e00\u8d77\u6765\u5224\u65ad\uff0c\u5c31\u53ef\u4ee5\u907f\u514d\u5355\u4e2a\u54e8\u5175\u56e0\u4e3a\u81ea\u8eab\u7f51\u7edc\u72b6\u51b5\u4e0d\u597d\uff0c\u800c\u8bef\u5224\u4e3b\u5e93\u4e0b\u7ebf\u7684\u60c5\u51b5\u3002 \u540c\u65f6\uff0c\u591a\u4e2a\u54e8\u5175\u7684\u7f51\u7edc\u540c\u65f6\u4e0d\u7a33\u5b9a\u7684\u6982\u7387\u8f83\u5c0f\uff0c\u7531\u5b83\u4eec\u4e00\u8d77\u505a\u51b3\u7b56\uff0c\u8bef\u5224\u7387\u4e5f\u80fd\u964d\u4f4e\u3002 2-3 \u5ba2\u89c2\u4e0b\u7ebf \u5728\u5224\u65ad\u4e3b\u5e93\u662f\u5426\u4e0b\u7ebf\u65f6\uff0c\u4e0d\u80fd\u7531\u4e00\u4e2a\u54e8\u5175\u8bf4\u4e86\u7b97\uff0c\u53ea\u6709\u5927\u591a\u6570\u7684\u54e8\u5175\u5b9e\u4f8b\uff0c\u90fd\u5224\u65ad\u4e3b\u5e93\u5df2\u7ecf\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u4e86\uff0c\u4e3b\u5e93\u624d\u4f1a\u88ab\u6807\u8bb0\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d \uff0c\u8fd9\u4e2a\u53eb\u6cd5\u4e5f\u662f\u8868\u660e\u4e3b\u5e93\u4e0b\u7ebf\u6210\u4e3a\u4e00\u4e2a\u5ba2\u89c2\u4e8b\u5b9e\u4e86 \u5224\u65ad\u539f\u5219\u5c31\u662f\uff1a\u5c11\u6570\u670d\u4ece\u591a\u6570\u3002\u540c\u65f6\uff0c\u8fd9\u4f1a\u8fdb\u4e00\u6b65\u89e6\u53d1\u54e8\u5175\u5f00\u59cb\u4e3b\u4ece\u5207\u6362\u6d41\u7a0b\u3002 Redis \u4e3b\u4ece\u96c6\u7fa4\u6709\u4e00\u4e2a\u4e3b\u5e93\u3001\u4e09\u4e2a\u4ece\u5e93\uff0c\u8fd8\u6709\u4e09\u4e2a\u54e8\u5175\u5b9e\u4f8b\u3002\u5728\u56fe\u7247\u7684\u5de6\u8fb9\uff0c\u54e8\u5175 2 \u5224\u65ad\u4e3b\u5e93\u4e3a\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\uff0c\u4f46\u54e8\u5175 1 \u548c 3 \u5374\u5224\u5b9a\u4e3b\u5e93\u662f\u4e0a\u7ebf\u72b6\u6001\uff0c\u6b64\u65f6\uff0c\u4e3b\u5e93\u4ecd\u7136\u88ab\u5224\u65ad\u4e3a\u5904\u4e8e\u4e0a\u7ebf\u72b6\u6001\u3002 \u54e8\u5175 1 \u548c 2 \u90fd\u5224\u65ad\u4e3b\u5e93\u4e3a\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\uff0c\u6b64\u65f6\uff0c\u5373\u4f7f\u54e8\u5175 3 \u4ecd\u7136\u5224\u65ad\u4e3b\u5e93\u4e3a\u4e0a\u7ebf\u72b6\u6001\uff0c\u4e3b\u5e93\u4e5f\u88ab\u6807\u8bb0\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u4e86\u3002 \u7b80\u5355\u6765\u8bf4\uff0c\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u7684\u6807\u51c6\u5c31\u662f\uff0c \u5f53\u6709 N \u4e2a\u54e8\u5175\u5b9e\u4f8b\u65f6\uff0c\u6700\u597d\u8981\u6709 N/2 + 1 \u4e2a\u5b9e\u4f8b\u5224\u65ad\u4e3b\u5e93\u4e3a\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\uff0c\u624d\u80fd\u6700\u7ec8\u5224\u5b9a\u4e3b\u5e93\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d \uff0c\u5c31\u53ef\u4ee5\u51cf\u5c11\u8bef\u5224\u7684\u6982\u7387\uff0c\u4e5f\u80fd\u907f\u514d\u8bef\u5224\u5e26\u6765\u7684\u65e0\u8c13\u7684\u4e3b\u4ece\u5e93\u5207\u6362\u3002\uff08\u5f53\u7136\uff0c\u6709\u591a\u5c11\u4e2a\u5b9e\u4f8b\u505a\u51fa\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u7684\u5224\u65ad\u624d\u53ef\u4ee5\uff0c\u53ef\u4ee5\u7531 Redis \u7ba1\u7406\u5458\u81ea\u884c\u8bbe\u5b9a\uff09\u3002 3\u3001\u5982\u4f55\u9009\u5b9a\u65b0\u4e3b\u5e93\uff1f \u54e8\u5175\u9009\u62e9\u65b0\u4e3b\u5e93\u7684\u8fc7\u7a0b\u79f0\u4e3a\u201c\u7b5b\u9009 + \u6253\u5206\u201d \u6211\u4eec\u5728\u591a\u4e2a\u4ece\u5e93\u4e2d\uff0c \u5148\u6309\u7167\u4e00\u5b9a\u7684\u7b5b\u9009\u6761\u4ef6 \uff0c\u628a\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4ece\u5e93\u53bb\u6389\u3002 \u7136\u540e\uff0c \u6211\u4eec\u518d\u6309\u7167\u4e00\u5b9a\u7684\u89c4\u5219 \uff0c\u7ed9\u5269\u4e0b\u7684\u4ece\u5e93\u9010\u4e2a\u6253\u5206\uff0c\u5c06\u5f97\u5206\u6700\u9ad8\u7684\u4ece\u5e93\u9009\u4e3a\u65b0\u4e3b\u5e93 3-1 \u7b5b\u9009 \u5728\u9009\u4e3b\u65f6\uff0c\u9664\u4e86\u8981\u68c0\u67e5\u4ece\u5e93\u7684\u5f53\u524d\u5728\u7ebf\u72b6\u6001\uff0c\u8fd8\u8981\u5224\u65ad\u5b83\u4e4b\u524d\u7684\u7f51\u7edc\u8fde\u63a5\u72b6\u6001\u3002 \u5982\u679c\u4ece\u5e93\u603b\u662f\u548c\u4e3b\u5e93\u65ad\u8fde\uff0c\u800c\u4e14\u65ad\u8fde\u6b21\u6570\u8d85\u51fa\u4e86\u4e00\u5b9a\u7684\u9608\u503c\uff0c\u6211\u4eec\u5c31\u6709\u7406\u7531\u76f8\u4fe1\uff0c\u8fd9\u4e2a\u4ece\u5e93\u7684\u7f51\u7edc\u72b6\u51b5\u5e76\u4e0d\u662f\u592a\u597d\uff0c\u5c31\u53ef\u4ee5\u628a\u8fd9\u4e2a\u4ece\u5e93\u7b5b\u6389\u4e86\u3002 \u5177\u4f53\u600e\u4e48\u5224\u65ad\u5462\uff1f\u4f60\u4f7f\u7528\u914d\u7f6e\u9879 down-after-milliseconds * 10 \u3002 \u5176\u4e2d\uff0c down-after-milliseconds \u662f\u6211\u4eec\u8ba4\u5b9a\u4e3b\u4ece\u5e93\u65ad\u8fde\u7684\u6700\u5927\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\u3002 \u5982\u679c\u5728 down-after-milliseconds \u6beb\u79d2\u5185\uff0c\u4e3b\u4ece\u8282\u70b9\u90fd\u6ca1\u6709\u901a\u8fc7\u7f51\u7edc\u8054\u7cfb\u4e0a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba4\u4e3a\u4e3b\u4ece\u8282\u70b9\u65ad\u8fde\u4e86\u3002 \u5982\u679c\u53d1\u751f\u65ad\u8fde\u7684\u6b21\u6570\u8d85\u8fc7\u4e86 10 \u6b21\uff0c\u5c31\u8bf4\u660e\u8fd9\u4e2a\u4ece\u5e93\u7684\u7f51\u7edc\u72b6\u51b5\u4e0d\u597d\uff0c\u4e0d\u9002\u5408\u4f5c\u4e3a\u65b0\u4e3b\u5e93\u3002 \u65b0\u5efa sentinal.conf \u6587\u4ef6\u8fdb\u884c\u914d\u7f6e\uff0c\u4e0d\u5728 redis.conf \u4e2d 3-2 \u6253\u5206 \u6211\u4eec\u53ef\u4ee5\u5206\u522b\u6309\u7167\u4e09\u4e2a\u89c4\u5219\u4f9d\u6b21\u8fdb\u884c\u4e09\u8f6e\u6253\u5206\uff0c\u8fd9\u4e09\u4e2a\u89c4\u5219\u5206\u522b\u662f\u4ece \u5e93\u4f18\u5148\u7ea7\u3001\u4ece\u5e93\u590d\u5236\u8fdb\u5ea6\u4ee5\u53ca\u4ece\u5e93 ID \u53f7 \u3002 \u53ea\u8981\u5728\u67d0\u4e00\u8f6e\u4e2d\uff0c\u6709\u4ece\u5e93\u5f97\u5206\u6700\u9ad8\uff0c\u90a3\u4e48\u5b83\u5c31\u662f\u4e3b\u5e93\u4e86\uff0c\u9009\u4e3b\u8fc7\u7a0b\u5230\u6b64\u7ed3\u675f\u3002\u5982\u679c\u6ca1\u6709\u51fa\u73b0\u5f97\u5206\u6700\u9ad8\u7684\u4ece\u5e93\uff0c\u90a3\u4e48\u5c31\u7ee7\u7eed\u8fdb\u884c\u4e0b\u4e00\u8f6e\u3002 \u7b2c\u4e00\u8f6e\uff1a\u4f18\u5148\u7ea7\u6700\u9ad8\u7684\u4ece\u5e93\u5f97\u5206\u9ad8\u3002 \u7528\u6237\u53ef\u4ee5\u901a\u8fc7 slave-priority \u914d\u7f6e\u9879\uff0c\u7ed9\u4e0d\u540c\u7684\u4ece\u5e93\u8bbe\u7f6e\u4e0d\u540c\u4f18\u5148\u7ea7\u3002 \u4f60\u6709\u4e24\u4e2a\u4ece\u5e93\uff0c\u5b83\u4eec\u7684\u5185\u5b58\u5927\u5c0f\u4e0d\u4e00\u6837\uff0c\u4f60\u53ef\u4ee5\u624b\u52a8\u7ed9\u5185\u5b58\u5927\u7684\u5b9e\u4f8b\u8bbe\u7f6e\u4e00\u4e2a\u9ad8\u4f18\u5148\u7ea7\u3002\u5728\u9009\u4e3b\u65f6\uff0c\u54e8\u5175\u4f1a\u7ed9\u4f18\u5148\u7ea7\u9ad8\u7684\u4ece\u5e93\u6253\u9ad8\u5206\uff0c\u5982\u679c\u6709\u4e00\u4e2a\u4ece\u5e93\u4f18\u5148\u7ea7\u6700\u9ad8\uff0c\u90a3\u4e48\u5b83\u5c31\u662f\u65b0\u4e3b\u5e93\u4e86\u3002\u5982\u679c\u4ece\u5e93\u7684\u4f18\u5148\u7ea7\u90fd\u4e00\u6837\uff0c\u90a3\u4e48\u54e8\u5175\u5f00\u59cb\u7b2c\u4e8c\u8f6e\u6253\u5206\u3002 \u7b2c\u4e8c\u8f6e\uff1a\u548c\u65e7\u4e3b\u5e93\u540c\u6b65\u7a0b\u5ea6\u6700\u63a5\u8fd1\u7684\u4ece\u5e93\u5f97\u5206\u9ad8\u3002 \u5982\u679c\u9009\u62e9\u548c\u65e7\u4e3b\u5e93\u540c\u6b65\u6700\u63a5\u8fd1\u7684\u90a3\u4e2a\u4ece\u5e93\u4f5c\u4e3a\u4e3b\u5e93\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e2a\u65b0\u4e3b\u5e93\u4e0a\u5c31\u6709\u6700\u65b0\u7684\u6570\u636e\u3002 \u4e3b\u4ece\u5e93\u540c\u6b65\u65f6\u6709\u4e2a\u547d\u4ee4\u4f20\u64ad\u7684\u8fc7\u7a0b\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c \u4e3b\u5e93\u4f1a\u7528 master_repl_offset \u8bb0\u5f55\u5f53\u524d\u7684\u6700\u65b0\u5199\u64cd\u4f5c\u5728 repl_backlog_buffer \u4e2d\u7684\u4f4d\u7f6e\uff0c\u800c\u4ece\u5e93\u4f1a\u7528 slave_repl_offset \u8fd9\u4e2a\u503c\u8bb0\u5f55\u5f53\u524d\u7684\u590d\u5236\u8fdb\u5ea6\u3002 \u6211\u4eec\u60f3\u8981\u627e\u7684\u4ece\u5e93\uff0c\u5b83\u7684 slave_repl_offset \u9700\u8981\u6700\u63a5\u8fd1 master_repl_offset \u3002 \u5982\u679c\u5728\u6240\u6709\u4ece\u5e93\u4e2d\uff0c\u6709\u4ece\u5e93\u7684 slave_repl_offset \u6700\u63a5\u8fd1 master_repl_offset \uff0c\u90a3\u4e48\u5b83\u7684\u5f97\u5206\u5c31\u6700\u9ad8\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u65b0\u4e3b\u5e93\u3002 master_repl_offset \u662f\u5355\u8c03\u589e\u52a0\u7684\uff0c\u5b83\u7684\u503c\u53ef\u4ee5\u5927\u4e8e repl_backlog_size \u3002Redis\u4f1a\u7528\u4e00\u4e2a\u540d\u4e3a repl_backlog_idx \u7684\u503c\u8bb0\u5f55\u5728\u73af\u5f62\u7f13\u51b2\u533a\u4e2d\u7684\u6700\u65b0\u5199\u5165\u4f4d\u7f6e\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4f8b\u5982\u5199\u5165len\u7684\u6570\u636e\uff0c\u90a3\u4e48 master_repl_offset += len repl_backlog_idx += len \u5982\u679c repl_backlog_idx \u7b49\u4e8e repl_backlog_size \u65f6\uff0c repl_backlog_idx \u4f1a\u88ab\u7f6e\u4e3a0\uff0c\u8868\u793a\u4ece\u73af\u5f62\u7f13\u51b2\u533a\u5f00\u59cb\u4f4d\u7f6e\u7ee7\u7eed\u5199\u5165\u3002 \u800c\u5728\u5b9e\u9645\u7684\u9009\u4e3b\u4ee3\u7801\u5c42\u9762\uff0csentinel\u662f\u76f4\u63a5\u6bd4\u8f83\u4ece\u5e93\u7684 slave_repl_offset \uff0c\u6765\u9009\u62e9\u548c\u4e3b\u5e93\u6700\u63a5\u8fd1\u7684\u4ece\u5e93\u3002 \u65e7\u4e3b\u5e93\u7684 master_repl_offset \u662f 1000\uff0c\u4ece\u5e93 1\u30012 \u548c 3 \u7684 slave_repl_offset \u5206\u522b\u662f 950\u3001990 \u548c 900\uff0c\u90a3\u4e48\uff0c \u4ece\u5e93 2 \u5c31\u5e94\u8be5\u88ab\u9009\u4e3a\u65b0\u4e3b\u5e93 \u3002 \u5f53\u7136\uff0c\u5982\u679c\u6709\u4e24\u4e2a\u4ece\u5e93\u7684 slave_repl_offset \u503c\u5927\u5c0f\u662f\u4e00\u6837\u7684\uff08\u4f8b\u5982\uff0c\u4ece\u5e93 1 \u548c\u4ece\u5e93 2 \u7684 slave_repl_offset \u503c\u90fd\u662f 990\uff09\uff0c\u6211\u4eec\u5c31\u9700\u8981\u7ed9\u5b83\u4eec\u8fdb\u884c\u7b2c\u4e09\u8f6e\u6253\u5206\u4e86\u3002 \u7b2c\u4e09\u8f6e\uff1aID \u53f7\u5c0f\u7684\u4ece\u5e93\u5f97\u5206\u9ad8\u3002 \u6bcf\u4e2a\u5b9e\u4f8b\u90fd\u4f1a\u6709\u4e00\u4e2a ID\uff0c\u8fd9\u4e2a ID \u5c31\u7c7b\u4f3c\u4e8e\u8fd9\u91cc\u7684\u4ece\u5e93\u7684\u7f16\u53f7\u3002\u76ee\u524d\uff0cRedis \u5728\u9009\u4e3b\u5e93\u65f6\uff0c\u6709\u4e00\u4e2a\u9ed8\u8ba4\u7684\u89c4\u5b9a\uff1a \u5728\u4f18\u5148\u7ea7\u548c\u590d\u5236\u8fdb\u5ea6\u90fd\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0cID \u53f7\u6700\u5c0f\u7684\u4ece\u5e93\u5f97\u5206\u6700\u9ad8\uff0c\u4f1a\u88ab\u9009\u4e3a\u65b0\u4e3b\u5e93\u3002 \u9996\u5148\uff0c \u54e8\u5175\u4f1a\u6309\u7167\u5728\u7ebf\u72b6\u6001\u3001\u7f51\u7edc\u72b6\u6001\uff0c\u7b5b\u9009\u8fc7\u6ee4\u6389\u4e00\u90e8\u5206\u4e0d\u7b26\u5408\u8981\u6c42\u7684\u4ece\u5e93 \uff0c \u7136\u540e\uff0c \u4f9d\u6b21\u6309\u7167\u4f18\u5148\u7ea7\u3001\u590d\u5236\u8fdb\u5ea6\u3001ID \u53f7\u5927\u5c0f\u518d\u5bf9\u5269\u4f59\u7684\u4ece\u5e93\u8fdb\u884c\u6253\u5206 \uff0c\u53ea\u8981\u6709\u5f97\u5206\u6700\u9ad8\u7684\u4ece\u5e93\u51fa\u73b0\uff0c\u5c31\u628a\u5b83\u9009\u4e3a\u65b0\u4e3b\u5e93\u3002 4\u3001\u672c\u8282\u5c0f\u7ed3 \u54e8\u5175\u673a\u5236\uff0c\u5b83\u662f\u5b9e\u73b0 Redis \u4e0d\u95f4\u65ad\u670d\u52a1\u7684\u91cd\u8981\u4fdd\u8bc1\u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u4e3b\u4ece\u96c6\u7fa4\u7684\u6570\u636e\u540c\u6b65\uff0c\u662f\u6570\u636e\u53ef\u9760\u7684\u57fa\u7840\u4fdd\u8bc1\uff1b\u800c\u5728\u4e3b\u5e93\u53d1\u751f\u6545\u969c\u65f6\uff0c\u81ea\u52a8\u7684\u4e3b\u4ece\u5207\u6362\u662f\u670d\u52a1\u4e0d\u95f4\u65ad\u7684\u5173\u952e\u652f\u6491\u3002 Redis \u7684\u54e8\u5175\u673a\u5236\u81ea\u52a8\u5b8c\u6210\u4e86\u4ee5\u4e0b\u4e09\u5927\u529f\u80fd\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u4e3b\u4ece\u5e93\u7684\u81ea\u52a8\u5207\u6362\uff0c\u53ef\u4ee5\u964d\u4f4e Redis \u96c6\u7fa4\u7684\u8fd0\u7ef4\u5f00\u9500\uff1a \u76d1\u63a7\u4e3b\u5e93\u8fd0\u884c\u72b6\u6001\uff0c\u5e76\u5224\u65ad\u4e3b\u5e93\u662f\u5426\u5ba2\u89c2\u4e0b\u7ebf\uff1b \u5728\u4e3b\u5e93\u5ba2\u89c2\u4e0b\u7ebf\u540e\uff0c\u9009\u53d6\u65b0\u4e3b\u5e93\uff1b \u9009\u51fa\u65b0\u4e3b\u5e93\u540e\uff0c\u901a\u77e5\u4ece\u5e93\u548c\u5ba2\u6237\u7aef\u3002 \u4e3a\u4e86\u964d\u4f4e\u8bef\u5224\u7387\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u65f6\uff0c\u54e8\u5175\u673a\u5236\u901a\u5e38\u91c7\u7528\u591a\u5b9e\u4f8b\u7684\u65b9\u5f0f\u8fdb\u884c\u90e8\u7f72\uff0c\u591a\u4e2a\u54e8\u5175\u5b9e\u4f8b\u901a\u8fc7\u201c\u5c11\u6570\u670d\u4ece\u591a\u6570\u201d\u7684\u539f\u5219\uff0c\u6765\u5224\u65ad\u4e3b\u5e93\u662f\u5426\u5ba2\u89c2\u4e0b\u7ebf \u4eae\u70b9 \u54e8\u5175\u7684\u672c\u8d28\uff1a\u662f\u4e00\u4e2aredis\u5b9e\u4f8b\uff0c\u8981\u505a\u4e09\u4ef6\u4e8b\uff1a\u76d1\u63a7\u4e3b\u5e93\uff0c\u9009\u4e3e\u65b0\u4e3b\u5e93\uff0c\u901a\u77e5\u5ba2\u6237\u7aef\u548c\u4ece\u673a \u54e8\u5175\u662f\u901a\u8fc7\u5fc3\u8df3\u68c0\u6d4b\uff0c\u76d1\u63a7\u4e3b\u5e93\u72b6\u6001\uff0c\u4e3b\u5e93\u4e0b\u7ebf\u88ab\u5206\u4e3a\uff1a\u4e3b\u89c2\u4e0b\u7ebf\u548c\u5ba2\u89c2\u4e0b\u7ebf\u3001 \u54e8\u5175\u76d1\u63a7\u662f\u53ef\u80fd\u8bef\u5224\u7684\uff0c\u6240\u4ee5\u54e8\u5175\u4e00\u822c\u662f\u96c6\u7fa4\u90e8\u7f72\uff0c\u91c7\u53d6\u6295\u7968\u7684\u5f62\u5f0f\u51cf\u5c11\u8bef\u5224 \u9009\u5b9a\u65b0\u4e3b\u5e93\u89c4\u5219\u662f\u5148\u7b5b\u9009\u5728\u6253\u5206\uff0c\u5f97\u5206\u9ad8\u7684\u4f1a\u88ab\u9009\u4e3a\u65b0\u4e3b\u5e93 \u7b5b\u9009\u89c4\u5219\uff1a\u4ece\u5e93\u5f53\u524d\u7684\u7f51\u7edc\u8fde\u63a5\u72b6\u51b5\uff0c\u4ee5\u53ca\u4e4b\u524d\u7684\u7f51\u7edc\u8fde\u63a5\u72b6\u51b5\uff0c\u7b5b\u9009\u4e2d\u65ad\u6b21\u6570\u6807\u51c6\u53ef\u4ee5\u914d\u7f6e \u6253\u5206\u89c4\u5219\uff1a\u4ece\u5e93\u7684\u4f18\u5148\u7ea7\uff0c\u6570\u636e\u540c\u6b65\u72b6\u51b5\uff0cId\u53f7\u5927\u5c0f\uff0c\u53ef\u4ee5\u5206\u4e3a\u4e09\u8f6e\uff0c\u53ea\u8981\u6709\u4e00\u8f6e\u51fa\u73b0\u5f97\u5206\u9ad8\u7684\uff0c\u5c31\u80fd\u9009\u51fa \u5224\u65ad\u54ea\u4e2a\u4ece\u5e93\u7684\u6570\u636e\u540c\u6b65\u6700\u63a5\u8fd1\u4e3b\u5e93\uff0c\u4e0d\u662f\u62ff\u4ece\u5e93\u4e0e\u4e3b\u5e93\u6bd4\u8f83\uff0c\u800c\u662f\u4ece\u5e93\u4e4b\u95f4\u4e92\u76f8\u6bd4\u8f83\uff0c\u8c01\u5927\u8c01\u5c31\u662f\u6700\u63a5\u8fd1\u7684 \u672c\u8282\u4e00\u95ee \u4e3b\u4ece\u5e93\u5207\u6362\u662f\u9700\u8981\u4e00\u5b9a\u65f6\u95f4\u7684 \u3002\u6240\u4ee5\uff0c\u5728\u8fd9\u4e2a\u5207\u6362\u8fc7\u7a0b\u4e2d\uff0c\u5ba2\u6237\u7aef\u80fd\u5426\u6b63\u5e38\u5730\u8fdb\u884c\u8bf7\u6c42\u64cd\u4f5c\u5462\uff1f\u5982\u679c\u60f3\u8981\u5e94\u7528\u7a0b\u5e8f\u4e0d\u611f\u77e5\u670d\u52a1\u7684\u4e2d\u65ad\uff0c\u8fd8\u9700\u8981\u54e8\u5175\u6216\u9700\u8981\u5ba2\u6237\u7aef\u518d\u505a\u4e9b\u4ec0\u4e48\u5417 \u7edd\u5927\u90e8\u5206\u7684\u8bfb\u8bf7\u6c42\uff0c\u53ef\u4ee5\u54cd\u5e94\u3002\u7531\u4e8e\u4e3b\u5e93\u5b9e\u4f8b\u6302\u6389\uff0c\u80af\u5b9a\u6709\u5c0f\u90e8\u5206\u6570\u636e\u672a\u88ab\u540c\u6b65\u81f3\u4ece\u5b9e\u4f8b\uff0c\u800c\u8fd9\u90e8\u5206\u6570\u636e\u7684\u8bfb\u8bf7\u6c42\u662f\u5931\u8d25\u7684\u3002 \u5982\u679c\u8fd9\u5c0f\u90e8\u5206\u6570\u636e\u662f\u65b0\u5199\u6570\u636e\uff0c\u4e14\u672a\u540c\u6b65\u7684\u8bdd\uff0c\u53d1\u5f80\u4ece\u5e93\u7684\u8bfb\u8bf7\u6c42\u662f\u4f1a\u5931\u8d25\u7684\u3002\u4f46\u5982\u679c\u662f\u66f4\u65b0\u7684\u6570\u636e\uff0c\u4e14\u672a\u540c\u6b65\u7684\u8bdd\uff0c\u90a3\u4e48\u4ece\u5e93\u7684\u8bfb\u8bf7\u6c42\u4f1a\u8fd4\u56de\u65e7\u503c \u7531\u4e8e\u4e3b\u4ece\u673a\u5236\u5b9e\u73b0\u4e86\u8bfb\u5199\u5206\u79bb\uff0c\u4e3b\u5b9e\u4f8b\u6302\u6389\uff0c\u65e0\u6cd5\u54cd\u5e94\u5199\u8bf7\u6c42\u3002","title":"\u7b2c\u4e03\u8282\t\u54e8\u5175\u673a\u5236\uff1a\u4e3b\u5e93\u4e0d\u95f4\u65ad\u670d\u52a1"},{"location":"chap2/7redis_master_rescue/#_1","text":"\u4e3b\u4ece\u5e93\u96c6\u7fa4\u6a21\u5f0f\u4e0b\uff0c\u5982\u679c\u4ece\u5e93\u53d1\u751f\u6545\u969c\u4e86\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u7ee7\u7eed\u5411\u4e3b\u5e93\u6216\u5176\u4ed6\u4ece\u5e93\u53d1\u9001\u8bf7\u6c42\uff0c\u8fdb\u884c\u76f8\u5173\u7684\u64cd\u4f5c\uff0c\u4f46\u662f\u5982\u679c\u4e3b\u5e93\u53d1\u751f\u6545\u969c\u4e86\uff0c\u90a3\u5c31\u76f4\u63a5\u4f1a\u5f71\u54cd\u5230\u4ece\u5e93\u7684\u540c\u6b65\uff0c\u56e0\u4e3a\u4ece\u5e93\u6ca1\u6709\u76f8\u5e94\u7684\u4e3b\u5e93\u53ef\u4ee5\u8fdb\u884c\u6570\u636e\u590d\u5236\u64cd\u4f5c\u4e86\u3002 \u5982\u679c\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u90fd\u662f\u8bfb\u64cd\u4f5c\u8bf7\u6c42\uff0c\u90a3\u8fd8\u53ef\u4ee5\u7531\u4ece\u5e93\u7ee7\u7eed\u63d0\u4f9b\u670d\u52a1\uff0c\u8fd9\u5728\u7eaf\u8bfb\u7684\u4e1a\u52a1\u573a\u666f\u4e0b\u8fd8\u80fd\u88ab\u63a5\u53d7 \u4e00\u65e6\u6709\u5199\u64cd\u4f5c\u8bf7\u6c42\u4e86\uff0c\u6309\u7167\u4e3b\u4ece\u5e93\u6a21\u5f0f\u4e0b\u7684\u8bfb\u5199\u5206\u79bb\u8981\u6c42\uff0c\u9700\u8981\u7531\u4e3b\u5e93\u6765\u5b8c\u6210\u5199\u64cd\u4f5c \uff0c\u6b64\u65f6\uff0c\u4e5f\u6ca1\u6709\u5b9e\u4f8b\u53ef\u4ee5\u6765\u670d\u52a1\u5ba2\u6237\u7aef\u7684\u5199\u64cd\u4f5c\u8bf7\u6c42\u4e86 \u65e0\u8bba\u662f\u5199\u670d\u52a1\u4e2d\u65ad\uff0c\u8fd8\u662f\u4ece\u5e93\u65e0\u6cd5\u8fdb\u884c\u6570\u636e\u540c\u6b65\uff0c\u90fd\u662f\u4e0d\u80fd\u63a5\u53d7\u7684\u3002 \u5982\u679c\u4e3b\u5e93\u6302\u4e86\uff0c\u6211\u4eec\u5c31\u9700\u8981\u8fd0\u884c\u4e00\u4e2a\u65b0\u4e3b\u5e93\uff0c\u6bd4\u5982\u8bf4\u628a\u4e00\u4e2a\u4ece\u5e93\u5207\u6362\u4e3a\u4e3b\u5e93\uff0c\u628a\u5b83\u5f53\u6210\u4e3b\u5e93 \u4e3b\u5e93\u771f\u7684\u6302\u4e86\u5417\uff1f \u8be5\u9009\u62e9\u54ea\u4e2a\u4ece\u5e93\u4f5c\u4e3a\u4e3b\u5e93\uff1f \u600e\u4e48\u628a\u65b0\u4e3b\u5e93\u7684\u76f8\u5173\u4fe1\u606f\u901a\u77e5\u7ed9\u4ece\u5e93\u548c\u5ba2\u6237\u7aef\u5462\uff1f \u8fd9\u5c31\u8981\u63d0\u5230\u54e8\u5175\u673a\u5236\u4e86\u3002\u5728 Redis \u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c \u54e8\u5175\u673a\u5236\u662f\u5b9e\u73b0\u4e3b\u4ece\u5e93\u81ea\u52a8\u5207\u6362\u7684\u5173\u952e\u673a\u5236 \uff0c\u5b83\u6709\u6548\u5730\u89e3\u51b3\u4e86\u4e3b\u4ece\u590d\u5236\u6a21\u5f0f\u4e0b\u6545\u969c\u8f6c\u79fb\u7684\u8fd9\u4e09\u4e2a\u95ee\u9898\u3002","title":"\u7b2c\u4e03\u8282 \u54e8\u5175\u673a\u5236\uff1a\u4e3b\u5e93\u4e0d\u95f4\u65ad\u670d\u52a1"},{"location":"chap2/7redis_master_rescue/#1","text":"\u54e8\u5175\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u8fd0\u884c\u5728\u7279\u6b8a\u6a21\u5f0f\u4e0b\u7684 Redis \u8fdb\u7a0b\uff0c\u4e3b\u4ece\u5e93\u5b9e\u4f8b\u8fd0\u884c\u7684\u540c\u65f6\uff0c\u5b83\u4e5f\u5728\u8fd0\u884c\u3002\u54e8\u5175\u4e3b\u8981\u8d1f\u8d23\u7684\u5c31\u662f\u4e09\u4e2a\u4efb\u52a1\uff1a\u76d1\u63a7\u3001\u9009\u4e3b\uff08\u9009\u62e9\u4e3b\u5e93\uff09\u548c\u901a\u77e5\u3002 \u54e8\u5175\u7684\u4e3b\u8981\u804c\u8d23\uff1a \u76d1\u63a7\uff1a\u901a\u8fc7PING\u6765\u76d1\u63a7\u4e3b\u4ece \u9009\u4e3b\uff1a\u4e3b\u5e93\u6302\u4e86\uff0c\u4ece\u4ece\u5e93\u4e2d\u6309\u4e00\u5b9a\u7684\u673a\u5236\u9009\u62e9\u4e00\u4e2a\u65b0\u4e3b\u5e93 \u901a\u77e5\uff1a\u901a\u77e5\u5176\u4ed6\u4ece\u5e93\u548c\u5ba2\u6237\u7aef\u65b0\u7684\u4e3b\u5e93\u4fe1\u606f","title":"1\u3001\u54e8\u5175\u673a\u5236\u7684\u57fa\u672c\u6d41\u7a0b"},{"location":"chap2/7redis_master_rescue/#1-1","text":"\u76d1\u63a7\u662f\u6307\u54e8\u5175\u8fdb\u7a0b\u5728\u8fd0\u884c\u65f6\uff0c\u5468\u671f\u6027\u5730\u7ed9\u6240\u6709\u7684\u4e3b\u4ece\u5e93\u53d1\u9001 PING \u547d\u4ee4\uff0c\u68c0\u6d4b\u5b83\u4eec\u662f\u5426\u4ecd\u7136\u5728\u7ebf\u8fd0\u884c\u3002 \u5982\u679c \u4ece\u5e93\u6ca1\u6709\u5728\u89c4\u5b9a\u65f6\u95f4\u5185\u54cd\u5e94\u54e8\u5175\u7684 PING \u547d\u4ee4 \uff0c\u54e8\u5175\u5c31\u4f1a\u628a\u5b83\u6807\u8bb0\u4e3a\u201c\u4e0b\u7ebf\u72b6\u6001\u201d\uff1b \u5982\u679c\u4e3b\u5e93\u4e5f\u6ca1\u6709\u5728\u89c4\u5b9a\u65f6\u95f4\u5185\u54cd\u5e94\u54e8\u5175\u7684 PING \u547d\u4ee4\uff0c\u54e8\u5175\u5c31\u4f1a\u5224\u5b9a\u4e3b\u5e93\u4e0b\u7ebf\uff0c\u7136\u540e\u5f00\u59cb \u81ea\u52a8\u5207\u6362\u4e3b\u5e93\u7684\u6d41\u7a0b \u3002 \u8fd9\u4e2a\u6d41\u7a0b\u9996\u5148\u662f\u6267\u884c\u54e8\u5175\u7684\u7b2c\u4e8c\u4e2a\u4efb\u52a1\uff0c\u9009\u4e3b","title":"1-1 \u76d1\u63a7"},{"location":"chap2/7redis_master_rescue/#1-2","text":"\u4e3b\u5e93\u6302\u4e86\u4ee5\u540e\uff0c\u54e8\u5175\u5c31\u9700\u8981\u4ece\u5f88\u591a\u4e2a\u4ece\u5e93\u91cc\uff0c\u6309\u7167\u4e00\u5b9a\u7684\u89c4\u5219\u9009\u62e9\u4e00\u4e2a\u4ece\u5e93\u5b9e\u4f8b\uff0c\u628a\u5b83\u4f5c\u4e3a\u65b0\u7684\u4e3b\u5e93\u3002 \u8fd9\u4e00\u6b65\u5b8c\u6210\u540e\uff0c\u73b0\u5728\u7684\u96c6\u7fa4\u91cc\u5c31\u6709\u4e86\u65b0\u4e3b\u5e93\u3002","title":"1-2 \u9009\u4e3b"},{"location":"chap2/7redis_master_rescue/#1-3","text":"\u5728\u6267\u884c\u901a\u77e5\u4efb\u52a1\u65f6\uff0c\u54e8\u5175\u4f1a\u628a\u65b0\u4e3b\u5e93\u7684\u8fde\u63a5\u4fe1\u606f\u53d1\u7ed9\u5176\u4ed6\u4ece\u5e93\uff0c\u8ba9\u5b83\u4eec\u6267\u884c replicaof \u547d\u4ee4\uff0c\u548c\u65b0\u4e3b\u5e93\u5efa\u7acb\u8fde\u63a5\uff0c\u5e76\u8fdb\u884c\u6570\u636e\u590d\u5236 \u540c\u65f6\uff0c\u54e8\u5175\u4f1a\u628a\u65b0\u4e3b\u5e93\u7684\u8fde\u63a5\u4fe1\u606f\u901a\u77e5\u7ed9\u5ba2\u6237\u7aef\uff0c\u8ba9\u5b83\u4eec\u628a\u8bf7\u6c42\u64cd\u4f5c\u53d1\u5230\u65b0\u4e3b\u5e93\u4e0a \u3002 \u901a\u77e5\u4efb\u52a1\u76f8\u5bf9\u6765\u8bf4\u6bd4\u8f83\u7b80\u5355\uff0c\u54e8\u5175\u53ea\u9700\u8981\u628a\u65b0\u4e3b\u5e93\u4fe1\u606f\u53d1\u7ed9\u4ece\u5e93\u548c\u5ba2\u6237\u7aef\uff0c\u8ba9\u5b83\u4eec\u548c\u65b0\u4e3b\u5e93\u5efa\u7acb\u8fde\u63a5\u5c31\u884c\uff0c\u5e76\u4e0d\u6d89\u53ca\u51b3\u7b56\u7684\u903b\u8f91\u3002 \u4f46\u662f\uff0c\u5728\u76d1\u63a7\u548c\u9009\u4e3b\u8fd9\u4e24\u4e2a\u4efb\u52a1\u4e2d\uff0c\u54e8\u5175\u9700\u8981\u505a\u51fa\u4e24\u4e2a\u51b3\u7b56\uff1a \u5728\u76d1\u63a7\u4efb\u52a1\u4e2d\uff0c\u54e8\u5175\u9700\u8981\u5224\u65ad\u4e3b\u5e93\u662f\u5426\u5904\u4e8e\u4e0b\u7ebf\u72b6\u6001\uff1b \u5728\u9009\u4e3b\u4efb\u52a1\u4e2d\uff0c\u54e8\u5175\u4e5f\u8981\u51b3\u5b9a\u9009\u62e9\u54ea\u4e2a\u4ece\u5e93\u5b9e\u4f8b\u4f5c\u4e3a\u4e3b\u5e93\u3002 \u54e8\u5175\u5bf9\u4e3b\u5e93\u7684\u4e0b\u7ebf\u5224\u65ad\u6709\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u548c\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u4e24\u79cd","title":"1-3 \u901a\u77e5"},{"location":"chap2/7redis_master_rescue/#2","text":"","title":"2\u3001\u4e3b\u89c2\u4e0b\u7ebf\u548c\u5ba2\u89c2\u4e0b\u7ebf"},{"location":"chap2/7redis_master_rescue/#2-1","text":"\u54e8\u5175\u8fdb\u7a0b\u4f1a\u4f7f\u7528 PING \u547d\u4ee4\u68c0\u6d4b\u5b83\u81ea\u5df1\u548c\u4e3b\u3001\u4ece\u5e93\u7684\u7f51\u7edc\u8fde\u63a5\u60c5\u51b5\uff0c\u7528\u6765\u5224\u65ad\u5b9e\u4f8b\u7684\u72b6\u6001\u3002 \u5982\u679c\u54e8\u5175\u53d1\u73b0\u4e3b\u5e93\u6216\u4ece\u5e93\u5bf9 PING \u547d\u4ee4\u7684\u54cd\u5e94\u8d85\u65f6\u4e86\uff0c\u90a3\u4e48\uff0c\u54e8\u5175\u5c31\u4f1a\u5148\u628a\u5b83\u6807\u8bb0\u4e3a\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d \u54e8\u5175\u8fdb\u7a0b\u4f1a\u4f7f\u7528 PING \u547d\u4ee4\u68c0\u6d4b\u5b83\u81ea\u5df1\u548c\u4e3b\u3001\u4ece\u5e93\u7684\u7f51\u7edc\u8fde\u63a5\u60c5\u51b5\uff0c\u7528\u6765\u5224\u65ad\u5b9e\u4f8b\u7684\u72b6\u6001\u3002 \u679c\u54e8\u5175\u53d1\u73b0\u4e3b\u5e93\u6216\u4ece\u5e93\u5bf9 PING \u547d\u4ee4\u7684\u54cd\u5e94\u8d85\u65f6\u4e86\uff0c\u90a3\u4e48 \uff0c\u54e8\u5175\u5c31\u4f1a\u5148\u628a\u5b83\u6807\u8bb0\u4e3a\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d \u3002 \u5982\u679c\u68c0\u6d4b\u7684\u662f\u4ece\u5e93\uff0c\u90a3\u4e48\uff0c\u54e8\u5175\u7b80\u5355\u5730\u628a\u5b83\u6807\u8bb0\u4e3a\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u5c31\u884c\u4e86\uff0c\u56e0\u4e3a\u4ece\u5e93\u7684\u4e0b\u7ebf\u5f71\u54cd\u4e00\u822c\u4e0d\u592a\u5927\uff0c\u96c6\u7fa4\u7684\u5bf9\u5916\u670d\u52a1\u4e0d\u4f1a\u95f4\u65ad\u3002 \u5982\u679c\u68c0\u6d4b\u7684\u662f\u4e3b\u5e93\uff0c\u90a3\u4e48\uff0c\u54e8\u5175\u8fd8\u4e0d\u80fd\u7b80\u5355\u5730\u628a\u5b83\u6807\u8bb0\u4e3a\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\uff0c\u5f00\u542f\u4e3b\u4ece\u5207\u6362\u3002 \u56e0\u4e3a\u5f88\u6709\u53ef\u80fd\u5b58\u5728\u8fd9\u4e48\u4e00\u4e2a\u60c5\u51b5\uff1a\u90a3\u5c31\u662f\u54e8\u5175\u8bef\u5224\u4e86\uff0c\u5176\u5b9e\u4e3b\u5e93\u5e76\u6ca1\u6709\u6545\u969c\u3002 \u4e00\u65e6\u542f\u52a8\u4e86\u4e3b\u4ece\u5207\u6362\uff0c\u540e\u7eed\u7684\u9009\u4e3b\u548c\u901a\u77e5\u64cd\u4f5c\u90fd\u4f1a\u5e26\u6765\u989d\u5916\u7684\u8ba1\u7b97\u548c\u901a\u4fe1\u5f00\u9500\u3002 \u9996\u5148\uff0c\u6211\u4eec\u8981\u77e5\u9053\u5565\u53eb\u8bef\u5224\u3002\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u4e3b\u5e93\u5b9e\u9645\u5e76\u6ca1\u6709\u4e0b\u7ebf\uff0c\u4f46\u662f\u54e8\u5175\u8bef\u4ee5\u4e3a\u5b83\u4e0b\u7ebf\u4e86\u3002 \u8bef\u5224\u4e00\u822c\u4f1a\u53d1\u751f\u5728\u96c6\u7fa4\u7f51\u7edc\u538b\u529b\u8f83\u5927\u3001\u7f51\u7edc\u62e5\u585e\uff0c\u6216\u8005\u662f\u4e3b\u5e93\u672c\u8eab\u538b\u529b\u8f83\u5927\u7684\u60c5\u51b5\u4e0b \u3002 \u4e00\u65e6\u54e8\u5175\u5224\u65ad\u4e3b\u5e93\u4e0b\u7ebf\u4e86\uff0c\u5c31\u4f1a\u5f00\u59cb\u9009\u62e9\u65b0\u4e3b\u5e93\uff0c\u5e76\u8ba9\u4ece\u5e93\u548c\u65b0\u4e3b\u5e93\u8fdb\u884c\u6570\u636e\u540c\u6b65\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u672c\u8eab\u5c31\u4f1a\u6709\u5f00\u9500\uff0c\u4f8b\u5982\uff0c\u54e8\u5175\u8981\u82b1\u65f6\u95f4\u9009\u51fa\u65b0\u4e3b\u5e93\uff0c\u4ece\u5e93\u4e5f\u9700\u8981\u82b1\u65f6\u95f4\u548c\u65b0\u4e3b\u5e93\u540c\u6b65\u3002 \u90a3\u600e\u4e48\u51cf\u5c11\u8bef\u5224\u5462\uff1f","title":"2-1 \u4e3b\u89c2\u4e0b\u7ebf"},{"location":"chap2/7redis_master_rescue/#2-2","text":"\u54e8\u5175\u673a\u5236\u901a\u5e38\u4f1a\u91c7\u7528\u591a\u5b9e\u4f8b\u7ec4\u6210\u7684\u96c6\u7fa4\u6a21\u5f0f\u8fdb\u884c\u90e8\u7f72\uff0c\u8fd9\u4e5f\u88ab\u79f0\u4e3a\u54e8\u5175\u96c6\u7fa4\u3002 \u5f15\u5165\u591a\u4e2a\u54e8\u5175\u5b9e\u4f8b\u4e00\u8d77\u6765\u5224\u65ad\uff0c\u5c31\u53ef\u4ee5\u907f\u514d\u5355\u4e2a\u54e8\u5175\u56e0\u4e3a\u81ea\u8eab\u7f51\u7edc\u72b6\u51b5\u4e0d\u597d\uff0c\u800c\u8bef\u5224\u4e3b\u5e93\u4e0b\u7ebf\u7684\u60c5\u51b5\u3002 \u540c\u65f6\uff0c\u591a\u4e2a\u54e8\u5175\u7684\u7f51\u7edc\u540c\u65f6\u4e0d\u7a33\u5b9a\u7684\u6982\u7387\u8f83\u5c0f\uff0c\u7531\u5b83\u4eec\u4e00\u8d77\u505a\u51b3\u7b56\uff0c\u8bef\u5224\u7387\u4e5f\u80fd\u964d\u4f4e\u3002","title":"2-2 \u54e8\u5175\u96c6\u7fa4"},{"location":"chap2/7redis_master_rescue/#2-3","text":"\u5728\u5224\u65ad\u4e3b\u5e93\u662f\u5426\u4e0b\u7ebf\u65f6\uff0c\u4e0d\u80fd\u7531\u4e00\u4e2a\u54e8\u5175\u8bf4\u4e86\u7b97\uff0c\u53ea\u6709\u5927\u591a\u6570\u7684\u54e8\u5175\u5b9e\u4f8b\uff0c\u90fd\u5224\u65ad\u4e3b\u5e93\u5df2\u7ecf\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u4e86\uff0c\u4e3b\u5e93\u624d\u4f1a\u88ab\u6807\u8bb0\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d \uff0c\u8fd9\u4e2a\u53eb\u6cd5\u4e5f\u662f\u8868\u660e\u4e3b\u5e93\u4e0b\u7ebf\u6210\u4e3a\u4e00\u4e2a\u5ba2\u89c2\u4e8b\u5b9e\u4e86 \u5224\u65ad\u539f\u5219\u5c31\u662f\uff1a\u5c11\u6570\u670d\u4ece\u591a\u6570\u3002\u540c\u65f6\uff0c\u8fd9\u4f1a\u8fdb\u4e00\u6b65\u89e6\u53d1\u54e8\u5175\u5f00\u59cb\u4e3b\u4ece\u5207\u6362\u6d41\u7a0b\u3002 Redis \u4e3b\u4ece\u96c6\u7fa4\u6709\u4e00\u4e2a\u4e3b\u5e93\u3001\u4e09\u4e2a\u4ece\u5e93\uff0c\u8fd8\u6709\u4e09\u4e2a\u54e8\u5175\u5b9e\u4f8b\u3002\u5728\u56fe\u7247\u7684\u5de6\u8fb9\uff0c\u54e8\u5175 2 \u5224\u65ad\u4e3b\u5e93\u4e3a\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\uff0c\u4f46\u54e8\u5175 1 \u548c 3 \u5374\u5224\u5b9a\u4e3b\u5e93\u662f\u4e0a\u7ebf\u72b6\u6001\uff0c\u6b64\u65f6\uff0c\u4e3b\u5e93\u4ecd\u7136\u88ab\u5224\u65ad\u4e3a\u5904\u4e8e\u4e0a\u7ebf\u72b6\u6001\u3002 \u54e8\u5175 1 \u548c 2 \u90fd\u5224\u65ad\u4e3b\u5e93\u4e3a\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\uff0c\u6b64\u65f6\uff0c\u5373\u4f7f\u54e8\u5175 3 \u4ecd\u7136\u5224\u65ad\u4e3b\u5e93\u4e3a\u4e0a\u7ebf\u72b6\u6001\uff0c\u4e3b\u5e93\u4e5f\u88ab\u6807\u8bb0\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u4e86\u3002 \u7b80\u5355\u6765\u8bf4\uff0c\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u7684\u6807\u51c6\u5c31\u662f\uff0c \u5f53\u6709 N \u4e2a\u54e8\u5175\u5b9e\u4f8b\u65f6\uff0c\u6700\u597d\u8981\u6709 N/2 + 1 \u4e2a\u5b9e\u4f8b\u5224\u65ad\u4e3b\u5e93\u4e3a\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\uff0c\u624d\u80fd\u6700\u7ec8\u5224\u5b9a\u4e3b\u5e93\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d \uff0c\u5c31\u53ef\u4ee5\u51cf\u5c11\u8bef\u5224\u7684\u6982\u7387\uff0c\u4e5f\u80fd\u907f\u514d\u8bef\u5224\u5e26\u6765\u7684\u65e0\u8c13\u7684\u4e3b\u4ece\u5e93\u5207\u6362\u3002\uff08\u5f53\u7136\uff0c\u6709\u591a\u5c11\u4e2a\u5b9e\u4f8b\u505a\u51fa\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u7684\u5224\u65ad\u624d\u53ef\u4ee5\uff0c\u53ef\u4ee5\u7531 Redis \u7ba1\u7406\u5458\u81ea\u884c\u8bbe\u5b9a\uff09\u3002","title":"2-3 \u5ba2\u89c2\u4e0b\u7ebf"},{"location":"chap2/7redis_master_rescue/#3","text":"\u54e8\u5175\u9009\u62e9\u65b0\u4e3b\u5e93\u7684\u8fc7\u7a0b\u79f0\u4e3a\u201c\u7b5b\u9009 + \u6253\u5206\u201d \u6211\u4eec\u5728\u591a\u4e2a\u4ece\u5e93\u4e2d\uff0c \u5148\u6309\u7167\u4e00\u5b9a\u7684\u7b5b\u9009\u6761\u4ef6 \uff0c\u628a\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4ece\u5e93\u53bb\u6389\u3002 \u7136\u540e\uff0c \u6211\u4eec\u518d\u6309\u7167\u4e00\u5b9a\u7684\u89c4\u5219 \uff0c\u7ed9\u5269\u4e0b\u7684\u4ece\u5e93\u9010\u4e2a\u6253\u5206\uff0c\u5c06\u5f97\u5206\u6700\u9ad8\u7684\u4ece\u5e93\u9009\u4e3a\u65b0\u4e3b\u5e93","title":"3\u3001\u5982\u4f55\u9009\u5b9a\u65b0\u4e3b\u5e93\uff1f"},{"location":"chap2/7redis_master_rescue/#3-1","text":"\u5728\u9009\u4e3b\u65f6\uff0c\u9664\u4e86\u8981\u68c0\u67e5\u4ece\u5e93\u7684\u5f53\u524d\u5728\u7ebf\u72b6\u6001\uff0c\u8fd8\u8981\u5224\u65ad\u5b83\u4e4b\u524d\u7684\u7f51\u7edc\u8fde\u63a5\u72b6\u6001\u3002 \u5982\u679c\u4ece\u5e93\u603b\u662f\u548c\u4e3b\u5e93\u65ad\u8fde\uff0c\u800c\u4e14\u65ad\u8fde\u6b21\u6570\u8d85\u51fa\u4e86\u4e00\u5b9a\u7684\u9608\u503c\uff0c\u6211\u4eec\u5c31\u6709\u7406\u7531\u76f8\u4fe1\uff0c\u8fd9\u4e2a\u4ece\u5e93\u7684\u7f51\u7edc\u72b6\u51b5\u5e76\u4e0d\u662f\u592a\u597d\uff0c\u5c31\u53ef\u4ee5\u628a\u8fd9\u4e2a\u4ece\u5e93\u7b5b\u6389\u4e86\u3002 \u5177\u4f53\u600e\u4e48\u5224\u65ad\u5462\uff1f\u4f60\u4f7f\u7528\u914d\u7f6e\u9879 down-after-milliseconds * 10 \u3002 \u5176\u4e2d\uff0c down-after-milliseconds \u662f\u6211\u4eec\u8ba4\u5b9a\u4e3b\u4ece\u5e93\u65ad\u8fde\u7684\u6700\u5927\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\u3002 \u5982\u679c\u5728 down-after-milliseconds \u6beb\u79d2\u5185\uff0c\u4e3b\u4ece\u8282\u70b9\u90fd\u6ca1\u6709\u901a\u8fc7\u7f51\u7edc\u8054\u7cfb\u4e0a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba4\u4e3a\u4e3b\u4ece\u8282\u70b9\u65ad\u8fde\u4e86\u3002 \u5982\u679c\u53d1\u751f\u65ad\u8fde\u7684\u6b21\u6570\u8d85\u8fc7\u4e86 10 \u6b21\uff0c\u5c31\u8bf4\u660e\u8fd9\u4e2a\u4ece\u5e93\u7684\u7f51\u7edc\u72b6\u51b5\u4e0d\u597d\uff0c\u4e0d\u9002\u5408\u4f5c\u4e3a\u65b0\u4e3b\u5e93\u3002 \u65b0\u5efa sentinal.conf \u6587\u4ef6\u8fdb\u884c\u914d\u7f6e\uff0c\u4e0d\u5728 redis.conf \u4e2d","title":"3-1 \u7b5b\u9009"},{"location":"chap2/7redis_master_rescue/#3-2","text":"\u6211\u4eec\u53ef\u4ee5\u5206\u522b\u6309\u7167\u4e09\u4e2a\u89c4\u5219\u4f9d\u6b21\u8fdb\u884c\u4e09\u8f6e\u6253\u5206\uff0c\u8fd9\u4e09\u4e2a\u89c4\u5219\u5206\u522b\u662f\u4ece \u5e93\u4f18\u5148\u7ea7\u3001\u4ece\u5e93\u590d\u5236\u8fdb\u5ea6\u4ee5\u53ca\u4ece\u5e93 ID \u53f7 \u3002 \u53ea\u8981\u5728\u67d0\u4e00\u8f6e\u4e2d\uff0c\u6709\u4ece\u5e93\u5f97\u5206\u6700\u9ad8\uff0c\u90a3\u4e48\u5b83\u5c31\u662f\u4e3b\u5e93\u4e86\uff0c\u9009\u4e3b\u8fc7\u7a0b\u5230\u6b64\u7ed3\u675f\u3002\u5982\u679c\u6ca1\u6709\u51fa\u73b0\u5f97\u5206\u6700\u9ad8\u7684\u4ece\u5e93\uff0c\u90a3\u4e48\u5c31\u7ee7\u7eed\u8fdb\u884c\u4e0b\u4e00\u8f6e\u3002 \u7b2c\u4e00\u8f6e\uff1a\u4f18\u5148\u7ea7\u6700\u9ad8\u7684\u4ece\u5e93\u5f97\u5206\u9ad8\u3002 \u7528\u6237\u53ef\u4ee5\u901a\u8fc7 slave-priority \u914d\u7f6e\u9879\uff0c\u7ed9\u4e0d\u540c\u7684\u4ece\u5e93\u8bbe\u7f6e\u4e0d\u540c\u4f18\u5148\u7ea7\u3002 \u4f60\u6709\u4e24\u4e2a\u4ece\u5e93\uff0c\u5b83\u4eec\u7684\u5185\u5b58\u5927\u5c0f\u4e0d\u4e00\u6837\uff0c\u4f60\u53ef\u4ee5\u624b\u52a8\u7ed9\u5185\u5b58\u5927\u7684\u5b9e\u4f8b\u8bbe\u7f6e\u4e00\u4e2a\u9ad8\u4f18\u5148\u7ea7\u3002\u5728\u9009\u4e3b\u65f6\uff0c\u54e8\u5175\u4f1a\u7ed9\u4f18\u5148\u7ea7\u9ad8\u7684\u4ece\u5e93\u6253\u9ad8\u5206\uff0c\u5982\u679c\u6709\u4e00\u4e2a\u4ece\u5e93\u4f18\u5148\u7ea7\u6700\u9ad8\uff0c\u90a3\u4e48\u5b83\u5c31\u662f\u65b0\u4e3b\u5e93\u4e86\u3002\u5982\u679c\u4ece\u5e93\u7684\u4f18\u5148\u7ea7\u90fd\u4e00\u6837\uff0c\u90a3\u4e48\u54e8\u5175\u5f00\u59cb\u7b2c\u4e8c\u8f6e\u6253\u5206\u3002 \u7b2c\u4e8c\u8f6e\uff1a\u548c\u65e7\u4e3b\u5e93\u540c\u6b65\u7a0b\u5ea6\u6700\u63a5\u8fd1\u7684\u4ece\u5e93\u5f97\u5206\u9ad8\u3002 \u5982\u679c\u9009\u62e9\u548c\u65e7\u4e3b\u5e93\u540c\u6b65\u6700\u63a5\u8fd1\u7684\u90a3\u4e2a\u4ece\u5e93\u4f5c\u4e3a\u4e3b\u5e93\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e2a\u65b0\u4e3b\u5e93\u4e0a\u5c31\u6709\u6700\u65b0\u7684\u6570\u636e\u3002 \u4e3b\u4ece\u5e93\u540c\u6b65\u65f6\u6709\u4e2a\u547d\u4ee4\u4f20\u64ad\u7684\u8fc7\u7a0b\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c \u4e3b\u5e93\u4f1a\u7528 master_repl_offset \u8bb0\u5f55\u5f53\u524d\u7684\u6700\u65b0\u5199\u64cd\u4f5c\u5728 repl_backlog_buffer \u4e2d\u7684\u4f4d\u7f6e\uff0c\u800c\u4ece\u5e93\u4f1a\u7528 slave_repl_offset \u8fd9\u4e2a\u503c\u8bb0\u5f55\u5f53\u524d\u7684\u590d\u5236\u8fdb\u5ea6\u3002 \u6211\u4eec\u60f3\u8981\u627e\u7684\u4ece\u5e93\uff0c\u5b83\u7684 slave_repl_offset \u9700\u8981\u6700\u63a5\u8fd1 master_repl_offset \u3002 \u5982\u679c\u5728\u6240\u6709\u4ece\u5e93\u4e2d\uff0c\u6709\u4ece\u5e93\u7684 slave_repl_offset \u6700\u63a5\u8fd1 master_repl_offset \uff0c\u90a3\u4e48\u5b83\u7684\u5f97\u5206\u5c31\u6700\u9ad8\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u65b0\u4e3b\u5e93\u3002 master_repl_offset \u662f\u5355\u8c03\u589e\u52a0\u7684\uff0c\u5b83\u7684\u503c\u53ef\u4ee5\u5927\u4e8e repl_backlog_size \u3002Redis\u4f1a\u7528\u4e00\u4e2a\u540d\u4e3a repl_backlog_idx \u7684\u503c\u8bb0\u5f55\u5728\u73af\u5f62\u7f13\u51b2\u533a\u4e2d\u7684\u6700\u65b0\u5199\u5165\u4f4d\u7f6e\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4f8b\u5982\u5199\u5165len\u7684\u6570\u636e\uff0c\u90a3\u4e48 master_repl_offset += len repl_backlog_idx += len \u5982\u679c repl_backlog_idx \u7b49\u4e8e repl_backlog_size \u65f6\uff0c repl_backlog_idx \u4f1a\u88ab\u7f6e\u4e3a0\uff0c\u8868\u793a\u4ece\u73af\u5f62\u7f13\u51b2\u533a\u5f00\u59cb\u4f4d\u7f6e\u7ee7\u7eed\u5199\u5165\u3002 \u800c\u5728\u5b9e\u9645\u7684\u9009\u4e3b\u4ee3\u7801\u5c42\u9762\uff0csentinel\u662f\u76f4\u63a5\u6bd4\u8f83\u4ece\u5e93\u7684 slave_repl_offset \uff0c\u6765\u9009\u62e9\u548c\u4e3b\u5e93\u6700\u63a5\u8fd1\u7684\u4ece\u5e93\u3002 \u65e7\u4e3b\u5e93\u7684 master_repl_offset \u662f 1000\uff0c\u4ece\u5e93 1\u30012 \u548c 3 \u7684 slave_repl_offset \u5206\u522b\u662f 950\u3001990 \u548c 900\uff0c\u90a3\u4e48\uff0c \u4ece\u5e93 2 \u5c31\u5e94\u8be5\u88ab\u9009\u4e3a\u65b0\u4e3b\u5e93 \u3002 \u5f53\u7136\uff0c\u5982\u679c\u6709\u4e24\u4e2a\u4ece\u5e93\u7684 slave_repl_offset \u503c\u5927\u5c0f\u662f\u4e00\u6837\u7684\uff08\u4f8b\u5982\uff0c\u4ece\u5e93 1 \u548c\u4ece\u5e93 2 \u7684 slave_repl_offset \u503c\u90fd\u662f 990\uff09\uff0c\u6211\u4eec\u5c31\u9700\u8981\u7ed9\u5b83\u4eec\u8fdb\u884c\u7b2c\u4e09\u8f6e\u6253\u5206\u4e86\u3002 \u7b2c\u4e09\u8f6e\uff1aID \u53f7\u5c0f\u7684\u4ece\u5e93\u5f97\u5206\u9ad8\u3002 \u6bcf\u4e2a\u5b9e\u4f8b\u90fd\u4f1a\u6709\u4e00\u4e2a ID\uff0c\u8fd9\u4e2a ID \u5c31\u7c7b\u4f3c\u4e8e\u8fd9\u91cc\u7684\u4ece\u5e93\u7684\u7f16\u53f7\u3002\u76ee\u524d\uff0cRedis \u5728\u9009\u4e3b\u5e93\u65f6\uff0c\u6709\u4e00\u4e2a\u9ed8\u8ba4\u7684\u89c4\u5b9a\uff1a \u5728\u4f18\u5148\u7ea7\u548c\u590d\u5236\u8fdb\u5ea6\u90fd\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0cID \u53f7\u6700\u5c0f\u7684\u4ece\u5e93\u5f97\u5206\u6700\u9ad8\uff0c\u4f1a\u88ab\u9009\u4e3a\u65b0\u4e3b\u5e93\u3002 \u9996\u5148\uff0c \u54e8\u5175\u4f1a\u6309\u7167\u5728\u7ebf\u72b6\u6001\u3001\u7f51\u7edc\u72b6\u6001\uff0c\u7b5b\u9009\u8fc7\u6ee4\u6389\u4e00\u90e8\u5206\u4e0d\u7b26\u5408\u8981\u6c42\u7684\u4ece\u5e93 \uff0c \u7136\u540e\uff0c \u4f9d\u6b21\u6309\u7167\u4f18\u5148\u7ea7\u3001\u590d\u5236\u8fdb\u5ea6\u3001ID \u53f7\u5927\u5c0f\u518d\u5bf9\u5269\u4f59\u7684\u4ece\u5e93\u8fdb\u884c\u6253\u5206 \uff0c\u53ea\u8981\u6709\u5f97\u5206\u6700\u9ad8\u7684\u4ece\u5e93\u51fa\u73b0\uff0c\u5c31\u628a\u5b83\u9009\u4e3a\u65b0\u4e3b\u5e93\u3002","title":"3-2 \u6253\u5206"},{"location":"chap2/7redis_master_rescue/#4","text":"\u54e8\u5175\u673a\u5236\uff0c\u5b83\u662f\u5b9e\u73b0 Redis \u4e0d\u95f4\u65ad\u670d\u52a1\u7684\u91cd\u8981\u4fdd\u8bc1\u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u4e3b\u4ece\u96c6\u7fa4\u7684\u6570\u636e\u540c\u6b65\uff0c\u662f\u6570\u636e\u53ef\u9760\u7684\u57fa\u7840\u4fdd\u8bc1\uff1b\u800c\u5728\u4e3b\u5e93\u53d1\u751f\u6545\u969c\u65f6\uff0c\u81ea\u52a8\u7684\u4e3b\u4ece\u5207\u6362\u662f\u670d\u52a1\u4e0d\u95f4\u65ad\u7684\u5173\u952e\u652f\u6491\u3002 Redis \u7684\u54e8\u5175\u673a\u5236\u81ea\u52a8\u5b8c\u6210\u4e86\u4ee5\u4e0b\u4e09\u5927\u529f\u80fd\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u4e3b\u4ece\u5e93\u7684\u81ea\u52a8\u5207\u6362\uff0c\u53ef\u4ee5\u964d\u4f4e Redis \u96c6\u7fa4\u7684\u8fd0\u7ef4\u5f00\u9500\uff1a \u76d1\u63a7\u4e3b\u5e93\u8fd0\u884c\u72b6\u6001\uff0c\u5e76\u5224\u65ad\u4e3b\u5e93\u662f\u5426\u5ba2\u89c2\u4e0b\u7ebf\uff1b \u5728\u4e3b\u5e93\u5ba2\u89c2\u4e0b\u7ebf\u540e\uff0c\u9009\u53d6\u65b0\u4e3b\u5e93\uff1b \u9009\u51fa\u65b0\u4e3b\u5e93\u540e\uff0c\u901a\u77e5\u4ece\u5e93\u548c\u5ba2\u6237\u7aef\u3002 \u4e3a\u4e86\u964d\u4f4e\u8bef\u5224\u7387\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u65f6\uff0c\u54e8\u5175\u673a\u5236\u901a\u5e38\u91c7\u7528\u591a\u5b9e\u4f8b\u7684\u65b9\u5f0f\u8fdb\u884c\u90e8\u7f72\uff0c\u591a\u4e2a\u54e8\u5175\u5b9e\u4f8b\u901a\u8fc7\u201c\u5c11\u6570\u670d\u4ece\u591a\u6570\u201d\u7684\u539f\u5219\uff0c\u6765\u5224\u65ad\u4e3b\u5e93\u662f\u5426\u5ba2\u89c2\u4e0b\u7ebf \u4eae\u70b9 \u54e8\u5175\u7684\u672c\u8d28\uff1a\u662f\u4e00\u4e2aredis\u5b9e\u4f8b\uff0c\u8981\u505a\u4e09\u4ef6\u4e8b\uff1a\u76d1\u63a7\u4e3b\u5e93\uff0c\u9009\u4e3e\u65b0\u4e3b\u5e93\uff0c\u901a\u77e5\u5ba2\u6237\u7aef\u548c\u4ece\u673a \u54e8\u5175\u662f\u901a\u8fc7\u5fc3\u8df3\u68c0\u6d4b\uff0c\u76d1\u63a7\u4e3b\u5e93\u72b6\u6001\uff0c\u4e3b\u5e93\u4e0b\u7ebf\u88ab\u5206\u4e3a\uff1a\u4e3b\u89c2\u4e0b\u7ebf\u548c\u5ba2\u89c2\u4e0b\u7ebf\u3001 \u54e8\u5175\u76d1\u63a7\u662f\u53ef\u80fd\u8bef\u5224\u7684\uff0c\u6240\u4ee5\u54e8\u5175\u4e00\u822c\u662f\u96c6\u7fa4\u90e8\u7f72\uff0c\u91c7\u53d6\u6295\u7968\u7684\u5f62\u5f0f\u51cf\u5c11\u8bef\u5224 \u9009\u5b9a\u65b0\u4e3b\u5e93\u89c4\u5219\u662f\u5148\u7b5b\u9009\u5728\u6253\u5206\uff0c\u5f97\u5206\u9ad8\u7684\u4f1a\u88ab\u9009\u4e3a\u65b0\u4e3b\u5e93 \u7b5b\u9009\u89c4\u5219\uff1a\u4ece\u5e93\u5f53\u524d\u7684\u7f51\u7edc\u8fde\u63a5\u72b6\u51b5\uff0c\u4ee5\u53ca\u4e4b\u524d\u7684\u7f51\u7edc\u8fde\u63a5\u72b6\u51b5\uff0c\u7b5b\u9009\u4e2d\u65ad\u6b21\u6570\u6807\u51c6\u53ef\u4ee5\u914d\u7f6e \u6253\u5206\u89c4\u5219\uff1a\u4ece\u5e93\u7684\u4f18\u5148\u7ea7\uff0c\u6570\u636e\u540c\u6b65\u72b6\u51b5\uff0cId\u53f7\u5927\u5c0f\uff0c\u53ef\u4ee5\u5206\u4e3a\u4e09\u8f6e\uff0c\u53ea\u8981\u6709\u4e00\u8f6e\u51fa\u73b0\u5f97\u5206\u9ad8\u7684\uff0c\u5c31\u80fd\u9009\u51fa \u5224\u65ad\u54ea\u4e2a\u4ece\u5e93\u7684\u6570\u636e\u540c\u6b65\u6700\u63a5\u8fd1\u4e3b\u5e93\uff0c\u4e0d\u662f\u62ff\u4ece\u5e93\u4e0e\u4e3b\u5e93\u6bd4\u8f83\uff0c\u800c\u662f\u4ece\u5e93\u4e4b\u95f4\u4e92\u76f8\u6bd4\u8f83\uff0c\u8c01\u5927\u8c01\u5c31\u662f\u6700\u63a5\u8fd1\u7684 \u672c\u8282\u4e00\u95ee \u4e3b\u4ece\u5e93\u5207\u6362\u662f\u9700\u8981\u4e00\u5b9a\u65f6\u95f4\u7684 \u3002\u6240\u4ee5\uff0c\u5728\u8fd9\u4e2a\u5207\u6362\u8fc7\u7a0b\u4e2d\uff0c\u5ba2\u6237\u7aef\u80fd\u5426\u6b63\u5e38\u5730\u8fdb\u884c\u8bf7\u6c42\u64cd\u4f5c\u5462\uff1f\u5982\u679c\u60f3\u8981\u5e94\u7528\u7a0b\u5e8f\u4e0d\u611f\u77e5\u670d\u52a1\u7684\u4e2d\u65ad\uff0c\u8fd8\u9700\u8981\u54e8\u5175\u6216\u9700\u8981\u5ba2\u6237\u7aef\u518d\u505a\u4e9b\u4ec0\u4e48\u5417 \u7edd\u5927\u90e8\u5206\u7684\u8bfb\u8bf7\u6c42\uff0c\u53ef\u4ee5\u54cd\u5e94\u3002\u7531\u4e8e\u4e3b\u5e93\u5b9e\u4f8b\u6302\u6389\uff0c\u80af\u5b9a\u6709\u5c0f\u90e8\u5206\u6570\u636e\u672a\u88ab\u540c\u6b65\u81f3\u4ece\u5b9e\u4f8b\uff0c\u800c\u8fd9\u90e8\u5206\u6570\u636e\u7684\u8bfb\u8bf7\u6c42\u662f\u5931\u8d25\u7684\u3002 \u5982\u679c\u8fd9\u5c0f\u90e8\u5206\u6570\u636e\u662f\u65b0\u5199\u6570\u636e\uff0c\u4e14\u672a\u540c\u6b65\u7684\u8bdd\uff0c\u53d1\u5f80\u4ece\u5e93\u7684\u8bfb\u8bf7\u6c42\u662f\u4f1a\u5931\u8d25\u7684\u3002\u4f46\u5982\u679c\u662f\u66f4\u65b0\u7684\u6570\u636e\uff0c\u4e14\u672a\u540c\u6b65\u7684\u8bdd\uff0c\u90a3\u4e48\u4ece\u5e93\u7684\u8bfb\u8bf7\u6c42\u4f1a\u8fd4\u56de\u65e7\u503c \u7531\u4e8e\u4e3b\u4ece\u673a\u5236\u5b9e\u73b0\u4e86\u8bfb\u5199\u5206\u79bb\uff0c\u4e3b\u5b9e\u4f8b\u6302\u6389\uff0c\u65e0\u6cd5\u54cd\u5e94\u5199\u8bf7\u6c42\u3002","title":"4\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap2/8redis_sentinel/","text":"\u7b2c\u516b\u8282 \u54e8\u5175\u96c6\u7fa4\uff1a\u54e8\u5175\u6302\u4e86\uff0c\u4e3b\u4ece\u5e93\u5207\u6362 \u4e3b\u4ece\u5e93\u7684\u81ea\u52a8\u5207\u6362\u3002\u901a\u8fc7\u90e8\u7f72\u591a\u4e2a\u5b9e\u4f8b\uff0c\u5c31\u5f62\u6210\u4e86\u4e00\u4e2a\u54e8\u5175\u96c6\u7fa4\u3002\u54e8\u5175\u96c6\u7fa4\u4e2d\u7684\u591a\u4e2a\u5b9e\u4f8b\u5171\u540c\u5224\u65ad\uff0c\u53ef\u4ee5\u964d\u4f4e\u5bf9\u4e3b\u5e93\u4e0b\u7ebf\u7684\u8bef\u5224\u7387\u3002 \u5982\u679c\u6709\u54e8\u5175\u5b9e\u4f8b\u5728\u8fd0\u884c\u65f6\u53d1\u751f\u4e86\u6545\u969c\uff0c\u4e3b\u4ece\u5e93\u8fd8\u80fd\u6b63\u5e38\u5207\u6362\u5417\uff1f \u4e00\u65e6\u591a\u4e2a\u5b9e\u4f8b\u7ec4\u6210\u4e86 \u54e8\u5175\u96c6\u7fa4 \uff0c\u5373\u4f7f\u6709\u54e8\u5175\u5b9e\u4f8b\u51fa\u73b0\u6545\u969c\u6302\u6389\u4e86\uff0c\u5176\u4ed6\u54e8\u5175\u8fd8\u80fd\u7ee7\u7eed\u534f\u4f5c\u5b8c\u6210\u4e3b\u4ece\u5e93\u5207\u6362\u7684\u5de5\u4f5c\uff0c\u5305\u62ec\u5224\u5b9a\u4e3b\u5e93\u662f\u4e0d\u662f\u5904\u4e8e\u4e0b\u7ebf\u72b6\u6001\uff0c\u9009\u62e9\u65b0\u4e3b\u5e93\uff0c\u4ee5\u53ca\u901a\u77e5\u4ece\u5e93\u548c\u5ba2\u6237\u7aef\u3002 \u7f72\u8fc7\u54e8\u5175\u96c6\u7fa4\uff0c\u914d\u7f6e\u54e8\u5175\u7684\u4fe1\u606f\uff0c \u8bbe\u7f6e\u4e3b\u5e93\u7684 IP \u548c\u7aef\u53e3 \uff0c\u5e76\u6ca1\u6709\u914d\u7f6e\u5176\u4ed6\u54e8\u5175\u7684\u8fde\u63a5\u4fe1\u606f\u3002 sentinel monitor <master-name> <ip> <redis-port> <quorum> 1\u3001\u57fa\u4e8e pub/sub \u673a\u5236\u7684\u54e8\u5175\u96c6\u7fa4\u7ec4\u6210 \u54e8\u5175\u5b9e\u4f8b\u4e4b\u95f4\u53ef\u4ee5\u76f8\u4e92\u53d1\u73b0\uff0c\u8981\u5f52\u529f\u4e8e Redis \u63d0\u4f9b\u7684 pub/sub \u673a\u5236\uff0c\u4e5f\u5c31\u662f\u53d1\u5e03 / \u8ba2\u9605\u673a\u5236\u3002 1-1 \u54e8\u5175\u53ea\u8981\u548c\u4e3b/\u4ece\u5e93\u5efa\u7acb\u8d77\u4e86\u8fde\u63a5 \u54e8\u5175\u53ea\u8981\u548c\u4e3b\u5e93\u5efa\u7acb\u8d77\u4e86\u8fde\u63a5\uff0c\u5c31\u53ef\u4ee5\u5728\u4e3b\u5e93\u4e0a\u53d1\u5e03\u6d88\u606f\u4e86\uff0c\u6bd4\u5982\u8bf4\u53d1\u5e03\u5b83\u81ea\u5df1\u7684\u8fde\u63a5\u4fe1\u606f\uff08IP \u548c\u7aef\u53e3\uff09\u3002 \u5b83\u4e5f\u53ef\u4ee5\u4ece\u4e3b\u5e93\u4e0a\u8ba2\u9605\u6d88\u606f\uff0c\u83b7\u5f97\u5176\u4ed6\u54e8\u5175\u53d1\u5e03\u7684\u8fde\u63a5\u4fe1\u606f \u3002 \u5f53\u591a\u4e2a\u54e8\u5175\u5b9e\u4f8b\u90fd\u5728\u4e3b\u5e93\u4e0a\u505a\u4e86\u53d1\u5e03\u548c\u8ba2\u9605\u64cd\u4f5c\u540e\uff0c\u5b83\u4eec\u4e4b\u95f4\u5c31\u80fd\u77e5\u9053\u5f7c\u6b64\u7684 IP \u5730\u5740\u548c\u7aef\u53e3\u3002 \u9664\u4e86\u54e8\u5175\u5b9e\u4f8b\uff0c\u6211\u4eec\u81ea\u5df1\u7f16\u5199\u7684\u5e94\u7528\u7a0b\u5e8f\u4e5f\u53ef\u4ee5\u901a\u8fc7 Redis \u8fdb\u884c\u6d88\u606f\u7684\u53d1\u5e03\u548c\u8ba2\u9605\u3002\u4e3a\u4e86\u533a\u5206\u4e0d\u540c\u5e94\u7528\u7684\u6d88\u606f\uff0c Redis \u4f1a\u4ee5\u9891\u9053\u7684\u5f62\u5f0f\uff0c\u5bf9\u8fd9\u4e9b\u6d88\u606f\u8fdb\u884c\u5206\u95e8\u522b\u7c7b\u7684\u7ba1\u7406 \u3002 \u6240\u8c13\u7684\u9891\u9053\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u6d88\u606f\u7684\u7c7b\u522b\u3002\u5f53\u6d88\u606f\u7c7b\u522b\u76f8\u540c\u65f6\uff0c\u5b83\u4eec\u5c31\u5c5e\u4e8e\u540c\u4e00\u4e2a\u9891\u9053\u3002 \u53ea\u6709\u8ba2\u9605\u4e86\u540c\u4e00\u4e2a\u9891\u9053\u7684\u5e94\u7528\uff0c\u624d\u80fd\u901a\u8fc7\u53d1\u5e03\u7684\u6d88\u606f\u8fdb\u884c\u4fe1\u606f\u4ea4\u6362\u3002 \u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c\u4e3b\u5e93\u4e0a\u6709\u4e00\u4e2a\u540d\u4e3a \u201c__sentinel__:hello\u201d \u7684\u9891\u9053\uff0c\u4e0d\u540c\u54e8\u5175\u5c31\u662f\u901a\u8fc7\u5b83\u6765\u76f8\u4e92\u53d1\u73b0\uff0c\u5b9e\u73b0\u4e92\u76f8\u901a\u4fe1\u7684\u3002 \u54e8\u5175 1 \u628a\u81ea\u5df1\u7684 IP\uff08172.16.19.3\uff09\u548c\u7aef\u53e3\uff0826579\uff09\u53d1\u5e03\u5230 \u201c__sentinel__:hello\u201d \u9891\u9053\u4e0a\uff0c\u54e8\u5175 2 \u548c 3 \u8ba2\u9605\u4e86\u8be5\u9891\u9053\u3002\u90a3\u4e48\u6b64\u65f6\uff0c\u54e8\u5175 2 \u548c 3 \u5c31\u53ef\u4ee5\u4ece\u8fd9\u4e2a\u9891\u9053\u76f4\u63a5\u83b7\u53d6\u54e8\u5175 1 \u7684 IP \u5730\u5740\u548c\u7aef\u53e3\u53f7\u3002 \u54e8\u5175 2\u30013 \u53ef\u4ee5\u548c\u54e8\u5175 1 \u5efa\u7acb\u7f51\u7edc\u8fde\u63a5\u3002 \u901a\u8fc7\u8fd9\u4e2a\u65b9\u5f0f\uff0c\u54e8\u5175 2 \u548c 3 \u4e5f\u53ef\u4ee5\u5efa\u7acb\u7f51\u7edc\u8fde\u63a5\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u54e8\u5175\u96c6\u7fa4\u5c31\u5f62\u6210\u4e86\u3002 \u5b83\u4eec\u76f8\u4e92\u95f4\u53ef\u4ee5\u901a\u8fc7\u7f51\u7edc\u8fde\u63a5\u8fdb\u884c\u901a\u4fe1\uff0c\u6bd4\u5982\u8bf4\u5bf9\u4e3b\u5e93\u6709\u6ca1\u6709\u4e0b\u7ebf\u8fd9\u4ef6\u4e8b\u513f\u8fdb\u884c\u5224\u65ad\u548c\u534f\u5546\u3002 \u54e8\u5175\u9664\u4e86\u5f7c\u6b64\u4e4b\u95f4\u5efa\u7acb\u8d77\u8fde\u63a5\u5f62\u6210\u96c6\u7fa4\u5916\uff0c\u8fd8\u9700\u8981\u548c\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5\u3002 \u8fd9\u662f\u56e0\u4e3a\uff0c\u5728\u54e8\u5175\u7684\u76d1\u63a7\u4efb\u52a1\u4e2d\uff0c\u5b83\u9700\u8981\u5bf9\u4e3b\u4ece\u5e93\u90fd\u8fdb\u884c\u5fc3\u8df3\u5224\u65ad\uff0c\u800c\u4e14\u5728\u4e3b\u4ece\u5e93\u5207\u6362\u5b8c\u6210\u540e\uff0c\u5b83\u8fd8\u9700\u8981\u901a\u77e5\u4ece\u5e93\uff0c\u8ba9\u5b83\u4eec\u548c\u65b0\u4e3b\u5e93\u8fdb\u884c\u540c\u6b65\u3002 1-2 \u54e8\u5175\u662f\u5982\u4f55\u77e5\u9053\u4ece\u5e93\u7684 IP \u5730\u5740\u548c\u7aef\u53e3 \u8fd9\u662f\u7531\u54e8\u5175\u5411\u4e3b\u5e93\u53d1\u9001 INFO \u547d\u4ee4\u6765\u5b8c\u6210\u7684 \u54e8\u5175 2 \u7ed9\u4e3b\u5e93\u53d1\u9001 INFO \u547d\u4ee4\uff0c\u4e3b\u5e93\u63a5\u53d7\u5230\u8fd9\u4e2a\u547d\u4ee4\u540e\uff0c \u5c31\u4f1a\u628a\u4ece\u5e93\u5217\u8868\u8fd4\u56de\u7ed9\u54e8\u5175 \u3002 \u54e8\u5175\u5c31\u53ef\u4ee5\u6839\u636e\u4ece\u5e93\u5217\u8868\u4e2d\u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u548c\u6bcf\u4e2a\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5\uff0c\u5e76\u5728\u8fd9\u4e2a\u8fde\u63a5\u4e0a\u6301\u7eed\u5730\u5bf9\u4ece\u5e93\u8fdb\u884c\u76d1\u63a7\u3002 \u54e8\u5175 1 \u548c 3 \u53ef\u4ee5\u901a\u8fc7\u76f8\u540c\u7684\u65b9\u6cd5\u548c\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5 \u901a\u8fc7 pub/sub \u673a\u5236\uff0c\u54e8\u5175\u4e4b\u95f4\u53ef\u4ee5\u7ec4\u6210\u96c6\u7fa4\uff0c\u540c\u65f6\uff0c\u54e8\u5175\u53c8\u901a\u8fc7 INFO \u547d\u4ee4\uff0c\u83b7\u5f97\u4e86\u4ece\u5e93\u8fde\u63a5\u4fe1\u606f\uff0c\u4e5f\u80fd\u548c\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5\uff0c\u5e76\u8fdb\u884c\u76d1\u63a7\u4e86\u3002 \u54e8\u5175\u4e0d\u80fd\u53ea\u548c\u4e3b\u3001\u4ece\u5e93\u8fde\u63a5\u3002\u56e0\u4e3a\uff0c\u4e3b\u4ece\u5e93\u5207\u6362\u540e\uff0c\u5ba2\u6237\u7aef\u4e5f\u9700\u8981\u77e5\u9053\u65b0\u4e3b\u5e93\u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u624d\u80fd\u5411\u65b0\u4e3b\u5e93\u53d1\u9001\u8bf7\u6c42\u64cd\u4f5c\u3002\u6240\u4ee5\uff0c \u54e8\u5175\u8fd8\u9700\u8981\u5b8c\u6210\u628a\u65b0\u4e3b\u5e93\u7684\u4fe1\u606f\u544a\u8bc9\u5ba2\u6237\u7aef\u8fd9\u4e2a\u4efb\u52a1 \u3002 \u5ba2\u6237\u7aef\u80fd\u591f\u83b7\u53d6\u5230\u54e8\u5175\u96c6\u7fa4\u5728\u76d1\u63a7\u3001\u9009\u4e3b\u3001\u5207\u6362 \u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u53d1\u751f\u7684\u5404\u79cd\u4e8b\u4ef6\u4ecd\u7136\u53ef\u4ee5\u4f9d\u8d56 pub/sub \u673a\u5236\uff0c\u6765\u5e2e\u52a9\u6211\u4eec\u5b8c\u6210\u54e8\u5175\u548c\u5ba2\u6237\u7aef\u95f4\u7684\u4fe1\u606f\u540c\u6b65\u3002 2\u3001\u57fa\u4e8e pub/sub \u673a\u5236\u7684\u5ba2\u6237\u7aef\u4e8b\u4ef6\u901a\u77e5 \u4ece\u672c\u8d28\u4e0a\u8bf4\uff0c\u54e8\u5175\u5c31\u662f\u4e00\u4e2a\u8fd0\u884c\u5728\u7279\u5b9a\u6a21\u5f0f\u4e0b\u7684 Redis \u5b9e\u4f8b\uff0c\u53ea\u4e0d\u8fc7\u5b83\u5e76\u4e0d\u670d\u52a1\u8bf7\u6c42\u64cd\u4f5c\uff0c\u53ea\u662f\u5b8c\u6210\u76d1\u63a7\u3001\u9009\u4e3b\u548c\u901a\u77e5\u7684\u4efb\u52a1\u3002 \u6240\u4ee5\uff0c\u6bcf\u4e2a\u54e8\u5175\u5b9e\u4f8b\u4e5f\u63d0\u4f9b pub/sub \u673a\u5236\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u4ece\u54e8\u5175\u8ba2\u9605\u6d88\u606f\u3002 \u54e8\u5175\u63d0\u4f9b\u7684\u6d88\u606f\u8ba2\u9605\u9891\u9053\u6709\u5f88\u591a\uff0c\u4e0d\u540c\u9891\u9053\u5305\u542b\u4e86\u4e3b\u4ece\u5e93\u5207\u6362\u8fc7\u7a0b\u4e2d\u7684\u4e0d\u540c\u5173\u952e\u4e8b\u4ef6\u3002 \u5173\u952e\u4e8b\u4ef6\u5305\u62ec\u4e3b\u5e93\u4e0b\u7ebf\u5224\u65ad\u3001\u65b0\u4e3b\u5e93\u9009\u5b9a\u3001\u4ece\u5e93\u91cd\u65b0\u914d\u7f6e\u3002 \u8ba9\u5ba2\u6237\u7aef\u4ece\u54e8\u5175\u8fd9\u91cc\u8ba2\u9605\u6d88\u606f\u4e86\u3002 \u5177\u4f53\u7684\u64cd\u4f5c\u6b65\u9aa4\u662f\uff0c \u5ba2\u6237\u7aef\u8bfb\u53d6\u54e8\u5175\u7684\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u53ef\u4ee5\u83b7\u5f97\u54e8\u5175\u7684\u5730\u5740\u548c\u7aef\u53e3\uff0c\u548c\u54e8\u5175\u5efa\u7acb\u7f51\u7edc\u8fde\u63a5\u3002 \u7136\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u6267\u884c\u8ba2\u9605\u547d\u4ee4\uff0c\u6765\u83b7\u53d6\u4e0d\u540c\u7684\u4e8b\u4ef6\u6d88\u606f\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4f60\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u6765\u8ba2\u9605\u201c\u6240\u6709\u5b9e\u4f8b\u8fdb\u5165\u5ba2\u89c2\u4e0b\u7ebf\u72b6\u6001\u7684\u4e8b\u4ef6\u201d\uff1a SUBSCRIBE +odown \u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u8ba2\u9605\u6240\u6709\u7684\u4e8b\u4ef6\uff1a PSUBSCRIBE * \u5f53\u54e8\u5175\u628a\u65b0\u4e3b\u5e93\u9009\u62e9\u51fa\u6765\u540e\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u770b\u5230\u4e0b\u9762\u7684 switch-master \u8fd9\u4e2a\u4e8b\u4ef6\u8868\u793a\u4e3b\u5e93\u5df2\u7ecf\u5207\u6362\u4e86\uff0c\u65b0\u4e3b\u5e93\u7684 IP \u5730\u5740\u548c\u7aef\u53e3\u4fe1\u606f\u5df2\u7ecf\u6709\u4e86\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u7528\u8fd9\u91cc\u9762\u7684\u65b0\u4e3b\u5e93\u5730\u5740\u548c\u7aef\u53e3\u8fdb\u884c\u901a\u4fe1\u4e86\u3002 switch-master <master name> <oldip> <oldport> <newip> <newport> \u6709\u4e86\u8fd9\u4e9b\u4e8b\u4ef6\u901a\u77e5\uff0c\u5ba2\u6237\u7aef\u4e0d\u4ec5\u53ef\u4ee5\u5728\u4e3b\u4ece\u5207\u6362\u540e\u5f97\u5230\u65b0\u4e3b\u5e93\u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u8fd8\u53ef\u4ee5\u76d1\u63a7\u5230\u4e3b\u4ece\u5e93\u5207\u6362\u8fc7\u7a0b\u4e2d\u53d1\u751f\u7684\u5404\u4e2a\u91cd\u8981\u4e8b\u4ef6\u3002 \u6709\u4e86 pub/sub \u673a\u5236\uff0c\u54e8\u5175\u548c\u54e8\u5175\u4e4b\u95f4\u3001\u54e8\u5175\u548c\u4ece\u5e93\u4e4b\u95f4\u3001\u54e8\u5175\u548c\u5ba2\u6237\u7aef\u4e4b\u95f4\u5c31\u90fd\u80fd\u5efa\u7acb\u8d77\u8fde\u63a5\u4e86 \u8fd8\u9700\u8981\u8003\u8651\u4e00\u4e2a\u95ee\u9898\uff1a\u4e3b\u5e93\u6545\u969c\u4ee5\u540e\uff0c\u54e8\u5175\u96c6\u7fa4\u6709\u591a\u4e2a\u5b9e\u4f8b\uff0c\u90a3\u600e\u4e48\u786e\u5b9a\u7531\u54ea\u4e2a\u54e8\u5175\u6765\u8fdb\u884c\u5b9e\u9645\u7684\u4e3b\u4ece\u5207\u6362\u5462\uff1f 3\u3001\u7531\u54ea\u4e2a\u54e8\u5175\u6267\u884c\u4e3b\u4ece\u5207\u6362\uff1f \u786e\u5b9a\u7531\u54ea\u4e2a\u54e8\u5175\u6267\u884c\u4e3b\u4ece\u5207\u6362\u7684\u8fc7\u7a0b\uff0c\u548c\u4e3b\u5e93\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u7684\u5224\u65ad\u8fc7\u7a0b\u7c7b\u4f3c\uff0c\u4e5f\u662f\u4e00\u4e2a\u201c\u6295\u7968\u4ef2\u88c1\u201d\u7684\u8fc7\u7a0b \u54e8\u5175\u96c6\u7fa4\u8981\u5224\u5b9a\u4e3b\u5e93\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\uff0c\u9700\u8981\u6709\u4e00\u5b9a\u6570\u91cf\u7684\u5b9e\u4f8b\u90fd\u8ba4\u4e3a\u8be5\u4e3b\u5e93\u5df2\u7ecf\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u4e86\u3002 \u4efb\u4f55\u4e00\u4e2a\u5b9e\u4f8b\u53ea\u8981\u81ea\u8eab\u5224\u65ad\u4e3b\u5e93\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u540e \uff0c\u5c31\u4f1a\u7ed9\u5176\u4ed6\u5b9e\u4f8b\u53d1\u9001 is-master-down-by-addr \u547d\u4ee4\u3002 \u5176\u4ed6\u5b9e\u4f8b\u4f1a\u6839\u636e\u81ea\u5df1\u548c\u4e3b\u5e93\u7684\u8fde\u63a5\u60c5\u51b5\uff0c\u505a\u51fa Y \u6216 N \u7684\u54cd\u5e94\uff0cY \u76f8\u5f53\u4e8e\u8d5e\u6210\u7968\uff0cN \u76f8\u5f53\u4e8e\u53cd\u5bf9\u7968\u3002 \u4e3b\u5e93\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d: \u4e00\u4e2a\u54e8\u5175\u83b7\u5f97\u4e86\u4ef2\u88c1\u6240\u9700\u7684\u8d5e\u6210\u7968\u6570\u540e\uff0c\u5c31\u53ef\u4ee5\u6807\u8bb0\u4e3b\u5e93\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u3002 \u8fd9\u4e2a\u6240\u9700\u7684\u8d5e\u6210\u7968\u6570\u662f\u901a\u8fc7\u54e8\u5175\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 quorum \u914d\u7f6e\u9879\u8bbe\u5b9a\u7684 \u3002\u4f8b\u5982\uff0c\u73b0\u5728\u6709 5 \u4e2a\u54e8\u5175\uff0cquorum \u914d\u7f6e\u7684\u662f 3\uff0c\u90a3\u4e48\uff0c\u4e00\u4e2a\u54e8\u5175\u9700\u8981 3 \u5f20\u8d5e\u6210\u7968\uff0c\u5c31\u53ef\u4ee5\u6807\u8bb0\u4e3b\u5e93\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u4e86\u3002\u8fd9 3 \u5f20\u8d5e\u6210\u7968\u5305\u62ec\u54e8\u5175\u81ea\u5df1\u7684\u4e00\u5f20\u8d5e\u6210\u7968\u548c\u53e6\u5916\u4e24\u4e2a\u54e8\u5175\u7684\u8d5e\u6210\u7968\u3002 \u6295\u7968\u8fc7\u7a0b\u786e\u5b9a Leader: \u8fd9\u4e2a\u4e2a\u54e8\u5175\u5c31\u53ef\u4ee5\u518d\u7ed9\u5176\u4ed6\u54e8\u5175\u53d1\u9001\u547d\u4ee4\uff0c\u8868\u660e\u5e0c\u671b\u7531\u81ea\u5df1\u6765\u6267\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u5e76\u8ba9\u6240\u6709\u5176\u4ed6\u54e8\u5175\u8fdb\u884c\u6295\u7968\u3002\u8fd9\u4e2a\u6295\u7968\u8fc7\u7a0b\u79f0\u4e3a\u201cLeader \u9009\u4e3e\u201d\u3002\u56e0\u4e3a\u6700\u7ec8\u6267\u884c\u4e3b\u4ece\u5207\u6362\u7684\u54e8\u5175\u79f0\u4e3a Leader\uff0c\u6295\u7968\u8fc7\u7a0b\u5c31\u662f\u786e\u5b9a Leader\u3002 \u5728\u6295\u7968\u8fc7\u7a0b\u4e2d\uff0c\u4efb\u4f55\u4e00\u4e2a\u60f3\u6210\u4e3a Leader \u7684\u54e8\u5175\uff0c\u8981\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6\uff1a \u7b2c\u4e00\uff0c\u62ff\u5230\u534a\u6570\u4ee5\u4e0a\u7684\u8d5e\u6210\u7968\uff1b \u7b2c\u4e8c\uff0c \u62ff\u5230\u7684\u7968\u6570\u540c\u65f6\u8fd8\u9700\u8981\u5927\u4e8e\u7b49\u4e8e\u54e8\u5175\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 quorum \u503c \u3002 \u4ee5 3 \u4e2a\u54e8\u5175\u4e3a\u4f8b\uff0c\u5047\u8bbe\u6b64\u65f6\u7684 quorum \u8bbe\u7f6e\u4e3a 2\uff0c\u90a3\u4e48\uff0c\u4efb\u4f55\u4e00\u4e2a\u60f3\u6210\u4e3a Leader \u7684\u54e8\u5175\u53ea\u8981\u62ff\u5230 2 \u5f20\u8d5e\u6210\u7968\uff0c\u5c31\u53ef\u4ee5\u4e86\u3002 \u5728 T1 \u65f6\u523b\uff0cS1 \u5224\u65ad\u4e3b\u5e93\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\uff0c\u5b83\u60f3\u6210\u4e3a Leader\uff0c\u5c31\u5148\u7ed9\u81ea\u5df1\u6295\u4e00\u5f20\u8d5e\u6210\u7968\uff0c\u7136\u540e\u5206\u522b\u5411 S2 \u548c S3 \u53d1\u9001\u547d\u4ee4\uff0c\u8868\u793a\u8981\u6210\u4e3a Leader\u3002 \u5728 T2 \u65f6\u523b\uff0cS3 \u5224\u65ad\u4e3b\u5e93\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\uff0c\u5b83\u4e5f\u60f3\u6210\u4e3a Leader\uff0c\u6240\u4ee5\u4e5f\u5148\u7ed9\u81ea\u5df1\u6295\u4e00\u5f20\u8d5e\u6210\u7968\uff0c\u518d\u5206\u522b\u5411 S1 \u548c S2 \u53d1\u9001\u547d\u4ee4\uff0c\u8868\u793a\u8981\u6210\u4e3a Leader\u3002 \u5728 T3 \u65f6\u523b\uff0cS1 \u6536\u5230\u4e86 S3 \u7684 Leader \u6295\u7968\u8bf7\u6c42\u3002\u56e0\u4e3a S1 \u5df2\u7ecf\u7ed9\u81ea\u5df1\u6295\u4e86\u4e00\u7968 Y\uff0c\u6240\u4ee5\u5b83\u4e0d\u80fd\u518d\u7ed9\u5176\u4ed6\u54e8\u5175\u6295\u8d5e\u6210\u7968\u4e86\uff0c\u6240\u4ee5 S1 \u56de\u590d N \u8868\u793a\u4e0d\u540c\u610f\u3002\u540c\u65f6\uff0cS2 \u6536\u5230\u4e86 T2 \u65f6 S3 \u53d1\u9001\u7684 Leader \u6295\u7968\u8bf7\u6c42\u3002\u56e0\u4e3a S2 \u4e4b\u524d\u6ca1\u6709\u6295\u8fc7\u7968\uff0c\u5b83\u4f1a\u7ed9\u7b2c\u4e00\u4e2a\u5411\u5b83\u53d1\u9001\u6295\u7968\u8bf7\u6c42\u7684\u54e8\u5175\u56de\u590d Y\uff0c\u7ed9\u540e\u7eed\u518d\u53d1\u9001\u6295\u7968\u8bf7\u6c42\u7684\u54e8\u5175\u56de\u590d N\uff0c\u6240\u4ee5\uff0c\u5728 T3 \u65f6\uff0cS2 \u56de\u590d S3\uff0c\u540c\u610f S3 \u6210\u4e3a Leader\u3002 \u5728 T4 \u65f6\u523b\uff0cS2 \u624d\u6536\u5230 T1 \u65f6 S1 \u53d1\u9001\u7684\u6295\u7968\u547d\u4ee4\u3002\u56e0\u4e3a S2 \u5df2\u7ecf\u5728 T3 \u65f6\u540c\u610f\u4e86 S3 \u7684\u6295\u7968\u8bf7\u6c42\uff0c\u6b64\u65f6\uff0cS2 \u7ed9 S1 \u56de\u590d N\uff0c\u8868\u793a\u4e0d\u540c\u610f S1 \u6210\u4e3a Leader\u3002\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\uff0c\u662f\u56e0\u4e3a S3 \u548c S2 \u4e4b\u95f4\u7684\u7f51\u7edc\u4f20\u8f93\u6b63\u5e38\uff0c \u800c S1 \u548c S2 \u4e4b\u95f4\u7684\u7f51\u7edc\u4f20\u8f93\u53ef\u80fd\u6b63\u597d\u62e5\u585e\u4e86\uff0c\u5bfc\u81f4\u6295\u7968\u8bf7\u6c42\u4f20\u8f93\u6162\u4e86 \u3002 \u5728 T5 \u65f6\u523b\uff0cS1 \u5f97\u5230\u7684\u7968\u6570\u662f\u6765\u81ea\u5b83\u81ea\u5df1\u7684\u4e00\u7968 Y \u548c\u6765\u81ea S2 \u7684\u4e00\u7968 N\u3002\u800c S3 \u9664\u4e86\u81ea\u5df1\u7684\u8d5e\u6210\u7968 Y \u4ee5\u5916\uff0c\u8fd8\u6536\u5230\u4e86\u6765\u81ea S2 \u7684\u4e00\u7968 Y\u3002\u6b64\u65f6\uff0cS3 \u4e0d\u4ec5\u83b7\u5f97\u4e86\u534a\u6570\u4ee5\u4e0a\u7684 Leader \u8d5e\u6210\u7968\uff0c\u4e5f\u8fbe\u5230\u9884\u8bbe\u7684 quorum \u503c\uff08quorum \u4e3a 2\uff09\uff0c\u6240\u4ee5\u5b83\u6700\u7ec8\u6210\u4e3a\u4e86 Leader S3 \u4f1a\u5f00\u59cb\u6267\u884c\u9009\u4e3b\u64cd\u4f5c\uff0c\u800c\u4e14\u5728\u9009\u5b9a\u65b0\u4e3b\u5e93\u540e\uff0c\u4f1a\u7ed9\u5176\u4ed6\u4ece\u5e93\u548c\u5ba2\u6237\u7aef\u901a\u77e5\u65b0\u4e3b\u5e93\u7684\u4fe1\u606f\u3002 \u5982\u679c S3 \u6ca1\u6709\u62ff\u5230 2 \u7968 Y\uff0c\u90a3\u4e48\u8fd9\u8f6e\u6295\u7968\u5c31\u4e0d\u4f1a\u4ea7\u751f Leader\u3002 \u54e8\u5175\u96c6\u7fa4\u4f1a\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff08\u4e5f\u5c31\u662f\u54e8\u5175\u6545\u969c\u8f6c\u79fb\u8d85\u65f6\u65f6\u95f4\u7684 2 \u500d\uff09\uff0c\u518d\u91cd\u65b0\u9009\u4e3e \u3002 \u8fd9\u662f\u56e0\u4e3a\uff0c\u54e8\u5175\u96c6\u7fa4\u80fd\u591f\u8fdb\u884c\u6210\u529f\u6295\u7968\uff0c\u5f88\u5927\u7a0b\u5ea6\u4e0a\u4f9d\u8d56\u4e8e\u9009\u4e3e\u547d\u4ee4\u7684\u6b63\u5e38\u7f51\u7edc\u4f20\u64ad\u3002 \u5982\u679c\u7f51\u7edc\u538b\u529b\u8f83\u5927\u6216\u6709\u77ed\u65f6\u5835\u585e\uff0c\u5c31\u53ef\u80fd\u5bfc\u81f4\u6ca1\u6709\u4e00\u4e2a\u54e8\u5175\u80fd\u62ff\u5230\u534a\u6570\u4ee5\u4e0a\u7684\u8d5e\u6210\u7968\u3002\u6240\u4ee5\uff0c\u7b49\u5230\u7f51\u7edc\u62e5\u585e\u597d\u8f6c\u4e4b\u540e\uff0c\u518d\u8fdb\u884c\u6295\u7968\u9009\u4e3e\uff0c\u6210\u529f\u7684\u6982\u7387\u5c31\u4f1a\u589e\u52a0\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f \u5982\u679c\u54e8\u5175\u96c6\u7fa4\u53ea\u6709 2 \u4e2a\u5b9e\u4f8b\uff0c\u6b64\u65f6\uff0c\u4e00\u4e2a\u54e8\u5175\u8981\u60f3\u6210\u4e3a Leader\uff0c\u5fc5\u987b\u83b7\u5f97 2 \u7968\uff0c\u800c\u4e0d\u662f 1 \u7968\u3002\u6240\u4ee5\uff0c\u5982\u679c\u6709\u4e2a\u54e8\u5175\u6302\u6389\u4e86\uff0c\u90a3\u4e48\uff0c\u6b64\u65f6\u7684\u96c6\u7fa4\u662f\u65e0\u6cd5\u8fdb\u884c\u4e3b\u4ece\u5e93\u5207\u6362\u7684\u3002 \u56e0\u6b64\uff0c\u901a\u5e38\u6211\u4eec\u81f3\u5c11\u4f1a\u914d\u7f6e 3 \u4e2a\u54e8\u5175\u5b9e\u4f8b 4\u3001\u672c\u8282\u5c0f\u7ed3 \u4e3a\u4e86\u5b9e\u73b0\u4e3b\u4ece\u5207\u6362\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u54e8\u5175\uff1b \u4e3a\u4e86\u907f\u514d\u5355\u4e2a\u54e8\u5175\u6545\u969c\u540e\u65e0\u6cd5\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u4ee5\u53ca\u4e3a\u4e86\u51cf\u5c11\u8bef\u5224\u7387\uff0c\u53c8\u5f15\u5165\u4e86\u54e8\u5175\u96c6\u7fa4\uff1b \u54e8\u5175\u96c6\u7fa4\u53c8\u9700\u8981\u6709\u4e00\u4e9b\u673a\u5236\u6765\u652f\u6491\u5b83\u7684\u6b63\u5e38\u8fd0\u884c\u3002 \u8fd9\u8282\u8bfe\u4e0a\uff0c\u6211\u5c31\u5411\u4f60\u4ecb\u7ecd\u4e86\u652f\u6301\u54e8\u5175\u96c6\u7fa4\u7684\u8fd9\u4e9b\u5173\u952e\u673a\u5236\uff0c\u5305\u62ec\uff1a \u57fa\u4e8e pub/sub \u673a\u5236\u7684\u54e8\u5175\u96c6\u7fa4\u7ec4\u6210\u8fc7\u7a0b\uff1b \u57fa\u4e8e INFO \u547d\u4ee4\u7684\u4ece\u5e93\u5217\u8868\uff0c\u8fd9\u53ef\u4ee5\u5e2e\u52a9\u54e8\u5175\u548c\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5\uff1b \u57fa\u4e8e\u54e8\u5175\u81ea\u8eab\u7684 pub/sub \u529f\u80fd\uff0c\u8fd9\u5b9e\u73b0\u4e86\u5ba2\u6237\u7aef\u548c\u54e8\u5175\u4e4b\u95f4\u7684\u4e8b\u4ef6\u901a\u77e5\u3002 \u5bf9\u4e8e\u4e3b\u4ece\u5207\u6362\uff0c\u5f53\u7136\u4e0d\u662f\u54ea\u4e2a\u54e8\u5175\u60f3\u6267\u884c\u5c31\u53ef\u4ee5\u6267\u884c\u7684\uff0c\u5426\u5219\u5c31\u4e71\u5957\u4e86\u3002\u6240\u4ee5\uff0c\u8fd9\u5c31\u9700\u8981\u54e8\u5175\u96c6\u7fa4\u5728\u5224\u65ad\u4e86\u4e3b\u5e93\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u540e\uff0c\u7ecf\u8fc7\u6295\u7968\u4ef2\u88c1\uff0c\u9009\u4e3e\u4e00\u4e2a Leader \u51fa\u6765\uff0c\u7531\u5b83\u8d1f\u8d23\u5b9e\u9645\u7684\u4e3b\u4ece\u5207\u6362\uff0c\u5373\u7531\u5b83\u6765\u5b8c\u6210\u65b0\u4e3b\u5e93\u7684\u9009\u62e9\u4ee5\u53ca\u901a\u77e5\u4ece\u5e93\u4e0e\u5ba2\u6237\u7aef\u3002 \u8981\u4fdd\u8bc1\u6240\u6709\u54e8\u5175\u5b9e\u4f8b\u7684\u914d\u7f6e\u662f\u4e00\u81f4\u7684\uff0c\u5c24\u5176\u662f\u4e3b\u89c2\u4e0b\u7ebf\u7684\u5224\u65ad\u503c down-after-milliseconds\u3002 down-after-milliseconds \u662f\u6211\u4eec\u8ba4\u5b9a\u4e3b\u4ece\u5e93\u65ad\u8fde\u7684\u6700\u5927\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4 \u56e0\u4e3a\u8fd9\u4e2a\u503c\u5728\u4e0d\u540c\u7684\u54e8\u5175\u5b9e\u4f8b\u4e0a\u914d\u7f6e\u4e0d\u4e00\u81f4\uff0c\u5bfc\u81f4\u54e8\u5175\u96c6\u7fa4\u4e00\u76f4\u6ca1\u6709\u5bf9\u6709\u6545\u969c\u7684\u4e3b\u5e93\u5f62\u6210\u5171\u8bc6\uff0c\u4e5f\u5c31\u6ca1\u6709\u53ca\u65f6\u5207\u6362\u4e3b\u5e93\uff0c\u6700\u7ec8\u7684\u7ed3\u679c\u5c31\u662f\u96c6\u7fa4\u670d\u52a1\u4e0d\u7a33\u5b9a\u3002 \u54e8\u5175\u96c6\u7fa4\u7684\u5de5\u4f5c\u673a\u5236 \u54e8\u5175\u4e4b\u95f4\u4e92\u901a\u673a\u5236\uff1a\u57fa\u4e8epub/sub\u673a\u5236\uff0c\u5728\u4e3b\u5e93\u4e2d\u6709\u4e00\u4e2a \"__sentinel__:hello\" \u7684\u9891\u9053\uff0c\u54e8\u5175\u4e4b\u95f4\u4e92\u76f8\u53d1\u73b0\u901a\u4fe1 \u54e8\u5175\u4e0e\u4e3b\u4ece\u5e93\u4e92\u901a\u673a\u5236\uff1a\u54e8\u5175\u5411\u4e3b\u5e93\u53d1\u9001INFO\u6307\u4ee4\uff0c\u53ef\u4ee5\u83b7\u53d6\u6240\u6709\u4ece\u5e93\u7684\u4fe1\u606f\uff0c\u5b9e\u73b0\u5bf9\u4e3b\u5e93\uff0c\u4ece\u5e93\u7684\u76d1\u63a7 \u54e8\u5175\u5224\u5b9a\u4e3b\u5e93\u5f02\u5e38\u673a\u5236\uff1a \u54e8\u5175\u96c6\u7fa4\u4e2d\u4efb\u610f\u4e00\u4e2a\u5b9e\u4f8b\u90fd\u53ef\u4ee5\u53d1\u8d77\u4e3b\u5e93\u5f02\u5e38\u201c\u6295\u7968\u4ef2\u88c1\u201d\u6d41\u7a0b \u54e8\u5175\u4e4b\u95f4\u7684\u4e92\u52a8\u662f\u901a\u8fc7\u53d1\u5e03\u8ba2\u9605\u673a\u5236\u5b8c\u6210\u7684\uff0c\u5229\u7528\u81ea\u8eab\u7684\u7279\u6027\u6765\u5b9e\u73b0\u3002 \u54e8\u5175\u4e4b\u95f4\u901a\u4fe1\u4e0d\u662f\u54e8\u5175\u4e4b\u95f4\u4e4b\u95f4\u8054\u7cfb\uff0c\u800c\u662f\u901a\u8fc7\u8ba2\u9605\u4e3b\u5e93\u7684\u540c\u4e00\u9891\u9053\u6765\u83b7\u53d6\u5f7c\u6b64\u7684\u4fe1\u606f \u54e8\u5175\u662f\u901a\u8fc7INFO\u6307\u4ee4\uff0c\u4ece\u4e3b\u5e93\u83b7\u53d6\u4ece\u5e93\u4fe1\u606f\uff0c\u5e76\u4e0e\u6bcf\u4e2a\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5\uff0c\u76d1\u63a7\u6240\u6709\u4e3b\u4ece\u5e93\u72b6\u6001 \u54e8\u5175\u662f\u4e00\u4e2a\u7279\u6b8a\u7684redis\u5b9e\u4f8b\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u53ef\u4ee5\u8ba2\u9605\u54e8\u5175\u7684\u6307\u5b9a\u9891\u9053\u83b7\u5f97redis\u4e3b\u4ece\u5e93\u7684\u4fe1\u606f \u54e8\u5175\u96c6\u7fa4\u6267\u884c\u4e3b\u4ece\u5207\u6362\u673a\u5236\uff1a\u8c01\u53d1\u73b0\uff0c\u8c01\u5c31\u53d1\u8d77\u6295\u7968\u6d41\u7a0b\uff0c\u8c01\u83b7\u5f97\u591a\u6570\u7968\uff0c\u8c01\u5c31\u662f\u54e8\u5175Leader\uff0c\u7531Leader\u8d1f\u8d23\u4e3b\u4ece\u5e93\u5207\u6362 \u54e8\u5175\u96c6\u7fa4Leader\u9009\u4e3e\u6210\u529f\u4e0e\u5426\uff0c\u4f9d\u8d56\u4e8e\u7f51\u7edc\u901a\u4fe1\u72b6\u51b5\uff0c\u7f51\u7edc\u62e5\u585e\u4f1a\u5bfc\u81f4\u9009\u4e3e\u5931\u8d25\uff0c\u91cd\u65b0\u8fdb\u884c\u65b0\u4e00\u8f6e\u9009\u4e3e \u672c\u8282\u4e00\u95ee \u5047\u8bbe\u6709\u4e00\u4e2a Redis \u96c6\u7fa4\uff0c\u662f\u201c\u4e00\u4e3b\u56db\u4ece\u201d\uff0c\u540c\u65f6\u914d\u7f6e\u4e86\u5305\u542b 5 \u4e2a\u54e8\u5175\u5b9e\u4f8b\u7684\u96c6\u7fa4\uff0cquorum \u503c\u8bbe\u4e3a 2\u3002\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u6709 3 \u4e2a\u54e8\u5175\u5b9e\u4f8b\u90fd\u53d1\u751f\u6545\u969c\u4e86\uff0c\u6b64\u65f6\uff0cRedis \u4e3b\u5e93\u5982\u679c\u6709\u6545\u969c\uff0c\u8fd8\u80fd\u6b63\u786e\u5730\u5224\u65ad\u4e3b\u5e93\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u5417\uff1f\u5982\u679c\u53ef\u4ee5\u7684\u8bdd\uff0c\u8fd8\u80fd\u8fdb\u884c\u4e3b\u4ece\u5e93\u81ea\u52a8\u5207\u6362\u5417\uff1f \u6b64\u5916\uff0c\u54e8\u5175\u5b9e\u4f8b\u662f\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\u5462\uff0c\u5982\u679c\u540c\u65f6\u8c03\u5927 down-after-milliseconds \u503c\uff0c\u5bf9\u51cf\u5c11\u8bef\u5224\u662f\u4e0d\u662f\u4e5f\u6709\u597d\u5904\u5462\uff1f \u54e8\u5175\u5b9e\u4f8b\u662f\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\uff1f \u5e76\u4e0d\u662f\uff0c\u6211\u4eec\u4e5f\u770b\u5230\u4e86\uff0c\u54e8\u5175\u5728\u5224\u5b9a\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u548c\u9009\u4e3e\u201c\u54e8\u5175\u9886\u5bfc\u8005\u201d\u65f6\uff0c\u90fd\u9700\u8981\u548c\u5176\u4ed6\u8282\u70b9\u8fdb\u884c\u901a\u4fe1\uff0c\u4ea4\u6362\u4fe1\u606f\uff0c\u54e8\u5175\u5b9e\u4f8b\u8d8a\u591a\uff0c\u901a\u4fe1\u7684\u6b21\u6570\u4e5f\u5c31\u8d8a\u591a\uff0c\u800c\u4e14\u90e8\u7f72\u591a\u4e2a\u54e8\u5175\u65f6\uff0c\u4f1a\u5206\u5e03\u5728\u4e0d\u540c\u673a\u5668\u4e0a\uff0c\u8282\u70b9\u8d8a\u591a\u5e26\u6765\u7684\u673a\u5668\u6545\u969c\u98ce\u9669\u4e5f\u4f1a\u8d8a\u5927\uff0c\u8fd9\u4e9b\u95ee\u9898\u90fd\u4f1a\u5f71\u54cd\u5230\u54e8\u5175\u7684\u901a\u4fe1\u548c\u9009\u4e3e\uff0c\u51fa\u95ee\u9898\u65f6\u4e5f\u5c31\u610f\u5473\u7740\u9009\u4e3e\u65f6\u95f4\u4f1a\u53d8\u957f\uff0c\u5207\u6362\u4e3b\u4ece\u7684\u65f6\u95f4\u53d8\u4e45\u3002 \u8c03\u5927down-after-milliseconds\u503c\uff0c\u5bf9\u51cf\u5c11\u8bef\u5224\u662f\u4e0d\u662f\u6709\u597d\u5904 \uff1f \u662f\u6709\u597d\u5904\u7684\uff0c\u9002\u5f53\u8c03\u5927down-after-milliseconds\u503c\uff0c\u5f53\u54e8\u5175\u4e0e\u4e3b\u5e93\u4e4b\u95f4\u7f51\u7edc\u5b58\u5728\u77ed\u65f6\u6ce2\u52a8\u65f6\uff0c\u53ef\u4ee5\u964d\u4f4e\u8bef\u5224\u7684\u6982\u7387\u3002\u4f46\u662f\u8c03\u5927down-after-milliseconds\u503c\u4e5f\u610f\u5473\u7740\u4e3b\u4ece\u5207\u6362\u7684\u65f6\u95f4\u4f1a\u53d8\u957f\uff0c\u5bf9\u4e1a\u52a1\u7684\u5f71\u54cd\u65f6\u95f4\u8d8a\u4e45\uff0c\u6211\u4eec\u9700\u8981\u6839\u636e\u5b9e\u9645\u573a\u666f\u8fdb\u884c\u6743\u8861\uff0c\u8bbe\u7f6e\u5408\u7406\u7684\u9608\u503c\u3002","title":"\u7b2c\u516b\u8282\t\u54e8\u5175\u96c6\u7fa4\uff1a\u54e8\u5175\u6302\u4e86\uff0c\u4e3b\u4ece\u5e93\u5207\u6362"},{"location":"chap2/8redis_sentinel/#_1","text":"\u4e3b\u4ece\u5e93\u7684\u81ea\u52a8\u5207\u6362\u3002\u901a\u8fc7\u90e8\u7f72\u591a\u4e2a\u5b9e\u4f8b\uff0c\u5c31\u5f62\u6210\u4e86\u4e00\u4e2a\u54e8\u5175\u96c6\u7fa4\u3002\u54e8\u5175\u96c6\u7fa4\u4e2d\u7684\u591a\u4e2a\u5b9e\u4f8b\u5171\u540c\u5224\u65ad\uff0c\u53ef\u4ee5\u964d\u4f4e\u5bf9\u4e3b\u5e93\u4e0b\u7ebf\u7684\u8bef\u5224\u7387\u3002 \u5982\u679c\u6709\u54e8\u5175\u5b9e\u4f8b\u5728\u8fd0\u884c\u65f6\u53d1\u751f\u4e86\u6545\u969c\uff0c\u4e3b\u4ece\u5e93\u8fd8\u80fd\u6b63\u5e38\u5207\u6362\u5417\uff1f \u4e00\u65e6\u591a\u4e2a\u5b9e\u4f8b\u7ec4\u6210\u4e86 \u54e8\u5175\u96c6\u7fa4 \uff0c\u5373\u4f7f\u6709\u54e8\u5175\u5b9e\u4f8b\u51fa\u73b0\u6545\u969c\u6302\u6389\u4e86\uff0c\u5176\u4ed6\u54e8\u5175\u8fd8\u80fd\u7ee7\u7eed\u534f\u4f5c\u5b8c\u6210\u4e3b\u4ece\u5e93\u5207\u6362\u7684\u5de5\u4f5c\uff0c\u5305\u62ec\u5224\u5b9a\u4e3b\u5e93\u662f\u4e0d\u662f\u5904\u4e8e\u4e0b\u7ebf\u72b6\u6001\uff0c\u9009\u62e9\u65b0\u4e3b\u5e93\uff0c\u4ee5\u53ca\u901a\u77e5\u4ece\u5e93\u548c\u5ba2\u6237\u7aef\u3002 \u7f72\u8fc7\u54e8\u5175\u96c6\u7fa4\uff0c\u914d\u7f6e\u54e8\u5175\u7684\u4fe1\u606f\uff0c \u8bbe\u7f6e\u4e3b\u5e93\u7684 IP \u548c\u7aef\u53e3 \uff0c\u5e76\u6ca1\u6709\u914d\u7f6e\u5176\u4ed6\u54e8\u5175\u7684\u8fde\u63a5\u4fe1\u606f\u3002 sentinel monitor <master-name> <ip> <redis-port> <quorum>","title":"\u7b2c\u516b\u8282 \u54e8\u5175\u96c6\u7fa4\uff1a\u54e8\u5175\u6302\u4e86\uff0c\u4e3b\u4ece\u5e93\u5207\u6362"},{"location":"chap2/8redis_sentinel/#1-pubsub","text":"\u54e8\u5175\u5b9e\u4f8b\u4e4b\u95f4\u53ef\u4ee5\u76f8\u4e92\u53d1\u73b0\uff0c\u8981\u5f52\u529f\u4e8e Redis \u63d0\u4f9b\u7684 pub/sub \u673a\u5236\uff0c\u4e5f\u5c31\u662f\u53d1\u5e03 / \u8ba2\u9605\u673a\u5236\u3002","title":"1\u3001\u57fa\u4e8e pub/sub \u673a\u5236\u7684\u54e8\u5175\u96c6\u7fa4\u7ec4\u6210"},{"location":"chap2/8redis_sentinel/#1-1","text":"\u54e8\u5175\u53ea\u8981\u548c\u4e3b\u5e93\u5efa\u7acb\u8d77\u4e86\u8fde\u63a5\uff0c\u5c31\u53ef\u4ee5\u5728\u4e3b\u5e93\u4e0a\u53d1\u5e03\u6d88\u606f\u4e86\uff0c\u6bd4\u5982\u8bf4\u53d1\u5e03\u5b83\u81ea\u5df1\u7684\u8fde\u63a5\u4fe1\u606f\uff08IP \u548c\u7aef\u53e3\uff09\u3002 \u5b83\u4e5f\u53ef\u4ee5\u4ece\u4e3b\u5e93\u4e0a\u8ba2\u9605\u6d88\u606f\uff0c\u83b7\u5f97\u5176\u4ed6\u54e8\u5175\u53d1\u5e03\u7684\u8fde\u63a5\u4fe1\u606f \u3002 \u5f53\u591a\u4e2a\u54e8\u5175\u5b9e\u4f8b\u90fd\u5728\u4e3b\u5e93\u4e0a\u505a\u4e86\u53d1\u5e03\u548c\u8ba2\u9605\u64cd\u4f5c\u540e\uff0c\u5b83\u4eec\u4e4b\u95f4\u5c31\u80fd\u77e5\u9053\u5f7c\u6b64\u7684 IP \u5730\u5740\u548c\u7aef\u53e3\u3002 \u9664\u4e86\u54e8\u5175\u5b9e\u4f8b\uff0c\u6211\u4eec\u81ea\u5df1\u7f16\u5199\u7684\u5e94\u7528\u7a0b\u5e8f\u4e5f\u53ef\u4ee5\u901a\u8fc7 Redis \u8fdb\u884c\u6d88\u606f\u7684\u53d1\u5e03\u548c\u8ba2\u9605\u3002\u4e3a\u4e86\u533a\u5206\u4e0d\u540c\u5e94\u7528\u7684\u6d88\u606f\uff0c Redis \u4f1a\u4ee5\u9891\u9053\u7684\u5f62\u5f0f\uff0c\u5bf9\u8fd9\u4e9b\u6d88\u606f\u8fdb\u884c\u5206\u95e8\u522b\u7c7b\u7684\u7ba1\u7406 \u3002 \u6240\u8c13\u7684\u9891\u9053\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u6d88\u606f\u7684\u7c7b\u522b\u3002\u5f53\u6d88\u606f\u7c7b\u522b\u76f8\u540c\u65f6\uff0c\u5b83\u4eec\u5c31\u5c5e\u4e8e\u540c\u4e00\u4e2a\u9891\u9053\u3002 \u53ea\u6709\u8ba2\u9605\u4e86\u540c\u4e00\u4e2a\u9891\u9053\u7684\u5e94\u7528\uff0c\u624d\u80fd\u901a\u8fc7\u53d1\u5e03\u7684\u6d88\u606f\u8fdb\u884c\u4fe1\u606f\u4ea4\u6362\u3002 \u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c\u4e3b\u5e93\u4e0a\u6709\u4e00\u4e2a\u540d\u4e3a \u201c__sentinel__:hello\u201d \u7684\u9891\u9053\uff0c\u4e0d\u540c\u54e8\u5175\u5c31\u662f\u901a\u8fc7\u5b83\u6765\u76f8\u4e92\u53d1\u73b0\uff0c\u5b9e\u73b0\u4e92\u76f8\u901a\u4fe1\u7684\u3002 \u54e8\u5175 1 \u628a\u81ea\u5df1\u7684 IP\uff08172.16.19.3\uff09\u548c\u7aef\u53e3\uff0826579\uff09\u53d1\u5e03\u5230 \u201c__sentinel__:hello\u201d \u9891\u9053\u4e0a\uff0c\u54e8\u5175 2 \u548c 3 \u8ba2\u9605\u4e86\u8be5\u9891\u9053\u3002\u90a3\u4e48\u6b64\u65f6\uff0c\u54e8\u5175 2 \u548c 3 \u5c31\u53ef\u4ee5\u4ece\u8fd9\u4e2a\u9891\u9053\u76f4\u63a5\u83b7\u53d6\u54e8\u5175 1 \u7684 IP \u5730\u5740\u548c\u7aef\u53e3\u53f7\u3002 \u54e8\u5175 2\u30013 \u53ef\u4ee5\u548c\u54e8\u5175 1 \u5efa\u7acb\u7f51\u7edc\u8fde\u63a5\u3002 \u901a\u8fc7\u8fd9\u4e2a\u65b9\u5f0f\uff0c\u54e8\u5175 2 \u548c 3 \u4e5f\u53ef\u4ee5\u5efa\u7acb\u7f51\u7edc\u8fde\u63a5\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u54e8\u5175\u96c6\u7fa4\u5c31\u5f62\u6210\u4e86\u3002 \u5b83\u4eec\u76f8\u4e92\u95f4\u53ef\u4ee5\u901a\u8fc7\u7f51\u7edc\u8fde\u63a5\u8fdb\u884c\u901a\u4fe1\uff0c\u6bd4\u5982\u8bf4\u5bf9\u4e3b\u5e93\u6709\u6ca1\u6709\u4e0b\u7ebf\u8fd9\u4ef6\u4e8b\u513f\u8fdb\u884c\u5224\u65ad\u548c\u534f\u5546\u3002 \u54e8\u5175\u9664\u4e86\u5f7c\u6b64\u4e4b\u95f4\u5efa\u7acb\u8d77\u8fde\u63a5\u5f62\u6210\u96c6\u7fa4\u5916\uff0c\u8fd8\u9700\u8981\u548c\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5\u3002 \u8fd9\u662f\u56e0\u4e3a\uff0c\u5728\u54e8\u5175\u7684\u76d1\u63a7\u4efb\u52a1\u4e2d\uff0c\u5b83\u9700\u8981\u5bf9\u4e3b\u4ece\u5e93\u90fd\u8fdb\u884c\u5fc3\u8df3\u5224\u65ad\uff0c\u800c\u4e14\u5728\u4e3b\u4ece\u5e93\u5207\u6362\u5b8c\u6210\u540e\uff0c\u5b83\u8fd8\u9700\u8981\u901a\u77e5\u4ece\u5e93\uff0c\u8ba9\u5b83\u4eec\u548c\u65b0\u4e3b\u5e93\u8fdb\u884c\u540c\u6b65\u3002","title":"1-1 \u54e8\u5175\u53ea\u8981\u548c\u4e3b/\u4ece\u5e93\u5efa\u7acb\u8d77\u4e86\u8fde\u63a5"},{"location":"chap2/8redis_sentinel/#1-2-ip","text":"\u8fd9\u662f\u7531\u54e8\u5175\u5411\u4e3b\u5e93\u53d1\u9001 INFO \u547d\u4ee4\u6765\u5b8c\u6210\u7684 \u54e8\u5175 2 \u7ed9\u4e3b\u5e93\u53d1\u9001 INFO \u547d\u4ee4\uff0c\u4e3b\u5e93\u63a5\u53d7\u5230\u8fd9\u4e2a\u547d\u4ee4\u540e\uff0c \u5c31\u4f1a\u628a\u4ece\u5e93\u5217\u8868\u8fd4\u56de\u7ed9\u54e8\u5175 \u3002 \u54e8\u5175\u5c31\u53ef\u4ee5\u6839\u636e\u4ece\u5e93\u5217\u8868\u4e2d\u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u548c\u6bcf\u4e2a\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5\uff0c\u5e76\u5728\u8fd9\u4e2a\u8fde\u63a5\u4e0a\u6301\u7eed\u5730\u5bf9\u4ece\u5e93\u8fdb\u884c\u76d1\u63a7\u3002 \u54e8\u5175 1 \u548c 3 \u53ef\u4ee5\u901a\u8fc7\u76f8\u540c\u7684\u65b9\u6cd5\u548c\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5 \u901a\u8fc7 pub/sub \u673a\u5236\uff0c\u54e8\u5175\u4e4b\u95f4\u53ef\u4ee5\u7ec4\u6210\u96c6\u7fa4\uff0c\u540c\u65f6\uff0c\u54e8\u5175\u53c8\u901a\u8fc7 INFO \u547d\u4ee4\uff0c\u83b7\u5f97\u4e86\u4ece\u5e93\u8fde\u63a5\u4fe1\u606f\uff0c\u4e5f\u80fd\u548c\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5\uff0c\u5e76\u8fdb\u884c\u76d1\u63a7\u4e86\u3002 \u54e8\u5175\u4e0d\u80fd\u53ea\u548c\u4e3b\u3001\u4ece\u5e93\u8fde\u63a5\u3002\u56e0\u4e3a\uff0c\u4e3b\u4ece\u5e93\u5207\u6362\u540e\uff0c\u5ba2\u6237\u7aef\u4e5f\u9700\u8981\u77e5\u9053\u65b0\u4e3b\u5e93\u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u624d\u80fd\u5411\u65b0\u4e3b\u5e93\u53d1\u9001\u8bf7\u6c42\u64cd\u4f5c\u3002\u6240\u4ee5\uff0c \u54e8\u5175\u8fd8\u9700\u8981\u5b8c\u6210\u628a\u65b0\u4e3b\u5e93\u7684\u4fe1\u606f\u544a\u8bc9\u5ba2\u6237\u7aef\u8fd9\u4e2a\u4efb\u52a1 \u3002 \u5ba2\u6237\u7aef\u80fd\u591f\u83b7\u53d6\u5230\u54e8\u5175\u96c6\u7fa4\u5728\u76d1\u63a7\u3001\u9009\u4e3b\u3001\u5207\u6362 \u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u53d1\u751f\u7684\u5404\u79cd\u4e8b\u4ef6\u4ecd\u7136\u53ef\u4ee5\u4f9d\u8d56 pub/sub \u673a\u5236\uff0c\u6765\u5e2e\u52a9\u6211\u4eec\u5b8c\u6210\u54e8\u5175\u548c\u5ba2\u6237\u7aef\u95f4\u7684\u4fe1\u606f\u540c\u6b65\u3002","title":"1-2 \u54e8\u5175\u662f\u5982\u4f55\u77e5\u9053\u4ece\u5e93\u7684 IP \u5730\u5740\u548c\u7aef\u53e3"},{"location":"chap2/8redis_sentinel/#2-pubsub","text":"\u4ece\u672c\u8d28\u4e0a\u8bf4\uff0c\u54e8\u5175\u5c31\u662f\u4e00\u4e2a\u8fd0\u884c\u5728\u7279\u5b9a\u6a21\u5f0f\u4e0b\u7684 Redis \u5b9e\u4f8b\uff0c\u53ea\u4e0d\u8fc7\u5b83\u5e76\u4e0d\u670d\u52a1\u8bf7\u6c42\u64cd\u4f5c\uff0c\u53ea\u662f\u5b8c\u6210\u76d1\u63a7\u3001\u9009\u4e3b\u548c\u901a\u77e5\u7684\u4efb\u52a1\u3002 \u6240\u4ee5\uff0c\u6bcf\u4e2a\u54e8\u5175\u5b9e\u4f8b\u4e5f\u63d0\u4f9b pub/sub \u673a\u5236\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u4ece\u54e8\u5175\u8ba2\u9605\u6d88\u606f\u3002 \u54e8\u5175\u63d0\u4f9b\u7684\u6d88\u606f\u8ba2\u9605\u9891\u9053\u6709\u5f88\u591a\uff0c\u4e0d\u540c\u9891\u9053\u5305\u542b\u4e86\u4e3b\u4ece\u5e93\u5207\u6362\u8fc7\u7a0b\u4e2d\u7684\u4e0d\u540c\u5173\u952e\u4e8b\u4ef6\u3002 \u5173\u952e\u4e8b\u4ef6\u5305\u62ec\u4e3b\u5e93\u4e0b\u7ebf\u5224\u65ad\u3001\u65b0\u4e3b\u5e93\u9009\u5b9a\u3001\u4ece\u5e93\u91cd\u65b0\u914d\u7f6e\u3002 \u8ba9\u5ba2\u6237\u7aef\u4ece\u54e8\u5175\u8fd9\u91cc\u8ba2\u9605\u6d88\u606f\u4e86\u3002 \u5177\u4f53\u7684\u64cd\u4f5c\u6b65\u9aa4\u662f\uff0c \u5ba2\u6237\u7aef\u8bfb\u53d6\u54e8\u5175\u7684\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u53ef\u4ee5\u83b7\u5f97\u54e8\u5175\u7684\u5730\u5740\u548c\u7aef\u53e3\uff0c\u548c\u54e8\u5175\u5efa\u7acb\u7f51\u7edc\u8fde\u63a5\u3002 \u7136\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u6267\u884c\u8ba2\u9605\u547d\u4ee4\uff0c\u6765\u83b7\u53d6\u4e0d\u540c\u7684\u4e8b\u4ef6\u6d88\u606f\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4f60\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u6765\u8ba2\u9605\u201c\u6240\u6709\u5b9e\u4f8b\u8fdb\u5165\u5ba2\u89c2\u4e0b\u7ebf\u72b6\u6001\u7684\u4e8b\u4ef6\u201d\uff1a SUBSCRIBE +odown \u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u8ba2\u9605\u6240\u6709\u7684\u4e8b\u4ef6\uff1a PSUBSCRIBE * \u5f53\u54e8\u5175\u628a\u65b0\u4e3b\u5e93\u9009\u62e9\u51fa\u6765\u540e\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u770b\u5230\u4e0b\u9762\u7684 switch-master \u8fd9\u4e2a\u4e8b\u4ef6\u8868\u793a\u4e3b\u5e93\u5df2\u7ecf\u5207\u6362\u4e86\uff0c\u65b0\u4e3b\u5e93\u7684 IP \u5730\u5740\u548c\u7aef\u53e3\u4fe1\u606f\u5df2\u7ecf\u6709\u4e86\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u7528\u8fd9\u91cc\u9762\u7684\u65b0\u4e3b\u5e93\u5730\u5740\u548c\u7aef\u53e3\u8fdb\u884c\u901a\u4fe1\u4e86\u3002 switch-master <master name> <oldip> <oldport> <newip> <newport> \u6709\u4e86\u8fd9\u4e9b\u4e8b\u4ef6\u901a\u77e5\uff0c\u5ba2\u6237\u7aef\u4e0d\u4ec5\u53ef\u4ee5\u5728\u4e3b\u4ece\u5207\u6362\u540e\u5f97\u5230\u65b0\u4e3b\u5e93\u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u8fd8\u53ef\u4ee5\u76d1\u63a7\u5230\u4e3b\u4ece\u5e93\u5207\u6362\u8fc7\u7a0b\u4e2d\u53d1\u751f\u7684\u5404\u4e2a\u91cd\u8981\u4e8b\u4ef6\u3002 \u6709\u4e86 pub/sub \u673a\u5236\uff0c\u54e8\u5175\u548c\u54e8\u5175\u4e4b\u95f4\u3001\u54e8\u5175\u548c\u4ece\u5e93\u4e4b\u95f4\u3001\u54e8\u5175\u548c\u5ba2\u6237\u7aef\u4e4b\u95f4\u5c31\u90fd\u80fd\u5efa\u7acb\u8d77\u8fde\u63a5\u4e86 \u8fd8\u9700\u8981\u8003\u8651\u4e00\u4e2a\u95ee\u9898\uff1a\u4e3b\u5e93\u6545\u969c\u4ee5\u540e\uff0c\u54e8\u5175\u96c6\u7fa4\u6709\u591a\u4e2a\u5b9e\u4f8b\uff0c\u90a3\u600e\u4e48\u786e\u5b9a\u7531\u54ea\u4e2a\u54e8\u5175\u6765\u8fdb\u884c\u5b9e\u9645\u7684\u4e3b\u4ece\u5207\u6362\u5462\uff1f","title":"2\u3001\u57fa\u4e8e pub/sub \u673a\u5236\u7684\u5ba2\u6237\u7aef\u4e8b\u4ef6\u901a\u77e5"},{"location":"chap2/8redis_sentinel/#3","text":"\u786e\u5b9a\u7531\u54ea\u4e2a\u54e8\u5175\u6267\u884c\u4e3b\u4ece\u5207\u6362\u7684\u8fc7\u7a0b\uff0c\u548c\u4e3b\u5e93\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u7684\u5224\u65ad\u8fc7\u7a0b\u7c7b\u4f3c\uff0c\u4e5f\u662f\u4e00\u4e2a\u201c\u6295\u7968\u4ef2\u88c1\u201d\u7684\u8fc7\u7a0b \u54e8\u5175\u96c6\u7fa4\u8981\u5224\u5b9a\u4e3b\u5e93\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\uff0c\u9700\u8981\u6709\u4e00\u5b9a\u6570\u91cf\u7684\u5b9e\u4f8b\u90fd\u8ba4\u4e3a\u8be5\u4e3b\u5e93\u5df2\u7ecf\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u4e86\u3002 \u4efb\u4f55\u4e00\u4e2a\u5b9e\u4f8b\u53ea\u8981\u81ea\u8eab\u5224\u65ad\u4e3b\u5e93\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u540e \uff0c\u5c31\u4f1a\u7ed9\u5176\u4ed6\u5b9e\u4f8b\u53d1\u9001 is-master-down-by-addr \u547d\u4ee4\u3002 \u5176\u4ed6\u5b9e\u4f8b\u4f1a\u6839\u636e\u81ea\u5df1\u548c\u4e3b\u5e93\u7684\u8fde\u63a5\u60c5\u51b5\uff0c\u505a\u51fa Y \u6216 N \u7684\u54cd\u5e94\uff0cY \u76f8\u5f53\u4e8e\u8d5e\u6210\u7968\uff0cN \u76f8\u5f53\u4e8e\u53cd\u5bf9\u7968\u3002 \u4e3b\u5e93\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d: \u4e00\u4e2a\u54e8\u5175\u83b7\u5f97\u4e86\u4ef2\u88c1\u6240\u9700\u7684\u8d5e\u6210\u7968\u6570\u540e\uff0c\u5c31\u53ef\u4ee5\u6807\u8bb0\u4e3b\u5e93\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u3002 \u8fd9\u4e2a\u6240\u9700\u7684\u8d5e\u6210\u7968\u6570\u662f\u901a\u8fc7\u54e8\u5175\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 quorum \u914d\u7f6e\u9879\u8bbe\u5b9a\u7684 \u3002\u4f8b\u5982\uff0c\u73b0\u5728\u6709 5 \u4e2a\u54e8\u5175\uff0cquorum \u914d\u7f6e\u7684\u662f 3\uff0c\u90a3\u4e48\uff0c\u4e00\u4e2a\u54e8\u5175\u9700\u8981 3 \u5f20\u8d5e\u6210\u7968\uff0c\u5c31\u53ef\u4ee5\u6807\u8bb0\u4e3b\u5e93\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u4e86\u3002\u8fd9 3 \u5f20\u8d5e\u6210\u7968\u5305\u62ec\u54e8\u5175\u81ea\u5df1\u7684\u4e00\u5f20\u8d5e\u6210\u7968\u548c\u53e6\u5916\u4e24\u4e2a\u54e8\u5175\u7684\u8d5e\u6210\u7968\u3002 \u6295\u7968\u8fc7\u7a0b\u786e\u5b9a Leader: \u8fd9\u4e2a\u4e2a\u54e8\u5175\u5c31\u53ef\u4ee5\u518d\u7ed9\u5176\u4ed6\u54e8\u5175\u53d1\u9001\u547d\u4ee4\uff0c\u8868\u660e\u5e0c\u671b\u7531\u81ea\u5df1\u6765\u6267\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u5e76\u8ba9\u6240\u6709\u5176\u4ed6\u54e8\u5175\u8fdb\u884c\u6295\u7968\u3002\u8fd9\u4e2a\u6295\u7968\u8fc7\u7a0b\u79f0\u4e3a\u201cLeader \u9009\u4e3e\u201d\u3002\u56e0\u4e3a\u6700\u7ec8\u6267\u884c\u4e3b\u4ece\u5207\u6362\u7684\u54e8\u5175\u79f0\u4e3a Leader\uff0c\u6295\u7968\u8fc7\u7a0b\u5c31\u662f\u786e\u5b9a Leader\u3002 \u5728\u6295\u7968\u8fc7\u7a0b\u4e2d\uff0c\u4efb\u4f55\u4e00\u4e2a\u60f3\u6210\u4e3a Leader \u7684\u54e8\u5175\uff0c\u8981\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6\uff1a \u7b2c\u4e00\uff0c\u62ff\u5230\u534a\u6570\u4ee5\u4e0a\u7684\u8d5e\u6210\u7968\uff1b \u7b2c\u4e8c\uff0c \u62ff\u5230\u7684\u7968\u6570\u540c\u65f6\u8fd8\u9700\u8981\u5927\u4e8e\u7b49\u4e8e\u54e8\u5175\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 quorum \u503c \u3002 \u4ee5 3 \u4e2a\u54e8\u5175\u4e3a\u4f8b\uff0c\u5047\u8bbe\u6b64\u65f6\u7684 quorum \u8bbe\u7f6e\u4e3a 2\uff0c\u90a3\u4e48\uff0c\u4efb\u4f55\u4e00\u4e2a\u60f3\u6210\u4e3a Leader \u7684\u54e8\u5175\u53ea\u8981\u62ff\u5230 2 \u5f20\u8d5e\u6210\u7968\uff0c\u5c31\u53ef\u4ee5\u4e86\u3002 \u5728 T1 \u65f6\u523b\uff0cS1 \u5224\u65ad\u4e3b\u5e93\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\uff0c\u5b83\u60f3\u6210\u4e3a Leader\uff0c\u5c31\u5148\u7ed9\u81ea\u5df1\u6295\u4e00\u5f20\u8d5e\u6210\u7968\uff0c\u7136\u540e\u5206\u522b\u5411 S2 \u548c S3 \u53d1\u9001\u547d\u4ee4\uff0c\u8868\u793a\u8981\u6210\u4e3a Leader\u3002 \u5728 T2 \u65f6\u523b\uff0cS3 \u5224\u65ad\u4e3b\u5e93\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\uff0c\u5b83\u4e5f\u60f3\u6210\u4e3a Leader\uff0c\u6240\u4ee5\u4e5f\u5148\u7ed9\u81ea\u5df1\u6295\u4e00\u5f20\u8d5e\u6210\u7968\uff0c\u518d\u5206\u522b\u5411 S1 \u548c S2 \u53d1\u9001\u547d\u4ee4\uff0c\u8868\u793a\u8981\u6210\u4e3a Leader\u3002 \u5728 T3 \u65f6\u523b\uff0cS1 \u6536\u5230\u4e86 S3 \u7684 Leader \u6295\u7968\u8bf7\u6c42\u3002\u56e0\u4e3a S1 \u5df2\u7ecf\u7ed9\u81ea\u5df1\u6295\u4e86\u4e00\u7968 Y\uff0c\u6240\u4ee5\u5b83\u4e0d\u80fd\u518d\u7ed9\u5176\u4ed6\u54e8\u5175\u6295\u8d5e\u6210\u7968\u4e86\uff0c\u6240\u4ee5 S1 \u56de\u590d N \u8868\u793a\u4e0d\u540c\u610f\u3002\u540c\u65f6\uff0cS2 \u6536\u5230\u4e86 T2 \u65f6 S3 \u53d1\u9001\u7684 Leader \u6295\u7968\u8bf7\u6c42\u3002\u56e0\u4e3a S2 \u4e4b\u524d\u6ca1\u6709\u6295\u8fc7\u7968\uff0c\u5b83\u4f1a\u7ed9\u7b2c\u4e00\u4e2a\u5411\u5b83\u53d1\u9001\u6295\u7968\u8bf7\u6c42\u7684\u54e8\u5175\u56de\u590d Y\uff0c\u7ed9\u540e\u7eed\u518d\u53d1\u9001\u6295\u7968\u8bf7\u6c42\u7684\u54e8\u5175\u56de\u590d N\uff0c\u6240\u4ee5\uff0c\u5728 T3 \u65f6\uff0cS2 \u56de\u590d S3\uff0c\u540c\u610f S3 \u6210\u4e3a Leader\u3002 \u5728 T4 \u65f6\u523b\uff0cS2 \u624d\u6536\u5230 T1 \u65f6 S1 \u53d1\u9001\u7684\u6295\u7968\u547d\u4ee4\u3002\u56e0\u4e3a S2 \u5df2\u7ecf\u5728 T3 \u65f6\u540c\u610f\u4e86 S3 \u7684\u6295\u7968\u8bf7\u6c42\uff0c\u6b64\u65f6\uff0cS2 \u7ed9 S1 \u56de\u590d N\uff0c\u8868\u793a\u4e0d\u540c\u610f S1 \u6210\u4e3a Leader\u3002\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\uff0c\u662f\u56e0\u4e3a S3 \u548c S2 \u4e4b\u95f4\u7684\u7f51\u7edc\u4f20\u8f93\u6b63\u5e38\uff0c \u800c S1 \u548c S2 \u4e4b\u95f4\u7684\u7f51\u7edc\u4f20\u8f93\u53ef\u80fd\u6b63\u597d\u62e5\u585e\u4e86\uff0c\u5bfc\u81f4\u6295\u7968\u8bf7\u6c42\u4f20\u8f93\u6162\u4e86 \u3002 \u5728 T5 \u65f6\u523b\uff0cS1 \u5f97\u5230\u7684\u7968\u6570\u662f\u6765\u81ea\u5b83\u81ea\u5df1\u7684\u4e00\u7968 Y \u548c\u6765\u81ea S2 \u7684\u4e00\u7968 N\u3002\u800c S3 \u9664\u4e86\u81ea\u5df1\u7684\u8d5e\u6210\u7968 Y \u4ee5\u5916\uff0c\u8fd8\u6536\u5230\u4e86\u6765\u81ea S2 \u7684\u4e00\u7968 Y\u3002\u6b64\u65f6\uff0cS3 \u4e0d\u4ec5\u83b7\u5f97\u4e86\u534a\u6570\u4ee5\u4e0a\u7684 Leader \u8d5e\u6210\u7968\uff0c\u4e5f\u8fbe\u5230\u9884\u8bbe\u7684 quorum \u503c\uff08quorum \u4e3a 2\uff09\uff0c\u6240\u4ee5\u5b83\u6700\u7ec8\u6210\u4e3a\u4e86 Leader S3 \u4f1a\u5f00\u59cb\u6267\u884c\u9009\u4e3b\u64cd\u4f5c\uff0c\u800c\u4e14\u5728\u9009\u5b9a\u65b0\u4e3b\u5e93\u540e\uff0c\u4f1a\u7ed9\u5176\u4ed6\u4ece\u5e93\u548c\u5ba2\u6237\u7aef\u901a\u77e5\u65b0\u4e3b\u5e93\u7684\u4fe1\u606f\u3002 \u5982\u679c S3 \u6ca1\u6709\u62ff\u5230 2 \u7968 Y\uff0c\u90a3\u4e48\u8fd9\u8f6e\u6295\u7968\u5c31\u4e0d\u4f1a\u4ea7\u751f Leader\u3002 \u54e8\u5175\u96c6\u7fa4\u4f1a\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff08\u4e5f\u5c31\u662f\u54e8\u5175\u6545\u969c\u8f6c\u79fb\u8d85\u65f6\u65f6\u95f4\u7684 2 \u500d\uff09\uff0c\u518d\u91cd\u65b0\u9009\u4e3e \u3002 \u8fd9\u662f\u56e0\u4e3a\uff0c\u54e8\u5175\u96c6\u7fa4\u80fd\u591f\u8fdb\u884c\u6210\u529f\u6295\u7968\uff0c\u5f88\u5927\u7a0b\u5ea6\u4e0a\u4f9d\u8d56\u4e8e\u9009\u4e3e\u547d\u4ee4\u7684\u6b63\u5e38\u7f51\u7edc\u4f20\u64ad\u3002 \u5982\u679c\u7f51\u7edc\u538b\u529b\u8f83\u5927\u6216\u6709\u77ed\u65f6\u5835\u585e\uff0c\u5c31\u53ef\u80fd\u5bfc\u81f4\u6ca1\u6709\u4e00\u4e2a\u54e8\u5175\u80fd\u62ff\u5230\u534a\u6570\u4ee5\u4e0a\u7684\u8d5e\u6210\u7968\u3002\u6240\u4ee5\uff0c\u7b49\u5230\u7f51\u7edc\u62e5\u585e\u597d\u8f6c\u4e4b\u540e\uff0c\u518d\u8fdb\u884c\u6295\u7968\u9009\u4e3e\uff0c\u6210\u529f\u7684\u6982\u7387\u5c31\u4f1a\u589e\u52a0\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f \u5982\u679c\u54e8\u5175\u96c6\u7fa4\u53ea\u6709 2 \u4e2a\u5b9e\u4f8b\uff0c\u6b64\u65f6\uff0c\u4e00\u4e2a\u54e8\u5175\u8981\u60f3\u6210\u4e3a Leader\uff0c\u5fc5\u987b\u83b7\u5f97 2 \u7968\uff0c\u800c\u4e0d\u662f 1 \u7968\u3002\u6240\u4ee5\uff0c\u5982\u679c\u6709\u4e2a\u54e8\u5175\u6302\u6389\u4e86\uff0c\u90a3\u4e48\uff0c\u6b64\u65f6\u7684\u96c6\u7fa4\u662f\u65e0\u6cd5\u8fdb\u884c\u4e3b\u4ece\u5e93\u5207\u6362\u7684\u3002 \u56e0\u6b64\uff0c\u901a\u5e38\u6211\u4eec\u81f3\u5c11\u4f1a\u914d\u7f6e 3 \u4e2a\u54e8\u5175\u5b9e\u4f8b","title":"3\u3001\u7531\u54ea\u4e2a\u54e8\u5175\u6267\u884c\u4e3b\u4ece\u5207\u6362\uff1f"},{"location":"chap2/8redis_sentinel/#4","text":"\u4e3a\u4e86\u5b9e\u73b0\u4e3b\u4ece\u5207\u6362\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u54e8\u5175\uff1b \u4e3a\u4e86\u907f\u514d\u5355\u4e2a\u54e8\u5175\u6545\u969c\u540e\u65e0\u6cd5\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u4ee5\u53ca\u4e3a\u4e86\u51cf\u5c11\u8bef\u5224\u7387\uff0c\u53c8\u5f15\u5165\u4e86\u54e8\u5175\u96c6\u7fa4\uff1b \u54e8\u5175\u96c6\u7fa4\u53c8\u9700\u8981\u6709\u4e00\u4e9b\u673a\u5236\u6765\u652f\u6491\u5b83\u7684\u6b63\u5e38\u8fd0\u884c\u3002 \u8fd9\u8282\u8bfe\u4e0a\uff0c\u6211\u5c31\u5411\u4f60\u4ecb\u7ecd\u4e86\u652f\u6301\u54e8\u5175\u96c6\u7fa4\u7684\u8fd9\u4e9b\u5173\u952e\u673a\u5236\uff0c\u5305\u62ec\uff1a \u57fa\u4e8e pub/sub \u673a\u5236\u7684\u54e8\u5175\u96c6\u7fa4\u7ec4\u6210\u8fc7\u7a0b\uff1b \u57fa\u4e8e INFO \u547d\u4ee4\u7684\u4ece\u5e93\u5217\u8868\uff0c\u8fd9\u53ef\u4ee5\u5e2e\u52a9\u54e8\u5175\u548c\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5\uff1b \u57fa\u4e8e\u54e8\u5175\u81ea\u8eab\u7684 pub/sub \u529f\u80fd\uff0c\u8fd9\u5b9e\u73b0\u4e86\u5ba2\u6237\u7aef\u548c\u54e8\u5175\u4e4b\u95f4\u7684\u4e8b\u4ef6\u901a\u77e5\u3002 \u5bf9\u4e8e\u4e3b\u4ece\u5207\u6362\uff0c\u5f53\u7136\u4e0d\u662f\u54ea\u4e2a\u54e8\u5175\u60f3\u6267\u884c\u5c31\u53ef\u4ee5\u6267\u884c\u7684\uff0c\u5426\u5219\u5c31\u4e71\u5957\u4e86\u3002\u6240\u4ee5\uff0c\u8fd9\u5c31\u9700\u8981\u54e8\u5175\u96c6\u7fa4\u5728\u5224\u65ad\u4e86\u4e3b\u5e93\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u540e\uff0c\u7ecf\u8fc7\u6295\u7968\u4ef2\u88c1\uff0c\u9009\u4e3e\u4e00\u4e2a Leader \u51fa\u6765\uff0c\u7531\u5b83\u8d1f\u8d23\u5b9e\u9645\u7684\u4e3b\u4ece\u5207\u6362\uff0c\u5373\u7531\u5b83\u6765\u5b8c\u6210\u65b0\u4e3b\u5e93\u7684\u9009\u62e9\u4ee5\u53ca\u901a\u77e5\u4ece\u5e93\u4e0e\u5ba2\u6237\u7aef\u3002 \u8981\u4fdd\u8bc1\u6240\u6709\u54e8\u5175\u5b9e\u4f8b\u7684\u914d\u7f6e\u662f\u4e00\u81f4\u7684\uff0c\u5c24\u5176\u662f\u4e3b\u89c2\u4e0b\u7ebf\u7684\u5224\u65ad\u503c down-after-milliseconds\u3002 down-after-milliseconds \u662f\u6211\u4eec\u8ba4\u5b9a\u4e3b\u4ece\u5e93\u65ad\u8fde\u7684\u6700\u5927\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4 \u56e0\u4e3a\u8fd9\u4e2a\u503c\u5728\u4e0d\u540c\u7684\u54e8\u5175\u5b9e\u4f8b\u4e0a\u914d\u7f6e\u4e0d\u4e00\u81f4\uff0c\u5bfc\u81f4\u54e8\u5175\u96c6\u7fa4\u4e00\u76f4\u6ca1\u6709\u5bf9\u6709\u6545\u969c\u7684\u4e3b\u5e93\u5f62\u6210\u5171\u8bc6\uff0c\u4e5f\u5c31\u6ca1\u6709\u53ca\u65f6\u5207\u6362\u4e3b\u5e93\uff0c\u6700\u7ec8\u7684\u7ed3\u679c\u5c31\u662f\u96c6\u7fa4\u670d\u52a1\u4e0d\u7a33\u5b9a\u3002 \u54e8\u5175\u96c6\u7fa4\u7684\u5de5\u4f5c\u673a\u5236 \u54e8\u5175\u4e4b\u95f4\u4e92\u901a\u673a\u5236\uff1a\u57fa\u4e8epub/sub\u673a\u5236\uff0c\u5728\u4e3b\u5e93\u4e2d\u6709\u4e00\u4e2a \"__sentinel__:hello\" \u7684\u9891\u9053\uff0c\u54e8\u5175\u4e4b\u95f4\u4e92\u76f8\u53d1\u73b0\u901a\u4fe1 \u54e8\u5175\u4e0e\u4e3b\u4ece\u5e93\u4e92\u901a\u673a\u5236\uff1a\u54e8\u5175\u5411\u4e3b\u5e93\u53d1\u9001INFO\u6307\u4ee4\uff0c\u53ef\u4ee5\u83b7\u53d6\u6240\u6709\u4ece\u5e93\u7684\u4fe1\u606f\uff0c\u5b9e\u73b0\u5bf9\u4e3b\u5e93\uff0c\u4ece\u5e93\u7684\u76d1\u63a7 \u54e8\u5175\u5224\u5b9a\u4e3b\u5e93\u5f02\u5e38\u673a\u5236\uff1a \u54e8\u5175\u96c6\u7fa4\u4e2d\u4efb\u610f\u4e00\u4e2a\u5b9e\u4f8b\u90fd\u53ef\u4ee5\u53d1\u8d77\u4e3b\u5e93\u5f02\u5e38\u201c\u6295\u7968\u4ef2\u88c1\u201d\u6d41\u7a0b \u54e8\u5175\u4e4b\u95f4\u7684\u4e92\u52a8\u662f\u901a\u8fc7\u53d1\u5e03\u8ba2\u9605\u673a\u5236\u5b8c\u6210\u7684\uff0c\u5229\u7528\u81ea\u8eab\u7684\u7279\u6027\u6765\u5b9e\u73b0\u3002 \u54e8\u5175\u4e4b\u95f4\u901a\u4fe1\u4e0d\u662f\u54e8\u5175\u4e4b\u95f4\u4e4b\u95f4\u8054\u7cfb\uff0c\u800c\u662f\u901a\u8fc7\u8ba2\u9605\u4e3b\u5e93\u7684\u540c\u4e00\u9891\u9053\u6765\u83b7\u53d6\u5f7c\u6b64\u7684\u4fe1\u606f \u54e8\u5175\u662f\u901a\u8fc7INFO\u6307\u4ee4\uff0c\u4ece\u4e3b\u5e93\u83b7\u53d6\u4ece\u5e93\u4fe1\u606f\uff0c\u5e76\u4e0e\u6bcf\u4e2a\u4ece\u5e93\u5efa\u7acb\u8fde\u63a5\uff0c\u76d1\u63a7\u6240\u6709\u4e3b\u4ece\u5e93\u72b6\u6001 \u54e8\u5175\u662f\u4e00\u4e2a\u7279\u6b8a\u7684redis\u5b9e\u4f8b\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u53ef\u4ee5\u8ba2\u9605\u54e8\u5175\u7684\u6307\u5b9a\u9891\u9053\u83b7\u5f97redis\u4e3b\u4ece\u5e93\u7684\u4fe1\u606f \u54e8\u5175\u96c6\u7fa4\u6267\u884c\u4e3b\u4ece\u5207\u6362\u673a\u5236\uff1a\u8c01\u53d1\u73b0\uff0c\u8c01\u5c31\u53d1\u8d77\u6295\u7968\u6d41\u7a0b\uff0c\u8c01\u83b7\u5f97\u591a\u6570\u7968\uff0c\u8c01\u5c31\u662f\u54e8\u5175Leader\uff0c\u7531Leader\u8d1f\u8d23\u4e3b\u4ece\u5e93\u5207\u6362 \u54e8\u5175\u96c6\u7fa4Leader\u9009\u4e3e\u6210\u529f\u4e0e\u5426\uff0c\u4f9d\u8d56\u4e8e\u7f51\u7edc\u901a\u4fe1\u72b6\u51b5\uff0c\u7f51\u7edc\u62e5\u585e\u4f1a\u5bfc\u81f4\u9009\u4e3e\u5931\u8d25\uff0c\u91cd\u65b0\u8fdb\u884c\u65b0\u4e00\u8f6e\u9009\u4e3e \u672c\u8282\u4e00\u95ee \u5047\u8bbe\u6709\u4e00\u4e2a Redis \u96c6\u7fa4\uff0c\u662f\u201c\u4e00\u4e3b\u56db\u4ece\u201d\uff0c\u540c\u65f6\u914d\u7f6e\u4e86\u5305\u542b 5 \u4e2a\u54e8\u5175\u5b9e\u4f8b\u7684\u96c6\u7fa4\uff0cquorum \u503c\u8bbe\u4e3a 2\u3002\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u6709 3 \u4e2a\u54e8\u5175\u5b9e\u4f8b\u90fd\u53d1\u751f\u6545\u969c\u4e86\uff0c\u6b64\u65f6\uff0cRedis \u4e3b\u5e93\u5982\u679c\u6709\u6545\u969c\uff0c\u8fd8\u80fd\u6b63\u786e\u5730\u5224\u65ad\u4e3b\u5e93\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u5417\uff1f\u5982\u679c\u53ef\u4ee5\u7684\u8bdd\uff0c\u8fd8\u80fd\u8fdb\u884c\u4e3b\u4ece\u5e93\u81ea\u52a8\u5207\u6362\u5417\uff1f \u6b64\u5916\uff0c\u54e8\u5175\u5b9e\u4f8b\u662f\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\u5462\uff0c\u5982\u679c\u540c\u65f6\u8c03\u5927 down-after-milliseconds \u503c\uff0c\u5bf9\u51cf\u5c11\u8bef\u5224\u662f\u4e0d\u662f\u4e5f\u6709\u597d\u5904\u5462\uff1f \u54e8\u5175\u5b9e\u4f8b\u662f\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\uff1f \u5e76\u4e0d\u662f\uff0c\u6211\u4eec\u4e5f\u770b\u5230\u4e86\uff0c\u54e8\u5175\u5728\u5224\u5b9a\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u548c\u9009\u4e3e\u201c\u54e8\u5175\u9886\u5bfc\u8005\u201d\u65f6\uff0c\u90fd\u9700\u8981\u548c\u5176\u4ed6\u8282\u70b9\u8fdb\u884c\u901a\u4fe1\uff0c\u4ea4\u6362\u4fe1\u606f\uff0c\u54e8\u5175\u5b9e\u4f8b\u8d8a\u591a\uff0c\u901a\u4fe1\u7684\u6b21\u6570\u4e5f\u5c31\u8d8a\u591a\uff0c\u800c\u4e14\u90e8\u7f72\u591a\u4e2a\u54e8\u5175\u65f6\uff0c\u4f1a\u5206\u5e03\u5728\u4e0d\u540c\u673a\u5668\u4e0a\uff0c\u8282\u70b9\u8d8a\u591a\u5e26\u6765\u7684\u673a\u5668\u6545\u969c\u98ce\u9669\u4e5f\u4f1a\u8d8a\u5927\uff0c\u8fd9\u4e9b\u95ee\u9898\u90fd\u4f1a\u5f71\u54cd\u5230\u54e8\u5175\u7684\u901a\u4fe1\u548c\u9009\u4e3e\uff0c\u51fa\u95ee\u9898\u65f6\u4e5f\u5c31\u610f\u5473\u7740\u9009\u4e3e\u65f6\u95f4\u4f1a\u53d8\u957f\uff0c\u5207\u6362\u4e3b\u4ece\u7684\u65f6\u95f4\u53d8\u4e45\u3002 \u8c03\u5927down-after-milliseconds\u503c\uff0c\u5bf9\u51cf\u5c11\u8bef\u5224\u662f\u4e0d\u662f\u6709\u597d\u5904 \uff1f \u662f\u6709\u597d\u5904\u7684\uff0c\u9002\u5f53\u8c03\u5927down-after-milliseconds\u503c\uff0c\u5f53\u54e8\u5175\u4e0e\u4e3b\u5e93\u4e4b\u95f4\u7f51\u7edc\u5b58\u5728\u77ed\u65f6\u6ce2\u52a8\u65f6\uff0c\u53ef\u4ee5\u964d\u4f4e\u8bef\u5224\u7684\u6982\u7387\u3002\u4f46\u662f\u8c03\u5927down-after-milliseconds\u503c\u4e5f\u610f\u5473\u7740\u4e3b\u4ece\u5207\u6362\u7684\u65f6\u95f4\u4f1a\u53d8\u957f\uff0c\u5bf9\u4e1a\u52a1\u7684\u5f71\u54cd\u65f6\u95f4\u8d8a\u4e45\uff0c\u6211\u4eec\u9700\u8981\u6839\u636e\u5b9e\u9645\u573a\u666f\u8fdb\u884c\u6743\u8861\uff0c\u8bbe\u7f6e\u5408\u7406\u7684\u9608\u503c\u3002","title":"4\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap2/9redis_slot/","text":"\u7b2c\u4e5d\u8282 \u5207\u7247\u96c6\u7fa4\uff1a\u6570\u636e\u589e\u591a\u4e86\uff0c\u662f\u8be5\u52a0\u5185\u5b58\u8fd8\u662f\u52a0\u5b9e\u4f8b \u8981\u7528 Redis \u4fdd\u5b58 5000 \u4e07\u4e2a\u952e\u503c\u5bf9\uff0c\u6bcf\u4e2a\u952e\u503c\u5bf9\u5927\u7ea6\u662f 512B\uff0c\u4e3a\u4e86\u80fd\u5feb\u901f\u90e8\u7f72\u5e76\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u6211\u4eec\u91c7\u7528\u4e91\u4e3b\u673a\u6765\u8fd0\u884c Redis \u5b9e\u4f8b\uff0c\u90a3\u4e48\uff0c\u8be5\u5982\u4f55\u9009\u62e9\u4e91\u4e3b\u673a\u7684\u5185\u5b58\u5bb9\u91cf\u5462\uff1f \u8fd9\u4e9b\u952e\u503c\u5bf9\u6240\u5360\u7684\u5185\u5b58\u7a7a\u95f4\u5927\u7ea6\u662f 25GB\uff08 5000\u4e07 * 512B \uff09 \u9009\u62e9\u4e00\u53f0 32GB \u5185\u5b58\u7684\u4e91\u4e3b\u673a\u6765\u90e8\u7f72 Redis\u3002\u56e0\u4e3a 32GB \u7684\u5185\u5b58\u80fd\u4fdd\u5b58\u6240\u6709\u6570\u636e\uff0c\u800c\u4e14\u8fd8\u7559\u6709 7GB\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u7cfb\u7edf\u7684\u6b63\u5e38\u8fd0\u884c\u3002 \u540c\u65f6\uff0c\u6211\u8fd8\u91c7\u7528 RDB \u5bf9\u6570\u636e\u505a\u6301\u4e45\u5316\uff0c\u4ee5\u786e\u4fdd Redis \u5b9e\u4f8b\u6545\u969c\u540e\uff0c\u8fd8\u80fd\u4ece RDB \u6062\u590d\u6570\u636e\u3002 1\u3001\u5927\u5185\u5b58 Redis \u54cd\u5e94\u6162\u7684\u95ee\u9898 \u5728\u4f7f\u7528\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u53d1\u73b0\uff0cRedis \u7684\u54cd\u5e94\u6709\u65f6\u4f1a\u975e\u5e38\u6162\u3002\u540e\u6765\uff0c\u6211\u4eec\u4f7f\u7528 INFO \u547d\u4ee4\u67e5\u770b Redis \u7684 latest_fork_usec \u6307\u6807\u503c\uff08\u8868\u793a\u6700\u8fd1\u4e00\u6b21 fork \u7684\u8017\u65f6\uff09\uff0c \u7ed3\u679c\u663e\u793a\u8fd9\u4e2a\u6307\u6807\u503c\u7279\u522b\u9ad8\uff0c\u5feb\u5230\u79d2\u7ea7\u522b\u4e86\u3002 \u4f7f\u7528\u547d\u4ee4 info stats \u67e5\u770b\uff0c \u91cc\u9762\u6709\u4e00\u4e2a latest_fork_usec \u6761\u76ee \u8fd9\u8ddf Redis \u7684\u6301\u4e45\u5316\u673a\u5236\u6709\u5173\u7cfb\u3002 \u5728\u4f7f\u7528 RDB \u8fdb\u884c\u6301\u4e45\u5316\u65f6\uff0cRedis \u4f1a fork \u5b50\u8fdb\u7a0b\u6765\u5b8c\u6210\uff0cfork \u64cd\u4f5c\u7684\u7528\u65f6\u548c Redis \u7684\u6570\u636e\u91cf\u662f\u6b63\u76f8\u5173\u7684\uff0c\u800c fork \u5728\u6267\u884c\u65f6\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002\u6570\u636e\u91cf\u8d8a\u5927\uff0cfork \u64cd\u4f5c\u9020\u6210\u7684\u4e3b\u7ebf\u7a0b\u963b\u585e\u7684\u65f6\u95f4\u8d8a\u957f\u3002 \u6240\u4ee5\uff0c\u5728\u4f7f\u7528 RDB \u5bf9 25GB \u7684\u6570\u636e\u8fdb\u884c\u6301\u4e45\u5316\u65f6\uff0c\u6570\u636e\u91cf\u8f83\u5927\uff0c\u540e\u53f0\u8fd0\u884c\u7684\u5b50\u8fdb\u7a0b\u5728 fork \u521b\u5efa\u65f6\u963b\u585e\u4e86\u4e3b\u7ebf\u7a0b\uff0c\u4e8e\u662f\u5c31\u5bfc\u81f4 Redis \u54cd\u5e94\u53d8\u6162\u4e86\u3002 Redis \u7684\u5207\u7247\u96c6\u7fa4\u3002\u867d\u7136\u7ec4\u5efa\u5207\u7247\u96c6\u7fa4\u6bd4\u8f83\u9ebb\u70e6\uff0c\u4f46\u662f\u5b83\u53ef\u4ee5\u4fdd\u5b58\u5927\u91cf\u6570\u636e\uff0c\u800c\u4e14\u5bf9 Redis \u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\u5f71\u54cd\u8f83\u5c0f\u3002 2\u3001Redis \u5207\u7247\u96c6\u7fa4 \u54e8\u5175\u96c6\u7fa4\uff08\u975e\u4e3b\u4ece\uff0c\u5355\u7eaf\u96c6\u7fa4\uff09 \u4e3b\u4ece\u65b9\u5f0f\uff08\u4e3b\u8981\u4e3a\u4e86\u9ad8\u53ef\u7528 \u548c \u5206\u62c5\u8bfb\u7684\u538b\u529b\uff0c\u6bcf\u4e2a\u8282\u70b9\u6570\u636e\u662f\u4e00\u81f4\u7684\uff09 \u5207\u7247\u96c6\u7fa4 ( \u964d\u4f4e\u8282\u70b9\u7684\u538b\u529b\u548c\u5355\u8282\u70b9\u5185\u5b58\u5927\u5c0f\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684\u6570\u636e\u662f\u4e0d\u4e00\u81f4\u7684\uff0c\u5206\u5e03\u5f0f\u7684\uff0c\u5171\u540c\u627f\u62c5\u6574\u4e2aredis\u96c6\u7fa4\u67e5\u8be2\u64cd\u4f5c\uff1b \u5207\u7247\u96c6\u7fa4\u6709slot\u54c8\u5e0c\u69fd\u7684\u6982\u5ff5\uff0c\u7c7b\u4f3c\u4e8e\u6570\u636e\u5206\u533a\uff0c\u54c8\u5e0c\u69fd\u670916384\u4e2a\uff0c\u4e0d\u540c\u7684\u54c8\u5e0c\u69fd\u7ed1\u5b9a\u4e0d\u540c\u7684redis\u5b9e\u4f8b\uff1b \u65b0\u6765\u8bf7\u6c42\u7684key\u4f1a\u5728\u5ba2\u6237\u7aef\u4fa7\u901a\u8fc7CRC16\u8ba1\u7b97\u518d\u5bf916384\u53d6\u6a21\u5f97\u5230\u54c8\u5e0c\u69fd\u7f16\u53f7\uff0c\u67e5\u672c\u5730\u7f13\u5b58\u627e\u5230\u5bf9\u5e94\u7684\u5b9e\u4f8b\u5730\u5740\u548c\u7aef\u53e3\u8fdb\u884c\u4e0b\u4e00\u6b65\u67e5\u8be2\uff1b \u5982\u679cRedis\u5b9e\u4f8b\u6269\u5bb9\u7b49\u64cd\u4f5c\u5f15\u8d77\u54c8\u5e0c\u69fd\u5206\u914d\u53d8\u6362\uff0c\u5b9e\u4f8b\u901a\u8fc7\u8fd4\u56de\u91cd\u5b9a\u5411MOVED \u6216\u8005 ASK\uff08\u5f53\u524d\u8fd8\u672a\u8fc1\u79fb\u7ed3\u675f\uff09\uff0c\u8ba9\u5ba2\u6237\u7aef\u53bb\u8bf7\u6c42\u69fd\u6240\u5728\u7684\u65b0\u5b9e\u4f8b\uff09 \u5207\u7247\u96c6\u7fa4\uff0c\u4e5f\u53eb\u5206\u7247\u96c6\u7fa4\uff0c\u5c31\u662f\u6307\u542f\u52a8\u591a\u4e2a Redis \u5b9e\u4f8b\u7ec4\u6210\u4e00\u4e2a\u96c6\u7fa4\uff0c\u7136\u540e\u6309\u7167\u4e00\u5b9a\u7684\u89c4\u5219\uff0c\u628a\u6536\u5230\u7684\u6570\u636e\u5212\u5206\u6210\u591a\u4efd\uff0c\u6bcf\u4e00\u4efd\u7528\u4e00\u4e2a\u5b9e\u4f8b\u6765\u4fdd\u5b58 25GB \u7684\u6570\u636e\u5e73\u5747\u5206\u6210 5 \u4efd\uff08\u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u505a\u5747\u5206\uff09\uff0c\u4f7f\u7528 5 \u4e2a\u5b9e\u4f8b\u6765\u4fdd\u5b58\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u53ea\u9700\u8981\u4fdd\u5b58 5GB \u6570\u636e\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u5728\u5207\u7247\u96c6\u7fa4\u4e2d\uff0c\u5b9e\u4f8b\u5728\u4e3a 5GB \u6570\u636e\u751f\u6210 RDB \u65f6\uff0c\u6570\u636e\u91cf\u5c31\u5c0f\u4e86\u5f88\u591a\uff0cfork \u5b50\u8fdb\u7a0b\u4e00\u822c\u4e0d\u4f1a\u7ed9\u4e3b\u7ebf\u7a0b\u5e26\u6765\u8f83\u957f\u65f6\u95f4\u7684\u963b\u585e\u3002 \u91c7\u7528\u591a\u4e2a\u5b9e\u4f8b\u4fdd\u5b58\u6570\u636e\u5207\u7247\u540e\uff0c\u6211\u4eec\u65e2\u80fd\u4fdd\u5b58 25GB \u6570\u636e\uff0c\u53c8\u907f\u514d\u4e86 fork \u5b50\u8fdb\u7a0b\u963b\u585e\u4e3b\u7ebf\u7a0b\u800c\u5bfc\u81f4\u7684\u54cd\u5e94\u7a81\u7136\u53d8\u6162\u3002 3\u3001\u5982\u4f55\u4fdd\u5b58\u66f4\u591a\u6570\u636e\uff1f \u4e3a\u4e86\u4fdd\u5b58\u5927\u91cf\u6570\u636e\uff0c\u6211\u4eec\u4f7f\u7528\u4e86\u5927\u5185\u5b58\u4e91\u4e3b\u673a\u548c\u5207\u7247\u96c6\u7fa4\u4e24\u79cd\u65b9\u6cd5\u3002 \u5b9e\u9645\u4e0a\uff0c\u8fd9\u4e24\u79cd\u65b9\u6cd5\u5206\u522b\u5bf9\u5e94\u7740 Redis \u5e94\u5bf9\u6570\u636e\u91cf\u589e\u591a\u7684\u4e24\u79cd\u65b9\u6848\uff1a \u7eb5\u5411\u6269\u5c55\uff08scale up\uff09\u548c\u6a2a\u5411\u6269\u5c55\uff08scale out\uff09\u3002 \u7eb5\u5411\u6269\u5c55 \uff1a\u5347\u7ea7\u5355\u4e2a Redis \u5b9e\u4f8b\u7684\u8d44\u6e90\u914d\u7f6e\uff0c\u5305\u62ec\u589e\u52a0\u5185\u5b58\u5bb9\u91cf\u3001\u589e\u52a0\u78c1\u76d8\u5bb9\u91cf\u3001\u4f7f\u7528\u66f4\u9ad8\u914d\u7f6e\u7684 CPU\u3002\u5c31\u50cf\u4e0b\u56fe\u4e2d\uff0c\u539f\u6765\u7684\u5b9e\u4f8b\u5185\u5b58\u662f 8GB\uff0c\u786c\u76d8\u662f 50GB\uff0c\u7eb5\u5411\u6269\u5c55\u540e\uff0c\u5185\u5b58\u589e\u52a0\u5230 24GB\uff0c\u78c1\u76d8\u589e\u52a0\u5230 150GB\u3002 \u6a2a\u5411\u6269\u5c55 \uff1a\u6a2a\u5411\u589e\u52a0\u5f53\u524d Redis \u5b9e\u4f8b\u7684\u4e2a\u6570\uff0c\u5c31\u50cf\u4e0b\u56fe\u4e2d\uff0c\u539f\u6765\u4f7f\u7528 1 \u4e2a 8GB \u5185\u5b58\u300150GB \u78c1\u76d8\u7684\u5b9e\u4f8b\uff0c\u73b0\u5728\u4f7f\u7528\u4e09\u4e2a\u76f8\u540c\u914d\u7f6e\u7684\u5b9e\u4f8b\u3002 3-1 \u7eb5\u5411\u6269\u5c55 \u7eb5\u5411\u6269\u5c55\u7684\u597d\u5904\u662f\uff0c \u5b9e\u65bd\u8d77\u6765\u7b80\u5355\u3001\u76f4\u63a5 \u4e24\u4e2a\u6f5c\u5728\u7684\u95ee\u9898 \u7b2c\u4e00\u4e2a\u95ee\u9898\u662f\uff0c\u5f53\u4f7f\u7528 RDB \u5bf9\u6570\u636e\u8fdb\u884c\u6301\u4e45\u5316\u65f6\uff0c\u5982\u679c\u6570\u636e\u91cf\u589e\u52a0\uff0c\u9700\u8981\u7684\u5185\u5b58\u4e5f\u4f1a\u589e\u52a0\uff0c\u4e3b\u7ebf\u7a0b fork \u5b50\u8fdb\u7a0b\u65f6\u5c31\u53ef\u80fd\u4f1a\u963b\u585e\uff08\u6bd4\u5982\u521a\u521a\u7684\u4f8b\u5b50\u4e2d\u7684\u60c5\u51b5\uff09\u3002 \u4e0d\u8fc7\uff0c\u5982\u679c\u4f60\u4e0d\u8981\u6c42\u6301\u4e45\u5316\u4fdd\u5b58 Redis \u6570\u636e\uff0c\u90a3\u4e48\uff0c\u7eb5\u5411\u6269\u5c55\u4f1a\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002 \u7b2c\u4e8c\u4e2a\u95ee\u9898\uff1a\u7eb5\u5411\u6269\u5c55\u4f1a\u53d7\u5230\u786c\u4ef6\u548c\u6210\u672c\u7684\u9650\u5236\u3002\u8fd9\u5f88\u5bb9\u6613\u7406\u89e3\uff0c\u6bd5\u7adf\uff0c\u628a\u5185\u5b58\u4ece 32GB \u6269\u5c55\u5230 64GB \u8fd8\u7b97\u5bb9\u6613\uff0c\u4f46\u662f\uff0c\u8981\u60f3\u6269\u5145\u5230 1TB\uff0c\u5c31\u4f1a\u9762\u4e34\u786c\u4ef6\u5bb9\u91cf\u548c\u6210\u672c\u4e0a\u7684\u9650\u5236\u4e86\u3002 3-2 \u6a2a\u5411\u6269\u5c55 \u6a2a\u5411\u6269\u5c55\u662f\u4e00\u4e2a\u6269\u5c55\u6027\u66f4\u597d\u7684\u65b9\u6848 \u8981\u60f3\u4fdd\u5b58\u66f4\u591a\u7684\u6570\u636e\uff0c\u91c7\u7528\u8fd9\u79cd\u65b9\u6848\u7684\u8bdd\uff0c\u53ea\u7528\u589e\u52a0 Redis \u7684\u5b9e\u4f8b\u4e2a\u6570\u5c31\u884c\u4e86\uff0c\u4e0d\u7528\u62c5\u5fc3\u5355\u4e2a\u5b9e\u4f8b\u7684\u786c\u4ef6\u548c\u6210\u672c\u9650\u5236\u3002 \u5728\u9762\u5411\u767e\u4e07\u3001\u5343\u4e07\u7ea7\u522b\u7684\u7528\u6237\u89c4\u6a21\u65f6\uff0c\u6a2a\u5411\u6269\u5c55\u7684 Redis \u5207\u7247\u96c6\u7fa4\u4f1a\u662f\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u9009\u62e9\u3002 \u4e24\u4e2a\u95ee\u9898 \u6570\u636e\u5207\u7247\u540e\uff0c\u5728\u591a\u4e2a\u5b9e\u4f8b\u4e4b\u95f4\u5982\u4f55\u5206\u5e03\uff1f \u5ba2\u6237\u7aef\u600e\u4e48\u786e\u5b9a\u60f3\u8981\u8bbf\u95ee\u7684\u6570\u636e\u5728\u54ea\u4e2a\u5b9e\u4f8b\u4e0a\uff1f 4\u3001\u6570\u636e\u5207\u7247\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5206\u5e03\u5173\u7cfb Redis 3.0 \u5f00\u59cb\uff0c\u5b98\u65b9\u63d0\u4f9b\u4e86\u4e00\u4e2a\u540d\u4e3a Redis Cluster \u7684\u65b9\u6848\uff0c\u7528\u4e8e\u5b9e\u73b0\u5207\u7247\u96c6\u7fa4\u3002 Redis Cluster \u65b9\u6848\u4e2d\u5c31\u89c4\u5b9a\u4e86\u6570\u636e\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u89c4\u5219\u3002 Redis Cluster \u65b9\u6848\u91c7\u7528\u54c8\u5e0c\u69fd\uff08Hash Slot\uff0c\u63a5\u4e0b\u6765\u6211\u4f1a\u76f4\u63a5\u79f0\u4e4b\u4e3a Slot\uff09\uff0c\u6765\u5904\u7406\u6570\u636e\u548c\u5b9e\u4f8b\u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb\u3002 \u5728 Redis Cluster \u65b9\u6848\u4e2d\uff0c\u4e00\u4e2a\u5207\u7247\u96c6\u7fa4\u5171\u6709 16384 \u4e2a\u54c8\u5e0c\u69fd\uff0c\u8fd9\u4e9b\u54c8\u5e0c\u69fd\u7c7b\u4f3c\u4e8e\u6570\u636e\u5206\u533a\uff0c\u6bcf\u4e2a\u952e\u503c\u5bf9\u90fd\u4f1a\u6839\u636e\u5b83\u7684 key\uff0c\u88ab\u6620\u5c04\u5230\u4e00\u4e2a\u54c8\u5e0c\u69fd\u4e2d\u3002 4-1 \u6620\u5c04\u8fc7\u7a0b \u9996\u5148\u6839\u636e\u952e\u503c\u5bf9\u7684 key\uff0c\u6309\u7167 CRC16 \u7b97\u6cd5\u8ba1\u7b97\u4e00\u4e2a 16 bit \u7684\u503c\uff1b \u7136\u540e\uff0c\u518d\u7528\u8fd9\u4e2a 16bit \u503c\u5bf9 16384 \u53d6\u6a21\uff0c\u5f97\u5230 0~16383 \u8303\u56f4\u5185\u7684\u6a21\u6570\uff0c\u6bcf\u4e2a\u6a21\u6570\u4ee3\u8868\u4e00\u4e2a\u76f8\u5e94\u7f16\u53f7\u7684\u54c8\u5e0c\u69fd\u3002 \u54c8\u5e0c\u69fd\u53c8\u662f\u5982\u4f55\u88ab\u6620\u5c04\u5230\u5177\u4f53\u7684 Redis \u5b9e\u4f8b\u4e0a \u6211\u4eec\u5728\u90e8\u7f72 Redis Cluster \u65b9\u6848\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 cluster create \u547d\u4ee4\u521b\u5efa\u96c6\u7fa4\uff0c\u6b64\u65f6\uff0cRedis \u4f1a\u81ea\u52a8\u628a\u8fd9\u4e9b\u69fd\u5e73\u5747\u5206\u5e03\u5728\u96c6\u7fa4\u5b9e\u4f8b\u4e0a\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u96c6\u7fa4\u4e2d\u6709 N \u4e2a\u5b9e\u4f8b\uff0c\u90a3\u4e48\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u69fd\u4e2a\u6570\u4e3a 16384/N \u4e2a\u3002 \u5f53\u7136\uff0c \u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528 cluster meet \u547d\u4ee4\u624b\u52a8\u5efa\u7acb\u5b9e\u4f8b\u95f4\u7684\u8fde\u63a5\uff0c\u5f62\u6210\u96c6\u7fa4\uff0c\u518d\u4f7f\u7528 cluster addslots \u547d\u4ee4\uff0c\u6307\u5b9a\u6bcf\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u54c8\u5e0c\u69fd\u4e2a\u6570\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u96c6\u7fa4\u4e2d\u4e0d\u540c Redis \u5b9e\u4f8b\u7684\u5185\u5b58\u5927\u5c0f\u914d\u7f6e\u4e0d\u4e00\uff0c\u5982\u679c\u628a\u54c8\u5e0c\u69fd\u5747\u5206\u5728\u5404\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u5728\u4fdd\u5b58\u76f8\u540c\u6570\u91cf\u7684\u952e\u503c\u5bf9\u65f6\uff0c\u548c\u5185\u5b58\u5927\u7684\u5b9e\u4f8b\u76f8\u6bd4\uff0c\u5185\u5b58\u5c0f\u7684\u5b9e\u4f8b\u5c31\u4f1a\u6709\u66f4\u5927\u7684\u5bb9\u91cf\u538b\u529b \u6839\u636e\u4e0d\u540c\u5b9e\u4f8b\u7684\u8d44\u6e90\u914d\u7f6e\u60c5\u51b5\uff0c\u4f7f\u7528 cluster addslots \u547d\u4ee4\u624b\u52a8\u5206\u914d\u54c8\u5e0c\u69fd\u3002 \u5207\u7247\u96c6\u7fa4\u4e00\u5171\u6709 3 \u4e2a\u5b9e\u4f8b\uff0c\u540c\u65f6\u5047\u8bbe\u6709 5 \u4e2a\u54c8\u5e0c\u69fd\uff0c\u6211\u4eec\u9996\u5148\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u624b\u52a8\u5206\u914d\u54c8\u5e0c\u69fd\uff1a \u5b9e\u4f8b 1 \u4fdd\u5b58\u54c8\u5e0c\u69fd 0 \u548c 1\uff0c\u5b9e\u4f8b 2 \u4fdd\u5b58\u54c8\u5e0c\u69fd 2 \u548c 3\uff0c\u5b9e\u4f8b 3 \u4fdd\u5b58\u54c8\u5e0c\u69fd 4\u3002 redis-cli -h 172.16.19.3 \u2013p 6379 cluster addslots 0,1 redis-cli -h 172.16.19.4 \u2013p 6379 cluster addslots 2,3 redis-cli -h 172.16.19.5 \u2013p 6379 cluster addslots 4 \u5728\u96c6\u7fa4\u8fd0\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0ckey1 \u548c key2 \u8ba1\u7b97\u5b8c CRC16 \u503c\u540e\uff0c\u5bf9\u54c8\u5e0c\u69fd\u603b\u4e2a\u6570 5 \u53d6\u6a21\uff0c\u518d\u6839\u636e\u5404\u81ea\u7684\u6a21\u6570\u7ed3\u679c\uff0c\u5c31\u53ef\u4ee5\u88ab\u6620\u5c04\u5230\u5bf9\u5e94\u7684\u5b9e\u4f8b 1 \u548c\u5b9e\u4f8b 3 \u4e0a\u4e86\u3002 \u5728\u624b\u52a8\u5206\u914d\u54c8\u5e0c\u69fd\u65f6\uff0c\u9700\u8981\u628a 16384 \u4e2a\u69fd\u90fd\u5206\u914d\u5b8c\uff0c\u5426\u5219 Redis \u96c6\u7fa4\u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c\u3002 5\u3001\u5ba2\u6237\u7aef\u5982\u4f55\u5b9a\u4f4d\u6570\u636e\uff1f \u5728\u5b9a\u4f4d\u952e\u503c\u5bf9\u6570\u636e\u65f6\uff0c\u5b83\u6240\u5904\u7684\u54c8\u5e0c\u69fd\u662f\u53ef\u4ee5\u901a\u8fc7\u8ba1\u7b97\u5f97\u5230\u7684\uff0c\u8fd9\u4e2a\u8ba1\u7b97\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u65f6\u6765\u6267\u884c \u5ba2\u6237\u7aef\u548c\u96c6\u7fa4\u5b9e\u4f8b\u5efa\u7acb\u8fde\u63a5\u540e\uff0c\u5b9e\u4f8b\u5c31\u4f1a\u628a\u54c8\u5e0c\u69fd\u7684\u5206\u914d\u4fe1\u606f\u53d1\u7ed9\u5ba2\u6237\u7aef\u3002 \u4f46\u662f\uff0c\u5728\u96c6\u7fa4\u521a\u521a\u521b\u5efa\u7684\u65f6\u5019\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u53ea\u77e5\u9053\u81ea\u5df1\u88ab\u5206\u914d\u4e86\u54ea\u4e9b\u54c8\u5e0c\u69fd\uff0c\u662f\u4e0d\u77e5\u9053\u5176\u4ed6\u5b9e\u4f8b\u62e5\u6709\u7684\u54c8\u5e0c\u69fd\u4fe1\u606f\u7684\u3002 5-1 \u5ba2\u6237\u7aef\u83b7\u5f97\u6240\u6709\u7684\u54c8\u5e0c\u69fd\u4fe1\u606f \u90a3\u4e48\uff0c\u5ba2\u6237\u7aef\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u5728\u8bbf\u95ee\u4efb\u4f55\u4e00\u4e2a\u5b9e\u4f8b\u65f6\uff0c\u90fd\u80fd\u83b7\u5f97\u6240\u6709\u7684\u54c8\u5e0c\u69fd\u4fe1\u606f\u5462\uff1f \u8fd9\u662f\u56e0\u4e3a\uff0cRedis \u5b9e\u4f8b\u4f1a\u628a\u81ea\u5df1\u7684\u54c8\u5e0c\u69fd\u4fe1\u606f\u53d1\u7ed9\u548c\u5b83\u76f8\u8fde\u63a5\u7684\u5176\u5b83\u5b9e\u4f8b\uff0c\u6765\u5b8c\u6210\u54c8\u5e0c\u69fd\u5206\u914d\u4fe1\u606f\u7684\u6269\u6563\u3002\u5f53\u5b9e\u4f8b\u4e4b\u95f4\u76f8\u4e92\u8fde\u63a5\u540e\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u5c31\u6709\u6240\u6709\u54c8\u5e0c\u69fd\u7684\u6620\u5c04\u5173\u7cfb\u4e86 \u3002 \u5ba2\u6237\u7aef\u6536\u5230\u54c8\u5e0c\u69fd\u4fe1\u606f\u540e\uff0c\u4f1a\u628a\u54c8\u5e0c\u69fd\u4fe1\u606f\u7f13\u5b58\u5728\u672c\u5730\u3002 \u5f53\u5ba2\u6237\u7aef\u8bf7\u6c42\u952e\u503c\u5bf9\u65f6\uff0c\u4f1a\u5148\u8ba1\u7b97\u952e\u6240\u5bf9\u5e94\u7684\u54c8\u5e0c\u69fd\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u7ed9\u76f8\u5e94\u7684\u5b9e\u4f8b\u53d1\u9001\u8bf7\u6c42\u4e86\u3002 \u5728\u96c6\u7fa4\u4e2d\uff0c\u5b9e\u4f8b\u548c\u54c8\u5e0c\u69fd\u7684\u5bf9\u5e94\u5173\u7cfb\u5e76\u4e0d\u662f\u4e00\u6210\u4e0d\u53d8\u7684\uff0c\u6700\u5e38\u89c1\u7684\u53d8\u5316\u6709\u4e24\u4e2a \u5728\u96c6\u7fa4\u4e2d\uff0c\u5b9e\u4f8b\u6709\u65b0\u589e\u6216\u5220\u9664\uff0cRedis \u9700\u8981\u91cd\u65b0\u5206\u914d\u54c8\u5e0c\u69fd\uff1b \u4e3a\u4e86\u8d1f\u8f7d\u5747\u8861\uff0cRedis \u9700\u8981\u628a\u54c8\u5e0c\u69fd\u5728\u6240\u6709\u5b9e\u4f8b\u4e0a\u91cd\u65b0\u5206\u5e03\u4e00\u904d\u3002 5-2 \u5ba2\u6237\u7aef\u83b7\u5f97\u6700\u65b0\u7684\u54c8\u5e0c\u69fd\u5206\u914d\u4fe1\u606f(\u91cd\u5b9a\u5411\u673a\u5236) \u5ba2\u6237\u7aef\u662f\u65e0\u6cd5\u4e3b\u52a8\u611f\u77e5\u8fd9\u4e9b\u53d8\u5316\u7684\u3002\u8fd9\u5c31\u4f1a\u5bfc\u81f4\uff0c\u5b83\u7f13\u5b58\u7684\u5206\u914d\u4fe1\u606f\u548c\u6700\u65b0\u7684\u5206\u914d\u4fe1\u606f\u5c31\u4e0d\u4e00\u81f4\u4e86\uff0c Redis Cluster \u65b9\u6848\u63d0\u4f9b\u4e86\u4e00\u79cd\u91cd\u5b9a\u5411\u673a\u5236 \uff0c\u6240\u8c13\u7684\u201c\u91cd\u5b9a\u5411\u201d\uff0c\u5c31\u662f\u6307\uff0c\u5ba2\u6237\u7aef\u7ed9\u4e00\u4e2a\u5b9e\u4f8b\u53d1\u9001\u6570\u636e\u8bfb\u5199\u64cd\u4f5c\u65f6\uff0c\u8fd9\u4e2a\u5b9e\u4f8b\u4e0a\u5e76\u6ca1\u6709\u76f8\u5e94\u7684\u6570\u636e\uff0c\u5ba2\u6237\u7aef\u8981\u518d\u7ed9\u4e00\u4e2a\u65b0\u5b9e\u4f8b\u53d1\u9001\u64cd\u4f5c\u547d\u4ee4\u3002 \u90a3\u5ba2\u6237\u7aef\u53c8\u662f\u600e\u4e48\u77e5\u9053\u91cd\u5b9a\u5411\u65f6\u7684\u65b0\u5b9e\u4f8b\u7684\u8bbf\u95ee\u5730\u5740\u5462\uff1f \u5f53\u5ba2\u6237\u7aef\u628a\u4e00\u4e2a\u952e\u503c\u5bf9\u7684\u64cd\u4f5c\u8bf7\u6c42\u53d1\u7ed9\u4e00\u4e2a\u5b9e\u4f8b\u65f6\uff0c\u5982\u679c\u8fd9\u4e2a\u5b9e\u4f8b\u4e0a\u5e76\u6ca1\u6709\u8fd9\u4e2a\u952e\u503c\u5bf9\u6620\u5c04\u7684\u54c8\u5e0c\u69fd\uff0c\u90a3\u4e48\uff0c \u8fd9\u4e2a\u5b9e\u4f8b\u5c31\u4f1a\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u4e0b\u9762\u7684 MOVED \u547d\u4ee4\u54cd\u5e94\u7ed3\u679c\uff0c\u8fd9\u4e2a\u7ed3\u679c\u4e2d\u5c31\u5305\u542b\u4e86\u65b0\u5b9e\u4f8b\u7684\u8bbf\u95ee\u5730\u5740 \u3002 GET hello:key (error) MOVED 13320 172.16.19.5:6379 \u5176\u4e2d\uff0cMOVED \u547d\u4ee4\u8868\u793a\uff0c\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u952e\u503c\u5bf9\u6240\u5728\u7684\u54c8\u5e0c\u69fd 13320\uff0c\u5b9e\u9645\u662f\u5728 172.16.19.5 \u8fd9\u4e2a\u5b9e\u4f8b\u4e0a\u3002 * \u901a\u8fc7\u8fd4\u56de\u7684 MOVED \u547d\u4ee4\uff0c\u5c31\u76f8\u5f53\u4e8e\u628a\u54c8\u5e0c\u69fd\u6240\u5728\u7684\u65b0\u5b9e\u4f8b\u7684\u4fe1\u606f\u544a\u8bc9\u7ed9\u5ba2\u6237\u7aef\u4e86\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u76f4\u63a5\u548c 172.16.19.5 \u8fde\u63a5\uff0c\u5e76\u53d1\u9001\u64cd\u4f5c\u8bf7\u6c42\u4e86\u3002 5-3 MOVED \u91cd\u5b9a\u5411\u547d\u4ee4\u7684\u4f7f\u7528\u65b9\u6cd5 \u7531\u4e8e\u8d1f\u8f7d\u5747\u8861\uff0cSlot 2 \u4e2d\u7684\u6570\u636e\u5df2\u7ecf\u4ece\u5b9e\u4f8b 2 \u8fc1\u79fb\u5230\u4e86\u5b9e\u4f8b 3 \u4f46\u662f\uff0c\u5ba2\u6237\u7aef\u7f13\u5b58\u4ecd\u7136\u8bb0\u5f55\u7740\u201cSlot 2 \u5728\u5b9e\u4f8b 2\u201d\u7684\u4fe1\u606f\uff0c\u6240\u4ee5\u4f1a\u7ed9\u5b9e\u4f8b 2 \u53d1\u9001\u547d\u4ee4\u3002 \u5b9e\u4f8b 2 \u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u4e00\u6761 MOVED \u547d\u4ee4\uff0c\u628a Slot 2 \u7684\u6700\u65b0\u4f4d\u7f6e\uff08\u4e5f\u5c31\u662f\u5728\u5b9e\u4f8b 3 \u4e0a\uff09\uff0c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c * \u5ba2\u6237\u7aef\u5c31\u4f1a\u518d\u6b21\u5411\u5b9e\u4f8b 3 \u53d1\u9001\u8bf7\u6c42\uff0c\u540c\u65f6\u8fd8\u4f1a\u66f4\u65b0\u672c\u5730\u7f13\u5b58\uff0c\u628a Slot 2 \u4e0e\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\u66f4\u65b0\u8fc7\u6765\u3002 \u5728\u4e0a\u56fe\u4e2d\uff0c\u5f53\u5ba2\u6237\u7aef\u7ed9\u5b9e\u4f8b 2 \u53d1\u9001\u547d\u4ee4\u65f6\uff0cSlot 2 \u4e2d\u7684\u6570\u636e\u5df2\u7ecf\u5168\u90e8\u8fc1\u79fb\u5230\u4e86\u5b9e\u4f8b 3\u3002 5-3 ASK \u547d\u4ee4\u89e3\u51b3\u90e8\u5206\u6570\u636e\u524d\u79fb\u7684\u95ee\u9898 \u5728\u5b9e\u9645\u5e94\u7528\u65f6\uff0c\u5982\u679c Slot 2 \u4e2d\u7684\u6570\u636e\u6bd4\u8f83\u591a\uff0c\u5c31\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e00\u79cd\u60c5\u51b5\uff1a\u5ba2\u6237\u7aef\u5411\u5b9e\u4f8b 2 \u53d1\u9001\u8bf7\u6c42\uff0c\u4f46\u6b64\u65f6\uff0c Slot 2 \u4e2d\u7684\u6570\u636e\u53ea\u6709\u4e00\u90e8\u5206\u8fc1\u79fb\u5230\u4e86\u5b9e\u4f8b 3\uff0c\u8fd8\u6709\u90e8\u5206\u6570\u636e\u6ca1\u6709\u8fc1\u79fb\u3002\u5728\u8fd9\u79cd\u8fc1\u79fb\u90e8\u5206\u5b8c\u6210\u7684\u60c5\u51b5\u4e0b\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u6536\u5230\u4e00\u6761 ASK \u62a5\u9519\u4fe1\u606f \uff0c GET hello:key (error) ASK 13320 172.16.19.5:6379 \u8fd9\u4e2a\u7ed3\u679c\u4e2d\u7684 ASK \u547d\u4ee4\u5c31\u8868\u793a\uff0c\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u952e\u503c\u5bf9\u6240\u5728\u7684\u54c8\u5e0c\u69fd 13320\uff0c\u5728 172.16.19.5 \u8fd9\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u4f46\u662f\u8fd9\u4e2a\u54c8\u5e0c\u69fd\u6b63\u5728\u8fc1\u79fb\u3002 \u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u5148\u7ed9 172.16.19.5 \u8fd9\u4e2a\u5b9e\u4f8b\u53d1\u9001\u4e00\u4e2a ASKING \u547d\u4ee4\u3002 \u8fd9\u4e2a\u547d\u4ee4\u7684\u610f\u601d\u662f\uff0c\u8ba9\u8fd9\u4e2a\u5b9e\u4f8b\u5141\u8bb8\u6267\u884c\u5ba2\u6237\u7aef\u63a5\u4e0b\u6765\u53d1\u9001\u7684\u547d\u4ee4\u3002 \u7136\u540e\uff0c\u5ba2\u6237\u7aef\u518d\u5411\u8fd9\u4e2a\u5b9e\u4f8b\u53d1\u9001 GET \u547d\u4ee4\uff0c\u4ee5\u8bfb\u53d6\u6570\u636e \u5982\u56fe\uff0cSlot 2 \u6b63\u5728\u4ece\u5b9e\u4f8b 2 \u5f80\u5b9e\u4f8b 3 \u8fc1\u79fb\uff0ckey1 \u548c key2 \u5df2\u7ecf\u8fc1\u79fb\u8fc7\u53bb\uff0ckey3 \u548c key4 \u8fd8\u5728\u5b9e\u4f8b 2\u3002\u5ba2\u6237\u7aef\u5411\u5b9e\u4f8b 2 \u8bf7\u6c42 key2 \u540e\uff0c\u5c31\u4f1a\u6536\u5230\u5b9e\u4f8b 2 \u8fd4\u56de\u7684 ASK \u547d\u4ee4\u3002 ASK \u547d\u4ee4\u8868\u793a\u4e24\u5c42\u542b\u4e49 \u7b2c\u4e00\uff0c\u8868\u660e Slot \u6570\u636e\u8fd8\u5728\u8fc1\u79fb\u4e2d\uff1b \u7b2c\u4e8c\uff0cASK \u547d\u4ee4\u628a\u5ba2\u6237\u7aef\u6240\u8bf7\u6c42\u6570\u636e\u7684\u6700\u65b0\u5b9e\u4f8b\u5730\u5740\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c \u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u7ed9\u5b9e\u4f8b 3 \u53d1\u9001 ASKING \u547d\u4ee4\uff0c\u7136\u540e\u518d\u53d1\u9001\u64cd\u4f5c\u547d\u4ee4 \u3002 \u548c MOVED \u547d\u4ee4\u4e0d\u540c\uff0cASK \u547d\u4ee4\u5e76\u4e0d\u4f1a\u66f4\u65b0\u5ba2\u6237\u7aef\u7f13\u5b58\u7684\u54c8\u5e0c\u69fd\u5206\u914d\u4fe1\u606f\u3002 \u5982\u679c\u5ba2\u6237\u7aef\u518d\u6b21\u8bf7\u6c42 Slot 2 \u4e2d\u7684\u6570\u636e\uff0c\u5b83\u8fd8\u662f\u4f1a\u7ed9\u5b9e\u4f8b 2 \u53d1\u9001\u8bf7\u6c42\u3002 \u8fd9\u4e5f\u5c31\u662f\u8bf4\uff0cASK \u547d\u4ee4\u7684\u4f5c\u7528\u53ea\u662f\u8ba9\u5ba2\u6237\u7aef\u80fd\u7ed9\u65b0\u5b9e\u4f8b\u53d1\u9001\u4e00\u6b21\u8bf7\u6c42 \uff0c\u800c\u4e0d\u50cf MOVED \u547d\u4ee4\u90a3\u6837\uff0c\u4f1a\u66f4\u6539\u672c\u5730\u7f13\u5b58\uff0c\u8ba9\u540e\u7eed\u6240\u6709\u547d\u4ee4\u90fd\u53d1\u5f80\u65b0\u5b9e\u4f8b\u3002 6\u3001\u672c\u8282\u5c0f\u8282 \u5207\u7247\u96c6\u7fa4\u5728\u4fdd\u5b58\u5927\u91cf\u6570\u636e\u65b9\u9762\u7684\u4f18\u52bf\uff0c\u4ee5\u53ca\u57fa\u4e8e\u54c8\u5e0c\u69fd\u7684\u6570\u636e\u5206\u5e03\u673a\u5236\u548c\u5ba2\u6237\u7aef\u5b9a\u4f4d\u952e\u503c\u5bf9\u7684\u65b9\u6cd5\u3002 \u5728\u5e94\u5bf9\u6570\u636e\u91cf\u6269\u5bb9\u65f6\uff0c\u867d\u7136\u589e\u52a0\u5185\u5b58\u8fd9\u79cd\u7eb5\u5411\u6269\u5c55\u7684\u65b9\u6cd5\u7b80\u5355\u76f4\u63a5\uff0c\u4f46\u662f\u4f1a\u9020\u6210\u6570\u636e\u5e93\u7684\u5185\u5b58\u8fc7\u5927\uff0c\u5bfc\u81f4\u6027\u80fd\u53d8\u6162\u3002 Redis \u5207\u7247\u96c6\u7fa4\u63d0\u4f9b\u4e86\u6a2a\u5411\u6269\u5c55\u7684\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f\u4f7f\u7528\u591a\u4e2a\u5b9e\u4f8b\uff0c\u5e76\u7ed9\u6bcf\u4e2a\u5b9e\u4f8b\u914d\u7f6e\u4e00\u5b9a\u6570\u91cf\u7684\u54c8\u5e0c\u69fd\uff0c\u6570\u636e\u53ef\u4ee5\u901a\u8fc7\u952e\u7684\u54c8\u5e0c\u503c\u6620\u5c04\u5230\u54c8\u5e0c\u69fd\uff0c\u518d\u901a\u8fc7\u54c8\u5e0c\u69fd\u5206\u6563\u4fdd\u5b58\u5230\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\u3002 \u96c6\u7fa4\u7684\u5b9e\u4f8b\u589e\u51cf\uff0c\u6216\u8005\u662f\u4e3a\u4e86\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861\u800c\u8fdb\u884c\u7684\u6570\u636e\u91cd\u65b0\u5206\u5e03\uff0c\u4f1a\u5bfc\u81f4\u54c8\u5e0c\u69fd\u548c\u5b9e\u4f8b\u7684\u6620\u5c04\u5173\u7cfb\u53d1\u751f\u53d8\u5316\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u4f1a\u6536\u5230\u547d\u4ee4\u6267\u884c\u62a5\u9519\u4fe1\u606f\u3002 6-1 \u672c\u8282\u4eae\u70b9 \u8fd9\u4e00\u8bfe\u6211\u66f4\u52a0\u6e05\u6670\u7684\u660e\u767d\u4e86\u4e4b\u524d\u522b\u4eba\u804aRedis\u6269\u5bb9\u4e2d\u7684\u7eb5\u5411\u6269\u5bb9\u548c\u6a2a\u5411\u6269\u5bb9\u7684\u771f\u5b9e\u542b\u4e49\u548c\u533a\u522b \u6570\u636e\u5206\u7247\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\u5efa\u7acb\uff1a\u6309\u7167CRC16\u7b97\u6cd5\u8ba1\u7b97\u4e00\u4e2akey\u768416bit\u7684\u503c\uff0c\u5728\u5c06\u8fd9\u503c\u5bf916384\u53d6\u6a21 \u4e00\u4e2a\u5207\u7247\u96c6\u7fa4\u7684\u69fd\u4f4d\u662f\u56fa\u5b9a\u768416384\u4e2a\uff0c\u53ef\u624b\u52a8\u5206\u914d\u6bcf\u4e2a\u5b9e\u4f8b\u7684\u69fd\u4f4d\uff0c\u4f46\u5fc5\u987b\u5c06\u69fd\u4f4d\u5168\u90e8\u5206\u5b8c \u5ba2\u6237\u7aef\u5982\u4f55\u786e\u5b9a\u8981\u8bbf\u95ee\u90a3\u4e2a\u5b9e\u4f8b\u83b7\u53d6\u6570\u636e\uff1a \u4ece\u4efb\u610f\u4e2a\u5b9e\u4f8b\u83b7\u53d6\u5e76\u7f13\u5b58\u5728\u81ea\u5df1\u672c\u5730\uff0c \u91cd\u5b9a\u5411\u673a\u5236 \u91cd\u5b9a\u5411\u673a\u5236\uff1a\u5ba2\u6237\u7aef\u8bbf\u95ee\u7684\u5b9e\u4f8b\u6ca1\u6709\u6570\u636e\uff0c\u88ab\u8bbf\u95ee\u5b9e\u4f8b\u54cd\u5e94move\u547d\u4ee4\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\u6307\u5411\u65b0\u7684\u5b9e\u4f8b\u5730\u5740 ASK\u547d\u4ee4\uff1a1\uff0c\u8868\u660e\u6570\u636e\u6b63\u5728\u8fc1\u79fb 2\uff0c\u544a\u77e5\u5ba2\u6237\u7aef\u6570\u636e\u6240\u5728\u7684\u5b9e\u4f8b ASK\u547d\u4ee4\u548cMOVE\u547d\u4ee4\u7684\u533a\u522b\uff1a move\u547d\u4ee4\u662f\u5728\u6570\u636e\u8fc1\u79fb\u5b8c\u6bd5\u540e\u88ab\u54cd\u5e94\uff0c\u5ba2\u6237\u7aef\u4f1a\u66f4\u65b0\u672c\u5730\u7f13\u5b58\u3002 ASK\u547d\u4ee4\u662f\u5728\u6570\u636e\u8fc1\u79fb\u4e2d\u88ab\u54cd\u5e94\uff0c\u4e0d\u4f1a\u8ba9\u5ba2\u6237\u7aef\u66f4\u65b0\u7f13\u5b58 6-2 \u672c\u8282\u4e00\u95ee Redis Cluster \u65b9\u6848\u901a\u8fc7\u54c8\u5e0c\u69fd\u7684\u65b9\u5f0f\u628a\u952e\u503c\u5bf9\u5206\u914d\u5230\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u9700\u8981\u5bf9\u952e\u503c\u5bf9\u7684 key \u505a CRC \u8ba1\u7b97\uff0c\u7136\u540e\u518d\u548c\u54c8\u5e0c\u69fd\u505a\u6620\u5c04\uff0c\u8fd9\u6837\u505a\u6709\u4ec0\u4e48\u597d\u5904\u5417\uff1f\u5982\u679c\u7528\u4e00\u4e2a\u8868\u76f4\u63a5\u628a\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\u8bb0\u5f55\u4e0b\u6765\uff08\u4f8b\u5982\u952e\u503c\u5bf9 1 \u5728\u5b9e\u4f8b 2 \u4e0a\uff0c\u952e\u503c\u5bf9 2 \u5728\u5b9e\u4f8b 1 \u4e0a\uff09\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u8ba1\u7b97 key \u548c\u54c8\u5e0c\u69fd\u7684\u5bf9\u5e94\u5173\u7cfb\u4e86\uff0c\u53ea\u7528\u67e5\u8868\u5c31\u884c\u4e86\uff0cRedis \u4e3a\u4ec0\u4e48\u4e0d\u8fd9\u4e48\u505a\u5462\uff1f \u5982\u679c\u4f7f\u7528\u8868\u8bb0\u5f55\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u4e00\u65e6\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\u53d1\u751f\u4e86\u53d8\u5316\uff08\u4f8b\u5982\u5b9e\u4f8b\u6709\u589e\u51cf\u6216\u8005\u6570\u636e\u91cd\u65b0\u5206\u5e03\uff09\uff0c\u5c31\u8981\u4fee\u6539\u8868\u3002\u5982\u679c\u662f\u5355\u7ebf\u7a0b\u64cd\u4f5c\u8868\uff0c\u90a3\u4e48\u6240\u6709\u64cd\u4f5c\u90fd\u8981\u4e32\u884c\u6267\u884c\uff0c\u6027\u80fd\u6162\uff1b\u5982\u679c\u662f\u591a\u7ebf\u7a0b\u64cd\u4f5c\u8868\uff0c\u5c31\u6d89\u53ca\u5230\u52a0\u9501\u5f00\u9500\u3002\u6b64\u5916\uff0c\u5982\u679c\u6570\u636e\u91cf\u975e\u5e38\u5927\uff0c\u4f7f\u7528\u8868\u8bb0\u5f55\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u9700\u8981\u7684\u989d\u5916\u5b58\u50a8\u7a7a\u95f4\u4e5f\u4f1a\u589e\u52a0\u3002 \u57fa\u4e8e\u54c8\u5e0c\u69fd\u8ba1\u7b97\u65f6\uff0c\u867d\u7136\u4e5f\u8981\u8bb0\u5f55\u54c8\u5e0c\u69fd\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u4f46\u662f\u54c8\u5e0c\u69fd\u7684\u4e2a\u6570\u8981\u6bd4\u952e\u503c\u5bf9\u7684\u4e2a\u6570\u5c11\u5f88\u591a\uff0c\u65e0\u8bba\u662f\u4fee\u6539\u54c8\u5e0c\u69fd\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u8fd8\u662f\u4f7f\u7528\u989d\u5916\u7a7a\u95f4\u5b58\u50a8\u54c8\u5e0c\u69fd\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u90fd\u6bd4\u76f4\u63a5\u8bb0\u5f55\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5173\u7cfb\u7684\u5f00\u9500\u5c0f\u5f97\u591a\u3002","title":"\u7b2c\u4e5d\u8282 \u5207\u7247\u96c6\u7fa4\uff1a\u6570\u636e\u589e\u591a\u4e86\uff0c\u662f\u8be5\u52a0\u5185\u5b58\u8fd8\u662f\u52a0\u5b9e\u4f8b"},{"location":"chap2/9redis_slot/#_1","text":"\u8981\u7528 Redis \u4fdd\u5b58 5000 \u4e07\u4e2a\u952e\u503c\u5bf9\uff0c\u6bcf\u4e2a\u952e\u503c\u5bf9\u5927\u7ea6\u662f 512B\uff0c\u4e3a\u4e86\u80fd\u5feb\u901f\u90e8\u7f72\u5e76\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u6211\u4eec\u91c7\u7528\u4e91\u4e3b\u673a\u6765\u8fd0\u884c Redis \u5b9e\u4f8b\uff0c\u90a3\u4e48\uff0c\u8be5\u5982\u4f55\u9009\u62e9\u4e91\u4e3b\u673a\u7684\u5185\u5b58\u5bb9\u91cf\u5462\uff1f \u8fd9\u4e9b\u952e\u503c\u5bf9\u6240\u5360\u7684\u5185\u5b58\u7a7a\u95f4\u5927\u7ea6\u662f 25GB\uff08 5000\u4e07 * 512B \uff09 \u9009\u62e9\u4e00\u53f0 32GB \u5185\u5b58\u7684\u4e91\u4e3b\u673a\u6765\u90e8\u7f72 Redis\u3002\u56e0\u4e3a 32GB \u7684\u5185\u5b58\u80fd\u4fdd\u5b58\u6240\u6709\u6570\u636e\uff0c\u800c\u4e14\u8fd8\u7559\u6709 7GB\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u7cfb\u7edf\u7684\u6b63\u5e38\u8fd0\u884c\u3002 \u540c\u65f6\uff0c\u6211\u8fd8\u91c7\u7528 RDB \u5bf9\u6570\u636e\u505a\u6301\u4e45\u5316\uff0c\u4ee5\u786e\u4fdd Redis \u5b9e\u4f8b\u6545\u969c\u540e\uff0c\u8fd8\u80fd\u4ece RDB \u6062\u590d\u6570\u636e\u3002","title":"\u7b2c\u4e5d\u8282 \u5207\u7247\u96c6\u7fa4\uff1a\u6570\u636e\u589e\u591a\u4e86\uff0c\u662f\u8be5\u52a0\u5185\u5b58\u8fd8\u662f\u52a0\u5b9e\u4f8b"},{"location":"chap2/9redis_slot/#1-redis","text":"\u5728\u4f7f\u7528\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u53d1\u73b0\uff0cRedis \u7684\u54cd\u5e94\u6709\u65f6\u4f1a\u975e\u5e38\u6162\u3002\u540e\u6765\uff0c\u6211\u4eec\u4f7f\u7528 INFO \u547d\u4ee4\u67e5\u770b Redis \u7684 latest_fork_usec \u6307\u6807\u503c\uff08\u8868\u793a\u6700\u8fd1\u4e00\u6b21 fork \u7684\u8017\u65f6\uff09\uff0c \u7ed3\u679c\u663e\u793a\u8fd9\u4e2a\u6307\u6807\u503c\u7279\u522b\u9ad8\uff0c\u5feb\u5230\u79d2\u7ea7\u522b\u4e86\u3002 \u4f7f\u7528\u547d\u4ee4 info stats \u67e5\u770b\uff0c \u91cc\u9762\u6709\u4e00\u4e2a latest_fork_usec \u6761\u76ee \u8fd9\u8ddf Redis \u7684\u6301\u4e45\u5316\u673a\u5236\u6709\u5173\u7cfb\u3002 \u5728\u4f7f\u7528 RDB \u8fdb\u884c\u6301\u4e45\u5316\u65f6\uff0cRedis \u4f1a fork \u5b50\u8fdb\u7a0b\u6765\u5b8c\u6210\uff0cfork \u64cd\u4f5c\u7684\u7528\u65f6\u548c Redis \u7684\u6570\u636e\u91cf\u662f\u6b63\u76f8\u5173\u7684\uff0c\u800c fork \u5728\u6267\u884c\u65f6\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002\u6570\u636e\u91cf\u8d8a\u5927\uff0cfork \u64cd\u4f5c\u9020\u6210\u7684\u4e3b\u7ebf\u7a0b\u963b\u585e\u7684\u65f6\u95f4\u8d8a\u957f\u3002 \u6240\u4ee5\uff0c\u5728\u4f7f\u7528 RDB \u5bf9 25GB \u7684\u6570\u636e\u8fdb\u884c\u6301\u4e45\u5316\u65f6\uff0c\u6570\u636e\u91cf\u8f83\u5927\uff0c\u540e\u53f0\u8fd0\u884c\u7684\u5b50\u8fdb\u7a0b\u5728 fork \u521b\u5efa\u65f6\u963b\u585e\u4e86\u4e3b\u7ebf\u7a0b\uff0c\u4e8e\u662f\u5c31\u5bfc\u81f4 Redis \u54cd\u5e94\u53d8\u6162\u4e86\u3002 Redis \u7684\u5207\u7247\u96c6\u7fa4\u3002\u867d\u7136\u7ec4\u5efa\u5207\u7247\u96c6\u7fa4\u6bd4\u8f83\u9ebb\u70e6\uff0c\u4f46\u662f\u5b83\u53ef\u4ee5\u4fdd\u5b58\u5927\u91cf\u6570\u636e\uff0c\u800c\u4e14\u5bf9 Redis \u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\u5f71\u54cd\u8f83\u5c0f\u3002","title":"1\u3001\u5927\u5185\u5b58 Redis \u54cd\u5e94\u6162\u7684\u95ee\u9898"},{"location":"chap2/9redis_slot/#2redis","text":"\u54e8\u5175\u96c6\u7fa4\uff08\u975e\u4e3b\u4ece\uff0c\u5355\u7eaf\u96c6\u7fa4\uff09 \u4e3b\u4ece\u65b9\u5f0f\uff08\u4e3b\u8981\u4e3a\u4e86\u9ad8\u53ef\u7528 \u548c \u5206\u62c5\u8bfb\u7684\u538b\u529b\uff0c\u6bcf\u4e2a\u8282\u70b9\u6570\u636e\u662f\u4e00\u81f4\u7684\uff09 \u5207\u7247\u96c6\u7fa4 ( \u964d\u4f4e\u8282\u70b9\u7684\u538b\u529b\u548c\u5355\u8282\u70b9\u5185\u5b58\u5927\u5c0f\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684\u6570\u636e\u662f\u4e0d\u4e00\u81f4\u7684\uff0c\u5206\u5e03\u5f0f\u7684\uff0c\u5171\u540c\u627f\u62c5\u6574\u4e2aredis\u96c6\u7fa4\u67e5\u8be2\u64cd\u4f5c\uff1b \u5207\u7247\u96c6\u7fa4\u6709slot\u54c8\u5e0c\u69fd\u7684\u6982\u5ff5\uff0c\u7c7b\u4f3c\u4e8e\u6570\u636e\u5206\u533a\uff0c\u54c8\u5e0c\u69fd\u670916384\u4e2a\uff0c\u4e0d\u540c\u7684\u54c8\u5e0c\u69fd\u7ed1\u5b9a\u4e0d\u540c\u7684redis\u5b9e\u4f8b\uff1b \u65b0\u6765\u8bf7\u6c42\u7684key\u4f1a\u5728\u5ba2\u6237\u7aef\u4fa7\u901a\u8fc7CRC16\u8ba1\u7b97\u518d\u5bf916384\u53d6\u6a21\u5f97\u5230\u54c8\u5e0c\u69fd\u7f16\u53f7\uff0c\u67e5\u672c\u5730\u7f13\u5b58\u627e\u5230\u5bf9\u5e94\u7684\u5b9e\u4f8b\u5730\u5740\u548c\u7aef\u53e3\u8fdb\u884c\u4e0b\u4e00\u6b65\u67e5\u8be2\uff1b \u5982\u679cRedis\u5b9e\u4f8b\u6269\u5bb9\u7b49\u64cd\u4f5c\u5f15\u8d77\u54c8\u5e0c\u69fd\u5206\u914d\u53d8\u6362\uff0c\u5b9e\u4f8b\u901a\u8fc7\u8fd4\u56de\u91cd\u5b9a\u5411MOVED \u6216\u8005 ASK\uff08\u5f53\u524d\u8fd8\u672a\u8fc1\u79fb\u7ed3\u675f\uff09\uff0c\u8ba9\u5ba2\u6237\u7aef\u53bb\u8bf7\u6c42\u69fd\u6240\u5728\u7684\u65b0\u5b9e\u4f8b\uff09 \u5207\u7247\u96c6\u7fa4\uff0c\u4e5f\u53eb\u5206\u7247\u96c6\u7fa4\uff0c\u5c31\u662f\u6307\u542f\u52a8\u591a\u4e2a Redis \u5b9e\u4f8b\u7ec4\u6210\u4e00\u4e2a\u96c6\u7fa4\uff0c\u7136\u540e\u6309\u7167\u4e00\u5b9a\u7684\u89c4\u5219\uff0c\u628a\u6536\u5230\u7684\u6570\u636e\u5212\u5206\u6210\u591a\u4efd\uff0c\u6bcf\u4e00\u4efd\u7528\u4e00\u4e2a\u5b9e\u4f8b\u6765\u4fdd\u5b58 25GB \u7684\u6570\u636e\u5e73\u5747\u5206\u6210 5 \u4efd\uff08\u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u505a\u5747\u5206\uff09\uff0c\u4f7f\u7528 5 \u4e2a\u5b9e\u4f8b\u6765\u4fdd\u5b58\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u53ea\u9700\u8981\u4fdd\u5b58 5GB \u6570\u636e\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u5728\u5207\u7247\u96c6\u7fa4\u4e2d\uff0c\u5b9e\u4f8b\u5728\u4e3a 5GB \u6570\u636e\u751f\u6210 RDB \u65f6\uff0c\u6570\u636e\u91cf\u5c31\u5c0f\u4e86\u5f88\u591a\uff0cfork \u5b50\u8fdb\u7a0b\u4e00\u822c\u4e0d\u4f1a\u7ed9\u4e3b\u7ebf\u7a0b\u5e26\u6765\u8f83\u957f\u65f6\u95f4\u7684\u963b\u585e\u3002 \u91c7\u7528\u591a\u4e2a\u5b9e\u4f8b\u4fdd\u5b58\u6570\u636e\u5207\u7247\u540e\uff0c\u6211\u4eec\u65e2\u80fd\u4fdd\u5b58 25GB \u6570\u636e\uff0c\u53c8\u907f\u514d\u4e86 fork \u5b50\u8fdb\u7a0b\u963b\u585e\u4e3b\u7ebf\u7a0b\u800c\u5bfc\u81f4\u7684\u54cd\u5e94\u7a81\u7136\u53d8\u6162\u3002","title":"2\u3001Redis \u5207\u7247\u96c6\u7fa4"},{"location":"chap2/9redis_slot/#3","text":"\u4e3a\u4e86\u4fdd\u5b58\u5927\u91cf\u6570\u636e\uff0c\u6211\u4eec\u4f7f\u7528\u4e86\u5927\u5185\u5b58\u4e91\u4e3b\u673a\u548c\u5207\u7247\u96c6\u7fa4\u4e24\u79cd\u65b9\u6cd5\u3002 \u5b9e\u9645\u4e0a\uff0c\u8fd9\u4e24\u79cd\u65b9\u6cd5\u5206\u522b\u5bf9\u5e94\u7740 Redis \u5e94\u5bf9\u6570\u636e\u91cf\u589e\u591a\u7684\u4e24\u79cd\u65b9\u6848\uff1a \u7eb5\u5411\u6269\u5c55\uff08scale up\uff09\u548c\u6a2a\u5411\u6269\u5c55\uff08scale out\uff09\u3002 \u7eb5\u5411\u6269\u5c55 \uff1a\u5347\u7ea7\u5355\u4e2a Redis \u5b9e\u4f8b\u7684\u8d44\u6e90\u914d\u7f6e\uff0c\u5305\u62ec\u589e\u52a0\u5185\u5b58\u5bb9\u91cf\u3001\u589e\u52a0\u78c1\u76d8\u5bb9\u91cf\u3001\u4f7f\u7528\u66f4\u9ad8\u914d\u7f6e\u7684 CPU\u3002\u5c31\u50cf\u4e0b\u56fe\u4e2d\uff0c\u539f\u6765\u7684\u5b9e\u4f8b\u5185\u5b58\u662f 8GB\uff0c\u786c\u76d8\u662f 50GB\uff0c\u7eb5\u5411\u6269\u5c55\u540e\uff0c\u5185\u5b58\u589e\u52a0\u5230 24GB\uff0c\u78c1\u76d8\u589e\u52a0\u5230 150GB\u3002 \u6a2a\u5411\u6269\u5c55 \uff1a\u6a2a\u5411\u589e\u52a0\u5f53\u524d Redis \u5b9e\u4f8b\u7684\u4e2a\u6570\uff0c\u5c31\u50cf\u4e0b\u56fe\u4e2d\uff0c\u539f\u6765\u4f7f\u7528 1 \u4e2a 8GB \u5185\u5b58\u300150GB \u78c1\u76d8\u7684\u5b9e\u4f8b\uff0c\u73b0\u5728\u4f7f\u7528\u4e09\u4e2a\u76f8\u540c\u914d\u7f6e\u7684\u5b9e\u4f8b\u3002","title":"3\u3001\u5982\u4f55\u4fdd\u5b58\u66f4\u591a\u6570\u636e\uff1f"},{"location":"chap2/9redis_slot/#3-1","text":"\u7eb5\u5411\u6269\u5c55\u7684\u597d\u5904\u662f\uff0c \u5b9e\u65bd\u8d77\u6765\u7b80\u5355\u3001\u76f4\u63a5 \u4e24\u4e2a\u6f5c\u5728\u7684\u95ee\u9898 \u7b2c\u4e00\u4e2a\u95ee\u9898\u662f\uff0c\u5f53\u4f7f\u7528 RDB \u5bf9\u6570\u636e\u8fdb\u884c\u6301\u4e45\u5316\u65f6\uff0c\u5982\u679c\u6570\u636e\u91cf\u589e\u52a0\uff0c\u9700\u8981\u7684\u5185\u5b58\u4e5f\u4f1a\u589e\u52a0\uff0c\u4e3b\u7ebf\u7a0b fork \u5b50\u8fdb\u7a0b\u65f6\u5c31\u53ef\u80fd\u4f1a\u963b\u585e\uff08\u6bd4\u5982\u521a\u521a\u7684\u4f8b\u5b50\u4e2d\u7684\u60c5\u51b5\uff09\u3002 \u4e0d\u8fc7\uff0c\u5982\u679c\u4f60\u4e0d\u8981\u6c42\u6301\u4e45\u5316\u4fdd\u5b58 Redis \u6570\u636e\uff0c\u90a3\u4e48\uff0c\u7eb5\u5411\u6269\u5c55\u4f1a\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002 \u7b2c\u4e8c\u4e2a\u95ee\u9898\uff1a\u7eb5\u5411\u6269\u5c55\u4f1a\u53d7\u5230\u786c\u4ef6\u548c\u6210\u672c\u7684\u9650\u5236\u3002\u8fd9\u5f88\u5bb9\u6613\u7406\u89e3\uff0c\u6bd5\u7adf\uff0c\u628a\u5185\u5b58\u4ece 32GB \u6269\u5c55\u5230 64GB \u8fd8\u7b97\u5bb9\u6613\uff0c\u4f46\u662f\uff0c\u8981\u60f3\u6269\u5145\u5230 1TB\uff0c\u5c31\u4f1a\u9762\u4e34\u786c\u4ef6\u5bb9\u91cf\u548c\u6210\u672c\u4e0a\u7684\u9650\u5236\u4e86\u3002","title":"3-1 \u7eb5\u5411\u6269\u5c55"},{"location":"chap2/9redis_slot/#3-2","text":"\u6a2a\u5411\u6269\u5c55\u662f\u4e00\u4e2a\u6269\u5c55\u6027\u66f4\u597d\u7684\u65b9\u6848 \u8981\u60f3\u4fdd\u5b58\u66f4\u591a\u7684\u6570\u636e\uff0c\u91c7\u7528\u8fd9\u79cd\u65b9\u6848\u7684\u8bdd\uff0c\u53ea\u7528\u589e\u52a0 Redis \u7684\u5b9e\u4f8b\u4e2a\u6570\u5c31\u884c\u4e86\uff0c\u4e0d\u7528\u62c5\u5fc3\u5355\u4e2a\u5b9e\u4f8b\u7684\u786c\u4ef6\u548c\u6210\u672c\u9650\u5236\u3002 \u5728\u9762\u5411\u767e\u4e07\u3001\u5343\u4e07\u7ea7\u522b\u7684\u7528\u6237\u89c4\u6a21\u65f6\uff0c\u6a2a\u5411\u6269\u5c55\u7684 Redis \u5207\u7247\u96c6\u7fa4\u4f1a\u662f\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u9009\u62e9\u3002 \u4e24\u4e2a\u95ee\u9898 \u6570\u636e\u5207\u7247\u540e\uff0c\u5728\u591a\u4e2a\u5b9e\u4f8b\u4e4b\u95f4\u5982\u4f55\u5206\u5e03\uff1f \u5ba2\u6237\u7aef\u600e\u4e48\u786e\u5b9a\u60f3\u8981\u8bbf\u95ee\u7684\u6570\u636e\u5728\u54ea\u4e2a\u5b9e\u4f8b\u4e0a\uff1f","title":"3-2 \u6a2a\u5411\u6269\u5c55"},{"location":"chap2/9redis_slot/#4","text":"Redis 3.0 \u5f00\u59cb\uff0c\u5b98\u65b9\u63d0\u4f9b\u4e86\u4e00\u4e2a\u540d\u4e3a Redis Cluster \u7684\u65b9\u6848\uff0c\u7528\u4e8e\u5b9e\u73b0\u5207\u7247\u96c6\u7fa4\u3002 Redis Cluster \u65b9\u6848\u4e2d\u5c31\u89c4\u5b9a\u4e86\u6570\u636e\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u89c4\u5219\u3002 Redis Cluster \u65b9\u6848\u91c7\u7528\u54c8\u5e0c\u69fd\uff08Hash Slot\uff0c\u63a5\u4e0b\u6765\u6211\u4f1a\u76f4\u63a5\u79f0\u4e4b\u4e3a Slot\uff09\uff0c\u6765\u5904\u7406\u6570\u636e\u548c\u5b9e\u4f8b\u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb\u3002 \u5728 Redis Cluster \u65b9\u6848\u4e2d\uff0c\u4e00\u4e2a\u5207\u7247\u96c6\u7fa4\u5171\u6709 16384 \u4e2a\u54c8\u5e0c\u69fd\uff0c\u8fd9\u4e9b\u54c8\u5e0c\u69fd\u7c7b\u4f3c\u4e8e\u6570\u636e\u5206\u533a\uff0c\u6bcf\u4e2a\u952e\u503c\u5bf9\u90fd\u4f1a\u6839\u636e\u5b83\u7684 key\uff0c\u88ab\u6620\u5c04\u5230\u4e00\u4e2a\u54c8\u5e0c\u69fd\u4e2d\u3002","title":"4\u3001\u6570\u636e\u5207\u7247\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5206\u5e03\u5173\u7cfb"},{"location":"chap2/9redis_slot/#4-1","text":"\u9996\u5148\u6839\u636e\u952e\u503c\u5bf9\u7684 key\uff0c\u6309\u7167 CRC16 \u7b97\u6cd5\u8ba1\u7b97\u4e00\u4e2a 16 bit \u7684\u503c\uff1b \u7136\u540e\uff0c\u518d\u7528\u8fd9\u4e2a 16bit \u503c\u5bf9 16384 \u53d6\u6a21\uff0c\u5f97\u5230 0~16383 \u8303\u56f4\u5185\u7684\u6a21\u6570\uff0c\u6bcf\u4e2a\u6a21\u6570\u4ee3\u8868\u4e00\u4e2a\u76f8\u5e94\u7f16\u53f7\u7684\u54c8\u5e0c\u69fd\u3002 \u54c8\u5e0c\u69fd\u53c8\u662f\u5982\u4f55\u88ab\u6620\u5c04\u5230\u5177\u4f53\u7684 Redis \u5b9e\u4f8b\u4e0a \u6211\u4eec\u5728\u90e8\u7f72 Redis Cluster \u65b9\u6848\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 cluster create \u547d\u4ee4\u521b\u5efa\u96c6\u7fa4\uff0c\u6b64\u65f6\uff0cRedis \u4f1a\u81ea\u52a8\u628a\u8fd9\u4e9b\u69fd\u5e73\u5747\u5206\u5e03\u5728\u96c6\u7fa4\u5b9e\u4f8b\u4e0a\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u96c6\u7fa4\u4e2d\u6709 N \u4e2a\u5b9e\u4f8b\uff0c\u90a3\u4e48\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u69fd\u4e2a\u6570\u4e3a 16384/N \u4e2a\u3002 \u5f53\u7136\uff0c \u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528 cluster meet \u547d\u4ee4\u624b\u52a8\u5efa\u7acb\u5b9e\u4f8b\u95f4\u7684\u8fde\u63a5\uff0c\u5f62\u6210\u96c6\u7fa4\uff0c\u518d\u4f7f\u7528 cluster addslots \u547d\u4ee4\uff0c\u6307\u5b9a\u6bcf\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u54c8\u5e0c\u69fd\u4e2a\u6570\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u96c6\u7fa4\u4e2d\u4e0d\u540c Redis \u5b9e\u4f8b\u7684\u5185\u5b58\u5927\u5c0f\u914d\u7f6e\u4e0d\u4e00\uff0c\u5982\u679c\u628a\u54c8\u5e0c\u69fd\u5747\u5206\u5728\u5404\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u5728\u4fdd\u5b58\u76f8\u540c\u6570\u91cf\u7684\u952e\u503c\u5bf9\u65f6\uff0c\u548c\u5185\u5b58\u5927\u7684\u5b9e\u4f8b\u76f8\u6bd4\uff0c\u5185\u5b58\u5c0f\u7684\u5b9e\u4f8b\u5c31\u4f1a\u6709\u66f4\u5927\u7684\u5bb9\u91cf\u538b\u529b \u6839\u636e\u4e0d\u540c\u5b9e\u4f8b\u7684\u8d44\u6e90\u914d\u7f6e\u60c5\u51b5\uff0c\u4f7f\u7528 cluster addslots \u547d\u4ee4\u624b\u52a8\u5206\u914d\u54c8\u5e0c\u69fd\u3002 \u5207\u7247\u96c6\u7fa4\u4e00\u5171\u6709 3 \u4e2a\u5b9e\u4f8b\uff0c\u540c\u65f6\u5047\u8bbe\u6709 5 \u4e2a\u54c8\u5e0c\u69fd\uff0c\u6211\u4eec\u9996\u5148\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u624b\u52a8\u5206\u914d\u54c8\u5e0c\u69fd\uff1a \u5b9e\u4f8b 1 \u4fdd\u5b58\u54c8\u5e0c\u69fd 0 \u548c 1\uff0c\u5b9e\u4f8b 2 \u4fdd\u5b58\u54c8\u5e0c\u69fd 2 \u548c 3\uff0c\u5b9e\u4f8b 3 \u4fdd\u5b58\u54c8\u5e0c\u69fd 4\u3002 redis-cli -h 172.16.19.3 \u2013p 6379 cluster addslots 0,1 redis-cli -h 172.16.19.4 \u2013p 6379 cluster addslots 2,3 redis-cli -h 172.16.19.5 \u2013p 6379 cluster addslots 4 \u5728\u96c6\u7fa4\u8fd0\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0ckey1 \u548c key2 \u8ba1\u7b97\u5b8c CRC16 \u503c\u540e\uff0c\u5bf9\u54c8\u5e0c\u69fd\u603b\u4e2a\u6570 5 \u53d6\u6a21\uff0c\u518d\u6839\u636e\u5404\u81ea\u7684\u6a21\u6570\u7ed3\u679c\uff0c\u5c31\u53ef\u4ee5\u88ab\u6620\u5c04\u5230\u5bf9\u5e94\u7684\u5b9e\u4f8b 1 \u548c\u5b9e\u4f8b 3 \u4e0a\u4e86\u3002 \u5728\u624b\u52a8\u5206\u914d\u54c8\u5e0c\u69fd\u65f6\uff0c\u9700\u8981\u628a 16384 \u4e2a\u69fd\u90fd\u5206\u914d\u5b8c\uff0c\u5426\u5219 Redis \u96c6\u7fa4\u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c\u3002","title":"4-1 \u6620\u5c04\u8fc7\u7a0b"},{"location":"chap2/9redis_slot/#5","text":"\u5728\u5b9a\u4f4d\u952e\u503c\u5bf9\u6570\u636e\u65f6\uff0c\u5b83\u6240\u5904\u7684\u54c8\u5e0c\u69fd\u662f\u53ef\u4ee5\u901a\u8fc7\u8ba1\u7b97\u5f97\u5230\u7684\uff0c\u8fd9\u4e2a\u8ba1\u7b97\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u65f6\u6765\u6267\u884c \u5ba2\u6237\u7aef\u548c\u96c6\u7fa4\u5b9e\u4f8b\u5efa\u7acb\u8fde\u63a5\u540e\uff0c\u5b9e\u4f8b\u5c31\u4f1a\u628a\u54c8\u5e0c\u69fd\u7684\u5206\u914d\u4fe1\u606f\u53d1\u7ed9\u5ba2\u6237\u7aef\u3002 \u4f46\u662f\uff0c\u5728\u96c6\u7fa4\u521a\u521a\u521b\u5efa\u7684\u65f6\u5019\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u53ea\u77e5\u9053\u81ea\u5df1\u88ab\u5206\u914d\u4e86\u54ea\u4e9b\u54c8\u5e0c\u69fd\uff0c\u662f\u4e0d\u77e5\u9053\u5176\u4ed6\u5b9e\u4f8b\u62e5\u6709\u7684\u54c8\u5e0c\u69fd\u4fe1\u606f\u7684\u3002","title":"5\u3001\u5ba2\u6237\u7aef\u5982\u4f55\u5b9a\u4f4d\u6570\u636e\uff1f"},{"location":"chap2/9redis_slot/#5-1","text":"\u90a3\u4e48\uff0c\u5ba2\u6237\u7aef\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u5728\u8bbf\u95ee\u4efb\u4f55\u4e00\u4e2a\u5b9e\u4f8b\u65f6\uff0c\u90fd\u80fd\u83b7\u5f97\u6240\u6709\u7684\u54c8\u5e0c\u69fd\u4fe1\u606f\u5462\uff1f \u8fd9\u662f\u56e0\u4e3a\uff0cRedis \u5b9e\u4f8b\u4f1a\u628a\u81ea\u5df1\u7684\u54c8\u5e0c\u69fd\u4fe1\u606f\u53d1\u7ed9\u548c\u5b83\u76f8\u8fde\u63a5\u7684\u5176\u5b83\u5b9e\u4f8b\uff0c\u6765\u5b8c\u6210\u54c8\u5e0c\u69fd\u5206\u914d\u4fe1\u606f\u7684\u6269\u6563\u3002\u5f53\u5b9e\u4f8b\u4e4b\u95f4\u76f8\u4e92\u8fde\u63a5\u540e\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u5c31\u6709\u6240\u6709\u54c8\u5e0c\u69fd\u7684\u6620\u5c04\u5173\u7cfb\u4e86 \u3002 \u5ba2\u6237\u7aef\u6536\u5230\u54c8\u5e0c\u69fd\u4fe1\u606f\u540e\uff0c\u4f1a\u628a\u54c8\u5e0c\u69fd\u4fe1\u606f\u7f13\u5b58\u5728\u672c\u5730\u3002 \u5f53\u5ba2\u6237\u7aef\u8bf7\u6c42\u952e\u503c\u5bf9\u65f6\uff0c\u4f1a\u5148\u8ba1\u7b97\u952e\u6240\u5bf9\u5e94\u7684\u54c8\u5e0c\u69fd\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u7ed9\u76f8\u5e94\u7684\u5b9e\u4f8b\u53d1\u9001\u8bf7\u6c42\u4e86\u3002 \u5728\u96c6\u7fa4\u4e2d\uff0c\u5b9e\u4f8b\u548c\u54c8\u5e0c\u69fd\u7684\u5bf9\u5e94\u5173\u7cfb\u5e76\u4e0d\u662f\u4e00\u6210\u4e0d\u53d8\u7684\uff0c\u6700\u5e38\u89c1\u7684\u53d8\u5316\u6709\u4e24\u4e2a \u5728\u96c6\u7fa4\u4e2d\uff0c\u5b9e\u4f8b\u6709\u65b0\u589e\u6216\u5220\u9664\uff0cRedis \u9700\u8981\u91cd\u65b0\u5206\u914d\u54c8\u5e0c\u69fd\uff1b \u4e3a\u4e86\u8d1f\u8f7d\u5747\u8861\uff0cRedis \u9700\u8981\u628a\u54c8\u5e0c\u69fd\u5728\u6240\u6709\u5b9e\u4f8b\u4e0a\u91cd\u65b0\u5206\u5e03\u4e00\u904d\u3002","title":"5-1 \u5ba2\u6237\u7aef\u83b7\u5f97\u6240\u6709\u7684\u54c8\u5e0c\u69fd\u4fe1\u606f"},{"location":"chap2/9redis_slot/#5-2","text":"\u5ba2\u6237\u7aef\u662f\u65e0\u6cd5\u4e3b\u52a8\u611f\u77e5\u8fd9\u4e9b\u53d8\u5316\u7684\u3002\u8fd9\u5c31\u4f1a\u5bfc\u81f4\uff0c\u5b83\u7f13\u5b58\u7684\u5206\u914d\u4fe1\u606f\u548c\u6700\u65b0\u7684\u5206\u914d\u4fe1\u606f\u5c31\u4e0d\u4e00\u81f4\u4e86\uff0c Redis Cluster \u65b9\u6848\u63d0\u4f9b\u4e86\u4e00\u79cd\u91cd\u5b9a\u5411\u673a\u5236 \uff0c\u6240\u8c13\u7684\u201c\u91cd\u5b9a\u5411\u201d\uff0c\u5c31\u662f\u6307\uff0c\u5ba2\u6237\u7aef\u7ed9\u4e00\u4e2a\u5b9e\u4f8b\u53d1\u9001\u6570\u636e\u8bfb\u5199\u64cd\u4f5c\u65f6\uff0c\u8fd9\u4e2a\u5b9e\u4f8b\u4e0a\u5e76\u6ca1\u6709\u76f8\u5e94\u7684\u6570\u636e\uff0c\u5ba2\u6237\u7aef\u8981\u518d\u7ed9\u4e00\u4e2a\u65b0\u5b9e\u4f8b\u53d1\u9001\u64cd\u4f5c\u547d\u4ee4\u3002 \u90a3\u5ba2\u6237\u7aef\u53c8\u662f\u600e\u4e48\u77e5\u9053\u91cd\u5b9a\u5411\u65f6\u7684\u65b0\u5b9e\u4f8b\u7684\u8bbf\u95ee\u5730\u5740\u5462\uff1f \u5f53\u5ba2\u6237\u7aef\u628a\u4e00\u4e2a\u952e\u503c\u5bf9\u7684\u64cd\u4f5c\u8bf7\u6c42\u53d1\u7ed9\u4e00\u4e2a\u5b9e\u4f8b\u65f6\uff0c\u5982\u679c\u8fd9\u4e2a\u5b9e\u4f8b\u4e0a\u5e76\u6ca1\u6709\u8fd9\u4e2a\u952e\u503c\u5bf9\u6620\u5c04\u7684\u54c8\u5e0c\u69fd\uff0c\u90a3\u4e48\uff0c \u8fd9\u4e2a\u5b9e\u4f8b\u5c31\u4f1a\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u4e0b\u9762\u7684 MOVED \u547d\u4ee4\u54cd\u5e94\u7ed3\u679c\uff0c\u8fd9\u4e2a\u7ed3\u679c\u4e2d\u5c31\u5305\u542b\u4e86\u65b0\u5b9e\u4f8b\u7684\u8bbf\u95ee\u5730\u5740 \u3002 GET hello:key (error) MOVED 13320 172.16.19.5:6379 \u5176\u4e2d\uff0cMOVED \u547d\u4ee4\u8868\u793a\uff0c\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u952e\u503c\u5bf9\u6240\u5728\u7684\u54c8\u5e0c\u69fd 13320\uff0c\u5b9e\u9645\u662f\u5728 172.16.19.5 \u8fd9\u4e2a\u5b9e\u4f8b\u4e0a\u3002 * \u901a\u8fc7\u8fd4\u56de\u7684 MOVED \u547d\u4ee4\uff0c\u5c31\u76f8\u5f53\u4e8e\u628a\u54c8\u5e0c\u69fd\u6240\u5728\u7684\u65b0\u5b9e\u4f8b\u7684\u4fe1\u606f\u544a\u8bc9\u7ed9\u5ba2\u6237\u7aef\u4e86\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u76f4\u63a5\u548c 172.16.19.5 \u8fde\u63a5\uff0c\u5e76\u53d1\u9001\u64cd\u4f5c\u8bf7\u6c42\u4e86\u3002","title":"5-2 \u5ba2\u6237\u7aef\u83b7\u5f97\u6700\u65b0\u7684\u54c8\u5e0c\u69fd\u5206\u914d\u4fe1\u606f(\u91cd\u5b9a\u5411\u673a\u5236)"},{"location":"chap2/9redis_slot/#5-3-moved","text":"\u7531\u4e8e\u8d1f\u8f7d\u5747\u8861\uff0cSlot 2 \u4e2d\u7684\u6570\u636e\u5df2\u7ecf\u4ece\u5b9e\u4f8b 2 \u8fc1\u79fb\u5230\u4e86\u5b9e\u4f8b 3 \u4f46\u662f\uff0c\u5ba2\u6237\u7aef\u7f13\u5b58\u4ecd\u7136\u8bb0\u5f55\u7740\u201cSlot 2 \u5728\u5b9e\u4f8b 2\u201d\u7684\u4fe1\u606f\uff0c\u6240\u4ee5\u4f1a\u7ed9\u5b9e\u4f8b 2 \u53d1\u9001\u547d\u4ee4\u3002 \u5b9e\u4f8b 2 \u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u4e00\u6761 MOVED \u547d\u4ee4\uff0c\u628a Slot 2 \u7684\u6700\u65b0\u4f4d\u7f6e\uff08\u4e5f\u5c31\u662f\u5728\u5b9e\u4f8b 3 \u4e0a\uff09\uff0c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c * \u5ba2\u6237\u7aef\u5c31\u4f1a\u518d\u6b21\u5411\u5b9e\u4f8b 3 \u53d1\u9001\u8bf7\u6c42\uff0c\u540c\u65f6\u8fd8\u4f1a\u66f4\u65b0\u672c\u5730\u7f13\u5b58\uff0c\u628a Slot 2 \u4e0e\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\u66f4\u65b0\u8fc7\u6765\u3002 \u5728\u4e0a\u56fe\u4e2d\uff0c\u5f53\u5ba2\u6237\u7aef\u7ed9\u5b9e\u4f8b 2 \u53d1\u9001\u547d\u4ee4\u65f6\uff0cSlot 2 \u4e2d\u7684\u6570\u636e\u5df2\u7ecf\u5168\u90e8\u8fc1\u79fb\u5230\u4e86\u5b9e\u4f8b 3\u3002","title":"5-3 MOVED \u91cd\u5b9a\u5411\u547d\u4ee4\u7684\u4f7f\u7528\u65b9\u6cd5"},{"location":"chap2/9redis_slot/#5-3-ask","text":"\u5728\u5b9e\u9645\u5e94\u7528\u65f6\uff0c\u5982\u679c Slot 2 \u4e2d\u7684\u6570\u636e\u6bd4\u8f83\u591a\uff0c\u5c31\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e00\u79cd\u60c5\u51b5\uff1a\u5ba2\u6237\u7aef\u5411\u5b9e\u4f8b 2 \u53d1\u9001\u8bf7\u6c42\uff0c\u4f46\u6b64\u65f6\uff0c Slot 2 \u4e2d\u7684\u6570\u636e\u53ea\u6709\u4e00\u90e8\u5206\u8fc1\u79fb\u5230\u4e86\u5b9e\u4f8b 3\uff0c\u8fd8\u6709\u90e8\u5206\u6570\u636e\u6ca1\u6709\u8fc1\u79fb\u3002\u5728\u8fd9\u79cd\u8fc1\u79fb\u90e8\u5206\u5b8c\u6210\u7684\u60c5\u51b5\u4e0b\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u6536\u5230\u4e00\u6761 ASK \u62a5\u9519\u4fe1\u606f \uff0c GET hello:key (error) ASK 13320 172.16.19.5:6379 \u8fd9\u4e2a\u7ed3\u679c\u4e2d\u7684 ASK \u547d\u4ee4\u5c31\u8868\u793a\uff0c\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u952e\u503c\u5bf9\u6240\u5728\u7684\u54c8\u5e0c\u69fd 13320\uff0c\u5728 172.16.19.5 \u8fd9\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u4f46\u662f\u8fd9\u4e2a\u54c8\u5e0c\u69fd\u6b63\u5728\u8fc1\u79fb\u3002 \u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u5148\u7ed9 172.16.19.5 \u8fd9\u4e2a\u5b9e\u4f8b\u53d1\u9001\u4e00\u4e2a ASKING \u547d\u4ee4\u3002 \u8fd9\u4e2a\u547d\u4ee4\u7684\u610f\u601d\u662f\uff0c\u8ba9\u8fd9\u4e2a\u5b9e\u4f8b\u5141\u8bb8\u6267\u884c\u5ba2\u6237\u7aef\u63a5\u4e0b\u6765\u53d1\u9001\u7684\u547d\u4ee4\u3002 \u7136\u540e\uff0c\u5ba2\u6237\u7aef\u518d\u5411\u8fd9\u4e2a\u5b9e\u4f8b\u53d1\u9001 GET \u547d\u4ee4\uff0c\u4ee5\u8bfb\u53d6\u6570\u636e \u5982\u56fe\uff0cSlot 2 \u6b63\u5728\u4ece\u5b9e\u4f8b 2 \u5f80\u5b9e\u4f8b 3 \u8fc1\u79fb\uff0ckey1 \u548c key2 \u5df2\u7ecf\u8fc1\u79fb\u8fc7\u53bb\uff0ckey3 \u548c key4 \u8fd8\u5728\u5b9e\u4f8b 2\u3002\u5ba2\u6237\u7aef\u5411\u5b9e\u4f8b 2 \u8bf7\u6c42 key2 \u540e\uff0c\u5c31\u4f1a\u6536\u5230\u5b9e\u4f8b 2 \u8fd4\u56de\u7684 ASK \u547d\u4ee4\u3002 ASK \u547d\u4ee4\u8868\u793a\u4e24\u5c42\u542b\u4e49 \u7b2c\u4e00\uff0c\u8868\u660e Slot \u6570\u636e\u8fd8\u5728\u8fc1\u79fb\u4e2d\uff1b \u7b2c\u4e8c\uff0cASK \u547d\u4ee4\u628a\u5ba2\u6237\u7aef\u6240\u8bf7\u6c42\u6570\u636e\u7684\u6700\u65b0\u5b9e\u4f8b\u5730\u5740\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c \u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u7ed9\u5b9e\u4f8b 3 \u53d1\u9001 ASKING \u547d\u4ee4\uff0c\u7136\u540e\u518d\u53d1\u9001\u64cd\u4f5c\u547d\u4ee4 \u3002 \u548c MOVED \u547d\u4ee4\u4e0d\u540c\uff0cASK \u547d\u4ee4\u5e76\u4e0d\u4f1a\u66f4\u65b0\u5ba2\u6237\u7aef\u7f13\u5b58\u7684\u54c8\u5e0c\u69fd\u5206\u914d\u4fe1\u606f\u3002 \u5982\u679c\u5ba2\u6237\u7aef\u518d\u6b21\u8bf7\u6c42 Slot 2 \u4e2d\u7684\u6570\u636e\uff0c\u5b83\u8fd8\u662f\u4f1a\u7ed9\u5b9e\u4f8b 2 \u53d1\u9001\u8bf7\u6c42\u3002 \u8fd9\u4e5f\u5c31\u662f\u8bf4\uff0cASK \u547d\u4ee4\u7684\u4f5c\u7528\u53ea\u662f\u8ba9\u5ba2\u6237\u7aef\u80fd\u7ed9\u65b0\u5b9e\u4f8b\u53d1\u9001\u4e00\u6b21\u8bf7\u6c42 \uff0c\u800c\u4e0d\u50cf MOVED \u547d\u4ee4\u90a3\u6837\uff0c\u4f1a\u66f4\u6539\u672c\u5730\u7f13\u5b58\uff0c\u8ba9\u540e\u7eed\u6240\u6709\u547d\u4ee4\u90fd\u53d1\u5f80\u65b0\u5b9e\u4f8b\u3002","title":"5-3 ASK \u547d\u4ee4\u89e3\u51b3\u90e8\u5206\u6570\u636e\u524d\u79fb\u7684\u95ee\u9898"},{"location":"chap2/9redis_slot/#6","text":"\u5207\u7247\u96c6\u7fa4\u5728\u4fdd\u5b58\u5927\u91cf\u6570\u636e\u65b9\u9762\u7684\u4f18\u52bf\uff0c\u4ee5\u53ca\u57fa\u4e8e\u54c8\u5e0c\u69fd\u7684\u6570\u636e\u5206\u5e03\u673a\u5236\u548c\u5ba2\u6237\u7aef\u5b9a\u4f4d\u952e\u503c\u5bf9\u7684\u65b9\u6cd5\u3002 \u5728\u5e94\u5bf9\u6570\u636e\u91cf\u6269\u5bb9\u65f6\uff0c\u867d\u7136\u589e\u52a0\u5185\u5b58\u8fd9\u79cd\u7eb5\u5411\u6269\u5c55\u7684\u65b9\u6cd5\u7b80\u5355\u76f4\u63a5\uff0c\u4f46\u662f\u4f1a\u9020\u6210\u6570\u636e\u5e93\u7684\u5185\u5b58\u8fc7\u5927\uff0c\u5bfc\u81f4\u6027\u80fd\u53d8\u6162\u3002 Redis \u5207\u7247\u96c6\u7fa4\u63d0\u4f9b\u4e86\u6a2a\u5411\u6269\u5c55\u7684\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f\u4f7f\u7528\u591a\u4e2a\u5b9e\u4f8b\uff0c\u5e76\u7ed9\u6bcf\u4e2a\u5b9e\u4f8b\u914d\u7f6e\u4e00\u5b9a\u6570\u91cf\u7684\u54c8\u5e0c\u69fd\uff0c\u6570\u636e\u53ef\u4ee5\u901a\u8fc7\u952e\u7684\u54c8\u5e0c\u503c\u6620\u5c04\u5230\u54c8\u5e0c\u69fd\uff0c\u518d\u901a\u8fc7\u54c8\u5e0c\u69fd\u5206\u6563\u4fdd\u5b58\u5230\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\u3002 \u96c6\u7fa4\u7684\u5b9e\u4f8b\u589e\u51cf\uff0c\u6216\u8005\u662f\u4e3a\u4e86\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861\u800c\u8fdb\u884c\u7684\u6570\u636e\u91cd\u65b0\u5206\u5e03\uff0c\u4f1a\u5bfc\u81f4\u54c8\u5e0c\u69fd\u548c\u5b9e\u4f8b\u7684\u6620\u5c04\u5173\u7cfb\u53d1\u751f\u53d8\u5316\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u4f1a\u6536\u5230\u547d\u4ee4\u6267\u884c\u62a5\u9519\u4fe1\u606f\u3002","title":"6\u3001\u672c\u8282\u5c0f\u8282"},{"location":"chap2/9redis_slot/#6-1","text":"\u8fd9\u4e00\u8bfe\u6211\u66f4\u52a0\u6e05\u6670\u7684\u660e\u767d\u4e86\u4e4b\u524d\u522b\u4eba\u804aRedis\u6269\u5bb9\u4e2d\u7684\u7eb5\u5411\u6269\u5bb9\u548c\u6a2a\u5411\u6269\u5bb9\u7684\u771f\u5b9e\u542b\u4e49\u548c\u533a\u522b \u6570\u636e\u5206\u7247\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\u5efa\u7acb\uff1a\u6309\u7167CRC16\u7b97\u6cd5\u8ba1\u7b97\u4e00\u4e2akey\u768416bit\u7684\u503c\uff0c\u5728\u5c06\u8fd9\u503c\u5bf916384\u53d6\u6a21 \u4e00\u4e2a\u5207\u7247\u96c6\u7fa4\u7684\u69fd\u4f4d\u662f\u56fa\u5b9a\u768416384\u4e2a\uff0c\u53ef\u624b\u52a8\u5206\u914d\u6bcf\u4e2a\u5b9e\u4f8b\u7684\u69fd\u4f4d\uff0c\u4f46\u5fc5\u987b\u5c06\u69fd\u4f4d\u5168\u90e8\u5206\u5b8c \u5ba2\u6237\u7aef\u5982\u4f55\u786e\u5b9a\u8981\u8bbf\u95ee\u90a3\u4e2a\u5b9e\u4f8b\u83b7\u53d6\u6570\u636e\uff1a \u4ece\u4efb\u610f\u4e2a\u5b9e\u4f8b\u83b7\u53d6\u5e76\u7f13\u5b58\u5728\u81ea\u5df1\u672c\u5730\uff0c \u91cd\u5b9a\u5411\u673a\u5236 \u91cd\u5b9a\u5411\u673a\u5236\uff1a\u5ba2\u6237\u7aef\u8bbf\u95ee\u7684\u5b9e\u4f8b\u6ca1\u6709\u6570\u636e\uff0c\u88ab\u8bbf\u95ee\u5b9e\u4f8b\u54cd\u5e94move\u547d\u4ee4\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\u6307\u5411\u65b0\u7684\u5b9e\u4f8b\u5730\u5740 ASK\u547d\u4ee4\uff1a1\uff0c\u8868\u660e\u6570\u636e\u6b63\u5728\u8fc1\u79fb 2\uff0c\u544a\u77e5\u5ba2\u6237\u7aef\u6570\u636e\u6240\u5728\u7684\u5b9e\u4f8b ASK\u547d\u4ee4\u548cMOVE\u547d\u4ee4\u7684\u533a\u522b\uff1a move\u547d\u4ee4\u662f\u5728\u6570\u636e\u8fc1\u79fb\u5b8c\u6bd5\u540e\u88ab\u54cd\u5e94\uff0c\u5ba2\u6237\u7aef\u4f1a\u66f4\u65b0\u672c\u5730\u7f13\u5b58\u3002 ASK\u547d\u4ee4\u662f\u5728\u6570\u636e\u8fc1\u79fb\u4e2d\u88ab\u54cd\u5e94\uff0c\u4e0d\u4f1a\u8ba9\u5ba2\u6237\u7aef\u66f4\u65b0\u7f13\u5b58","title":"6-1 \u672c\u8282\u4eae\u70b9"},{"location":"chap2/9redis_slot/#6-2","text":"Redis Cluster \u65b9\u6848\u901a\u8fc7\u54c8\u5e0c\u69fd\u7684\u65b9\u5f0f\u628a\u952e\u503c\u5bf9\u5206\u914d\u5230\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u9700\u8981\u5bf9\u952e\u503c\u5bf9\u7684 key \u505a CRC \u8ba1\u7b97\uff0c\u7136\u540e\u518d\u548c\u54c8\u5e0c\u69fd\u505a\u6620\u5c04\uff0c\u8fd9\u6837\u505a\u6709\u4ec0\u4e48\u597d\u5904\u5417\uff1f\u5982\u679c\u7528\u4e00\u4e2a\u8868\u76f4\u63a5\u628a\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\u8bb0\u5f55\u4e0b\u6765\uff08\u4f8b\u5982\u952e\u503c\u5bf9 1 \u5728\u5b9e\u4f8b 2 \u4e0a\uff0c\u952e\u503c\u5bf9 2 \u5728\u5b9e\u4f8b 1 \u4e0a\uff09\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u8ba1\u7b97 key \u548c\u54c8\u5e0c\u69fd\u7684\u5bf9\u5e94\u5173\u7cfb\u4e86\uff0c\u53ea\u7528\u67e5\u8868\u5c31\u884c\u4e86\uff0cRedis \u4e3a\u4ec0\u4e48\u4e0d\u8fd9\u4e48\u505a\u5462\uff1f \u5982\u679c\u4f7f\u7528\u8868\u8bb0\u5f55\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u4e00\u65e6\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\u53d1\u751f\u4e86\u53d8\u5316\uff08\u4f8b\u5982\u5b9e\u4f8b\u6709\u589e\u51cf\u6216\u8005\u6570\u636e\u91cd\u65b0\u5206\u5e03\uff09\uff0c\u5c31\u8981\u4fee\u6539\u8868\u3002\u5982\u679c\u662f\u5355\u7ebf\u7a0b\u64cd\u4f5c\u8868\uff0c\u90a3\u4e48\u6240\u6709\u64cd\u4f5c\u90fd\u8981\u4e32\u884c\u6267\u884c\uff0c\u6027\u80fd\u6162\uff1b\u5982\u679c\u662f\u591a\u7ebf\u7a0b\u64cd\u4f5c\u8868\uff0c\u5c31\u6d89\u53ca\u5230\u52a0\u9501\u5f00\u9500\u3002\u6b64\u5916\uff0c\u5982\u679c\u6570\u636e\u91cf\u975e\u5e38\u5927\uff0c\u4f7f\u7528\u8868\u8bb0\u5f55\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u9700\u8981\u7684\u989d\u5916\u5b58\u50a8\u7a7a\u95f4\u4e5f\u4f1a\u589e\u52a0\u3002 \u57fa\u4e8e\u54c8\u5e0c\u69fd\u8ba1\u7b97\u65f6\uff0c\u867d\u7136\u4e5f\u8981\u8bb0\u5f55\u54c8\u5e0c\u69fd\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u4f46\u662f\u54c8\u5e0c\u69fd\u7684\u4e2a\u6570\u8981\u6bd4\u952e\u503c\u5bf9\u7684\u4e2a\u6570\u5c11\u5f88\u591a\uff0c\u65e0\u8bba\u662f\u4fee\u6539\u54c8\u5e0c\u69fd\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u8fd8\u662f\u4f7f\u7528\u989d\u5916\u7a7a\u95f4\u5b58\u50a8\u54c8\u5e0c\u69fd\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u90fd\u6bd4\u76f4\u63a5\u8bb0\u5f55\u952e\u503c\u5bf9\u548c\u5b9e\u4f8b\u7684\u5173\u7cfb\u7684\u5f00\u9500\u5c0f\u5f97\u591a\u3002","title":"6-2 \u672c\u8282\u4e00\u95ee"},{"location":"chap3/1redis_string/","text":"\u7b2c\u4e00\u8282 Redis\u7684String\u7c7b\u578b\u6570\u636e\u7ed3\u6784\uff0c\u53ca\u5176\u5e95\u5c42\u5b9e\u73b0 String \u7c7b\u578b\u7684\u5185\u5b58\u7a7a\u95f4\u6d88\u8017\u95ee\u9898\uff0c\u4ee5\u53ca\u9009\u62e9\u8282\u7701\u5185\u5b58\u5f00\u9500\u7684\u6570\u636e\u7c7b\u578b\u7684\u89e3\u51b3\u65b9\u6848\u3002 1\u3001String \u7c7b\u578b\u7684\u6d88\u8017\u5185\u5b58\u7a7a\u95f4 \u56fe\u7247\u5b58\u50a8\u7cfb\u7edf\uff0c\u8981\u6c42\u8fd9\u4e2a\u7cfb\u7edf\u80fd\u5feb\u901f\u5730\u8bb0\u5f55\u56fe\u7247 ID \u548c\u56fe\u7247\u5728\u5b58\u50a8\u7cfb\u7edf\u4e2d\u4fdd\u5b58\u65f6\u7684 ID\uff08\u53ef\u4ee5\u76f4\u63a5\u53eb\u4f5c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID\uff09\u3002\u540c\u65f6\uff0c\u8fd8\u8981\u80fd\u591f\u6839\u636e\u56fe\u7247 ID \u5feb\u901f\u67e5\u627e\u5230\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID\u3002 \u56e0\u4e3a\u56fe\u7247\u6570\u91cf\u5de8\u5927\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u7528 10 \u4f4d\u6570\u6765\u8868\u793a\u56fe\u7247 ID \u548c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID\uff0c\u4f8b\u5982\uff0c\u56fe\u7247 ID \u4e3a 1101000051\uff0c\u5b83\u5728\u5b58\u50a8\u7cfb\u7edf\u4e2d\u5bf9\u5e94\u7684 ID \u53f7\u662f 3301000051\u3002 photo_id: 1101000051 photo_obj_id: 3301000051 \u56fe\u7247 ID \u548c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID \u6b63\u597d\u4e00\u4e00\u5bf9\u5e94\uff0c\u662f\u5178\u578b\u7684\u201c\u952e - \u5355\u503c\u201d\u6a21\u5f0f\u3002 \u6240\u8c13\u7684\u201c\u5355\u503c\u201d\uff0c\u5c31\u662f\u6307\u952e\u503c\u5bf9\u4e2d\u7684\u503c\u5c31\u662f\u4e00\u4e2a\u503c\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u96c6\u5408\uff0c\u8fd9\u548c String \u7c7b\u578b\u63d0\u4f9b\u7684\u201c\u4e00\u4e2a\u952e\u5bf9\u5e94\u4e00\u4e2a\u503c\u7684\u6570\u636e\u201d\u7684\u4fdd\u5b58\u5f62\u5f0f\u521a\u597d\u5951\u5408\u3002 String \u7c7b\u578b\u53ef\u4ee5\u4fdd\u5b58\u4e8c\u8fdb\u5236\u5b57\u8282\u6d41\uff0c\u53ea\u8981\u628a\u6570\u636e\u8f6c\u6210\u4e8c\u8fdb\u5236\u5b57\u8282\u6570\u7ec4\uff0c\u5c31\u53ef\u4ee5\u4fdd\u5b58\u4e86\u3002 \u7b2c\u4e00\u4e2a\u65b9\u6848\u5c31\u662f\u7528 String \u4fdd\u5b58\u6570\u636e\u3002 \u6211\u4eec\u628a\u56fe\u7247 ID \u548c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID \u5206\u522b\u4f5c\u4e3a\u952e\u503c\u5bf9\u7684 key \u548c value \u6765\u4fdd\u5b58\uff0c\u5176\u4e2d\uff0c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID \u7528\u4e86 String \u7c7b\u578b\u3002 \u6211\u4eec\u4fdd\u5b58\u4e86 1 \u4ebf\u5f20\u56fe\u7247\uff0c\u5927\u7ea6\u7528\u4e86 6.4GB \u7684\u5185\u5b58\u3002\u4f46\u662f\uff0c\u968f\u7740\u56fe\u7247\u6570\u636e\u91cf\u7684\u4e0d\u65ad\u589e\u52a0\uff0c\u6211\u4eec\u7684 Redis \u5185\u5b58\u4f7f\u7528\u91cf\u4e5f\u5728\u589e\u52a0\uff0c\u7ed3\u679c\u5c31\u9047\u5230\u4e86\u5927\u5185\u5b58 Redis \u5b9e\u4f8b\u56e0\u4e3a\u751f\u6210 RDB \u800c\u54cd\u5e94\u53d8\u6162\u7684\u95ee\u9898\u3002 String \u7c7b\u578b\u5e76\u4e0d\u662f\u4e00\u79cd\u597d\u7684\u9009\u62e9\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u8fdb\u4e00\u6b65\u5bfb\u627e\u80fd\u8282\u7701\u5185\u5b58\u5f00\u9500\u7684\u6570\u636e\u7c7b\u578b\u65b9\u6848\u3002 String \u7c7b\u578b\u5e76\u4e0d\u662f\u9002\u7528\u4e8e\u6240\u6709\u573a\u5408\u7684\uff0c\u5b83\u6709\u4e00\u4e2a\u660e\u663e\u7684\u77ed\u677f\uff0c\u5c31\u662f\u5b83\u4fdd\u5b58\u6570\u636e\u65f6\u6240\u6d88\u8017\u7684\u5185\u5b58\u7a7a\u95f4\u8f83\u591a\u3002 \u96c6\u5408\u7c7b\u578b\u6709\u975e\u5e38\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u7684\u5e95\u5c42\u5b9e\u73b0\u7ed3\u6784\uff0c\u4f46\u662f\uff0c\u96c6\u5408\u7c7b\u578b\u4fdd\u5b58\u7684\u6570\u636e\u6a21\u5f0f\uff0c \u662f\u4e00\u4e2a\u952e\u5bf9\u5e94\u4e00\u7cfb\u5217\u503c\uff0c\u5e76\u4e0d\u9002\u5408\u76f4\u63a5\u4fdd\u5b58\u5355\u503c\u7684\u952e\u503c\u5bf9 \u3002\u6240\u4ee5\uff0c \u6211\u4eec\u5c31\u4f7f\u7528\u4e8c\u7ea7\u7f16\u7801\u7684\u65b9\u6cd5\uff0c\u5b9e\u73b0\u4e86\u7528\u96c6\u5408\u7c7b\u578b\u4fdd\u5b58\u5355\u503c\u952e\u503c\u5bf9\uff0cRedis \u5b9e\u4f8b\u7684\u5185\u5b58\u7a7a\u95f4\u6d88\u8017\u660e\u663e\u4e0b\u964d\u4e86\u3002 2\u3001\u4e3a\u4ec0\u4e48 String \u7c7b\u578b\u5185\u5b58\u5f00\u9500\u5927\uff1f \u4fdd\u5b58\u4e86 1 \u4ebf\u5f20\u56fe\u7247\u7684\u4fe1\u606f\uff0c\u7528\u4e86\u7ea6 6.4GB \u7684\u5185\u5b58\uff0c\u4e00\u4e2a\u56fe\u7247 ID \u548c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID \u7684\u8bb0\u5f55\u5e73\u5747\u7528\u4e86 64 \u5b57\u8282\u3002 \u4e00\u7ec4\u56fe\u7247 ID \u53ca\u5176\u5b58\u50a8\u5bf9\u8c61 ID \u7684\u8bb0\u5f55\uff0c\u5b9e\u9645\u53ea\u9700\u8981 16 \u5b57\u8282\u5c31\u53ef\u4ee5\u4e86 \u56fe\u7247 ID \u548c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID \u90fd\u662f 10 \u4f4d\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e24\u4e2a 8 \u5b57\u8282\u7684 Long \u7c7b\u578b\u8868\u793a\u8fd9\u4e24\u4e2a ID\u3002\u56e0\u4e3a 8 \u5b57\u8282\u7684 Long \u7c7b\u578b\u6700\u5927\u53ef\u4ee5\u8868\u793a 2 \u7684 64 \u6b21\u65b9\u7684\u6570\u503c\uff0c\u6240\u4ee5\u80af\u5b9a\u53ef\u4ee5\u8868\u793a 10 \u4f4d\u6570\u3002 \u4e3a\u4ec0\u4e48 String \u7c7b\u578b\u5374\u7528\u4e86 64 \u5b57\u8282\u5462\uff1f \u5176\u5b9e\uff0c\u9664\u4e86\u8bb0\u5f55\u5b9e\u9645\u6570\u636e\uff0c String \u7c7b\u578b\u8fd8\u9700\u8981\u989d\u5916\u7684\u5185\u5b58\u7a7a\u95f4\u8bb0\u5f55\u6570\u636e\u957f\u5ea6\u3001\u7a7a\u95f4\u4f7f\u7528\u7b49\u4fe1\u606f\uff0c\u8fd9\u4e9b\u4fe1\u606f\u4e5f\u53eb\u4f5c\u5143\u6570\u636e \u3002 \u5f53\u5b9e\u9645\u4fdd\u5b58\u7684\u6570\u636e\u8f83\u5c0f\u65f6\uff0c\u5143\u6570\u636e\u7684\u7a7a\u95f4\u5f00\u9500\u5c31\u663e\u5f97\u6bd4\u8f83\u5927\u4e86\uff0c\u6709\u70b9\u201c\u55a7\u5bbe\u593a\u4e3b\u201d\u7684\u610f\u601d\u3002 2-1 String \u7c7b\u578b\u5177\u4f53\u662f\u600e\u4e48\u4fdd\u5b58\u6570\u636e\u7684\u5462 \u4fdd\u5b58 64 \u4f4d\u6709\u7b26\u53f7\u6574\u6570\u65f6\uff0cString \u7c7b\u578b\u4f1a\u628a\u5b83\u4fdd\u5b58\u4e3a\u4e00\u4e2a 8 \u5b57\u8282\u7684 Long \u7c7b\u578b\u6574\u6570\uff0c\u8fd9\u79cd\u4fdd\u5b58\u65b9\u5f0f\u901a\u5e38\u4e5f\u53eb\u4f5c int \u7f16\u7801\u65b9\u5f0f\u3002 \u5f53\u4f60\u4fdd\u5b58\u7684\u6570\u636e\u4e2d\u5305\u542b\u5b57\u7b26\u65f6\uff0c String \u7c7b\u578b\u5c31\u4f1a\u7528\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\uff08Simple Dynamic String\uff0cSDS\uff09\u7ed3\u6784\u4f53\u6765\u4fdd\u5b58 buf \uff1a\u5b57\u8282\u6570\u7ec4\uff0c\u4fdd\u5b58\u5b9e\u9645\u6570\u636e\u3002\u4e3a\u4e86\u8868\u793a\u5b57\u8282\u6570\u7ec4\u7684\u7ed3\u675f\uff0cRedis \u4f1a\u81ea\u52a8\u5728\u6570\u7ec4\u6700\u540e\u52a0\u4e00\u4e2a\u201c\\0\u201d\uff0c\u8fd9\u5c31\u4f1a\u989d\u5916\u5360\u7528 1 \u4e2a\u5b57\u8282\u7684\u5f00\u9500\u3002 len\uff1a\u5360 4 \u4e2a\u5b57\u8282\uff0c \u8868\u793a buf \u7684\u5df2\u7528\u957f\u5ea6 \u3002 alloc\uff1a\u4e5f\u5360\u4e2a 4 \u5b57\u8282\uff0c \u8868\u793a buf \u7684\u5b9e\u9645\u5206\u914d\u957f\u5ea6\uff0c\u4e00\u822c\u5927\u4e8e len\u3002 \u5728 SDS \u4e2d\uff0cbuf \u4fdd\u5b58\u5b9e\u9645\u6570\u636e\uff0c\u800c len \u548c alloc \u672c\u8eab\u5176\u5b9e\u662f SDS \u7ed3\u6784\u4f53\u7684\u989d\u5916\u5f00\u9500\u3002 \u5bf9\u4e8e String \u7c7b\u578b\u6765\u8bf4\uff0c\u9664\u4e86 SDS \u7684\u989d\u5916\u5f00\u9500\uff0c\u8fd8\u6709\u4e00\u4e2a\u6765\u81ea\u4e8e RedisObject \u7ed3\u6784\u4f53\u7684\u5f00\u9500\u3002 2-2 RedisObject \u56e0\u4e3a Redis \u7684\u6570\u636e\u7c7b\u578b\u6709\u5f88\u591a\uff0c\u800c\u4e14\uff0c\u4e0d\u540c\u6570\u636e\u7c7b\u578b\u90fd\u6709\u4e9b\u76f8\u540c\u7684\u5143\u6570\u636e\u8981\u8bb0\u5f55\uff08\u6bd4\u5982\u6700\u540e\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u95f4\u3001\u88ab\u5f15\u7528\u7684\u6b21\u6570\u7b49\uff09\uff0c\u6240\u4ee5\uff0c Redis \u4f1a\u7528\u4e00\u4e2a RedisObject \u7ed3\u6784\u4f53\u6765\u7edf\u4e00\u8bb0\u5f55\u8fd9\u4e9b\u5143\u6570\u636e\uff0c\u540c\u65f6\u6307\u5411\u5b9e\u9645\u6570\u636e\u3002 \u4e00\u4e2a RedisObject \u5305\u542b\u4e86 8 \u5b57\u8282\u7684\u5143\u6570\u636e\u548c\u4e00\u4e2a 8 \u5b57\u8282\u6307\u9488\uff0c\u8fd9\u4e2a\u6307\u9488\u518d\u8fdb\u4e00\u6b65\u6307\u5411\u5177\u4f53\u6570\u636e\u7c7b\u578b\u7684\u5b9e\u9645\u6570\u636e\u6240\u5728 \uff0c\u4f8b\u5982\u6307\u5411 String \u7c7b\u578b\u7684 SDS \u7ed3\u6784\u6240\u5728\u7684\u5185\u5b58\u5730\u5740 2-3 int\u3001embstr \u548c raw \u8fd9\u4e09\u79cd\u7f16\u7801\u6a21\u5f0f \u4e3a\u4e86\u8282\u7701\u5185\u5b58\u7a7a\u95f4\uff0cRedis \u8fd8\u5bf9 Long \u7c7b\u578b\u6574\u6570\u548c SDS \u7684\u5185\u5b58\u5e03\u5c40 \u4e00\u65b9\u9762\uff0c\u5f53\u4fdd\u5b58\u7684\u662f Long \u7c7b\u578b\u6574\u6570\u65f6\uff0c RedisObject \u4e2d\u7684\u6307\u9488\u5c31\u76f4\u63a5\u8d4b\u503c\u4e3a\u6574\u6570\u6570\u636e\u4e86\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u989d\u5916\u7684\u6307\u9488\u518d\u6307\u5411\u6574\u6570\u4e86\uff0c\u8282\u7701\u4e86\u6307\u9488\u7684\u7a7a\u95f4\u5f00\u9500 \u3002 \u53e6\u4e00\u65b9\u9762\uff0c\u5f53\u4fdd\u5b58\u7684\u662f\u5b57\u7b26\u4e32\u6570\u636e\uff0c\u5e76\u4e14\u5b57\u7b26\u4e32\u5c0f\u4e8e\u7b49\u4e8e 44 \u5b57\u8282\u65f6\uff0cRedisObject \u4e2d\u7684\u5143\u6570\u636e\u3001\u6307\u9488\u548c SDS \u662f\u4e00\u5757\u8fde\u7eed\u7684\u5185\u5b58\u533a\u57df\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u907f\u514d\u5185\u5b58\u788e\u7247\u3002 \u8fd9\u79cd\u5e03\u5c40\u65b9\u5f0f\u4e5f\u88ab\u79f0\u4e3a embstr \u7f16\u7801\u65b9\u5f0f\u3002 \u5f53\u5b57\u7b26\u4e32\u5927\u4e8e 44 \u5b57\u8282\u65f6 \uff0cSDS \u7684\u6570\u636e\u91cf\u5c31\u5f00\u59cb\u53d8\u591a\u4e86\uff0cRedis \u5c31\u4e0d\u518d\u628a SDS \u548c RedisObject \u5e03\u5c40\u5728\u4e00\u8d77\u4e86\uff0c\u800c\u662f\u4f1a\u7ed9 SDS \u5206\u914d\u72ec\u7acb\u7684\u7a7a\u95f4\uff0c\u5e76\u7528\u6307\u9488\u6307\u5411 SDS \u7ed3\u6784\u3002\u8fd9\u79cd\u5e03\u5c40\u65b9\u5f0f\u88ab\u79f0\u4e3a raw \u7f16\u7801\u6a21\u5f0f\u3002 int\u3001embstr \u548c raw \u8fd9\u4e09\u79cd\u7f16\u7801\u6a21\u5f0f 2-4 \u8ba1\u7b97String \u7c7b\u578b\u7684\u5185\u5b58\u4f7f\u7528\u91cf \u56e0\u4e3a 10 \u4f4d\u6570\u7684\u56fe\u7247 ID \u548c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID \u662f Long \u7c7b\u578b\u6574\u6570\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u7528 int \u7f16\u7801\u7684 RedisObject \u4fdd\u5b58\u3002 \u6bcf\u4e2a int \u7f16\u7801\u7684 RedisObject \u5143\u6570\u636e\u90e8\u5206\u5360 8 \u5b57\u8282\uff0c\u6307\u9488\u90e8\u5206\u88ab\u76f4\u63a5\u8d4b\u503c\u4e3a 8 \u5b57\u8282\u7684\u6574\u6570\u4e86\u3002 \u6b64\u65f6\uff0c\u6bcf\u4e2a ID \u4f1a\u4f7f\u7528 16 \u5b57\u8282\uff0c\u52a0\u8d77\u6765\u4e00\u5171\u662f 32 \u5b57\u8282\u3002\u4f46\u662f\uff0c\u53e6\u5916\u7684 32 \u5b57\u8282\u53bb\u54ea\u513f\u4e86\u5462\uff1f Redis \u4f1a\u4f7f\u7528\u4e00\u4e2a\u5168\u5c40\u54c8\u5e0c\u8868\u4fdd\u5b58\u6240\u6709\u952e\u503c\u5bf9\uff0c\u54c8\u5e0c\u8868\u7684\u6bcf\u4e00\u9879\u662f\u4e00\u4e2a dictEntry \u7684\u7ed3\u6784\u4f53\uff0c\u7528\u6765\u6307\u5411\u4e00\u4e2a\u952e\u503c\u5bf9\u3002dictEntry \u7ed3\u6784\u4e2d\u6709\u4e09\u4e2a 8 \u5b57\u8282\u7684\u6307\u9488\uff0c \u5206\u522b\u6307\u5411 key\u3001value \u4ee5\u53ca\u4e0b\u4e00\u4e2a dictEntry\uff0c\u4e09\u4e2a\u6307\u9488\u5171 24 \u5b57\u8282\uff0c \u8fd9\u4e09\u4e2a\u6307\u9488\u53ea\u6709 24 \u5b57\u8282\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u5360\u7528\u4e86 32 \u5b57\u8282\u5462\uff1f\u8fd9\u5c31\u8981\u63d0\u5230 Redis \u4f7f\u7528\u7684\u5185\u5b58\u5206\u914d\u5e93 jemalloc \u4e86\u3002 2-5 Redis \u4f7f\u7528\u7684\u5185\u5b58\u5206\u914d\u5e93 jemalloc jemalloc \u5728\u5206\u914d\u5185\u5b58\u65f6\uff0c\u4f1a\u6839\u636e\u6211\u4eec\u7533\u8bf7\u7684\u5b57\u8282\u6570 N\uff0c\u627e\u4e00\u4e2a\u6bd4 N \u5927\uff0c \u4f46\u662f\u6700\u63a5\u8fd1 N \u7684 2 \u7684\u5e42\u6b21\u6570\u4f5c\u4e3a\u5206\u914d\u7684\u7a7a\u95f4\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u9891\u7e41\u5206\u914d\u7684\u6b21\u6570\u3002 \u4e3e\u4e2a\u4f8b\u5b50\u3002\u5982\u679c\u4f60\u7533\u8bf7 6 \u5b57\u8282\u7a7a\u95f4\uff0cjemalloc \u5b9e\u9645\u4f1a\u5206\u914d 8 \u5b57\u8282\u7a7a\u95f4\uff1b \u5982\u679c\u4f60\u7533\u8bf7 24 \u5b57\u8282\u7a7a\u95f4\uff0cjemalloc \u5219\u4f1a\u5206\u914d 32 \u5b57\u8282\u3002 \u6240\u4ee5\uff0c\u5728\u6211\u4eec\u521a\u521a\u8bf4\u7684\u573a\u666f\u91cc\uff0c dictEntry \u7ed3\u6784\u5c31\u5360\u7528\u4e86 32 \u5b57\u8282\u3002 3\u3001\u7528\u4ec0\u4e48\u6570\u636e\u7ed3\u6784\u53ef\u4ee5\u8282\u7701\u5185\u5b58\uff1f Redis \u6709\u4e00\u79cd\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff0c\u53eb \u538b\u7f29\u5217\u8868\uff08ziplist\uff09\uff0c\u8fd9\u662f\u4e00\u79cd\u975e\u5e38\u8282\u7701\u5185\u5b58\u7684\u7ed3\u6784 \u3002 \u6211\u4eec\u5148\u56de\u987e\u4e0b\u538b\u7f29\u5217\u8868\u7684\u6784\u6210\u3002 \u8868\u5934\u6709\u4e09\u4e2a\u5b57\u6bb5 zlbytes\u3001zltail \u548c zllen\uff0c\u5206\u522b\u8868\u793a\u5217\u8868\u957f\u5ea6\u3001\u5217\u8868\u5c3e\u7684\u504f\u79fb\u91cf\uff0c\u4ee5\u53ca\u5217\u8868\u4e2d\u7684 entry \u4e2a\u6570\u3002\u538b\u7f29\u5217\u8868\u5c3e\u8fd8\u6709\u4e00\u4e2a zlend\uff0c\u8868\u793a\u5217\u8868\u7ed3\u675f \u3002 \u538b\u7f29\u5217\u8868\u4e4b\u6240\u4ee5\u80fd\u8282\u7701\u5185\u5b58\uff0c\u5c31\u5728\u4e8e\u5b83\u662f\u7528\u4e00\u7cfb\u5217\u8fde\u7eed\u7684 entry \u4fdd\u5b58\u6570\u636e\u3002\u6bcf\u4e2a entry \u7684\u5143\u6570\u636e\u5305\u62ec\u4e0b\u9762\u51e0\u90e8\u5206\u3002 prev_len \uff0c\u8868\u793a\u524d\u4e00\u4e2a entry \u7684\u957f\u5ea6\u3002prev_len \u6709\u4e24\u79cd\u53d6\u503c\u60c5\u51b5\uff1a1 \u5b57\u8282\u6216 5 \u5b57\u8282\u3002\u53d6\u503c 1 \u5b57\u8282\u65f6\uff0c\u8868\u793a\u4e0a\u4e00\u4e2a entry \u7684\u957f\u5ea6\u5c0f\u4e8e 254 \u5b57\u8282\u3002\u867d\u7136 1 \u5b57\u8282\u7684\u503c\u80fd\u8868\u793a\u7684\u6570\u503c\u8303\u56f4\u662f 0 \u5230 255\uff0c\u4f46\u662f\u538b\u7f29\u5217\u8868\u4e2d zlend \u7684\u53d6\u503c\u9ed8\u8ba4\u662f 255\uff0c\u56e0\u6b64\uff0c\u5c31\u9ed8\u8ba4\u7528 255 \u8868\u793a\u6574\u4e2a\u538b\u7f29\u5217\u8868\u7684\u7ed3\u675f\uff0c\u5176\u4ed6\u8868\u793a\u957f\u5ea6\u7684\u5730\u65b9\u5c31\u4e0d\u80fd\u518d\u7528 255 \u8fd9\u4e2a\u503c\u4e86\u3002\u6240\u4ee5\uff0c\u5f53\u4e0a\u4e00\u4e2a entry \u957f\u5ea6\u5c0f\u4e8e 254 \u5b57\u8282\u65f6\uff0c prev_len \u53d6\u503c\u4e3a 1 \u5b57\u8282\uff0c\u5426\u5219\uff0c\u5c31\u53d6\u503c\u4e3a 5 \u5b57\u8282\u3002 len\uff1a\u8868\u793a\u81ea\u8eab\u957f\u5ea6\uff0c4 \u5b57\u8282\uff1b encoding\uff1a\u8868\u793a\u7f16\u7801\u65b9\u5f0f\uff0c1 \u5b57\u8282\uff1b content\uff1a\u4fdd\u5b58\u5b9e\u9645\u6570\u636e\u3002 \u8fd9\u4e9b entry \u4f1a\u6328\u4e2a\u513f\u653e\u7f6e\u5728\u5185\u5b58\u4e2d\uff0c\u4e0d\u9700\u8981\u518d\u7528\u989d\u5916\u7684\u6307\u9488\u8fdb\u884c\u8fde\u63a5\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8282\u7701\u6307\u9488\u6240\u5360\u7528\u7684\u7a7a\u95f4\u3002 \u4fdd\u5b58\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID \u4e3a\u4f8b \u6bcf\u4e2a entry \u4fdd\u5b58\u4e00\u4e2a\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID\uff088 \u5b57\u8282\uff09\uff0c\u6b64\u65f6\uff0c\u6bcf\u4e2a entry \u7684 prev_len \u53ea\u9700\u8981 1 \u4e2a\u5b57\u8282\u5c31\u884c\uff0c\u56e0\u4e3a\u6bcf\u4e2a entry \u7684\u524d\u4e00\u4e2a entry \u957f\u5ea6\u90fd\u53ea\u6709 8 \u5b57\u8282\uff0c\u5c0f\u4e8e 254 \u5b57\u8282\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4e00\u4e2a\u56fe\u7247\u7684\u5b58\u50a8\u5bf9\u8c61 ID \u6240\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f\u662f 14 \u5b57\u8282\uff081+4+1+8=14\uff09\uff0c\u5b9e\u9645\u5206\u914d 16 \u5b57\u8282\u3002 Redis \u57fa\u4e8e\u538b\u7f29\u5217\u8868\u5b9e\u73b0\u4e86 List\u3001Hash \u548c Sorted Set \u8fd9\u6837\u7684\u96c6\u5408\u7c7b\u578b\uff0c\u8fd9\u6837\u505a\u7684\u6700\u5927\u597d\u5904\u5c31\u662f\u8282\u7701\u4e86 dictEntry \u7684\u5f00\u9500\u3002 \u5f53\u4f60\u7528 String \u7c7b\u578b\u65f6\uff0c\u4e00\u4e2a\u952e\u503c\u5bf9\u5c31\u6709\u4e00\u4e2a dictEntry\uff0c\u8981\u7528 32 \u5b57\u8282\u7a7a\u95f4\u3002 \u4f46\u91c7\u7528\u96c6\u5408\u7c7b\u578b\u65f6\uff0c\u4e00\u4e2a key \u5c31\u5bf9\u5e94\u4e00\u4e2a\u96c6\u5408\u7684\u6570\u636e\uff0c\u80fd\u4fdd\u5b58\u7684\u6570\u636e\u591a\u4e86\u5f88\u591a\uff0c\u4f46\u4e5f\u53ea\u7528\u4e86\u4e00\u4e2a dictEntry\uff0c\u8fd9\u6837\u5c31\u8282\u7701\u4e86\u5185\u5b58\u3002 \u5728\u7528\u96c6\u5408\u7c7b\u578b\u4fdd\u5b58\u952e\u503c\u5bf9\u65f6\uff0c\u4e00\u4e2a\u952e\u5bf9\u5e94\u4e86\u4e00\u4e2a\u96c6\u5408\u7684\u6570\u636e\uff0c\u4f46\u662f\u5728\u6211\u4eec\u7684\u573a\u666f\u4e2d\uff0c\u4e00\u4e2a\u56fe\u7247 ID \u53ea\u5bf9\u5e94\u4e00\u4e2a\u56fe\u7247\u7684\u5b58\u50a8\u5bf9\u8c61 ID\uff0c\u6211\u4eec\u8be5\u600e\u4e48\u7528\u96c6\u5408\u7c7b\u578b\u5462\uff1f 4\u3001\u5982\u4f55\u7528\u96c6\u5408\u7c7b\u578b\u4fdd\u5b58\u5355\u503c\u7684\u952e\u503c\u5bf9\uff1f \u5728\u4fdd\u5b58\u5355\u503c\u7684\u952e\u503c\u5bf9\u65f6\uff0c\u53ef\u4ee5\u91c7\u7528\u57fa\u4e8e Hash \u7c7b\u578b\u7684\u4e8c\u7ea7\u7f16\u7801\u65b9\u6cd5\u3002 \u8fd9\u91cc\u8bf4\u7684\u4e8c\u7ea7\u7f16\u7801\uff0c\u5c31\u662f\u628a\u4e00\u4e2a\u5355\u503c\u7684\u6570\u636e\u62c6\u5206\u6210\u4e24\u90e8\u5206\uff0c\u524d\u4e00\u90e8\u5206\u4f5c\u4e3a Hash \u96c6\u5408\u7684 key\uff0c\u540e\u4e00\u90e8\u5206\u4f5c\u4e3a Hash \u96c6\u5408\u7684 value\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u5355\u503c\u6570\u636e\u4fdd\u5b58\u5230 Hash \u96c6\u5408\u4e2d\u4e86 \u3002 \u4ee5\u56fe\u7247 ID 1101000060 \u548c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID 3302000080 \u4e3a\u4f8b\uff0c \u6211\u4eec\u53ef\u4ee5\u628a\u56fe\u7247 ID \u7684\u524d 7 \u4f4d\uff081101000\uff09\u4f5c\u4e3a Hash \u7c7b\u578b\u7684\u952e\uff0c\u628a\u56fe\u7247 ID \u7684\u6700\u540e 3 \u4f4d\uff08060\uff09\u548c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID \u5206\u522b\u4f5c\u4e3a Hash \u7c7b\u578b\u503c\u4e2d\u7684 key \u548c value\u3002 \u6211\u5728 Redis \u4e2d\u63d2\u5165\u4e86\u4e00\u7ec4\u56fe\u7247 ID \u53ca\u5176\u5b58\u50a8\u5bf9\u8c61 ID \u7684\u8bb0\u5f55\uff0c\u5e76\u4e14\u7528 info \u547d\u4ee4\u67e5\u770b\u4e86\u5185\u5b58\u5f00\u9500\uff0c\u6211\u53d1\u73b0\uff0c\u589e\u52a0\u4e00\u6761\u8bb0\u5f55\u540e\uff0c\u5185\u5b58\u5360\u7528\u53ea\u589e\u52a0\u4e86 16 \u5b57\u8282 127.0.0.1:6379> info memory # Memory used_memory:1039120 127.0.0.1:6379> hset 1101000 060 3302000080 (integer) 1 127.0.0.1:6379> info memory # Memory used_memory:1039136 \u5728\u4f7f\u7528 String \u7c7b\u578b\u65f6\uff0c\u6bcf\u4e2a\u8bb0\u5f55\u9700\u8981\u6d88\u8017 64 \u5b57\u8282\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5374\u53ea\u7528\u4e86 16 \u5b57\u8282\uff0c\u6240\u4f7f\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u662f\u539f\u6765\u7684 1/4\uff0c\u6ee1\u8db3\u4e86\u6211\u4eec\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u7684\u9700\u6c42\u3002 \u4e8c\u7ea7\u7f16\u7801\u4e00\u5b9a\u8981\u628a\u56fe\u7247 ID \u7684\u524d 7 \u4f4d\u4f5c\u4e3a Hash \u7c7b\u578b\u7684\u952e\uff0c\u628a\u6700\u540e 3 \u4f4d\u4f5c\u4e3a Hash \u7c7b\u578b\u503c\u4e2d\u7684 key \u5417\uff1f\u201d\u5176\u5b9e\uff0c\u4e8c\u7ea7\u7f16\u7801\u65b9\u6cd5\u4e2d\u91c7\u7528\u7684 ID \u957f\u5ea6\u662f\u6709\u8bb2\u7a76\u7684\u3002 Redis Hash \u7c7b\u578b\u7684\u4e24\u79cd\u5e95\u5c42\u5b9e\u73b0\u7ed3\u6784\uff0c\u5206\u522b\u662f\u538b\u7f29\u5217\u8868\u548c\u54c8\u5e0c\u8868\u3002 Hash \u7c7b\u578b\u5e95\u5c42\u7ed3\u6784\u4ec0\u4e48\u65f6\u5019\u4f7f\u7528\u538b\u7f29\u5217\u8868\uff0c\u4ec0\u4e48\u65f6\u5019\u4f7f\u7528\u54c8\u5e0c\u8868\u5462\uff1f\u5176\u5b9e\uff0cHash \u7c7b\u578b\u8bbe\u7f6e\u4e86\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u6570\u636e\u65f6\u7684\u4e24\u4e2a\u9608\u503c\uff0c\u4e00\u65e6\u8d85\u8fc7\u4e86\u9608\u503c\uff0cHash \u7c7b\u578b\u5c31\u4f1a\u7528\u54c8\u5e0c\u8868\u6765\u4fdd\u5b58\u6570\u636e\u4e86\u3002 \u8fd9\u4e24\u4e2a\u9608\u503c\u5206\u522b\u5bf9\u5e94\u4ee5\u4e0b\u4e24\u4e2a\u914d\u7f6e\u9879\uff1a hash-max-ziplist-entries \uff1a \u8868\u793a\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u65f6\u54c8\u5e0c\u96c6\u5408\u4e2d\u7684\u6700\u5927\u5143\u7d20\u4e2a\u6570\u3002 hash-max-ziplist-value \uff1a \u8868\u793a\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u65f6\u54c8\u5e0c\u96c6\u5408\u4e2d\u5355\u4e2a\u5143\u7d20\u7684\u6700\u5927\u957f\u5ea6\u3002 \u5982\u679c\u6211\u4eec\u5f80 Hash \u96c6\u5408\u4e2d\u5199\u5165\u7684\u5143\u7d20\u4e2a\u6570\u8d85\u8fc7\u4e86 hash-max-ziplist-entries \uff0c\u6216\u8005\u5199\u5165\u7684\u5355\u4e2a\u5143\u7d20\u5927\u5c0f\u8d85\u8fc7\u4e86 hash-max-ziplist-value \uff0cRedis \u5c31\u4f1a\u81ea\u52a8\u628a Hash \u7c7b\u578b\u7684\u5b9e\u73b0\u7ed3\u6784\u7531\u538b\u7f29\u5217\u8868\u8f6c\u4e3a\u54c8\u5e0c\u8868\u3002 \u4e00\u65e6\u4ece\u538b\u7f29\u5217\u8868\u8f6c\u4e3a\u4e86\u54c8\u5e0c\u8868\uff0cHash \u7c7b\u578b\u5c31\u4f1a\u4e00\u76f4\u7528\u54c8\u5e0c\u8868\u8fdb\u884c\u4fdd\u5b58\uff0c\u800c\u4e0d\u4f1a\u518d\u8f6c\u56de\u538b\u7f29\u5217\u8868\u4e86\u3002\u5728\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u65b9\u9762\uff0c\u54c8\u5e0c\u8868\u5c31\u6ca1\u6709\u538b\u7f29\u5217\u8868\u90a3\u4e48\u9ad8\u6548\u4e86\u3002 \u4e3a\u4e86\u80fd\u5145\u5206\u4f7f\u7528\u538b\u7f29\u5217\u8868\u7684\u7cbe\u7b80\u5185\u5b58\u5e03\u5c40\uff0c\u6211\u4eec\u4e00\u822c\u8981\u63a7\u5236\u4fdd\u5b58\u5728 Hash \u96c6\u5408\u4e2d\u7684\u5143\u7d20\u4e2a\u6570 \u3002 \u5728\u521a\u624d\u7684\u4e8c\u7ea7\u7f16\u7801\u4e2d\uff0c\u6211\u4eec\u53ea\u7528\u56fe\u7247 ID \u6700\u540e 3 \u4f4d\u4f5c\u4e3a Hash \u96c6\u5408\u7684 key\uff0c\u4e5f\u5c31\u4fdd\u8bc1\u4e86 Hash \u96c6\u5408\u7684\u5143\u7d20\u4e2a\u6570\u4e0d\u8d85\u8fc7 1000\uff0c\u540c\u65f6\uff0c\u6211\u4eec\u628a hash-max-ziplist-entries \u8bbe\u7f6e\u4e3a 1000\uff0c\u8fd9\u6837\u4e00\u6765\uff0cHash \u96c6\u5408\u5c31\u53ef\u4ee5\u4e00\u76f4\u4f7f\u7528\u538b\u7f29\u5217\u8868\u6765\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u4e86\u3002 5\u3001\u672c\u8282\u5c0f\u7ed3 String \u5728\u4fdd\u5b58\u7684\u952e\u503c\u5bf9\u672c\u8eab\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u4e0d\u5927\u65f6\uff0cString \u7c7b\u578b\u7684\u5143\u6570\u636e\u5f00\u9500\u5c31\u5360\u636e\u4e3b\u5bfc\u4e86\uff0c \u8fd9\u91cc\u9762\u5305\u62ec\u4e86 RedisObject \u7ed3\u6784\u3001SDS \u7ed3\u6784\u3001dictEntry \u7ed3\u6784\u7684\u5185\u5b58\u5f00\u9500 \u3002 \u4f7f\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u6570\u636e\u3002\u5f53\u7136\uff0c\u4f7f\u7528 Hash \u8fd9\u79cd\u96c6\u5408\u7c7b\u578b\u4fdd\u5b58\u5355\u503c\u952e\u503c\u5bf9\u7684\u6570\u636e\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5c06\u5355\u503c\u6570\u636e\u62c6\u5206\u6210\u4e24\u90e8\u5206\uff0c\u5206\u522b\u4f5c\u4e3a Hash \u96c6\u5408\u7684\u952e\u548c\u503c\uff0c\u5c31\u50cf\u521a\u624d\u6848\u4f8b\u4e2d\u7528\u4e8c\u7ea7\u7f16\u7801\u6765\u8868\u793a\u56fe\u7247 ID \u5982\u679c\u4f60\u60f3\u77e5\u9053\u952e\u503c\u5bf9\u91c7\u7528\u4e0d\u540c\u7c7b\u578b\u4fdd\u5b58\u65f6\u7684\u5185\u5b58\u5f00\u9500\uff0c\u53ef\u4ee5\u5728 \u8fd9\u4e2a\u7f51\u5740 \u91cc\u8f93\u5165\u4f60\u7684\u952e\u503c\u5bf9\u957f\u5ea6\u548c\u4f7f\u7528\u7684\u6570\u636e\u7c7b\u578b\uff0c\u8fd9\u6837\u5c31\u80fd\u77e5\u9053\u5b9e\u9645\u6d88\u8017\u7684\u5185\u5b58\u5927\u5c0f\u4e86 5-1 Redis\u7684String\u7c7b\u578b\u6570\u636e\u7ed3\u6784\uff0c\u53ca\u5176\u5e95\u5c42\u5b9e\u73b0 Redis\u7684String\u7c7b\u578b\u6570\u636e\u7ed3\u6784\uff0c\u53ca\u5176\u5e95\u5c42\u5b9e\u73b0 \u53ef\u4ee5\u5de7\u5999\u7684\u5229\u7528Redis\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u7279\u6027\uff0c\u964d\u4f4e\u8d44\u6e90\u6d88\u8017 Simple Dynamic String\u7ed3\u6784 buf \uff1a\u5b57\u8282\u6570\u7ec4\uff0c\u4fdd\u5b58\u5b9e\u9645\u6570\u636e\u3002\u4e3a\u4e86\u8868\u793a\u5b57\u8282\u6570\u7ec4\u7684\u7ed3\u675f\uff0cRedis \u4f1a\u81ea\u52a8\u5728\u6570\u7ec4\u6700\u540e\u52a0\u4e00\u4e2a\u201c\\0\u201d\uff0c\u8fd9\u5c31\u4f1a\u989d\u5916\u5360\u7528 1 \u4e2a\u5b57\u8282\u7684\u5f00\u9500\u3002 len\uff1a\u5360 4 \u4e2a\u5b57\u8282\uff0c \u8868\u793a buf \u7684\u5df2\u7528\u957f\u5ea6 \u3002 alloc\uff1a\u4e5f\u5360\u4e2a 4 \u5b57\u8282\uff0c \u8868\u793a buf \u7684\u5b9e\u9645\u5206\u914d\u957f\u5ea6\uff0c\u4e00\u822c\u5927\u4e8e len\u3002 dicEntry \u7ed3\u6784\u4f53 key\uff1a8\u4e2a\u5b57\u8282\u6307\u9488\uff0c\u6307\u5411key value\uff1a8\u4e2a\u5b57\u8282\u6307\u9488\uff0c\u6307\u5411value next\uff1a\u6307\u5411\u4e0b\u4e00\u4e2adicEntry ziplist(\u538b\u7f29\u5217\u8868)\uff08 zlbytes\uff1a\u5728\u8868\u5934\uff0c\u8868\u793a\u5217\u8868\u957f\u5ea6 zltail\uff1a\u5728\u8868\u5934\uff0c\u8868\u793a\u5217\u5c3e\u504f\u79fb\u91cf zllen\uff1a\u5728\u8868\u5934\uff0c\u8868\u793a\u5217\u8868\u4e2d entry\uff1a\u4fdd\u5b58\u6570\u636e\u5bf9\u8c61\u6a21\u578b zlend\uff1a\u5728\u8868\u5c3e\uff0c\u8868\u793a\u5217\u8868\u7ed3\u675f\uff09 entry\uff1a prev_len \uff1a\u8868\u793a\u4e00\u4e2aentry\u7684\u957f\u5ea6\uff0c\u6709\u4e24\u79cd\u53d6\u503c\u65b9\u5f0f\uff1a1\u5b57\u8282\u62165\u5b57\u8282\u3002 1\u5b57\u8282\u8868\u793a\u4e00\u4e2aentry\u5c0f\u4e8e254\u5b57\u8282\uff0c255\u662fzlend\u7684\u9ed8\u8ba4\u503c\uff0c\u6240\u4ee5\u4e0d\u4f7f\u7528\u3002 len\uff1a\u8868\u793a\u81ea\u8eab\u957f\u5ea6\uff0c4\u5b57\u8282 encodeing\uff1a\u8868\u793a\u7f16\u7801\u65b9\u5f0f\uff0c1\u5b57\u8282 content\uff1a\u4fdd\u5b58\u5b9e\u9645\u6570\u636e String\u7c7b\u578b\u7684\u5185\u5b58\u7a7a\u95f4\u6d88\u8017 \u4fdd\u5b58Long\u7c7b\u578b\u65f6\uff0c\u6307\u9488\u76f4\u63a5\u4fdd\u5b58\u6574\u6570\u6570\u636e\u503c\uff0c\u53ef\u4ee5\u8282\u7701\u7a7a\u95f4\u5f00\u9500\uff08\u88ab\u79f0\u4e3a\uff1aint\u7f16\u7801\uff09 \u4fdd\u5b58\u5b57\u7b26\u4e32\uff0c\u4e14\u4e0d\u5927\u4e8e44\u5b57\u8282\u65f6\uff0cRedisObject\u7684\u5143\u6570\u636e\uff0c\u6307\u9488\u548cSDS\u662f\u8fde\u7eed\u7684\uff0c\u53ef\u4ee5\u907f\u514d\u5185\u5b58\u788e\u7247\uff08\u88ab\u79f0\u4e3a\uff1aembstr\u7f16\u7801\uff09 \u5f53\u4fdd\u5b58\u7684\u5b57\u7b26\u4e32\u5927\u4e8e44\u5b57\u8282\u65f6\uff0cSDS\u7684\u6570\u636e\u91cf\u53d8\u591a\uff0cRedis\u4f1a\u7ed9SDS\u5206\u914d\u72ec\u7acb\u7684\u7a7a\u95f4\uff0c\u5e76\u7528\u6307\u9488\u6307\u5411SDS\u7ed3\u6784\uff08\u88ab\u79f0\u4e3a\uff1araw\u7f16\u7801\uff09 Redis\u4f7f\u7528\u4e00\u4e2a\u5168\u5c40\u54c8\u5e0c\u8868\u4fdd\u5b58\u6240\u4ee5\u952e\u503c\u5bf9\uff0c\u54c8\u5e0c\u8868\u7684\u6bcf\u4e00\u9879\u90fd\u662f\u4e00\u4e2adicEntry\uff0c\u6bcf\u4e2adicEntry\u5360\u752832\u5b57\u8282\u7a7a\u95f4 dicEntry\u81ea\u8eab24\u5b57\u8282\uff0c\u4f46\u4f1a\u5360\u752832\u5b57\u8282\u7a7a\u95f4\uff0c\u662f\u56e0\u4e3aRedis\u4f7f\u7528\u4e86\u5185\u5b58\u5206\u914d\u5e93jemalloc\u3002 jemalloc\u5728\u5206\u914d\u5185\u5b58\u65f6\uff0c\u4f1a\u6839\u636e\u7533\u8bf7\u7684\u5b57\u8282\u6570N\uff0c\u627e\u4e00\u4e2a\u6bd4N\u5927\uff0c\u4f46\u6700\u63a5\u8fd1N\u76842\u7684\u5e42\u6b21\u6570\u4f5c\u4e3a\u5206\u914d\u7a7a\u95f4\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u9891\u7e41\u5206\u914d\u5185\u5b58\u7684\u6b21\u6570 \u4f7f\u7528\u4ec0\u4e48\u6570\u636e\u7ed3\u6784\u53ef\u4ee5\u8282\u7701\u5185\u5b58\uff1f \u538b\u7f29\u5217\u8868\uff0c\u662f\u4e00\u79cd\u975e\u5e38\u8282\u7701\u5185\u5b58\u7684\u6570\u636e\u7ed3\u6784\uff0c\u56e0\u4e3a\u4ed6\u4f7f\u7528\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u4fdd\u5b58\u6570\u636e\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7684\u6307\u9488\u8fdb\u884c\u8fde\u63a5 Redis\u57fa\u4e8e\u538b\u7f29\u5217\u8868\u5b9e\u73b0List\uff0cHash\uff0cSorted Set\u96c6\u5408\u7c7b\u578b\uff0c\u6700\u5927\u7684\u597d\u5904\u662f\u8282\u7701\u4e86dicEntry\u5f00\u9500 \u5982\u4f55\u4f7f\u7528\u96c6\u5408\u7c7b\u578b\u4fdd\u5b58\u952e\u503c\u5bf9\uff1f Hash\u7c7b\u578b\u8bbe\u7f6e\u4e86\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u6570\u636e\u65f6\u7684\u4e24\u4e2a\u9600\u503c\uff0c\u4e00\u65e6\u8d85\u8fc7\u5c31\u4f1a\u5c06\u538b\u7f29\u5217\u8868\u8f6c\u4e3a\u54c8\u5e0c\u8868\uff0c\u4e14\u4e0d\u53ef\u56de\u9000 hash-max-ziplist-entries \uff1a\u8868\u793a\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u54c8\u5e0c\u96c6\u5408\u4e2d\u7684\u6700\u5927\u5143\u7d20\u4e2a\u6570 hash-max-ziplist-value \uff1a\u8868\u793a\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u65f6\uff0c\u54c8\u5e0c\u96c6\u5408\u4e2d\u5355\u4e2a\u5143\u7d20\u7684\u6700\u5927\u957f\u5ea6","title":"\u7b2c\u4e00\u8282 Redis\u7684String\u7c7b\u578b\u6570\u636e\u7ed3\u6784"},{"location":"chap3/1redis_string/#redisstring","text":"String \u7c7b\u578b\u7684\u5185\u5b58\u7a7a\u95f4\u6d88\u8017\u95ee\u9898\uff0c\u4ee5\u53ca\u9009\u62e9\u8282\u7701\u5185\u5b58\u5f00\u9500\u7684\u6570\u636e\u7c7b\u578b\u7684\u89e3\u51b3\u65b9\u6848\u3002","title":"\u7b2c\u4e00\u8282 Redis\u7684String\u7c7b\u578b\u6570\u636e\u7ed3\u6784\uff0c\u53ca\u5176\u5e95\u5c42\u5b9e\u73b0"},{"location":"chap3/1redis_string/#1string","text":"\u56fe\u7247\u5b58\u50a8\u7cfb\u7edf\uff0c\u8981\u6c42\u8fd9\u4e2a\u7cfb\u7edf\u80fd\u5feb\u901f\u5730\u8bb0\u5f55\u56fe\u7247 ID \u548c\u56fe\u7247\u5728\u5b58\u50a8\u7cfb\u7edf\u4e2d\u4fdd\u5b58\u65f6\u7684 ID\uff08\u53ef\u4ee5\u76f4\u63a5\u53eb\u4f5c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID\uff09\u3002\u540c\u65f6\uff0c\u8fd8\u8981\u80fd\u591f\u6839\u636e\u56fe\u7247 ID \u5feb\u901f\u67e5\u627e\u5230\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID\u3002 \u56e0\u4e3a\u56fe\u7247\u6570\u91cf\u5de8\u5927\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u7528 10 \u4f4d\u6570\u6765\u8868\u793a\u56fe\u7247 ID \u548c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID\uff0c\u4f8b\u5982\uff0c\u56fe\u7247 ID \u4e3a 1101000051\uff0c\u5b83\u5728\u5b58\u50a8\u7cfb\u7edf\u4e2d\u5bf9\u5e94\u7684 ID \u53f7\u662f 3301000051\u3002 photo_id: 1101000051 photo_obj_id: 3301000051 \u56fe\u7247 ID \u548c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID \u6b63\u597d\u4e00\u4e00\u5bf9\u5e94\uff0c\u662f\u5178\u578b\u7684\u201c\u952e - \u5355\u503c\u201d\u6a21\u5f0f\u3002 \u6240\u8c13\u7684\u201c\u5355\u503c\u201d\uff0c\u5c31\u662f\u6307\u952e\u503c\u5bf9\u4e2d\u7684\u503c\u5c31\u662f\u4e00\u4e2a\u503c\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u96c6\u5408\uff0c\u8fd9\u548c String \u7c7b\u578b\u63d0\u4f9b\u7684\u201c\u4e00\u4e2a\u952e\u5bf9\u5e94\u4e00\u4e2a\u503c\u7684\u6570\u636e\u201d\u7684\u4fdd\u5b58\u5f62\u5f0f\u521a\u597d\u5951\u5408\u3002 String \u7c7b\u578b\u53ef\u4ee5\u4fdd\u5b58\u4e8c\u8fdb\u5236\u5b57\u8282\u6d41\uff0c\u53ea\u8981\u628a\u6570\u636e\u8f6c\u6210\u4e8c\u8fdb\u5236\u5b57\u8282\u6570\u7ec4\uff0c\u5c31\u53ef\u4ee5\u4fdd\u5b58\u4e86\u3002 \u7b2c\u4e00\u4e2a\u65b9\u6848\u5c31\u662f\u7528 String \u4fdd\u5b58\u6570\u636e\u3002 \u6211\u4eec\u628a\u56fe\u7247 ID \u548c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID \u5206\u522b\u4f5c\u4e3a\u952e\u503c\u5bf9\u7684 key \u548c value \u6765\u4fdd\u5b58\uff0c\u5176\u4e2d\uff0c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID \u7528\u4e86 String \u7c7b\u578b\u3002 \u6211\u4eec\u4fdd\u5b58\u4e86 1 \u4ebf\u5f20\u56fe\u7247\uff0c\u5927\u7ea6\u7528\u4e86 6.4GB \u7684\u5185\u5b58\u3002\u4f46\u662f\uff0c\u968f\u7740\u56fe\u7247\u6570\u636e\u91cf\u7684\u4e0d\u65ad\u589e\u52a0\uff0c\u6211\u4eec\u7684 Redis \u5185\u5b58\u4f7f\u7528\u91cf\u4e5f\u5728\u589e\u52a0\uff0c\u7ed3\u679c\u5c31\u9047\u5230\u4e86\u5927\u5185\u5b58 Redis \u5b9e\u4f8b\u56e0\u4e3a\u751f\u6210 RDB \u800c\u54cd\u5e94\u53d8\u6162\u7684\u95ee\u9898\u3002 String \u7c7b\u578b\u5e76\u4e0d\u662f\u4e00\u79cd\u597d\u7684\u9009\u62e9\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u8fdb\u4e00\u6b65\u5bfb\u627e\u80fd\u8282\u7701\u5185\u5b58\u5f00\u9500\u7684\u6570\u636e\u7c7b\u578b\u65b9\u6848\u3002 String \u7c7b\u578b\u5e76\u4e0d\u662f\u9002\u7528\u4e8e\u6240\u6709\u573a\u5408\u7684\uff0c\u5b83\u6709\u4e00\u4e2a\u660e\u663e\u7684\u77ed\u677f\uff0c\u5c31\u662f\u5b83\u4fdd\u5b58\u6570\u636e\u65f6\u6240\u6d88\u8017\u7684\u5185\u5b58\u7a7a\u95f4\u8f83\u591a\u3002 \u96c6\u5408\u7c7b\u578b\u6709\u975e\u5e38\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u7684\u5e95\u5c42\u5b9e\u73b0\u7ed3\u6784\uff0c\u4f46\u662f\uff0c\u96c6\u5408\u7c7b\u578b\u4fdd\u5b58\u7684\u6570\u636e\u6a21\u5f0f\uff0c \u662f\u4e00\u4e2a\u952e\u5bf9\u5e94\u4e00\u7cfb\u5217\u503c\uff0c\u5e76\u4e0d\u9002\u5408\u76f4\u63a5\u4fdd\u5b58\u5355\u503c\u7684\u952e\u503c\u5bf9 \u3002\u6240\u4ee5\uff0c \u6211\u4eec\u5c31\u4f7f\u7528\u4e8c\u7ea7\u7f16\u7801\u7684\u65b9\u6cd5\uff0c\u5b9e\u73b0\u4e86\u7528\u96c6\u5408\u7c7b\u578b\u4fdd\u5b58\u5355\u503c\u952e\u503c\u5bf9\uff0cRedis \u5b9e\u4f8b\u7684\u5185\u5b58\u7a7a\u95f4\u6d88\u8017\u660e\u663e\u4e0b\u964d\u4e86\u3002","title":"1\u3001String \u7c7b\u578b\u7684\u6d88\u8017\u5185\u5b58\u7a7a\u95f4"},{"location":"chap3/1redis_string/#2-string","text":"\u4fdd\u5b58\u4e86 1 \u4ebf\u5f20\u56fe\u7247\u7684\u4fe1\u606f\uff0c\u7528\u4e86\u7ea6 6.4GB \u7684\u5185\u5b58\uff0c\u4e00\u4e2a\u56fe\u7247 ID \u548c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID \u7684\u8bb0\u5f55\u5e73\u5747\u7528\u4e86 64 \u5b57\u8282\u3002 \u4e00\u7ec4\u56fe\u7247 ID \u53ca\u5176\u5b58\u50a8\u5bf9\u8c61 ID \u7684\u8bb0\u5f55\uff0c\u5b9e\u9645\u53ea\u9700\u8981 16 \u5b57\u8282\u5c31\u53ef\u4ee5\u4e86 \u56fe\u7247 ID \u548c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID \u90fd\u662f 10 \u4f4d\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e24\u4e2a 8 \u5b57\u8282\u7684 Long \u7c7b\u578b\u8868\u793a\u8fd9\u4e24\u4e2a ID\u3002\u56e0\u4e3a 8 \u5b57\u8282\u7684 Long \u7c7b\u578b\u6700\u5927\u53ef\u4ee5\u8868\u793a 2 \u7684 64 \u6b21\u65b9\u7684\u6570\u503c\uff0c\u6240\u4ee5\u80af\u5b9a\u53ef\u4ee5\u8868\u793a 10 \u4f4d\u6570\u3002 \u4e3a\u4ec0\u4e48 String \u7c7b\u578b\u5374\u7528\u4e86 64 \u5b57\u8282\u5462\uff1f \u5176\u5b9e\uff0c\u9664\u4e86\u8bb0\u5f55\u5b9e\u9645\u6570\u636e\uff0c String \u7c7b\u578b\u8fd8\u9700\u8981\u989d\u5916\u7684\u5185\u5b58\u7a7a\u95f4\u8bb0\u5f55\u6570\u636e\u957f\u5ea6\u3001\u7a7a\u95f4\u4f7f\u7528\u7b49\u4fe1\u606f\uff0c\u8fd9\u4e9b\u4fe1\u606f\u4e5f\u53eb\u4f5c\u5143\u6570\u636e \u3002 \u5f53\u5b9e\u9645\u4fdd\u5b58\u7684\u6570\u636e\u8f83\u5c0f\u65f6\uff0c\u5143\u6570\u636e\u7684\u7a7a\u95f4\u5f00\u9500\u5c31\u663e\u5f97\u6bd4\u8f83\u5927\u4e86\uff0c\u6709\u70b9\u201c\u55a7\u5bbe\u593a\u4e3b\u201d\u7684\u610f\u601d\u3002","title":"2\u3001\u4e3a\u4ec0\u4e48 String \u7c7b\u578b\u5185\u5b58\u5f00\u9500\u5927\uff1f"},{"location":"chap3/1redis_string/#2-1-string","text":"\u4fdd\u5b58 64 \u4f4d\u6709\u7b26\u53f7\u6574\u6570\u65f6\uff0cString \u7c7b\u578b\u4f1a\u628a\u5b83\u4fdd\u5b58\u4e3a\u4e00\u4e2a 8 \u5b57\u8282\u7684 Long \u7c7b\u578b\u6574\u6570\uff0c\u8fd9\u79cd\u4fdd\u5b58\u65b9\u5f0f\u901a\u5e38\u4e5f\u53eb\u4f5c int \u7f16\u7801\u65b9\u5f0f\u3002 \u5f53\u4f60\u4fdd\u5b58\u7684\u6570\u636e\u4e2d\u5305\u542b\u5b57\u7b26\u65f6\uff0c String \u7c7b\u578b\u5c31\u4f1a\u7528\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\uff08Simple Dynamic String\uff0cSDS\uff09\u7ed3\u6784\u4f53\u6765\u4fdd\u5b58 buf \uff1a\u5b57\u8282\u6570\u7ec4\uff0c\u4fdd\u5b58\u5b9e\u9645\u6570\u636e\u3002\u4e3a\u4e86\u8868\u793a\u5b57\u8282\u6570\u7ec4\u7684\u7ed3\u675f\uff0cRedis \u4f1a\u81ea\u52a8\u5728\u6570\u7ec4\u6700\u540e\u52a0\u4e00\u4e2a\u201c\\0\u201d\uff0c\u8fd9\u5c31\u4f1a\u989d\u5916\u5360\u7528 1 \u4e2a\u5b57\u8282\u7684\u5f00\u9500\u3002 len\uff1a\u5360 4 \u4e2a\u5b57\u8282\uff0c \u8868\u793a buf \u7684\u5df2\u7528\u957f\u5ea6 \u3002 alloc\uff1a\u4e5f\u5360\u4e2a 4 \u5b57\u8282\uff0c \u8868\u793a buf \u7684\u5b9e\u9645\u5206\u914d\u957f\u5ea6\uff0c\u4e00\u822c\u5927\u4e8e len\u3002 \u5728 SDS \u4e2d\uff0cbuf \u4fdd\u5b58\u5b9e\u9645\u6570\u636e\uff0c\u800c len \u548c alloc \u672c\u8eab\u5176\u5b9e\u662f SDS \u7ed3\u6784\u4f53\u7684\u989d\u5916\u5f00\u9500\u3002 \u5bf9\u4e8e String \u7c7b\u578b\u6765\u8bf4\uff0c\u9664\u4e86 SDS \u7684\u989d\u5916\u5f00\u9500\uff0c\u8fd8\u6709\u4e00\u4e2a\u6765\u81ea\u4e8e RedisObject \u7ed3\u6784\u4f53\u7684\u5f00\u9500\u3002","title":"2-1 String \u7c7b\u578b\u5177\u4f53\u662f\u600e\u4e48\u4fdd\u5b58\u6570\u636e\u7684\u5462"},{"location":"chap3/1redis_string/#2-2-redisobject","text":"\u56e0\u4e3a Redis \u7684\u6570\u636e\u7c7b\u578b\u6709\u5f88\u591a\uff0c\u800c\u4e14\uff0c\u4e0d\u540c\u6570\u636e\u7c7b\u578b\u90fd\u6709\u4e9b\u76f8\u540c\u7684\u5143\u6570\u636e\u8981\u8bb0\u5f55\uff08\u6bd4\u5982\u6700\u540e\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u95f4\u3001\u88ab\u5f15\u7528\u7684\u6b21\u6570\u7b49\uff09\uff0c\u6240\u4ee5\uff0c Redis \u4f1a\u7528\u4e00\u4e2a RedisObject \u7ed3\u6784\u4f53\u6765\u7edf\u4e00\u8bb0\u5f55\u8fd9\u4e9b\u5143\u6570\u636e\uff0c\u540c\u65f6\u6307\u5411\u5b9e\u9645\u6570\u636e\u3002 \u4e00\u4e2a RedisObject \u5305\u542b\u4e86 8 \u5b57\u8282\u7684\u5143\u6570\u636e\u548c\u4e00\u4e2a 8 \u5b57\u8282\u6307\u9488\uff0c\u8fd9\u4e2a\u6307\u9488\u518d\u8fdb\u4e00\u6b65\u6307\u5411\u5177\u4f53\u6570\u636e\u7c7b\u578b\u7684\u5b9e\u9645\u6570\u636e\u6240\u5728 \uff0c\u4f8b\u5982\u6307\u5411 String \u7c7b\u578b\u7684 SDS \u7ed3\u6784\u6240\u5728\u7684\u5185\u5b58\u5730\u5740","title":"2-2 RedisObject"},{"location":"chap3/1redis_string/#2-3-intembstr-raw","text":"\u4e3a\u4e86\u8282\u7701\u5185\u5b58\u7a7a\u95f4\uff0cRedis \u8fd8\u5bf9 Long \u7c7b\u578b\u6574\u6570\u548c SDS \u7684\u5185\u5b58\u5e03\u5c40 \u4e00\u65b9\u9762\uff0c\u5f53\u4fdd\u5b58\u7684\u662f Long \u7c7b\u578b\u6574\u6570\u65f6\uff0c RedisObject \u4e2d\u7684\u6307\u9488\u5c31\u76f4\u63a5\u8d4b\u503c\u4e3a\u6574\u6570\u6570\u636e\u4e86\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u989d\u5916\u7684\u6307\u9488\u518d\u6307\u5411\u6574\u6570\u4e86\uff0c\u8282\u7701\u4e86\u6307\u9488\u7684\u7a7a\u95f4\u5f00\u9500 \u3002 \u53e6\u4e00\u65b9\u9762\uff0c\u5f53\u4fdd\u5b58\u7684\u662f\u5b57\u7b26\u4e32\u6570\u636e\uff0c\u5e76\u4e14\u5b57\u7b26\u4e32\u5c0f\u4e8e\u7b49\u4e8e 44 \u5b57\u8282\u65f6\uff0cRedisObject \u4e2d\u7684\u5143\u6570\u636e\u3001\u6307\u9488\u548c SDS \u662f\u4e00\u5757\u8fde\u7eed\u7684\u5185\u5b58\u533a\u57df\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u907f\u514d\u5185\u5b58\u788e\u7247\u3002 \u8fd9\u79cd\u5e03\u5c40\u65b9\u5f0f\u4e5f\u88ab\u79f0\u4e3a embstr \u7f16\u7801\u65b9\u5f0f\u3002 \u5f53\u5b57\u7b26\u4e32\u5927\u4e8e 44 \u5b57\u8282\u65f6 \uff0cSDS \u7684\u6570\u636e\u91cf\u5c31\u5f00\u59cb\u53d8\u591a\u4e86\uff0cRedis \u5c31\u4e0d\u518d\u628a SDS \u548c RedisObject \u5e03\u5c40\u5728\u4e00\u8d77\u4e86\uff0c\u800c\u662f\u4f1a\u7ed9 SDS \u5206\u914d\u72ec\u7acb\u7684\u7a7a\u95f4\uff0c\u5e76\u7528\u6307\u9488\u6307\u5411 SDS \u7ed3\u6784\u3002\u8fd9\u79cd\u5e03\u5c40\u65b9\u5f0f\u88ab\u79f0\u4e3a raw \u7f16\u7801\u6a21\u5f0f\u3002 int\u3001embstr \u548c raw \u8fd9\u4e09\u79cd\u7f16\u7801\u6a21\u5f0f","title":"2-3 int\u3001embstr \u548c raw \u8fd9\u4e09\u79cd\u7f16\u7801\u6a21\u5f0f"},{"location":"chap3/1redis_string/#2-4-string","text":"\u56e0\u4e3a 10 \u4f4d\u6570\u7684\u56fe\u7247 ID \u548c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID \u662f Long \u7c7b\u578b\u6574\u6570\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u7528 int \u7f16\u7801\u7684 RedisObject \u4fdd\u5b58\u3002 \u6bcf\u4e2a int \u7f16\u7801\u7684 RedisObject \u5143\u6570\u636e\u90e8\u5206\u5360 8 \u5b57\u8282\uff0c\u6307\u9488\u90e8\u5206\u88ab\u76f4\u63a5\u8d4b\u503c\u4e3a 8 \u5b57\u8282\u7684\u6574\u6570\u4e86\u3002 \u6b64\u65f6\uff0c\u6bcf\u4e2a ID \u4f1a\u4f7f\u7528 16 \u5b57\u8282\uff0c\u52a0\u8d77\u6765\u4e00\u5171\u662f 32 \u5b57\u8282\u3002\u4f46\u662f\uff0c\u53e6\u5916\u7684 32 \u5b57\u8282\u53bb\u54ea\u513f\u4e86\u5462\uff1f Redis \u4f1a\u4f7f\u7528\u4e00\u4e2a\u5168\u5c40\u54c8\u5e0c\u8868\u4fdd\u5b58\u6240\u6709\u952e\u503c\u5bf9\uff0c\u54c8\u5e0c\u8868\u7684\u6bcf\u4e00\u9879\u662f\u4e00\u4e2a dictEntry \u7684\u7ed3\u6784\u4f53\uff0c\u7528\u6765\u6307\u5411\u4e00\u4e2a\u952e\u503c\u5bf9\u3002dictEntry \u7ed3\u6784\u4e2d\u6709\u4e09\u4e2a 8 \u5b57\u8282\u7684\u6307\u9488\uff0c \u5206\u522b\u6307\u5411 key\u3001value \u4ee5\u53ca\u4e0b\u4e00\u4e2a dictEntry\uff0c\u4e09\u4e2a\u6307\u9488\u5171 24 \u5b57\u8282\uff0c \u8fd9\u4e09\u4e2a\u6307\u9488\u53ea\u6709 24 \u5b57\u8282\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u5360\u7528\u4e86 32 \u5b57\u8282\u5462\uff1f\u8fd9\u5c31\u8981\u63d0\u5230 Redis \u4f7f\u7528\u7684\u5185\u5b58\u5206\u914d\u5e93 jemalloc \u4e86\u3002","title":"2-4 \u8ba1\u7b97String \u7c7b\u578b\u7684\u5185\u5b58\u4f7f\u7528\u91cf"},{"location":"chap3/1redis_string/#2-5-redis-jemalloc","text":"jemalloc \u5728\u5206\u914d\u5185\u5b58\u65f6\uff0c\u4f1a\u6839\u636e\u6211\u4eec\u7533\u8bf7\u7684\u5b57\u8282\u6570 N\uff0c\u627e\u4e00\u4e2a\u6bd4 N \u5927\uff0c \u4f46\u662f\u6700\u63a5\u8fd1 N \u7684 2 \u7684\u5e42\u6b21\u6570\u4f5c\u4e3a\u5206\u914d\u7684\u7a7a\u95f4\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u9891\u7e41\u5206\u914d\u7684\u6b21\u6570\u3002 \u4e3e\u4e2a\u4f8b\u5b50\u3002\u5982\u679c\u4f60\u7533\u8bf7 6 \u5b57\u8282\u7a7a\u95f4\uff0cjemalloc \u5b9e\u9645\u4f1a\u5206\u914d 8 \u5b57\u8282\u7a7a\u95f4\uff1b \u5982\u679c\u4f60\u7533\u8bf7 24 \u5b57\u8282\u7a7a\u95f4\uff0cjemalloc \u5219\u4f1a\u5206\u914d 32 \u5b57\u8282\u3002 \u6240\u4ee5\uff0c\u5728\u6211\u4eec\u521a\u521a\u8bf4\u7684\u573a\u666f\u91cc\uff0c dictEntry \u7ed3\u6784\u5c31\u5360\u7528\u4e86 32 \u5b57\u8282\u3002","title":"2-5 Redis \u4f7f\u7528\u7684\u5185\u5b58\u5206\u914d\u5e93 jemalloc"},{"location":"chap3/1redis_string/#3","text":"Redis \u6709\u4e00\u79cd\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff0c\u53eb \u538b\u7f29\u5217\u8868\uff08ziplist\uff09\uff0c\u8fd9\u662f\u4e00\u79cd\u975e\u5e38\u8282\u7701\u5185\u5b58\u7684\u7ed3\u6784 \u3002 \u6211\u4eec\u5148\u56de\u987e\u4e0b\u538b\u7f29\u5217\u8868\u7684\u6784\u6210\u3002 \u8868\u5934\u6709\u4e09\u4e2a\u5b57\u6bb5 zlbytes\u3001zltail \u548c zllen\uff0c\u5206\u522b\u8868\u793a\u5217\u8868\u957f\u5ea6\u3001\u5217\u8868\u5c3e\u7684\u504f\u79fb\u91cf\uff0c\u4ee5\u53ca\u5217\u8868\u4e2d\u7684 entry \u4e2a\u6570\u3002\u538b\u7f29\u5217\u8868\u5c3e\u8fd8\u6709\u4e00\u4e2a zlend\uff0c\u8868\u793a\u5217\u8868\u7ed3\u675f \u3002 \u538b\u7f29\u5217\u8868\u4e4b\u6240\u4ee5\u80fd\u8282\u7701\u5185\u5b58\uff0c\u5c31\u5728\u4e8e\u5b83\u662f\u7528\u4e00\u7cfb\u5217\u8fde\u7eed\u7684 entry \u4fdd\u5b58\u6570\u636e\u3002\u6bcf\u4e2a entry \u7684\u5143\u6570\u636e\u5305\u62ec\u4e0b\u9762\u51e0\u90e8\u5206\u3002 prev_len \uff0c\u8868\u793a\u524d\u4e00\u4e2a entry \u7684\u957f\u5ea6\u3002prev_len \u6709\u4e24\u79cd\u53d6\u503c\u60c5\u51b5\uff1a1 \u5b57\u8282\u6216 5 \u5b57\u8282\u3002\u53d6\u503c 1 \u5b57\u8282\u65f6\uff0c\u8868\u793a\u4e0a\u4e00\u4e2a entry \u7684\u957f\u5ea6\u5c0f\u4e8e 254 \u5b57\u8282\u3002\u867d\u7136 1 \u5b57\u8282\u7684\u503c\u80fd\u8868\u793a\u7684\u6570\u503c\u8303\u56f4\u662f 0 \u5230 255\uff0c\u4f46\u662f\u538b\u7f29\u5217\u8868\u4e2d zlend \u7684\u53d6\u503c\u9ed8\u8ba4\u662f 255\uff0c\u56e0\u6b64\uff0c\u5c31\u9ed8\u8ba4\u7528 255 \u8868\u793a\u6574\u4e2a\u538b\u7f29\u5217\u8868\u7684\u7ed3\u675f\uff0c\u5176\u4ed6\u8868\u793a\u957f\u5ea6\u7684\u5730\u65b9\u5c31\u4e0d\u80fd\u518d\u7528 255 \u8fd9\u4e2a\u503c\u4e86\u3002\u6240\u4ee5\uff0c\u5f53\u4e0a\u4e00\u4e2a entry \u957f\u5ea6\u5c0f\u4e8e 254 \u5b57\u8282\u65f6\uff0c prev_len \u53d6\u503c\u4e3a 1 \u5b57\u8282\uff0c\u5426\u5219\uff0c\u5c31\u53d6\u503c\u4e3a 5 \u5b57\u8282\u3002 len\uff1a\u8868\u793a\u81ea\u8eab\u957f\u5ea6\uff0c4 \u5b57\u8282\uff1b encoding\uff1a\u8868\u793a\u7f16\u7801\u65b9\u5f0f\uff0c1 \u5b57\u8282\uff1b content\uff1a\u4fdd\u5b58\u5b9e\u9645\u6570\u636e\u3002 \u8fd9\u4e9b entry \u4f1a\u6328\u4e2a\u513f\u653e\u7f6e\u5728\u5185\u5b58\u4e2d\uff0c\u4e0d\u9700\u8981\u518d\u7528\u989d\u5916\u7684\u6307\u9488\u8fdb\u884c\u8fde\u63a5\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8282\u7701\u6307\u9488\u6240\u5360\u7528\u7684\u7a7a\u95f4\u3002 \u4fdd\u5b58\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID \u4e3a\u4f8b \u6bcf\u4e2a entry \u4fdd\u5b58\u4e00\u4e2a\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID\uff088 \u5b57\u8282\uff09\uff0c\u6b64\u65f6\uff0c\u6bcf\u4e2a entry \u7684 prev_len \u53ea\u9700\u8981 1 \u4e2a\u5b57\u8282\u5c31\u884c\uff0c\u56e0\u4e3a\u6bcf\u4e2a entry \u7684\u524d\u4e00\u4e2a entry \u957f\u5ea6\u90fd\u53ea\u6709 8 \u5b57\u8282\uff0c\u5c0f\u4e8e 254 \u5b57\u8282\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4e00\u4e2a\u56fe\u7247\u7684\u5b58\u50a8\u5bf9\u8c61 ID \u6240\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f\u662f 14 \u5b57\u8282\uff081+4+1+8=14\uff09\uff0c\u5b9e\u9645\u5206\u914d 16 \u5b57\u8282\u3002 Redis \u57fa\u4e8e\u538b\u7f29\u5217\u8868\u5b9e\u73b0\u4e86 List\u3001Hash \u548c Sorted Set \u8fd9\u6837\u7684\u96c6\u5408\u7c7b\u578b\uff0c\u8fd9\u6837\u505a\u7684\u6700\u5927\u597d\u5904\u5c31\u662f\u8282\u7701\u4e86 dictEntry \u7684\u5f00\u9500\u3002 \u5f53\u4f60\u7528 String \u7c7b\u578b\u65f6\uff0c\u4e00\u4e2a\u952e\u503c\u5bf9\u5c31\u6709\u4e00\u4e2a dictEntry\uff0c\u8981\u7528 32 \u5b57\u8282\u7a7a\u95f4\u3002 \u4f46\u91c7\u7528\u96c6\u5408\u7c7b\u578b\u65f6\uff0c\u4e00\u4e2a key \u5c31\u5bf9\u5e94\u4e00\u4e2a\u96c6\u5408\u7684\u6570\u636e\uff0c\u80fd\u4fdd\u5b58\u7684\u6570\u636e\u591a\u4e86\u5f88\u591a\uff0c\u4f46\u4e5f\u53ea\u7528\u4e86\u4e00\u4e2a dictEntry\uff0c\u8fd9\u6837\u5c31\u8282\u7701\u4e86\u5185\u5b58\u3002 \u5728\u7528\u96c6\u5408\u7c7b\u578b\u4fdd\u5b58\u952e\u503c\u5bf9\u65f6\uff0c\u4e00\u4e2a\u952e\u5bf9\u5e94\u4e86\u4e00\u4e2a\u96c6\u5408\u7684\u6570\u636e\uff0c\u4f46\u662f\u5728\u6211\u4eec\u7684\u573a\u666f\u4e2d\uff0c\u4e00\u4e2a\u56fe\u7247 ID \u53ea\u5bf9\u5e94\u4e00\u4e2a\u56fe\u7247\u7684\u5b58\u50a8\u5bf9\u8c61 ID\uff0c\u6211\u4eec\u8be5\u600e\u4e48\u7528\u96c6\u5408\u7c7b\u578b\u5462\uff1f","title":"3\u3001\u7528\u4ec0\u4e48\u6570\u636e\u7ed3\u6784\u53ef\u4ee5\u8282\u7701\u5185\u5b58\uff1f"},{"location":"chap3/1redis_string/#4","text":"\u5728\u4fdd\u5b58\u5355\u503c\u7684\u952e\u503c\u5bf9\u65f6\uff0c\u53ef\u4ee5\u91c7\u7528\u57fa\u4e8e Hash \u7c7b\u578b\u7684\u4e8c\u7ea7\u7f16\u7801\u65b9\u6cd5\u3002 \u8fd9\u91cc\u8bf4\u7684\u4e8c\u7ea7\u7f16\u7801\uff0c\u5c31\u662f\u628a\u4e00\u4e2a\u5355\u503c\u7684\u6570\u636e\u62c6\u5206\u6210\u4e24\u90e8\u5206\uff0c\u524d\u4e00\u90e8\u5206\u4f5c\u4e3a Hash \u96c6\u5408\u7684 key\uff0c\u540e\u4e00\u90e8\u5206\u4f5c\u4e3a Hash \u96c6\u5408\u7684 value\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u5355\u503c\u6570\u636e\u4fdd\u5b58\u5230 Hash \u96c6\u5408\u4e2d\u4e86 \u3002 \u4ee5\u56fe\u7247 ID 1101000060 \u548c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID 3302000080 \u4e3a\u4f8b\uff0c \u6211\u4eec\u53ef\u4ee5\u628a\u56fe\u7247 ID \u7684\u524d 7 \u4f4d\uff081101000\uff09\u4f5c\u4e3a Hash \u7c7b\u578b\u7684\u952e\uff0c\u628a\u56fe\u7247 ID \u7684\u6700\u540e 3 \u4f4d\uff08060\uff09\u548c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID \u5206\u522b\u4f5c\u4e3a Hash \u7c7b\u578b\u503c\u4e2d\u7684 key \u548c value\u3002 \u6211\u5728 Redis \u4e2d\u63d2\u5165\u4e86\u4e00\u7ec4\u56fe\u7247 ID \u53ca\u5176\u5b58\u50a8\u5bf9\u8c61 ID \u7684\u8bb0\u5f55\uff0c\u5e76\u4e14\u7528 info \u547d\u4ee4\u67e5\u770b\u4e86\u5185\u5b58\u5f00\u9500\uff0c\u6211\u53d1\u73b0\uff0c\u589e\u52a0\u4e00\u6761\u8bb0\u5f55\u540e\uff0c\u5185\u5b58\u5360\u7528\u53ea\u589e\u52a0\u4e86 16 \u5b57\u8282 127.0.0.1:6379> info memory # Memory used_memory:1039120 127.0.0.1:6379> hset 1101000 060 3302000080 (integer) 1 127.0.0.1:6379> info memory # Memory used_memory:1039136 \u5728\u4f7f\u7528 String \u7c7b\u578b\u65f6\uff0c\u6bcf\u4e2a\u8bb0\u5f55\u9700\u8981\u6d88\u8017 64 \u5b57\u8282\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5374\u53ea\u7528\u4e86 16 \u5b57\u8282\uff0c\u6240\u4f7f\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u662f\u539f\u6765\u7684 1/4\uff0c\u6ee1\u8db3\u4e86\u6211\u4eec\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u7684\u9700\u6c42\u3002 \u4e8c\u7ea7\u7f16\u7801\u4e00\u5b9a\u8981\u628a\u56fe\u7247 ID \u7684\u524d 7 \u4f4d\u4f5c\u4e3a Hash \u7c7b\u578b\u7684\u952e\uff0c\u628a\u6700\u540e 3 \u4f4d\u4f5c\u4e3a Hash \u7c7b\u578b\u503c\u4e2d\u7684 key \u5417\uff1f\u201d\u5176\u5b9e\uff0c\u4e8c\u7ea7\u7f16\u7801\u65b9\u6cd5\u4e2d\u91c7\u7528\u7684 ID \u957f\u5ea6\u662f\u6709\u8bb2\u7a76\u7684\u3002 Redis Hash \u7c7b\u578b\u7684\u4e24\u79cd\u5e95\u5c42\u5b9e\u73b0\u7ed3\u6784\uff0c\u5206\u522b\u662f\u538b\u7f29\u5217\u8868\u548c\u54c8\u5e0c\u8868\u3002 Hash \u7c7b\u578b\u5e95\u5c42\u7ed3\u6784\u4ec0\u4e48\u65f6\u5019\u4f7f\u7528\u538b\u7f29\u5217\u8868\uff0c\u4ec0\u4e48\u65f6\u5019\u4f7f\u7528\u54c8\u5e0c\u8868\u5462\uff1f\u5176\u5b9e\uff0cHash \u7c7b\u578b\u8bbe\u7f6e\u4e86\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u6570\u636e\u65f6\u7684\u4e24\u4e2a\u9608\u503c\uff0c\u4e00\u65e6\u8d85\u8fc7\u4e86\u9608\u503c\uff0cHash \u7c7b\u578b\u5c31\u4f1a\u7528\u54c8\u5e0c\u8868\u6765\u4fdd\u5b58\u6570\u636e\u4e86\u3002 \u8fd9\u4e24\u4e2a\u9608\u503c\u5206\u522b\u5bf9\u5e94\u4ee5\u4e0b\u4e24\u4e2a\u914d\u7f6e\u9879\uff1a hash-max-ziplist-entries \uff1a \u8868\u793a\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u65f6\u54c8\u5e0c\u96c6\u5408\u4e2d\u7684\u6700\u5927\u5143\u7d20\u4e2a\u6570\u3002 hash-max-ziplist-value \uff1a \u8868\u793a\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u65f6\u54c8\u5e0c\u96c6\u5408\u4e2d\u5355\u4e2a\u5143\u7d20\u7684\u6700\u5927\u957f\u5ea6\u3002 \u5982\u679c\u6211\u4eec\u5f80 Hash \u96c6\u5408\u4e2d\u5199\u5165\u7684\u5143\u7d20\u4e2a\u6570\u8d85\u8fc7\u4e86 hash-max-ziplist-entries \uff0c\u6216\u8005\u5199\u5165\u7684\u5355\u4e2a\u5143\u7d20\u5927\u5c0f\u8d85\u8fc7\u4e86 hash-max-ziplist-value \uff0cRedis \u5c31\u4f1a\u81ea\u52a8\u628a Hash \u7c7b\u578b\u7684\u5b9e\u73b0\u7ed3\u6784\u7531\u538b\u7f29\u5217\u8868\u8f6c\u4e3a\u54c8\u5e0c\u8868\u3002 \u4e00\u65e6\u4ece\u538b\u7f29\u5217\u8868\u8f6c\u4e3a\u4e86\u54c8\u5e0c\u8868\uff0cHash \u7c7b\u578b\u5c31\u4f1a\u4e00\u76f4\u7528\u54c8\u5e0c\u8868\u8fdb\u884c\u4fdd\u5b58\uff0c\u800c\u4e0d\u4f1a\u518d\u8f6c\u56de\u538b\u7f29\u5217\u8868\u4e86\u3002\u5728\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u65b9\u9762\uff0c\u54c8\u5e0c\u8868\u5c31\u6ca1\u6709\u538b\u7f29\u5217\u8868\u90a3\u4e48\u9ad8\u6548\u4e86\u3002 \u4e3a\u4e86\u80fd\u5145\u5206\u4f7f\u7528\u538b\u7f29\u5217\u8868\u7684\u7cbe\u7b80\u5185\u5b58\u5e03\u5c40\uff0c\u6211\u4eec\u4e00\u822c\u8981\u63a7\u5236\u4fdd\u5b58\u5728 Hash \u96c6\u5408\u4e2d\u7684\u5143\u7d20\u4e2a\u6570 \u3002 \u5728\u521a\u624d\u7684\u4e8c\u7ea7\u7f16\u7801\u4e2d\uff0c\u6211\u4eec\u53ea\u7528\u56fe\u7247 ID \u6700\u540e 3 \u4f4d\u4f5c\u4e3a Hash \u96c6\u5408\u7684 key\uff0c\u4e5f\u5c31\u4fdd\u8bc1\u4e86 Hash \u96c6\u5408\u7684\u5143\u7d20\u4e2a\u6570\u4e0d\u8d85\u8fc7 1000\uff0c\u540c\u65f6\uff0c\u6211\u4eec\u628a hash-max-ziplist-entries \u8bbe\u7f6e\u4e3a 1000\uff0c\u8fd9\u6837\u4e00\u6765\uff0cHash \u96c6\u5408\u5c31\u53ef\u4ee5\u4e00\u76f4\u4f7f\u7528\u538b\u7f29\u5217\u8868\u6765\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u4e86\u3002","title":"4\u3001\u5982\u4f55\u7528\u96c6\u5408\u7c7b\u578b\u4fdd\u5b58\u5355\u503c\u7684\u952e\u503c\u5bf9\uff1f"},{"location":"chap3/1redis_string/#5","text":"String \u5728\u4fdd\u5b58\u7684\u952e\u503c\u5bf9\u672c\u8eab\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u4e0d\u5927\u65f6\uff0cString \u7c7b\u578b\u7684\u5143\u6570\u636e\u5f00\u9500\u5c31\u5360\u636e\u4e3b\u5bfc\u4e86\uff0c \u8fd9\u91cc\u9762\u5305\u62ec\u4e86 RedisObject \u7ed3\u6784\u3001SDS \u7ed3\u6784\u3001dictEntry \u7ed3\u6784\u7684\u5185\u5b58\u5f00\u9500 \u3002 \u4f7f\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u6570\u636e\u3002\u5f53\u7136\uff0c\u4f7f\u7528 Hash \u8fd9\u79cd\u96c6\u5408\u7c7b\u578b\u4fdd\u5b58\u5355\u503c\u952e\u503c\u5bf9\u7684\u6570\u636e\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5c06\u5355\u503c\u6570\u636e\u62c6\u5206\u6210\u4e24\u90e8\u5206\uff0c\u5206\u522b\u4f5c\u4e3a Hash \u96c6\u5408\u7684\u952e\u548c\u503c\uff0c\u5c31\u50cf\u521a\u624d\u6848\u4f8b\u4e2d\u7528\u4e8c\u7ea7\u7f16\u7801\u6765\u8868\u793a\u56fe\u7247 ID \u5982\u679c\u4f60\u60f3\u77e5\u9053\u952e\u503c\u5bf9\u91c7\u7528\u4e0d\u540c\u7c7b\u578b\u4fdd\u5b58\u65f6\u7684\u5185\u5b58\u5f00\u9500\uff0c\u53ef\u4ee5\u5728 \u8fd9\u4e2a\u7f51\u5740 \u91cc\u8f93\u5165\u4f60\u7684\u952e\u503c\u5bf9\u957f\u5ea6\u548c\u4f7f\u7528\u7684\u6570\u636e\u7c7b\u578b\uff0c\u8fd9\u6837\u5c31\u80fd\u77e5\u9053\u5b9e\u9645\u6d88\u8017\u7684\u5185\u5b58\u5927\u5c0f\u4e86","title":"5\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap3/1redis_string/#5-1-redisstring","text":"Redis\u7684String\u7c7b\u578b\u6570\u636e\u7ed3\u6784\uff0c\u53ca\u5176\u5e95\u5c42\u5b9e\u73b0 \u53ef\u4ee5\u5de7\u5999\u7684\u5229\u7528Redis\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u7279\u6027\uff0c\u964d\u4f4e\u8d44\u6e90\u6d88\u8017 Simple Dynamic String\u7ed3\u6784 buf \uff1a\u5b57\u8282\u6570\u7ec4\uff0c\u4fdd\u5b58\u5b9e\u9645\u6570\u636e\u3002\u4e3a\u4e86\u8868\u793a\u5b57\u8282\u6570\u7ec4\u7684\u7ed3\u675f\uff0cRedis \u4f1a\u81ea\u52a8\u5728\u6570\u7ec4\u6700\u540e\u52a0\u4e00\u4e2a\u201c\\0\u201d\uff0c\u8fd9\u5c31\u4f1a\u989d\u5916\u5360\u7528 1 \u4e2a\u5b57\u8282\u7684\u5f00\u9500\u3002 len\uff1a\u5360 4 \u4e2a\u5b57\u8282\uff0c \u8868\u793a buf \u7684\u5df2\u7528\u957f\u5ea6 \u3002 alloc\uff1a\u4e5f\u5360\u4e2a 4 \u5b57\u8282\uff0c \u8868\u793a buf \u7684\u5b9e\u9645\u5206\u914d\u957f\u5ea6\uff0c\u4e00\u822c\u5927\u4e8e len\u3002 dicEntry \u7ed3\u6784\u4f53 key\uff1a8\u4e2a\u5b57\u8282\u6307\u9488\uff0c\u6307\u5411key value\uff1a8\u4e2a\u5b57\u8282\u6307\u9488\uff0c\u6307\u5411value next\uff1a\u6307\u5411\u4e0b\u4e00\u4e2adicEntry ziplist(\u538b\u7f29\u5217\u8868)\uff08 zlbytes\uff1a\u5728\u8868\u5934\uff0c\u8868\u793a\u5217\u8868\u957f\u5ea6 zltail\uff1a\u5728\u8868\u5934\uff0c\u8868\u793a\u5217\u5c3e\u504f\u79fb\u91cf zllen\uff1a\u5728\u8868\u5934\uff0c\u8868\u793a\u5217\u8868\u4e2d entry\uff1a\u4fdd\u5b58\u6570\u636e\u5bf9\u8c61\u6a21\u578b zlend\uff1a\u5728\u8868\u5c3e\uff0c\u8868\u793a\u5217\u8868\u7ed3\u675f\uff09 entry\uff1a prev_len \uff1a\u8868\u793a\u4e00\u4e2aentry\u7684\u957f\u5ea6\uff0c\u6709\u4e24\u79cd\u53d6\u503c\u65b9\u5f0f\uff1a1\u5b57\u8282\u62165\u5b57\u8282\u3002 1\u5b57\u8282\u8868\u793a\u4e00\u4e2aentry\u5c0f\u4e8e254\u5b57\u8282\uff0c255\u662fzlend\u7684\u9ed8\u8ba4\u503c\uff0c\u6240\u4ee5\u4e0d\u4f7f\u7528\u3002 len\uff1a\u8868\u793a\u81ea\u8eab\u957f\u5ea6\uff0c4\u5b57\u8282 encodeing\uff1a\u8868\u793a\u7f16\u7801\u65b9\u5f0f\uff0c1\u5b57\u8282 content\uff1a\u4fdd\u5b58\u5b9e\u9645\u6570\u636e String\u7c7b\u578b\u7684\u5185\u5b58\u7a7a\u95f4\u6d88\u8017 \u4fdd\u5b58Long\u7c7b\u578b\u65f6\uff0c\u6307\u9488\u76f4\u63a5\u4fdd\u5b58\u6574\u6570\u6570\u636e\u503c\uff0c\u53ef\u4ee5\u8282\u7701\u7a7a\u95f4\u5f00\u9500\uff08\u88ab\u79f0\u4e3a\uff1aint\u7f16\u7801\uff09 \u4fdd\u5b58\u5b57\u7b26\u4e32\uff0c\u4e14\u4e0d\u5927\u4e8e44\u5b57\u8282\u65f6\uff0cRedisObject\u7684\u5143\u6570\u636e\uff0c\u6307\u9488\u548cSDS\u662f\u8fde\u7eed\u7684\uff0c\u53ef\u4ee5\u907f\u514d\u5185\u5b58\u788e\u7247\uff08\u88ab\u79f0\u4e3a\uff1aembstr\u7f16\u7801\uff09 \u5f53\u4fdd\u5b58\u7684\u5b57\u7b26\u4e32\u5927\u4e8e44\u5b57\u8282\u65f6\uff0cSDS\u7684\u6570\u636e\u91cf\u53d8\u591a\uff0cRedis\u4f1a\u7ed9SDS\u5206\u914d\u72ec\u7acb\u7684\u7a7a\u95f4\uff0c\u5e76\u7528\u6307\u9488\u6307\u5411SDS\u7ed3\u6784\uff08\u88ab\u79f0\u4e3a\uff1araw\u7f16\u7801\uff09 Redis\u4f7f\u7528\u4e00\u4e2a\u5168\u5c40\u54c8\u5e0c\u8868\u4fdd\u5b58\u6240\u4ee5\u952e\u503c\u5bf9\uff0c\u54c8\u5e0c\u8868\u7684\u6bcf\u4e00\u9879\u90fd\u662f\u4e00\u4e2adicEntry\uff0c\u6bcf\u4e2adicEntry\u5360\u752832\u5b57\u8282\u7a7a\u95f4 dicEntry\u81ea\u8eab24\u5b57\u8282\uff0c\u4f46\u4f1a\u5360\u752832\u5b57\u8282\u7a7a\u95f4\uff0c\u662f\u56e0\u4e3aRedis\u4f7f\u7528\u4e86\u5185\u5b58\u5206\u914d\u5e93jemalloc\u3002 jemalloc\u5728\u5206\u914d\u5185\u5b58\u65f6\uff0c\u4f1a\u6839\u636e\u7533\u8bf7\u7684\u5b57\u8282\u6570N\uff0c\u627e\u4e00\u4e2a\u6bd4N\u5927\uff0c\u4f46\u6700\u63a5\u8fd1N\u76842\u7684\u5e42\u6b21\u6570\u4f5c\u4e3a\u5206\u914d\u7a7a\u95f4\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u9891\u7e41\u5206\u914d\u5185\u5b58\u7684\u6b21\u6570 \u4f7f\u7528\u4ec0\u4e48\u6570\u636e\u7ed3\u6784\u53ef\u4ee5\u8282\u7701\u5185\u5b58\uff1f \u538b\u7f29\u5217\u8868\uff0c\u662f\u4e00\u79cd\u975e\u5e38\u8282\u7701\u5185\u5b58\u7684\u6570\u636e\u7ed3\u6784\uff0c\u56e0\u4e3a\u4ed6\u4f7f\u7528\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u4fdd\u5b58\u6570\u636e\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7684\u6307\u9488\u8fdb\u884c\u8fde\u63a5 Redis\u57fa\u4e8e\u538b\u7f29\u5217\u8868\u5b9e\u73b0List\uff0cHash\uff0cSorted Set\u96c6\u5408\u7c7b\u578b\uff0c\u6700\u5927\u7684\u597d\u5904\u662f\u8282\u7701\u4e86dicEntry\u5f00\u9500 \u5982\u4f55\u4f7f\u7528\u96c6\u5408\u7c7b\u578b\u4fdd\u5b58\u952e\u503c\u5bf9\uff1f Hash\u7c7b\u578b\u8bbe\u7f6e\u4e86\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u6570\u636e\u65f6\u7684\u4e24\u4e2a\u9600\u503c\uff0c\u4e00\u65e6\u8d85\u8fc7\u5c31\u4f1a\u5c06\u538b\u7f29\u5217\u8868\u8f6c\u4e3a\u54c8\u5e0c\u8868\uff0c\u4e14\u4e0d\u53ef\u56de\u9000 hash-max-ziplist-entries \uff1a\u8868\u793a\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u54c8\u5e0c\u96c6\u5408\u4e2d\u7684\u6700\u5927\u5143\u7d20\u4e2a\u6570 hash-max-ziplist-value \uff1a\u8868\u793a\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u65f6\uff0c\u54c8\u5e0c\u96c6\u5408\u4e2d\u5355\u4e2a\u5143\u7d20\u7684\u6700\u5927\u957f\u5ea6","title":"5-1  Redis\u7684String\u7c7b\u578b\u6570\u636e\u7ed3\u6784\uff0c\u53ca\u5176\u5e95\u5c42\u5b9e\u73b0"},{"location":"chap3/2redis_sets/","text":"\u7b2c\u4e8c\u8282 Redis\u6709\u90a3\u4e9b\u6570\u636e\u7ed3\u6784\u9002\u5408\u505a\u7edf\u8ba1 \u5728 Web \u548c\u79fb\u52a8\u5e94\u7528\u7684\u4e1a\u52a1\u573a\u666f\u4e2d\uff0c\u7ecf\u5e38\u9700\u8981\u4fdd\u5b58\u8fd9\u6837\u4e00\u79cd\u4fe1\u606f\uff1a \u4e00\u4e2a key \u5bf9\u5e94\u4e86\u4e00\u4e2a\u6570\u636e\u96c6\u5408 \u624b\u673a App \u4e2d\u7684\u6bcf\u5929\u7684\u7528\u6237\u767b\u5f55\u4fe1\u606f\uff1a\u4e00\u5929\u5bf9\u5e94\u4e00\u7cfb\u5217\u7528\u6237 ID \u6216\u79fb\u52a8\u8bbe\u5907 ID\uff1b \u7535\u5546\u7f51\u7ad9\u4e0a\u5546\u54c1\u7684\u7528\u6237\u8bc4\u8bba\u5217\u8868\uff1a\u4e00\u4e2a\u5546\u54c1\u5bf9\u5e94\u4e86\u4e00\u7cfb\u5217\u7684\u8bc4\u8bba\uff1b \u7528\u6237\u5728\u624b\u673a App \u4e0a\u7684\u7b7e\u5230\u6253\u5361\u4fe1\u606f\uff1a\u4e00\u5929\u5bf9\u5e94\u4e00\u7cfb\u5217\u7528\u6237\u7684\u7b7e\u5230\u8bb0\u5f55\uff1b \u5e94\u7528\u7f51\u7ad9\u4e0a\u7684\u7f51\u9875\u8bbf\u95ee\u4fe1\u606f\uff1a\u4e00\u4e2a\u7f51\u9875\u5bf9\u5e94\u4e00\u7cfb\u5217\u7684\u8bbf\u95ee\u70b9\u51fb\u3002 Redis \u96c6\u5408\u7c7b\u578b\u7684\u7279\u70b9\u5c31\u662f\u4e00\u4e2a\u952e\u5bf9\u5e94\u4e00\u7cfb\u5217\u7684\u6570\u636e\uff0c\u6240\u4ee5\u975e\u5e38\u9002\u5408\u7528\u6765\u5b58\u53d6\u8fd9\u4e9b\u6570\u636e\u3002\u9664\u4e86\u8bb0\u5f55\u4fe1\u606f\uff0c\u6211\u4eec\u5f80\u5f80\u8fd8\u9700\u8981\u5bf9\u96c6\u5408\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u7edf\u8ba1\uff0c\u4f8b\u5982\uff1a \u5728\u79fb\u52a8\u5e94\u7528\u4e2d\uff0c\u9700\u8981\u7edf\u8ba1\u6bcf\u5929\u7684\u65b0\u589e\u7528\u6237\u6570\u548c\u7b2c\u4e8c\u5929\u7684\u7559\u5b58\u7528\u6237\u6570\uff1b \u5728\u7535\u5546\u7f51\u7ad9\u7684\u5546\u54c1\u8bc4\u8bba\u4e2d\uff0c\u9700\u8981\u7edf\u8ba1\u8bc4\u8bba\u5217\u8868\u4e2d\u7684\u6700\u65b0\u8bc4\u8bba\uff1b \u5728\u7b7e\u5230\u6253\u5361\u4e2d\uff0c\u9700\u8981\u7edf\u8ba1\u4e00\u4e2a\u6708\u5185\u8fde\u7eed\u6253\u5361\u7684\u7528\u6237\u6570\uff1b \u5728\u7f51\u9875\u8bbf\u95ee\u8bb0\u5f55\u4e2d\uff0c\u9700\u8981\u7edf\u8ba1\u72ec\u7acb\u8bbf\u5ba2\uff08Unique Visitor\uff0cUV\uff09\u91cf\u3002 \u8981\u60f3\u9009\u62e9\u5408\u9002\u7684\u96c6\u5408\uff0c\u6211\u4eec\u5c31\u5f97\u4e86\u89e3\u5e38\u7528\u7684\u96c6\u5408\u7edf\u8ba1\u6a21\u5f0f\u3002 \u96c6\u5408\u7c7b\u578b\u5e38\u89c1\u7684\u56db\u79cd\u7edf\u8ba1\u6a21\u5f0f\uff0c\u5305\u62ec\u805a\u5408\u7edf\u8ba1\u3001\u6392\u5e8f\u7edf\u8ba1\u3001\u4e8c\u503c\u72b6\u6001\u7edf\u8ba1\u548c\u57fa\u6570\u7edf\u8ba1\u3002 1\u3001\u805a\u5408\u7edf\u8ba1 \u6240\u8c13\u7684\u805a\u5408\u7edf\u8ba1\uff0c\u5c31\u662f\u6307\u7edf\u8ba1\u591a\u4e2a\u96c6\u5408\u5143\u7d20\u7684\u805a\u5408\u7ed3\u679c\uff0c\u5305\u62ec\uff1a \u7edf\u8ba1\u591a\u4e2a\u96c6\u5408\u7684\u5171\u6709\u5143\u7d20\uff08\u4ea4\u96c6\u7edf\u8ba1\uff09\uff1b \u628a\u4e24\u4e2a\u96c6\u5408\u76f8\u6bd4\uff0c\u7edf\u8ba1\u5176\u4e2d\u4e00\u4e2a\u96c6\u5408\u72ec\u6709\u7684\u5143\u7d20\uff08\u5dee\u96c6\u7edf\u8ba1\uff09\uff1b \u7edf\u8ba1\u591a\u4e2a\u96c6\u5408\u7684\u6240\u6709\u5143\u7d20\uff08\u5e76\u96c6\u7edf\u8ba1\uff09\u3002 \u7edf\u8ba1\u624b\u673a App \u6bcf\u5929\u7684\u65b0\u589e\u7528\u6237\u6570\u548c\u7b2c\u4e8c\u5929\u7684\u7559\u5b58\u7528\u6237\u6570\uff0c\u6b63\u597d\u5bf9\u5e94\u4e86\u805a\u5408\u7edf\u8ba1\u3002 \u7528\u4e00\u4e2a \u96c6\u5408\u8bb0\u5f55\u6240\u6709\u767b\u5f55\u8fc7 App \u7684\u7528\u6237 ID \u7528\u53e6\u4e00\u4e2a\u96c6\u5408\u8bb0\u5f55\u6bcf\u4e00\u5929\u767b\u5f55\u8fc7 App \u7684\u7528\u6237 ID\u3002 \u767b\u5f55\u8fc7 App \u7684\u7528\u6237 ID\uff1a \u76f4\u63a5\u4f7f\u7528 Set \u7c7b\u578b\uff0c\u628a key \u8bbe\u7f6e\u4e3a user:id \uff0c\u8868\u793a\u8bb0\u5f55\u7684\u662f\u7528\u6237 ID\uff0c value \u5c31\u662f\u4e00\u4e2a Set \u96c6\u5408\uff0c\u91cc\u9762\u662f\u6240\u6709\u767b\u5f55\u8fc7 App \u7684\u7528\u6237 ID\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e2a Set \u53eb \u4f5c\u7d2f\u8ba1\u7528\u6237 Set \uff0c \u7d2f\u8ba1\u7528\u6237 Set \u4e2d\u6ca1\u6709\u65e5\u671f\u4fe1\u606f\uff0c\u6211\u4eec\u662f\u4e0d\u80fd\u76f4\u63a5\u7edf\u8ba1\u6bcf\u5929\u7684\u65b0\u589e\u7528\u6237\u7684 \u3002\u6240\u4ee5\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u628a\u6bcf\u4e00\u5929\u767b\u5f55\u7684\u7528\u6237 ID\uff0c\u8bb0\u5f55\u5230\u4e00\u4e2a\u65b0\u96c6\u5408\u4e2d\uff0c\u6211\u4eec\u628a\u8fd9\u4e2a\u96c6\u5408\u53eb\u4f5c \u6bcf\u65e5\u7528\u6237 Set \uff0c\u5b83\u6709\u4e24\u4e2a\u7279\u70b9\uff1a key \u662f user:id \u4ee5\u53ca\u5f53\u5929\u65e5\u671f\uff0c\u4f8b\u5982 user:id:20200803 \uff1b value \u662f Set \u96c6\u5408\uff0c\u8bb0\u5f55\u5f53\u5929\u767b\u5f55\u7684\u7528\u6237 ID\u3002 \u5728\u7edf\u8ba1\u6bcf\u5929\u7684\u65b0\u589e\u7528\u6237\u65f6\uff0c\u6211\u4eec\u53ea\u7528 \u8ba1\u7b97\u6bcf\u65e5\u7528\u6237 Set \u548c\u7d2f\u8ba1\u7528\u6237 Set \u7684\u5dee\u96c6\u5c31\u884c \u3002 \u5047\u8bbe\u6211\u4eec\u7684\u624b\u673a App \u5728 2020 \u5e74 8 \u6708 3 \u65e5\u4e0a\u7ebf\uff0c\u90a3\u4e48\uff0c8 \u6708 3 \u65e5\u524d\u662f\u6ca1\u6709\u7528\u6237\u7684\u3002 \u6b64\u65f6\uff0c\u7d2f\u8ba1\u7528\u6237 Set \u662f\u7a7a\u96c6\uff0c\u5f53\u5929\u767b\u5f55\u7684\u7528\u6237 ID \u4f1a\u88ab\u8bb0\u5f55\u5230 key \u4e3a user:id:20200803 \u7684 Set \u4e2d\u3002\u6240\u4ee5\uff0c user:id:20200803 \u8fd9\u4e2a Set \u4e2d\u7684\u7528\u6237\u5c31\u662f\u5f53\u5929\u7684\u65b0\u589e\u7528\u6237\u3002 \u7136\u540e\uff0c \u6211\u4eec\u8ba1\u7b97\u7d2f\u8ba1\u7528\u6237 Set \u548c user:id:20200803 Set \u7684\u5e76\u96c6\u7ed3\u679c\uff0c\u7ed3\u679c\u4fdd\u5b58\u5728 user:id \u8fd9\u4e2a\u7d2f\u8ba1\u7528\u6237 Set \u4e2d \uff0c\u5982\u4e0b\u6240\u793a\uff1a \u7edf\u8ba1\u591a\u4e2a\u96c6\u5408\u7684\u6240\u6709\u5143\u7d20\uff08\u5e76\u96c6\u7edf\u8ba1\uff09\u3002 SUNIONSTORE user:id user:id user:id:20200803 \u6b64\u65f6\uff0c user:id \u8fd9\u4e2a\u7d2f\u8ba1\u7528\u6237 Set \u4e2d\u5c31\u6709\u4e86 8 \u6708 3 \u65e5\u7684\u7528\u6237 ID\u3002 \u7b49\u5230 8 \u6708 4 \u65e5\u518d\u7edf\u8ba1\u65f6\uff0c\u6211\u4eec\u628a 8 \u6708 4 \u65e5\u767b\u5f55\u7684\u7528\u6237 ID \u8bb0\u5f55\u5230 user:id:20200804 \u7684 Set \u4e2d \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6267\u884c SDIFFSTORE \u547d\u4ee4\u8ba1\u7b97\u7d2f\u8ba1\u7528\u6237 Set \u548c user:id:20200804 Set \u7684\u5dee\u96c6\uff0c\u7ed3\u679c\u4fdd\u5b58\u5728 key \u4e3a user:new \u7684 Set \u4e2d\uff0c\u5982\u4e0b\u6240\u793a\uff1a \u628a\u4e24\u4e2a\u96c6\u5408\u76f8\u6bd4\uff0c\u7edf\u8ba1\u5176\u4e2d\u4e00\u4e2a\u96c6\u5408\u72ec\u6709\u7684\u5143\u7d20\uff08\u5dee\u96c6\u7edf\u8ba1\uff09\uff1b SDIFFSTORE user:new user:id:20200804 user:id \u4ee5\u770b\u5230\uff0c\u8fd9\u4e2a\u5dee\u96c6\u4e2d\u7684\u7528\u6237 ID \u5728 user:id:20200804 \u7684 Set \u4e2d\u5b58\u5728\uff0c\u4f46\u662f\u4e0d\u5728\u7d2f\u8ba1\u7528\u6237 Set \u4e2d\u3002\u6240\u4ee5\uff0c user:new \u8fd9\u4e2a Set \u4e2d\u8bb0\u5f55\u7684\u5c31\u662f 8 \u6708 4 \u65e5\u7684\u65b0\u589e\u7528\u6237\u3002 \u5f53\u8981\u8ba1\u7b97 8 \u6708 4 \u65e5\u7684\u7559\u5b58\u7528\u6237\u65f6\uff0c\u6211\u4eec\u53ea\u9700\u8981\u518d\u8ba1\u7b97 user:id:20200803 \u548c user:id:20200804 \u4e24\u4e2a Set \u7684\u4ea4\u96c6\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u540c\u65f6\u5728\u8fd9\u4e24\u4e2a\u96c6\u5408\u4e2d\u7684\u7528\u6237 ID \u4e86\uff0c\u8fd9\u4e9b\u5c31\u662f\u5728 8 \u6708 3 \u65e5\u767b\u5f55\uff0c\u5e76\u4e14\u5728 8 \u6708 4 \u65e5\u7559\u5b58\u7684\u7528\u6237\u3002 \u7edf\u8ba1\u591a\u4e2a\u96c6\u5408\u7684\u5171\u6709\u5143\u7d20\uff08\u4ea4\u96c6\u7edf\u8ba1\uff09 \u6267\u884c\u7684\u547d\u4ee4\u5982\u4e0b\uff1a SINTERSTORE user:id:rem user:id:20200803 user:id:20200804 \u5f53\u4f60\u9700\u8981\u5bf9\u591a\u4e2a\u96c6\u5408\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\u65f6\uff0cSet \u7c7b\u578b\u4f1a\u662f\u4e00\u4e2a\u975e\u5e38\u4e0d\u9519\u7684\u9009\u62e9 set\u7c7b\u578b\u9002\u5408\u505a\u805a\u5408\u7edf\u8ba1\uff1a SUNIONSTORE :\u5e76\u96c6 SDIFFSTORE :\u5dee\u96c6 SINTERSTORE :\u4ea4\u96c6 Set \u7684\u5dee\u96c6\u3001\u5e76\u96c6\u548c\u4ea4\u96c6\u7684\u8ba1\u7b97\u590d\u6742\u5ea6\u8f83\u9ad8\uff0c\u5728\u6570\u636e\u91cf\u8f83\u5927\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u76f4\u63a5\u6267\u884c\u8fd9\u4e9b\u8ba1\u7b97\uff0c\u4f1a\u5bfc\u81f4 Redis \u5b9e\u4f8b\u963b\u585e \u5efa\u8bae\uff1a \u4f60\u53ef\u4ee5\u4ece\u4e3b\u4ece\u96c6\u7fa4\u4e2d\u9009\u62e9\u4e00\u4e2a\u4ece\u5e93\uff0c\u8ba9\u5b83\u4e13\u95e8\u8d1f\u8d23\u805a\u5408\u8ba1\u7b97\uff0c\u6216\u8005\u662f\u628a\u6570\u636e\u8bfb\u53d6\u5230\u5ba2\u6237\u7aef\uff0c\u5728\u5ba2\u6237\u7aef\u6765\u5b8c\u6210\u805a\u5408\u7edf\u8ba1\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u89c4\u907f\u963b\u585e\u4e3b\u5e93\u5b9e\u4f8b\u548c\u5176\u4ed6\u4ece\u5e93\u5b9e\u4f8b\u7684\u98ce\u9669\u4e86 \u3002 2\u3001\u6392\u5e8f\u7edf\u8ba1 \u4ee5\u5728\u7535\u5546\u7f51\u7ad9\u4e0a\u63d0\u4f9b\u6700\u65b0\u8bc4\u8bba \u5217\u8868\u7684\u573a\u666f\u4e3a\u4f8b\u5e94\u5bf9\u96c6\u5408 \u5143\u7d20\u6392\u5e8f\u9700\u6c42\u7684\u65b9\u6cd5 \u3002 \u6700\u65b0\u8bc4\u8bba\u5217\u8868\u5305\u542b\u4e86\u6240\u6709\u8bc4\u8bba\u4e2d\u7684\u6700\u65b0\u7559\u8a00\uff0c \u8fd9\u5c31\u8981\u6c42\u96c6\u5408\u7c7b\u578b\u80fd\u5bf9\u5143\u7d20\u4fdd\u5e8f \uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u96c6\u5408 \u4e2d\u7684\u5143\u7d20\u53ef\u4ee5\u6309\u5e8f\u6392\u5217\uff0c\u8fd9\u79cd\u5bf9\u5143\u7d20\u4fdd\u5e8f\u7684\u96c6\u5408\u7c7b\u578b\u53eb\u4f5c\u6709\u5e8f\u96c6\u5408 \u3002 \u5728 Redis \u5e38\u7528\u7684 4 \u4e2a\u96c6\u5408\u7c7b\u578b\u4e2d\uff08List\u3001Hash\u3001Set\u3001Sorted Set\uff09\uff0cList \u548c Sorted Set \u5c31\u5c5e\u4e8e\u6709\u5e8f\u96c6\u5408\u3002 List\u662f\u6309\u7167\u653e\u5165\u7684\u987a\u5e8f\u6392\u5e8f\uff0cSorted Set\u6839\u636e\u5143\u7d20\u7684\u6743\u91cd\u8fdb\u884c\u6392\u5e8f\u3002 List \u662f\u6309\u7167\u5143\u7d20\u8fdb\u5165 List \u7684\u987a\u5e8f\u8fdb\u884c\u6392\u5e8f\u7684\uff0c\u800c Sorted Set \u53ef\u4ee5\u6839\u636e\u5143\u7d20\u7684\u6743\u91cd\u6765\u6392\u5e8f\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u6765\u51b3\u5b9a\u6bcf\u4e2a\u5143\u7d20\u7684\u6743\u91cd\u503c\u3002 \u6211\u4eec\u53ef\u4ee5\u6839\u636e\u5143\u7d20\u63d2\u5165 Sorted Set \u7684\u65f6\u95f4\u786e\u5b9a\u6743\u91cd\u503c\uff0c\u5148\u63d2\u5165\u7684\u5143\u7d20\u6743\u91cd\u5c0f\uff0c\u540e\u63d2\u5165\u7684\u5143\u7d20\u6743\u91cd\u5927\u3002 2-1 List \u6bcf\u4e2a\u5546\u54c1\u5bf9\u5e94\u4e00\u4e2a List\uff0c\u8fd9\u4e2a List \u5305\u542b\u4e86\u5bf9\u8fd9\u4e2a\u5546\u54c1\u7684\u6240\u6709\u8bc4\u8bba\uff0c\u800c\u4e14\u4f1a\u6309\u7167\u8bc4\u8bba\u65f6\u95f4\u4fdd\u5b58\u8fd9\u4e9b\u8bc4\u8bba\uff0c\u6bcf\u6765\u4e00\u4e2a\u65b0\u8bc4\u8bba\uff0c\u5c31\u7528 LPUSH \u547d\u4ee4\u628a\u5b83\u63d2\u5165 List \u7684\u961f\u5934\u3002 \u5728\u53ea\u6709\u4e00\u9875\u8bc4\u8bba\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u6e05\u6670\u5730\u770b\u5230\u6700\u65b0\u7684\u8bc4\u8bba\uff0c \u4f46\u662f\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u7f51\u7ad9\u4e00\u822c\u4f1a\u5206\u9875\u663e\u793a\u6700\u65b0\u7684\u8bc4\u8bba\u5217\u8868\uff0c\u4e00\u65e6\u6d89\u53ca\u5230\u5206\u9875\u64cd\u4f5c\uff0cList \u5c31\u53ef\u80fd\u4f1a\u51fa\u73b0\u95ee\u9898\u4e86 \u3002 \u5047\u8bbe\u5f53\u524d\u7684\u8bc4\u8bba List \u662f{A, B, C, D, E, F}\uff08\u5176\u4e2d\uff0cA \u662f\u6700\u65b0\u7684\u8bc4\u8bba\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0cF \u662f\u6700\u65e9\u7684\u8bc4\u8bba\uff09\uff0c\u5728\u5c55\u793a\u7b2c\u4e00\u9875\u7684 3 \u4e2a\u8bc4\u8bba\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5f97\u5230\u6700\u65b0\u7684\u4e09\u6761\u8bc4\u8bba A\u3001B\u3001C\uff1a LRANGE product1 0 2 1) \"A\" 2) \"B\" 3) \"C\" \u7136\u540e\uff0c\u518d\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u83b7\u53d6\u7b2c\u4e8c\u9875\u7684 3 \u4e2a\u8bc4\u8bba\uff0c\u4e5f\u5c31\u662f D\u3001E\u3001F\u3002 LRANGE product1 3 5 1) \"D\" 2) \"E\" 3) \"F\" \u4f46\u662f\uff0c\u5982\u679c\u5728\u5c55\u793a\u7b2c\u4e8c\u9875\u524d\uff0c\u53c8\u4ea7\u751f\u4e86\u4e00\u4e2a\u65b0\u8bc4\u8bba G\uff0c \u8bc4\u8bba G \u5c31\u4f1a\u88ab LPUSH \u547d\u4ee4\u63d2\u5165\u5230\u8bc4\u8bba List \u7684\u961f\u5934\uff0c\u8bc4\u8bba List \u5c31\u53d8\u6210\u4e86 {G, A, B, C, D, E, F} \u3002 \u6b64\u65f6\uff0c\u518d\u7528\u521a\u624d\u7684\u547d\u4ee4\u83b7\u53d6\u7b2c\u4e8c\u9875\u8bc4\u8bba\u65f6\uff0c\u5c31\u4f1a\u53d1\u73b0\uff0c\u8bc4\u8bba C \u53c8\u88ab\u5c55\u793a\u51fa\u6765\u4e86\uff0c\u4e5f\u5c31\u662f C\u3001D\u3001E\u3002 LRANGE product1 3 5 1) \"C\" 2) \"D\" 3) \"E\" \u4e4b\u6240\u4ee5\u4f1a\u8fd9\u6837\uff0c\u5173\u952e\u539f\u56e0\u5c31\u5728\u4e8e\uff0c List \u662f\u901a\u8fc7\u5143\u7d20\u5728 List \u4e2d\u7684\u4f4d\u7f6e\u6765\u6392\u5e8f\u7684\uff0c\u5f53\u6709\u4e00\u4e2a\u65b0\u5143\u7d20\u63d2\u5165\u65f6\uff0c\u539f\u5148\u7684\u5143\u7d20\u5728 List \u4e2d\u7684\u4f4d\u7f6e\u90fd\u540e\u79fb\u4e86\u4e00\u4f4d \uff0c\u6bd4\u5982\u8bf4\u539f\u6765\u5728\u7b2c 1 \u4f4d\u7684\u5143\u7d20\u73b0\u5728\u6392\u5728\u4e86\u7b2c 2 \u4f4d\u3002\u6240\u4ee5\uff0c\u5bf9\u6bd4\u65b0\u5143\u7d20\u63d2\u5165\u524d\u540e\uff0cList \u76f8\u540c\u4f4d\u7f6e\u4e0a\u7684\u5143\u7d20\u5c31\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u7528 LRANGE \u8bfb\u53d6\u65f6\uff0c\u5c31\u4f1a\u8bfb\u5230\u65e7\u5143\u7d20\u3002 2-2 Sorted Set \u548c List \u76f8\u6bd4\uff0cSorted Set \u5c31\u4e0d\u5b58\u5728\u8fd9\u4e2a\u95ee\u9898\uff0c \u56e0\u4e3a\u5b83\u662f\u6839\u636e\u5143\u7d20\u7684\u5b9e\u9645\u6743\u91cd\u6765\u6392\u5e8f\u548c\u83b7\u53d6\u6570\u636e\u7684\u3002 \u6211\u4eec\u53ef\u4ee5\u6309\u8bc4\u8bba\u65f6\u95f4\u7684\u5148\u540e\u7ed9\u6bcf\u6761\u8bc4\u8bba\u8bbe\u7f6e\u4e00\u4e2a\u6743\u91cd\u503c \uff0c\u7136\u540e\u518d\u628a\u8bc4\u8bba\u4fdd\u5b58\u5230 Sorted Set \u4e2d\u3002Sorted Set \u7684 ZRANGEBYSCORE \u547d\u4ee4\u5c31\u53ef\u4ee5\u6309\u6743\u91cd\u6392\u5e8f\u540e\u8fd4\u56de\u5143\u7d20\u3002 \u8fd9\u6837\u7684\u8bdd\uff0c\u5373\u4f7f\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u9891\u7e41\u66f4\u65b0\uff0c Sorted Set \u4e5f\u80fd\u901a\u8fc7 ZRANGEBYSCORE \u547d\u4ee4\u51c6\u786e\u5730\u83b7\u53d6\u5230\u6309\u5e8f\u6392\u5217\u7684\u6570\u636e\u3002 \u5047\u8bbe\u8d8a\u65b0\u7684\u8bc4\u8bba\u6743\u91cd\u8d8a\u5927\uff0c\u76ee\u524d\u6700\u65b0\u8bc4\u8bba\u7684\u6743\u91cd\u662f N\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0c\u5c31\u53ef\u4ee5\u83b7\u5f97\u6700\u65b0\u7684 10 \u6761\u8bc4\u8bba\uff1a ZRANGEBYSCORE comments N-9 N \u6240\u4ee5\uff0c\u5728\u9762\u5bf9\u9700\u8981\u5c55\u793a\u6700\u65b0\u5217\u8868\u3001\u6392\u884c\u699c\u7b49\u573a\u666f\u65f6\uff0c\u5982\u679c\u6570\u636e\u66f4\u65b0\u9891\u7e41\u6216\u8005\u9700\u8981\u5206\u9875\u663e\u793a\uff0c\u5efa\u8bae\u4f60\u4f18\u5148\u8003\u8651\u4f7f\u7528 Sorted Set\u3002 3\u3001\u4e8c\u503c\u72b6\u6001\u7edf\u8ba1 \u7b2c\u4e09\u4e2a\u573a\u666f: \u7528\u6237\u5728\u624b\u673a App \u4e0a\u7684\u7b7e\u5230\u6253\u5361\u4fe1\u606f\uff1a\u4e00\u5929\u5bf9\u5e94\u4e00\u7cfb\u5217\u7528\u6237\u7684\u7b7e\u5230\u8bb0\u5f55\uff1b 3-1 Bitmap \u8fd9\u91cc\u7684\u4e8c\u503c\u72b6\u6001\u5c31\u662f\u6307\u96c6\u5408\u5143\u7d20\u7684\u53d6\u503c\u5c31\u53ea\u6709 0 \u548c 1 \u4e24\u79cd\u3002 \u5728\u7b7e\u5230\u6253\u5361\u7684\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u53ea\u7528\u8bb0\u5f55\u7b7e\u5230\uff081\uff09\u6216\u672a\u7b7e\u5230\uff080\uff09\uff0c\u6240\u4ee5\u5b83\u5c31\u662f\u975e\u5e38\u5178\u578b\u7684\u4e8c\u503c\u72b6\u6001 \u5230\u7edf\u8ba1\u65f6\uff0c\u6bcf\u4e2a\u7528\u6237\u4e00\u5929\u7684\u7b7e\u5230\u7528 1 \u4e2a bit \u4f4d\u5c31\u80fd\u8868\u793a\uff0c\u4e00\u4e2a\u6708\uff08\u5047\u8bbe\u662f 31 \u5929\uff09\u7684\u7b7e\u5230\u60c5\u51b5\u7528 31 \u4e2a bit \u4f4d\u5c31\u53ef\u4ee5\uff0c\u800c\u4e00\u5e74\u7684\u7b7e\u5230\u4e5f\u53ea\u9700\u8981\u7528 365 \u4e2a bit \u4f4d\uff0c\u6839\u672c\u4e0d\u7528\u592a\u590d\u6742\u7684\u96c6\u5408\u7c7b\u578b\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u9009\u62e9 Bitmap\u3002 \u8fd9\u662f Redis \u63d0\u4f9b\u7684\u6269\u5c55\u6570\u636e\u7c7b\u578b\u3002 Bitmap \u672c\u8eab\u662f\u7528 String \u7c7b\u578b\u4f5c\u4e3a\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5b9e\u73b0\u7684\u4e00\u79cd\u7edf\u8ba1\u4e8c\u503c\u72b6\u6001\u7684\u6570\u636e\u7c7b\u578b\u3002 String \u7c7b\u578b\u662f\u4f1a\u4fdd\u5b58\u4e3a\u4e8c\u8fdb\u5236\u7684\u5b57\u8282\u6570\u7ec4\uff0c\u6240\u4ee5\uff0cRedis \u5c31\u628a\u5b57\u8282\u6570\u7ec4\u7684\u6bcf\u4e2a bit \u4f4d\u5229\u7528\u8d77\u6765\uff0c\u7528\u6765\u8868\u793a\u4e00\u4e2a\u5143\u7d20\u7684\u4e8c\u503c\u72b6\u6001\u3002\u4f60\u53ef\u4ee5\u628a Bitmap \u770b\u4f5c\u662f\u4e00\u4e2a bit \u6570\u7ec4\u3002 Bitmap \u63d0\u4f9b\u4e86 GETBIT/SETBIT \u64cd\u4f5c\uff0c\u4f7f\u7528\u4e00\u4e2a\u504f\u79fb\u503c offset \u5bf9 bit \u6570\u7ec4\u7684\u67d0\u4e00\u4e2a bit \u4f4d\u8fdb\u884c\u8bfb\u548c\u5199\u3002 \u4e0d\u8fc7\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cBitmap \u7684\u504f\u79fb\u91cf\u662f\u4ece 0 \u5f00\u59cb\u7b97\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4 offset \u7684\u6700\u5c0f\u503c\u662f 0\u3002 \u5f53\u4f7f\u7528 SETBIT \u5bf9\u4e00\u4e2a bit \u4f4d\u8fdb\u884c\u5199\u64cd\u4f5c\u65f6\uff0c\u8fd9\u4e2a bit \u4f4d\u4f1a\u88ab\u8bbe\u7f6e\u4e3a 1\u3002Bitmap \u8fd8\u63d0\u4f9b\u4e86 BITCOUNT \u64cd\u4f5c\uff0c\u7528\u6765\u7edf\u8ba1\u8fd9\u4e2a bit \u6570\u7ec4\u4e2d\u6240\u6709\u201c1\u201d\u7684\u4e2a\u6570\u3002 \u5047\u8bbe\u6211\u4eec\u8981\u7edf\u8ba1 ID 3000 \u7684\u7528\u6237\u5728 2020 \u5e74 8 \u6708\u4efd\u7684\u7b7e\u5230\u60c5\u51b5\uff0c\u5c31\u53ef\u4ee5\u6309\u7167\u4e0b\u9762\u7684\u6b65\u9aa4\u8fdb\u884c\u64cd\u4f5c\u3002 \u7b2c\u4e00\u6b65\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u8bb0\u5f55\u8be5\u7528\u6237 8 \u6708 3 \u53f7\u5df2\u7b7e\u5230\u3002 SETBIT uid:sign:3000:202008 2 1 setbit key offset value \u7b2c\u4e8c\u6b65\uff0c\u68c0\u67e5\u8be5\u7528\u6237 8 \u6708 3 \u65e5\u662f\u5426\u7b7e\u5230\u3002 GETBIT uid:sign:3000:202008 2 \u7b2c\u4e09\u6b65\uff0c\u7edf\u8ba1\u8be5\u7528\u6237\u5728 8 \u6708\u4efd\u7684\u7b7e\u5230\u6b21\u6570\u3002 BITCOUNT uid:sign:3000:202008 \u7b2c\u4e09\u6b65\uff0c\u7edf\u8ba1\u8be5\u7528\u6237\u5728 8 \u6708\u4efd\u7684\u7b7e\u5230\u6b21\u6570\u3002 BITCOUNT uid:sign:3000:202008 3-2 BITOP \u5982\u679c\u8bb0\u5f55\u4e86 1 \u4ebf\u4e2a\u7528\u6237 10 \u5929\u7684\u7b7e\u5230\u60c5\u51b5\uff0c\u4f60\u6709\u529e\u6cd5\u7edf\u8ba1\u51fa\u8fd9 10 \u5929\u8fde\u7eed\u7b7e\u5230\u7684\u7528\u6237\u603b\u6570\u5417\uff1f Bitmap \u652f\u6301\u7528 BITOP \u547d\u4ee4\u5bf9\u591a\u4e2a Bitmap \u6309\u4f4d\u505a\u201c\u4e0e\u201d\u201c\u6216\u201d\u201c\u5f02\u6216\u201d\u7684\u64cd\u4f5c\uff0c\u64cd\u4f5c\u7684\u7ed3\u679c\u4f1a\u4fdd\u5b58\u5230\u4e00\u4e2a\u65b0\u7684 Bitmap \u4e2d\u3002 \u6211\u4ee5\u6309\u4f4d\u201c\u4e0e\u201d\u64cd\u4f5c\u4e3a\u4f8b\u6765\u5177\u4f53\u89e3\u91ca\u4e00\u4e0b\u3002\u4ece\u4e0b\u56fe\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\uff0c \u4e09\u4e2a Bitmap bm1\u3001bm2 \u548c bm3\uff0c\u5bf9\u5e94 bit \u4f4d\u505a\u201c\u4e0e\u201d\u64cd\u4f5c\uff0c\u7ed3\u679c\u4fdd\u5b58\u5230\u4e86\u4e00\u4e2a\u65b0\u7684 Bitmap \u4e2d \uff08\u793a\u4f8b\u4e2d\uff0c\u8fd9\u4e2a\u7ed3\u679c Bitmap \u7684 key \u88ab\u8bbe\u4e3a\u201c resmap \u201d\uff09\u3002 \u5728\u7edf\u8ba1 1 \u4ebf\u4e2a\u7528\u6237\u8fde\u7eed 10 \u5929\u7684\u7b7e\u5230\u60c5\u51b5\u65f6\uff0c \u4f60\u53ef\u4ee5\u628a\u6bcf\u5929\u7684\u65e5\u671f\u4f5c\u4e3a key\uff0c\u6bcf\u4e2a key \u5bf9\u5e94\u4e00\u4e2a 1 \u4ebf\u4f4d\u7684 Bitmap\uff0c\u6bcf\u4e00\u4e2a bit \u5bf9\u5e94\u4e00\u4e2a\u7528\u6237\u5f53\u5929\u7684\u7b7e\u5230\u60c5\u51b5 \u3002 \u6211\u4eec\u5bf9 10 \u4e2a Bitmap \u505a\u201c\u4e0e\u201d\u64cd\u4f5c\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u4e5f\u662f\u4e00\u4e2a Bitmap\u3002\u5728\u8fd9\u4e2a Bitmap \u4e2d\uff0c \u53ea\u6709 10 \u5929\u90fd\u7b7e\u5230\u7684\u7528\u6237\u5bf9\u5e94\u7684 bit \u4f4d\u4e0a\u7684\u503c\u624d\u4f1a\u662f 1\u3002\u6700\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 BITCOUNT \u7edf\u8ba1\u4e0b Bitmap \u4e2d\u7684 1 \u7684\u4e2a\u6570\uff0c\u8fd9\u5c31\u662f\u8fde\u7eed\u7b7e\u5230 10 \u5929\u7684\u7528\u6237\u603b\u6570\u4e86 \u8ba1\u7b97\u4e00\u4e0b\u8bb0\u5f55\u4e86 10 \u5929\u7b7e\u5230\u60c5\u51b5\u540e\u7684\u5185\u5b58\u5f00\u9500\u3002 \u6bcf\u5929\u4f7f\u7528 1 \u4e2a 1 \u4ebf\u4f4d\u7684 Bitmap\uff0c\u5927\u7ea6\u5360 12MB \u7684\u5185\u5b58 \uff0810^8/8/1024/1024\uff09 \uff0c10 \u5929\u7684 Bitmap \u7684\u5185\u5b58\u5f00\u9500\u7ea6\u4e3a 120MB\uff0c\u5185\u5b58\u538b\u529b\u4e0d\u7b97\u592a\u5927\u3002 \u4e0d\u8fc7\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u65f6\uff0c\u6700\u597d\u5bf9 Bitmap \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u8ba9 Redis \u81ea\u52a8\u5220\u9664\u4e0d\u518d\u9700\u8981\u7684\u7b7e\u5230\u8bb0\u5f55\uff0c\u4ee5\u8282\u7701\u5185\u5b58\u5f00\u9500\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u53ea\u9700\u8981\u7edf\u8ba1\u6570\u636e\u7684\u4e8c\u503c\u72b6\u6001\uff0c\u4f8b\u5982\u5546\u54c1\u6709\u6ca1\u6709\u3001\u7528\u6237\u5728\u4e0d\u5728\u7b49\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 Bitmap\uff0c\u56e0\u4e3a\u5b83\u53ea\u7528\u4e00\u4e2a bit \u4f4d\u5c31\u80fd\u8868\u793a 0 \u6216 1\u3002 \u5728\u8bb0\u5f55\u6d77\u91cf\u6570\u636e\u65f6\uff0cBitmap \u80fd\u591f\u6709\u6548\u5730\u8282\u7701\u5185\u5b58\u7a7a\u95f4 \u3002 4\u3001\u57fa\u6570\u7edf\u8ba1 \u5e94\u7528\u7f51\u7ad9\u4e0a\u7684\u7f51\u9875\u8bbf\u95ee\u4fe1\u606f\uff1a\u4e00\u4e2a\u7f51\u9875\u5bf9\u5e94\u4e00\u7cfb\u5217\u7684\u8bbf\u95ee\u70b9\u51fb\u3002\u5728\u7f51\u9875\u8bbf\u95ee\u8bb0\u5f55\u4e2d\uff0c\u9700\u8981\u7edf\u8ba1\u72ec\u7acb\u8bbf\u5ba2\uff08Unique Visitor\uff0cUV\uff09\u91cf\u3002 \u57fa\u6570\u7edf\u8ba1\u3002\u57fa\u6570\u7edf\u8ba1\u5c31\u662f\u6307\u7edf\u8ba1\u4e00\u4e2a\u96c6\u5408\u4e2d\u4e0d\u91cd\u590d\u7684\u5143\u7d20\u4e2a\u6570\u3002 4-1 SADD \u7f51\u9875 UV \u7684\u7edf\u8ba1\u6709\u4e2a\u72ec\u7279\u7684\u5730\u65b9\uff0c\u5c31\u662f\u9700\u8981\u53bb\u91cd\uff0c\u4e00\u4e2a\u7528\u6237\u4e00\u5929\u5185\u7684\u591a\u6b21\u8bbf\u95ee\u53ea\u80fd\u7b97\u4f5c\u4e00\u6b21\u3002 \u5728 Redis \u7684\u96c6\u5408\u7c7b\u578b\u4e2d\uff0cSet \u7c7b\u578b\u9ed8\u8ba4\u652f\u6301\u53bb\u91cd\uff0c\u6240\u4ee5\u770b\u5230\u6709\u53bb\u91cd\u9700\u6c42\u65f6\uff0c\u6211\u4eec\u53ef\u80fd\u7b2c\u4e00\u65f6\u95f4\u5c31\u4f1a\u60f3\u5230\u7528 Set \u7c7b\u578b\u3002 \u6709\u4e00\u4e2a\u7528\u6237 user1 \u8bbf\u95ee page1 \u65f6\uff0c\u4f60\u628a\u8fd9\u4e2a\u4fe1\u606f\u52a0\u5230 Set \u4e2d\uff1a SADD page1:uv user1 \u7528\u6237 1 \u518d\u6765\u8bbf\u95ee\u65f6\uff0cSet \u7684\u53bb\u91cd\u529f\u80fd\u5c31\u4fdd\u8bc1\u4e86\u4e0d\u4f1a\u91cd\u590d\u8bb0\u5f55\u7528\u6237 1 \u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u8fd9\u6837\uff0c\u7528\u6237 1 \u5c31\u7b97\u662f\u4e00\u4e2a\u72ec\u7acb\u8bbf\u5ba2\u3002 \u5f53\u4f60\u9700\u8981\u7edf\u8ba1 UV \u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u7528 SCARD \u547d\u4ee4\uff0c\u8fd9\u4e2a\u547d\u4ee4\u4f1a\u8fd4\u56de\u4e00\u4e2a\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u4e2a\u6570\u3002 \u4f46\u662f\uff0c\u5982\u679c page1 \u975e\u5e38\u706b\u7206\uff0cUV \u8fbe\u5230\u4e86\u5343\u4e07\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u4e00\u4e2a Set \u5c31\u8981\u8bb0\u5f55\u5343\u4e07\u4e2a\u7528\u6237 ID\u3002 \u5bf9\u4e8e\u4e00\u4e2a\u641e\u5927\u4fc3\u7684\u7535\u5546\u7f51\u7ad9\u800c\u8a00\uff0c\u8fd9\u6837\u7684\u9875\u9762\u53ef\u80fd\u6709\u6210\u5343\u4e0a\u4e07\u4e2a\uff0c \u5982\u679c\u6bcf\u4e2a\u9875\u9762\u90fd\u7528\u8fd9\u6837\u7684\u4e00\u4e2a Set\uff0c\u5c31\u4f1a\u6d88\u8017\u5f88\u5927\u7684\u5185\u5b58\u7a7a\u95f4\u3002 4-2 Hash => HSET \u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u7528 Hash \u7c7b\u578b\u8bb0\u5f55 UV\u3002 \u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u628a\u7528\u6237 ID \u4f5c\u4e3a Hash \u96c6\u5408\u7684 key\uff0c\u5f53\u7528\u6237\u8bbf\u95ee\u9875\u9762\u65f6\uff0c\u5c31\u7528 HSET \u547d\u4ee4\uff08\u7528\u4e8e\u8bbe\u7f6e Hash \u96c6\u5408\u5143\u7d20\u7684\u503c\uff09\uff0c\u5bf9\u8fd9\u4e2a\u7528\u6237 ID \u8bb0\u5f55\u4e00\u4e2a\u503c\u201c1\u201d\uff0c\u8868\u793a\u4e00\u4e2a\u72ec\u7acb\u8bbf\u5ba2\uff0c\u7528\u6237 1 \u8bbf\u95ee page1 \u540e\uff0c\u6211\u4eec\u5c31\u8bb0\u5f55\u4e3a 1 \u4e2a\u72ec\u7acb\u8bbf\u5ba2\uff0c\u5982\u4e0b\u6240\u793a\uff1a HSET page1:uv user1 1 \u5373\u4f7f\u7528\u6237 1 \u591a\u6b21\u8bbf\u95ee\u9875\u9762\uff0c\u91cd\u590d\u6267\u884c\u8fd9\u4e2a HSET \u547d\u4ee4\uff0c\u4e5f\u53ea\u4f1a\u628a user1 \u7684\u503c\u8bbe\u7f6e\u4e3a 1\uff0c\u4ecd\u7136\u53ea\u8bb0\u4e3a 1 \u4e2a\u72ec\u7acb\u8bbf\u5ba2\u3002 \u5f53\u8981\u7edf\u8ba1 UV \u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 HLEN \u547d\u4ee4\u7edf\u8ba1 Hash \u96c6\u5408\u4e2d\u7684\u6240\u6709\u5143\u7d20\u4e2a\u6570\u3002 \u4f46\u662f\uff0c\u548c Set \u7c7b\u578b\u76f8\u4f3c\uff0c\u5f53\u9875\u9762\u5f88\u591a\u65f6\uff0cHash \u7c7b\u578b\u4e5f\u4f1a\u6d88\u8017\u5f88\u5927\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u90a3\u4e48\uff0c\u6709\u4ec0\u4e48\u529e\u6cd5\u65e2\u80fd\u5b8c\u6210\u7edf\u8ba1\uff0c\u8fd8\u80fd\u8282\u7701\u5185\u5b58\u5417\uff1f \u5c31\u8981\u7528\u5230 Redis \u63d0\u4f9b\u7684 HyperLogLog \u4e86 HyperLogLog \u662f\u4e00\u79cd\u7528\u4e8e\u7edf\u8ba1\u57fa\u6570\u7684\u6570\u636e\u96c6\u5408\u7c7b\u578b\uff0c\u5b83\u7684\u6700\u5927\u4f18\u52bf\u5c31\u5728\u4e8e\uff0c\u5f53\u96c6\u5408\u5143\u7d20\u6570\u91cf\u975e\u5e38\u591a\u65f6\uff0c\u5b83\u8ba1\u7b97\u57fa\u6570\u6240\u9700\u7684\u7a7a\u95f4\u603b\u662f\u56fa\u5b9a\u7684\uff0c\u800c\u4e14\u8fd8\u5f88\u5c0f\u3002 \u5728 Redis \u4e2d\uff0c\u6bcf\u4e2a HyperLogLog \u53ea\u9700\u8981\u82b1\u8d39 12 KB \u5185\u5b58\uff0c\u5c31\u53ef\u4ee5\u8ba1\u7b97\u63a5\u8fd1 2^64 \u4e2a\u5143\u7d20\u7684\u57fa\u6570\u3002 \u4f60\u770b\uff0c\u548c\u5143\u7d20\u8d8a\u591a\u5c31\u8d8a\u8017\u8d39\u5185\u5b58\u7684 Set \u548c Hash \u7c7b\u578b\u76f8\u6bd4\uff0cHyperLogLog \u5c31\u975e\u5e38\u8282\u7701\u7a7a\u95f4\u3002 \u5728\u7edf\u8ba1 UV \u65f6\uff0c\u4f60\u53ef\u4ee5\u7528 PFADD \u547d\u4ee4\uff08\u7528\u4e8e\u5411 HyperLogLog \u4e2d\u6dfb\u52a0\u65b0\u5143\u7d20\uff09\u628a\u8bbf\u95ee\u9875\u9762\u7684\u6bcf\u4e2a\u7528\u6237\u90fd\u6dfb\u52a0\u5230 HyperLogLog \u4e2d\u3002 PFADD page1:uv user1 user2 user3 user4 user5 \u5c31\u53ef\u4ee5\u7528 PFCOUNT \u547d\u4ee4\u76f4\u63a5\u83b7\u5f97 page1 \u7684 UV \u503c\u4e86\uff0c\u8fd9\u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\u5c31\u662f\u8fd4\u56de HyperLogLog \u7684\u7edf\u8ba1\u7ed3\u679c\u3002 PFCOUNT page1:uv HyperLogLog \u7684\u7edf\u8ba1\u89c4\u5219\u662f\u57fa\u4e8e\u6982\u7387\u5b8c\u6210\u7684\uff0c\u6240\u4ee5\u5b83\u7ed9\u51fa\u7684\u7edf\u8ba1\u7ed3\u679c\u662f\u6709\u4e00\u5b9a\u8bef\u5dee\u7684\uff0c\u6807\u51c6\u8bef\u7b97\u7387\u662f 0.81%\u3002 \u8fd9\u4e5f\u5c31\u610f\u5473\u7740\uff0c\u4f60\u4f7f\u7528 HyperLogLog \u7edf\u8ba1\u7684 UV \u662f 100 \u4e07\uff0c\u4f46\u5b9e\u9645\u7684 UV \u53ef\u80fd\u662f 101 \u4e07\u3002\u867d\u7136\u8bef\u5dee\u7387\u4e0d\u7b97\u5927\uff0c\u4f46\u662f\uff0c\u5982\u679c\u4f60\u9700\u8981\u7cbe\u786e\u7edf\u8ba1\u7ed3\u679c\u7684\u8bdd\uff0c\u6700\u597d\u8fd8\u662f\u7ee7\u7eed\u7528 Set \u6216 Hash \u7c7b\u578b\u3002 5\u3001\u672c\u8282\u5c0f\u7ed3 Set \u548c Sorted Set \u90fd\u652f\u6301\u591a\u79cd\u805a\u5408\u7edf\u8ba1\uff0c\u4e0d\u8fc7\uff0c\u5bf9\u4e8e\u5dee\u96c6\u8ba1\u7b97\u6765\u8bf4\uff0c\u53ea\u6709 Set \u652f\u6301\u3002Bitmap \u4e5f\u80fd\u505a\u591a\u4e2a Bitmap \u95f4\u7684\u805a\u5408\u8ba1\u7b97\uff0c\u5305\u62ec\u4e0e\u3001\u6216\u548c\u5f02\u6216\u64cd\u4f5c\u3002 \u5f53\u9700\u8981\u8fdb\u884c\u6392\u5e8f\u7edf\u8ba1\u65f6 \uff0cList \u4e2d\u7684\u5143\u7d20\u867d\u7136\u6709\u5e8f\uff0c\u4f46\u662f\u4e00\u65e6\u6709\u65b0\u5143\u7d20\u63d2\u5165\uff0c\u539f\u6765\u7684\u5143\u7d20\u5728 List \u4e2d\u7684\u4f4d\u7f6e\u5c31\u4f1a\u79fb\u52a8\uff0c\u90a3\u4e48\uff0c\u6309\u4f4d\u7f6e\u8bfb\u53d6\u7684\u6392\u5e8f\u7ed3\u679c\u53ef\u80fd\u5c31\u4e0d\u51c6\u786e\u4e86\u3002\u800c Sorted Set \u672c\u8eab\u662f\u6309\u7167\u96c6\u5408\u5143\u7d20\u7684\u6743\u91cd\u6392\u5e8f\uff0c\u53ef\u4ee5\u51c6\u786e\u5730\u6309\u5e8f\u83b7\u53d6\u7ed3\u679c\uff0c\u6240\u4ee5\u5efa\u8bae\u4f60\u4f18\u5148\u4f7f\u7528\u5b83\u3002 \u8bb0\u5f55\u7684\u6570\u636e\u53ea\u6709 0 \u548c 1 \u4e24\u4e2a\u503c\u7684\u72b6\u6001\uff0cBitmap \u4f1a\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\uff0c\u8fd9\u4e3b\u8981\u5f52\u529f\u4e8e Bitmap \u5bf9\u4e8e\u4e00\u4e2a\u6570\u636e\u53ea\u7528 1 \u4e2a bit \u8bb0\u5f55\uff0c\u53ef\u4ee5\u8282\u7701\u5185\u5b58\u3002 \u5bf9\u4e8e\u57fa\u6570\u7edf\u8ba1\u6765\u8bf4\uff0c\u5982\u679c\u96c6\u5408\u5143\u7d20\u91cf\u8fbe\u5230\u4ebf\u7ea7\u522b\u800c\u4e14\u4e0d\u9700\u8981\u7cbe\u786e\u7edf\u8ba1\u65f6\uff0c\u6211\u5efa\u8bae\u4f60\u4f7f\u7528 HyperLogLog\u3002 \u91cd\u70b9\u53ca\u4eae\u70b9 \u65e5\u5e38\u7684\u7edf\u8ba1\u9700\u6c42\u53ef\u4ee5\u5206\u4e3a\u56db\u7c7b\uff1a\u805a\u5408\uff0c\u6392\u5e8f\uff0c\u4e8c\u503c\u72b6\u6001\uff0c\u57fa\u6570\uff0c\u9009\u7528\u9002\u5408\u7684\u6570\u636e\u7c7b\u578b\u53ef\u4ee5\u5b9e\u73b0\u5373\u5feb\u901f\u53c8\u8282\u7701\u5185\u5b58 \u805a\u5408\u7edf\u8ba1\uff0c\u53ef\u4ee5\u9009\u7528Set\u7c7b\u578b\u5b8c\u6210\uff0c\u4f46Set\u7684\u5dee\uff0c\u5e76\uff0c\u4ea4\u96c6\u64cd\u4f5c\u590d\u6742\u5ea6\u9ad8\uff0c\u5728\u6570\u636e\u91cf\u5927\u7684\u65f6\u5019\u4f1a\u963b\u585e\u4e3b\u8fdb\u7a0b \u6392\u5e8f\u7edf\u8ba1\uff0c\u53ef\u4ee5\u9009\u7528List\u548cSorted Set \u4e8c\u503c\u72b6\u6001\u7edf\u8ba1\uff1aBitmap\u672c\u8eab\u662f\u7528String\u7c7b\u578b\u4f5c\u4e3a\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5b9e\u73b0\uff0cString\u7c7b\u578b\u4f1a\u4fdd\u5b58\u4e3a\u4e8c\u8fdb\u5236\u5b57\u8282\u6570\u7ec4\uff0c\u6240\u4ee5\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2abit\u6570\u7ec4 \u57fa\u6570\u7edf\u8ba1\uff1aHyperLogLog ,\u8ba1\u7b97\u57fa\u6570\u6240\u9700\u7a7a\u95f4\u603b\u662f\u56fa\u5b9a\u7684\uff0c\u800c\u4e14\u5f88\u5c0f\u3002\u4f46\u8981\u6ce8\u610f\uff0cHyperLogLog\u662f\u7edf\u8ba1\u89c4\u5219\u662f\u57fa\u4e8e\u6982\u7387\u5b8c\u6210\u7684\uff0c\u4e0d\u662f\u975e\u5e38\u51c6\u786e 5-2 \u672c\u8282\u4e00\u95ee 4 \u79cd\u5178\u578b\u7684\u7edf\u8ba1\u6a21\u5f0f\uff0c\u4ee5\u53ca\u5404\u79cd\u96c6\u5408\u7c7b\u578b\u7684\u652f\u6301\u60c5\u51b5\u548c\u4f18\u7f3a\u70b9","title":"\u7b2c\u4e8c\u8282 Redis\u6709\u90a3\u4e9b\u6570\u636e\u7ed3\u6784\u9002\u5408\u505a\u7edf\u8ba1"},{"location":"chap3/2redis_sets/#redis","text":"\u5728 Web \u548c\u79fb\u52a8\u5e94\u7528\u7684\u4e1a\u52a1\u573a\u666f\u4e2d\uff0c\u7ecf\u5e38\u9700\u8981\u4fdd\u5b58\u8fd9\u6837\u4e00\u79cd\u4fe1\u606f\uff1a \u4e00\u4e2a key \u5bf9\u5e94\u4e86\u4e00\u4e2a\u6570\u636e\u96c6\u5408 \u624b\u673a App \u4e2d\u7684\u6bcf\u5929\u7684\u7528\u6237\u767b\u5f55\u4fe1\u606f\uff1a\u4e00\u5929\u5bf9\u5e94\u4e00\u7cfb\u5217\u7528\u6237 ID \u6216\u79fb\u52a8\u8bbe\u5907 ID\uff1b \u7535\u5546\u7f51\u7ad9\u4e0a\u5546\u54c1\u7684\u7528\u6237\u8bc4\u8bba\u5217\u8868\uff1a\u4e00\u4e2a\u5546\u54c1\u5bf9\u5e94\u4e86\u4e00\u7cfb\u5217\u7684\u8bc4\u8bba\uff1b \u7528\u6237\u5728\u624b\u673a App \u4e0a\u7684\u7b7e\u5230\u6253\u5361\u4fe1\u606f\uff1a\u4e00\u5929\u5bf9\u5e94\u4e00\u7cfb\u5217\u7528\u6237\u7684\u7b7e\u5230\u8bb0\u5f55\uff1b \u5e94\u7528\u7f51\u7ad9\u4e0a\u7684\u7f51\u9875\u8bbf\u95ee\u4fe1\u606f\uff1a\u4e00\u4e2a\u7f51\u9875\u5bf9\u5e94\u4e00\u7cfb\u5217\u7684\u8bbf\u95ee\u70b9\u51fb\u3002 Redis \u96c6\u5408\u7c7b\u578b\u7684\u7279\u70b9\u5c31\u662f\u4e00\u4e2a\u952e\u5bf9\u5e94\u4e00\u7cfb\u5217\u7684\u6570\u636e\uff0c\u6240\u4ee5\u975e\u5e38\u9002\u5408\u7528\u6765\u5b58\u53d6\u8fd9\u4e9b\u6570\u636e\u3002\u9664\u4e86\u8bb0\u5f55\u4fe1\u606f\uff0c\u6211\u4eec\u5f80\u5f80\u8fd8\u9700\u8981\u5bf9\u96c6\u5408\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u7edf\u8ba1\uff0c\u4f8b\u5982\uff1a \u5728\u79fb\u52a8\u5e94\u7528\u4e2d\uff0c\u9700\u8981\u7edf\u8ba1\u6bcf\u5929\u7684\u65b0\u589e\u7528\u6237\u6570\u548c\u7b2c\u4e8c\u5929\u7684\u7559\u5b58\u7528\u6237\u6570\uff1b \u5728\u7535\u5546\u7f51\u7ad9\u7684\u5546\u54c1\u8bc4\u8bba\u4e2d\uff0c\u9700\u8981\u7edf\u8ba1\u8bc4\u8bba\u5217\u8868\u4e2d\u7684\u6700\u65b0\u8bc4\u8bba\uff1b \u5728\u7b7e\u5230\u6253\u5361\u4e2d\uff0c\u9700\u8981\u7edf\u8ba1\u4e00\u4e2a\u6708\u5185\u8fde\u7eed\u6253\u5361\u7684\u7528\u6237\u6570\uff1b \u5728\u7f51\u9875\u8bbf\u95ee\u8bb0\u5f55\u4e2d\uff0c\u9700\u8981\u7edf\u8ba1\u72ec\u7acb\u8bbf\u5ba2\uff08Unique Visitor\uff0cUV\uff09\u91cf\u3002 \u8981\u60f3\u9009\u62e9\u5408\u9002\u7684\u96c6\u5408\uff0c\u6211\u4eec\u5c31\u5f97\u4e86\u89e3\u5e38\u7528\u7684\u96c6\u5408\u7edf\u8ba1\u6a21\u5f0f\u3002 \u96c6\u5408\u7c7b\u578b\u5e38\u89c1\u7684\u56db\u79cd\u7edf\u8ba1\u6a21\u5f0f\uff0c\u5305\u62ec\u805a\u5408\u7edf\u8ba1\u3001\u6392\u5e8f\u7edf\u8ba1\u3001\u4e8c\u503c\u72b6\u6001\u7edf\u8ba1\u548c\u57fa\u6570\u7edf\u8ba1\u3002","title":"\u7b2c\u4e8c\u8282 Redis\u6709\u90a3\u4e9b\u6570\u636e\u7ed3\u6784\u9002\u5408\u505a\u7edf\u8ba1"},{"location":"chap3/2redis_sets/#1","text":"\u6240\u8c13\u7684\u805a\u5408\u7edf\u8ba1\uff0c\u5c31\u662f\u6307\u7edf\u8ba1\u591a\u4e2a\u96c6\u5408\u5143\u7d20\u7684\u805a\u5408\u7ed3\u679c\uff0c\u5305\u62ec\uff1a \u7edf\u8ba1\u591a\u4e2a\u96c6\u5408\u7684\u5171\u6709\u5143\u7d20\uff08\u4ea4\u96c6\u7edf\u8ba1\uff09\uff1b \u628a\u4e24\u4e2a\u96c6\u5408\u76f8\u6bd4\uff0c\u7edf\u8ba1\u5176\u4e2d\u4e00\u4e2a\u96c6\u5408\u72ec\u6709\u7684\u5143\u7d20\uff08\u5dee\u96c6\u7edf\u8ba1\uff09\uff1b \u7edf\u8ba1\u591a\u4e2a\u96c6\u5408\u7684\u6240\u6709\u5143\u7d20\uff08\u5e76\u96c6\u7edf\u8ba1\uff09\u3002 \u7edf\u8ba1\u624b\u673a App \u6bcf\u5929\u7684\u65b0\u589e\u7528\u6237\u6570\u548c\u7b2c\u4e8c\u5929\u7684\u7559\u5b58\u7528\u6237\u6570\uff0c\u6b63\u597d\u5bf9\u5e94\u4e86\u805a\u5408\u7edf\u8ba1\u3002 \u7528\u4e00\u4e2a \u96c6\u5408\u8bb0\u5f55\u6240\u6709\u767b\u5f55\u8fc7 App \u7684\u7528\u6237 ID \u7528\u53e6\u4e00\u4e2a\u96c6\u5408\u8bb0\u5f55\u6bcf\u4e00\u5929\u767b\u5f55\u8fc7 App \u7684\u7528\u6237 ID\u3002 \u767b\u5f55\u8fc7 App \u7684\u7528\u6237 ID\uff1a \u76f4\u63a5\u4f7f\u7528 Set \u7c7b\u578b\uff0c\u628a key \u8bbe\u7f6e\u4e3a user:id \uff0c\u8868\u793a\u8bb0\u5f55\u7684\u662f\u7528\u6237 ID\uff0c value \u5c31\u662f\u4e00\u4e2a Set \u96c6\u5408\uff0c\u91cc\u9762\u662f\u6240\u6709\u767b\u5f55\u8fc7 App \u7684\u7528\u6237 ID\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e2a Set \u53eb \u4f5c\u7d2f\u8ba1\u7528\u6237 Set \uff0c \u7d2f\u8ba1\u7528\u6237 Set \u4e2d\u6ca1\u6709\u65e5\u671f\u4fe1\u606f\uff0c\u6211\u4eec\u662f\u4e0d\u80fd\u76f4\u63a5\u7edf\u8ba1\u6bcf\u5929\u7684\u65b0\u589e\u7528\u6237\u7684 \u3002\u6240\u4ee5\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u628a\u6bcf\u4e00\u5929\u767b\u5f55\u7684\u7528\u6237 ID\uff0c\u8bb0\u5f55\u5230\u4e00\u4e2a\u65b0\u96c6\u5408\u4e2d\uff0c\u6211\u4eec\u628a\u8fd9\u4e2a\u96c6\u5408\u53eb\u4f5c \u6bcf\u65e5\u7528\u6237 Set \uff0c\u5b83\u6709\u4e24\u4e2a\u7279\u70b9\uff1a key \u662f user:id \u4ee5\u53ca\u5f53\u5929\u65e5\u671f\uff0c\u4f8b\u5982 user:id:20200803 \uff1b value \u662f Set \u96c6\u5408\uff0c\u8bb0\u5f55\u5f53\u5929\u767b\u5f55\u7684\u7528\u6237 ID\u3002 \u5728\u7edf\u8ba1\u6bcf\u5929\u7684\u65b0\u589e\u7528\u6237\u65f6\uff0c\u6211\u4eec\u53ea\u7528 \u8ba1\u7b97\u6bcf\u65e5\u7528\u6237 Set \u548c\u7d2f\u8ba1\u7528\u6237 Set \u7684\u5dee\u96c6\u5c31\u884c \u3002 \u5047\u8bbe\u6211\u4eec\u7684\u624b\u673a App \u5728 2020 \u5e74 8 \u6708 3 \u65e5\u4e0a\u7ebf\uff0c\u90a3\u4e48\uff0c8 \u6708 3 \u65e5\u524d\u662f\u6ca1\u6709\u7528\u6237\u7684\u3002 \u6b64\u65f6\uff0c\u7d2f\u8ba1\u7528\u6237 Set \u662f\u7a7a\u96c6\uff0c\u5f53\u5929\u767b\u5f55\u7684\u7528\u6237 ID \u4f1a\u88ab\u8bb0\u5f55\u5230 key \u4e3a user:id:20200803 \u7684 Set \u4e2d\u3002\u6240\u4ee5\uff0c user:id:20200803 \u8fd9\u4e2a Set \u4e2d\u7684\u7528\u6237\u5c31\u662f\u5f53\u5929\u7684\u65b0\u589e\u7528\u6237\u3002 \u7136\u540e\uff0c \u6211\u4eec\u8ba1\u7b97\u7d2f\u8ba1\u7528\u6237 Set \u548c user:id:20200803 Set \u7684\u5e76\u96c6\u7ed3\u679c\uff0c\u7ed3\u679c\u4fdd\u5b58\u5728 user:id \u8fd9\u4e2a\u7d2f\u8ba1\u7528\u6237 Set \u4e2d \uff0c\u5982\u4e0b\u6240\u793a\uff1a \u7edf\u8ba1\u591a\u4e2a\u96c6\u5408\u7684\u6240\u6709\u5143\u7d20\uff08\u5e76\u96c6\u7edf\u8ba1\uff09\u3002 SUNIONSTORE user:id user:id user:id:20200803 \u6b64\u65f6\uff0c user:id \u8fd9\u4e2a\u7d2f\u8ba1\u7528\u6237 Set \u4e2d\u5c31\u6709\u4e86 8 \u6708 3 \u65e5\u7684\u7528\u6237 ID\u3002 \u7b49\u5230 8 \u6708 4 \u65e5\u518d\u7edf\u8ba1\u65f6\uff0c\u6211\u4eec\u628a 8 \u6708 4 \u65e5\u767b\u5f55\u7684\u7528\u6237 ID \u8bb0\u5f55\u5230 user:id:20200804 \u7684 Set \u4e2d \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6267\u884c SDIFFSTORE \u547d\u4ee4\u8ba1\u7b97\u7d2f\u8ba1\u7528\u6237 Set \u548c user:id:20200804 Set \u7684\u5dee\u96c6\uff0c\u7ed3\u679c\u4fdd\u5b58\u5728 key \u4e3a user:new \u7684 Set \u4e2d\uff0c\u5982\u4e0b\u6240\u793a\uff1a \u628a\u4e24\u4e2a\u96c6\u5408\u76f8\u6bd4\uff0c\u7edf\u8ba1\u5176\u4e2d\u4e00\u4e2a\u96c6\u5408\u72ec\u6709\u7684\u5143\u7d20\uff08\u5dee\u96c6\u7edf\u8ba1\uff09\uff1b SDIFFSTORE user:new user:id:20200804 user:id \u4ee5\u770b\u5230\uff0c\u8fd9\u4e2a\u5dee\u96c6\u4e2d\u7684\u7528\u6237 ID \u5728 user:id:20200804 \u7684 Set \u4e2d\u5b58\u5728\uff0c\u4f46\u662f\u4e0d\u5728\u7d2f\u8ba1\u7528\u6237 Set \u4e2d\u3002\u6240\u4ee5\uff0c user:new \u8fd9\u4e2a Set \u4e2d\u8bb0\u5f55\u7684\u5c31\u662f 8 \u6708 4 \u65e5\u7684\u65b0\u589e\u7528\u6237\u3002 \u5f53\u8981\u8ba1\u7b97 8 \u6708 4 \u65e5\u7684\u7559\u5b58\u7528\u6237\u65f6\uff0c\u6211\u4eec\u53ea\u9700\u8981\u518d\u8ba1\u7b97 user:id:20200803 \u548c user:id:20200804 \u4e24\u4e2a Set \u7684\u4ea4\u96c6\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u540c\u65f6\u5728\u8fd9\u4e24\u4e2a\u96c6\u5408\u4e2d\u7684\u7528\u6237 ID \u4e86\uff0c\u8fd9\u4e9b\u5c31\u662f\u5728 8 \u6708 3 \u65e5\u767b\u5f55\uff0c\u5e76\u4e14\u5728 8 \u6708 4 \u65e5\u7559\u5b58\u7684\u7528\u6237\u3002 \u7edf\u8ba1\u591a\u4e2a\u96c6\u5408\u7684\u5171\u6709\u5143\u7d20\uff08\u4ea4\u96c6\u7edf\u8ba1\uff09 \u6267\u884c\u7684\u547d\u4ee4\u5982\u4e0b\uff1a SINTERSTORE user:id:rem user:id:20200803 user:id:20200804 \u5f53\u4f60\u9700\u8981\u5bf9\u591a\u4e2a\u96c6\u5408\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\u65f6\uff0cSet \u7c7b\u578b\u4f1a\u662f\u4e00\u4e2a\u975e\u5e38\u4e0d\u9519\u7684\u9009\u62e9 set\u7c7b\u578b\u9002\u5408\u505a\u805a\u5408\u7edf\u8ba1\uff1a SUNIONSTORE :\u5e76\u96c6 SDIFFSTORE :\u5dee\u96c6 SINTERSTORE :\u4ea4\u96c6 Set \u7684\u5dee\u96c6\u3001\u5e76\u96c6\u548c\u4ea4\u96c6\u7684\u8ba1\u7b97\u590d\u6742\u5ea6\u8f83\u9ad8\uff0c\u5728\u6570\u636e\u91cf\u8f83\u5927\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u76f4\u63a5\u6267\u884c\u8fd9\u4e9b\u8ba1\u7b97\uff0c\u4f1a\u5bfc\u81f4 Redis \u5b9e\u4f8b\u963b\u585e \u5efa\u8bae\uff1a \u4f60\u53ef\u4ee5\u4ece\u4e3b\u4ece\u96c6\u7fa4\u4e2d\u9009\u62e9\u4e00\u4e2a\u4ece\u5e93\uff0c\u8ba9\u5b83\u4e13\u95e8\u8d1f\u8d23\u805a\u5408\u8ba1\u7b97\uff0c\u6216\u8005\u662f\u628a\u6570\u636e\u8bfb\u53d6\u5230\u5ba2\u6237\u7aef\uff0c\u5728\u5ba2\u6237\u7aef\u6765\u5b8c\u6210\u805a\u5408\u7edf\u8ba1\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u89c4\u907f\u963b\u585e\u4e3b\u5e93\u5b9e\u4f8b\u548c\u5176\u4ed6\u4ece\u5e93\u5b9e\u4f8b\u7684\u98ce\u9669\u4e86 \u3002","title":"1\u3001\u805a\u5408\u7edf\u8ba1"},{"location":"chap3/2redis_sets/#2","text":"\u4ee5\u5728\u7535\u5546\u7f51\u7ad9\u4e0a\u63d0\u4f9b\u6700\u65b0\u8bc4\u8bba \u5217\u8868\u7684\u573a\u666f\u4e3a\u4f8b\u5e94\u5bf9\u96c6\u5408 \u5143\u7d20\u6392\u5e8f\u9700\u6c42\u7684\u65b9\u6cd5 \u3002 \u6700\u65b0\u8bc4\u8bba\u5217\u8868\u5305\u542b\u4e86\u6240\u6709\u8bc4\u8bba\u4e2d\u7684\u6700\u65b0\u7559\u8a00\uff0c \u8fd9\u5c31\u8981\u6c42\u96c6\u5408\u7c7b\u578b\u80fd\u5bf9\u5143\u7d20\u4fdd\u5e8f \uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u96c6\u5408 \u4e2d\u7684\u5143\u7d20\u53ef\u4ee5\u6309\u5e8f\u6392\u5217\uff0c\u8fd9\u79cd\u5bf9\u5143\u7d20\u4fdd\u5e8f\u7684\u96c6\u5408\u7c7b\u578b\u53eb\u4f5c\u6709\u5e8f\u96c6\u5408 \u3002 \u5728 Redis \u5e38\u7528\u7684 4 \u4e2a\u96c6\u5408\u7c7b\u578b\u4e2d\uff08List\u3001Hash\u3001Set\u3001Sorted Set\uff09\uff0cList \u548c Sorted Set \u5c31\u5c5e\u4e8e\u6709\u5e8f\u96c6\u5408\u3002 List\u662f\u6309\u7167\u653e\u5165\u7684\u987a\u5e8f\u6392\u5e8f\uff0cSorted Set\u6839\u636e\u5143\u7d20\u7684\u6743\u91cd\u8fdb\u884c\u6392\u5e8f\u3002 List \u662f\u6309\u7167\u5143\u7d20\u8fdb\u5165 List \u7684\u987a\u5e8f\u8fdb\u884c\u6392\u5e8f\u7684\uff0c\u800c Sorted Set \u53ef\u4ee5\u6839\u636e\u5143\u7d20\u7684\u6743\u91cd\u6765\u6392\u5e8f\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u6765\u51b3\u5b9a\u6bcf\u4e2a\u5143\u7d20\u7684\u6743\u91cd\u503c\u3002 \u6211\u4eec\u53ef\u4ee5\u6839\u636e\u5143\u7d20\u63d2\u5165 Sorted Set \u7684\u65f6\u95f4\u786e\u5b9a\u6743\u91cd\u503c\uff0c\u5148\u63d2\u5165\u7684\u5143\u7d20\u6743\u91cd\u5c0f\uff0c\u540e\u63d2\u5165\u7684\u5143\u7d20\u6743\u91cd\u5927\u3002","title":"2\u3001\u6392\u5e8f\u7edf\u8ba1"},{"location":"chap3/2redis_sets/#2-1-list","text":"\u6bcf\u4e2a\u5546\u54c1\u5bf9\u5e94\u4e00\u4e2a List\uff0c\u8fd9\u4e2a List \u5305\u542b\u4e86\u5bf9\u8fd9\u4e2a\u5546\u54c1\u7684\u6240\u6709\u8bc4\u8bba\uff0c\u800c\u4e14\u4f1a\u6309\u7167\u8bc4\u8bba\u65f6\u95f4\u4fdd\u5b58\u8fd9\u4e9b\u8bc4\u8bba\uff0c\u6bcf\u6765\u4e00\u4e2a\u65b0\u8bc4\u8bba\uff0c\u5c31\u7528 LPUSH \u547d\u4ee4\u628a\u5b83\u63d2\u5165 List \u7684\u961f\u5934\u3002 \u5728\u53ea\u6709\u4e00\u9875\u8bc4\u8bba\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u6e05\u6670\u5730\u770b\u5230\u6700\u65b0\u7684\u8bc4\u8bba\uff0c \u4f46\u662f\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u7f51\u7ad9\u4e00\u822c\u4f1a\u5206\u9875\u663e\u793a\u6700\u65b0\u7684\u8bc4\u8bba\u5217\u8868\uff0c\u4e00\u65e6\u6d89\u53ca\u5230\u5206\u9875\u64cd\u4f5c\uff0cList \u5c31\u53ef\u80fd\u4f1a\u51fa\u73b0\u95ee\u9898\u4e86 \u3002 \u5047\u8bbe\u5f53\u524d\u7684\u8bc4\u8bba List \u662f{A, B, C, D, E, F}\uff08\u5176\u4e2d\uff0cA \u662f\u6700\u65b0\u7684\u8bc4\u8bba\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0cF \u662f\u6700\u65e9\u7684\u8bc4\u8bba\uff09\uff0c\u5728\u5c55\u793a\u7b2c\u4e00\u9875\u7684 3 \u4e2a\u8bc4\u8bba\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5f97\u5230\u6700\u65b0\u7684\u4e09\u6761\u8bc4\u8bba A\u3001B\u3001C\uff1a LRANGE product1 0 2 1) \"A\" 2) \"B\" 3) \"C\" \u7136\u540e\uff0c\u518d\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u83b7\u53d6\u7b2c\u4e8c\u9875\u7684 3 \u4e2a\u8bc4\u8bba\uff0c\u4e5f\u5c31\u662f D\u3001E\u3001F\u3002 LRANGE product1 3 5 1) \"D\" 2) \"E\" 3) \"F\" \u4f46\u662f\uff0c\u5982\u679c\u5728\u5c55\u793a\u7b2c\u4e8c\u9875\u524d\uff0c\u53c8\u4ea7\u751f\u4e86\u4e00\u4e2a\u65b0\u8bc4\u8bba G\uff0c \u8bc4\u8bba G \u5c31\u4f1a\u88ab LPUSH \u547d\u4ee4\u63d2\u5165\u5230\u8bc4\u8bba List \u7684\u961f\u5934\uff0c\u8bc4\u8bba List \u5c31\u53d8\u6210\u4e86 {G, A, B, C, D, E, F} \u3002 \u6b64\u65f6\uff0c\u518d\u7528\u521a\u624d\u7684\u547d\u4ee4\u83b7\u53d6\u7b2c\u4e8c\u9875\u8bc4\u8bba\u65f6\uff0c\u5c31\u4f1a\u53d1\u73b0\uff0c\u8bc4\u8bba C \u53c8\u88ab\u5c55\u793a\u51fa\u6765\u4e86\uff0c\u4e5f\u5c31\u662f C\u3001D\u3001E\u3002 LRANGE product1 3 5 1) \"C\" 2) \"D\" 3) \"E\" \u4e4b\u6240\u4ee5\u4f1a\u8fd9\u6837\uff0c\u5173\u952e\u539f\u56e0\u5c31\u5728\u4e8e\uff0c List \u662f\u901a\u8fc7\u5143\u7d20\u5728 List \u4e2d\u7684\u4f4d\u7f6e\u6765\u6392\u5e8f\u7684\uff0c\u5f53\u6709\u4e00\u4e2a\u65b0\u5143\u7d20\u63d2\u5165\u65f6\uff0c\u539f\u5148\u7684\u5143\u7d20\u5728 List \u4e2d\u7684\u4f4d\u7f6e\u90fd\u540e\u79fb\u4e86\u4e00\u4f4d \uff0c\u6bd4\u5982\u8bf4\u539f\u6765\u5728\u7b2c 1 \u4f4d\u7684\u5143\u7d20\u73b0\u5728\u6392\u5728\u4e86\u7b2c 2 \u4f4d\u3002\u6240\u4ee5\uff0c\u5bf9\u6bd4\u65b0\u5143\u7d20\u63d2\u5165\u524d\u540e\uff0cList \u76f8\u540c\u4f4d\u7f6e\u4e0a\u7684\u5143\u7d20\u5c31\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u7528 LRANGE \u8bfb\u53d6\u65f6\uff0c\u5c31\u4f1a\u8bfb\u5230\u65e7\u5143\u7d20\u3002","title":"2-1 List"},{"location":"chap3/2redis_sets/#2-2-sorted-set","text":"\u548c List \u76f8\u6bd4\uff0cSorted Set \u5c31\u4e0d\u5b58\u5728\u8fd9\u4e2a\u95ee\u9898\uff0c \u56e0\u4e3a\u5b83\u662f\u6839\u636e\u5143\u7d20\u7684\u5b9e\u9645\u6743\u91cd\u6765\u6392\u5e8f\u548c\u83b7\u53d6\u6570\u636e\u7684\u3002 \u6211\u4eec\u53ef\u4ee5\u6309\u8bc4\u8bba\u65f6\u95f4\u7684\u5148\u540e\u7ed9\u6bcf\u6761\u8bc4\u8bba\u8bbe\u7f6e\u4e00\u4e2a\u6743\u91cd\u503c \uff0c\u7136\u540e\u518d\u628a\u8bc4\u8bba\u4fdd\u5b58\u5230 Sorted Set \u4e2d\u3002Sorted Set \u7684 ZRANGEBYSCORE \u547d\u4ee4\u5c31\u53ef\u4ee5\u6309\u6743\u91cd\u6392\u5e8f\u540e\u8fd4\u56de\u5143\u7d20\u3002 \u8fd9\u6837\u7684\u8bdd\uff0c\u5373\u4f7f\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u9891\u7e41\u66f4\u65b0\uff0c Sorted Set \u4e5f\u80fd\u901a\u8fc7 ZRANGEBYSCORE \u547d\u4ee4\u51c6\u786e\u5730\u83b7\u53d6\u5230\u6309\u5e8f\u6392\u5217\u7684\u6570\u636e\u3002 \u5047\u8bbe\u8d8a\u65b0\u7684\u8bc4\u8bba\u6743\u91cd\u8d8a\u5927\uff0c\u76ee\u524d\u6700\u65b0\u8bc4\u8bba\u7684\u6743\u91cd\u662f N\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0c\u5c31\u53ef\u4ee5\u83b7\u5f97\u6700\u65b0\u7684 10 \u6761\u8bc4\u8bba\uff1a ZRANGEBYSCORE comments N-9 N \u6240\u4ee5\uff0c\u5728\u9762\u5bf9\u9700\u8981\u5c55\u793a\u6700\u65b0\u5217\u8868\u3001\u6392\u884c\u699c\u7b49\u573a\u666f\u65f6\uff0c\u5982\u679c\u6570\u636e\u66f4\u65b0\u9891\u7e41\u6216\u8005\u9700\u8981\u5206\u9875\u663e\u793a\uff0c\u5efa\u8bae\u4f60\u4f18\u5148\u8003\u8651\u4f7f\u7528 Sorted Set\u3002","title":"2-2 Sorted Set"},{"location":"chap3/2redis_sets/#3","text":"\u7b2c\u4e09\u4e2a\u573a\u666f: \u7528\u6237\u5728\u624b\u673a App \u4e0a\u7684\u7b7e\u5230\u6253\u5361\u4fe1\u606f\uff1a\u4e00\u5929\u5bf9\u5e94\u4e00\u7cfb\u5217\u7528\u6237\u7684\u7b7e\u5230\u8bb0\u5f55\uff1b","title":"3\u3001\u4e8c\u503c\u72b6\u6001\u7edf\u8ba1"},{"location":"chap3/2redis_sets/#3-1-bitmap","text":"\u8fd9\u91cc\u7684\u4e8c\u503c\u72b6\u6001\u5c31\u662f\u6307\u96c6\u5408\u5143\u7d20\u7684\u53d6\u503c\u5c31\u53ea\u6709 0 \u548c 1 \u4e24\u79cd\u3002 \u5728\u7b7e\u5230\u6253\u5361\u7684\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u53ea\u7528\u8bb0\u5f55\u7b7e\u5230\uff081\uff09\u6216\u672a\u7b7e\u5230\uff080\uff09\uff0c\u6240\u4ee5\u5b83\u5c31\u662f\u975e\u5e38\u5178\u578b\u7684\u4e8c\u503c\u72b6\u6001 \u5230\u7edf\u8ba1\u65f6\uff0c\u6bcf\u4e2a\u7528\u6237\u4e00\u5929\u7684\u7b7e\u5230\u7528 1 \u4e2a bit \u4f4d\u5c31\u80fd\u8868\u793a\uff0c\u4e00\u4e2a\u6708\uff08\u5047\u8bbe\u662f 31 \u5929\uff09\u7684\u7b7e\u5230\u60c5\u51b5\u7528 31 \u4e2a bit \u4f4d\u5c31\u53ef\u4ee5\uff0c\u800c\u4e00\u5e74\u7684\u7b7e\u5230\u4e5f\u53ea\u9700\u8981\u7528 365 \u4e2a bit \u4f4d\uff0c\u6839\u672c\u4e0d\u7528\u592a\u590d\u6742\u7684\u96c6\u5408\u7c7b\u578b\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u9009\u62e9 Bitmap\u3002 \u8fd9\u662f Redis \u63d0\u4f9b\u7684\u6269\u5c55\u6570\u636e\u7c7b\u578b\u3002 Bitmap \u672c\u8eab\u662f\u7528 String \u7c7b\u578b\u4f5c\u4e3a\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5b9e\u73b0\u7684\u4e00\u79cd\u7edf\u8ba1\u4e8c\u503c\u72b6\u6001\u7684\u6570\u636e\u7c7b\u578b\u3002 String \u7c7b\u578b\u662f\u4f1a\u4fdd\u5b58\u4e3a\u4e8c\u8fdb\u5236\u7684\u5b57\u8282\u6570\u7ec4\uff0c\u6240\u4ee5\uff0cRedis \u5c31\u628a\u5b57\u8282\u6570\u7ec4\u7684\u6bcf\u4e2a bit \u4f4d\u5229\u7528\u8d77\u6765\uff0c\u7528\u6765\u8868\u793a\u4e00\u4e2a\u5143\u7d20\u7684\u4e8c\u503c\u72b6\u6001\u3002\u4f60\u53ef\u4ee5\u628a Bitmap \u770b\u4f5c\u662f\u4e00\u4e2a bit \u6570\u7ec4\u3002 Bitmap \u63d0\u4f9b\u4e86 GETBIT/SETBIT \u64cd\u4f5c\uff0c\u4f7f\u7528\u4e00\u4e2a\u504f\u79fb\u503c offset \u5bf9 bit \u6570\u7ec4\u7684\u67d0\u4e00\u4e2a bit \u4f4d\u8fdb\u884c\u8bfb\u548c\u5199\u3002 \u4e0d\u8fc7\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cBitmap \u7684\u504f\u79fb\u91cf\u662f\u4ece 0 \u5f00\u59cb\u7b97\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4 offset \u7684\u6700\u5c0f\u503c\u662f 0\u3002 \u5f53\u4f7f\u7528 SETBIT \u5bf9\u4e00\u4e2a bit \u4f4d\u8fdb\u884c\u5199\u64cd\u4f5c\u65f6\uff0c\u8fd9\u4e2a bit \u4f4d\u4f1a\u88ab\u8bbe\u7f6e\u4e3a 1\u3002Bitmap \u8fd8\u63d0\u4f9b\u4e86 BITCOUNT \u64cd\u4f5c\uff0c\u7528\u6765\u7edf\u8ba1\u8fd9\u4e2a bit \u6570\u7ec4\u4e2d\u6240\u6709\u201c1\u201d\u7684\u4e2a\u6570\u3002 \u5047\u8bbe\u6211\u4eec\u8981\u7edf\u8ba1 ID 3000 \u7684\u7528\u6237\u5728 2020 \u5e74 8 \u6708\u4efd\u7684\u7b7e\u5230\u60c5\u51b5\uff0c\u5c31\u53ef\u4ee5\u6309\u7167\u4e0b\u9762\u7684\u6b65\u9aa4\u8fdb\u884c\u64cd\u4f5c\u3002 \u7b2c\u4e00\u6b65\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u8bb0\u5f55\u8be5\u7528\u6237 8 \u6708 3 \u53f7\u5df2\u7b7e\u5230\u3002 SETBIT uid:sign:3000:202008 2 1 setbit key offset value \u7b2c\u4e8c\u6b65\uff0c\u68c0\u67e5\u8be5\u7528\u6237 8 \u6708 3 \u65e5\u662f\u5426\u7b7e\u5230\u3002 GETBIT uid:sign:3000:202008 2 \u7b2c\u4e09\u6b65\uff0c\u7edf\u8ba1\u8be5\u7528\u6237\u5728 8 \u6708\u4efd\u7684\u7b7e\u5230\u6b21\u6570\u3002 BITCOUNT uid:sign:3000:202008 \u7b2c\u4e09\u6b65\uff0c\u7edf\u8ba1\u8be5\u7528\u6237\u5728 8 \u6708\u4efd\u7684\u7b7e\u5230\u6b21\u6570\u3002 BITCOUNT uid:sign:3000:202008","title":"3-1 Bitmap"},{"location":"chap3/2redis_sets/#3-2-bitop","text":"\u5982\u679c\u8bb0\u5f55\u4e86 1 \u4ebf\u4e2a\u7528\u6237 10 \u5929\u7684\u7b7e\u5230\u60c5\u51b5\uff0c\u4f60\u6709\u529e\u6cd5\u7edf\u8ba1\u51fa\u8fd9 10 \u5929\u8fde\u7eed\u7b7e\u5230\u7684\u7528\u6237\u603b\u6570\u5417\uff1f Bitmap \u652f\u6301\u7528 BITOP \u547d\u4ee4\u5bf9\u591a\u4e2a Bitmap \u6309\u4f4d\u505a\u201c\u4e0e\u201d\u201c\u6216\u201d\u201c\u5f02\u6216\u201d\u7684\u64cd\u4f5c\uff0c\u64cd\u4f5c\u7684\u7ed3\u679c\u4f1a\u4fdd\u5b58\u5230\u4e00\u4e2a\u65b0\u7684 Bitmap \u4e2d\u3002 \u6211\u4ee5\u6309\u4f4d\u201c\u4e0e\u201d\u64cd\u4f5c\u4e3a\u4f8b\u6765\u5177\u4f53\u89e3\u91ca\u4e00\u4e0b\u3002\u4ece\u4e0b\u56fe\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\uff0c \u4e09\u4e2a Bitmap bm1\u3001bm2 \u548c bm3\uff0c\u5bf9\u5e94 bit \u4f4d\u505a\u201c\u4e0e\u201d\u64cd\u4f5c\uff0c\u7ed3\u679c\u4fdd\u5b58\u5230\u4e86\u4e00\u4e2a\u65b0\u7684 Bitmap \u4e2d \uff08\u793a\u4f8b\u4e2d\uff0c\u8fd9\u4e2a\u7ed3\u679c Bitmap \u7684 key \u88ab\u8bbe\u4e3a\u201c resmap \u201d\uff09\u3002 \u5728\u7edf\u8ba1 1 \u4ebf\u4e2a\u7528\u6237\u8fde\u7eed 10 \u5929\u7684\u7b7e\u5230\u60c5\u51b5\u65f6\uff0c \u4f60\u53ef\u4ee5\u628a\u6bcf\u5929\u7684\u65e5\u671f\u4f5c\u4e3a key\uff0c\u6bcf\u4e2a key \u5bf9\u5e94\u4e00\u4e2a 1 \u4ebf\u4f4d\u7684 Bitmap\uff0c\u6bcf\u4e00\u4e2a bit \u5bf9\u5e94\u4e00\u4e2a\u7528\u6237\u5f53\u5929\u7684\u7b7e\u5230\u60c5\u51b5 \u3002 \u6211\u4eec\u5bf9 10 \u4e2a Bitmap \u505a\u201c\u4e0e\u201d\u64cd\u4f5c\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u4e5f\u662f\u4e00\u4e2a Bitmap\u3002\u5728\u8fd9\u4e2a Bitmap \u4e2d\uff0c \u53ea\u6709 10 \u5929\u90fd\u7b7e\u5230\u7684\u7528\u6237\u5bf9\u5e94\u7684 bit \u4f4d\u4e0a\u7684\u503c\u624d\u4f1a\u662f 1\u3002\u6700\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 BITCOUNT \u7edf\u8ba1\u4e0b Bitmap \u4e2d\u7684 1 \u7684\u4e2a\u6570\uff0c\u8fd9\u5c31\u662f\u8fde\u7eed\u7b7e\u5230 10 \u5929\u7684\u7528\u6237\u603b\u6570\u4e86 \u8ba1\u7b97\u4e00\u4e0b\u8bb0\u5f55\u4e86 10 \u5929\u7b7e\u5230\u60c5\u51b5\u540e\u7684\u5185\u5b58\u5f00\u9500\u3002 \u6bcf\u5929\u4f7f\u7528 1 \u4e2a 1 \u4ebf\u4f4d\u7684 Bitmap\uff0c\u5927\u7ea6\u5360 12MB \u7684\u5185\u5b58 \uff0810^8/8/1024/1024\uff09 \uff0c10 \u5929\u7684 Bitmap \u7684\u5185\u5b58\u5f00\u9500\u7ea6\u4e3a 120MB\uff0c\u5185\u5b58\u538b\u529b\u4e0d\u7b97\u592a\u5927\u3002 \u4e0d\u8fc7\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u65f6\uff0c\u6700\u597d\u5bf9 Bitmap \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u8ba9 Redis \u81ea\u52a8\u5220\u9664\u4e0d\u518d\u9700\u8981\u7684\u7b7e\u5230\u8bb0\u5f55\uff0c\u4ee5\u8282\u7701\u5185\u5b58\u5f00\u9500\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u53ea\u9700\u8981\u7edf\u8ba1\u6570\u636e\u7684\u4e8c\u503c\u72b6\u6001\uff0c\u4f8b\u5982\u5546\u54c1\u6709\u6ca1\u6709\u3001\u7528\u6237\u5728\u4e0d\u5728\u7b49\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 Bitmap\uff0c\u56e0\u4e3a\u5b83\u53ea\u7528\u4e00\u4e2a bit \u4f4d\u5c31\u80fd\u8868\u793a 0 \u6216 1\u3002 \u5728\u8bb0\u5f55\u6d77\u91cf\u6570\u636e\u65f6\uff0cBitmap \u80fd\u591f\u6709\u6548\u5730\u8282\u7701\u5185\u5b58\u7a7a\u95f4 \u3002","title":"3-2 BITOP"},{"location":"chap3/2redis_sets/#4","text":"\u5e94\u7528\u7f51\u7ad9\u4e0a\u7684\u7f51\u9875\u8bbf\u95ee\u4fe1\u606f\uff1a\u4e00\u4e2a\u7f51\u9875\u5bf9\u5e94\u4e00\u7cfb\u5217\u7684\u8bbf\u95ee\u70b9\u51fb\u3002\u5728\u7f51\u9875\u8bbf\u95ee\u8bb0\u5f55\u4e2d\uff0c\u9700\u8981\u7edf\u8ba1\u72ec\u7acb\u8bbf\u5ba2\uff08Unique Visitor\uff0cUV\uff09\u91cf\u3002 \u57fa\u6570\u7edf\u8ba1\u3002\u57fa\u6570\u7edf\u8ba1\u5c31\u662f\u6307\u7edf\u8ba1\u4e00\u4e2a\u96c6\u5408\u4e2d\u4e0d\u91cd\u590d\u7684\u5143\u7d20\u4e2a\u6570\u3002","title":"4\u3001\u57fa\u6570\u7edf\u8ba1"},{"location":"chap3/2redis_sets/#4-1-sadd","text":"\u7f51\u9875 UV \u7684\u7edf\u8ba1\u6709\u4e2a\u72ec\u7279\u7684\u5730\u65b9\uff0c\u5c31\u662f\u9700\u8981\u53bb\u91cd\uff0c\u4e00\u4e2a\u7528\u6237\u4e00\u5929\u5185\u7684\u591a\u6b21\u8bbf\u95ee\u53ea\u80fd\u7b97\u4f5c\u4e00\u6b21\u3002 \u5728 Redis \u7684\u96c6\u5408\u7c7b\u578b\u4e2d\uff0cSet \u7c7b\u578b\u9ed8\u8ba4\u652f\u6301\u53bb\u91cd\uff0c\u6240\u4ee5\u770b\u5230\u6709\u53bb\u91cd\u9700\u6c42\u65f6\uff0c\u6211\u4eec\u53ef\u80fd\u7b2c\u4e00\u65f6\u95f4\u5c31\u4f1a\u60f3\u5230\u7528 Set \u7c7b\u578b\u3002 \u6709\u4e00\u4e2a\u7528\u6237 user1 \u8bbf\u95ee page1 \u65f6\uff0c\u4f60\u628a\u8fd9\u4e2a\u4fe1\u606f\u52a0\u5230 Set \u4e2d\uff1a SADD page1:uv user1 \u7528\u6237 1 \u518d\u6765\u8bbf\u95ee\u65f6\uff0cSet \u7684\u53bb\u91cd\u529f\u80fd\u5c31\u4fdd\u8bc1\u4e86\u4e0d\u4f1a\u91cd\u590d\u8bb0\u5f55\u7528\u6237 1 \u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u8fd9\u6837\uff0c\u7528\u6237 1 \u5c31\u7b97\u662f\u4e00\u4e2a\u72ec\u7acb\u8bbf\u5ba2\u3002 \u5f53\u4f60\u9700\u8981\u7edf\u8ba1 UV \u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u7528 SCARD \u547d\u4ee4\uff0c\u8fd9\u4e2a\u547d\u4ee4\u4f1a\u8fd4\u56de\u4e00\u4e2a\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u4e2a\u6570\u3002 \u4f46\u662f\uff0c\u5982\u679c page1 \u975e\u5e38\u706b\u7206\uff0cUV \u8fbe\u5230\u4e86\u5343\u4e07\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u4e00\u4e2a Set \u5c31\u8981\u8bb0\u5f55\u5343\u4e07\u4e2a\u7528\u6237 ID\u3002 \u5bf9\u4e8e\u4e00\u4e2a\u641e\u5927\u4fc3\u7684\u7535\u5546\u7f51\u7ad9\u800c\u8a00\uff0c\u8fd9\u6837\u7684\u9875\u9762\u53ef\u80fd\u6709\u6210\u5343\u4e0a\u4e07\u4e2a\uff0c \u5982\u679c\u6bcf\u4e2a\u9875\u9762\u90fd\u7528\u8fd9\u6837\u7684\u4e00\u4e2a Set\uff0c\u5c31\u4f1a\u6d88\u8017\u5f88\u5927\u7684\u5185\u5b58\u7a7a\u95f4\u3002","title":"4-1 SADD"},{"location":"chap3/2redis_sets/#4-2-hash-hset","text":"\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u7528 Hash \u7c7b\u578b\u8bb0\u5f55 UV\u3002 \u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u628a\u7528\u6237 ID \u4f5c\u4e3a Hash \u96c6\u5408\u7684 key\uff0c\u5f53\u7528\u6237\u8bbf\u95ee\u9875\u9762\u65f6\uff0c\u5c31\u7528 HSET \u547d\u4ee4\uff08\u7528\u4e8e\u8bbe\u7f6e Hash \u96c6\u5408\u5143\u7d20\u7684\u503c\uff09\uff0c\u5bf9\u8fd9\u4e2a\u7528\u6237 ID \u8bb0\u5f55\u4e00\u4e2a\u503c\u201c1\u201d\uff0c\u8868\u793a\u4e00\u4e2a\u72ec\u7acb\u8bbf\u5ba2\uff0c\u7528\u6237 1 \u8bbf\u95ee page1 \u540e\uff0c\u6211\u4eec\u5c31\u8bb0\u5f55\u4e3a 1 \u4e2a\u72ec\u7acb\u8bbf\u5ba2\uff0c\u5982\u4e0b\u6240\u793a\uff1a HSET page1:uv user1 1 \u5373\u4f7f\u7528\u6237 1 \u591a\u6b21\u8bbf\u95ee\u9875\u9762\uff0c\u91cd\u590d\u6267\u884c\u8fd9\u4e2a HSET \u547d\u4ee4\uff0c\u4e5f\u53ea\u4f1a\u628a user1 \u7684\u503c\u8bbe\u7f6e\u4e3a 1\uff0c\u4ecd\u7136\u53ea\u8bb0\u4e3a 1 \u4e2a\u72ec\u7acb\u8bbf\u5ba2\u3002 \u5f53\u8981\u7edf\u8ba1 UV \u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 HLEN \u547d\u4ee4\u7edf\u8ba1 Hash \u96c6\u5408\u4e2d\u7684\u6240\u6709\u5143\u7d20\u4e2a\u6570\u3002 \u4f46\u662f\uff0c\u548c Set \u7c7b\u578b\u76f8\u4f3c\uff0c\u5f53\u9875\u9762\u5f88\u591a\u65f6\uff0cHash \u7c7b\u578b\u4e5f\u4f1a\u6d88\u8017\u5f88\u5927\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u90a3\u4e48\uff0c\u6709\u4ec0\u4e48\u529e\u6cd5\u65e2\u80fd\u5b8c\u6210\u7edf\u8ba1\uff0c\u8fd8\u80fd\u8282\u7701\u5185\u5b58\u5417\uff1f \u5c31\u8981\u7528\u5230 Redis \u63d0\u4f9b\u7684 HyperLogLog \u4e86 HyperLogLog \u662f\u4e00\u79cd\u7528\u4e8e\u7edf\u8ba1\u57fa\u6570\u7684\u6570\u636e\u96c6\u5408\u7c7b\u578b\uff0c\u5b83\u7684\u6700\u5927\u4f18\u52bf\u5c31\u5728\u4e8e\uff0c\u5f53\u96c6\u5408\u5143\u7d20\u6570\u91cf\u975e\u5e38\u591a\u65f6\uff0c\u5b83\u8ba1\u7b97\u57fa\u6570\u6240\u9700\u7684\u7a7a\u95f4\u603b\u662f\u56fa\u5b9a\u7684\uff0c\u800c\u4e14\u8fd8\u5f88\u5c0f\u3002 \u5728 Redis \u4e2d\uff0c\u6bcf\u4e2a HyperLogLog \u53ea\u9700\u8981\u82b1\u8d39 12 KB \u5185\u5b58\uff0c\u5c31\u53ef\u4ee5\u8ba1\u7b97\u63a5\u8fd1 2^64 \u4e2a\u5143\u7d20\u7684\u57fa\u6570\u3002 \u4f60\u770b\uff0c\u548c\u5143\u7d20\u8d8a\u591a\u5c31\u8d8a\u8017\u8d39\u5185\u5b58\u7684 Set \u548c Hash \u7c7b\u578b\u76f8\u6bd4\uff0cHyperLogLog \u5c31\u975e\u5e38\u8282\u7701\u7a7a\u95f4\u3002 \u5728\u7edf\u8ba1 UV \u65f6\uff0c\u4f60\u53ef\u4ee5\u7528 PFADD \u547d\u4ee4\uff08\u7528\u4e8e\u5411 HyperLogLog \u4e2d\u6dfb\u52a0\u65b0\u5143\u7d20\uff09\u628a\u8bbf\u95ee\u9875\u9762\u7684\u6bcf\u4e2a\u7528\u6237\u90fd\u6dfb\u52a0\u5230 HyperLogLog \u4e2d\u3002 PFADD page1:uv user1 user2 user3 user4 user5 \u5c31\u53ef\u4ee5\u7528 PFCOUNT \u547d\u4ee4\u76f4\u63a5\u83b7\u5f97 page1 \u7684 UV \u503c\u4e86\uff0c\u8fd9\u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\u5c31\u662f\u8fd4\u56de HyperLogLog \u7684\u7edf\u8ba1\u7ed3\u679c\u3002 PFCOUNT page1:uv HyperLogLog \u7684\u7edf\u8ba1\u89c4\u5219\u662f\u57fa\u4e8e\u6982\u7387\u5b8c\u6210\u7684\uff0c\u6240\u4ee5\u5b83\u7ed9\u51fa\u7684\u7edf\u8ba1\u7ed3\u679c\u662f\u6709\u4e00\u5b9a\u8bef\u5dee\u7684\uff0c\u6807\u51c6\u8bef\u7b97\u7387\u662f 0.81%\u3002 \u8fd9\u4e5f\u5c31\u610f\u5473\u7740\uff0c\u4f60\u4f7f\u7528 HyperLogLog \u7edf\u8ba1\u7684 UV \u662f 100 \u4e07\uff0c\u4f46\u5b9e\u9645\u7684 UV \u53ef\u80fd\u662f 101 \u4e07\u3002\u867d\u7136\u8bef\u5dee\u7387\u4e0d\u7b97\u5927\uff0c\u4f46\u662f\uff0c\u5982\u679c\u4f60\u9700\u8981\u7cbe\u786e\u7edf\u8ba1\u7ed3\u679c\u7684\u8bdd\uff0c\u6700\u597d\u8fd8\u662f\u7ee7\u7eed\u7528 Set \u6216 Hash \u7c7b\u578b\u3002","title":"4-2 Hash =&gt; HSET"},{"location":"chap3/2redis_sets/#5","text":"Set \u548c Sorted Set \u90fd\u652f\u6301\u591a\u79cd\u805a\u5408\u7edf\u8ba1\uff0c\u4e0d\u8fc7\uff0c\u5bf9\u4e8e\u5dee\u96c6\u8ba1\u7b97\u6765\u8bf4\uff0c\u53ea\u6709 Set \u652f\u6301\u3002Bitmap \u4e5f\u80fd\u505a\u591a\u4e2a Bitmap \u95f4\u7684\u805a\u5408\u8ba1\u7b97\uff0c\u5305\u62ec\u4e0e\u3001\u6216\u548c\u5f02\u6216\u64cd\u4f5c\u3002 \u5f53\u9700\u8981\u8fdb\u884c\u6392\u5e8f\u7edf\u8ba1\u65f6 \uff0cList \u4e2d\u7684\u5143\u7d20\u867d\u7136\u6709\u5e8f\uff0c\u4f46\u662f\u4e00\u65e6\u6709\u65b0\u5143\u7d20\u63d2\u5165\uff0c\u539f\u6765\u7684\u5143\u7d20\u5728 List \u4e2d\u7684\u4f4d\u7f6e\u5c31\u4f1a\u79fb\u52a8\uff0c\u90a3\u4e48\uff0c\u6309\u4f4d\u7f6e\u8bfb\u53d6\u7684\u6392\u5e8f\u7ed3\u679c\u53ef\u80fd\u5c31\u4e0d\u51c6\u786e\u4e86\u3002\u800c Sorted Set \u672c\u8eab\u662f\u6309\u7167\u96c6\u5408\u5143\u7d20\u7684\u6743\u91cd\u6392\u5e8f\uff0c\u53ef\u4ee5\u51c6\u786e\u5730\u6309\u5e8f\u83b7\u53d6\u7ed3\u679c\uff0c\u6240\u4ee5\u5efa\u8bae\u4f60\u4f18\u5148\u4f7f\u7528\u5b83\u3002 \u8bb0\u5f55\u7684\u6570\u636e\u53ea\u6709 0 \u548c 1 \u4e24\u4e2a\u503c\u7684\u72b6\u6001\uff0cBitmap \u4f1a\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\uff0c\u8fd9\u4e3b\u8981\u5f52\u529f\u4e8e Bitmap \u5bf9\u4e8e\u4e00\u4e2a\u6570\u636e\u53ea\u7528 1 \u4e2a bit \u8bb0\u5f55\uff0c\u53ef\u4ee5\u8282\u7701\u5185\u5b58\u3002 \u5bf9\u4e8e\u57fa\u6570\u7edf\u8ba1\u6765\u8bf4\uff0c\u5982\u679c\u96c6\u5408\u5143\u7d20\u91cf\u8fbe\u5230\u4ebf\u7ea7\u522b\u800c\u4e14\u4e0d\u9700\u8981\u7cbe\u786e\u7edf\u8ba1\u65f6\uff0c\u6211\u5efa\u8bae\u4f60\u4f7f\u7528 HyperLogLog\u3002 \u91cd\u70b9\u53ca\u4eae\u70b9 \u65e5\u5e38\u7684\u7edf\u8ba1\u9700\u6c42\u53ef\u4ee5\u5206\u4e3a\u56db\u7c7b\uff1a\u805a\u5408\uff0c\u6392\u5e8f\uff0c\u4e8c\u503c\u72b6\u6001\uff0c\u57fa\u6570\uff0c\u9009\u7528\u9002\u5408\u7684\u6570\u636e\u7c7b\u578b\u53ef\u4ee5\u5b9e\u73b0\u5373\u5feb\u901f\u53c8\u8282\u7701\u5185\u5b58 \u805a\u5408\u7edf\u8ba1\uff0c\u53ef\u4ee5\u9009\u7528Set\u7c7b\u578b\u5b8c\u6210\uff0c\u4f46Set\u7684\u5dee\uff0c\u5e76\uff0c\u4ea4\u96c6\u64cd\u4f5c\u590d\u6742\u5ea6\u9ad8\uff0c\u5728\u6570\u636e\u91cf\u5927\u7684\u65f6\u5019\u4f1a\u963b\u585e\u4e3b\u8fdb\u7a0b \u6392\u5e8f\u7edf\u8ba1\uff0c\u53ef\u4ee5\u9009\u7528List\u548cSorted Set \u4e8c\u503c\u72b6\u6001\u7edf\u8ba1\uff1aBitmap\u672c\u8eab\u662f\u7528String\u7c7b\u578b\u4f5c\u4e3a\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5b9e\u73b0\uff0cString\u7c7b\u578b\u4f1a\u4fdd\u5b58\u4e3a\u4e8c\u8fdb\u5236\u5b57\u8282\u6570\u7ec4\uff0c\u6240\u4ee5\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2abit\u6570\u7ec4 \u57fa\u6570\u7edf\u8ba1\uff1aHyperLogLog ,\u8ba1\u7b97\u57fa\u6570\u6240\u9700\u7a7a\u95f4\u603b\u662f\u56fa\u5b9a\u7684\uff0c\u800c\u4e14\u5f88\u5c0f\u3002\u4f46\u8981\u6ce8\u610f\uff0cHyperLogLog\u662f\u7edf\u8ba1\u89c4\u5219\u662f\u57fa\u4e8e\u6982\u7387\u5b8c\u6210\u7684\uff0c\u4e0d\u662f\u975e\u5e38\u51c6\u786e","title":"5\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap3/2redis_sets/#5-2","text":"4 \u79cd\u5178\u578b\u7684\u7edf\u8ba1\u6a21\u5f0f\uff0c\u4ee5\u53ca\u5404\u79cd\u96c6\u5408\u7c7b\u578b\u7684\u652f\u6301\u60c5\u51b5\u548c\u4f18\u7f3a\u70b9","title":"5-2 \u672c\u8282\u4e00\u95ee"},{"location":"chap3/3redis_geo/","text":"\u7b2c\u4e09\u8282 GEO\uff0c\u4e00\u79cd\u53ef\u4ee5\u5b9e\u73b0LBS\u670d\u52a1\u7684\u6570\u636e\u7ed3\u6784 \u4e0a\u4e00\u8282\u8bb2\u4e86 5 \u5927\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff1a String\u3001List\u3001Hash\u3001Set \u548c Sorted Set\uff0c\u5b83\u4eec\u53ef\u4ee5\u6ee1\u8db3\u5927\u591a\u6570\u7684\u6570\u636e\u5b58\u50a8\u9700\u6c42\uff0c\u4f46\u662f\u5728\u9762\u5bf9\u6d77\u91cf\u6570\u636e\u7edf\u8ba1\u65f6\uff0c\u5b83\u4eec\u7684\u5185\u5b58\u5f00\u9500\u5f88\u5927 \uff0c\u800c\u4e14\u5bf9\u4e8e\u4e00\u4e9b\u7279\u6b8a\u7684\u573a\u666f\uff0c\u5b83\u4eec\u662f\u65e0\u6cd5\u652f\u6301\u7684\u3002 Redis \u8fd8\u63d0\u4f9b\u4e86 3 \u79cd\u6269\u5c55\u6570\u636e\u7c7b\u578b\uff0c\u5206\u522b\u662f Bitmap\u3001HyperLogLog \u548c GEO 1\u3001\u9762\u5411 LBS \u5e94\u7528\u7684 GEO \u6570\u636e\u7c7b\u578b \u57fa\u4e8e\u4f4d\u7f6e\u4fe1\u606f\u670d\u52a1\uff08Location-Based Service\uff0cLBS\uff09\u7684\u5e94\u7528\u3002LBS \u5e94\u7528\u8bbf\u95ee\u7684\u6570\u636e\u662f\u548c\u4eba\u6216\u7269\u5173\u8054\u7684\u4e00\u7ec4\u7ecf\u7eac\u5ea6\u4fe1\u606f\uff0c\u800c\u4e14\u8981\u80fd\u67e5\u8be2\u76f8\u90bb\u7684\u7ecf\u7eac\u5ea6\u8303\u56f4\uff0cGEO \u5c31\u975e\u5e38\u9002\u5408\u5e94\u7528\u5728 LBS \u670d\u52a1\u7684\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u5b83\u7684\u5e95\u5c42\u7ed3\u6784\u3002 2\u3001GEO \u7684\u5e95\u5c42\u7ed3\u6784 2-1 LBS \u5e94\u7528\u7eac\u5ea6\u7684\u5b58\u53d6\u7279\u70b9 \u4e00\u822c\u6765\u8bf4\uff0c\u5728\u8bbe\u8ba1\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\u7684\u5e95\u5c42\u7ed3\u6784\u65f6\uff0c\u6211\u4eec\u9996\u5148\u9700\u8981\u77e5\u9053\uff0c\u8981\u5904\u7406\u7684\u6570\u636e\u6709\u4ec0\u4e48\u8bbf\u95ee\u7279\u70b9\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u5148\u641e\u6e05\u695a\u4f4d\u7f6e\u4fe1\u606f\u5230\u5e95\u662f\u600e\u4e48\u88ab\u5b58\u53d6\u7684\u3002 \u4ee5\u53eb\u8f66\u670d\u52a1\u4e3a\u4f8b\uff0c\u6765\u5206\u6790\u4e0b LBS \u5e94\u7528\u4e2d\u7ecf\u7eac\u5ea6\u7684\u5b58\u53d6\u7279\u70b9\u3002 \u6bcf\u4e00\u8f86\u7f51\u7ea6\u8f66\u90fd\u6709\u4e00\u4e2a\u7f16\u53f7\uff08\u4f8b\u5982 33\uff09\uff0c\u7f51\u7ea6\u8f66\u9700\u8981\u5c06\u81ea\u5df1\u7684\u7ecf\u5ea6\u4fe1\u606f\uff08\u4f8b\u5982 116.034579\uff09\u548c\u7eac\u5ea6\u4fe1\u606f\uff08\u4f8b\u5982 39.000452 \uff09\u53d1\u7ed9\u53eb\u8f66\u5e94\u7528\u3002 \u7528\u6237\u5728\u53eb\u8f66\u7684\u65f6\u5019\uff0c\u53eb\u8f66\u5e94\u7528\u4f1a\u6839\u636e\u7528\u6237\u7684\u7ecf\u7eac\u5ea6\u4f4d\u7f6e\uff08\u4f8b\u5982\u7ecf\u5ea6 116.054579\uff0c\u7eac\u5ea6 39.030452\uff09\uff0c\u67e5\u627e\u7528\u6237\u7684\u9644\u8fd1\u8f66\u8f86\uff0c\u5e76\u8fdb\u884c\u5339\u914d\u3002 \u7b49\u628a\u4f4d\u7f6e\u76f8\u8fd1\u7684\u7528\u6237\u548c\u8f66\u8f86\u5339\u914d\u4e0a\u4ee5\u540e\uff0c\u53eb\u8f66\u5e94\u7528\u5c31\u4f1a\u6839\u636e\u8f66\u8f86\u7684\u7f16\u53f7\uff0c\u83b7\u53d6\u8f66\u8f86\u7684\u4fe1\u606f\uff0c\u5e76\u8fd4\u56de\u7ed9\u7528\u6237\u3002 \u4e00\u8f86\u8f66\uff08\u6216\u4e00\u4e2a\u7528\u6237\uff09\u5bf9\u5e94\u4e00\u7ec4\u7ecf\u7eac\u5ea6\uff0c\u5e76\u4e14\u968f\u7740\u8f66\uff08\u6216\u7528\u6237\uff09\u7684\u4f4d\u7f6e\u79fb\u52a8\uff0c\u76f8\u5e94\u7684\u7ecf\u7eac\u5ea6\u4e5f\u4f1a\u53d8\u5316\u3002 \u6570\u636e\u8bb0\u5f55\u6a21\u5f0f\u5c5e\u4e8e\u4e00\u4e2a key\uff08\u4f8b\u5982\u8f66 ID\uff09\u5bf9\u5e94\u4e00\u4e2a value\uff08\u4e00\u7ec4\u7ecf\u7eac\u5ea6\uff09\u3002\u5f53\u6709\u5f88\u591a\u8f66\u8f86\u4fe1\u606f\u8981\u4fdd\u5b58\u65f6\uff0c\u5c31\u9700\u8981\u6709\u4e00\u4e2a\u96c6\u5408\u6765\u4fdd\u5b58\u4e00\u7cfb\u5217\u7684 key \u548c value\u3002 Hash \u96c6\u5408\u7c7b\u578b\u53ef\u4ee5\u5feb\u901f\u5b58\u53d6\u4e00\u7cfb\u5217\u7684 key \u548c value \uff0c \u6b63\u597d\u53ef\u4ee5\u7528\u6765\u8bb0\u5f55\u4e00\u7cfb\u5217\u8f66\u8f86 ID \u548c\u7ecf\u7eac\u5ea6\u7684\u5bf9\u5e94\u5173\u7cfb \uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4e0d\u540c\u8f66\u8f86\u7684 ID \u548c\u5b83\u4eec\u5bf9\u5e94\u7684\u7ecf\u7eac\u5ea6\u4fe1\u606f\u5b58\u5728 Hash \u96c6\u5408\u4e2d Hash \u7c7b\u578b\u7684 HSET \u64cd\u4f5c\u547d\u4ee4\uff0c\u4f1a\u6839\u636e key \u6765\u8bbe\u7f6e\u76f8\u5e94\u7684 value \u503c \uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u5b83\u6765\u5feb\u901f\u5730\u66f4\u65b0\u8f66\u8f86\u53d8\u5316\u7684\u7ecf\u7eac\u5ea6\u4fe1\u606f\u3002 2-2 Sorted Set \u7c7b\u578b Sorted Set \u7c7b\u578b\u4e5f\u652f\u6301\u4e00\u4e2a key \u5bf9\u5e94\u4e00\u4e2a value \u7684\u8bb0\u5f55\u6a21\u5f0f\uff0c\u5176\u4e2d\uff0ckey \u5c31\u662f Sorted Set \u4e2d\u7684\u5143\u7d20\uff0c\u800c value \u5219\u662f\u5143\u7d20\u7684\u6743\u91cd\u5206\u6570\u3002\u66f4\u91cd\u8981\u7684\u662f\uff0cSorted Set \u53ef\u4ee5\u6839\u636e\u5143\u7d20\u7684\u6743\u91cd\u5206\u6570\u6392\u5e8f\uff0c\u652f\u6301\u8303\u56f4\u67e5\u8be2\u3002 \u5b9e\u9645\u4e0a\uff0cGEO \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5c31\u662f\u7528 Sorted Set \u6765\u5b9e\u73b0\u7684 \u7528 Sorted Set \u6765\u4fdd\u5b58\u8f66\u8f86\u7684\u7ecf\u7eac\u5ea6\u4fe1\u606f\u65f6\uff0cSorted Set \u7684\u5143\u7d20\u662f\u8f66\u8f86 ID\uff0c\u5143\u7d20\u7684\u6743\u91cd\u5206\u6570\u662f\u7ecf\u7eac\u5ea6\u4fe1\u606f\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a Sorted Set \u5143\u7d20\u7684\u6743\u91cd\u5206\u6570\u662f\u4e00\u4e2a\u6d6e\u70b9\u6570\uff08float \u7c7b\u578b\uff09\uff0c\u800c\u4e00\u7ec4\u7ecf\u7eac\u5ea6\u5305\u542b\u7684\u662f\u7ecf\u5ea6\u548c\u7eac\u5ea6\u4e24\u4e2a\u503c\uff0c\u662f\u6ca1\u6cd5\u76f4\u63a5\u4fdd\u5b58\u4e3a\u4e00\u4e2a\u6d6e\u70b9\u6570\u7684\uff0c\u90a3\u5177\u4f53\u8be5\u600e\u4e48\u8fdb\u884c\u4fdd\u5b58\u5462\uff1f \u8fd9\u5c31\u8981\u7528\u5230 GEO \u7c7b\u578b\u4e2d\u7684 GeoHash \u7f16\u7801\u4e86\u3002 3\u3001GeoHash \u7684\u7f16\u7801\u65b9\u6cd5 \u4e3a\u4e86\u80fd\u9ad8\u6548\u5730\u5bf9\u7ecf\u7eac\u5ea6\u8fdb\u884c\u6bd4\u8f83\uff0cRedis \u91c7\u7528\u4e86\u4e1a\u754c\u5e7f\u6cdb\u4f7f\u7528\u7684 GeoHash \u7f16\u7801\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u7684\u57fa\u672c\u539f\u7406\u5c31\u662f\u201c\u4e8c\u5206\u533a\u95f4\uff0c\u533a\u95f4\u7f16\u7801\u201d\u3002 \u5bf9\u4e00\u7ec4\u7ecf\u7eac\u5ea6\u8fdb\u884c GeoHash \u7f16\u7801\u65f6\uff0c\u6211\u4eec\u8981\u5148\u5bf9\u7ecf\u5ea6\u548c\u7eac\u5ea6\u5206\u522b\u7f16\u7801\uff0c\u7136\u540e\u518d\u628a\u7ecf\u7eac\u5ea6\u5404\u81ea\u7684\u7f16\u7801\u7ec4\u5408\u6210\u4e00\u4e2a\u6700\u7ec8\u7f16\u7801\u3002 3-1 \u7ecf\u5ea6\u548c\u7eac\u5ea6\u7684\u5355\u72ec\u7f16\u7801\u8fc7\u7a0b \u5bf9\u4e8e\u4e00\u4e2a\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u6765\u8bf4\uff0c\u5b83\u7684\u7ecf\u5ea6\u8303\u56f4\u662f [-180,180] \u3002GeoHash \u7f16\u7801\u4f1a\u628a\u4e00\u4e2a\u7ecf\u5ea6\u503c\u7f16\u7801\u6210\u4e00\u4e2a N \u4f4d\u7684\u4e8c\u8fdb\u5236\u503c\uff0c\u6211\u4eec\u6765\u5bf9\u7ecf\u5ea6\u8303\u56f4 [-180,180] \u505a N \u6b21\u7684\u4e8c\u5206\u533a\u64cd\u4f5c\uff0c\u5176\u4e2d N \u53ef\u4ee5\u81ea\u5b9a\u4e49\u3002 \u5728\u8fdb\u884c\u7b2c\u4e00\u6b21\u4e8c\u5206\u533a\u65f6\uff0c\u7ecf\u5ea6\u8303\u56f4[-180,180]\u4f1a\u88ab\u5206\u6210\u4e24\u4e2a\u5b50\u533a\u95f4\uff1a [-180,0) \u548c [0,180] \uff08\u6211\u79f0\u4e4b\u4e3a\u5de6\u3001\u53f3\u5206\u533a\uff09\u3002 \u6b64\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u67e5\u770b\u4e00\u4e0b\u8981\u7f16\u7801\u7684\u7ecf\u5ea6\u503c\u843d\u5728\u4e86\u5de6\u5206\u533a\u8fd8\u662f\u53f3\u5206\u533a\u3002 \u5982\u679c\u662f\u843d\u5728\u5de6\u5206\u533a\uff0c\u6211\u4eec\u5c31\u7528 0 \u8868\u793a\uff1b\u5982\u679c\u843d\u5728\u53f3\u5206\u533a\uff0c\u5c31\u7528 1 \u8868\u793a\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u6bcf\u505a\u5b8c\u4e00\u6b21\u4e8c\u5206\u533a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f97\u5230 1 \u4f4d\u7f16\u7801\u503c\u3002 \u6211\u4eec\u518d\u5bf9\u7ecf\u5ea6\u503c\u6240\u5c5e\u7684\u5206\u533a\u518d\u505a\u4e00\u6b21\u4e8c\u5206\u533a\uff0c \u540c\u65f6\u518d\u6b21\u67e5\u770b\u7ecf\u5ea6\u503c\u843d\u5728\u4e86\u4e8c\u5206\u533a\u540e\u7684\u5de6\u5206\u533a\u8fd8\u662f\u53f3\u5206\u533a\uff0c\u6309\u7167\u521a\u624d\u7684\u89c4\u5219\u518d\u505a 1 \u4f4d\u7f16\u7801\u3002\u5f53\u505a\u5b8c N \u6b21\u7684\u4e8c\u5206\u533a\u540e\uff0c\u7ecf\u5ea6\u503c\u5c31\u53ef\u4ee5\u7528\u4e00\u4e2a N bit \u7684\u6570\u6765\u8868\u793a\u4e86\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u6211\u4eec\u8981\u7f16\u7801\u7684\u7ecf\u5ea6\u503c\u662f 116.37\uff0c\u6211\u4eec\u7528 5 \u4f4d\u7f16\u7801\u503c\uff08\u4e5f\u5c31\u662f N=5\uff0c\u505a 5 \u6b21\u5206\u533a\uff09\u3002 \u6211\u4eec\u5148\u505a\u7b2c\u4e00\u6b21\u4e8c\u5206\u533a\u64cd\u4f5c\uff0c\u628a\u7ecf\u5ea6\u533a\u95f4 [-180,180] \u5206\u6210\u4e86\u5de6\u5206\u533a [-180,0) \u548c\u53f3\u5206\u533a [0,180] \uff0c\u6b64\u65f6\uff0c\u7ecf\u5ea6\u503c 116.37 \u662f\u5c5e\u4e8e\u53f3\u5206\u533a [0,180] \uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u7528 1 \u8868\u793a\u7b2c\u4e00\u6b21\u4e8c\u5206\u533a\u540e\u7684\u7f16\u7801\u503c\u3002 * \u7b2c\u4e8c\u6b21\u4e8c\u5206\u533a\uff1a\u628a\u7ecf\u5ea6\u503c 116.37 \u6240\u5c5e\u7684 [0,180] \u533a\u95f4\uff0c\u5206\u6210 [0,90) \u548c [90, 180] \u3002 \u6b64\u65f6\uff0c\u7ecf\u5ea6\u503c 116.37 \u8fd8\u662f\u5c5e\u4e8e\u53f3\u5206\u533a [90,180] \uff0c\u6240\u4ee5\uff0c\u7b2c\u4e8c\u6b21\u5206\u533a\u540e\u7684\u7f16\u7801\u503c\u4ecd\u7136\u4e3a 1 \u3002 \u7b49\u5230\u7b2c\u4e09\u6b21\u5bf9 [90,180] \u8fdb\u884c\u4e8c\u5206\u533a\uff0c\u7ecf\u5ea6\u503c 116.37 \u843d\u5728\u4e86\u5206\u533a\u540e\u7684\u5de6\u5206\u533a [90, 135) \u4e2d\uff0c\u6240\u4ee5\uff0c\u7b2c\u4e09\u6b21\u5206\u533a\u540e\u7684\u7f16\u7801\u503c\u5c31\u662f 0\u3002 \u6309\u7167\u8fd9\u79cd\u65b9\u6cd5\uff0c\u505a\u5b8c 5 \u6b21\u5206\u533a\u540e\uff0c\u6211\u4eec\u628a\u7ecf\u5ea6\u503c 116.37 \u5b9a\u4f4d\u5728 [112.5, 123.75] \u8fd9\u4e2a\u533a\u95f4\uff0c\u5e76\u4e14\u5f97\u5230\u4e86\u7ecf\u5ea6\u503c\u7684 5 \u4f4d\u7f16\u7801\u503c\uff0c\u5373 11010\u3002 \u5bf9\u7eac\u5ea6\u7684\u7f16\u7801\u65b9\u5f0f\uff0c\u548c\u5bf9\u7ecf\u5ea6\u7684\u4e00\u6837\uff0c\u53ea\u662f\u7eac\u5ea6\u7684\u8303\u56f4\u662f[-90\uff0c90]\uff0c\u4e0b\u9762\u8fd9\u5f20\u8868\u663e\u793a\u4e86\u5bf9\u7eac\u5ea6\u503c 39.86 \u7684\u7f16\u7801\u8fc7\u7a0b\u3002 \u5f53\u4e00\u7ec4\u7ecf\u7eac\u5ea6\u503c\u90fd\u7f16\u5b8c\u7801\u540e\uff0c\u6211\u4eec\u518d\u628a\u5b83\u4eec\u7684\u5404\u81ea\u7f16\u7801\u503c\u7ec4\u5408\u5728\u4e00\u8d77\uff0c\u7ec4\u5408\u7684\u89c4\u5219\u662f\uff1a \u6700\u7ec8\u7f16\u7801\u503c\u7684\u5076\u6570\u4f4d\u4e0a\u4f9d\u6b21\u662f\u7ecf\u5ea6\u7684\u7f16\u7801\u503c\uff0c\u5947\u6570\u4f4d\u4e0a\u4f9d\u6b21\u662f\u7eac\u5ea6\u7684\u7f16\u7801\u503c\uff0c\u5176\u4e2d\uff0c\u5076\u6570\u4f4d\u4ece 0 \u5f00\u59cb\uff0c\u5947\u6570\u4f4d\u4ece 1 \u5f00\u59cb\u3002 \u8ba1\u7b97\u7684\u7ecf\u7eac\u5ea6 \uff08116.37\uff0c39.86\uff09 \u7684\u5404\u81ea\u7f16\u7801\u503c\u662f 11010 \u548c 10111 \uff0c\u7ec4\u5408\u4e4b\u540e\uff0c\u7b2c 0 \u4f4d\u662f\u7ecf\u5ea6\u7684\u7b2c 0 \u4f4d 1\uff0c\u7b2c 1 \u4f4d\u662f\u7eac\u5ea6\u7684\u7b2c 0 \u4f4d 1\uff0c\u7b2c 2 \u4f4d\u662f\u7ecf\u5ea6\u7684\u7b2c 1 \u4f4d 1\uff0c\u7b2c 3 \u4f4d\u662f\u7eac\u5ea6\u7684\u7b2c 1 \u4f4d 0\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u5c31\u80fd\u5f97\u5230\u6700\u7ec8\u7f16\u7801\u503c 1110011101 \uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u7528\u4e86 GeoHash \u7f16\u7801\u540e\uff0c\u539f\u6765\u65e0\u6cd5\u7528\u4e00\u4e2a\u6743\u91cd\u5206\u6570\u8868\u793a\u7684\u4e00\u7ec4\u7ecf\u7eac\u5ea6\uff08116.37\uff0c39.86\uff09\u5c31\u53ef\u4ee5\u7528 1110011101 \u8fd9\u4e00\u4e2a\u503c\u6765\u8868\u793a\uff0c\u5c31\u53ef\u4ee5\u4fdd\u5b58\u4e3a Sorted Set \u7684\u6743\u91cd\u5206\u6570\u4e86\u3002 3-2 GeoHash \u7f16\u7801\u5206\u533a \u5f53\u7136\uff0c\u4f7f\u7528 GeoHash \u7f16\u7801\u540e\uff0c\u6211\u4eec\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u5730\u7406\u7a7a\u95f4\u5212\u5206\u6210\u4e86\u4e00\u4e2a\u4e2a\u65b9\u683c\uff0c\u6bcf\u4e2a\u65b9\u683c\u5bf9\u5e94\u4e86 GeoHash \u4e2d\u7684\u4e00\u4e2a\u5206\u533a\u3002 \u4e3e\u4e2a\u4f8b\u5b50\u3002\u6211\u4eec\u628a\u7ecf\u5ea6\u533a\u95f4 [-180,180] \u505a\u4e00\u6b21\u4e8c\u5206\u533a\uff0c\u628a\u7eac\u5ea6\u533a\u95f4 [-90,90] \u505a\u4e00\u6b21\u4e8c\u5206\u533a\uff0c\u5c31\u4f1a\u5f97\u5230 4 \u4e2a\u5206\u533a\u3002 \u6211\u4eec\u6765\u770b\u4e0b\u5b83\u4eec\u7684\u7ecf\u5ea6\u548c\u7eac\u5ea6\u8303\u56f4\u4ee5\u53ca\u5bf9\u5e94\u7684 GeoHash \u7ec4\u5408\u7f16\u7801\u3002 \u5206\u533a\u4e00\uff1a [-180,0) \u548c [-90,0) \uff0c\u7f16\u7801 00\uff1b \u5206\u533a\u4e8c\uff1a [-180,0) \u548c [0,90] \uff0c\u7f16\u7801 01\uff1b \u5206\u533a\u4e09\uff1a [0,180] \u548c [-90,0) \uff0c\u7f16\u7801 10\uff1b \u5206\u533a\u56db\uff1a [0,180] \u548c [0,90] \uff0c\u7f16\u7801 11\u3002 \u8fd9 4 \u4e2a\u5206\u533a\u5bf9\u5e94\u4e86 4 \u4e2a\u65b9\u683c\uff0c\u6bcf\u4e2a\u65b9\u683c\u8986\u76d6\u4e86\u4e00\u5b9a\u8303\u56f4\u5185\u7684\u7ecf\u7eac\u5ea6\u503c\uff0c\u5206\u533a\u8d8a\u591a\uff0c\u6bcf\u4e2a\u65b9\u683c\u80fd\u8986\u76d6\u5230\u7684\u5730\u7406\u7a7a\u95f4\u5c31\u8d8a\u5c0f\uff0c\u4e5f\u5c31\u8d8a\u7cbe\u51c6\u3002\u6211\u4eec\u628a\u6240\u6709\u65b9\u683c\u7684\u7f16\u7801\u503c\u6620\u5c04\u5230\u4e00\u7ef4\u7a7a\u95f4\u65f6\uff0c\u76f8\u90bb\u65b9\u683c\u7684 GeoHash \u7f16\u7801\u503c\u57fa\u672c\u4e5f\u662f\u63a5\u8fd1\u7684\uff0c \u6211\u4eec\u4f7f\u7528 Sorted Set \u8303\u56f4\u67e5\u8be2\u5f97\u5230\u7684\u76f8\u8fd1\u7f16\u7801\u503c\uff0c\u5728\u5b9e\u9645\u7684\u5730\u7406\u7a7a\u95f4\u4e0a\uff0c\u4e5f\u662f\u76f8\u90bb\u7684\u65b9\u683c\uff0c\u8fd9\u5c31\u53ef\u4ee5\u5b9e\u73b0 LBS \u5e94\u7528\u201c\u641c\u7d22\u9644\u8fd1\u7684\u4eba\u6216\u7269\u201d\u7684\u529f\u80fd\u4e86\u3002 \u6709\u7684\u7f16\u7801\u503c\u867d\u7136\u5728\u5927\u5c0f\u4e0a\u63a5\u8fd1\uff0c\u4f46\u5b9e\u9645\u5bf9\u5e94\u7684\u65b9\u683c\u5374\u8ddd\u79bb\u6bd4\u8f83\u8fdc\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u7528 4 \u4f4d\u6765\u505a GeoHash \u7f16\u7801\uff0c\u628a\u7ecf\u5ea6\u533a\u95f4 [-180,180] \u548c\u7eac\u5ea6\u533a\u95f4 [-90,90] \u5404\u5206\u6210\u4e86 4 \u4e2a\u5206\u533a\uff0c\u4e00\u5171 16 \u4e2a\u5206\u533a\uff0c\u5bf9\u5e94\u4e86 16 \u4e2a\u65b9\u683c\u3002\u7f16\u7801\u503c\u4e3a 0111 \u548c 1000 \u7684\u4e24\u4e2a\u65b9\u683c\u5c31\u79bb\u5f97\u6bd4\u8f83\u8fdc\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u6240\u4ee5\uff0c\u4e3a\u4e86\u907f\u514d\u67e5\u8be2\u4e0d\u51c6\u786e\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u540c\u65f6\u67e5\u8be2\u7ed9\u5b9a\u7ecf\u7eac\u5ea6\u6240\u5728\u7684\u65b9\u683c\u5468\u56f4\u7684 4 \u4e2a\u6216 8 \u4e2a\u65b9\u683c\u3002 GEO \u7c7b\u578b\u662f\u628a\u7ecf\u7eac\u5ea6\u6240\u5728\u7684\u533a\u95f4\u7f16\u7801\u4f5c\u4e3a Sorted Set \u4e2d\u5143\u7d20\u7684\u6743\u91cd\u5206\u6570\uff0c\u628a\u548c\u7ecf\u7eac\u5ea6\u76f8\u5173\u7684\u8f66\u8f86 ID \u4f5c\u4e3a Sorted Set \u4e2d\u5143\u7d20\u672c\u8eab\u7684\u503c\u4fdd\u5b58\u4e0b\u6765\uff0c\u8fd9\u6837\u76f8\u90bb\u7ecf\u7eac\u5ea6\u7684\u67e5\u8be2\u5c31\u53ef\u4ee5\u901a\u8fc7\u7f16\u7801\u503c\u7684\u5927\u5c0f\u8303\u56f4\u67e5\u8be2\u6765\u5b9e\u73b0\u4e86 4\u3001\u5982\u4f55\u64cd\u4f5c GEO \u7c7b\u578b\uff1f \u5728\u4f7f\u7528 GEO \u7c7b\u578b\u65f6\uff0c\u6211\u4eec\u7ecf\u5e38\u4f1a\u7528\u5230\u4e24\u4e2a\u547d\u4ee4\uff0c\u5206\u522b\u662f GEOADD \u548c GEORADIUS\u3002 GEOADD \u547d\u4ee4\uff1a\u7528\u4e8e\u628a\u4e00\u7ec4\u7ecf\u7eac\u5ea6\u4fe1\u606f\u548c\u76f8\u5bf9\u5e94\u7684\u4e00\u4e2a ID \u8bb0\u5f55\u5230 GEO \u7c7b\u578b\u96c6\u5408\u4e2d\uff1b GEORADIUS \u547d\u4ee4\uff1a\u4f1a\u6839\u636e\u8f93\u5165\u7684\u7ecf\u7eac\u5ea6\u4f4d\u7f6e\uff0c\u67e5\u627e\u4ee5\u8fd9\u4e2a\u7ecf\u7eac\u5ea6\u4e3a\u4e2d\u5fc3\u7684\u4e00\u5b9a\u8303\u56f4\u5185\u7684\u5176\u4ed6\u5143\u7d20\u3002\u5f53\u7136\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u5b9a\u4e49\u8fd9\u4e2a\u8303\u56f4\u3002 \u6211\u8fd8\u662f\u4ee5\u53eb\u8f66\u5e94\u7528\u7684\u8f66\u8f86\u5339\u914d\u573a\u666f\u4e3a\u4f8b\uff0c\u4ecb\u7ecd\u4e0b\u5177\u4f53\u5982\u4f55\u4f7f\u7528\u8fd9\u4e24\u4e2a\u547d\u4ee4\u3002 \u5047\u8bbe\u8f66\u8f86 ID \u662f 33\uff0c\u7ecf\u7eac\u5ea6\u4f4d\u7f6e\u662f \uff08116.034579\uff0c39.030452\uff09 \uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a GEO \u96c6\u5408\u4fdd\u5b58\u6240\u6709\u8f66\u8f86\u7684\u7ecf\u7eac\u5ea6\uff0c\u96c6\u5408 key \u662f cars:locations \u3002 \u6267\u884c\u4e0b\u9762\u7684\u8fd9\u4e2a\u547d\u4ee4\uff0c \u5c31\u53ef\u4ee5\u628a ID \u53f7\u4e3a 33 \u7684\u8f66\u8f86\u7684\u5f53\u524d\u7ecf\u7eac\u5ea6\u4f4d\u7f6e\u5b58\u5165 GEO \u96c6\u5408\u4e2d \uff1a GEOADD cars:locations 116.034579 39.030452 33 \u57fa\u672c\u7684\u5199\u6cd5\uff1a geoadd key longitude latitude member \u6ce8\uff1a latitude [\u02c8l\u00e6t\u026atju\u02d0d] \u7eac\u5ea6 longtitude \u7ecf\u5ea6 \u5f53\u7528\u6237\u60f3\u8981\u5bfb\u627e\u81ea\u5df1\u9644\u8fd1\u7684\u7f51\u7ea6\u8f66\u65f6\uff0cLBS \u5e94\u7528\u5c31\u53ef\u4ee5\u4f7f\u7528 GEORADIUS \u547d\u4ee4\u3002 \u4f8b\u5982\uff0cLBS \u5e94\u7528\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0cRedis \u4f1a\u6839\u636e\u8f93\u5165\u7684\u7528\u6237\u7684\u7ecf\u7eac\u5ea6\u4fe1\u606f\uff08116.054579\uff0c39.030452 \uff09\uff0c \u67e5\u627e\u4ee5\u8fd9\u4e2a\u7ecf\u7eac\u5ea6\u4e3a\u4e2d\u5fc3\u7684 5 \u516c\u91cc\u5185\u7684\u8f66\u8f86\u4fe1\u606f\uff0c\u5e76\u8fd4\u56de\u7ed9 LBS \u5e94\u7528\u3002\u5f53\u7136\uff0c \u4f60\u53ef\u4ee5\u4fee\u6539\u201c5\u201d\u8fd9\u4e2a\u53c2\u6570\uff0c\u6765\u8fd4\u56de\u66f4\u5927\u6216\u66f4\u5c0f\u8303\u56f4\u5185\u7684\u8f66\u8f86\u4fe1\u606f\u3002 GEORADIUS cars:locations 116.054579 39.030452 5 km ASC COUNT 10 \u6211\u4eec\u8fd8\u53ef\u4ee5\u8fdb\u4e00\u6b65\u9650\u5b9a\u8fd4\u56de\u7684\u8f66\u8f86\u4fe1\u606f\u3002 \u6bd4\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ASC \u9009\u9879\uff0c\u8ba9\u8fd4\u56de\u7684\u8f66\u8f86\u4fe1\u606f\u6309\u7167\u8ddd\u79bb\u8fd9\u4e2a\u4e2d\u5fc3\u4f4d\u7f6e \u4ece\u8fd1\u5230\u8fdc\u7684\u65b9\u5f0f\u6765\u6392\u5e8f\uff0c\u4ee5\u65b9\u4fbf\u9009\u62e9\u6700\u8fd1\u7684\u8f66\u8f86\uff1b 5\u3001\u5982\u4f55\u81ea\u5b9a\u4e49\u6570\u636e\u7c7b\u578b\uff1f \u4f46\u662f\u6709\u4e9b\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u5bf9\u6570\u636e\u7c7b\u578b\u4f1a\u6709\u7279\u6b8a\u9700\u6c42\uff0c\u4f8b\u5982\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\u65e2\u80fd\u50cf Hash \u90a3\u6837\u652f\u6301\u5feb\u901f\u7684\u5355\u952e\u67e5\u8be2\uff0c\u53c8\u80fd\u50cf Sorted Set \u90a3\u6837\u652f\u6301\u8303\u56f4\u67e5\u8be2\uff0c\u6b64\u65f6\uff0c\u6211\u4eec\u4e4b\u524d\u5b66\u4e60\u7684\u8fd9\u4e9b\u6570\u636e\u7c7b\u578b\u5c31\u65e0\u6cd5\u6ee1\u8db3\u9700\u6c42\u4e86\u3002 \u4e3a\u4e86\u5b9e\u73b0\u81ea\u5b9a\u4e49\u6570\u636e\u7c7b\u578b\uff0c \u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u4e86\u89e3 Redis \u7684\u57fa\u672c\u5bf9\u8c61\u7ed3\u6784 RedisObject\uff0c\u56e0\u4e3a Redis \u952e\u503c\u5bf9\u4e2d\u7684\u6bcf\u4e00\u4e2a\u503c\u90fd\u662f\u7528 RedisObject \u4fdd\u5b58\u7684 \u3002 RedisObject \u5305\u62ec\u5143\u6570\u636e\u548c\u6307\u9488\uff1a \u5143\u6570\u636e\u7684\u4e00\u4e2a\u529f\u80fd\u5c31\u662f\u7528\u6765\u533a\u5206\u4e0d\u540c\u7684\u6570\u636e\u7c7b\u578b \u6307\u9488\u7528\u6765\u6307\u5411\u5177\u4f53\u7684\u6570\u636e\u7c7b\u578b\u7684\u503c 5-1 Redis \u7684\u57fa\u672c\u5bf9\u8c61\u7ed3\u6784 RedisObject \u7684\u5185\u90e8\u7ec4\u6210\u5305\u62ec\u4e86 type \u3001 encoding \u3001 lru \u548c refcount 4 \u4e2a\u5143\u6570\u636e\uff0c\u4ee5\u53ca 1 \u4e2a *ptr \u6307\u9488\u3002 type\uff1a \u8868\u793a\u503c\u7684\u7c7b\u578b \uff0c\u6db5\u76d6\u4e86\u6211\u4eec\u524d\u9762\u5b66\u4e60\u7684\u4e94\u5927\u57fa\u672c\u7c7b\u578b\uff1b encoding \uff1a\u662f\u503c\u7684\u7f16\u7801\u65b9\u5f0f\uff0c\u7528\u6765\u8868\u793a Redis \u4e2d\u5b9e\u73b0\u5404\u4e2a\u57fa\u672c\u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff0c\u4f8b\u5982 SDS\u3001\u538b\u7f29\u5217\u8868\u3001\u54c8\u5e0c\u8868\u3001\u8df3\u8868\u7b49\uff1b lru \uff1a\u8bb0\u5f55\u4e86\u8fd9\u4e2a\u5bf9\u8c61\u6700\u540e\u4e00\u6b21\u88ab\u8bbf\u95ee\u7684\u65f6\u95f4\uff0c\u7528\u4e8e\u6dd8\u6c70\u8fc7\u671f\u7684\u952e\u503c\u5bf9\uff1b refcount \uff1a\u8bb0\u5f55\u4e86\u5bf9\u8c61\u7684\u5f15\u7528\u8ba1\u6570\uff1b *ptr \uff1a\u662f\u6307\u5411\u6570\u636e\u7684\u6307\u9488\u3002 RedisObject \u7ed3\u6784\u501f\u52a9 *ptr \u6307\u9488\uff0c\u5c31\u53ef\u4ee5\u6307\u5411\u4e0d\u540c\u7684\u6570\u636e\u7c7b\u578b \u4f8b\u5982\uff0c *ptr \u6307\u5411\u4e00\u4e2a SDS \u6216\u4e00\u4e2a\u8df3\u8868\uff0c\u5c31\u8868\u793a\u952e\u503c\u5bf9\u4e2d\u7684\u503c\u662f String \u7c7b\u578b\u6216 Sorted Set \u7c7b\u578b\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u5728\u5b9a\u4e49\u4e86\u65b0\u7684\u6570\u636e\u7c7b\u578b\u540e\uff0c\u4e5f\u53ea\u8981\u5728 RedisObject \u4e2d\u8bbe\u7f6e\u597d\u65b0\u7c7b\u578b\u7684 type \u548c encoding \uff0c\u518d\u7528 *ptr \u6307\u5411\u65b0\u7c7b\u578b\u7684\u5b9e\u73b0\uff0c\u5c31\u884c\u4e86\u3002 6\u3001\u5f00\u53d1\u4e00\u4e2a\u65b0\u7684\u6570\u636e\u7c7b\u578b \u4e86\u89e3\u4e86 RedisObject \u7ed3\u6784\u540e\uff0c\u5b9a\u4e49\u4e00\u4e2a\u65b0\u7684\u6570\u636e\u7c7b\u578b\u4e5f\u5c31\u4e0d\u96be\u4e86\u3002 \u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u4e3a\u65b0\u6570\u636e\u7c7b\u578b\u5b9a\u4e49\u597d\u5b83\u7684\u5e95\u5c42\u7ed3\u6784\u3001type \u548c encoding \u5c5e\u6027\u503c\uff0c\u7136\u540e\u518d\u5b9e\u73b0\u65b0\u6570\u636e\u7c7b\u578b\u7684\u521b\u5efa\u3001\u91ca\u653e\u51fd\u6570\u548c\u57fa\u672c\u547d\u4ee4\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u4ee5\u5f00\u53d1\u4e00\u4e2a\u540d\u5b57\u53eb\u4f5c NewTypeObject \u7684\u65b0\u6570\u636e\u7c7b\u578b\u4e3a\u4f8b\uff0c\u6765\u89e3\u91ca\u4e0b\u5177\u4f53\u7684 4 \u4e2a\u64cd\u4f5c\u6b65\u9aa4\u3002 6-1 \u7b2c\u4e00\u6b65\uff1a\u5b9a\u4e49\u65b0\u6570\u636e\u7c7b\u578b\u7684\u5e95\u5c42\u7ed3\u6784 \u6211\u4eec\u7528 newtype.h \u6587\u4ef6\u6765\u4fdd\u5b58\u8fd9\u4e2a\u65b0\u7c7b\u578b\u7684\u5b9a\u4e49\uff0c\u5177\u4f53\u5b9a\u4e49\u7684\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a struct NewTypeObject { struct NewTypeNode *head; size_t len; }NewTypeObject; \u5176\u4e2d\uff0c NewTypeNode \u7ed3\u6784\u5c31\u662f\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u65b0\u7c7b\u578b\u7684\u5e95\u5c42\u7ed3\u6784\u3002\u6211\u4eec\u4e3a\u5e95\u5c42\u7ed3\u6784\u8bbe\u8ba1\u4e24\u4e2a\u6210\u5458\u53d8\u91cf\uff1a\u4e00\u4e2a\u662f Long \u7c7b\u578b\u7684 value \u503c\uff0c\u7528\u6765\u4fdd\u5b58\u5b9e\u9645\u6570\u636e\uff1b\u4e00\u4e2a\u662f *next \u6307\u9488\uff0c\u6307\u5411\u4e0b\u4e00\u4e2a NewTypeNode \u7ed3\u6784\u3002 struct NewTypeNode { long value; struct NewTypeNode *next; }; \u4ece\u4ee3\u7801\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c NewTypeObject \u7c7b\u578b\u7684\u5e95\u5c42\u7ed3\u6784\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a Long \u7c7b\u578b\u7684\u5355\u5411\u94fe\u8868\u3002\u5f53\u7136\uff0c\u4f60\u8fd8\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\uff0c\u628a NewTypeObject \u7684\u5e95\u5c42\u7ed3\u6784\u5b9a\u4e49\u4e3a\u5176\u4ed6\u7c7b\u578b\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8981 NewTypeObject \u7684\u67e5\u8be2\u6548\u7387\u6bd4\u94fe\u8868\u9ad8\uff0c\u5c31\u53ef\u4ee5\u628a\u5b83\u7684\u5e95\u5c42\u7ed3\u6784\u8bbe\u8ba1\u6210\u4e00\u9897 B+ \u6811\u3002 6-2 \u7b2c\u4e8c\u6b65\uff1a\u5728 RedisObject \u7684 type \u5c5e\u6027\u4e2d\uff0c\u589e\u52a0\u8fd9\u4e2a\u65b0\u7c7b\u578b\u7684\u5b9a\u4e49 \u8fd9\u4e2a\u5b9a\u4e49\u662f\u5728 Redis \u7684 server.h \u6587\u4ef6\u4e2d\u3002\u6bd4\u5982\uff0c\u6211\u4eec\u589e\u52a0\u4e00\u4e2a\u53eb\u4f5c OBJ_NEWTYPE \u7684\u5b8f\u5b9a\u4e49\uff0c\u7528\u6765\u5728\u4ee3\u7801\u4e2d\u6307\u4ee3 NewTypeObject \u8fd9\u4e2a\u65b0\u7c7b\u578b\u3002 #define OBJ_STRING 0 /* String object. */ #define OBJ_LIST 1 /* List object. */ #define OBJ_SET 2 /* Set object. */ #define OBJ_ZSET 3 /* Sorted set object. */ \u2026 #define OBJ_NEWTYPE 7 6-3 \u7b2c\u4e09\u6b65\uff1a\u5f00\u53d1\u65b0\u7c7b\u578b\u7684\u521b\u5efa\u548c\u91ca\u653e\u51fd\u6570 Redis \u628a\u6570\u636e\u7c7b\u578b\u7684\u521b\u5efa\u548c\u91ca\u653e\u51fd\u6570\u90fd\u5b9a\u4e49\u5728\u4e86 object.c \u6587\u4ef6\u4e2d\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u589e\u52a0 NewTypeObject \u7684\u521b\u5efa\u51fd\u6570 createNewTypeObject \uff0c\u5982\u4e0b\u6240\u793a\uff1a robj *createNewTypeObject(void){ NewTypeObject *h = newtypeNew(); robj *o = createObject(OBJ_NEWTYPE,h); return o; } createNewTypeObject \u5206\u522b\u8c03\u7528\u4e86 newtypeNew \u548c createObject \u4e24\u4e2a\u51fd\u6570\uff0c\u6211\u5206\u522b\u6765\u4ecb\u7ecd\u4e0b\u3002 \u5148\u8bf4 newtypeNew \u51fd\u6570\u3002\u5b83\u662f\u7528\u6765\u4e3a\u65b0\u6570\u636e\u7c7b\u578b\u521d\u59cb\u5316\u5185\u5b58\u7ed3\u6784\u7684\u3002\u8fd9\u4e2a\u521d\u59cb\u5316\u8fc7\u7a0b\u4e3b\u8981\u662f\u7528 zmalloc \u505a\u5e95\u5c42\u7ed3\u6784\u5206\u914d\u7a7a\u95f4\uff0c\u4ee5\u4fbf\u5199\u5165\u6570\u636e\u3002 NewTypeObject *newtypeNew(void){ NewTypeObject *n = zmalloc(sizeof(*n)); n->head = NULL; n->len = 0; return n; } newtypeNew \u51fd\u6570\u6d89\u53ca\u5230\u65b0\u6570\u636e\u7c7b\u578b\u7684\u5177\u4f53\u521b\u5efa\uff0c\u800c Redis \u9ed8\u8ba4\u4f1a\u4e3a\u6bcf\u4e2a\u6570\u636e\u7c7b\u578b\u5b9a\u4e49\u4e00\u4e2a\u5355\u72ec\u6587\u4ef6\uff0c\u5b9e\u73b0\u8fd9\u4e2a\u7c7b\u578b\u7684\u521b\u5efa\u548c\u547d\u4ee4\u64cd\u4f5c\uff0c\u4f8b\u5982\uff0c t_string.c \u548c t_list.c \u5206\u522b\u5bf9\u5e94 String \u548c List \u7c7b\u578b\u3002 \u6309\u7167 Redis \u7684\u60ef\u4f8b\uff0c\u6211\u4eec\u5c31\u628a newtypeNew \u51fd\u6570\u5b9a\u4e49\u5728\u540d\u4e3a t_newtype.c \u7684\u6587\u4ef6\u4e2d\u3002 createObject \u662f Redis \u672c\u8eab\u63d0\u4f9b\u7684 RedisObject \u521b\u5efa\u51fd\u6570\uff0c\u5b83\u7684\u53c2\u6570\u662f\u6570\u636e\u7c7b\u578b\u7684 type \u548c\u6307\u5411\u6570\u636e\u7c7b\u578b\u5b9e\u73b0\u7684\u6307\u9488 *ptr \u3002 \u6211\u4eec\u7ed9 createObject \u51fd\u6570\u4e2d\u4f20\u5165\u4e86\u4e24\u4e2a\u53c2\u6570\uff0c\u5206\u522b\u662f\u65b0\u7c7b\u578b\u7684 type \u503c OBJ_NEWTYPE \uff0c\u4ee5\u53ca\u6307\u5411\u4e00\u4e2a\u521d\u59cb\u5316\u8fc7\u7684 NewTypeObject \u7684\u6307\u9488\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u521b\u5efa\u7684 RedisObject \u5c31\u80fd\u6307\u5411\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u65b0\u6570\u636e\u7c7b\u578b\u4e86\u3002 robj *createObject(int type, void *ptr) { robj *o = zmalloc(sizeof(*o)); o->type = type; o->ptr = ptr; ... return o; } \u5bf9\u4e8e\u91ca\u653e\u51fd\u6570\u6765\u8bf4\uff0c\u5b83\u662f\u521b\u5efa\u51fd\u6570\u7684\u53cd\u8fc7\u7a0b\uff0c\u662f\u7528 zfree \u547d\u4ee4\u628a\u65b0\u7ed3\u6784\u7684\u5185\u5b58\u7a7a\u95f4\u91ca\u653e\u6389\u3002 6-4 \u7b2c\u56db\u6b65\uff1a\u5f00\u53d1\u65b0\u7c7b\u578b\u7684\u547d\u4ee4\u64cd\u4f5c \u7b80\u5355\u6765\u8bf4\uff0c\u589e\u52a0\u76f8\u5e94\u7684\u547d\u4ee4\u64cd\u4f5c\u7684\u8fc7\u7a0b\u53ef\u4ee5\u5206\u6210\u4e09\u5c0f\u6b65\uff1a 1.\u5728 t_newtype.c \u6587\u4ef6\u4e2d\u589e\u52a0\u547d\u4ee4\u64cd\u4f5c\u7684\u5b9e\u73b0\u3002\u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u5b9a\u4e49 ntinsertCommand \u51fd\u6570\uff0c\u7531\u5b83\u5b9e\u73b0\u5bf9 NewTypeObject \u5355\u5411\u94fe\u8868\u7684\u63d2\u5165\u64cd\u4f5c\uff1a void ntinsertCommand(client *c){ //\u57fa\u4e8e\u5ba2\u6237\u7aef\u4f20\u9012\u7684\u53c2\u6570\uff0c\u5b9e\u73b0\u5728NewTypeObject\u94fe\u8868\u5934\u63d2\u5165\u5143\u7d20 } 2.\u5728 server.h \u6587\u4ef6\u4e2d\uff0c\u58f0\u660e\u6211\u4eec\u5df2\u7ecf\u5b9e\u73b0\u7684\u547d\u4ee4\uff0c\u4ee5\u4fbf\u5728 server.c \u6587\u4ef6\u5f15\u7528\u8fd9\u4e2a\u547d\u4ee4\uff0c\u4f8b\u5982\uff1a void ntinsertCommand(client *c) 3.\u5728 server.c \u6587\u4ef6\u4e2d\u7684 redisCommandTable \u91cc\u9762\uff0c\u628a\u65b0\u589e\u547d\u4ee4\u548c\u5b9e\u73b0\u51fd\u6570\u5173\u8054\u8d77\u6765\u3002\u4f8b\u5982\uff0c\u65b0\u589e\u7684 ntinsert \u547d\u4ee4\u7531 ntinsertCommand \u51fd\u6570\u5b9e\u73b0\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528 ntinsert \u547d\u4ee4\u7ed9 NewTypeObject \u6570\u636e\u7c7b\u578b\u63d2\u5165\u5143\u7d20\u4e86\u3002 struct redisCommand redisCommandTable[] = { ... {\"ntinsert\",ntinsertCommand,2,\"m\",...} } \u6b64\u65f6\uff0c\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684 NewTypeObject \u6570\u636e\u7c7b\u578b\uff0c\u53ef\u4ee5\u5b9e\u73b0\u57fa\u672c\u7684\u547d\u4ee4\u64cd\u4f5c\u4e86\u3002\u5f53\u7136\uff0c\u5982\u679c\u4f60\u8fd8\u5e0c\u671b\u65b0\u7684\u6570\u636e\u7c7b\u578b\u80fd\u88ab\u6301\u4e45\u5316\u4fdd\u5b58\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5728 Redis \u7684 RDB \u548c AOF \u6a21\u5757\u4e2d\u589e\u52a0\u5bf9\u65b0\u6570\u636e\u7c7b\u578b\u8fdb\u884c\u6301\u4e45\u5316\u4fdd\u5b58\u7684\u4ee3\u7801\uff0c 7\u3001\u672c\u8282\u5c0f\u7ed3 GEO \u672c\u8eab\u5e76\u6ca1\u6709\u8bbe\u8ba1\u65b0\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff0c\u800c\u662f\u76f4\u63a5\u4f7f\u7528\u4e86 Sorted Set \u96c6\u5408\u7c7b\u578b\u3002 GEO \u7c7b\u578b\u4f7f\u7528 GeoHash \u7f16\u7801\u65b9\u6cd5\u5b9e\u73b0\u4e86\u7ecf\u7eac\u5ea6\u5230 Sorted Set \u4e2d\u5143\u7d20\u6743\u91cd\u5206\u6570\u7684\u8f6c\u6362\uff0c\u8fd9\u5176\u4e2d\u7684\u4e24\u4e2a\u5173\u952e\u673a\u5236\u5c31\u662f\u5bf9\u4e8c\u7ef4\u5730\u56fe\u505a\u533a\u95f4\u5212\u5206\uff0c\u4ee5\u53ca\u5bf9\u533a\u95f4\u8fdb\u884c\u7f16\u7801\u3002 \u4e00\u7ec4\u7ecf\u7eac\u5ea6\u843d\u5728\u67d0\u4e2a\u533a\u95f4\u540e\uff0c\u5c31\u7528\u533a\u95f4\u7684\u7f16\u7801\u503c\u6765\u8868\u793a\uff0c\u5e76\u628a\u7f16\u7801\u503c\u4f5c\u4e3a Sorted Se \u5143\u7d20\u7684\u6743\u91cd\u5206\u6570\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u7ecf\u7eac\u5ea6\u4fdd\u5b58\u5230 Sorted Set \u4e2d\uff0c\u5229\u7528 Sorted Set \u63d0\u4f9b\u7684\u201c\u6309\u6743\u91cd\u8fdb\u884c\u6709\u5e8f\u8303\u56f4\u67e5\u627e\u201d\u7684\u7279\u6027\uff0c\u5b9e\u73b0 LBS \u670d\u52a1\u4e2d\u9891\u7e41\u4f7f\u7528\u7684\u201c\u641c\u7d22\u9644\u8fd1\u201d\u7684\u9700\u6c42\u3002 GEO \u5c5e\u4e8e Redis \u63d0\u4f9b\u7684\u6269\u5c55\u6570\u636e\u7c7b\u578b\u3002\u6269\u5c55\u6570\u636e\u7c7b\u578b\u6709\u4e24\u79cd\u5b9e\u73b0\u9014\u5f84\uff1a \u4e00\u79cd\u662f\u57fa\u4e8e\u73b0\u6709\u7684\u6570\u636e\u7c7b\u578b\uff0c\u901a\u8fc7\u6570\u636e\u7f16\u7801\u6216\u662f\u5b9e\u73b0\u65b0\u7684\u64cd\u4f5c\u7684\u65b9\u5f0f\uff0c\u6765\u5b9e\u73b0\u6269\u5c55\u6570\u636e\u7c7b\u578b\uff0c\u4f8b\u5982\u57fa\u4e8e Sorted Set \u548c GeoHash \u7f16\u7801\u5b9e\u73b0 GEO\uff0c\u4ee5\u53ca\u57fa\u4e8e String \u548c\u4f4d\u64cd\u4f5c\u5b9e\u73b0 Bitmap\uff1b \u53e6\u4e00\u79cd\u5c31\u662f\u5f00\u53d1\u81ea\u5b9a\u4e49\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5177\u4f53\u7684\u64cd\u4f5c\u662f\u589e\u52a0\u65b0\u6570\u636e\u7c7b\u578b\u7684\u5b9a\u4e49\uff0c\u5b9e\u73b0\u521b\u5efa\u548c\u91ca\u653e\u51fd\u6570\uff0c\u5b9e\u73b0\u65b0\u6570\u636e\u7c7b\u578b\u652f\u6301\u7684\u547d\u4ee4\u64cd\u4f5c 7-1 \u8981\u70b9&\u4eae\u70b9\uff1f GEO\u7684\u539f\u7406\uff0c\u8fd9\u4e2a\u662f\u6211\u4e4b\u524d\u6240\u4e0d\u77e5\u9053\u7684\uff0c\u5b66\u5b8c\u540e\u5bf9GEO\u6709\u4e86\u4e00\u4e9b\u8ba4\u77e5 Redis\u5c45\u7136\u652f\u6301\u81ea\u5b9a\u4e49\u6570\u636e\u5b58\u50a8\u7ed3\u6784\uff0c\u8fd9\u6253\u5f00\u4e86\u6211\u7684\u773c\u754c GEO\u7684\u5e95\u5c42\u5b9e\u73b0\uff0c\u662fsortSet\uff0c\u5143\u7d20\u662f\u8f66\u8f86\u4fe1\u606f\uff0c\u6743\u91cd\u662f\u8f66\u8f86\u7ecf\u7eac\u5ea6\u8f6c\u6362\u8fc7\u6765\u7684float\u503c GEOHash\u7f16\u7801\uff0c\u57fa\u672c\u539f\u7406\u201c\u4e8c\u5206\u533a\u95f4\uff0c\u533a\u95f4\u7f16\u7801\u201d\uff08\u4e8c\u5206\u6cd5\u7684\u5e94\u7528\uff0c\u5c06\u4e00\u4e2a\u503c\u7f16\u7801\u6210N\u4f4d\u7684\u4e8c\u8fdb\u5236\u503c\uff09 GEO\u4f7f\u7528GEOHash\u7f16\u7801\u540e\uff0c\u5c06\u7ecf\u7eac\u5ea6\uff0c\u6309\u7167\u7eac\u5947\u7ecf\u5076\u4f4d\u5206\u522b\u586b\u5145\u7ec4\u5408\uff0c\u5f97\u5230\u4e00\u4e2a\u8f66\u8f86\u7684\u7ecf\u7eac\u5ea6\u7f16\u7801\u503c GEOHash\u7f16\u7801\u5b9e\u73b0\u7684\u6548\u679c\u662f\u5c06\u4e00\u4e2a\u7a7a\u95f4\u5206\u5272\u6210\u4e3a\u4e00\u4e2a\u4e2a\u65b9\u5757\uff0c\u53ef\u4ee5\u5b9e\u73b0LBS\u670d\u52a1\uff08\u4f46\u7f16\u7801\u503c\u76f8\u8fd1\uff0c\u4e0d\u4e00\u5b9a\u4f4d\u7f6e\u76f8\u8fd1\uff09 7-2 \u6bcf\u8bfe\u4e00\u95ee Redis \u7684 5 \u5927\u57fa\u672c\u6570\u636e\u7c7b\u578b\u548c 3 \u4e2a\u6269\u5c55\u6570\u636e\u7c7b\u578b","title":"\u7b2c\u4e09\u8282 GEO\uff0c\u4e00\u79cd\u53ef\u4ee5\u5b9e\u73b0LBS\u670d\u52a1\u7684\u6570\u636e\u7ed3\u6784"},{"location":"chap3/3redis_geo/#geolbs","text":"\u4e0a\u4e00\u8282\u8bb2\u4e86 5 \u5927\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff1a String\u3001List\u3001Hash\u3001Set \u548c Sorted Set\uff0c\u5b83\u4eec\u53ef\u4ee5\u6ee1\u8db3\u5927\u591a\u6570\u7684\u6570\u636e\u5b58\u50a8\u9700\u6c42\uff0c\u4f46\u662f\u5728\u9762\u5bf9\u6d77\u91cf\u6570\u636e\u7edf\u8ba1\u65f6\uff0c\u5b83\u4eec\u7684\u5185\u5b58\u5f00\u9500\u5f88\u5927 \uff0c\u800c\u4e14\u5bf9\u4e8e\u4e00\u4e9b\u7279\u6b8a\u7684\u573a\u666f\uff0c\u5b83\u4eec\u662f\u65e0\u6cd5\u652f\u6301\u7684\u3002 Redis \u8fd8\u63d0\u4f9b\u4e86 3 \u79cd\u6269\u5c55\u6570\u636e\u7c7b\u578b\uff0c\u5206\u522b\u662f Bitmap\u3001HyperLogLog \u548c GEO","title":"\u7b2c\u4e09\u8282 GEO\uff0c\u4e00\u79cd\u53ef\u4ee5\u5b9e\u73b0LBS\u670d\u52a1\u7684\u6570\u636e\u7ed3\u6784"},{"location":"chap3/3redis_geo/#1-lbs-geo","text":"\u57fa\u4e8e\u4f4d\u7f6e\u4fe1\u606f\u670d\u52a1\uff08Location-Based Service\uff0cLBS\uff09\u7684\u5e94\u7528\u3002LBS \u5e94\u7528\u8bbf\u95ee\u7684\u6570\u636e\u662f\u548c\u4eba\u6216\u7269\u5173\u8054\u7684\u4e00\u7ec4\u7ecf\u7eac\u5ea6\u4fe1\u606f\uff0c\u800c\u4e14\u8981\u80fd\u67e5\u8be2\u76f8\u90bb\u7684\u7ecf\u7eac\u5ea6\u8303\u56f4\uff0cGEO \u5c31\u975e\u5e38\u9002\u5408\u5e94\u7528\u5728 LBS \u670d\u52a1\u7684\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u5b83\u7684\u5e95\u5c42\u7ed3\u6784\u3002","title":"1\u3001\u9762\u5411 LBS \u5e94\u7528\u7684 GEO \u6570\u636e\u7c7b\u578b"},{"location":"chap3/3redis_geo/#2geo","text":"","title":"2\u3001GEO \u7684\u5e95\u5c42\u7ed3\u6784"},{"location":"chap3/3redis_geo/#2-1-lbs","text":"\u4e00\u822c\u6765\u8bf4\uff0c\u5728\u8bbe\u8ba1\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\u7684\u5e95\u5c42\u7ed3\u6784\u65f6\uff0c\u6211\u4eec\u9996\u5148\u9700\u8981\u77e5\u9053\uff0c\u8981\u5904\u7406\u7684\u6570\u636e\u6709\u4ec0\u4e48\u8bbf\u95ee\u7279\u70b9\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u5148\u641e\u6e05\u695a\u4f4d\u7f6e\u4fe1\u606f\u5230\u5e95\u662f\u600e\u4e48\u88ab\u5b58\u53d6\u7684\u3002 \u4ee5\u53eb\u8f66\u670d\u52a1\u4e3a\u4f8b\uff0c\u6765\u5206\u6790\u4e0b LBS \u5e94\u7528\u4e2d\u7ecf\u7eac\u5ea6\u7684\u5b58\u53d6\u7279\u70b9\u3002 \u6bcf\u4e00\u8f86\u7f51\u7ea6\u8f66\u90fd\u6709\u4e00\u4e2a\u7f16\u53f7\uff08\u4f8b\u5982 33\uff09\uff0c\u7f51\u7ea6\u8f66\u9700\u8981\u5c06\u81ea\u5df1\u7684\u7ecf\u5ea6\u4fe1\u606f\uff08\u4f8b\u5982 116.034579\uff09\u548c\u7eac\u5ea6\u4fe1\u606f\uff08\u4f8b\u5982 39.000452 \uff09\u53d1\u7ed9\u53eb\u8f66\u5e94\u7528\u3002 \u7528\u6237\u5728\u53eb\u8f66\u7684\u65f6\u5019\uff0c\u53eb\u8f66\u5e94\u7528\u4f1a\u6839\u636e\u7528\u6237\u7684\u7ecf\u7eac\u5ea6\u4f4d\u7f6e\uff08\u4f8b\u5982\u7ecf\u5ea6 116.054579\uff0c\u7eac\u5ea6 39.030452\uff09\uff0c\u67e5\u627e\u7528\u6237\u7684\u9644\u8fd1\u8f66\u8f86\uff0c\u5e76\u8fdb\u884c\u5339\u914d\u3002 \u7b49\u628a\u4f4d\u7f6e\u76f8\u8fd1\u7684\u7528\u6237\u548c\u8f66\u8f86\u5339\u914d\u4e0a\u4ee5\u540e\uff0c\u53eb\u8f66\u5e94\u7528\u5c31\u4f1a\u6839\u636e\u8f66\u8f86\u7684\u7f16\u53f7\uff0c\u83b7\u53d6\u8f66\u8f86\u7684\u4fe1\u606f\uff0c\u5e76\u8fd4\u56de\u7ed9\u7528\u6237\u3002 \u4e00\u8f86\u8f66\uff08\u6216\u4e00\u4e2a\u7528\u6237\uff09\u5bf9\u5e94\u4e00\u7ec4\u7ecf\u7eac\u5ea6\uff0c\u5e76\u4e14\u968f\u7740\u8f66\uff08\u6216\u7528\u6237\uff09\u7684\u4f4d\u7f6e\u79fb\u52a8\uff0c\u76f8\u5e94\u7684\u7ecf\u7eac\u5ea6\u4e5f\u4f1a\u53d8\u5316\u3002 \u6570\u636e\u8bb0\u5f55\u6a21\u5f0f\u5c5e\u4e8e\u4e00\u4e2a key\uff08\u4f8b\u5982\u8f66 ID\uff09\u5bf9\u5e94\u4e00\u4e2a value\uff08\u4e00\u7ec4\u7ecf\u7eac\u5ea6\uff09\u3002\u5f53\u6709\u5f88\u591a\u8f66\u8f86\u4fe1\u606f\u8981\u4fdd\u5b58\u65f6\uff0c\u5c31\u9700\u8981\u6709\u4e00\u4e2a\u96c6\u5408\u6765\u4fdd\u5b58\u4e00\u7cfb\u5217\u7684 key \u548c value\u3002 Hash \u96c6\u5408\u7c7b\u578b\u53ef\u4ee5\u5feb\u901f\u5b58\u53d6\u4e00\u7cfb\u5217\u7684 key \u548c value \uff0c \u6b63\u597d\u53ef\u4ee5\u7528\u6765\u8bb0\u5f55\u4e00\u7cfb\u5217\u8f66\u8f86 ID \u548c\u7ecf\u7eac\u5ea6\u7684\u5bf9\u5e94\u5173\u7cfb \uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4e0d\u540c\u8f66\u8f86\u7684 ID \u548c\u5b83\u4eec\u5bf9\u5e94\u7684\u7ecf\u7eac\u5ea6\u4fe1\u606f\u5b58\u5728 Hash \u96c6\u5408\u4e2d Hash \u7c7b\u578b\u7684 HSET \u64cd\u4f5c\u547d\u4ee4\uff0c\u4f1a\u6839\u636e key \u6765\u8bbe\u7f6e\u76f8\u5e94\u7684 value \u503c \uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u5b83\u6765\u5feb\u901f\u5730\u66f4\u65b0\u8f66\u8f86\u53d8\u5316\u7684\u7ecf\u7eac\u5ea6\u4fe1\u606f\u3002","title":"2-1 LBS \u5e94\u7528\u7eac\u5ea6\u7684\u5b58\u53d6\u7279\u70b9"},{"location":"chap3/3redis_geo/#2-2-sorted-set","text":"Sorted Set \u7c7b\u578b\u4e5f\u652f\u6301\u4e00\u4e2a key \u5bf9\u5e94\u4e00\u4e2a value \u7684\u8bb0\u5f55\u6a21\u5f0f\uff0c\u5176\u4e2d\uff0ckey \u5c31\u662f Sorted Set \u4e2d\u7684\u5143\u7d20\uff0c\u800c value \u5219\u662f\u5143\u7d20\u7684\u6743\u91cd\u5206\u6570\u3002\u66f4\u91cd\u8981\u7684\u662f\uff0cSorted Set \u53ef\u4ee5\u6839\u636e\u5143\u7d20\u7684\u6743\u91cd\u5206\u6570\u6392\u5e8f\uff0c\u652f\u6301\u8303\u56f4\u67e5\u8be2\u3002 \u5b9e\u9645\u4e0a\uff0cGEO \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5c31\u662f\u7528 Sorted Set \u6765\u5b9e\u73b0\u7684 \u7528 Sorted Set \u6765\u4fdd\u5b58\u8f66\u8f86\u7684\u7ecf\u7eac\u5ea6\u4fe1\u606f\u65f6\uff0cSorted Set \u7684\u5143\u7d20\u662f\u8f66\u8f86 ID\uff0c\u5143\u7d20\u7684\u6743\u91cd\u5206\u6570\u662f\u7ecf\u7eac\u5ea6\u4fe1\u606f\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a Sorted Set \u5143\u7d20\u7684\u6743\u91cd\u5206\u6570\u662f\u4e00\u4e2a\u6d6e\u70b9\u6570\uff08float \u7c7b\u578b\uff09\uff0c\u800c\u4e00\u7ec4\u7ecf\u7eac\u5ea6\u5305\u542b\u7684\u662f\u7ecf\u5ea6\u548c\u7eac\u5ea6\u4e24\u4e2a\u503c\uff0c\u662f\u6ca1\u6cd5\u76f4\u63a5\u4fdd\u5b58\u4e3a\u4e00\u4e2a\u6d6e\u70b9\u6570\u7684\uff0c\u90a3\u5177\u4f53\u8be5\u600e\u4e48\u8fdb\u884c\u4fdd\u5b58\u5462\uff1f \u8fd9\u5c31\u8981\u7528\u5230 GEO \u7c7b\u578b\u4e2d\u7684 GeoHash \u7f16\u7801\u4e86\u3002","title":"2-2 Sorted Set \u7c7b\u578b"},{"location":"chap3/3redis_geo/#3geohash","text":"\u4e3a\u4e86\u80fd\u9ad8\u6548\u5730\u5bf9\u7ecf\u7eac\u5ea6\u8fdb\u884c\u6bd4\u8f83\uff0cRedis \u91c7\u7528\u4e86\u4e1a\u754c\u5e7f\u6cdb\u4f7f\u7528\u7684 GeoHash \u7f16\u7801\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u7684\u57fa\u672c\u539f\u7406\u5c31\u662f\u201c\u4e8c\u5206\u533a\u95f4\uff0c\u533a\u95f4\u7f16\u7801\u201d\u3002 \u5bf9\u4e00\u7ec4\u7ecf\u7eac\u5ea6\u8fdb\u884c GeoHash \u7f16\u7801\u65f6\uff0c\u6211\u4eec\u8981\u5148\u5bf9\u7ecf\u5ea6\u548c\u7eac\u5ea6\u5206\u522b\u7f16\u7801\uff0c\u7136\u540e\u518d\u628a\u7ecf\u7eac\u5ea6\u5404\u81ea\u7684\u7f16\u7801\u7ec4\u5408\u6210\u4e00\u4e2a\u6700\u7ec8\u7f16\u7801\u3002","title":"3\u3001GeoHash \u7684\u7f16\u7801\u65b9\u6cd5"},{"location":"chap3/3redis_geo/#3-1","text":"\u5bf9\u4e8e\u4e00\u4e2a\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u6765\u8bf4\uff0c\u5b83\u7684\u7ecf\u5ea6\u8303\u56f4\u662f [-180,180] \u3002GeoHash \u7f16\u7801\u4f1a\u628a\u4e00\u4e2a\u7ecf\u5ea6\u503c\u7f16\u7801\u6210\u4e00\u4e2a N \u4f4d\u7684\u4e8c\u8fdb\u5236\u503c\uff0c\u6211\u4eec\u6765\u5bf9\u7ecf\u5ea6\u8303\u56f4 [-180,180] \u505a N \u6b21\u7684\u4e8c\u5206\u533a\u64cd\u4f5c\uff0c\u5176\u4e2d N \u53ef\u4ee5\u81ea\u5b9a\u4e49\u3002 \u5728\u8fdb\u884c\u7b2c\u4e00\u6b21\u4e8c\u5206\u533a\u65f6\uff0c\u7ecf\u5ea6\u8303\u56f4[-180,180]\u4f1a\u88ab\u5206\u6210\u4e24\u4e2a\u5b50\u533a\u95f4\uff1a [-180,0) \u548c [0,180] \uff08\u6211\u79f0\u4e4b\u4e3a\u5de6\u3001\u53f3\u5206\u533a\uff09\u3002 \u6b64\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u67e5\u770b\u4e00\u4e0b\u8981\u7f16\u7801\u7684\u7ecf\u5ea6\u503c\u843d\u5728\u4e86\u5de6\u5206\u533a\u8fd8\u662f\u53f3\u5206\u533a\u3002 \u5982\u679c\u662f\u843d\u5728\u5de6\u5206\u533a\uff0c\u6211\u4eec\u5c31\u7528 0 \u8868\u793a\uff1b\u5982\u679c\u843d\u5728\u53f3\u5206\u533a\uff0c\u5c31\u7528 1 \u8868\u793a\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u6bcf\u505a\u5b8c\u4e00\u6b21\u4e8c\u5206\u533a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f97\u5230 1 \u4f4d\u7f16\u7801\u503c\u3002 \u6211\u4eec\u518d\u5bf9\u7ecf\u5ea6\u503c\u6240\u5c5e\u7684\u5206\u533a\u518d\u505a\u4e00\u6b21\u4e8c\u5206\u533a\uff0c \u540c\u65f6\u518d\u6b21\u67e5\u770b\u7ecf\u5ea6\u503c\u843d\u5728\u4e86\u4e8c\u5206\u533a\u540e\u7684\u5de6\u5206\u533a\u8fd8\u662f\u53f3\u5206\u533a\uff0c\u6309\u7167\u521a\u624d\u7684\u89c4\u5219\u518d\u505a 1 \u4f4d\u7f16\u7801\u3002\u5f53\u505a\u5b8c N \u6b21\u7684\u4e8c\u5206\u533a\u540e\uff0c\u7ecf\u5ea6\u503c\u5c31\u53ef\u4ee5\u7528\u4e00\u4e2a N bit \u7684\u6570\u6765\u8868\u793a\u4e86\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u6211\u4eec\u8981\u7f16\u7801\u7684\u7ecf\u5ea6\u503c\u662f 116.37\uff0c\u6211\u4eec\u7528 5 \u4f4d\u7f16\u7801\u503c\uff08\u4e5f\u5c31\u662f N=5\uff0c\u505a 5 \u6b21\u5206\u533a\uff09\u3002 \u6211\u4eec\u5148\u505a\u7b2c\u4e00\u6b21\u4e8c\u5206\u533a\u64cd\u4f5c\uff0c\u628a\u7ecf\u5ea6\u533a\u95f4 [-180,180] \u5206\u6210\u4e86\u5de6\u5206\u533a [-180,0) \u548c\u53f3\u5206\u533a [0,180] \uff0c\u6b64\u65f6\uff0c\u7ecf\u5ea6\u503c 116.37 \u662f\u5c5e\u4e8e\u53f3\u5206\u533a [0,180] \uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u7528 1 \u8868\u793a\u7b2c\u4e00\u6b21\u4e8c\u5206\u533a\u540e\u7684\u7f16\u7801\u503c\u3002 * \u7b2c\u4e8c\u6b21\u4e8c\u5206\u533a\uff1a\u628a\u7ecf\u5ea6\u503c 116.37 \u6240\u5c5e\u7684 [0,180] \u533a\u95f4\uff0c\u5206\u6210 [0,90) \u548c [90, 180] \u3002 \u6b64\u65f6\uff0c\u7ecf\u5ea6\u503c 116.37 \u8fd8\u662f\u5c5e\u4e8e\u53f3\u5206\u533a [90,180] \uff0c\u6240\u4ee5\uff0c\u7b2c\u4e8c\u6b21\u5206\u533a\u540e\u7684\u7f16\u7801\u503c\u4ecd\u7136\u4e3a 1 \u3002 \u7b49\u5230\u7b2c\u4e09\u6b21\u5bf9 [90,180] \u8fdb\u884c\u4e8c\u5206\u533a\uff0c\u7ecf\u5ea6\u503c 116.37 \u843d\u5728\u4e86\u5206\u533a\u540e\u7684\u5de6\u5206\u533a [90, 135) \u4e2d\uff0c\u6240\u4ee5\uff0c\u7b2c\u4e09\u6b21\u5206\u533a\u540e\u7684\u7f16\u7801\u503c\u5c31\u662f 0\u3002 \u6309\u7167\u8fd9\u79cd\u65b9\u6cd5\uff0c\u505a\u5b8c 5 \u6b21\u5206\u533a\u540e\uff0c\u6211\u4eec\u628a\u7ecf\u5ea6\u503c 116.37 \u5b9a\u4f4d\u5728 [112.5, 123.75] \u8fd9\u4e2a\u533a\u95f4\uff0c\u5e76\u4e14\u5f97\u5230\u4e86\u7ecf\u5ea6\u503c\u7684 5 \u4f4d\u7f16\u7801\u503c\uff0c\u5373 11010\u3002 \u5bf9\u7eac\u5ea6\u7684\u7f16\u7801\u65b9\u5f0f\uff0c\u548c\u5bf9\u7ecf\u5ea6\u7684\u4e00\u6837\uff0c\u53ea\u662f\u7eac\u5ea6\u7684\u8303\u56f4\u662f[-90\uff0c90]\uff0c\u4e0b\u9762\u8fd9\u5f20\u8868\u663e\u793a\u4e86\u5bf9\u7eac\u5ea6\u503c 39.86 \u7684\u7f16\u7801\u8fc7\u7a0b\u3002 \u5f53\u4e00\u7ec4\u7ecf\u7eac\u5ea6\u503c\u90fd\u7f16\u5b8c\u7801\u540e\uff0c\u6211\u4eec\u518d\u628a\u5b83\u4eec\u7684\u5404\u81ea\u7f16\u7801\u503c\u7ec4\u5408\u5728\u4e00\u8d77\uff0c\u7ec4\u5408\u7684\u89c4\u5219\u662f\uff1a \u6700\u7ec8\u7f16\u7801\u503c\u7684\u5076\u6570\u4f4d\u4e0a\u4f9d\u6b21\u662f\u7ecf\u5ea6\u7684\u7f16\u7801\u503c\uff0c\u5947\u6570\u4f4d\u4e0a\u4f9d\u6b21\u662f\u7eac\u5ea6\u7684\u7f16\u7801\u503c\uff0c\u5176\u4e2d\uff0c\u5076\u6570\u4f4d\u4ece 0 \u5f00\u59cb\uff0c\u5947\u6570\u4f4d\u4ece 1 \u5f00\u59cb\u3002 \u8ba1\u7b97\u7684\u7ecf\u7eac\u5ea6 \uff08116.37\uff0c39.86\uff09 \u7684\u5404\u81ea\u7f16\u7801\u503c\u662f 11010 \u548c 10111 \uff0c\u7ec4\u5408\u4e4b\u540e\uff0c\u7b2c 0 \u4f4d\u662f\u7ecf\u5ea6\u7684\u7b2c 0 \u4f4d 1\uff0c\u7b2c 1 \u4f4d\u662f\u7eac\u5ea6\u7684\u7b2c 0 \u4f4d 1\uff0c\u7b2c 2 \u4f4d\u662f\u7ecf\u5ea6\u7684\u7b2c 1 \u4f4d 1\uff0c\u7b2c 3 \u4f4d\u662f\u7eac\u5ea6\u7684\u7b2c 1 \u4f4d 0\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u5c31\u80fd\u5f97\u5230\u6700\u7ec8\u7f16\u7801\u503c 1110011101 \uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u7528\u4e86 GeoHash \u7f16\u7801\u540e\uff0c\u539f\u6765\u65e0\u6cd5\u7528\u4e00\u4e2a\u6743\u91cd\u5206\u6570\u8868\u793a\u7684\u4e00\u7ec4\u7ecf\u7eac\u5ea6\uff08116.37\uff0c39.86\uff09\u5c31\u53ef\u4ee5\u7528 1110011101 \u8fd9\u4e00\u4e2a\u503c\u6765\u8868\u793a\uff0c\u5c31\u53ef\u4ee5\u4fdd\u5b58\u4e3a Sorted Set \u7684\u6743\u91cd\u5206\u6570\u4e86\u3002","title":"3-1 \u7ecf\u5ea6\u548c\u7eac\u5ea6\u7684\u5355\u72ec\u7f16\u7801\u8fc7\u7a0b"},{"location":"chap3/3redis_geo/#3-2-geohash","text":"\u5f53\u7136\uff0c\u4f7f\u7528 GeoHash \u7f16\u7801\u540e\uff0c\u6211\u4eec\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u5730\u7406\u7a7a\u95f4\u5212\u5206\u6210\u4e86\u4e00\u4e2a\u4e2a\u65b9\u683c\uff0c\u6bcf\u4e2a\u65b9\u683c\u5bf9\u5e94\u4e86 GeoHash \u4e2d\u7684\u4e00\u4e2a\u5206\u533a\u3002 \u4e3e\u4e2a\u4f8b\u5b50\u3002\u6211\u4eec\u628a\u7ecf\u5ea6\u533a\u95f4 [-180,180] \u505a\u4e00\u6b21\u4e8c\u5206\u533a\uff0c\u628a\u7eac\u5ea6\u533a\u95f4 [-90,90] \u505a\u4e00\u6b21\u4e8c\u5206\u533a\uff0c\u5c31\u4f1a\u5f97\u5230 4 \u4e2a\u5206\u533a\u3002 \u6211\u4eec\u6765\u770b\u4e0b\u5b83\u4eec\u7684\u7ecf\u5ea6\u548c\u7eac\u5ea6\u8303\u56f4\u4ee5\u53ca\u5bf9\u5e94\u7684 GeoHash \u7ec4\u5408\u7f16\u7801\u3002 \u5206\u533a\u4e00\uff1a [-180,0) \u548c [-90,0) \uff0c\u7f16\u7801 00\uff1b \u5206\u533a\u4e8c\uff1a [-180,0) \u548c [0,90] \uff0c\u7f16\u7801 01\uff1b \u5206\u533a\u4e09\uff1a [0,180] \u548c [-90,0) \uff0c\u7f16\u7801 10\uff1b \u5206\u533a\u56db\uff1a [0,180] \u548c [0,90] \uff0c\u7f16\u7801 11\u3002 \u8fd9 4 \u4e2a\u5206\u533a\u5bf9\u5e94\u4e86 4 \u4e2a\u65b9\u683c\uff0c\u6bcf\u4e2a\u65b9\u683c\u8986\u76d6\u4e86\u4e00\u5b9a\u8303\u56f4\u5185\u7684\u7ecf\u7eac\u5ea6\u503c\uff0c\u5206\u533a\u8d8a\u591a\uff0c\u6bcf\u4e2a\u65b9\u683c\u80fd\u8986\u76d6\u5230\u7684\u5730\u7406\u7a7a\u95f4\u5c31\u8d8a\u5c0f\uff0c\u4e5f\u5c31\u8d8a\u7cbe\u51c6\u3002\u6211\u4eec\u628a\u6240\u6709\u65b9\u683c\u7684\u7f16\u7801\u503c\u6620\u5c04\u5230\u4e00\u7ef4\u7a7a\u95f4\u65f6\uff0c\u76f8\u90bb\u65b9\u683c\u7684 GeoHash \u7f16\u7801\u503c\u57fa\u672c\u4e5f\u662f\u63a5\u8fd1\u7684\uff0c \u6211\u4eec\u4f7f\u7528 Sorted Set \u8303\u56f4\u67e5\u8be2\u5f97\u5230\u7684\u76f8\u8fd1\u7f16\u7801\u503c\uff0c\u5728\u5b9e\u9645\u7684\u5730\u7406\u7a7a\u95f4\u4e0a\uff0c\u4e5f\u662f\u76f8\u90bb\u7684\u65b9\u683c\uff0c\u8fd9\u5c31\u53ef\u4ee5\u5b9e\u73b0 LBS \u5e94\u7528\u201c\u641c\u7d22\u9644\u8fd1\u7684\u4eba\u6216\u7269\u201d\u7684\u529f\u80fd\u4e86\u3002 \u6709\u7684\u7f16\u7801\u503c\u867d\u7136\u5728\u5927\u5c0f\u4e0a\u63a5\u8fd1\uff0c\u4f46\u5b9e\u9645\u5bf9\u5e94\u7684\u65b9\u683c\u5374\u8ddd\u79bb\u6bd4\u8f83\u8fdc\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u7528 4 \u4f4d\u6765\u505a GeoHash \u7f16\u7801\uff0c\u628a\u7ecf\u5ea6\u533a\u95f4 [-180,180] \u548c\u7eac\u5ea6\u533a\u95f4 [-90,90] \u5404\u5206\u6210\u4e86 4 \u4e2a\u5206\u533a\uff0c\u4e00\u5171 16 \u4e2a\u5206\u533a\uff0c\u5bf9\u5e94\u4e86 16 \u4e2a\u65b9\u683c\u3002\u7f16\u7801\u503c\u4e3a 0111 \u548c 1000 \u7684\u4e24\u4e2a\u65b9\u683c\u5c31\u79bb\u5f97\u6bd4\u8f83\u8fdc\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u6240\u4ee5\uff0c\u4e3a\u4e86\u907f\u514d\u67e5\u8be2\u4e0d\u51c6\u786e\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u540c\u65f6\u67e5\u8be2\u7ed9\u5b9a\u7ecf\u7eac\u5ea6\u6240\u5728\u7684\u65b9\u683c\u5468\u56f4\u7684 4 \u4e2a\u6216 8 \u4e2a\u65b9\u683c\u3002 GEO \u7c7b\u578b\u662f\u628a\u7ecf\u7eac\u5ea6\u6240\u5728\u7684\u533a\u95f4\u7f16\u7801\u4f5c\u4e3a Sorted Set \u4e2d\u5143\u7d20\u7684\u6743\u91cd\u5206\u6570\uff0c\u628a\u548c\u7ecf\u7eac\u5ea6\u76f8\u5173\u7684\u8f66\u8f86 ID \u4f5c\u4e3a Sorted Set \u4e2d\u5143\u7d20\u672c\u8eab\u7684\u503c\u4fdd\u5b58\u4e0b\u6765\uff0c\u8fd9\u6837\u76f8\u90bb\u7ecf\u7eac\u5ea6\u7684\u67e5\u8be2\u5c31\u53ef\u4ee5\u901a\u8fc7\u7f16\u7801\u503c\u7684\u5927\u5c0f\u8303\u56f4\u67e5\u8be2\u6765\u5b9e\u73b0\u4e86","title":"3-2 GeoHash \u7f16\u7801\u5206\u533a"},{"location":"chap3/3redis_geo/#4-geo","text":"\u5728\u4f7f\u7528 GEO \u7c7b\u578b\u65f6\uff0c\u6211\u4eec\u7ecf\u5e38\u4f1a\u7528\u5230\u4e24\u4e2a\u547d\u4ee4\uff0c\u5206\u522b\u662f GEOADD \u548c GEORADIUS\u3002 GEOADD \u547d\u4ee4\uff1a\u7528\u4e8e\u628a\u4e00\u7ec4\u7ecf\u7eac\u5ea6\u4fe1\u606f\u548c\u76f8\u5bf9\u5e94\u7684\u4e00\u4e2a ID \u8bb0\u5f55\u5230 GEO \u7c7b\u578b\u96c6\u5408\u4e2d\uff1b GEORADIUS \u547d\u4ee4\uff1a\u4f1a\u6839\u636e\u8f93\u5165\u7684\u7ecf\u7eac\u5ea6\u4f4d\u7f6e\uff0c\u67e5\u627e\u4ee5\u8fd9\u4e2a\u7ecf\u7eac\u5ea6\u4e3a\u4e2d\u5fc3\u7684\u4e00\u5b9a\u8303\u56f4\u5185\u7684\u5176\u4ed6\u5143\u7d20\u3002\u5f53\u7136\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u5b9a\u4e49\u8fd9\u4e2a\u8303\u56f4\u3002 \u6211\u8fd8\u662f\u4ee5\u53eb\u8f66\u5e94\u7528\u7684\u8f66\u8f86\u5339\u914d\u573a\u666f\u4e3a\u4f8b\uff0c\u4ecb\u7ecd\u4e0b\u5177\u4f53\u5982\u4f55\u4f7f\u7528\u8fd9\u4e24\u4e2a\u547d\u4ee4\u3002 \u5047\u8bbe\u8f66\u8f86 ID \u662f 33\uff0c\u7ecf\u7eac\u5ea6\u4f4d\u7f6e\u662f \uff08116.034579\uff0c39.030452\uff09 \uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a GEO \u96c6\u5408\u4fdd\u5b58\u6240\u6709\u8f66\u8f86\u7684\u7ecf\u7eac\u5ea6\uff0c\u96c6\u5408 key \u662f cars:locations \u3002 \u6267\u884c\u4e0b\u9762\u7684\u8fd9\u4e2a\u547d\u4ee4\uff0c \u5c31\u53ef\u4ee5\u628a ID \u53f7\u4e3a 33 \u7684\u8f66\u8f86\u7684\u5f53\u524d\u7ecf\u7eac\u5ea6\u4f4d\u7f6e\u5b58\u5165 GEO \u96c6\u5408\u4e2d \uff1a GEOADD cars:locations 116.034579 39.030452 33 \u57fa\u672c\u7684\u5199\u6cd5\uff1a geoadd key longitude latitude member \u6ce8\uff1a latitude [\u02c8l\u00e6t\u026atju\u02d0d] \u7eac\u5ea6 longtitude \u7ecf\u5ea6 \u5f53\u7528\u6237\u60f3\u8981\u5bfb\u627e\u81ea\u5df1\u9644\u8fd1\u7684\u7f51\u7ea6\u8f66\u65f6\uff0cLBS \u5e94\u7528\u5c31\u53ef\u4ee5\u4f7f\u7528 GEORADIUS \u547d\u4ee4\u3002 \u4f8b\u5982\uff0cLBS \u5e94\u7528\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0cRedis \u4f1a\u6839\u636e\u8f93\u5165\u7684\u7528\u6237\u7684\u7ecf\u7eac\u5ea6\u4fe1\u606f\uff08116.054579\uff0c39.030452 \uff09\uff0c \u67e5\u627e\u4ee5\u8fd9\u4e2a\u7ecf\u7eac\u5ea6\u4e3a\u4e2d\u5fc3\u7684 5 \u516c\u91cc\u5185\u7684\u8f66\u8f86\u4fe1\u606f\uff0c\u5e76\u8fd4\u56de\u7ed9 LBS \u5e94\u7528\u3002\u5f53\u7136\uff0c \u4f60\u53ef\u4ee5\u4fee\u6539\u201c5\u201d\u8fd9\u4e2a\u53c2\u6570\uff0c\u6765\u8fd4\u56de\u66f4\u5927\u6216\u66f4\u5c0f\u8303\u56f4\u5185\u7684\u8f66\u8f86\u4fe1\u606f\u3002 GEORADIUS cars:locations 116.054579 39.030452 5 km ASC COUNT 10 \u6211\u4eec\u8fd8\u53ef\u4ee5\u8fdb\u4e00\u6b65\u9650\u5b9a\u8fd4\u56de\u7684\u8f66\u8f86\u4fe1\u606f\u3002 \u6bd4\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ASC \u9009\u9879\uff0c\u8ba9\u8fd4\u56de\u7684\u8f66\u8f86\u4fe1\u606f\u6309\u7167\u8ddd\u79bb\u8fd9\u4e2a\u4e2d\u5fc3\u4f4d\u7f6e \u4ece\u8fd1\u5230\u8fdc\u7684\u65b9\u5f0f\u6765\u6392\u5e8f\uff0c\u4ee5\u65b9\u4fbf\u9009\u62e9\u6700\u8fd1\u7684\u8f66\u8f86\uff1b","title":"4\u3001\u5982\u4f55\u64cd\u4f5c GEO \u7c7b\u578b\uff1f"},{"location":"chap3/3redis_geo/#5","text":"\u4f46\u662f\u6709\u4e9b\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u5bf9\u6570\u636e\u7c7b\u578b\u4f1a\u6709\u7279\u6b8a\u9700\u6c42\uff0c\u4f8b\u5982\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\u65e2\u80fd\u50cf Hash \u90a3\u6837\u652f\u6301\u5feb\u901f\u7684\u5355\u952e\u67e5\u8be2\uff0c\u53c8\u80fd\u50cf Sorted Set \u90a3\u6837\u652f\u6301\u8303\u56f4\u67e5\u8be2\uff0c\u6b64\u65f6\uff0c\u6211\u4eec\u4e4b\u524d\u5b66\u4e60\u7684\u8fd9\u4e9b\u6570\u636e\u7c7b\u578b\u5c31\u65e0\u6cd5\u6ee1\u8db3\u9700\u6c42\u4e86\u3002 \u4e3a\u4e86\u5b9e\u73b0\u81ea\u5b9a\u4e49\u6570\u636e\u7c7b\u578b\uff0c \u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u4e86\u89e3 Redis \u7684\u57fa\u672c\u5bf9\u8c61\u7ed3\u6784 RedisObject\uff0c\u56e0\u4e3a Redis \u952e\u503c\u5bf9\u4e2d\u7684\u6bcf\u4e00\u4e2a\u503c\u90fd\u662f\u7528 RedisObject \u4fdd\u5b58\u7684 \u3002 RedisObject \u5305\u62ec\u5143\u6570\u636e\u548c\u6307\u9488\uff1a \u5143\u6570\u636e\u7684\u4e00\u4e2a\u529f\u80fd\u5c31\u662f\u7528\u6765\u533a\u5206\u4e0d\u540c\u7684\u6570\u636e\u7c7b\u578b \u6307\u9488\u7528\u6765\u6307\u5411\u5177\u4f53\u7684\u6570\u636e\u7c7b\u578b\u7684\u503c","title":"5\u3001\u5982\u4f55\u81ea\u5b9a\u4e49\u6570\u636e\u7c7b\u578b\uff1f"},{"location":"chap3/3redis_geo/#5-1-redis","text":"RedisObject \u7684\u5185\u90e8\u7ec4\u6210\u5305\u62ec\u4e86 type \u3001 encoding \u3001 lru \u548c refcount 4 \u4e2a\u5143\u6570\u636e\uff0c\u4ee5\u53ca 1 \u4e2a *ptr \u6307\u9488\u3002 type\uff1a \u8868\u793a\u503c\u7684\u7c7b\u578b \uff0c\u6db5\u76d6\u4e86\u6211\u4eec\u524d\u9762\u5b66\u4e60\u7684\u4e94\u5927\u57fa\u672c\u7c7b\u578b\uff1b encoding \uff1a\u662f\u503c\u7684\u7f16\u7801\u65b9\u5f0f\uff0c\u7528\u6765\u8868\u793a Redis \u4e2d\u5b9e\u73b0\u5404\u4e2a\u57fa\u672c\u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff0c\u4f8b\u5982 SDS\u3001\u538b\u7f29\u5217\u8868\u3001\u54c8\u5e0c\u8868\u3001\u8df3\u8868\u7b49\uff1b lru \uff1a\u8bb0\u5f55\u4e86\u8fd9\u4e2a\u5bf9\u8c61\u6700\u540e\u4e00\u6b21\u88ab\u8bbf\u95ee\u7684\u65f6\u95f4\uff0c\u7528\u4e8e\u6dd8\u6c70\u8fc7\u671f\u7684\u952e\u503c\u5bf9\uff1b refcount \uff1a\u8bb0\u5f55\u4e86\u5bf9\u8c61\u7684\u5f15\u7528\u8ba1\u6570\uff1b *ptr \uff1a\u662f\u6307\u5411\u6570\u636e\u7684\u6307\u9488\u3002 RedisObject \u7ed3\u6784\u501f\u52a9 *ptr \u6307\u9488\uff0c\u5c31\u53ef\u4ee5\u6307\u5411\u4e0d\u540c\u7684\u6570\u636e\u7c7b\u578b \u4f8b\u5982\uff0c *ptr \u6307\u5411\u4e00\u4e2a SDS \u6216\u4e00\u4e2a\u8df3\u8868\uff0c\u5c31\u8868\u793a\u952e\u503c\u5bf9\u4e2d\u7684\u503c\u662f String \u7c7b\u578b\u6216 Sorted Set \u7c7b\u578b\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u5728\u5b9a\u4e49\u4e86\u65b0\u7684\u6570\u636e\u7c7b\u578b\u540e\uff0c\u4e5f\u53ea\u8981\u5728 RedisObject \u4e2d\u8bbe\u7f6e\u597d\u65b0\u7c7b\u578b\u7684 type \u548c encoding \uff0c\u518d\u7528 *ptr \u6307\u5411\u65b0\u7c7b\u578b\u7684\u5b9e\u73b0\uff0c\u5c31\u884c\u4e86\u3002","title":"5-1 Redis \u7684\u57fa\u672c\u5bf9\u8c61\u7ed3\u6784"},{"location":"chap3/3redis_geo/#6","text":"\u4e86\u89e3\u4e86 RedisObject \u7ed3\u6784\u540e\uff0c\u5b9a\u4e49\u4e00\u4e2a\u65b0\u7684\u6570\u636e\u7c7b\u578b\u4e5f\u5c31\u4e0d\u96be\u4e86\u3002 \u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u4e3a\u65b0\u6570\u636e\u7c7b\u578b\u5b9a\u4e49\u597d\u5b83\u7684\u5e95\u5c42\u7ed3\u6784\u3001type \u548c encoding \u5c5e\u6027\u503c\uff0c\u7136\u540e\u518d\u5b9e\u73b0\u65b0\u6570\u636e\u7c7b\u578b\u7684\u521b\u5efa\u3001\u91ca\u653e\u51fd\u6570\u548c\u57fa\u672c\u547d\u4ee4\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u4ee5\u5f00\u53d1\u4e00\u4e2a\u540d\u5b57\u53eb\u4f5c NewTypeObject \u7684\u65b0\u6570\u636e\u7c7b\u578b\u4e3a\u4f8b\uff0c\u6765\u89e3\u91ca\u4e0b\u5177\u4f53\u7684 4 \u4e2a\u64cd\u4f5c\u6b65\u9aa4\u3002","title":"6\u3001\u5f00\u53d1\u4e00\u4e2a\u65b0\u7684\u6570\u636e\u7c7b\u578b"},{"location":"chap3/3redis_geo/#6-1","text":"\u6211\u4eec\u7528 newtype.h \u6587\u4ef6\u6765\u4fdd\u5b58\u8fd9\u4e2a\u65b0\u7c7b\u578b\u7684\u5b9a\u4e49\uff0c\u5177\u4f53\u5b9a\u4e49\u7684\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a struct NewTypeObject { struct NewTypeNode *head; size_t len; }NewTypeObject; \u5176\u4e2d\uff0c NewTypeNode \u7ed3\u6784\u5c31\u662f\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u65b0\u7c7b\u578b\u7684\u5e95\u5c42\u7ed3\u6784\u3002\u6211\u4eec\u4e3a\u5e95\u5c42\u7ed3\u6784\u8bbe\u8ba1\u4e24\u4e2a\u6210\u5458\u53d8\u91cf\uff1a\u4e00\u4e2a\u662f Long \u7c7b\u578b\u7684 value \u503c\uff0c\u7528\u6765\u4fdd\u5b58\u5b9e\u9645\u6570\u636e\uff1b\u4e00\u4e2a\u662f *next \u6307\u9488\uff0c\u6307\u5411\u4e0b\u4e00\u4e2a NewTypeNode \u7ed3\u6784\u3002 struct NewTypeNode { long value; struct NewTypeNode *next; }; \u4ece\u4ee3\u7801\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c NewTypeObject \u7c7b\u578b\u7684\u5e95\u5c42\u7ed3\u6784\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a Long \u7c7b\u578b\u7684\u5355\u5411\u94fe\u8868\u3002\u5f53\u7136\uff0c\u4f60\u8fd8\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\uff0c\u628a NewTypeObject \u7684\u5e95\u5c42\u7ed3\u6784\u5b9a\u4e49\u4e3a\u5176\u4ed6\u7c7b\u578b\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8981 NewTypeObject \u7684\u67e5\u8be2\u6548\u7387\u6bd4\u94fe\u8868\u9ad8\uff0c\u5c31\u53ef\u4ee5\u628a\u5b83\u7684\u5e95\u5c42\u7ed3\u6784\u8bbe\u8ba1\u6210\u4e00\u9897 B+ \u6811\u3002","title":"6-1 \u7b2c\u4e00\u6b65\uff1a\u5b9a\u4e49\u65b0\u6570\u636e\u7c7b\u578b\u7684\u5e95\u5c42\u7ed3\u6784"},{"location":"chap3/3redis_geo/#6-2-redisobject-type","text":"\u8fd9\u4e2a\u5b9a\u4e49\u662f\u5728 Redis \u7684 server.h \u6587\u4ef6\u4e2d\u3002\u6bd4\u5982\uff0c\u6211\u4eec\u589e\u52a0\u4e00\u4e2a\u53eb\u4f5c OBJ_NEWTYPE \u7684\u5b8f\u5b9a\u4e49\uff0c\u7528\u6765\u5728\u4ee3\u7801\u4e2d\u6307\u4ee3 NewTypeObject \u8fd9\u4e2a\u65b0\u7c7b\u578b\u3002 #define OBJ_STRING 0 /* String object. */ #define OBJ_LIST 1 /* List object. */ #define OBJ_SET 2 /* Set object. */ #define OBJ_ZSET 3 /* Sorted set object. */ \u2026 #define OBJ_NEWTYPE 7","title":"6-2 \u7b2c\u4e8c\u6b65\uff1a\u5728 RedisObject \u7684 type \u5c5e\u6027\u4e2d\uff0c\u589e\u52a0\u8fd9\u4e2a\u65b0\u7c7b\u578b\u7684\u5b9a\u4e49"},{"location":"chap3/3redis_geo/#6-3","text":"Redis \u628a\u6570\u636e\u7c7b\u578b\u7684\u521b\u5efa\u548c\u91ca\u653e\u51fd\u6570\u90fd\u5b9a\u4e49\u5728\u4e86 object.c \u6587\u4ef6\u4e2d\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u589e\u52a0 NewTypeObject \u7684\u521b\u5efa\u51fd\u6570 createNewTypeObject \uff0c\u5982\u4e0b\u6240\u793a\uff1a robj *createNewTypeObject(void){ NewTypeObject *h = newtypeNew(); robj *o = createObject(OBJ_NEWTYPE,h); return o; } createNewTypeObject \u5206\u522b\u8c03\u7528\u4e86 newtypeNew \u548c createObject \u4e24\u4e2a\u51fd\u6570\uff0c\u6211\u5206\u522b\u6765\u4ecb\u7ecd\u4e0b\u3002 \u5148\u8bf4 newtypeNew \u51fd\u6570\u3002\u5b83\u662f\u7528\u6765\u4e3a\u65b0\u6570\u636e\u7c7b\u578b\u521d\u59cb\u5316\u5185\u5b58\u7ed3\u6784\u7684\u3002\u8fd9\u4e2a\u521d\u59cb\u5316\u8fc7\u7a0b\u4e3b\u8981\u662f\u7528 zmalloc \u505a\u5e95\u5c42\u7ed3\u6784\u5206\u914d\u7a7a\u95f4\uff0c\u4ee5\u4fbf\u5199\u5165\u6570\u636e\u3002 NewTypeObject *newtypeNew(void){ NewTypeObject *n = zmalloc(sizeof(*n)); n->head = NULL; n->len = 0; return n; } newtypeNew \u51fd\u6570\u6d89\u53ca\u5230\u65b0\u6570\u636e\u7c7b\u578b\u7684\u5177\u4f53\u521b\u5efa\uff0c\u800c Redis \u9ed8\u8ba4\u4f1a\u4e3a\u6bcf\u4e2a\u6570\u636e\u7c7b\u578b\u5b9a\u4e49\u4e00\u4e2a\u5355\u72ec\u6587\u4ef6\uff0c\u5b9e\u73b0\u8fd9\u4e2a\u7c7b\u578b\u7684\u521b\u5efa\u548c\u547d\u4ee4\u64cd\u4f5c\uff0c\u4f8b\u5982\uff0c t_string.c \u548c t_list.c \u5206\u522b\u5bf9\u5e94 String \u548c List \u7c7b\u578b\u3002 \u6309\u7167 Redis \u7684\u60ef\u4f8b\uff0c\u6211\u4eec\u5c31\u628a newtypeNew \u51fd\u6570\u5b9a\u4e49\u5728\u540d\u4e3a t_newtype.c \u7684\u6587\u4ef6\u4e2d\u3002 createObject \u662f Redis \u672c\u8eab\u63d0\u4f9b\u7684 RedisObject \u521b\u5efa\u51fd\u6570\uff0c\u5b83\u7684\u53c2\u6570\u662f\u6570\u636e\u7c7b\u578b\u7684 type \u548c\u6307\u5411\u6570\u636e\u7c7b\u578b\u5b9e\u73b0\u7684\u6307\u9488 *ptr \u3002 \u6211\u4eec\u7ed9 createObject \u51fd\u6570\u4e2d\u4f20\u5165\u4e86\u4e24\u4e2a\u53c2\u6570\uff0c\u5206\u522b\u662f\u65b0\u7c7b\u578b\u7684 type \u503c OBJ_NEWTYPE \uff0c\u4ee5\u53ca\u6307\u5411\u4e00\u4e2a\u521d\u59cb\u5316\u8fc7\u7684 NewTypeObject \u7684\u6307\u9488\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u521b\u5efa\u7684 RedisObject \u5c31\u80fd\u6307\u5411\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u65b0\u6570\u636e\u7c7b\u578b\u4e86\u3002 robj *createObject(int type, void *ptr) { robj *o = zmalloc(sizeof(*o)); o->type = type; o->ptr = ptr; ... return o; } \u5bf9\u4e8e\u91ca\u653e\u51fd\u6570\u6765\u8bf4\uff0c\u5b83\u662f\u521b\u5efa\u51fd\u6570\u7684\u53cd\u8fc7\u7a0b\uff0c\u662f\u7528 zfree \u547d\u4ee4\u628a\u65b0\u7ed3\u6784\u7684\u5185\u5b58\u7a7a\u95f4\u91ca\u653e\u6389\u3002","title":"6-3 \u7b2c\u4e09\u6b65\uff1a\u5f00\u53d1\u65b0\u7c7b\u578b\u7684\u521b\u5efa\u548c\u91ca\u653e\u51fd\u6570"},{"location":"chap3/3redis_geo/#6-4","text":"\u7b80\u5355\u6765\u8bf4\uff0c\u589e\u52a0\u76f8\u5e94\u7684\u547d\u4ee4\u64cd\u4f5c\u7684\u8fc7\u7a0b\u53ef\u4ee5\u5206\u6210\u4e09\u5c0f\u6b65\uff1a 1.\u5728 t_newtype.c \u6587\u4ef6\u4e2d\u589e\u52a0\u547d\u4ee4\u64cd\u4f5c\u7684\u5b9e\u73b0\u3002\u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u5b9a\u4e49 ntinsertCommand \u51fd\u6570\uff0c\u7531\u5b83\u5b9e\u73b0\u5bf9 NewTypeObject \u5355\u5411\u94fe\u8868\u7684\u63d2\u5165\u64cd\u4f5c\uff1a void ntinsertCommand(client *c){ //\u57fa\u4e8e\u5ba2\u6237\u7aef\u4f20\u9012\u7684\u53c2\u6570\uff0c\u5b9e\u73b0\u5728NewTypeObject\u94fe\u8868\u5934\u63d2\u5165\u5143\u7d20 } 2.\u5728 server.h \u6587\u4ef6\u4e2d\uff0c\u58f0\u660e\u6211\u4eec\u5df2\u7ecf\u5b9e\u73b0\u7684\u547d\u4ee4\uff0c\u4ee5\u4fbf\u5728 server.c \u6587\u4ef6\u5f15\u7528\u8fd9\u4e2a\u547d\u4ee4\uff0c\u4f8b\u5982\uff1a void ntinsertCommand(client *c) 3.\u5728 server.c \u6587\u4ef6\u4e2d\u7684 redisCommandTable \u91cc\u9762\uff0c\u628a\u65b0\u589e\u547d\u4ee4\u548c\u5b9e\u73b0\u51fd\u6570\u5173\u8054\u8d77\u6765\u3002\u4f8b\u5982\uff0c\u65b0\u589e\u7684 ntinsert \u547d\u4ee4\u7531 ntinsertCommand \u51fd\u6570\u5b9e\u73b0\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528 ntinsert \u547d\u4ee4\u7ed9 NewTypeObject \u6570\u636e\u7c7b\u578b\u63d2\u5165\u5143\u7d20\u4e86\u3002 struct redisCommand redisCommandTable[] = { ... {\"ntinsert\",ntinsertCommand,2,\"m\",...} } \u6b64\u65f6\uff0c\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684 NewTypeObject \u6570\u636e\u7c7b\u578b\uff0c\u53ef\u4ee5\u5b9e\u73b0\u57fa\u672c\u7684\u547d\u4ee4\u64cd\u4f5c\u4e86\u3002\u5f53\u7136\uff0c\u5982\u679c\u4f60\u8fd8\u5e0c\u671b\u65b0\u7684\u6570\u636e\u7c7b\u578b\u80fd\u88ab\u6301\u4e45\u5316\u4fdd\u5b58\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5728 Redis \u7684 RDB \u548c AOF \u6a21\u5757\u4e2d\u589e\u52a0\u5bf9\u65b0\u6570\u636e\u7c7b\u578b\u8fdb\u884c\u6301\u4e45\u5316\u4fdd\u5b58\u7684\u4ee3\u7801\uff0c","title":"6-4 \u7b2c\u56db\u6b65\uff1a\u5f00\u53d1\u65b0\u7c7b\u578b\u7684\u547d\u4ee4\u64cd\u4f5c"},{"location":"chap3/3redis_geo/#7","text":"GEO \u672c\u8eab\u5e76\u6ca1\u6709\u8bbe\u8ba1\u65b0\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff0c\u800c\u662f\u76f4\u63a5\u4f7f\u7528\u4e86 Sorted Set \u96c6\u5408\u7c7b\u578b\u3002 GEO \u7c7b\u578b\u4f7f\u7528 GeoHash \u7f16\u7801\u65b9\u6cd5\u5b9e\u73b0\u4e86\u7ecf\u7eac\u5ea6\u5230 Sorted Set \u4e2d\u5143\u7d20\u6743\u91cd\u5206\u6570\u7684\u8f6c\u6362\uff0c\u8fd9\u5176\u4e2d\u7684\u4e24\u4e2a\u5173\u952e\u673a\u5236\u5c31\u662f\u5bf9\u4e8c\u7ef4\u5730\u56fe\u505a\u533a\u95f4\u5212\u5206\uff0c\u4ee5\u53ca\u5bf9\u533a\u95f4\u8fdb\u884c\u7f16\u7801\u3002 \u4e00\u7ec4\u7ecf\u7eac\u5ea6\u843d\u5728\u67d0\u4e2a\u533a\u95f4\u540e\uff0c\u5c31\u7528\u533a\u95f4\u7684\u7f16\u7801\u503c\u6765\u8868\u793a\uff0c\u5e76\u628a\u7f16\u7801\u503c\u4f5c\u4e3a Sorted Se \u5143\u7d20\u7684\u6743\u91cd\u5206\u6570\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u7ecf\u7eac\u5ea6\u4fdd\u5b58\u5230 Sorted Set \u4e2d\uff0c\u5229\u7528 Sorted Set \u63d0\u4f9b\u7684\u201c\u6309\u6743\u91cd\u8fdb\u884c\u6709\u5e8f\u8303\u56f4\u67e5\u627e\u201d\u7684\u7279\u6027\uff0c\u5b9e\u73b0 LBS \u670d\u52a1\u4e2d\u9891\u7e41\u4f7f\u7528\u7684\u201c\u641c\u7d22\u9644\u8fd1\u201d\u7684\u9700\u6c42\u3002 GEO \u5c5e\u4e8e Redis \u63d0\u4f9b\u7684\u6269\u5c55\u6570\u636e\u7c7b\u578b\u3002\u6269\u5c55\u6570\u636e\u7c7b\u578b\u6709\u4e24\u79cd\u5b9e\u73b0\u9014\u5f84\uff1a \u4e00\u79cd\u662f\u57fa\u4e8e\u73b0\u6709\u7684\u6570\u636e\u7c7b\u578b\uff0c\u901a\u8fc7\u6570\u636e\u7f16\u7801\u6216\u662f\u5b9e\u73b0\u65b0\u7684\u64cd\u4f5c\u7684\u65b9\u5f0f\uff0c\u6765\u5b9e\u73b0\u6269\u5c55\u6570\u636e\u7c7b\u578b\uff0c\u4f8b\u5982\u57fa\u4e8e Sorted Set \u548c GeoHash \u7f16\u7801\u5b9e\u73b0 GEO\uff0c\u4ee5\u53ca\u57fa\u4e8e String \u548c\u4f4d\u64cd\u4f5c\u5b9e\u73b0 Bitmap\uff1b \u53e6\u4e00\u79cd\u5c31\u662f\u5f00\u53d1\u81ea\u5b9a\u4e49\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5177\u4f53\u7684\u64cd\u4f5c\u662f\u589e\u52a0\u65b0\u6570\u636e\u7c7b\u578b\u7684\u5b9a\u4e49\uff0c\u5b9e\u73b0\u521b\u5efa\u548c\u91ca\u653e\u51fd\u6570\uff0c\u5b9e\u73b0\u65b0\u6570\u636e\u7c7b\u578b\u652f\u6301\u7684\u547d\u4ee4\u64cd\u4f5c","title":"7\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap3/3redis_geo/#7-1","text":"GEO\u7684\u539f\u7406\uff0c\u8fd9\u4e2a\u662f\u6211\u4e4b\u524d\u6240\u4e0d\u77e5\u9053\u7684\uff0c\u5b66\u5b8c\u540e\u5bf9GEO\u6709\u4e86\u4e00\u4e9b\u8ba4\u77e5 Redis\u5c45\u7136\u652f\u6301\u81ea\u5b9a\u4e49\u6570\u636e\u5b58\u50a8\u7ed3\u6784\uff0c\u8fd9\u6253\u5f00\u4e86\u6211\u7684\u773c\u754c GEO\u7684\u5e95\u5c42\u5b9e\u73b0\uff0c\u662fsortSet\uff0c\u5143\u7d20\u662f\u8f66\u8f86\u4fe1\u606f\uff0c\u6743\u91cd\u662f\u8f66\u8f86\u7ecf\u7eac\u5ea6\u8f6c\u6362\u8fc7\u6765\u7684float\u503c GEOHash\u7f16\u7801\uff0c\u57fa\u672c\u539f\u7406\u201c\u4e8c\u5206\u533a\u95f4\uff0c\u533a\u95f4\u7f16\u7801\u201d\uff08\u4e8c\u5206\u6cd5\u7684\u5e94\u7528\uff0c\u5c06\u4e00\u4e2a\u503c\u7f16\u7801\u6210N\u4f4d\u7684\u4e8c\u8fdb\u5236\u503c\uff09 GEO\u4f7f\u7528GEOHash\u7f16\u7801\u540e\uff0c\u5c06\u7ecf\u7eac\u5ea6\uff0c\u6309\u7167\u7eac\u5947\u7ecf\u5076\u4f4d\u5206\u522b\u586b\u5145\u7ec4\u5408\uff0c\u5f97\u5230\u4e00\u4e2a\u8f66\u8f86\u7684\u7ecf\u7eac\u5ea6\u7f16\u7801\u503c GEOHash\u7f16\u7801\u5b9e\u73b0\u7684\u6548\u679c\u662f\u5c06\u4e00\u4e2a\u7a7a\u95f4\u5206\u5272\u6210\u4e3a\u4e00\u4e2a\u4e2a\u65b9\u5757\uff0c\u53ef\u4ee5\u5b9e\u73b0LBS\u670d\u52a1\uff08\u4f46\u7f16\u7801\u503c\u76f8\u8fd1\uff0c\u4e0d\u4e00\u5b9a\u4f4d\u7f6e\u76f8\u8fd1\uff09","title":"7-1 \u8981\u70b9&amp;\u4eae\u70b9\uff1f"},{"location":"chap3/3redis_geo/#7-2","text":"Redis \u7684 5 \u5927\u57fa\u672c\u6570\u636e\u7c7b\u578b\u548c 3 \u4e2a\u6269\u5c55\u6570\u636e\u7c7b\u578b","title":"7-2 \u6bcf\u8bfe\u4e00\u95ee"},{"location":"chap3/4redis_timeseries/","text":"\u7b2c\u56db\u8282 \u6839\u636e\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u7279\u70b9\uff0c\u9009\u62e9\u5408\u9002\u7684\u5b58\u50a8\u65b9\u6848 \u8bb0\u5f55\u7528\u6237\u5728\u7f51\u7ad9\u6216\u8005 App \u4e0a\u7684\u70b9\u51fb\u884c\u4e3a\u6570\u636e\uff0c\u6765\u5206\u6790\u7528\u6237\u884c\u4e3a\u3002\u8fd9\u91cc\u7684\u6570\u636e\u4e00\u822c\u5305\u62ec\u7528\u6237 ID\u3001\u884c\u4e3a\u7c7b\u578b\uff08\u4f8b\u5982\u6d4f\u89c8\u3001\u767b\u5f55\u3001\u4e0b\u5355\u7b49\uff09\u3001\u884c\u4e3a\u53d1\u751f\u7684\u65f6\u95f4\u6233\uff1a UserID, Type, TimeStamp \u7269\u8054\u7f51\u9879\u76ee\u7684\u6570\u636e\u5b58\u53d6\u9700\u6c42\uff0c\u548c\u8fd9\u4e2a\u5f88\u76f8\u4f3c\u3002\u6211\u4eec\u9700\u8981\u5468\u671f\u6027\u5730\u7edf\u8ba1\u8fd1\u4e07\u53f0\u8bbe\u5907\u7684\u5b9e\u65f6\u72b6\u6001\uff0c\u5305\u62ec\u8bbe\u5907 ID\u3001\u538b\u529b\u3001\u6e29\u5ea6\u3001\u6e7f\u5ea6\uff0c\u4ee5\u53ca\u5bf9\u5e94\u7684\u65f6\u95f4\u6233\uff1a DeviceID, Pressure, Temperature, Humidity, TimeStamp \u65f6\u95f4\u5e8f\u5217\u6570\u636e: \u8fd9\u4e9b\u6570\u636e\u7684\u7279\u70b9\u662f\u6ca1\u6709\u4e25\u683c\u7684\u5173\u7cfb\u6a21\u578b\uff0c\u8bb0\u5f55\u7684\u4fe1\u606f\u53ef\u4ee5\u8868\u793a\u6210\u952e\u548c\u503c\u7684\u5173\u7cfb\uff08\u4f8b\u5982\uff0c\u4e00\u4e2a\u8bbe\u5907 ID \u5bf9\u5e94\u4e00\u6761\u8bb0\u5f55\uff09\uff0c\u6240\u4ee5\uff0c\u5e76\u4e0d\u9700\u8981\u4e13\u95e8\u7528\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff08\u4f8b\u5982 MySQL\uff09\u6765\u4fdd\u5b58\u3002 1\u3001\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u8bfb\u5199\u7279\u70b9 1-1 \u5199\u5165\u7279\u70b9 \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u901a\u5e38\u662f\u6301\u7eed\u9ad8\u5e76\u53d1\u5199\u5165\u7684 \uff0c\u4f8b\u5982\uff0c\u9700\u8981\u8fde\u7eed\u8bb0\u5f55\u6570\u4e07\u4e2a\u8bbe\u5907\u7684\u5b9e\u65f6\u72b6\u6001\u503c\u3002 \u540c\u65f6\uff0c\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u5199\u5165\u4e3b\u8981\u5c31\u662f\u63d2\u5165\u65b0\u6570\u636e\uff0c\u800c\u4e0d\u662f\u66f4\u65b0\u4e00\u4e2a\u5df2\u5b58\u5728\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u4e2a\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u88ab\u8bb0\u5f55\u540e\u901a\u5e38\u5c31\u4e0d\u4f1a\u53d8\u4e86\uff0c\u56e0\u4e3a\u5b83\u5c31\u4ee3\u8868\u4e86\u4e00\u4e2a\u8bbe\u5907\u5728\u67d0\u4e2a\u65f6\u523b\u7684\u72b6\u6001\u503c \u8fd9\u79cd\u6570\u636e\u7684\u5199\u5165\u7279\u70b9\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u63d2\u5165\u6570\u636e\u5feb\uff0c\u8fd9\u5c31\u8981\u6c42\u6211\u4eec\u9009\u62e9\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5728\u8fdb\u884c\u6570\u636e\u63d2\u5165\u65f6\uff0c\u590d\u6742\u5ea6\u8981\u4f4e\uff0c\u5c3d\u91cf\u4e0d\u8981\u963b\u585e \u4f60\u53ef\u80fd\u7b2c\u4e00\u65f6\u95f4\u4f1a\u60f3\u5230\u7528 Redis \u7684 String \u3001 Hash \u7c7b\u578b\u6765\u4fdd\u5b58\uff0c\u56e0\u4e3a\u5b83\u4eec\u7684\u63d2\u5165\u590d\u6742\u5ea6\u90fd\u662f O(1)\uff0c\u662f\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002\u4f46\u662f\uff0cString \u7c7b\u578b\u5728\u8bb0\u5f55\u5c0f\u6570\u636e\u65f6\uff08\u4f8b\u5982\u521a\u624d\u4f8b\u5b50\u4e2d\u7684\u8bbe\u5907\u6e29\u5ea6\u503c\uff09\uff0c\u5143\u6570\u636e\u7684\u5185\u5b58\u5f00\u9500\u6bd4\u8f83\u5927\uff0c\u4e0d\u592a\u9002\u5408\u4fdd\u5b58\u5927\u91cf\u6570\u636e\u3002 1-2 \u201c\u8bfb\u201d\u64cd\u4f5c\u7279\u70b9 \u6211\u4eec\u5728\u67e5\u8be2\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u65f6\uff0c\u65e2\u6709\u5bf9\u5355\u6761\u8bb0\u5f55\u7684\u67e5\u8be2\uff08\u4f8b\u5982\u67e5\u8be2\u67d0\u4e2a\u8bbe\u5907\u5728\u67d0\u4e00\u4e2a\u65f6\u523b\u7684\u8fd0\u884c\u72b6\u6001\u4fe1\u606f\uff0c\u5bf9\u5e94\u7684\u5c31\u662f\u8fd9\u4e2a\u8bbe\u5907\u7684\u4e00\u6761\u8bb0\u5f55\uff09\uff0c\u4e5f\u6709\u5bf9\u67d0\u4e2a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6570\u636e\u7684\u67e5\u8be2\uff08\u4f8b\u5982\u6bcf\u5929\u65e9\u4e0a 8 \u70b9\u5230 10 \u70b9\u7684\u6240\u6709\u8bbe\u5907\u7684\u72b6\u6001\u4fe1\u606f\uff09\u3002 \u8fd8\u6709\u4e00\u4e9b\u66f4\u590d\u6742\u7684\u67e5\u8be2\uff0c \u6bd4\u5982\u5bf9\u67d0\u4e2a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6570\u636e\u505a\u805a\u5408\u8ba1\u7b97\u3002\u8fd9\u91cc\u7684\u805a\u5408\u8ba1\u7b97\uff0c\u5c31\u662f\u5bf9\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u6240\u6709\u6570\u636e\u505a\u8ba1\u7b97\uff0c\u5305\u62ec\u8ba1\u7b97\u5747\u503c\u3001\u6700\u5927 / \u6700\u5c0f\u503c\u3001\u6c42\u548c\u7b49 \u4f8b\u5982\uff0c\u6211\u4eec\u8981\u8ba1\u7b97\u67d0\u4e2a\u65f6\u95f4\u6bb5\u5185\u7684\u8bbe\u5907\u538b\u529b\u7684\u6700\u5927\u503c\uff0c\u6765\u5224\u65ad\u662f\u5426\u6709\u6545\u969c\u53d1\u751f\u3002 \u65f6\u95f4\u5e8f\u5217\u6570\u636e\u8bfb\u7684\u7279\u70b9\uff1a\u8303\u56f4\u67e5\u8be2\uff0c\u805a\u5408\u7edf\u8ba1\uff0c\u67e5\u8be2\u5feb \u4e24\u79cd\u89e3\u51b3\u65b9\u6848\uff1a 1\u3001\u57fa\u4e8eHash\u548cSorted Set\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e 2\u3001\u57fa\u4e8eRedisTimeSeries\u6a21\u5757\u5b9e\u73b0 1-3 \u8bfb\u5199\u7279\u70b9 \u9488\u5bf9\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u201c\u5199\u8981\u5feb\u201d\uff0cRedis \u7684\u9ad8\u6027\u80fd\u5199\u7279\u6027\u76f4\u63a5\u5c31\u53ef\u4ee5\u6ee1\u8db3\u4e86\uff1b \u800c\u9488\u5bf9\u201c\u67e5\u8be2\u6a21\u5f0f\u591a\u201d\uff0c\u4e5f\u5c31\u662f\u8981\u652f\u6301\u5355\u70b9\u67e5\u8be2\u3001\u8303\u56f4\u67e5\u8be2\u548c\u805a\u5408\u8ba1\u7b97\uff0cRedis \u63d0\u4f9b\u4e86\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u4e24\u79cd\u65b9\u6848\uff0c\u5206\u522b\u53ef\u4ee5\u57fa\u4e8e Hash \u548c Sorted Set \u5b9e\u73b0\uff0c\u4ee5\u53ca\u57fa\u4e8e RedisTimeSeries \u6a21\u5757\u5b9e\u73b0\u3002 2\u3001\u57fa\u4e8e Hash \u548c Sorted Set \u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e Hash \u548c Sorted Set \u7ec4\u5408\u7684\u65b9\u5f0f\u6709\u4e00\u4e2a\u660e\u663e\u7684\u597d\u5904\uff1a\u5b83\u4eec\u662f Redis \u5185\u5728\u7684\u6570\u636e\u7c7b\u578b\uff0c\u4ee3\u7801\u6210\u719f\u548c\u6027\u80fd\u7a33\u5b9a\u3002 \u4e3a\u4ec0\u4e48\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u8981\u540c\u65f6\u4f7f\u7528\u8fd9\u4e24\u79cd\u7c7b\u578b\uff1f\u8fd9\u662f\u6211\u4eec\u8981\u56de\u7b54\u7684\u7b2c\u4e00\u4e2a\u95ee\u9898\u3002 2-1 Hash \u7c7b\u578b\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217 \u5173\u4e8e Hash \u7c7b\u578b\uff0c\u6211\u4eec\u90fd\u77e5\u9053\uff0c\u5b83\u6709\u4e00\u4e2a\u7279\u70b9\u662f\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5bf9\u5355\u952e\u7684\u5feb\u901f\u67e5\u8be2\u3002\u8fd9\u5c31\u6ee1\u8db3\u4e86\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u5355\u952e\u67e5\u8be2\u9700\u6c42\u3002 \u6211\u4eec\u53ef\u4ee5\u628a\u65f6\u95f4\u6233\u4f5c\u4e3a Hash \u96c6\u5408\u7684 key\uff0c\u628a\u8bb0\u5f55\u7684\u8bbe\u5907\u72b6\u6001\u503c\u4f5c\u4e3a Hash \u96c6\u5408\u7684 value \u3002 Hash \u96c6\u5408\u8bb0\u5f55\u8bbe\u5907\u7684\u6e29\u5ea6\u503c\u7684\u793a\u610f\u56fe\uff1a \u5f53\u6211\u4eec\u60f3\u8981\u67e5\u8be2\u67d0\u4e2a\u65f6\u95f4\u70b9\u6216\u8005\u662f\u591a\u4e2a\u65f6\u95f4\u70b9\u4e0a\u7684\u6e29\u5ea6\u6570\u636e\u65f6\uff0c\u76f4\u63a5\u4f7f\u7528 HGET \u547d\u4ee4\u6216\u8005 HMGET \u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u5206\u522b\u83b7\u5f97 Hash \u96c6\u5408\u4e2d\u7684\u4e00\u4e2a key \u548c\u591a\u4e2a key \u7684 value \u503c\u4e86\u3002 \u4e3e\u4e2a\u4f8b\u5b50\u3002\u6211\u4eec\u7528 HGET \u547d\u4ee4\u67e5\u8be2 202008030905 \u8fd9\u4e2a\u65f6\u523b\u7684\u6e29\u5ea6\u503c\uff0c\u4f7f\u7528 HMGET \u67e5\u8be2 202008030905\u3001202008030907\u3001202008030908 \u8fd9\u4e09\u4e2a\u65f6\u523b\u7684\u6e29\u5ea6\u503c\uff0c\u5982\u4e0b\u6240\u793a\uff1a HGET device:temperature 202008030905 \"25.1\" HMGET device:temperature 202008030905 202008030907 202008030908 1) \"25.1\" 2) \"25.9\" 3) \"24.9\" Hash \u7c7b\u578b\u6709\u4e2a\u77ed\u677f\uff1a\u5b83\u5e76\u4e0d\u652f\u6301\u5bf9\u6570\u636e\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\u3002 \u867d\u7136\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u662f\u6309\u65f6\u95f4\u9012\u589e\u987a\u5e8f\u63d2\u5165 Hash \u96c6\u5408\u4e2d\u7684\uff0c \u4f46 Hash \u7c7b\u578b\u7684\u5e95\u5c42\u7ed3\u6784\u662f\u54c8\u5e0c\u8868\uff0c\u5e76\u6ca1\u6709\u5bf9\u6570\u636e\u8fdb\u884c\u6709\u5e8f\u7d22\u5f15\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u8981\u5bf9 Hash \u7c7b\u578b\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u626b\u63cf Hash \u96c6\u5408\u4e2d\u7684\u6240\u6709\u6570\u636e\uff0c\u518d\u628a\u8fd9\u4e9b\u6570\u636e\u53d6\u56de\u5230\u5ba2\u6237\u7aef\u8fdb\u884c\u6392\u5e8f\uff0c\u7136\u540e\uff0c\u624d\u80fd\u5728\u5ba2\u6237\u7aef\u5f97\u5230\u6240\u67e5\u8be2\u8303\u56f4\u5185\u7684\u6570\u636e\u3002\u663e\u7136\uff0c\u67e5\u8be2\u6548\u7387\u5f88\u4f4e\u3002 2-2 Sorted Set \u6765\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217 \u4e3a\u4e86\u80fd\u540c\u65f6\u652f\u6301\u6309\u65f6\u95f4\u6233\u8303\u56f4\u7684\u67e5\u8be2\uff0c\u53ef\u4ee5\u7528 Sorted Set \u6765\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u56e0\u4e3a\u5b83\u80fd\u591f\u6839\u636e\u5143\u7d20\u7684\u6743\u91cd\u5206\u6570\u6765\u6392\u5e8f\u3002 \u6211\u4eec\u53ef\u4ee5\u628a\u65f6\u95f4\u6233\u4f5c\u4e3a Sorted Set \u96c6\u5408\u7684\u5143\u7d20\u5206\u6570\uff0c\u628a\u65f6\u95f4\u70b9\u4e0a\u8bb0\u5f55\u7684\u6570\u636e\u4f5c\u4e3a\u5143\u7d20\u672c\u8eab\u3002 \u4e0b\u56fe\u663e\u793a\u4e86\u7528 Sorted Set \u96c6\u5408\u4fdd\u5b58\u7684\u7ed3\u679c\u3002 \u4f7f\u7528 Sorted Set \u4fdd\u5b58\u6570\u636e\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528 ZRANGEBYSCORE \u547d\u4ee4\uff0c\u6309\u7167\u8f93\u5165\u7684\u6700\u5927\u65f6\u95f4\u6233\u548c\u6700\u5c0f\u65f6\u95f4\u6233\u6765\u67e5\u8be2\u8fd9\u4e2a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6e29\u5ea6\u503c\u4e86\u3002\u5982\u4e0b\u6240\u793a\uff0c\u6211\u4eec\u6765\u67e5\u8be2\u4e00\u4e0b\u5728 2020 \u5e74 8 \u6708 3 \u65e5 9 \u70b9 7 \u5206\u5230 9 \u70b9 10 \u5206\u95f4\u7684\u6240\u6709\u6e29\u5ea6\u503c\uff1a ZRANGEBYSCORE device:temperature 202008030907 202008030910 1) \"25.9\" 2) \"24.9\" 3) \"25.3\" 4) \"25.2\" \u540c\u65f6\u4f7f\u7528 Hash \u548c Sorted Set\uff0c\u53ef\u4ee5\u6ee1\u8db3\u5355\u4e2a\u65f6\u95f4\u70b9\u548c\u4e00\u4e2a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6570\u636e\u67e5\u8be2\u9700\u6c42\u4e86\uff0c\u4f46\u662f\u6211\u4eec\u53c8\u4f1a\u9762\u4e34\u4e00\u4e2a\u65b0\u7684\u95ee\u9898\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u8981\u89e3\u7b54\u7684\u7b2c\u4e8c\u4e2a\u95ee\u9898\uff1a \u5982\u4f55\u4fdd\u8bc1\u5199\u5165 Hash \u548c Sorted Set \u662f\u4e00\u4e2a\u539f\u5b50\u6027\u7684\u64cd\u4f5c\u5462\uff1f 2-3 \u539f\u5b50\u6027\u7684\u64cd\u4f5c \u6267\u884c\u591a\u4e2a\u5199\u547d\u4ee4\u64cd\u4f5c\u65f6\uff08\u4f8b\u5982\u7528 HSET \u547d\u4ee4\u548c ZADD \u547d\u4ee4\u5206\u522b\u628a\u6570\u636e\u5199\u5165 Hash \u548c Sorted Set\uff09\uff0c\u8fd9\u4e9b\u547d\u4ee4\u64cd\u4f5c\u8981\u4e48\u5168\u90e8\u5b8c\u6210\uff0c\u8981\u4e48\u90fd\u4e0d\u5b8c\u6210\u3002 \u53ea\u6709\u4fdd\u8bc1\u4e86\u5199\u64cd\u4f5c\u7684\u539f\u5b50\u6027\uff0c\u624d\u80fd\u4fdd\u8bc1\u540c\u4e00\u4e2a\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u5728 Hash \u548c Sorted Set \u4e2d\uff0c\u8981\u4e48\u90fd\u4fdd\u5b58\u4e86\uff0c\u8981\u4e48\u90fd\u6ca1\u4fdd\u5b58\u3002\u5426\u5219\uff0c \u5c31\u53ef\u80fd\u51fa\u73b0 Hash \u96c6\u5408\u4e2d\u6709\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u800c Sorted Set \u4e2d\u6ca1\u6709\uff0c\u90a3\u4e48\uff0c\u5728\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u5c31\u6ca1\u6709\u529e\u6cd5\u6ee1\u8db3\u67e5\u8be2\u9700\u6c42\u4e86 \u3002 \u90a3 Redis \u662f\u600e\u4e48\u4fdd\u8bc1\u539f\u5b50\u6027\u64cd\u4f5c\u7684\u5462\uff1f \u8fd9\u91cc\u5c31\u6d89\u53ca\u5230\u4e86 Redis \u7528\u6765\u5b9e\u73b0\u7b80\u5355\u7684\u4e8b\u52a1\u7684 MULTI \u548c EXEC \u547d\u4ee4\u3002\u5f53\u591a\u4e2a\u547d\u4ee4\u53ca\u5176\u53c2\u6570\u672c\u8eab\u65e0\u8bef\u65f6\uff0c MULTI \u548c EXEC \u547d\u4ee4\u53ef\u4ee5\u4fdd\u8bc1\u6267\u884c\u8fd9\u4e9b\u547d\u4ee4\u65f6\u7684\u539f\u5b50\u6027\u3002 MULTI \u547d\u4ee4\uff1a\u8868\u793a\u4e00\u7cfb\u5217\u539f\u5b50\u6027\u64cd\u4f5c\u7684\u5f00\u59cb \u3002\u6536\u5230\u8fd9\u4e2a\u547d\u4ee4\u540e\uff0cRedis \u5c31\u77e5\u9053\uff0c\u63a5\u4e0b\u6765\u518d\u6536\u5230\u7684\u547d\u4ee4\u9700\u8981\u653e\u5230\u4e00\u4e2a\u5185\u90e8\u961f\u5217\u4e2d\uff0c\u540e\u7eed\u4e00\u8d77\u6267\u884c\uff0c\u4fdd\u8bc1\u539f\u5b50\u6027\u3002 EXEC \u547d\u4ee4\uff1a\u8868\u793a\u4e00\u7cfb\u5217\u539f\u5b50\u6027\u64cd\u4f5c\u7684\u7ed3\u675f\u3002 \u4e00\u65e6 Redis \u6536\u5230\u4e86\u8fd9\u4e2a\u547d\u4ee4\uff0c\u5c31\u8868\u793a\u6240\u6709\u8981\u4fdd\u8bc1\u539f\u5b50\u6027\u7684\u547d\u4ee4\u64cd\u4f5c\u90fd\u5df2\u7ecf\u53d1\u9001\u5b8c\u6210\u4e86\u3002\u6b64\u65f6\uff0cRedis \u5f00\u59cb\u6267\u884c\u521a\u624d\u653e\u5230\u5185\u90e8\u961f\u5217\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u64cd\u4f5c\u3002 \u547d\u4ee4 1 \u5230\u547d\u4ee4 N \u662f\u5728 MULTI \u547d\u4ee4\u540e\u3001EXEC \u547d\u4ee4\u524d\u53d1\u9001\u7684\uff0c\u5b83\u4eec\u4f1a\u88ab\u4e00\u8d77\u6267\u884c\uff0c\u4fdd\u8bc1\u539f\u5b50\u6027\u3002 \u4ee5\u4fdd\u5b58\u8bbe\u5907\u72b6\u6001\u4fe1\u606f\u7684\u9700\u6c42\u4e3a\u4f8b\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u628a\u8bbe\u5907\u5728 2020 \u5e74 8 \u6708 3 \u65e5 9 \u65f6 5 \u5206\u7684\u6e29\u5ea6\uff0c \u5206\u522b\u7528 HSET \u547d\u4ee4\u548c ZADD \u547d\u4ee4\u5199\u5165 Hash \u96c6\u5408\u548c Sorted Set \u96c6\u5408 \u3002 127.0.0.1:6379> MULTI OK 127.0.0.1:6379> HSET device:temperature 202008030911 26.8 QUEUED 127.0.0.1:6379> ZADD device:temperature 202008030911 26.8 QUEUED 127.0.0.1:6379> EXEC 1) (integer) 1 2) (integer) 1 \u9996\u5148\uff0cRedis \u6536\u5230\u4e86\u5ba2\u6237\u7aef\u6267\u884c\u7684 MULTI \u547d\u4ee4\u3002 \u7136\u540e\uff0c\u5ba2\u6237\u7aef\u518d\u6267\u884c HSET \u548c ZADD \u547d\u4ee4\u540e\uff0c Redis \u8fd4\u56de\u7684\u7ed3\u679c\u4e3a \u201cQUEUED \u201d\uff0c\u8868\u793a\u8fd9\u4e24\u4e2a\u547d\u4ee4\u6682\u65f6\u5165\u961f\uff0c\u5148\u4e0d\u6267\u884c\uff1b \u6267\u884c\u4e86 EXEC \u547d\u4ee4\u540e\uff0c HSET \u547d\u4ee4\u548c ZADD \u547d\u4ee4\u624d\u771f\u6b63\u6267\u884c\uff0c\u5e76\u8fd4\u56de\u6210\u529f\u7ed3\u679c\uff08\u7ed3\u679c\u503c\u4e3a 1\uff09\u3002 3\u3001\u5982\u4f55\u5bf9\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\uff1f 3-1 \u805a\u5408\u8ba1\u7b97 \u805a\u5408\u8ba1\u7b97\u4e00\u822c\u88ab\u7528\u6765\u5468\u671f\u6027\u5730\u7edf\u8ba1\u65f6\u95f4\u7a97\u53e3\u5185\u7684\u6570\u636e\u6c47\u603b\u72b6\u6001\uff0c\u5728\u5b9e\u65f6\u76d1\u63a7\u4e0e\u9884\u8b66\u7b49\u573a\u666f\u4e0b\u4f1a\u9891\u7e41\u6267\u884c\u3002 \u7269\u8054\u7f51\u9879\u76ee\u4e2d\uff0c\u5c31\u9700\u8981\u6bcf 3 \u5206\u949f\u7edf\u8ba1\u4e00\u4e0b\u5404\u4e2a\u8bbe\u5907\u7684\u6e29\u5ea6\u72b6\u6001\uff0c\u4e00\u65e6\u8bbe\u5907\u6e29\u5ea6\u8d85\u51fa\u4e86\u8bbe\u5b9a\u7684\u9608\u503c\uff0c\u5c31\u8981\u8fdb\u884c\u62a5\u8b66\u3002\u8fd9\u662f\u4e00\u4e2a\u5178\u578b\u7684\u805a\u5408\u8ba1\u7b97\u573a\u666f\uff0c\u6211\u4eec\u53ef\u4ee5\u6765\u770b\u770b\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u7684\u6570\u636e\u4f53\u91cf \u5047\u8bbe\u6211\u4eec\u9700\u8981\u6bcf 3 \u5206\u949f\u8ba1\u7b97\u4e00\u6b21\u7684\u6240\u6709\u8bbe\u5907\u5404\u6307\u6807\u7684\u6700\u5927\u503c\uff0c\u6bcf\u4e2a\u8bbe\u5907\u6bcf 15 \u79d2\u8bb0\u5f55\u4e00\u4e2a\u6307\u6807\u503c\uff0c1 \u5206\u949f\u5c31\u4f1a\u8bb0\u5f55 4 \u4e2a\u503c\uff0c3 \u5206\u949f\u5c31\u4f1a\u6709 12 \u4e2a\u503c\u3002\u6211\u4eec\u8981\u7edf\u8ba1\u7684\u8bbe\u5907\u6307\u6807\u6570\u91cf\u6709 33 \u4e2a\uff0c\u6240\u4ee5\uff0c\u5355\u4e2a\u8bbe\u5907\u6bcf 3 \u5206\u949f\u8bb0\u5f55\u7684\u6307\u6807\u6570\u636e\u6709\u5c06\u8fd1 400 \u4e2a \uff0833 * 12 = 396\uff09 \uff0c\u800c\u8bbe\u5907\u603b\u6570\u91cf\u6709 1 \u4e07\u53f0\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u6bcf 3 \u5206\u949f\u5c31\u6709\u5c06\u8fd1 400 \u4e07\u6761 \uff08396 * 1 \u4e07 = 396 \u4e07\uff09 \u6570\u636e\u9700\u8981\u5728\u5ba2\u6237\u7aef\u548c Redis \u5b9e\u4f8b\u95f4\u8fdb\u884c\u4f20\u8f93\u3002 \u4e3a\u4e86\u907f\u514d\u5ba2\u6237\u7aef\u548c Redis \u5b9e\u4f8b\u95f4\u9891\u7e41\u7684\u5927\u91cf\u6570\u636e\u4f20\u8f93\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 RedisTimeSeries \u6765\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u3002 3-2 \u805a\u5408\u8ba1\u7b97 RedisTimeSeries \u652f\u6301\u76f4\u63a5\u5728 Redis \u5b9e\u4f8b\u4e0a\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\u3002 \u8fd8\u662f\u4ee5\u521a\u624d\u6bcf 3 \u5206\u949f\u7b97\u4e00\u6b21\u6700\u5927\u503c\u4e3a\u4f8b\u3002\u5728 Redis \u5b9e\u4f8b\u4e0a\u76f4\u63a5\u805a\u5408\u8ba1\u7b97\uff0c\u90a3\u4e48\uff0c\u5bf9\u4e8e\u5355\u4e2a\u8bbe\u5907\u7684\u4e00\u4e2a\u6307\u6807\u503c\u6765\u8bf4\uff0c\u6bcf 3 \u5206\u949f\u8bb0\u5f55\u7684 12 \u6761\u6570\u636e\u53ef\u4ee5\u805a\u5408\u8ba1\u7b97\u6210\u4e00\u4e2a\u503c\uff0c\u5355\u4e2a\u8bbe\u5907\u6bcf 3 \u5206\u949f\u4e5f\u5c31\u53ea\u6709 33 \u4e2a\u805a\u5408\u503c\u9700\u8981\u4f20\u8f93\uff0c1 \u4e07\u53f0\u8bbe\u5907\u4e5f\u53ea\u6709 33 \u4e07\u6761\u6570\u636e\u3002\u6570\u636e\u91cf\u5927\u7ea6\u662f\u5728\u5ba2\u6237\u7aef\u505a\u805a\u5408\u8ba1\u7b97\u7684\u5341\u5206\u4e4b\u4e00\uff0c\u5f88\u663e\u7136\uff0c\u53ef\u4ee5\u51cf\u5c11\u5927\u91cf\u6570\u636e\u4f20\u8f93\u5bf9 Redis \u5b9e\u4f8b\u7f51\u7edc\u7684\u6027\u80fd\u5f71\u54cd\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u6211\u4eec\u53ea\u9700\u8981\u8fdb\u884c\u5355\u4e2a\u65f6\u95f4\u70b9\u67e5\u8be2\u6216\u662f\u5bf9\u67d0\u4e2a\u65f6\u95f4\u8303\u56f4\u67e5\u8be2\u7684\u8bdd\uff0c\u9002\u5408\u4f7f\u7528 Hash \u548c Sorted Set \u7684\u7ec4\u5408\uff0c\u5b83\u4eec\u90fd\u662f Redis \u7684\u5185\u5728\u6570\u636e\u7ed3\u6784\uff0c\u6027\u80fd\u597d\uff0c\u7a33\u5b9a\u6027\u9ad8\u3002 \u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u9700\u8981\u8fdb\u884c\u5927\u91cf\u7684\u805a\u5408\u8ba1\u7b97\uff0c\u540c\u65f6\u7f51\u7edc\u5e26\u5bbd\u6761\u4ef6\u4e0d\u662f\u592a\u597d\u65f6\uff0cHash \u548c Sorted Set \u7684\u7ec4\u5408\u5c31\u4e0d\u592a\u9002\u5408\u4e86\u3002\u6b64\u65f6\uff0c\u4f7f\u7528 RedisTimeSeries \u5c31\u66f4\u52a0\u5408\u9002\u4e00\u4e9b\u3002 4\u3001\u57fa\u4e8e RedisTimeSeries \u6a21\u5757\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e RedisTimeSeries \u662f Redis \u7684\u4e00\u4e2a\u6269\u5c55\u6a21\u5757\u3002 \u5b83 \u4e13\u95e8\u9762\u5411\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u63d0\u4f9b\u4e86\u6570\u636e\u7c7b\u578b\u548c\u8bbf\u95ee\u63a5\u53e3\uff0c\u5e76\u4e14\u652f\u6301\u5728 Redis \u5b9e\u4f8b\u4e0a\u76f4\u63a5\u5bf9\u6570\u636e\u8fdb\u884c\u6309\u65f6\u95f4\u8303\u56f4\u7684\u805a\u5408\u8ba1\u7b97\u3002 \u56e0\u4e3a RedisTimeSeries \u4e0d\u5c5e\u4e8e Redis \u7684\u5185\u5efa\u529f\u80fd\u6a21\u5757\uff0c\u5728\u4f7f\u7528\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5148\u628a\u5b83\u7684\u6e90\u7801\u5355\u72ec\u7f16\u8bd1\u6210\u52a8\u6001\u94fe\u63a5\u5e93 redistimeseries.so \uff0c\u518d\u4f7f\u7528 loadmodule \u547d\u4ee4\u8fdb\u884c\u52a0\u8f7d\uff0c\u5982\u4e0b\u6240\u793a\uff1a loadmodule redistimeseries.so \u5f53\u7528\u4e8e\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u5b58\u53d6\u65f6\uff0cRedisTimeSeries \u7684\u64cd\u4f5c\u4e3b\u8981\u6709 5 \u4e2a\uff1a \u7528 TS.CREATE \u547d\u4ee4\u521b\u5efa\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u96c6\u5408\uff1b \u7528 TS.ADD \u547d\u4ee4\u63d2\u5165\u6570\u636e\uff1b \u7528 TS.GET \u547d\u4ee4\u8bfb\u53d6\u6700\u65b0\u6570\u636e\uff1b \u7528 TS.MGET \u547d\u4ee4\u6309\u6807\u7b7e\u8fc7\u6ee4\u67e5\u8be2\u6570\u636e\u96c6\u5408\uff1b \u7528 TS.RANGE \u652f\u6301\u805a\u5408\u8ba1\u7b97\u7684\u8303\u56f4\u67e5\u8be2\u3002 \u4e0b\u9762\uff0c\u6211\u6765\u4ecb\u7ecd\u4e00\u4e0b\u5982\u4f55\u4f7f\u7528\u8fd9 5 \u4e2a\u64cd\u4f5c\u3002 4-1 \u7528 TS.CREATE \u547d\u4ee4\u521b\u5efa\u4e00\u4e2a\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u96c6\u5408 \u5728 TS.CREATE \u547d\u4ee4\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u8bbe\u7f6e\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u96c6\u5408\u7684 key \u548c\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\uff08\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\uff09\u3002\u6b64\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4e3a\u6570\u636e\u96c6\u5408\u8bbe\u7f6e\u6807\u7b7e\uff0c\u6765\u8868\u793a\u6570\u636e\u96c6\u5408\u7684\u5c5e\u6027\u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u521b\u5efa\u4e00\u4e2a key \u4e3a device:temperature \u3001\u6570\u636e\u6709\u6548\u671f\u4e3a 600s \u7684\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u96c6\u5408\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u4e2a\u96c6\u5408\u4e2d\u7684\u6570\u636e\u521b\u5efa\u4e86 600s \u540e\uff0c\u5c31\u4f1a\u88ab\u81ea\u52a8\u5220\u9664\u3002 \u6700\u540e\uff0c\u6211\u4eec\u7ed9\u8fd9\u4e2a\u96c6\u5408\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u6807\u7b7e\u5c5e\u6027 {device_id:1} \uff0c\u8868\u660e\u8fd9\u4e2a\u6570\u636e\u96c6\u5408\u4e2d\u8bb0\u5f55\u7684\u662f\u5c5e\u4e8e\u8bbe\u5907 ID \u53f7\u4e3a 1 \u7684\u6570\u636e\u3002 TS.CREATE device:temperature RETENTION 600000 LABELS device_id 1 OK 4-2 \u7528 TS.ADD \u547d\u4ee4\u63d2\u5165\u6570\u636e\uff0c\u7528 TS.GET \u547d\u4ee4\u8bfb\u53d6\u6700\u65b0\u6570\u636e \u6211\u4eec\u53ef\u4ee5\u7528 TS.ADD \u547d\u4ee4\u5f80\u65f6\u95f4\u5e8f\u5217\u96c6\u5408\u4e2d\u63d2\u5165\u6570\u636e\uff0c\u5305\u62ec\u65f6\u95f4\u6233\u548c\u5177\u4f53\u7684\u6570\u503c\uff0c \u5e76\u4f7f\u7528 TS.GET \u547d\u4ee4\u8bfb\u53d6\u6570\u636e\u96c6\u5408\u4e2d\u7684\u6700\u65b0\u4e00\u6761\u6570\u636e\u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u5217 TS.ADD \u547d\u4ee4\u65f6\uff0c\u5c31\u5f80 device:temperature \u96c6\u5408\u4e2d\u63d2\u5165\u4e86\u4e00\u6761\u6570\u636e\uff0c\u8bb0\u5f55\u7684\u662f\u8bbe\u5907\u5728 2020 \u5e74 8 \u6708 3 \u65e5 9 \u65f6 5 \u5206\u7684\u8bbe\u5907\u6e29\u5ea6\uff1b \u518d\u6267\u884c TS.GET \u547d\u4ee4\u65f6\uff0c\u5c31\u4f1a\u628a\u521a\u521a\u63d2\u5165\u7684\u6700\u65b0\u6570\u636e\u8bfb\u53d6\u51fa\u6765 TS.ADD device:temperature 1596416700 25.1 1596416700 TS.GET device:temperature 25.1 4-3 \u7528 TS.MGET \u547d\u4ee4\u6309\u6807\u7b7e\u8fc7\u6ee4\u67e5\u8be2\u6570\u636e\u96c6\u5408 \u5728\u4fdd\u5b58\u591a\u4e2a\u8bbe\u5907\u7684\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u65f6\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u628a\u4e0d\u540c\u8bbe\u5907\u7684\u6570\u636e\u4fdd\u5b58\u5230\u4e0d\u540c\u96c6\u5408\u4e2d\u3002 \u6b64\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528 TS.MGET \u547d\u4ee4\uff0c\u6309\u7167\u6807\u7b7e\u67e5\u8be2\u90e8\u5206\u96c6\u5408\u4e2d\u7684\u6700\u65b0\u6570\u636e \u3002 \u5728\u4f7f\u7528 TS.CREATE \u521b\u5efa\u6570\u636e\u96c6\u5408\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u7ed9\u96c6\u5408\u8bbe\u7f6e\u6807\u7b7e\u5c5e\u6027\u3002 \u5f53\u6211\u4eec\u8fdb\u884c\u67e5\u8be2\u65f6\uff0c\u5c31\u53ef\u4ee5\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9\u96c6\u5408\u6807\u7b7e\u5c5e\u6027\u8fdb\u884c\u5339\u914d\uff0c\u6700\u540e\u7684\u67e5\u8be2\u7ed3\u679c\u91cc\u53ea\u8fd4\u56de\u5339\u914d\u4e0a\u7684\u96c6\u5408\u4e2d\u7684\u6700\u65b0\u6570\u636e\u3002 \u4e3e\u4e2a\u4f8b\u5b50\u3002\u5047\u8bbe\u6211\u4eec\u4e00\u5171\u7528 4 \u4e2a\u96c6\u5408\u4e3a 4 \u4e2a\u8bbe\u5907\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u8bbe\u5907\u7684 ID \u53f7\u662f 1\u30012\u30013\u30014\uff0c\u6211\u4eec\u5728\u521b\u5efa\u6570\u636e\u96c6\u5408\u65f6\uff0c\u628a device_id \u8bbe\u7f6e\u4e3a\u6bcf\u4e2a\u96c6\u5408\u7684\u6807\u7b7e\u3002 \u6b64\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e0b\u5217 TS.MGET \u547d\u4ee4\uff0c\u4ee5\u53ca FILTER \u8bbe\u7f6e\uff08\u8fd9\u4e2a\u914d\u7f6e\u9879\u7528\u6765\u8bbe\u7f6e\u96c6\u5408\u6807\u7b7e\u7684\u8fc7\u6ee4\u6761\u4ef6\uff09\uff0c\u67e5\u8be2 device_id \u4e0d\u7b49\u4e8e 2 \u7684\u6240\u6709\u5176\u4ed6\u8bbe\u5907\u7684\u6570\u636e\u96c6\u5408\uff0c\u5e76\u8fd4\u56de\u5404\u81ea\u96c6\u5408\u4e2d\u7684\u6700\u65b0\u7684\u4e00\u6761\u6570\u636e\u3002 TS.MGET FILTER device_id!=2 1) 1) \"device:temperature:1\" 2) (empty list or set) 3) 1) (integer) 1596417000 2) \"25.3\" 2) 1) \"device:temperature:3\" 2) (empty list or set) 3) 1) (integer) 1596417000 2) \"29.5\" 3) 1) \"device:temperature:4\" 2) (empty list or set) 3) 1) (integer) 1596417000 2) \"30.1\" 4-4 \u7528 TS.RANGE \u652f\u6301\u9700\u8981\u805a\u5408\u8ba1\u7b97\u7684\u8303\u56f4\u67e5\u8be2 \u6700\u540e\uff0c\u5728\u5bf9\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 TS.RANGE \u547d\u4ee4\u6307\u5b9a\u8981\u67e5\u8be2\u7684\u6570\u636e\u7684\u65f6\u95f4\u8303\u56f4\uff0c\u540c\u65f6\u7528 AGGREGATION \u53c2\u6570\u6307\u5b9a\u8981\u6267\u884c\u7684\u805a\u5408\u8ba1\u7b97\u7c7b\u578b\u3002 RedisTimeSeries \u652f\u6301\u7684\u805a\u5408\u8ba1\u7b97\u7c7b\u578b\u5f88\u4e30\u5bcc\uff0c\u5305\u62ec\u6c42\u5747\u503c\uff08avg\uff09\u3001\u6c42\u6700\u5927 / \u6700\u5c0f\u503c\uff08max/min\uff09\uff0c\u6c42\u548c\uff08sum\uff09\u7b49\u3002 \u4f8b\u5982\uff0c\u5728\u6267\u884c\u4e0b\u5217\u547d\u4ee4\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6309\u7167\u6bcf 180s \u7684\u65f6\u95f4\u7a97\u53e3\uff0c\u5bf9 2020 \u5e74 8 \u6708 3 \u65e5 9 \u65f6 5 \u5206\u548c 2020 \u5e74 8 \u6708 3 \u65e5 9 \u65f6 12 \u5206\u8fd9\u6bb5\u65f6\u95f4\u5185\u7684\u6570\u636e\u8fdb\u884c\u5747\u503c\u8ba1\u7b97\u4e86\u3002 TS.RANGE device:temperature 1596416700 1596417120 AGGREGATION avg 180000 1) 1) (integer) 1596416700 2) \"25.6\" 2) 1) (integer) 1596416880 2) \"25.8\" 3) 1) (integer) 1596417060 2) \"26.1\" \u4e0e\u4f7f\u7528 Hash \u548c Sorted Set \u6765\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u76f8\u6bd4\uff0cRedisTimeSeries \u662f\u4e13\u95e8\u4e3a\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u8bbf\u95ee\u8bbe\u8ba1\u7684\u6269\u5c55\u6a21\u5757\uff0c\u80fd\u652f\u6301\u5728 Redis \u5b9e\u4f8b\u4e0a\u76f4\u63a5\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\uff0c\u4ee5\u53ca\u6309\u6807\u7b7e\u5c5e\u6027\u8fc7\u6ee4\u67e5\u8be2\u6570\u636e\u96c6\u5408\uff0c\u5f53\u6211\u4eec\u9700\u8981\u9891\u7e41\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\uff0c\u4ee5\u53ca\u4ece\u5927\u91cf\u96c6\u5408\u4e2d\u7b5b\u9009\u51fa\u7279\u5b9a\u8bbe\u5907\u6216\u7528\u6237\u7684\u6570\u636e\u96c6\u5408\u65f6\uff0cRedisTimeSeries \u5c31\u53ef\u4ee5\u53d1\u6325\u4f18\u52bf\u4e86\u3002 5\u3001\u672c\u8282\u5c0f\u7ed3 \u70b9\u67e5\u8be2\uff0c\u6839\u636e\u4e00\u4e2a\u65f6\u95f4\u6233\uff0c\u67e5\u8be2\u76f8\u5e94\u65f6\u95f4\u7684\u6570\u636e\uff1b \u8303\u56f4\u67e5\u8be2\uff0c\u67e5\u8be2\u8d77\u59cb\u548c\u622a\u6b62\u65f6\u95f4\u6233\u8303\u56f4\u5185\u7684\u6570\u636e\uff1b \u805a\u5408\u8ba1\u7b97\uff0c\u9488\u5bf9\u8d77\u59cb\u548c\u622a\u6b62\u65f6\u95f4\u6233\u8303\u56f4\u5185\u7684\u6240\u6709\u6570\u636e\u8fdb\u884c\u8ba1\u7b97\uff0c\u4f8b\u5982\u6c42\u6700\u5927 / \u6700\u5c0f\u503c\uff0c\u6c42\u5747\u503c\u7b49\u3002 Redis \u7684\u9ad8\u6027\u80fd\u5199\u7279\u6027\u8db3\u4ee5\u5e94\u5bf9\u4e86\uff1b\u800c\u9488\u5bf9\u591a\u6837\u5316\u7684\u67e5\u8be2\u9700\u6c42\uff0cRedis \u63d0\u4f9b\u4e86\u4e24\u79cd\u65b9\u6848\u3002 \u7b2c\u4e00\u79cd\u65b9\u6848\u662f\uff0c\u7ec4\u5408\u4f7f\u7528 Redis \u5185\u7f6e\u7684 Hash \u548c Sorted Set \u7c7b\u578b\uff0c\u628a\u6570\u636e\u540c\u65f6\u4fdd\u5b58\u5728 Hash \u96c6\u5408\u548c Sorted Set \u96c6\u5408\u4e2d\u3002 \u8fd9\u79cd\u65b9\u6848\u65e2\u53ef\u4ee5\u5229\u7528 Hash \u7c7b\u578b\u5b9e\u73b0\u5bf9\u5355\u952e\u7684\u5feb\u901f\u67e5\u8be2\uff0c\u8fd8\u80fd\u5229\u7528 Sorted Set \u5b9e\u73b0\u5bf9\u8303\u56f4\u67e5\u8be2\u7684\u9ad8\u6548\u652f\u6301\uff0c\u4e00\u4e0b\u5b50\u6ee1\u8db3\u4e86\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u4e24\u5927\u67e5\u8be2\u9700\u6c42\u3002 \u7b2c\u4e00\u79cd\u65b9\u6848\u4e5f\u6709\u4e24\u4e2a\u4e0d\u8db3 \u5728\u6267\u884c\u805a\u5408\u8ba1\u7b97\u65f6\uff0c\u6211\u4eec\u9700\u8981\u628a\u6570\u636e\u8bfb\u53d6\u5230\u5ba2\u6237\u7aef\u518d\u8fdb\u884c\u805a\u5408\uff0c\u5f53\u6709\u5927\u91cf\u6570\u636e\u8981\u805a\u5408\u65f6\uff0c\u6570\u636e\u4f20\u8f93\u5f00\u9500\u5927\uff1b \u6240\u6709\u7684\u6570\u636e\u4f1a\u5728\u4e24\u4e2a\u6570\u636e\u7c7b\u578b\u4e2d\u5404\u4fdd\u5b58\u4e00\u4efd\uff0c\u5185\u5b58\u5f00\u9500\u4e0d\u5c0f\u3002 \u4e0d\u8fc7\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u9002\u5f53\u7684\u6570\u636e\u8fc7\u671f\u65f6\u95f4\uff0c\u91ca\u653e\u5185\u5b58\uff0c\u51cf\u5c0f\u5185\u5b58\u538b\u529b \u3002 RedisTimeSeries \u6a21\u5757 \u8fd9\u662f\u4e13\u95e8\u4e3a\u5b58\u53d6\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u800c\u8bbe\u8ba1\u7684\u6269\u5c55\u6a21\u5757\u3002\u548c\u7b2c\u4e00\u79cd\u65b9\u6848\u76f8\u6bd4\uff0c RedisTimeSeries \u80fd\u652f\u6301\u76f4\u63a5\u5728 Redis \u5b9e\u4f8b\u4e0a\u8fdb\u884c\u591a\u79cd\u6570\u636e\u805a\u5408\u8ba1\u7b97\uff0c\u907f\u514d\u4e86\u5927\u91cf\u6570\u636e\u5728\u5b9e\u4f8b\u548c\u5ba2\u6237\u7aef\u95f4\u4f20\u8f93\u3002 \u4e0d\u8fc7\uff0c RedisTimeSeries \u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u4f7f\u7528\u4e86\u94fe\u8868\uff0c\u5b83\u7684\u8303\u56f4\u67e5\u8be2\u7684\u590d\u6742\u5ea6\u662f O(N) \u7ea7\u522b\u7684\uff0c\u540c\u65f6\uff0c\u5b83\u7684 TS.GET \u67e5\u8be2\u53ea\u80fd\u8fd4\u56de\u6700\u65b0\u7684\u6570\u636e\uff0c\u6ca1\u6709\u529e\u6cd5\u50cf\u7b2c\u4e00\u79cd\u65b9\u6848\u7684 Hash \u7c7b\u578b\u4e00\u6837\uff0c\u53ef\u4ee5\u8fd4\u56de\u4efb\u4e00\u65f6\u95f4\u70b9\u7684\u6570\u636e\u3002 \u7ec4\u5408\u4f7f\u7528 Hash \u548c Sorted Set\uff0c\u6216\u8005\u4f7f\u7528 RedisTimeSeries\uff0c\u5728\u652f\u6301\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u5b58\u53d6\u4e0a\u5404\u6709\u4f18\u52a3\u52bf \u5982\u679c\u4f60\u7684\u90e8\u7f72\u73af\u5883\u4e2d\u7f51\u7edc\u5e26\u5bbd\u9ad8\u3001Redis \u5b9e\u4f8b\u5185\u5b58\u5927\uff0c\u53ef\u4ee5\u4f18\u5148\u8003\u8651\u7b2c\u4e00\u79cd\u65b9\u6848\uff1b \u5982\u679c\u4f60\u7684\u90e8\u7f72\u73af\u5883\u4e2d\u7f51\u7edc\u3001\u5185\u5b58\u8d44\u6e90\u6709\u9650\uff0c\u800c\u4e14\u6570\u636e\u91cf\u5927\uff0c\u805a\u5408\u8ba1\u7b97\u9891\u7e41\uff0c\u9700\u8981\u6309\u6570\u636e\u96c6\u5408\u5c5e\u6027\u67e5\u8be2\uff0c\u53ef\u4ee5\u4f18\u5148\u8003\u8651\u7b2c\u4e8c\u79cd\u65b9\u6848\u3002 hash \u548c sorted set \u7c7b\u578b\u7684key\u4e0d\u80fd\u76f8\u540c\uff0c\u6587\u4ef6\u662f\u76f8\u540c\u7684\u3002 127.0.0.1:6379> MULTI OK 127.0.0.1:6379> ZADD dev:temp4 2020092201 26.8 QUEUED 127.0.0.1:6379> HSET dev:temp4 2020092201 26.8 QUEUED 127.0.0.1:6379> EXEC 1) (integer) 1 2) (error) WRONGTYPE Operation against a key holding the wrong kind of value 127.0.0.1:6379> MULTI OK 127.0.0.1:6379> HSET dev:temp5 2020092201 26.8 QUEUED 127.0.0.1:6379> ZADD dev:temp6 2020092201 26.8 QUEUED 127.0.0.1:6379> EXEC 1) (integer) 1 2) (integer) 1 \u4f7f\u7528 Sorted Set \u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u628a\u65f6\u95f4\u6233\u4f5c\u4e3a score \uff0c\u628a\u5b9e\u9645\u7684\u6570\u636e\u4f5c\u4e3a member\uff0c\u4f60\u89c9\u5f97\u8fd9\u6837\u4fdd\u5b58\u6570\u636e\u6709\u6ca1\u6709\u6f5c\u5728\u7684\u98ce\u9669\uff1f\u53e6\u5916\uff0c\u5982\u679c\u4f60\u662f Redis \u7684\u5f00\u53d1\u7ef4\u62a4\u8005\uff0c\u4f60\u4f1a\u628a\u805a\u5408\u8ba1\u7b97\u4e5f\u8bbe\u8ba1\u4e3a Sorted Set \u7684\u4e00\u4e2a\u5185\u5728\u529f\u80fd\u5417\uff1f \u5b58\u5728member\u91cd\u590d\u7684\u95ee\u9898\uff0c\u4f1a\u5bf9member\u8986\u76d6","title":"\u7b2c\u56db\u8282 \u6839\u636e\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u7279\u70b9\uff0c\u9009\u62e9\u5408\u9002\u7684\u5b58\u50a8\u65b9\u6848"},{"location":"chap3/4redis_timeseries/#_1","text":"\u8bb0\u5f55\u7528\u6237\u5728\u7f51\u7ad9\u6216\u8005 App \u4e0a\u7684\u70b9\u51fb\u884c\u4e3a\u6570\u636e\uff0c\u6765\u5206\u6790\u7528\u6237\u884c\u4e3a\u3002\u8fd9\u91cc\u7684\u6570\u636e\u4e00\u822c\u5305\u62ec\u7528\u6237 ID\u3001\u884c\u4e3a\u7c7b\u578b\uff08\u4f8b\u5982\u6d4f\u89c8\u3001\u767b\u5f55\u3001\u4e0b\u5355\u7b49\uff09\u3001\u884c\u4e3a\u53d1\u751f\u7684\u65f6\u95f4\u6233\uff1a UserID, Type, TimeStamp \u7269\u8054\u7f51\u9879\u76ee\u7684\u6570\u636e\u5b58\u53d6\u9700\u6c42\uff0c\u548c\u8fd9\u4e2a\u5f88\u76f8\u4f3c\u3002\u6211\u4eec\u9700\u8981\u5468\u671f\u6027\u5730\u7edf\u8ba1\u8fd1\u4e07\u53f0\u8bbe\u5907\u7684\u5b9e\u65f6\u72b6\u6001\uff0c\u5305\u62ec\u8bbe\u5907 ID\u3001\u538b\u529b\u3001\u6e29\u5ea6\u3001\u6e7f\u5ea6\uff0c\u4ee5\u53ca\u5bf9\u5e94\u7684\u65f6\u95f4\u6233\uff1a DeviceID, Pressure, Temperature, Humidity, TimeStamp \u65f6\u95f4\u5e8f\u5217\u6570\u636e: \u8fd9\u4e9b\u6570\u636e\u7684\u7279\u70b9\u662f\u6ca1\u6709\u4e25\u683c\u7684\u5173\u7cfb\u6a21\u578b\uff0c\u8bb0\u5f55\u7684\u4fe1\u606f\u53ef\u4ee5\u8868\u793a\u6210\u952e\u548c\u503c\u7684\u5173\u7cfb\uff08\u4f8b\u5982\uff0c\u4e00\u4e2a\u8bbe\u5907 ID \u5bf9\u5e94\u4e00\u6761\u8bb0\u5f55\uff09\uff0c\u6240\u4ee5\uff0c\u5e76\u4e0d\u9700\u8981\u4e13\u95e8\u7528\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff08\u4f8b\u5982 MySQL\uff09\u6765\u4fdd\u5b58\u3002","title":"\u7b2c\u56db\u8282 \u6839\u636e\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u7279\u70b9\uff0c\u9009\u62e9\u5408\u9002\u7684\u5b58\u50a8\u65b9\u6848"},{"location":"chap3/4redis_timeseries/#1","text":"","title":"1\u3001\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u8bfb\u5199\u7279\u70b9"},{"location":"chap3/4redis_timeseries/#1-1","text":"\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u901a\u5e38\u662f\u6301\u7eed\u9ad8\u5e76\u53d1\u5199\u5165\u7684 \uff0c\u4f8b\u5982\uff0c\u9700\u8981\u8fde\u7eed\u8bb0\u5f55\u6570\u4e07\u4e2a\u8bbe\u5907\u7684\u5b9e\u65f6\u72b6\u6001\u503c\u3002 \u540c\u65f6\uff0c\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u5199\u5165\u4e3b\u8981\u5c31\u662f\u63d2\u5165\u65b0\u6570\u636e\uff0c\u800c\u4e0d\u662f\u66f4\u65b0\u4e00\u4e2a\u5df2\u5b58\u5728\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u4e2a\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u88ab\u8bb0\u5f55\u540e\u901a\u5e38\u5c31\u4e0d\u4f1a\u53d8\u4e86\uff0c\u56e0\u4e3a\u5b83\u5c31\u4ee3\u8868\u4e86\u4e00\u4e2a\u8bbe\u5907\u5728\u67d0\u4e2a\u65f6\u523b\u7684\u72b6\u6001\u503c \u8fd9\u79cd\u6570\u636e\u7684\u5199\u5165\u7279\u70b9\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u63d2\u5165\u6570\u636e\u5feb\uff0c\u8fd9\u5c31\u8981\u6c42\u6211\u4eec\u9009\u62e9\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5728\u8fdb\u884c\u6570\u636e\u63d2\u5165\u65f6\uff0c\u590d\u6742\u5ea6\u8981\u4f4e\uff0c\u5c3d\u91cf\u4e0d\u8981\u963b\u585e \u4f60\u53ef\u80fd\u7b2c\u4e00\u65f6\u95f4\u4f1a\u60f3\u5230\u7528 Redis \u7684 String \u3001 Hash \u7c7b\u578b\u6765\u4fdd\u5b58\uff0c\u56e0\u4e3a\u5b83\u4eec\u7684\u63d2\u5165\u590d\u6742\u5ea6\u90fd\u662f O(1)\uff0c\u662f\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002\u4f46\u662f\uff0cString \u7c7b\u578b\u5728\u8bb0\u5f55\u5c0f\u6570\u636e\u65f6\uff08\u4f8b\u5982\u521a\u624d\u4f8b\u5b50\u4e2d\u7684\u8bbe\u5907\u6e29\u5ea6\u503c\uff09\uff0c\u5143\u6570\u636e\u7684\u5185\u5b58\u5f00\u9500\u6bd4\u8f83\u5927\uff0c\u4e0d\u592a\u9002\u5408\u4fdd\u5b58\u5927\u91cf\u6570\u636e\u3002","title":"1-1 \u5199\u5165\u7279\u70b9"},{"location":"chap3/4redis_timeseries/#1-2","text":"\u6211\u4eec\u5728\u67e5\u8be2\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u65f6\uff0c\u65e2\u6709\u5bf9\u5355\u6761\u8bb0\u5f55\u7684\u67e5\u8be2\uff08\u4f8b\u5982\u67e5\u8be2\u67d0\u4e2a\u8bbe\u5907\u5728\u67d0\u4e00\u4e2a\u65f6\u523b\u7684\u8fd0\u884c\u72b6\u6001\u4fe1\u606f\uff0c\u5bf9\u5e94\u7684\u5c31\u662f\u8fd9\u4e2a\u8bbe\u5907\u7684\u4e00\u6761\u8bb0\u5f55\uff09\uff0c\u4e5f\u6709\u5bf9\u67d0\u4e2a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6570\u636e\u7684\u67e5\u8be2\uff08\u4f8b\u5982\u6bcf\u5929\u65e9\u4e0a 8 \u70b9\u5230 10 \u70b9\u7684\u6240\u6709\u8bbe\u5907\u7684\u72b6\u6001\u4fe1\u606f\uff09\u3002 \u8fd8\u6709\u4e00\u4e9b\u66f4\u590d\u6742\u7684\u67e5\u8be2\uff0c \u6bd4\u5982\u5bf9\u67d0\u4e2a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6570\u636e\u505a\u805a\u5408\u8ba1\u7b97\u3002\u8fd9\u91cc\u7684\u805a\u5408\u8ba1\u7b97\uff0c\u5c31\u662f\u5bf9\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u6240\u6709\u6570\u636e\u505a\u8ba1\u7b97\uff0c\u5305\u62ec\u8ba1\u7b97\u5747\u503c\u3001\u6700\u5927 / \u6700\u5c0f\u503c\u3001\u6c42\u548c\u7b49 \u4f8b\u5982\uff0c\u6211\u4eec\u8981\u8ba1\u7b97\u67d0\u4e2a\u65f6\u95f4\u6bb5\u5185\u7684\u8bbe\u5907\u538b\u529b\u7684\u6700\u5927\u503c\uff0c\u6765\u5224\u65ad\u662f\u5426\u6709\u6545\u969c\u53d1\u751f\u3002 \u65f6\u95f4\u5e8f\u5217\u6570\u636e\u8bfb\u7684\u7279\u70b9\uff1a\u8303\u56f4\u67e5\u8be2\uff0c\u805a\u5408\u7edf\u8ba1\uff0c\u67e5\u8be2\u5feb \u4e24\u79cd\u89e3\u51b3\u65b9\u6848\uff1a 1\u3001\u57fa\u4e8eHash\u548cSorted Set\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e 2\u3001\u57fa\u4e8eRedisTimeSeries\u6a21\u5757\u5b9e\u73b0","title":"1-2 \u201c\u8bfb\u201d\u64cd\u4f5c\u7279\u70b9"},{"location":"chap3/4redis_timeseries/#1-3","text":"\u9488\u5bf9\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u201c\u5199\u8981\u5feb\u201d\uff0cRedis \u7684\u9ad8\u6027\u80fd\u5199\u7279\u6027\u76f4\u63a5\u5c31\u53ef\u4ee5\u6ee1\u8db3\u4e86\uff1b \u800c\u9488\u5bf9\u201c\u67e5\u8be2\u6a21\u5f0f\u591a\u201d\uff0c\u4e5f\u5c31\u662f\u8981\u652f\u6301\u5355\u70b9\u67e5\u8be2\u3001\u8303\u56f4\u67e5\u8be2\u548c\u805a\u5408\u8ba1\u7b97\uff0cRedis \u63d0\u4f9b\u4e86\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u4e24\u79cd\u65b9\u6848\uff0c\u5206\u522b\u53ef\u4ee5\u57fa\u4e8e Hash \u548c Sorted Set \u5b9e\u73b0\uff0c\u4ee5\u53ca\u57fa\u4e8e RedisTimeSeries \u6a21\u5757\u5b9e\u73b0\u3002","title":"1-3 \u8bfb\u5199\u7279\u70b9"},{"location":"chap3/4redis_timeseries/#2-hash-sorted-set","text":"Hash \u548c Sorted Set \u7ec4\u5408\u7684\u65b9\u5f0f\u6709\u4e00\u4e2a\u660e\u663e\u7684\u597d\u5904\uff1a\u5b83\u4eec\u662f Redis \u5185\u5728\u7684\u6570\u636e\u7c7b\u578b\uff0c\u4ee3\u7801\u6210\u719f\u548c\u6027\u80fd\u7a33\u5b9a\u3002 \u4e3a\u4ec0\u4e48\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u8981\u540c\u65f6\u4f7f\u7528\u8fd9\u4e24\u79cd\u7c7b\u578b\uff1f\u8fd9\u662f\u6211\u4eec\u8981\u56de\u7b54\u7684\u7b2c\u4e00\u4e2a\u95ee\u9898\u3002","title":"2\u3001\u57fa\u4e8e Hash \u548c Sorted Set \u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e"},{"location":"chap3/4redis_timeseries/#2-1-hash","text":"\u5173\u4e8e Hash \u7c7b\u578b\uff0c\u6211\u4eec\u90fd\u77e5\u9053\uff0c\u5b83\u6709\u4e00\u4e2a\u7279\u70b9\u662f\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5bf9\u5355\u952e\u7684\u5feb\u901f\u67e5\u8be2\u3002\u8fd9\u5c31\u6ee1\u8db3\u4e86\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u5355\u952e\u67e5\u8be2\u9700\u6c42\u3002 \u6211\u4eec\u53ef\u4ee5\u628a\u65f6\u95f4\u6233\u4f5c\u4e3a Hash \u96c6\u5408\u7684 key\uff0c\u628a\u8bb0\u5f55\u7684\u8bbe\u5907\u72b6\u6001\u503c\u4f5c\u4e3a Hash \u96c6\u5408\u7684 value \u3002 Hash \u96c6\u5408\u8bb0\u5f55\u8bbe\u5907\u7684\u6e29\u5ea6\u503c\u7684\u793a\u610f\u56fe\uff1a \u5f53\u6211\u4eec\u60f3\u8981\u67e5\u8be2\u67d0\u4e2a\u65f6\u95f4\u70b9\u6216\u8005\u662f\u591a\u4e2a\u65f6\u95f4\u70b9\u4e0a\u7684\u6e29\u5ea6\u6570\u636e\u65f6\uff0c\u76f4\u63a5\u4f7f\u7528 HGET \u547d\u4ee4\u6216\u8005 HMGET \u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u5206\u522b\u83b7\u5f97 Hash \u96c6\u5408\u4e2d\u7684\u4e00\u4e2a key \u548c\u591a\u4e2a key \u7684 value \u503c\u4e86\u3002 \u4e3e\u4e2a\u4f8b\u5b50\u3002\u6211\u4eec\u7528 HGET \u547d\u4ee4\u67e5\u8be2 202008030905 \u8fd9\u4e2a\u65f6\u523b\u7684\u6e29\u5ea6\u503c\uff0c\u4f7f\u7528 HMGET \u67e5\u8be2 202008030905\u3001202008030907\u3001202008030908 \u8fd9\u4e09\u4e2a\u65f6\u523b\u7684\u6e29\u5ea6\u503c\uff0c\u5982\u4e0b\u6240\u793a\uff1a HGET device:temperature 202008030905 \"25.1\" HMGET device:temperature 202008030905 202008030907 202008030908 1) \"25.1\" 2) \"25.9\" 3) \"24.9\" Hash \u7c7b\u578b\u6709\u4e2a\u77ed\u677f\uff1a\u5b83\u5e76\u4e0d\u652f\u6301\u5bf9\u6570\u636e\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\u3002 \u867d\u7136\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u662f\u6309\u65f6\u95f4\u9012\u589e\u987a\u5e8f\u63d2\u5165 Hash \u96c6\u5408\u4e2d\u7684\uff0c \u4f46 Hash \u7c7b\u578b\u7684\u5e95\u5c42\u7ed3\u6784\u662f\u54c8\u5e0c\u8868\uff0c\u5e76\u6ca1\u6709\u5bf9\u6570\u636e\u8fdb\u884c\u6709\u5e8f\u7d22\u5f15\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u8981\u5bf9 Hash \u7c7b\u578b\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u626b\u63cf Hash \u96c6\u5408\u4e2d\u7684\u6240\u6709\u6570\u636e\uff0c\u518d\u628a\u8fd9\u4e9b\u6570\u636e\u53d6\u56de\u5230\u5ba2\u6237\u7aef\u8fdb\u884c\u6392\u5e8f\uff0c\u7136\u540e\uff0c\u624d\u80fd\u5728\u5ba2\u6237\u7aef\u5f97\u5230\u6240\u67e5\u8be2\u8303\u56f4\u5185\u7684\u6570\u636e\u3002\u663e\u7136\uff0c\u67e5\u8be2\u6548\u7387\u5f88\u4f4e\u3002","title":"2-1 Hash \u7c7b\u578b\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217"},{"location":"chap3/4redis_timeseries/#2-2-sorted-set","text":"\u4e3a\u4e86\u80fd\u540c\u65f6\u652f\u6301\u6309\u65f6\u95f4\u6233\u8303\u56f4\u7684\u67e5\u8be2\uff0c\u53ef\u4ee5\u7528 Sorted Set \u6765\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u56e0\u4e3a\u5b83\u80fd\u591f\u6839\u636e\u5143\u7d20\u7684\u6743\u91cd\u5206\u6570\u6765\u6392\u5e8f\u3002 \u6211\u4eec\u53ef\u4ee5\u628a\u65f6\u95f4\u6233\u4f5c\u4e3a Sorted Set \u96c6\u5408\u7684\u5143\u7d20\u5206\u6570\uff0c\u628a\u65f6\u95f4\u70b9\u4e0a\u8bb0\u5f55\u7684\u6570\u636e\u4f5c\u4e3a\u5143\u7d20\u672c\u8eab\u3002 \u4e0b\u56fe\u663e\u793a\u4e86\u7528 Sorted Set \u96c6\u5408\u4fdd\u5b58\u7684\u7ed3\u679c\u3002 \u4f7f\u7528 Sorted Set \u4fdd\u5b58\u6570\u636e\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528 ZRANGEBYSCORE \u547d\u4ee4\uff0c\u6309\u7167\u8f93\u5165\u7684\u6700\u5927\u65f6\u95f4\u6233\u548c\u6700\u5c0f\u65f6\u95f4\u6233\u6765\u67e5\u8be2\u8fd9\u4e2a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6e29\u5ea6\u503c\u4e86\u3002\u5982\u4e0b\u6240\u793a\uff0c\u6211\u4eec\u6765\u67e5\u8be2\u4e00\u4e0b\u5728 2020 \u5e74 8 \u6708 3 \u65e5 9 \u70b9 7 \u5206\u5230 9 \u70b9 10 \u5206\u95f4\u7684\u6240\u6709\u6e29\u5ea6\u503c\uff1a ZRANGEBYSCORE device:temperature 202008030907 202008030910 1) \"25.9\" 2) \"24.9\" 3) \"25.3\" 4) \"25.2\" \u540c\u65f6\u4f7f\u7528 Hash \u548c Sorted Set\uff0c\u53ef\u4ee5\u6ee1\u8db3\u5355\u4e2a\u65f6\u95f4\u70b9\u548c\u4e00\u4e2a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6570\u636e\u67e5\u8be2\u9700\u6c42\u4e86\uff0c\u4f46\u662f\u6211\u4eec\u53c8\u4f1a\u9762\u4e34\u4e00\u4e2a\u65b0\u7684\u95ee\u9898\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u8981\u89e3\u7b54\u7684\u7b2c\u4e8c\u4e2a\u95ee\u9898\uff1a \u5982\u4f55\u4fdd\u8bc1\u5199\u5165 Hash \u548c Sorted Set \u662f\u4e00\u4e2a\u539f\u5b50\u6027\u7684\u64cd\u4f5c\u5462\uff1f","title":"2-2 Sorted Set \u6765\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217"},{"location":"chap3/4redis_timeseries/#2-3","text":"\u6267\u884c\u591a\u4e2a\u5199\u547d\u4ee4\u64cd\u4f5c\u65f6\uff08\u4f8b\u5982\u7528 HSET \u547d\u4ee4\u548c ZADD \u547d\u4ee4\u5206\u522b\u628a\u6570\u636e\u5199\u5165 Hash \u548c Sorted Set\uff09\uff0c\u8fd9\u4e9b\u547d\u4ee4\u64cd\u4f5c\u8981\u4e48\u5168\u90e8\u5b8c\u6210\uff0c\u8981\u4e48\u90fd\u4e0d\u5b8c\u6210\u3002 \u53ea\u6709\u4fdd\u8bc1\u4e86\u5199\u64cd\u4f5c\u7684\u539f\u5b50\u6027\uff0c\u624d\u80fd\u4fdd\u8bc1\u540c\u4e00\u4e2a\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u5728 Hash \u548c Sorted Set \u4e2d\uff0c\u8981\u4e48\u90fd\u4fdd\u5b58\u4e86\uff0c\u8981\u4e48\u90fd\u6ca1\u4fdd\u5b58\u3002\u5426\u5219\uff0c \u5c31\u53ef\u80fd\u51fa\u73b0 Hash \u96c6\u5408\u4e2d\u6709\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u800c Sorted Set \u4e2d\u6ca1\u6709\uff0c\u90a3\u4e48\uff0c\u5728\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u5c31\u6ca1\u6709\u529e\u6cd5\u6ee1\u8db3\u67e5\u8be2\u9700\u6c42\u4e86 \u3002 \u90a3 Redis \u662f\u600e\u4e48\u4fdd\u8bc1\u539f\u5b50\u6027\u64cd\u4f5c\u7684\u5462\uff1f \u8fd9\u91cc\u5c31\u6d89\u53ca\u5230\u4e86 Redis \u7528\u6765\u5b9e\u73b0\u7b80\u5355\u7684\u4e8b\u52a1\u7684 MULTI \u548c EXEC \u547d\u4ee4\u3002\u5f53\u591a\u4e2a\u547d\u4ee4\u53ca\u5176\u53c2\u6570\u672c\u8eab\u65e0\u8bef\u65f6\uff0c MULTI \u548c EXEC \u547d\u4ee4\u53ef\u4ee5\u4fdd\u8bc1\u6267\u884c\u8fd9\u4e9b\u547d\u4ee4\u65f6\u7684\u539f\u5b50\u6027\u3002 MULTI \u547d\u4ee4\uff1a\u8868\u793a\u4e00\u7cfb\u5217\u539f\u5b50\u6027\u64cd\u4f5c\u7684\u5f00\u59cb \u3002\u6536\u5230\u8fd9\u4e2a\u547d\u4ee4\u540e\uff0cRedis \u5c31\u77e5\u9053\uff0c\u63a5\u4e0b\u6765\u518d\u6536\u5230\u7684\u547d\u4ee4\u9700\u8981\u653e\u5230\u4e00\u4e2a\u5185\u90e8\u961f\u5217\u4e2d\uff0c\u540e\u7eed\u4e00\u8d77\u6267\u884c\uff0c\u4fdd\u8bc1\u539f\u5b50\u6027\u3002 EXEC \u547d\u4ee4\uff1a\u8868\u793a\u4e00\u7cfb\u5217\u539f\u5b50\u6027\u64cd\u4f5c\u7684\u7ed3\u675f\u3002 \u4e00\u65e6 Redis \u6536\u5230\u4e86\u8fd9\u4e2a\u547d\u4ee4\uff0c\u5c31\u8868\u793a\u6240\u6709\u8981\u4fdd\u8bc1\u539f\u5b50\u6027\u7684\u547d\u4ee4\u64cd\u4f5c\u90fd\u5df2\u7ecf\u53d1\u9001\u5b8c\u6210\u4e86\u3002\u6b64\u65f6\uff0cRedis \u5f00\u59cb\u6267\u884c\u521a\u624d\u653e\u5230\u5185\u90e8\u961f\u5217\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u64cd\u4f5c\u3002 \u547d\u4ee4 1 \u5230\u547d\u4ee4 N \u662f\u5728 MULTI \u547d\u4ee4\u540e\u3001EXEC \u547d\u4ee4\u524d\u53d1\u9001\u7684\uff0c\u5b83\u4eec\u4f1a\u88ab\u4e00\u8d77\u6267\u884c\uff0c\u4fdd\u8bc1\u539f\u5b50\u6027\u3002 \u4ee5\u4fdd\u5b58\u8bbe\u5907\u72b6\u6001\u4fe1\u606f\u7684\u9700\u6c42\u4e3a\u4f8b\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u628a\u8bbe\u5907\u5728 2020 \u5e74 8 \u6708 3 \u65e5 9 \u65f6 5 \u5206\u7684\u6e29\u5ea6\uff0c \u5206\u522b\u7528 HSET \u547d\u4ee4\u548c ZADD \u547d\u4ee4\u5199\u5165 Hash \u96c6\u5408\u548c Sorted Set \u96c6\u5408 \u3002 127.0.0.1:6379> MULTI OK 127.0.0.1:6379> HSET device:temperature 202008030911 26.8 QUEUED 127.0.0.1:6379> ZADD device:temperature 202008030911 26.8 QUEUED 127.0.0.1:6379> EXEC 1) (integer) 1 2) (integer) 1 \u9996\u5148\uff0cRedis \u6536\u5230\u4e86\u5ba2\u6237\u7aef\u6267\u884c\u7684 MULTI \u547d\u4ee4\u3002 \u7136\u540e\uff0c\u5ba2\u6237\u7aef\u518d\u6267\u884c HSET \u548c ZADD \u547d\u4ee4\u540e\uff0c Redis \u8fd4\u56de\u7684\u7ed3\u679c\u4e3a \u201cQUEUED \u201d\uff0c\u8868\u793a\u8fd9\u4e24\u4e2a\u547d\u4ee4\u6682\u65f6\u5165\u961f\uff0c\u5148\u4e0d\u6267\u884c\uff1b \u6267\u884c\u4e86 EXEC \u547d\u4ee4\u540e\uff0c HSET \u547d\u4ee4\u548c ZADD \u547d\u4ee4\u624d\u771f\u6b63\u6267\u884c\uff0c\u5e76\u8fd4\u56de\u6210\u529f\u7ed3\u679c\uff08\u7ed3\u679c\u503c\u4e3a 1\uff09\u3002","title":"2-3 \u539f\u5b50\u6027\u7684\u64cd\u4f5c"},{"location":"chap3/4redis_timeseries/#3","text":"","title":"3\u3001\u5982\u4f55\u5bf9\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\uff1f"},{"location":"chap3/4redis_timeseries/#3-1","text":"\u805a\u5408\u8ba1\u7b97\u4e00\u822c\u88ab\u7528\u6765\u5468\u671f\u6027\u5730\u7edf\u8ba1\u65f6\u95f4\u7a97\u53e3\u5185\u7684\u6570\u636e\u6c47\u603b\u72b6\u6001\uff0c\u5728\u5b9e\u65f6\u76d1\u63a7\u4e0e\u9884\u8b66\u7b49\u573a\u666f\u4e0b\u4f1a\u9891\u7e41\u6267\u884c\u3002 \u7269\u8054\u7f51\u9879\u76ee\u4e2d\uff0c\u5c31\u9700\u8981\u6bcf 3 \u5206\u949f\u7edf\u8ba1\u4e00\u4e0b\u5404\u4e2a\u8bbe\u5907\u7684\u6e29\u5ea6\u72b6\u6001\uff0c\u4e00\u65e6\u8bbe\u5907\u6e29\u5ea6\u8d85\u51fa\u4e86\u8bbe\u5b9a\u7684\u9608\u503c\uff0c\u5c31\u8981\u8fdb\u884c\u62a5\u8b66\u3002\u8fd9\u662f\u4e00\u4e2a\u5178\u578b\u7684\u805a\u5408\u8ba1\u7b97\u573a\u666f\uff0c\u6211\u4eec\u53ef\u4ee5\u6765\u770b\u770b\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u7684\u6570\u636e\u4f53\u91cf \u5047\u8bbe\u6211\u4eec\u9700\u8981\u6bcf 3 \u5206\u949f\u8ba1\u7b97\u4e00\u6b21\u7684\u6240\u6709\u8bbe\u5907\u5404\u6307\u6807\u7684\u6700\u5927\u503c\uff0c\u6bcf\u4e2a\u8bbe\u5907\u6bcf 15 \u79d2\u8bb0\u5f55\u4e00\u4e2a\u6307\u6807\u503c\uff0c1 \u5206\u949f\u5c31\u4f1a\u8bb0\u5f55 4 \u4e2a\u503c\uff0c3 \u5206\u949f\u5c31\u4f1a\u6709 12 \u4e2a\u503c\u3002\u6211\u4eec\u8981\u7edf\u8ba1\u7684\u8bbe\u5907\u6307\u6807\u6570\u91cf\u6709 33 \u4e2a\uff0c\u6240\u4ee5\uff0c\u5355\u4e2a\u8bbe\u5907\u6bcf 3 \u5206\u949f\u8bb0\u5f55\u7684\u6307\u6807\u6570\u636e\u6709\u5c06\u8fd1 400 \u4e2a \uff0833 * 12 = 396\uff09 \uff0c\u800c\u8bbe\u5907\u603b\u6570\u91cf\u6709 1 \u4e07\u53f0\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u6bcf 3 \u5206\u949f\u5c31\u6709\u5c06\u8fd1 400 \u4e07\u6761 \uff08396 * 1 \u4e07 = 396 \u4e07\uff09 \u6570\u636e\u9700\u8981\u5728\u5ba2\u6237\u7aef\u548c Redis \u5b9e\u4f8b\u95f4\u8fdb\u884c\u4f20\u8f93\u3002 \u4e3a\u4e86\u907f\u514d\u5ba2\u6237\u7aef\u548c Redis \u5b9e\u4f8b\u95f4\u9891\u7e41\u7684\u5927\u91cf\u6570\u636e\u4f20\u8f93\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 RedisTimeSeries \u6765\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u3002","title":"3-1 \u805a\u5408\u8ba1\u7b97"},{"location":"chap3/4redis_timeseries/#3-2","text":"RedisTimeSeries \u652f\u6301\u76f4\u63a5\u5728 Redis \u5b9e\u4f8b\u4e0a\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\u3002 \u8fd8\u662f\u4ee5\u521a\u624d\u6bcf 3 \u5206\u949f\u7b97\u4e00\u6b21\u6700\u5927\u503c\u4e3a\u4f8b\u3002\u5728 Redis \u5b9e\u4f8b\u4e0a\u76f4\u63a5\u805a\u5408\u8ba1\u7b97\uff0c\u90a3\u4e48\uff0c\u5bf9\u4e8e\u5355\u4e2a\u8bbe\u5907\u7684\u4e00\u4e2a\u6307\u6807\u503c\u6765\u8bf4\uff0c\u6bcf 3 \u5206\u949f\u8bb0\u5f55\u7684 12 \u6761\u6570\u636e\u53ef\u4ee5\u805a\u5408\u8ba1\u7b97\u6210\u4e00\u4e2a\u503c\uff0c\u5355\u4e2a\u8bbe\u5907\u6bcf 3 \u5206\u949f\u4e5f\u5c31\u53ea\u6709 33 \u4e2a\u805a\u5408\u503c\u9700\u8981\u4f20\u8f93\uff0c1 \u4e07\u53f0\u8bbe\u5907\u4e5f\u53ea\u6709 33 \u4e07\u6761\u6570\u636e\u3002\u6570\u636e\u91cf\u5927\u7ea6\u662f\u5728\u5ba2\u6237\u7aef\u505a\u805a\u5408\u8ba1\u7b97\u7684\u5341\u5206\u4e4b\u4e00\uff0c\u5f88\u663e\u7136\uff0c\u53ef\u4ee5\u51cf\u5c11\u5927\u91cf\u6570\u636e\u4f20\u8f93\u5bf9 Redis \u5b9e\u4f8b\u7f51\u7edc\u7684\u6027\u80fd\u5f71\u54cd\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u6211\u4eec\u53ea\u9700\u8981\u8fdb\u884c\u5355\u4e2a\u65f6\u95f4\u70b9\u67e5\u8be2\u6216\u662f\u5bf9\u67d0\u4e2a\u65f6\u95f4\u8303\u56f4\u67e5\u8be2\u7684\u8bdd\uff0c\u9002\u5408\u4f7f\u7528 Hash \u548c Sorted Set \u7684\u7ec4\u5408\uff0c\u5b83\u4eec\u90fd\u662f Redis \u7684\u5185\u5728\u6570\u636e\u7ed3\u6784\uff0c\u6027\u80fd\u597d\uff0c\u7a33\u5b9a\u6027\u9ad8\u3002 \u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u9700\u8981\u8fdb\u884c\u5927\u91cf\u7684\u805a\u5408\u8ba1\u7b97\uff0c\u540c\u65f6\u7f51\u7edc\u5e26\u5bbd\u6761\u4ef6\u4e0d\u662f\u592a\u597d\u65f6\uff0cHash \u548c Sorted Set \u7684\u7ec4\u5408\u5c31\u4e0d\u592a\u9002\u5408\u4e86\u3002\u6b64\u65f6\uff0c\u4f7f\u7528 RedisTimeSeries \u5c31\u66f4\u52a0\u5408\u9002\u4e00\u4e9b\u3002","title":"3-2 \u805a\u5408\u8ba1\u7b97"},{"location":"chap3/4redis_timeseries/#4-redistimeseries","text":"RedisTimeSeries \u662f Redis \u7684\u4e00\u4e2a\u6269\u5c55\u6a21\u5757\u3002 \u5b83 \u4e13\u95e8\u9762\u5411\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u63d0\u4f9b\u4e86\u6570\u636e\u7c7b\u578b\u548c\u8bbf\u95ee\u63a5\u53e3\uff0c\u5e76\u4e14\u652f\u6301\u5728 Redis \u5b9e\u4f8b\u4e0a\u76f4\u63a5\u5bf9\u6570\u636e\u8fdb\u884c\u6309\u65f6\u95f4\u8303\u56f4\u7684\u805a\u5408\u8ba1\u7b97\u3002 \u56e0\u4e3a RedisTimeSeries \u4e0d\u5c5e\u4e8e Redis \u7684\u5185\u5efa\u529f\u80fd\u6a21\u5757\uff0c\u5728\u4f7f\u7528\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5148\u628a\u5b83\u7684\u6e90\u7801\u5355\u72ec\u7f16\u8bd1\u6210\u52a8\u6001\u94fe\u63a5\u5e93 redistimeseries.so \uff0c\u518d\u4f7f\u7528 loadmodule \u547d\u4ee4\u8fdb\u884c\u52a0\u8f7d\uff0c\u5982\u4e0b\u6240\u793a\uff1a loadmodule redistimeseries.so \u5f53\u7528\u4e8e\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u5b58\u53d6\u65f6\uff0cRedisTimeSeries \u7684\u64cd\u4f5c\u4e3b\u8981\u6709 5 \u4e2a\uff1a \u7528 TS.CREATE \u547d\u4ee4\u521b\u5efa\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u96c6\u5408\uff1b \u7528 TS.ADD \u547d\u4ee4\u63d2\u5165\u6570\u636e\uff1b \u7528 TS.GET \u547d\u4ee4\u8bfb\u53d6\u6700\u65b0\u6570\u636e\uff1b \u7528 TS.MGET \u547d\u4ee4\u6309\u6807\u7b7e\u8fc7\u6ee4\u67e5\u8be2\u6570\u636e\u96c6\u5408\uff1b \u7528 TS.RANGE \u652f\u6301\u805a\u5408\u8ba1\u7b97\u7684\u8303\u56f4\u67e5\u8be2\u3002 \u4e0b\u9762\uff0c\u6211\u6765\u4ecb\u7ecd\u4e00\u4e0b\u5982\u4f55\u4f7f\u7528\u8fd9 5 \u4e2a\u64cd\u4f5c\u3002","title":"4\u3001\u57fa\u4e8e RedisTimeSeries \u6a21\u5757\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e"},{"location":"chap3/4redis_timeseries/#4-1-tscreate","text":"\u5728 TS.CREATE \u547d\u4ee4\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u8bbe\u7f6e\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u96c6\u5408\u7684 key \u548c\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\uff08\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\uff09\u3002\u6b64\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4e3a\u6570\u636e\u96c6\u5408\u8bbe\u7f6e\u6807\u7b7e\uff0c\u6765\u8868\u793a\u6570\u636e\u96c6\u5408\u7684\u5c5e\u6027\u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u521b\u5efa\u4e00\u4e2a key \u4e3a device:temperature \u3001\u6570\u636e\u6709\u6548\u671f\u4e3a 600s \u7684\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u96c6\u5408\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u4e2a\u96c6\u5408\u4e2d\u7684\u6570\u636e\u521b\u5efa\u4e86 600s \u540e\uff0c\u5c31\u4f1a\u88ab\u81ea\u52a8\u5220\u9664\u3002 \u6700\u540e\uff0c\u6211\u4eec\u7ed9\u8fd9\u4e2a\u96c6\u5408\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u6807\u7b7e\u5c5e\u6027 {device_id:1} \uff0c\u8868\u660e\u8fd9\u4e2a\u6570\u636e\u96c6\u5408\u4e2d\u8bb0\u5f55\u7684\u662f\u5c5e\u4e8e\u8bbe\u5907 ID \u53f7\u4e3a 1 \u7684\u6570\u636e\u3002 TS.CREATE device:temperature RETENTION 600000 LABELS device_id 1 OK","title":"4-1 \u7528 TS.CREATE \u547d\u4ee4\u521b\u5efa\u4e00\u4e2a\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u96c6\u5408"},{"location":"chap3/4redis_timeseries/#4-2-tsadd-tsget","text":"\u6211\u4eec\u53ef\u4ee5\u7528 TS.ADD \u547d\u4ee4\u5f80\u65f6\u95f4\u5e8f\u5217\u96c6\u5408\u4e2d\u63d2\u5165\u6570\u636e\uff0c\u5305\u62ec\u65f6\u95f4\u6233\u548c\u5177\u4f53\u7684\u6570\u503c\uff0c \u5e76\u4f7f\u7528 TS.GET \u547d\u4ee4\u8bfb\u53d6\u6570\u636e\u96c6\u5408\u4e2d\u7684\u6700\u65b0\u4e00\u6761\u6570\u636e\u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u5217 TS.ADD \u547d\u4ee4\u65f6\uff0c\u5c31\u5f80 device:temperature \u96c6\u5408\u4e2d\u63d2\u5165\u4e86\u4e00\u6761\u6570\u636e\uff0c\u8bb0\u5f55\u7684\u662f\u8bbe\u5907\u5728 2020 \u5e74 8 \u6708 3 \u65e5 9 \u65f6 5 \u5206\u7684\u8bbe\u5907\u6e29\u5ea6\uff1b \u518d\u6267\u884c TS.GET \u547d\u4ee4\u65f6\uff0c\u5c31\u4f1a\u628a\u521a\u521a\u63d2\u5165\u7684\u6700\u65b0\u6570\u636e\u8bfb\u53d6\u51fa\u6765 TS.ADD device:temperature 1596416700 25.1 1596416700 TS.GET device:temperature 25.1","title":"4-2 \u7528 TS.ADD \u547d\u4ee4\u63d2\u5165\u6570\u636e\uff0c\u7528 TS.GET \u547d\u4ee4\u8bfb\u53d6\u6700\u65b0\u6570\u636e"},{"location":"chap3/4redis_timeseries/#4-3-tsmget","text":"\u5728\u4fdd\u5b58\u591a\u4e2a\u8bbe\u5907\u7684\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u65f6\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u628a\u4e0d\u540c\u8bbe\u5907\u7684\u6570\u636e\u4fdd\u5b58\u5230\u4e0d\u540c\u96c6\u5408\u4e2d\u3002 \u6b64\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528 TS.MGET \u547d\u4ee4\uff0c\u6309\u7167\u6807\u7b7e\u67e5\u8be2\u90e8\u5206\u96c6\u5408\u4e2d\u7684\u6700\u65b0\u6570\u636e \u3002 \u5728\u4f7f\u7528 TS.CREATE \u521b\u5efa\u6570\u636e\u96c6\u5408\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u7ed9\u96c6\u5408\u8bbe\u7f6e\u6807\u7b7e\u5c5e\u6027\u3002 \u5f53\u6211\u4eec\u8fdb\u884c\u67e5\u8be2\u65f6\uff0c\u5c31\u53ef\u4ee5\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9\u96c6\u5408\u6807\u7b7e\u5c5e\u6027\u8fdb\u884c\u5339\u914d\uff0c\u6700\u540e\u7684\u67e5\u8be2\u7ed3\u679c\u91cc\u53ea\u8fd4\u56de\u5339\u914d\u4e0a\u7684\u96c6\u5408\u4e2d\u7684\u6700\u65b0\u6570\u636e\u3002 \u4e3e\u4e2a\u4f8b\u5b50\u3002\u5047\u8bbe\u6211\u4eec\u4e00\u5171\u7528 4 \u4e2a\u96c6\u5408\u4e3a 4 \u4e2a\u8bbe\u5907\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u8bbe\u5907\u7684 ID \u53f7\u662f 1\u30012\u30013\u30014\uff0c\u6211\u4eec\u5728\u521b\u5efa\u6570\u636e\u96c6\u5408\u65f6\uff0c\u628a device_id \u8bbe\u7f6e\u4e3a\u6bcf\u4e2a\u96c6\u5408\u7684\u6807\u7b7e\u3002 \u6b64\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e0b\u5217 TS.MGET \u547d\u4ee4\uff0c\u4ee5\u53ca FILTER \u8bbe\u7f6e\uff08\u8fd9\u4e2a\u914d\u7f6e\u9879\u7528\u6765\u8bbe\u7f6e\u96c6\u5408\u6807\u7b7e\u7684\u8fc7\u6ee4\u6761\u4ef6\uff09\uff0c\u67e5\u8be2 device_id \u4e0d\u7b49\u4e8e 2 \u7684\u6240\u6709\u5176\u4ed6\u8bbe\u5907\u7684\u6570\u636e\u96c6\u5408\uff0c\u5e76\u8fd4\u56de\u5404\u81ea\u96c6\u5408\u4e2d\u7684\u6700\u65b0\u7684\u4e00\u6761\u6570\u636e\u3002 TS.MGET FILTER device_id!=2 1) 1) \"device:temperature:1\" 2) (empty list or set) 3) 1) (integer) 1596417000 2) \"25.3\" 2) 1) \"device:temperature:3\" 2) (empty list or set) 3) 1) (integer) 1596417000 2) \"29.5\" 3) 1) \"device:temperature:4\" 2) (empty list or set) 3) 1) (integer) 1596417000 2) \"30.1\"","title":"4-3 \u7528 TS.MGET \u547d\u4ee4\u6309\u6807\u7b7e\u8fc7\u6ee4\u67e5\u8be2\u6570\u636e\u96c6\u5408"},{"location":"chap3/4redis_timeseries/#4-4-tsrange","text":"\u6700\u540e\uff0c\u5728\u5bf9\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 TS.RANGE \u547d\u4ee4\u6307\u5b9a\u8981\u67e5\u8be2\u7684\u6570\u636e\u7684\u65f6\u95f4\u8303\u56f4\uff0c\u540c\u65f6\u7528 AGGREGATION \u53c2\u6570\u6307\u5b9a\u8981\u6267\u884c\u7684\u805a\u5408\u8ba1\u7b97\u7c7b\u578b\u3002 RedisTimeSeries \u652f\u6301\u7684\u805a\u5408\u8ba1\u7b97\u7c7b\u578b\u5f88\u4e30\u5bcc\uff0c\u5305\u62ec\u6c42\u5747\u503c\uff08avg\uff09\u3001\u6c42\u6700\u5927 / \u6700\u5c0f\u503c\uff08max/min\uff09\uff0c\u6c42\u548c\uff08sum\uff09\u7b49\u3002 \u4f8b\u5982\uff0c\u5728\u6267\u884c\u4e0b\u5217\u547d\u4ee4\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6309\u7167\u6bcf 180s \u7684\u65f6\u95f4\u7a97\u53e3\uff0c\u5bf9 2020 \u5e74 8 \u6708 3 \u65e5 9 \u65f6 5 \u5206\u548c 2020 \u5e74 8 \u6708 3 \u65e5 9 \u65f6 12 \u5206\u8fd9\u6bb5\u65f6\u95f4\u5185\u7684\u6570\u636e\u8fdb\u884c\u5747\u503c\u8ba1\u7b97\u4e86\u3002 TS.RANGE device:temperature 1596416700 1596417120 AGGREGATION avg 180000 1) 1) (integer) 1596416700 2) \"25.6\" 2) 1) (integer) 1596416880 2) \"25.8\" 3) 1) (integer) 1596417060 2) \"26.1\" \u4e0e\u4f7f\u7528 Hash \u548c Sorted Set \u6765\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u76f8\u6bd4\uff0cRedisTimeSeries \u662f\u4e13\u95e8\u4e3a\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u8bbf\u95ee\u8bbe\u8ba1\u7684\u6269\u5c55\u6a21\u5757\uff0c\u80fd\u652f\u6301\u5728 Redis \u5b9e\u4f8b\u4e0a\u76f4\u63a5\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\uff0c\u4ee5\u53ca\u6309\u6807\u7b7e\u5c5e\u6027\u8fc7\u6ee4\u67e5\u8be2\u6570\u636e\u96c6\u5408\uff0c\u5f53\u6211\u4eec\u9700\u8981\u9891\u7e41\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\uff0c\u4ee5\u53ca\u4ece\u5927\u91cf\u96c6\u5408\u4e2d\u7b5b\u9009\u51fa\u7279\u5b9a\u8bbe\u5907\u6216\u7528\u6237\u7684\u6570\u636e\u96c6\u5408\u65f6\uff0cRedisTimeSeries \u5c31\u53ef\u4ee5\u53d1\u6325\u4f18\u52bf\u4e86\u3002","title":"4-4 \u7528 TS.RANGE \u652f\u6301\u9700\u8981\u805a\u5408\u8ba1\u7b97\u7684\u8303\u56f4\u67e5\u8be2"},{"location":"chap3/4redis_timeseries/#5","text":"\u70b9\u67e5\u8be2\uff0c\u6839\u636e\u4e00\u4e2a\u65f6\u95f4\u6233\uff0c\u67e5\u8be2\u76f8\u5e94\u65f6\u95f4\u7684\u6570\u636e\uff1b \u8303\u56f4\u67e5\u8be2\uff0c\u67e5\u8be2\u8d77\u59cb\u548c\u622a\u6b62\u65f6\u95f4\u6233\u8303\u56f4\u5185\u7684\u6570\u636e\uff1b \u805a\u5408\u8ba1\u7b97\uff0c\u9488\u5bf9\u8d77\u59cb\u548c\u622a\u6b62\u65f6\u95f4\u6233\u8303\u56f4\u5185\u7684\u6240\u6709\u6570\u636e\u8fdb\u884c\u8ba1\u7b97\uff0c\u4f8b\u5982\u6c42\u6700\u5927 / \u6700\u5c0f\u503c\uff0c\u6c42\u5747\u503c\u7b49\u3002 Redis \u7684\u9ad8\u6027\u80fd\u5199\u7279\u6027\u8db3\u4ee5\u5e94\u5bf9\u4e86\uff1b\u800c\u9488\u5bf9\u591a\u6837\u5316\u7684\u67e5\u8be2\u9700\u6c42\uff0cRedis \u63d0\u4f9b\u4e86\u4e24\u79cd\u65b9\u6848\u3002 \u7b2c\u4e00\u79cd\u65b9\u6848\u662f\uff0c\u7ec4\u5408\u4f7f\u7528 Redis \u5185\u7f6e\u7684 Hash \u548c Sorted Set \u7c7b\u578b\uff0c\u628a\u6570\u636e\u540c\u65f6\u4fdd\u5b58\u5728 Hash \u96c6\u5408\u548c Sorted Set \u96c6\u5408\u4e2d\u3002 \u8fd9\u79cd\u65b9\u6848\u65e2\u53ef\u4ee5\u5229\u7528 Hash \u7c7b\u578b\u5b9e\u73b0\u5bf9\u5355\u952e\u7684\u5feb\u901f\u67e5\u8be2\uff0c\u8fd8\u80fd\u5229\u7528 Sorted Set \u5b9e\u73b0\u5bf9\u8303\u56f4\u67e5\u8be2\u7684\u9ad8\u6548\u652f\u6301\uff0c\u4e00\u4e0b\u5b50\u6ee1\u8db3\u4e86\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u4e24\u5927\u67e5\u8be2\u9700\u6c42\u3002 \u7b2c\u4e00\u79cd\u65b9\u6848\u4e5f\u6709\u4e24\u4e2a\u4e0d\u8db3 \u5728\u6267\u884c\u805a\u5408\u8ba1\u7b97\u65f6\uff0c\u6211\u4eec\u9700\u8981\u628a\u6570\u636e\u8bfb\u53d6\u5230\u5ba2\u6237\u7aef\u518d\u8fdb\u884c\u805a\u5408\uff0c\u5f53\u6709\u5927\u91cf\u6570\u636e\u8981\u805a\u5408\u65f6\uff0c\u6570\u636e\u4f20\u8f93\u5f00\u9500\u5927\uff1b \u6240\u6709\u7684\u6570\u636e\u4f1a\u5728\u4e24\u4e2a\u6570\u636e\u7c7b\u578b\u4e2d\u5404\u4fdd\u5b58\u4e00\u4efd\uff0c\u5185\u5b58\u5f00\u9500\u4e0d\u5c0f\u3002 \u4e0d\u8fc7\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u9002\u5f53\u7684\u6570\u636e\u8fc7\u671f\u65f6\u95f4\uff0c\u91ca\u653e\u5185\u5b58\uff0c\u51cf\u5c0f\u5185\u5b58\u538b\u529b \u3002 RedisTimeSeries \u6a21\u5757 \u8fd9\u662f\u4e13\u95e8\u4e3a\u5b58\u53d6\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u800c\u8bbe\u8ba1\u7684\u6269\u5c55\u6a21\u5757\u3002\u548c\u7b2c\u4e00\u79cd\u65b9\u6848\u76f8\u6bd4\uff0c RedisTimeSeries \u80fd\u652f\u6301\u76f4\u63a5\u5728 Redis \u5b9e\u4f8b\u4e0a\u8fdb\u884c\u591a\u79cd\u6570\u636e\u805a\u5408\u8ba1\u7b97\uff0c\u907f\u514d\u4e86\u5927\u91cf\u6570\u636e\u5728\u5b9e\u4f8b\u548c\u5ba2\u6237\u7aef\u95f4\u4f20\u8f93\u3002 \u4e0d\u8fc7\uff0c RedisTimeSeries \u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u4f7f\u7528\u4e86\u94fe\u8868\uff0c\u5b83\u7684\u8303\u56f4\u67e5\u8be2\u7684\u590d\u6742\u5ea6\u662f O(N) \u7ea7\u522b\u7684\uff0c\u540c\u65f6\uff0c\u5b83\u7684 TS.GET \u67e5\u8be2\u53ea\u80fd\u8fd4\u56de\u6700\u65b0\u7684\u6570\u636e\uff0c\u6ca1\u6709\u529e\u6cd5\u50cf\u7b2c\u4e00\u79cd\u65b9\u6848\u7684 Hash \u7c7b\u578b\u4e00\u6837\uff0c\u53ef\u4ee5\u8fd4\u56de\u4efb\u4e00\u65f6\u95f4\u70b9\u7684\u6570\u636e\u3002 \u7ec4\u5408\u4f7f\u7528 Hash \u548c Sorted Set\uff0c\u6216\u8005\u4f7f\u7528 RedisTimeSeries\uff0c\u5728\u652f\u6301\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u5b58\u53d6\u4e0a\u5404\u6709\u4f18\u52a3\u52bf \u5982\u679c\u4f60\u7684\u90e8\u7f72\u73af\u5883\u4e2d\u7f51\u7edc\u5e26\u5bbd\u9ad8\u3001Redis \u5b9e\u4f8b\u5185\u5b58\u5927\uff0c\u53ef\u4ee5\u4f18\u5148\u8003\u8651\u7b2c\u4e00\u79cd\u65b9\u6848\uff1b \u5982\u679c\u4f60\u7684\u90e8\u7f72\u73af\u5883\u4e2d\u7f51\u7edc\u3001\u5185\u5b58\u8d44\u6e90\u6709\u9650\uff0c\u800c\u4e14\u6570\u636e\u91cf\u5927\uff0c\u805a\u5408\u8ba1\u7b97\u9891\u7e41\uff0c\u9700\u8981\u6309\u6570\u636e\u96c6\u5408\u5c5e\u6027\u67e5\u8be2\uff0c\u53ef\u4ee5\u4f18\u5148\u8003\u8651\u7b2c\u4e8c\u79cd\u65b9\u6848\u3002 hash \u548c sorted set \u7c7b\u578b\u7684key\u4e0d\u80fd\u76f8\u540c\uff0c\u6587\u4ef6\u662f\u76f8\u540c\u7684\u3002 127.0.0.1:6379> MULTI OK 127.0.0.1:6379> ZADD dev:temp4 2020092201 26.8 QUEUED 127.0.0.1:6379> HSET dev:temp4 2020092201 26.8 QUEUED 127.0.0.1:6379> EXEC 1) (integer) 1 2) (error) WRONGTYPE Operation against a key holding the wrong kind of value 127.0.0.1:6379> MULTI OK 127.0.0.1:6379> HSET dev:temp5 2020092201 26.8 QUEUED 127.0.0.1:6379> ZADD dev:temp6 2020092201 26.8 QUEUED 127.0.0.1:6379> EXEC 1) (integer) 1 2) (integer) 1 \u4f7f\u7528 Sorted Set \u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u628a\u65f6\u95f4\u6233\u4f5c\u4e3a score \uff0c\u628a\u5b9e\u9645\u7684\u6570\u636e\u4f5c\u4e3a member\uff0c\u4f60\u89c9\u5f97\u8fd9\u6837\u4fdd\u5b58\u6570\u636e\u6709\u6ca1\u6709\u6f5c\u5728\u7684\u98ce\u9669\uff1f\u53e6\u5916\uff0c\u5982\u679c\u4f60\u662f Redis \u7684\u5f00\u53d1\u7ef4\u62a4\u8005\uff0c\u4f60\u4f1a\u628a\u805a\u5408\u8ba1\u7b97\u4e5f\u8bbe\u8ba1\u4e3a Sorted Set \u7684\u4e00\u4e2a\u5185\u5728\u529f\u80fd\u5417\uff1f \u5b58\u5728member\u91cd\u590d\u7684\u95ee\u9898\uff0c\u4f1a\u5bf9member\u8986\u76d6","title":"5\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap3/5redis_stream/","text":"\u7b2c\u4e94\u8282 \u5982\u4f55\u4f7f\u7528redis\u5b9e\u73b0\u6d88\u606f\u961f\u5217\u7684\u9700\u6c42 \u591a\u5206\u5e03\u5f0f\u7cfb\u7edf\u5fc5\u5907\u7684\u4e00\u4e2a\u57fa\u7840\u8f6f\u4ef6\u5c31\u662f\u6d88\u606f\u961f\u5217 \u6d88\u606f\u961f\u5217\u8981\u80fd\u652f\u6301\u7ec4\u4ef6\u901a\u4fe1\u6d88\u606f\u7684\u5feb\u901f\u8bfb\u5199\uff0c\u800c Redis \u672c\u8eab\u652f\u6301\u6570\u636e\u7684\u9ad8\u901f\u8bbf\u95ee\uff0c\u6b63\u597d\u53ef\u4ee5\u6ee1\u8db3\u6d88\u606f\u961f\u5217\u7684\u8bfb\u5199\u6027\u80fd\u9700\u6c42\u3002 Redis \u9002\u5408\u505a\u6d88\u606f\u961f\u5217\u5417\uff1f \u6d88\u606f\u961f\u5217\u7684\u6d88\u606f\u5b58\u53d6\u9700\u6c42\u662f\u4ec0\u4e48\uff1f Redis \u5982\u4f55\u5b9e\u73b0\u6d88\u606f\u961f\u5217\u7684\u9700\u6c42\uff1f 1\u3001\u6d88\u606f\u961f\u5217\u7684\u6d88\u606f\u5b58\u53d6\u9700\u6c42 \u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u5f53\u4e24\u4e2a\u7ec4\u4ef6\u8981\u57fa\u4e8e\u6d88\u606f\u961f\u5217\u8fdb\u884c\u901a\u4fe1\u65f6\uff0c\u4e00\u4e2a\u7ec4\u4ef6\u4f1a\u628a\u8981\u5904\u7406\u7684\u6570\u636e\u4ee5\u6d88\u606f\u7684\u5f62\u5f0f\u4f20\u9012\u7ed9\u6d88\u606f\u961f\u5217\uff0c\u7136\u540e\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u5c31\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\u5176\u4ed6\u64cd\u4f5c\u4e86\uff1b \u8fdc\u7aef\u7684\u53e6\u4e00\u4e2a\u7ec4\u4ef6\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u628a\u6d88\u606f\u8bfb\u53d6\u51fa\u6765\uff0c\u518d\u5728\u672c\u5730\u8fdb\u884c\u5904\u7406\u3002 \u5047\u8bbe\u7ec4\u4ef6 1 \u9700\u8981\u5bf9\u91c7\u96c6\u5230\u7684\u6570\u636e\u8fdb\u884c\u6c42\u548c\u8ba1\u7b97\uff0c\u5e76\u5199\u5165\u6570\u636e\u5e93\uff0c\u4f46\u662f\uff0c\u6d88\u606f\u5230\u8fbe\u7684\u901f\u5ea6\u5f88\u5feb\uff0c\u7ec4\u4ef6 1 \u6ca1\u6709\u529e\u6cd5\u53ca\u65f6\u5730\u65e2\u505a\u91c7\u96c6\uff0c\u53c8\u505a\u8ba1\u7b97\uff0c\u5e76\u4e14\u5199\u5165\u6570\u636e\u5e93\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u57fa\u4e8e\u6d88\u606f\u961f\u5217\u7684\u901a\u4fe1\uff0c\u8ba9\u7ec4\u4ef6 1 \u628a\u6570\u636e x \u548c y \u4fdd\u5b58\u4e3a JSON \u683c\u5f0f\u7684\u6d88\u606f\uff0c\u518d\u53d1\u5230\u6d88\u606f\u961f\u5217\uff0c\u8fd9\u6837\u5b83\u5c31\u53ef\u4ee5\u7ee7\u7eed\u63a5\u6536\u65b0\u7684\u6570\u636e\u4e86\u3002 \u7ec4\u4ef6 2 \u5219\u5f02\u6b65\u5730\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u628a\u6570\u636e\u8bfb\u53d6\u51fa\u6765\uff0c\u5728\u670d\u52a1\u5668 2 \u4e0a\u8fdb\u884c\u6c42\u548c\u8ba1\u7b97\u540e\uff0c\u518d\u5199\u5165\u6570\u636e\u5e93\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u6211\u4eec\u4e00\u822c\u628a\u6d88\u606f\u961f\u5217\u4e2d\u53d1\u9001\u6d88\u606f\u7684\u7ec4\u4ef6\u79f0\u4e3a\u751f\u4ea7\u8005\uff08\u4f8b\u5b50\u4e2d\u7684\u7ec4\u4ef6 1\uff09\uff0c\u628a\u63a5\u6536\u6d88\u606f\u7684\u7ec4\u4ef6\u79f0\u4e3a\u6d88\u8d39\u8005\uff08\u4f8b\u5b50\u4e2d\u7684\u7ec4\u4ef6 2\uff09 \uff0c\u4e0b\u56fe\u5c55\u793a\u4e86\u4e00\u4e2a\u901a\u7528\u7684\u6d88\u606f\u961f\u5217\u7684\u67b6\u6784\u6a21\u578b\uff1a \u5728\u4f7f\u7528\u6d88\u606f\u961f\u5217\u65f6\uff0c\u6d88\u8d39\u8005\u53ef\u4ee5\u5f02\u6b65\u8bfb\u53d6\u751f\u4ea7\u8005\u6d88\u606f\uff0c\u7136\u540e\u518d\u8fdb\u884c\u5904\u7406\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\u7684\u901f\u5ea6\u8fdc\u8fdc\u8d85\u8fc7\u4e86\u6d88\u8d39\u8005\u5904\u7406\u6d88\u606f\u7684\u901f\u5ea6\uff0c\u751f\u4ea7\u8005\u5df2\u7ecf\u53d1\u9001\u7684\u6d88\u606f\u4e5f\u53ef\u4ee5\u7f13\u5b58\u5728\u6d88\u606f\u961f\u5217\u4e2d\uff0c\u907f\u514d\u963b\u585e\u751f\u4ea7\u8005\uff0c\u8fd9\u662f\u6d88\u606f\u961f\u5217\u4f5c\u4e3a\u5206\u5e03\u5f0f\u7ec4\u4ef6\u901a\u4fe1\u7684\u4e00\u5927\u4f18\u52bf \u4e0d\u8fc7\uff0c\u6d88\u606f\u961f\u5217\u5728\u5b58\u53d6\u6d88\u606f\u65f6\uff0c\u5fc5\u987b\u8981\u6ee1\u8db3\u4e09\u4e2a\u9700\u6c42\uff0c \u5206\u522b\u662f\u6d88\u606f\u4fdd\u5e8f\u3001\u5904\u7406\u91cd\u590d\u7684\u6d88\u606f\u548c\u4fdd\u8bc1\u6d88\u606f\u53ef\u9760\u6027\u3002 1-1 \u9700\u6c42\u4e00\uff1a\u6d88\u606f\u4fdd\u5e8f \u867d\u7136\u6d88\u8d39\u8005\u662f\u5f02\u6b65\u5904\u7406\u6d88\u606f\uff0c\u4f46\u662f\uff0c\u6d88\u8d39\u8005\u4ecd\u7136\u9700\u8981\u6309\u7167\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\u7684\u987a\u5e8f\u6765\u5904\u7406\u6d88\u606f\uff0c\u907f\u514d\u540e\u53d1\u9001\u7684\u6d88\u606f\u88ab\u5148\u5904\u7406\u4e86\u3002 \u5bf9\u4e8e\u8981\u6c42\u6d88\u606f\u4fdd\u5e8f\u7684\u573a\u666f\u6765\u8bf4\uff0c\u4e00\u65e6\u51fa\u73b0\u8fd9\u79cd\u6d88\u606f\u88ab\u4e71\u5e8f\u5904\u7406\u7684\u60c5\u51b5\uff0c\u5c31\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e1a\u52a1\u903b\u8f91\u88ab\u9519\u8bef\u6267\u884c\uff0c\u4ece\u800c\u7ed9\u4e1a\u52a1\u65b9\u9020\u6210\u635f\u5931\u3002 \u66f4\u65b0\u5546\u54c1\u5e93\u5b58\u7684\u573a\u666f\u3002 \u5047\u8bbe\u751f\u4ea7\u8005\u8d1f\u8d23\u63a5\u6536\u5e93\u5b58\u66f4\u65b0\u8bf7\u6c42\uff0c\u6d88\u8d39\u8005\u8d1f\u8d23\u5b9e\u9645\u66f4\u65b0\u5e93\u5b58\uff0c\u73b0\u6709\u5e93\u5b58\u91cf\u662f 10\u3002 \u751f\u4ea7\u8005\u5148\u540e\u53d1\u9001\u4e86\u6d88\u606f 1 \u548c\u6d88\u606f 2\uff0c\u6d88\u606f 1 \u8981\u628a\u5546\u54c1 X \u7684\u5e93\u5b58\u8bb0\u5f55\u66f4\u65b0\u4e3a 5\uff0c\u6d88\u606f 2 \u662f\u628a\u5546\u54c1 X \u5e93\u5b58\u66f4\u65b0\u4e3a 3\u3002 \u5982\u679c\u6d88\u606f 1 \u548c 2 \u5728\u6d88\u606f\u961f\u5217\u4e2d\u65e0\u6cd5\u4fdd\u5e8f\uff0c\u51fa\u73b0\u6d88\u606f 2 \u65e9\u4e8e\u6d88\u606f 1 \u88ab\u5904\u7406\u7684\u60c5\u51b5\uff0c\u90a3\u4e48\uff0c\u5f88\u663e\u7136\uff0c\u5e93\u5b58\u66f4\u65b0\u5c31\u51fa\u9519\u4e86\u3002\u8fd9\u662f\u4e1a\u52a1\u5e94\u7528\u65e0\u6cd5\u63a5\u53d7\u7684\u3002 \u89e3\u51b3\u65b9\u6848 \uff1a\u4e0d\u8981\u628a\u66f4\u65b0\u540e\u7684\u5e93\u5b58\u91cf\u4f5c\u4e3a\u751f\u4ea7\u8005\u53d1\u9001\u7684\u6d88\u606f\uff0c\u800c\u662f\u628a\u5e93\u5b58\u6263\u9664\u503c\u4f5c\u4e3a\u6d88\u606f\u7684\u5185\u5bb9 \u8fd9\u6837\u4e00\u6765\uff0c\u6d88\u606f 1 \u662f\u6263\u51cf\u5e93\u5b58\u91cf 5\uff0c\u6d88\u606f 2 \u662f\u6263\u51cf\u5e93\u5b58\u91cf 2\u3002\u5982\u679c\u6d88\u606f 1 \u548c\u6d88\u606f 2 \u4e4b\u95f4\u6ca1\u6709\u5e93\u5b58\u67e5\u8be2\u8bf7\u6c42\u7684\u8bdd\uff0c\u5373\u4f7f\u6d88\u8d39\u8005\u5148\u5904\u7406\u6d88\u606f 2\uff0c\u518d\u5904\u7406\u6d88\u606f 1\uff0c\u8fd9\u4e2a\u65b9\u6848\u4e5f\u80fd\u591f\u4fdd\u8bc1\u6700\u7ec8\u7684\u5e93\u5b58\u91cf\u662f\u6b63\u786e\u7684\uff0c\u4e5f\u5c31\u662f\u5e93\u5b58\u91cf\u4e3a 3\u3002 \u4f46\u662f\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u8003\u8651\u8fd9\u6837\u4e00\u79cd\u60c5\u51b5\uff1a\u5047\u5982\u6d88\u8d39\u8005\u6536\u5230\u4e86\u8fd9\u6837\u4e09\u6761\u6d88\u606f\uff1a\u6d88\u606f 1 \u662f\u6263\u51cf\u5e93\u5b58\u91cf 5\uff0c\u6d88\u606f 2 \u662f\u8bfb\u53d6\u5e93\u5b58\u91cf\uff0c\u6d88\u606f 3 \u662f\u6263\u51cf\u5e93\u5b58\u91cf 2 \u5982\u679c\u6d88\u8d39\u8005\u5148\u5904\u7406\u4e86\u6d88\u606f 3\uff08\u628a\u5e93\u5b58\u91cf\u6263\u51cf 2\uff09\uff0c\u90a3\u4e48\u5e93\u5b58\u91cf\u5c31\u53d8\u6210\u4e86 8\u3002\u7136\u540e\uff0c\u6d88\u8d39\u8005\u5904\u7406\u4e86\u6d88\u606f 2\uff0c\u8bfb\u53d6\u5f53\u524d\u7684\u5e93\u5b58\u91cf\u662f 8\uff0c\u8fd9\u5c31\u4f1a\u51fa\u73b0\u5e93\u5b58\u91cf\u67e5\u8be2\u4e0d\u6b63\u786e\u7684\u60c5\u51b5\u3002 \u4ece\u4e1a\u52a1\u5e94\u7528\u5c42\u9762\u770b\uff0c\u6d88\u606f 1\u30012\u30013 \u5e94\u8be5\u662f\u987a\u5e8f\u6267\u884c\u7684\uff0c\u6240\u4ee5\uff0c\u6d88\u606f 2 \u67e5\u8be2\u5230\u7684\u5e94\u8be5\u662f\u6263\u51cf\u4e86 5 \u4ee5\u540e\u7684\u5e93\u5b58\u91cf\uff0c\u800c\u4e0d\u662f\u6263\u51cf\u4e86 2 \u4ee5\u540e\u7684\u5e93\u5b58\u91cf\u3002\u6240\u4ee5\uff0c\u7528\u5e93\u5b58\u6263\u9664\u503c\u4f5c\u4e3a\u6d88\u606f\u7684\u65b9\u6848\uff0c\u5728\u6d88\u606f\u4e2d\u540c\u65f6\u5305\u542b\u8bfb\u5199\u64cd\u4f5c\u7684\u573a\u666f\u4e0b\uff0c\u4f1a\u5e26\u6765\u6570\u636e\u8bfb\u53d6\u9519\u8bef\u7684\u95ee\u9898\u3002 1-2 \u9700\u6c42\u4e8c\uff1a\u91cd\u590d\u6d88\u606f\u5904\u7406 \u6d88\u8d39\u8005\u4ece\u6d88\u606f\u961f\u5217\u8bfb\u53d6\u6d88\u606f\u65f6\uff0c\u6709\u65f6\u4f1a\u56e0\u4e3a\u7f51\u7edc\u5835\u585e\u800c\u51fa\u73b0\u6d88\u606f\u91cd\u4f20\u7684\u60c5\u51b5\u3002\u6b64\u65f6\uff0c\u6d88\u8d39\u8005\u53ef\u80fd\u4f1a\u6536\u5230\u591a\u6761\u91cd\u590d\u7684\u6d88\u606f\u3002\u5bf9\u4e8e\u91cd\u590d\u7684\u6d88\u606f\uff0c \u6d88\u8d39\u8005\u5982\u679c\u591a\u6b21\u5904\u7406\u7684\u8bdd\uff0c\u5c31\u53ef\u80fd\u9020\u6210\u4e00\u4e2a\u4e1a\u52a1\u903b\u8f91\u88ab\u591a\u6b21\u6267\u884c\uff0c\u5982\u679c\u4e1a\u52a1\u903b\u8f91\u6b63\u597d\u662f\u8981\u4fee\u6539\u6570\u636e\uff0c\u90a3\u5c31\u4f1a\u51fa\u73b0\u6570\u636e\u88ab\u591a\u6b21\u4fee\u6539\u7684\u95ee\u9898\u4e86 \u3002 \u8fd8\u662f\u4ee5\u5e93\u5b58\u66f4\u65b0\u4e3a\u4f8b\uff0c\u5047\u8bbe\u6d88\u8d39\u8005\u6536\u5230\u4e86\u4e00\u6b21\u6d88\u606f 1\uff0c\u8981\u6263\u51cf\u5e93\u5b58\u91cf 5\uff0c\u7136\u540e\u53c8\u6536\u5230\u4e86\u4e00\u6b21\u6d88\u606f 1\uff0c\u90a3\u4e48\uff0c\u5982\u679c\u6d88\u8d39\u8005\u65e0\u6cd5\u8bc6\u522b\u8fd9\u4e24\u6761\u6d88\u606f\u5b9e\u9645\u662f\u4e00\u6761\u76f8\u540c\u6d88\u606f\u7684\u8bdd\uff0c\u5c31\u4f1a\u6267\u884c\u4e24\u6b21\u6263\u51cf\u5e93\u5b58\u91cf 5 \u7684\u64cd\u4f5c\uff0c\u6b64\u65f6\uff0c\u5e93\u5b58\u91cf\u5c31\u4e0d\u5bf9\u4e86\u3002\u8fd9\u5f53\u7136\u4e5f\u662f\u65e0\u6cd5\u63a5\u53d7\u7684\u3002 1-3 \u9700\u6c42\u4e09\uff1a\u6d88\u606f\u53ef\u9760\u6027\u4fdd\u8bc1 \u53e6\u5916\uff0c\u6d88\u8d39\u8005\u5728\u5904\u7406\u6d88\u606f\u7684\u65f6\u5019\uff0c\u8fd8\u53ef\u80fd\u51fa\u73b0\u56e0\u4e3a\u6545\u969c\u6216\u5b95\u673a\u5bfc\u81f4\u6d88\u606f\u6ca1\u6709\u5904\u7406\u5b8c\u6210\u7684\u60c5\u51b5\u3002\u6b64\u65f6\uff0c\u6d88\u606f\u961f\u5217\u9700\u8981\u80fd\u63d0\u4f9b\u6d88\u606f\u53ef\u9760\u6027\u7684\u4fdd\u8bc1\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c \u5f53\u6d88\u8d39\u8005\u91cd\u542f\u540e\uff0c\u53ef\u4ee5\u91cd\u65b0\u8bfb\u53d6\u6d88\u606f\u518d\u6b21\u8fdb\u884c\u5904\u7406\uff0c\u5426\u5219\uff0c\u5c31\u4f1a\u51fa\u73b0\u6d88\u606f\u6f0f\u5904\u7406\u7684\u95ee\u9898\u4e86 \u3002 Redis \u7684 List \u548c Streams \u4e24\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u5c31\u53ef\u4ee5\u6ee1\u8db3\u6d88\u606f\u961f\u5217\u7684\u8fd9\u4e09\u4e2a\u9700\u6c42\u3002 2\u3001\u57fa\u4e8e List \u7684\u6d88\u606f\u961f\u5217\u89e3\u51b3\u65b9\u6848 List \u672c\u8eab\u5c31\u662f\u6309\u5148\u8fdb\u5148\u51fa\u7684\u987a\u5e8f\u5bf9\u6570\u636e\u8fdb\u884c\u5b58\u53d6\u7684\uff0c\u6240\u4ee5\uff0c\u5982 \u679c\u4f7f\u7528 List \u4f5c\u4e3a\u6d88\u606f\u961f\u5217\u4fdd\u5b58\u6d88\u606f\u7684\u8bdd\uff0c\u5c31\u5df2\u7ecf\u80fd\u6ee1\u8db3\u6d88\u606f\u4fdd\u5e8f\u7684\u9700\u6c42\u4e86\u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u751f\u4ea7\u8005\u53ef\u4ee5\u4f7f\u7528 LPUSH \u547d\u4ee4\u628a\u8981\u53d1\u9001\u7684\u6d88\u606f\u4f9d\u6b21\u5199\u5165 List\uff0c\u800c\u6d88\u8d39\u8005\u5219\u53ef\u4ee5\u4f7f\u7528 RPOP \u547d\u4ee4\uff0c\u4ece List \u7684\u53e6\u4e00\u7aef\u6309\u7167\u6d88\u606f\u7684\u5199\u5165\u987a\u5e8f\uff0c\u4f9d\u6b21\u8bfb\u53d6\u6d88\u606f\u5e76\u8fdb\u884c\u5904\u7406\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff0c\u751f\u4ea7\u8005\u5148\u7528 LPUSH \u5199\u5165\u4e86\u4e24\u6761\u5e93\u5b58\u6d88\u606f\uff0c\u5206\u522b\u662f 5 \u548c 3 \uff0c\u8868\u793a\u8981\u628a\u5e93\u5b58\u66f4\u65b0\u4e3a 5 \u548c 3\uff1b \u6d88\u8d39\u8005\u5219\u7528 RPOP \u628a\u4e24\u6761\u6d88\u606f\u4f9d\u6b21\u8bfb\u51fa\uff0c\u7136\u540e\u8fdb\u884c\u76f8\u5e94\u7684\u5904\u7406\u3002 2-1 \u6d88\u8d39\u8005\u8bfb\u53d6\u6570\u636e\u6027\u80fd\u98ce\u9669 \u5728\u751f\u4ea7\u8005\u5f80 List \u4e2d\u5199\u5165\u6570\u636e\u65f6\uff0cList \u5e76\u4e0d\u4f1a\u4e3b\u52a8\u5730\u901a\u77e5\u6d88\u8d39\u8005\u6709\u65b0\u6d88\u606f\u5199\u5165\uff0c\u5982\u679c\u6d88\u8d39\u8005\u60f3\u8981\u53ca\u65f6\u5904\u7406\u6d88\u606f\uff0c\u5c31\u9700\u8981\u5728\u7a0b\u5e8f\u4e2d\u4e0d\u505c\u5730\u8c03\u7528 RPOP \u547d\u4ee4\uff08\u6bd4\u5982\u4f7f\u7528\u4e00\u4e2a while(1) \u5faa\u73af\uff09\u3002\u5982\u679c\u6709\u65b0\u6d88\u606f\u5199\u5165\uff0cRPOP \u547d\u4ee4\u5c31\u4f1a\u8fd4\u56de\u7ed3\u679c\uff0c\u5426\u5219\uff0cRPOP \u547d\u4ee4\u8fd4\u56de\u7a7a\u503c\uff0c\u518d\u7ee7\u7eed\u5faa\u73af\u3002 \u6240\u4ee5\uff0c\u5373\u4f7f\u6ca1\u6709\u65b0\u6d88\u606f\u5199\u5165 List\uff0c\u6d88\u8d39\u8005\u4e5f\u8981\u4e0d\u505c\u5730\u8c03\u7528 RPOP \u547d\u4ee4\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u6d88\u8d39\u8005\u7a0b\u5e8f\u7684 CPU \u4e00\u76f4\u6d88\u8017\u5728\u6267\u884c RPOP \u547d\u4ee4\u4e0a\uff0c\u5e26\u6765\u4e0d\u5fc5\u8981\u7684\u6027\u80fd\u635f\u5931\u3002 2-2 BRPOP \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cRedis \u63d0\u4f9b\u4e86 BRPOP \u547d\u4ee4\u3002 BRPOP \u547d\u4ee4\u4e5f\u79f0\u4e3a\u963b\u585e\u5f0f\u8bfb\u53d6\uff0c\u5ba2\u6237\u7aef\u5728\u6ca1\u6709\u8bfb\u5230\u961f\u5217\u6570\u636e\u65f6\uff0c\u81ea\u52a8\u963b\u585e\uff0c\u76f4\u5230\u6709\u65b0\u7684\u6570\u636e\u5199\u5165\u961f\u5217\uff0c\u518d\u5f00\u59cb\u8bfb\u53d6\u65b0\u6570\u636e\u3002 \u548c\u6d88\u8d39\u8005\u7a0b\u5e8f\u81ea\u5df1\u4e0d\u505c\u5730\u8c03\u7528 RPOP \u547d\u4ee4\u76f8\u6bd4\uff0c\u8fd9\u79cd\u65b9\u5f0f\u80fd\u8282\u7701 CPU \u5f00\u9500\u3002 2-3 \u6d88\u8d39\u8005\u7a0b\u5e8f\u672c\u8eab\u80fd\u5bf9\u91cd\u590d\u6d88\u606f\u8fdb\u884c\u5224\u65ad \u4e00\u65b9\u9762\uff0c\u6d88\u606f\u961f\u5217\u8981\u80fd\u7ed9\u6bcf\u4e00\u4e2a\u6d88\u606f\u63d0\u4f9b\u5168\u5c40\u552f\u4e00\u7684 ID \u53f7\uff1b \u53e6\u4e00\u65b9\u9762\uff0c\u6d88\u8d39\u8005\u7a0b\u5e8f\u8981\u628a\u5df2\u7ecf\u5904\u7406\u8fc7\u7684\u6d88\u606f\u7684 ID \u53f7\u8bb0\u5f55\u4e0b\u6765\u3002 \u5f53\u6536\u5230\u4e00\u6761\u6d88\u606f\u540e\uff0c\u6d88\u8d39\u8005\u7a0b\u5e8f\u5c31\u53ef\u4ee5\u5bf9\u6bd4\u6536\u5230\u7684\u6d88\u606f ID \u548c\u8bb0\u5f55\u7684\u5df2\u5904\u7406\u8fc7\u7684\u6d88\u606f ID\uff0c\u6765\u5224\u65ad\u5f53\u524d\u6536\u5230\u7684\u6d88\u606f\u6709\u6ca1\u6709\u7ecf\u8fc7\u5904\u7406\u3002\u5982\u679c\u5df2\u7ecf\u5904\u7406\u8fc7\uff0c\u90a3\u4e48\uff0c\u6d88\u8d39\u8005\u7a0b\u5e8f\u5c31\u4e0d\u518d\u8fdb\u884c\u5904\u7406\u4e86\u3002 \u8fd9\u79cd\u5904\u7406\u7279\u6027\u4e5f\u79f0\u4e3a\u5e42\u7b49\u6027\uff0c\u5e42\u7b49\u6027\u5c31\u662f\u6307\uff0c\u5bf9\u4e8e\u540c\u4e00\u6761\u6d88\u606f\uff0c\u6d88\u8d39\u8005\u6536\u5230\u4e00\u6b21\u7684\u5904\u7406\u7ed3\u679c\u548c\u6536\u5230\u591a\u6b21\u7684\u5904\u7406\u7ed3\u679c\u662f\u4e00\u81f4\u7684\u3002 \u4e0d\u8fc7\uff0cList \u672c\u8eab\u662f\u4e0d\u4f1a\u4e3a\u6bcf\u4e2a\u6d88\u606f\u751f\u6210 ID \u53f7\u7684\uff0c\u6240\u4ee5\uff0c\u6d88\u606f\u7684\u5168\u5c40\u552f\u4e00 ID \u53f7\u5c31\u9700\u8981\u751f\u4ea7\u8005\u7a0b\u5e8f\u5728\u53d1\u9001\u6d88\u606f\u524d\u81ea\u884c\u751f\u6210\u3002\u751f\u6210\u4e4b\u540e\uff0c\u6211\u4eec\u5728\u7528 LPUSH \u547d\u4ee4\u628a\u6d88\u606f\u63d2\u5165 List \u65f6\uff0c\u9700\u8981\u5728\u6d88\u606f\u4e2d\u5305\u542b\u8fd9\u4e2a\u5168\u5c40\u552f\u4e00 ID\u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5c31\u628a\u4e00\u6761\u5168\u5c40 ID \u4e3a 101030001\u3001\u5e93\u5b58\u91cf\u4e3a 5 \u7684\u6d88\u606f\u63d2\u5165\u4e86\u6d88\u606f\u961f\u5217\uff1a LPUSH mq \"101030001:stock:5\" (integer) 1 2-4 List \u7c7b\u578b\u662f\u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u53ef\u9760\u6027: BRPOPLPUSH \u5f53\u6d88\u8d39\u8005\u7a0b\u5e8f\u4ece List \u4e2d\u8bfb\u53d6\u4e00\u6761\u6d88\u606f\u540e\uff0cList \u5c31\u4e0d\u4f1a\u518d\u7559\u5b58\u8fd9\u6761\u6d88\u606f\u4e86\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u6d88\u8d39\u8005\u7a0b\u5e8f\u5728\u5904\u7406\u6d88\u606f\u7684\u8fc7\u7a0b\u51fa\u73b0\u4e86\u6545\u969c\u6216\u5b95\u673a\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6d88\u606f\u6ca1\u6709\u5904\u7406\u5b8c\u6210\uff0c\u90a3\u4e48\uff0c\u6d88\u8d39\u8005\u7a0b\u5e8f\u518d\u6b21\u542f\u52a8\u540e\uff0c\u5c31\u6ca1\u6cd5\u518d\u6b21\u4ece List \u4e2d\u8bfb\u53d6\u6d88\u606f\u4e86\u3002 \u4e3a\u4e86\u7559\u5b58\u6d88\u606f\uff0cList \u7c7b\u578b\u63d0\u4f9b\u4e86 BRPOPLPUSH \u547d\u4ee4\uff0c\u8fd9\u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\u662f\u8ba9\u6d88\u8d39\u8005\u7a0b\u5e8f\u4ece\u4e00\u4e2a List \u4e2d\u8bfb\u53d6\u6d88\u606f\uff0c\u540c\u65f6\uff0cRedis \u4f1a\u628a\u8fd9\u4e2a\u6d88\u606f\u518d\u63d2\u5165\u5230\u53e6\u4e00\u4e2a List\uff08\u53ef\u4ee5\u53eb\u4f5c\u5907\u4efd List\uff09\u7559\u5b58\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5982\u679c\u6d88\u8d39\u8005\u7a0b\u5e8f\u8bfb\u4e86\u6d88\u606f\u4f46\u6ca1\u80fd\u6b63\u5e38\u5904\u7406\uff0c\u7b49\u5b83\u91cd\u542f\u540e\uff0c\u5c31\u53ef\u4ee5\u4ece\u5907\u4efd List \u4e2d\u91cd\u65b0\u8bfb\u53d6\u6d88\u606f\u5e76\u8fdb\u884c\u5904\u7406\u4e86\u3002 \u5c55\u793a\u4e86\u4f7f\u7528 BRPOPLPUSH \u547d\u4ee4\u7559\u5b58\u6d88\u606f\uff0c\u4ee5\u53ca\u6d88\u8d39\u8005\u518d\u6b21\u8bfb\u53d6\u6d88\u606f\u7684\u8fc7\u7a0b \u751f\u4ea7\u8005\u5148\u7528 LPUSH \u628a\u6d88\u606f\u201c5\u201d\u201c3\u201d\u63d2\u5165\u5230\u6d88\u606f\u961f\u5217 mq \u4e2d\u3002 \u6d88\u8d39\u8005\u7a0b\u5e8f\u4f7f\u7528 BRPOPLPUSH \u547d\u4ee4\u8bfb\u53d6\u6d88\u606f\u201c5\u201d \u540c\u65f6\uff0c\u6d88\u606f\u201c5\u201d\u8fd8\u4f1a\u88ab Redis \u63d2\u5165\u5230 mqback \u961f\u5217\u4e2d \u3002 \u5982\u679c\u6d88\u8d39\u8005\u7a0b\u5e8f\u5904\u7406\u6d88\u606f\u201c5\u201d\u65f6\u5b95\u673a\u4e86\uff0c\u7b49\u5b83\u91cd\u542f\u540e\uff0c\u53ef\u4ee5\u4ece mqback \u4e2d\u518d\u6b21\u8bfb\u53d6\u6d88\u606f\u201c5\u201d\uff0c\u7ee7\u7eed\u5904\u7406\u3002 \u5728\u7528 List \u505a\u6d88\u606f\u961f\u5217\u65f6\uff0c\u6211\u4eec\u8fd8\u53ef\u80fd\u9047\u5230\u8fc7\u4e00\u4e2a\u95ee\u9898\uff1a \u751f\u4ea7\u8005\u6d88\u606f\u53d1\u9001\u5f88\u5feb\uff0c\u800c\u6d88\u8d39\u8005\u5904\u7406\u6d88\u606f\u7684\u901f\u5ea6\u6bd4\u8f83\u6162\uff0c\u8fd9\u5c31\u5bfc\u81f4 List \u4e2d\u7684\u6d88\u606f\u8d8a\u79ef\u8d8a\u591a\uff0c\u7ed9 Redis \u7684\u5185\u5b58\u5e26\u6765\u5f88\u5927\u538b\u529b\u3002 \u5230 Redis \u4ece 5.0 \u7248\u672c\u5f00\u59cb\u63d0\u4f9b\u7684 Streams \u6570\u636e\u7c7b\u578b\u4e86\u3002 \u548c List \u76f8\u6bd4\uff0cStreams \u540c\u6837\u80fd\u591f\u6ee1\u8db3\u6d88\u606f\u961f\u5217\u7684\u4e09\u5927\u9700\u6c42\u3002\u800c\u4e14\uff0c\u5b83\u8fd8\u652f\u6301\u6d88\u8d39\u7ec4\u5f62\u5f0f\u7684\u6d88\u606f\u8bfb\u53d6\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u6765\u4e86\u89e3\u4e0b Streams \u7684\u4f7f\u7528\u65b9\u6cd5\u3002 3\u3001\u57fa\u4e8e Streams \u7684\u6d88\u606f\u961f\u5217\u89e3\u51b3\u65b9\u6848 Streams \u662f Redis \u4e13\u95e8\u4e3a\u6d88\u606f\u961f\u5217\u8bbe\u8ba1\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u6d88\u606f\u961f\u5217\u64cd\u4f5c\u547d\u4ee4\u3002 XADD\uff1a\u63d2\u5165\u6d88\u606f\uff0c\u4fdd\u8bc1\u6709\u5e8f\uff0c\u53ef\u4ee5\u81ea\u52a8\u751f\u6210\u5168\u5c40\u552f\u4e00 ID\uff1b XREAD\uff1a\u7528\u4e8e\u8bfb\u53d6\u6d88\u606f\uff0c\u53ef\u4ee5\u6309 ID \u8bfb\u53d6\u6570\u636e\uff1b XREADGROUP\uff1a\u6309\u6d88\u8d39\u7ec4\u5f62\u5f0f\u8bfb\u53d6\u6d88\u606f\uff1b XPENDING \u548c XACK\uff1aXPENDING \u547d\u4ee4\u53ef\u4ee5\u7528\u6765\u67e5\u8be2\u6bcf\u4e2a\u6d88\u8d39\u7ec4\u5185\u6240\u6709\u6d88\u8d39\u8005\u5df2\u8bfb\u53d6\u4f46\u5c1a\u672a\u786e\u8ba4\u7684\u6d88\u606f\uff0c\u800c XACK \u547d\u4ee4\u7528\u4e8e\u5411\u6d88\u606f\u961f\u5217\u786e\u8ba4\u6d88\u606f\u5904\u7406\u5df2\u5b8c\u6210\u3002 3-1 XADD XADD \u547d\u4ee4\u53ef\u4ee5\u5f80\u6d88\u606f\u961f\u5217\u4e2d\u63d2\u5165\u65b0\u6d88\u606f\uff0c \u6d88\u606f\u7684\u683c\u5f0f\u662f\u952e - \u503c\u5bf9\u5f62\u5f0f\u3002\u5bf9\u4e8e\u63d2\u5165\u7684\u6bcf\u4e00\u6761\u6d88\u606f\uff0cStreams \u53ef\u4ee5\u81ea\u52a8\u4e3a\u5176\u751f\u6210\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u7684 ID\u3002 \u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u5f80\u540d\u79f0\u4e3a mqstream \u7684\u6d88\u606f\u961f\u5217\u4e2d\u63d2\u5165\u4e00\u6761\u6d88\u606f\uff0c\u6d88\u606f\u7684\u952e\u662f repo \uff0c\u503c\u662f 5 \u3002 \u5176\u4e2d\uff0c\u6d88\u606f\u961f\u5217\u540d\u79f0\u540e\u9762\u7684 * \uff0c\u8868\u793a\u8ba9 Redis \u4e3a\u63d2\u5165\u7684\u6570\u636e\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u7684 ID\uff0c\u4f8b\u5982 \u201c1599203861727-0\u201d \u3002 \u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4e0d\u7528 * \uff0c\u76f4\u63a5\u5728\u6d88\u606f\u961f\u5217\u540d\u79f0\u540e\u81ea\u884c\u8bbe\u5b9a\u4e00\u4e2a ID \u53f7\uff0c\u53ea\u8981\u4fdd\u8bc1\u8fd9\u4e2a ID \u53f7\u662f\u5168\u5c40\u552f\u4e00\u7684\u5c31\u884c\u3002\u4e0d\u8fc7\uff0c\u76f8\u6bd4\u81ea\u884c\u8bbe\u5b9a ID \u53f7\uff0c\u4f7f\u7528 * \u4f1a\u66f4\u52a0\u65b9\u4fbf\u9ad8\u6548\u3002 XADD mqstream * repo 5 \"1599203861727-0\" \u53ef\u4ee5\u770b\u5230\uff0c\u6d88\u606f\u7684\u5168\u5c40\u552f\u4e00 ID \u7531\u4e24\u90e8\u5206\u7ec4\u6210 \uff0c \u7b2c\u4e00\u90e8\u5206\u201c1599203861727\u201d\u662f\u6570\u636e\u63d2\u5165\u65f6\uff0c\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u8ba1\u7b97\u7684\u5f53\u524d\u670d\u52a1\u5668\u65f6\u95f4\uff0c\u7b2c\u4e8c\u90e8\u5206\u8868\u793a\u63d2\u5165\u6d88\u606f\u5728\u5f53\u524d\u6beb\u79d2\u5185\u7684\u6d88\u606f\u5e8f\u53f7\uff0c\u8fd9\u662f\u4ece 0 \u5f00\u59cb\u7f16\u53f7\u7684\u3002 \u4f8b\u5982\uff0c \u201c1599203861727-0\u201d\u5c31\u8868\u793a\u5728\u201c1599203861727\u201d\u6beb\u79d2\u5185\u7684\u7b2c 1 \u6761\u6d88\u606f \u3002 3-2 XREAD XREAD \u5728\u8bfb\u53d6\u6d88\u606f\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u6d88\u606f ID\uff0c\u5e76\u4ece\u8fd9\u4e2a\u6d88\u606f ID \u7684\u4e0b\u4e00\u6761\u6d88\u606f\u5f00\u59cb\u8fdb\u884c\u8bfb\u53d6\u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u4ece ID \u53f7\u4e3a 1599203861727-0 \u7684\u6d88\u606f\u5f00\u59cb\uff0c\u8bfb\u53d6\u540e\u7eed\u7684\u6240\u6709\u6d88\u606f\uff08\u793a\u4f8b\u4e2d\u4e00\u5171 3 \u6761\uff09\u3002 XREAD BLOCK 100 STREAMS mqstream 1599203861727-0 1) 1) \"mqstream\" 2) 1) 1) \"1599274912765-0\" 2) 1) \"repo\" 2) \"3\" 2) 1) \"1599274925823-0\" 2) 1) \"repo\" 2) \"2\" 3) 1) \"1599274927910-0\" 2) 1) \"repo\" 2) \"1\" \u53e6\u5916\uff0c\u6d88\u8d39\u8005\u4e5f\u53ef\u4ee5\u5728\u8c03\u7528 XRAED \u65f6\u8bbe\u5b9a block \u914d\u7f6e\u9879\uff0c\u5b9e\u73b0\u7c7b\u4f3c\u4e8e BRPOP \u7684\u963b\u585e\u8bfb\u53d6\u64cd\u4f5c\u3002 \u5f53\u6d88\u606f\u961f\u5217\u4e2d\u6ca1\u6709\u6d88\u606f\u65f6\uff0c \u4e00\u65e6\u8bbe\u7f6e\u4e86 block \u914d\u7f6e\u9879\uff0cXREAD \u5c31\u4f1a\u963b\u585e\uff0c\u963b\u585e\u7684\u65f6\u957f\u53ef\u4ee5\u5728 block \u914d\u7f6e\u9879\u8fdb\u884c\u8bbe\u7f6e\u3002 XREAD block 10000 streams mqstream $ (nil) (10.00s) 3-3 XGROUP \u521b\u5efa\u6d88\u8d39\u7ec4 Streams \u672c\u8eab\u53ef\u4ee5\u4f7f\u7528 XGROUP \u521b\u5efa\u6d88\u8d39\u7ec4\uff0c\u521b\u5efa\u6d88\u8d39\u7ec4\u4e4b\u540e\uff0cStreams \u53ef\u4ee5\u4f7f\u7528 XREADGROUP \u547d\u4ee4\u8ba9\u6d88\u8d39\u7ec4\u5185\u7684\u6d88\u8d39\u8005\u8bfb\u53d6\u6d88\u606f\uff0c \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a group1 \u7684\u6d88\u8d39\u7ec4\uff0c\u8fd9\u4e2a\u6d88\u8d39\u7ec4\u6d88\u8d39\u7684\u6d88\u606f\u961f\u5217\u662f mqstream\u3002 XGROUP create mqstream group1 0 OK \u7136\u540e\uff0c\u6211\u4eec\u518d\u6267\u884c\u4e00\u6bb5\u547d\u4ee4\uff0c \u8ba9 group1 \u6d88\u8d39\u7ec4\u91cc\u7684\u6d88\u8d39\u8005 consumer1 \u4ece mqstream \u4e2d\u8bfb\u53d6\u6240\u6709\u6d88\u606f\uff0c\u5176\u4e2d\uff0c\u547d\u4ee4\u6700\u540e\u7684\u53c2\u6570 \u201c>\u201d \uff0c\u8868\u793a\u4ece\u7b2c\u4e00\u6761\u5c1a\u672a\u88ab\u6d88\u8d39\u7684\u6d88\u606f\u5f00\u59cb\u8bfb\u53d6\u3002 \u56e0\u4e3a\u5728 consumer1 \u8bfb\u53d6\u6d88\u606f\u524d\uff0c group1 \u4e2d\u6ca1\u6709\u5176\u4ed6\u6d88\u8d39\u8005\u8bfb\u53d6\u8fc7\u6d88\u606f\uff0c\u6240\u4ee5\uff0c consumer1 \u5c31\u5f97\u5230 mqstream \u6d88\u606f\u961f\u5217\u4e2d\u7684\u6240\u6709\u6d88\u606f\u4e86\uff08\u4e00\u5171 4 \u6761\uff09\u3002 XREADGROUP group group1 consumer1 streams mqstream > 1) 1) \"mqstream\" 2) 1) 1) \"1599203861727-0\" 2) 1) \"repo\" 2) \"5\" 2) 1) \"1599274912765-0\" 2) 1) \"repo\" 2) \"3\" 3) 1) \"1599274925823-0\" 2) 1) \"repo\" 2) \"2\" 4) 1) \"1599274927910-0\" 2) 1) \"repo\" 2) \"1\" \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6d88\u606f\u961f\u5217\u4e2d\u7684\u6d88\u606f\u4e00\u65e6\u88ab\u6d88\u8d39\u7ec4\u91cc\u7684\u4e00\u4e2a\u6d88\u8d39\u8005\u8bfb\u53d6\u4e86\uff0c\u5c31\u4e0d\u80fd\u518d\u88ab\u8be5\u6d88\u8d39\u7ec4\u5185\u7684\u5176\u4ed6\u6d88\u8d39\u8005\u8bfb\u53d6\u4e86\u3002 \u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u6267\u884c\u5b8c\u521a\u624d\u7684 XREADGROUP \u547d\u4ee4\u540e\uff0c\u518d\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c \u8ba9 group1 \u5185\u7684 consumer2 \u8bfb\u53d6\u6d88\u606f\u65f6\uff0c consumer2 \u8bfb\u5230\u7684\u5c31\u662f\u7a7a\u503c\uff0c\u56e0\u4e3a\u6d88\u606f\u5df2\u7ecf\u88ab consumer1 \u8bfb\u53d6\u5b8c\u4e86 \uff0c\u5982\u4e0b\u6240\u793a\uff1a XREADGROUP group group1 consumer2 streams mqstream 0 1) 1) \"mqstream\" 2) (empty list or set) \u4f7f\u7528\u6d88\u8d39\u7ec4\u7684\u76ee\u7684\u662f\u8ba9\u7ec4\u5185\u7684\u591a\u4e2a\u6d88\u8d39\u8005\u5171\u540c\u5206\u62c5\u8bfb\u53d6\u6d88\u606f\uff0c \u6240\u4ee5\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u8ba9\u6bcf\u4e2a\u6d88\u8d39\u8005\u8bfb\u53d6\u90e8\u5206\u6d88\u606f\uff0c\u4ece\u800c\u5b9e\u73b0\u6d88\u606f\u8bfb\u53d6\u8d1f\u8f7d\u5728\u591a\u4e2a\u6d88\u8d39\u8005\u95f4\u662f\u5747\u8861\u5206\u5e03\u7684\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u8ba9 group2 \u4e2d\u7684 consumer1\u30012\u30013 \u5404\u81ea\u8bfb\u53d6\u4e00\u6761\u6d88\u606f\u3002 XREADGROUP group group2 consumer1 count 1 streams mqstream > 1) 1) \"mqstream\" 2) 1) 1) \"1599203861727-0\" 2) 1) \"repo\" 2) \"5\" XREADGROUP group group2 consumer2 count 1 streams mqstream > 1) 1) \"mqstream\" 2) 1) 1) \"1599274912765-0\" 2) 1) \"repo\" 2) \"3\" XREADGROUP group group2 consumer3 count 1 streams mqstream > 1) 1) \"mqstream\" 2) 1) 1) \"1599274925823-0\" 2) 1) \"repo\" 2) \"2\" 3-4 XPENDING \u548c XACK \u4e3a\u4e86\u4fdd\u8bc1\u6d88\u8d39\u8005\u5728\u53d1\u751f\u6545\u969c\u6216\u5b95\u673a\u518d\u6b21\u91cd\u542f\u540e\uff0c\u4ecd\u7136\u53ef\u4ee5\u8bfb\u53d6\u672a\u5904\u7406\u5b8c\u7684\u6d88\u606f\uff0c Streams \u4f1a\u81ea\u52a8\u4f7f\u7528\u5185\u90e8\u961f\u5217\uff08\u4e5f\u79f0\u4e3a PENDING List\uff09\u7559\u5b58\u6d88\u8d39\u7ec4\u91cc\u6bcf\u4e2a\u6d88\u8d39\u8005\u8bfb\u53d6\u7684\u6d88\u606f \uff0c\u76f4\u5230\u6d88\u8d39\u8005\u4f7f\u7528 XACK \u547d\u4ee4\u901a\u77e5 Streams\u201c\u6d88\u606f\u5df2\u7ecf\u5904\u7406\u5b8c\u6210\u201d\u3002 \u5982\u679c\u6d88\u8d39\u8005\u6ca1\u6709\u6210\u529f\u5904\u7406\u6d88\u606f\uff0c\u5b83\u5c31\u4e0d\u4f1a\u7ed9 Streams \u53d1\u9001 XACK \u547d\u4ee4\uff0c\u6d88\u606f\u4ecd\u7136\u4f1a\u7559\u5b58\u3002 \u6b64\u65f6\uff0c\u6d88\u8d39\u8005\u53ef\u4ee5\u5728\u91cd\u542f\u540e\uff0c\u7528 XPENDING \u547d\u4ee4\u67e5\u770b\u5df2\u8bfb\u53d6\u3001\u4f46\u5c1a\u672a\u786e\u8ba4\u5904\u7406\u5b8c\u6210\u7684\u6d88\u606f\u3002 \u5982\u679c\u6d88\u8d39\u8005\u6ca1\u6709\u6210\u529f\u5904\u7406\u6d88\u606f\uff0c\u5b83\u5c31\u4e0d\u4f1a\u7ed9 Streams \u53d1\u9001 XACK \u547d\u4ee4\uff0c\u6d88\u606f\u4ecd\u7136\u4f1a\u7559\u5b58\u3002\u6b64\u65f6\uff0c\u6d88\u8d39\u8005\u53ef\u4ee5\u5728\u91cd\u542f\u540e\uff0c\u7528 XPENDING \u547d\u4ee4\u67e5\u770b\u5df2\u8bfb\u53d6\u3001\u4f46\u5c1a\u672a\u786e\u8ba4\u5904\u7406\u5b8c\u6210\u7684\u6d88\u606f\u3002 XPENDING mqstream group2 1) (integer) 3 2) \"1599203861727-0\" 3) \"1599274925823-0\" 4) 1) 1) \"consumer1\" 2) \"1\" 2) 1) \"consumer2\" 2) \"1\" 3) 1) \"consumer3\" 2) \"1\" \u5982\u679c\u6211\u4eec\u8fd8\u9700\u8981\u8fdb\u4e00\u6b65\u67e5\u770b\u67d0\u4e2a\u6d88\u8d39\u8005\u5177\u4f53\u8bfb\u53d6\u4e86\u54ea\u4e9b\u6570\u636e\uff0c\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff1a XPENDING mqstream group2 - + 10 consumer2 1) 1) \"1599274912765-0\" 2) \"consumer2\" 3) (integer) 513336 4) (integer) 1 \u53ef\u4ee5\u770b\u5230\uff0cconsumer2 \u5df2\u8bfb\u53d6\u7684\u6d88\u606f\u7684 ID \u662f 1599274912765-0 \u4e00\u65e6\u6d88\u606f 1599274912765-0 \u88ab consumer2 \u5904\u7406\u4e86\uff0c consumer2 \u5c31\u53ef\u4ee5\u4f7f\u7528 XACK \u547d\u4ee4\u901a\u77e5 Streams \uff0c\u7136\u540e\u8fd9\u6761\u6d88\u606f\u5c31\u4f1a\u88ab\u5220\u9664\u3002\u5f53\u6211\u4eec\u518d\u4f7f\u7528 XPENDING \u547d\u4ee4\u67e5\u770b\u65f6\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\uff0c consumer2 \u5df2\u7ecf\u6ca1\u6709\u5df2\u8bfb\u53d6\u3001\u4f46\u5c1a\u672a\u786e\u8ba4\u5904\u7406\u7684\u6d88\u606f\u4e86\u3002 XACK mqstream group2 1599274912765-0 (integer) 1 XPENDING mqstream group2 - + 10 consumer2 (empty list or set) 4\u3001\u672c\u8282\u5c0f\u7ed3 \u5206\u5e03\u5f0f\u7cfb\u7edf\u7ec4\u4ef6\u4f7f\u7528\u6d88\u606f\u961f\u5217\u65f6\u7684\u4e09\u5927\u9700\u6c42\uff1a \u6d88\u606f\u4fdd\u5e8f\u3001\u91cd\u590d\u6d88\u606f\u5904\u7406\u548c\u6d88\u606f\u53ef\u9760\u6027\u4fdd\u8bc1 \uff0c\u8fd9\u4e09\u5927\u9700\u6c42\u53ef\u4ee5\u8fdb\u4e00\u6b65\u8f6c\u6362\u4e3a\u5bf9\u6d88\u606f\u961f\u5217\u7684\u4e09\u5927\u8981\u6c42\uff1a \u6d88\u606f\u6570\u636e\u6709\u5e8f\u5b58\u53d6\uff0c\u6d88\u606f\u6570\u636e\u5177\u6709\u5168\u5c40\u552f\u4e00\u7f16\u53f7\uff0c\u4ee5\u53ca\u6d88\u606f\u6570\u636e\u5728\u6d88\u8d39\u5b8c\u6210\u540e\u88ab\u5220\u9664\u3002 \u5176\u5b9e\uff0c\u5173\u4e8e Redis \u662f\u5426\u9002\u5408\u505a\u6d88\u606f\u961f\u5217\uff0c\u4e1a\u754c\u4e00\u76f4\u662f\u6709\u4e89\u8bba\u7684\u3002\u5f88\u591a\u4eba\u8ba4\u4e3a\uff0c\u8981\u4f7f\u7528\u6d88\u606f\u961f\u5217\uff0c\u5c31\u5e94\u8be5\u91c7\u7528 Kafka\u3001RabbitMQ \u8fd9\u4e9b\u4e13\u95e8\u9762\u5411\u6d88\u606f\u961f\u5217\u573a\u666f\u7684\u8f6f\u4ef6\uff0c\u800c Redis \u66f4\u52a0\u9002\u5408\u505a\u7f13\u5b58\u3002 Redis \u662f\u4e00\u4e2a\u975e\u5e38\u8f7b\u91cf\u7ea7\u7684\u952e\u503c\u6570\u636e\u5e93\uff0c\u90e8\u7f72\u4e00\u4e2a Redis \u5b9e\u4f8b\u5c31\u662f\u542f\u52a8\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u90e8\u7f72 Redis \u96c6\u7fa4\uff0c\u4e5f\u5c31\u662f\u90e8\u7f72\u591a\u4e2a Redis \u5b9e\u4f8b\u3002\u800c Kafka\u3001RabbitMQ \u90e8\u7f72\u65f6\uff0c\u6d89\u53ca\u989d\u5916\u7684\u7ec4\u4ef6\uff0c\u4f8b\u5982 Kafka \u7684\u8fd0\u884c\u5c31\u9700\u8981\u518d\u90e8\u7f72 ZooKeeper\u3002 \u76f8\u6bd4 Redis \u6765\u8bf4\uff0cKafka \u548c RabbitMQ \u4e00\u822c\u88ab\u8ba4\u4e3a\u662f\u91cd\u91cf\u7ea7\u7684\u6d88\u606f\u961f\u5217\u3002 \u5982\u679c\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u7684\u7ec4\u4ef6\u6d88\u606f\u901a\u4fe1\u91cf\u4e0d\u5927\uff0c\u90a3\u4e48\uff0cRedis \u53ea\u9700\u8981\u4f7f\u7528\u6709\u9650\u7684\u5185\u5b58\u7a7a\u95f4\u5c31\u80fd\u6ee1\u8db3\u6d88\u606f\u5b58\u50a8\u7684\u9700\u6c42\uff0c\u800c\u4e14\uff0c Redis \u7684\u9ad8\u6027\u80fd\u7279\u6027\u80fd\u652f\u6301\u5feb\u901f\u7684\u6d88\u606f\u8bfb\u5199\uff0c\u4e0d\u5931\u4e3a\u6d88\u606f\u961f\u5217\u7684\u4e00\u4e2a\u597d\u7684\u89e3\u51b3\u65b9\u6848\u3002","title":"\u7b2c\u4e94\u8282 \u5982\u4f55\u4f7f\u7528redis\u5b9e\u73b0\u6d88\u606f\u961f\u5217\u7684\u9700\u6c42"},{"location":"chap3/5redis_stream/#redis","text":"\u591a\u5206\u5e03\u5f0f\u7cfb\u7edf\u5fc5\u5907\u7684\u4e00\u4e2a\u57fa\u7840\u8f6f\u4ef6\u5c31\u662f\u6d88\u606f\u961f\u5217 \u6d88\u606f\u961f\u5217\u8981\u80fd\u652f\u6301\u7ec4\u4ef6\u901a\u4fe1\u6d88\u606f\u7684\u5feb\u901f\u8bfb\u5199\uff0c\u800c Redis \u672c\u8eab\u652f\u6301\u6570\u636e\u7684\u9ad8\u901f\u8bbf\u95ee\uff0c\u6b63\u597d\u53ef\u4ee5\u6ee1\u8db3\u6d88\u606f\u961f\u5217\u7684\u8bfb\u5199\u6027\u80fd\u9700\u6c42\u3002 Redis \u9002\u5408\u505a\u6d88\u606f\u961f\u5217\u5417\uff1f \u6d88\u606f\u961f\u5217\u7684\u6d88\u606f\u5b58\u53d6\u9700\u6c42\u662f\u4ec0\u4e48\uff1f Redis \u5982\u4f55\u5b9e\u73b0\u6d88\u606f\u961f\u5217\u7684\u9700\u6c42\uff1f","title":"\u7b2c\u4e94\u8282 \u5982\u4f55\u4f7f\u7528redis\u5b9e\u73b0\u6d88\u606f\u961f\u5217\u7684\u9700\u6c42"},{"location":"chap3/5redis_stream/#1","text":"\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u5f53\u4e24\u4e2a\u7ec4\u4ef6\u8981\u57fa\u4e8e\u6d88\u606f\u961f\u5217\u8fdb\u884c\u901a\u4fe1\u65f6\uff0c\u4e00\u4e2a\u7ec4\u4ef6\u4f1a\u628a\u8981\u5904\u7406\u7684\u6570\u636e\u4ee5\u6d88\u606f\u7684\u5f62\u5f0f\u4f20\u9012\u7ed9\u6d88\u606f\u961f\u5217\uff0c\u7136\u540e\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u5c31\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\u5176\u4ed6\u64cd\u4f5c\u4e86\uff1b \u8fdc\u7aef\u7684\u53e6\u4e00\u4e2a\u7ec4\u4ef6\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u628a\u6d88\u606f\u8bfb\u53d6\u51fa\u6765\uff0c\u518d\u5728\u672c\u5730\u8fdb\u884c\u5904\u7406\u3002 \u5047\u8bbe\u7ec4\u4ef6 1 \u9700\u8981\u5bf9\u91c7\u96c6\u5230\u7684\u6570\u636e\u8fdb\u884c\u6c42\u548c\u8ba1\u7b97\uff0c\u5e76\u5199\u5165\u6570\u636e\u5e93\uff0c\u4f46\u662f\uff0c\u6d88\u606f\u5230\u8fbe\u7684\u901f\u5ea6\u5f88\u5feb\uff0c\u7ec4\u4ef6 1 \u6ca1\u6709\u529e\u6cd5\u53ca\u65f6\u5730\u65e2\u505a\u91c7\u96c6\uff0c\u53c8\u505a\u8ba1\u7b97\uff0c\u5e76\u4e14\u5199\u5165\u6570\u636e\u5e93\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u57fa\u4e8e\u6d88\u606f\u961f\u5217\u7684\u901a\u4fe1\uff0c\u8ba9\u7ec4\u4ef6 1 \u628a\u6570\u636e x \u548c y \u4fdd\u5b58\u4e3a JSON \u683c\u5f0f\u7684\u6d88\u606f\uff0c\u518d\u53d1\u5230\u6d88\u606f\u961f\u5217\uff0c\u8fd9\u6837\u5b83\u5c31\u53ef\u4ee5\u7ee7\u7eed\u63a5\u6536\u65b0\u7684\u6570\u636e\u4e86\u3002 \u7ec4\u4ef6 2 \u5219\u5f02\u6b65\u5730\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u628a\u6570\u636e\u8bfb\u53d6\u51fa\u6765\uff0c\u5728\u670d\u52a1\u5668 2 \u4e0a\u8fdb\u884c\u6c42\u548c\u8ba1\u7b97\u540e\uff0c\u518d\u5199\u5165\u6570\u636e\u5e93\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u6211\u4eec\u4e00\u822c\u628a\u6d88\u606f\u961f\u5217\u4e2d\u53d1\u9001\u6d88\u606f\u7684\u7ec4\u4ef6\u79f0\u4e3a\u751f\u4ea7\u8005\uff08\u4f8b\u5b50\u4e2d\u7684\u7ec4\u4ef6 1\uff09\uff0c\u628a\u63a5\u6536\u6d88\u606f\u7684\u7ec4\u4ef6\u79f0\u4e3a\u6d88\u8d39\u8005\uff08\u4f8b\u5b50\u4e2d\u7684\u7ec4\u4ef6 2\uff09 \uff0c\u4e0b\u56fe\u5c55\u793a\u4e86\u4e00\u4e2a\u901a\u7528\u7684\u6d88\u606f\u961f\u5217\u7684\u67b6\u6784\u6a21\u578b\uff1a \u5728\u4f7f\u7528\u6d88\u606f\u961f\u5217\u65f6\uff0c\u6d88\u8d39\u8005\u53ef\u4ee5\u5f02\u6b65\u8bfb\u53d6\u751f\u4ea7\u8005\u6d88\u606f\uff0c\u7136\u540e\u518d\u8fdb\u884c\u5904\u7406\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\u7684\u901f\u5ea6\u8fdc\u8fdc\u8d85\u8fc7\u4e86\u6d88\u8d39\u8005\u5904\u7406\u6d88\u606f\u7684\u901f\u5ea6\uff0c\u751f\u4ea7\u8005\u5df2\u7ecf\u53d1\u9001\u7684\u6d88\u606f\u4e5f\u53ef\u4ee5\u7f13\u5b58\u5728\u6d88\u606f\u961f\u5217\u4e2d\uff0c\u907f\u514d\u963b\u585e\u751f\u4ea7\u8005\uff0c\u8fd9\u662f\u6d88\u606f\u961f\u5217\u4f5c\u4e3a\u5206\u5e03\u5f0f\u7ec4\u4ef6\u901a\u4fe1\u7684\u4e00\u5927\u4f18\u52bf \u4e0d\u8fc7\uff0c\u6d88\u606f\u961f\u5217\u5728\u5b58\u53d6\u6d88\u606f\u65f6\uff0c\u5fc5\u987b\u8981\u6ee1\u8db3\u4e09\u4e2a\u9700\u6c42\uff0c \u5206\u522b\u662f\u6d88\u606f\u4fdd\u5e8f\u3001\u5904\u7406\u91cd\u590d\u7684\u6d88\u606f\u548c\u4fdd\u8bc1\u6d88\u606f\u53ef\u9760\u6027\u3002","title":"1\u3001\u6d88\u606f\u961f\u5217\u7684\u6d88\u606f\u5b58\u53d6\u9700\u6c42"},{"location":"chap3/5redis_stream/#1-1","text":"\u867d\u7136\u6d88\u8d39\u8005\u662f\u5f02\u6b65\u5904\u7406\u6d88\u606f\uff0c\u4f46\u662f\uff0c\u6d88\u8d39\u8005\u4ecd\u7136\u9700\u8981\u6309\u7167\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\u7684\u987a\u5e8f\u6765\u5904\u7406\u6d88\u606f\uff0c\u907f\u514d\u540e\u53d1\u9001\u7684\u6d88\u606f\u88ab\u5148\u5904\u7406\u4e86\u3002 \u5bf9\u4e8e\u8981\u6c42\u6d88\u606f\u4fdd\u5e8f\u7684\u573a\u666f\u6765\u8bf4\uff0c\u4e00\u65e6\u51fa\u73b0\u8fd9\u79cd\u6d88\u606f\u88ab\u4e71\u5e8f\u5904\u7406\u7684\u60c5\u51b5\uff0c\u5c31\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e1a\u52a1\u903b\u8f91\u88ab\u9519\u8bef\u6267\u884c\uff0c\u4ece\u800c\u7ed9\u4e1a\u52a1\u65b9\u9020\u6210\u635f\u5931\u3002 \u66f4\u65b0\u5546\u54c1\u5e93\u5b58\u7684\u573a\u666f\u3002 \u5047\u8bbe\u751f\u4ea7\u8005\u8d1f\u8d23\u63a5\u6536\u5e93\u5b58\u66f4\u65b0\u8bf7\u6c42\uff0c\u6d88\u8d39\u8005\u8d1f\u8d23\u5b9e\u9645\u66f4\u65b0\u5e93\u5b58\uff0c\u73b0\u6709\u5e93\u5b58\u91cf\u662f 10\u3002 \u751f\u4ea7\u8005\u5148\u540e\u53d1\u9001\u4e86\u6d88\u606f 1 \u548c\u6d88\u606f 2\uff0c\u6d88\u606f 1 \u8981\u628a\u5546\u54c1 X \u7684\u5e93\u5b58\u8bb0\u5f55\u66f4\u65b0\u4e3a 5\uff0c\u6d88\u606f 2 \u662f\u628a\u5546\u54c1 X \u5e93\u5b58\u66f4\u65b0\u4e3a 3\u3002 \u5982\u679c\u6d88\u606f 1 \u548c 2 \u5728\u6d88\u606f\u961f\u5217\u4e2d\u65e0\u6cd5\u4fdd\u5e8f\uff0c\u51fa\u73b0\u6d88\u606f 2 \u65e9\u4e8e\u6d88\u606f 1 \u88ab\u5904\u7406\u7684\u60c5\u51b5\uff0c\u90a3\u4e48\uff0c\u5f88\u663e\u7136\uff0c\u5e93\u5b58\u66f4\u65b0\u5c31\u51fa\u9519\u4e86\u3002\u8fd9\u662f\u4e1a\u52a1\u5e94\u7528\u65e0\u6cd5\u63a5\u53d7\u7684\u3002 \u89e3\u51b3\u65b9\u6848 \uff1a\u4e0d\u8981\u628a\u66f4\u65b0\u540e\u7684\u5e93\u5b58\u91cf\u4f5c\u4e3a\u751f\u4ea7\u8005\u53d1\u9001\u7684\u6d88\u606f\uff0c\u800c\u662f\u628a\u5e93\u5b58\u6263\u9664\u503c\u4f5c\u4e3a\u6d88\u606f\u7684\u5185\u5bb9 \u8fd9\u6837\u4e00\u6765\uff0c\u6d88\u606f 1 \u662f\u6263\u51cf\u5e93\u5b58\u91cf 5\uff0c\u6d88\u606f 2 \u662f\u6263\u51cf\u5e93\u5b58\u91cf 2\u3002\u5982\u679c\u6d88\u606f 1 \u548c\u6d88\u606f 2 \u4e4b\u95f4\u6ca1\u6709\u5e93\u5b58\u67e5\u8be2\u8bf7\u6c42\u7684\u8bdd\uff0c\u5373\u4f7f\u6d88\u8d39\u8005\u5148\u5904\u7406\u6d88\u606f 2\uff0c\u518d\u5904\u7406\u6d88\u606f 1\uff0c\u8fd9\u4e2a\u65b9\u6848\u4e5f\u80fd\u591f\u4fdd\u8bc1\u6700\u7ec8\u7684\u5e93\u5b58\u91cf\u662f\u6b63\u786e\u7684\uff0c\u4e5f\u5c31\u662f\u5e93\u5b58\u91cf\u4e3a 3\u3002 \u4f46\u662f\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u8003\u8651\u8fd9\u6837\u4e00\u79cd\u60c5\u51b5\uff1a\u5047\u5982\u6d88\u8d39\u8005\u6536\u5230\u4e86\u8fd9\u6837\u4e09\u6761\u6d88\u606f\uff1a\u6d88\u606f 1 \u662f\u6263\u51cf\u5e93\u5b58\u91cf 5\uff0c\u6d88\u606f 2 \u662f\u8bfb\u53d6\u5e93\u5b58\u91cf\uff0c\u6d88\u606f 3 \u662f\u6263\u51cf\u5e93\u5b58\u91cf 2 \u5982\u679c\u6d88\u8d39\u8005\u5148\u5904\u7406\u4e86\u6d88\u606f 3\uff08\u628a\u5e93\u5b58\u91cf\u6263\u51cf 2\uff09\uff0c\u90a3\u4e48\u5e93\u5b58\u91cf\u5c31\u53d8\u6210\u4e86 8\u3002\u7136\u540e\uff0c\u6d88\u8d39\u8005\u5904\u7406\u4e86\u6d88\u606f 2\uff0c\u8bfb\u53d6\u5f53\u524d\u7684\u5e93\u5b58\u91cf\u662f 8\uff0c\u8fd9\u5c31\u4f1a\u51fa\u73b0\u5e93\u5b58\u91cf\u67e5\u8be2\u4e0d\u6b63\u786e\u7684\u60c5\u51b5\u3002 \u4ece\u4e1a\u52a1\u5e94\u7528\u5c42\u9762\u770b\uff0c\u6d88\u606f 1\u30012\u30013 \u5e94\u8be5\u662f\u987a\u5e8f\u6267\u884c\u7684\uff0c\u6240\u4ee5\uff0c\u6d88\u606f 2 \u67e5\u8be2\u5230\u7684\u5e94\u8be5\u662f\u6263\u51cf\u4e86 5 \u4ee5\u540e\u7684\u5e93\u5b58\u91cf\uff0c\u800c\u4e0d\u662f\u6263\u51cf\u4e86 2 \u4ee5\u540e\u7684\u5e93\u5b58\u91cf\u3002\u6240\u4ee5\uff0c\u7528\u5e93\u5b58\u6263\u9664\u503c\u4f5c\u4e3a\u6d88\u606f\u7684\u65b9\u6848\uff0c\u5728\u6d88\u606f\u4e2d\u540c\u65f6\u5305\u542b\u8bfb\u5199\u64cd\u4f5c\u7684\u573a\u666f\u4e0b\uff0c\u4f1a\u5e26\u6765\u6570\u636e\u8bfb\u53d6\u9519\u8bef\u7684\u95ee\u9898\u3002","title":"1-1 \u9700\u6c42\u4e00\uff1a\u6d88\u606f\u4fdd\u5e8f"},{"location":"chap3/5redis_stream/#1-2","text":"\u6d88\u8d39\u8005\u4ece\u6d88\u606f\u961f\u5217\u8bfb\u53d6\u6d88\u606f\u65f6\uff0c\u6709\u65f6\u4f1a\u56e0\u4e3a\u7f51\u7edc\u5835\u585e\u800c\u51fa\u73b0\u6d88\u606f\u91cd\u4f20\u7684\u60c5\u51b5\u3002\u6b64\u65f6\uff0c\u6d88\u8d39\u8005\u53ef\u80fd\u4f1a\u6536\u5230\u591a\u6761\u91cd\u590d\u7684\u6d88\u606f\u3002\u5bf9\u4e8e\u91cd\u590d\u7684\u6d88\u606f\uff0c \u6d88\u8d39\u8005\u5982\u679c\u591a\u6b21\u5904\u7406\u7684\u8bdd\uff0c\u5c31\u53ef\u80fd\u9020\u6210\u4e00\u4e2a\u4e1a\u52a1\u903b\u8f91\u88ab\u591a\u6b21\u6267\u884c\uff0c\u5982\u679c\u4e1a\u52a1\u903b\u8f91\u6b63\u597d\u662f\u8981\u4fee\u6539\u6570\u636e\uff0c\u90a3\u5c31\u4f1a\u51fa\u73b0\u6570\u636e\u88ab\u591a\u6b21\u4fee\u6539\u7684\u95ee\u9898\u4e86 \u3002 \u8fd8\u662f\u4ee5\u5e93\u5b58\u66f4\u65b0\u4e3a\u4f8b\uff0c\u5047\u8bbe\u6d88\u8d39\u8005\u6536\u5230\u4e86\u4e00\u6b21\u6d88\u606f 1\uff0c\u8981\u6263\u51cf\u5e93\u5b58\u91cf 5\uff0c\u7136\u540e\u53c8\u6536\u5230\u4e86\u4e00\u6b21\u6d88\u606f 1\uff0c\u90a3\u4e48\uff0c\u5982\u679c\u6d88\u8d39\u8005\u65e0\u6cd5\u8bc6\u522b\u8fd9\u4e24\u6761\u6d88\u606f\u5b9e\u9645\u662f\u4e00\u6761\u76f8\u540c\u6d88\u606f\u7684\u8bdd\uff0c\u5c31\u4f1a\u6267\u884c\u4e24\u6b21\u6263\u51cf\u5e93\u5b58\u91cf 5 \u7684\u64cd\u4f5c\uff0c\u6b64\u65f6\uff0c\u5e93\u5b58\u91cf\u5c31\u4e0d\u5bf9\u4e86\u3002\u8fd9\u5f53\u7136\u4e5f\u662f\u65e0\u6cd5\u63a5\u53d7\u7684\u3002","title":"1-2 \u9700\u6c42\u4e8c\uff1a\u91cd\u590d\u6d88\u606f\u5904\u7406"},{"location":"chap3/5redis_stream/#1-3","text":"\u53e6\u5916\uff0c\u6d88\u8d39\u8005\u5728\u5904\u7406\u6d88\u606f\u7684\u65f6\u5019\uff0c\u8fd8\u53ef\u80fd\u51fa\u73b0\u56e0\u4e3a\u6545\u969c\u6216\u5b95\u673a\u5bfc\u81f4\u6d88\u606f\u6ca1\u6709\u5904\u7406\u5b8c\u6210\u7684\u60c5\u51b5\u3002\u6b64\u65f6\uff0c\u6d88\u606f\u961f\u5217\u9700\u8981\u80fd\u63d0\u4f9b\u6d88\u606f\u53ef\u9760\u6027\u7684\u4fdd\u8bc1\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c \u5f53\u6d88\u8d39\u8005\u91cd\u542f\u540e\uff0c\u53ef\u4ee5\u91cd\u65b0\u8bfb\u53d6\u6d88\u606f\u518d\u6b21\u8fdb\u884c\u5904\u7406\uff0c\u5426\u5219\uff0c\u5c31\u4f1a\u51fa\u73b0\u6d88\u606f\u6f0f\u5904\u7406\u7684\u95ee\u9898\u4e86 \u3002 Redis \u7684 List \u548c Streams \u4e24\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u5c31\u53ef\u4ee5\u6ee1\u8db3\u6d88\u606f\u961f\u5217\u7684\u8fd9\u4e09\u4e2a\u9700\u6c42\u3002","title":"1-3 \u9700\u6c42\u4e09\uff1a\u6d88\u606f\u53ef\u9760\u6027\u4fdd\u8bc1"},{"location":"chap3/5redis_stream/#2-list","text":"List \u672c\u8eab\u5c31\u662f\u6309\u5148\u8fdb\u5148\u51fa\u7684\u987a\u5e8f\u5bf9\u6570\u636e\u8fdb\u884c\u5b58\u53d6\u7684\uff0c\u6240\u4ee5\uff0c\u5982 \u679c\u4f7f\u7528 List \u4f5c\u4e3a\u6d88\u606f\u961f\u5217\u4fdd\u5b58\u6d88\u606f\u7684\u8bdd\uff0c\u5c31\u5df2\u7ecf\u80fd\u6ee1\u8db3\u6d88\u606f\u4fdd\u5e8f\u7684\u9700\u6c42\u4e86\u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u751f\u4ea7\u8005\u53ef\u4ee5\u4f7f\u7528 LPUSH \u547d\u4ee4\u628a\u8981\u53d1\u9001\u7684\u6d88\u606f\u4f9d\u6b21\u5199\u5165 List\uff0c\u800c\u6d88\u8d39\u8005\u5219\u53ef\u4ee5\u4f7f\u7528 RPOP \u547d\u4ee4\uff0c\u4ece List \u7684\u53e6\u4e00\u7aef\u6309\u7167\u6d88\u606f\u7684\u5199\u5165\u987a\u5e8f\uff0c\u4f9d\u6b21\u8bfb\u53d6\u6d88\u606f\u5e76\u8fdb\u884c\u5904\u7406\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff0c\u751f\u4ea7\u8005\u5148\u7528 LPUSH \u5199\u5165\u4e86\u4e24\u6761\u5e93\u5b58\u6d88\u606f\uff0c\u5206\u522b\u662f 5 \u548c 3 \uff0c\u8868\u793a\u8981\u628a\u5e93\u5b58\u66f4\u65b0\u4e3a 5 \u548c 3\uff1b \u6d88\u8d39\u8005\u5219\u7528 RPOP \u628a\u4e24\u6761\u6d88\u606f\u4f9d\u6b21\u8bfb\u51fa\uff0c\u7136\u540e\u8fdb\u884c\u76f8\u5e94\u7684\u5904\u7406\u3002","title":"2\u3001\u57fa\u4e8e List \u7684\u6d88\u606f\u961f\u5217\u89e3\u51b3\u65b9\u6848"},{"location":"chap3/5redis_stream/#2-1","text":"\u5728\u751f\u4ea7\u8005\u5f80 List \u4e2d\u5199\u5165\u6570\u636e\u65f6\uff0cList \u5e76\u4e0d\u4f1a\u4e3b\u52a8\u5730\u901a\u77e5\u6d88\u8d39\u8005\u6709\u65b0\u6d88\u606f\u5199\u5165\uff0c\u5982\u679c\u6d88\u8d39\u8005\u60f3\u8981\u53ca\u65f6\u5904\u7406\u6d88\u606f\uff0c\u5c31\u9700\u8981\u5728\u7a0b\u5e8f\u4e2d\u4e0d\u505c\u5730\u8c03\u7528 RPOP \u547d\u4ee4\uff08\u6bd4\u5982\u4f7f\u7528\u4e00\u4e2a while(1) \u5faa\u73af\uff09\u3002\u5982\u679c\u6709\u65b0\u6d88\u606f\u5199\u5165\uff0cRPOP \u547d\u4ee4\u5c31\u4f1a\u8fd4\u56de\u7ed3\u679c\uff0c\u5426\u5219\uff0cRPOP \u547d\u4ee4\u8fd4\u56de\u7a7a\u503c\uff0c\u518d\u7ee7\u7eed\u5faa\u73af\u3002 \u6240\u4ee5\uff0c\u5373\u4f7f\u6ca1\u6709\u65b0\u6d88\u606f\u5199\u5165 List\uff0c\u6d88\u8d39\u8005\u4e5f\u8981\u4e0d\u505c\u5730\u8c03\u7528 RPOP \u547d\u4ee4\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u6d88\u8d39\u8005\u7a0b\u5e8f\u7684 CPU \u4e00\u76f4\u6d88\u8017\u5728\u6267\u884c RPOP \u547d\u4ee4\u4e0a\uff0c\u5e26\u6765\u4e0d\u5fc5\u8981\u7684\u6027\u80fd\u635f\u5931\u3002","title":"2-1 \u6d88\u8d39\u8005\u8bfb\u53d6\u6570\u636e\u6027\u80fd\u98ce\u9669"},{"location":"chap3/5redis_stream/#2-2-brpop","text":"\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cRedis \u63d0\u4f9b\u4e86 BRPOP \u547d\u4ee4\u3002 BRPOP \u547d\u4ee4\u4e5f\u79f0\u4e3a\u963b\u585e\u5f0f\u8bfb\u53d6\uff0c\u5ba2\u6237\u7aef\u5728\u6ca1\u6709\u8bfb\u5230\u961f\u5217\u6570\u636e\u65f6\uff0c\u81ea\u52a8\u963b\u585e\uff0c\u76f4\u5230\u6709\u65b0\u7684\u6570\u636e\u5199\u5165\u961f\u5217\uff0c\u518d\u5f00\u59cb\u8bfb\u53d6\u65b0\u6570\u636e\u3002 \u548c\u6d88\u8d39\u8005\u7a0b\u5e8f\u81ea\u5df1\u4e0d\u505c\u5730\u8c03\u7528 RPOP \u547d\u4ee4\u76f8\u6bd4\uff0c\u8fd9\u79cd\u65b9\u5f0f\u80fd\u8282\u7701 CPU \u5f00\u9500\u3002","title":"2-2 BRPOP"},{"location":"chap3/5redis_stream/#2-3","text":"\u4e00\u65b9\u9762\uff0c\u6d88\u606f\u961f\u5217\u8981\u80fd\u7ed9\u6bcf\u4e00\u4e2a\u6d88\u606f\u63d0\u4f9b\u5168\u5c40\u552f\u4e00\u7684 ID \u53f7\uff1b \u53e6\u4e00\u65b9\u9762\uff0c\u6d88\u8d39\u8005\u7a0b\u5e8f\u8981\u628a\u5df2\u7ecf\u5904\u7406\u8fc7\u7684\u6d88\u606f\u7684 ID \u53f7\u8bb0\u5f55\u4e0b\u6765\u3002 \u5f53\u6536\u5230\u4e00\u6761\u6d88\u606f\u540e\uff0c\u6d88\u8d39\u8005\u7a0b\u5e8f\u5c31\u53ef\u4ee5\u5bf9\u6bd4\u6536\u5230\u7684\u6d88\u606f ID \u548c\u8bb0\u5f55\u7684\u5df2\u5904\u7406\u8fc7\u7684\u6d88\u606f ID\uff0c\u6765\u5224\u65ad\u5f53\u524d\u6536\u5230\u7684\u6d88\u606f\u6709\u6ca1\u6709\u7ecf\u8fc7\u5904\u7406\u3002\u5982\u679c\u5df2\u7ecf\u5904\u7406\u8fc7\uff0c\u90a3\u4e48\uff0c\u6d88\u8d39\u8005\u7a0b\u5e8f\u5c31\u4e0d\u518d\u8fdb\u884c\u5904\u7406\u4e86\u3002 \u8fd9\u79cd\u5904\u7406\u7279\u6027\u4e5f\u79f0\u4e3a\u5e42\u7b49\u6027\uff0c\u5e42\u7b49\u6027\u5c31\u662f\u6307\uff0c\u5bf9\u4e8e\u540c\u4e00\u6761\u6d88\u606f\uff0c\u6d88\u8d39\u8005\u6536\u5230\u4e00\u6b21\u7684\u5904\u7406\u7ed3\u679c\u548c\u6536\u5230\u591a\u6b21\u7684\u5904\u7406\u7ed3\u679c\u662f\u4e00\u81f4\u7684\u3002 \u4e0d\u8fc7\uff0cList \u672c\u8eab\u662f\u4e0d\u4f1a\u4e3a\u6bcf\u4e2a\u6d88\u606f\u751f\u6210 ID \u53f7\u7684\uff0c\u6240\u4ee5\uff0c\u6d88\u606f\u7684\u5168\u5c40\u552f\u4e00 ID \u53f7\u5c31\u9700\u8981\u751f\u4ea7\u8005\u7a0b\u5e8f\u5728\u53d1\u9001\u6d88\u606f\u524d\u81ea\u884c\u751f\u6210\u3002\u751f\u6210\u4e4b\u540e\uff0c\u6211\u4eec\u5728\u7528 LPUSH \u547d\u4ee4\u628a\u6d88\u606f\u63d2\u5165 List \u65f6\uff0c\u9700\u8981\u5728\u6d88\u606f\u4e2d\u5305\u542b\u8fd9\u4e2a\u5168\u5c40\u552f\u4e00 ID\u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5c31\u628a\u4e00\u6761\u5168\u5c40 ID \u4e3a 101030001\u3001\u5e93\u5b58\u91cf\u4e3a 5 \u7684\u6d88\u606f\u63d2\u5165\u4e86\u6d88\u606f\u961f\u5217\uff1a LPUSH mq \"101030001:stock:5\" (integer) 1","title":"2-3 \u6d88\u8d39\u8005\u7a0b\u5e8f\u672c\u8eab\u80fd\u5bf9\u91cd\u590d\u6d88\u606f\u8fdb\u884c\u5224\u65ad"},{"location":"chap3/5redis_stream/#2-4-list-brpoplpush","text":"\u5f53\u6d88\u8d39\u8005\u7a0b\u5e8f\u4ece List \u4e2d\u8bfb\u53d6\u4e00\u6761\u6d88\u606f\u540e\uff0cList \u5c31\u4e0d\u4f1a\u518d\u7559\u5b58\u8fd9\u6761\u6d88\u606f\u4e86\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u6d88\u8d39\u8005\u7a0b\u5e8f\u5728\u5904\u7406\u6d88\u606f\u7684\u8fc7\u7a0b\u51fa\u73b0\u4e86\u6545\u969c\u6216\u5b95\u673a\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6d88\u606f\u6ca1\u6709\u5904\u7406\u5b8c\u6210\uff0c\u90a3\u4e48\uff0c\u6d88\u8d39\u8005\u7a0b\u5e8f\u518d\u6b21\u542f\u52a8\u540e\uff0c\u5c31\u6ca1\u6cd5\u518d\u6b21\u4ece List \u4e2d\u8bfb\u53d6\u6d88\u606f\u4e86\u3002 \u4e3a\u4e86\u7559\u5b58\u6d88\u606f\uff0cList \u7c7b\u578b\u63d0\u4f9b\u4e86 BRPOPLPUSH \u547d\u4ee4\uff0c\u8fd9\u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\u662f\u8ba9\u6d88\u8d39\u8005\u7a0b\u5e8f\u4ece\u4e00\u4e2a List \u4e2d\u8bfb\u53d6\u6d88\u606f\uff0c\u540c\u65f6\uff0cRedis \u4f1a\u628a\u8fd9\u4e2a\u6d88\u606f\u518d\u63d2\u5165\u5230\u53e6\u4e00\u4e2a List\uff08\u53ef\u4ee5\u53eb\u4f5c\u5907\u4efd List\uff09\u7559\u5b58\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5982\u679c\u6d88\u8d39\u8005\u7a0b\u5e8f\u8bfb\u4e86\u6d88\u606f\u4f46\u6ca1\u80fd\u6b63\u5e38\u5904\u7406\uff0c\u7b49\u5b83\u91cd\u542f\u540e\uff0c\u5c31\u53ef\u4ee5\u4ece\u5907\u4efd List \u4e2d\u91cd\u65b0\u8bfb\u53d6\u6d88\u606f\u5e76\u8fdb\u884c\u5904\u7406\u4e86\u3002 \u5c55\u793a\u4e86\u4f7f\u7528 BRPOPLPUSH \u547d\u4ee4\u7559\u5b58\u6d88\u606f\uff0c\u4ee5\u53ca\u6d88\u8d39\u8005\u518d\u6b21\u8bfb\u53d6\u6d88\u606f\u7684\u8fc7\u7a0b \u751f\u4ea7\u8005\u5148\u7528 LPUSH \u628a\u6d88\u606f\u201c5\u201d\u201c3\u201d\u63d2\u5165\u5230\u6d88\u606f\u961f\u5217 mq \u4e2d\u3002 \u6d88\u8d39\u8005\u7a0b\u5e8f\u4f7f\u7528 BRPOPLPUSH \u547d\u4ee4\u8bfb\u53d6\u6d88\u606f\u201c5\u201d \u540c\u65f6\uff0c\u6d88\u606f\u201c5\u201d\u8fd8\u4f1a\u88ab Redis \u63d2\u5165\u5230 mqback \u961f\u5217\u4e2d \u3002 \u5982\u679c\u6d88\u8d39\u8005\u7a0b\u5e8f\u5904\u7406\u6d88\u606f\u201c5\u201d\u65f6\u5b95\u673a\u4e86\uff0c\u7b49\u5b83\u91cd\u542f\u540e\uff0c\u53ef\u4ee5\u4ece mqback \u4e2d\u518d\u6b21\u8bfb\u53d6\u6d88\u606f\u201c5\u201d\uff0c\u7ee7\u7eed\u5904\u7406\u3002 \u5728\u7528 List \u505a\u6d88\u606f\u961f\u5217\u65f6\uff0c\u6211\u4eec\u8fd8\u53ef\u80fd\u9047\u5230\u8fc7\u4e00\u4e2a\u95ee\u9898\uff1a \u751f\u4ea7\u8005\u6d88\u606f\u53d1\u9001\u5f88\u5feb\uff0c\u800c\u6d88\u8d39\u8005\u5904\u7406\u6d88\u606f\u7684\u901f\u5ea6\u6bd4\u8f83\u6162\uff0c\u8fd9\u5c31\u5bfc\u81f4 List \u4e2d\u7684\u6d88\u606f\u8d8a\u79ef\u8d8a\u591a\uff0c\u7ed9 Redis \u7684\u5185\u5b58\u5e26\u6765\u5f88\u5927\u538b\u529b\u3002 \u5230 Redis \u4ece 5.0 \u7248\u672c\u5f00\u59cb\u63d0\u4f9b\u7684 Streams \u6570\u636e\u7c7b\u578b\u4e86\u3002 \u548c List \u76f8\u6bd4\uff0cStreams \u540c\u6837\u80fd\u591f\u6ee1\u8db3\u6d88\u606f\u961f\u5217\u7684\u4e09\u5927\u9700\u6c42\u3002\u800c\u4e14\uff0c\u5b83\u8fd8\u652f\u6301\u6d88\u8d39\u7ec4\u5f62\u5f0f\u7684\u6d88\u606f\u8bfb\u53d6\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u6765\u4e86\u89e3\u4e0b Streams \u7684\u4f7f\u7528\u65b9\u6cd5\u3002","title":"2-4 List \u7c7b\u578b\u662f\u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u53ef\u9760\u6027: BRPOPLPUSH"},{"location":"chap3/5redis_stream/#3-streams","text":"Streams \u662f Redis \u4e13\u95e8\u4e3a\u6d88\u606f\u961f\u5217\u8bbe\u8ba1\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u6d88\u606f\u961f\u5217\u64cd\u4f5c\u547d\u4ee4\u3002 XADD\uff1a\u63d2\u5165\u6d88\u606f\uff0c\u4fdd\u8bc1\u6709\u5e8f\uff0c\u53ef\u4ee5\u81ea\u52a8\u751f\u6210\u5168\u5c40\u552f\u4e00 ID\uff1b XREAD\uff1a\u7528\u4e8e\u8bfb\u53d6\u6d88\u606f\uff0c\u53ef\u4ee5\u6309 ID \u8bfb\u53d6\u6570\u636e\uff1b XREADGROUP\uff1a\u6309\u6d88\u8d39\u7ec4\u5f62\u5f0f\u8bfb\u53d6\u6d88\u606f\uff1b XPENDING \u548c XACK\uff1aXPENDING \u547d\u4ee4\u53ef\u4ee5\u7528\u6765\u67e5\u8be2\u6bcf\u4e2a\u6d88\u8d39\u7ec4\u5185\u6240\u6709\u6d88\u8d39\u8005\u5df2\u8bfb\u53d6\u4f46\u5c1a\u672a\u786e\u8ba4\u7684\u6d88\u606f\uff0c\u800c XACK \u547d\u4ee4\u7528\u4e8e\u5411\u6d88\u606f\u961f\u5217\u786e\u8ba4\u6d88\u606f\u5904\u7406\u5df2\u5b8c\u6210\u3002","title":"3\u3001\u57fa\u4e8e Streams \u7684\u6d88\u606f\u961f\u5217\u89e3\u51b3\u65b9\u6848"},{"location":"chap3/5redis_stream/#3-1-xadd","text":"XADD \u547d\u4ee4\u53ef\u4ee5\u5f80\u6d88\u606f\u961f\u5217\u4e2d\u63d2\u5165\u65b0\u6d88\u606f\uff0c \u6d88\u606f\u7684\u683c\u5f0f\u662f\u952e - \u503c\u5bf9\u5f62\u5f0f\u3002\u5bf9\u4e8e\u63d2\u5165\u7684\u6bcf\u4e00\u6761\u6d88\u606f\uff0cStreams \u53ef\u4ee5\u81ea\u52a8\u4e3a\u5176\u751f\u6210\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u7684 ID\u3002 \u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u5f80\u540d\u79f0\u4e3a mqstream \u7684\u6d88\u606f\u961f\u5217\u4e2d\u63d2\u5165\u4e00\u6761\u6d88\u606f\uff0c\u6d88\u606f\u7684\u952e\u662f repo \uff0c\u503c\u662f 5 \u3002 \u5176\u4e2d\uff0c\u6d88\u606f\u961f\u5217\u540d\u79f0\u540e\u9762\u7684 * \uff0c\u8868\u793a\u8ba9 Redis \u4e3a\u63d2\u5165\u7684\u6570\u636e\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u7684 ID\uff0c\u4f8b\u5982 \u201c1599203861727-0\u201d \u3002 \u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4e0d\u7528 * \uff0c\u76f4\u63a5\u5728\u6d88\u606f\u961f\u5217\u540d\u79f0\u540e\u81ea\u884c\u8bbe\u5b9a\u4e00\u4e2a ID \u53f7\uff0c\u53ea\u8981\u4fdd\u8bc1\u8fd9\u4e2a ID \u53f7\u662f\u5168\u5c40\u552f\u4e00\u7684\u5c31\u884c\u3002\u4e0d\u8fc7\uff0c\u76f8\u6bd4\u81ea\u884c\u8bbe\u5b9a ID \u53f7\uff0c\u4f7f\u7528 * \u4f1a\u66f4\u52a0\u65b9\u4fbf\u9ad8\u6548\u3002 XADD mqstream * repo 5 \"1599203861727-0\" \u53ef\u4ee5\u770b\u5230\uff0c\u6d88\u606f\u7684\u5168\u5c40\u552f\u4e00 ID \u7531\u4e24\u90e8\u5206\u7ec4\u6210 \uff0c \u7b2c\u4e00\u90e8\u5206\u201c1599203861727\u201d\u662f\u6570\u636e\u63d2\u5165\u65f6\uff0c\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u8ba1\u7b97\u7684\u5f53\u524d\u670d\u52a1\u5668\u65f6\u95f4\uff0c\u7b2c\u4e8c\u90e8\u5206\u8868\u793a\u63d2\u5165\u6d88\u606f\u5728\u5f53\u524d\u6beb\u79d2\u5185\u7684\u6d88\u606f\u5e8f\u53f7\uff0c\u8fd9\u662f\u4ece 0 \u5f00\u59cb\u7f16\u53f7\u7684\u3002 \u4f8b\u5982\uff0c \u201c1599203861727-0\u201d\u5c31\u8868\u793a\u5728\u201c1599203861727\u201d\u6beb\u79d2\u5185\u7684\u7b2c 1 \u6761\u6d88\u606f \u3002","title":"3-1 XADD"},{"location":"chap3/5redis_stream/#3-2-xread","text":"XREAD \u5728\u8bfb\u53d6\u6d88\u606f\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u6d88\u606f ID\uff0c\u5e76\u4ece\u8fd9\u4e2a\u6d88\u606f ID \u7684\u4e0b\u4e00\u6761\u6d88\u606f\u5f00\u59cb\u8fdb\u884c\u8bfb\u53d6\u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u4ece ID \u53f7\u4e3a 1599203861727-0 \u7684\u6d88\u606f\u5f00\u59cb\uff0c\u8bfb\u53d6\u540e\u7eed\u7684\u6240\u6709\u6d88\u606f\uff08\u793a\u4f8b\u4e2d\u4e00\u5171 3 \u6761\uff09\u3002 XREAD BLOCK 100 STREAMS mqstream 1599203861727-0 1) 1) \"mqstream\" 2) 1) 1) \"1599274912765-0\" 2) 1) \"repo\" 2) \"3\" 2) 1) \"1599274925823-0\" 2) 1) \"repo\" 2) \"2\" 3) 1) \"1599274927910-0\" 2) 1) \"repo\" 2) \"1\" \u53e6\u5916\uff0c\u6d88\u8d39\u8005\u4e5f\u53ef\u4ee5\u5728\u8c03\u7528 XRAED \u65f6\u8bbe\u5b9a block \u914d\u7f6e\u9879\uff0c\u5b9e\u73b0\u7c7b\u4f3c\u4e8e BRPOP \u7684\u963b\u585e\u8bfb\u53d6\u64cd\u4f5c\u3002 \u5f53\u6d88\u606f\u961f\u5217\u4e2d\u6ca1\u6709\u6d88\u606f\u65f6\uff0c \u4e00\u65e6\u8bbe\u7f6e\u4e86 block \u914d\u7f6e\u9879\uff0cXREAD \u5c31\u4f1a\u963b\u585e\uff0c\u963b\u585e\u7684\u65f6\u957f\u53ef\u4ee5\u5728 block \u914d\u7f6e\u9879\u8fdb\u884c\u8bbe\u7f6e\u3002 XREAD block 10000 streams mqstream $ (nil) (10.00s)","title":"3-2 XREAD"},{"location":"chap3/5redis_stream/#3-3-xgroup","text":"Streams \u672c\u8eab\u53ef\u4ee5\u4f7f\u7528 XGROUP \u521b\u5efa\u6d88\u8d39\u7ec4\uff0c\u521b\u5efa\u6d88\u8d39\u7ec4\u4e4b\u540e\uff0cStreams \u53ef\u4ee5\u4f7f\u7528 XREADGROUP \u547d\u4ee4\u8ba9\u6d88\u8d39\u7ec4\u5185\u7684\u6d88\u8d39\u8005\u8bfb\u53d6\u6d88\u606f\uff0c \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a group1 \u7684\u6d88\u8d39\u7ec4\uff0c\u8fd9\u4e2a\u6d88\u8d39\u7ec4\u6d88\u8d39\u7684\u6d88\u606f\u961f\u5217\u662f mqstream\u3002 XGROUP create mqstream group1 0 OK \u7136\u540e\uff0c\u6211\u4eec\u518d\u6267\u884c\u4e00\u6bb5\u547d\u4ee4\uff0c \u8ba9 group1 \u6d88\u8d39\u7ec4\u91cc\u7684\u6d88\u8d39\u8005 consumer1 \u4ece mqstream \u4e2d\u8bfb\u53d6\u6240\u6709\u6d88\u606f\uff0c\u5176\u4e2d\uff0c\u547d\u4ee4\u6700\u540e\u7684\u53c2\u6570 \u201c>\u201d \uff0c\u8868\u793a\u4ece\u7b2c\u4e00\u6761\u5c1a\u672a\u88ab\u6d88\u8d39\u7684\u6d88\u606f\u5f00\u59cb\u8bfb\u53d6\u3002 \u56e0\u4e3a\u5728 consumer1 \u8bfb\u53d6\u6d88\u606f\u524d\uff0c group1 \u4e2d\u6ca1\u6709\u5176\u4ed6\u6d88\u8d39\u8005\u8bfb\u53d6\u8fc7\u6d88\u606f\uff0c\u6240\u4ee5\uff0c consumer1 \u5c31\u5f97\u5230 mqstream \u6d88\u606f\u961f\u5217\u4e2d\u7684\u6240\u6709\u6d88\u606f\u4e86\uff08\u4e00\u5171 4 \u6761\uff09\u3002 XREADGROUP group group1 consumer1 streams mqstream > 1) 1) \"mqstream\" 2) 1) 1) \"1599203861727-0\" 2) 1) \"repo\" 2) \"5\" 2) 1) \"1599274912765-0\" 2) 1) \"repo\" 2) \"3\" 3) 1) \"1599274925823-0\" 2) 1) \"repo\" 2) \"2\" 4) 1) \"1599274927910-0\" 2) 1) \"repo\" 2) \"1\" \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6d88\u606f\u961f\u5217\u4e2d\u7684\u6d88\u606f\u4e00\u65e6\u88ab\u6d88\u8d39\u7ec4\u91cc\u7684\u4e00\u4e2a\u6d88\u8d39\u8005\u8bfb\u53d6\u4e86\uff0c\u5c31\u4e0d\u80fd\u518d\u88ab\u8be5\u6d88\u8d39\u7ec4\u5185\u7684\u5176\u4ed6\u6d88\u8d39\u8005\u8bfb\u53d6\u4e86\u3002 \u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u6267\u884c\u5b8c\u521a\u624d\u7684 XREADGROUP \u547d\u4ee4\u540e\uff0c\u518d\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c \u8ba9 group1 \u5185\u7684 consumer2 \u8bfb\u53d6\u6d88\u606f\u65f6\uff0c consumer2 \u8bfb\u5230\u7684\u5c31\u662f\u7a7a\u503c\uff0c\u56e0\u4e3a\u6d88\u606f\u5df2\u7ecf\u88ab consumer1 \u8bfb\u53d6\u5b8c\u4e86 \uff0c\u5982\u4e0b\u6240\u793a\uff1a XREADGROUP group group1 consumer2 streams mqstream 0 1) 1) \"mqstream\" 2) (empty list or set) \u4f7f\u7528\u6d88\u8d39\u7ec4\u7684\u76ee\u7684\u662f\u8ba9\u7ec4\u5185\u7684\u591a\u4e2a\u6d88\u8d39\u8005\u5171\u540c\u5206\u62c5\u8bfb\u53d6\u6d88\u606f\uff0c \u6240\u4ee5\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u8ba9\u6bcf\u4e2a\u6d88\u8d39\u8005\u8bfb\u53d6\u90e8\u5206\u6d88\u606f\uff0c\u4ece\u800c\u5b9e\u73b0\u6d88\u606f\u8bfb\u53d6\u8d1f\u8f7d\u5728\u591a\u4e2a\u6d88\u8d39\u8005\u95f4\u662f\u5747\u8861\u5206\u5e03\u7684\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u8ba9 group2 \u4e2d\u7684 consumer1\u30012\u30013 \u5404\u81ea\u8bfb\u53d6\u4e00\u6761\u6d88\u606f\u3002 XREADGROUP group group2 consumer1 count 1 streams mqstream > 1) 1) \"mqstream\" 2) 1) 1) \"1599203861727-0\" 2) 1) \"repo\" 2) \"5\" XREADGROUP group group2 consumer2 count 1 streams mqstream > 1) 1) \"mqstream\" 2) 1) 1) \"1599274912765-0\" 2) 1) \"repo\" 2) \"3\" XREADGROUP group group2 consumer3 count 1 streams mqstream > 1) 1) \"mqstream\" 2) 1) 1) \"1599274925823-0\" 2) 1) \"repo\" 2) \"2\"","title":"3-3 XGROUP \u521b\u5efa\u6d88\u8d39\u7ec4"},{"location":"chap3/5redis_stream/#3-4-xpending-xack","text":"\u4e3a\u4e86\u4fdd\u8bc1\u6d88\u8d39\u8005\u5728\u53d1\u751f\u6545\u969c\u6216\u5b95\u673a\u518d\u6b21\u91cd\u542f\u540e\uff0c\u4ecd\u7136\u53ef\u4ee5\u8bfb\u53d6\u672a\u5904\u7406\u5b8c\u7684\u6d88\u606f\uff0c Streams \u4f1a\u81ea\u52a8\u4f7f\u7528\u5185\u90e8\u961f\u5217\uff08\u4e5f\u79f0\u4e3a PENDING List\uff09\u7559\u5b58\u6d88\u8d39\u7ec4\u91cc\u6bcf\u4e2a\u6d88\u8d39\u8005\u8bfb\u53d6\u7684\u6d88\u606f \uff0c\u76f4\u5230\u6d88\u8d39\u8005\u4f7f\u7528 XACK \u547d\u4ee4\u901a\u77e5 Streams\u201c\u6d88\u606f\u5df2\u7ecf\u5904\u7406\u5b8c\u6210\u201d\u3002 \u5982\u679c\u6d88\u8d39\u8005\u6ca1\u6709\u6210\u529f\u5904\u7406\u6d88\u606f\uff0c\u5b83\u5c31\u4e0d\u4f1a\u7ed9 Streams \u53d1\u9001 XACK \u547d\u4ee4\uff0c\u6d88\u606f\u4ecd\u7136\u4f1a\u7559\u5b58\u3002 \u6b64\u65f6\uff0c\u6d88\u8d39\u8005\u53ef\u4ee5\u5728\u91cd\u542f\u540e\uff0c\u7528 XPENDING \u547d\u4ee4\u67e5\u770b\u5df2\u8bfb\u53d6\u3001\u4f46\u5c1a\u672a\u786e\u8ba4\u5904\u7406\u5b8c\u6210\u7684\u6d88\u606f\u3002 \u5982\u679c\u6d88\u8d39\u8005\u6ca1\u6709\u6210\u529f\u5904\u7406\u6d88\u606f\uff0c\u5b83\u5c31\u4e0d\u4f1a\u7ed9 Streams \u53d1\u9001 XACK \u547d\u4ee4\uff0c\u6d88\u606f\u4ecd\u7136\u4f1a\u7559\u5b58\u3002\u6b64\u65f6\uff0c\u6d88\u8d39\u8005\u53ef\u4ee5\u5728\u91cd\u542f\u540e\uff0c\u7528 XPENDING \u547d\u4ee4\u67e5\u770b\u5df2\u8bfb\u53d6\u3001\u4f46\u5c1a\u672a\u786e\u8ba4\u5904\u7406\u5b8c\u6210\u7684\u6d88\u606f\u3002 XPENDING mqstream group2 1) (integer) 3 2) \"1599203861727-0\" 3) \"1599274925823-0\" 4) 1) 1) \"consumer1\" 2) \"1\" 2) 1) \"consumer2\" 2) \"1\" 3) 1) \"consumer3\" 2) \"1\" \u5982\u679c\u6211\u4eec\u8fd8\u9700\u8981\u8fdb\u4e00\u6b65\u67e5\u770b\u67d0\u4e2a\u6d88\u8d39\u8005\u5177\u4f53\u8bfb\u53d6\u4e86\u54ea\u4e9b\u6570\u636e\uff0c\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff1a XPENDING mqstream group2 - + 10 consumer2 1) 1) \"1599274912765-0\" 2) \"consumer2\" 3) (integer) 513336 4) (integer) 1 \u53ef\u4ee5\u770b\u5230\uff0cconsumer2 \u5df2\u8bfb\u53d6\u7684\u6d88\u606f\u7684 ID \u662f 1599274912765-0 \u4e00\u65e6\u6d88\u606f 1599274912765-0 \u88ab consumer2 \u5904\u7406\u4e86\uff0c consumer2 \u5c31\u53ef\u4ee5\u4f7f\u7528 XACK \u547d\u4ee4\u901a\u77e5 Streams \uff0c\u7136\u540e\u8fd9\u6761\u6d88\u606f\u5c31\u4f1a\u88ab\u5220\u9664\u3002\u5f53\u6211\u4eec\u518d\u4f7f\u7528 XPENDING \u547d\u4ee4\u67e5\u770b\u65f6\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\uff0c consumer2 \u5df2\u7ecf\u6ca1\u6709\u5df2\u8bfb\u53d6\u3001\u4f46\u5c1a\u672a\u786e\u8ba4\u5904\u7406\u7684\u6d88\u606f\u4e86\u3002 XACK mqstream group2 1599274912765-0 (integer) 1 XPENDING mqstream group2 - + 10 consumer2 (empty list or set)","title":"3-4 XPENDING \u548c XACK"},{"location":"chap3/5redis_stream/#4","text":"\u5206\u5e03\u5f0f\u7cfb\u7edf\u7ec4\u4ef6\u4f7f\u7528\u6d88\u606f\u961f\u5217\u65f6\u7684\u4e09\u5927\u9700\u6c42\uff1a \u6d88\u606f\u4fdd\u5e8f\u3001\u91cd\u590d\u6d88\u606f\u5904\u7406\u548c\u6d88\u606f\u53ef\u9760\u6027\u4fdd\u8bc1 \uff0c\u8fd9\u4e09\u5927\u9700\u6c42\u53ef\u4ee5\u8fdb\u4e00\u6b65\u8f6c\u6362\u4e3a\u5bf9\u6d88\u606f\u961f\u5217\u7684\u4e09\u5927\u8981\u6c42\uff1a \u6d88\u606f\u6570\u636e\u6709\u5e8f\u5b58\u53d6\uff0c\u6d88\u606f\u6570\u636e\u5177\u6709\u5168\u5c40\u552f\u4e00\u7f16\u53f7\uff0c\u4ee5\u53ca\u6d88\u606f\u6570\u636e\u5728\u6d88\u8d39\u5b8c\u6210\u540e\u88ab\u5220\u9664\u3002 \u5176\u5b9e\uff0c\u5173\u4e8e Redis \u662f\u5426\u9002\u5408\u505a\u6d88\u606f\u961f\u5217\uff0c\u4e1a\u754c\u4e00\u76f4\u662f\u6709\u4e89\u8bba\u7684\u3002\u5f88\u591a\u4eba\u8ba4\u4e3a\uff0c\u8981\u4f7f\u7528\u6d88\u606f\u961f\u5217\uff0c\u5c31\u5e94\u8be5\u91c7\u7528 Kafka\u3001RabbitMQ \u8fd9\u4e9b\u4e13\u95e8\u9762\u5411\u6d88\u606f\u961f\u5217\u573a\u666f\u7684\u8f6f\u4ef6\uff0c\u800c Redis \u66f4\u52a0\u9002\u5408\u505a\u7f13\u5b58\u3002 Redis \u662f\u4e00\u4e2a\u975e\u5e38\u8f7b\u91cf\u7ea7\u7684\u952e\u503c\u6570\u636e\u5e93\uff0c\u90e8\u7f72\u4e00\u4e2a Redis \u5b9e\u4f8b\u5c31\u662f\u542f\u52a8\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u90e8\u7f72 Redis \u96c6\u7fa4\uff0c\u4e5f\u5c31\u662f\u90e8\u7f72\u591a\u4e2a Redis \u5b9e\u4f8b\u3002\u800c Kafka\u3001RabbitMQ \u90e8\u7f72\u65f6\uff0c\u6d89\u53ca\u989d\u5916\u7684\u7ec4\u4ef6\uff0c\u4f8b\u5982 Kafka \u7684\u8fd0\u884c\u5c31\u9700\u8981\u518d\u90e8\u7f72 ZooKeeper\u3002 \u76f8\u6bd4 Redis \u6765\u8bf4\uff0cKafka \u548c RabbitMQ \u4e00\u822c\u88ab\u8ba4\u4e3a\u662f\u91cd\u91cf\u7ea7\u7684\u6d88\u606f\u961f\u5217\u3002 \u5982\u679c\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u7684\u7ec4\u4ef6\u6d88\u606f\u901a\u4fe1\u91cf\u4e0d\u5927\uff0c\u90a3\u4e48\uff0cRedis \u53ea\u9700\u8981\u4f7f\u7528\u6709\u9650\u7684\u5185\u5b58\u7a7a\u95f4\u5c31\u80fd\u6ee1\u8db3\u6d88\u606f\u5b58\u50a8\u7684\u9700\u6c42\uff0c\u800c\u4e14\uff0c Redis \u7684\u9ad8\u6027\u80fd\u7279\u6027\u80fd\u652f\u6301\u5feb\u901f\u7684\u6d88\u606f\u8bfb\u5199\uff0c\u4e0d\u5931\u4e3a\u6d88\u606f\u961f\u5217\u7684\u4e00\u4e2a\u597d\u7684\u89e3\u51b3\u65b9\u6848\u3002","title":"4\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap3/6redis_ds_sum/","text":"\u7b2c\u4e09\u7ae0 Redis \u7684\u6570\u636e\u7ed3\u6784 1\u3001\u7ae0\u8282\u5c0f\u7ed3 1-1 Redis\u7684String\u7c7b\u578b\u6570\u636e\u7ed3\u6784\uff0c\u53ca\u5176\u5e95\u5c42\u5b9e\u73b0 String \u5728\u4fdd\u5b58\u7684\u952e\u503c\u5bf9\u672c\u8eab\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u4e0d\u5927\u65f6\uff0cString \u7c7b\u578b\u7684\u5143\u6570\u636e\u5f00\u9500\u5c31\u5360\u636e\u4e3b\u5bfc\u4e86\uff0c \u8fd9\u91cc\u9762\u5305\u62ec\u4e86 RedisObject \u7ed3\u6784\u3001SDS \u7ed3\u6784\u3001dictEntry \u7ed3\u6784\u7684\u5185\u5b58\u5f00\u9500 \u3002 \u4f7f\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u6570\u636e\u3002\u5f53\u7136\uff0c\u4f7f\u7528 Hash \u8fd9\u79cd\u96c6\u5408\u7c7b\u578b\u4fdd\u5b58\u5355\u503c\u952e\u503c\u5bf9\u7684\u6570\u636e\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5c06\u5355\u503c\u6570\u636e\u62c6\u5206\u6210\u4e24\u90e8\u5206\uff0c\u5206\u522b\u4f5c\u4e3a Hash \u96c6\u5408\u7684\u952e\u548c\u503c\uff0c\u5c31\u50cf\u521a\u624d\u6848\u4f8b\u4e2d\u7528\u4e8c\u7ea7\u7f16\u7801\u6765\u8868\u793a\u56fe\u7247 ID \u5982\u679c\u4f60\u60f3\u77e5\u9053\u952e\u503c\u5bf9\u91c7\u7528\u4e0d\u540c\u7c7b\u578b\u4fdd\u5b58\u65f6\u7684\u5185\u5b58\u5f00\u9500\uff0c\u53ef\u4ee5\u5728 \u8fd9\u4e2a\u7f51\u5740 \u91cc\u8f93\u5165\u4f60\u7684\u952e\u503c\u5bf9\u957f\u5ea6\u548c\u4f7f\u7528\u7684\u6570\u636e\u7c7b\u578b\uff0c\u8fd9\u6837\u5c31\u80fd\u77e5\u9053\u5b9e\u9645\u6d88\u8017\u7684\u5185\u5b58\u5927\u5c0f\u4e86 Redis\u7684String\u7c7b\u578b\u6570\u636e\u7ed3\u6784\uff0c\u53ca\u5176\u5e95\u5c42\u5b9e\u73b0 Redis\u7684String\u7c7b\u578b\u6570\u636e\u7ed3\u6784\uff0c\u53ca\u5176\u5e95\u5c42\u5b9e\u73b0 \u53ef\u4ee5\u5de7\u5999\u7684\u5229\u7528Redis\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u7279\u6027\uff0c\u964d\u4f4e\u8d44\u6e90\u6d88\u8017 Simple Dynamic String\u7ed3\u6784 buf \uff1a\u5b57\u8282\u6570\u7ec4\uff0c\u4fdd\u5b58\u5b9e\u9645\u6570\u636e\u3002\u4e3a\u4e86\u8868\u793a\u5b57\u8282\u6570\u7ec4\u7684\u7ed3\u675f\uff0cRedis \u4f1a\u81ea\u52a8\u5728\u6570\u7ec4\u6700\u540e\u52a0\u4e00\u4e2a \u201c\\0\u201d \uff0c\u8fd9\u5c31\u4f1a\u989d\u5916\u5360\u7528 1 \u4e2a\u5b57\u8282\u7684\u5f00\u9500\u3002 len\uff1a\u5360 4 \u4e2a\u5b57\u8282\uff0c \u8868\u793a buf \u7684\u5df2\u7528\u957f\u5ea6 \u3002 alloc\uff1a\u4e5f\u5360\u4e2a 4 \u5b57\u8282\uff0c \u8868\u793a buf \u7684\u5b9e\u9645\u5206\u914d\u957f\u5ea6\uff0c\u4e00\u822c\u5927\u4e8e len\u3002 dicEntry \u7ed3\u6784\u4f53 key\uff1a8\u4e2a\u5b57\u8282\u6307\u9488\uff0c\u6307\u5411key value\uff1a8\u4e2a\u5b57\u8282\u6307\u9488\uff0c\u6307\u5411value next\uff1a\u6307\u5411\u4e0b\u4e00\u4e2adicEntry ziplist(\u538b\u7f29\u5217\u8868)\uff08 zlbytes\uff1a\u5728\u8868\u5934\uff0c\u8868\u793a\u5217\u8868\u957f\u5ea6 zltail\uff1a\u5728\u8868\u5934\uff0c\u8868\u793a\u5217\u5c3e\u504f\u79fb\u91cf zllen\uff1a\u5728\u8868\u5934\uff0c\u8868\u793a\u5217\u8868\u4e2d entry\uff1a\u4fdd\u5b58\u6570\u636e\u5bf9\u8c61\u6a21\u578b zlend\uff1a\u5728\u8868\u5c3e\uff0c\u8868\u793a\u5217\u8868\u7ed3\u675f\uff09 entry\uff1a prev_len \uff1a\u8868\u793a\u4e00\u4e2aentry\u7684\u957f\u5ea6\uff0c\u6709\u4e24\u79cd\u53d6\u503c\u65b9\u5f0f\uff1a1\u5b57\u8282\u62165\u5b57\u8282\u3002 1\u5b57\u8282\u8868\u793a\u4e00\u4e2aentry\u5c0f\u4e8e254\u5b57\u8282\uff0c255\u662fzlend\u7684\u9ed8\u8ba4\u503c\uff0c\u6240\u4ee5\u4e0d\u4f7f\u7528\u3002 len\uff1a\u8868\u793a\u81ea\u8eab\u957f\u5ea6\uff0c4\u5b57\u8282 encodeing\uff1a\u8868\u793a\u7f16\u7801\u65b9\u5f0f\uff0c1\u5b57\u8282 content\uff1a\u4fdd\u5b58\u5b9e\u9645\u6570\u636e String\u7c7b\u578b\u7684\u5185\u5b58\u7a7a\u95f4\u6d88\u8017 \u4fdd\u5b58Long\u7c7b\u578b\u65f6\uff0c\u6307\u9488\u76f4\u63a5\u4fdd\u5b58\u6574\u6570\u6570\u636e\u503c\uff0c\u53ef\u4ee5\u8282\u7701\u7a7a\u95f4\u5f00\u9500\uff08\u88ab\u79f0\u4e3a\uff1aint\u7f16\u7801\uff09 \u4fdd\u5b58\u5b57\u7b26\u4e32\uff0c\u4e14\u4e0d\u5927\u4e8e44\u5b57\u8282\u65f6\uff0cRedisObject\u7684\u5143\u6570\u636e\uff0c\u6307\u9488\u548cSDS\u662f\u8fde\u7eed\u7684\uff0c\u53ef\u4ee5\u907f\u514d\u5185\u5b58\u788e\u7247\uff08\u88ab\u79f0\u4e3a\uff1aembstr\u7f16\u7801\uff09 \u5f53\u4fdd\u5b58\u7684\u5b57\u7b26\u4e32\u5927\u4e8e44\u5b57\u8282\u65f6\uff0cSDS\u7684\u6570\u636e\u91cf\u53d8\u591a\uff0cRedis\u4f1a\u7ed9SDS\u5206\u914d\u72ec\u7acb\u7684\u7a7a\u95f4\uff0c\u5e76\u7528\u6307\u9488\u6307\u5411SDS\u7ed3\u6784\uff08\u88ab\u79f0\u4e3a\uff1araw\u7f16\u7801\uff09 Redis\u4f7f\u7528\u4e00\u4e2a\u5168\u5c40\u54c8\u5e0c\u8868\u4fdd\u5b58\u6240\u4ee5\u952e\u503c\u5bf9\uff0c\u54c8\u5e0c\u8868\u7684\u6bcf\u4e00\u9879\u90fd\u662f\u4e00\u4e2adicEntry\uff0c\u6bcf\u4e2adicEntry\u5360\u752832\u5b57\u8282\u7a7a\u95f4 dicEntry\u81ea\u8eab24\u5b57\u8282\uff0c\u4f46\u4f1a\u5360\u752832\u5b57\u8282\u7a7a\u95f4\uff0c\u662f\u56e0\u4e3aRedis\u4f7f\u7528\u4e86\u5185\u5b58\u5206\u914d\u5e93jemalloc\u3002 jemalloc\u5728\u5206\u914d\u5185\u5b58\u65f6\uff0c\u4f1a\u6839\u636e\u7533\u8bf7\u7684\u5b57\u8282\u6570N\uff0c\u627e\u4e00\u4e2a\u6bd4N\u5927\uff0c\u4f46\u6700\u63a5\u8fd1N\u76842\u7684\u5e42\u6b21\u6570\u4f5c\u4e3a\u5206\u914d\u7a7a\u95f4\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u9891\u7e41\u5206\u914d\u5185\u5b58\u7684\u6b21\u6570 \u4f7f\u7528\u4ec0\u4e48\u6570\u636e\u7ed3\u6784\u53ef\u4ee5\u8282\u7701\u5185\u5b58\uff1f \u538b\u7f29\u5217\u8868\uff0c\u662f\u4e00\u79cd\u975e\u5e38\u8282\u7701\u5185\u5b58\u7684\u6570\u636e\u7ed3\u6784\uff0c\u56e0\u4e3a\u4ed6\u4f7f\u7528\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u4fdd\u5b58\u6570\u636e\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7684\u6307\u9488\u8fdb\u884c\u8fde\u63a5 Redis\u57fa\u4e8e\u538b\u7f29\u5217\u8868\u5b9e\u73b0List\uff0cHash\uff0cSorted Set\u96c6\u5408\u7c7b\u578b\uff0c\u6700\u5927\u7684\u597d\u5904\u662f\u8282\u7701\u4e86dicEntry\u5f00\u9500 \u5982\u4f55\u4f7f\u7528\u96c6\u5408\u7c7b\u578b\u4fdd\u5b58\u952e\u503c\u5bf9\uff1f Hash\u7c7b\u578b\u8bbe\u7f6e\u4e86\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u6570\u636e\u65f6\u7684\u4e24\u4e2a\u9600\u503c\uff0c\u4e00\u65e6\u8d85\u8fc7\u5c31\u4f1a\u5c06\u538b\u7f29\u5217\u8868\u8f6c\u4e3a\u54c8\u5e0c\u8868\uff0c\u4e14\u4e0d\u53ef\u56de\u9000 hash-max-ziplist-entries \uff1a\u8868\u793a\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u54c8\u5e0c\u96c6\u5408\u4e2d\u7684\u6700\u5927\u5143\u7d20\u4e2a\u6570 hash-max-ziplist-value \uff1a\u8868\u793a\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u65f6\uff0c\u54c8\u5e0c\u96c6\u5408\u4e2d\u5355\u4e2a\u5143\u7d20\u7684\u6700\u5927\u957f\u5ea6 1-2 Redis\u6709\u90a3\u4e9b\u6570\u636e\u7ed3\u6784\u9002\u5408\u505a\u7edf\u8ba1 Set \u548c Sorted Set \u90fd\u652f\u6301\u591a\u79cd\u805a\u5408\u7edf\u8ba1\uff0c\u4e0d\u8fc7\uff0c\u5bf9\u4e8e\u5dee\u96c6\u8ba1\u7b97\u6765\u8bf4\uff0c\u53ea\u6709 Set \u652f\u6301\u3002Bitmap \u4e5f\u80fd\u505a\u591a\u4e2a Bitmap \u95f4\u7684\u805a\u5408\u8ba1\u7b97\uff0c\u5305\u62ec\u4e0e\u3001\u6216\u548c\u5f02\u6216\u64cd\u4f5c\u3002 \u5f53\u9700\u8981\u8fdb\u884c\u6392\u5e8f\u7edf\u8ba1\u65f6 \uff0cList \u4e2d\u7684\u5143\u7d20\u867d\u7136\u6709\u5e8f\uff0c\u4f46\u662f\u4e00\u65e6\u6709\u65b0\u5143\u7d20\u63d2\u5165\uff0c\u539f\u6765\u7684\u5143\u7d20\u5728 List \u4e2d\u7684\u4f4d\u7f6e\u5c31\u4f1a\u79fb\u52a8\uff0c\u90a3\u4e48\uff0c\u6309\u4f4d\u7f6e\u8bfb\u53d6\u7684\u6392\u5e8f\u7ed3\u679c\u53ef\u80fd\u5c31\u4e0d\u51c6\u786e\u4e86\u3002\u800c Sorted Set \u672c\u8eab\u662f\u6309\u7167\u96c6\u5408\u5143\u7d20\u7684\u6743\u91cd\u6392\u5e8f\uff0c\u53ef\u4ee5\u51c6\u786e\u5730\u6309\u5e8f\u83b7\u53d6\u7ed3\u679c\uff0c\u6240\u4ee5\u5efa\u8bae\u4f60\u4f18\u5148\u4f7f\u7528\u5b83\u3002 \u8bb0\u5f55\u7684\u6570\u636e\u53ea\u6709 0 \u548c 1 \u4e24\u4e2a\u503c\u7684\u72b6\u6001\uff0cBitmap \u4f1a\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\uff0c\u8fd9\u4e3b\u8981\u5f52\u529f\u4e8e Bitmap \u5bf9\u4e8e\u4e00\u4e2a\u6570\u636e\u53ea\u7528 1 \u4e2a bit \u8bb0\u5f55\uff0c\u53ef\u4ee5\u8282\u7701\u5185\u5b58\u3002 \u5bf9\u4e8e\u57fa\u6570\u7edf\u8ba1\u6765\u8bf4\uff0c\u5982\u679c\u96c6\u5408\u5143\u7d20\u91cf\u8fbe\u5230\u4ebf\u7ea7\u522b\u800c\u4e14\u4e0d\u9700\u8981\u7cbe\u786e\u7edf\u8ba1\u65f6\uff0c\u6211\u5efa\u8bae\u4f60\u4f7f\u7528 HyperLogLog\u3002 \u91cd\u70b9\u53ca\u4eae\u70b9 \u65e5\u5e38\u7684\u7edf\u8ba1\u9700\u6c42\u53ef\u4ee5\u5206\u4e3a\u56db\u7c7b\uff1a\u805a\u5408\uff0c\u6392\u5e8f\uff0c\u4e8c\u503c\u72b6\u6001\uff0c\u57fa\u6570\uff0c\u9009\u7528\u9002\u5408\u7684\u6570\u636e\u7c7b\u578b\u53ef\u4ee5\u5b9e\u73b0\u5373\u5feb\u901f\u53c8\u8282\u7701\u5185\u5b58 \u805a\u5408\u7edf\u8ba1\uff0c\u53ef\u4ee5\u9009\u7528Set\u7c7b\u578b\u5b8c\u6210\uff0c\u4f46Set\u7684\u5dee\uff0c\u5e76\uff0c\u4ea4\u96c6\u64cd\u4f5c\u590d\u6742\u5ea6\u9ad8\uff0c\u5728\u6570\u636e\u91cf\u5927\u7684\u65f6\u5019\u4f1a\u963b\u585e\u4e3b\u8fdb\u7a0b \u6392\u5e8f\u7edf\u8ba1\uff0c\u53ef\u4ee5\u9009\u7528List\u548cSorted Set \u4e8c\u503c\u72b6\u6001\u7edf\u8ba1\uff1aBitmap\u672c\u8eab\u662f\u7528String\u7c7b\u578b\u4f5c\u4e3a\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5b9e\u73b0\uff0cString\u7c7b\u578b\u4f1a\u4fdd\u5b58\u4e3a\u4e8c\u8fdb\u5236\u5b57\u8282\u6570\u7ec4\uff0c\u6240\u4ee5\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2abit\u6570\u7ec4 \u57fa\u6570\u7edf\u8ba1\uff1aHyperLogLog ,\u8ba1\u7b97\u57fa\u6570\u6240\u9700\u7a7a\u95f4\u603b\u662f\u56fa\u5b9a\u7684\uff0c\u800c\u4e14\u5f88\u5c0f\u3002\u4f46\u8981\u6ce8\u610f\uff0cHyperLogLog\u662f\u7edf\u8ba1\u89c4\u5219\u662f\u57fa\u4e8e\u6982\u7387\u5b8c\u6210\u7684\uff0c\u4e0d\u662f\u975e\u5e38\u51c6\u786e 1-3 GEO\uff0c\u4e00\u79cd\u53ef\u4ee5\u5b9e\u73b0LBS\u670d\u52a1\u7684\u6570\u636e\u7ed3\u6784 GEO \u672c\u8eab\u5e76\u6ca1\u6709\u8bbe\u8ba1\u65b0\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff0c\u800c\u662f\u76f4\u63a5\u4f7f\u7528\u4e86 Sorted Set \u96c6\u5408\u7c7b\u578b\u3002 GEO \u7c7b\u578b\u4f7f\u7528 GeoHash \u7f16\u7801\u65b9\u6cd5\u5b9e\u73b0\u4e86\u7ecf\u7eac\u5ea6\u5230 Sorted Set \u4e2d\u5143\u7d20\u6743\u91cd\u5206\u6570\u7684\u8f6c\u6362\uff0c\u8fd9\u5176\u4e2d\u7684\u4e24\u4e2a\u5173\u952e\u673a\u5236\u5c31\u662f\u5bf9\u4e8c\u7ef4\u5730\u56fe\u505a\u533a\u95f4\u5212\u5206\uff0c\u4ee5\u53ca\u5bf9\u533a\u95f4\u8fdb\u884c\u7f16\u7801\u3002 \u4e00\u7ec4\u7ecf\u7eac\u5ea6\u843d\u5728\u67d0\u4e2a\u533a\u95f4\u540e\uff0c\u5c31\u7528\u533a\u95f4\u7684\u7f16\u7801\u503c\u6765\u8868\u793a\uff0c\u5e76\u628a\u7f16\u7801\u503c\u4f5c\u4e3a Sorted Se \u5143\u7d20\u7684\u6743\u91cd\u5206\u6570\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u7ecf\u7eac\u5ea6\u4fdd\u5b58\u5230 Sorted Set \u4e2d\uff0c\u5229\u7528 Sorted Set \u63d0\u4f9b\u7684\u201c\u6309\u6743\u91cd\u8fdb\u884c\u6709\u5e8f\u8303\u56f4\u67e5\u627e\u201d\u7684\u7279\u6027\uff0c\u5b9e\u73b0 LBS \u670d\u52a1\u4e2d\u9891\u7e41\u4f7f\u7528\u7684\u201c\u641c\u7d22\u9644\u8fd1\u201d\u7684\u9700\u6c42\u3002 GEO \u5c5e\u4e8e Redis \u63d0\u4f9b\u7684\u6269\u5c55\u6570\u636e\u7c7b\u578b\u3002\u6269\u5c55\u6570\u636e\u7c7b\u578b\u6709\u4e24\u79cd\u5b9e\u73b0\u9014\u5f84\uff1a \u4e00\u79cd\u662f\u57fa\u4e8e\u73b0\u6709\u7684\u6570\u636e\u7c7b\u578b\uff0c\u901a\u8fc7\u6570\u636e\u7f16\u7801\u6216\u662f\u5b9e\u73b0\u65b0\u7684\u64cd\u4f5c\u7684\u65b9\u5f0f\uff0c\u6765\u5b9e\u73b0\u6269\u5c55\u6570\u636e\u7c7b\u578b\uff0c\u4f8b\u5982\u57fa\u4e8e Sorted Set \u548c GeoHash \u7f16\u7801\u5b9e\u73b0 GEO\uff0c\u4ee5\u53ca\u57fa\u4e8e String \u548c\u4f4d\u64cd\u4f5c\u5b9e\u73b0 Bitmap\uff1b \u53e6\u4e00\u79cd\u5c31\u662f\u5f00\u53d1\u81ea\u5b9a\u4e49\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5177\u4f53\u7684\u64cd\u4f5c\u662f\u589e\u52a0\u65b0\u6570\u636e\u7c7b\u578b\u7684\u5b9a\u4e49\uff0c\u5b9e\u73b0\u521b\u5efa\u548c\u91ca\u653e\u51fd\u6570\uff0c\u5b9e\u73b0\u65b0\u6570\u636e\u7c7b\u578b\u652f\u6301\u7684\u547d\u4ee4\u64cd\u4f5c \u8981\u70b9&\u4eae\u70b9\uff1f GEO\u7684\u539f\u7406\uff0c\u8fd9\u4e2a\u662f\u6211\u4e4b\u524d\u6240\u4e0d\u77e5\u9053\u7684\uff0c\u5b66\u5b8c\u540e\u5bf9GEO\u6709\u4e86\u4e00\u4e9b\u8ba4\u77e5 Redis\u5c45\u7136\u652f\u6301\u81ea\u5b9a\u4e49\u6570\u636e\u5b58\u50a8\u7ed3\u6784\uff0c\u8fd9\u6253\u5f00\u4e86\u6211\u7684\u773c\u754c GEO\u7684\u5e95\u5c42\u5b9e\u73b0\uff0c\u662fsortSet\uff0c\u5143\u7d20\u662f\u8f66\u8f86\u4fe1\u606f\uff0c\u6743\u91cd\u662f\u8f66\u8f86\u7ecf\u7eac\u5ea6\u8f6c\u6362\u8fc7\u6765\u7684float\u503c GEOHash\u7f16\u7801\uff0c\u57fa\u672c\u539f\u7406\u201c\u4e8c\u5206\u533a\u95f4\uff0c\u533a\u95f4\u7f16\u7801\u201d\uff08\u4e8c\u5206\u6cd5\u7684\u5e94\u7528\uff0c\u5c06\u4e00\u4e2a\u503c\u7f16\u7801\u6210N\u4f4d\u7684\u4e8c\u8fdb\u5236\u503c\uff09 GEO\u4f7f\u7528GEOHash\u7f16\u7801\u540e\uff0c\u5c06\u7ecf\u7eac\u5ea6\uff0c\u6309\u7167\u7eac\u5947\u7ecf\u5076\u4f4d\u5206\u522b\u586b\u5145\u7ec4\u5408\uff0c\u5f97\u5230\u4e00\u4e2a\u8f66\u8f86\u7684\u7ecf\u7eac\u5ea6\u7f16\u7801\u503c GEOHash\u7f16\u7801\u5b9e\u73b0\u7684\u6548\u679c\u662f\u5c06\u4e00\u4e2a\u7a7a\u95f4\u5206\u5272\u6210\u4e3a\u4e00\u4e2a\u4e2a\u65b9\u5757\uff0c\u53ef\u4ee5\u5b9e\u73b0LBS\u670d\u52a1\uff08\u4f46\u7f16\u7801\u503c\u76f8\u8fd1\uff0c\u4e0d\u4e00\u5b9a\u4f4d\u7f6e\u76f8\u8fd1\uff09 1-4 \u6839\u636e\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u7279\u70b9\uff0c\u9009\u62e9\u5408\u9002\u7684\u5b58\u50a8\u65b9\u6848 \u70b9\u67e5\u8be2\uff0c\u6839\u636e\u4e00\u4e2a\u65f6\u95f4\u6233\uff0c\u67e5\u8be2\u76f8\u5e94\u65f6\u95f4\u7684\u6570\u636e\uff1b \u8303\u56f4\u67e5\u8be2\uff0c\u67e5\u8be2\u8d77\u59cb\u548c\u622a\u6b62\u65f6\u95f4\u6233\u8303\u56f4\u5185\u7684\u6570\u636e\uff1b \u805a\u5408\u8ba1\u7b97\uff0c\u9488\u5bf9\u8d77\u59cb\u548c\u622a\u6b62\u65f6\u95f4\u6233\u8303\u56f4\u5185\u7684\u6240\u6709\u6570\u636e\u8fdb\u884c\u8ba1\u7b97\uff0c\u4f8b\u5982\u6c42\u6700\u5927 / \u6700\u5c0f\u503c\uff0c\u6c42\u5747\u503c\u7b49\u3002 Redis \u7684\u9ad8\u6027\u80fd\u5199\u7279\u6027\u8db3\u4ee5\u5e94\u5bf9\u4e86\uff1b\u800c\u9488\u5bf9\u591a\u6837\u5316\u7684\u67e5\u8be2\u9700\u6c42\uff0cRedis \u63d0\u4f9b\u4e86\u4e24\u79cd\u65b9\u6848\u3002 \u7b2c\u4e00\u79cd\u65b9\u6848\u662f\uff0c\u7ec4\u5408\u4f7f\u7528 Redis \u5185\u7f6e\u7684 Hash \u548c Sorted Set \u7c7b\u578b\uff0c\u628a\u6570\u636e\u540c\u65f6\u4fdd\u5b58\u5728 Hash \u96c6\u5408\u548c Sorted Set \u96c6\u5408\u4e2d\u3002 \u8fd9\u79cd\u65b9\u6848\u65e2\u53ef\u4ee5\u5229\u7528 Hash \u7c7b\u578b\u5b9e\u73b0\u5bf9\u5355\u952e\u7684\u5feb\u901f\u67e5\u8be2\uff0c\u8fd8\u80fd\u5229\u7528 Sorted Set \u5b9e\u73b0\u5bf9\u8303\u56f4\u67e5\u8be2\u7684\u9ad8\u6548\u652f\u6301\uff0c\u4e00\u4e0b\u5b50\u6ee1\u8db3\u4e86\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u4e24\u5927\u67e5\u8be2\u9700\u6c42\u3002 \u7b2c\u4e00\u79cd\u65b9\u6848\u4e5f\u6709\u4e24\u4e2a\u4e0d\u8db3 \u5728\u6267\u884c\u805a\u5408\u8ba1\u7b97\u65f6\uff0c\u6211\u4eec\u9700\u8981\u628a\u6570\u636e\u8bfb\u53d6\u5230\u5ba2\u6237\u7aef\u518d\u8fdb\u884c\u805a\u5408\uff0c\u5f53\u6709\u5927\u91cf\u6570\u636e\u8981\u805a\u5408\u65f6\uff0c\u6570\u636e\u4f20\u8f93\u5f00\u9500\u5927\uff1b \u6240\u6709\u7684\u6570\u636e\u4f1a\u5728\u4e24\u4e2a\u6570\u636e\u7c7b\u578b\u4e2d\u5404\u4fdd\u5b58\u4e00\u4efd\uff0c\u5185\u5b58\u5f00\u9500\u4e0d\u5c0f\u3002 \u4e0d\u8fc7\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u9002\u5f53\u7684\u6570\u636e\u8fc7\u671f\u65f6\u95f4\uff0c\u91ca\u653e\u5185\u5b58\uff0c\u51cf\u5c0f\u5185\u5b58\u538b\u529b \u3002 RedisTimeSeries \u6a21\u5757 \u8fd9\u662f\u4e13\u95e8\u4e3a\u5b58\u53d6\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u800c\u8bbe\u8ba1\u7684\u6269\u5c55\u6a21\u5757\u3002\u548c\u7b2c\u4e00\u79cd\u65b9\u6848\u76f8\u6bd4\uff0c RedisTimeSeries \u80fd\u652f\u6301\u76f4\u63a5\u5728 Redis \u5b9e\u4f8b\u4e0a\u8fdb\u884c\u591a\u79cd\u6570\u636e\u805a\u5408\u8ba1\u7b97\uff0c\u907f\u514d\u4e86\u5927\u91cf\u6570\u636e\u5728\u5b9e\u4f8b\u548c\u5ba2\u6237\u7aef\u95f4\u4f20\u8f93\u3002 \u4e0d\u8fc7\uff0c RedisTimeSeries \u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u4f7f\u7528\u4e86\u94fe\u8868\uff0c\u5b83\u7684\u8303\u56f4\u67e5\u8be2\u7684\u590d\u6742\u5ea6\u662f O(N) \u7ea7\u522b\u7684\uff0c\u540c\u65f6\uff0c\u5b83\u7684 TS.GET \u67e5\u8be2\u53ea\u80fd\u8fd4\u56de\u6700\u65b0\u7684\u6570\u636e\uff0c\u6ca1\u6709\u529e\u6cd5\u50cf\u7b2c\u4e00\u79cd\u65b9\u6848\u7684 Hash \u7c7b\u578b\u4e00\u6837\uff0c\u53ef\u4ee5\u8fd4\u56de\u4efb\u4e00\u65f6\u95f4\u70b9\u7684\u6570\u636e\u3002 \u7ec4\u5408\u4f7f\u7528 Hash \u548c Sorted Set\uff0c\u6216\u8005\u4f7f\u7528 RedisTimeSeries\uff0c\u5728\u652f\u6301\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u5b58\u53d6\u4e0a\u5404\u6709\u4f18\u52a3\u52bf \u5982\u679c\u4f60\u7684\u90e8\u7f72\u73af\u5883\u4e2d\u7f51\u7edc\u5e26\u5bbd\u9ad8\u3001Redis \u5b9e\u4f8b\u5185\u5b58\u5927\uff0c\u53ef\u4ee5\u4f18\u5148\u8003\u8651\u7b2c\u4e00\u79cd\u65b9\u6848\uff1b \u5982\u679c\u4f60\u7684\u90e8\u7f72\u73af\u5883\u4e2d\u7f51\u7edc\u3001\u5185\u5b58\u8d44\u6e90\u6709\u9650\uff0c\u800c\u4e14\u6570\u636e\u91cf\u5927\uff0c\u805a\u5408\u8ba1\u7b97\u9891\u7e41\uff0c\u9700\u8981\u6309\u6570\u636e\u96c6\u5408\u5c5e\u6027\u67e5\u8be2\uff0c\u53ef\u4ee5\u4f18\u5148\u8003\u8651\u7b2c\u4e8c\u79cd\u65b9\u6848\u3002 \u4f7f\u7528 Sorted Set \u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u628a\u65f6\u95f4\u6233\u4f5c\u4e3a score \uff0c\u628a\u5b9e\u9645\u7684\u6570\u636e\u4f5c\u4e3a member\uff0c\u4f60\u89c9\u5f97\u8fd9\u6837\u4fdd\u5b58\u6570\u636e\u6709\u6ca1\u6709\u6f5c\u5728\u7684\u98ce\u9669\uff1f\u53e6\u5916\uff0c\u5982\u679c\u4f60\u662f Redis \u7684\u5f00\u53d1\u7ef4\u62a4\u8005\uff0c\u4f60\u4f1a\u628a\u805a\u5408\u8ba1\u7b97\u4e5f\u8bbe\u8ba1\u4e3a Sorted Set \u7684\u4e00\u4e2a\u5185\u5728\u529f\u80fd\u5417\uff1f \u5b58\u5728member\u91cd\u590d\u7684\u95ee\u9898\uff0c\u4f1a\u5bf9member\u8986\u76d6 1-5 \u5982\u4f55\u4f7f\u7528redis\u5b9e\u73b0\u6d88\u606f\u961f\u5217\u7684\u9700\u6c42 \u5206\u5e03\u5f0f\u7cfb\u7edf\u7ec4\u4ef6\u4f7f\u7528\u6d88\u606f\u961f\u5217\u65f6\u7684\u4e09\u5927\u9700\u6c42\uff1a \u6d88\u606f\u4fdd\u5e8f\u3001\u91cd\u590d\u6d88\u606f\u5904\u7406\u548c\u6d88\u606f\u53ef\u9760\u6027\u4fdd\u8bc1 \uff0c\u8fd9\u4e09\u5927\u9700\u6c42\u53ef\u4ee5\u8fdb\u4e00\u6b65\u8f6c\u6362\u4e3a\u5bf9\u6d88\u606f\u961f\u5217\u7684\u4e09\u5927\u8981\u6c42\uff1a \u6d88\u606f\u6570\u636e\u6709\u5e8f\u5b58\u53d6\uff0c\u6d88\u606f\u6570\u636e\u5177\u6709\u5168\u5c40\u552f\u4e00\u7f16\u53f7\uff0c\u4ee5\u53ca\u6d88\u606f\u6570\u636e\u5728\u6d88\u8d39\u5b8c\u6210\u540e\u88ab\u5220\u9664\u3002 \u5176\u5b9e\uff0c\u5173\u4e8e Redis \u662f\u5426\u9002\u5408\u505a\u6d88\u606f\u961f\u5217\uff0c\u4e1a\u754c\u4e00\u76f4\u662f\u6709\u4e89\u8bba\u7684\u3002\u5f88\u591a\u4eba\u8ba4\u4e3a\uff0c\u8981\u4f7f\u7528\u6d88\u606f\u961f\u5217\uff0c\u5c31\u5e94\u8be5\u91c7\u7528 Kafka\u3001RabbitMQ \u8fd9\u4e9b\u4e13\u95e8\u9762\u5411\u6d88\u606f\u961f\u5217\u573a\u666f\u7684\u8f6f\u4ef6\uff0c\u800c Redis \u66f4\u52a0\u9002\u5408\u505a\u7f13\u5b58\u3002 Redis \u662f\u4e00\u4e2a\u975e\u5e38\u8f7b\u91cf\u7ea7\u7684\u952e\u503c\u6570\u636e\u5e93\uff0c\u90e8\u7f72\u4e00\u4e2a Redis \u5b9e\u4f8b\u5c31\u662f\u542f\u52a8\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u90e8\u7f72 Redis \u96c6\u7fa4\uff0c\u4e5f\u5c31\u662f\u90e8\u7f72\u591a\u4e2a Redis \u5b9e\u4f8b\u3002\u800c Kafka\u3001RabbitMQ \u90e8\u7f72\u65f6\uff0c\u6d89\u53ca\u989d\u5916\u7684\u7ec4\u4ef6\uff0c\u4f8b\u5982 Kafka \u7684\u8fd0\u884c\u5c31\u9700\u8981\u518d\u90e8\u7f72 ZooKeeper\u3002 \u76f8\u6bd4 Redis \u6765\u8bf4\uff0cKafka \u548c RabbitMQ \u4e00\u822c\u88ab\u8ba4\u4e3a\u662f\u91cd\u91cf\u7ea7\u7684\u6d88\u606f\u961f\u5217\u3002 \u5982\u679c\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u7684\u7ec4\u4ef6\u6d88\u606f\u901a\u4fe1\u91cf\u4e0d\u5927\uff0c\u90a3\u4e48\uff0cRedis \u53ea\u9700\u8981\u4f7f\u7528\u6709\u9650\u7684\u5185\u5b58\u7a7a\u95f4\u5c31\u80fd\u6ee1\u8db3\u6d88\u606f\u5b58\u50a8\u7684\u9700\u6c42\uff0c\u800c\u4e14\uff0c Redis \u7684\u9ad8\u6027\u80fd\u7279\u6027\u80fd\u652f\u6301\u5feb\u901f\u7684\u6d88\u606f\u8bfb\u5199\uff0c\u4e0d\u5931\u4e3a\u6d88\u606f\u961f\u5217\u7684\u4e00\u4e2a\u597d\u7684\u89e3\u51b3\u65b9\u6848\u3002 2\u3001\u672c\u7ae0\u64cd\u4f5c\u603b\u7ed3 1-1 Redis\u7684String\u7c7b\u578b\u6570\u636e\u7ed3\u6784\uff0c\u53ca\u5176\u5e95\u5c42\u5b9e\u73b0 127.0.0.1:6379> info memory # Memory used_memory:1039120 127.0.0.1:6379> hset 1101000 060 3302000080 (integer) 1 127.0.0.1:6379> info memory # Memory used_memory:1039136 1-2 Redis\u6709\u90a3\u4e9b\u6570\u636e\u7ed3\u6784\u9002\u5408\u505a\u7edf\u8ba1 \u6211\u4eec\u8ba1\u7b97\u7d2f\u8ba1\u7528\u6237 Set \u548c user:id:20200803 Set \u7684\u5e76\u96c6\u7ed3\u679c\uff0c\u7ed3\u679c\u4fdd\u5b58\u5728 user:id \u8fd9\u4e2a\u7d2f\u8ba1\u7528\u6237 Set \u7edf\u8ba1\u591a\u4e2a\u96c6\u5408\u7684\u6240\u6709\u5143\u7d20\uff08\u5e76\u96c6\u7edf\u8ba1\uff09\u3002 SUNIONSTORE user:id user:id user:id:20200803 \u6b64\u65f6\uff0c user:id \u8fd9\u4e2a\u7d2f\u8ba1\u7528\u6237 Set \u4e2d\u5c31\u6709\u4e86 8 \u6708 3 \u65e5\u7684\u7528\u6237 ID\u3002\u7b49\u5230 8 \u6708 4 \u65e5\u518d\u7edf\u8ba1\u65f6\uff0c\u6211\u4eec\u628a 8 \u6708 4 \u65e5\u767b\u5f55\u7684\u7528\u6237 ID \u8bb0\u5f55\u5230 user:id:20200804 \u7684 Set \u4e2d\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6267\u884c SDIFFSTORE \u547d\u4ee4\u8ba1\u7b97\u7d2f\u8ba1\u7528\u6237 Set \u548c user:id:20200804 Set \u7684\u5dee\u96c6\uff0c\u7ed3\u679c\u4fdd\u5b58\u5728 key \u4e3a user:new \u7684 Set \u4e2d\uff0c\u5982\u4e0b\u6240\u793a\uff1a \u628a\u4e24\u4e2a\u96c6\u5408\u76f8\u6bd4\uff0c\u7edf\u8ba1\u5176\u4e2d\u4e00\u4e2a\u96c6\u5408\u72ec\u6709\u7684\u5143\u7d20\uff08\u5dee\u96c6\u7edf\u8ba1\uff09\uff1b SDIFFSTORE user:new user:id:20200804 user:id \u4ee5\u770b\u5230\uff0c\u8fd9\u4e2a\u5dee\u96c6\u4e2d\u7684\u7528\u6237 ID \u5728 user:id:20200804 \u7684 Set \u4e2d\u5b58\u5728\uff0c\u4f46\u662f\u4e0d\u5728\u7d2f\u8ba1\u7528\u6237 Set \u4e2d\u3002\u6240\u4ee5\uff0c user:new \u8fd9\u4e2a Set \u4e2d\u8bb0\u5f55\u7684\u5c31\u662f 8 \u6708 4 \u65e5\u7684\u65b0\u589e\u7528\u6237\u3002 \u5f53\u8981\u8ba1\u7b97 8 \u6708 4 \u65e5\u7684\u7559\u5b58\u7528\u6237\u65f6\uff0c\u6211\u4eec\u53ea\u9700\u8981\u518d\u8ba1\u7b97 user:id:20200803 \u548c user:id:20200804 \u4e24\u4e2a Set \u7684\u4ea4\u96c6\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u540c\u65f6\u5728\u8fd9\u4e24\u4e2a\u96c6\u5408\u4e2d\u7684\u7528\u6237 ID \u4e86\uff0c\u8fd9\u4e9b\u5c31\u662f\u5728 8 \u6708 3 \u65e5\u767b\u5f55\uff0c\u5e76\u4e14\u5728 8 \u6708 4 \u65e5\u7559\u5b58\u7684\u7528\u6237\u3002 \u7edf\u8ba1\u591a\u4e2a\u96c6\u5408\u7684\u5171\u6709\u5143\u7d20\uff08\u4ea4\u96c6\u7edf\u8ba1\uff09 SINTERSTORE user:id:rem user:id:20200803 user:id:20200804 \u5f53\u4f60\u9700\u8981\u5bf9\u591a\u4e2a\u96c6\u5408\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\u65f6\uff0cSet \u7c7b\u578b\u4f1a\u662f\u4e00\u4e2a\u975e\u5e38\u4e0d\u9519\u7684\u9009\u62e9 set\u7c7b\u578b\u9002\u5408\u505a\u805a\u5408\u7edf\u8ba1\uff1a SUNIONSTORE :\u5e76\u96c6 SDIFFSTORE :\u5dee\u96c6 SINTERSTORE :\u4ea4\u96c6 \u7528 LPUSH \u547d\u4ee4\u628a\u5b83\u63d2\u5165 List \u7684\u961f\u5934\u3002 \u5047\u8bbe\u5f53\u524d\u7684\u8bc4\u8bba List \u662f{A, B, C, D, E, F}\uff08\u5176\u4e2d\uff0cA \u662f\u6700\u65b0\u7684\u8bc4\u8bba\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0cF \u662f\u6700\u65e9\u7684\u8bc4\u8bba\uff09\uff0c\u5728\u5c55\u793a\u7b2c\u4e00\u9875\u7684 3 \u4e2a\u8bc4\u8bba\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5f97\u5230\u6700\u65b0\u7684\u4e09\u6761\u8bc4\u8bba A\u3001B\u3001C\uff1a LRANGE product1 0 2 1) \"A\" 2) \"B\" 3) \"C\" \u7136\u540e\uff0c\u518d\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u83b7\u53d6\u7b2c\u4e8c\u9875\u7684 3 \u4e2a\u8bc4\u8bba\uff0c\u4e5f\u5c31\u662f D\u3001E\u3001F\u3002 LRANGE product1 3 5 1) \"D\" 2) \"E\" 3) \"F\" Sorted Set ZRANGEBYSCORE comments N-9 N Bitmap Bitmap \u63d0\u4f9b\u4e86 GETBIT/SETBIT \u64cd\u4f5c\uff0c\u4f7f\u7528\u4e00\u4e2a\u504f\u79fb\u503c offset \u5bf9 bit \u6570\u7ec4\u7684\u67d0\u4e00\u4e2a bit \u4f4d\u8fdb\u884c\u8bfb\u548c\u5199\u3002 \u4e0d\u8fc7\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cBitmap \u7684\u504f\u79fb\u91cf\u662f\u4ece 0 \u5f00\u59cb\u7b97\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4 offset \u7684\u6700\u5c0f\u503c\u662f 0\u3002 \u5f53\u4f7f\u7528 SETBIT \u5bf9\u4e00\u4e2a bit \u4f4d\u8fdb\u884c\u5199\u64cd\u4f5c\u65f6\uff0c\u8fd9\u4e2a bit \u4f4d\u4f1a\u88ab\u8bbe\u7f6e\u4e3a 1\u3002Bitmap \u8fd8\u63d0\u4f9b\u4e86 BITCOUNT \u64cd\u4f5c\uff0c\u7528\u6765\u7edf\u8ba1\u8fd9\u4e2a bit \u6570\u7ec4\u4e2d\u6240\u6709\u201c1\u201d\u7684\u4e2a\u6570\u3002 \u5047\u8bbe\u6211\u4eec\u8981\u7edf\u8ba1 ID 3000 \u7684\u7528\u6237\u5728 2020 \u5e74 8 \u6708\u4efd\u7684\u7b7e\u5230\u60c5\u51b5\uff0c\u5c31\u53ef\u4ee5\u6309\u7167\u4e0b\u9762\u7684\u6b65\u9aa4\u8fdb\u884c\u64cd\u4f5c\u3002 \u7b2c\u4e00\u6b65\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u8bb0\u5f55\u8be5\u7528\u6237 8 \u6708 3 \u53f7\u5df2\u7b7e\u5230\u3002 SETBIT uid:sign:3000:202008 2 1 setbit key offset value \u7b2c\u4e8c\u6b65\uff0c\u68c0\u67e5\u8be5\u7528\u6237 8 \u6708 3 \u65e5\u662f\u5426\u7b7e\u5230\u3002 GETBIT uid:sign:3000:202008 2 \u7b2c\u4e09\u6b65\uff0c\u7edf\u8ba1\u8be5\u7528\u6237\u5728 8 \u6708\u4efd\u7684\u7b7e\u5230\u6b21\u6570\u3002 BITCOUNT uid:sign:3000:202008 \u7b2c\u4e09\u6b65\uff0c\u7edf\u8ba1\u8be5\u7528\u6237\u5728 8 \u6708\u4efd\u7684\u7b7e\u5230\u6b21\u6570\u3002 BITCOUNT uid:sign:3000:202008 SADD \u6709\u4e00\u4e2a\u7528\u6237 user1 \u8bbf\u95ee page1 \u65f6\uff0c\u4f60\u628a\u8fd9\u4e2a\u4fe1\u606f\u52a0\u5230 Set \u4e2d\uff1a SADD page1:uv user1 \u5f53\u4f60\u9700\u8981\u7edf\u8ba1 UV \u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u7528 SCARD \u547d\u4ee4\uff0c\u8fd9\u4e2a\u547d\u4ee4\u4f1a\u8fd4\u56de\u4e00\u4e2a\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u4e2a\u6570\u3002 Hash => HSET \u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u628a\u7528\u6237 ID \u4f5c\u4e3a Hash \u96c6\u5408\u7684 key\uff0c\u5f53\u7528\u6237\u8bbf\u95ee\u9875\u9762\u65f6\uff0c\u5c31\u7528 HSET \u547d\u4ee4\uff08\u7528\u4e8e\u8bbe\u7f6e Hash \u96c6\u5408\u5143\u7d20\u7684\u503c\uff09\uff0c\u5bf9\u8fd9\u4e2a\u7528\u6237 ID \u8bb0\u5f55\u4e00\u4e2a\u503c\u201c1\u201d\uff0c\u8868\u793a\u4e00\u4e2a\u72ec\u7acb\u8bbf\u5ba2\uff0c\u7528\u6237 1 \u8bbf\u95ee page1 \u540e\uff0c\u6211\u4eec\u5c31\u8bb0\u5f55\u4e3a 1 \u4e2a\u72ec\u7acb\u8bbf\u5ba2\uff0c\u5982\u4e0b\u6240\u793a\uff1a HSET page1:uv user1 1 \u5373\u4f7f\u7528\u6237 1 \u591a\u6b21\u8bbf\u95ee\u9875\u9762\uff0c\u91cd\u590d\u6267\u884c\u8fd9\u4e2a HSET \u547d\u4ee4\uff0c\u4e5f\u53ea\u4f1a\u628a user1 \u7684\u503c\u8bbe\u7f6e\u4e3a 1\uff0c\u4ecd\u7136\u53ea\u8bb0\u4e3a 1 \u4e2a\u72ec\u7acb\u8bbf\u5ba2\u3002 \u5f53\u8981\u7edf\u8ba1 UV \u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 HLEN \u547d\u4ee4\u7edf\u8ba1 Hash \u96c6\u5408\u4e2d\u7684\u6240\u6709\u5143\u7d20\u4e2a\u6570\u3002 \u5728\u7edf\u8ba1 UV \u65f6\uff0c\u4f60\u53ef\u4ee5\u7528 PFADD \u547d\u4ee4\uff08\u7528\u4e8e\u5411 HyperLogLog \u4e2d\u6dfb\u52a0\u65b0\u5143\u7d20\uff09\u628a\u8bbf\u95ee\u9875\u9762\u7684\u6bcf\u4e2a\u7528\u6237\u90fd\u6dfb\u52a0\u5230 HyperLogLog \u4e2d\u3002 PFADD page1:uv user1 user2 user3 user4 user5 \u5c31\u53ef\u4ee5\u7528 PFCOUNT \u547d\u4ee4\u76f4\u63a5\u83b7\u5f97 page1 \u7684 UV \u503c\u4e86\uff0c\u8fd9\u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\u5c31\u662f\u8fd4\u56de HyperLogLog \u7684\u7edf\u8ba1\u7ed3\u679c\u3002 PFCOUNT page1:uv 1-3 GEO\uff0c\u4e00\u79cd\u53ef\u4ee5\u5b9e\u73b0LBS\u670d\u52a1\u7684\u6570\u636e\u7ed3\u6784 \u628a ID \u53f7\u4e3a 33 \u7684\u8f66\u8f86\u7684\u5f53\u524d\u7ecf\u7eac\u5ea6\u4f4d\u7f6e\u5b58\u5165 GEO \u96c6\u5408\u4e2d \uff1a GEOADD cars:locations 116.034579 39.030452 33 \u4f8b\u5982\uff0cLBS \u5e94\u7528\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0cRedis \u4f1a\u6839\u636e\u8f93\u5165\u7684\u7528\u6237\u7684\u7ecf\u7eac\u5ea6\u4fe1\u606f\uff08116.054579\uff0c39.030452 \uff09\uff0c \u67e5\u627e\u4ee5\u8fd9\u4e2a\u7ecf\u7eac\u5ea6\u4e3a\u4e2d\u5fc3\u7684 5 \u516c\u91cc\u5185\u7684\u8f66\u8f86\u4fe1\u606f\uff0c\u5e76\u8fd4\u56de\u7ed9 LBS \u5e94\u7528\u3002\u5f53\u7136\uff0c \u4f60\u53ef\u4ee5\u4fee\u6539\u201c5\u201d\u8fd9\u4e2a\u53c2\u6570\uff0c\u6765\u8fd4\u56de\u66f4\u5927\u6216\u66f4\u5c0f\u8303\u56f4\u5185\u7684\u8f66\u8f86\u4fe1\u606f\u3002 GEORADIUS cars:locations 116.054579 39.030452 5 km ASC COUNT 10 1-4 \u6839\u636e\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u7279\u70b9\uff0c\u9009\u62e9\u5408\u9002\u7684\u5b58\u50a8\u65b9\u6848 Hash \u7c7b\u578b\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217 \u4e3e\u4e2a\u4f8b\u5b50\u3002\u6211\u4eec\u7528 HGET \u547d\u4ee4\u67e5\u8be2 202008030905 \u8fd9\u4e2a\u65f6\u523b\u7684\u6e29\u5ea6\u503c\uff0c\u4f7f\u7528 HMGET \u67e5\u8be2 202008030905\u3001202008030907\u3001202008030908 \u8fd9\u4e09\u4e2a\u65f6\u523b\u7684\u6e29\u5ea6\u503c\uff0c\u5982\u4e0b\u6240\u793a\uff1a HGET device:temperature 202008030905 \"25.1\" HMGET device:temperature 202008030905 202008030907 202008030908 1) \"25.1\" 2) \"25.9\" 3) \"24.9\" Sorted Set \u6765\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217 \u4f7f\u7528 Sorted Set \u4fdd\u5b58\u6570\u636e\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528 ZRANGEBYSCORE \u547d\u4ee4\uff0c\u6309\u7167\u8f93\u5165\u7684\u6700\u5927\u65f6\u95f4\u6233\u548c\u6700\u5c0f\u65f6\u95f4\u6233\u6765\u67e5\u8be2\u8fd9\u4e2a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6e29\u5ea6\u503c\u4e86\u3002\u5982\u4e0b\u6240\u793a\uff0c\u6211\u4eec\u6765\u67e5\u8be2\u4e00\u4e0b\u5728 2020 \u5e74 8 \u6708 3 \u65e5 9 \u70b9 7 \u5206\u5230 9 \u70b9 10 \u5206\u95f4\u7684\u6240\u6709\u6e29\u5ea6\u503c\uff1a ZRANGEBYSCORE device:temperature 202008030907 202008030910 1) \"25.9\" 2) \"24.9\" 3) \"25.3\" 4) \"25.2\" \u539f\u5b50\u6027\u7684\u64cd\u4f5c MULTI & EXEC \u4ee5\u4fdd\u5b58\u8bbe\u5907\u72b6\u6001\u4fe1\u606f\u7684\u9700\u6c42\u4e3a\u4f8b\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u628a\u8bbe\u5907\u5728 2020 \u5e74 8 \u6708 3 \u65e5 9 \u65f6 5 \u5206\u7684\u6e29\u5ea6\uff0c \u5206\u522b\u7528 HSET \u547d\u4ee4\u548c ZADD \u547d\u4ee4\u5199\u5165 Hash \u96c6\u5408\u548c Sorted Set \u96c6\u5408 \u3002 127.0.0.1:6379> MULTI OK 127.0.0.1:6379> HSET device:temperature 202008030911 26.8 QUEUED 127.0.0.1:6379> ZADD device:temperature 202008030911 26.8 QUEUED 127.0.0.1:6379> EXEC 1) (integer) 1 2) (integer) 1 \u9996\u5148\uff0cRedis \u6536\u5230\u4e86\u5ba2\u6237\u7aef\u6267\u884c\u7684 MULTI \u547d\u4ee4\u3002 \u7136\u540e\uff0c\u5ba2\u6237\u7aef\u518d\u6267\u884c HSET \u548c ZADD \u547d\u4ee4\u540e\uff0c Redis \u8fd4\u56de\u7684\u7ed3\u679c\u4e3a \u201cQUEUED \u201d\uff0c\u8868\u793a\u8fd9\u4e24\u4e2a\u547d\u4ee4\u6682\u65f6\u5165\u961f\uff0c\u5148\u4e0d\u6267\u884c\uff1b \u6267\u884c\u4e86 EXEC \u547d\u4ee4\u540e\uff0c HSET \u547d\u4ee4\u548c ZADD \u547d\u4ee4\u624d\u771f\u6b63\u6267\u884c\uff0c\u5e76\u8fd4\u56de\u6210\u529f\u7ed3\u679c\uff08\u7ed3\u679c\u503c\u4e3a 1\uff09\u3002 \u5e8f\u5217\u6570\u636e \u56e0\u4e3a RedisTimeSeries \u4e0d\u5c5e\u4e8e Redis \u7684\u5185\u5efa\u529f\u80fd\u6a21\u5757\uff0c\u5728\u4f7f\u7528\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5148\u628a\u5b83\u7684\u6e90\u7801\u5355\u72ec\u7f16\u8bd1\u6210\u52a8\u6001\u94fe\u63a5\u5e93 redistimeseries.so \uff0c\u518d\u4f7f\u7528 loadmodule \u547d\u4ee4\u8fdb\u884c\u52a0\u8f7d\uff0c\u5982\u4e0b\u6240\u793a\uff1a loadmodule redistimeseries.so \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u521b\u5efa\u4e00\u4e2a key \u4e3a device:temperature \u3001\u6570\u636e\u6709\u6548\u671f\u4e3a 600s \u7684\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u96c6\u5408\u3002 TS.CREATE device:temperature RETENTION 600000 LABELS device_id 1 OK \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u5217 TS.ADD \u547d\u4ee4\u65f6\uff0c\u5c31\u5f80 device:temperature \u96c6\u5408\u4e2d\u63d2\u5165\u4e86\u4e00\u6761\u6570\u636e\uff0c\u8bb0\u5f55\u7684\u662f\u8bbe\u5907\u5728 2020 \u5e74 8 \u6708 3 \u65e5 9 \u65f6 5 \u5206\u7684\u8bbe\u5907\u6e29\u5ea6\uff1b \u518d\u6267\u884c TS.GET \u547d\u4ee4\u65f6\uff0c\u5c31\u4f1a\u628a\u521a\u521a\u63d2\u5165\u7684\u6700\u65b0\u6570\u636e\u8bfb\u53d6\u51fa\u6765 TS.ADD device:temperature 1596416700 25.1 1596416700 TS.GET device:temperature 25.1 \u4e3e\u4e2a\u4f8b\u5b50\u3002\u5047\u8bbe\u6211\u4eec\u4e00\u5171\u7528 4 \u4e2a\u96c6\u5408\u4e3a 4 \u4e2a\u8bbe\u5907\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u8bbe\u5907\u7684 ID \u53f7\u662f 1\u30012\u30013\u30014\uff0c\u6211\u4eec\u5728\u521b\u5efa\u6570\u636e\u96c6\u5408\u65f6\uff0c\u628a device_id \u8bbe\u7f6e\u4e3a\u6bcf\u4e2a\u96c6\u5408\u7684\u6807\u7b7e\u3002 \u6b64\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e0b\u5217 TS.MGET \u547d\u4ee4\uff0c\u4ee5\u53ca FILTER \u8bbe\u7f6e\uff08\u8fd9\u4e2a\u914d\u7f6e\u9879\u7528\u6765\u8bbe\u7f6e\u96c6\u5408\u6807\u7b7e\u7684\u8fc7\u6ee4\u6761\u4ef6\uff09\uff0c\u67e5\u8be2 device_id \u4e0d\u7b49\u4e8e 2 \u7684\u6240\u6709\u5176\u4ed6\u8bbe\u5907\u7684\u6570\u636e\u96c6\u5408\uff0c\u5e76\u8fd4\u56de\u5404\u81ea\u96c6\u5408\u4e2d\u7684\u6700\u65b0\u7684\u4e00\u6761\u6570\u636e\u3002 TS.MGET FILTER device_id!=2 1) 1) \"device:temperature:1\" 2) (empty list or set) 3) 1) (integer) 1596417000 2) \"25.3\" 2) 1) \"device:temperature:3\" 2) (empty list or set) 3) 1) (integer) 1596417000 2) \"29.5\" 3) 1) \"device:temperature:4\" 2) (empty list or set) 3) 1) (integer) 1596417000 2) \"30.1\" RedisTimeSeries \u652f\u6301\u7684\u805a\u5408\u8ba1\u7b97\u7c7b\u578b\u5f88\u4e30\u5bcc\uff0c\u5305\u62ec\u6c42\u5747\u503c\uff08avg\uff09\u3001\u6c42\u6700\u5927 / \u6700\u5c0f\u503c\uff08max/min\uff09\uff0c\u6c42\u548c\uff08sum\uff09\u7b49\u3002 \u4f8b\u5982\uff0c\u5728\u6267\u884c\u4e0b\u5217\u547d\u4ee4\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6309\u7167\u6bcf 180s \u7684\u65f6\u95f4\u7a97\u53e3\uff0c\u5bf9 2020 \u5e74 8 \u6708 3 \u65e5 9 \u65f6 5 \u5206\u548c 2020 \u5e74 8 \u6708 3 \u65e5 9 \u65f6 12 \u5206\u8fd9\u6bb5\u65f6\u95f4\u5185\u7684\u6570\u636e\u8fdb\u884c\u5747\u503c\u8ba1\u7b97\u4e86\u3002 TS.RANGE device:temperature 1596416700 1596417120 AGGREGATION avg 180000 1) 1) (integer) 1596416700 2) \"25.6\" 2) 1) (integer) 1596416880 2) \"25.8\" 3) 1) (integer) 1596417060 2) \"26.1\" 1-5 \u5982\u4f55\u4f7f\u7528redis\u5b9e\u73b0\u6d88\u606f\u961f\u5217\u7684\u9700\u6c42 List \u672c\u8eab\u662f\u4e0d\u4f1a\u4e3a\u6bcf\u4e2a\u6d88\u606f\u751f\u6210 ID \u53f7\u7684\uff0c\u6240\u4ee5\uff0c\u6d88\u606f\u7684\u5168\u5c40\u552f\u4e00 ID \u53f7\u5c31\u9700\u8981\u751f\u4ea7\u8005\u7a0b\u5e8f\u5728\u53d1\u9001\u6d88\u606f\u524d\u81ea\u884c\u751f\u6210\u3002\u751f\u6210\u4e4b\u540e\uff0c\u6211\u4eec\u5728\u7528 LPUSH \u547d\u4ee4\u628a\u6d88\u606f\u63d2\u5165 List \u65f6\uff0c\u9700\u8981\u5728\u6d88\u606f\u4e2d\u5305\u542b\u8fd9\u4e2a\u5168\u5c40\u552f\u4e00 ID\u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5c31\u628a\u4e00\u6761\u5168\u5c40 ID \u4e3a 101030001 \u3001\u5e93\u5b58\u91cf\u4e3a 5 \u7684\u6d88\u606f\u63d2\u5165\u4e86\u6d88\u606f\u961f\u5217\uff1a LPUSH mq \"101030001:stock:5\" (integer) 1 \u57fa\u4e8e Streams \u7684\u6d88\u606f\u961f\u5217\u89e3\u51b3\u65b9\u6848 XADD\uff1a\u63d2\u5165\u6d88\u606f\uff0c\u4fdd\u8bc1\u6709\u5e8f\uff0c\u53ef\u4ee5\u81ea\u52a8\u751f\u6210\u5168\u5c40\u552f\u4e00 ID\uff1b XREAD\uff1a\u7528\u4e8e\u8bfb\u53d6\u6d88\u606f\uff0c\u53ef\u4ee5\u6309 ID \u8bfb\u53d6\u6570\u636e\uff1b XREADGROUP\uff1a\u6309\u6d88\u8d39\u7ec4\u5f62\u5f0f\u8bfb\u53d6\u6d88\u606f\uff1b XPENDING \u548c XACK\uff1aXPENDING \u547d\u4ee4\u53ef\u4ee5\u7528\u6765\u67e5\u8be2\u6bcf\u4e2a\u6d88\u8d39\u7ec4\u5185\u6240\u6709\u6d88\u8d39\u8005\u5df2\u8bfb\u53d6\u4f46\u5c1a\u672a\u786e\u8ba4\u7684\u6d88\u606f\uff0c\u800c XACK \u547d\u4ee4\u7528\u4e8e\u5411\u6d88\u606f\u961f\u5217\u786e\u8ba4\u6d88\u606f\u5904\u7406\u5df2\u5b8c\u6210\u3002 \u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u5f80\u540d\u79f0\u4e3a mqstream \u7684\u6d88\u606f\u961f\u5217\u4e2d\u63d2\u5165\u4e00\u6761\u6d88\u606f\uff0c\u6d88\u606f\u7684\u952e\u662f repo \uff0c\u503c\u662f 5 \u3002 \u5176\u4e2d\uff0c\u6d88\u606f\u961f\u5217\u540d\u79f0\u540e\u9762\u7684 * \uff0c\u8868\u793a\u8ba9 Redis \u4e3a\u63d2\u5165\u7684\u6570\u636e\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u7684 ID\uff0c\u4f8b\u5982 \u201c1599203861727-0\u201d \u3002 \u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4e0d\u7528 * \uff0c\u76f4\u63a5\u5728\u6d88\u606f\u961f\u5217\u540d\u79f0\u540e\u81ea\u884c\u8bbe\u5b9a\u4e00\u4e2a ID \u53f7\uff0c\u53ea\u8981\u4fdd\u8bc1\u8fd9\u4e2a ID \u53f7\u662f\u5168\u5c40\u552f\u4e00\u7684\u5c31\u884c\u3002\u4e0d\u8fc7\uff0c\u76f8\u6bd4\u81ea\u884c\u8bbe\u5b9a ID \u53f7\uff0c\u4f7f\u7528 * \u4f1a\u66f4\u52a0\u65b9\u4fbf\u9ad8\u6548\u3002 XADD mqstream * repo 5 \"1599203861727-0\" \u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u4ece ID \u53f7\u4e3a 1599203861727-0 \u7684\u6d88\u606f\u5f00\u59cb\uff0c\u8bfb\u53d6\u540e\u7eed\u7684\u6240\u6709\u6d88\u606f\uff08\u793a\u4f8b\u4e2d\u4e00\u5171 3 \u6761\uff09\u3002 XREAD BLOCK 100 STREAMS mqstream 1599203861727-0 1) 1) \"mqstream\" 2) 1) 1) \"1599274912765-0\" 2) 1) \"repo\" 2) \"3\" 2) 1) \"1599274925823-0\" 2) 1) \"repo\" 2) \"2\" 3) 1) \"1599274927910-0\" 2) 1) \"repo\" 2) \"1\" \u53e6\u5916\uff0c\u6d88\u8d39\u8005\u4e5f\u53ef\u4ee5\u5728\u8c03\u7528 XRAED \u65f6\u8bbe\u5b9a block \u914d\u7f6e\u9879\uff0c\u5b9e\u73b0\u7c7b\u4f3c\u4e8e BRPOP \u7684\u963b\u585e\u8bfb\u53d6\u64cd\u4f5c\u3002 \u5f53\u6d88\u606f\u961f\u5217\u4e2d\u6ca1\u6709\u6d88\u606f\u65f6\uff0c \u4e00\u65e6\u8bbe\u7f6e\u4e86 block \u914d\u7f6e\u9879\uff0cXREAD \u5c31\u4f1a\u963b\u585e\uff0c\u963b\u585e\u7684\u65f6\u957f\u53ef\u4ee5\u5728 block \u914d\u7f6e\u9879\u8fdb\u884c\u8bbe\u7f6e\u3002 XREAD block 10000 streams mqstream $ (nil) (10.00s) \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a group1 \u7684\u6d88\u8d39\u7ec4\uff0c\u8fd9\u4e2a\u6d88\u8d39\u7ec4\u6d88\u8d39\u7684\u6d88\u606f\u961f\u5217\u662f mqstream\u3002 XGROUP create mqstream group1 0 OK \u7136\u540e\uff0c\u6211\u4eec\u518d\u6267\u884c\u4e00\u6bb5\u547d\u4ee4\uff0c \u8ba9 group1 \u6d88\u8d39\u7ec4\u91cc\u7684\u6d88\u8d39\u8005 consumer1 \u4ece mqstream \u4e2d\u8bfb\u53d6\u6240\u6709\u6d88\u606f\uff0c\u5176\u4e2d\uff0c\u547d\u4ee4\u6700\u540e\u7684\u53c2\u6570 \u201c>\u201d \uff0c\u8868\u793a\u4ece\u7b2c\u4e00\u6761\u5c1a\u672a\u88ab\u6d88\u8d39\u7684\u6d88\u606f\u5f00\u59cb\u8bfb\u53d6\u3002 \u56e0\u4e3a\u5728 consumer1 \u8bfb\u53d6\u6d88\u606f\u524d\uff0c group1 \u4e2d\u6ca1\u6709\u5176\u4ed6\u6d88\u8d39\u8005\u8bfb\u53d6\u8fc7\u6d88\u606f\uff0c\u6240\u4ee5\uff0c consumer1 \u5c31\u5f97\u5230 mqstream \u6d88\u606f\u961f\u5217\u4e2d\u7684\u6240\u6709\u6d88\u606f\u4e86\uff08\u4e00\u5171 4 \u6761\uff09\u3002 XREADGROUP group group1 consumer1 streams mqstream > 1) 1) \"mqstream\" 2) 1) 1) \"1599203861727-0\" 2) 1) \"repo\" 2) \"5\" 2) 1) \"1599274912765-0\" 2) 1) \"repo\" 2) \"3\" 3) 1) \"1599274925823-0\" 2) 1) \"repo\" 2) \"2\" 4) 1) \"1599274927910-0\" 2) 1) \"repo\" 2) \"1\" \u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u6267\u884c\u5b8c\u521a\u624d\u7684 XREADGROUP \u547d\u4ee4\u540e\uff0c\u518d\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c \u8ba9 group1 \u5185\u7684 consumer2 \u8bfb\u53d6\u6d88\u606f\u65f6\uff0c consumer2 \u8bfb\u5230\u7684\u5c31\u662f\u7a7a\u503c\uff0c\u56e0\u4e3a\u6d88\u606f\u5df2\u7ecf\u88ab consumer1 \u8bfb\u53d6\u5b8c\u4e86 \uff0c\u5982\u4e0b\u6240\u793a\uff1a XREADGROUP group group1 consumer2 streams mqstream 0 1) 1) \"mqstream\" 2) (empty list or set) \u4f7f\u7528\u6d88\u8d39\u7ec4\u7684\u76ee\u7684\u662f\u8ba9\u7ec4\u5185\u7684\u591a\u4e2a\u6d88\u8d39\u8005\u5171\u540c\u5206\u62c5\u8bfb\u53d6\u6d88\u606f\uff0c \u6240\u4ee5\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u8ba9\u6bcf\u4e2a\u6d88\u8d39\u8005\u8bfb\u53d6\u90e8\u5206\u6d88\u606f\uff0c\u4ece\u800c\u5b9e\u73b0\u6d88\u606f\u8bfb\u53d6\u8d1f\u8f7d\u5728\u591a\u4e2a\u6d88\u8d39\u8005\u95f4\u662f\u5747\u8861\u5206\u5e03\u7684\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u8ba9 group2 \u4e2d\u7684 consumer1\u30012\u30013 \u5404\u81ea\u8bfb\u53d6\u4e00\u6761\u6d88\u606f\u3002 XREADGROUP group group2 consumer1 count 1 streams mqstream > 1) 1) \"mqstream\" 2) 1) 1) \"1599203861727-0\" 2) 1) \"repo\" 2) \"5\" XREADGROUP group group2 consumer2 count 1 streams mqstream > 1) 1) \"mqstream\" 2) 1) 1) \"1599274912765-0\" 2) 1) \"repo\" 2) \"3\" XREADGROUP group group2 consumer3 count 1 streams mqstream > 1) 1) \"mqstream\" 2) 1) 1) \"1599274925823-0\" 2) 1) \"repo\" 2) \"2\" \u5982\u679c\u6d88\u8d39\u8005\u6ca1\u6709\u6210\u529f\u5904\u7406\u6d88\u606f\uff0c\u5b83\u5c31\u4e0d\u4f1a\u7ed9 Streams \u53d1\u9001 XACK \u547d\u4ee4\uff0c\u6d88\u606f\u4ecd\u7136\u4f1a\u7559\u5b58\u3002\u6b64\u65f6\uff0c\u6d88\u8d39\u8005\u53ef\u4ee5\u5728\u91cd\u542f\u540e\uff0c\u7528 XPENDING \u547d\u4ee4\u67e5\u770b\u5df2\u8bfb\u53d6\u3001\u4f46\u5c1a\u672a\u786e\u8ba4\u5904\u7406\u5b8c\u6210\u7684\u6d88\u606f\u3002 XPENDING mqstream group2 1) (integer) 3 2) \"1599203861727-0\" 3) \"1599274925823-0\" 4) 1) 1) \"consumer1\" 2) \"1\" 2) 1) \"consumer2\" 2) \"1\" 3) 1) \"consumer3\" 2) \"1\" \u5982\u679c\u6211\u4eec\u8fd8\u9700\u8981\u8fdb\u4e00\u6b65\u67e5\u770b\u67d0\u4e2a\u6d88\u8d39\u8005\u5177\u4f53\u8bfb\u53d6\u4e86\u54ea\u4e9b\u6570\u636e\uff0c\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff1a XPENDING mqstream group2 - + 10 consumer2 1) 1) \"1599274912765-0\" 2) \"consumer2\" 3) (integer) 513336 4) (integer) 1 \u4e00\u65e6\u6d88\u606f 1599274912765-0 \u88ab consumer2 \u5904\u7406\u4e86\uff0c consumer2 \u5c31\u53ef\u4ee5\u4f7f\u7528 XACK \u547d\u4ee4\u901a\u77e5 Streams \uff0c\u7136\u540e\u8fd9\u6761\u6d88\u606f\u5c31\u4f1a\u88ab\u5220\u9664\u3002\u5f53\u6211\u4eec\u518d\u4f7f\u7528 XPENDING \u547d\u4ee4\u67e5\u770b\u65f6\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\uff0c consumer2 \u5df2\u7ecf\u6ca1\u6709\u5df2\u8bfb\u53d6\u3001\u4f46\u5c1a\u672a\u786e\u8ba4\u5904\u7406\u7684\u6d88\u606f\u4e86\u3002 XACK mqstream group2 1599274912765-0 (integer) 1 XPENDING mqstream group2 - + 10 consumer2 (empty list or set) 3\u3001\u7ae0\u8282\u5c0f\u95ee 1-1 \u95ee\u9898\uff1a\u9664\u4e86 String \u7c7b\u578b\u548c Hash \u7c7b\u578b\uff0c\u8fd8\u6709\u4ec0\u4e48\u7c7b\u578b\u9002\u5408\u4fdd\u5b58\u56fe\u7247\u5417\uff1f \u7b54\u6848\uff1a\u9664\u4e86 String \u548c Hash\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4f7f\u7528 Sorted Set \u7c7b\u578b\u8fdb\u884c\u4fdd\u5b58\u3002Sorted Set \u7684\u5143\u7d20\u6709 member \u503c\u548c score \u503c\uff0c\u53ef\u4ee5\u50cf Hash \u90a3\u6837\uff0c\u4f7f\u7528\u4e8c\u7ea7\u7f16\u7801\u8fdb\u884c\u4fdd\u5b58\u3002\u5177\u4f53\u505a\u6cd5\u662f\uff0c\u628a\u56fe\u7247 ID \u7684\u524d 7 \u4f4d\u4f5c\u4e3a Sorted Set \u7684 key\uff0c\u628a\u56fe\u7247 ID \u7684\u540e 3 \u4f4d\u4f5c\u4e3a member \u503c\uff0c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID \u4f5c\u4e3a score \u503c\u3002 Sorted Set \u4e2d\u5143\u7d20\u8f83\u5c11\u65f6\uff0cRedis \u4f1a\u4f7f\u7528\u538b\u7f29\u5217\u8868\u8fdb\u884c\u5b58\u50a8\uff0c\u53ef\u4ee5\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u3002\u4e0d\u8fc7\uff0c\u548c Hash \u4e0d\u4e00\u6837\uff0cSorted Set \u63d2\u5165\u6570\u636e\u65f6\uff0c\u9700\u8981\u6309 score \u503c\u7684\u5927\u5c0f\u6392\u5e8f\u3002\u5f53\u5e95\u5c42\u7ed3\u6784\u662f\u538b\u7f29\u5217\u8868\u65f6\uff0cSorted Set \u7684\u63d2\u5165\u6027\u80fd\u5c31\u6bd4\u4e0d\u4e0a Hash\u3002\u6240\u4ee5\uff0c\u5728\u6211\u4eec\u8fd9\u8282\u8bfe\u63cf\u8ff0\u7684\u573a\u666f\u4e2d\uff0cSorted Set \u7c7b\u578b\u867d\u7136\u53ef\u4ee5\u7528\u6765\u4fdd\u5b58\uff0c\u4f46\u5e76\u4e0d\u662f\u6700\u4f18\u9009\u9879\u3002 1-2 4 \u79cd\u5178\u578b\u7684\u7edf\u8ba1\u6a21\u5f0f\uff0c\u5206\u522b\u662f\u805a\u5408\u7edf\u8ba1\u3001\u6392\u5e8f\u7edf\u8ba1\u3001\u4e8c\u503c\u72b6\u6001\u7edf\u8ba1\u548c\u57fa\u6570\u7edf\u8ba1\uff0c\u4ee5\u53ca\u5b83\u4eec\u5404\u81ea\u9002\u5408\u7684\u96c6\u5408\u7c7b\u578b\u3002\u4f60\u8fd8\u9047\u5230\u8fc7\u5176\u4ed6\u7684\u7edf\u8ba1\u573a\u666f\u5417\uff1f\u7528\u7684\u662f\u4ec0\u4e48\u96c6\u5408\u7c7b\u578b\u5462\uff1f \u4f7f\u7528 List+Lua \u7edf\u8ba1\u6700\u8fd1 200 \u4e2a\u5ba2\u6237\u7684\u89e6\u8fbe\u7387\u3002\u5177\u4f53\u505a\u6cd5\u662f\uff0c\u6bcf\u4e2a List \u5143\u7d20\u8868\u793a\u4e00\u4e2a\u5ba2\u6237\uff0c\u5143\u7d20\u503c\u4e3a 0\uff0c\u4ee3\u8868\u89e6\u8fbe\uff1b\u5143\u7d20\u503c\u4e3a 1\uff0c\u5c31\u4ee3\u8868\u672a\u89e6\u8fbe\u3002\u5728\u8fdb\u884c\u7edf\u8ba1\u65f6\uff0c\u5e94\u7528\u7a0b\u5e8f\u4f1a\u628a\u4ee3\u8868\u5ba2\u6237\u7684\u5143\u7d20\u5199\u5165\u961f\u5217\u4e2d\u3002\u5f53\u9700\u8981\u7edf\u8ba1\u89e6\u8fbe\u7387\u65f6\uff0c\u5c31\u4f7f\u7528 LRANGE key 0 -1 \u53d6\u51fa\u5168\u90e8\u5143\u7d20\uff0c\u8ba1\u7b97 0 \u7684\u6bd4\u4f8b\uff0c\u8fd9\u4e2a\u6bd4\u4f8b\u5c31\u662f\u89e6\u8fbe\u7387\u3002 \u8fd9\u4e2a\u4f8b\u5b50\u9700\u8981\u83b7\u53d6\u5168\u90e8\u5143\u7d20\uff0c\u4e0d\u8fc7\u6570\u636e\u91cf\u53ea\u6709 200 \u4e2a\uff0c\u4e0d\u7b97\u5927\uff0c\u6240\u4ee5\uff0c\u4f7f\u7528 List\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\u4e5f\u662f\u53ef\u4ee5\u63a5\u53d7\u7684\u3002\u4f46\u662f\uff0c\u5982\u679c\u6570\u636e\u91cf\u5f88\u5927\uff0c\u53c8\u6709\u5176\u4ed6\u67e5\u8be2\u9700\u6c42\u7684\u8bdd\uff08\u4f8b\u5982\u67e5\u8be2\u5355\u4e2a\u5143\u7d20\u7684\u89e6\u8fbe\u60c5\u51b5\uff09\uff0cList \u7684\u64cd\u4f5c\u590d\u6742\u5ea6\u8f83\u9ad8\uff0c\u5c31\u4e0d\u5408\u9002\u4e86\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 Hash \u7c7b\u578b\u3002 1-3 \u4f60\u5728\u65e5\u5e38\u7684\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\uff0c\u8fd8\u7528\u8fc7 Redis \u7684\u5176\u4ed6\u6570\u636e\u7c7b\u578b\u5417\uff1f 5 \u5927\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff0c\u4ee5\u53ca HyperLogLog\u3001Bitmap\u3001GEO\uff0cRedis \u8fd8\u6709\u4e00\u79cd\u6570\u636e\u7c7b\u578b\uff0c \u53eb\u4f5c\u5e03\u9686\u8fc7\u6ee4\u5668\u3002\u5b83\u7684\u67e5\u8be2\u6548\u7387\u5f88\u9ad8\uff0c\u7ecf\u5e38\u4f1a\u7528\u5728\u7f13\u5b58\u573a\u666f\u4e2d\uff0c\u53ef\u4ee5\u7528\u6765\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728\u7f13\u5b58\u4e2d \u3002 1-4 \u5728\u7528 Sorted Set \u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u65f6\uff0c\u5982\u679c\u628a\u65f6\u95f4\u6233\u4f5c\u4e3a score\uff0c\u628a\u5b9e\u9645\u7684\u6570\u636e\u4f5c\u4e3a member\uff0c\u8fd9\u6837\u4fdd\u5b58\u6570\u636e\u6709\u6ca1\u6709\u6f5c\u5728\u7684\u98ce\u9669\uff1f\u53e6\u5916\uff0c\u5982\u679c\u4f60\u662f Redis \u7684\u5f00\u53d1\u7ef4\u62a4\u8005\uff0c\u4f60\u4f1a\u628a\u805a\u5408\u8ba1\u7b97\u4e5f\u8bbe\u8ba1\u4e3a Sorted Set \u7684\u4e00\u4e2a\u5185\u5728\u529f\u80fd\u5417\uff1f \u7b54\u6848\uff1aSorted Set \u548c Set \u4e00\u6837\uff0c\u90fd\u4f1a\u5bf9\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u8fdb\u884c\u53bb\u91cd\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u5f80\u96c6\u5408\u4e2d\u63d2\u5165\u7684 member \u503c\uff0c\u548c\u4e4b\u524d\u5df2\u7ecf\u5b58\u5728\u7684 member \u503c\u4e00\u6837\uff0c\u90a3\u4e48\uff0c\u539f\u6765 member \u7684 score \u5c31\u4f1a\u88ab\u65b0\u5199\u5165\u7684 member \u7684 score \u8986\u76d6\u3002\u76f8\u540c member \u7684\u503c\uff0c\u5728 Sorted Set \u4e2d\u53ea\u4f1a\u4fdd\u7559\u4e00\u4e2a\u3002 \u5bf9\u4e8e\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u6765\u8bf4\uff0c\u8fd9\u79cd\u53bb\u91cd\u7684\u7279\u6027\u662f\u4f1a\u5e26\u6765\u6570\u636e\u4e22\u5931\u98ce\u9669\u7684\u3002\u6bd5\u7adf\uff0c\u67d0\u4e00\u65f6\u95f4\u6bb5\u5185\u7684\u591a\u4e2a\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u503c\u53ef\u80fd\u662f\u76f8\u540c\u7684\u3002\u5982\u679c\u6211\u4eec\u5f80 Sorted Set \u4e2d\u5199\u5165\u7684\u6570\u636e\u662f\u5728\u4e0d\u540c\u65f6\u523b\u4ea7\u751f\u7684\uff0c\u4f46\u662f\u5199\u5165\u7684\u65f6\u523b\u4e0d\u540c\uff0cSorted Set \u4e2d\u53ea\u4f1a\u4fdd\u5b58\u4e00\u4efd\u6700\u8fd1\u65f6\u523b\u7684\u6570\u636e\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5176\u4ed6\u65f6\u523b\u7684\u6570\u636e\u5c31\u90fd\u6ca1\u6709\u4fdd\u5b58\u4e0b\u6765\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5728\u8bb0\u5f55\u7269\u8054\u7f51\u8bbe\u5907\u7684\u6e29\u5ea6\u65f6\uff0c\u4e00\u4e2a\u8bbe\u5907\u4e00\u4e2a\u4e0a\u5348\u7684\u6e29\u5ea6\u503c\u53ef\u80fd\u90fd\u662f 26\u3002\u5728 Sorted Set \u4e2d\uff0c\u6211\u4eec\u628a\u6e29\u5ea6\u503c\u4f5c\u4e3a member\uff0c\u628a\u65f6\u95f4\u6233\u4f5c\u4e3a score\u3002\u6211\u4eec\u7528 ZADD \u547d\u4ee4\u628a\u4e0a\u5348\u4e0d\u540c\u65f6\u523b\u7684\u6e29\u5ea6\u503c\u5199\u5165 Sorted Set\u3002\u7531\u4e8e member \u503c\u4e00\u6837\uff0c\u6240\u4ee5\u53ea\u4f1a\u628a score \u66f4\u65b0\u4e3a\u6700\u65b0\u65f6\u95f4\u6233\uff0c\u6700\u540e\u53ea\u6709\u4e00\u4e2a\u6700\u65b0\u65f6\u95f4\u6233\uff08\u4f8b\u5982\u4e0a\u5348 12 \u70b9\uff09\u4e0b\u7684\u6e29\u5ea6\u503c\u3002\u8fd9\u80af\u5b9a\u662f\u65e0\u6cd5\u6ee1\u8db3\u4fdd\u5b58\u591a\u4e2a\u65f6\u523b\u6570\u636e\u7684\u9700\u6c42\u7684\u3002 \u5173\u4e8e\u662f\u5426\u628a\u805a\u5408\u8ba1\u7b97\u4f5c\u4e3a Sorted Set \u7684\u5185\u5728\u529f\u80fd\uff0c\u8003\u8651\u5230 Redis \u7684\u8bfb\u5199\u529f\u80fd\u662f\u7531\u5355\u7ebf\u7a0b\u6267\u884c\uff0c\u5728\u8fdb\u884c\u6570\u636e\u8bfb\u5199\u65f6\uff0c\u672c\u8eab\u5c31\u4f1a\u6d88\u8017\u8f83\u591a\u7684 CPU \u8d44\u6e90\uff0c\u5982\u679c\u518d\u5728 Sorted Set \u4e2d\u5b9e\u73b0\u805a\u5408\u8ba1\u7b97\uff0c\u5c31\u4f1a\u8fdb\u4e00\u6b65\u589e\u52a0 CPU \u7684\u8d44\u6e90\u6d88\u8017\uff0c\u5f71\u54cd\u5230 Redis \u7684\u6b63\u5e38\u6570\u636e\u8bfb\u53d6\u3002\u6240\u4ee5\uff0c\u5982\u679c\u6211\u662f Redis \u7684\u5f00\u53d1\u7ef4\u62a4\u8005\uff0c\u9664\u975e\u5bf9 Redis \u7684\u7ebf\u7a0b\u6a21\u578b\u505a\u4fee\u6539\uff0c\u6bd4\u5982\u8bf4\u5728 Redis \u4e2d\u4f7f\u7528\u989d\u5916\u7684\u7ebf\u7a0b\u6c60\u505a\u805a\u5408\u8ba1\u7b97\uff0c\u5426\u5219\uff0c\u6211\u4e0d\u4f1a\u628a\u805a\u5408\u8ba1\u7b97\u4f5c\u4e3a Redis \u7684\u5185\u5728\u529f\u80fd\u5b9e\u73b0\u7684\u3002 1-5 \u5982\u679c\u4e00\u4e2a\u751f\u4ea7\u8005\u53d1\u9001\u7ed9\u6d88\u606f\u961f\u5217\u7684\u6d88\u606f\uff0c\u9700\u8981\u88ab\u591a\u4e2a\u6d88\u8d39\u8005\u8fdb\u884c\u8bfb\u53d6\u548c\u5904\u7406\uff08\u4f8b\u5982\uff0c\u4e00\u4e2a\u6d88\u606f\u662f\u4e00\u6761\u4ece\u4e1a\u52a1\u7cfb\u7edf\u91c7\u96c6\u7684\u6570\u636e\uff0c\u65e2\u8981\u88ab\u6d88\u8d39\u8005 1 \u8bfb\u53d6\u5e76\u8fdb\u884c\u5b9e\u65f6\u8ba1\u7b97\uff0c\u4e5f\u8981\u88ab\u6d88\u8d39\u8005 2 \u8bfb\u53d6\u5e76\u7559\u5b58\u5230\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf HDFS \u4e2d\uff0c\u4ee5\u4fbf\u540e\u7eed\u8fdb\u884c\u5386\u53f2\u67e5\u8be2\uff09\uff0c\u4f60\u4f1a\u4f7f\u7528 Redis \u7684\u4ec0\u4e48\u6570\u636e\u7c7b\u578b\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f \u53ef\u4ee5\u4f7f\u7528 Streams \u6570\u636e\u7c7b\u578b\u7684\u6d88\u8d39\u7ec4\uff0c\u540c\u65f6\u6d88\u8d39\u751f\u4ea7\u8005\u7684\u6570\u636e\uff0c\u8fd9\u662f\u53ef\u4ee5\u7684\u3002\u4f46\u662f\uff0c\u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\uff0c\u5982\u679c\u53ea\u662f\u4f7f\u7528\u4e00\u4e2a\u6d88\u8d39\u7ec4\u7684\u8bdd\uff0c\u6d88\u8d39\u7ec4\u5185\u7684\u591a\u4e2a\u6d88\u8d39\u8005\u5728\u6d88\u8d39\u6d88\u606f\u65f6\u662f\u4e92\u65a5\u7684\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u5728\u4e00\u4e2a\u6d88\u8d39\u7ec4\u5185\uff0c\u4e00\u4e2a\u6d88\u606f\u53ea\u80fd\u88ab\u4e00\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\u3002\u6211\u4eec\u5e0c\u671b\u6d88\u606f\u65e2\u8981\u88ab\u6d88\u8d39\u8005 1 \u8bfb\u53d6\uff0c\u4e5f\u8981\u88ab\u6d88\u8d39\u8005 2 \u8bfb\u53d6\uff0c\u662f\u4e00\u4e2a\u591a\u6d88\u8d39\u8005\u7684\u9700\u6c42\u3002\u6240\u4ee5\uff0c\u5982\u679c\u4f7f\u7528\u6d88\u8d39\u7ec4\u6a21\u5f0f\uff0c\u9700\u8981\u8ba9\u6d88\u8d39\u8005 1 \u548c\u6d88\u8d39\u8005 2 \u5c5e\u4e8e\u4e0d\u540c\u7684\u6d88\u8d39\u7ec4\uff0c\u8fd9\u6837\u5b83\u4eec\u5c31\u80fd\u540c\u65f6\u6d88\u8d39\u4e86\u3002 \u53e6\u5916\uff0cRedis \u57fa\u4e8e\u5b57\u5178\u548c\u94fe\u8868\u6570\u636e\u7ed3\u6784\uff0c\u5b9e\u73b0\u4e86\u53d1\u5e03\u548c\u8ba2\u9605\u529f\u80fd\uff0c\u8fd9\u4e2a\u529f\u80fd\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u6d88\u606f\u88ab\u591a\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\u4f7f\u7528\uff0c\u53ef\u4ee5\u6ee1\u8db3\u95ee\u9898\u4e2d\u7684\u573a\u666f\u9700\u6c42\u3002","title":"\u7b2c\u4e09\u7ae0 Redis \u7684\u6570\u636e\u7ed3\u6784"},{"location":"chap3/6redis_ds_sum/#redis","text":"","title":"\u7b2c\u4e09\u7ae0 Redis \u7684\u6570\u636e\u7ed3\u6784"},{"location":"chap3/6redis_ds_sum/#1","text":"","title":"1\u3001\u7ae0\u8282\u5c0f\u7ed3"},{"location":"chap3/6redis_ds_sum/#1-1-redisstring","text":"String \u5728\u4fdd\u5b58\u7684\u952e\u503c\u5bf9\u672c\u8eab\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u4e0d\u5927\u65f6\uff0cString \u7c7b\u578b\u7684\u5143\u6570\u636e\u5f00\u9500\u5c31\u5360\u636e\u4e3b\u5bfc\u4e86\uff0c \u8fd9\u91cc\u9762\u5305\u62ec\u4e86 RedisObject \u7ed3\u6784\u3001SDS \u7ed3\u6784\u3001dictEntry \u7ed3\u6784\u7684\u5185\u5b58\u5f00\u9500 \u3002 \u4f7f\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u6570\u636e\u3002\u5f53\u7136\uff0c\u4f7f\u7528 Hash \u8fd9\u79cd\u96c6\u5408\u7c7b\u578b\u4fdd\u5b58\u5355\u503c\u952e\u503c\u5bf9\u7684\u6570\u636e\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5c06\u5355\u503c\u6570\u636e\u62c6\u5206\u6210\u4e24\u90e8\u5206\uff0c\u5206\u522b\u4f5c\u4e3a Hash \u96c6\u5408\u7684\u952e\u548c\u503c\uff0c\u5c31\u50cf\u521a\u624d\u6848\u4f8b\u4e2d\u7528\u4e8c\u7ea7\u7f16\u7801\u6765\u8868\u793a\u56fe\u7247 ID \u5982\u679c\u4f60\u60f3\u77e5\u9053\u952e\u503c\u5bf9\u91c7\u7528\u4e0d\u540c\u7c7b\u578b\u4fdd\u5b58\u65f6\u7684\u5185\u5b58\u5f00\u9500\uff0c\u53ef\u4ee5\u5728 \u8fd9\u4e2a\u7f51\u5740 \u91cc\u8f93\u5165\u4f60\u7684\u952e\u503c\u5bf9\u957f\u5ea6\u548c\u4f7f\u7528\u7684\u6570\u636e\u7c7b\u578b\uff0c\u8fd9\u6837\u5c31\u80fd\u77e5\u9053\u5b9e\u9645\u6d88\u8017\u7684\u5185\u5b58\u5927\u5c0f\u4e86 Redis\u7684String\u7c7b\u578b\u6570\u636e\u7ed3\u6784\uff0c\u53ca\u5176\u5e95\u5c42\u5b9e\u73b0 Redis\u7684String\u7c7b\u578b\u6570\u636e\u7ed3\u6784\uff0c\u53ca\u5176\u5e95\u5c42\u5b9e\u73b0 \u53ef\u4ee5\u5de7\u5999\u7684\u5229\u7528Redis\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u7279\u6027\uff0c\u964d\u4f4e\u8d44\u6e90\u6d88\u8017 Simple Dynamic String\u7ed3\u6784 buf \uff1a\u5b57\u8282\u6570\u7ec4\uff0c\u4fdd\u5b58\u5b9e\u9645\u6570\u636e\u3002\u4e3a\u4e86\u8868\u793a\u5b57\u8282\u6570\u7ec4\u7684\u7ed3\u675f\uff0cRedis \u4f1a\u81ea\u52a8\u5728\u6570\u7ec4\u6700\u540e\u52a0\u4e00\u4e2a \u201c\\0\u201d \uff0c\u8fd9\u5c31\u4f1a\u989d\u5916\u5360\u7528 1 \u4e2a\u5b57\u8282\u7684\u5f00\u9500\u3002 len\uff1a\u5360 4 \u4e2a\u5b57\u8282\uff0c \u8868\u793a buf \u7684\u5df2\u7528\u957f\u5ea6 \u3002 alloc\uff1a\u4e5f\u5360\u4e2a 4 \u5b57\u8282\uff0c \u8868\u793a buf \u7684\u5b9e\u9645\u5206\u914d\u957f\u5ea6\uff0c\u4e00\u822c\u5927\u4e8e len\u3002 dicEntry \u7ed3\u6784\u4f53 key\uff1a8\u4e2a\u5b57\u8282\u6307\u9488\uff0c\u6307\u5411key value\uff1a8\u4e2a\u5b57\u8282\u6307\u9488\uff0c\u6307\u5411value next\uff1a\u6307\u5411\u4e0b\u4e00\u4e2adicEntry ziplist(\u538b\u7f29\u5217\u8868)\uff08 zlbytes\uff1a\u5728\u8868\u5934\uff0c\u8868\u793a\u5217\u8868\u957f\u5ea6 zltail\uff1a\u5728\u8868\u5934\uff0c\u8868\u793a\u5217\u5c3e\u504f\u79fb\u91cf zllen\uff1a\u5728\u8868\u5934\uff0c\u8868\u793a\u5217\u8868\u4e2d entry\uff1a\u4fdd\u5b58\u6570\u636e\u5bf9\u8c61\u6a21\u578b zlend\uff1a\u5728\u8868\u5c3e\uff0c\u8868\u793a\u5217\u8868\u7ed3\u675f\uff09 entry\uff1a prev_len \uff1a\u8868\u793a\u4e00\u4e2aentry\u7684\u957f\u5ea6\uff0c\u6709\u4e24\u79cd\u53d6\u503c\u65b9\u5f0f\uff1a1\u5b57\u8282\u62165\u5b57\u8282\u3002 1\u5b57\u8282\u8868\u793a\u4e00\u4e2aentry\u5c0f\u4e8e254\u5b57\u8282\uff0c255\u662fzlend\u7684\u9ed8\u8ba4\u503c\uff0c\u6240\u4ee5\u4e0d\u4f7f\u7528\u3002 len\uff1a\u8868\u793a\u81ea\u8eab\u957f\u5ea6\uff0c4\u5b57\u8282 encodeing\uff1a\u8868\u793a\u7f16\u7801\u65b9\u5f0f\uff0c1\u5b57\u8282 content\uff1a\u4fdd\u5b58\u5b9e\u9645\u6570\u636e String\u7c7b\u578b\u7684\u5185\u5b58\u7a7a\u95f4\u6d88\u8017 \u4fdd\u5b58Long\u7c7b\u578b\u65f6\uff0c\u6307\u9488\u76f4\u63a5\u4fdd\u5b58\u6574\u6570\u6570\u636e\u503c\uff0c\u53ef\u4ee5\u8282\u7701\u7a7a\u95f4\u5f00\u9500\uff08\u88ab\u79f0\u4e3a\uff1aint\u7f16\u7801\uff09 \u4fdd\u5b58\u5b57\u7b26\u4e32\uff0c\u4e14\u4e0d\u5927\u4e8e44\u5b57\u8282\u65f6\uff0cRedisObject\u7684\u5143\u6570\u636e\uff0c\u6307\u9488\u548cSDS\u662f\u8fde\u7eed\u7684\uff0c\u53ef\u4ee5\u907f\u514d\u5185\u5b58\u788e\u7247\uff08\u88ab\u79f0\u4e3a\uff1aembstr\u7f16\u7801\uff09 \u5f53\u4fdd\u5b58\u7684\u5b57\u7b26\u4e32\u5927\u4e8e44\u5b57\u8282\u65f6\uff0cSDS\u7684\u6570\u636e\u91cf\u53d8\u591a\uff0cRedis\u4f1a\u7ed9SDS\u5206\u914d\u72ec\u7acb\u7684\u7a7a\u95f4\uff0c\u5e76\u7528\u6307\u9488\u6307\u5411SDS\u7ed3\u6784\uff08\u88ab\u79f0\u4e3a\uff1araw\u7f16\u7801\uff09 Redis\u4f7f\u7528\u4e00\u4e2a\u5168\u5c40\u54c8\u5e0c\u8868\u4fdd\u5b58\u6240\u4ee5\u952e\u503c\u5bf9\uff0c\u54c8\u5e0c\u8868\u7684\u6bcf\u4e00\u9879\u90fd\u662f\u4e00\u4e2adicEntry\uff0c\u6bcf\u4e2adicEntry\u5360\u752832\u5b57\u8282\u7a7a\u95f4 dicEntry\u81ea\u8eab24\u5b57\u8282\uff0c\u4f46\u4f1a\u5360\u752832\u5b57\u8282\u7a7a\u95f4\uff0c\u662f\u56e0\u4e3aRedis\u4f7f\u7528\u4e86\u5185\u5b58\u5206\u914d\u5e93jemalloc\u3002 jemalloc\u5728\u5206\u914d\u5185\u5b58\u65f6\uff0c\u4f1a\u6839\u636e\u7533\u8bf7\u7684\u5b57\u8282\u6570N\uff0c\u627e\u4e00\u4e2a\u6bd4N\u5927\uff0c\u4f46\u6700\u63a5\u8fd1N\u76842\u7684\u5e42\u6b21\u6570\u4f5c\u4e3a\u5206\u914d\u7a7a\u95f4\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u9891\u7e41\u5206\u914d\u5185\u5b58\u7684\u6b21\u6570 \u4f7f\u7528\u4ec0\u4e48\u6570\u636e\u7ed3\u6784\u53ef\u4ee5\u8282\u7701\u5185\u5b58\uff1f \u538b\u7f29\u5217\u8868\uff0c\u662f\u4e00\u79cd\u975e\u5e38\u8282\u7701\u5185\u5b58\u7684\u6570\u636e\u7ed3\u6784\uff0c\u56e0\u4e3a\u4ed6\u4f7f\u7528\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u4fdd\u5b58\u6570\u636e\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7684\u6307\u9488\u8fdb\u884c\u8fde\u63a5 Redis\u57fa\u4e8e\u538b\u7f29\u5217\u8868\u5b9e\u73b0List\uff0cHash\uff0cSorted Set\u96c6\u5408\u7c7b\u578b\uff0c\u6700\u5927\u7684\u597d\u5904\u662f\u8282\u7701\u4e86dicEntry\u5f00\u9500 \u5982\u4f55\u4f7f\u7528\u96c6\u5408\u7c7b\u578b\u4fdd\u5b58\u952e\u503c\u5bf9\uff1f Hash\u7c7b\u578b\u8bbe\u7f6e\u4e86\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u6570\u636e\u65f6\u7684\u4e24\u4e2a\u9600\u503c\uff0c\u4e00\u65e6\u8d85\u8fc7\u5c31\u4f1a\u5c06\u538b\u7f29\u5217\u8868\u8f6c\u4e3a\u54c8\u5e0c\u8868\uff0c\u4e14\u4e0d\u53ef\u56de\u9000 hash-max-ziplist-entries \uff1a\u8868\u793a\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u54c8\u5e0c\u96c6\u5408\u4e2d\u7684\u6700\u5927\u5143\u7d20\u4e2a\u6570 hash-max-ziplist-value \uff1a\u8868\u793a\u7528\u538b\u7f29\u5217\u8868\u4fdd\u5b58\u65f6\uff0c\u54c8\u5e0c\u96c6\u5408\u4e2d\u5355\u4e2a\u5143\u7d20\u7684\u6700\u5927\u957f\u5ea6","title":"1-1 Redis\u7684String\u7c7b\u578b\u6570\u636e\u7ed3\u6784\uff0c\u53ca\u5176\u5e95\u5c42\u5b9e\u73b0"},{"location":"chap3/6redis_ds_sum/#1-2-redis","text":"Set \u548c Sorted Set \u90fd\u652f\u6301\u591a\u79cd\u805a\u5408\u7edf\u8ba1\uff0c\u4e0d\u8fc7\uff0c\u5bf9\u4e8e\u5dee\u96c6\u8ba1\u7b97\u6765\u8bf4\uff0c\u53ea\u6709 Set \u652f\u6301\u3002Bitmap \u4e5f\u80fd\u505a\u591a\u4e2a Bitmap \u95f4\u7684\u805a\u5408\u8ba1\u7b97\uff0c\u5305\u62ec\u4e0e\u3001\u6216\u548c\u5f02\u6216\u64cd\u4f5c\u3002 \u5f53\u9700\u8981\u8fdb\u884c\u6392\u5e8f\u7edf\u8ba1\u65f6 \uff0cList \u4e2d\u7684\u5143\u7d20\u867d\u7136\u6709\u5e8f\uff0c\u4f46\u662f\u4e00\u65e6\u6709\u65b0\u5143\u7d20\u63d2\u5165\uff0c\u539f\u6765\u7684\u5143\u7d20\u5728 List \u4e2d\u7684\u4f4d\u7f6e\u5c31\u4f1a\u79fb\u52a8\uff0c\u90a3\u4e48\uff0c\u6309\u4f4d\u7f6e\u8bfb\u53d6\u7684\u6392\u5e8f\u7ed3\u679c\u53ef\u80fd\u5c31\u4e0d\u51c6\u786e\u4e86\u3002\u800c Sorted Set \u672c\u8eab\u662f\u6309\u7167\u96c6\u5408\u5143\u7d20\u7684\u6743\u91cd\u6392\u5e8f\uff0c\u53ef\u4ee5\u51c6\u786e\u5730\u6309\u5e8f\u83b7\u53d6\u7ed3\u679c\uff0c\u6240\u4ee5\u5efa\u8bae\u4f60\u4f18\u5148\u4f7f\u7528\u5b83\u3002 \u8bb0\u5f55\u7684\u6570\u636e\u53ea\u6709 0 \u548c 1 \u4e24\u4e2a\u503c\u7684\u72b6\u6001\uff0cBitmap \u4f1a\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\uff0c\u8fd9\u4e3b\u8981\u5f52\u529f\u4e8e Bitmap \u5bf9\u4e8e\u4e00\u4e2a\u6570\u636e\u53ea\u7528 1 \u4e2a bit \u8bb0\u5f55\uff0c\u53ef\u4ee5\u8282\u7701\u5185\u5b58\u3002 \u5bf9\u4e8e\u57fa\u6570\u7edf\u8ba1\u6765\u8bf4\uff0c\u5982\u679c\u96c6\u5408\u5143\u7d20\u91cf\u8fbe\u5230\u4ebf\u7ea7\u522b\u800c\u4e14\u4e0d\u9700\u8981\u7cbe\u786e\u7edf\u8ba1\u65f6\uff0c\u6211\u5efa\u8bae\u4f60\u4f7f\u7528 HyperLogLog\u3002 \u91cd\u70b9\u53ca\u4eae\u70b9 \u65e5\u5e38\u7684\u7edf\u8ba1\u9700\u6c42\u53ef\u4ee5\u5206\u4e3a\u56db\u7c7b\uff1a\u805a\u5408\uff0c\u6392\u5e8f\uff0c\u4e8c\u503c\u72b6\u6001\uff0c\u57fa\u6570\uff0c\u9009\u7528\u9002\u5408\u7684\u6570\u636e\u7c7b\u578b\u53ef\u4ee5\u5b9e\u73b0\u5373\u5feb\u901f\u53c8\u8282\u7701\u5185\u5b58 \u805a\u5408\u7edf\u8ba1\uff0c\u53ef\u4ee5\u9009\u7528Set\u7c7b\u578b\u5b8c\u6210\uff0c\u4f46Set\u7684\u5dee\uff0c\u5e76\uff0c\u4ea4\u96c6\u64cd\u4f5c\u590d\u6742\u5ea6\u9ad8\uff0c\u5728\u6570\u636e\u91cf\u5927\u7684\u65f6\u5019\u4f1a\u963b\u585e\u4e3b\u8fdb\u7a0b \u6392\u5e8f\u7edf\u8ba1\uff0c\u53ef\u4ee5\u9009\u7528List\u548cSorted Set \u4e8c\u503c\u72b6\u6001\u7edf\u8ba1\uff1aBitmap\u672c\u8eab\u662f\u7528String\u7c7b\u578b\u4f5c\u4e3a\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5b9e\u73b0\uff0cString\u7c7b\u578b\u4f1a\u4fdd\u5b58\u4e3a\u4e8c\u8fdb\u5236\u5b57\u8282\u6570\u7ec4\uff0c\u6240\u4ee5\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2abit\u6570\u7ec4 \u57fa\u6570\u7edf\u8ba1\uff1aHyperLogLog ,\u8ba1\u7b97\u57fa\u6570\u6240\u9700\u7a7a\u95f4\u603b\u662f\u56fa\u5b9a\u7684\uff0c\u800c\u4e14\u5f88\u5c0f\u3002\u4f46\u8981\u6ce8\u610f\uff0cHyperLogLog\u662f\u7edf\u8ba1\u89c4\u5219\u662f\u57fa\u4e8e\u6982\u7387\u5b8c\u6210\u7684\uff0c\u4e0d\u662f\u975e\u5e38\u51c6\u786e","title":"1-2 Redis\u6709\u90a3\u4e9b\u6570\u636e\u7ed3\u6784\u9002\u5408\u505a\u7edf\u8ba1"},{"location":"chap3/6redis_ds_sum/#1-3-geolbs","text":"GEO \u672c\u8eab\u5e76\u6ca1\u6709\u8bbe\u8ba1\u65b0\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff0c\u800c\u662f\u76f4\u63a5\u4f7f\u7528\u4e86 Sorted Set \u96c6\u5408\u7c7b\u578b\u3002 GEO \u7c7b\u578b\u4f7f\u7528 GeoHash \u7f16\u7801\u65b9\u6cd5\u5b9e\u73b0\u4e86\u7ecf\u7eac\u5ea6\u5230 Sorted Set \u4e2d\u5143\u7d20\u6743\u91cd\u5206\u6570\u7684\u8f6c\u6362\uff0c\u8fd9\u5176\u4e2d\u7684\u4e24\u4e2a\u5173\u952e\u673a\u5236\u5c31\u662f\u5bf9\u4e8c\u7ef4\u5730\u56fe\u505a\u533a\u95f4\u5212\u5206\uff0c\u4ee5\u53ca\u5bf9\u533a\u95f4\u8fdb\u884c\u7f16\u7801\u3002 \u4e00\u7ec4\u7ecf\u7eac\u5ea6\u843d\u5728\u67d0\u4e2a\u533a\u95f4\u540e\uff0c\u5c31\u7528\u533a\u95f4\u7684\u7f16\u7801\u503c\u6765\u8868\u793a\uff0c\u5e76\u628a\u7f16\u7801\u503c\u4f5c\u4e3a Sorted Se \u5143\u7d20\u7684\u6743\u91cd\u5206\u6570\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u7ecf\u7eac\u5ea6\u4fdd\u5b58\u5230 Sorted Set \u4e2d\uff0c\u5229\u7528 Sorted Set \u63d0\u4f9b\u7684\u201c\u6309\u6743\u91cd\u8fdb\u884c\u6709\u5e8f\u8303\u56f4\u67e5\u627e\u201d\u7684\u7279\u6027\uff0c\u5b9e\u73b0 LBS \u670d\u52a1\u4e2d\u9891\u7e41\u4f7f\u7528\u7684\u201c\u641c\u7d22\u9644\u8fd1\u201d\u7684\u9700\u6c42\u3002 GEO \u5c5e\u4e8e Redis \u63d0\u4f9b\u7684\u6269\u5c55\u6570\u636e\u7c7b\u578b\u3002\u6269\u5c55\u6570\u636e\u7c7b\u578b\u6709\u4e24\u79cd\u5b9e\u73b0\u9014\u5f84\uff1a \u4e00\u79cd\u662f\u57fa\u4e8e\u73b0\u6709\u7684\u6570\u636e\u7c7b\u578b\uff0c\u901a\u8fc7\u6570\u636e\u7f16\u7801\u6216\u662f\u5b9e\u73b0\u65b0\u7684\u64cd\u4f5c\u7684\u65b9\u5f0f\uff0c\u6765\u5b9e\u73b0\u6269\u5c55\u6570\u636e\u7c7b\u578b\uff0c\u4f8b\u5982\u57fa\u4e8e Sorted Set \u548c GeoHash \u7f16\u7801\u5b9e\u73b0 GEO\uff0c\u4ee5\u53ca\u57fa\u4e8e String \u548c\u4f4d\u64cd\u4f5c\u5b9e\u73b0 Bitmap\uff1b \u53e6\u4e00\u79cd\u5c31\u662f\u5f00\u53d1\u81ea\u5b9a\u4e49\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5177\u4f53\u7684\u64cd\u4f5c\u662f\u589e\u52a0\u65b0\u6570\u636e\u7c7b\u578b\u7684\u5b9a\u4e49\uff0c\u5b9e\u73b0\u521b\u5efa\u548c\u91ca\u653e\u51fd\u6570\uff0c\u5b9e\u73b0\u65b0\u6570\u636e\u7c7b\u578b\u652f\u6301\u7684\u547d\u4ee4\u64cd\u4f5c \u8981\u70b9&\u4eae\u70b9\uff1f GEO\u7684\u539f\u7406\uff0c\u8fd9\u4e2a\u662f\u6211\u4e4b\u524d\u6240\u4e0d\u77e5\u9053\u7684\uff0c\u5b66\u5b8c\u540e\u5bf9GEO\u6709\u4e86\u4e00\u4e9b\u8ba4\u77e5 Redis\u5c45\u7136\u652f\u6301\u81ea\u5b9a\u4e49\u6570\u636e\u5b58\u50a8\u7ed3\u6784\uff0c\u8fd9\u6253\u5f00\u4e86\u6211\u7684\u773c\u754c GEO\u7684\u5e95\u5c42\u5b9e\u73b0\uff0c\u662fsortSet\uff0c\u5143\u7d20\u662f\u8f66\u8f86\u4fe1\u606f\uff0c\u6743\u91cd\u662f\u8f66\u8f86\u7ecf\u7eac\u5ea6\u8f6c\u6362\u8fc7\u6765\u7684float\u503c GEOHash\u7f16\u7801\uff0c\u57fa\u672c\u539f\u7406\u201c\u4e8c\u5206\u533a\u95f4\uff0c\u533a\u95f4\u7f16\u7801\u201d\uff08\u4e8c\u5206\u6cd5\u7684\u5e94\u7528\uff0c\u5c06\u4e00\u4e2a\u503c\u7f16\u7801\u6210N\u4f4d\u7684\u4e8c\u8fdb\u5236\u503c\uff09 GEO\u4f7f\u7528GEOHash\u7f16\u7801\u540e\uff0c\u5c06\u7ecf\u7eac\u5ea6\uff0c\u6309\u7167\u7eac\u5947\u7ecf\u5076\u4f4d\u5206\u522b\u586b\u5145\u7ec4\u5408\uff0c\u5f97\u5230\u4e00\u4e2a\u8f66\u8f86\u7684\u7ecf\u7eac\u5ea6\u7f16\u7801\u503c GEOHash\u7f16\u7801\u5b9e\u73b0\u7684\u6548\u679c\u662f\u5c06\u4e00\u4e2a\u7a7a\u95f4\u5206\u5272\u6210\u4e3a\u4e00\u4e2a\u4e2a\u65b9\u5757\uff0c\u53ef\u4ee5\u5b9e\u73b0LBS\u670d\u52a1\uff08\u4f46\u7f16\u7801\u503c\u76f8\u8fd1\uff0c\u4e0d\u4e00\u5b9a\u4f4d\u7f6e\u76f8\u8fd1\uff09","title":"1-3 GEO\uff0c\u4e00\u79cd\u53ef\u4ee5\u5b9e\u73b0LBS\u670d\u52a1\u7684\u6570\u636e\u7ed3\u6784"},{"location":"chap3/6redis_ds_sum/#1-4","text":"\u70b9\u67e5\u8be2\uff0c\u6839\u636e\u4e00\u4e2a\u65f6\u95f4\u6233\uff0c\u67e5\u8be2\u76f8\u5e94\u65f6\u95f4\u7684\u6570\u636e\uff1b \u8303\u56f4\u67e5\u8be2\uff0c\u67e5\u8be2\u8d77\u59cb\u548c\u622a\u6b62\u65f6\u95f4\u6233\u8303\u56f4\u5185\u7684\u6570\u636e\uff1b \u805a\u5408\u8ba1\u7b97\uff0c\u9488\u5bf9\u8d77\u59cb\u548c\u622a\u6b62\u65f6\u95f4\u6233\u8303\u56f4\u5185\u7684\u6240\u6709\u6570\u636e\u8fdb\u884c\u8ba1\u7b97\uff0c\u4f8b\u5982\u6c42\u6700\u5927 / \u6700\u5c0f\u503c\uff0c\u6c42\u5747\u503c\u7b49\u3002 Redis \u7684\u9ad8\u6027\u80fd\u5199\u7279\u6027\u8db3\u4ee5\u5e94\u5bf9\u4e86\uff1b\u800c\u9488\u5bf9\u591a\u6837\u5316\u7684\u67e5\u8be2\u9700\u6c42\uff0cRedis \u63d0\u4f9b\u4e86\u4e24\u79cd\u65b9\u6848\u3002 \u7b2c\u4e00\u79cd\u65b9\u6848\u662f\uff0c\u7ec4\u5408\u4f7f\u7528 Redis \u5185\u7f6e\u7684 Hash \u548c Sorted Set \u7c7b\u578b\uff0c\u628a\u6570\u636e\u540c\u65f6\u4fdd\u5b58\u5728 Hash \u96c6\u5408\u548c Sorted Set \u96c6\u5408\u4e2d\u3002 \u8fd9\u79cd\u65b9\u6848\u65e2\u53ef\u4ee5\u5229\u7528 Hash \u7c7b\u578b\u5b9e\u73b0\u5bf9\u5355\u952e\u7684\u5feb\u901f\u67e5\u8be2\uff0c\u8fd8\u80fd\u5229\u7528 Sorted Set \u5b9e\u73b0\u5bf9\u8303\u56f4\u67e5\u8be2\u7684\u9ad8\u6548\u652f\u6301\uff0c\u4e00\u4e0b\u5b50\u6ee1\u8db3\u4e86\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u4e24\u5927\u67e5\u8be2\u9700\u6c42\u3002 \u7b2c\u4e00\u79cd\u65b9\u6848\u4e5f\u6709\u4e24\u4e2a\u4e0d\u8db3 \u5728\u6267\u884c\u805a\u5408\u8ba1\u7b97\u65f6\uff0c\u6211\u4eec\u9700\u8981\u628a\u6570\u636e\u8bfb\u53d6\u5230\u5ba2\u6237\u7aef\u518d\u8fdb\u884c\u805a\u5408\uff0c\u5f53\u6709\u5927\u91cf\u6570\u636e\u8981\u805a\u5408\u65f6\uff0c\u6570\u636e\u4f20\u8f93\u5f00\u9500\u5927\uff1b \u6240\u6709\u7684\u6570\u636e\u4f1a\u5728\u4e24\u4e2a\u6570\u636e\u7c7b\u578b\u4e2d\u5404\u4fdd\u5b58\u4e00\u4efd\uff0c\u5185\u5b58\u5f00\u9500\u4e0d\u5c0f\u3002 \u4e0d\u8fc7\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u9002\u5f53\u7684\u6570\u636e\u8fc7\u671f\u65f6\u95f4\uff0c\u91ca\u653e\u5185\u5b58\uff0c\u51cf\u5c0f\u5185\u5b58\u538b\u529b \u3002 RedisTimeSeries \u6a21\u5757 \u8fd9\u662f\u4e13\u95e8\u4e3a\u5b58\u53d6\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u800c\u8bbe\u8ba1\u7684\u6269\u5c55\u6a21\u5757\u3002\u548c\u7b2c\u4e00\u79cd\u65b9\u6848\u76f8\u6bd4\uff0c RedisTimeSeries \u80fd\u652f\u6301\u76f4\u63a5\u5728 Redis \u5b9e\u4f8b\u4e0a\u8fdb\u884c\u591a\u79cd\u6570\u636e\u805a\u5408\u8ba1\u7b97\uff0c\u907f\u514d\u4e86\u5927\u91cf\u6570\u636e\u5728\u5b9e\u4f8b\u548c\u5ba2\u6237\u7aef\u95f4\u4f20\u8f93\u3002 \u4e0d\u8fc7\uff0c RedisTimeSeries \u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u4f7f\u7528\u4e86\u94fe\u8868\uff0c\u5b83\u7684\u8303\u56f4\u67e5\u8be2\u7684\u590d\u6742\u5ea6\u662f O(N) \u7ea7\u522b\u7684\uff0c\u540c\u65f6\uff0c\u5b83\u7684 TS.GET \u67e5\u8be2\u53ea\u80fd\u8fd4\u56de\u6700\u65b0\u7684\u6570\u636e\uff0c\u6ca1\u6709\u529e\u6cd5\u50cf\u7b2c\u4e00\u79cd\u65b9\u6848\u7684 Hash \u7c7b\u578b\u4e00\u6837\uff0c\u53ef\u4ee5\u8fd4\u56de\u4efb\u4e00\u65f6\u95f4\u70b9\u7684\u6570\u636e\u3002 \u7ec4\u5408\u4f7f\u7528 Hash \u548c Sorted Set\uff0c\u6216\u8005\u4f7f\u7528 RedisTimeSeries\uff0c\u5728\u652f\u6301\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u5b58\u53d6\u4e0a\u5404\u6709\u4f18\u52a3\u52bf \u5982\u679c\u4f60\u7684\u90e8\u7f72\u73af\u5883\u4e2d\u7f51\u7edc\u5e26\u5bbd\u9ad8\u3001Redis \u5b9e\u4f8b\u5185\u5b58\u5927\uff0c\u53ef\u4ee5\u4f18\u5148\u8003\u8651\u7b2c\u4e00\u79cd\u65b9\u6848\uff1b \u5982\u679c\u4f60\u7684\u90e8\u7f72\u73af\u5883\u4e2d\u7f51\u7edc\u3001\u5185\u5b58\u8d44\u6e90\u6709\u9650\uff0c\u800c\u4e14\u6570\u636e\u91cf\u5927\uff0c\u805a\u5408\u8ba1\u7b97\u9891\u7e41\uff0c\u9700\u8981\u6309\u6570\u636e\u96c6\u5408\u5c5e\u6027\u67e5\u8be2\uff0c\u53ef\u4ee5\u4f18\u5148\u8003\u8651\u7b2c\u4e8c\u79cd\u65b9\u6848\u3002 \u4f7f\u7528 Sorted Set \u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u628a\u65f6\u95f4\u6233\u4f5c\u4e3a score \uff0c\u628a\u5b9e\u9645\u7684\u6570\u636e\u4f5c\u4e3a member\uff0c\u4f60\u89c9\u5f97\u8fd9\u6837\u4fdd\u5b58\u6570\u636e\u6709\u6ca1\u6709\u6f5c\u5728\u7684\u98ce\u9669\uff1f\u53e6\u5916\uff0c\u5982\u679c\u4f60\u662f Redis \u7684\u5f00\u53d1\u7ef4\u62a4\u8005\uff0c\u4f60\u4f1a\u628a\u805a\u5408\u8ba1\u7b97\u4e5f\u8bbe\u8ba1\u4e3a Sorted Set \u7684\u4e00\u4e2a\u5185\u5728\u529f\u80fd\u5417\uff1f \u5b58\u5728member\u91cd\u590d\u7684\u95ee\u9898\uff0c\u4f1a\u5bf9member\u8986\u76d6","title":"1-4 \u6839\u636e\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u7279\u70b9\uff0c\u9009\u62e9\u5408\u9002\u7684\u5b58\u50a8\u65b9\u6848"},{"location":"chap3/6redis_ds_sum/#1-5-redis","text":"\u5206\u5e03\u5f0f\u7cfb\u7edf\u7ec4\u4ef6\u4f7f\u7528\u6d88\u606f\u961f\u5217\u65f6\u7684\u4e09\u5927\u9700\u6c42\uff1a \u6d88\u606f\u4fdd\u5e8f\u3001\u91cd\u590d\u6d88\u606f\u5904\u7406\u548c\u6d88\u606f\u53ef\u9760\u6027\u4fdd\u8bc1 \uff0c\u8fd9\u4e09\u5927\u9700\u6c42\u53ef\u4ee5\u8fdb\u4e00\u6b65\u8f6c\u6362\u4e3a\u5bf9\u6d88\u606f\u961f\u5217\u7684\u4e09\u5927\u8981\u6c42\uff1a \u6d88\u606f\u6570\u636e\u6709\u5e8f\u5b58\u53d6\uff0c\u6d88\u606f\u6570\u636e\u5177\u6709\u5168\u5c40\u552f\u4e00\u7f16\u53f7\uff0c\u4ee5\u53ca\u6d88\u606f\u6570\u636e\u5728\u6d88\u8d39\u5b8c\u6210\u540e\u88ab\u5220\u9664\u3002 \u5176\u5b9e\uff0c\u5173\u4e8e Redis \u662f\u5426\u9002\u5408\u505a\u6d88\u606f\u961f\u5217\uff0c\u4e1a\u754c\u4e00\u76f4\u662f\u6709\u4e89\u8bba\u7684\u3002\u5f88\u591a\u4eba\u8ba4\u4e3a\uff0c\u8981\u4f7f\u7528\u6d88\u606f\u961f\u5217\uff0c\u5c31\u5e94\u8be5\u91c7\u7528 Kafka\u3001RabbitMQ \u8fd9\u4e9b\u4e13\u95e8\u9762\u5411\u6d88\u606f\u961f\u5217\u573a\u666f\u7684\u8f6f\u4ef6\uff0c\u800c Redis \u66f4\u52a0\u9002\u5408\u505a\u7f13\u5b58\u3002 Redis \u662f\u4e00\u4e2a\u975e\u5e38\u8f7b\u91cf\u7ea7\u7684\u952e\u503c\u6570\u636e\u5e93\uff0c\u90e8\u7f72\u4e00\u4e2a Redis \u5b9e\u4f8b\u5c31\u662f\u542f\u52a8\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u90e8\u7f72 Redis \u96c6\u7fa4\uff0c\u4e5f\u5c31\u662f\u90e8\u7f72\u591a\u4e2a Redis \u5b9e\u4f8b\u3002\u800c Kafka\u3001RabbitMQ \u90e8\u7f72\u65f6\uff0c\u6d89\u53ca\u989d\u5916\u7684\u7ec4\u4ef6\uff0c\u4f8b\u5982 Kafka \u7684\u8fd0\u884c\u5c31\u9700\u8981\u518d\u90e8\u7f72 ZooKeeper\u3002 \u76f8\u6bd4 Redis \u6765\u8bf4\uff0cKafka \u548c RabbitMQ \u4e00\u822c\u88ab\u8ba4\u4e3a\u662f\u91cd\u91cf\u7ea7\u7684\u6d88\u606f\u961f\u5217\u3002 \u5982\u679c\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u7684\u7ec4\u4ef6\u6d88\u606f\u901a\u4fe1\u91cf\u4e0d\u5927\uff0c\u90a3\u4e48\uff0cRedis \u53ea\u9700\u8981\u4f7f\u7528\u6709\u9650\u7684\u5185\u5b58\u7a7a\u95f4\u5c31\u80fd\u6ee1\u8db3\u6d88\u606f\u5b58\u50a8\u7684\u9700\u6c42\uff0c\u800c\u4e14\uff0c Redis \u7684\u9ad8\u6027\u80fd\u7279\u6027\u80fd\u652f\u6301\u5feb\u901f\u7684\u6d88\u606f\u8bfb\u5199\uff0c\u4e0d\u5931\u4e3a\u6d88\u606f\u961f\u5217\u7684\u4e00\u4e2a\u597d\u7684\u89e3\u51b3\u65b9\u6848\u3002","title":"1-5 \u5982\u4f55\u4f7f\u7528redis\u5b9e\u73b0\u6d88\u606f\u961f\u5217\u7684\u9700\u6c42"},{"location":"chap3/6redis_ds_sum/#2","text":"","title":"2\u3001\u672c\u7ae0\u64cd\u4f5c\u603b\u7ed3"},{"location":"chap3/6redis_ds_sum/#1-1-redisstring_1","text":"127.0.0.1:6379> info memory # Memory used_memory:1039120 127.0.0.1:6379> hset 1101000 060 3302000080 (integer) 1 127.0.0.1:6379> info memory # Memory used_memory:1039136","title":"1-1 Redis\u7684String\u7c7b\u578b\u6570\u636e\u7ed3\u6784\uff0c\u53ca\u5176\u5e95\u5c42\u5b9e\u73b0"},{"location":"chap3/6redis_ds_sum/#1-2-redis_1","text":"\u6211\u4eec\u8ba1\u7b97\u7d2f\u8ba1\u7528\u6237 Set \u548c user:id:20200803 Set \u7684\u5e76\u96c6\u7ed3\u679c\uff0c\u7ed3\u679c\u4fdd\u5b58\u5728 user:id \u8fd9\u4e2a\u7d2f\u8ba1\u7528\u6237 Set \u7edf\u8ba1\u591a\u4e2a\u96c6\u5408\u7684\u6240\u6709\u5143\u7d20\uff08\u5e76\u96c6\u7edf\u8ba1\uff09\u3002 SUNIONSTORE user:id user:id user:id:20200803 \u6b64\u65f6\uff0c user:id \u8fd9\u4e2a\u7d2f\u8ba1\u7528\u6237 Set \u4e2d\u5c31\u6709\u4e86 8 \u6708 3 \u65e5\u7684\u7528\u6237 ID\u3002\u7b49\u5230 8 \u6708 4 \u65e5\u518d\u7edf\u8ba1\u65f6\uff0c\u6211\u4eec\u628a 8 \u6708 4 \u65e5\u767b\u5f55\u7684\u7528\u6237 ID \u8bb0\u5f55\u5230 user:id:20200804 \u7684 Set \u4e2d\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6267\u884c SDIFFSTORE \u547d\u4ee4\u8ba1\u7b97\u7d2f\u8ba1\u7528\u6237 Set \u548c user:id:20200804 Set \u7684\u5dee\u96c6\uff0c\u7ed3\u679c\u4fdd\u5b58\u5728 key \u4e3a user:new \u7684 Set \u4e2d\uff0c\u5982\u4e0b\u6240\u793a\uff1a \u628a\u4e24\u4e2a\u96c6\u5408\u76f8\u6bd4\uff0c\u7edf\u8ba1\u5176\u4e2d\u4e00\u4e2a\u96c6\u5408\u72ec\u6709\u7684\u5143\u7d20\uff08\u5dee\u96c6\u7edf\u8ba1\uff09\uff1b SDIFFSTORE user:new user:id:20200804 user:id \u4ee5\u770b\u5230\uff0c\u8fd9\u4e2a\u5dee\u96c6\u4e2d\u7684\u7528\u6237 ID \u5728 user:id:20200804 \u7684 Set \u4e2d\u5b58\u5728\uff0c\u4f46\u662f\u4e0d\u5728\u7d2f\u8ba1\u7528\u6237 Set \u4e2d\u3002\u6240\u4ee5\uff0c user:new \u8fd9\u4e2a Set \u4e2d\u8bb0\u5f55\u7684\u5c31\u662f 8 \u6708 4 \u65e5\u7684\u65b0\u589e\u7528\u6237\u3002 \u5f53\u8981\u8ba1\u7b97 8 \u6708 4 \u65e5\u7684\u7559\u5b58\u7528\u6237\u65f6\uff0c\u6211\u4eec\u53ea\u9700\u8981\u518d\u8ba1\u7b97 user:id:20200803 \u548c user:id:20200804 \u4e24\u4e2a Set \u7684\u4ea4\u96c6\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u540c\u65f6\u5728\u8fd9\u4e24\u4e2a\u96c6\u5408\u4e2d\u7684\u7528\u6237 ID \u4e86\uff0c\u8fd9\u4e9b\u5c31\u662f\u5728 8 \u6708 3 \u65e5\u767b\u5f55\uff0c\u5e76\u4e14\u5728 8 \u6708 4 \u65e5\u7559\u5b58\u7684\u7528\u6237\u3002 \u7edf\u8ba1\u591a\u4e2a\u96c6\u5408\u7684\u5171\u6709\u5143\u7d20\uff08\u4ea4\u96c6\u7edf\u8ba1\uff09 SINTERSTORE user:id:rem user:id:20200803 user:id:20200804 \u5f53\u4f60\u9700\u8981\u5bf9\u591a\u4e2a\u96c6\u5408\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\u65f6\uff0cSet \u7c7b\u578b\u4f1a\u662f\u4e00\u4e2a\u975e\u5e38\u4e0d\u9519\u7684\u9009\u62e9 set\u7c7b\u578b\u9002\u5408\u505a\u805a\u5408\u7edf\u8ba1\uff1a SUNIONSTORE :\u5e76\u96c6 SDIFFSTORE :\u5dee\u96c6 SINTERSTORE :\u4ea4\u96c6 \u7528 LPUSH \u547d\u4ee4\u628a\u5b83\u63d2\u5165 List \u7684\u961f\u5934\u3002 \u5047\u8bbe\u5f53\u524d\u7684\u8bc4\u8bba List \u662f{A, B, C, D, E, F}\uff08\u5176\u4e2d\uff0cA \u662f\u6700\u65b0\u7684\u8bc4\u8bba\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0cF \u662f\u6700\u65e9\u7684\u8bc4\u8bba\uff09\uff0c\u5728\u5c55\u793a\u7b2c\u4e00\u9875\u7684 3 \u4e2a\u8bc4\u8bba\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5f97\u5230\u6700\u65b0\u7684\u4e09\u6761\u8bc4\u8bba A\u3001B\u3001C\uff1a LRANGE product1 0 2 1) \"A\" 2) \"B\" 3) \"C\" \u7136\u540e\uff0c\u518d\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u83b7\u53d6\u7b2c\u4e8c\u9875\u7684 3 \u4e2a\u8bc4\u8bba\uff0c\u4e5f\u5c31\u662f D\u3001E\u3001F\u3002 LRANGE product1 3 5 1) \"D\" 2) \"E\" 3) \"F\" Sorted Set ZRANGEBYSCORE comments N-9 N Bitmap Bitmap \u63d0\u4f9b\u4e86 GETBIT/SETBIT \u64cd\u4f5c\uff0c\u4f7f\u7528\u4e00\u4e2a\u504f\u79fb\u503c offset \u5bf9 bit \u6570\u7ec4\u7684\u67d0\u4e00\u4e2a bit \u4f4d\u8fdb\u884c\u8bfb\u548c\u5199\u3002 \u4e0d\u8fc7\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cBitmap \u7684\u504f\u79fb\u91cf\u662f\u4ece 0 \u5f00\u59cb\u7b97\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4 offset \u7684\u6700\u5c0f\u503c\u662f 0\u3002 \u5f53\u4f7f\u7528 SETBIT \u5bf9\u4e00\u4e2a bit \u4f4d\u8fdb\u884c\u5199\u64cd\u4f5c\u65f6\uff0c\u8fd9\u4e2a bit \u4f4d\u4f1a\u88ab\u8bbe\u7f6e\u4e3a 1\u3002Bitmap \u8fd8\u63d0\u4f9b\u4e86 BITCOUNT \u64cd\u4f5c\uff0c\u7528\u6765\u7edf\u8ba1\u8fd9\u4e2a bit \u6570\u7ec4\u4e2d\u6240\u6709\u201c1\u201d\u7684\u4e2a\u6570\u3002 \u5047\u8bbe\u6211\u4eec\u8981\u7edf\u8ba1 ID 3000 \u7684\u7528\u6237\u5728 2020 \u5e74 8 \u6708\u4efd\u7684\u7b7e\u5230\u60c5\u51b5\uff0c\u5c31\u53ef\u4ee5\u6309\u7167\u4e0b\u9762\u7684\u6b65\u9aa4\u8fdb\u884c\u64cd\u4f5c\u3002 \u7b2c\u4e00\u6b65\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u8bb0\u5f55\u8be5\u7528\u6237 8 \u6708 3 \u53f7\u5df2\u7b7e\u5230\u3002 SETBIT uid:sign:3000:202008 2 1 setbit key offset value \u7b2c\u4e8c\u6b65\uff0c\u68c0\u67e5\u8be5\u7528\u6237 8 \u6708 3 \u65e5\u662f\u5426\u7b7e\u5230\u3002 GETBIT uid:sign:3000:202008 2 \u7b2c\u4e09\u6b65\uff0c\u7edf\u8ba1\u8be5\u7528\u6237\u5728 8 \u6708\u4efd\u7684\u7b7e\u5230\u6b21\u6570\u3002 BITCOUNT uid:sign:3000:202008 \u7b2c\u4e09\u6b65\uff0c\u7edf\u8ba1\u8be5\u7528\u6237\u5728 8 \u6708\u4efd\u7684\u7b7e\u5230\u6b21\u6570\u3002 BITCOUNT uid:sign:3000:202008 SADD \u6709\u4e00\u4e2a\u7528\u6237 user1 \u8bbf\u95ee page1 \u65f6\uff0c\u4f60\u628a\u8fd9\u4e2a\u4fe1\u606f\u52a0\u5230 Set \u4e2d\uff1a SADD page1:uv user1 \u5f53\u4f60\u9700\u8981\u7edf\u8ba1 UV \u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u7528 SCARD \u547d\u4ee4\uff0c\u8fd9\u4e2a\u547d\u4ee4\u4f1a\u8fd4\u56de\u4e00\u4e2a\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u4e2a\u6570\u3002 Hash => HSET \u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u628a\u7528\u6237 ID \u4f5c\u4e3a Hash \u96c6\u5408\u7684 key\uff0c\u5f53\u7528\u6237\u8bbf\u95ee\u9875\u9762\u65f6\uff0c\u5c31\u7528 HSET \u547d\u4ee4\uff08\u7528\u4e8e\u8bbe\u7f6e Hash \u96c6\u5408\u5143\u7d20\u7684\u503c\uff09\uff0c\u5bf9\u8fd9\u4e2a\u7528\u6237 ID \u8bb0\u5f55\u4e00\u4e2a\u503c\u201c1\u201d\uff0c\u8868\u793a\u4e00\u4e2a\u72ec\u7acb\u8bbf\u5ba2\uff0c\u7528\u6237 1 \u8bbf\u95ee page1 \u540e\uff0c\u6211\u4eec\u5c31\u8bb0\u5f55\u4e3a 1 \u4e2a\u72ec\u7acb\u8bbf\u5ba2\uff0c\u5982\u4e0b\u6240\u793a\uff1a HSET page1:uv user1 1 \u5373\u4f7f\u7528\u6237 1 \u591a\u6b21\u8bbf\u95ee\u9875\u9762\uff0c\u91cd\u590d\u6267\u884c\u8fd9\u4e2a HSET \u547d\u4ee4\uff0c\u4e5f\u53ea\u4f1a\u628a user1 \u7684\u503c\u8bbe\u7f6e\u4e3a 1\uff0c\u4ecd\u7136\u53ea\u8bb0\u4e3a 1 \u4e2a\u72ec\u7acb\u8bbf\u5ba2\u3002 \u5f53\u8981\u7edf\u8ba1 UV \u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 HLEN \u547d\u4ee4\u7edf\u8ba1 Hash \u96c6\u5408\u4e2d\u7684\u6240\u6709\u5143\u7d20\u4e2a\u6570\u3002 \u5728\u7edf\u8ba1 UV \u65f6\uff0c\u4f60\u53ef\u4ee5\u7528 PFADD \u547d\u4ee4\uff08\u7528\u4e8e\u5411 HyperLogLog \u4e2d\u6dfb\u52a0\u65b0\u5143\u7d20\uff09\u628a\u8bbf\u95ee\u9875\u9762\u7684\u6bcf\u4e2a\u7528\u6237\u90fd\u6dfb\u52a0\u5230 HyperLogLog \u4e2d\u3002 PFADD page1:uv user1 user2 user3 user4 user5 \u5c31\u53ef\u4ee5\u7528 PFCOUNT \u547d\u4ee4\u76f4\u63a5\u83b7\u5f97 page1 \u7684 UV \u503c\u4e86\uff0c\u8fd9\u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\u5c31\u662f\u8fd4\u56de HyperLogLog \u7684\u7edf\u8ba1\u7ed3\u679c\u3002 PFCOUNT page1:uv","title":"1-2 Redis\u6709\u90a3\u4e9b\u6570\u636e\u7ed3\u6784\u9002\u5408\u505a\u7edf\u8ba1"},{"location":"chap3/6redis_ds_sum/#1-3-geolbs_1","text":"\u628a ID \u53f7\u4e3a 33 \u7684\u8f66\u8f86\u7684\u5f53\u524d\u7ecf\u7eac\u5ea6\u4f4d\u7f6e\u5b58\u5165 GEO \u96c6\u5408\u4e2d \uff1a GEOADD cars:locations 116.034579 39.030452 33 \u4f8b\u5982\uff0cLBS \u5e94\u7528\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0cRedis \u4f1a\u6839\u636e\u8f93\u5165\u7684\u7528\u6237\u7684\u7ecf\u7eac\u5ea6\u4fe1\u606f\uff08116.054579\uff0c39.030452 \uff09\uff0c \u67e5\u627e\u4ee5\u8fd9\u4e2a\u7ecf\u7eac\u5ea6\u4e3a\u4e2d\u5fc3\u7684 5 \u516c\u91cc\u5185\u7684\u8f66\u8f86\u4fe1\u606f\uff0c\u5e76\u8fd4\u56de\u7ed9 LBS \u5e94\u7528\u3002\u5f53\u7136\uff0c \u4f60\u53ef\u4ee5\u4fee\u6539\u201c5\u201d\u8fd9\u4e2a\u53c2\u6570\uff0c\u6765\u8fd4\u56de\u66f4\u5927\u6216\u66f4\u5c0f\u8303\u56f4\u5185\u7684\u8f66\u8f86\u4fe1\u606f\u3002 GEORADIUS cars:locations 116.054579 39.030452 5 km ASC COUNT 10","title":"1-3 GEO\uff0c\u4e00\u79cd\u53ef\u4ee5\u5b9e\u73b0LBS\u670d\u52a1\u7684\u6570\u636e\u7ed3\u6784"},{"location":"chap3/6redis_ds_sum/#1-4_1","text":"Hash \u7c7b\u578b\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217 \u4e3e\u4e2a\u4f8b\u5b50\u3002\u6211\u4eec\u7528 HGET \u547d\u4ee4\u67e5\u8be2 202008030905 \u8fd9\u4e2a\u65f6\u523b\u7684\u6e29\u5ea6\u503c\uff0c\u4f7f\u7528 HMGET \u67e5\u8be2 202008030905\u3001202008030907\u3001202008030908 \u8fd9\u4e09\u4e2a\u65f6\u523b\u7684\u6e29\u5ea6\u503c\uff0c\u5982\u4e0b\u6240\u793a\uff1a HGET device:temperature 202008030905 \"25.1\" HMGET device:temperature 202008030905 202008030907 202008030908 1) \"25.1\" 2) \"25.9\" 3) \"24.9\" Sorted Set \u6765\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217 \u4f7f\u7528 Sorted Set \u4fdd\u5b58\u6570\u636e\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528 ZRANGEBYSCORE \u547d\u4ee4\uff0c\u6309\u7167\u8f93\u5165\u7684\u6700\u5927\u65f6\u95f4\u6233\u548c\u6700\u5c0f\u65f6\u95f4\u6233\u6765\u67e5\u8be2\u8fd9\u4e2a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6e29\u5ea6\u503c\u4e86\u3002\u5982\u4e0b\u6240\u793a\uff0c\u6211\u4eec\u6765\u67e5\u8be2\u4e00\u4e0b\u5728 2020 \u5e74 8 \u6708 3 \u65e5 9 \u70b9 7 \u5206\u5230 9 \u70b9 10 \u5206\u95f4\u7684\u6240\u6709\u6e29\u5ea6\u503c\uff1a ZRANGEBYSCORE device:temperature 202008030907 202008030910 1) \"25.9\" 2) \"24.9\" 3) \"25.3\" 4) \"25.2\" \u539f\u5b50\u6027\u7684\u64cd\u4f5c MULTI & EXEC \u4ee5\u4fdd\u5b58\u8bbe\u5907\u72b6\u6001\u4fe1\u606f\u7684\u9700\u6c42\u4e3a\u4f8b\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u628a\u8bbe\u5907\u5728 2020 \u5e74 8 \u6708 3 \u65e5 9 \u65f6 5 \u5206\u7684\u6e29\u5ea6\uff0c \u5206\u522b\u7528 HSET \u547d\u4ee4\u548c ZADD \u547d\u4ee4\u5199\u5165 Hash \u96c6\u5408\u548c Sorted Set \u96c6\u5408 \u3002 127.0.0.1:6379> MULTI OK 127.0.0.1:6379> HSET device:temperature 202008030911 26.8 QUEUED 127.0.0.1:6379> ZADD device:temperature 202008030911 26.8 QUEUED 127.0.0.1:6379> EXEC 1) (integer) 1 2) (integer) 1 \u9996\u5148\uff0cRedis \u6536\u5230\u4e86\u5ba2\u6237\u7aef\u6267\u884c\u7684 MULTI \u547d\u4ee4\u3002 \u7136\u540e\uff0c\u5ba2\u6237\u7aef\u518d\u6267\u884c HSET \u548c ZADD \u547d\u4ee4\u540e\uff0c Redis \u8fd4\u56de\u7684\u7ed3\u679c\u4e3a \u201cQUEUED \u201d\uff0c\u8868\u793a\u8fd9\u4e24\u4e2a\u547d\u4ee4\u6682\u65f6\u5165\u961f\uff0c\u5148\u4e0d\u6267\u884c\uff1b \u6267\u884c\u4e86 EXEC \u547d\u4ee4\u540e\uff0c HSET \u547d\u4ee4\u548c ZADD \u547d\u4ee4\u624d\u771f\u6b63\u6267\u884c\uff0c\u5e76\u8fd4\u56de\u6210\u529f\u7ed3\u679c\uff08\u7ed3\u679c\u503c\u4e3a 1\uff09\u3002 \u5e8f\u5217\u6570\u636e \u56e0\u4e3a RedisTimeSeries \u4e0d\u5c5e\u4e8e Redis \u7684\u5185\u5efa\u529f\u80fd\u6a21\u5757\uff0c\u5728\u4f7f\u7528\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5148\u628a\u5b83\u7684\u6e90\u7801\u5355\u72ec\u7f16\u8bd1\u6210\u52a8\u6001\u94fe\u63a5\u5e93 redistimeseries.so \uff0c\u518d\u4f7f\u7528 loadmodule \u547d\u4ee4\u8fdb\u884c\u52a0\u8f7d\uff0c\u5982\u4e0b\u6240\u793a\uff1a loadmodule redistimeseries.so \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u521b\u5efa\u4e00\u4e2a key \u4e3a device:temperature \u3001\u6570\u636e\u6709\u6548\u671f\u4e3a 600s \u7684\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u96c6\u5408\u3002 TS.CREATE device:temperature RETENTION 600000 LABELS device_id 1 OK \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u5217 TS.ADD \u547d\u4ee4\u65f6\uff0c\u5c31\u5f80 device:temperature \u96c6\u5408\u4e2d\u63d2\u5165\u4e86\u4e00\u6761\u6570\u636e\uff0c\u8bb0\u5f55\u7684\u662f\u8bbe\u5907\u5728 2020 \u5e74 8 \u6708 3 \u65e5 9 \u65f6 5 \u5206\u7684\u8bbe\u5907\u6e29\u5ea6\uff1b \u518d\u6267\u884c TS.GET \u547d\u4ee4\u65f6\uff0c\u5c31\u4f1a\u628a\u521a\u521a\u63d2\u5165\u7684\u6700\u65b0\u6570\u636e\u8bfb\u53d6\u51fa\u6765 TS.ADD device:temperature 1596416700 25.1 1596416700 TS.GET device:temperature 25.1 \u4e3e\u4e2a\u4f8b\u5b50\u3002\u5047\u8bbe\u6211\u4eec\u4e00\u5171\u7528 4 \u4e2a\u96c6\u5408\u4e3a 4 \u4e2a\u8bbe\u5907\u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u8bbe\u5907\u7684 ID \u53f7\u662f 1\u30012\u30013\u30014\uff0c\u6211\u4eec\u5728\u521b\u5efa\u6570\u636e\u96c6\u5408\u65f6\uff0c\u628a device_id \u8bbe\u7f6e\u4e3a\u6bcf\u4e2a\u96c6\u5408\u7684\u6807\u7b7e\u3002 \u6b64\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e0b\u5217 TS.MGET \u547d\u4ee4\uff0c\u4ee5\u53ca FILTER \u8bbe\u7f6e\uff08\u8fd9\u4e2a\u914d\u7f6e\u9879\u7528\u6765\u8bbe\u7f6e\u96c6\u5408\u6807\u7b7e\u7684\u8fc7\u6ee4\u6761\u4ef6\uff09\uff0c\u67e5\u8be2 device_id \u4e0d\u7b49\u4e8e 2 \u7684\u6240\u6709\u5176\u4ed6\u8bbe\u5907\u7684\u6570\u636e\u96c6\u5408\uff0c\u5e76\u8fd4\u56de\u5404\u81ea\u96c6\u5408\u4e2d\u7684\u6700\u65b0\u7684\u4e00\u6761\u6570\u636e\u3002 TS.MGET FILTER device_id!=2 1) 1) \"device:temperature:1\" 2) (empty list or set) 3) 1) (integer) 1596417000 2) \"25.3\" 2) 1) \"device:temperature:3\" 2) (empty list or set) 3) 1) (integer) 1596417000 2) \"29.5\" 3) 1) \"device:temperature:4\" 2) (empty list or set) 3) 1) (integer) 1596417000 2) \"30.1\" RedisTimeSeries \u652f\u6301\u7684\u805a\u5408\u8ba1\u7b97\u7c7b\u578b\u5f88\u4e30\u5bcc\uff0c\u5305\u62ec\u6c42\u5747\u503c\uff08avg\uff09\u3001\u6c42\u6700\u5927 / \u6700\u5c0f\u503c\uff08max/min\uff09\uff0c\u6c42\u548c\uff08sum\uff09\u7b49\u3002 \u4f8b\u5982\uff0c\u5728\u6267\u884c\u4e0b\u5217\u547d\u4ee4\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6309\u7167\u6bcf 180s \u7684\u65f6\u95f4\u7a97\u53e3\uff0c\u5bf9 2020 \u5e74 8 \u6708 3 \u65e5 9 \u65f6 5 \u5206\u548c 2020 \u5e74 8 \u6708 3 \u65e5 9 \u65f6 12 \u5206\u8fd9\u6bb5\u65f6\u95f4\u5185\u7684\u6570\u636e\u8fdb\u884c\u5747\u503c\u8ba1\u7b97\u4e86\u3002 TS.RANGE device:temperature 1596416700 1596417120 AGGREGATION avg 180000 1) 1) (integer) 1596416700 2) \"25.6\" 2) 1) (integer) 1596416880 2) \"25.8\" 3) 1) (integer) 1596417060 2) \"26.1\"","title":"1-4 \u6839\u636e\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u7279\u70b9\uff0c\u9009\u62e9\u5408\u9002\u7684\u5b58\u50a8\u65b9\u6848"},{"location":"chap3/6redis_ds_sum/#1-5-redis_1","text":"List \u672c\u8eab\u662f\u4e0d\u4f1a\u4e3a\u6bcf\u4e2a\u6d88\u606f\u751f\u6210 ID \u53f7\u7684\uff0c\u6240\u4ee5\uff0c\u6d88\u606f\u7684\u5168\u5c40\u552f\u4e00 ID \u53f7\u5c31\u9700\u8981\u751f\u4ea7\u8005\u7a0b\u5e8f\u5728\u53d1\u9001\u6d88\u606f\u524d\u81ea\u884c\u751f\u6210\u3002\u751f\u6210\u4e4b\u540e\uff0c\u6211\u4eec\u5728\u7528 LPUSH \u547d\u4ee4\u628a\u6d88\u606f\u63d2\u5165 List \u65f6\uff0c\u9700\u8981\u5728\u6d88\u606f\u4e2d\u5305\u542b\u8fd9\u4e2a\u5168\u5c40\u552f\u4e00 ID\u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5c31\u628a\u4e00\u6761\u5168\u5c40 ID \u4e3a 101030001 \u3001\u5e93\u5b58\u91cf\u4e3a 5 \u7684\u6d88\u606f\u63d2\u5165\u4e86\u6d88\u606f\u961f\u5217\uff1a LPUSH mq \"101030001:stock:5\" (integer) 1 \u57fa\u4e8e Streams \u7684\u6d88\u606f\u961f\u5217\u89e3\u51b3\u65b9\u6848 XADD\uff1a\u63d2\u5165\u6d88\u606f\uff0c\u4fdd\u8bc1\u6709\u5e8f\uff0c\u53ef\u4ee5\u81ea\u52a8\u751f\u6210\u5168\u5c40\u552f\u4e00 ID\uff1b XREAD\uff1a\u7528\u4e8e\u8bfb\u53d6\u6d88\u606f\uff0c\u53ef\u4ee5\u6309 ID \u8bfb\u53d6\u6570\u636e\uff1b XREADGROUP\uff1a\u6309\u6d88\u8d39\u7ec4\u5f62\u5f0f\u8bfb\u53d6\u6d88\u606f\uff1b XPENDING \u548c XACK\uff1aXPENDING \u547d\u4ee4\u53ef\u4ee5\u7528\u6765\u67e5\u8be2\u6bcf\u4e2a\u6d88\u8d39\u7ec4\u5185\u6240\u6709\u6d88\u8d39\u8005\u5df2\u8bfb\u53d6\u4f46\u5c1a\u672a\u786e\u8ba4\u7684\u6d88\u606f\uff0c\u800c XACK \u547d\u4ee4\u7528\u4e8e\u5411\u6d88\u606f\u961f\u5217\u786e\u8ba4\u6d88\u606f\u5904\u7406\u5df2\u5b8c\u6210\u3002 \u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u5f80\u540d\u79f0\u4e3a mqstream \u7684\u6d88\u606f\u961f\u5217\u4e2d\u63d2\u5165\u4e00\u6761\u6d88\u606f\uff0c\u6d88\u606f\u7684\u952e\u662f repo \uff0c\u503c\u662f 5 \u3002 \u5176\u4e2d\uff0c\u6d88\u606f\u961f\u5217\u540d\u79f0\u540e\u9762\u7684 * \uff0c\u8868\u793a\u8ba9 Redis \u4e3a\u63d2\u5165\u7684\u6570\u636e\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u7684 ID\uff0c\u4f8b\u5982 \u201c1599203861727-0\u201d \u3002 \u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4e0d\u7528 * \uff0c\u76f4\u63a5\u5728\u6d88\u606f\u961f\u5217\u540d\u79f0\u540e\u81ea\u884c\u8bbe\u5b9a\u4e00\u4e2a ID \u53f7\uff0c\u53ea\u8981\u4fdd\u8bc1\u8fd9\u4e2a ID \u53f7\u662f\u5168\u5c40\u552f\u4e00\u7684\u5c31\u884c\u3002\u4e0d\u8fc7\uff0c\u76f8\u6bd4\u81ea\u884c\u8bbe\u5b9a ID \u53f7\uff0c\u4f7f\u7528 * \u4f1a\u66f4\u52a0\u65b9\u4fbf\u9ad8\u6548\u3002 XADD mqstream * repo 5 \"1599203861727-0\" \u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u4ece ID \u53f7\u4e3a 1599203861727-0 \u7684\u6d88\u606f\u5f00\u59cb\uff0c\u8bfb\u53d6\u540e\u7eed\u7684\u6240\u6709\u6d88\u606f\uff08\u793a\u4f8b\u4e2d\u4e00\u5171 3 \u6761\uff09\u3002 XREAD BLOCK 100 STREAMS mqstream 1599203861727-0 1) 1) \"mqstream\" 2) 1) 1) \"1599274912765-0\" 2) 1) \"repo\" 2) \"3\" 2) 1) \"1599274925823-0\" 2) 1) \"repo\" 2) \"2\" 3) 1) \"1599274927910-0\" 2) 1) \"repo\" 2) \"1\" \u53e6\u5916\uff0c\u6d88\u8d39\u8005\u4e5f\u53ef\u4ee5\u5728\u8c03\u7528 XRAED \u65f6\u8bbe\u5b9a block \u914d\u7f6e\u9879\uff0c\u5b9e\u73b0\u7c7b\u4f3c\u4e8e BRPOP \u7684\u963b\u585e\u8bfb\u53d6\u64cd\u4f5c\u3002 \u5f53\u6d88\u606f\u961f\u5217\u4e2d\u6ca1\u6709\u6d88\u606f\u65f6\uff0c \u4e00\u65e6\u8bbe\u7f6e\u4e86 block \u914d\u7f6e\u9879\uff0cXREAD \u5c31\u4f1a\u963b\u585e\uff0c\u963b\u585e\u7684\u65f6\u957f\u53ef\u4ee5\u5728 block \u914d\u7f6e\u9879\u8fdb\u884c\u8bbe\u7f6e\u3002 XREAD block 10000 streams mqstream $ (nil) (10.00s) \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a group1 \u7684\u6d88\u8d39\u7ec4\uff0c\u8fd9\u4e2a\u6d88\u8d39\u7ec4\u6d88\u8d39\u7684\u6d88\u606f\u961f\u5217\u662f mqstream\u3002 XGROUP create mqstream group1 0 OK \u7136\u540e\uff0c\u6211\u4eec\u518d\u6267\u884c\u4e00\u6bb5\u547d\u4ee4\uff0c \u8ba9 group1 \u6d88\u8d39\u7ec4\u91cc\u7684\u6d88\u8d39\u8005 consumer1 \u4ece mqstream \u4e2d\u8bfb\u53d6\u6240\u6709\u6d88\u606f\uff0c\u5176\u4e2d\uff0c\u547d\u4ee4\u6700\u540e\u7684\u53c2\u6570 \u201c>\u201d \uff0c\u8868\u793a\u4ece\u7b2c\u4e00\u6761\u5c1a\u672a\u88ab\u6d88\u8d39\u7684\u6d88\u606f\u5f00\u59cb\u8bfb\u53d6\u3002 \u56e0\u4e3a\u5728 consumer1 \u8bfb\u53d6\u6d88\u606f\u524d\uff0c group1 \u4e2d\u6ca1\u6709\u5176\u4ed6\u6d88\u8d39\u8005\u8bfb\u53d6\u8fc7\u6d88\u606f\uff0c\u6240\u4ee5\uff0c consumer1 \u5c31\u5f97\u5230 mqstream \u6d88\u606f\u961f\u5217\u4e2d\u7684\u6240\u6709\u6d88\u606f\u4e86\uff08\u4e00\u5171 4 \u6761\uff09\u3002 XREADGROUP group group1 consumer1 streams mqstream > 1) 1) \"mqstream\" 2) 1) 1) \"1599203861727-0\" 2) 1) \"repo\" 2) \"5\" 2) 1) \"1599274912765-0\" 2) 1) \"repo\" 2) \"3\" 3) 1) \"1599274925823-0\" 2) 1) \"repo\" 2) \"2\" 4) 1) \"1599274927910-0\" 2) 1) \"repo\" 2) \"1\" \u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u6267\u884c\u5b8c\u521a\u624d\u7684 XREADGROUP \u547d\u4ee4\u540e\uff0c\u518d\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c \u8ba9 group1 \u5185\u7684 consumer2 \u8bfb\u53d6\u6d88\u606f\u65f6\uff0c consumer2 \u8bfb\u5230\u7684\u5c31\u662f\u7a7a\u503c\uff0c\u56e0\u4e3a\u6d88\u606f\u5df2\u7ecf\u88ab consumer1 \u8bfb\u53d6\u5b8c\u4e86 \uff0c\u5982\u4e0b\u6240\u793a\uff1a XREADGROUP group group1 consumer2 streams mqstream 0 1) 1) \"mqstream\" 2) (empty list or set) \u4f7f\u7528\u6d88\u8d39\u7ec4\u7684\u76ee\u7684\u662f\u8ba9\u7ec4\u5185\u7684\u591a\u4e2a\u6d88\u8d39\u8005\u5171\u540c\u5206\u62c5\u8bfb\u53d6\u6d88\u606f\uff0c \u6240\u4ee5\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u8ba9\u6bcf\u4e2a\u6d88\u8d39\u8005\u8bfb\u53d6\u90e8\u5206\u6d88\u606f\uff0c\u4ece\u800c\u5b9e\u73b0\u6d88\u606f\u8bfb\u53d6\u8d1f\u8f7d\u5728\u591a\u4e2a\u6d88\u8d39\u8005\u95f4\u662f\u5747\u8861\u5206\u5e03\u7684\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u8ba9 group2 \u4e2d\u7684 consumer1\u30012\u30013 \u5404\u81ea\u8bfb\u53d6\u4e00\u6761\u6d88\u606f\u3002 XREADGROUP group group2 consumer1 count 1 streams mqstream > 1) 1) \"mqstream\" 2) 1) 1) \"1599203861727-0\" 2) 1) \"repo\" 2) \"5\" XREADGROUP group group2 consumer2 count 1 streams mqstream > 1) 1) \"mqstream\" 2) 1) 1) \"1599274912765-0\" 2) 1) \"repo\" 2) \"3\" XREADGROUP group group2 consumer3 count 1 streams mqstream > 1) 1) \"mqstream\" 2) 1) 1) \"1599274925823-0\" 2) 1) \"repo\" 2) \"2\" \u5982\u679c\u6d88\u8d39\u8005\u6ca1\u6709\u6210\u529f\u5904\u7406\u6d88\u606f\uff0c\u5b83\u5c31\u4e0d\u4f1a\u7ed9 Streams \u53d1\u9001 XACK \u547d\u4ee4\uff0c\u6d88\u606f\u4ecd\u7136\u4f1a\u7559\u5b58\u3002\u6b64\u65f6\uff0c\u6d88\u8d39\u8005\u53ef\u4ee5\u5728\u91cd\u542f\u540e\uff0c\u7528 XPENDING \u547d\u4ee4\u67e5\u770b\u5df2\u8bfb\u53d6\u3001\u4f46\u5c1a\u672a\u786e\u8ba4\u5904\u7406\u5b8c\u6210\u7684\u6d88\u606f\u3002 XPENDING mqstream group2 1) (integer) 3 2) \"1599203861727-0\" 3) \"1599274925823-0\" 4) 1) 1) \"consumer1\" 2) \"1\" 2) 1) \"consumer2\" 2) \"1\" 3) 1) \"consumer3\" 2) \"1\" \u5982\u679c\u6211\u4eec\u8fd8\u9700\u8981\u8fdb\u4e00\u6b65\u67e5\u770b\u67d0\u4e2a\u6d88\u8d39\u8005\u5177\u4f53\u8bfb\u53d6\u4e86\u54ea\u4e9b\u6570\u636e\uff0c\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff1a XPENDING mqstream group2 - + 10 consumer2 1) 1) \"1599274912765-0\" 2) \"consumer2\" 3) (integer) 513336 4) (integer) 1 \u4e00\u65e6\u6d88\u606f 1599274912765-0 \u88ab consumer2 \u5904\u7406\u4e86\uff0c consumer2 \u5c31\u53ef\u4ee5\u4f7f\u7528 XACK \u547d\u4ee4\u901a\u77e5 Streams \uff0c\u7136\u540e\u8fd9\u6761\u6d88\u606f\u5c31\u4f1a\u88ab\u5220\u9664\u3002\u5f53\u6211\u4eec\u518d\u4f7f\u7528 XPENDING \u547d\u4ee4\u67e5\u770b\u65f6\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\uff0c consumer2 \u5df2\u7ecf\u6ca1\u6709\u5df2\u8bfb\u53d6\u3001\u4f46\u5c1a\u672a\u786e\u8ba4\u5904\u7406\u7684\u6d88\u606f\u4e86\u3002 XACK mqstream group2 1599274912765-0 (integer) 1 XPENDING mqstream group2 - + 10 consumer2 (empty list or set)","title":"1-5 \u5982\u4f55\u4f7f\u7528redis\u5b9e\u73b0\u6d88\u606f\u961f\u5217\u7684\u9700\u6c42"},{"location":"chap3/6redis_ds_sum/#3","text":"1-1 \u95ee\u9898\uff1a\u9664\u4e86 String \u7c7b\u578b\u548c Hash \u7c7b\u578b\uff0c\u8fd8\u6709\u4ec0\u4e48\u7c7b\u578b\u9002\u5408\u4fdd\u5b58\u56fe\u7247\u5417\uff1f \u7b54\u6848\uff1a\u9664\u4e86 String \u548c Hash\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4f7f\u7528 Sorted Set \u7c7b\u578b\u8fdb\u884c\u4fdd\u5b58\u3002Sorted Set \u7684\u5143\u7d20\u6709 member \u503c\u548c score \u503c\uff0c\u53ef\u4ee5\u50cf Hash \u90a3\u6837\uff0c\u4f7f\u7528\u4e8c\u7ea7\u7f16\u7801\u8fdb\u884c\u4fdd\u5b58\u3002\u5177\u4f53\u505a\u6cd5\u662f\uff0c\u628a\u56fe\u7247 ID \u7684\u524d 7 \u4f4d\u4f5c\u4e3a Sorted Set \u7684 key\uff0c\u628a\u56fe\u7247 ID \u7684\u540e 3 \u4f4d\u4f5c\u4e3a member \u503c\uff0c\u56fe\u7247\u5b58\u50a8\u5bf9\u8c61 ID \u4f5c\u4e3a score \u503c\u3002 Sorted Set \u4e2d\u5143\u7d20\u8f83\u5c11\u65f6\uff0cRedis \u4f1a\u4f7f\u7528\u538b\u7f29\u5217\u8868\u8fdb\u884c\u5b58\u50a8\uff0c\u53ef\u4ee5\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u3002\u4e0d\u8fc7\uff0c\u548c Hash \u4e0d\u4e00\u6837\uff0cSorted Set \u63d2\u5165\u6570\u636e\u65f6\uff0c\u9700\u8981\u6309 score \u503c\u7684\u5927\u5c0f\u6392\u5e8f\u3002\u5f53\u5e95\u5c42\u7ed3\u6784\u662f\u538b\u7f29\u5217\u8868\u65f6\uff0cSorted Set \u7684\u63d2\u5165\u6027\u80fd\u5c31\u6bd4\u4e0d\u4e0a Hash\u3002\u6240\u4ee5\uff0c\u5728\u6211\u4eec\u8fd9\u8282\u8bfe\u63cf\u8ff0\u7684\u573a\u666f\u4e2d\uff0cSorted Set \u7c7b\u578b\u867d\u7136\u53ef\u4ee5\u7528\u6765\u4fdd\u5b58\uff0c\u4f46\u5e76\u4e0d\u662f\u6700\u4f18\u9009\u9879\u3002 1-2 4 \u79cd\u5178\u578b\u7684\u7edf\u8ba1\u6a21\u5f0f\uff0c\u5206\u522b\u662f\u805a\u5408\u7edf\u8ba1\u3001\u6392\u5e8f\u7edf\u8ba1\u3001\u4e8c\u503c\u72b6\u6001\u7edf\u8ba1\u548c\u57fa\u6570\u7edf\u8ba1\uff0c\u4ee5\u53ca\u5b83\u4eec\u5404\u81ea\u9002\u5408\u7684\u96c6\u5408\u7c7b\u578b\u3002\u4f60\u8fd8\u9047\u5230\u8fc7\u5176\u4ed6\u7684\u7edf\u8ba1\u573a\u666f\u5417\uff1f\u7528\u7684\u662f\u4ec0\u4e48\u96c6\u5408\u7c7b\u578b\u5462\uff1f \u4f7f\u7528 List+Lua \u7edf\u8ba1\u6700\u8fd1 200 \u4e2a\u5ba2\u6237\u7684\u89e6\u8fbe\u7387\u3002\u5177\u4f53\u505a\u6cd5\u662f\uff0c\u6bcf\u4e2a List \u5143\u7d20\u8868\u793a\u4e00\u4e2a\u5ba2\u6237\uff0c\u5143\u7d20\u503c\u4e3a 0\uff0c\u4ee3\u8868\u89e6\u8fbe\uff1b\u5143\u7d20\u503c\u4e3a 1\uff0c\u5c31\u4ee3\u8868\u672a\u89e6\u8fbe\u3002\u5728\u8fdb\u884c\u7edf\u8ba1\u65f6\uff0c\u5e94\u7528\u7a0b\u5e8f\u4f1a\u628a\u4ee3\u8868\u5ba2\u6237\u7684\u5143\u7d20\u5199\u5165\u961f\u5217\u4e2d\u3002\u5f53\u9700\u8981\u7edf\u8ba1\u89e6\u8fbe\u7387\u65f6\uff0c\u5c31\u4f7f\u7528 LRANGE key 0 -1 \u53d6\u51fa\u5168\u90e8\u5143\u7d20\uff0c\u8ba1\u7b97 0 \u7684\u6bd4\u4f8b\uff0c\u8fd9\u4e2a\u6bd4\u4f8b\u5c31\u662f\u89e6\u8fbe\u7387\u3002 \u8fd9\u4e2a\u4f8b\u5b50\u9700\u8981\u83b7\u53d6\u5168\u90e8\u5143\u7d20\uff0c\u4e0d\u8fc7\u6570\u636e\u91cf\u53ea\u6709 200 \u4e2a\uff0c\u4e0d\u7b97\u5927\uff0c\u6240\u4ee5\uff0c\u4f7f\u7528 List\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\u4e5f\u662f\u53ef\u4ee5\u63a5\u53d7\u7684\u3002\u4f46\u662f\uff0c\u5982\u679c\u6570\u636e\u91cf\u5f88\u5927\uff0c\u53c8\u6709\u5176\u4ed6\u67e5\u8be2\u9700\u6c42\u7684\u8bdd\uff08\u4f8b\u5982\u67e5\u8be2\u5355\u4e2a\u5143\u7d20\u7684\u89e6\u8fbe\u60c5\u51b5\uff09\uff0cList \u7684\u64cd\u4f5c\u590d\u6742\u5ea6\u8f83\u9ad8\uff0c\u5c31\u4e0d\u5408\u9002\u4e86\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 Hash \u7c7b\u578b\u3002 1-3 \u4f60\u5728\u65e5\u5e38\u7684\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\uff0c\u8fd8\u7528\u8fc7 Redis \u7684\u5176\u4ed6\u6570\u636e\u7c7b\u578b\u5417\uff1f 5 \u5927\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff0c\u4ee5\u53ca HyperLogLog\u3001Bitmap\u3001GEO\uff0cRedis \u8fd8\u6709\u4e00\u79cd\u6570\u636e\u7c7b\u578b\uff0c \u53eb\u4f5c\u5e03\u9686\u8fc7\u6ee4\u5668\u3002\u5b83\u7684\u67e5\u8be2\u6548\u7387\u5f88\u9ad8\uff0c\u7ecf\u5e38\u4f1a\u7528\u5728\u7f13\u5b58\u573a\u666f\u4e2d\uff0c\u53ef\u4ee5\u7528\u6765\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728\u7f13\u5b58\u4e2d \u3002 1-4 \u5728\u7528 Sorted Set \u4fdd\u5b58\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u65f6\uff0c\u5982\u679c\u628a\u65f6\u95f4\u6233\u4f5c\u4e3a score\uff0c\u628a\u5b9e\u9645\u7684\u6570\u636e\u4f5c\u4e3a member\uff0c\u8fd9\u6837\u4fdd\u5b58\u6570\u636e\u6709\u6ca1\u6709\u6f5c\u5728\u7684\u98ce\u9669\uff1f\u53e6\u5916\uff0c\u5982\u679c\u4f60\u662f Redis \u7684\u5f00\u53d1\u7ef4\u62a4\u8005\uff0c\u4f60\u4f1a\u628a\u805a\u5408\u8ba1\u7b97\u4e5f\u8bbe\u8ba1\u4e3a Sorted Set \u7684\u4e00\u4e2a\u5185\u5728\u529f\u80fd\u5417\uff1f \u7b54\u6848\uff1aSorted Set \u548c Set \u4e00\u6837\uff0c\u90fd\u4f1a\u5bf9\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u8fdb\u884c\u53bb\u91cd\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u5f80\u96c6\u5408\u4e2d\u63d2\u5165\u7684 member \u503c\uff0c\u548c\u4e4b\u524d\u5df2\u7ecf\u5b58\u5728\u7684 member \u503c\u4e00\u6837\uff0c\u90a3\u4e48\uff0c\u539f\u6765 member \u7684 score \u5c31\u4f1a\u88ab\u65b0\u5199\u5165\u7684 member \u7684 score \u8986\u76d6\u3002\u76f8\u540c member \u7684\u503c\uff0c\u5728 Sorted Set \u4e2d\u53ea\u4f1a\u4fdd\u7559\u4e00\u4e2a\u3002 \u5bf9\u4e8e\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u6765\u8bf4\uff0c\u8fd9\u79cd\u53bb\u91cd\u7684\u7279\u6027\u662f\u4f1a\u5e26\u6765\u6570\u636e\u4e22\u5931\u98ce\u9669\u7684\u3002\u6bd5\u7adf\uff0c\u67d0\u4e00\u65f6\u95f4\u6bb5\u5185\u7684\u591a\u4e2a\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u7684\u503c\u53ef\u80fd\u662f\u76f8\u540c\u7684\u3002\u5982\u679c\u6211\u4eec\u5f80 Sorted Set \u4e2d\u5199\u5165\u7684\u6570\u636e\u662f\u5728\u4e0d\u540c\u65f6\u523b\u4ea7\u751f\u7684\uff0c\u4f46\u662f\u5199\u5165\u7684\u65f6\u523b\u4e0d\u540c\uff0cSorted Set \u4e2d\u53ea\u4f1a\u4fdd\u5b58\u4e00\u4efd\u6700\u8fd1\u65f6\u523b\u7684\u6570\u636e\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5176\u4ed6\u65f6\u523b\u7684\u6570\u636e\u5c31\u90fd\u6ca1\u6709\u4fdd\u5b58\u4e0b\u6765\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5728\u8bb0\u5f55\u7269\u8054\u7f51\u8bbe\u5907\u7684\u6e29\u5ea6\u65f6\uff0c\u4e00\u4e2a\u8bbe\u5907\u4e00\u4e2a\u4e0a\u5348\u7684\u6e29\u5ea6\u503c\u53ef\u80fd\u90fd\u662f 26\u3002\u5728 Sorted Set \u4e2d\uff0c\u6211\u4eec\u628a\u6e29\u5ea6\u503c\u4f5c\u4e3a member\uff0c\u628a\u65f6\u95f4\u6233\u4f5c\u4e3a score\u3002\u6211\u4eec\u7528 ZADD \u547d\u4ee4\u628a\u4e0a\u5348\u4e0d\u540c\u65f6\u523b\u7684\u6e29\u5ea6\u503c\u5199\u5165 Sorted Set\u3002\u7531\u4e8e member \u503c\u4e00\u6837\uff0c\u6240\u4ee5\u53ea\u4f1a\u628a score \u66f4\u65b0\u4e3a\u6700\u65b0\u65f6\u95f4\u6233\uff0c\u6700\u540e\u53ea\u6709\u4e00\u4e2a\u6700\u65b0\u65f6\u95f4\u6233\uff08\u4f8b\u5982\u4e0a\u5348 12 \u70b9\uff09\u4e0b\u7684\u6e29\u5ea6\u503c\u3002\u8fd9\u80af\u5b9a\u662f\u65e0\u6cd5\u6ee1\u8db3\u4fdd\u5b58\u591a\u4e2a\u65f6\u523b\u6570\u636e\u7684\u9700\u6c42\u7684\u3002 \u5173\u4e8e\u662f\u5426\u628a\u805a\u5408\u8ba1\u7b97\u4f5c\u4e3a Sorted Set \u7684\u5185\u5728\u529f\u80fd\uff0c\u8003\u8651\u5230 Redis \u7684\u8bfb\u5199\u529f\u80fd\u662f\u7531\u5355\u7ebf\u7a0b\u6267\u884c\uff0c\u5728\u8fdb\u884c\u6570\u636e\u8bfb\u5199\u65f6\uff0c\u672c\u8eab\u5c31\u4f1a\u6d88\u8017\u8f83\u591a\u7684 CPU \u8d44\u6e90\uff0c\u5982\u679c\u518d\u5728 Sorted Set \u4e2d\u5b9e\u73b0\u805a\u5408\u8ba1\u7b97\uff0c\u5c31\u4f1a\u8fdb\u4e00\u6b65\u589e\u52a0 CPU \u7684\u8d44\u6e90\u6d88\u8017\uff0c\u5f71\u54cd\u5230 Redis \u7684\u6b63\u5e38\u6570\u636e\u8bfb\u53d6\u3002\u6240\u4ee5\uff0c\u5982\u679c\u6211\u662f Redis \u7684\u5f00\u53d1\u7ef4\u62a4\u8005\uff0c\u9664\u975e\u5bf9 Redis \u7684\u7ebf\u7a0b\u6a21\u578b\u505a\u4fee\u6539\uff0c\u6bd4\u5982\u8bf4\u5728 Redis \u4e2d\u4f7f\u7528\u989d\u5916\u7684\u7ebf\u7a0b\u6c60\u505a\u805a\u5408\u8ba1\u7b97\uff0c\u5426\u5219\uff0c\u6211\u4e0d\u4f1a\u628a\u805a\u5408\u8ba1\u7b97\u4f5c\u4e3a Redis \u7684\u5185\u5728\u529f\u80fd\u5b9e\u73b0\u7684\u3002 1-5 \u5982\u679c\u4e00\u4e2a\u751f\u4ea7\u8005\u53d1\u9001\u7ed9\u6d88\u606f\u961f\u5217\u7684\u6d88\u606f\uff0c\u9700\u8981\u88ab\u591a\u4e2a\u6d88\u8d39\u8005\u8fdb\u884c\u8bfb\u53d6\u548c\u5904\u7406\uff08\u4f8b\u5982\uff0c\u4e00\u4e2a\u6d88\u606f\u662f\u4e00\u6761\u4ece\u4e1a\u52a1\u7cfb\u7edf\u91c7\u96c6\u7684\u6570\u636e\uff0c\u65e2\u8981\u88ab\u6d88\u8d39\u8005 1 \u8bfb\u53d6\u5e76\u8fdb\u884c\u5b9e\u65f6\u8ba1\u7b97\uff0c\u4e5f\u8981\u88ab\u6d88\u8d39\u8005 2 \u8bfb\u53d6\u5e76\u7559\u5b58\u5230\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf HDFS \u4e2d\uff0c\u4ee5\u4fbf\u540e\u7eed\u8fdb\u884c\u5386\u53f2\u67e5\u8be2\uff09\uff0c\u4f60\u4f1a\u4f7f\u7528 Redis \u7684\u4ec0\u4e48\u6570\u636e\u7c7b\u578b\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f \u53ef\u4ee5\u4f7f\u7528 Streams \u6570\u636e\u7c7b\u578b\u7684\u6d88\u8d39\u7ec4\uff0c\u540c\u65f6\u6d88\u8d39\u751f\u4ea7\u8005\u7684\u6570\u636e\uff0c\u8fd9\u662f\u53ef\u4ee5\u7684\u3002\u4f46\u662f\uff0c\u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\uff0c\u5982\u679c\u53ea\u662f\u4f7f\u7528\u4e00\u4e2a\u6d88\u8d39\u7ec4\u7684\u8bdd\uff0c\u6d88\u8d39\u7ec4\u5185\u7684\u591a\u4e2a\u6d88\u8d39\u8005\u5728\u6d88\u8d39\u6d88\u606f\u65f6\u662f\u4e92\u65a5\u7684\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u5728\u4e00\u4e2a\u6d88\u8d39\u7ec4\u5185\uff0c\u4e00\u4e2a\u6d88\u606f\u53ea\u80fd\u88ab\u4e00\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\u3002\u6211\u4eec\u5e0c\u671b\u6d88\u606f\u65e2\u8981\u88ab\u6d88\u8d39\u8005 1 \u8bfb\u53d6\uff0c\u4e5f\u8981\u88ab\u6d88\u8d39\u8005 2 \u8bfb\u53d6\uff0c\u662f\u4e00\u4e2a\u591a\u6d88\u8d39\u8005\u7684\u9700\u6c42\u3002\u6240\u4ee5\uff0c\u5982\u679c\u4f7f\u7528\u6d88\u8d39\u7ec4\u6a21\u5f0f\uff0c\u9700\u8981\u8ba9\u6d88\u8d39\u8005 1 \u548c\u6d88\u8d39\u8005 2 \u5c5e\u4e8e\u4e0d\u540c\u7684\u6d88\u8d39\u7ec4\uff0c\u8fd9\u6837\u5b83\u4eec\u5c31\u80fd\u540c\u65f6\u6d88\u8d39\u4e86\u3002 \u53e6\u5916\uff0cRedis \u57fa\u4e8e\u5b57\u5178\u548c\u94fe\u8868\u6570\u636e\u7ed3\u6784\uff0c\u5b9e\u73b0\u4e86\u53d1\u5e03\u548c\u8ba2\u9605\u529f\u80fd\uff0c\u8fd9\u4e2a\u529f\u80fd\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u6d88\u606f\u88ab\u591a\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\u4f7f\u7528\uff0c\u53ef\u4ee5\u6ee1\u8db3\u95ee\u9898\u4e2d\u7684\u573a\u666f\u9700\u6c42\u3002","title":"3\u3001\u7ae0\u8282\u5c0f\u95ee"},{"location":"chap4/1redis_asyn/","text":"\u7b2c\u4e00\u8282 Redis\u6709\u54ea\u4e9b\u53ef\u80fd\u5bfc\u81f4\u963b\u585e\u7684\u64cd\u4f5c\uff0c\u4ee5\u53ca\u89e3\u51b3\u673a\u5236 Redis \u4e4b\u6240\u4ee5\u88ab\u5e7f\u6cdb\u5e94\u7528\uff0c\u5f88\u91cd\u8981\u7684\u4e00\u4e2a\u539f\u56e0\u5c31\u662f\u5b83\u652f\u6301\u9ad8\u6027\u80fd\u8bbf\u95ee\u3002\u4e5f\u6b63\u56e0\u4e3a\u8fd9\u6837\uff0c \u6211\u4eec\u5fc5\u987b\u8981\u91cd\u89c6\u6240\u6709\u53ef\u80fd\u5f71\u54cd Redis \u6027\u80fd\u7684\u56e0\u7d20\uff08\u4f8b\u5982\u547d\u4ee4\u64cd\u4f5c\u3001\u7cfb\u7edf\u914d\u7f6e\u3001\u5173\u952e\u673a\u5236\u3001\u786c\u4ef6\u914d\u7f6e\u7b49\uff09 Redis \u6027\u80fd\u7684 5 \u5927\u65b9\u9762\u7684\u6f5c\u5728\u56e0\u7d20 Redis \u5185\u90e8\u7684\u963b\u585e\u5f0f\u64cd\u4f5c\uff1b CPU \u6838\u548c NUMA \u67b6\u6784\u7684\u5f71\u54cd\uff1b Redis \u5173\u952e\u7cfb\u7edf\u914d\u7f6e\uff1b Redis \u5185\u5b58\u788e\u7247\uff1b Redis \u7f13\u51b2\u533a\u3002 Redis \u7684\u7f51\u7edc IO \u548c\u952e\u503c\u5bf9\u8bfb\u5199\u662f\u7531\u4e3b\u7ebf\u7a0b\u5b8c\u6210\u7684\u3002\u90a3\u4e48\uff0c\u5982\u679c\u5728\u4e3b\u7ebf\u7a0b\u4e0a\u6267\u884c\u7684\u64cd\u4f5c\u6d88\u8017\u7684\u65f6\u95f4\u592a\u957f\uff0c\u5c31\u4f1a\u5f15\u8d77\u4e3b\u7ebf\u7a0b\u963b\u585e\u3002 Redis \u65e2\u6709\u670d\u52a1\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u952e\u503c\u5bf9\u589e\u5220\u6539\u67e5\u64cd\u4f5c\uff0c\u4e5f\u6709\u4fdd\u8bc1\u53ef\u9760\u6027\u7684\u6301\u4e45\u5316\u64cd\u4f5c 1\u3001Redis \u5b9e\u4f8b\u6709\u54ea\u4e9b\u963b\u585e\u70b9\uff1f Redis \u5b9e\u4f8b\u5728\u8fd0\u884c\u65f6\uff0c\u8981\u548c\u8bb8\u591a\u5bf9\u8c61\u8fdb\u884c\u4ea4\u4e92\uff0c\u8fd9\u4e9b\u4e0d\u540c\u7684\u4ea4\u4e92\u5c31\u4f1a\u6d89\u53ca\u4e0d\u540c\u7684\u64cd\u4f5c\uff0c\u4e0b\u9762\u6211\u4eec\u6765\u770b\u770b\u548c Redis \u5b9e\u4f8b\u4ea4\u4e92\u7684\u5bf9\u8c61\uff0c\u4ee5\u53ca\u4ea4\u4e92\u65f6\u4f1a\u53d1\u751f\u7684\u64cd\u4f5c\u3002 \u5ba2\u6237\u7aef \uff1a\u7f51\u7edc IO\uff0c\u952e\u503c\u5bf9\u589e\u5220\u6539\u67e5\u64cd\u4f5c\uff0c\u6570\u636e\u5e93\u64cd\u4f5c\uff1b \u78c1\u76d8 \uff1a\u751f\u6210 RDB \u5feb\u7167\uff0c\u8bb0\u5f55 AOF \u65e5\u5fd7\uff0cAOF \u65e5\u5fd7\u91cd\u5199\uff1b \u4e3b\u4ece\u8282\u70b9 \uff1a\u4e3b\u5e93\u751f\u6210\u3001\u4f20\u8f93 RDB \u6587\u4ef6\uff0c\u4ece\u5e93\u63a5\u6536 RDB \u6587\u4ef6\u3001\u6e05\u7a7a\u6570\u636e\u5e93\u3001\u52a0\u8f7d RDB \u6587\u4ef6\uff1b \u5207\u7247\u96c6\u7fa4\u5b9e\u4f8b \uff1a\u5411\u5176\u4ed6\u5b9e\u4f8b\u4f20\u8f93\u54c8\u5e0c\u69fd\u4fe1\u606f\uff0c\u6570\u636e\u8fc1\u79fb\u3002 1-1 \u548c\u5ba2\u6237\u7aef\u4ea4\u4e92\u65f6\u7684\u963b\u585e\u70b9 \u7f51\u7edc IO \u6709\u65f6\u5019\u4f1a\u6bd4\u8f83\u6162\uff0c\u4f46\u662f Redis \u4f7f\u7528\u4e86 IO \u591a\u8def\u590d\u7528\u673a\u5236\uff0c\u907f\u514d\u4e86\u4e3b\u7ebf\u7a0b\u4e00\u76f4\u5904\u5728\u7b49\u5f85\u7f51\u7edc\u8fde\u63a5\u6216\u8bf7\u6c42\u5230\u6765\u7684\u72b6\u6001\uff0c \u6240\u4ee5\uff0c\u7f51\u7edc IO \u4e0d\u662f\u5bfc\u81f4 Redis \u963b\u585e\u7684\u56e0\u7d20\u3002 \u503c\u5bf9\u7684\u589e\u5220\u6539\u67e5\u64cd\u4f5c\u662f Redis \u548c\u5ba2\u6237\u7aef\u4ea4\u4e92\u7684\u4e3b\u8981\u90e8\u5206\uff0c\u4e5f\u662f Redis \u4e3b\u7ebf\u7a0b\u6267\u884c\u7684\u4e3b\u8981\u4efb\u52a1\u3002 \u6240\u4ee5\uff0c\u590d\u6742\u5ea6\u9ad8\u7684\u589e\u5220\u6539\u67e5\u64cd\u4f5c\u80af\u5b9a\u4f1a\u963b\u585e Redis\u3002 \u600e\u4e48\u5224\u65ad\u64cd\u4f5c\u590d\u6742\u5ea6\u662f\u4e0d\u662f\u9ad8\u5462\uff1f \u8fd9\u91cc\u6709\u4e00\u4e2a\u6700\u57fa\u672c\u7684\u6807\u51c6\uff0c\u5c31\u662f\u770b\u64cd\u4f5c\u7684\u590d\u6742\u5ea6\u662f\u5426\u4e3a O(N) \u3002 Redis \u4e2d\u6d89\u53ca\u96c6\u5408\u7684\u64cd\u4f5c\u590d\u6742\u5ea6\u901a\u5e38\u4e3a O(N) \u4f8b\u5982\u96c6\u5408\u5143\u7d20\u5168\u91cf\u67e5\u8be2\u64cd\u4f5c HGETALL \u3001 SMEMBERS \uff0c\u4ee5\u53ca\u96c6\u5408\u7684\u805a\u5408\u7edf\u8ba1\u64cd\u4f5c\uff0c\u4f8b\u5982\u6c42\u4ea4\u3001\u5e76\u548c\u5dee\u96c6\u3002\u8fd9\u4e9b\u64cd\u4f5c\u53ef\u4ee5\u4f5c\u4e3a Redis \u7684\u7b2c\u4e00\u4e2a\u963b\u585e\u70b9\uff1a \u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\u3002 1-2 \u96c6\u5408\u5220\u9664\u5bfc\u81f4\u963b\u585e\u98ce\u9669 \u5220\u9664\u64cd\u4f5c\u7684\u672c\u8d28\u662f\u8981\u91ca\u653e\u952e\u503c\u5bf9\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4 \u91ca\u653e\u5185\u5b58\u53ea\u662f\u7b2c\u4e00\u6b65\uff0c\u4e3a\u4e86\u66f4\u52a0\u9ad8\u6548\u5730\u7ba1\u7406\u5185\u5b58\u7a7a\u95f4\uff0c\u5728\u5e94\u7528\u7a0b\u5e8f\u91ca\u653e\u5185\u5b58\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u628a\u91ca\u653e\u6389\u7684\u5185\u5b58\u5757\u63d2\u5165\u4e00\u4e2a\u7a7a\u95f2\u5185\u5b58\u5757\u7684\u94fe\u8868\uff0c\u4ee5\u4fbf\u540e\u7eed\u8fdb\u884c\u7ba1\u7406\u548c\u518d\u5206\u914d\u3002 \u8fd9\u4e2a\u8fc7\u7a0b\u672c\u8eab\u9700\u8981\u4e00\u5b9a\u65f6\u95f4\uff0c\u800c\u4e14\u4f1a\u963b\u585e\u5f53\u524d\u91ca\u653e\u5185\u5b58\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u6240\u4ee5\uff0c\u5982\u679c\u4e00\u4e0b\u5b50\u91ca\u653e\u4e86\u5927\u91cf\u5185\u5b58\uff0c\u7a7a\u95f2\u5185\u5b58\u5757\u94fe\u8868\u64cd\u4f5c\u65f6\u95f4\u5c31\u4f1a\u589e\u52a0\uff0c\u76f8\u5e94\u5730\u5c31\u4f1a\u9020\u6210 Redis \u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\u3002 \u4ec0\u4e48\u65f6\u5019\u4f1a\u91ca\u653e\u5927\u91cf\u5185\u5b58\u5462\uff1f \u5176\u5b9e\u5c31\u662f\u5728\u5220\u9664\u5927\u91cf\u952e\u503c\u5bf9\u6570\u636e\u7684\u65f6\u5019\uff0c\u6700\u5178\u578b\u7684\u5c31\u662f\u5220\u9664\u5305\u542b\u4e86\u5927\u91cf\u5143\u7d20\u7684\u96c6\u5408\uff0c\u4e5f\u79f0\u4e3a bigkey \u5220\u9664\u3002\u4e3a\u4e86\u8ba9\u4f60\u5bf9 bigkey \u7684\u5220\u9664\u6027\u80fd\u6709\u4e00\u4e2a\u76f4\u89c2\u7684\u5370\u8c61\uff0c \u6211\u6d4b\u8bd5\u4e86\u4e0d\u540c\u5143\u7d20\u6570\u91cf\u7684\u96c6\u5408\u5728\u8fdb\u884c\u5220\u9664\u64cd\u4f5c\u65f6\u6240\u6d88\u8017\u7684\u65f6\u95f4\uff0c\u5982\u4e0b\u8868\u6240\u793a \uff1a \u4ece\u8fd9\u5f20\u8868\u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\u4e09\u4e2a\u7ed3\u8bba\uff1a \u5f53\u5143\u7d20\u6570\u91cf\u4ece 10 \u4e07\u589e\u52a0\u5230 100 \u4e07\u65f6\uff0c4 \u5927\u96c6\u5408\u7c7b\u578b\u7684\u5220\u9664\u65f6\u95f4\u7684\u589e\u957f\u5e45\u5ea6\u4ece 5 \u500d\u4e0a\u5347\u5230\u4e86\u8fd1 20 \u500d\uff1b \u96c6\u5408\u5143\u7d20\u8d8a\u5927\uff0c\u5220\u9664\u6240\u82b1\u8d39\u7684\u65f6\u95f4\u5c31\u8d8a\u957f\uff1b \u5f53\u5220\u9664\u6709 100 \u4e07\u4e2a\u5143\u7d20\u7684\u96c6\u5408\u65f6\uff0c\u6700\u5927\u7684\u5220\u9664\u65f6\u95f4\u7edd\u5bf9\u503c\u5df2\u7ecf\u8fbe\u5230\u4e86 1.98s\uff08Hash \u7c7b\u578b\uff09\u3002Redis \u7684\u54cd\u5e94\u65f6\u95f4\u4e00\u822c\u5728\u5fae\u79d2\u7ea7\u522b\uff0c\u6240\u4ee5\uff0c\u4e00\u4e2a\u64cd\u4f5c\u8fbe\u5230\u4e86\u8fd1 2s\uff0c\u4e0d\u53ef\u907f\u514d\u5730\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002 bigkey \u5220\u9664\u64cd\u4f5c\u5c31\u662f Redis \u7684\u7b2c\u4e8c\u4e2a\u963b\u585e\u70b9 \u3002\u5220\u9664\u64cd\u4f5c\u5bf9 Redis \u5b9e\u4f8b\u6027\u80fd\u7684\u8d1f\u9762\u5f71\u54cd\u5f88\u5927\uff0c\u800c\u4e14\u5728\u5b9e\u9645\u4e1a\u52a1\u5f00\u53d1\u65f6\u5bb9\u6613\u88ab\u5ffd\u7565\uff0c\u6240\u4ee5\u4e00\u5b9a\u8981\u91cd\u89c6\u5b83 \u65e2\u7136\u9891\u7e41\u5220\u9664\u952e\u503c\u5bf9\u90fd\u662f\u6f5c\u5728\u7684\u963b\u585e\u70b9\u4e86\uff0c\u90a3\u4e48\uff0c\u5728 Redis \u7684\u6570\u636e\u5e93\u7ea7\u522b\u64cd\u4f5c\u4e2d\uff0c\u6e05\u7a7a\u6570\u636e\u5e93\uff08\u4f8b\u5982 FLUSHDB \u548c FLUSHALL \u64cd\u4f5c\uff09\u5fc5\u7136\u4e5f\u662f\u4e00\u4e2a\u6f5c\u5728\u7684\u963b\u585e\u98ce\u9669\uff0c\u56e0\u4e3a \u5b83\u6d89\u53ca\u5230\u5220\u9664\u548c\u91ca\u653e\u6240\u6709\u7684\u952e\u503c\u5bf9\u3002 \u6240\u4ee5\uff0c\u8fd9\u5c31\u662f Redis \u7684\u7b2c\u4e09\u4e2a\u963b\u585e\u70b9\uff1a\u6e05\u7a7a\u6570\u636e\u5e93 \u3002 1-3 \u548c\u78c1\u76d8\u4ea4\u4e92\u65f6\u7684\u963b\u585e\u70b9 Redis \u4e0e\u78c1\u76d8\u7684\u4ea4\u4e92\u5355\u72ec\u5217\u4e3a\u4e00\u7c7b\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u78c1\u76d8 IO \u4e00\u822c\u90fd\u662f\u6bd4\u8f83\u8d39\u65f6\u8d39\u529b Redis \u5f00\u53d1\u8005\u65e9\u5df2\u8ba4\u8bc6\u5230\u78c1\u76d8 IO \u4f1a\u5e26\u6765\u963b\u585e\uff0c \u6240\u4ee5\u5c31\u628a Redis \u8fdb\u4e00\u6b65\u8bbe\u8ba1\u4e3a\u91c7\u7528\u5b50\u8fdb\u7a0b\u7684\u65b9\u5f0f\u751f\u6210 RDB \u5feb\u7167\u6587\u4ef6\uff0c\u4ee5\u53ca\u6267\u884c AOF \u65e5\u5fd7\u91cd\u5199\u64cd\u4f5c \u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7531\u5b50\u8fdb\u7a0b\u8d1f\u8d23\u6267\u884c\uff0c\u6162\u901f\u7684\u78c1\u76d8 IO \u5c31\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u4e86\u3002 Redis \u76f4\u63a5\u8bb0\u5f55 AOF \u65e5\u5fd7\u65f6\uff0c \u4f1a\u6839\u636e\u4e0d\u540c\u7684\u5199\u56de\u7b56\u7565\u5bf9\u6570\u636e\u505a\u843d\u76d8\u4fdd\u5b58 \u3002 \u4e00\u4e2a\u540c\u6b65\u5199\u78c1\u76d8\u7684\u64cd\u4f5c\u7684\u8017\u65f6\u5927\u7ea6\u662f 1\uff5e2ms \uff0c\u5982\u679c\u6709\u5927\u91cf\u7684\u5199\u64cd\u4f5c\u9700\u8981\u8bb0\u5f55\u5728 AOF \u65e5\u5fd7\u4e2d\uff0c\u5e76\u540c\u6b65\u5199\u56de\u7684\u8bdd\uff0c\u5c31\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u4e86 \u3002 Redis \u7684\u7b2c\u56db\u4e2a\u963b\u585e\u70b9\u4e86\uff1aAOF \u65e5\u5fd7\u540c\u6b65\u5199 AOF\u65e5\u5fd7\u7684\u540c\u6b65\u5199\u3002 fork\u5b50\u8fdb\u7a0b\u4e5f\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b 1-4 \u4e3b\u4ece\u8282\u70b9\u4ea4\u4e92\u65f6\u7684\u963b\u585e\u70b9 \u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c\u4e3b\u5e93\u9700\u8981\u751f\u6210 RDB \u6587\u4ef6\uff0c\u5e76\u4f20\u8f93\u7ed9\u4ece\u5e93\u3002 \u4e3b\u5e93\u5728\u590d\u5236\u7684\u8fc7\u7a0b\u4e2d\uff0c\u521b\u5efa\u548c\u4f20\u8f93 RDB \u6587\u4ef6\u90fd\u662f\u7531\u5b50\u8fdb\u7a0b\u6765\u5b8c\u6210\u7684\uff0c\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b \u3002 \u4f46\u662f\uff0c\u5bf9\u4e8e\u4ece\u5e93\u6765\u8bf4\uff0c\u5b83\u5728\u63a5\u6536\u4e86 RDB \u6587\u4ef6\u540e\uff0c\u9700\u8981\u4f7f\u7528 FLUSHDB \u547d\u4ee4\u6e05\u7a7a\u5f53\u524d\u6570\u636e\u5e93\uff0c\u8fd9\u5c31\u6b63\u597d\u649e\u4e0a\u4e86\u521a\u624d\u6211\u4eec\u5206\u6790\u7684\u7b2c\u4e09\u4e2a\u963b\u585e\u70b9\u3002 \u6b64\u5916\uff0c\u4ece\u5e93\u5728\u6e05\u7a7a\u5f53\u524d\u6570\u636e\u5e93\u540e\uff0c\u8fd8\u9700\u8981\u628a RDB \u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u5feb\u6162\u548c RDB \u6587\u4ef6\u7684\u5927\u5c0f\u5bc6\u5207\u76f8\u5173\uff0c RDB \u6587\u4ef6\u8d8a\u5927\uff0c\u52a0\u8f7d\u8fc7\u7a0b\u8d8a\u6162 \uff0c\u6240\u4ee5\uff0c \u52a0\u8f7d RDB \u6587\u4ef6\u5c31\u6210\u4e3a\u4e86 Redis \u7684\u7b2c\u4e94\u4e2a\u963b\u585e\u70b9\u3002 1-5 \u5207\u7247\u96c6\u7fa4\u5b9e\u4f8b\u4ea4\u4e92\u65f6\u7684\u963b\u585e\u70b9 \u6700\u540e\uff0c\u5f53\u6211\u4eec\u90e8\u7f72 Redis \u5207\u7247\u96c6\u7fa4\u65f6\uff0c\u6bcf\u4e2a Redis \u5b9e\u4f8b\u4e0a\u5206\u914d\u7684\u54c8\u5e0c\u69fd\u4fe1\u606f\u9700\u8981\u5728\u4e0d\u540c\u5b9e\u4f8b\u95f4\u8fdb\u884c\u4f20\u9012\uff0c\u540c\u65f6\uff0c\u5f53\u9700\u8981\u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\u6216\u8005\u6709\u5b9e\u4f8b\u589e\u5220\u65f6\uff0c\u6570\u636e\u4f1a\u5728\u4e0d\u540c\u7684\u5b9e\u4f8b\u95f4\u8fdb\u884c\u8fc1\u79fb\u3002\u4e0d\u8fc7\uff0c\u54c8\u5e0c\u69fd\u7684\u4fe1\u606f\u91cf\u4e0d\u5927\uff0c\u800c\u6570\u636e\u8fc1\u79fb\u662f\u6e10\u8fdb\u5f0f\u6267\u884c\u7684\uff0c\u6240\u4ee5\uff0c\u4e00\u822c\u6765\u8bf4\uff0c\u8fd9\u4e24\u7c7b\u64cd\u4f5c\u5bf9 Redis \u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\u98ce\u9669\u4e0d\u5927\u3002 \u4e0d\u8fc7\uff0c\u5982\u679c\u4f60\u4f7f\u7528\u4e86 Redis Cluster \u65b9\u6848\uff0c\u800c\u4e14\u540c\u65f6\u6b63\u597d\u8fc1\u79fb\u7684\u662f bigkey \u7684\u8bdd\uff0c\u5c31\u4f1a\u9020\u6210\u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\uff0c\u56e0\u4e3a Redis Cluster \u4f7f\u7528\u4e86\u540c\u6b65\u8fc1\u79fb \u7b2c\u516d\u4e2a\u963b\u585e\u70b9\uff1a\u5728Redis Cluster\u65b9\u6848\uff0c\u540c\u65f6\u6b63\u597d\u8fc1\u79fb\u7684\u662fbigkey\u7684\u8bdd\uff0c\u5c31\u4f1a\u9020\u6210\u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\uff0c\u56e0\u4e3aRedis Cluster\u4f7f\u7528\u4e86\u540c\u6b65\u8fc1\u79fb\u3002 \u4e94\u4e2a\u963b\u585e\u70b9\uff1a \u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\uff1b bigkey \u5220\u9664\uff1b \u6e05\u7a7a\u6570\u636e\u5e93\uff1b AOF \u65e5\u5fd7\u540c\u6b65\u5199\uff1b \u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6\u3002 \u5982\u679c\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\u8fd9\u4e9b\u64cd\u4f5c\uff0c\u5fc5\u7136\u4f1a\u5bfc\u81f4\u4e3b\u7ebf\u7a0b\u957f\u65f6\u95f4\u65e0\u6cd5\u670d\u52a1\u5176\u4ed6\u8bf7\u6c42\u3002 \u4e3a\u4e86\u907f\u514d\u963b\u585e\u5f0f\u64cd\u4f5c\uff0cRedis \u63d0\u4f9b\u4e86\u5f02\u6b65\u7ebf\u7a0b\u673a\u5236\u3002 \u6240\u8c13\u7684\u5f02\u6b65\u7ebf\u7a0b\u673a\u5236\uff0c\u5c31\u662f\u6307\uff0cRedis \u4f1a\u542f\u52a8\u4e00\u4e9b\u5b50\u7ebf\u7a0b\uff0c\u7136\u540e\u628a\u4e00\u4e9b\u4efb\u52a1\u4ea4\u7ed9\u8fd9\u4e9b\u5b50\u7ebf\u7a0b\uff0c\u8ba9\u5b83\u4eec\u5728\u540e\u53f0\u5b8c\u6210\uff0c\u800c\u4e0d\u518d\u7531\u4e3b\u7ebf\u7a0b\u6765\u6267\u884c\u8fd9\u4e9b\u4efb\u52a1\u3002\u4f7f\u7528\u5f02\u6b65\u7ebf\u7a0b\u673a\u5236\u6267\u884c\u64cd\u4f5c\uff0c\u53ef\u4ee5\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002 2\u3001\u54ea\u4e9b\u963b\u585e\u70b9\u53ef\u4ee5\u5f02\u6b65\u6267\u884c\uff1f \u5982\u679c\u4e00\u4e2a\u64cd\u4f5c\u80fd\u88ab\u5f02\u6b65\u6267\u884c\uff0c\u5c31\u610f\u5473\u7740\uff0c\u5b83\u5e76\u4e0d\u662f Redis \u4e3b\u7ebf\u7a0b\u7684 \u5173\u952e\u8def\u5f84 (critical path )\u4e0a\u7684\u64cd\u4f5c\u3002 \u5ba2\u6237\u7aef\u628a\u8bf7\u6c42\u53d1\u9001\u7ed9 Redis \u540e\uff0c\u7b49\u7740 Redis \u8fd4\u56de\u6570\u636e\u7ed3\u679c\u7684\u64cd\u4f5c\u3002 \u4e3b\u7ebf\u7a0b\u63a5\u6536\u5230\u64cd\u4f5c 1 \u540e\uff0c\u56e0\u4e3a\u64cd\u4f5c 1 \u5e76\u4e0d\u7528\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u5177\u4f53\u7684\u6570\u636e\uff0c\u6240\u4ee5\uff0c\u4e3b\u7ebf\u7a0b\u53ef\u4ee5\u628a\u5b83\u4ea4\u7ed9\u540e\u53f0\u5b50\u7ebf\u7a0b\u6765\u5b8c\u6210\uff0c\u540c\u65f6\u53ea\u8981\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u4e00\u4e2a\u201cOK\u201d\u7ed3\u679c\u5c31\u884c\u3002 \u5728\u5b50\u7ebf\u7a0b\u6267\u884c\u64cd\u4f5c 1 \u7684\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\u53c8\u5411 Redis \u5b9e\u4f8b\u53d1\u9001\u4e86\u64cd\u4f5c 2\uff0c\u800c\u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u662f\u9700\u8981\u4f7f\u7528\u64cd\u4f5c 2 \u8fd4\u56de\u7684\u6570\u636e\u7ed3\u679c\u7684\uff0c\u5982\u679c\u64cd\u4f5c 2 \u4e0d\u8fd4\u56de\u7ed3\u679c\uff0c\u90a3\u4e48\uff0c\u5ba2\u6237\u7aef\u5c06\u4e00\u76f4\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u3002 \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u64cd\u4f5c 1 \u5c31\u4e0d\u7b97\u5173\u952e\u8def\u5f84\u4e0a\u7684\u64cd\u4f5c\uff0c\u56e0\u4e3a\u5b83\u4e0d\u7528\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u5177\u4f53\u6570\u636e\uff0c\u6240\u4ee5\u53ef\u4ee5\u7531\u540e\u53f0\u5b50\u7ebf\u7a0b\u5f02\u6b65\u6267\u884c\u3002 \u800c\u64cd\u4f5c 2 \u9700\u8981\u628a\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u5b83\u5c31\u662f\u5173\u952e\u8def\u5f84\u4e0a\u7684\u64cd\u4f5c\uff0c\u6240\u4ee5\u4e3b\u7ebf\u7a0b\u5fc5\u987b\u7acb\u5373\u628a\u8fd9\u4e2a\u64cd\u4f5c\u6267\u884c\u5b8c\u3002 2-1 \u8bfb\u64cd\u4f5c \u5bf9\u4e8e Redis \u6765\u8bf4\uff0c\u8bfb\u64cd\u4f5c\u662f\u5178\u578b\u7684\u5173\u952e\u8def\u5f84\u64cd\u4f5c \uff0c\u56e0\u4e3a\u5ba2\u6237\u7aef\u53d1\u9001\u4e86\u8bfb\u64cd\u4f5c\u4e4b\u540e\uff0c\u5c31\u4f1a\u7b49\u5f85\u8bfb\u53d6\u7684\u6570\u636e\u8fd4\u56de\uff0c\u4ee5\u4fbf\u8fdb\u884c\u540e\u7eed\u7684\u6570\u636e\u5904\u7406\u3002 \u800c Redis \u7684\u7b2c\u4e00\u4e2a\u963b\u585e\u70b9\u201c\u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\u201d\u90fd\u6d89\u53ca\u5230\u4e86\u8bfb\u64cd\u4f5c\uff0c\u6240\u4ee5\uff0c\u5b83\u4eec\u662f\u4e0d\u80fd\u8fdb\u884c\u5f02\u6b65\u64cd\u4f5c\u4e86\u3002 2-2 \u5220\u9664\u64cd\u4f5c \u5220\u9664\u64cd\u4f5c\u5e76\u4e0d\u9700\u8981\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u5177\u4f53\u7684\u6570\u636e\u7ed3\u679c\uff0c\u6240\u4ee5\u4e0d\u7b97\u662f\u5173\u952e\u8def\u5f84\u64cd\u4f5c \u800c\u7b2c\u4e8c\u4e2a\u963b\u585e\u70b9\u201cbigkey \u5220\u9664\u201d\uff0c\u548c\u7b2c\u4e09\u4e2a\u963b\u585e\u70b9\u201c\u6e05\u7a7a\u6570\u636e\u5e93\u201d\uff0c\u90fd\u662f\u5bf9\u6570\u636e\u505a\u5220\u9664\uff0c\u5e76\u4e0d\u5728\u5173\u952e\u8def\u5f84\u4e0a\u3002\u56e0\u6b64\uff0c\u53ef\u4ee5\u4f7f\u7528\u540e\u53f0\u5b50\u7ebf\u7a0b\u6765\u5f02\u6b65\u6267\u884c\u5220\u9664\u64cd\u4f5c\u3002 2-3 AOF \u65e5\u5fd7\u540c\u6b65\u5199 \u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\uff0cRedis \u5b9e\u4f8b\u9700\u8981\u4fdd\u8bc1 AOF \u65e5\u5fd7\u4e2d\u7684\u64cd\u4f5c\u8bb0\u5f55\u5df2\u7ecf\u843d\u76d8\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u867d\u7136\u9700\u8981\u5b9e\u4f8b\u7b49\u5f85\uff0c\u4f46\u5b83\u5e76\u4e0d\u4f1a\u8fd4\u56de\u5177\u4f53\u7684\u6570\u636e\u7ed3\u679c\u7ed9\u5b9e\u4f8b\u3002 \u6240\u4ee5\uff0c\u4e5f\u53ef\u4ee5\u542f\u52a8\u4e00\u4e2a\u5b50\u7ebf\u7a0b\u6765\u6267\u884c AOF \u65e5\u5fd7\u7684\u540c\u6b65\u5199\uff0c\u800c\u4e0d\u7528\u8ba9\u4e3b\u7ebf\u7a0b\u7b49\u5f85 AOF \u65e5\u5fd7\u7684\u5199\u5b8c\u6210 2-4 \u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6 \u4ece\u5e93\u8981\u60f3\u5bf9\u5ba2\u6237\u7aef\u63d0\u4f9b\u6570\u636e\u5b58\u53d6\u670d\u52a1\uff0c\u5c31\u5fc5\u987b\u628a RDB \u6587\u4ef6\u52a0\u8f7d\u5b8c\u6210 \u3002 \u6240\u4ee5\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u4e5f\u5c5e\u4e8e\u5173\u952e\u8def\u5f84\u4e0a\u7684\u64cd\u4f5c\uff0c\u6211\u4eec\u5fc5\u987b\u8ba9\u4ece\u5e93\u7684\u4e3b\u7ebf\u7a0b\u6765\u6267\u884c\u3002 \u5bf9\u4e8e Redis \u7684\u4e94\u5927\u963b\u585e\u70b9\u6765\u8bf4\uff0c\u9664\u4e86\u201c\u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\u201d\u548c\u201c\u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6\u201d\uff0c\u5176\u4ed6\u4e09\u4e2a\u963b\u585e\u70b9\u6d89\u53ca\u7684\u64cd\u4f5c\u90fd\u4e0d\u5728\u5173\u952e\u8def\u5f84\u4e0a\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Redis \u7684\u5f02\u6b65\u5b50\u7ebf\u7a0b\u673a\u5236\u6765\u5b9e\u73b0 bigkey \u5220\u9664\uff0c\u6e05\u7a7a\u6570\u636e\u5e93\uff0c\u4ee5\u53ca AOF \u65e5\u5fd7\u540c\u6b65\u5199\u3002 \u5173\u952e\u8def\u5f84\u64cd\u4f5c\uff1a\u96c6\u5408\u7684\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\u3001\u4ece\u5e93\u52a0\u8f7dRDB\u6587\u4ef6 \u975e\u5173\u952e\u8def\u5f84\u64cd\u4f5c\uff1abigkey\u7684\u5220\u9664\u3001\u6e05\u7a7a\u6570\u636e\u5e93\u3001AOF\u65e5\u5fd7\u7684\u540c\u6b65\u5199 3\u3001\u5f02\u6b65\u7684\u5b50\u7ebf\u7a0b\u673a\u5236 Redis \u4e3b\u7ebf\u7a0b\u542f\u52a8\u540e\uff0c \u4f1a\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684 pthread_create \u51fd\u6570\u521b\u5efa 3 \u4e2a\u5b50\u7ebf\u7a0b \uff0c\u5206\u522b\u7531 \u5b83\u4eec\u8d1f\u8d23 AOF \u65e5\u5fd7\u5199\u64cd\u4f5c\u3001\u952e\u503c\u5bf9\u5220\u9664\u4ee5\u53ca\u6587\u4ef6\u5173\u95ed\u7684\u5f02\u6b65\u6267\u884c \u3002 \u4e3b\u7ebf\u7a0b\u901a\u8fc7\u4e00\u4e2a\u94fe\u8868\u5f62\u5f0f\u7684\u4efb\u52a1\u961f\u5217\u548c\u5b50\u7ebf\u7a0b\u8fdb\u884c\u4ea4\u4e92\u3002 \u5f53\u6536\u5230\u952e\u503c\u5bf9\u5220\u9664\u548c\u6e05\u7a7a\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u628a\u8fd9\u4e2a\u64cd\u4f5c\u5c01\u88c5\u6210\u4e00\u4e2a\u4efb\u52a1\uff0c\u653e\u5165\u5230\u4efb\u52a1\u961f\u5217\u4e2d\uff0c\u7136\u540e\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u4e00\u4e2a\u5b8c\u6210\u4fe1\u606f\uff0c\u8868\u660e\u5220\u9664\u5df2\u7ecf\u5b8c\u6210\u3002 \u4f46\u5b9e\u9645\u4e0a\uff0c \u8fd9\u4e2a\u65f6\u5019\u5220\u9664\u8fd8\u6ca1\u6709\u6267\u884c\uff0c\u7b49\u5230\u540e\u53f0\u5b50\u7ebf\u7a0b\u4ece\u4efb\u52a1\u961f\u5217\u4e2d\u8bfb\u53d6\u4efb\u52a1\u540e\uff0c\u624d\u5f00\u59cb\u5b9e\u9645\u5220\u9664\u952e\u503c\u5bf9\uff0c\u5e76\u91ca\u653e\u76f8\u5e94\u7684\u5185\u5b58\u7a7a\u95f4 \u3002\u56e0\u6b64\uff0c \u6211\u4eec\u628a\u8fd9\u79cd\u5f02\u6b65\u5220\u9664\u4e5f\u79f0\u4e3a\u60f0\u6027\u5220\u9664\uff08lazy free\uff09\u3002\u6b64\u65f6\uff0c\u5220\u9664\u6216\u6e05\u7a7a\u64cd\u4f5c\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u8fd9\u5c31\u907f\u514d\u4e86\u5bf9\u4e3b\u7ebf\u7a0b\u7684\u6027\u80fd\u5f71\u54cd\u3002 \u548c\u60f0\u6027\u5220\u9664\u7c7b\u4f3c\uff0c\u5f53 AOF \u65e5\u5fd7\u914d\u7f6e\u6210 everysec \u9009\u9879\u540e\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u628a AOF \u5199\u65e5\u5fd7\u64cd\u4f5c\u5c01\u88c5\u6210\u4e00\u4e2a\u4efb\u52a1\uff0c\u4e5f\u653e\u5230\u4efb\u52a1\u961f\u5217\u4e2d\u3002 \u540e\u53f0\u5b50\u7ebf\u7a0b\u8bfb\u53d6\u4efb\u52a1\u540e\uff0c\u5f00\u59cb\u81ea\u884c\u5199\u5165 AOF \u65e5\u5fd7\uff0c\u8fd9\u6837\u4e3b\u7ebf\u7a0b\u5c31\u4e0d\u7528\u4e00\u76f4\u7b49\u5f85 AOF \u65e5\u5fd7\u5199\u5b8c\u4e86\u3002 \u5f02\u6b65\u7684\u952e\u503c\u5bf9\u5220\u9664\u548c\u6570\u636e\u5e93\u6e05\u7a7a\u64cd\u4f5c\u662f Redis 4.0 \u540e\u63d0\u4f9b\u7684\u529f\u80fd \uff0cRedis \u4e5f\u63d0\u4f9b\u4e86\u65b0\u7684\u547d\u4ee4\u6765\u6267\u884c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u3002 \u952e\u503c\u5bf9\u5220\u9664\uff1a\u5f53\u4f60\u7684\u96c6\u5408\u7c7b\u578b\u4e2d\u6709\u5927\u91cf\u5143\u7d20\uff08\u4f8b\u5982\u6709\u767e\u4e07\u7ea7\u522b\u6216\u5343\u4e07\u7ea7\u522b\u5143\u7d20\uff09\u9700\u8981\u5220\u9664\u65f6\uff0c\u6211\u5efa\u8bae\u4f60\u4f7f\u7528 UNLINK \u547d\u4ee4\u3002 \u6e05\u7a7a\u6570\u636e\u5e93\uff1a\u53ef\u4ee5\u5728 FLUSHDB \u548c FLUSHALL \u547d\u4ee4\u540e\u52a0\u4e0a ASYNC \u9009\u9879\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8ba9\u540e\u53f0\u5b50\u7ebf\u7a0b\u5f02\u6b65\u5730\u6e05\u7a7a\u6570\u636e\u5e93\uff0c\u5982\u4e0b\u6240\u793a\uff1a FLUSHDB ASYNC FLUSHALL AYSNC 4\u3001\u672c\u8282\u5c0f\u7ed3 Redis \u5b9e\u4f8b\u8fd0\u884c\u65f6\u7684 4 \u5927\u7c7b\u4ea4\u4e92\u5bf9\u8c61\uff1a \u5ba2\u6237\u7aef\u3001\u78c1\u76d8\u3001\u4e3b\u4ece\u5e93\u5b9e\u4f8b\u3001\u5207\u7247\u96c6\u7fa4\u5b9e\u4f8b \u3002 \u57fa\u4e8e\u8fd9 4 \u5927\u7c7b\u4ea4\u4e92\u5bf9\u8c61\uff0c\u6211\u4eec\u68b3\u7406\u4e86\u4f1a\u5bfc\u81f4 Redis \u6027\u80fd\u53d7\u635f\u7684 5 \u5927\u963b\u585e\u70b9\uff0c\u5305\u62ec \u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\u3001bigkey \u5220\u9664\u3001\u6e05\u7a7a\u6570\u636e\u5e93\u3001AOF \u65e5\u5fd7\u540c\u6b65\u5199\uff0c\u4ee5\u53ca\u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6 \u3002 \u5728\u8fd9 5 \u5927\u963b\u585e\u70b9\u4e2d\uff0c bigkey \u5220\u9664\u3001\u6e05\u7a7a\u6570\u636e\u5e93\u3001AOF \u65e5\u5fd7\u540c\u6b65\u5199\u4e0d\u5c5e\u4e8e\u5173\u952e\u8def\u5f84\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4f7f\u7528\u5f02\u6b65\u5b50\u7ebf\u7a0b\u673a\u5236\u6765\u5b8c\u6210 \u3002 Redis \u5728\u8fd0\u884c\u65f6\u4f1a\u521b\u5efa\u4e09\u4e2a\u5b50\u7ebf\u7a0b\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u901a\u8fc7\u4e00\u4e2a\u4efb\u52a1\u961f\u5217\u548c\u4e09\u4e2a\u5b50\u7ebf\u7a0b\u8fdb\u884c\u4ea4\u4e92\u3002\u5b50\u7ebf\u7a0b\u4f1a\u6839\u636e\u4efb\u52a1\u7684\u5177\u4f53\u7c7b\u578b\uff0c\u6765\u6267\u884c\u76f8\u5e94\u7684\u5f02\u6b65\u64cd\u4f5c\u3002 \u4e0d\u8fc7\uff0c\u5f02\u6b65\u5220\u9664\u64cd\u4f5c\u662f Redis 4.0 \u4ee5\u540e\u624d\u6709\u7684\u529f\u80fd\uff0c\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f 4.0 \u4e4b\u524d\u7684\u7248\u672c\uff0c\u5f53\u4f60\u9047\u5230 bigkey \u5220\u9664\u65f6\uff1a \u4f7f\u7528\u96c6\u5408\u7c7b\u578b\u63d0\u4f9b\u7684 SCAN \u547d\u4ee4\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540e\u518d\u8fdb\u884c\u5220\u9664\u3002\u56e0\u4e3a\u7528 SCAN \u547d\u4ee4\u53ef\u4ee5\u6bcf\u6b21\u53ea\u8bfb\u53d6\u4e00\u90e8\u5206\u6570\u636e\u5e76\u8fdb\u884c\u5220\u9664\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u4e00\u6b21\u6027\u5220\u9664\u5927\u91cf key \u7ed9\u4e3b\u7ebf\u7a0b\u5e26\u6765\u7684\u963b\u585e \u3002 \u4f8b\u5982\uff0c\u5bf9\u4e8e Hash \u7c7b\u578b\u7684 bigkey \u5220\u9664\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 HSCAN \u547d\u4ee4\uff0c\u6bcf\u6b21\u4ece Hash \u96c6\u5408\u4e2d\u83b7\u53d6\u4e00\u90e8\u5206\u952e\u503c\u5bf9\uff08\u4f8b\u5982 200 \u4e2a\uff09\uff0c\u518d\u4f7f\u7528 HDEL \u5220\u9664\u8fd9\u4e9b\u952e\u503c\u5bf9\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u628a\u5220\u9664\u538b\u529b\u5206\u644a\u5230\u591a\u6b21\u64cd\u4f5c\u4e2d\uff0c\u90a3\u4e48\uff0c\u6bcf\u6b21\u5220\u9664\u64cd\u4f5c\u7684\u8017\u65f6\u5c31\u4e0d\u4f1a\u592a\u957f\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u4e86\u3002 \u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\u3001\u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6\u662f\u5728\u5173\u952e\u8def\u5f84\u4e0a\uff0c\u65e0\u6cd5\u4f7f\u7528\u5f02\u6b65\u64cd\u4f5c\u6765\u5b8c\u6210 \u3002\u5bf9\u4e8e\u8fd9\u4e24\u4e2a\u963b\u585e\u70b9\uff0c\u6211\u4e24\u4e2a\u5c0f\u5efa\u8bae\u3002 \u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\uff1a\u53ef\u4ee5\u4f7f\u7528 SCAN \u547d\u4ee4\uff0c\u5206\u6279\u8bfb\u53d6\u6570\u636e\uff0c\u518d\u5728\u5ba2\u6237\u7aef\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\uff1b \u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6\uff1a\u628a\u4e3b\u5e93\u7684\u6570\u636e\u91cf\u5927\u5c0f\u63a7\u5236\u5728 2~4GB \u5de6\u53f3\uff0c\u4ee5\u4fdd\u8bc1 RDB \u6587\u4ef6\u80fd\u4ee5\u8f83\u5feb\u7684\u901f\u5ea6\u52a0\u8f7d\u3002 \u8981\u70b9&\u4eae\u70b9 \u4e0e\u5ba2\u6237\u7aef\u4ea4\u4e92\u65f6\u7684\u963b\u585e\u70b9\uff1a\u9ad8\u590d\u6742\u5ea6\u7684\u589e\u5220\u6539\u64cd\u4f5c\uff08\u96c6\u5408\u5168\u91cf\u7684\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\uff0cbigKey \u5220\u9664\u64cd\u4f5c\uff0c\u6e05\u7a7a\u6570\u636e\u5e93\uff09 \u4e0e\u78c1\u76d8\u4ea4\u4e92\u7684\u963b\u585e\u70b9\uff1aaof\u65e5\u5fd7\u5b9e\u65f6\u540c\u6b65\u5199\u56de \u4e3b\u4ece\u8282\u70b9\u4ea4\u4e92\u65f6\u7684\u963b\u585e\u70b9\uff1a\u4ece\u5e93\u52a0\u8f7dRDB\u6587\u4ef6 \u5206\u7247\u96c6\u7fa4\u7684\u963b\u585e\u70b9\uff1a\u54c8\u5e0c\u69fdbigkey\u6570\u636e\u8fc1\u79fb \u5173\u952e\u8def\u5f84\u64cd\u4f5c\u6982\u5ff5\uff1a\u5ba2\u6237\u7aef\u628a\u8bf7\u6c42\u53d1\u7ed9Redis\u540e\uff0c\u8981\u7b49\u7740Redis\u8fd4\u56de\u6570\u636e\u7ed3\u679c\u7684\u64cd\u4f5c \u5f02\u6b65\u7684\u5b50\u7ebf\u7a0b\u673a\u5236\uff1a\u4e3b\u7ebf\u7a0b\u901a\u8fc7\u4e00\u4e2a\u94fe\u8868\u5f62\u5f0f\u7684\u4efb\u52a1\u961f\u5217\u548c\u5b50\u7ebf\u7a0b\u8fdb\u884c\u4ea4\u4e92 lazy free \u673a\u5236\uff1aRedis\u6536\u5230\u952e\u503c\u5bf9\u5220\u9664\u548c\u6e05\u7a7a\u6570\u636e\u5e93\u7684\u6307\u4ee4\u65f6\uff0c\u4e3b\u7ebf\u7ebf\u7a0b\u4f1a\u628a\u8fd9\u4e2a\u64cd\u4f5c\u5c01\u88c5\u6210\u4e00\u4e2a\u4efb\u52a1\uff0c\u653e\u5165\u4efb\u52a1\u961f\u5217\u4e2d\uff0c\u7136\u540e\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u4e00\u4e2a\u5b8c\u6210\u4fe1\u606f\uff0c\u4f46\u5b9e\u9645\u4e0a\uff0c\u8fd9\u4e2a\u5220\u9664\u8fd8\u6ca1\u6709\u6267\u884c\uff0c\u9700\u8981\u7b49\u5f85\u540e\u53f0\u5b50\u7ebf\u7a0b\u4ece\u4efb\u52a1\u961f\u5217\u4e2d\u8bfb\u53d6\u5230\u8fd9\u4e2a\u4efb\u52a1\u540e\uff0c\u624d\u5f00\u59cb\u5b9e\u9645\u5220\u9664\u952e\u503c\u5bf9\uff0c\u5e76\u91ca\u653e\u76f8\u5e94\u7684\u5185\u5b58\u7a7a\u95f4\u3002 \u4f46\u662f\uff1a lazy-free \u662f 4.0 \u65b0\u589e\u529f\u80fd\uff0c\u9ed8\u8ba4\u5173\u95ed\u3002\u5f00\u542f\u8fd9\u4e2a\u914d\u7f6e\u540e\uff0c \u9664\u4e86 replica-lazy-flush \u4e4b\u5916\uff0c\u5176\u4ed6\u60c5\u51b5\u90fd\u53ea\u662f \u53ef\u80fd \u53bb\u5f02\u6b65\u91ca\u653e key \u7684\u5185\u5b58\uff0c\u5e76\u4e0d\u662f\u6bcf\u6b21\u5fc5\u5b9a\u5f02\u6b65\u91ca\u653e\u5185\u5b58\u7684\u3002\u662f\u5426\u4f1a\u771f\u6b63\u5f02\u6b65\u91ca\u653e\u5185\u5b58\uff0c\u53d6\u51b3\u4e8e key \u7684\u7c7b\u578b\uff0c\u7f16\u7801\u65b9\u5f0f\uff0c\u5143\u7d20\u6570\u91cf\uff0c\u6240\u4ee5 \u5373\u4f7f\u5f00\u542f\u4e86 lazy-free \uff0c String \u7c7b\u578b\u7684 bigkey \uff0c\u5728\u5220\u9664\u65f6\u4f9d\u65e7\u6709\u963b\u585e\u4e3b\u7ebf\u7a0b\u7684\u98ce\u9669","title":"\u7b2c\u4e00\u8282 Redis\u6709\u54ea\u4e9b\u53ef\u80fd\u5bfc\u81f4\u963b\u585e\u7684\u64cd\u4f5c"},{"location":"chap4/1redis_asyn/#redis","text":"Redis \u4e4b\u6240\u4ee5\u88ab\u5e7f\u6cdb\u5e94\u7528\uff0c\u5f88\u91cd\u8981\u7684\u4e00\u4e2a\u539f\u56e0\u5c31\u662f\u5b83\u652f\u6301\u9ad8\u6027\u80fd\u8bbf\u95ee\u3002\u4e5f\u6b63\u56e0\u4e3a\u8fd9\u6837\uff0c \u6211\u4eec\u5fc5\u987b\u8981\u91cd\u89c6\u6240\u6709\u53ef\u80fd\u5f71\u54cd Redis \u6027\u80fd\u7684\u56e0\u7d20\uff08\u4f8b\u5982\u547d\u4ee4\u64cd\u4f5c\u3001\u7cfb\u7edf\u914d\u7f6e\u3001\u5173\u952e\u673a\u5236\u3001\u786c\u4ef6\u914d\u7f6e\u7b49\uff09 Redis \u6027\u80fd\u7684 5 \u5927\u65b9\u9762\u7684\u6f5c\u5728\u56e0\u7d20 Redis \u5185\u90e8\u7684\u963b\u585e\u5f0f\u64cd\u4f5c\uff1b CPU \u6838\u548c NUMA \u67b6\u6784\u7684\u5f71\u54cd\uff1b Redis \u5173\u952e\u7cfb\u7edf\u914d\u7f6e\uff1b Redis \u5185\u5b58\u788e\u7247\uff1b Redis \u7f13\u51b2\u533a\u3002 Redis \u7684\u7f51\u7edc IO \u548c\u952e\u503c\u5bf9\u8bfb\u5199\u662f\u7531\u4e3b\u7ebf\u7a0b\u5b8c\u6210\u7684\u3002\u90a3\u4e48\uff0c\u5982\u679c\u5728\u4e3b\u7ebf\u7a0b\u4e0a\u6267\u884c\u7684\u64cd\u4f5c\u6d88\u8017\u7684\u65f6\u95f4\u592a\u957f\uff0c\u5c31\u4f1a\u5f15\u8d77\u4e3b\u7ebf\u7a0b\u963b\u585e\u3002 Redis \u65e2\u6709\u670d\u52a1\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u952e\u503c\u5bf9\u589e\u5220\u6539\u67e5\u64cd\u4f5c\uff0c\u4e5f\u6709\u4fdd\u8bc1\u53ef\u9760\u6027\u7684\u6301\u4e45\u5316\u64cd\u4f5c","title":"\u7b2c\u4e00\u8282 Redis\u6709\u54ea\u4e9b\u53ef\u80fd\u5bfc\u81f4\u963b\u585e\u7684\u64cd\u4f5c\uff0c\u4ee5\u53ca\u89e3\u51b3\u673a\u5236"},{"location":"chap4/1redis_asyn/#1redis","text":"Redis \u5b9e\u4f8b\u5728\u8fd0\u884c\u65f6\uff0c\u8981\u548c\u8bb8\u591a\u5bf9\u8c61\u8fdb\u884c\u4ea4\u4e92\uff0c\u8fd9\u4e9b\u4e0d\u540c\u7684\u4ea4\u4e92\u5c31\u4f1a\u6d89\u53ca\u4e0d\u540c\u7684\u64cd\u4f5c\uff0c\u4e0b\u9762\u6211\u4eec\u6765\u770b\u770b\u548c Redis \u5b9e\u4f8b\u4ea4\u4e92\u7684\u5bf9\u8c61\uff0c\u4ee5\u53ca\u4ea4\u4e92\u65f6\u4f1a\u53d1\u751f\u7684\u64cd\u4f5c\u3002 \u5ba2\u6237\u7aef \uff1a\u7f51\u7edc IO\uff0c\u952e\u503c\u5bf9\u589e\u5220\u6539\u67e5\u64cd\u4f5c\uff0c\u6570\u636e\u5e93\u64cd\u4f5c\uff1b \u78c1\u76d8 \uff1a\u751f\u6210 RDB \u5feb\u7167\uff0c\u8bb0\u5f55 AOF \u65e5\u5fd7\uff0cAOF \u65e5\u5fd7\u91cd\u5199\uff1b \u4e3b\u4ece\u8282\u70b9 \uff1a\u4e3b\u5e93\u751f\u6210\u3001\u4f20\u8f93 RDB \u6587\u4ef6\uff0c\u4ece\u5e93\u63a5\u6536 RDB \u6587\u4ef6\u3001\u6e05\u7a7a\u6570\u636e\u5e93\u3001\u52a0\u8f7d RDB \u6587\u4ef6\uff1b \u5207\u7247\u96c6\u7fa4\u5b9e\u4f8b \uff1a\u5411\u5176\u4ed6\u5b9e\u4f8b\u4f20\u8f93\u54c8\u5e0c\u69fd\u4fe1\u606f\uff0c\u6570\u636e\u8fc1\u79fb\u3002","title":"1\u3001Redis \u5b9e\u4f8b\u6709\u54ea\u4e9b\u963b\u585e\u70b9\uff1f"},{"location":"chap4/1redis_asyn/#1-1","text":"\u7f51\u7edc IO \u6709\u65f6\u5019\u4f1a\u6bd4\u8f83\u6162\uff0c\u4f46\u662f Redis \u4f7f\u7528\u4e86 IO \u591a\u8def\u590d\u7528\u673a\u5236\uff0c\u907f\u514d\u4e86\u4e3b\u7ebf\u7a0b\u4e00\u76f4\u5904\u5728\u7b49\u5f85\u7f51\u7edc\u8fde\u63a5\u6216\u8bf7\u6c42\u5230\u6765\u7684\u72b6\u6001\uff0c \u6240\u4ee5\uff0c\u7f51\u7edc IO \u4e0d\u662f\u5bfc\u81f4 Redis \u963b\u585e\u7684\u56e0\u7d20\u3002 \u503c\u5bf9\u7684\u589e\u5220\u6539\u67e5\u64cd\u4f5c\u662f Redis \u548c\u5ba2\u6237\u7aef\u4ea4\u4e92\u7684\u4e3b\u8981\u90e8\u5206\uff0c\u4e5f\u662f Redis \u4e3b\u7ebf\u7a0b\u6267\u884c\u7684\u4e3b\u8981\u4efb\u52a1\u3002 \u6240\u4ee5\uff0c\u590d\u6742\u5ea6\u9ad8\u7684\u589e\u5220\u6539\u67e5\u64cd\u4f5c\u80af\u5b9a\u4f1a\u963b\u585e Redis\u3002 \u600e\u4e48\u5224\u65ad\u64cd\u4f5c\u590d\u6742\u5ea6\u662f\u4e0d\u662f\u9ad8\u5462\uff1f \u8fd9\u91cc\u6709\u4e00\u4e2a\u6700\u57fa\u672c\u7684\u6807\u51c6\uff0c\u5c31\u662f\u770b\u64cd\u4f5c\u7684\u590d\u6742\u5ea6\u662f\u5426\u4e3a O(N) \u3002 Redis \u4e2d\u6d89\u53ca\u96c6\u5408\u7684\u64cd\u4f5c\u590d\u6742\u5ea6\u901a\u5e38\u4e3a O(N) \u4f8b\u5982\u96c6\u5408\u5143\u7d20\u5168\u91cf\u67e5\u8be2\u64cd\u4f5c HGETALL \u3001 SMEMBERS \uff0c\u4ee5\u53ca\u96c6\u5408\u7684\u805a\u5408\u7edf\u8ba1\u64cd\u4f5c\uff0c\u4f8b\u5982\u6c42\u4ea4\u3001\u5e76\u548c\u5dee\u96c6\u3002\u8fd9\u4e9b\u64cd\u4f5c\u53ef\u4ee5\u4f5c\u4e3a Redis \u7684\u7b2c\u4e00\u4e2a\u963b\u585e\u70b9\uff1a \u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\u3002","title":"1-1 \u548c\u5ba2\u6237\u7aef\u4ea4\u4e92\u65f6\u7684\u963b\u585e\u70b9"},{"location":"chap4/1redis_asyn/#1-2","text":"\u5220\u9664\u64cd\u4f5c\u7684\u672c\u8d28\u662f\u8981\u91ca\u653e\u952e\u503c\u5bf9\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4 \u91ca\u653e\u5185\u5b58\u53ea\u662f\u7b2c\u4e00\u6b65\uff0c\u4e3a\u4e86\u66f4\u52a0\u9ad8\u6548\u5730\u7ba1\u7406\u5185\u5b58\u7a7a\u95f4\uff0c\u5728\u5e94\u7528\u7a0b\u5e8f\u91ca\u653e\u5185\u5b58\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u628a\u91ca\u653e\u6389\u7684\u5185\u5b58\u5757\u63d2\u5165\u4e00\u4e2a\u7a7a\u95f2\u5185\u5b58\u5757\u7684\u94fe\u8868\uff0c\u4ee5\u4fbf\u540e\u7eed\u8fdb\u884c\u7ba1\u7406\u548c\u518d\u5206\u914d\u3002 \u8fd9\u4e2a\u8fc7\u7a0b\u672c\u8eab\u9700\u8981\u4e00\u5b9a\u65f6\u95f4\uff0c\u800c\u4e14\u4f1a\u963b\u585e\u5f53\u524d\u91ca\u653e\u5185\u5b58\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u6240\u4ee5\uff0c\u5982\u679c\u4e00\u4e0b\u5b50\u91ca\u653e\u4e86\u5927\u91cf\u5185\u5b58\uff0c\u7a7a\u95f2\u5185\u5b58\u5757\u94fe\u8868\u64cd\u4f5c\u65f6\u95f4\u5c31\u4f1a\u589e\u52a0\uff0c\u76f8\u5e94\u5730\u5c31\u4f1a\u9020\u6210 Redis \u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\u3002 \u4ec0\u4e48\u65f6\u5019\u4f1a\u91ca\u653e\u5927\u91cf\u5185\u5b58\u5462\uff1f \u5176\u5b9e\u5c31\u662f\u5728\u5220\u9664\u5927\u91cf\u952e\u503c\u5bf9\u6570\u636e\u7684\u65f6\u5019\uff0c\u6700\u5178\u578b\u7684\u5c31\u662f\u5220\u9664\u5305\u542b\u4e86\u5927\u91cf\u5143\u7d20\u7684\u96c6\u5408\uff0c\u4e5f\u79f0\u4e3a bigkey \u5220\u9664\u3002\u4e3a\u4e86\u8ba9\u4f60\u5bf9 bigkey \u7684\u5220\u9664\u6027\u80fd\u6709\u4e00\u4e2a\u76f4\u89c2\u7684\u5370\u8c61\uff0c \u6211\u6d4b\u8bd5\u4e86\u4e0d\u540c\u5143\u7d20\u6570\u91cf\u7684\u96c6\u5408\u5728\u8fdb\u884c\u5220\u9664\u64cd\u4f5c\u65f6\u6240\u6d88\u8017\u7684\u65f6\u95f4\uff0c\u5982\u4e0b\u8868\u6240\u793a \uff1a \u4ece\u8fd9\u5f20\u8868\u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\u4e09\u4e2a\u7ed3\u8bba\uff1a \u5f53\u5143\u7d20\u6570\u91cf\u4ece 10 \u4e07\u589e\u52a0\u5230 100 \u4e07\u65f6\uff0c4 \u5927\u96c6\u5408\u7c7b\u578b\u7684\u5220\u9664\u65f6\u95f4\u7684\u589e\u957f\u5e45\u5ea6\u4ece 5 \u500d\u4e0a\u5347\u5230\u4e86\u8fd1 20 \u500d\uff1b \u96c6\u5408\u5143\u7d20\u8d8a\u5927\uff0c\u5220\u9664\u6240\u82b1\u8d39\u7684\u65f6\u95f4\u5c31\u8d8a\u957f\uff1b \u5f53\u5220\u9664\u6709 100 \u4e07\u4e2a\u5143\u7d20\u7684\u96c6\u5408\u65f6\uff0c\u6700\u5927\u7684\u5220\u9664\u65f6\u95f4\u7edd\u5bf9\u503c\u5df2\u7ecf\u8fbe\u5230\u4e86 1.98s\uff08Hash \u7c7b\u578b\uff09\u3002Redis \u7684\u54cd\u5e94\u65f6\u95f4\u4e00\u822c\u5728\u5fae\u79d2\u7ea7\u522b\uff0c\u6240\u4ee5\uff0c\u4e00\u4e2a\u64cd\u4f5c\u8fbe\u5230\u4e86\u8fd1 2s\uff0c\u4e0d\u53ef\u907f\u514d\u5730\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002 bigkey \u5220\u9664\u64cd\u4f5c\u5c31\u662f Redis \u7684\u7b2c\u4e8c\u4e2a\u963b\u585e\u70b9 \u3002\u5220\u9664\u64cd\u4f5c\u5bf9 Redis \u5b9e\u4f8b\u6027\u80fd\u7684\u8d1f\u9762\u5f71\u54cd\u5f88\u5927\uff0c\u800c\u4e14\u5728\u5b9e\u9645\u4e1a\u52a1\u5f00\u53d1\u65f6\u5bb9\u6613\u88ab\u5ffd\u7565\uff0c\u6240\u4ee5\u4e00\u5b9a\u8981\u91cd\u89c6\u5b83 \u65e2\u7136\u9891\u7e41\u5220\u9664\u952e\u503c\u5bf9\u90fd\u662f\u6f5c\u5728\u7684\u963b\u585e\u70b9\u4e86\uff0c\u90a3\u4e48\uff0c\u5728 Redis \u7684\u6570\u636e\u5e93\u7ea7\u522b\u64cd\u4f5c\u4e2d\uff0c\u6e05\u7a7a\u6570\u636e\u5e93\uff08\u4f8b\u5982 FLUSHDB \u548c FLUSHALL \u64cd\u4f5c\uff09\u5fc5\u7136\u4e5f\u662f\u4e00\u4e2a\u6f5c\u5728\u7684\u963b\u585e\u98ce\u9669\uff0c\u56e0\u4e3a \u5b83\u6d89\u53ca\u5230\u5220\u9664\u548c\u91ca\u653e\u6240\u6709\u7684\u952e\u503c\u5bf9\u3002 \u6240\u4ee5\uff0c\u8fd9\u5c31\u662f Redis \u7684\u7b2c\u4e09\u4e2a\u963b\u585e\u70b9\uff1a\u6e05\u7a7a\u6570\u636e\u5e93 \u3002","title":"1-2 \u96c6\u5408\u5220\u9664\u5bfc\u81f4\u963b\u585e\u98ce\u9669"},{"location":"chap4/1redis_asyn/#1-3","text":"Redis \u4e0e\u78c1\u76d8\u7684\u4ea4\u4e92\u5355\u72ec\u5217\u4e3a\u4e00\u7c7b\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u78c1\u76d8 IO \u4e00\u822c\u90fd\u662f\u6bd4\u8f83\u8d39\u65f6\u8d39\u529b Redis \u5f00\u53d1\u8005\u65e9\u5df2\u8ba4\u8bc6\u5230\u78c1\u76d8 IO \u4f1a\u5e26\u6765\u963b\u585e\uff0c \u6240\u4ee5\u5c31\u628a Redis \u8fdb\u4e00\u6b65\u8bbe\u8ba1\u4e3a\u91c7\u7528\u5b50\u8fdb\u7a0b\u7684\u65b9\u5f0f\u751f\u6210 RDB \u5feb\u7167\u6587\u4ef6\uff0c\u4ee5\u53ca\u6267\u884c AOF \u65e5\u5fd7\u91cd\u5199\u64cd\u4f5c \u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7531\u5b50\u8fdb\u7a0b\u8d1f\u8d23\u6267\u884c\uff0c\u6162\u901f\u7684\u78c1\u76d8 IO \u5c31\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u4e86\u3002 Redis \u76f4\u63a5\u8bb0\u5f55 AOF \u65e5\u5fd7\u65f6\uff0c \u4f1a\u6839\u636e\u4e0d\u540c\u7684\u5199\u56de\u7b56\u7565\u5bf9\u6570\u636e\u505a\u843d\u76d8\u4fdd\u5b58 \u3002 \u4e00\u4e2a\u540c\u6b65\u5199\u78c1\u76d8\u7684\u64cd\u4f5c\u7684\u8017\u65f6\u5927\u7ea6\u662f 1\uff5e2ms \uff0c\u5982\u679c\u6709\u5927\u91cf\u7684\u5199\u64cd\u4f5c\u9700\u8981\u8bb0\u5f55\u5728 AOF \u65e5\u5fd7\u4e2d\uff0c\u5e76\u540c\u6b65\u5199\u56de\u7684\u8bdd\uff0c\u5c31\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u4e86 \u3002 Redis \u7684\u7b2c\u56db\u4e2a\u963b\u585e\u70b9\u4e86\uff1aAOF \u65e5\u5fd7\u540c\u6b65\u5199 AOF\u65e5\u5fd7\u7684\u540c\u6b65\u5199\u3002 fork\u5b50\u8fdb\u7a0b\u4e5f\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b","title":"1-3 \u548c\u78c1\u76d8\u4ea4\u4e92\u65f6\u7684\u963b\u585e\u70b9"},{"location":"chap4/1redis_asyn/#1-4","text":"\u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c\u4e3b\u5e93\u9700\u8981\u751f\u6210 RDB \u6587\u4ef6\uff0c\u5e76\u4f20\u8f93\u7ed9\u4ece\u5e93\u3002 \u4e3b\u5e93\u5728\u590d\u5236\u7684\u8fc7\u7a0b\u4e2d\uff0c\u521b\u5efa\u548c\u4f20\u8f93 RDB \u6587\u4ef6\u90fd\u662f\u7531\u5b50\u8fdb\u7a0b\u6765\u5b8c\u6210\u7684\uff0c\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b \u3002 \u4f46\u662f\uff0c\u5bf9\u4e8e\u4ece\u5e93\u6765\u8bf4\uff0c\u5b83\u5728\u63a5\u6536\u4e86 RDB \u6587\u4ef6\u540e\uff0c\u9700\u8981\u4f7f\u7528 FLUSHDB \u547d\u4ee4\u6e05\u7a7a\u5f53\u524d\u6570\u636e\u5e93\uff0c\u8fd9\u5c31\u6b63\u597d\u649e\u4e0a\u4e86\u521a\u624d\u6211\u4eec\u5206\u6790\u7684\u7b2c\u4e09\u4e2a\u963b\u585e\u70b9\u3002 \u6b64\u5916\uff0c\u4ece\u5e93\u5728\u6e05\u7a7a\u5f53\u524d\u6570\u636e\u5e93\u540e\uff0c\u8fd8\u9700\u8981\u628a RDB \u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u5feb\u6162\u548c RDB \u6587\u4ef6\u7684\u5927\u5c0f\u5bc6\u5207\u76f8\u5173\uff0c RDB \u6587\u4ef6\u8d8a\u5927\uff0c\u52a0\u8f7d\u8fc7\u7a0b\u8d8a\u6162 \uff0c\u6240\u4ee5\uff0c \u52a0\u8f7d RDB \u6587\u4ef6\u5c31\u6210\u4e3a\u4e86 Redis \u7684\u7b2c\u4e94\u4e2a\u963b\u585e\u70b9\u3002","title":"1-4 \u4e3b\u4ece\u8282\u70b9\u4ea4\u4e92\u65f6\u7684\u963b\u585e\u70b9"},{"location":"chap4/1redis_asyn/#1-5","text":"\u6700\u540e\uff0c\u5f53\u6211\u4eec\u90e8\u7f72 Redis \u5207\u7247\u96c6\u7fa4\u65f6\uff0c\u6bcf\u4e2a Redis \u5b9e\u4f8b\u4e0a\u5206\u914d\u7684\u54c8\u5e0c\u69fd\u4fe1\u606f\u9700\u8981\u5728\u4e0d\u540c\u5b9e\u4f8b\u95f4\u8fdb\u884c\u4f20\u9012\uff0c\u540c\u65f6\uff0c\u5f53\u9700\u8981\u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\u6216\u8005\u6709\u5b9e\u4f8b\u589e\u5220\u65f6\uff0c\u6570\u636e\u4f1a\u5728\u4e0d\u540c\u7684\u5b9e\u4f8b\u95f4\u8fdb\u884c\u8fc1\u79fb\u3002\u4e0d\u8fc7\uff0c\u54c8\u5e0c\u69fd\u7684\u4fe1\u606f\u91cf\u4e0d\u5927\uff0c\u800c\u6570\u636e\u8fc1\u79fb\u662f\u6e10\u8fdb\u5f0f\u6267\u884c\u7684\uff0c\u6240\u4ee5\uff0c\u4e00\u822c\u6765\u8bf4\uff0c\u8fd9\u4e24\u7c7b\u64cd\u4f5c\u5bf9 Redis \u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\u98ce\u9669\u4e0d\u5927\u3002 \u4e0d\u8fc7\uff0c\u5982\u679c\u4f60\u4f7f\u7528\u4e86 Redis Cluster \u65b9\u6848\uff0c\u800c\u4e14\u540c\u65f6\u6b63\u597d\u8fc1\u79fb\u7684\u662f bigkey \u7684\u8bdd\uff0c\u5c31\u4f1a\u9020\u6210\u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\uff0c\u56e0\u4e3a Redis Cluster \u4f7f\u7528\u4e86\u540c\u6b65\u8fc1\u79fb \u7b2c\u516d\u4e2a\u963b\u585e\u70b9\uff1a\u5728Redis Cluster\u65b9\u6848\uff0c\u540c\u65f6\u6b63\u597d\u8fc1\u79fb\u7684\u662fbigkey\u7684\u8bdd\uff0c\u5c31\u4f1a\u9020\u6210\u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\uff0c\u56e0\u4e3aRedis Cluster\u4f7f\u7528\u4e86\u540c\u6b65\u8fc1\u79fb\u3002 \u4e94\u4e2a\u963b\u585e\u70b9\uff1a \u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\uff1b bigkey \u5220\u9664\uff1b \u6e05\u7a7a\u6570\u636e\u5e93\uff1b AOF \u65e5\u5fd7\u540c\u6b65\u5199\uff1b \u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6\u3002 \u5982\u679c\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\u8fd9\u4e9b\u64cd\u4f5c\uff0c\u5fc5\u7136\u4f1a\u5bfc\u81f4\u4e3b\u7ebf\u7a0b\u957f\u65f6\u95f4\u65e0\u6cd5\u670d\u52a1\u5176\u4ed6\u8bf7\u6c42\u3002 \u4e3a\u4e86\u907f\u514d\u963b\u585e\u5f0f\u64cd\u4f5c\uff0cRedis \u63d0\u4f9b\u4e86\u5f02\u6b65\u7ebf\u7a0b\u673a\u5236\u3002 \u6240\u8c13\u7684\u5f02\u6b65\u7ebf\u7a0b\u673a\u5236\uff0c\u5c31\u662f\u6307\uff0cRedis \u4f1a\u542f\u52a8\u4e00\u4e9b\u5b50\u7ebf\u7a0b\uff0c\u7136\u540e\u628a\u4e00\u4e9b\u4efb\u52a1\u4ea4\u7ed9\u8fd9\u4e9b\u5b50\u7ebf\u7a0b\uff0c\u8ba9\u5b83\u4eec\u5728\u540e\u53f0\u5b8c\u6210\uff0c\u800c\u4e0d\u518d\u7531\u4e3b\u7ebf\u7a0b\u6765\u6267\u884c\u8fd9\u4e9b\u4efb\u52a1\u3002\u4f7f\u7528\u5f02\u6b65\u7ebf\u7a0b\u673a\u5236\u6267\u884c\u64cd\u4f5c\uff0c\u53ef\u4ee5\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002","title":"1-5 \u5207\u7247\u96c6\u7fa4\u5b9e\u4f8b\u4ea4\u4e92\u65f6\u7684\u963b\u585e\u70b9"},{"location":"chap4/1redis_asyn/#2","text":"\u5982\u679c\u4e00\u4e2a\u64cd\u4f5c\u80fd\u88ab\u5f02\u6b65\u6267\u884c\uff0c\u5c31\u610f\u5473\u7740\uff0c\u5b83\u5e76\u4e0d\u662f Redis \u4e3b\u7ebf\u7a0b\u7684 \u5173\u952e\u8def\u5f84 (critical path )\u4e0a\u7684\u64cd\u4f5c\u3002 \u5ba2\u6237\u7aef\u628a\u8bf7\u6c42\u53d1\u9001\u7ed9 Redis \u540e\uff0c\u7b49\u7740 Redis \u8fd4\u56de\u6570\u636e\u7ed3\u679c\u7684\u64cd\u4f5c\u3002 \u4e3b\u7ebf\u7a0b\u63a5\u6536\u5230\u64cd\u4f5c 1 \u540e\uff0c\u56e0\u4e3a\u64cd\u4f5c 1 \u5e76\u4e0d\u7528\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u5177\u4f53\u7684\u6570\u636e\uff0c\u6240\u4ee5\uff0c\u4e3b\u7ebf\u7a0b\u53ef\u4ee5\u628a\u5b83\u4ea4\u7ed9\u540e\u53f0\u5b50\u7ebf\u7a0b\u6765\u5b8c\u6210\uff0c\u540c\u65f6\u53ea\u8981\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u4e00\u4e2a\u201cOK\u201d\u7ed3\u679c\u5c31\u884c\u3002 \u5728\u5b50\u7ebf\u7a0b\u6267\u884c\u64cd\u4f5c 1 \u7684\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\u53c8\u5411 Redis \u5b9e\u4f8b\u53d1\u9001\u4e86\u64cd\u4f5c 2\uff0c\u800c\u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u662f\u9700\u8981\u4f7f\u7528\u64cd\u4f5c 2 \u8fd4\u56de\u7684\u6570\u636e\u7ed3\u679c\u7684\uff0c\u5982\u679c\u64cd\u4f5c 2 \u4e0d\u8fd4\u56de\u7ed3\u679c\uff0c\u90a3\u4e48\uff0c\u5ba2\u6237\u7aef\u5c06\u4e00\u76f4\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u3002 \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u64cd\u4f5c 1 \u5c31\u4e0d\u7b97\u5173\u952e\u8def\u5f84\u4e0a\u7684\u64cd\u4f5c\uff0c\u56e0\u4e3a\u5b83\u4e0d\u7528\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u5177\u4f53\u6570\u636e\uff0c\u6240\u4ee5\u53ef\u4ee5\u7531\u540e\u53f0\u5b50\u7ebf\u7a0b\u5f02\u6b65\u6267\u884c\u3002 \u800c\u64cd\u4f5c 2 \u9700\u8981\u628a\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u5b83\u5c31\u662f\u5173\u952e\u8def\u5f84\u4e0a\u7684\u64cd\u4f5c\uff0c\u6240\u4ee5\u4e3b\u7ebf\u7a0b\u5fc5\u987b\u7acb\u5373\u628a\u8fd9\u4e2a\u64cd\u4f5c\u6267\u884c\u5b8c\u3002","title":"2\u3001\u54ea\u4e9b\u963b\u585e\u70b9\u53ef\u4ee5\u5f02\u6b65\u6267\u884c\uff1f"},{"location":"chap4/1redis_asyn/#2-1","text":"\u5bf9\u4e8e Redis \u6765\u8bf4\uff0c\u8bfb\u64cd\u4f5c\u662f\u5178\u578b\u7684\u5173\u952e\u8def\u5f84\u64cd\u4f5c \uff0c\u56e0\u4e3a\u5ba2\u6237\u7aef\u53d1\u9001\u4e86\u8bfb\u64cd\u4f5c\u4e4b\u540e\uff0c\u5c31\u4f1a\u7b49\u5f85\u8bfb\u53d6\u7684\u6570\u636e\u8fd4\u56de\uff0c\u4ee5\u4fbf\u8fdb\u884c\u540e\u7eed\u7684\u6570\u636e\u5904\u7406\u3002 \u800c Redis \u7684\u7b2c\u4e00\u4e2a\u963b\u585e\u70b9\u201c\u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\u201d\u90fd\u6d89\u53ca\u5230\u4e86\u8bfb\u64cd\u4f5c\uff0c\u6240\u4ee5\uff0c\u5b83\u4eec\u662f\u4e0d\u80fd\u8fdb\u884c\u5f02\u6b65\u64cd\u4f5c\u4e86\u3002","title":"2-1 \u8bfb\u64cd\u4f5c"},{"location":"chap4/1redis_asyn/#2-2","text":"\u5220\u9664\u64cd\u4f5c\u5e76\u4e0d\u9700\u8981\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u5177\u4f53\u7684\u6570\u636e\u7ed3\u679c\uff0c\u6240\u4ee5\u4e0d\u7b97\u662f\u5173\u952e\u8def\u5f84\u64cd\u4f5c \u800c\u7b2c\u4e8c\u4e2a\u963b\u585e\u70b9\u201cbigkey \u5220\u9664\u201d\uff0c\u548c\u7b2c\u4e09\u4e2a\u963b\u585e\u70b9\u201c\u6e05\u7a7a\u6570\u636e\u5e93\u201d\uff0c\u90fd\u662f\u5bf9\u6570\u636e\u505a\u5220\u9664\uff0c\u5e76\u4e0d\u5728\u5173\u952e\u8def\u5f84\u4e0a\u3002\u56e0\u6b64\uff0c\u53ef\u4ee5\u4f7f\u7528\u540e\u53f0\u5b50\u7ebf\u7a0b\u6765\u5f02\u6b65\u6267\u884c\u5220\u9664\u64cd\u4f5c\u3002","title":"2-2 \u5220\u9664\u64cd\u4f5c"},{"location":"chap4/1redis_asyn/#2-3-aof","text":"\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\uff0cRedis \u5b9e\u4f8b\u9700\u8981\u4fdd\u8bc1 AOF \u65e5\u5fd7\u4e2d\u7684\u64cd\u4f5c\u8bb0\u5f55\u5df2\u7ecf\u843d\u76d8\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u867d\u7136\u9700\u8981\u5b9e\u4f8b\u7b49\u5f85\uff0c\u4f46\u5b83\u5e76\u4e0d\u4f1a\u8fd4\u56de\u5177\u4f53\u7684\u6570\u636e\u7ed3\u679c\u7ed9\u5b9e\u4f8b\u3002 \u6240\u4ee5\uff0c\u4e5f\u53ef\u4ee5\u542f\u52a8\u4e00\u4e2a\u5b50\u7ebf\u7a0b\u6765\u6267\u884c AOF \u65e5\u5fd7\u7684\u540c\u6b65\u5199\uff0c\u800c\u4e0d\u7528\u8ba9\u4e3b\u7ebf\u7a0b\u7b49\u5f85 AOF \u65e5\u5fd7\u7684\u5199\u5b8c\u6210","title":"2-3 AOF \u65e5\u5fd7\u540c\u6b65\u5199"},{"location":"chap4/1redis_asyn/#2-4-rdb","text":"\u4ece\u5e93\u8981\u60f3\u5bf9\u5ba2\u6237\u7aef\u63d0\u4f9b\u6570\u636e\u5b58\u53d6\u670d\u52a1\uff0c\u5c31\u5fc5\u987b\u628a RDB \u6587\u4ef6\u52a0\u8f7d\u5b8c\u6210 \u3002 \u6240\u4ee5\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u4e5f\u5c5e\u4e8e\u5173\u952e\u8def\u5f84\u4e0a\u7684\u64cd\u4f5c\uff0c\u6211\u4eec\u5fc5\u987b\u8ba9\u4ece\u5e93\u7684\u4e3b\u7ebf\u7a0b\u6765\u6267\u884c\u3002 \u5bf9\u4e8e Redis \u7684\u4e94\u5927\u963b\u585e\u70b9\u6765\u8bf4\uff0c\u9664\u4e86\u201c\u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\u201d\u548c\u201c\u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6\u201d\uff0c\u5176\u4ed6\u4e09\u4e2a\u963b\u585e\u70b9\u6d89\u53ca\u7684\u64cd\u4f5c\u90fd\u4e0d\u5728\u5173\u952e\u8def\u5f84\u4e0a\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Redis \u7684\u5f02\u6b65\u5b50\u7ebf\u7a0b\u673a\u5236\u6765\u5b9e\u73b0 bigkey \u5220\u9664\uff0c\u6e05\u7a7a\u6570\u636e\u5e93\uff0c\u4ee5\u53ca AOF \u65e5\u5fd7\u540c\u6b65\u5199\u3002 \u5173\u952e\u8def\u5f84\u64cd\u4f5c\uff1a\u96c6\u5408\u7684\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\u3001\u4ece\u5e93\u52a0\u8f7dRDB\u6587\u4ef6 \u975e\u5173\u952e\u8def\u5f84\u64cd\u4f5c\uff1abigkey\u7684\u5220\u9664\u3001\u6e05\u7a7a\u6570\u636e\u5e93\u3001AOF\u65e5\u5fd7\u7684\u540c\u6b65\u5199","title":"2-4 \u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6"},{"location":"chap4/1redis_asyn/#3","text":"Redis \u4e3b\u7ebf\u7a0b\u542f\u52a8\u540e\uff0c \u4f1a\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684 pthread_create \u51fd\u6570\u521b\u5efa 3 \u4e2a\u5b50\u7ebf\u7a0b \uff0c\u5206\u522b\u7531 \u5b83\u4eec\u8d1f\u8d23 AOF \u65e5\u5fd7\u5199\u64cd\u4f5c\u3001\u952e\u503c\u5bf9\u5220\u9664\u4ee5\u53ca\u6587\u4ef6\u5173\u95ed\u7684\u5f02\u6b65\u6267\u884c \u3002 \u4e3b\u7ebf\u7a0b\u901a\u8fc7\u4e00\u4e2a\u94fe\u8868\u5f62\u5f0f\u7684\u4efb\u52a1\u961f\u5217\u548c\u5b50\u7ebf\u7a0b\u8fdb\u884c\u4ea4\u4e92\u3002 \u5f53\u6536\u5230\u952e\u503c\u5bf9\u5220\u9664\u548c\u6e05\u7a7a\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u628a\u8fd9\u4e2a\u64cd\u4f5c\u5c01\u88c5\u6210\u4e00\u4e2a\u4efb\u52a1\uff0c\u653e\u5165\u5230\u4efb\u52a1\u961f\u5217\u4e2d\uff0c\u7136\u540e\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u4e00\u4e2a\u5b8c\u6210\u4fe1\u606f\uff0c\u8868\u660e\u5220\u9664\u5df2\u7ecf\u5b8c\u6210\u3002 \u4f46\u5b9e\u9645\u4e0a\uff0c \u8fd9\u4e2a\u65f6\u5019\u5220\u9664\u8fd8\u6ca1\u6709\u6267\u884c\uff0c\u7b49\u5230\u540e\u53f0\u5b50\u7ebf\u7a0b\u4ece\u4efb\u52a1\u961f\u5217\u4e2d\u8bfb\u53d6\u4efb\u52a1\u540e\uff0c\u624d\u5f00\u59cb\u5b9e\u9645\u5220\u9664\u952e\u503c\u5bf9\uff0c\u5e76\u91ca\u653e\u76f8\u5e94\u7684\u5185\u5b58\u7a7a\u95f4 \u3002\u56e0\u6b64\uff0c \u6211\u4eec\u628a\u8fd9\u79cd\u5f02\u6b65\u5220\u9664\u4e5f\u79f0\u4e3a\u60f0\u6027\u5220\u9664\uff08lazy free\uff09\u3002\u6b64\u65f6\uff0c\u5220\u9664\u6216\u6e05\u7a7a\u64cd\u4f5c\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u8fd9\u5c31\u907f\u514d\u4e86\u5bf9\u4e3b\u7ebf\u7a0b\u7684\u6027\u80fd\u5f71\u54cd\u3002 \u548c\u60f0\u6027\u5220\u9664\u7c7b\u4f3c\uff0c\u5f53 AOF \u65e5\u5fd7\u914d\u7f6e\u6210 everysec \u9009\u9879\u540e\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u628a AOF \u5199\u65e5\u5fd7\u64cd\u4f5c\u5c01\u88c5\u6210\u4e00\u4e2a\u4efb\u52a1\uff0c\u4e5f\u653e\u5230\u4efb\u52a1\u961f\u5217\u4e2d\u3002 \u540e\u53f0\u5b50\u7ebf\u7a0b\u8bfb\u53d6\u4efb\u52a1\u540e\uff0c\u5f00\u59cb\u81ea\u884c\u5199\u5165 AOF \u65e5\u5fd7\uff0c\u8fd9\u6837\u4e3b\u7ebf\u7a0b\u5c31\u4e0d\u7528\u4e00\u76f4\u7b49\u5f85 AOF \u65e5\u5fd7\u5199\u5b8c\u4e86\u3002 \u5f02\u6b65\u7684\u952e\u503c\u5bf9\u5220\u9664\u548c\u6570\u636e\u5e93\u6e05\u7a7a\u64cd\u4f5c\u662f Redis 4.0 \u540e\u63d0\u4f9b\u7684\u529f\u80fd \uff0cRedis \u4e5f\u63d0\u4f9b\u4e86\u65b0\u7684\u547d\u4ee4\u6765\u6267\u884c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u3002 \u952e\u503c\u5bf9\u5220\u9664\uff1a\u5f53\u4f60\u7684\u96c6\u5408\u7c7b\u578b\u4e2d\u6709\u5927\u91cf\u5143\u7d20\uff08\u4f8b\u5982\u6709\u767e\u4e07\u7ea7\u522b\u6216\u5343\u4e07\u7ea7\u522b\u5143\u7d20\uff09\u9700\u8981\u5220\u9664\u65f6\uff0c\u6211\u5efa\u8bae\u4f60\u4f7f\u7528 UNLINK \u547d\u4ee4\u3002 \u6e05\u7a7a\u6570\u636e\u5e93\uff1a\u53ef\u4ee5\u5728 FLUSHDB \u548c FLUSHALL \u547d\u4ee4\u540e\u52a0\u4e0a ASYNC \u9009\u9879\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8ba9\u540e\u53f0\u5b50\u7ebf\u7a0b\u5f02\u6b65\u5730\u6e05\u7a7a\u6570\u636e\u5e93\uff0c\u5982\u4e0b\u6240\u793a\uff1a FLUSHDB ASYNC FLUSHALL AYSNC","title":"3\u3001\u5f02\u6b65\u7684\u5b50\u7ebf\u7a0b\u673a\u5236"},{"location":"chap4/1redis_asyn/#4","text":"Redis \u5b9e\u4f8b\u8fd0\u884c\u65f6\u7684 4 \u5927\u7c7b\u4ea4\u4e92\u5bf9\u8c61\uff1a \u5ba2\u6237\u7aef\u3001\u78c1\u76d8\u3001\u4e3b\u4ece\u5e93\u5b9e\u4f8b\u3001\u5207\u7247\u96c6\u7fa4\u5b9e\u4f8b \u3002 \u57fa\u4e8e\u8fd9 4 \u5927\u7c7b\u4ea4\u4e92\u5bf9\u8c61\uff0c\u6211\u4eec\u68b3\u7406\u4e86\u4f1a\u5bfc\u81f4 Redis \u6027\u80fd\u53d7\u635f\u7684 5 \u5927\u963b\u585e\u70b9\uff0c\u5305\u62ec \u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\u3001bigkey \u5220\u9664\u3001\u6e05\u7a7a\u6570\u636e\u5e93\u3001AOF \u65e5\u5fd7\u540c\u6b65\u5199\uff0c\u4ee5\u53ca\u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6 \u3002 \u5728\u8fd9 5 \u5927\u963b\u585e\u70b9\u4e2d\uff0c bigkey \u5220\u9664\u3001\u6e05\u7a7a\u6570\u636e\u5e93\u3001AOF \u65e5\u5fd7\u540c\u6b65\u5199\u4e0d\u5c5e\u4e8e\u5173\u952e\u8def\u5f84\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4f7f\u7528\u5f02\u6b65\u5b50\u7ebf\u7a0b\u673a\u5236\u6765\u5b8c\u6210 \u3002 Redis \u5728\u8fd0\u884c\u65f6\u4f1a\u521b\u5efa\u4e09\u4e2a\u5b50\u7ebf\u7a0b\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u901a\u8fc7\u4e00\u4e2a\u4efb\u52a1\u961f\u5217\u548c\u4e09\u4e2a\u5b50\u7ebf\u7a0b\u8fdb\u884c\u4ea4\u4e92\u3002\u5b50\u7ebf\u7a0b\u4f1a\u6839\u636e\u4efb\u52a1\u7684\u5177\u4f53\u7c7b\u578b\uff0c\u6765\u6267\u884c\u76f8\u5e94\u7684\u5f02\u6b65\u64cd\u4f5c\u3002 \u4e0d\u8fc7\uff0c\u5f02\u6b65\u5220\u9664\u64cd\u4f5c\u662f Redis 4.0 \u4ee5\u540e\u624d\u6709\u7684\u529f\u80fd\uff0c\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f 4.0 \u4e4b\u524d\u7684\u7248\u672c\uff0c\u5f53\u4f60\u9047\u5230 bigkey \u5220\u9664\u65f6\uff1a \u4f7f\u7528\u96c6\u5408\u7c7b\u578b\u63d0\u4f9b\u7684 SCAN \u547d\u4ee4\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540e\u518d\u8fdb\u884c\u5220\u9664\u3002\u56e0\u4e3a\u7528 SCAN \u547d\u4ee4\u53ef\u4ee5\u6bcf\u6b21\u53ea\u8bfb\u53d6\u4e00\u90e8\u5206\u6570\u636e\u5e76\u8fdb\u884c\u5220\u9664\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u4e00\u6b21\u6027\u5220\u9664\u5927\u91cf key \u7ed9\u4e3b\u7ebf\u7a0b\u5e26\u6765\u7684\u963b\u585e \u3002 \u4f8b\u5982\uff0c\u5bf9\u4e8e Hash \u7c7b\u578b\u7684 bigkey \u5220\u9664\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 HSCAN \u547d\u4ee4\uff0c\u6bcf\u6b21\u4ece Hash \u96c6\u5408\u4e2d\u83b7\u53d6\u4e00\u90e8\u5206\u952e\u503c\u5bf9\uff08\u4f8b\u5982 200 \u4e2a\uff09\uff0c\u518d\u4f7f\u7528 HDEL \u5220\u9664\u8fd9\u4e9b\u952e\u503c\u5bf9\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u628a\u5220\u9664\u538b\u529b\u5206\u644a\u5230\u591a\u6b21\u64cd\u4f5c\u4e2d\uff0c\u90a3\u4e48\uff0c\u6bcf\u6b21\u5220\u9664\u64cd\u4f5c\u7684\u8017\u65f6\u5c31\u4e0d\u4f1a\u592a\u957f\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u4e86\u3002 \u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\u3001\u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6\u662f\u5728\u5173\u952e\u8def\u5f84\u4e0a\uff0c\u65e0\u6cd5\u4f7f\u7528\u5f02\u6b65\u64cd\u4f5c\u6765\u5b8c\u6210 \u3002\u5bf9\u4e8e\u8fd9\u4e24\u4e2a\u963b\u585e\u70b9\uff0c\u6211\u4e24\u4e2a\u5c0f\u5efa\u8bae\u3002 \u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\uff1a\u53ef\u4ee5\u4f7f\u7528 SCAN \u547d\u4ee4\uff0c\u5206\u6279\u8bfb\u53d6\u6570\u636e\uff0c\u518d\u5728\u5ba2\u6237\u7aef\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\uff1b \u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6\uff1a\u628a\u4e3b\u5e93\u7684\u6570\u636e\u91cf\u5927\u5c0f\u63a7\u5236\u5728 2~4GB \u5de6\u53f3\uff0c\u4ee5\u4fdd\u8bc1 RDB \u6587\u4ef6\u80fd\u4ee5\u8f83\u5feb\u7684\u901f\u5ea6\u52a0\u8f7d\u3002 \u8981\u70b9&\u4eae\u70b9 \u4e0e\u5ba2\u6237\u7aef\u4ea4\u4e92\u65f6\u7684\u963b\u585e\u70b9\uff1a\u9ad8\u590d\u6742\u5ea6\u7684\u589e\u5220\u6539\u64cd\u4f5c\uff08\u96c6\u5408\u5168\u91cf\u7684\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\uff0cbigKey \u5220\u9664\u64cd\u4f5c\uff0c\u6e05\u7a7a\u6570\u636e\u5e93\uff09 \u4e0e\u78c1\u76d8\u4ea4\u4e92\u7684\u963b\u585e\u70b9\uff1aaof\u65e5\u5fd7\u5b9e\u65f6\u540c\u6b65\u5199\u56de \u4e3b\u4ece\u8282\u70b9\u4ea4\u4e92\u65f6\u7684\u963b\u585e\u70b9\uff1a\u4ece\u5e93\u52a0\u8f7dRDB\u6587\u4ef6 \u5206\u7247\u96c6\u7fa4\u7684\u963b\u585e\u70b9\uff1a\u54c8\u5e0c\u69fdbigkey\u6570\u636e\u8fc1\u79fb \u5173\u952e\u8def\u5f84\u64cd\u4f5c\u6982\u5ff5\uff1a\u5ba2\u6237\u7aef\u628a\u8bf7\u6c42\u53d1\u7ed9Redis\u540e\uff0c\u8981\u7b49\u7740Redis\u8fd4\u56de\u6570\u636e\u7ed3\u679c\u7684\u64cd\u4f5c \u5f02\u6b65\u7684\u5b50\u7ebf\u7a0b\u673a\u5236\uff1a\u4e3b\u7ebf\u7a0b\u901a\u8fc7\u4e00\u4e2a\u94fe\u8868\u5f62\u5f0f\u7684\u4efb\u52a1\u961f\u5217\u548c\u5b50\u7ebf\u7a0b\u8fdb\u884c\u4ea4\u4e92 lazy free \u673a\u5236\uff1aRedis\u6536\u5230\u952e\u503c\u5bf9\u5220\u9664\u548c\u6e05\u7a7a\u6570\u636e\u5e93\u7684\u6307\u4ee4\u65f6\uff0c\u4e3b\u7ebf\u7ebf\u7a0b\u4f1a\u628a\u8fd9\u4e2a\u64cd\u4f5c\u5c01\u88c5\u6210\u4e00\u4e2a\u4efb\u52a1\uff0c\u653e\u5165\u4efb\u52a1\u961f\u5217\u4e2d\uff0c\u7136\u540e\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u4e00\u4e2a\u5b8c\u6210\u4fe1\u606f\uff0c\u4f46\u5b9e\u9645\u4e0a\uff0c\u8fd9\u4e2a\u5220\u9664\u8fd8\u6ca1\u6709\u6267\u884c\uff0c\u9700\u8981\u7b49\u5f85\u540e\u53f0\u5b50\u7ebf\u7a0b\u4ece\u4efb\u52a1\u961f\u5217\u4e2d\u8bfb\u53d6\u5230\u8fd9\u4e2a\u4efb\u52a1\u540e\uff0c\u624d\u5f00\u59cb\u5b9e\u9645\u5220\u9664\u952e\u503c\u5bf9\uff0c\u5e76\u91ca\u653e\u76f8\u5e94\u7684\u5185\u5b58\u7a7a\u95f4\u3002 \u4f46\u662f\uff1a lazy-free \u662f 4.0 \u65b0\u589e\u529f\u80fd\uff0c\u9ed8\u8ba4\u5173\u95ed\u3002\u5f00\u542f\u8fd9\u4e2a\u914d\u7f6e\u540e\uff0c \u9664\u4e86 replica-lazy-flush \u4e4b\u5916\uff0c\u5176\u4ed6\u60c5\u51b5\u90fd\u53ea\u662f \u53ef\u80fd \u53bb\u5f02\u6b65\u91ca\u653e key \u7684\u5185\u5b58\uff0c\u5e76\u4e0d\u662f\u6bcf\u6b21\u5fc5\u5b9a\u5f02\u6b65\u91ca\u653e\u5185\u5b58\u7684\u3002\u662f\u5426\u4f1a\u771f\u6b63\u5f02\u6b65\u91ca\u653e\u5185\u5b58\uff0c\u53d6\u51b3\u4e8e key \u7684\u7c7b\u578b\uff0c\u7f16\u7801\u65b9\u5f0f\uff0c\u5143\u7d20\u6570\u91cf\uff0c\u6240\u4ee5 \u5373\u4f7f\u5f00\u542f\u4e86 lazy-free \uff0c String \u7c7b\u578b\u7684 bigkey \uff0c\u5728\u5220\u9664\u65f6\u4f9d\u65e7\u6709\u963b\u585e\u4e3b\u7ebf\u7a0b\u7684\u98ce\u9669","title":"4\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap4/2redis_cpu/","text":"\u7b2c\u4e8c\u8282 \u5728\u591a\u6838CPU\u67b6\u6784\u548cNUMA\u67b6\u6784\u4e0b\u5bf9redis\u8fdb\u884c\u4f18\u5316\u914d\u7f6e CPU \u7684\u591a\u6838\u67b6\u6784\u4ee5\u53ca\u591a CPU \u67b6\u6784\uff0c\u4e5f\u4f1a\u5f71\u54cd\u5230 Redis \u7684\u6027\u80fd\u3002\u5982\u679c\u4e0d\u4e86\u89e3 CPU \u5bf9 Redis \u7684\u5f71\u54cd\uff0c\u5728\u5bf9 Redis \u7684\u6027\u80fd\u8fdb\u884c\u8c03\u4f18\u65f6\uff0c\u5c31\u53ef\u80fd\u4f1a\u9057\u6f0f\u4e00\u4e9b\u8c03\u4f18\u65b9\u6cd5\uff0c\u4e0d\u80fd\u628a Redis \u7684\u6027\u80fd\u53d1\u6325\u5230\u6781\u9650\u3002 1\u3001\u4e3b\u6d41\u7684 CPU \u67b6\u6784 \u4e00\u4e2a CPU \u5904\u7406\u5668\u4e2d\u4e00\u822c\u6709\u591a\u4e2a\u8fd0\u884c\u6838\u5fc3\uff0c\u6211\u4eec\u628a\u4e00\u4e2a\u8fd0\u884c\u6838\u5fc3\u79f0\u4e3a\u4e00\u4e2a\u7269\u7406\u6838\uff0c\u6bcf\u4e2a\u7269\u7406\u6838\u90fd\u53ef\u4ee5\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u3002 \u6bcf\u4e2a\u7269\u7406\u6838\u90fd\u62e5\u6709\u79c1\u6709\u7684\u4e00\u7ea7\u7f13\u5b58\uff08Level 1 cache\uff0c\u7b80\u79f0 L1 cache\uff09\uff0c\u5305\u62ec\u4e00\u7ea7\u6307\u4ee4\u7f13\u5b58\u548c\u4e00\u7ea7\u6570\u636e\u7f13\u5b58\uff0c\u4ee5\u53ca\u79c1\u6709\u7684\u4e8c\u7ea7\u7f13\u5b58\uff08Level 2 cache\uff0c\u7b80\u79f0 L2 cache\uff09\u3002 1-1 \u7269\u7406\u6838\u7684\u79c1\u6709\u7f13\u5b58 \u5b83\u5176\u5b9e\u662f\u6307\u7f13\u5b58\u7a7a\u95f4\u53ea\u80fd\u88ab\u5f53\u524d\u7684\u8fd9\u4e2a\u7269\u7406\u6838\u4f7f\u7528\uff0c\u5176\u4ed6\u7684\u7269\u7406\u6838\u65e0\u6cd5\u5bf9\u8fd9\u4e2a\u6838\u7684\u7f13\u5b58\u7a7a\u95f4\u8fdb\u884c\u6570\u636e\u5b58\u53d6\u3002\u6211\u4eec\u6765\u770b\u4e00\u4e0b CPU \u7269\u7406\u6838\u7684\u67b6\u6784\u3002 \u56e0\u4e3a L1 \u548c L2 \u7f13\u5b58\u662f\u6bcf\u4e2a\u7269\u7406\u6838\u79c1\u6709\u7684\uff0c\u6240\u4ee5\uff0c\u5f53\u6570\u636e\u6216\u6307\u4ee4\u4fdd\u5b58\u5728 L1\u3001L2 \u7f13\u5b58\u65f6\uff0c\u7269\u7406\u6838\u8bbf\u95ee\u5b83\u4eec\u7684\u5ef6\u8fdf\u4e0d\u8d85\u8fc7 10 \u7eb3\u79d2\uff0c\u901f\u5ea6\u975e\u5e38\u5feb\u3002 \u90a3\u4e48\uff0c\u5982\u679c Redis \u628a\u8981\u8fd0\u884c\u7684\u6307\u4ee4\u6216\u5b58\u53d6\u7684\u6570\u636e\u4fdd\u5b58\u5728 L1 \u548c L2 \u7f13\u5b58\u7684\u8bdd\uff0c\u5c31\u80fd\u9ad8\u901f\u5730\u8bbf\u95ee\u8fd9\u4e9b\u6307\u4ee4\u548c\u6570\u636e\u3002 \u4f46\u662f\uff0c\u8fd9\u4e9b L1 \u548c L2 \u7f13\u5b58\u7684\u5927\u5c0f\u53d7\u9650\u4e8e\u5904\u7406\u5668\u7684\u5236\u9020\u6280\u672f\uff0c\u4e00\u822c\u53ea\u6709 KB \u7ea7\u522b\uff0c\u5b58\u4e0d\u4e0b\u592a\u591a\u7684\u6570\u636e\u3002 \u5982\u679c L1\u3001L2 \u7f13\u5b58\u4e2d\u6ca1\u6709\u6240\u9700\u7684\u6570\u636e\uff0c\u5e94\u7528\u7a0b\u5e8f\u5c31\u9700\u8981\u8bbf\u95ee\u5185\u5b58\u6765\u83b7\u53d6\u6570\u636e\u3002\u800c\u5e94\u7528\u7a0b\u5e8f\u7684\u8bbf\u5b58\u5ef6\u8fdf\u4e00\u822c\u5728\u767e\u7eb3\u79d2\u7ea7\u522b\uff0c\u662f\u8bbf\u95ee L1\u3001L2 \u7f13\u5b58\u7684\u5ef6\u8fdf\u7684\u8fd1 10 \u500d\uff0c\u4e0d\u53ef\u907f\u514d\u5730\u4f1a\u5bf9\u6027\u80fd\u9020\u6210\u5f71\u54cd\u3002 \u6240\u4ee5\uff0c\u4e0d\u540c\u7684\u7269\u7406\u6838\u8fd8\u4f1a\u5171\u4eab\u4e00\u4e2a\u5171\u540c\u7684\u4e09\u7ea7\u7f13\u5b58\uff08Level 3 cache\uff0c\u7b80\u79f0\u4e3a L3 cache\uff09 L3 \u7f13\u5b58\u80fd\u591f\u4f7f\u7528\u7684\u5b58\u50a8\u8d44\u6e90\u6bd4\u8f83\u591a\uff0c\u6240\u4ee5\u4e00\u822c\u6bd4\u8f83\u5927\uff0c\u80fd\u8fbe\u5230\u51e0 MB \u5230\u51e0\u5341 MB\uff0c\u8fd9\u5c31\u80fd\u8ba9\u5e94\u7528\u7a0b\u5e8f\u7f13\u5b58\u66f4\u591a\u7684\u6570\u636e\u3002\u5f53 L1\u3001L2 \u7f13\u5b58\u4e2d\u6ca1\u6709\u6570\u636e\u7f13\u5b58\u65f6\uff0c\u53ef\u4ee5\u8bbf\u95ee L3\uff0c\u5c3d\u53ef\u80fd\u907f\u514d\u8bbf\u95ee\u5185\u5b58\u3002 3 \u7f13\u5b58\u80fd\u591f\u4f7f\u7528\u7684\u5b58\u50a8\u8d44\u6e90\u6bd4\u8f83\u591a\uff0c\u6240\u4ee5\u4e00\u822c\u6bd4\u8f83\u5927\uff0c\u80fd\u8fbe\u5230\u51e0 MB \u5230\u51e0\u5341 MB\uff0c\u8fd9\u5c31\u80fd\u8ba9\u5e94\u7528\u7a0b\u5e8f\u7f13\u5b58\u66f4\u591a\u7684\u6570\u636e\u3002\u5f53 L1\u3001L2 \u7f13\u5b58\u4e2d\u6ca1\u6709\u6570\u636e\u7f13\u5b58\u65f6\uff0c\u53ef\u4ee5\u8bbf\u95ee L3\uff0c\u5c3d\u53ef\u80fd\u907f\u514d\u8bbf\u95ee\u5185\u5b58\u3002 1-2 \u903b\u8f91\u6838 \u53e6\u5916\uff0c\u73b0\u5728\u4e3b\u6d41\u7684 CPU \u5904\u7406\u5668\u4e2d\uff0c \u6bcf\u4e2a\u7269\u7406\u6838\u901a\u5e38\u90fd\u4f1a\u8fd0\u884c\u4e24\u4e2a\u8d85\u7ebf\u7a0b\uff0c\u4e5f\u53eb\u4f5c\u903b\u8f91\u6838 \u3002\u540c\u4e00\u4e2a\u7269\u7406\u6838\u7684\u903b\u8f91\u6838\u4f1a\u5171\u4eab\u4f7f\u7528 L1\u3001L2 \u7f13\u5b58\u3002 \u7269\u7406\u6838\u548c\u903b\u8f91\u6838\uff0c\u4ee5\u53ca\u4e00\u7ea7\u3001\u4e8c\u7ea7\u7f13\u5b58\u7684\u5173\u7cfb\u3002 \u5728\u4e3b\u6d41\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u4e00\u4e2a CPU \u5904\u7406\u5668\u4f1a\u6709 10 \u5230 20 \u591a\u4e2a\u7269\u7406\u6838\u3002 \u540c\u65f6\uff0c \u4e3a\u4e86\u63d0\u5347\u670d\u52a1\u5668\u7684\u5904\u7406\u80fd\u529b\uff0c\u670d\u52a1\u5668\u4e0a\u901a\u5e38\u8fd8\u4f1a\u6709\u591a\u4e2a CPU \u5904\u7406\u5668\uff08\u4e5f\u79f0\u4e3a\u591a CPU Socket \uff09\uff0c\u6bcf\u4e2a\u5904\u7406\u5668\u6709\u81ea\u5df1\u7684\u7269\u7406\u6838\uff08\u5305\u62ec L1\u3001L2 \u7f13\u5b58\uff09\uff0cL3 \u7f13\u5b58\uff0c\u4ee5\u53ca\u8fde\u63a5\u7684\u5185\u5b58\uff0c\u540c\u65f6\uff0c\u4e0d\u540c\u5904\u7406\u5668\u95f4\u901a\u8fc7\u603b\u7ebf\u8fde\u63a5\u3002 \u5728\u591a CPU \u67b6\u6784\u4e0a\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u5904\u7406\u5668\u4e0a\u8fd0\u884c Redis \u53ef\u4ee5\u5148\u5728 Socket 1 \u4e0a\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\uff0c\u7136\u540e\u518d\u88ab\u8c03\u5ea6\u5230 Socket 2 \u4e0a\u8fd0\u884c\u3002 \u4f46\u662f\uff0c\u6709\u4e2a\u5730\u65b9\u9700\u8981\u4f60\u6ce8\u610f\u4e00\u4e0b\uff1a\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u5148\u5728\u4e00\u4e2a Socket \u4e0a\u8fd0\u884c\uff0c\u5e76\u4e14\u628a\u6570\u636e\u4fdd\u5b58\u5230\u4e86\u5185\u5b58\uff0c\u7136\u540e\u88ab\u8c03\u5ea6\u5230\u53e6\u4e00\u4e2a Socket \u4e0a\u8fd0\u884c\uff0c\u6b64\u65f6\uff0c\u5e94\u7528\u7a0b\u5e8f\u518d\u8fdb\u884c\u5185\u5b58\u8bbf\u95ee\u65f6\uff0c\u5c31\u9700\u8981\u8bbf\u95ee\u4e4b\u524d Socket \u4e0a\u8fde\u63a5\u7684\u5185\u5b58\uff0c\u8fd9\u79cd\u8bbf\u95ee\u5c5e\u4e8e \u8fdc\u7aef\u5185\u5b58\u8bbf\u95ee \u3002 \u548c\u8bbf\u95ee Socket \u76f4\u63a5\u8fde\u63a5\u7684\u5185\u5b58\u76f8\u6bd4\uff0c\u8fdc\u7aef\u5185\u5b58\u8bbf\u95ee\u4f1a\u589e\u52a0\u5e94\u7528\u7a0b\u5e8f\u7684\u5ef6\u8fdf \u3002 1-3 Non-Uniform Memory Access\uff0cNUMA \u67b6\u6784 \u5728\u591a CPU \u67b6\u6784\u4e0b\uff0c\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u6240\u5728 Socket \u7684\u672c\u5730\u5185\u5b58\u548c\u8bbf\u95ee\u8fdc\u7aef\u5185\u5b58\u7684\u5ef6\u8fdf\u5e76\u4e0d\u4e00\u81f4 \uff0c\u6240\u4ee5\uff0c \u6211\u4eec\u4e5f\u628a\u8fd9\u4e2a\u67b6\u6784\u79f0\u4e3a\u975e\u7edf\u4e00\u5185\u5b58\u8bbf\u95ee\u67b6\u6784\uff08Non-Uniform Memory Access\uff0cNUMA \u67b6\u6784\uff09 \u3002 \u4eec\u5c31\u77e5\u9053\u4e86\u4e3b\u6d41\u7684 CPU \u591a\u6838\u67b6\u6784\u548c\u591a CPU \u67b6\u6784\uff0c\u6211\u4eec\u6765\u7b80\u5355\u603b\u7ed3\u4e0b CPU \u67b6\u6784\u5bf9\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u7684\u5f71\u54cd\u3002 L1\u3001L2 \u7f13\u5b58\u4e2d\u7684\u6307\u4ee4\u548c\u6570\u636e\u7684\u8bbf\u95ee\u901f\u5ea6\u5f88\u5feb\uff0c\u6240\u4ee5\uff0c\u5145\u5206\u5229\u7528 L1\u3001L2 \u7f13\u5b58\uff0c\u53ef\u4ee5\u6709\u6548\u7f29\u77ed\u5e94\u7528\u7a0b\u5e8f\u7684\u6267\u884c\u65f6\u95f4\uff1b \u5728 NUMA \u67b6\u6784\u4e0b\uff0c\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u4ece\u4e00\u4e2a Socket \u4e0a\u8c03\u5ea6\u5230\u53e6\u4e00\u4e2a Socket \u4e0a\uff0c\u5c31\u53ef\u80fd\u4f1a\u51fa\u73b0\u8fdc\u7aef\u5185\u5b58\u8bbf\u95ee\u7684\u60c5\u51b5\uff0c\u8fd9\u4f1a\u76f4\u63a5\u589e\u52a0\u5e94\u7528\u7a0b\u5e8f\u7684\u6267\u884c\u65f6\u95f4 2\u3001CPU \u591a\u6838\u5bf9 Redis \u6027\u80fd\u7684\u5f71\u54cd \u5728\u4e00\u4e2a CPU \u6838\u4e0a\u8fd0\u884c\u65f6\uff0c\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u8bb0\u5f55\u81ea\u8eab\u4f7f\u7528\u7684\u8f6f\u786c\u4ef6\u8d44\u6e90\u4fe1\u606f\uff08\u4f8b\u5982\u6808\u6307\u9488\u3001CPU \u6838\u7684\u5bc4\u5b58\u5668\u503c\u7b49\uff09\uff0c\u6211\u4eec\u628a\u8fd9\u4e9b\u4fe1\u606f\u79f0\u4e3a \u8fd0\u884c\u65f6\u4fe1\u606f \u3002 \u540c\u65f6\uff0c\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u6700\u9891\u7e41\u7684\u6307\u4ee4\u548c\u6570\u636e\u8fd8\u4f1a\u88ab\u7f13\u5b58\u5230 L1\u3001L2 \u7f13\u5b58\u4e0a\uff0c\u4ee5\u4fbf\u63d0\u5347\u6267\u884c\u901f\u5ea6\u3002 \u4f46\u662f\uff0c\u5728\u591a\u6838 CPU \u7684\u573a\u666f\u4e0b\uff0c\u4e00\u65e6\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u5728\u4e00\u4e2a\u65b0\u7684 CPU \u6838\u4e0a\u8fd0\u884c\uff0c\u90a3\u4e48\uff0c\u8fd0\u884c\u65f6\u4fe1\u606f\u5c31\u9700\u8981\u91cd\u65b0\u52a0\u8f7d\u5230\u65b0\u7684 CPU \u6838\u4e0a\u3002\u800c\u4e14\uff0c \u65b0\u7684 CPU \u6838\u7684 L1\u3001L2 \u7f13\u5b58\u4e5f\u9700\u8981\u91cd\u65b0\u52a0\u8f7d\u6570\u636e\u548c\u6307\u4ee4\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u7a0b\u5e8f\u7684\u8fd0\u884c\u65f6\u95f4\u589e\u52a0\u3002 2-1 CPU \u73af\u5883\u4e0b\u5bf9 Redis \u6027\u80fd\u8fdb\u884c\u8c03\u4f18 \u76ee\u9700\u6c42\u662f\u8981\u5bf9 Redis \u7684 99% \u5c3e\u5ef6\u8fdf\u8fdb\u884c\u4f18\u5316\uff0c\u8981\u6c42 GET \u5c3e\u5ef6\u8fdf\u5c0f\u4e8e 300 \u5fae\u79d2\uff0cPUT \u5c3e\u5ef6\u8fdf\u5c0f\u4e8e 500 \u5fae\u79d2\u3002 99% \u5c3e\u5ef6\u8fdf \u6211\u4eec\u628a\u6240\u6709\u8bf7\u6c42\u7684\u5904\u7406\u5ef6\u8fdf\u4ece\u5c0f\u5230\u5927\u6392\u4e2a\u5e8f\uff0c99% \u7684\u8bf7\u6c42\u5ef6\u8fdf\u5c0f\u4e8e\u7684\u503c\u5c31\u662f 99% \u5c3e\u5ef6\u8fdf\u3002\u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u6709 1000 \u4e2a\u8bf7\u6c42\uff0c\u5047\u8bbe\u6309\u8bf7\u6c42\u5ef6\u8fdf\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u540e\uff0c \u7b2c 991 \u4e2a\u8bf7\u6c42\u7684\u5ef6\u8fdf\u5b9e\u6d4b\u503c\u662f 1ms\uff0c\u800c\u524d 990 \u4e2a\u8bf7\u6c42\u7684\u5ef6\u8fdf\u90fd\u5c0f\u4e8e 1ms\uff0c\u6240\u4ee5\uff0c\u8fd9\u91cc\u7684 99% \u5c3e\u5ef6\u8fdf\u5c31\u662f 1ms\u3002 \u6211\u4eec\u4f7f\u7528 GET/PUT \u590d\u6742\u5ea6\u4e3a O(1) \u7684 String \u7c7b\u578b\u8fdb\u884c\u6570\u636e\u5b58\u53d6\uff0c\u540c\u65f6\u5173\u95ed\u4e86 RDB \u548c AOF \uff0c\u800c\u4e14\uff0cRedis \u5b9e\u4f8b\u4e2d\u6ca1\u6709\u4fdd\u5b58\u96c6\u5408\u7c7b\u578b\u7684\u5176\u4ed6\u6570\u636e\uff0c\u4e5f\u5c31\u6ca1\u6709 bigkey \u64cd\u4f5c\uff0c \u907f\u514d\u4e86\u53ef\u80fd\u5bfc\u81f4\u5ef6\u8fdf\u589e\u52a0\u7684\u8bb8\u591a\u60c5\u51b5 \u5373\u4f7f\u8fd9\u6837\uff0c\u6211\u4eec\u5728\u4e00\u53f0\u6709 24 \u4e2a CPU \u6838\u7684\u670d\u52a1\u5668\u4e0a\u8fd0\u884c Redis \u5b9e\u4f8b\uff0cGET \u548c PUT \u7684 99% \u5c3e\u5ef6\u8fdf\u5206\u522b\u662f 504 \u5fae\u79d2\u548c 1175 \u5fae\u79d2\uff0c\u660e\u663e\u5927\u4e8e\u6211\u4eec\u8bbe\u5b9a\u7684\u76ee\u6807\u3002 \u68c0\u6d4b\u4e86 Redis \u5b9e\u4f8b\u8fd0\u884c\u65f6\u7684\u670d\u52a1\u5668 CPU \u7684\u72b6\u6001\u6307\u6807\u503c\uff0c\u8fd9\u624d\u53d1\u73b0\uff0cCPU \u7684 context switch \u6b21\u6570\u6bd4\u8f83\u591a\u3002 context switch context switch \u662f\u6307\u7ebf\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u8fd9\u91cc\u7684\u4e0a\u4e0b\u6587\u5c31\u662f\u7ebf\u7a0b\u7684\u8fd0\u884c\u65f6\u4fe1\u606f\u3002 \u5728 CPU \u591a\u6838\u7684\u73af\u5883\u4e2d\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u5148\u5728\u4e00\u4e2a CPU \u6838\u4e0a\u8fd0\u884c\uff0c\u4e4b\u540e\u53c8\u5207\u6362\u5230\u53e6\u4e00\u4e2a CPU \u6838\u4e0a\u8fd0\u884c\uff0c\u8fd9\u65f6\u5c31\u4f1a\u53d1\u751f context switch\u3002 \u591a\u6838CPU\u8fd0\u884c\u6162\u7684\u539f\u56e0 1\u3001\u4e00\u4e2a\u6838\u8fd0\u884c\uff0c\u9700\u8981\u8bb0\u5f55\u8fd0\u884c\u5230\u54ea\u91cc\u4e86\uff0c\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u6838\u7684\u65f6\u5019\uff0c\u9700\u8981\u628a\u8bb0\u5f55\u7684\u8fd0\u884c\u65f6\u4fe1\u606f\u540c\u6b65\u5230\u53e6\u4e00\u4e2a\u6838\u4e0a\u3002 2\u3001\u53e6\u4e00\u4e2a CPU \u6838\u4e0a\u7684 L1\u3001L2 \u7f13\u5b58\u4e2d\uff0c\u5e76\u6ca1\u6709 Redis \u5b9e\u4f8b\u4e4b\u524d\u8fd0\u884c\u65f6\u9891\u7e41\u8bbf\u95ee\u7684\u6307\u4ee4\u548c\u6570\u636e\uff0c\u6240\u4ee5\uff0c\u8fd9\u4e9b\u6307\u4ee4\u548c\u6570\u636e\u90fd\u9700\u8981\u91cd\u65b0\u4ece L3 \u7f13\u5b58\uff0c\u751a\u81f3\u662f\u5185\u5b58\u4e2d\u52a0\u8f7d\u3002\u8fd9\u4e2a\u91cd\u65b0\u52a0\u8f7d\u7684\u8fc7\u7a0b\u662f\u9700\u8981\u82b1\u8d39\u4e00\u5b9a\u65f6\u95f4\u7684\u3002 \u5f53 context switch \u53d1\u751f\u540e\uff0cRedis \u4e3b\u7ebf\u7a0b\u7684\u8fd0\u884c\u65f6\u4fe1\u606f\u9700\u8981\u88ab\u91cd\u65b0\u52a0\u8f7d\u5230\u53e6\u4e00\u4e2a CPU \u6838\u4e0a\uff0c\u800c\u4e14\uff0c\u6b64\u65f6\uff0c\u53e6\u4e00\u4e2a CPU \u6838\u4e0a\u7684 L1\u3001L2 \u7f13\u5b58\u4e2d\uff0c\u5e76\u6ca1\u6709 Redis \u5b9e\u4f8b\u4e4b\u524d\u8fd0\u884c\u65f6\u9891\u7e41\u8bbf\u95ee\u7684\u6307\u4ee4\u548c\u6570\u636e\uff0c\u6240\u4ee5\uff0c \u8fd9\u4e9b\u6307\u4ee4\u548c\u6570\u636e\u90fd\u9700\u8981\u91cd\u65b0\u4ece L3 \u7f13\u5b58\uff0c\u751a\u81f3\u662f\u5185\u5b58\u4e2d\u52a0\u8f7d\u3002\u8fd9\u4e2a\u91cd\u65b0\u52a0\u8f7d\u7684\u8fc7\u7a0b\u662f\u9700\u8981\u82b1\u8d39\u4e00\u5b9a\u65f6\u95f4\u7684 \u800c\u4e14\uff0cRedis \u5b9e\u4f8b\u9700\u8981\u7b49\u5f85\u8fd9\u4e2a\u91cd\u65b0\u52a0\u8f7d\u7684\u8fc7\u7a0b\u5b8c\u6210\u540e\uff0c\u624d\u80fd\u5f00\u59cb\u5904\u7406\u8bf7\u6c42\uff0c\u6240\u4ee5\uff0c\u8fd9\u4e5f\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u8bf7\u6c42\u7684\u5904\u7406\u65f6\u95f4\u589e\u52a0\u3002 \u5982\u679c\u5728 CPU \u591a\u6838\u573a\u666f\u4e0b\uff0cRedis \u5b9e\u4f8b\u88ab\u9891\u7e41\u8c03\u5ea6\u5230\u4e0d\u540c CPU \u6838\u4e0a\u8fd0\u884c\u7684\u8bdd\uff0c\u90a3\u4e48\uff0c\u5bf9 Redis \u5b9e\u4f8b\u7684\u8bf7\u6c42\u5904\u7406\u65f6\u95f4\u5f71\u54cd\u5c31\u66f4\u5927\u4e86\u3002 \u6bcf\u8c03\u5ea6\u4e00\u6b21\uff0c\u4e00\u4e9b\u8bf7\u6c42\u5c31\u4f1a\u53d7\u5230\u8fd0\u884c\u65f6\u4fe1\u606f\u3001\u6307\u4ee4\u548c\u6570\u636e\u91cd\u65b0\u52a0\u8f7d\u8fc7\u7a0b\u7684\u5f71\u54cd\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u67d0\u4e9b\u8bf7\u6c42\u7684\u5ef6\u8fdf\u660e\u663e\u9ad8\u4e8e\u5176\u4ed6\u8bf7\u6c42\u3002 \u5206\u6790\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u5c31\u77e5\u9053\u4e86\u521a\u521a\u7684\u4f8b\u5b50\u4e2d 99% \u5c3e\u5ef6\u8fdf\u7684\u503c\u59cb\u7ec8\u964d\u4e0d\u4e0b\u6765\u7684\u539f\u56e0\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u8981\u907f\u514d Redis \u603b\u662f\u5728\u4e0d\u540c CPU \u6838\u4e0a\u6765\u56de\u8c03\u5ea6\u6267\u884c\u3002\u4e8e\u662f\uff0c\u6211\u4eec\u5c1d\u8bd5\u7740\u628a Redis \u5b9e\u4f8b\u548c CPU \u6838\u7ed1\u5b9a\u4e86\uff0c\u8ba9\u4e00\u4e2a Redis \u5b9e\u4f8b\u56fa\u5b9a\u8fd0\u884c\u5728\u4e00\u4e2a CPU \u6838\u4e0a\u3002 \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 taskset \u547d\u4ee4\u628a\u4e00\u4e2a\u7a0b\u5e8f\u7ed1\u5b9a\u5728\u4e00\u4e2a\u6838\u4e0a\u8fd0\u884c \u3002 \u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5c31\u628a Redis \u5b9e\u4f8b\u7ed1\u5728\u4e86 0 \u53f7\u6838\u4e0a\uff0c \u5176\u4e2d\uff0c\u201c-c\u201d\u9009\u9879\u7528\u4e8e\u8bbe\u7f6e\u8981\u7ed1\u5b9a\u7684\u6838\u7f16\u53f7\u3002 taskset -c 0 ./redis-server \u7ed1\u5b9a\u4ee5\u540e\uff0c\u6211\u4eec\u8fdb\u884c\u4e86\u6d4b\u8bd5\u3002\u6211\u4eec\u53d1\u73b0\uff0c Redis \u5b9e\u4f8b\u7684 GET \u548c PUT \u7684 99% \u5c3e\u5ef6\u8fdf\u4e00\u4e0b\u5b50\u5c31\u5206\u522b\u964d\u5230\u4e86 260 \u5fae\u79d2\u548c 482 \u5fae\u79d2 \uff0c\u8fbe\u5230\u4e86\u6211\u4eec\u671f\u671b\u7684\u76ee\u6807\u3002 \u6211\u4eec\u6765\u770b\u4e00\u4e0b\u7ed1\u6838\u524d\u540e\u7684 Redis \u7684 99% \u5c3e\u5ef6\u8fdf\u3002 \u548c\u53ea\u7ed1\u4e00\u4e2a\u903b\u8f91\u6838\u76f8\u6bd4\uff0c\u628a Redis \u5b9e\u4f8b\u548c\u7269\u7406\u6838\u7ed1\u5b9a\uff0c\u53ef\u4ee5\u8ba9\u4e3b\u7ebf\u7a0b\u3001\u5b50\u8fdb\u7a0b\u3001\u540e\u53f0\u7ebf\u7a0b\u5171\u4eab\u4f7f\u7528 2 \u4e2a\u903b\u8f91\u6838\uff0c\u53ef\u4ee5\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u7f13\u89e3 CPU \u8d44\u6e90\u7ade\u4e89\u3002 \u4f46\u662f\uff0c\u56e0\u4e3a\u53ea\u7528\u4e86 2 \u4e2a\u903b\u8f91\u6838\uff0c\u5b83\u4eec\u76f8\u4e92\u4e4b\u95f4\u7684 CPU \u7ade\u4e89\u4ecd\u7136\u8fd8\u4f1a\u5b58\u5728\u3002\u5982\u679c\u4f60\u8fd8\u60f3\u8fdb\u4e00\u6b65\u51cf\u5c11 CPU \u7ade\u4e89\uff0c\u6211\u518d\u7ed9\u4f60\u4ecb\u7ecd\u4e00\u79cd\u65b9\u6848\u3002 \u5728 CPU \u591a\u6838\u7684\u73af\u5883\u4e0b\uff0c\u901a\u8fc7\u7ed1\u5b9a Redis \u5b9e\u4f8b\u548c CPU \u6838\uff0c\u53ef\u4ee5\u6709\u6548\u964d\u4f4e Redis \u7684\u5c3e\u5ef6\u8fdf\u3002\u5f53\u7136\uff0c\u7ed1\u6838\u4e0d\u4ec5\u5bf9\u964d\u4f4e\u5c3e\u5ef6\u8fdf\u6709\u597d\u5904\uff0c\u540c\u6837\u4e5f\u80fd\u964d\u4f4e\u5e73\u5747\u5ef6\u8fdf\u3001\u63d0\u5347\u541e\u5410\u7387\uff0c\u8fdb\u800c\u63d0\u5347 Redis \u6027\u80fd\u3002 3\u3001CPU \u7684 NUMA \u67b6\u6784\u5bf9 Redis \u6027\u80fd\u7684\u5f71\u54cd \u5728\u5b9e\u9645\u5e94\u7528 Redis \u65f6\uff0c\u4e3a\u4e86\u63d0\u5347 Redis \u7684\u7f51\u7edc\u6027\u80fd\uff0c\u628a\u64cd\u4f5c\u7cfb\u7edf\u7684\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u548c CPU \u6838\u7ed1\u5b9a\u3002 \u8fd9\u4e2a\u505a\u6cd5\u53ef\u4ee5\u907f\u514d\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u5728\u4e0d\u540c\u6838\u4e0a\u6765\u56de\u8c03\u5ea6\u6267\u884c\uff0c\u7684\u786e\u80fd\u6709\u6548\u63d0\u5347 Redis \u7684\u7f51\u7edc\u5904\u7406\u6027\u80fd\u3002 \u4f46\u662f\uff0c \u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u662f\u8981\u548c Redis \u5b9e\u4f8b\u8fdb\u884c\u7f51\u7edc\u6570\u636e\u4ea4\u4e92\u7684\uff0c\u4e00\u65e6\u628a\u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u7ed1\u6838\u540e\uff0c\u6211\u4eec\u5c31\u9700\u8981\u6ce8\u610f Redis \u5b9e\u4f8b\u662f\u7ed1\u5728\u54ea\u4e2a\u6838\u4e0a\u4e86\uff0c\u8fd9\u4f1a\u5173\u7cfb\u5230 Redis \u8bbf\u95ee\u7f51\u7edc\u6570\u636e\u7684\u6548\u7387\u9ad8\u4f4e \u3002 \u6211\u4eec\u5148\u6765\u770b\u4e0b Redis \u5b9e\u4f8b\u548c\u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u7684\u6570\u636e\u4ea4\u4e92\uff1a \u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u4ece\u7f51\u5361\u786c\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u628a\u6570\u636e\u5199\u5165\u5230\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7ef4\u62a4\u7684\u4e00\u5757\u5185\u5b58\u7f13\u51b2\u533a \u5185\u6838\u4f1a\u901a\u8fc7 epoll \u673a\u5236\u89e6\u53d1\u4e8b\u4ef6\uff0c\u901a\u77e5 Redis \u5b9e\u4f8b\uff0cRedis \u5b9e\u4f8b\u518d\u628a\u6570\u636e\u4ece\u5185\u6838\u7684\u5185\u5b58\u7f13\u51b2\u533a\u62f7\u8d1d\u5230\u81ea\u5df1\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u90a3\u4e48\uff0c\u5728 CPU \u7684 NUMA \u67b6\u6784\u4e0b\uff0c\u5f53\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u3001Redis \u5b9e\u4f8b\u5206\u522b\u548c CPU \u6838\u7ed1\u5b9a\u540e\uff0c\u5c31\u4f1a\u6709\u4e00\u4e2a\u6f5c\u5728\u7684\u98ce\u9669\uff1a \u5982\u679c\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u548c Redis \u5b9e\u4f8b\u5404\u81ea\u6240\u7ed1\u7684 CPU \u6838\u4e0d\u5728\u540c\u4e00\u4e2a CPU Socket \u4e0a\uff0c\u90a3\u4e48\uff0cRedis \u5b9e\u4f8b\u8bfb\u53d6\u7f51\u7edc\u6570\u636e\u65f6\uff0c\u5c31\u9700\u8981\u8de8 CPU Socket \u8bbf\u95ee\u5185\u5b58\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u82b1\u8d39\u8f83\u591a\u65f6\u95f4\u3002 \u56fe\u4e2d\u7684 \u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u88ab\u7ed1\u5728\u4e86 CPU Socket 1 \u7684\u67d0\u4e2a\u6838\u4e0a\uff0c\u800c Redis \u5b9e\u4f8b\u5219\u88ab\u7ed1\u5728\u4e86 CPU Socket 2 \u4e0a \u3002 \u6b64\u65f6\uff0c\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u8bfb\u53d6\u5230\u7684\u7f51\u7edc\u6570\u636e\uff0c\u88ab\u4fdd\u5b58\u5728 CPU Socket 1 \u7684\u672c\u5730\u5185\u5b58\u4e2d\uff0c \u5f53 Redis \u5b9e\u4f8b\u8981\u8bbf\u95ee\u7f51\u7edc\u6570\u636e\u65f6\uff0c\u5c31\u9700\u8981 Socket 2 \u901a\u8fc7\u603b\u7ebf\u628a\u5185\u5b58\u8bbf\u95ee\u547d\u4ee4\u53d1\u9001\u5230 Socket 1 \u4e0a\uff0c\u8fdb\u884c\u8fdc\u7a0b\u8bbf\u95ee\uff0c\u65f6\u95f4\u5f00\u9500\u6bd4\u8f83\u5927\u3002 \u548c\u8bbf\u95ee CPU Socket \u672c\u5730\u5185\u5b58\u76f8\u6bd4\uff0c\u8de8 CPU Socket \u7684\u5185\u5b58\u8bbf\u95ee\u5ef6\u8fdf\u589e\u52a0\u4e86 18%\uff0c\u8fd9\u81ea\u7136\u4f1a\u5bfc\u81f4 Redis \u5904\u7406\u8bf7\u6c42\u7684\u5ef6\u8fdf\u589e\u52a0\u3002 \u6240\u4ee5\uff0c \u4e3a\u4e86\u907f\u514d Redis \u8de8 CPU Socket \u8bbf\u95ee\u7f51\u7edc\u6570\u636e\uff0c\u6211\u4eec\u6700\u597d\u628a\u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u548c Redis \u5b9e\u4f8b\u7ed1\u5728\u540c\u4e00\u4e2a CPU Socket \u4e0a\uff0c\u8fd9\u6837\u4e00\u6765\uff0cRedis \u5b9e\u4f8b\u5c31\u53ef\u4ee5\u76f4\u63a5\u4ece\u672c\u5730\u5185\u5b58\u8bfb\u53d6\u7f51\u7edc\u6570\u636e\u4e86 \uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u9700\u8981\u6ce8\u610f\u7684\u662f \u5728 CPU \u7684 NUMA \u67b6\u6784\u4e0b\uff0c\u5bf9 CPU \u6838\u7684\u7f16\u53f7\u89c4\u5219\uff0c\u5e76\u4e0d\u662f\u5148\u628a\u4e00\u4e2a CPU Socket \u4e2d\u7684\u6240\u6709\u903b\u8f91\u6838\u7f16\u5b8c\uff0c\u518d\u5bf9\u4e0b\u4e00\u4e2a CPU Socket \u4e2d\u7684\u903b\u8f91\u6838\u7f16\u7801\uff0c\u800c\u662f\u5148\u7ed9\u6bcf\u4e2a CPU Socket \u4e2d\u6bcf\u4e2a\u7269\u7406\u6838\u7684\u7b2c\u4e00\u4e2a\u903b\u8f91\u6838\u4f9d\u6b21\u7f16\u53f7\uff0c\u518d\u7ed9\u6bcf\u4e2a CPU Socket \u4e2d\u7684\u7269\u7406\u6838\u7684\u7b2c\u4e8c\u4e2a\u903b\u8f91\u6838\u4f9d\u6b21\u7f16\u53f7\u3002 \u5047\u8bbe\u6709 2 \u4e2a CPU Socket\uff0c\u6bcf\u4e2a Socket \u4e0a\u6709 6 \u4e2a\u7269\u7406\u6838\uff0c\u6bcf\u4e2a\u7269\u7406\u6838\u53c8\u6709 2 \u4e2a\u903b\u8f91\u6838\uff0c\u603b\u5171 24 \u4e2a\u903b\u8f91\u6838\u3002 \u6211\u4eec\u53ef\u4ee5\u6267\u884c lscpu \u547d\u4ee4 \uff0c\u67e5\u770b\u5230\u8fd9\u4e9b\u6838\u7684\u7f16\u53f7\uff1a lscpu Architecture: x86_64 ... NUMA node0 CPU(s): 0-5,12-17 NUMA node1 CPU(s): 6-11,18-23 ... NUMA node0 \u7684 CPU \u6838\u7f16\u53f7\u662f 0 \u5230 5\u300112 \u5230 17\u3002 \u5176\u4e2d\uff0c0 \u5230 5 \u662f node0 \u4e0a\u7684 6 \u4e2a\u7269\u7406\u6838\u4e2d\u7684\u7b2c\u4e00\u4e2a\u903b\u8f91\u6838\u7684\u7f16\u53f7\uff0c12 \u5230 17 \u662f\u76f8\u5e94\u7269\u7406\u6838\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u903b\u8f91\u6838\u7f16\u53f7\u3002 NUMA node1 \u7684 CPU \u6838\u7f16\u53f7\u89c4\u5219\u548c node0 \u4e00\u6837\u3002 \u6240\u4ee5\uff0c\u5728\u7ed1\u6838\u65f6\uff0c\u6211\u4eec\u4e00\u5b9a\u8981\u6ce8\u610f\uff0c\u4e0d\u80fd\u60f3\u5f53\u7136\u5730\u8ba4\u4e3a\u7b2c\u4e00\u4e2a Socket \u4e0a\u7684 12 \u4e2a\u903b\u8f91\u6838\u7684\u7f16\u53f7\u5c31\u662f 0 \u5230 11\u3002\u5426\u5219\uff0c\u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u548c Redis \u5b9e\u4f8b\u5c31\u53ef\u80fd\u7ed1\u5728\u4e86\u4e0d\u540c\u7684 CPU Socket \u4e0a\u3002 \u6bd4\u5982\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u628a\u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u548c Redis \u5b9e\u4f8b\u5206\u522b\u7ed1\u5230\u7f16\u53f7\u4e3a 1 \u548c 7 \u7684 CPU \u6838\u4e0a\uff0c\u6b64\u65f6\uff0c\u5b83\u4eec\u4ecd\u7136\u662f\u5728 2 \u4e2a CPU Socket \u4e0a\uff0cRedis \u5b9e\u4f8b\u4ecd\u7136\u9700\u8981\u8de8 Socket \u8bfb\u53d6\u7f51\u7edc\u6570\u636e\u3002 \u6240\u4ee5\uff0c\u4f60\u4e00\u5b9a\u8981\u6ce8\u610f NUMA \u67b6\u6784\u4e0b CPU \u6838\u7684\u7f16\u53f7\u65b9\u6cd5\uff0c\u8fd9\u6837\u624d\u4e0d\u4f1a\u7ed1\u9519\u6838\u3002 \u5728 CPU \u591a\u6838\u7684\u573a\u666f\u4e0b \uff0c\u7528 taskset \u547d\u4ee4\u628a Redis \u5b9e\u4f8b\u548c\u4e00\u4e2a\u6838\u7ed1\u5b9a\uff0c\u53ef\u4ee5\u51cf\u5c11 Redis \u5b9e\u4f8b\u5728\u4e0d\u540c\u6838\u4e0a\u88ab\u6765\u56de\u8c03\u5ea6\u6267\u884c\u7684\u5f00\u9500\uff0c\u907f\u514d\u8f83\u9ad8\u7684\u5c3e\u5ef6\u8fdf\uff1b \u5728\u591a CPU \u7684 NUMA \u67b6\u6784\u4e0b \uff0c\u5982\u679c\u4f60\u5bf9\u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u505a\u4e86\u7ed1\u6838\u64cd\u4f5c\uff0c \u5efa\u8bae\u4f60\u540c\u65f6\u628a Redis \u5b9e\u4f8b\u548c\u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u7ed1\u5728\u540c\u4e00\u4e2a CPU Socket \u7684\u4e0d\u540c\u6838\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d Redis \u8de8 Socket \u8bbf\u95ee\u5185\u5b58\u4e2d\u7684\u7f51\u7edc\u6570\u636e\u7684\u65f6\u95f4\u5f00\u9500\u3002 4\u3001\u7ed1\u6838\u7684\u98ce\u9669\u548c\u89e3\u51b3\u65b9\u6848 Redis \u9664\u4e86\u4e3b\u7ebf\u7a0b\u4ee5\u5916\uff0c\u8fd8\u6709\u7528\u4e8e RDB \u751f\u6210\u548c AOF \u91cd\u5199\u7684\u5b50\u8fdb\u7a0b Redis \u7684\u540e\u53f0\u7ebf\u7a0b \u5f53\u6211\u4eec\u628a Redis \u5b9e\u4f8b\u7ed1\u5230\u4e00\u4e2a CPU \u903b\u8f91\u6838\u4e0a\u65f6\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5b50\u8fdb\u7a0b\u3001\u540e\u53f0\u7ebf\u7a0b\u548c Redis \u4e3b\u7ebf\u7a0b\u7ade\u4e89 CPU \u8d44\u6e90 \uff0c\u4e00\u65e6\u5b50\u8fdb\u7a0b\u6216\u540e\u53f0\u7ebf\u7a0b\u5360\u7528 CPU \u65f6\uff0c\u4e3b\u7ebf\u7a0b\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u5bfc\u81f4 Redis \u8bf7\u6c42\u5ef6\u8fdf\u589e\u52a0\u3002 \u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0c \u5206\u522b\u662f\u4e00\u4e2a Redis \u5b9e\u4f8b\u5bf9\u5e94\u7ed1\u4e00\u4e2a\u7269\u7406\u6838\u548c\u4f18\u5316 Redis \u6e90\u7801 \u3002 4-1 \u4e00\u4e2a Redis \u5b9e\u4f8b\u5bf9\u5e94\u7ed1\u4e00\u4e2a\u7269\u7406\u6838 \u5728\u7ed9 Redis \u5b9e\u4f8b\u7ed1\u6838\u65f6\uff0c \u6211\u4eec\u4e0d\u8981\u628a\u4e00\u4e2a\u5b9e\u4f8b\u548c\u4e00\u4e2a\u903b\u8f91\u6838\u7ed1\u5b9a\uff0c\u800c\u8981\u548c\u4e00\u4e2a\u7269\u7406\u6838\u7ed1\u5b9a\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u628a\u4e00\u4e2a\u7269\u7406\u6838\u7684 2 \u4e2a\u903b\u8f91\u6838\u90fd\u7528\u4e0a \u3002 \u6211\u4eec\u8fd8\u662f\u4ee5\u521a\u624d\u7684 NUMA \u67b6\u6784\u4e3a\u4f8b\uff0cNUMA node0 \u7684 CPU \u6838\u7f16\u53f7\u662f 0 \u5230 5\u300112 \u5230 17\u3002\u5176\u4e2d\uff0c\u7f16\u53f7 0 \u548c 12\u30011 \u548c 13\u30012 \u548c 14 \u7b49\u90fd\u662f\u8868\u793a\u4e00\u4e2a\u7269\u7406\u6838\u7684 2 \u4e2a\u903b\u8f91\u6838\u3002 \u6240\u4ee5\uff0c\u5728\u7ed1\u6838\u65f6\uff0c\u6211\u4eec\u4f7f\u7528\u5c5e\u4e8e\u540c\u4e00\u4e2a\u7269\u7406\u6838\u7684 2 \u4e2a\u903b\u8f91\u6838\u8fdb\u884c\u7ed1\u6838\u64cd\u4f5c\u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c \u5c31\u628a Redis \u5b9e\u4f8b\u7ed1\u5b9a\u5230\u4e86\u903b\u8f91\u6838 0 \u548c 12 \u4e0a\uff0c\u800c\u8fd9\u4e24\u4e2a\u6838\u6b63\u597d\u90fd\u5c5e\u4e8e\u7269\u7406\u6838 1 \u3002 taskset -c 0,12 ./redis-server \u548c\u53ea\u7ed1\u4e00\u4e2a\u903b\u8f91\u6838\u76f8\u6bd4\uff0c\u628a Redis \u5b9e\u4f8b\u548c\u7269\u7406\u6838\u7ed1\u5b9a\uff0c\u53ef\u4ee5\u8ba9\u4e3b\u7ebf\u7a0b\u3001\u5b50\u8fdb\u7a0b\u3001\u540e\u53f0\u7ebf\u7a0b\u5171\u4eab\u4f7f\u7528 2 \u4e2a\u903b\u8f91\u6838\uff0c\u53ef\u4ee5\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u7f13\u89e3 CPU \u8d44\u6e90\u7ade\u4e89\u3002 \u4f46\u662f\uff0c\u56e0\u4e3a\u53ea\u7528\u4e86 2 \u4e2a\u903b\u8f91\u6838\uff0c\u5b83\u4eec\u76f8\u4e92\u4e4b\u95f4\u7684 CPU \u7ade\u4e89\u4ecd\u7136\u8fd8\u4f1a\u5b58\u5728\u3002\u5982\u679c\u4f60\u8fd8\u60f3\u8fdb\u4e00\u6b65\u51cf\u5c11 CPU \u7ade\u4e89\uff0c\u6211\u518d\u7ed9\u4f60\u4ecb\u7ecd\u4e00\u79cd\u65b9\u6848\u3002 4-2 \u4f18\u5316 Redis \u6e90\u7801 \u8fd9\u4e2a\u65b9\u6848\u5c31\u662f\u901a\u8fc7\u4fee\u6539 Redis \u6e90\u7801\uff0c \u628a\u5b50\u8fdb\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\u7ed1\u5230\u4e0d\u540c\u7684 CPU \u6838\u4e0a\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u5148\u4ecb\u7ecd\u4e00\u4e0b\u901a\u7528\u7684\u505a\u6cd5\uff0c\u7136\u540e\uff0c\u518d\u5177\u4f53\u8bf4\u8bf4\u53ef\u4ee5\u628a\u8fd9\u4e2a\u505a\u6cd5\u5bf9\u5e94\u5230 Redis \u7684\u54ea\u90e8\u5206\u6e90\u7801\u4e2d\u3002 \u901a\u8fc7\u7f16\u7a0b\u5b9e\u73b0\u7ed1\u6838\u65f6\uff0c\u8981\u7528\u5230\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684 1 \u4e2a\u6570\u636e\u7ed3\u6784 cpu_set_t \u548c 3 \u4e2a\u51fd\u6570 CPU_ZERO \u3001 CPU_SET \u548c sched_setaffinity \uff0c\u6211\u5148\u6765\u89e3\u91ca\u4e0b\u5b83\u4eec\u3002 cpu_set_t \u6570\u636e\u7ed3\u6784\uff1a\u662f\u4e00\u4e2a\u4f4d\u56fe\uff0c\u6bcf\u4e00\u4f4d\u7528\u6765\u8868\u793a\u670d\u52a1\u5668\u4e0a\u7684\u4e00\u4e2a CPU \u903b\u8f91\u6838\u3002 CPU_ZERO \u51fd\u6570\uff1a\u4ee5 cpu_set_t \u7ed3\u6784\u7684\u4f4d\u56fe\u4e3a\u8f93\u5165\u53c2\u6570\uff0c\u628a\u4f4d\u56fe\u4e2d\u6240\u6709\u7684\u4f4d\u8bbe\u7f6e\u4e3a 0\u3002 CPU_SET \u51fd\u6570\uff1a\u4ee5 CPU \u903b\u8f91\u6838\u7f16\u53f7\u548c cpu_set_t \u4f4d\u56fe\u4e3a\u53c2\u6570\uff0c\u628a\u4f4d\u56fe\u4e2d\u548c\u8f93\u5165\u7684\u903b\u8f91\u6838\u7f16\u53f7\u5bf9\u5e94\u7684\u4f4d\u8bbe\u7f6e\u4e3a 1\u3002 sched_setaffinity \u51fd\u6570\uff1a\u4ee5\u8fdb\u7a0b / \u7ebf\u7a0b ID \u53f7\u548c cpu_set_t \u4e3a\u53c2\u6570\uff0c\u68c0\u67e5 cpu_set_t \u4e2d\u54ea\u4e00\u4f4d\u4e3a 1\uff0c\u5c31\u628a\u8f93\u5165\u7684 ID \u53f7\u6240\u4ee3\u8868\u7684\u8fdb\u7a0b / \u7ebf\u7a0b\u7ed1\u5728\u5bf9\u5e94\u7684\u903b\u8f91\u6838\u4e0a\u3002 \u600e\u4e48\u5728\u7f16\u7a0b\u65f6\u628a\u8fd9\u4e09\u4e2a\u51fd\u6570\u7ed3\u5408\u8d77\u6765\u5b9e\u73b0\u7ed1\u6838\u5462\uff1f \u7b2c\u4e00\u6b65\uff1a\u521b\u5efa\u4e00\u4e2a cpu_set_t \u7ed3\u6784\u7684\u4f4d\u56fe\u53d8\u91cf\uff1b \u7b2c\u4e8c\u6b65\uff1a\u4f7f\u7528 CPU_ZERO \u51fd\u6570\uff0c\u628a cpu_set_t \u7ed3\u6784\u7684\u4f4d\u56fe\u6240\u6709\u7684\u4f4d\u90fd\u8bbe\u7f6e\u4e3a 0\uff1b \u7b2c\u4e09\u6b65\uff1a\u6839\u636e\u8981\u7ed1\u5b9a\u7684\u903b\u8f91\u6838\u7f16\u53f7\uff0c\u4f7f\u7528 CPU_SET \u51fd\u6570\uff0c\u628a cpu_set_t \u7ed3\u6784\u7684\u4f4d\u56fe\u76f8\u5e94\u4f4d\u8bbe\u7f6e\u4e3a 1\uff1b \u7b2c\u56db\u6b65\uff1a\u4f7f\u7528 sched_setaffinity \u51fd\u6570\uff0c\u628a\u7a0b\u5e8f\u7ed1\u5b9a\u5728 cpu_set_t \u7ed3\u6784\u4f4d\u56fe\u4e2d\u4e3a 1 \u7684\u903b\u8f91\u6838\u4e0a\u3002 \u5148\u8bf4\u540e\u53f0\u7ebf\u7a0b\u3002\u4e3a\u4e86\u8ba9\u4f60\u66f4\u597d\u5730\u7406\u89e3\u7f16\u7a0b\u5b9e\u73b0\u7ed1\u6838\uff0c\u4f60\u53ef\u4ee5\u770b\u4e0b\u8fd9\u6bb5\u793a\u4f8b\u4ee3\u7801\uff0c\u5b83\u5b9e\u73b0\u4e86\u4e3a\u7ebf\u7a0b\u7ed1\u6838\u7684\u64cd\u4f5c\uff1a //\u7ebf\u7a0b\u51fd\u6570 void worker(int bind_cpu){ cpu_set_t cpuset; //\u521b\u5efa\u4f4d\u56fe\u53d8\u91cf CPU_ZERO(&cpu_set); //\u4f4d\u56fe\u53d8\u91cf\u6240\u6709\u4f4d\u8bbe\u7f6e0 CPU_SET(bind_cpu, &cpuset); //\u6839\u636e\u8f93\u5165\u7684bind_cpu\u7f16\u53f7\uff0c\u628a\u4f4d\u56fe\u5bf9\u5e94\u4e3a\u8bbe\u7f6e\u4e3a1 sched_setaffinity(0, sizeof(cpuset), &cpuset); //\u628a\u7a0b\u5e8f\u7ed1\u5b9a\u5728cpu_set_t\u7ed3\u6784\u4f4d\u56fe\u4e2d\u4e3a1\u7684\u903b\u8f91\u6838 //\u5b9e\u9645\u7ebf\u7a0b\u51fd\u6570\u5de5\u4f5c } int main(){ pthread_t pthread1 //\u628a\u521b\u5efa\u7684pthread1\u7ed1\u5728\u7f16\u53f7\u4e3a3\u7684\u903b\u8f91\u6838\u4e0a pthread_create(&pthread1, NULL, (void *)worker, 3); } \u5bf9\u4e8e Redis \u6765\u8bf4\uff0c\u5b83\u662f\u5728 bio.c \u6587\u4ef6\u4e2d\u7684 bioProcessBackgroundJobs \u51fd\u6570\u4e2d\u521b\u5efa\u4e86\u540e\u53f0\u7ebf\u7a0b\u3002bioProcessBackgroundJobs \u51fd\u6570\u7c7b\u4f3c\u4e8e\u521a\u521a\u7684\u4f8b\u5b50\u4e2d\u7684 worker \u51fd\u6570\uff0c\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d\u5b9e\u73b0\u7ed1\u6838\u56db\u6b65\u64cd\u4f5c\uff0c\u5c31\u53ef\u4ee5\u628a\u540e\u53f0\u7ebf\u7a0b\u7ed1\u5230\u548c\u4e3b\u7ebf\u7a0b\u4e0d\u540c\u7684\u6838\u4e0a\u4e86\u3002 \u548c\u7ed9\u7ebf\u7a0b\u7ed1\u6838\u7c7b\u4f3c\uff0c\u5f53\u6211\u4eec\u4f7f\u7528 fork \u521b\u5efa\u5b50\u8fdb\u7a0b\u65f6\uff0c\u4e5f\u53ef\u4ee5\u628a\u521a\u521a\u8bf4\u7684\u56db\u6b65\u64cd\u4f5c\u5b9e\u73b0\u5728 fork \u540e\u7684\u5b50\u8fdb\u7a0b\u4ee3\u7801\u4e2d\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a int main(){ //\u7528fork\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b pid_t p = fork(); if(p < 0){ printf(\" fork error\\n\"); } //\u5b50\u8fdb\u7a0b\u4ee3\u7801\u90e8\u5206 else if(!p){ cpu_set_t cpuset; //\u521b\u5efa\u4f4d\u56fe\u53d8\u91cf CPU_ZERO(&cpu_set); //\u4f4d\u56fe\u53d8\u91cf\u6240\u6709\u4f4d\u8bbe\u7f6e0 CPU_SET(3, &cpuset); //\u628a\u4f4d\u56fe\u7684\u7b2c3\u4f4d\u8bbe\u7f6e\u4e3a1 sched_setaffinity(0, sizeof(cpuset), &cpuset); //\u628a\u7a0b\u5e8f\u7ed1\u5b9a\u57283\u53f7\u903b\u8f91\u6838 //\u5b9e\u9645\u5b50\u8fdb\u7a0b\u5de5\u4f5c exit(0); } ... } \u5bf9\u4e8e Redis \u6765\u8bf4\uff0c\u751f\u6210 RDB \u548c AOF \u65e5\u5fd7\u91cd\u5199\u7684\u5b50\u8fdb\u7a0b\u5206\u522b\u662f\u4e0b\u9762\u4e24\u4e2a\u6587\u4ef6\u7684\u51fd\u6570\u4e2d\u5b9e\u73b0\u7684\u3002 rdb.c \u6587\u4ef6\uff1ardbSaveBackground \u51fd\u6570\uff1b aof.c \u6587\u4ef6\uff1arewriteAppendOnlyFileBackground \u51fd\u6570\u3002 \u8fd9\u4e24\u4e2a\u51fd\u6570\u4e2d\u90fd\u8c03\u7528\u4e86 fork \u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u5b50\u8fdb\u7a0b\u4ee3\u7801\u90e8\u5206\u52a0\u4e0a\u7ed1\u6838\u7684\u56db\u6b65\u64cd\u4f5c\u3002 \u4f7f\u7528\u6e90\u7801\u4f18\u5316\u65b9\u6848\uff0c\u6211\u4eec\u65e2\u53ef\u4ee5\u5b9e\u73b0 Redis \u5b9e\u4f8b\u7ed1\u6838\uff0c\u907f\u514d\u5207\u6362\u6838\u5e26\u6765\u7684\u6027\u80fd\u5f71\u54cd\uff0c\u8fd8\u53ef\u4ee5\u8ba9\u5b50\u8fdb\u7a0b\u3001\u540e\u53f0\u7ebf\u7a0b\u548c\u4e3b\u7ebf\u7a0b\u4e0d\u5728\u540c\u4e00\u4e2a\u6838\u4e0a\u8fd0\u884c\uff0c\u907f\u514d\u4e86\u5b83\u4eec\u4e4b\u95f4\u7684 CPU \u8d44\u6e90\u7ade\u4e89\u3002\u76f8\u6bd4\u4f7f\u7528 taskset \u7ed1\u6838\u6765\u8bf4\uff0c\u8fd9\u4e2a\u65b9\u6848\u53ef\u4ee5\u8fdb\u4e00\u6b65\u964d\u4f4e\u7ed1\u6838\u7684\u98ce\u9669\u3002 5\u3001\u672c\u8282\u5c0f\u7ed3 \u591a\u6838 CPU \u67b6\u6784\uff0c\u4ee5\u53ca NUMA \u67b6\u6784\u3002 \u5728\u591a\u6838 CPU \u67b6\u6784\u4e0b\uff0cRedis \u5982\u679c\u5728\u4e0d\u540c\u7684\u6838\u4e0a\u8fd0\u884c\uff0c\u5c31\u9700\u8981\u9891\u7e41\u5730\u8fdb\u884c\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u589e\u52a0 Redis \u7684\u6267\u884c\u65f6\u95f4\uff0c\u5ba2\u6237\u7aef\u4e5f\u4f1a\u89c2\u5bdf\u5230\u8f83\u9ad8\u7684\u5c3e\u5ef6\u8fdf\u4e86\u3002 \u6240\u4ee5\uff0c \u5efa\u8bae\u4f60\u5728 Redis \u8fd0\u884c\u65f6\uff0c\u628a\u5b9e\u4f8b\u548c\u67d0\u4e2a\u6838\u7ed1\u5b9a\uff0c\u8fd9\u6837\uff0c\u5c31\u80fd\u91cd\u590d\u5229\u7528\u6838\u4e0a\u7684 L1\u3001L2 \u7f13\u5b58\uff0c\u53ef\u4ee5\u964d\u4f4e\u54cd\u5e94\u5ef6\u8fdf \u3002 \u4e3a\u4e86\u63d0\u5347 Redis \u7684\u7f51\u7edc\u6027\u80fd\uff0c\u6211\u4eec\u6709\u65f6\u8fd8\u4f1a\u628a\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u548c CPU \u6838\u7ed1\u5b9a\u3002 \u5982\u679c\u670d\u52a1\u5668\u4f7f\u7528\u7684\u662f NUMA \u67b6\u6784\uff0cRedis \u5b9e\u4f8b\u4e00\u65e6\u88ab\u8c03\u5ea6\u5230\u548c\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u4e0d\u5728\u540c\u4e00\u4e2a CPU Socket\uff0c\u5c31\u8981\u8de8 CPU Socket \u8bbf\u95ee\u7f51\u7edc\u6570\u636e\uff0c\u8fd9\u5c31\u4f1a\u964d\u4f4e Redis \u7684\u6027\u80fd\u3002 \u5efa\u8bae\u4f60\u628a Redis \u5b9e\u4f8b\u548c\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u7ed1\u5728\u540c\u4e00\u4e2a CPU Socket \u4e0b\u7684\u4e0d\u540c\u6838\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u5347 Redis \u7684\u8fd0\u884c\u6027\u80fd\u3002 \u867d\u7136\u7ed1\u6838\u53ef\u4ee5\u5e2e\u52a9 Redis \u964d\u4f4e\u8bf7\u6c42\u6267\u884c\u65f6\u95f4\uff0c\u4f46\u662f\uff0c\u9664\u4e86\u4e3b\u7ebf\u7a0b\uff0cRedis \u8fd8\u6709\u7528\u4e8e RDB \u548c AOF \u91cd\u5199\u7684\u5b50\u8fdb\u7a0b\uff0c\u4ee5\u53ca 4.0 \u7248\u672c\u4e4b\u540e\u63d0\u4f9b\u7684\u7528\u4e8e\u60f0\u6027\u5220\u9664\u7684\u540e\u53f0\u7ebf\u7a0b\u3002 \u5f53 Redis \u5b9e\u4f8b\u548c\u4e00\u4e2a\u903b\u8f91\u6838\u7ed1\u5b9a\u540e\uff0c\u8fd9\u4e9b\u5b50\u8fdb\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\u4f1a\u548c\u4e3b\u7ebf\u7a0b\u7ade\u4e89 CPU \u8d44\u6e90\uff0c\u4e5f\u4f1a\u5bf9 Redis \u6027\u80fd\u9020\u6210\u5f71\u54cd \u3002\u6240\u4ee5\uff0c\u6211\u7ed9\u4e86\u4f60\u4e24\u4e2a\u5efa\u8bae\uff1a \u5982\u679c\u4f60\u4e0d\u60f3\u4fee\u6539 Redis \u4ee3\u7801\uff0c \u53ef\u4ee5\u628a\u6309\u4e00\u4e2a Redis \u5b9e\u4f8b\u4e00\u4e2a\u7269\u7406\u6838\u65b9\u5f0f\u8fdb\u884c\u7ed1\u5b9a\uff0c\u8fd9\u6837\uff0cRedis \u7684\u4e3b\u7ebf\u7a0b\u3001\u5b50\u8fdb\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\u53ef\u4ee5\u5171\u4eab\u4f7f\u7528\u4e00\u4e2a\u7269\u7406\u6838\u4e0a\u7684\u4e24\u4e2a\u903b\u8f91\u6838 \u3002 Redis \u7684\u6e90\u7801\uff0c\u5c31\u53ef\u4ee5\u5728\u6e90\u7801\u4e2d\u589e\u52a0\u7ed1\u6838\u64cd\u4f5c\uff0c\u628a\u5b50\u8fdb\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\u7ed1\u5230\u4e0d\u540c\u7684\u6838\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u5bf9\u4e3b\u7ebf\u7a0b\u7684 CPU \u8d44\u6e90\u7ade\u4e89 Redis 6.0 \u51fa\u6765\u540e\uff0c\u53ef\u4ee5\u652f\u6301 CPU \u6838\u7ed1\u5b9a\u7684\u914d\u7f6e\u64cd\u4f5c\u4e86 5-1 \u4eae\u70b9&\u8981\u70b9 \u4e3b\u6d41\u7684CPU\u67b6\u6784\uff0c\u4e3b\u8981\u6709\u591a\u6838CPU\u67b6\u6784\u548cNUMA\u67b6\u6784\u4e24\u4e2a\u67b6\u6784 \u591a\u6838CPU\u67b6\u6784\uff1a \u591a\u4e2a\u7269\u7406\u6838\uff0c\u5404\u7269\u7406\u6838\u4f7f\u7528\u79c1\u6709\u76841\u30012\u7ea7\u7f13\u5b58\uff0c\u5171\u4eab3\u7ea7\u7f13\u5b58\u3002\u7269\u7406\u6838\u53ef\u5305\u542b2\u4e2a\u8d85\u7ebf\u7a0b\uff0c\u79f0\u4e3a\u903b\u8f91\u6838 NUMA\u67b6\u6784\uff1a \u4e00\u4e2a\u670d\u52a1\u5668\u4e0a\u591a\u4e2acpu\uff0c\u79f0\u4e3aCPU Socket\uff0c\u6bcf\u4e2acpu socker\u5b58\u5728\u591a\u4e2a\u7269\u7406\u6838\u3002\u6bcf\u4e2asocket\u901a\u8fc7\u603b\u7ebf\u8fde\u63a5\uff0c\u5e76\u4e14\u6709\u7528\u79c1\u6709\u7684\u5185\u5b58\u7a7a\u95f4 cpu\u67b6\u6784\uff1a\u4e00\u4e2acpu\u4e00\u822c\u62e5\u6709\u591a\u4e2a\u7269\u7406\u6838\uff0c\u6bcf\u4e2a\u7269\u7406\u6838\u90fd\u62e5\u6709\u79c1\u6709\u7684\u4e00\u7ea7\u7f13\u5b58\uff0c\u4e8c\u7ea7\u7f13\u5b58\u3002\u4e09\u7ea7\u7f13\u5b58\u662f\u5404\u7269\u7406\u6838\u5171\u4eab\u7684\u7f13\u5b58\u7a7a\u95f4\u3002\u800c\u7269\u7406\u6838\u53c8\u53ef\u4ee5\u5206\u4e3a\u591a\u4e2a\u8d85\u7ebf\u7a0b\uff0c\u79f0\u4e3a\u903b\u8f91\u6838\uff0c\u540c\u4e00\u4e2a\u7269\u7406\u6838\u7684\u903b\u8f91\u6838\u4f1a\u5171\u4eab\u4f7f\u7528 L1\u3001L2 \u7f13\u5b58\u3002 \u4e00\u7ea7\u7f13\u5b58\u548c\u4e8c\u7ea7\u7f13\u5b58\u8bbf\u95ee\u5ef6\u8fdf\u4e0d\u8d85\u8fc710\u7eb3\u79d2\uff0c\u4f46\u7a7a\u95f4\u5f88\u5c0f\uff0c\u53ea\u662fKB\u5355\u4f4d\u3002\u800c\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u5185\u5b58\u5ef6\u8fdf\u662f\u767e\u7eb3\u79d2\u7ea7\u522b\uff0c\u57fa\u672c\u4e0a\u662f\u4e00\u4e8c\u7ea7\u7f13\u5b58\u768410\u500d \u4e0d\u540c\u7684\u7269\u7406\u6838\u8fd8\u4f1a\u5171\u4eab\u4e00\u4e2a\u5171\u540c\u7684\u4e09\u7ea7\u7f13\u5b58\uff0c\u4e09\u7ea7\u7f13\u5b58\u7a7a\u95f4\u6bd4\u8f83\u591a\uff0c\u4e3a\u51e0\u5230\u51e0\u5341MB\uff0c\u5f53 L1\u3001L2 \u7f13\u5b58\u4e2d\u6ca1\u6709\u6570\u636e\u7f13\u5b58\u65f6\uff0c\u53ef\u4ee5\u8bbf\u95ee L3\uff0c\u5c3d\u53ef\u80fd\u907f\u514d\u8bbf\u95ee\u5185\u5b58\u3002 \u591a\u6838CPU\u8fd0\u884credis\u5b9e\u4f8b\uff0c\u4f1a\u5bfc\u81f4context switch\uff0c\u5bfc\u81f4\u589e\u52a0\u5ef6\u8fdf\uff0c\u53ef\u4ee5\u901a\u8fc7taskset \u547d\u4ee4\u628aredis\u8fdb\u7a0b\u7ed1\u5b9a\u5230\u67d0\u4e2acup\u7269\u7406\u6838\u4e0a\u3002 NUMA\u67b6\u6784\u8fd0\u884credis\u5b9e\u4f8b\uff0c\u5982\u679c\u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u548credis\u5b9e\u4f8b\u8fd0\u884c\u5728\u4e0d\u540c\u7684socket\u4e0a\uff0c\u5c31\u9700\u8981\u8de8 CPU Socket \u8bbf\u95ee\u5185\u5b58\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u82b1\u8d39\u8f83\u591a\u65f6\u95f4\u3002 \u7ed1\u6838\u7684\u98ce\u9669\u548c\u89e3\u51b3\u65b9\u6848\uff1a \u4e00\u4e2a Redis \u5b9e\u4f8b\u5bf9\u5e94\u7ed1\u4e00\u4e2a\u7269\u7406\u6838 \uff1a \u5c06redis\u670d\u52a1\u7ed1\u5b9a\u5230\u4e00\u4e2a\u7269\u7406\u6838\u4e0a\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u903b\u8f91\u6838\u4e0a\uff0c\u5982 taskset -c 0,12 ./redis-server \u4f18\u5316 Redis \u6e90\u7801\u3002","title":"\u7b2c\u4e8c\u8282 \u5728\u591a\u6838CPU\u67b6\u6784\u548cNUMA\u67b6\u6784\u4e0b\u5bf9redis\u8fdb\u884c\u4f18\u5316\u914d\u7f6e"},{"location":"chap4/2redis_cpu/#cpunumaredis","text":"CPU \u7684\u591a\u6838\u67b6\u6784\u4ee5\u53ca\u591a CPU \u67b6\u6784\uff0c\u4e5f\u4f1a\u5f71\u54cd\u5230 Redis \u7684\u6027\u80fd\u3002\u5982\u679c\u4e0d\u4e86\u89e3 CPU \u5bf9 Redis \u7684\u5f71\u54cd\uff0c\u5728\u5bf9 Redis \u7684\u6027\u80fd\u8fdb\u884c\u8c03\u4f18\u65f6\uff0c\u5c31\u53ef\u80fd\u4f1a\u9057\u6f0f\u4e00\u4e9b\u8c03\u4f18\u65b9\u6cd5\uff0c\u4e0d\u80fd\u628a Redis \u7684\u6027\u80fd\u53d1\u6325\u5230\u6781\u9650\u3002","title":"\u7b2c\u4e8c\u8282 \u5728\u591a\u6838CPU\u67b6\u6784\u548cNUMA\u67b6\u6784\u4e0b\u5bf9redis\u8fdb\u884c\u4f18\u5316\u914d\u7f6e"},{"location":"chap4/2redis_cpu/#1-cpu","text":"\u4e00\u4e2a CPU \u5904\u7406\u5668\u4e2d\u4e00\u822c\u6709\u591a\u4e2a\u8fd0\u884c\u6838\u5fc3\uff0c\u6211\u4eec\u628a\u4e00\u4e2a\u8fd0\u884c\u6838\u5fc3\u79f0\u4e3a\u4e00\u4e2a\u7269\u7406\u6838\uff0c\u6bcf\u4e2a\u7269\u7406\u6838\u90fd\u53ef\u4ee5\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u3002 \u6bcf\u4e2a\u7269\u7406\u6838\u90fd\u62e5\u6709\u79c1\u6709\u7684\u4e00\u7ea7\u7f13\u5b58\uff08Level 1 cache\uff0c\u7b80\u79f0 L1 cache\uff09\uff0c\u5305\u62ec\u4e00\u7ea7\u6307\u4ee4\u7f13\u5b58\u548c\u4e00\u7ea7\u6570\u636e\u7f13\u5b58\uff0c\u4ee5\u53ca\u79c1\u6709\u7684\u4e8c\u7ea7\u7f13\u5b58\uff08Level 2 cache\uff0c\u7b80\u79f0 L2 cache\uff09\u3002","title":"1\u3001\u4e3b\u6d41\u7684 CPU \u67b6\u6784"},{"location":"chap4/2redis_cpu/#1-1","text":"\u5b83\u5176\u5b9e\u662f\u6307\u7f13\u5b58\u7a7a\u95f4\u53ea\u80fd\u88ab\u5f53\u524d\u7684\u8fd9\u4e2a\u7269\u7406\u6838\u4f7f\u7528\uff0c\u5176\u4ed6\u7684\u7269\u7406\u6838\u65e0\u6cd5\u5bf9\u8fd9\u4e2a\u6838\u7684\u7f13\u5b58\u7a7a\u95f4\u8fdb\u884c\u6570\u636e\u5b58\u53d6\u3002\u6211\u4eec\u6765\u770b\u4e00\u4e0b CPU \u7269\u7406\u6838\u7684\u67b6\u6784\u3002 \u56e0\u4e3a L1 \u548c L2 \u7f13\u5b58\u662f\u6bcf\u4e2a\u7269\u7406\u6838\u79c1\u6709\u7684\uff0c\u6240\u4ee5\uff0c\u5f53\u6570\u636e\u6216\u6307\u4ee4\u4fdd\u5b58\u5728 L1\u3001L2 \u7f13\u5b58\u65f6\uff0c\u7269\u7406\u6838\u8bbf\u95ee\u5b83\u4eec\u7684\u5ef6\u8fdf\u4e0d\u8d85\u8fc7 10 \u7eb3\u79d2\uff0c\u901f\u5ea6\u975e\u5e38\u5feb\u3002 \u90a3\u4e48\uff0c\u5982\u679c Redis \u628a\u8981\u8fd0\u884c\u7684\u6307\u4ee4\u6216\u5b58\u53d6\u7684\u6570\u636e\u4fdd\u5b58\u5728 L1 \u548c L2 \u7f13\u5b58\u7684\u8bdd\uff0c\u5c31\u80fd\u9ad8\u901f\u5730\u8bbf\u95ee\u8fd9\u4e9b\u6307\u4ee4\u548c\u6570\u636e\u3002 \u4f46\u662f\uff0c\u8fd9\u4e9b L1 \u548c L2 \u7f13\u5b58\u7684\u5927\u5c0f\u53d7\u9650\u4e8e\u5904\u7406\u5668\u7684\u5236\u9020\u6280\u672f\uff0c\u4e00\u822c\u53ea\u6709 KB \u7ea7\u522b\uff0c\u5b58\u4e0d\u4e0b\u592a\u591a\u7684\u6570\u636e\u3002 \u5982\u679c L1\u3001L2 \u7f13\u5b58\u4e2d\u6ca1\u6709\u6240\u9700\u7684\u6570\u636e\uff0c\u5e94\u7528\u7a0b\u5e8f\u5c31\u9700\u8981\u8bbf\u95ee\u5185\u5b58\u6765\u83b7\u53d6\u6570\u636e\u3002\u800c\u5e94\u7528\u7a0b\u5e8f\u7684\u8bbf\u5b58\u5ef6\u8fdf\u4e00\u822c\u5728\u767e\u7eb3\u79d2\u7ea7\u522b\uff0c\u662f\u8bbf\u95ee L1\u3001L2 \u7f13\u5b58\u7684\u5ef6\u8fdf\u7684\u8fd1 10 \u500d\uff0c\u4e0d\u53ef\u907f\u514d\u5730\u4f1a\u5bf9\u6027\u80fd\u9020\u6210\u5f71\u54cd\u3002 \u6240\u4ee5\uff0c\u4e0d\u540c\u7684\u7269\u7406\u6838\u8fd8\u4f1a\u5171\u4eab\u4e00\u4e2a\u5171\u540c\u7684\u4e09\u7ea7\u7f13\u5b58\uff08Level 3 cache\uff0c\u7b80\u79f0\u4e3a L3 cache\uff09 L3 \u7f13\u5b58\u80fd\u591f\u4f7f\u7528\u7684\u5b58\u50a8\u8d44\u6e90\u6bd4\u8f83\u591a\uff0c\u6240\u4ee5\u4e00\u822c\u6bd4\u8f83\u5927\uff0c\u80fd\u8fbe\u5230\u51e0 MB \u5230\u51e0\u5341 MB\uff0c\u8fd9\u5c31\u80fd\u8ba9\u5e94\u7528\u7a0b\u5e8f\u7f13\u5b58\u66f4\u591a\u7684\u6570\u636e\u3002\u5f53 L1\u3001L2 \u7f13\u5b58\u4e2d\u6ca1\u6709\u6570\u636e\u7f13\u5b58\u65f6\uff0c\u53ef\u4ee5\u8bbf\u95ee L3\uff0c\u5c3d\u53ef\u80fd\u907f\u514d\u8bbf\u95ee\u5185\u5b58\u3002 3 \u7f13\u5b58\u80fd\u591f\u4f7f\u7528\u7684\u5b58\u50a8\u8d44\u6e90\u6bd4\u8f83\u591a\uff0c\u6240\u4ee5\u4e00\u822c\u6bd4\u8f83\u5927\uff0c\u80fd\u8fbe\u5230\u51e0 MB \u5230\u51e0\u5341 MB\uff0c\u8fd9\u5c31\u80fd\u8ba9\u5e94\u7528\u7a0b\u5e8f\u7f13\u5b58\u66f4\u591a\u7684\u6570\u636e\u3002\u5f53 L1\u3001L2 \u7f13\u5b58\u4e2d\u6ca1\u6709\u6570\u636e\u7f13\u5b58\u65f6\uff0c\u53ef\u4ee5\u8bbf\u95ee L3\uff0c\u5c3d\u53ef\u80fd\u907f\u514d\u8bbf\u95ee\u5185\u5b58\u3002","title":"1-1 \u7269\u7406\u6838\u7684\u79c1\u6709\u7f13\u5b58"},{"location":"chap4/2redis_cpu/#1-2","text":"\u53e6\u5916\uff0c\u73b0\u5728\u4e3b\u6d41\u7684 CPU \u5904\u7406\u5668\u4e2d\uff0c \u6bcf\u4e2a\u7269\u7406\u6838\u901a\u5e38\u90fd\u4f1a\u8fd0\u884c\u4e24\u4e2a\u8d85\u7ebf\u7a0b\uff0c\u4e5f\u53eb\u4f5c\u903b\u8f91\u6838 \u3002\u540c\u4e00\u4e2a\u7269\u7406\u6838\u7684\u903b\u8f91\u6838\u4f1a\u5171\u4eab\u4f7f\u7528 L1\u3001L2 \u7f13\u5b58\u3002 \u7269\u7406\u6838\u548c\u903b\u8f91\u6838\uff0c\u4ee5\u53ca\u4e00\u7ea7\u3001\u4e8c\u7ea7\u7f13\u5b58\u7684\u5173\u7cfb\u3002 \u5728\u4e3b\u6d41\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u4e00\u4e2a CPU \u5904\u7406\u5668\u4f1a\u6709 10 \u5230 20 \u591a\u4e2a\u7269\u7406\u6838\u3002 \u540c\u65f6\uff0c \u4e3a\u4e86\u63d0\u5347\u670d\u52a1\u5668\u7684\u5904\u7406\u80fd\u529b\uff0c\u670d\u52a1\u5668\u4e0a\u901a\u5e38\u8fd8\u4f1a\u6709\u591a\u4e2a CPU \u5904\u7406\u5668\uff08\u4e5f\u79f0\u4e3a\u591a CPU Socket \uff09\uff0c\u6bcf\u4e2a\u5904\u7406\u5668\u6709\u81ea\u5df1\u7684\u7269\u7406\u6838\uff08\u5305\u62ec L1\u3001L2 \u7f13\u5b58\uff09\uff0cL3 \u7f13\u5b58\uff0c\u4ee5\u53ca\u8fde\u63a5\u7684\u5185\u5b58\uff0c\u540c\u65f6\uff0c\u4e0d\u540c\u5904\u7406\u5668\u95f4\u901a\u8fc7\u603b\u7ebf\u8fde\u63a5\u3002 \u5728\u591a CPU \u67b6\u6784\u4e0a\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u5904\u7406\u5668\u4e0a\u8fd0\u884c Redis \u53ef\u4ee5\u5148\u5728 Socket 1 \u4e0a\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\uff0c\u7136\u540e\u518d\u88ab\u8c03\u5ea6\u5230 Socket 2 \u4e0a\u8fd0\u884c\u3002 \u4f46\u662f\uff0c\u6709\u4e2a\u5730\u65b9\u9700\u8981\u4f60\u6ce8\u610f\u4e00\u4e0b\uff1a\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u5148\u5728\u4e00\u4e2a Socket \u4e0a\u8fd0\u884c\uff0c\u5e76\u4e14\u628a\u6570\u636e\u4fdd\u5b58\u5230\u4e86\u5185\u5b58\uff0c\u7136\u540e\u88ab\u8c03\u5ea6\u5230\u53e6\u4e00\u4e2a Socket \u4e0a\u8fd0\u884c\uff0c\u6b64\u65f6\uff0c\u5e94\u7528\u7a0b\u5e8f\u518d\u8fdb\u884c\u5185\u5b58\u8bbf\u95ee\u65f6\uff0c\u5c31\u9700\u8981\u8bbf\u95ee\u4e4b\u524d Socket \u4e0a\u8fde\u63a5\u7684\u5185\u5b58\uff0c\u8fd9\u79cd\u8bbf\u95ee\u5c5e\u4e8e \u8fdc\u7aef\u5185\u5b58\u8bbf\u95ee \u3002 \u548c\u8bbf\u95ee Socket \u76f4\u63a5\u8fde\u63a5\u7684\u5185\u5b58\u76f8\u6bd4\uff0c\u8fdc\u7aef\u5185\u5b58\u8bbf\u95ee\u4f1a\u589e\u52a0\u5e94\u7528\u7a0b\u5e8f\u7684\u5ef6\u8fdf \u3002","title":"1-2 \u903b\u8f91\u6838"},{"location":"chap4/2redis_cpu/#1-3-non-uniform-memory-accessnuma","text":"\u5728\u591a CPU \u67b6\u6784\u4e0b\uff0c\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u6240\u5728 Socket \u7684\u672c\u5730\u5185\u5b58\u548c\u8bbf\u95ee\u8fdc\u7aef\u5185\u5b58\u7684\u5ef6\u8fdf\u5e76\u4e0d\u4e00\u81f4 \uff0c\u6240\u4ee5\uff0c \u6211\u4eec\u4e5f\u628a\u8fd9\u4e2a\u67b6\u6784\u79f0\u4e3a\u975e\u7edf\u4e00\u5185\u5b58\u8bbf\u95ee\u67b6\u6784\uff08Non-Uniform Memory Access\uff0cNUMA \u67b6\u6784\uff09 \u3002 \u4eec\u5c31\u77e5\u9053\u4e86\u4e3b\u6d41\u7684 CPU \u591a\u6838\u67b6\u6784\u548c\u591a CPU \u67b6\u6784\uff0c\u6211\u4eec\u6765\u7b80\u5355\u603b\u7ed3\u4e0b CPU \u67b6\u6784\u5bf9\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u7684\u5f71\u54cd\u3002 L1\u3001L2 \u7f13\u5b58\u4e2d\u7684\u6307\u4ee4\u548c\u6570\u636e\u7684\u8bbf\u95ee\u901f\u5ea6\u5f88\u5feb\uff0c\u6240\u4ee5\uff0c\u5145\u5206\u5229\u7528 L1\u3001L2 \u7f13\u5b58\uff0c\u53ef\u4ee5\u6709\u6548\u7f29\u77ed\u5e94\u7528\u7a0b\u5e8f\u7684\u6267\u884c\u65f6\u95f4\uff1b \u5728 NUMA \u67b6\u6784\u4e0b\uff0c\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u4ece\u4e00\u4e2a Socket \u4e0a\u8c03\u5ea6\u5230\u53e6\u4e00\u4e2a Socket \u4e0a\uff0c\u5c31\u53ef\u80fd\u4f1a\u51fa\u73b0\u8fdc\u7aef\u5185\u5b58\u8bbf\u95ee\u7684\u60c5\u51b5\uff0c\u8fd9\u4f1a\u76f4\u63a5\u589e\u52a0\u5e94\u7528\u7a0b\u5e8f\u7684\u6267\u884c\u65f6\u95f4","title":"1-3 Non-Uniform Memory Access\uff0cNUMA \u67b6\u6784"},{"location":"chap4/2redis_cpu/#2cpu-redis","text":"\u5728\u4e00\u4e2a CPU \u6838\u4e0a\u8fd0\u884c\u65f6\uff0c\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u8bb0\u5f55\u81ea\u8eab\u4f7f\u7528\u7684\u8f6f\u786c\u4ef6\u8d44\u6e90\u4fe1\u606f\uff08\u4f8b\u5982\u6808\u6307\u9488\u3001CPU \u6838\u7684\u5bc4\u5b58\u5668\u503c\u7b49\uff09\uff0c\u6211\u4eec\u628a\u8fd9\u4e9b\u4fe1\u606f\u79f0\u4e3a \u8fd0\u884c\u65f6\u4fe1\u606f \u3002 \u540c\u65f6\uff0c\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u6700\u9891\u7e41\u7684\u6307\u4ee4\u548c\u6570\u636e\u8fd8\u4f1a\u88ab\u7f13\u5b58\u5230 L1\u3001L2 \u7f13\u5b58\u4e0a\uff0c\u4ee5\u4fbf\u63d0\u5347\u6267\u884c\u901f\u5ea6\u3002 \u4f46\u662f\uff0c\u5728\u591a\u6838 CPU \u7684\u573a\u666f\u4e0b\uff0c\u4e00\u65e6\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u5728\u4e00\u4e2a\u65b0\u7684 CPU \u6838\u4e0a\u8fd0\u884c\uff0c\u90a3\u4e48\uff0c\u8fd0\u884c\u65f6\u4fe1\u606f\u5c31\u9700\u8981\u91cd\u65b0\u52a0\u8f7d\u5230\u65b0\u7684 CPU \u6838\u4e0a\u3002\u800c\u4e14\uff0c \u65b0\u7684 CPU \u6838\u7684 L1\u3001L2 \u7f13\u5b58\u4e5f\u9700\u8981\u91cd\u65b0\u52a0\u8f7d\u6570\u636e\u548c\u6307\u4ee4\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u7a0b\u5e8f\u7684\u8fd0\u884c\u65f6\u95f4\u589e\u52a0\u3002","title":"2\u3001CPU \u591a\u6838\u5bf9 Redis \u6027\u80fd\u7684\u5f71\u54cd"},{"location":"chap4/2redis_cpu/#2-1-cpu-redis","text":"\u76ee\u9700\u6c42\u662f\u8981\u5bf9 Redis \u7684 99% \u5c3e\u5ef6\u8fdf\u8fdb\u884c\u4f18\u5316\uff0c\u8981\u6c42 GET \u5c3e\u5ef6\u8fdf\u5c0f\u4e8e 300 \u5fae\u79d2\uff0cPUT \u5c3e\u5ef6\u8fdf\u5c0f\u4e8e 500 \u5fae\u79d2\u3002 99% \u5c3e\u5ef6\u8fdf \u6211\u4eec\u628a\u6240\u6709\u8bf7\u6c42\u7684\u5904\u7406\u5ef6\u8fdf\u4ece\u5c0f\u5230\u5927\u6392\u4e2a\u5e8f\uff0c99% \u7684\u8bf7\u6c42\u5ef6\u8fdf\u5c0f\u4e8e\u7684\u503c\u5c31\u662f 99% \u5c3e\u5ef6\u8fdf\u3002\u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u6709 1000 \u4e2a\u8bf7\u6c42\uff0c\u5047\u8bbe\u6309\u8bf7\u6c42\u5ef6\u8fdf\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u540e\uff0c \u7b2c 991 \u4e2a\u8bf7\u6c42\u7684\u5ef6\u8fdf\u5b9e\u6d4b\u503c\u662f 1ms\uff0c\u800c\u524d 990 \u4e2a\u8bf7\u6c42\u7684\u5ef6\u8fdf\u90fd\u5c0f\u4e8e 1ms\uff0c\u6240\u4ee5\uff0c\u8fd9\u91cc\u7684 99% \u5c3e\u5ef6\u8fdf\u5c31\u662f 1ms\u3002 \u6211\u4eec\u4f7f\u7528 GET/PUT \u590d\u6742\u5ea6\u4e3a O(1) \u7684 String \u7c7b\u578b\u8fdb\u884c\u6570\u636e\u5b58\u53d6\uff0c\u540c\u65f6\u5173\u95ed\u4e86 RDB \u548c AOF \uff0c\u800c\u4e14\uff0cRedis \u5b9e\u4f8b\u4e2d\u6ca1\u6709\u4fdd\u5b58\u96c6\u5408\u7c7b\u578b\u7684\u5176\u4ed6\u6570\u636e\uff0c\u4e5f\u5c31\u6ca1\u6709 bigkey \u64cd\u4f5c\uff0c \u907f\u514d\u4e86\u53ef\u80fd\u5bfc\u81f4\u5ef6\u8fdf\u589e\u52a0\u7684\u8bb8\u591a\u60c5\u51b5 \u5373\u4f7f\u8fd9\u6837\uff0c\u6211\u4eec\u5728\u4e00\u53f0\u6709 24 \u4e2a CPU \u6838\u7684\u670d\u52a1\u5668\u4e0a\u8fd0\u884c Redis \u5b9e\u4f8b\uff0cGET \u548c PUT \u7684 99% \u5c3e\u5ef6\u8fdf\u5206\u522b\u662f 504 \u5fae\u79d2\u548c 1175 \u5fae\u79d2\uff0c\u660e\u663e\u5927\u4e8e\u6211\u4eec\u8bbe\u5b9a\u7684\u76ee\u6807\u3002 \u68c0\u6d4b\u4e86 Redis \u5b9e\u4f8b\u8fd0\u884c\u65f6\u7684\u670d\u52a1\u5668 CPU \u7684\u72b6\u6001\u6307\u6807\u503c\uff0c\u8fd9\u624d\u53d1\u73b0\uff0cCPU \u7684 context switch \u6b21\u6570\u6bd4\u8f83\u591a\u3002 context switch context switch \u662f\u6307\u7ebf\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u8fd9\u91cc\u7684\u4e0a\u4e0b\u6587\u5c31\u662f\u7ebf\u7a0b\u7684\u8fd0\u884c\u65f6\u4fe1\u606f\u3002 \u5728 CPU \u591a\u6838\u7684\u73af\u5883\u4e2d\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u5148\u5728\u4e00\u4e2a CPU \u6838\u4e0a\u8fd0\u884c\uff0c\u4e4b\u540e\u53c8\u5207\u6362\u5230\u53e6\u4e00\u4e2a CPU \u6838\u4e0a\u8fd0\u884c\uff0c\u8fd9\u65f6\u5c31\u4f1a\u53d1\u751f context switch\u3002 \u591a\u6838CPU\u8fd0\u884c\u6162\u7684\u539f\u56e0 1\u3001\u4e00\u4e2a\u6838\u8fd0\u884c\uff0c\u9700\u8981\u8bb0\u5f55\u8fd0\u884c\u5230\u54ea\u91cc\u4e86\uff0c\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u6838\u7684\u65f6\u5019\uff0c\u9700\u8981\u628a\u8bb0\u5f55\u7684\u8fd0\u884c\u65f6\u4fe1\u606f\u540c\u6b65\u5230\u53e6\u4e00\u4e2a\u6838\u4e0a\u3002 2\u3001\u53e6\u4e00\u4e2a CPU \u6838\u4e0a\u7684 L1\u3001L2 \u7f13\u5b58\u4e2d\uff0c\u5e76\u6ca1\u6709 Redis \u5b9e\u4f8b\u4e4b\u524d\u8fd0\u884c\u65f6\u9891\u7e41\u8bbf\u95ee\u7684\u6307\u4ee4\u548c\u6570\u636e\uff0c\u6240\u4ee5\uff0c\u8fd9\u4e9b\u6307\u4ee4\u548c\u6570\u636e\u90fd\u9700\u8981\u91cd\u65b0\u4ece L3 \u7f13\u5b58\uff0c\u751a\u81f3\u662f\u5185\u5b58\u4e2d\u52a0\u8f7d\u3002\u8fd9\u4e2a\u91cd\u65b0\u52a0\u8f7d\u7684\u8fc7\u7a0b\u662f\u9700\u8981\u82b1\u8d39\u4e00\u5b9a\u65f6\u95f4\u7684\u3002 \u5f53 context switch \u53d1\u751f\u540e\uff0cRedis \u4e3b\u7ebf\u7a0b\u7684\u8fd0\u884c\u65f6\u4fe1\u606f\u9700\u8981\u88ab\u91cd\u65b0\u52a0\u8f7d\u5230\u53e6\u4e00\u4e2a CPU \u6838\u4e0a\uff0c\u800c\u4e14\uff0c\u6b64\u65f6\uff0c\u53e6\u4e00\u4e2a CPU \u6838\u4e0a\u7684 L1\u3001L2 \u7f13\u5b58\u4e2d\uff0c\u5e76\u6ca1\u6709 Redis \u5b9e\u4f8b\u4e4b\u524d\u8fd0\u884c\u65f6\u9891\u7e41\u8bbf\u95ee\u7684\u6307\u4ee4\u548c\u6570\u636e\uff0c\u6240\u4ee5\uff0c \u8fd9\u4e9b\u6307\u4ee4\u548c\u6570\u636e\u90fd\u9700\u8981\u91cd\u65b0\u4ece L3 \u7f13\u5b58\uff0c\u751a\u81f3\u662f\u5185\u5b58\u4e2d\u52a0\u8f7d\u3002\u8fd9\u4e2a\u91cd\u65b0\u52a0\u8f7d\u7684\u8fc7\u7a0b\u662f\u9700\u8981\u82b1\u8d39\u4e00\u5b9a\u65f6\u95f4\u7684 \u800c\u4e14\uff0cRedis \u5b9e\u4f8b\u9700\u8981\u7b49\u5f85\u8fd9\u4e2a\u91cd\u65b0\u52a0\u8f7d\u7684\u8fc7\u7a0b\u5b8c\u6210\u540e\uff0c\u624d\u80fd\u5f00\u59cb\u5904\u7406\u8bf7\u6c42\uff0c\u6240\u4ee5\uff0c\u8fd9\u4e5f\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u8bf7\u6c42\u7684\u5904\u7406\u65f6\u95f4\u589e\u52a0\u3002 \u5982\u679c\u5728 CPU \u591a\u6838\u573a\u666f\u4e0b\uff0cRedis \u5b9e\u4f8b\u88ab\u9891\u7e41\u8c03\u5ea6\u5230\u4e0d\u540c CPU \u6838\u4e0a\u8fd0\u884c\u7684\u8bdd\uff0c\u90a3\u4e48\uff0c\u5bf9 Redis \u5b9e\u4f8b\u7684\u8bf7\u6c42\u5904\u7406\u65f6\u95f4\u5f71\u54cd\u5c31\u66f4\u5927\u4e86\u3002 \u6bcf\u8c03\u5ea6\u4e00\u6b21\uff0c\u4e00\u4e9b\u8bf7\u6c42\u5c31\u4f1a\u53d7\u5230\u8fd0\u884c\u65f6\u4fe1\u606f\u3001\u6307\u4ee4\u548c\u6570\u636e\u91cd\u65b0\u52a0\u8f7d\u8fc7\u7a0b\u7684\u5f71\u54cd\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u67d0\u4e9b\u8bf7\u6c42\u7684\u5ef6\u8fdf\u660e\u663e\u9ad8\u4e8e\u5176\u4ed6\u8bf7\u6c42\u3002 \u5206\u6790\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u5c31\u77e5\u9053\u4e86\u521a\u521a\u7684\u4f8b\u5b50\u4e2d 99% \u5c3e\u5ef6\u8fdf\u7684\u503c\u59cb\u7ec8\u964d\u4e0d\u4e0b\u6765\u7684\u539f\u56e0\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u8981\u907f\u514d Redis \u603b\u662f\u5728\u4e0d\u540c CPU \u6838\u4e0a\u6765\u56de\u8c03\u5ea6\u6267\u884c\u3002\u4e8e\u662f\uff0c\u6211\u4eec\u5c1d\u8bd5\u7740\u628a Redis \u5b9e\u4f8b\u548c CPU \u6838\u7ed1\u5b9a\u4e86\uff0c\u8ba9\u4e00\u4e2a Redis \u5b9e\u4f8b\u56fa\u5b9a\u8fd0\u884c\u5728\u4e00\u4e2a CPU \u6838\u4e0a\u3002 \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 taskset \u547d\u4ee4\u628a\u4e00\u4e2a\u7a0b\u5e8f\u7ed1\u5b9a\u5728\u4e00\u4e2a\u6838\u4e0a\u8fd0\u884c \u3002 \u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5c31\u628a Redis \u5b9e\u4f8b\u7ed1\u5728\u4e86 0 \u53f7\u6838\u4e0a\uff0c \u5176\u4e2d\uff0c\u201c-c\u201d\u9009\u9879\u7528\u4e8e\u8bbe\u7f6e\u8981\u7ed1\u5b9a\u7684\u6838\u7f16\u53f7\u3002 taskset -c 0 ./redis-server \u7ed1\u5b9a\u4ee5\u540e\uff0c\u6211\u4eec\u8fdb\u884c\u4e86\u6d4b\u8bd5\u3002\u6211\u4eec\u53d1\u73b0\uff0c Redis \u5b9e\u4f8b\u7684 GET \u548c PUT \u7684 99% \u5c3e\u5ef6\u8fdf\u4e00\u4e0b\u5b50\u5c31\u5206\u522b\u964d\u5230\u4e86 260 \u5fae\u79d2\u548c 482 \u5fae\u79d2 \uff0c\u8fbe\u5230\u4e86\u6211\u4eec\u671f\u671b\u7684\u76ee\u6807\u3002 \u6211\u4eec\u6765\u770b\u4e00\u4e0b\u7ed1\u6838\u524d\u540e\u7684 Redis \u7684 99% \u5c3e\u5ef6\u8fdf\u3002 \u548c\u53ea\u7ed1\u4e00\u4e2a\u903b\u8f91\u6838\u76f8\u6bd4\uff0c\u628a Redis \u5b9e\u4f8b\u548c\u7269\u7406\u6838\u7ed1\u5b9a\uff0c\u53ef\u4ee5\u8ba9\u4e3b\u7ebf\u7a0b\u3001\u5b50\u8fdb\u7a0b\u3001\u540e\u53f0\u7ebf\u7a0b\u5171\u4eab\u4f7f\u7528 2 \u4e2a\u903b\u8f91\u6838\uff0c\u53ef\u4ee5\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u7f13\u89e3 CPU \u8d44\u6e90\u7ade\u4e89\u3002 \u4f46\u662f\uff0c\u56e0\u4e3a\u53ea\u7528\u4e86 2 \u4e2a\u903b\u8f91\u6838\uff0c\u5b83\u4eec\u76f8\u4e92\u4e4b\u95f4\u7684 CPU \u7ade\u4e89\u4ecd\u7136\u8fd8\u4f1a\u5b58\u5728\u3002\u5982\u679c\u4f60\u8fd8\u60f3\u8fdb\u4e00\u6b65\u51cf\u5c11 CPU \u7ade\u4e89\uff0c\u6211\u518d\u7ed9\u4f60\u4ecb\u7ecd\u4e00\u79cd\u65b9\u6848\u3002 \u5728 CPU \u591a\u6838\u7684\u73af\u5883\u4e0b\uff0c\u901a\u8fc7\u7ed1\u5b9a Redis \u5b9e\u4f8b\u548c CPU \u6838\uff0c\u53ef\u4ee5\u6709\u6548\u964d\u4f4e Redis \u7684\u5c3e\u5ef6\u8fdf\u3002\u5f53\u7136\uff0c\u7ed1\u6838\u4e0d\u4ec5\u5bf9\u964d\u4f4e\u5c3e\u5ef6\u8fdf\u6709\u597d\u5904\uff0c\u540c\u6837\u4e5f\u80fd\u964d\u4f4e\u5e73\u5747\u5ef6\u8fdf\u3001\u63d0\u5347\u541e\u5410\u7387\uff0c\u8fdb\u800c\u63d0\u5347 Redis \u6027\u80fd\u3002","title":"2-1 CPU \u73af\u5883\u4e0b\u5bf9 Redis \u6027\u80fd\u8fdb\u884c\u8c03\u4f18"},{"location":"chap4/2redis_cpu/#3cpu-numa-redis","text":"\u5728\u5b9e\u9645\u5e94\u7528 Redis \u65f6\uff0c\u4e3a\u4e86\u63d0\u5347 Redis \u7684\u7f51\u7edc\u6027\u80fd\uff0c\u628a\u64cd\u4f5c\u7cfb\u7edf\u7684\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u548c CPU \u6838\u7ed1\u5b9a\u3002 \u8fd9\u4e2a\u505a\u6cd5\u53ef\u4ee5\u907f\u514d\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u5728\u4e0d\u540c\u6838\u4e0a\u6765\u56de\u8c03\u5ea6\u6267\u884c\uff0c\u7684\u786e\u80fd\u6709\u6548\u63d0\u5347 Redis \u7684\u7f51\u7edc\u5904\u7406\u6027\u80fd\u3002 \u4f46\u662f\uff0c \u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u662f\u8981\u548c Redis \u5b9e\u4f8b\u8fdb\u884c\u7f51\u7edc\u6570\u636e\u4ea4\u4e92\u7684\uff0c\u4e00\u65e6\u628a\u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u7ed1\u6838\u540e\uff0c\u6211\u4eec\u5c31\u9700\u8981\u6ce8\u610f Redis \u5b9e\u4f8b\u662f\u7ed1\u5728\u54ea\u4e2a\u6838\u4e0a\u4e86\uff0c\u8fd9\u4f1a\u5173\u7cfb\u5230 Redis \u8bbf\u95ee\u7f51\u7edc\u6570\u636e\u7684\u6548\u7387\u9ad8\u4f4e \u3002 \u6211\u4eec\u5148\u6765\u770b\u4e0b Redis \u5b9e\u4f8b\u548c\u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u7684\u6570\u636e\u4ea4\u4e92\uff1a \u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u4ece\u7f51\u5361\u786c\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u628a\u6570\u636e\u5199\u5165\u5230\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7ef4\u62a4\u7684\u4e00\u5757\u5185\u5b58\u7f13\u51b2\u533a \u5185\u6838\u4f1a\u901a\u8fc7 epoll \u673a\u5236\u89e6\u53d1\u4e8b\u4ef6\uff0c\u901a\u77e5 Redis \u5b9e\u4f8b\uff0cRedis \u5b9e\u4f8b\u518d\u628a\u6570\u636e\u4ece\u5185\u6838\u7684\u5185\u5b58\u7f13\u51b2\u533a\u62f7\u8d1d\u5230\u81ea\u5df1\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u90a3\u4e48\uff0c\u5728 CPU \u7684 NUMA \u67b6\u6784\u4e0b\uff0c\u5f53\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u3001Redis \u5b9e\u4f8b\u5206\u522b\u548c CPU \u6838\u7ed1\u5b9a\u540e\uff0c\u5c31\u4f1a\u6709\u4e00\u4e2a\u6f5c\u5728\u7684\u98ce\u9669\uff1a \u5982\u679c\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u548c Redis \u5b9e\u4f8b\u5404\u81ea\u6240\u7ed1\u7684 CPU \u6838\u4e0d\u5728\u540c\u4e00\u4e2a CPU Socket \u4e0a\uff0c\u90a3\u4e48\uff0cRedis \u5b9e\u4f8b\u8bfb\u53d6\u7f51\u7edc\u6570\u636e\u65f6\uff0c\u5c31\u9700\u8981\u8de8 CPU Socket \u8bbf\u95ee\u5185\u5b58\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u82b1\u8d39\u8f83\u591a\u65f6\u95f4\u3002 \u56fe\u4e2d\u7684 \u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u88ab\u7ed1\u5728\u4e86 CPU Socket 1 \u7684\u67d0\u4e2a\u6838\u4e0a\uff0c\u800c Redis \u5b9e\u4f8b\u5219\u88ab\u7ed1\u5728\u4e86 CPU Socket 2 \u4e0a \u3002 \u6b64\u65f6\uff0c\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u8bfb\u53d6\u5230\u7684\u7f51\u7edc\u6570\u636e\uff0c\u88ab\u4fdd\u5b58\u5728 CPU Socket 1 \u7684\u672c\u5730\u5185\u5b58\u4e2d\uff0c \u5f53 Redis \u5b9e\u4f8b\u8981\u8bbf\u95ee\u7f51\u7edc\u6570\u636e\u65f6\uff0c\u5c31\u9700\u8981 Socket 2 \u901a\u8fc7\u603b\u7ebf\u628a\u5185\u5b58\u8bbf\u95ee\u547d\u4ee4\u53d1\u9001\u5230 Socket 1 \u4e0a\uff0c\u8fdb\u884c\u8fdc\u7a0b\u8bbf\u95ee\uff0c\u65f6\u95f4\u5f00\u9500\u6bd4\u8f83\u5927\u3002 \u548c\u8bbf\u95ee CPU Socket \u672c\u5730\u5185\u5b58\u76f8\u6bd4\uff0c\u8de8 CPU Socket \u7684\u5185\u5b58\u8bbf\u95ee\u5ef6\u8fdf\u589e\u52a0\u4e86 18%\uff0c\u8fd9\u81ea\u7136\u4f1a\u5bfc\u81f4 Redis \u5904\u7406\u8bf7\u6c42\u7684\u5ef6\u8fdf\u589e\u52a0\u3002 \u6240\u4ee5\uff0c \u4e3a\u4e86\u907f\u514d Redis \u8de8 CPU Socket \u8bbf\u95ee\u7f51\u7edc\u6570\u636e\uff0c\u6211\u4eec\u6700\u597d\u628a\u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u548c Redis \u5b9e\u4f8b\u7ed1\u5728\u540c\u4e00\u4e2a CPU Socket \u4e0a\uff0c\u8fd9\u6837\u4e00\u6765\uff0cRedis \u5b9e\u4f8b\u5c31\u53ef\u4ee5\u76f4\u63a5\u4ece\u672c\u5730\u5185\u5b58\u8bfb\u53d6\u7f51\u7edc\u6570\u636e\u4e86 \uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u9700\u8981\u6ce8\u610f\u7684\u662f \u5728 CPU \u7684 NUMA \u67b6\u6784\u4e0b\uff0c\u5bf9 CPU \u6838\u7684\u7f16\u53f7\u89c4\u5219\uff0c\u5e76\u4e0d\u662f\u5148\u628a\u4e00\u4e2a CPU Socket \u4e2d\u7684\u6240\u6709\u903b\u8f91\u6838\u7f16\u5b8c\uff0c\u518d\u5bf9\u4e0b\u4e00\u4e2a CPU Socket \u4e2d\u7684\u903b\u8f91\u6838\u7f16\u7801\uff0c\u800c\u662f\u5148\u7ed9\u6bcf\u4e2a CPU Socket \u4e2d\u6bcf\u4e2a\u7269\u7406\u6838\u7684\u7b2c\u4e00\u4e2a\u903b\u8f91\u6838\u4f9d\u6b21\u7f16\u53f7\uff0c\u518d\u7ed9\u6bcf\u4e2a CPU Socket \u4e2d\u7684\u7269\u7406\u6838\u7684\u7b2c\u4e8c\u4e2a\u903b\u8f91\u6838\u4f9d\u6b21\u7f16\u53f7\u3002 \u5047\u8bbe\u6709 2 \u4e2a CPU Socket\uff0c\u6bcf\u4e2a Socket \u4e0a\u6709 6 \u4e2a\u7269\u7406\u6838\uff0c\u6bcf\u4e2a\u7269\u7406\u6838\u53c8\u6709 2 \u4e2a\u903b\u8f91\u6838\uff0c\u603b\u5171 24 \u4e2a\u903b\u8f91\u6838\u3002 \u6211\u4eec\u53ef\u4ee5\u6267\u884c lscpu \u547d\u4ee4 \uff0c\u67e5\u770b\u5230\u8fd9\u4e9b\u6838\u7684\u7f16\u53f7\uff1a lscpu Architecture: x86_64 ... NUMA node0 CPU(s): 0-5,12-17 NUMA node1 CPU(s): 6-11,18-23 ... NUMA node0 \u7684 CPU \u6838\u7f16\u53f7\u662f 0 \u5230 5\u300112 \u5230 17\u3002 \u5176\u4e2d\uff0c0 \u5230 5 \u662f node0 \u4e0a\u7684 6 \u4e2a\u7269\u7406\u6838\u4e2d\u7684\u7b2c\u4e00\u4e2a\u903b\u8f91\u6838\u7684\u7f16\u53f7\uff0c12 \u5230 17 \u662f\u76f8\u5e94\u7269\u7406\u6838\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u903b\u8f91\u6838\u7f16\u53f7\u3002 NUMA node1 \u7684 CPU \u6838\u7f16\u53f7\u89c4\u5219\u548c node0 \u4e00\u6837\u3002 \u6240\u4ee5\uff0c\u5728\u7ed1\u6838\u65f6\uff0c\u6211\u4eec\u4e00\u5b9a\u8981\u6ce8\u610f\uff0c\u4e0d\u80fd\u60f3\u5f53\u7136\u5730\u8ba4\u4e3a\u7b2c\u4e00\u4e2a Socket \u4e0a\u7684 12 \u4e2a\u903b\u8f91\u6838\u7684\u7f16\u53f7\u5c31\u662f 0 \u5230 11\u3002\u5426\u5219\uff0c\u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u548c Redis \u5b9e\u4f8b\u5c31\u53ef\u80fd\u7ed1\u5728\u4e86\u4e0d\u540c\u7684 CPU Socket \u4e0a\u3002 \u6bd4\u5982\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u628a\u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u548c Redis \u5b9e\u4f8b\u5206\u522b\u7ed1\u5230\u7f16\u53f7\u4e3a 1 \u548c 7 \u7684 CPU \u6838\u4e0a\uff0c\u6b64\u65f6\uff0c\u5b83\u4eec\u4ecd\u7136\u662f\u5728 2 \u4e2a CPU Socket \u4e0a\uff0cRedis \u5b9e\u4f8b\u4ecd\u7136\u9700\u8981\u8de8 Socket \u8bfb\u53d6\u7f51\u7edc\u6570\u636e\u3002 \u6240\u4ee5\uff0c\u4f60\u4e00\u5b9a\u8981\u6ce8\u610f NUMA \u67b6\u6784\u4e0b CPU \u6838\u7684\u7f16\u53f7\u65b9\u6cd5\uff0c\u8fd9\u6837\u624d\u4e0d\u4f1a\u7ed1\u9519\u6838\u3002 \u5728 CPU \u591a\u6838\u7684\u573a\u666f\u4e0b \uff0c\u7528 taskset \u547d\u4ee4\u628a Redis \u5b9e\u4f8b\u548c\u4e00\u4e2a\u6838\u7ed1\u5b9a\uff0c\u53ef\u4ee5\u51cf\u5c11 Redis \u5b9e\u4f8b\u5728\u4e0d\u540c\u6838\u4e0a\u88ab\u6765\u56de\u8c03\u5ea6\u6267\u884c\u7684\u5f00\u9500\uff0c\u907f\u514d\u8f83\u9ad8\u7684\u5c3e\u5ef6\u8fdf\uff1b \u5728\u591a CPU \u7684 NUMA \u67b6\u6784\u4e0b \uff0c\u5982\u679c\u4f60\u5bf9\u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u505a\u4e86\u7ed1\u6838\u64cd\u4f5c\uff0c \u5efa\u8bae\u4f60\u540c\u65f6\u628a Redis \u5b9e\u4f8b\u548c\u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u7ed1\u5728\u540c\u4e00\u4e2a CPU Socket \u7684\u4e0d\u540c\u6838\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d Redis \u8de8 Socket \u8bbf\u95ee\u5185\u5b58\u4e2d\u7684\u7f51\u7edc\u6570\u636e\u7684\u65f6\u95f4\u5f00\u9500\u3002","title":"3\u3001CPU \u7684 NUMA \u67b6\u6784\u5bf9 Redis \u6027\u80fd\u7684\u5f71\u54cd"},{"location":"chap4/2redis_cpu/#4","text":"Redis \u9664\u4e86\u4e3b\u7ebf\u7a0b\u4ee5\u5916\uff0c\u8fd8\u6709\u7528\u4e8e RDB \u751f\u6210\u548c AOF \u91cd\u5199\u7684\u5b50\u8fdb\u7a0b Redis \u7684\u540e\u53f0\u7ebf\u7a0b \u5f53\u6211\u4eec\u628a Redis \u5b9e\u4f8b\u7ed1\u5230\u4e00\u4e2a CPU \u903b\u8f91\u6838\u4e0a\u65f6\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5b50\u8fdb\u7a0b\u3001\u540e\u53f0\u7ebf\u7a0b\u548c Redis \u4e3b\u7ebf\u7a0b\u7ade\u4e89 CPU \u8d44\u6e90 \uff0c\u4e00\u65e6\u5b50\u8fdb\u7a0b\u6216\u540e\u53f0\u7ebf\u7a0b\u5360\u7528 CPU \u65f6\uff0c\u4e3b\u7ebf\u7a0b\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u5bfc\u81f4 Redis \u8bf7\u6c42\u5ef6\u8fdf\u589e\u52a0\u3002 \u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0c \u5206\u522b\u662f\u4e00\u4e2a Redis \u5b9e\u4f8b\u5bf9\u5e94\u7ed1\u4e00\u4e2a\u7269\u7406\u6838\u548c\u4f18\u5316 Redis \u6e90\u7801 \u3002","title":"4\u3001\u7ed1\u6838\u7684\u98ce\u9669\u548c\u89e3\u51b3\u65b9\u6848"},{"location":"chap4/2redis_cpu/#4-1-redis","text":"\u5728\u7ed9 Redis \u5b9e\u4f8b\u7ed1\u6838\u65f6\uff0c \u6211\u4eec\u4e0d\u8981\u628a\u4e00\u4e2a\u5b9e\u4f8b\u548c\u4e00\u4e2a\u903b\u8f91\u6838\u7ed1\u5b9a\uff0c\u800c\u8981\u548c\u4e00\u4e2a\u7269\u7406\u6838\u7ed1\u5b9a\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u628a\u4e00\u4e2a\u7269\u7406\u6838\u7684 2 \u4e2a\u903b\u8f91\u6838\u90fd\u7528\u4e0a \u3002 \u6211\u4eec\u8fd8\u662f\u4ee5\u521a\u624d\u7684 NUMA \u67b6\u6784\u4e3a\u4f8b\uff0cNUMA node0 \u7684 CPU \u6838\u7f16\u53f7\u662f 0 \u5230 5\u300112 \u5230 17\u3002\u5176\u4e2d\uff0c\u7f16\u53f7 0 \u548c 12\u30011 \u548c 13\u30012 \u548c 14 \u7b49\u90fd\u662f\u8868\u793a\u4e00\u4e2a\u7269\u7406\u6838\u7684 2 \u4e2a\u903b\u8f91\u6838\u3002 \u6240\u4ee5\uff0c\u5728\u7ed1\u6838\u65f6\uff0c\u6211\u4eec\u4f7f\u7528\u5c5e\u4e8e\u540c\u4e00\u4e2a\u7269\u7406\u6838\u7684 2 \u4e2a\u903b\u8f91\u6838\u8fdb\u884c\u7ed1\u6838\u64cd\u4f5c\u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c \u5c31\u628a Redis \u5b9e\u4f8b\u7ed1\u5b9a\u5230\u4e86\u903b\u8f91\u6838 0 \u548c 12 \u4e0a\uff0c\u800c\u8fd9\u4e24\u4e2a\u6838\u6b63\u597d\u90fd\u5c5e\u4e8e\u7269\u7406\u6838 1 \u3002 taskset -c 0,12 ./redis-server \u548c\u53ea\u7ed1\u4e00\u4e2a\u903b\u8f91\u6838\u76f8\u6bd4\uff0c\u628a Redis \u5b9e\u4f8b\u548c\u7269\u7406\u6838\u7ed1\u5b9a\uff0c\u53ef\u4ee5\u8ba9\u4e3b\u7ebf\u7a0b\u3001\u5b50\u8fdb\u7a0b\u3001\u540e\u53f0\u7ebf\u7a0b\u5171\u4eab\u4f7f\u7528 2 \u4e2a\u903b\u8f91\u6838\uff0c\u53ef\u4ee5\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u7f13\u89e3 CPU \u8d44\u6e90\u7ade\u4e89\u3002 \u4f46\u662f\uff0c\u56e0\u4e3a\u53ea\u7528\u4e86 2 \u4e2a\u903b\u8f91\u6838\uff0c\u5b83\u4eec\u76f8\u4e92\u4e4b\u95f4\u7684 CPU \u7ade\u4e89\u4ecd\u7136\u8fd8\u4f1a\u5b58\u5728\u3002\u5982\u679c\u4f60\u8fd8\u60f3\u8fdb\u4e00\u6b65\u51cf\u5c11 CPU \u7ade\u4e89\uff0c\u6211\u518d\u7ed9\u4f60\u4ecb\u7ecd\u4e00\u79cd\u65b9\u6848\u3002","title":"4-1 \u4e00\u4e2a Redis \u5b9e\u4f8b\u5bf9\u5e94\u7ed1\u4e00\u4e2a\u7269\u7406\u6838"},{"location":"chap4/2redis_cpu/#4-2-redis","text":"\u8fd9\u4e2a\u65b9\u6848\u5c31\u662f\u901a\u8fc7\u4fee\u6539 Redis \u6e90\u7801\uff0c \u628a\u5b50\u8fdb\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\u7ed1\u5230\u4e0d\u540c\u7684 CPU \u6838\u4e0a\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u5148\u4ecb\u7ecd\u4e00\u4e0b\u901a\u7528\u7684\u505a\u6cd5\uff0c\u7136\u540e\uff0c\u518d\u5177\u4f53\u8bf4\u8bf4\u53ef\u4ee5\u628a\u8fd9\u4e2a\u505a\u6cd5\u5bf9\u5e94\u5230 Redis \u7684\u54ea\u90e8\u5206\u6e90\u7801\u4e2d\u3002 \u901a\u8fc7\u7f16\u7a0b\u5b9e\u73b0\u7ed1\u6838\u65f6\uff0c\u8981\u7528\u5230\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684 1 \u4e2a\u6570\u636e\u7ed3\u6784 cpu_set_t \u548c 3 \u4e2a\u51fd\u6570 CPU_ZERO \u3001 CPU_SET \u548c sched_setaffinity \uff0c\u6211\u5148\u6765\u89e3\u91ca\u4e0b\u5b83\u4eec\u3002 cpu_set_t \u6570\u636e\u7ed3\u6784\uff1a\u662f\u4e00\u4e2a\u4f4d\u56fe\uff0c\u6bcf\u4e00\u4f4d\u7528\u6765\u8868\u793a\u670d\u52a1\u5668\u4e0a\u7684\u4e00\u4e2a CPU \u903b\u8f91\u6838\u3002 CPU_ZERO \u51fd\u6570\uff1a\u4ee5 cpu_set_t \u7ed3\u6784\u7684\u4f4d\u56fe\u4e3a\u8f93\u5165\u53c2\u6570\uff0c\u628a\u4f4d\u56fe\u4e2d\u6240\u6709\u7684\u4f4d\u8bbe\u7f6e\u4e3a 0\u3002 CPU_SET \u51fd\u6570\uff1a\u4ee5 CPU \u903b\u8f91\u6838\u7f16\u53f7\u548c cpu_set_t \u4f4d\u56fe\u4e3a\u53c2\u6570\uff0c\u628a\u4f4d\u56fe\u4e2d\u548c\u8f93\u5165\u7684\u903b\u8f91\u6838\u7f16\u53f7\u5bf9\u5e94\u7684\u4f4d\u8bbe\u7f6e\u4e3a 1\u3002 sched_setaffinity \u51fd\u6570\uff1a\u4ee5\u8fdb\u7a0b / \u7ebf\u7a0b ID \u53f7\u548c cpu_set_t \u4e3a\u53c2\u6570\uff0c\u68c0\u67e5 cpu_set_t \u4e2d\u54ea\u4e00\u4f4d\u4e3a 1\uff0c\u5c31\u628a\u8f93\u5165\u7684 ID \u53f7\u6240\u4ee3\u8868\u7684\u8fdb\u7a0b / \u7ebf\u7a0b\u7ed1\u5728\u5bf9\u5e94\u7684\u903b\u8f91\u6838\u4e0a\u3002 \u600e\u4e48\u5728\u7f16\u7a0b\u65f6\u628a\u8fd9\u4e09\u4e2a\u51fd\u6570\u7ed3\u5408\u8d77\u6765\u5b9e\u73b0\u7ed1\u6838\u5462\uff1f \u7b2c\u4e00\u6b65\uff1a\u521b\u5efa\u4e00\u4e2a cpu_set_t \u7ed3\u6784\u7684\u4f4d\u56fe\u53d8\u91cf\uff1b \u7b2c\u4e8c\u6b65\uff1a\u4f7f\u7528 CPU_ZERO \u51fd\u6570\uff0c\u628a cpu_set_t \u7ed3\u6784\u7684\u4f4d\u56fe\u6240\u6709\u7684\u4f4d\u90fd\u8bbe\u7f6e\u4e3a 0\uff1b \u7b2c\u4e09\u6b65\uff1a\u6839\u636e\u8981\u7ed1\u5b9a\u7684\u903b\u8f91\u6838\u7f16\u53f7\uff0c\u4f7f\u7528 CPU_SET \u51fd\u6570\uff0c\u628a cpu_set_t \u7ed3\u6784\u7684\u4f4d\u56fe\u76f8\u5e94\u4f4d\u8bbe\u7f6e\u4e3a 1\uff1b \u7b2c\u56db\u6b65\uff1a\u4f7f\u7528 sched_setaffinity \u51fd\u6570\uff0c\u628a\u7a0b\u5e8f\u7ed1\u5b9a\u5728 cpu_set_t \u7ed3\u6784\u4f4d\u56fe\u4e2d\u4e3a 1 \u7684\u903b\u8f91\u6838\u4e0a\u3002 \u5148\u8bf4\u540e\u53f0\u7ebf\u7a0b\u3002\u4e3a\u4e86\u8ba9\u4f60\u66f4\u597d\u5730\u7406\u89e3\u7f16\u7a0b\u5b9e\u73b0\u7ed1\u6838\uff0c\u4f60\u53ef\u4ee5\u770b\u4e0b\u8fd9\u6bb5\u793a\u4f8b\u4ee3\u7801\uff0c\u5b83\u5b9e\u73b0\u4e86\u4e3a\u7ebf\u7a0b\u7ed1\u6838\u7684\u64cd\u4f5c\uff1a //\u7ebf\u7a0b\u51fd\u6570 void worker(int bind_cpu){ cpu_set_t cpuset; //\u521b\u5efa\u4f4d\u56fe\u53d8\u91cf CPU_ZERO(&cpu_set); //\u4f4d\u56fe\u53d8\u91cf\u6240\u6709\u4f4d\u8bbe\u7f6e0 CPU_SET(bind_cpu, &cpuset); //\u6839\u636e\u8f93\u5165\u7684bind_cpu\u7f16\u53f7\uff0c\u628a\u4f4d\u56fe\u5bf9\u5e94\u4e3a\u8bbe\u7f6e\u4e3a1 sched_setaffinity(0, sizeof(cpuset), &cpuset); //\u628a\u7a0b\u5e8f\u7ed1\u5b9a\u5728cpu_set_t\u7ed3\u6784\u4f4d\u56fe\u4e2d\u4e3a1\u7684\u903b\u8f91\u6838 //\u5b9e\u9645\u7ebf\u7a0b\u51fd\u6570\u5de5\u4f5c } int main(){ pthread_t pthread1 //\u628a\u521b\u5efa\u7684pthread1\u7ed1\u5728\u7f16\u53f7\u4e3a3\u7684\u903b\u8f91\u6838\u4e0a pthread_create(&pthread1, NULL, (void *)worker, 3); } \u5bf9\u4e8e Redis \u6765\u8bf4\uff0c\u5b83\u662f\u5728 bio.c \u6587\u4ef6\u4e2d\u7684 bioProcessBackgroundJobs \u51fd\u6570\u4e2d\u521b\u5efa\u4e86\u540e\u53f0\u7ebf\u7a0b\u3002bioProcessBackgroundJobs \u51fd\u6570\u7c7b\u4f3c\u4e8e\u521a\u521a\u7684\u4f8b\u5b50\u4e2d\u7684 worker \u51fd\u6570\uff0c\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d\u5b9e\u73b0\u7ed1\u6838\u56db\u6b65\u64cd\u4f5c\uff0c\u5c31\u53ef\u4ee5\u628a\u540e\u53f0\u7ebf\u7a0b\u7ed1\u5230\u548c\u4e3b\u7ebf\u7a0b\u4e0d\u540c\u7684\u6838\u4e0a\u4e86\u3002 \u548c\u7ed9\u7ebf\u7a0b\u7ed1\u6838\u7c7b\u4f3c\uff0c\u5f53\u6211\u4eec\u4f7f\u7528 fork \u521b\u5efa\u5b50\u8fdb\u7a0b\u65f6\uff0c\u4e5f\u53ef\u4ee5\u628a\u521a\u521a\u8bf4\u7684\u56db\u6b65\u64cd\u4f5c\u5b9e\u73b0\u5728 fork \u540e\u7684\u5b50\u8fdb\u7a0b\u4ee3\u7801\u4e2d\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a int main(){ //\u7528fork\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b pid_t p = fork(); if(p < 0){ printf(\" fork error\\n\"); } //\u5b50\u8fdb\u7a0b\u4ee3\u7801\u90e8\u5206 else if(!p){ cpu_set_t cpuset; //\u521b\u5efa\u4f4d\u56fe\u53d8\u91cf CPU_ZERO(&cpu_set); //\u4f4d\u56fe\u53d8\u91cf\u6240\u6709\u4f4d\u8bbe\u7f6e0 CPU_SET(3, &cpuset); //\u628a\u4f4d\u56fe\u7684\u7b2c3\u4f4d\u8bbe\u7f6e\u4e3a1 sched_setaffinity(0, sizeof(cpuset), &cpuset); //\u628a\u7a0b\u5e8f\u7ed1\u5b9a\u57283\u53f7\u903b\u8f91\u6838 //\u5b9e\u9645\u5b50\u8fdb\u7a0b\u5de5\u4f5c exit(0); } ... } \u5bf9\u4e8e Redis \u6765\u8bf4\uff0c\u751f\u6210 RDB \u548c AOF \u65e5\u5fd7\u91cd\u5199\u7684\u5b50\u8fdb\u7a0b\u5206\u522b\u662f\u4e0b\u9762\u4e24\u4e2a\u6587\u4ef6\u7684\u51fd\u6570\u4e2d\u5b9e\u73b0\u7684\u3002 rdb.c \u6587\u4ef6\uff1ardbSaveBackground \u51fd\u6570\uff1b aof.c \u6587\u4ef6\uff1arewriteAppendOnlyFileBackground \u51fd\u6570\u3002 \u8fd9\u4e24\u4e2a\u51fd\u6570\u4e2d\u90fd\u8c03\u7528\u4e86 fork \u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u5b50\u8fdb\u7a0b\u4ee3\u7801\u90e8\u5206\u52a0\u4e0a\u7ed1\u6838\u7684\u56db\u6b65\u64cd\u4f5c\u3002 \u4f7f\u7528\u6e90\u7801\u4f18\u5316\u65b9\u6848\uff0c\u6211\u4eec\u65e2\u53ef\u4ee5\u5b9e\u73b0 Redis \u5b9e\u4f8b\u7ed1\u6838\uff0c\u907f\u514d\u5207\u6362\u6838\u5e26\u6765\u7684\u6027\u80fd\u5f71\u54cd\uff0c\u8fd8\u53ef\u4ee5\u8ba9\u5b50\u8fdb\u7a0b\u3001\u540e\u53f0\u7ebf\u7a0b\u548c\u4e3b\u7ebf\u7a0b\u4e0d\u5728\u540c\u4e00\u4e2a\u6838\u4e0a\u8fd0\u884c\uff0c\u907f\u514d\u4e86\u5b83\u4eec\u4e4b\u95f4\u7684 CPU \u8d44\u6e90\u7ade\u4e89\u3002\u76f8\u6bd4\u4f7f\u7528 taskset \u7ed1\u6838\u6765\u8bf4\uff0c\u8fd9\u4e2a\u65b9\u6848\u53ef\u4ee5\u8fdb\u4e00\u6b65\u964d\u4f4e\u7ed1\u6838\u7684\u98ce\u9669\u3002","title":"4-2 \u4f18\u5316 Redis \u6e90\u7801"},{"location":"chap4/2redis_cpu/#5","text":"\u591a\u6838 CPU \u67b6\u6784\uff0c\u4ee5\u53ca NUMA \u67b6\u6784\u3002 \u5728\u591a\u6838 CPU \u67b6\u6784\u4e0b\uff0cRedis \u5982\u679c\u5728\u4e0d\u540c\u7684\u6838\u4e0a\u8fd0\u884c\uff0c\u5c31\u9700\u8981\u9891\u7e41\u5730\u8fdb\u884c\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u589e\u52a0 Redis \u7684\u6267\u884c\u65f6\u95f4\uff0c\u5ba2\u6237\u7aef\u4e5f\u4f1a\u89c2\u5bdf\u5230\u8f83\u9ad8\u7684\u5c3e\u5ef6\u8fdf\u4e86\u3002 \u6240\u4ee5\uff0c \u5efa\u8bae\u4f60\u5728 Redis \u8fd0\u884c\u65f6\uff0c\u628a\u5b9e\u4f8b\u548c\u67d0\u4e2a\u6838\u7ed1\u5b9a\uff0c\u8fd9\u6837\uff0c\u5c31\u80fd\u91cd\u590d\u5229\u7528\u6838\u4e0a\u7684 L1\u3001L2 \u7f13\u5b58\uff0c\u53ef\u4ee5\u964d\u4f4e\u54cd\u5e94\u5ef6\u8fdf \u3002 \u4e3a\u4e86\u63d0\u5347 Redis \u7684\u7f51\u7edc\u6027\u80fd\uff0c\u6211\u4eec\u6709\u65f6\u8fd8\u4f1a\u628a\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u548c CPU \u6838\u7ed1\u5b9a\u3002 \u5982\u679c\u670d\u52a1\u5668\u4f7f\u7528\u7684\u662f NUMA \u67b6\u6784\uff0cRedis \u5b9e\u4f8b\u4e00\u65e6\u88ab\u8c03\u5ea6\u5230\u548c\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u4e0d\u5728\u540c\u4e00\u4e2a CPU Socket\uff0c\u5c31\u8981\u8de8 CPU Socket \u8bbf\u95ee\u7f51\u7edc\u6570\u636e\uff0c\u8fd9\u5c31\u4f1a\u964d\u4f4e Redis \u7684\u6027\u80fd\u3002 \u5efa\u8bae\u4f60\u628a Redis \u5b9e\u4f8b\u548c\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u7ed1\u5728\u540c\u4e00\u4e2a CPU Socket \u4e0b\u7684\u4e0d\u540c\u6838\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u5347 Redis \u7684\u8fd0\u884c\u6027\u80fd\u3002 \u867d\u7136\u7ed1\u6838\u53ef\u4ee5\u5e2e\u52a9 Redis \u964d\u4f4e\u8bf7\u6c42\u6267\u884c\u65f6\u95f4\uff0c\u4f46\u662f\uff0c\u9664\u4e86\u4e3b\u7ebf\u7a0b\uff0cRedis \u8fd8\u6709\u7528\u4e8e RDB \u548c AOF \u91cd\u5199\u7684\u5b50\u8fdb\u7a0b\uff0c\u4ee5\u53ca 4.0 \u7248\u672c\u4e4b\u540e\u63d0\u4f9b\u7684\u7528\u4e8e\u60f0\u6027\u5220\u9664\u7684\u540e\u53f0\u7ebf\u7a0b\u3002 \u5f53 Redis \u5b9e\u4f8b\u548c\u4e00\u4e2a\u903b\u8f91\u6838\u7ed1\u5b9a\u540e\uff0c\u8fd9\u4e9b\u5b50\u8fdb\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\u4f1a\u548c\u4e3b\u7ebf\u7a0b\u7ade\u4e89 CPU \u8d44\u6e90\uff0c\u4e5f\u4f1a\u5bf9 Redis \u6027\u80fd\u9020\u6210\u5f71\u54cd \u3002\u6240\u4ee5\uff0c\u6211\u7ed9\u4e86\u4f60\u4e24\u4e2a\u5efa\u8bae\uff1a \u5982\u679c\u4f60\u4e0d\u60f3\u4fee\u6539 Redis \u4ee3\u7801\uff0c \u53ef\u4ee5\u628a\u6309\u4e00\u4e2a Redis \u5b9e\u4f8b\u4e00\u4e2a\u7269\u7406\u6838\u65b9\u5f0f\u8fdb\u884c\u7ed1\u5b9a\uff0c\u8fd9\u6837\uff0cRedis \u7684\u4e3b\u7ebf\u7a0b\u3001\u5b50\u8fdb\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\u53ef\u4ee5\u5171\u4eab\u4f7f\u7528\u4e00\u4e2a\u7269\u7406\u6838\u4e0a\u7684\u4e24\u4e2a\u903b\u8f91\u6838 \u3002 Redis \u7684\u6e90\u7801\uff0c\u5c31\u53ef\u4ee5\u5728\u6e90\u7801\u4e2d\u589e\u52a0\u7ed1\u6838\u64cd\u4f5c\uff0c\u628a\u5b50\u8fdb\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\u7ed1\u5230\u4e0d\u540c\u7684\u6838\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u5bf9\u4e3b\u7ebf\u7a0b\u7684 CPU \u8d44\u6e90\u7ade\u4e89 Redis 6.0 \u51fa\u6765\u540e\uff0c\u53ef\u4ee5\u652f\u6301 CPU \u6838\u7ed1\u5b9a\u7684\u914d\u7f6e\u64cd\u4f5c\u4e86","title":"5\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap4/2redis_cpu/#5-1","text":"\u4e3b\u6d41\u7684CPU\u67b6\u6784\uff0c\u4e3b\u8981\u6709\u591a\u6838CPU\u67b6\u6784\u548cNUMA\u67b6\u6784\u4e24\u4e2a\u67b6\u6784 \u591a\u6838CPU\u67b6\u6784\uff1a \u591a\u4e2a\u7269\u7406\u6838\uff0c\u5404\u7269\u7406\u6838\u4f7f\u7528\u79c1\u6709\u76841\u30012\u7ea7\u7f13\u5b58\uff0c\u5171\u4eab3\u7ea7\u7f13\u5b58\u3002\u7269\u7406\u6838\u53ef\u5305\u542b2\u4e2a\u8d85\u7ebf\u7a0b\uff0c\u79f0\u4e3a\u903b\u8f91\u6838 NUMA\u67b6\u6784\uff1a \u4e00\u4e2a\u670d\u52a1\u5668\u4e0a\u591a\u4e2acpu\uff0c\u79f0\u4e3aCPU Socket\uff0c\u6bcf\u4e2acpu socker\u5b58\u5728\u591a\u4e2a\u7269\u7406\u6838\u3002\u6bcf\u4e2asocket\u901a\u8fc7\u603b\u7ebf\u8fde\u63a5\uff0c\u5e76\u4e14\u6709\u7528\u79c1\u6709\u7684\u5185\u5b58\u7a7a\u95f4 cpu\u67b6\u6784\uff1a\u4e00\u4e2acpu\u4e00\u822c\u62e5\u6709\u591a\u4e2a\u7269\u7406\u6838\uff0c\u6bcf\u4e2a\u7269\u7406\u6838\u90fd\u62e5\u6709\u79c1\u6709\u7684\u4e00\u7ea7\u7f13\u5b58\uff0c\u4e8c\u7ea7\u7f13\u5b58\u3002\u4e09\u7ea7\u7f13\u5b58\u662f\u5404\u7269\u7406\u6838\u5171\u4eab\u7684\u7f13\u5b58\u7a7a\u95f4\u3002\u800c\u7269\u7406\u6838\u53c8\u53ef\u4ee5\u5206\u4e3a\u591a\u4e2a\u8d85\u7ebf\u7a0b\uff0c\u79f0\u4e3a\u903b\u8f91\u6838\uff0c\u540c\u4e00\u4e2a\u7269\u7406\u6838\u7684\u903b\u8f91\u6838\u4f1a\u5171\u4eab\u4f7f\u7528 L1\u3001L2 \u7f13\u5b58\u3002 \u4e00\u7ea7\u7f13\u5b58\u548c\u4e8c\u7ea7\u7f13\u5b58\u8bbf\u95ee\u5ef6\u8fdf\u4e0d\u8d85\u8fc710\u7eb3\u79d2\uff0c\u4f46\u7a7a\u95f4\u5f88\u5c0f\uff0c\u53ea\u662fKB\u5355\u4f4d\u3002\u800c\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u5185\u5b58\u5ef6\u8fdf\u662f\u767e\u7eb3\u79d2\u7ea7\u522b\uff0c\u57fa\u672c\u4e0a\u662f\u4e00\u4e8c\u7ea7\u7f13\u5b58\u768410\u500d \u4e0d\u540c\u7684\u7269\u7406\u6838\u8fd8\u4f1a\u5171\u4eab\u4e00\u4e2a\u5171\u540c\u7684\u4e09\u7ea7\u7f13\u5b58\uff0c\u4e09\u7ea7\u7f13\u5b58\u7a7a\u95f4\u6bd4\u8f83\u591a\uff0c\u4e3a\u51e0\u5230\u51e0\u5341MB\uff0c\u5f53 L1\u3001L2 \u7f13\u5b58\u4e2d\u6ca1\u6709\u6570\u636e\u7f13\u5b58\u65f6\uff0c\u53ef\u4ee5\u8bbf\u95ee L3\uff0c\u5c3d\u53ef\u80fd\u907f\u514d\u8bbf\u95ee\u5185\u5b58\u3002 \u591a\u6838CPU\u8fd0\u884credis\u5b9e\u4f8b\uff0c\u4f1a\u5bfc\u81f4context switch\uff0c\u5bfc\u81f4\u589e\u52a0\u5ef6\u8fdf\uff0c\u53ef\u4ee5\u901a\u8fc7taskset \u547d\u4ee4\u628aredis\u8fdb\u7a0b\u7ed1\u5b9a\u5230\u67d0\u4e2acup\u7269\u7406\u6838\u4e0a\u3002 NUMA\u67b6\u6784\u8fd0\u884credis\u5b9e\u4f8b\uff0c\u5982\u679c\u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u548credis\u5b9e\u4f8b\u8fd0\u884c\u5728\u4e0d\u540c\u7684socket\u4e0a\uff0c\u5c31\u9700\u8981\u8de8 CPU Socket \u8bbf\u95ee\u5185\u5b58\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u82b1\u8d39\u8f83\u591a\u65f6\u95f4\u3002 \u7ed1\u6838\u7684\u98ce\u9669\u548c\u89e3\u51b3\u65b9\u6848\uff1a \u4e00\u4e2a Redis \u5b9e\u4f8b\u5bf9\u5e94\u7ed1\u4e00\u4e2a\u7269\u7406\u6838 \uff1a \u5c06redis\u670d\u52a1\u7ed1\u5b9a\u5230\u4e00\u4e2a\u7269\u7406\u6838\u4e0a\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u903b\u8f91\u6838\u4e0a\uff0c\u5982 taskset -c 0,12 ./redis-server \u4f18\u5316 Redis \u6e90\u7801\u3002","title":"5-1 \u4eae\u70b9&amp;\u8981\u70b9"},{"location":"chap4/3redis_response/","text":"\u7b2c\u4e09\u8282 \u5f53redis\u67e5\u8be2\u53d8\u6162\u4e86\u600e\u4e48\u529e\uff1f \u5728\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e2d\uff0cRedis \u5f80\u5f80\u662f\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u7684\u4e00\u4e2a\u73af\u8282\uff08\u4f8b\u5982\u4f5c\u4e3a\u7f13\u5b58\u6216\u662f\u4f5c\u4e3a\u6570\u636e\u5e93\uff09\u3002\u4e00\u65e6 Redis \u4e0a\u7684\u8bf7\u6c42\u5ef6\u8fdf\u589e\u52a0\uff0c\u5c31\u53ef\u80fd\u5f15\u8d77\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u7684\u4e00\u4e32\u513f\u201c\u8fde\u9501\u53cd\u5e94\u201d\u3002 \u5e94\u7528\u670d\u52a1\u5668\uff08App Server\uff09\u8981\u5b8c\u6210\u4e00\u4e2a\u4e8b\u52a1\u6027\u64cd\u4f5c\uff0c \u5305\u62ec\u5728 MySQL \u4e0a\u6267\u884c\u4e00\u4e2a\u5199\u4e8b\u52a1\uff0c\u5728 Redis \u4e0a\u63d2\u5165\u4e00\u4e2a\u6807\u8bb0\u4f4d\uff0c\u5e76\u901a\u8fc7\u4e00\u4e2a\u7b2c\u4e09\u65b9\u670d\u52a1\u7ed9\u7528\u6237\u53d1\u9001\u4e00\u6761\u5b8c\u6210\u6d88\u606f \u3002 \u8fd9\u4e09\u4e2a\u64cd\u4f5c\u90fd\u9700\u8981\u4fdd\u8bc1\u4e8b\u52a1\u539f\u5b50\u6027\uff0c\u6240\u4ee5\uff0c\u5982\u679c\u6b64\u65f6 Redis \u7684\u5ef6\u8fdf\u589e\u52a0\uff0c\u5c31\u4f1a\u62d6\u7d2f App Server \u7aef\u6574\u4e2a\u4e8b\u52a1\u7684\u6267\u884c\u3002 \u8fd9\u4e2a\u4e8b\u52a1\u4e00\u76f4\u5b8c\u6210\u4e0d\u4e86\uff0c\u53c8\u4f1a\u5bfc\u81f4 MySQL \u4e0a\u5199\u4e8b\u52a1\u5360\u7528\u7684\u8d44\u6e90\u65e0\u6cd5\u91ca\u653e\uff0c\u8fdb\u800c\u5bfc\u81f4\u8bbf\u95ee MySQL \u7684\u5176\u4ed6\u8bf7\u6c42\u88ab\u963b\u585e\u3002 \u5f88\u660e\u663e\uff0cRedis \u53d8\u6162\u4f1a\u5e26\u6765\u4e25\u91cd\u7684\u8fde\u9501\u53cd\u5e94\u3002 1\u3001Redis \u771f\u7684\u53d8\u6162\u4e86\u5417\uff1f \u4e00\u4e2a\u6700\u76f4\u63a5\u7684\u65b9\u6cd5\uff0c\u5c31\u662f \u67e5\u770b Redis \u7684\u54cd\u5e94\u5ef6\u8fdf\u3002 \u5927\u90e8\u5206\u65f6\u5019\uff0cRedis \u5ef6\u8fdf\u5f88\u4f4e\uff0c\u4f46\u662f\u5728\u67d0\u4e9b\u65f6\u523b\uff0c\u6709\u4e9b Redis \u5b9e\u4f8b\u4f1a\u51fa\u73b0\u5f88\u9ad8\u7684\u54cd\u5e94\u5ef6\u8fdf\uff0c \u751a\u81f3\u80fd\u8fbe\u5230\u51e0\u79d2\u5230\u5341\u51e0\u79d2\uff0c\u4e0d\u8fc7\u6301\u7eed\u65f6\u95f4\u4e0d\u957f\uff0c\u8fd9\u4e5f\u53eb\u5ef6\u8fdf\u201c\u6bdb\u523a\u201d \u3002 \u5f53\u4f60\u53d1\u73b0 Redis \u547d\u4ee4\u7684\u6267\u884c\u65f6\u95f4\u7a81\u7136\u5c31\u589e\u957f\u5230\u4e86\u51e0\u79d2\uff0c\u57fa\u672c\u5c31\u53ef\u4ee5\u8ba4\u5b9a Redis \u53d8\u6162\u4e86\u3002 \u5927\u90e8\u5206\u65f6\u5019\uff0cRedis \u5ef6\u8fdf\u5f88\u4f4e\uff0c\u4f46\u662f\u5728\u67d0\u4e9b\u65f6\u523b\uff0c\u6709\u4e9b Redis \u5b9e\u4f8b\u4f1a\u51fa\u73b0\u5f88\u9ad8\u7684\u54cd\u5e94\u5ef6\u8fdf\uff0c\u751a\u81f3\u80fd\u8fbe\u5230\u51e0\u79d2\u5230\u5341\u51e0\u79d2\uff0c\u4e0d\u8fc7\u6301\u7eed\u65f6\u95f4\u4e0d\u957f\uff0c\u8fd9\u4e5f\u53eb\u5ef6\u8fdf\u201c\u6bdb\u523a\u201d\u3002\u5f53\u4f60\u53d1\u73b0 Redis \u547d\u4ee4\u7684\u6267\u884c\u65f6\u95f4\u7a81\u7136\u5c31\u589e\u957f\u5230\u4e86\u51e0\u79d2\uff0c\u57fa\u672c\u5c31\u53ef\u4ee5\u8ba4\u5b9a Redis \u53d8\u6162\u4e86\u3002 \u8fd9\u79cd\u65b9\u6cd5\u662f\u770b Redis \u5ef6\u8fdf\u7684\u7edd\u5bf9\u503c\uff0c\u4f46\u662f\uff0c\u5728\u4e0d\u540c\u7684\u8f6f\u786c\u4ef6\u73af\u5883\u4e0b\uff0cRedis \u672c\u8eab\u7684\u7edd\u5bf9\u6027\u80fd\u5e76\u4e0d\u76f8\u540c\u3002 \u6bd4\u5982\uff0c\u5728\u6211\u7684\u73af\u5883\u4e2d\uff0c\u5f53\u5ef6\u8fdf\u4e3a 1ms \u65f6\uff0c\u6211\u5224\u5b9a Redis \u53d8\u6162\u4e86\uff0c\u4f46\u662f\u4f60\u7684\u786c\u4ef6\u914d\u7f6e\u9ad8\uff0c\u90a3\u4e48\uff0c\u5728\u4f60\u7684\u8fd0\u884c\u73af\u5883\u4e0b\uff0c\u53ef\u80fd\u5ef6\u8fdf\u662f 0.2ms \u7684\u65f6\u5019\uff0c\u4f60\u5c31\u53ef\u4ee5\u8ba4\u5b9a Redis \u53d8\u6162\u4e86\u3002 1-1 \u57fa\u7ebf\u6027\u80fd \u57fa\u4e8e\u5f53\u524d\u73af\u5883\u4e0b\u7684 Redis \u57fa\u7ebf\u6027\u80fd\u505a\u5224\u65ad \u6240\u8c13\u7684\u57fa\u7ebf\u6027\u80fd\u5462\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u7cfb\u7edf\u5728\u4f4e\u538b\u529b\u3001\u65e0\u5e72\u6270\u4e0b\u7684\u57fa\u672c\u6027\u80fd\uff0c\u8fd9\u4e2a\u6027\u80fd\u53ea\u7531\u5f53\u524d\u7684\u8f6f\u786c\u4ef6\u914d\u7f6e\u51b3\u5b9a\u3002 \u5b9e\u9645\u4e0a\uff0c\u4ece 2.8.7 \u7248\u672c\u5f00\u59cb\uff0c redis-cli \u547d\u4ee4\u63d0\u4f9b\u4e86 \u2013intrinsic-latency \u9009\u9879\uff0c\u53ef\u4ee5\u7528\u6765\u76d1\u6d4b\u548c\u7edf\u8ba1\u6d4b\u8bd5\u671f\u95f4\u5185\u7684\u6700\u5927\u5ef6\u8fdf\uff0c\u8fd9\u4e2a\u5ef6\u8fdf\u53ef\u4ee5\u4f5c\u4e3a Redis \u7684\u57fa\u7ebf\u6027\u80fd\u3002\u5176\u4e2d\uff0c\u6d4b\u8bd5\u65f6\u957f\u53ef\u4ee5\u7528 \u2013intrinsic-latency \u9009\u9879\u7684\u53c2\u6570\u6765\u6307\u5b9a\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u8fd0\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u8be5\u547d\u4ee4\u4f1a\u6253\u5370 120 \u79d2\u5185\u76d1\u6d4b\u5230\u7684\u6700\u5927\u5ef6\u8fdf\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u7684\u6700\u5927\u5ef6\u8fdf\u662f 119 \u5fae\u79d2\uff0c\u4e5f\u5c31\u662f\u57fa\u7ebf\u6027\u80fd\u4e3a 119 \u5fae\u79d2\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd0\u884c 120 \u79d2\u5c31\u8db3\u591f\u76d1\u6d4b\u5230\u6700\u5927\u5ef6\u8fdf\u4e86\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u53c2\u6570\u8bbe\u7f6e\u4e3a 120\u3002 ./redis-cli --intrinsic-latency 120 Max latency so far: 17 microseconds. Max latency so far: 44 microseconds. Max latency so far: 94 microseconds. Max latency so far: 110 microseconds. Max latency so far: 119 microseconds. 36481658 total runs (avg latency: 3.2893 microseconds / 3289.32 nanoseconds per run). Worst run took 36x longer than the average latency. \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u57fa\u7ebf\u6027\u80fd\u548c\u5f53\u524d\u7684\u64cd\u4f5c\u7cfb\u7edf\u3001\u786c\u4ef6\u914d\u7f6e\u76f8\u5173\u3002 \u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u548c Redis \u8fd0\u884c\u65f6\u7684\u5ef6\u8fdf\u7ed3\u5408\u8d77\u6765\uff0c\u518d\u8fdb\u4e00\u6b65\u5224\u65ad Redis \u6027\u80fd\u662f\u5426\u53d8\u6162\u4e86 \u3002 \u4e00\u822c\u6765\u8bf4\uff0c\u4f60\u8981\u628a\u8fd0\u884c\u65f6\u5ef6\u8fdf\u548c\u57fa\u7ebf\u6027\u80fd\u8fdb\u884c\u5bf9\u6bd4\uff0c\u5982\u679c\u4f60\u89c2\u5bdf\u5230\u7684 Redis \u8fd0\u884c\u65f6\u5ef6\u8fdf\u662f\u5176\u57fa\u7ebf\u6027\u80fd\u7684 2 \u500d\u53ca\u4ee5\u4e0a\uff0c\u5c31\u53ef\u4ee5\u8ba4\u5b9a Redis \u53d8\u6162\u4e86\u3002 \u5224\u65ad\u57fa\u7ebf\u6027\u80fd\u8fd9\u4e00\u70b9\uff0c\u5bf9\u4e8e\u5728\u865a\u62df\u5316\u73af\u5883\u4e0b\u8fd0\u884c\u7684 Redis \u6765\u8bf4\uff0c\u975e\u5e38\u91cd\u8981\u3002 \u662f\u56e0\u4e3a\uff0c\u5728\u865a\u62df\u5316\u73af\u5883\uff08\u4f8b\u5982\u865a\u62df\u673a\u6216\u5bb9\u5668\uff09\u4e2d\uff0c\u7531\u4e8e\u589e\u52a0\u4e86\u865a\u62df\u5316\u8f6f\u4ef6\u5c42\uff0c\u4e0e\u7269\u7406\u673a\u76f8\u6bd4\uff0c \u865a\u62df\u673a\u6216\u5bb9\u5668\u672c\u8eab\u5c31\u4f1a\u5f15\u5165\u4e00\u5b9a\u7684\u6027\u80fd\u5f00\u9500\uff0c\u6240\u4ee5\u57fa\u7ebf\u6027\u80fd\u4f1a\u9ad8\u4e00\u4e9b \u3002\u4e0b\u9762\u7684\u6d4b\u8bd5\u7ed3\u679c\uff0c\u663e\u793a\u7684\u5c31\u662f\u67d0\u4e00\u4e2a\u865a\u62df\u673a\u4e0a\u8fd0\u884c Redis \u65f6\u6d4b\u7684\u57fa\u7ebf\u6027\u80fd\u3002 $ ./redis-cli --intrinsic-latency 120 Max latency so far: 692 microseconds. Max latency so far: 915 microseconds. Max latency so far: 2193 microseconds. Max latency so far: 9343 microseconds. Max latency so far: 9871 microseconds. \u53ef\u4ee5\u770b\u5230\uff0c\u7531\u4e8e\u865a\u62df\u5316\u8f6f\u4ef6\u672c\u8eab\u7684\u5f00\u9500\uff0c\u6b64\u65f6\u7684\u57fa\u7ebf\u6027\u80fd\u5df2\u7ecf\u8fbe\u5230\u4e86 9.871ms\u3002 \u5982\u679c\u8be5 Redis \u5b9e\u4f8b\u7684\u8fd0\u884c\u65f6\u5ef6\u8fdf\u4e3a 10ms\uff0c\u8fd9\u5e76\u4e0d\u80fd\u7b97\u4f5c\u6027\u80fd\u53d8\u6162\uff0c\u56e0\u4e3a\u6b64\u65f6\uff0c\u8fd0\u884c\u65f6\u5ef6\u8fdf\u53ea\u6bd4\u57fa\u7ebf\u6027\u80fd\u589e\u52a0\u4e86 1.3%\u3002 \u5982\u679c\u4f60\u4e0d\u4e86\u89e3\u57fa\u7ebf\u6027\u80fd\uff0c\u4e00\u770b\u5230\u8f83\u9ad8\u7684\u8fd0\u884c\u65f6\u5ef6\u8fdf\uff0c\u5c31\u5f88\u6709\u53ef\u80fd\u8bef\u5224 Redis \u53d8\u6162\u4e86\u3002 \u6211\u4eec\u901a\u5e38\u662f\u901a\u8fc7\u5ba2\u6237\u7aef\u548c\u7f51\u7edc\u8bbf\u95ee Redis \u670d\u52a1\uff0c\u4e3a\u4e86\u907f\u514d\u7f51\u7edc\u5bf9\u57fa\u7ebf\u6027\u80fd\u7684\u5f71\u54cd\uff0c\u521a\u521a\u8bf4\u7684\u8fd9\u4e2a\u547d\u4ee4\u9700\u8981\u5728\u670d\u52a1\u5668\u7aef\u76f4\u63a5\u8fd0\u884c\uff0c\u8fd9\u4e5f\u5c31\u662f\u8bf4\uff0c \u6211\u4eec\u53ea\u8003\u8651\u670d\u52a1\u5668\u7aef\u8f6f\u786c\u4ef6\u73af\u5883\u7684\u5f71\u54cd \u3002 1-2 \u7f51\u7edc\u5bf9 Redis \u6027\u80fd\u7684\u5f71\u54cd \u5982\u679c\u4f60\u60f3\u4e86\u89e3\u7f51\u7edc\u5bf9 Redis \u6027\u80fd\u7684\u5f71\u54cd\uff0c\u4e00\u4e2a\u7b80\u5355\u7684\u65b9\u6cd5\u662f\u7528 iPerf \u8fd9\u6837\u7684\u5de5\u5177\uff0c\u6d4b\u91cf\u4ece Redis \u5ba2\u6237\u7aef\u5230\u670d\u52a1\u5668\u7aef\u7684\u7f51\u7edc\u5ef6\u8fdf\u3002 \u5982\u679c\u8fd9\u4e2a\u5ef6\u8fdf\u6709\u51e0\u5341\u6beb\u79d2\u751a\u81f3\u662f\u51e0\u767e\u6beb\u79d2\uff0c\u5c31\u8bf4\u660e\uff0cRedis \u8fd0\u884c\u7684\u7f51\u7edc\u73af\u5883\u4e2d\u5f88\u53ef\u80fd\u6709\u5927\u6d41\u91cf\u7684\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u5728\u8fd0\u884c \uff0c\u5bfc\u81f4\u7f51\u7edc\u62e5\u585e\u4e86\u3002 \u8fd9\u4e2a\u65f6\u5019\uff0c\u4f60\u5c31\u9700\u8981\u534f\u8c03\u7f51\u7edc\u8fd0\u7ef4\uff0c\u8c03\u6574\u7f51\u7edc\u7684\u6d41\u91cf\u5206\u914d\u4e86\u3002 2\u3001\u5982\u4f55\u5e94\u5bf9 Redis \u53d8\u6162\uff1f Redis \u67b6\u6784\u56fe\uff0c\u662f Redis \u81ea\u8eab\u7684\u64cd\u4f5c\u7279\u6027\u3001\u6587\u4ef6\u7cfb\u7edf\u548c\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5b83\u4eec\u662f\u5f71\u54cd Redis \u6027\u80fd\u7684\u4e09\u5927\u8981\u7d20\u3002 3\u3001Redis \u81ea\u8eab\u64cd\u4f5c\u7279\u6027\u7684\u5f71\u54cd 3-1 \u6162\u67e5\u8be2\u547d\u4ee4 \u6162\u67e5\u8be2\u547d\u4ee4\uff0c\u5c31\u662f\u6307\u5728 Redis \u4e2d\u6267\u884c\u901f\u5ea6\u6162\u7684\u547d\u4ee4\uff0c\u8fd9\u4f1a\u5bfc\u81f4 Redis \u5ef6\u8fdf\u589e\u52a0\u3002Redis \u63d0\u4f9b\u7684\u547d\u4ee4\u64cd\u4f5c\u5f88\u591a\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u547d\u4ee4\u90fd\u6162\uff0c\u8fd9\u548c\u547d\u4ee4\u64cd\u4f5c\u7684\u590d\u6742\u5ea6\u6709\u5173\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u5fc5\u987b\u8981\u77e5\u9053 Redis \u7684\u4e0d\u540c\u547d\u4ee4\u7684\u590d\u6742\u5ea6\u3002 \u6bd4\u5982\u8bf4\uff0c Value \u7c7b\u578b\u4e3a String \u65f6\uff0c GET/SET \u64cd\u4f5c\u4e3b\u8981\u5c31\u662f\u64cd\u4f5c Redis \u7684\u54c8\u5e0c\u8868\u7d22\u5f15\u3002\u8fd9\u4e2a\u64cd\u4f5c\u590d\u6742\u5ea6\u57fa\u672c\u662f\u56fa\u5b9a\u7684\uff0c\u5373 O(1) \u3002 \u4f46\u662f\uff0c\u5f53 Value \u7c7b\u578b\u4e3a Set \u65f6\uff0c SORT \u3001 SUNION/SMEMBERS \u64cd\u4f5c\u590d\u6742\u5ea6\u5206\u522b\u4e3a O(N+M*log(M)) \u548c O(N) \u3002\u5176\u4e2d\uff0cN \u4e3a Set \u4e2d\u7684\u5143\u7d20\u4e2a\u6570\uff0cM \u4e3a SORT \u64cd\u4f5c\u8fd4\u56de\u7684\u5143\u7d20\u4e2a\u6570\u3002\u8fd9\u4e2a\u590d\u6742\u5ea6\u5c31\u589e\u52a0\u4e86\u5f88\u591a Redis \u5b98\u65b9\u6587\u6863\u4e2d\u5bf9\u6bcf\u4e2a\u547d\u4ee4\u7684\u590d\u6742\u5ea6\u90fd\u6709\u4ecb\u7ecd \u4f60\u53d1\u73b0 Redis \u6027\u80fd\u53d8\u6162\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7 Redis \u65e5\u5fd7\uff0c\u6216\u8005\u662f latency monitor \u5de5\u5177 \uff0c\u67e5\u8be2\u53d8\u6162\u7684\u8bf7\u6c42\uff0c \u6839\u636e\u8bf7\u6c42\u5bf9\u5e94\u7684\u5177\u4f53\u547d\u4ee4\u4ee5\u53ca\u5b98\u65b9\u6587\u6863\uff0c\u786e\u8ba4\u4e0b\u662f\u5426\u91c7\u7528\u4e86\u590d\u6742\u5ea6\u9ad8\u7684\u6162\u67e5\u8be2\u547d\u4ee4\u3002 \u5982\u679c\u7684\u786e\u6709\u5927\u91cf\u7684\u6162\u67e5\u8be2\u547d\u4ee4\uff0c\u6709\u4e24\u79cd\u5904\u7406\u65b9\u5f0f\uff1a \u7528\u5176\u4ed6\u9ad8\u6548\u547d\u4ee4\u4ee3\u66ff\u3002\u6bd4\u5982\u8bf4\uff0c\u5982\u679c\u4f60\u9700\u8981\u8fd4\u56de\u4e00\u4e2a SET \u4e2d\u7684\u6240\u6709\u6210\u5458\u65f6\uff0c \u4e0d\u8981\u4f7f\u7528 SMEMBERS \u547d\u4ee4\uff0c\u800c\u662f\u8981\u4f7f\u7528 SSCAN \u591a\u6b21\u8fed\u4ee3\u8fd4\u56de \uff0c\u907f\u514d\u4e00\u6b21\u8fd4\u56de\u5927\u91cf\u6570\u636e\uff0c\u9020\u6210\u7ebf\u7a0b\u963b\u585e\u3002 \u5f53\u4f60\u9700\u8981\u6267\u884c\u6392\u5e8f\u3001\u4ea4\u96c6\u3001\u5e76\u96c6\u64cd\u4f5c\u65f6\uff0c\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u5b8c\u6210\uff0c\u800c\u4e0d\u8981\u7528 SORT\u3001SUNION\u3001SINTER \u8fd9\u4e9b\u547d\u4ee4\uff0c\u4ee5\u514d\u62d6\u6162 Redis \u5b9e\u4f8b\u3002 \u5f53\u7136\uff0c\u5982\u679c\u4e1a\u52a1\u903b\u8f91\u5c31\u662f\u8981\u6c42\u4f7f\u7528\u6162\u67e5\u8be2\u547d\u4ee4\uff0c\u90a3\u4f60\u5f97\u8003\u8651\u91c7\u7528\u6027\u80fd\u66f4\u597d\u7684 CPU\uff0c\u66f4\u5feb\u5730\u5b8c\u6210\u67e5\u8be2\u547d\u4ee4\uff0c\u907f\u514d\u6162\u67e5\u8be2\u7684\u5f71\u54cd\u3002 \u8fd8\u6709\u4e00\u4e2a\u6bd4\u8f83\u5bb9\u6613\u5ffd\u7565\u7684\u6162\u67e5\u8be2\u547d\u4ee4\uff0c\u5c31\u662f KEYS \u3002 \u5b83\u7528\u4e8e\u8fd4\u56de\u548c\u8f93\u5165\u6a21\u5f0f\u5339\u914d\u7684\u6240\u6709 key\uff0c\u4f8b\u5982\uff0c\u4ee5\u4e0b\u547d\u4ee4\u8fd4\u56de\u6240\u6709\u5305\u542b\u201cname\u201d\u5b57\u7b26\u4e32\u7684 keys\u3002 redis> KEYS *name* 1) \"lastname\" 2) \"firstname\" \u56e0\u4e3a KEYS \u547d\u4ee4\u9700\u8981\u904d\u5386\u5b58\u50a8\u7684\u952e\u503c\u5bf9\uff0c\u6240\u4ee5\u64cd\u4f5c\u5ef6\u65f6\u9ad8\u3002\u5982\u679c\u4f60\u4e0d\u4e86\u89e3\u5b83\u7684\u5b9e\u73b0\u800c\u4f7f\u7528\u4e86\u5b83\uff0c\u5c31\u4f1a\u5bfc\u81f4 Redis \u6027\u80fd\u53d8\u6162\u3002\u6240\u4ee5\uff0cKEYS \u547d\u4ee4\u4e00\u822c\u4e0d\u88ab\u5efa\u8bae\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u4e2d\u3002 3-2 \u8fc7\u671f key \u64cd\u4f5c \u8fc7\u671f key \u7684\u81ea\u52a8\u5220\u9664\u673a\u5236\u3002\u5b83\u662f Redis \u7528\u6765\u56de\u6536\u5185\u5b58\u7a7a\u95f4\u7684\u5e38\u7528\u673a\u5236 \uff0c\u5e94\u7528\u5e7f\u6cdb\uff0c\u672c\u8eab\u5c31\u4f1a\u5f15\u8d77 Redis \u64cd\u4f5c\u963b\u585e\uff0c\u5bfc\u81f4\u6027\u80fd\u53d8\u6162\uff0c\u6240\u4ee5\uff0c\u4f60\u5fc5\u987b\u8981\u77e5\u9053\u8be5\u673a\u5236\u5bf9\u6027\u80fd\u7684\u5f71\u54cd\u3002 Redis \u952e\u503c\u5bf9\u7684 key \u53ef\u4ee5\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cRedis \u6bcf 100 \u6beb\u79d2\u4f1a\u5220\u9664\u4e00\u4e9b\u8fc7\u671f key \uff0c\u5177\u4f53\u7684\u7b97\u6cd5\u5982\u4e0b\uff1a \u91c7\u6837 ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP \u4e2a\u6570\u7684 key\uff0c\u5e76\u5c06\u5176\u4e2d\u8fc7\u671f\u7684 key \u5168\u90e8\u5220\u9664\uff1b \u5982\u679c\u8d85\u8fc7 25% \u7684 key \u8fc7\u671f\u4e86\uff0c\u5219\u91cd\u590d\u5220\u9664\u7684\u8fc7\u7a0b\uff0c\u76f4\u5230\u8fc7\u671f key \u7684\u6bd4\u4f8b\u964d\u81f3 25% \u4ee5\u4e0b\u3002 ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP \u662f Redis \u7684\u4e00\u4e2a\u53c2\u6570\uff0c\u9ed8\u8ba4\u662f 20 \uff0c\u90a3\u4e48\uff0c\u4e00\u79d2\u5185\u57fa\u672c\u6709 200 \u4e2a\u8fc7\u671f key \u4f1a\u88ab\u5220\u9664\u3002 \u8fd9\u4e00\u7b56\u7565\u5bf9\u6e05\u9664\u8fc7\u671f key\u3001\u91ca\u653e\u5185\u5b58\u7a7a\u95f4\u5f88\u6709\u5e2e\u52a9\u3002\u5982\u679c\u6bcf\u79d2\u949f\u5220\u9664 200 \u4e2a\u8fc7\u671f key\uff0c\u5e76\u4e0d\u4f1a\u5bf9 Redis \u9020\u6210\u592a\u5927\u5f71\u54cd\u3002 \u5982\u679c\u89e6\u53d1\u4e86\u4e0a\u9762\u8fd9\u4e2a\u7b97\u6cd5\u7684\u7b2c\u4e8c\u6761\uff0cRedis \u5c31\u4f1a\u4e00\u76f4\u5220\u9664\u4ee5\u91ca\u653e\u5185\u5b58\u7a7a\u95f4 \u3002 \u6ce8\u610f\uff0c\u5220\u9664\u64cd\u4f5c\u662f\u963b\u585e\u7684\uff08Redis 4.0 \u540e\u53ef\u4ee5\u7528\u5f02\u6b65\u7ebf\u7a0b\u673a\u5236\u6765\u51cf\u5c11\u963b\u585e\u5f71\u54cd\uff09\u3002\u6240\u4ee5\uff0c\u4e00\u65e6\u8be5\u6761\u4ef6\u89e6\u53d1\uff0cRedis \u7684\u7ebf\u7a0b\u5c31\u4f1a\u4e00\u76f4\u6267\u884c\u5220\u9664\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5c31\u6ca1\u529e\u6cd5\u6b63\u5e38\u670d\u52a1\u5176\u4ed6\u7684\u952e\u503c\u64cd\u4f5c\u4e86\uff0c\u5c31\u4f1a\u8fdb\u4e00\u6b65\u5f15\u8d77\u5176\u4ed6\u952e\u503c\u64cd\u4f5c\u7684\u5ef6\u8fdf\u589e\u52a0\uff0cRedis \u5c31\u4f1a\u53d8\u6162\u3002 \u7b97\u6cd5\u7684\u7b2c\u4e8c\u6761\u662f\u600e\u4e48\u88ab\u89e6\u53d1\u7684\u5462\uff1f \u5176\u4e2d\u4e00\u4e2a\u91cd\u8981\u6765\u6e90\uff0c \u5c31\u662f\u9891\u7e41\u4f7f\u7528\u5e26\u6709\u76f8\u540c\u65f6\u95f4\u53c2\u6570\u7684 EXPIREAT \u547d\u4ee4\u8bbe\u7f6e\u8fc7\u671f key\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\uff0c\u5728\u540c\u4e00\u79d2\u5185\u6709\u5927\u91cf\u7684 key \u540c\u65f6\u8fc7\u671f \u3002 \u8981\u68c0\u67e5\u4e1a\u52a1\u4ee3\u7801\u5728\u4f7f\u7528 EXPIREAT \u547d\u4ee4\u8bbe\u7f6e key \u8fc7\u671f\u65f6\u95f4\u65f6\uff0c\u662f\u5426\u4f7f\u7528\u4e86\u76f8\u540c\u7684 UNIX \u65f6\u95f4\u6233\uff0c\u6709\u6ca1\u6709\u4f7f\u7528 EXPIRE \u547d\u4ee4\u7ed9\u6279\u91cf\u7684 key \u8bbe\u7f6e\u76f8\u540c\u7684\u8fc7\u671f\u79d2\u6570\u3002\u56e0\u4e3a\uff0c\u8fd9\u90fd\u4f1a\u9020\u6210\u5927\u91cf key \u5728\u540c\u4e00\u65f6\u95f4\u8fc7\u671f\uff0c\u5bfc\u81f4\u6027\u80fd\u53d8\u6162 \u9996\u5148\u8981\u6839\u636e\u5b9e\u9645\u4e1a\u52a1\u7684\u4f7f\u7528\u9700\u6c42\uff0c\u51b3\u5b9a EXPIREAT \u548c EXPIRE \u7684\u8fc7\u671f\u65f6\u95f4\u53c2\u6570\u3002 \u5176\u6b21\uff0c\u5982\u679c\u4e00\u6279 key \u7684\u786e\u662f\u540c\u65f6\u8fc7\u671f\uff0c\u4f60\u8fd8\u53ef\u4ee5\u5728 EXPIREAT \u548c EXPIRE \u7684\u8fc7\u671f\u65f6\u95f4\u53c2\u6570\u4e0a\uff0c \u52a0\u4e0a\u4e00\u4e2a\u4e00\u5b9a\u5927\u5c0f\u8303\u56f4\u5185\u7684\u968f\u673a\u6570 \uff0c\u8fd9\u6837\uff0c\u65e2\u4fdd\u8bc1\u4e86 key \u5728\u4e00\u4e2a\u90bb\u8fd1\u65f6\u95f4\u8303\u56f4\u5185\u88ab\u5220\u9664\uff0c\u53c8\u907f\u514d\u4e86\u540c\u65f6\u8fc7\u671f\u9020\u6210\u7684\u538b\u529b\u3002 4\u3001\u6587\u4ef6\u7cfb\u7edf\u548c\u64cd\u4f5c\u7cfb\u7edf Redis \u4f1a\u6301\u4e45\u5316\u4fdd\u5b58\u6570\u636e\u5230\u78c1\u76d8\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u8981\u4f9d\u8d56\u6587\u4ef6\u7cfb\u7edf\u6765\u5b8c\u6210\uff0c\u6240\u4ee5\uff0c\u6587\u4ef6\u7cfb\u7edf\u5c06\u6570\u636e\u5199\u56de\u78c1\u76d8\u7684\u673a\u5236\uff0c\u4f1a\u76f4\u63a5\u5f71\u54cd\u5230 Redis \u6301\u4e45\u5316\u7684\u6548\u7387 \u3002 \u800c\u4e14\uff0c\u5728\u6301\u4e45\u5316\u7684\u8fc7\u7a0b\u4e2d\uff0cRedis \u4e5f\u8fd8\u5728\u63a5\u6536\u5176\u4ed6\u8bf7\u6c42\uff0c\u6301\u4e45\u5316\u7684\u6548\u7387\u9ad8\u4f4e\u53c8\u4f1a\u5f71\u54cd\u5230 Redis \u5904\u7406\u8bf7\u6c42\u7684\u6027\u80fd\u3002 \u53e6\u4e00\u65b9\u9762\uff0c Redis \u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u5185\u5b58\u64cd\u4f5c\u975e\u5e38\u9891\u7e41 \uff0c\u6240\u4ee5\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58\u673a\u5236\u4f1a\u76f4\u63a5\u5f71\u54cd\u5230 Redis \u7684\u5904\u7406\u6548\u7387\u3002\u6bd4\u5982\u8bf4\uff0c\u5982\u679c Redis \u7684\u5185\u5b58\u4e0d\u591f\u7528\u4e86\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u542f\u52a8 swap \u673a\u5236\uff0c\u8fd9\u5c31\u4f1a\u76f4\u63a5\u62d6\u6162 Redis\u3002 5\u3001\u6587\u4ef6\u7cfb\u7edf\uff1aAOF \u6a21\u5f0f Redis \u662f\u4e2a\u5185\u5b58\u6570\u636e\u5e93\uff0c\u4e3a\u4ec0\u4e48\u5b83\u7684\u6027\u80fd\u8fd8\u548c\u6587\u4ef6\u7cfb\u7edf\u6709\u5173\u5462\uff1f \u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\uff0cRedis \u4f1a\u91c7\u7528 AOF \u65e5\u5fd7\u6216 RDB \u5feb\u7167\u3002 \u5176\u4e2d\uff0cAOF \u65e5\u5fd7\u63d0\u4f9b\u4e86\u4e09\u79cd\u65e5\u5fd7\u5199\u56de\u7b56\u7565\uff1a no\u3001everysec\u3001always\u3002\u8fd9\u4e09\u79cd\u5199\u56de\u7b56\u7565\u4f9d\u8d56\u6587\u4ef6\u7cfb\u7edf\u7684\u4e24\u4e2a\u7cfb\u7edf\u8c03\u7528\u5b8c\u6210\uff0c\u4e5f\u5c31\u662f write \u548c fsync\u3002 write \u53ea\u8981\u628a\u65e5\u5fd7\u8bb0\u5f55\u5199\u5230\u5185\u6838\u7f13\u51b2\u533a\uff0c\u5c31\u53ef\u4ee5\u8fd4\u56de\u4e86\uff0c\u5e76\u4e0d\u9700\u8981\u7b49\u5f85\u65e5\u5fd7\u5b9e\u9645\u5199\u56de\u5230\u78c1\u76d8\uff1b \u800c fsync \u9700\u8981\u628a\u65e5\u5fd7\u8bb0\u5f55\u5199\u56de\u5230\u78c1\u76d8\u540e\u624d\u80fd\u8fd4\u56de\uff0c\u65f6\u95f4\u8f83\u957f\u3002 \u4e0b\u9762\u8fd9\u5f20\u8868\u5c55\u793a\u4e86\u4e09\u79cd\u5199\u56de\u7b56\u7565\u6240\u6267\u884c\u7684\u7cfb\u7edf\u8c03\u7528\u3002 \u5f53\u5199\u56de\u7b56\u7565\u914d\u7f6e\u4e3a everysec \u548c always \u65f6\uff0cRedis \u9700\u8981\u8c03\u7528 fsync \u628a\u65e5\u5fd7\u5199\u56de\u78c1\u76d8\u3002 5-1 everysec \u5728\u4f7f\u7528 everysec \u65f6\uff0cRedis \u5141\u8bb8\u4e22\u5931\u4e00\u79d2\u7684\u64cd\u4f5c\u8bb0\u5f55\uff0c\u6240\u4ee5\uff0cRedis \u4e3b\u7ebf\u7a0b\u5e76\u4e0d\u9700\u8981\u786e\u4fdd\u6bcf\u4e2a\u64cd\u4f5c\u8bb0\u5f55\u65e5\u5fd7\u90fd\u5199\u56de\u78c1\u76d8\u3002 \u800c\u4e14\uff0cfsync \u7684\u6267\u884c\u65f6\u95f4\u5f88\u957f\uff0c\u5982\u679c\u662f\u5728 Redis \u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c fsync\uff0c\u5c31\u5bb9\u6613\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002 \u6240\u4ee5\uff0c\u5f53\u5199\u56de\u7b56\u7565\u914d\u7f6e\u4e3a everysec \u65f6\uff0cRedis \u4f1a\u4f7f\u7528\u540e\u53f0\u7684\u5b50\u7ebf\u7a0b\u5f02\u6b65\u5b8c\u6210 fsync \u7684\u64cd\u4f5c\u3002 5-2 always \u800c\u5bf9\u4e8e always \u7b56\u7565\u6765\u8bf4\uff0cRedis \u9700\u8981\u786e\u4fdd\u6bcf\u4e2a\u64cd\u4f5c\u8bb0\u5f55\u65e5\u5fd7\u90fd\u5199\u56de\u78c1\u76d8\uff0c\u5982\u679c\u7528\u540e\u53f0\u5b50\u7ebf\u7a0b\u5f02\u6b65\u5b8c\u6210\uff0c\u4e3b\u7ebf\u7a0b\u5c31\u65e0\u6cd5\u53ca\u65f6\u5730\u77e5\u9053\u6bcf\u4e2a\u64cd\u4f5c\u662f\u5426\u5df2\u7ecf\u5b8c\u6210\u4e86\uff0c\u8fd9\u5c31\u4e0d\u7b26\u5408 always \u7b56\u7565\u7684\u8981\u6c42\u4e86\u3002 \u6240\u4ee5\uff0calways \u7b56\u7565\u5e76\u4e0d\u4f7f\u7528\u540e\u53f0\u5b50\u7ebf\u7a0b\u6765\u6267\u884c\u3002 \u4f7f\u7528everysec\u65f6\uff0c\u4f1a\u4f7f\u7528\u5b50\u7ebf\u7a0b\u6765\u64cd\u4f5c\uff0c\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002\u800c\u4f7f\u7528always\u65f6\uff0c\u662f\u4f7f\u7528\u4e3b\u7ebf\u7a0b\u6765\u64cd\u4f5c\uff0c\u6240\u4ee5\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b 5-3 AOF \u91cd\u5199 \u5728\u4f7f\u7528 AOF \u65e5\u5fd7\u65f6\uff0c\u4e3a\u4e86\u907f\u514d\u65e5\u5fd7\u6587\u4ef6\u4e0d\u65ad\u589e\u5927\uff0c Redis \u4f1a\u6267\u884c AOF \u91cd\u5199\uff0c\u751f\u6210\u4f53\u91cf\u7f29\u5c0f\u7684\u65b0\u7684 AOF \u65e5\u5fd7\u6587\u4ef6 \u3002AOF \u91cd\u5199\u672c\u8eab\u9700\u8981\u7684\u65f6\u95f4\u5f88\u957f\uff0c\u4e5f\u5bb9\u6613\u963b\u585e Redis \u4e3b\u7ebf\u7a0b\uff0c\u6240\u4ee5\uff0cRedis \u4f7f\u7528\u5b50\u8fdb\u7a0b\u6765\u8fdb\u884c AOF \u91cd\u5199\u3002 \u6f5c\u5728\u7684\u98ce\u9669\u70b9: AOF \u91cd\u5199\u4f1a\u5bf9\u78c1\u76d8\u8fdb\u884c\u5927\u91cf IO \u64cd\u4f5c\uff0c\u540c\u65f6\uff0cfsync \u53c8\u9700\u8981\u7b49\u5230\u6570\u636e\u5199\u5230\u78c1\u76d8\u540e\u624d\u80fd\u8fd4\u56de\uff0c\u6240\u4ee5\uff0c\u5f53 AOF \u91cd\u5199\u7684\u538b\u529b\u6bd4\u8f83\u5927\u65f6\uff0c\u5c31\u4f1a\u5bfc\u81f4 fsync \u88ab\u963b\u585e\u3002\u867d\u7136 fsync \u662f\u7531\u540e\u53f0\u5b50\u7ebf\u7a0b\u8d1f\u8d23\u6267\u884c\u7684\uff0c\u4f46\u662f\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u76d1\u63a7 fsync \u7684\u6267\u884c\u8fdb\u5ea6\u3002 \u5f53\u4e3b\u7ebf\u7a0b\u4f7f\u7528\u540e\u53f0\u5b50\u7ebf\u7a0b\u6267\u884c\u4e86\u4e00\u6b21 fsync\uff0c\u9700\u8981\u518d\u6b21\u628a\u65b0\u63a5\u6536\u7684\u64cd\u4f5c\u8bb0\u5f55\u5199\u56de\u78c1\u76d8\u65f6\uff0c\u5982\u679c\u4e3b\u7ebf\u7a0b\u53d1\u73b0\u4e0a\u4e00\u6b21\u7684 fsync \u8fd8\u6ca1\u6709\u6267\u884c\u5b8c\uff0c\u90a3\u4e48\u5b83\u5c31\u4f1a\u963b\u585e\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u540e\u53f0\u5b50\u7ebf\u7a0b\u6267\u884c\u7684 fsync \u9891\u7e41\u963b\u585e\u7684\u8bdd\uff08\u6bd4\u5982 AOF \u91cd\u5199\u5360\u7528\u4e86\u5927\u91cf\u7684\u78c1\u76d8 IO \u5e26\u5bbd\uff09\uff0c\u4e3b\u7ebf\u7a0b\u4e5f\u4f1a\u963b\u585e\uff0c\u5bfc\u81f4 Redis \u6027\u80fd\u53d8\u6162\u3002 \u7531\u4e8e fsync \u540e\u53f0\u5b50\u7ebf\u7a0b\u548c AOF \u91cd\u5199\u5b50\u8fdb\u7a0b\u7684\u5b58\u5728\uff0c\u4e3b IO \u7ebf\u7a0b\u4e00\u822c\u4e0d\u4f1a\u88ab\u963b\u585e\u3002 \u4f46\u662f\uff0c\u5982\u679c\u5728\u91cd\u5199\u65e5\u5fd7\u65f6\uff0c AOF \u91cd\u5199\u5b50\u8fdb\u7a0b\u7684\u5199\u5165\u91cf\u6bd4\u8f83\u5927\uff0c fsync \u7ebf\u7a0b\u4e5f\u4f1a\u88ab\u963b\u585e\uff0c\u8fdb\u800c\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u5bfc\u81f4\u5ef6\u8fdf\u589e\u52a0 \u9996\u5148\uff0c\u4f60\u53ef\u4ee5\u68c0\u67e5\u4e0b Redis \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 appendfsync \u914d\u7f6e\u9879\uff0c\u8be5\u914d\u7f6e\u9879\u7684\u53d6\u503c\u8868\u660e\u4e86 Redis \u5b9e\u4f8b\u4f7f\u7528\u7684\u662f\u54ea\u79cd AOF \u65e5\u5fd7\u5199\u56de\u7b56\u7565\uff0c\u5982\u4e0b\u6240\u793a\uff1a \u5982\u679c AOF \u5199\u56de\u7b56\u7565\u4f7f\u7528\u4e86 everysec \u6216 always \u914d\u7f6e\uff0c\u8bf7\u5148\u786e\u8ba4\u4e0b\u4e1a\u52a1\u65b9\u5bf9\u6570\u636e\u53ef\u9760\u6027\u7684\u8981\u6c42\uff0c\u660e\u786e\u662f\u5426\u9700\u8981\u6bcf\u4e00\u79d2\u6216\u6bcf\u4e00\u4e2a\u64cd\u4f5c\u90fd\u8bb0\u65e5\u5fd7\u3002 \u6709\u7684\u4e1a\u52a1\u65b9\u4e0d\u4e86\u89e3 Redis AOF \u673a\u5236\uff0c\u5f88\u53ef\u80fd\u5c31\u76f4\u63a5\u4f7f\u7528\u6570\u636e\u53ef\u9760\u6027\u6700\u9ad8\u7b49\u7ea7\u7684 always \u914d\u7f6e\u4e86\u3002\u5176\u5b9e\uff0c\u5728\u6709\u4e9b\u573a\u666f\u4e2d\uff08\u4f8b\u5982 Redis \u7528\u4e8e\u7f13\u5b58\uff09\uff0c\u6570\u636e\u4e22\u4e86\u8fd8\u53ef\u4ee5\u4ece\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u83b7\u53d6\uff0c\u5e76\u4e0d\u9700\u8981\u5f88\u9ad8\u7684\u6570\u636e\u53ef\u9760\u6027\u3002 \u5982\u679c\u4e1a\u52a1\u5e94\u7528\u5bf9\u5ef6\u8fdf\u975e\u5e38\u654f\u611f\uff0c\u4f46\u540c\u65f6\u5141\u8bb8\u4e00\u5b9a\u91cf\u7684\u6570\u636e\u4e22\u5931\uff0c\u90a3\u4e48\uff0c\u53ef\u4ee5\u628a\u914d\u7f6e\u9879 no-appendfsync-on-rewrite \u8bbe\u7f6e\u4e3a yes \uff0c\u5982\u4e0b\u6240\u793a\uff1a no-appendfsync-on-rewrite yes \u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a yes \u65f6\uff0c\u8868\u793a\u5728 AOF \u91cd\u5199\u65f6\uff0c\u4e0d\u8fdb\u884c fsync \u64cd\u4f5c\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cRedis \u5b9e\u4f8b\u628a\u5199\u547d\u4ee4\u5199\u5230\u5185\u5b58\u540e\uff0c\u4e0d\u8c03\u7528\u540e\u53f0\u7ebf\u7a0b\u8fdb\u884c fsync \u64cd\u4f5c\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de\u4e86\u3002 \u5f53\u7136\uff0c\u5982\u679c\u6b64\u65f6\u5b9e\u4f8b\u53d1\u751f\u5b95\u673a\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u3002\u53cd\u4e4b\uff0c\u5982\u679c\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a no\uff08\u4e5f\u662f\u9ed8\u8ba4\u914d\u7f6e\uff09\uff0c\u5728 AOF \u91cd\u5199\u65f6\uff0cRedis \u5b9e\u4f8b\u4ecd\u7136\u4f1a\u8c03\u7528\u540e\u53f0\u7ebf\u7a0b\u8fdb\u884c fsync \u64cd\u4f5c\uff0c\u8fd9\u5c31\u4f1a\u7ed9\u5b9e\u4f8b\u5e26\u6765\u963b\u585e\u3002 \u5982\u679c\u7684\u786e\u9700\u8981\u9ad8\u6027\u80fd\uff0c\u91c7\u7528\u9ad8\u901f\u7684\u56fa\u6001\u786c\u76d8\u4f5c\u4e3a AOF \u65e5\u5fd7\u7684\u5199\u5165\u8bbe\u5907\u3002 \u9ad8\u901f\u56fa\u6001\u76d8\u7684\u5e26\u5bbd\u548c\u5e76\u53d1\u5ea6\u6bd4\u4f20\u7edf\u7684\u673a\u68b0\u786c\u76d8\u7684\u8981\u9ad8\u51fa 10 \u500d\u53ca\u4ee5\u4e0a\u3002 \u5728 AOF \u91cd\u5199\u548c fsync \u540e\u53f0\u7ebf\u7a0b\u540c\u65f6\u6267\u884c\u65f6\uff0c\u56fa\u6001\u786c\u76d8\u53ef\u4ee5\u63d0\u4f9b\u8f83\u4e3a\u5145\u8db3\u7684\u78c1\u76d8 IO \u8d44\u6e90\uff0c\u8ba9 AOF \u91cd\u5199\u548c fsync \u540e\u53f0\u7ebf\u7a0b\u7684\u78c1\u76d8 IO \u8d44\u6e90\u7ade\u4e89\u51cf\u5c11\uff0c\u4ece\u800c\u964d\u4f4e\u5bf9 Redis \u7684\u6027\u80fd\u5f71\u54cd\u3002 6\u3001\u64cd\u4f5c\u7cfb\u7edf\uff1aswap \u5982\u679c Redis \u7684 AOF \u65e5\u5fd7\u914d\u7f6e\u53ea\u662f no\uff0c\u6216\u8005\u5c31\u6ca1\u6709\u91c7\u7528 AOF \u6a21\u5f0f \u6f5c\u5728\u7684\u74f6\u9888\uff1a\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58 swap\u3002 \u5185\u5b58 swap \u662f\u64cd\u4f5c\u7cfb\u7edf\u91cc\u5c06\u5185\u5b58\u6570\u636e\u5728\u5185\u5b58\u548c\u78c1\u76d8\u95f4\u6765\u56de\u6362\u5165\u548c\u6362\u51fa\u7684\u673a\u5236\uff0c\u6d89\u53ca\u5230\u78c1\u76d8\u7684\u8bfb\u5199 \uff0c\u6240\u4ee5\uff0c\u4e00\u65e6\u89e6\u53d1 swap\uff0c\u65e0\u8bba\u662f\u88ab\u6362\u5165\u6570\u636e\u7684\u8fdb\u7a0b\uff0c\u8fd8\u662f\u88ab\u6362\u51fa\u6570\u636e\u7684\u8fdb\u7a0b\uff0c\u5176\u6027\u80fd\u90fd\u4f1a\u53d7\u5230\u6162\u901f\u78c1\u76d8\u8bfb\u5199\u7684\u5f71\u54cd\u3002 Redis \u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u5185\u5b58\u4f7f\u7528\u91cf\u5927\uff0c\u5982\u679c\u6ca1\u6709\u63a7\u5236\u597d\u5185\u5b58\u7684\u4f7f\u7528\u91cf\uff0c\u6216\u8005\u548c\u5176\u4ed6\u5185\u5b58\u9700\u6c42\u5927\u7684\u5e94\u7528\u4e00\u8d77\u8fd0\u884c\u4e86\uff0c\u5c31\u53ef\u80fd\u53d7\u5230 swap \u7684\u5f71\u54cd\uff0c\u800c\u5bfc\u81f4\u6027\u80fd\u53d8\u6162\u3002 Redis \u5185\u5b58\u6570\u636e\u5e93\u800c\u8a00\uff0c\u663e\u5f97\u66f4\u4e3a\u91cd\u8981\uff1a \u6b63\u5e38\u60c5\u51b5\u4e0b\uff0cRedis \u7684\u64cd\u4f5c\u662f\u76f4\u63a5\u901a\u8fc7\u8bbf\u95ee\u5185\u5b58\u5c31\u80fd\u5b8c\u6210\uff0c\u4e00\u65e6 swap \u88ab\u89e6\u53d1\u4e86\uff0cRedis \u7684\u8bf7\u6c42\u64cd\u4f5c\u9700\u8981\u7b49\u5230\u78c1\u76d8\u6570\u636e\u8bfb\u5199\u5b8c\u6210\u624d\u884c \u3002 \u800c\u4e14\uff0c AOF \u65e5\u5fd7\u6587\u4ef6\u8bfb\u5199\u4f7f\u7528 fsync \u7ebf\u7a0b\u4e0d\u540c\uff0cswap \u89e6\u53d1\u540e\u5f71\u54cd\u7684\u662f Redis \u4e3b IO \u7ebf\u7a0b\uff0c\u8fd9\u4f1a\u6781\u5927\u5730\u589e\u52a0 Redis \u7684\u54cd\u5e94\u65f6\u95f4\u3002 6-1 swap \u800c\u5bfc\u81f4\u6027\u80fd\u964d\u4f4e \u5b9e\u4f8b\u5b8c\u6210 5000 \u4e07\u4e2a GET \u8bf7\u6c42\u65f6\u9700\u8981 300s\uff0c\u4f46\u662f\uff0c\u6709\u4e00\u6b21\uff0c\u8fd9\u4e2a\u5b9e\u4f8b\u5b8c\u6210 5000 \u4e07 GET \u8bf7\u6c42\uff0c\u82b1\u4e86\u5c06\u8fd1 4 \u4e2a\u5c0f\u65f6\u7684\u65f6\u95f4 \u95ee\u9898\u590d\u73b0\uff0c\u5f53\u65f6 Redis \u5904\u7406\u8bf7\u6c42\u7528\u4e86\u8fd1 4 \u5c0f\u65f6\u7684\u60c5\u51b5\u4e0b\uff0c \u8be5\u5b9e\u4f8b\u6240\u5728\u7684\u673a\u5668\u5df2\u7ecf\u53d1\u751f\u4e86 swap \u3002\u4ece 300s \u5230 4 \u4e2a\u5c0f\u65f6\uff0c\u5ef6\u8fdf\u589e\u52a0\u4e86\u5c06\u8fd1 48 \u500d\uff0c\u53ef\u4ee5\u770b\u5230 swap \u5bf9\u6027\u80fd\u9020\u6210\u7684\u4e25\u91cd\u5f71\u54cd\u3002 \u4ec0\u4e48\u65f6\u5019\u4f1a\u89e6\u53d1 swap \u5462\uff1f \u901a\u5e38\uff0c\u89e6\u53d1 swap \u7684\u539f\u56e0\u4e3b\u8981\u662f\u7269\u7406\u673a\u5668\u5185\u5b58\u4e0d\u8db3 \u5bf9\u4e8e Redis \u800c\u8a00\uff0c\u6709\u4e24\u79cd\u5e38\u89c1\u7684\u60c5\u51b5\uff1a Redis \u5b9e\u4f8b\u81ea\u8eab\u4f7f\u7528\u4e86\u5927\u91cf\u7684\u5185\u5b58\uff0c\u5bfc\u81f4\u7269\u7406\u673a\u5668\u7684\u53ef\u7528\u5185\u5b58\u4e0d\u8db3\uff1b \u548c Redis \u5b9e\u4f8b\u5728\u540c\u4e00\u53f0\u673a\u5668\u4e0a\u8fd0\u884c\u7684 \u5176\u4ed6\u8fdb\u7a0b\uff0c\u5728\u8fdb\u884c\u5927\u91cf\u7684\u6587\u4ef6\u8bfb\u5199\u64cd\u4f5c \u3002\u6587\u4ef6\u8bfb\u5199\u672c\u8eab\u4f1a\u5360\u7528\u7cfb\u7edf\u5185\u5b58\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u5206\u914d\u7ed9 Redis \u5b9e\u4f8b\u7684\u5185\u5b58\u91cf\u53d8\u5c11\uff0c \u8fdb\u800c\u89e6\u53d1 Redis \u53d1\u751f swap \u3002 \u89e3\u51b3\u601d\u8def\uff1a\u589e\u52a0\u673a\u5668\u7684\u5185\u5b58\u6216\u8005\u4f7f\u7528 Redis \u96c6\u7fa4 \u64cd\u4f5c\u7cfb\u7edf\u672c\u8eab\u4f1a\u5728\u540e\u53f0\u8bb0\u5f55\u6bcf\u4e2a\u8fdb\u7a0b\u7684 swap \u4f7f\u7528\u60c5\u51b5\uff0c\u5373\u6709\u591a\u5c11\u6570\u636e\u91cf\u53d1\u751f\u4e86 swap\u3002\u4f60\u53ef\u4ee5\u5148\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770b Redis \u7684\u8fdb\u7a0b\u53f7\uff0c\u8fd9\u91cc\u662f 5332\u3002 $ redis-cli info | grep process_id process_id: 5332 \u7136\u540e\uff0c\u8fdb\u5165 Redis \u6240\u5728\u673a\u5668\u7684 /proc \u76ee\u5f55\u4e0b\u7684\u8be5\u8fdb\u7a0b\u76ee\u5f55\u4e2d\uff1a $ cd /proc/5332 \u6700\u540e\uff0c\u8fd0\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u67e5\u770b\u8be5 Redis \u8fdb\u7a0b\u7684\u4f7f\u7528\u60c5\u51b5\u3002 $cat smaps | egrep '^(Swap|Size)' Size: 584 kB Swap: 0 kB Size: 4 kB Swap: 4 kB Size: 4 kB Swap: 0 kB Size: 462044 kB Swap: 462008 kB Size: 21392 kB Swap: 0 kB \u6bcf\u4e00\u884c Size \u8868\u793a\u7684\u662f Redis \u5b9e\u4f8b\u6240\u7528\u7684\u4e00\u5757\u5185\u5b58\u5927\u5c0f\uff0c\u800c Size \u4e0b\u65b9\u7684 Swap \u548c\u5b83\u76f8\u5bf9\u5e94\uff0c\u8868\u793a\u8fd9\u5757 Size \u5927\u5c0f\u7684\u5185\u5b58\u533a\u57df\u6709\u591a\u5c11\u5df2\u7ecf\u88ab\u6362\u51fa\u5230\u78c1\u76d8\u4e0a\u4e86\u3002 \u5982\u679c\u8fd9\u4e24\u4e2a\u503c\u76f8\u7b49\uff0c\u5c31\u8868\u793a\u8fd9\u5757\u5185\u5b58\u533a\u57df\u5df2\u7ecf\u5b8c\u5168\u88ab\u6362\u51fa\u5230\u78c1\u76d8\u4e86\u3002 \u4f5c\u4e3a\u5185\u5b58\u6570\u636e\u5e93\uff0cRedis \u672c\u8eab\u4f1a\u4f7f\u7528\u5f88\u591a\u5927\u5c0f\u4e0d\u4e00\u7684\u5185\u5b58\u5757 \uff0c\u6240\u4ee5\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\u6709\u5f88\u591a Size \u884c\uff0c\u6709\u7684\u5f88\u5c0f\uff0c\u5c31\u662f 4KB\uff0c\u800c\u6709\u7684\u5f88\u5927\uff0c\u4f8b\u5982 462044KB\u3002 \u4e0d\u540c\u5185\u5b58\u5757\u88ab\u6362\u51fa\u5230\u78c1\u76d8\u4e0a\u7684\u5927\u5c0f\u4e5f\u4e0d\u4e00\u6837 \uff0c\u4f8b\u5982\u521a\u521a\u7684\u7ed3\u679c\u4e2d\u7684\u7b2c\u4e00\u4e2a 4KB \u5185\u5b58\u5757\uff0c\u5b83\u4e0b\u65b9\u7684 Swap \u4e5f\u662f 4KB\uff0c\u8fd9\u8868\u793a\u8fd9\u4e2a\u5185\u5b58\u5757\u5df2\u7ecf\u88ab\u6362\u51fa\u4e86\uff1b \u53e6\u5916\uff0c462044KB \u8fd9\u4e2a\u5185\u5b58\u5757\u4e5f\u88ab\u6362\u51fa\u4e86 462008KB\uff0c\u5dee\u4e0d\u591a\u6709 462MB\u3002 \u5f53\u51fa\u73b0\u767e MB\uff0c\u751a\u81f3 GB \u7ea7\u522b\u7684 swap \u5927\u5c0f\u65f6\uff0c\u5c31\u8868\u660e\uff0c\u6b64\u65f6\uff0cRedis \u5b9e\u4f8b\u7684\u5185\u5b58\u538b\u529b\u5f88\u5927\uff0c\u5f88\u6709\u53ef\u80fd\u4f1a\u53d8\u6162\u3002\u6240\u4ee5\uff0cswap \u7684\u5927\u5c0f\u662f\u6392\u67e5 Redis \u6027\u80fd\u53d8\u6162\u662f\u5426\u7531 swap \u5f15\u8d77\u7684\u91cd\u8981\u6307\u6807\u3002 \u4e00\u65e6\u53d1\u751f\u5185\u5b58 swap\uff0c \u6700\u76f4\u63a5\u7684\u89e3\u51b3\u65b9\u6cd5\u5c31\u662f\u589e\u52a0\u673a\u5668\u5185\u5b58 \u3002 \u5982\u679c\u8be5\u5b9e\u4f8b\u5728\u4e00\u4e2a Redis \u5207\u7247\u96c6\u7fa4\u4e2d\uff0c\u53ef\u4ee5\u589e\u52a0 Redis \u96c6\u7fa4\u7684\u5b9e\u4f8b\u4e2a\u6570\uff0c\u6765\u5206\u644a\u6bcf\u4e2a\u5b9e\u4f8b\u670d\u52a1\u7684\u6570\u636e\u91cf\uff0c\u8fdb\u800c\u51cf\u5c11\u6bcf\u4e2a\u5b9e\u4f8b\u6240\u9700\u7684\u5185\u5b58\u91cf\u3002 \u5982\u679c Redis \u5b9e\u4f8b\u548c\u5176\u4ed6\u64cd\u4f5c\u5927\u91cf\u6587\u4ef6\u7684\u7a0b\u5e8f\uff08\u4f8b\u5982\u6570\u636e\u5206\u6790\u7a0b\u5e8f\uff09\u5171\u4eab\u673a\u5668\uff0c\u4f60\u53ef\u4ee5\u5c06 Redis \u5b9e\u4f8b\u8fc1\u79fb\u5230\u5355\u72ec\u7684\u673a\u5668\u4e0a\u8fd0\u884c\uff0c\u4ee5\u6ee1\u8db3\u5b83\u7684\u5185\u5b58\u9700\u6c42\u91cf\u3002\u5982\u679c\u8be5\u5b9e\u4f8b\u6b63\u597d\u662f Redis \u4e3b\u4ece\u96c6\u7fa4\u4e2d\u7684\u4e3b\u5e93\uff0c\u800c\u4ece\u5e93\u7684\u5185\u5b58\u5f88\u5927\uff0c\u4e5f\u53ef\u4ee5\u8003\u8651\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u628a\u5927\u5185\u5b58\u7684\u4ece\u5e93\u53d8\u6210\u4e3b\u5e93\uff0c\u7531\u5b83\u6765\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42\u3002 7\u3001\u64cd\u4f5c\u7cfb\u7edf\uff1a\u5185\u5b58\u5927\u9875 \u9664\u4e86\u5185\u5b58 swap\uff0c\u8fd8\u6709\u4e00\u4e2a\u548c\u5185\u5b58\u76f8\u5173\u7684\u56e0\u7d20\uff0c\u5373\u5185\u5b58\u5927\u9875\u673a\u5236\uff08Transparent Huge Page, THP\uff09\uff0c\u4e5f\u4f1a\u5f71\u54cd Redis \u6027\u80fd\u3002 7-1 \u5185\u5b58\u5927\u9875 trade-off Linux \u5185\u6838\u4ece 2.6.38 \u5f00\u59cb\u652f\u6301\u5185\u5b58\u5927\u9875\u673a\u5236\uff0c \u8be5\u673a\u5236\u652f\u6301 2MB \u5927\u5c0f\u7684\u5185\u5b58\u9875\u5206\u914d\uff0c\u800c\u5e38\u89c4\u7684\u5185\u5b58\u9875\u5206\u914d\u662f\u6309 4KB \u7684\u7c92\u5ea6\u6765\u6267\u884c\u7684\u3002 Redis \u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u5185\u5b58\u5927\u9875\u4e0d\u6b63\u597d\u53ef\u4ee5\u6ee1\u8db3 Redis \u7684\u9700\u6c42\u5417\uff1f\u800c\u4e14\u5728\u5206\u914d\u76f8\u540c\u7684\u5185\u5b58\u91cf\u65f6\uff0c\u5185\u5b58\u5927\u9875\u8fd8\u80fd\u51cf\u5c11\u5206\u914d\u6b21\u6570\uff0c\u4e0d\u4e5f\u662f\u5bf9 Redis \u53cb\u597d\u5417? \u5176\u5b9e\uff0c\u7cfb\u7edf\u7684\u8bbe\u8ba1\u901a\u5e38\u662f\u4e00\u4e2a\u53d6\u820d\u8fc7\u7a0b\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a trade-off\u3002\u5f88\u591a\u673a\u5236\u901a\u5e38\u90fd\u662f\u4f18\u52bf\u548c\u52a3\u52bf\u5e76\u5b58\u7684\u3002Redis \u4f7f\u7528\u5185\u5b58\u5927\u9875\u5c31\u662f\u4e00\u4e2a\u5178\u578b\u7684\u4f8b\u5b50\u3002 \u867d\u7136\u5185\u5b58\u5927\u9875\u53ef\u4ee5\u7ed9 Redis \u5e26\u6765\u5185\u5b58\u5206\u914d\u65b9\u9762\u7684\u6536\u76ca\uff0c\u4e0d\u8981\u5fd8\u4e86\uff0cRedis \u4e3a\u4e86\u63d0\u4f9b\u6570\u636e\u53ef\u9760\u6027\u4fdd\u8bc1\uff0c\u9700\u8981\u5c06\u6570\u636e\u505a\u6301\u4e45\u5316\u4fdd\u5b58\u3002 \u8fd9\u4e2a\u5199\u5165\u8fc7\u7a0b\u7531\u989d\u5916\u7684\u7ebf\u7a0b\u6267\u884c\uff0c\u6240\u4ee5\uff0c\u6b64\u65f6\uff0cRedis \u4e3b\u7ebf\u7a0b\u4ecd\u7136\u53ef\u4ee5\u63a5\u6536\u5ba2\u6237\u7aef\u5199\u8bf7\u6c42\u3002\u5ba2\u6237\u7aef\u7684\u5199\u8bf7\u6c42\u53ef\u80fd\u4f1a\u4fee\u6539\u6b63\u5728\u8fdb\u884c\u6301\u4e45\u5316\u7684\u6570\u636e\u3002 \u5728\u8fd9\u4e00\u8fc7\u7a0b\u4e2d\uff0cRedis \u5c31\u4f1a\u91c7\u7528\u5199\u65f6\u590d\u5236\u673a\u5236\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u65e6\u6709\u6570\u636e\u8981\u88ab\u4fee\u6539\uff0cRedis \u5e76\u4e0d\u4f1a\u76f4\u63a5\u4fee\u6539\u5185\u5b58\u4e2d\u7684\u6570\u636e\uff0c \u800c\u662f\u5c06\u8fd9\u4e9b\u6570\u636e\u62f7\u8d1d\u4e00\u4efd\uff0c\u7136\u540e\u518d\u8fdb\u884c\u4fee\u6539 \u3002 \u5982\u679c\u91c7\u7528\u4e86\u5185\u5b58\u5927\u9875\uff0c\u90a3\u4e48\uff0c\u5373\u4f7f\u5ba2\u6237\u7aef\u8bf7\u6c42\u53ea\u4fee\u6539 100B \u7684\u6570\u636e\uff0cRedis \u4e5f\u9700\u8981\u62f7\u8d1d 2MB \u7684\u5927\u9875\u3002\u76f8\u53cd\uff0c\u5982\u679c\u662f\u5e38\u89c4\u5185\u5b58\u9875\u673a\u5236\uff0c\u53ea\u7528\u62f7\u8d1d 4KB \u5f53\u5ba2\u6237\u7aef\u8bf7\u6c42\u4fee\u6539\u6216\u65b0\u5199\u5165\u6570\u636e\u8f83\u591a\u65f6\uff0c\u5185\u5b58\u5927\u9875\u673a\u5236\u5c06\u5bfc\u81f4\u5927\u91cf\u7684\u62f7\u8d1d\uff0c\u8fd9\u5c31\u4f1a\u5f71\u54cd Redis \u6b63\u5e38\u7684\u8bbf\u5b58\u64cd\u4f5c\uff0c\u6700\u7ec8\u5bfc\u81f4\u6027\u80fd\u53d8\u6162\u3002 7-2 \u5173\u95ed\u5185\u5b58\u5927\u9875 \u9996\u5148\uff0c\u6211\u4eec\u8981\u5148\u6392\u67e5\u4e0b\u5185\u5b58\u5927\u9875\u3002\u65b9\u6cd5\u662f\uff1a\u5728 Redis \u5b9e\u4f8b\u8fd0\u884c\u7684\u673a\u5668\u4e0a\u6267\u884c\u5982\u4e0b\u547d\u4ee4: cat /sys/kernel/mm/transparent_hugepage/enabled \u5982\u679c\u6267\u884c\u7ed3\u679c\u662f always\uff0c\u5c31\u8868\u660e\u5185\u5b58\u5927\u9875\u673a\u5236\u88ab\u542f\u52a8\u4e86\uff1b\u5982\u679c\u662f never\uff0c\u5c31\u8868\u793a\uff0c\u5185\u5b58\u5927\u9875\u673a\u5236\u88ab\u7981\u6b62\u3002 \u5728\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e2d\u90e8\u7f72\u65f6\uff0c\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528\u5185\u5b58\u5927\u9875\u673a\u5236\uff0c\u64cd\u4f5c\u4e5f\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u8981\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u5c31\u53ef\u4ee5\u4e86 \uff1a echo never > /sys/kernel/mm/transparent_hugepage/enabled \u672c\u8282\u5c0f\u7ed3 \u5224\u65ad Redis \u53d8\u6162\u7684\u65b9\u6cd5\uff0c \u4e00\u4e2a\u662f\u770b\u54cd\u5e94\u5ef6\u8fdf\uff0c\u4e00\u4e2a\u662f\u770b\u57fa\u7ebf\u6027\u80fd \u3002\u540c\u65f6\uff0c\u6211\u8fd8\u7ed9\u4e86\u4f60\u4e24\u79cd\u6392\u67e5\u548c\u89e3\u51b3 Redis \u53d8\u6162\u8fd9\u4e2a\u95ee\u9898\u7684\u65b9\u6cd5\uff1a \u4ece\u6162\u67e5\u8be2\u547d\u4ee4\u5f00\u59cb\u6392\u67e5\uff0c\u5e76\u4e14\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u66ff\u6362\u6162\u67e5\u8be2\u547d\u4ee4 \uff1b \u6392\u67e5\u8fc7\u671f key \u7684\u65f6\u95f4\u8bbe\u7f6e\uff0c\u5e76\u6839\u636e\u5b9e\u9645\u4f7f\u7528\u9700\u6c42\uff0c\u8bbe\u7f6e\u4e0d\u540c\u7684\u8fc7\u671f\u65f6\u95f4 \u3002 9 \u4e2a\u68c0\u67e5\u70b9\u7684 Checklist\uff0c\u5e0c\u671b\u4f60\u5728\u9047\u5230 Redis \u6027\u80fd\u53d8\u6162\u65f6\uff0c\u6309\u7167\u8fd9\u4e9b\u6b65\u9aa4\u9010\u4e00\u68c0\u67e5\uff0c\u9ad8\u6548\u5730\u89e3\u51b3\u95ee\u9898: \u83b7\u53d6 Redis \u5b9e\u4f8b\u5728\u5f53\u524d\u73af\u5883\u4e0b\u7684\u57fa\u7ebf\u6027\u80fd\u3002 \u662f\u5426\u7528\u4e86\u6162\u67e5\u8be2\u547d\u4ee4\uff1f\u5982\u679c\u662f\u7684\u8bdd\uff0c\u5c31\u4f7f\u7528\u5176\u4ed6\u547d\u4ee4\u66ff\u4ee3\u6162\u67e5\u8be2\u547d\u4ee4\uff0c\u6216\u8005\u628a\u805a\u5408\u8ba1\u7b97\u547d\u4ee4\u653e\u5728\u5ba2\u6237\u7aef\u505a\u3002 \u662f\u5426\u5bf9\u8fc7\u671f key \u8bbe\u7f6e\u4e86\u76f8\u540c\u7684\u8fc7\u671f\u65f6\u95f4\uff1f \u5bf9\u4e8e\u6279\u91cf\u5220\u9664\u7684 key\uff0c\u53ef\u4ee5\u5728\u6bcf\u4e2a key \u7684\u8fc7\u671f\u65f6\u95f4\u4e0a\u52a0\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u907f\u514d\u540c\u65f6\u5220\u9664 \u3002 \u662f\u5426\u5b58\u5728 bigkey\uff1f \u5bf9\u4e8e bigkey \u7684\u5220\u9664\u64cd\u4f5c\uff0c\u5982\u679c\u4f60\u7684 Redis \u662f 4.0 \u53ca\u4ee5\u4e0a\u7684\u7248\u672c\uff0c\u53ef\u4ee5\u76f4\u63a5\u5229\u7528\u5f02\u6b65\u7ebf\u7a0b\u673a\u5236\u51cf\u5c11\u4e3b\u7ebf\u7a0b\u963b\u585e\uff1b\u5982\u679c\u662f Redis 4.0 \u4ee5\u524d\u7684\u7248\u672c\uff0c \u53ef\u4ee5\u4f7f\u7528 SCAN \u547d\u4ee4\u8fed\u4ee3\u5220\u9664\uff1b\u5bf9\u4e8e bigkey \u7684\u96c6\u5408\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4f7f\u7528 SCAN \u547d\u4ee4\u5728\u5ba2\u6237\u7aef\u5b8c\u6210 \u3002 Redis AOF \u914d\u7f6e\u7ea7\u522b\u662f\u4ec0\u4e48\uff1f\u4e1a\u52a1\u5c42\u9762\u662f\u5426\u7684\u786e\u9700\u8981\u8fd9\u4e00\u53ef\u9760\u6027\u7ea7\u522b\uff1f\u5982\u679c\u6211\u4eec\u9700\u8981\u9ad8\u6027\u80fd\uff0c\u540c\u65f6\u4e5f\u5141\u8bb8\u6570\u636e\u4e22\u5931\uff0c \u53ef\u4ee5\u5c06\u914d\u7f6e\u9879 no-appendfsync-on-rewrite \u8bbe\u7f6e\u4e3a yes \uff0c \u907f\u514d AOF \u91cd\u5199\u548c fsync \u7ade\u4e89\u78c1\u76d8 IO \u8d44\u6e90\uff0c\u5bfc\u81f4 Redis \u5ef6\u8fdf\u589e\u52a0 \u3002\u5f53\u7136\uff0c \u5982\u679c\u65e2\u9700\u8981\u9ad8\u6027\u80fd\u53c8\u9700\u8981\u9ad8\u53ef\u9760\u6027\uff0c\u6700\u597d\u4f7f\u7528\u9ad8\u901f\u56fa\u6001\u76d8\u4f5c\u4e3a AOF \u65e5\u5fd7\u7684\u5199\u5165\u76d8\u3002 Redis \u5b9e\u4f8b\u7684\u5185\u5b58\u4f7f\u7528\u662f\u5426\u8fc7\u5927\uff1f\u53d1\u751f swap \u4e86\u5417\uff1f\u5982\u679c\u662f\u7684\u8bdd\uff0c\u5c31\u589e\u52a0\u673a\u5668\u5185\u5b58\uff0c\u6216\u8005\u662f\u4f7f\u7528 Redis \u96c6\u7fa4\uff0c\u5206\u644a\u5355\u673a Redis \u7684\u952e\u503c\u5bf9\u6570\u91cf\u548c\u5185\u5b58\u538b\u529b\u3002\u540c\u65f6\uff0c\u8981\u907f\u514d\u51fa\u73b0 Redis \u548c\u5176\u4ed6\u5185\u5b58\u9700\u6c42\u5927\u7684\u5e94\u7528\u5171\u4eab\u673a\u5668\u7684\u60c5\u51b5\u3002 \u5728 Redis \u5b9e\u4f8b\u7684\u8fd0\u884c\u73af\u5883\u4e2d\uff0c\u662f\u5426\u542f\u7528\u4e86\u900f\u660e\u5927\u9875\u673a\u5236\uff1f\u5982\u679c\u662f\u7684\u8bdd\uff0c\u76f4\u63a5\u5173\u95ed\u5185\u5b58\u5927\u9875\u673a\u5236\u5c31\u884c\u4e86\u3002 \u662f\u5426\u8fd0\u884c\u4e86 Redis \u4e3b\u4ece\u96c6\u7fa4\uff1f\u5982\u679c\u662f\u7684\u8bdd\uff0c\u628a\u4e3b\u5e93\u5b9e\u4f8b\u7684\u6570\u636e\u91cf\u5927\u5c0f\u63a7\u5236\u5728 2~4GB\uff0c\u4ee5\u514d\u4e3b\u4ece\u590d\u5236\u65f6\uff0c\u4ece\u5e93\u56e0\u52a0\u8f7d\u5927\u7684 RDB \u6587\u4ef6\u800c\u963b\u585e\u3002 \u662f\u5426\u4f7f\u7528\u4e86\u591a\u6838 CPU \u6216 NUMA \u67b6\u6784\u7684\u673a\u5668\u8fd0\u884c Redis \u5b9e\u4f8b\uff1f\u4f7f\u7528\u591a\u6838 CPU \u65f6\uff0c\u53ef\u4ee5\u7ed9 Redis \u5b9e\u4f8b\u7ed1\u5b9a\u7269\u7406\u6838\uff1b\u4f7f\u7528 NUMA \u67b6\u6784\u65f6\uff0c\u6ce8\u610f\u628a Redis \u5b9e\u4f8b\u548c\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u8fd0\u884c\u5728\u540c\u4e00\u4e2a CPU Socket \u4e0a\u3002 \u4ed4\u7ec6\u68c0\u67e5\u4e0b\u6709\u6ca1\u6709\u607c\u4eba\u7684\u201c\u90bb\u5c45\u201d\uff0c\u5177\u4f53\u70b9\u8bf4\uff0c\u5c31\u662f Redis \u6240\u5728\u7684\u673a\u5668\u4e0a\u6709\u6ca1\u6709\u4e00\u4e9b\u5176\u4ed6\u5360\u5185\u5b58\u3001\u78c1\u76d8 IO \u548c\u7f51\u7edc IO \u7684\u7a0b\u5e8f\uff0c\u6bd4\u5982\u8bf4\u6570\u636e\u5e93\u7a0b\u5e8f\u6216\u8005\u6570\u636e\u91c7\u96c6\u7a0b\u5e8f\u3002 \u5982\u679c\u6709\u7684\u8bdd\uff0c\u6211\u5efa\u8bae\u4f60\u5c06\u8fd9\u4e9b\u7a0b\u5e8f\u8fc1\u79fb\u5230\u5176\u4ed6\u673a\u5668\u4e0a\u8fd0\u884c\u3002 \u5206\u6790\u3001\u6392\u67e5\u3001\u89e3\u51b3Redis\u53d8\u6162\u95ee\u9898 \u4f7f\u7528\u590d\u6742\u5ea6\u8fc7\u9ad8\u7684\u547d\u4ee4\uff08\u4f8b\u5982SORT/SUION/ZUNIONSTORE/KEYS\uff09\uff0c\u6216\u4e00\u6b21\u67e5\u8be2\u5168\u91cf\u6570\u636e\uff08\u4f8b\u5982LRANGE key 0 N\uff0c\u4f46N\u5f88\u5927\uff09 \u5206\u6790\uff1a a) \u67e5\u770bslowlog\u662f\u5426\u5b58\u5728\u8fd9\u4e9b\u547d\u4ee4 b) Redis\u8fdb\u7a0bCPU\u4f7f\u7528\u7387\u662f\u5426\u98d9\u5347\uff08\u805a\u5408\u8fd0\u7b97\u547d\u4ee4\u5bfc\u81f4\uff09 \u89e3\u51b3\uff1a a) \u4e0d\u4f7f\u7528\u590d\u6742\u5ea6\u8fc7\u9ad8\u7684\u547d\u4ee4\uff0c\u6216\u7528\u5176\u4ed6\u65b9\u5f0f\u4ee3\u66ff\u5b9e\u73b0\uff08\u653e\u5728\u5ba2\u6237\u7aef\u505a\uff09 b) \u6570\u636e\u5c3d\u91cf\u5206\u6279\u67e5\u8be2\uff08LRANGE key 0 N\uff0c\u5efa\u8baeN<=100\uff0c\u67e5\u8be2\u5168\u91cf\u6570\u636e\u5efa\u8bae\u4f7f\u7528HSCAN/SSCAN/ZSCAN\uff09 \u64cd\u4f5cbigkey \u5206\u6790\uff1a a) slowlog \u51fa\u73b0\u5f88\u591a SET/DELETE \u53d8\u6162\u547d\u4ee4\uff08bigkey\u5206\u914d\u5185\u5b58\u548c\u91ca\u653e\u5185\u5b58\u53d8\u6162\uff09 b) \u4f7f\u7528 redis-cli -h $host -p $port --bigkeys \u626b\u63cf\u51fa\u5f88\u591a bigkey \u89e3\u51b3\uff1a a) \u4f18\u5316\u4e1a\u52a1\uff0c\u907f\u514d\u5b58\u50a8bigkey b) Redis 4.0+\u53ef\u5f00\u542f lazy-free \u673a\u5236 \u5927\u91cfkey\u96c6\u4e2d\u8fc7\u671f \u5206\u6790\uff1a a) \u4e1a\u52a1\u4f7f\u7528EXPIREAT/PEXPIREAT\u547d\u4ee4 b) Redis info\u4e2d\u7684 expired_keys \u6307\u6807\u77ed\u671f\u7a81\u589e \u89e3\u51b3\uff1a a) \u4f18\u5316\u4e1a\u52a1\uff0c\u8fc7\u671f\u589e\u52a0\u968f\u673a\u65f6\u95f4\uff0c\u628a\u65f6\u95f4\u6253\u6563\uff0c\u51cf\u8f7b\u5220\u9664\u8fc7\u671fkey\u7684\u538b\u529b b) \u8fd0\u7ef4\u5c42\u9762\uff0c\u76d1\u63a7 expired_keys \u6307\u6807\uff0c\u6709\u77ed\u671f\u7a81\u589e\u53ca\u65f6\u62a5\u8b66\u6392\u67e5 Redis\u5185\u5b58\u8fbe\u5230maxmemory \u5206\u6790\uff1a a) \u5b9e\u4f8b\u5185\u5b58\u8fbe\u5230maxmemory\uff0c\u4e14\u5199\u5165\u91cf\u5927\uff0c\u6dd8\u6c70key\u538b\u529b\u53d8\u5927 b) Redis info\u4e2d\u7684 evicted_keys \u6307\u6807\u77ed\u671f\u7a81\u589e \u89e3\u51b3\uff1a a) \u4e1a\u52a1\u5c42\u9762\uff0c\u6839\u636e\u60c5\u51b5\u8c03\u6574\u6dd8\u6c70\u7b56\u7565\uff08\u968f\u673a\u6bd4LRU\u5feb\uff09 b) \u8fd0\u7ef4\u5c42\u9762\uff0c\u76d1\u63a7evicted_keys\u6307\u6807\uff0c\u6709\u77ed\u671f\u7a81\u589e\u53ca\u65f6\u62a5\u8b66 c) \u96c6\u7fa4\u6269\u5bb9\uff0c\u591a\u4e2a\u5b9e\u4f8b\u51cf\u8f7b\u6dd8\u6c70key\u7684\u538b\u529b \u5927\u91cf\u77ed\u8fde\u63a5\u8bf7\u6c42 \u5206\u6790\uff1aRedis\u5904\u7406\u5927\u91cf\u77ed\u8fde\u63a5\u8bf7\u6c42\uff0cTCP\u4e09\u6b21\u63e1\u624b\u548c\u56db\u6b21\u6325\u624b\u4e5f\u4f1a\u589e\u52a0\u8017\u65f6 \u89e3\u51b3\uff1a\u4f7f\u7528\u957f\u8fde\u63a5\u64cd\u4f5cRedis \u751f\u6210RDB\u548cAOF\u91cd\u5199fork\u8017\u65f6\u4e25\u91cd \u5206\u6790\uff1a a) Redis\u53d8\u6162\u53ea\u53d1\u751f\u5728\u751f\u6210RDB\u548cAOF\u91cd\u5199\u671f\u95f4 b) \u5b9e\u4f8b\u5360\u7528\u5185\u5b58\u8d8a\u5927\uff0cfork\u62f7\u8d1d\u5185\u5b58\u9875\u8868\u8d8a\u4e45 c) Redis info\u4e2d latest_fork_usec \u8017\u65f6\u53d8\u957f \u89e3\u51b3\uff1a a) \u5b9e\u4f8b\u5c3d\u91cf\u5c0f b) Redis\u5c3d\u91cf\u90e8\u7f72\u5728\u7269\u7406\u673a\u4e0a c) \u4f18\u5316\u5907\u4efd\u7b56\u7565\uff08\u4f8b\u5982\u4f4e\u5cf0\u671f\u5907\u4efd\uff09 d) \u5408\u7406\u914d\u7f6e repl-backlog \u548c slave client-output-buffer-limit \uff0c\u907f\u514d\u4e3b\u4ece\u5168\u91cf\u540c\u6b65 e) \u89c6\u60c5\u51b5\u8003\u8651\u5173\u95edAOF f) \u76d1\u63a7 latest_fork_usec \u8017\u65f6\u662f\u5426\u53d8\u957f AOF\u4f7f\u7528 awalys \u673a\u5236 \u5206\u6790\uff1a\u78c1\u76d8IO\u8d1f\u8f7d\u53d8\u9ad8 \u89e3\u51b3\uff1a a) \u4f7f\u7528everysec\u673a\u5236 b) \u4e22\u5931\u6570\u636e\u4e0d\u654f\u611f\u7684\u4e1a\u52a1\u4e0d\u5f00\u542fAOF \u4f7f\u7528Swap \u5206\u6790\uff1a a) \u6240\u6709\u8bf7\u6c42\u5168\u90e8\u5f00\u59cb\u53d8\u6162 b) slowlog\u5927\u91cf\u6162\u65e5\u5fd7 c) \u67e5\u770bRedis\u8fdb\u7a0b\u662f\u5426\u4f7f\u7528\u5230\u4e86Swap \u89e3\u51b3\uff1a a) \u589e\u52a0\u673a\u5668\u5185\u5b58 b) \u96c6\u7fa4\u6269\u5bb9 c) Swap\u4f7f\u7528\u65f6\u76d1\u63a7\u62a5\u8b66 \u8fdb\u7a0b\u7ed1\u5b9aCPU\u4e0d\u5408\u7406 \u5206\u6790 a) Redis\u8fdb\u7a0b\u53ea\u7ed1\u5b9a\u4e00\u4e2aCPU\u903b\u8f91\u6838 b) NUMA\u67b6\u6784\u4e0b\uff0c\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u548cRedis\u8fdb\u7a0b\u6ca1\u6709\u7ed1\u5b9a\u5728\u540c\u4e00\u4e2aSocket\u4e0b \u89e3\u51b3 a) Redis\u8fdb\u7a0b\u7ed1\u5b9a\u591a\u4e2aCPU\u903b\u8f91\u6838 b) \u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u548cRedis\u8fdb\u7a0b\u7ed1\u5b9a\u5728\u540c\u4e00\u4e2aSocket\u4e0b \u5f00\u542f\u900f\u660e\u5927\u9875\u673a\u5236 \u5206\u6790\uff1a\u751f\u6210RDB\u548cAOF\u91cd\u5199\u671f\u95f4\uff0c\u4e3b\u7ebf\u7a0b\u5904\u7406\u5199\u8bf7\u6c42\u8017\u65f6\u53d8\u957f\uff08\u62f7\u8d1d\u5185\u5b58\u526f\u672c\u8017\u65f6\u53d8\u957f\uff09 \u89e3\u51b3\uff1a\u5173\u95ed\u900f\u660e\u5927\u9875\u673a\u5236 \u7f51\u5361\u8d1f\u8f7d\u8fc7\u9ad8 \u5206\u6790\uff1a a) TCP/IP\u5c42\u5ef6\u8fdf\u53d8\u5927\uff0c\u4e22\u5305\u91cd\u4f20\u53d8\u591a b) \u662f\u5426\u5b58\u5728\u6d41\u91cf\u8fc7\u5927\u7684\u5b9e\u4f8b\u5360\u6ee1\u5e26\u5bbd \u89e3\u51b3\uff1a a) \u673a\u5668\u7f51\u7edc\u8d44\u6e90\u76d1\u63a7\uff0c\u8d1f\u8f7d\u8fc7\u9ad8\u53ca\u65f6\u62a5\u8b66 b) \u63d0\u524d\u89c4\u5212\u90e8\u7f72\u7b56\u7565\uff0c\u8bbf\u95ee\u91cf\u5927\u7684\u5b9e\u4f8b\u9694\u79bb\u90e8\u7f72 \u603b\u4e4b\uff0cRedis\u7684\u6027\u80fd\u4e0eCPU\u3001\u5185\u5b58\u3001\u7f51\u7edc\u3001\u78c1\u76d8\u90fd\u606f\u606f\u76f8\u5173\uff0c\u4efb\u4f55\u4e00\u5904\u53d1\u751f\u95ee\u9898\uff0c\u90fd\u4f1a\u5f71\u54cd\u5230Redis\u7684\u6027\u80fd\u3002 \u8981\u70b9&\u4eae\u70b9 \u901a\u8fc7 redis-cli --intrinsic-latency 120 \u53ef\u4ee5\u5f97\u77e5redis\u7684\u57fa\u51c6\u7ebf\u3002\u540e\u7eed\u53ef\u4ee5\u6839\u636e\u57fa\u51c6\u7ebf\u7684\u54cd\u5e94\u901f\u5ea6\u8fdb\u884c\u5224\u65ad\u662f\u5426\u67e5\u8be2\u6162 \u57fa\u4e8e\u81ea\u5df1\u5bf9 Redis \u672c\u8eab\u7684\u5de5\u4f5c\u539f\u7406\u7684\u7406\u89e3\uff0c\u5e76\u4e14\u7ed3\u5408\u548c\u5b83\u4ea4\u4e92\u7684\u64cd\u4f5c\u7cfb\u7edf\u3001\u5b58\u50a8\u4ee5\u53ca\u7f51\u7edc\u7b49\u5916\u90e8\u7cfb\u7edf\u5173\u952e\u673a\u5236\uff0c\u518d\u501f\u52a9\u4e00\u4e9b\u8f85\u52a9\u5de5\u5177\u6765\u5b9a\u4f4d\u539f\u56e0\uff0c\u5e76\u5236\u5b9a\u884c\u4e4b\u6709\u6548\u7684\u89e3\u51b3\u65b9\u6848 Redis \u81ea\u8eab\u64cd\u4f5c\u7279\u6027\u7684\u5f71\u54cd \u6162\u67e5\u8be2\u547d\u4ee4\uff1a\u547d\u4ee4\u64cd\u4f5c\u7684\u590d\u6742\u5ea6\u6709\u5173 \u6392\u67e5\u65b9\u6cd5\uff1a\u901a\u8fc7 Redis \u65e5\u5fd7\uff0c\u6216\u8005\u662f latency monitor \u5de5\u5177\uff0c\u67e5\u8be2\u53d8\u6162\u7684\u8bf7\u6c42 \u89e3\u51b3\u65b9\u6cd5\uff1a \u7528\u5176\u4ed6\u9ad8\u6548\u547d\u4ee4\u4ee3\u66ff\u3002\u5982\u4e0d\u8981\u4f7f\u7528keys\u67e5\u8be2\u6240\u6709key\uff0c\u53ef\u4ee5\u4f7f\u7528scan\u8fdb\u884c\u67e5\u8be2\uff0c\u4e0d\u4f1a\u963b\u585e\u7ebf\u7a0b \u5f53\u4f60\u9700\u8981\u6267\u884c\u6392\u5e8f\u3001\u4ea4\u96c6\u3001\u5e76\u96c6\u64cd\u4f5c\u65f6\uff0c\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u5b8c\u6210\uff0c\u800c\u4e0d\u8981\u7528 SORT\u3001SUNION\u3001SINTER \u8fd9\u4e9b\u547d\u4ee4\uff0c\u4ee5\u514d\u62d6\u6162 Redis \u5b9e\u4f8b\u3002 \u8fc7\u671f key \u64cd\u4f5c\uff1aredis\u672c\u8eab\u7684\u5185\u5b58\u56de\u6536\u673a\u5236\u4f1a\u9020\u6210redis\u64cd\u4f5c\u963b\u585e\uff0c\u5bfc\u81f4\u6027\u80fd\u53d8\u6162\uff08Redis 4.0 \u540e\u53ef\u4ee5\u7528\u5f02\u6b65\u7ebf\u7a0b\u673a\u5236\u6765\u51cf\u5c11\u963b\u585e\u5f71\u54cd\uff09 \u5bfc\u81f4\u539f\u56e0\uff1a\u5927\u6279\u91cf\u7684key\u540c\u65f6\u95f4\u5185\u8fc7\u671f\uff0c\u5bfc\u81f4\u5220\u9664\u8fc7\u671fkey\u7684\u673a\u5236\u4e00\u76f4\u89e6\u53d1\uff0c\u5f15\u8d77redis\u64cd\u4f5c\u963b\u585e \u89e3\u51b3\u65b9\u6cd5\uff1a\u5bf9key\u8bbe\u5b9a\u8fc7\u671f\u65f6\u95f4\u65f6\uff0c\u6dfb\u52a0\u4e00\u4e2a\u5220\u9664\u7684\u65f6\u95f4\u968f\u673a\u6570\uff0c\u80fd\u907f\u514dkey\u5b58\u5728\u540c\u4e00\u65f6\u95f4\u8fc7\u671f redis\u5220\u9664\u8fc7\u671fkey\u7684\u673a\u5236\uff0c\u6bcf100\u6beb\u79d2\u5bf9\u4e00\u4e9bkey\u8fdb\u884c\u5220\u9664\u3002\u7b97\u6cd5\u5982\u4e0b \u91c7\u6837 ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP \u4e2a\u6570\u7684 key\uff0c\u5e76\u5c06\u5176\u4e2d\u8fc7\u671f\u7684 key \u5168\u90e8\u5220\u9664\uff1b \u679c\u8d85\u8fc7 25% \u7684 key \u8fc7\u671f\u4e86\uff0c\u5219\u91cd\u590d\u5220\u9664\u7684\u8fc7\u7a0b\uff0c\u76f4\u5230\u8fc7\u671f key \u7684\u6bd4\u4f8b\u964d\u81f3 25% \u4ee5\u4e0b\u3002","title":"\u7b2c\u4e09\u8282 \u5f53redis\u67e5\u8be2\u53d8\u6162\u4e86\u600e\u4e48\u529e\uff1f"},{"location":"chap4/3redis_response/#redis","text":"\u5728\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e2d\uff0cRedis \u5f80\u5f80\u662f\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u7684\u4e00\u4e2a\u73af\u8282\uff08\u4f8b\u5982\u4f5c\u4e3a\u7f13\u5b58\u6216\u662f\u4f5c\u4e3a\u6570\u636e\u5e93\uff09\u3002\u4e00\u65e6 Redis \u4e0a\u7684\u8bf7\u6c42\u5ef6\u8fdf\u589e\u52a0\uff0c\u5c31\u53ef\u80fd\u5f15\u8d77\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u7684\u4e00\u4e32\u513f\u201c\u8fde\u9501\u53cd\u5e94\u201d\u3002 \u5e94\u7528\u670d\u52a1\u5668\uff08App Server\uff09\u8981\u5b8c\u6210\u4e00\u4e2a\u4e8b\u52a1\u6027\u64cd\u4f5c\uff0c \u5305\u62ec\u5728 MySQL \u4e0a\u6267\u884c\u4e00\u4e2a\u5199\u4e8b\u52a1\uff0c\u5728 Redis \u4e0a\u63d2\u5165\u4e00\u4e2a\u6807\u8bb0\u4f4d\uff0c\u5e76\u901a\u8fc7\u4e00\u4e2a\u7b2c\u4e09\u65b9\u670d\u52a1\u7ed9\u7528\u6237\u53d1\u9001\u4e00\u6761\u5b8c\u6210\u6d88\u606f \u3002 \u8fd9\u4e09\u4e2a\u64cd\u4f5c\u90fd\u9700\u8981\u4fdd\u8bc1\u4e8b\u52a1\u539f\u5b50\u6027\uff0c\u6240\u4ee5\uff0c\u5982\u679c\u6b64\u65f6 Redis \u7684\u5ef6\u8fdf\u589e\u52a0\uff0c\u5c31\u4f1a\u62d6\u7d2f App Server \u7aef\u6574\u4e2a\u4e8b\u52a1\u7684\u6267\u884c\u3002 \u8fd9\u4e2a\u4e8b\u52a1\u4e00\u76f4\u5b8c\u6210\u4e0d\u4e86\uff0c\u53c8\u4f1a\u5bfc\u81f4 MySQL \u4e0a\u5199\u4e8b\u52a1\u5360\u7528\u7684\u8d44\u6e90\u65e0\u6cd5\u91ca\u653e\uff0c\u8fdb\u800c\u5bfc\u81f4\u8bbf\u95ee MySQL \u7684\u5176\u4ed6\u8bf7\u6c42\u88ab\u963b\u585e\u3002 \u5f88\u660e\u663e\uff0cRedis \u53d8\u6162\u4f1a\u5e26\u6765\u4e25\u91cd\u7684\u8fde\u9501\u53cd\u5e94\u3002","title":"\u7b2c\u4e09\u8282 \u5f53redis\u67e5\u8be2\u53d8\u6162\u4e86\u600e\u4e48\u529e\uff1f"},{"location":"chap4/3redis_response/#1redis","text":"\u4e00\u4e2a\u6700\u76f4\u63a5\u7684\u65b9\u6cd5\uff0c\u5c31\u662f \u67e5\u770b Redis \u7684\u54cd\u5e94\u5ef6\u8fdf\u3002 \u5927\u90e8\u5206\u65f6\u5019\uff0cRedis \u5ef6\u8fdf\u5f88\u4f4e\uff0c\u4f46\u662f\u5728\u67d0\u4e9b\u65f6\u523b\uff0c\u6709\u4e9b Redis \u5b9e\u4f8b\u4f1a\u51fa\u73b0\u5f88\u9ad8\u7684\u54cd\u5e94\u5ef6\u8fdf\uff0c \u751a\u81f3\u80fd\u8fbe\u5230\u51e0\u79d2\u5230\u5341\u51e0\u79d2\uff0c\u4e0d\u8fc7\u6301\u7eed\u65f6\u95f4\u4e0d\u957f\uff0c\u8fd9\u4e5f\u53eb\u5ef6\u8fdf\u201c\u6bdb\u523a\u201d \u3002 \u5f53\u4f60\u53d1\u73b0 Redis \u547d\u4ee4\u7684\u6267\u884c\u65f6\u95f4\u7a81\u7136\u5c31\u589e\u957f\u5230\u4e86\u51e0\u79d2\uff0c\u57fa\u672c\u5c31\u53ef\u4ee5\u8ba4\u5b9a Redis \u53d8\u6162\u4e86\u3002 \u5927\u90e8\u5206\u65f6\u5019\uff0cRedis \u5ef6\u8fdf\u5f88\u4f4e\uff0c\u4f46\u662f\u5728\u67d0\u4e9b\u65f6\u523b\uff0c\u6709\u4e9b Redis \u5b9e\u4f8b\u4f1a\u51fa\u73b0\u5f88\u9ad8\u7684\u54cd\u5e94\u5ef6\u8fdf\uff0c\u751a\u81f3\u80fd\u8fbe\u5230\u51e0\u79d2\u5230\u5341\u51e0\u79d2\uff0c\u4e0d\u8fc7\u6301\u7eed\u65f6\u95f4\u4e0d\u957f\uff0c\u8fd9\u4e5f\u53eb\u5ef6\u8fdf\u201c\u6bdb\u523a\u201d\u3002\u5f53\u4f60\u53d1\u73b0 Redis \u547d\u4ee4\u7684\u6267\u884c\u65f6\u95f4\u7a81\u7136\u5c31\u589e\u957f\u5230\u4e86\u51e0\u79d2\uff0c\u57fa\u672c\u5c31\u53ef\u4ee5\u8ba4\u5b9a Redis \u53d8\u6162\u4e86\u3002 \u8fd9\u79cd\u65b9\u6cd5\u662f\u770b Redis \u5ef6\u8fdf\u7684\u7edd\u5bf9\u503c\uff0c\u4f46\u662f\uff0c\u5728\u4e0d\u540c\u7684\u8f6f\u786c\u4ef6\u73af\u5883\u4e0b\uff0cRedis \u672c\u8eab\u7684\u7edd\u5bf9\u6027\u80fd\u5e76\u4e0d\u76f8\u540c\u3002 \u6bd4\u5982\uff0c\u5728\u6211\u7684\u73af\u5883\u4e2d\uff0c\u5f53\u5ef6\u8fdf\u4e3a 1ms \u65f6\uff0c\u6211\u5224\u5b9a Redis \u53d8\u6162\u4e86\uff0c\u4f46\u662f\u4f60\u7684\u786c\u4ef6\u914d\u7f6e\u9ad8\uff0c\u90a3\u4e48\uff0c\u5728\u4f60\u7684\u8fd0\u884c\u73af\u5883\u4e0b\uff0c\u53ef\u80fd\u5ef6\u8fdf\u662f 0.2ms \u7684\u65f6\u5019\uff0c\u4f60\u5c31\u53ef\u4ee5\u8ba4\u5b9a Redis \u53d8\u6162\u4e86\u3002","title":"1\u3001Redis \u771f\u7684\u53d8\u6162\u4e86\u5417\uff1f"},{"location":"chap4/3redis_response/#1-1","text":"\u57fa\u4e8e\u5f53\u524d\u73af\u5883\u4e0b\u7684 Redis \u57fa\u7ebf\u6027\u80fd\u505a\u5224\u65ad \u6240\u8c13\u7684\u57fa\u7ebf\u6027\u80fd\u5462\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u7cfb\u7edf\u5728\u4f4e\u538b\u529b\u3001\u65e0\u5e72\u6270\u4e0b\u7684\u57fa\u672c\u6027\u80fd\uff0c\u8fd9\u4e2a\u6027\u80fd\u53ea\u7531\u5f53\u524d\u7684\u8f6f\u786c\u4ef6\u914d\u7f6e\u51b3\u5b9a\u3002 \u5b9e\u9645\u4e0a\uff0c\u4ece 2.8.7 \u7248\u672c\u5f00\u59cb\uff0c redis-cli \u547d\u4ee4\u63d0\u4f9b\u4e86 \u2013intrinsic-latency \u9009\u9879\uff0c\u53ef\u4ee5\u7528\u6765\u76d1\u6d4b\u548c\u7edf\u8ba1\u6d4b\u8bd5\u671f\u95f4\u5185\u7684\u6700\u5927\u5ef6\u8fdf\uff0c\u8fd9\u4e2a\u5ef6\u8fdf\u53ef\u4ee5\u4f5c\u4e3a Redis \u7684\u57fa\u7ebf\u6027\u80fd\u3002\u5176\u4e2d\uff0c\u6d4b\u8bd5\u65f6\u957f\u53ef\u4ee5\u7528 \u2013intrinsic-latency \u9009\u9879\u7684\u53c2\u6570\u6765\u6307\u5b9a\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u8fd0\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u8be5\u547d\u4ee4\u4f1a\u6253\u5370 120 \u79d2\u5185\u76d1\u6d4b\u5230\u7684\u6700\u5927\u5ef6\u8fdf\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u7684\u6700\u5927\u5ef6\u8fdf\u662f 119 \u5fae\u79d2\uff0c\u4e5f\u5c31\u662f\u57fa\u7ebf\u6027\u80fd\u4e3a 119 \u5fae\u79d2\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd0\u884c 120 \u79d2\u5c31\u8db3\u591f\u76d1\u6d4b\u5230\u6700\u5927\u5ef6\u8fdf\u4e86\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u53c2\u6570\u8bbe\u7f6e\u4e3a 120\u3002 ./redis-cli --intrinsic-latency 120 Max latency so far: 17 microseconds. Max latency so far: 44 microseconds. Max latency so far: 94 microseconds. Max latency so far: 110 microseconds. Max latency so far: 119 microseconds. 36481658 total runs (avg latency: 3.2893 microseconds / 3289.32 nanoseconds per run). Worst run took 36x longer than the average latency. \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u57fa\u7ebf\u6027\u80fd\u548c\u5f53\u524d\u7684\u64cd\u4f5c\u7cfb\u7edf\u3001\u786c\u4ef6\u914d\u7f6e\u76f8\u5173\u3002 \u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u548c Redis \u8fd0\u884c\u65f6\u7684\u5ef6\u8fdf\u7ed3\u5408\u8d77\u6765\uff0c\u518d\u8fdb\u4e00\u6b65\u5224\u65ad Redis \u6027\u80fd\u662f\u5426\u53d8\u6162\u4e86 \u3002 \u4e00\u822c\u6765\u8bf4\uff0c\u4f60\u8981\u628a\u8fd0\u884c\u65f6\u5ef6\u8fdf\u548c\u57fa\u7ebf\u6027\u80fd\u8fdb\u884c\u5bf9\u6bd4\uff0c\u5982\u679c\u4f60\u89c2\u5bdf\u5230\u7684 Redis \u8fd0\u884c\u65f6\u5ef6\u8fdf\u662f\u5176\u57fa\u7ebf\u6027\u80fd\u7684 2 \u500d\u53ca\u4ee5\u4e0a\uff0c\u5c31\u53ef\u4ee5\u8ba4\u5b9a Redis \u53d8\u6162\u4e86\u3002 \u5224\u65ad\u57fa\u7ebf\u6027\u80fd\u8fd9\u4e00\u70b9\uff0c\u5bf9\u4e8e\u5728\u865a\u62df\u5316\u73af\u5883\u4e0b\u8fd0\u884c\u7684 Redis \u6765\u8bf4\uff0c\u975e\u5e38\u91cd\u8981\u3002 \u662f\u56e0\u4e3a\uff0c\u5728\u865a\u62df\u5316\u73af\u5883\uff08\u4f8b\u5982\u865a\u62df\u673a\u6216\u5bb9\u5668\uff09\u4e2d\uff0c\u7531\u4e8e\u589e\u52a0\u4e86\u865a\u62df\u5316\u8f6f\u4ef6\u5c42\uff0c\u4e0e\u7269\u7406\u673a\u76f8\u6bd4\uff0c \u865a\u62df\u673a\u6216\u5bb9\u5668\u672c\u8eab\u5c31\u4f1a\u5f15\u5165\u4e00\u5b9a\u7684\u6027\u80fd\u5f00\u9500\uff0c\u6240\u4ee5\u57fa\u7ebf\u6027\u80fd\u4f1a\u9ad8\u4e00\u4e9b \u3002\u4e0b\u9762\u7684\u6d4b\u8bd5\u7ed3\u679c\uff0c\u663e\u793a\u7684\u5c31\u662f\u67d0\u4e00\u4e2a\u865a\u62df\u673a\u4e0a\u8fd0\u884c Redis \u65f6\u6d4b\u7684\u57fa\u7ebf\u6027\u80fd\u3002 $ ./redis-cli --intrinsic-latency 120 Max latency so far: 692 microseconds. Max latency so far: 915 microseconds. Max latency so far: 2193 microseconds. Max latency so far: 9343 microseconds. Max latency so far: 9871 microseconds. \u53ef\u4ee5\u770b\u5230\uff0c\u7531\u4e8e\u865a\u62df\u5316\u8f6f\u4ef6\u672c\u8eab\u7684\u5f00\u9500\uff0c\u6b64\u65f6\u7684\u57fa\u7ebf\u6027\u80fd\u5df2\u7ecf\u8fbe\u5230\u4e86 9.871ms\u3002 \u5982\u679c\u8be5 Redis \u5b9e\u4f8b\u7684\u8fd0\u884c\u65f6\u5ef6\u8fdf\u4e3a 10ms\uff0c\u8fd9\u5e76\u4e0d\u80fd\u7b97\u4f5c\u6027\u80fd\u53d8\u6162\uff0c\u56e0\u4e3a\u6b64\u65f6\uff0c\u8fd0\u884c\u65f6\u5ef6\u8fdf\u53ea\u6bd4\u57fa\u7ebf\u6027\u80fd\u589e\u52a0\u4e86 1.3%\u3002 \u5982\u679c\u4f60\u4e0d\u4e86\u89e3\u57fa\u7ebf\u6027\u80fd\uff0c\u4e00\u770b\u5230\u8f83\u9ad8\u7684\u8fd0\u884c\u65f6\u5ef6\u8fdf\uff0c\u5c31\u5f88\u6709\u53ef\u80fd\u8bef\u5224 Redis \u53d8\u6162\u4e86\u3002 \u6211\u4eec\u901a\u5e38\u662f\u901a\u8fc7\u5ba2\u6237\u7aef\u548c\u7f51\u7edc\u8bbf\u95ee Redis \u670d\u52a1\uff0c\u4e3a\u4e86\u907f\u514d\u7f51\u7edc\u5bf9\u57fa\u7ebf\u6027\u80fd\u7684\u5f71\u54cd\uff0c\u521a\u521a\u8bf4\u7684\u8fd9\u4e2a\u547d\u4ee4\u9700\u8981\u5728\u670d\u52a1\u5668\u7aef\u76f4\u63a5\u8fd0\u884c\uff0c\u8fd9\u4e5f\u5c31\u662f\u8bf4\uff0c \u6211\u4eec\u53ea\u8003\u8651\u670d\u52a1\u5668\u7aef\u8f6f\u786c\u4ef6\u73af\u5883\u7684\u5f71\u54cd \u3002","title":"1-1 \u57fa\u7ebf\u6027\u80fd"},{"location":"chap4/3redis_response/#1-2-redis","text":"\u5982\u679c\u4f60\u60f3\u4e86\u89e3\u7f51\u7edc\u5bf9 Redis \u6027\u80fd\u7684\u5f71\u54cd\uff0c\u4e00\u4e2a\u7b80\u5355\u7684\u65b9\u6cd5\u662f\u7528 iPerf \u8fd9\u6837\u7684\u5de5\u5177\uff0c\u6d4b\u91cf\u4ece Redis \u5ba2\u6237\u7aef\u5230\u670d\u52a1\u5668\u7aef\u7684\u7f51\u7edc\u5ef6\u8fdf\u3002 \u5982\u679c\u8fd9\u4e2a\u5ef6\u8fdf\u6709\u51e0\u5341\u6beb\u79d2\u751a\u81f3\u662f\u51e0\u767e\u6beb\u79d2\uff0c\u5c31\u8bf4\u660e\uff0cRedis \u8fd0\u884c\u7684\u7f51\u7edc\u73af\u5883\u4e2d\u5f88\u53ef\u80fd\u6709\u5927\u6d41\u91cf\u7684\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u5728\u8fd0\u884c \uff0c\u5bfc\u81f4\u7f51\u7edc\u62e5\u585e\u4e86\u3002 \u8fd9\u4e2a\u65f6\u5019\uff0c\u4f60\u5c31\u9700\u8981\u534f\u8c03\u7f51\u7edc\u8fd0\u7ef4\uff0c\u8c03\u6574\u7f51\u7edc\u7684\u6d41\u91cf\u5206\u914d\u4e86\u3002","title":"1-2 \u7f51\u7edc\u5bf9 Redis \u6027\u80fd\u7684\u5f71\u54cd"},{"location":"chap4/3redis_response/#2-redis","text":"Redis \u67b6\u6784\u56fe\uff0c\u662f Redis \u81ea\u8eab\u7684\u64cd\u4f5c\u7279\u6027\u3001\u6587\u4ef6\u7cfb\u7edf\u548c\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5b83\u4eec\u662f\u5f71\u54cd Redis \u6027\u80fd\u7684\u4e09\u5927\u8981\u7d20\u3002","title":"2\u3001\u5982\u4f55\u5e94\u5bf9 Redis \u53d8\u6162\uff1f"},{"location":"chap4/3redis_response/#3redis","text":"","title":"3\u3001Redis \u81ea\u8eab\u64cd\u4f5c\u7279\u6027\u7684\u5f71\u54cd"},{"location":"chap4/3redis_response/#3-1","text":"\u6162\u67e5\u8be2\u547d\u4ee4\uff0c\u5c31\u662f\u6307\u5728 Redis \u4e2d\u6267\u884c\u901f\u5ea6\u6162\u7684\u547d\u4ee4\uff0c\u8fd9\u4f1a\u5bfc\u81f4 Redis \u5ef6\u8fdf\u589e\u52a0\u3002Redis \u63d0\u4f9b\u7684\u547d\u4ee4\u64cd\u4f5c\u5f88\u591a\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u547d\u4ee4\u90fd\u6162\uff0c\u8fd9\u548c\u547d\u4ee4\u64cd\u4f5c\u7684\u590d\u6742\u5ea6\u6709\u5173\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u5fc5\u987b\u8981\u77e5\u9053 Redis \u7684\u4e0d\u540c\u547d\u4ee4\u7684\u590d\u6742\u5ea6\u3002 \u6bd4\u5982\u8bf4\uff0c Value \u7c7b\u578b\u4e3a String \u65f6\uff0c GET/SET \u64cd\u4f5c\u4e3b\u8981\u5c31\u662f\u64cd\u4f5c Redis \u7684\u54c8\u5e0c\u8868\u7d22\u5f15\u3002\u8fd9\u4e2a\u64cd\u4f5c\u590d\u6742\u5ea6\u57fa\u672c\u662f\u56fa\u5b9a\u7684\uff0c\u5373 O(1) \u3002 \u4f46\u662f\uff0c\u5f53 Value \u7c7b\u578b\u4e3a Set \u65f6\uff0c SORT \u3001 SUNION/SMEMBERS \u64cd\u4f5c\u590d\u6742\u5ea6\u5206\u522b\u4e3a O(N+M*log(M)) \u548c O(N) \u3002\u5176\u4e2d\uff0cN \u4e3a Set \u4e2d\u7684\u5143\u7d20\u4e2a\u6570\uff0cM \u4e3a SORT \u64cd\u4f5c\u8fd4\u56de\u7684\u5143\u7d20\u4e2a\u6570\u3002\u8fd9\u4e2a\u590d\u6742\u5ea6\u5c31\u589e\u52a0\u4e86\u5f88\u591a Redis \u5b98\u65b9\u6587\u6863\u4e2d\u5bf9\u6bcf\u4e2a\u547d\u4ee4\u7684\u590d\u6742\u5ea6\u90fd\u6709\u4ecb\u7ecd \u4f60\u53d1\u73b0 Redis \u6027\u80fd\u53d8\u6162\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7 Redis \u65e5\u5fd7\uff0c\u6216\u8005\u662f latency monitor \u5de5\u5177 \uff0c\u67e5\u8be2\u53d8\u6162\u7684\u8bf7\u6c42\uff0c \u6839\u636e\u8bf7\u6c42\u5bf9\u5e94\u7684\u5177\u4f53\u547d\u4ee4\u4ee5\u53ca\u5b98\u65b9\u6587\u6863\uff0c\u786e\u8ba4\u4e0b\u662f\u5426\u91c7\u7528\u4e86\u590d\u6742\u5ea6\u9ad8\u7684\u6162\u67e5\u8be2\u547d\u4ee4\u3002 \u5982\u679c\u7684\u786e\u6709\u5927\u91cf\u7684\u6162\u67e5\u8be2\u547d\u4ee4\uff0c\u6709\u4e24\u79cd\u5904\u7406\u65b9\u5f0f\uff1a \u7528\u5176\u4ed6\u9ad8\u6548\u547d\u4ee4\u4ee3\u66ff\u3002\u6bd4\u5982\u8bf4\uff0c\u5982\u679c\u4f60\u9700\u8981\u8fd4\u56de\u4e00\u4e2a SET \u4e2d\u7684\u6240\u6709\u6210\u5458\u65f6\uff0c \u4e0d\u8981\u4f7f\u7528 SMEMBERS \u547d\u4ee4\uff0c\u800c\u662f\u8981\u4f7f\u7528 SSCAN \u591a\u6b21\u8fed\u4ee3\u8fd4\u56de \uff0c\u907f\u514d\u4e00\u6b21\u8fd4\u56de\u5927\u91cf\u6570\u636e\uff0c\u9020\u6210\u7ebf\u7a0b\u963b\u585e\u3002 \u5f53\u4f60\u9700\u8981\u6267\u884c\u6392\u5e8f\u3001\u4ea4\u96c6\u3001\u5e76\u96c6\u64cd\u4f5c\u65f6\uff0c\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u5b8c\u6210\uff0c\u800c\u4e0d\u8981\u7528 SORT\u3001SUNION\u3001SINTER \u8fd9\u4e9b\u547d\u4ee4\uff0c\u4ee5\u514d\u62d6\u6162 Redis \u5b9e\u4f8b\u3002 \u5f53\u7136\uff0c\u5982\u679c\u4e1a\u52a1\u903b\u8f91\u5c31\u662f\u8981\u6c42\u4f7f\u7528\u6162\u67e5\u8be2\u547d\u4ee4\uff0c\u90a3\u4f60\u5f97\u8003\u8651\u91c7\u7528\u6027\u80fd\u66f4\u597d\u7684 CPU\uff0c\u66f4\u5feb\u5730\u5b8c\u6210\u67e5\u8be2\u547d\u4ee4\uff0c\u907f\u514d\u6162\u67e5\u8be2\u7684\u5f71\u54cd\u3002 \u8fd8\u6709\u4e00\u4e2a\u6bd4\u8f83\u5bb9\u6613\u5ffd\u7565\u7684\u6162\u67e5\u8be2\u547d\u4ee4\uff0c\u5c31\u662f KEYS \u3002 \u5b83\u7528\u4e8e\u8fd4\u56de\u548c\u8f93\u5165\u6a21\u5f0f\u5339\u914d\u7684\u6240\u6709 key\uff0c\u4f8b\u5982\uff0c\u4ee5\u4e0b\u547d\u4ee4\u8fd4\u56de\u6240\u6709\u5305\u542b\u201cname\u201d\u5b57\u7b26\u4e32\u7684 keys\u3002 redis> KEYS *name* 1) \"lastname\" 2) \"firstname\" \u56e0\u4e3a KEYS \u547d\u4ee4\u9700\u8981\u904d\u5386\u5b58\u50a8\u7684\u952e\u503c\u5bf9\uff0c\u6240\u4ee5\u64cd\u4f5c\u5ef6\u65f6\u9ad8\u3002\u5982\u679c\u4f60\u4e0d\u4e86\u89e3\u5b83\u7684\u5b9e\u73b0\u800c\u4f7f\u7528\u4e86\u5b83\uff0c\u5c31\u4f1a\u5bfc\u81f4 Redis \u6027\u80fd\u53d8\u6162\u3002\u6240\u4ee5\uff0cKEYS \u547d\u4ee4\u4e00\u822c\u4e0d\u88ab\u5efa\u8bae\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u4e2d\u3002","title":"3-1 \u6162\u67e5\u8be2\u547d\u4ee4"},{"location":"chap4/3redis_response/#3-2-key","text":"\u8fc7\u671f key \u7684\u81ea\u52a8\u5220\u9664\u673a\u5236\u3002\u5b83\u662f Redis \u7528\u6765\u56de\u6536\u5185\u5b58\u7a7a\u95f4\u7684\u5e38\u7528\u673a\u5236 \uff0c\u5e94\u7528\u5e7f\u6cdb\uff0c\u672c\u8eab\u5c31\u4f1a\u5f15\u8d77 Redis \u64cd\u4f5c\u963b\u585e\uff0c\u5bfc\u81f4\u6027\u80fd\u53d8\u6162\uff0c\u6240\u4ee5\uff0c\u4f60\u5fc5\u987b\u8981\u77e5\u9053\u8be5\u673a\u5236\u5bf9\u6027\u80fd\u7684\u5f71\u54cd\u3002 Redis \u952e\u503c\u5bf9\u7684 key \u53ef\u4ee5\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cRedis \u6bcf 100 \u6beb\u79d2\u4f1a\u5220\u9664\u4e00\u4e9b\u8fc7\u671f key \uff0c\u5177\u4f53\u7684\u7b97\u6cd5\u5982\u4e0b\uff1a \u91c7\u6837 ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP \u4e2a\u6570\u7684 key\uff0c\u5e76\u5c06\u5176\u4e2d\u8fc7\u671f\u7684 key \u5168\u90e8\u5220\u9664\uff1b \u5982\u679c\u8d85\u8fc7 25% \u7684 key \u8fc7\u671f\u4e86\uff0c\u5219\u91cd\u590d\u5220\u9664\u7684\u8fc7\u7a0b\uff0c\u76f4\u5230\u8fc7\u671f key \u7684\u6bd4\u4f8b\u964d\u81f3 25% \u4ee5\u4e0b\u3002 ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP \u662f Redis \u7684\u4e00\u4e2a\u53c2\u6570\uff0c\u9ed8\u8ba4\u662f 20 \uff0c\u90a3\u4e48\uff0c\u4e00\u79d2\u5185\u57fa\u672c\u6709 200 \u4e2a\u8fc7\u671f key \u4f1a\u88ab\u5220\u9664\u3002 \u8fd9\u4e00\u7b56\u7565\u5bf9\u6e05\u9664\u8fc7\u671f key\u3001\u91ca\u653e\u5185\u5b58\u7a7a\u95f4\u5f88\u6709\u5e2e\u52a9\u3002\u5982\u679c\u6bcf\u79d2\u949f\u5220\u9664 200 \u4e2a\u8fc7\u671f key\uff0c\u5e76\u4e0d\u4f1a\u5bf9 Redis \u9020\u6210\u592a\u5927\u5f71\u54cd\u3002 \u5982\u679c\u89e6\u53d1\u4e86\u4e0a\u9762\u8fd9\u4e2a\u7b97\u6cd5\u7684\u7b2c\u4e8c\u6761\uff0cRedis \u5c31\u4f1a\u4e00\u76f4\u5220\u9664\u4ee5\u91ca\u653e\u5185\u5b58\u7a7a\u95f4 \u3002 \u6ce8\u610f\uff0c\u5220\u9664\u64cd\u4f5c\u662f\u963b\u585e\u7684\uff08Redis 4.0 \u540e\u53ef\u4ee5\u7528\u5f02\u6b65\u7ebf\u7a0b\u673a\u5236\u6765\u51cf\u5c11\u963b\u585e\u5f71\u54cd\uff09\u3002\u6240\u4ee5\uff0c\u4e00\u65e6\u8be5\u6761\u4ef6\u89e6\u53d1\uff0cRedis \u7684\u7ebf\u7a0b\u5c31\u4f1a\u4e00\u76f4\u6267\u884c\u5220\u9664\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5c31\u6ca1\u529e\u6cd5\u6b63\u5e38\u670d\u52a1\u5176\u4ed6\u7684\u952e\u503c\u64cd\u4f5c\u4e86\uff0c\u5c31\u4f1a\u8fdb\u4e00\u6b65\u5f15\u8d77\u5176\u4ed6\u952e\u503c\u64cd\u4f5c\u7684\u5ef6\u8fdf\u589e\u52a0\uff0cRedis \u5c31\u4f1a\u53d8\u6162\u3002 \u7b97\u6cd5\u7684\u7b2c\u4e8c\u6761\u662f\u600e\u4e48\u88ab\u89e6\u53d1\u7684\u5462\uff1f \u5176\u4e2d\u4e00\u4e2a\u91cd\u8981\u6765\u6e90\uff0c \u5c31\u662f\u9891\u7e41\u4f7f\u7528\u5e26\u6709\u76f8\u540c\u65f6\u95f4\u53c2\u6570\u7684 EXPIREAT \u547d\u4ee4\u8bbe\u7f6e\u8fc7\u671f key\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\uff0c\u5728\u540c\u4e00\u79d2\u5185\u6709\u5927\u91cf\u7684 key \u540c\u65f6\u8fc7\u671f \u3002 \u8981\u68c0\u67e5\u4e1a\u52a1\u4ee3\u7801\u5728\u4f7f\u7528 EXPIREAT \u547d\u4ee4\u8bbe\u7f6e key \u8fc7\u671f\u65f6\u95f4\u65f6\uff0c\u662f\u5426\u4f7f\u7528\u4e86\u76f8\u540c\u7684 UNIX \u65f6\u95f4\u6233\uff0c\u6709\u6ca1\u6709\u4f7f\u7528 EXPIRE \u547d\u4ee4\u7ed9\u6279\u91cf\u7684 key \u8bbe\u7f6e\u76f8\u540c\u7684\u8fc7\u671f\u79d2\u6570\u3002\u56e0\u4e3a\uff0c\u8fd9\u90fd\u4f1a\u9020\u6210\u5927\u91cf key \u5728\u540c\u4e00\u65f6\u95f4\u8fc7\u671f\uff0c\u5bfc\u81f4\u6027\u80fd\u53d8\u6162 \u9996\u5148\u8981\u6839\u636e\u5b9e\u9645\u4e1a\u52a1\u7684\u4f7f\u7528\u9700\u6c42\uff0c\u51b3\u5b9a EXPIREAT \u548c EXPIRE \u7684\u8fc7\u671f\u65f6\u95f4\u53c2\u6570\u3002 \u5176\u6b21\uff0c\u5982\u679c\u4e00\u6279 key \u7684\u786e\u662f\u540c\u65f6\u8fc7\u671f\uff0c\u4f60\u8fd8\u53ef\u4ee5\u5728 EXPIREAT \u548c EXPIRE \u7684\u8fc7\u671f\u65f6\u95f4\u53c2\u6570\u4e0a\uff0c \u52a0\u4e0a\u4e00\u4e2a\u4e00\u5b9a\u5927\u5c0f\u8303\u56f4\u5185\u7684\u968f\u673a\u6570 \uff0c\u8fd9\u6837\uff0c\u65e2\u4fdd\u8bc1\u4e86 key \u5728\u4e00\u4e2a\u90bb\u8fd1\u65f6\u95f4\u8303\u56f4\u5185\u88ab\u5220\u9664\uff0c\u53c8\u907f\u514d\u4e86\u540c\u65f6\u8fc7\u671f\u9020\u6210\u7684\u538b\u529b\u3002","title":"3-2 \u8fc7\u671f key \u64cd\u4f5c"},{"location":"chap4/3redis_response/#4","text":"Redis \u4f1a\u6301\u4e45\u5316\u4fdd\u5b58\u6570\u636e\u5230\u78c1\u76d8\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u8981\u4f9d\u8d56\u6587\u4ef6\u7cfb\u7edf\u6765\u5b8c\u6210\uff0c\u6240\u4ee5\uff0c\u6587\u4ef6\u7cfb\u7edf\u5c06\u6570\u636e\u5199\u56de\u78c1\u76d8\u7684\u673a\u5236\uff0c\u4f1a\u76f4\u63a5\u5f71\u54cd\u5230 Redis \u6301\u4e45\u5316\u7684\u6548\u7387 \u3002 \u800c\u4e14\uff0c\u5728\u6301\u4e45\u5316\u7684\u8fc7\u7a0b\u4e2d\uff0cRedis \u4e5f\u8fd8\u5728\u63a5\u6536\u5176\u4ed6\u8bf7\u6c42\uff0c\u6301\u4e45\u5316\u7684\u6548\u7387\u9ad8\u4f4e\u53c8\u4f1a\u5f71\u54cd\u5230 Redis \u5904\u7406\u8bf7\u6c42\u7684\u6027\u80fd\u3002 \u53e6\u4e00\u65b9\u9762\uff0c Redis \u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u5185\u5b58\u64cd\u4f5c\u975e\u5e38\u9891\u7e41 \uff0c\u6240\u4ee5\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58\u673a\u5236\u4f1a\u76f4\u63a5\u5f71\u54cd\u5230 Redis \u7684\u5904\u7406\u6548\u7387\u3002\u6bd4\u5982\u8bf4\uff0c\u5982\u679c Redis \u7684\u5185\u5b58\u4e0d\u591f\u7528\u4e86\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u542f\u52a8 swap \u673a\u5236\uff0c\u8fd9\u5c31\u4f1a\u76f4\u63a5\u62d6\u6162 Redis\u3002","title":"4\u3001\u6587\u4ef6\u7cfb\u7edf\u548c\u64cd\u4f5c\u7cfb\u7edf"},{"location":"chap4/3redis_response/#5aof","text":"Redis \u662f\u4e2a\u5185\u5b58\u6570\u636e\u5e93\uff0c\u4e3a\u4ec0\u4e48\u5b83\u7684\u6027\u80fd\u8fd8\u548c\u6587\u4ef6\u7cfb\u7edf\u6709\u5173\u5462\uff1f \u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\uff0cRedis \u4f1a\u91c7\u7528 AOF \u65e5\u5fd7\u6216 RDB \u5feb\u7167\u3002 \u5176\u4e2d\uff0cAOF \u65e5\u5fd7\u63d0\u4f9b\u4e86\u4e09\u79cd\u65e5\u5fd7\u5199\u56de\u7b56\u7565\uff1a no\u3001everysec\u3001always\u3002\u8fd9\u4e09\u79cd\u5199\u56de\u7b56\u7565\u4f9d\u8d56\u6587\u4ef6\u7cfb\u7edf\u7684\u4e24\u4e2a\u7cfb\u7edf\u8c03\u7528\u5b8c\u6210\uff0c\u4e5f\u5c31\u662f write \u548c fsync\u3002 write \u53ea\u8981\u628a\u65e5\u5fd7\u8bb0\u5f55\u5199\u5230\u5185\u6838\u7f13\u51b2\u533a\uff0c\u5c31\u53ef\u4ee5\u8fd4\u56de\u4e86\uff0c\u5e76\u4e0d\u9700\u8981\u7b49\u5f85\u65e5\u5fd7\u5b9e\u9645\u5199\u56de\u5230\u78c1\u76d8\uff1b \u800c fsync \u9700\u8981\u628a\u65e5\u5fd7\u8bb0\u5f55\u5199\u56de\u5230\u78c1\u76d8\u540e\u624d\u80fd\u8fd4\u56de\uff0c\u65f6\u95f4\u8f83\u957f\u3002 \u4e0b\u9762\u8fd9\u5f20\u8868\u5c55\u793a\u4e86\u4e09\u79cd\u5199\u56de\u7b56\u7565\u6240\u6267\u884c\u7684\u7cfb\u7edf\u8c03\u7528\u3002 \u5f53\u5199\u56de\u7b56\u7565\u914d\u7f6e\u4e3a everysec \u548c always \u65f6\uff0cRedis \u9700\u8981\u8c03\u7528 fsync \u628a\u65e5\u5fd7\u5199\u56de\u78c1\u76d8\u3002","title":"5\u3001\u6587\u4ef6\u7cfb\u7edf\uff1aAOF \u6a21\u5f0f"},{"location":"chap4/3redis_response/#5-1-everysec","text":"\u5728\u4f7f\u7528 everysec \u65f6\uff0cRedis \u5141\u8bb8\u4e22\u5931\u4e00\u79d2\u7684\u64cd\u4f5c\u8bb0\u5f55\uff0c\u6240\u4ee5\uff0cRedis \u4e3b\u7ebf\u7a0b\u5e76\u4e0d\u9700\u8981\u786e\u4fdd\u6bcf\u4e2a\u64cd\u4f5c\u8bb0\u5f55\u65e5\u5fd7\u90fd\u5199\u56de\u78c1\u76d8\u3002 \u800c\u4e14\uff0cfsync \u7684\u6267\u884c\u65f6\u95f4\u5f88\u957f\uff0c\u5982\u679c\u662f\u5728 Redis \u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c fsync\uff0c\u5c31\u5bb9\u6613\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002 \u6240\u4ee5\uff0c\u5f53\u5199\u56de\u7b56\u7565\u914d\u7f6e\u4e3a everysec \u65f6\uff0cRedis \u4f1a\u4f7f\u7528\u540e\u53f0\u7684\u5b50\u7ebf\u7a0b\u5f02\u6b65\u5b8c\u6210 fsync \u7684\u64cd\u4f5c\u3002","title":"5-1 everysec"},{"location":"chap4/3redis_response/#5-2-always","text":"\u800c\u5bf9\u4e8e always \u7b56\u7565\u6765\u8bf4\uff0cRedis \u9700\u8981\u786e\u4fdd\u6bcf\u4e2a\u64cd\u4f5c\u8bb0\u5f55\u65e5\u5fd7\u90fd\u5199\u56de\u78c1\u76d8\uff0c\u5982\u679c\u7528\u540e\u53f0\u5b50\u7ebf\u7a0b\u5f02\u6b65\u5b8c\u6210\uff0c\u4e3b\u7ebf\u7a0b\u5c31\u65e0\u6cd5\u53ca\u65f6\u5730\u77e5\u9053\u6bcf\u4e2a\u64cd\u4f5c\u662f\u5426\u5df2\u7ecf\u5b8c\u6210\u4e86\uff0c\u8fd9\u5c31\u4e0d\u7b26\u5408 always \u7b56\u7565\u7684\u8981\u6c42\u4e86\u3002 \u6240\u4ee5\uff0calways \u7b56\u7565\u5e76\u4e0d\u4f7f\u7528\u540e\u53f0\u5b50\u7ebf\u7a0b\u6765\u6267\u884c\u3002 \u4f7f\u7528everysec\u65f6\uff0c\u4f1a\u4f7f\u7528\u5b50\u7ebf\u7a0b\u6765\u64cd\u4f5c\uff0c\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002\u800c\u4f7f\u7528always\u65f6\uff0c\u662f\u4f7f\u7528\u4e3b\u7ebf\u7a0b\u6765\u64cd\u4f5c\uff0c\u6240\u4ee5\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b","title":"5-2 always"},{"location":"chap4/3redis_response/#5-3-aof","text":"\u5728\u4f7f\u7528 AOF \u65e5\u5fd7\u65f6\uff0c\u4e3a\u4e86\u907f\u514d\u65e5\u5fd7\u6587\u4ef6\u4e0d\u65ad\u589e\u5927\uff0c Redis \u4f1a\u6267\u884c AOF \u91cd\u5199\uff0c\u751f\u6210\u4f53\u91cf\u7f29\u5c0f\u7684\u65b0\u7684 AOF \u65e5\u5fd7\u6587\u4ef6 \u3002AOF \u91cd\u5199\u672c\u8eab\u9700\u8981\u7684\u65f6\u95f4\u5f88\u957f\uff0c\u4e5f\u5bb9\u6613\u963b\u585e Redis \u4e3b\u7ebf\u7a0b\uff0c\u6240\u4ee5\uff0cRedis \u4f7f\u7528\u5b50\u8fdb\u7a0b\u6765\u8fdb\u884c AOF \u91cd\u5199\u3002 \u6f5c\u5728\u7684\u98ce\u9669\u70b9: AOF \u91cd\u5199\u4f1a\u5bf9\u78c1\u76d8\u8fdb\u884c\u5927\u91cf IO \u64cd\u4f5c\uff0c\u540c\u65f6\uff0cfsync \u53c8\u9700\u8981\u7b49\u5230\u6570\u636e\u5199\u5230\u78c1\u76d8\u540e\u624d\u80fd\u8fd4\u56de\uff0c\u6240\u4ee5\uff0c\u5f53 AOF \u91cd\u5199\u7684\u538b\u529b\u6bd4\u8f83\u5927\u65f6\uff0c\u5c31\u4f1a\u5bfc\u81f4 fsync \u88ab\u963b\u585e\u3002\u867d\u7136 fsync \u662f\u7531\u540e\u53f0\u5b50\u7ebf\u7a0b\u8d1f\u8d23\u6267\u884c\u7684\uff0c\u4f46\u662f\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u76d1\u63a7 fsync \u7684\u6267\u884c\u8fdb\u5ea6\u3002 \u5f53\u4e3b\u7ebf\u7a0b\u4f7f\u7528\u540e\u53f0\u5b50\u7ebf\u7a0b\u6267\u884c\u4e86\u4e00\u6b21 fsync\uff0c\u9700\u8981\u518d\u6b21\u628a\u65b0\u63a5\u6536\u7684\u64cd\u4f5c\u8bb0\u5f55\u5199\u56de\u78c1\u76d8\u65f6\uff0c\u5982\u679c\u4e3b\u7ebf\u7a0b\u53d1\u73b0\u4e0a\u4e00\u6b21\u7684 fsync \u8fd8\u6ca1\u6709\u6267\u884c\u5b8c\uff0c\u90a3\u4e48\u5b83\u5c31\u4f1a\u963b\u585e\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u540e\u53f0\u5b50\u7ebf\u7a0b\u6267\u884c\u7684 fsync \u9891\u7e41\u963b\u585e\u7684\u8bdd\uff08\u6bd4\u5982 AOF \u91cd\u5199\u5360\u7528\u4e86\u5927\u91cf\u7684\u78c1\u76d8 IO \u5e26\u5bbd\uff09\uff0c\u4e3b\u7ebf\u7a0b\u4e5f\u4f1a\u963b\u585e\uff0c\u5bfc\u81f4 Redis \u6027\u80fd\u53d8\u6162\u3002 \u7531\u4e8e fsync \u540e\u53f0\u5b50\u7ebf\u7a0b\u548c AOF \u91cd\u5199\u5b50\u8fdb\u7a0b\u7684\u5b58\u5728\uff0c\u4e3b IO \u7ebf\u7a0b\u4e00\u822c\u4e0d\u4f1a\u88ab\u963b\u585e\u3002 \u4f46\u662f\uff0c\u5982\u679c\u5728\u91cd\u5199\u65e5\u5fd7\u65f6\uff0c AOF \u91cd\u5199\u5b50\u8fdb\u7a0b\u7684\u5199\u5165\u91cf\u6bd4\u8f83\u5927\uff0c fsync \u7ebf\u7a0b\u4e5f\u4f1a\u88ab\u963b\u585e\uff0c\u8fdb\u800c\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u5bfc\u81f4\u5ef6\u8fdf\u589e\u52a0 \u9996\u5148\uff0c\u4f60\u53ef\u4ee5\u68c0\u67e5\u4e0b Redis \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 appendfsync \u914d\u7f6e\u9879\uff0c\u8be5\u914d\u7f6e\u9879\u7684\u53d6\u503c\u8868\u660e\u4e86 Redis \u5b9e\u4f8b\u4f7f\u7528\u7684\u662f\u54ea\u79cd AOF \u65e5\u5fd7\u5199\u56de\u7b56\u7565\uff0c\u5982\u4e0b\u6240\u793a\uff1a \u5982\u679c AOF \u5199\u56de\u7b56\u7565\u4f7f\u7528\u4e86 everysec \u6216 always \u914d\u7f6e\uff0c\u8bf7\u5148\u786e\u8ba4\u4e0b\u4e1a\u52a1\u65b9\u5bf9\u6570\u636e\u53ef\u9760\u6027\u7684\u8981\u6c42\uff0c\u660e\u786e\u662f\u5426\u9700\u8981\u6bcf\u4e00\u79d2\u6216\u6bcf\u4e00\u4e2a\u64cd\u4f5c\u90fd\u8bb0\u65e5\u5fd7\u3002 \u6709\u7684\u4e1a\u52a1\u65b9\u4e0d\u4e86\u89e3 Redis AOF \u673a\u5236\uff0c\u5f88\u53ef\u80fd\u5c31\u76f4\u63a5\u4f7f\u7528\u6570\u636e\u53ef\u9760\u6027\u6700\u9ad8\u7b49\u7ea7\u7684 always \u914d\u7f6e\u4e86\u3002\u5176\u5b9e\uff0c\u5728\u6709\u4e9b\u573a\u666f\u4e2d\uff08\u4f8b\u5982 Redis \u7528\u4e8e\u7f13\u5b58\uff09\uff0c\u6570\u636e\u4e22\u4e86\u8fd8\u53ef\u4ee5\u4ece\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u83b7\u53d6\uff0c\u5e76\u4e0d\u9700\u8981\u5f88\u9ad8\u7684\u6570\u636e\u53ef\u9760\u6027\u3002 \u5982\u679c\u4e1a\u52a1\u5e94\u7528\u5bf9\u5ef6\u8fdf\u975e\u5e38\u654f\u611f\uff0c\u4f46\u540c\u65f6\u5141\u8bb8\u4e00\u5b9a\u91cf\u7684\u6570\u636e\u4e22\u5931\uff0c\u90a3\u4e48\uff0c\u53ef\u4ee5\u628a\u914d\u7f6e\u9879 no-appendfsync-on-rewrite \u8bbe\u7f6e\u4e3a yes \uff0c\u5982\u4e0b\u6240\u793a\uff1a no-appendfsync-on-rewrite yes \u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a yes \u65f6\uff0c\u8868\u793a\u5728 AOF \u91cd\u5199\u65f6\uff0c\u4e0d\u8fdb\u884c fsync \u64cd\u4f5c\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cRedis \u5b9e\u4f8b\u628a\u5199\u547d\u4ee4\u5199\u5230\u5185\u5b58\u540e\uff0c\u4e0d\u8c03\u7528\u540e\u53f0\u7ebf\u7a0b\u8fdb\u884c fsync \u64cd\u4f5c\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de\u4e86\u3002 \u5f53\u7136\uff0c\u5982\u679c\u6b64\u65f6\u5b9e\u4f8b\u53d1\u751f\u5b95\u673a\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u3002\u53cd\u4e4b\uff0c\u5982\u679c\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a no\uff08\u4e5f\u662f\u9ed8\u8ba4\u914d\u7f6e\uff09\uff0c\u5728 AOF \u91cd\u5199\u65f6\uff0cRedis \u5b9e\u4f8b\u4ecd\u7136\u4f1a\u8c03\u7528\u540e\u53f0\u7ebf\u7a0b\u8fdb\u884c fsync \u64cd\u4f5c\uff0c\u8fd9\u5c31\u4f1a\u7ed9\u5b9e\u4f8b\u5e26\u6765\u963b\u585e\u3002 \u5982\u679c\u7684\u786e\u9700\u8981\u9ad8\u6027\u80fd\uff0c\u91c7\u7528\u9ad8\u901f\u7684\u56fa\u6001\u786c\u76d8\u4f5c\u4e3a AOF \u65e5\u5fd7\u7684\u5199\u5165\u8bbe\u5907\u3002 \u9ad8\u901f\u56fa\u6001\u76d8\u7684\u5e26\u5bbd\u548c\u5e76\u53d1\u5ea6\u6bd4\u4f20\u7edf\u7684\u673a\u68b0\u786c\u76d8\u7684\u8981\u9ad8\u51fa 10 \u500d\u53ca\u4ee5\u4e0a\u3002 \u5728 AOF \u91cd\u5199\u548c fsync \u540e\u53f0\u7ebf\u7a0b\u540c\u65f6\u6267\u884c\u65f6\uff0c\u56fa\u6001\u786c\u76d8\u53ef\u4ee5\u63d0\u4f9b\u8f83\u4e3a\u5145\u8db3\u7684\u78c1\u76d8 IO \u8d44\u6e90\uff0c\u8ba9 AOF \u91cd\u5199\u548c fsync \u540e\u53f0\u7ebf\u7a0b\u7684\u78c1\u76d8 IO \u8d44\u6e90\u7ade\u4e89\u51cf\u5c11\uff0c\u4ece\u800c\u964d\u4f4e\u5bf9 Redis \u7684\u6027\u80fd\u5f71\u54cd\u3002","title":"5-3 AOF \u91cd\u5199"},{"location":"chap4/3redis_response/#6swap","text":"\u5982\u679c Redis \u7684 AOF \u65e5\u5fd7\u914d\u7f6e\u53ea\u662f no\uff0c\u6216\u8005\u5c31\u6ca1\u6709\u91c7\u7528 AOF \u6a21\u5f0f \u6f5c\u5728\u7684\u74f6\u9888\uff1a\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58 swap\u3002 \u5185\u5b58 swap \u662f\u64cd\u4f5c\u7cfb\u7edf\u91cc\u5c06\u5185\u5b58\u6570\u636e\u5728\u5185\u5b58\u548c\u78c1\u76d8\u95f4\u6765\u56de\u6362\u5165\u548c\u6362\u51fa\u7684\u673a\u5236\uff0c\u6d89\u53ca\u5230\u78c1\u76d8\u7684\u8bfb\u5199 \uff0c\u6240\u4ee5\uff0c\u4e00\u65e6\u89e6\u53d1 swap\uff0c\u65e0\u8bba\u662f\u88ab\u6362\u5165\u6570\u636e\u7684\u8fdb\u7a0b\uff0c\u8fd8\u662f\u88ab\u6362\u51fa\u6570\u636e\u7684\u8fdb\u7a0b\uff0c\u5176\u6027\u80fd\u90fd\u4f1a\u53d7\u5230\u6162\u901f\u78c1\u76d8\u8bfb\u5199\u7684\u5f71\u54cd\u3002 Redis \u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u5185\u5b58\u4f7f\u7528\u91cf\u5927\uff0c\u5982\u679c\u6ca1\u6709\u63a7\u5236\u597d\u5185\u5b58\u7684\u4f7f\u7528\u91cf\uff0c\u6216\u8005\u548c\u5176\u4ed6\u5185\u5b58\u9700\u6c42\u5927\u7684\u5e94\u7528\u4e00\u8d77\u8fd0\u884c\u4e86\uff0c\u5c31\u53ef\u80fd\u53d7\u5230 swap \u7684\u5f71\u54cd\uff0c\u800c\u5bfc\u81f4\u6027\u80fd\u53d8\u6162\u3002 Redis \u5185\u5b58\u6570\u636e\u5e93\u800c\u8a00\uff0c\u663e\u5f97\u66f4\u4e3a\u91cd\u8981\uff1a \u6b63\u5e38\u60c5\u51b5\u4e0b\uff0cRedis \u7684\u64cd\u4f5c\u662f\u76f4\u63a5\u901a\u8fc7\u8bbf\u95ee\u5185\u5b58\u5c31\u80fd\u5b8c\u6210\uff0c\u4e00\u65e6 swap \u88ab\u89e6\u53d1\u4e86\uff0cRedis \u7684\u8bf7\u6c42\u64cd\u4f5c\u9700\u8981\u7b49\u5230\u78c1\u76d8\u6570\u636e\u8bfb\u5199\u5b8c\u6210\u624d\u884c \u3002 \u800c\u4e14\uff0c AOF \u65e5\u5fd7\u6587\u4ef6\u8bfb\u5199\u4f7f\u7528 fsync \u7ebf\u7a0b\u4e0d\u540c\uff0cswap \u89e6\u53d1\u540e\u5f71\u54cd\u7684\u662f Redis \u4e3b IO \u7ebf\u7a0b\uff0c\u8fd9\u4f1a\u6781\u5927\u5730\u589e\u52a0 Redis \u7684\u54cd\u5e94\u65f6\u95f4\u3002","title":"6\u3001\u64cd\u4f5c\u7cfb\u7edf\uff1aswap"},{"location":"chap4/3redis_response/#6-1-swap","text":"\u5b9e\u4f8b\u5b8c\u6210 5000 \u4e07\u4e2a GET \u8bf7\u6c42\u65f6\u9700\u8981 300s\uff0c\u4f46\u662f\uff0c\u6709\u4e00\u6b21\uff0c\u8fd9\u4e2a\u5b9e\u4f8b\u5b8c\u6210 5000 \u4e07 GET \u8bf7\u6c42\uff0c\u82b1\u4e86\u5c06\u8fd1 4 \u4e2a\u5c0f\u65f6\u7684\u65f6\u95f4 \u95ee\u9898\u590d\u73b0\uff0c\u5f53\u65f6 Redis \u5904\u7406\u8bf7\u6c42\u7528\u4e86\u8fd1 4 \u5c0f\u65f6\u7684\u60c5\u51b5\u4e0b\uff0c \u8be5\u5b9e\u4f8b\u6240\u5728\u7684\u673a\u5668\u5df2\u7ecf\u53d1\u751f\u4e86 swap \u3002\u4ece 300s \u5230 4 \u4e2a\u5c0f\u65f6\uff0c\u5ef6\u8fdf\u589e\u52a0\u4e86\u5c06\u8fd1 48 \u500d\uff0c\u53ef\u4ee5\u770b\u5230 swap \u5bf9\u6027\u80fd\u9020\u6210\u7684\u4e25\u91cd\u5f71\u54cd\u3002 \u4ec0\u4e48\u65f6\u5019\u4f1a\u89e6\u53d1 swap \u5462\uff1f \u901a\u5e38\uff0c\u89e6\u53d1 swap \u7684\u539f\u56e0\u4e3b\u8981\u662f\u7269\u7406\u673a\u5668\u5185\u5b58\u4e0d\u8db3 \u5bf9\u4e8e Redis \u800c\u8a00\uff0c\u6709\u4e24\u79cd\u5e38\u89c1\u7684\u60c5\u51b5\uff1a Redis \u5b9e\u4f8b\u81ea\u8eab\u4f7f\u7528\u4e86\u5927\u91cf\u7684\u5185\u5b58\uff0c\u5bfc\u81f4\u7269\u7406\u673a\u5668\u7684\u53ef\u7528\u5185\u5b58\u4e0d\u8db3\uff1b \u548c Redis \u5b9e\u4f8b\u5728\u540c\u4e00\u53f0\u673a\u5668\u4e0a\u8fd0\u884c\u7684 \u5176\u4ed6\u8fdb\u7a0b\uff0c\u5728\u8fdb\u884c\u5927\u91cf\u7684\u6587\u4ef6\u8bfb\u5199\u64cd\u4f5c \u3002\u6587\u4ef6\u8bfb\u5199\u672c\u8eab\u4f1a\u5360\u7528\u7cfb\u7edf\u5185\u5b58\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u5206\u914d\u7ed9 Redis \u5b9e\u4f8b\u7684\u5185\u5b58\u91cf\u53d8\u5c11\uff0c \u8fdb\u800c\u89e6\u53d1 Redis \u53d1\u751f swap \u3002 \u89e3\u51b3\u601d\u8def\uff1a\u589e\u52a0\u673a\u5668\u7684\u5185\u5b58\u6216\u8005\u4f7f\u7528 Redis \u96c6\u7fa4 \u64cd\u4f5c\u7cfb\u7edf\u672c\u8eab\u4f1a\u5728\u540e\u53f0\u8bb0\u5f55\u6bcf\u4e2a\u8fdb\u7a0b\u7684 swap \u4f7f\u7528\u60c5\u51b5\uff0c\u5373\u6709\u591a\u5c11\u6570\u636e\u91cf\u53d1\u751f\u4e86 swap\u3002\u4f60\u53ef\u4ee5\u5148\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770b Redis \u7684\u8fdb\u7a0b\u53f7\uff0c\u8fd9\u91cc\u662f 5332\u3002 $ redis-cli info | grep process_id process_id: 5332 \u7136\u540e\uff0c\u8fdb\u5165 Redis \u6240\u5728\u673a\u5668\u7684 /proc \u76ee\u5f55\u4e0b\u7684\u8be5\u8fdb\u7a0b\u76ee\u5f55\u4e2d\uff1a $ cd /proc/5332 \u6700\u540e\uff0c\u8fd0\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u67e5\u770b\u8be5 Redis \u8fdb\u7a0b\u7684\u4f7f\u7528\u60c5\u51b5\u3002 $cat smaps | egrep '^(Swap|Size)' Size: 584 kB Swap: 0 kB Size: 4 kB Swap: 4 kB Size: 4 kB Swap: 0 kB Size: 462044 kB Swap: 462008 kB Size: 21392 kB Swap: 0 kB \u6bcf\u4e00\u884c Size \u8868\u793a\u7684\u662f Redis \u5b9e\u4f8b\u6240\u7528\u7684\u4e00\u5757\u5185\u5b58\u5927\u5c0f\uff0c\u800c Size \u4e0b\u65b9\u7684 Swap \u548c\u5b83\u76f8\u5bf9\u5e94\uff0c\u8868\u793a\u8fd9\u5757 Size \u5927\u5c0f\u7684\u5185\u5b58\u533a\u57df\u6709\u591a\u5c11\u5df2\u7ecf\u88ab\u6362\u51fa\u5230\u78c1\u76d8\u4e0a\u4e86\u3002 \u5982\u679c\u8fd9\u4e24\u4e2a\u503c\u76f8\u7b49\uff0c\u5c31\u8868\u793a\u8fd9\u5757\u5185\u5b58\u533a\u57df\u5df2\u7ecf\u5b8c\u5168\u88ab\u6362\u51fa\u5230\u78c1\u76d8\u4e86\u3002 \u4f5c\u4e3a\u5185\u5b58\u6570\u636e\u5e93\uff0cRedis \u672c\u8eab\u4f1a\u4f7f\u7528\u5f88\u591a\u5927\u5c0f\u4e0d\u4e00\u7684\u5185\u5b58\u5757 \uff0c\u6240\u4ee5\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\u6709\u5f88\u591a Size \u884c\uff0c\u6709\u7684\u5f88\u5c0f\uff0c\u5c31\u662f 4KB\uff0c\u800c\u6709\u7684\u5f88\u5927\uff0c\u4f8b\u5982 462044KB\u3002 \u4e0d\u540c\u5185\u5b58\u5757\u88ab\u6362\u51fa\u5230\u78c1\u76d8\u4e0a\u7684\u5927\u5c0f\u4e5f\u4e0d\u4e00\u6837 \uff0c\u4f8b\u5982\u521a\u521a\u7684\u7ed3\u679c\u4e2d\u7684\u7b2c\u4e00\u4e2a 4KB \u5185\u5b58\u5757\uff0c\u5b83\u4e0b\u65b9\u7684 Swap \u4e5f\u662f 4KB\uff0c\u8fd9\u8868\u793a\u8fd9\u4e2a\u5185\u5b58\u5757\u5df2\u7ecf\u88ab\u6362\u51fa\u4e86\uff1b \u53e6\u5916\uff0c462044KB \u8fd9\u4e2a\u5185\u5b58\u5757\u4e5f\u88ab\u6362\u51fa\u4e86 462008KB\uff0c\u5dee\u4e0d\u591a\u6709 462MB\u3002 \u5f53\u51fa\u73b0\u767e MB\uff0c\u751a\u81f3 GB \u7ea7\u522b\u7684 swap \u5927\u5c0f\u65f6\uff0c\u5c31\u8868\u660e\uff0c\u6b64\u65f6\uff0cRedis \u5b9e\u4f8b\u7684\u5185\u5b58\u538b\u529b\u5f88\u5927\uff0c\u5f88\u6709\u53ef\u80fd\u4f1a\u53d8\u6162\u3002\u6240\u4ee5\uff0cswap \u7684\u5927\u5c0f\u662f\u6392\u67e5 Redis \u6027\u80fd\u53d8\u6162\u662f\u5426\u7531 swap \u5f15\u8d77\u7684\u91cd\u8981\u6307\u6807\u3002 \u4e00\u65e6\u53d1\u751f\u5185\u5b58 swap\uff0c \u6700\u76f4\u63a5\u7684\u89e3\u51b3\u65b9\u6cd5\u5c31\u662f\u589e\u52a0\u673a\u5668\u5185\u5b58 \u3002 \u5982\u679c\u8be5\u5b9e\u4f8b\u5728\u4e00\u4e2a Redis \u5207\u7247\u96c6\u7fa4\u4e2d\uff0c\u53ef\u4ee5\u589e\u52a0 Redis \u96c6\u7fa4\u7684\u5b9e\u4f8b\u4e2a\u6570\uff0c\u6765\u5206\u644a\u6bcf\u4e2a\u5b9e\u4f8b\u670d\u52a1\u7684\u6570\u636e\u91cf\uff0c\u8fdb\u800c\u51cf\u5c11\u6bcf\u4e2a\u5b9e\u4f8b\u6240\u9700\u7684\u5185\u5b58\u91cf\u3002 \u5982\u679c Redis \u5b9e\u4f8b\u548c\u5176\u4ed6\u64cd\u4f5c\u5927\u91cf\u6587\u4ef6\u7684\u7a0b\u5e8f\uff08\u4f8b\u5982\u6570\u636e\u5206\u6790\u7a0b\u5e8f\uff09\u5171\u4eab\u673a\u5668\uff0c\u4f60\u53ef\u4ee5\u5c06 Redis \u5b9e\u4f8b\u8fc1\u79fb\u5230\u5355\u72ec\u7684\u673a\u5668\u4e0a\u8fd0\u884c\uff0c\u4ee5\u6ee1\u8db3\u5b83\u7684\u5185\u5b58\u9700\u6c42\u91cf\u3002\u5982\u679c\u8be5\u5b9e\u4f8b\u6b63\u597d\u662f Redis \u4e3b\u4ece\u96c6\u7fa4\u4e2d\u7684\u4e3b\u5e93\uff0c\u800c\u4ece\u5e93\u7684\u5185\u5b58\u5f88\u5927\uff0c\u4e5f\u53ef\u4ee5\u8003\u8651\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u628a\u5927\u5185\u5b58\u7684\u4ece\u5e93\u53d8\u6210\u4e3b\u5e93\uff0c\u7531\u5b83\u6765\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42\u3002","title":"6-1 swap \u800c\u5bfc\u81f4\u6027\u80fd\u964d\u4f4e"},{"location":"chap4/3redis_response/#7","text":"\u9664\u4e86\u5185\u5b58 swap\uff0c\u8fd8\u6709\u4e00\u4e2a\u548c\u5185\u5b58\u76f8\u5173\u7684\u56e0\u7d20\uff0c\u5373\u5185\u5b58\u5927\u9875\u673a\u5236\uff08Transparent Huge Page, THP\uff09\uff0c\u4e5f\u4f1a\u5f71\u54cd Redis \u6027\u80fd\u3002","title":"7\u3001\u64cd\u4f5c\u7cfb\u7edf\uff1a\u5185\u5b58\u5927\u9875"},{"location":"chap4/3redis_response/#7-1-trade-off","text":"Linux \u5185\u6838\u4ece 2.6.38 \u5f00\u59cb\u652f\u6301\u5185\u5b58\u5927\u9875\u673a\u5236\uff0c \u8be5\u673a\u5236\u652f\u6301 2MB \u5927\u5c0f\u7684\u5185\u5b58\u9875\u5206\u914d\uff0c\u800c\u5e38\u89c4\u7684\u5185\u5b58\u9875\u5206\u914d\u662f\u6309 4KB \u7684\u7c92\u5ea6\u6765\u6267\u884c\u7684\u3002 Redis \u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u5185\u5b58\u5927\u9875\u4e0d\u6b63\u597d\u53ef\u4ee5\u6ee1\u8db3 Redis \u7684\u9700\u6c42\u5417\uff1f\u800c\u4e14\u5728\u5206\u914d\u76f8\u540c\u7684\u5185\u5b58\u91cf\u65f6\uff0c\u5185\u5b58\u5927\u9875\u8fd8\u80fd\u51cf\u5c11\u5206\u914d\u6b21\u6570\uff0c\u4e0d\u4e5f\u662f\u5bf9 Redis \u53cb\u597d\u5417? \u5176\u5b9e\uff0c\u7cfb\u7edf\u7684\u8bbe\u8ba1\u901a\u5e38\u662f\u4e00\u4e2a\u53d6\u820d\u8fc7\u7a0b\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a trade-off\u3002\u5f88\u591a\u673a\u5236\u901a\u5e38\u90fd\u662f\u4f18\u52bf\u548c\u52a3\u52bf\u5e76\u5b58\u7684\u3002Redis \u4f7f\u7528\u5185\u5b58\u5927\u9875\u5c31\u662f\u4e00\u4e2a\u5178\u578b\u7684\u4f8b\u5b50\u3002 \u867d\u7136\u5185\u5b58\u5927\u9875\u53ef\u4ee5\u7ed9 Redis \u5e26\u6765\u5185\u5b58\u5206\u914d\u65b9\u9762\u7684\u6536\u76ca\uff0c\u4e0d\u8981\u5fd8\u4e86\uff0cRedis \u4e3a\u4e86\u63d0\u4f9b\u6570\u636e\u53ef\u9760\u6027\u4fdd\u8bc1\uff0c\u9700\u8981\u5c06\u6570\u636e\u505a\u6301\u4e45\u5316\u4fdd\u5b58\u3002 \u8fd9\u4e2a\u5199\u5165\u8fc7\u7a0b\u7531\u989d\u5916\u7684\u7ebf\u7a0b\u6267\u884c\uff0c\u6240\u4ee5\uff0c\u6b64\u65f6\uff0cRedis \u4e3b\u7ebf\u7a0b\u4ecd\u7136\u53ef\u4ee5\u63a5\u6536\u5ba2\u6237\u7aef\u5199\u8bf7\u6c42\u3002\u5ba2\u6237\u7aef\u7684\u5199\u8bf7\u6c42\u53ef\u80fd\u4f1a\u4fee\u6539\u6b63\u5728\u8fdb\u884c\u6301\u4e45\u5316\u7684\u6570\u636e\u3002 \u5728\u8fd9\u4e00\u8fc7\u7a0b\u4e2d\uff0cRedis \u5c31\u4f1a\u91c7\u7528\u5199\u65f6\u590d\u5236\u673a\u5236\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u65e6\u6709\u6570\u636e\u8981\u88ab\u4fee\u6539\uff0cRedis \u5e76\u4e0d\u4f1a\u76f4\u63a5\u4fee\u6539\u5185\u5b58\u4e2d\u7684\u6570\u636e\uff0c \u800c\u662f\u5c06\u8fd9\u4e9b\u6570\u636e\u62f7\u8d1d\u4e00\u4efd\uff0c\u7136\u540e\u518d\u8fdb\u884c\u4fee\u6539 \u3002 \u5982\u679c\u91c7\u7528\u4e86\u5185\u5b58\u5927\u9875\uff0c\u90a3\u4e48\uff0c\u5373\u4f7f\u5ba2\u6237\u7aef\u8bf7\u6c42\u53ea\u4fee\u6539 100B \u7684\u6570\u636e\uff0cRedis \u4e5f\u9700\u8981\u62f7\u8d1d 2MB \u7684\u5927\u9875\u3002\u76f8\u53cd\uff0c\u5982\u679c\u662f\u5e38\u89c4\u5185\u5b58\u9875\u673a\u5236\uff0c\u53ea\u7528\u62f7\u8d1d 4KB \u5f53\u5ba2\u6237\u7aef\u8bf7\u6c42\u4fee\u6539\u6216\u65b0\u5199\u5165\u6570\u636e\u8f83\u591a\u65f6\uff0c\u5185\u5b58\u5927\u9875\u673a\u5236\u5c06\u5bfc\u81f4\u5927\u91cf\u7684\u62f7\u8d1d\uff0c\u8fd9\u5c31\u4f1a\u5f71\u54cd Redis \u6b63\u5e38\u7684\u8bbf\u5b58\u64cd\u4f5c\uff0c\u6700\u7ec8\u5bfc\u81f4\u6027\u80fd\u53d8\u6162\u3002","title":"7-1 \u5185\u5b58\u5927\u9875 trade-off"},{"location":"chap4/3redis_response/#7-2","text":"\u9996\u5148\uff0c\u6211\u4eec\u8981\u5148\u6392\u67e5\u4e0b\u5185\u5b58\u5927\u9875\u3002\u65b9\u6cd5\u662f\uff1a\u5728 Redis \u5b9e\u4f8b\u8fd0\u884c\u7684\u673a\u5668\u4e0a\u6267\u884c\u5982\u4e0b\u547d\u4ee4: cat /sys/kernel/mm/transparent_hugepage/enabled \u5982\u679c\u6267\u884c\u7ed3\u679c\u662f always\uff0c\u5c31\u8868\u660e\u5185\u5b58\u5927\u9875\u673a\u5236\u88ab\u542f\u52a8\u4e86\uff1b\u5982\u679c\u662f never\uff0c\u5c31\u8868\u793a\uff0c\u5185\u5b58\u5927\u9875\u673a\u5236\u88ab\u7981\u6b62\u3002 \u5728\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e2d\u90e8\u7f72\u65f6\uff0c\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528\u5185\u5b58\u5927\u9875\u673a\u5236\uff0c\u64cd\u4f5c\u4e5f\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u8981\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u5c31\u53ef\u4ee5\u4e86 \uff1a echo never > /sys/kernel/mm/transparent_hugepage/enabled","title":"7-2 \u5173\u95ed\u5185\u5b58\u5927\u9875"},{"location":"chap4/3redis_response/#_1","text":"\u5224\u65ad Redis \u53d8\u6162\u7684\u65b9\u6cd5\uff0c \u4e00\u4e2a\u662f\u770b\u54cd\u5e94\u5ef6\u8fdf\uff0c\u4e00\u4e2a\u662f\u770b\u57fa\u7ebf\u6027\u80fd \u3002\u540c\u65f6\uff0c\u6211\u8fd8\u7ed9\u4e86\u4f60\u4e24\u79cd\u6392\u67e5\u548c\u89e3\u51b3 Redis \u53d8\u6162\u8fd9\u4e2a\u95ee\u9898\u7684\u65b9\u6cd5\uff1a \u4ece\u6162\u67e5\u8be2\u547d\u4ee4\u5f00\u59cb\u6392\u67e5\uff0c\u5e76\u4e14\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u66ff\u6362\u6162\u67e5\u8be2\u547d\u4ee4 \uff1b \u6392\u67e5\u8fc7\u671f key \u7684\u65f6\u95f4\u8bbe\u7f6e\uff0c\u5e76\u6839\u636e\u5b9e\u9645\u4f7f\u7528\u9700\u6c42\uff0c\u8bbe\u7f6e\u4e0d\u540c\u7684\u8fc7\u671f\u65f6\u95f4 \u3002 9 \u4e2a\u68c0\u67e5\u70b9\u7684 Checklist\uff0c\u5e0c\u671b\u4f60\u5728\u9047\u5230 Redis \u6027\u80fd\u53d8\u6162\u65f6\uff0c\u6309\u7167\u8fd9\u4e9b\u6b65\u9aa4\u9010\u4e00\u68c0\u67e5\uff0c\u9ad8\u6548\u5730\u89e3\u51b3\u95ee\u9898: \u83b7\u53d6 Redis \u5b9e\u4f8b\u5728\u5f53\u524d\u73af\u5883\u4e0b\u7684\u57fa\u7ebf\u6027\u80fd\u3002 \u662f\u5426\u7528\u4e86\u6162\u67e5\u8be2\u547d\u4ee4\uff1f\u5982\u679c\u662f\u7684\u8bdd\uff0c\u5c31\u4f7f\u7528\u5176\u4ed6\u547d\u4ee4\u66ff\u4ee3\u6162\u67e5\u8be2\u547d\u4ee4\uff0c\u6216\u8005\u628a\u805a\u5408\u8ba1\u7b97\u547d\u4ee4\u653e\u5728\u5ba2\u6237\u7aef\u505a\u3002 \u662f\u5426\u5bf9\u8fc7\u671f key \u8bbe\u7f6e\u4e86\u76f8\u540c\u7684\u8fc7\u671f\u65f6\u95f4\uff1f \u5bf9\u4e8e\u6279\u91cf\u5220\u9664\u7684 key\uff0c\u53ef\u4ee5\u5728\u6bcf\u4e2a key \u7684\u8fc7\u671f\u65f6\u95f4\u4e0a\u52a0\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u907f\u514d\u540c\u65f6\u5220\u9664 \u3002 \u662f\u5426\u5b58\u5728 bigkey\uff1f \u5bf9\u4e8e bigkey \u7684\u5220\u9664\u64cd\u4f5c\uff0c\u5982\u679c\u4f60\u7684 Redis \u662f 4.0 \u53ca\u4ee5\u4e0a\u7684\u7248\u672c\uff0c\u53ef\u4ee5\u76f4\u63a5\u5229\u7528\u5f02\u6b65\u7ebf\u7a0b\u673a\u5236\u51cf\u5c11\u4e3b\u7ebf\u7a0b\u963b\u585e\uff1b\u5982\u679c\u662f Redis 4.0 \u4ee5\u524d\u7684\u7248\u672c\uff0c \u53ef\u4ee5\u4f7f\u7528 SCAN \u547d\u4ee4\u8fed\u4ee3\u5220\u9664\uff1b\u5bf9\u4e8e bigkey \u7684\u96c6\u5408\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4f7f\u7528 SCAN \u547d\u4ee4\u5728\u5ba2\u6237\u7aef\u5b8c\u6210 \u3002 Redis AOF \u914d\u7f6e\u7ea7\u522b\u662f\u4ec0\u4e48\uff1f\u4e1a\u52a1\u5c42\u9762\u662f\u5426\u7684\u786e\u9700\u8981\u8fd9\u4e00\u53ef\u9760\u6027\u7ea7\u522b\uff1f\u5982\u679c\u6211\u4eec\u9700\u8981\u9ad8\u6027\u80fd\uff0c\u540c\u65f6\u4e5f\u5141\u8bb8\u6570\u636e\u4e22\u5931\uff0c \u53ef\u4ee5\u5c06\u914d\u7f6e\u9879 no-appendfsync-on-rewrite \u8bbe\u7f6e\u4e3a yes \uff0c \u907f\u514d AOF \u91cd\u5199\u548c fsync \u7ade\u4e89\u78c1\u76d8 IO \u8d44\u6e90\uff0c\u5bfc\u81f4 Redis \u5ef6\u8fdf\u589e\u52a0 \u3002\u5f53\u7136\uff0c \u5982\u679c\u65e2\u9700\u8981\u9ad8\u6027\u80fd\u53c8\u9700\u8981\u9ad8\u53ef\u9760\u6027\uff0c\u6700\u597d\u4f7f\u7528\u9ad8\u901f\u56fa\u6001\u76d8\u4f5c\u4e3a AOF \u65e5\u5fd7\u7684\u5199\u5165\u76d8\u3002 Redis \u5b9e\u4f8b\u7684\u5185\u5b58\u4f7f\u7528\u662f\u5426\u8fc7\u5927\uff1f\u53d1\u751f swap \u4e86\u5417\uff1f\u5982\u679c\u662f\u7684\u8bdd\uff0c\u5c31\u589e\u52a0\u673a\u5668\u5185\u5b58\uff0c\u6216\u8005\u662f\u4f7f\u7528 Redis \u96c6\u7fa4\uff0c\u5206\u644a\u5355\u673a Redis \u7684\u952e\u503c\u5bf9\u6570\u91cf\u548c\u5185\u5b58\u538b\u529b\u3002\u540c\u65f6\uff0c\u8981\u907f\u514d\u51fa\u73b0 Redis \u548c\u5176\u4ed6\u5185\u5b58\u9700\u6c42\u5927\u7684\u5e94\u7528\u5171\u4eab\u673a\u5668\u7684\u60c5\u51b5\u3002 \u5728 Redis \u5b9e\u4f8b\u7684\u8fd0\u884c\u73af\u5883\u4e2d\uff0c\u662f\u5426\u542f\u7528\u4e86\u900f\u660e\u5927\u9875\u673a\u5236\uff1f\u5982\u679c\u662f\u7684\u8bdd\uff0c\u76f4\u63a5\u5173\u95ed\u5185\u5b58\u5927\u9875\u673a\u5236\u5c31\u884c\u4e86\u3002 \u662f\u5426\u8fd0\u884c\u4e86 Redis \u4e3b\u4ece\u96c6\u7fa4\uff1f\u5982\u679c\u662f\u7684\u8bdd\uff0c\u628a\u4e3b\u5e93\u5b9e\u4f8b\u7684\u6570\u636e\u91cf\u5927\u5c0f\u63a7\u5236\u5728 2~4GB\uff0c\u4ee5\u514d\u4e3b\u4ece\u590d\u5236\u65f6\uff0c\u4ece\u5e93\u56e0\u52a0\u8f7d\u5927\u7684 RDB \u6587\u4ef6\u800c\u963b\u585e\u3002 \u662f\u5426\u4f7f\u7528\u4e86\u591a\u6838 CPU \u6216 NUMA \u67b6\u6784\u7684\u673a\u5668\u8fd0\u884c Redis \u5b9e\u4f8b\uff1f\u4f7f\u7528\u591a\u6838 CPU \u65f6\uff0c\u53ef\u4ee5\u7ed9 Redis \u5b9e\u4f8b\u7ed1\u5b9a\u7269\u7406\u6838\uff1b\u4f7f\u7528 NUMA \u67b6\u6784\u65f6\uff0c\u6ce8\u610f\u628a Redis \u5b9e\u4f8b\u548c\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u8fd0\u884c\u5728\u540c\u4e00\u4e2a CPU Socket \u4e0a\u3002 \u4ed4\u7ec6\u68c0\u67e5\u4e0b\u6709\u6ca1\u6709\u607c\u4eba\u7684\u201c\u90bb\u5c45\u201d\uff0c\u5177\u4f53\u70b9\u8bf4\uff0c\u5c31\u662f Redis \u6240\u5728\u7684\u673a\u5668\u4e0a\u6709\u6ca1\u6709\u4e00\u4e9b\u5176\u4ed6\u5360\u5185\u5b58\u3001\u78c1\u76d8 IO \u548c\u7f51\u7edc IO \u7684\u7a0b\u5e8f\uff0c\u6bd4\u5982\u8bf4\u6570\u636e\u5e93\u7a0b\u5e8f\u6216\u8005\u6570\u636e\u91c7\u96c6\u7a0b\u5e8f\u3002 \u5982\u679c\u6709\u7684\u8bdd\uff0c\u6211\u5efa\u8bae\u4f60\u5c06\u8fd9\u4e9b\u7a0b\u5e8f\u8fc1\u79fb\u5230\u5176\u4ed6\u673a\u5668\u4e0a\u8fd0\u884c\u3002","title":"\u672c\u8282\u5c0f\u7ed3"},{"location":"chap4/3redis_response/#redis_1","text":"\u4f7f\u7528\u590d\u6742\u5ea6\u8fc7\u9ad8\u7684\u547d\u4ee4\uff08\u4f8b\u5982SORT/SUION/ZUNIONSTORE/KEYS\uff09\uff0c\u6216\u4e00\u6b21\u67e5\u8be2\u5168\u91cf\u6570\u636e\uff08\u4f8b\u5982LRANGE key 0 N\uff0c\u4f46N\u5f88\u5927\uff09 \u5206\u6790\uff1a a) \u67e5\u770bslowlog\u662f\u5426\u5b58\u5728\u8fd9\u4e9b\u547d\u4ee4 b) Redis\u8fdb\u7a0bCPU\u4f7f\u7528\u7387\u662f\u5426\u98d9\u5347\uff08\u805a\u5408\u8fd0\u7b97\u547d\u4ee4\u5bfc\u81f4\uff09 \u89e3\u51b3\uff1a a) \u4e0d\u4f7f\u7528\u590d\u6742\u5ea6\u8fc7\u9ad8\u7684\u547d\u4ee4\uff0c\u6216\u7528\u5176\u4ed6\u65b9\u5f0f\u4ee3\u66ff\u5b9e\u73b0\uff08\u653e\u5728\u5ba2\u6237\u7aef\u505a\uff09 b) \u6570\u636e\u5c3d\u91cf\u5206\u6279\u67e5\u8be2\uff08LRANGE key 0 N\uff0c\u5efa\u8baeN<=100\uff0c\u67e5\u8be2\u5168\u91cf\u6570\u636e\u5efa\u8bae\u4f7f\u7528HSCAN/SSCAN/ZSCAN\uff09 \u64cd\u4f5cbigkey \u5206\u6790\uff1a a) slowlog \u51fa\u73b0\u5f88\u591a SET/DELETE \u53d8\u6162\u547d\u4ee4\uff08bigkey\u5206\u914d\u5185\u5b58\u548c\u91ca\u653e\u5185\u5b58\u53d8\u6162\uff09 b) \u4f7f\u7528 redis-cli -h $host -p $port --bigkeys \u626b\u63cf\u51fa\u5f88\u591a bigkey \u89e3\u51b3\uff1a a) \u4f18\u5316\u4e1a\u52a1\uff0c\u907f\u514d\u5b58\u50a8bigkey b) Redis 4.0+\u53ef\u5f00\u542f lazy-free \u673a\u5236 \u5927\u91cfkey\u96c6\u4e2d\u8fc7\u671f \u5206\u6790\uff1a a) \u4e1a\u52a1\u4f7f\u7528EXPIREAT/PEXPIREAT\u547d\u4ee4 b) Redis info\u4e2d\u7684 expired_keys \u6307\u6807\u77ed\u671f\u7a81\u589e \u89e3\u51b3\uff1a a) \u4f18\u5316\u4e1a\u52a1\uff0c\u8fc7\u671f\u589e\u52a0\u968f\u673a\u65f6\u95f4\uff0c\u628a\u65f6\u95f4\u6253\u6563\uff0c\u51cf\u8f7b\u5220\u9664\u8fc7\u671fkey\u7684\u538b\u529b b) \u8fd0\u7ef4\u5c42\u9762\uff0c\u76d1\u63a7 expired_keys \u6307\u6807\uff0c\u6709\u77ed\u671f\u7a81\u589e\u53ca\u65f6\u62a5\u8b66\u6392\u67e5 Redis\u5185\u5b58\u8fbe\u5230maxmemory \u5206\u6790\uff1a a) \u5b9e\u4f8b\u5185\u5b58\u8fbe\u5230maxmemory\uff0c\u4e14\u5199\u5165\u91cf\u5927\uff0c\u6dd8\u6c70key\u538b\u529b\u53d8\u5927 b) Redis info\u4e2d\u7684 evicted_keys \u6307\u6807\u77ed\u671f\u7a81\u589e \u89e3\u51b3\uff1a a) \u4e1a\u52a1\u5c42\u9762\uff0c\u6839\u636e\u60c5\u51b5\u8c03\u6574\u6dd8\u6c70\u7b56\u7565\uff08\u968f\u673a\u6bd4LRU\u5feb\uff09 b) \u8fd0\u7ef4\u5c42\u9762\uff0c\u76d1\u63a7evicted_keys\u6307\u6807\uff0c\u6709\u77ed\u671f\u7a81\u589e\u53ca\u65f6\u62a5\u8b66 c) \u96c6\u7fa4\u6269\u5bb9\uff0c\u591a\u4e2a\u5b9e\u4f8b\u51cf\u8f7b\u6dd8\u6c70key\u7684\u538b\u529b \u5927\u91cf\u77ed\u8fde\u63a5\u8bf7\u6c42 \u5206\u6790\uff1aRedis\u5904\u7406\u5927\u91cf\u77ed\u8fde\u63a5\u8bf7\u6c42\uff0cTCP\u4e09\u6b21\u63e1\u624b\u548c\u56db\u6b21\u6325\u624b\u4e5f\u4f1a\u589e\u52a0\u8017\u65f6 \u89e3\u51b3\uff1a\u4f7f\u7528\u957f\u8fde\u63a5\u64cd\u4f5cRedis \u751f\u6210RDB\u548cAOF\u91cd\u5199fork\u8017\u65f6\u4e25\u91cd \u5206\u6790\uff1a a) Redis\u53d8\u6162\u53ea\u53d1\u751f\u5728\u751f\u6210RDB\u548cAOF\u91cd\u5199\u671f\u95f4 b) \u5b9e\u4f8b\u5360\u7528\u5185\u5b58\u8d8a\u5927\uff0cfork\u62f7\u8d1d\u5185\u5b58\u9875\u8868\u8d8a\u4e45 c) Redis info\u4e2d latest_fork_usec \u8017\u65f6\u53d8\u957f \u89e3\u51b3\uff1a a) \u5b9e\u4f8b\u5c3d\u91cf\u5c0f b) Redis\u5c3d\u91cf\u90e8\u7f72\u5728\u7269\u7406\u673a\u4e0a c) \u4f18\u5316\u5907\u4efd\u7b56\u7565\uff08\u4f8b\u5982\u4f4e\u5cf0\u671f\u5907\u4efd\uff09 d) \u5408\u7406\u914d\u7f6e repl-backlog \u548c slave client-output-buffer-limit \uff0c\u907f\u514d\u4e3b\u4ece\u5168\u91cf\u540c\u6b65 e) \u89c6\u60c5\u51b5\u8003\u8651\u5173\u95edAOF f) \u76d1\u63a7 latest_fork_usec \u8017\u65f6\u662f\u5426\u53d8\u957f AOF\u4f7f\u7528 awalys \u673a\u5236 \u5206\u6790\uff1a\u78c1\u76d8IO\u8d1f\u8f7d\u53d8\u9ad8 \u89e3\u51b3\uff1a a) \u4f7f\u7528everysec\u673a\u5236 b) \u4e22\u5931\u6570\u636e\u4e0d\u654f\u611f\u7684\u4e1a\u52a1\u4e0d\u5f00\u542fAOF \u4f7f\u7528Swap \u5206\u6790\uff1a a) \u6240\u6709\u8bf7\u6c42\u5168\u90e8\u5f00\u59cb\u53d8\u6162 b) slowlog\u5927\u91cf\u6162\u65e5\u5fd7 c) \u67e5\u770bRedis\u8fdb\u7a0b\u662f\u5426\u4f7f\u7528\u5230\u4e86Swap \u89e3\u51b3\uff1a a) \u589e\u52a0\u673a\u5668\u5185\u5b58 b) \u96c6\u7fa4\u6269\u5bb9 c) Swap\u4f7f\u7528\u65f6\u76d1\u63a7\u62a5\u8b66 \u8fdb\u7a0b\u7ed1\u5b9aCPU\u4e0d\u5408\u7406 \u5206\u6790 a) Redis\u8fdb\u7a0b\u53ea\u7ed1\u5b9a\u4e00\u4e2aCPU\u903b\u8f91\u6838 b) NUMA\u67b6\u6784\u4e0b\uff0c\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u548cRedis\u8fdb\u7a0b\u6ca1\u6709\u7ed1\u5b9a\u5728\u540c\u4e00\u4e2aSocket\u4e0b \u89e3\u51b3 a) Redis\u8fdb\u7a0b\u7ed1\u5b9a\u591a\u4e2aCPU\u903b\u8f91\u6838 b) \u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u548cRedis\u8fdb\u7a0b\u7ed1\u5b9a\u5728\u540c\u4e00\u4e2aSocket\u4e0b \u5f00\u542f\u900f\u660e\u5927\u9875\u673a\u5236 \u5206\u6790\uff1a\u751f\u6210RDB\u548cAOF\u91cd\u5199\u671f\u95f4\uff0c\u4e3b\u7ebf\u7a0b\u5904\u7406\u5199\u8bf7\u6c42\u8017\u65f6\u53d8\u957f\uff08\u62f7\u8d1d\u5185\u5b58\u526f\u672c\u8017\u65f6\u53d8\u957f\uff09 \u89e3\u51b3\uff1a\u5173\u95ed\u900f\u660e\u5927\u9875\u673a\u5236 \u7f51\u5361\u8d1f\u8f7d\u8fc7\u9ad8 \u5206\u6790\uff1a a) TCP/IP\u5c42\u5ef6\u8fdf\u53d8\u5927\uff0c\u4e22\u5305\u91cd\u4f20\u53d8\u591a b) \u662f\u5426\u5b58\u5728\u6d41\u91cf\u8fc7\u5927\u7684\u5b9e\u4f8b\u5360\u6ee1\u5e26\u5bbd \u89e3\u51b3\uff1a a) \u673a\u5668\u7f51\u7edc\u8d44\u6e90\u76d1\u63a7\uff0c\u8d1f\u8f7d\u8fc7\u9ad8\u53ca\u65f6\u62a5\u8b66 b) \u63d0\u524d\u89c4\u5212\u90e8\u7f72\u7b56\u7565\uff0c\u8bbf\u95ee\u91cf\u5927\u7684\u5b9e\u4f8b\u9694\u79bb\u90e8\u7f72 \u603b\u4e4b\uff0cRedis\u7684\u6027\u80fd\u4e0eCPU\u3001\u5185\u5b58\u3001\u7f51\u7edc\u3001\u78c1\u76d8\u90fd\u606f\u606f\u76f8\u5173\uff0c\u4efb\u4f55\u4e00\u5904\u53d1\u751f\u95ee\u9898\uff0c\u90fd\u4f1a\u5f71\u54cd\u5230Redis\u7684\u6027\u80fd\u3002","title":"\u5206\u6790\u3001\u6392\u67e5\u3001\u89e3\u51b3Redis\u53d8\u6162\u95ee\u9898"},{"location":"chap4/3redis_response/#_2","text":"\u901a\u8fc7 redis-cli --intrinsic-latency 120 \u53ef\u4ee5\u5f97\u77e5redis\u7684\u57fa\u51c6\u7ebf\u3002\u540e\u7eed\u53ef\u4ee5\u6839\u636e\u57fa\u51c6\u7ebf\u7684\u54cd\u5e94\u901f\u5ea6\u8fdb\u884c\u5224\u65ad\u662f\u5426\u67e5\u8be2\u6162 \u57fa\u4e8e\u81ea\u5df1\u5bf9 Redis \u672c\u8eab\u7684\u5de5\u4f5c\u539f\u7406\u7684\u7406\u89e3\uff0c\u5e76\u4e14\u7ed3\u5408\u548c\u5b83\u4ea4\u4e92\u7684\u64cd\u4f5c\u7cfb\u7edf\u3001\u5b58\u50a8\u4ee5\u53ca\u7f51\u7edc\u7b49\u5916\u90e8\u7cfb\u7edf\u5173\u952e\u673a\u5236\uff0c\u518d\u501f\u52a9\u4e00\u4e9b\u8f85\u52a9\u5de5\u5177\u6765\u5b9a\u4f4d\u539f\u56e0\uff0c\u5e76\u5236\u5b9a\u884c\u4e4b\u6709\u6548\u7684\u89e3\u51b3\u65b9\u6848 Redis \u81ea\u8eab\u64cd\u4f5c\u7279\u6027\u7684\u5f71\u54cd \u6162\u67e5\u8be2\u547d\u4ee4\uff1a\u547d\u4ee4\u64cd\u4f5c\u7684\u590d\u6742\u5ea6\u6709\u5173 \u6392\u67e5\u65b9\u6cd5\uff1a\u901a\u8fc7 Redis \u65e5\u5fd7\uff0c\u6216\u8005\u662f latency monitor \u5de5\u5177\uff0c\u67e5\u8be2\u53d8\u6162\u7684\u8bf7\u6c42 \u89e3\u51b3\u65b9\u6cd5\uff1a \u7528\u5176\u4ed6\u9ad8\u6548\u547d\u4ee4\u4ee3\u66ff\u3002\u5982\u4e0d\u8981\u4f7f\u7528keys\u67e5\u8be2\u6240\u6709key\uff0c\u53ef\u4ee5\u4f7f\u7528scan\u8fdb\u884c\u67e5\u8be2\uff0c\u4e0d\u4f1a\u963b\u585e\u7ebf\u7a0b \u5f53\u4f60\u9700\u8981\u6267\u884c\u6392\u5e8f\u3001\u4ea4\u96c6\u3001\u5e76\u96c6\u64cd\u4f5c\u65f6\uff0c\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u5b8c\u6210\uff0c\u800c\u4e0d\u8981\u7528 SORT\u3001SUNION\u3001SINTER \u8fd9\u4e9b\u547d\u4ee4\uff0c\u4ee5\u514d\u62d6\u6162 Redis \u5b9e\u4f8b\u3002 \u8fc7\u671f key \u64cd\u4f5c\uff1aredis\u672c\u8eab\u7684\u5185\u5b58\u56de\u6536\u673a\u5236\u4f1a\u9020\u6210redis\u64cd\u4f5c\u963b\u585e\uff0c\u5bfc\u81f4\u6027\u80fd\u53d8\u6162\uff08Redis 4.0 \u540e\u53ef\u4ee5\u7528\u5f02\u6b65\u7ebf\u7a0b\u673a\u5236\u6765\u51cf\u5c11\u963b\u585e\u5f71\u54cd\uff09 \u5bfc\u81f4\u539f\u56e0\uff1a\u5927\u6279\u91cf\u7684key\u540c\u65f6\u95f4\u5185\u8fc7\u671f\uff0c\u5bfc\u81f4\u5220\u9664\u8fc7\u671fkey\u7684\u673a\u5236\u4e00\u76f4\u89e6\u53d1\uff0c\u5f15\u8d77redis\u64cd\u4f5c\u963b\u585e \u89e3\u51b3\u65b9\u6cd5\uff1a\u5bf9key\u8bbe\u5b9a\u8fc7\u671f\u65f6\u95f4\u65f6\uff0c\u6dfb\u52a0\u4e00\u4e2a\u5220\u9664\u7684\u65f6\u95f4\u968f\u673a\u6570\uff0c\u80fd\u907f\u514dkey\u5b58\u5728\u540c\u4e00\u65f6\u95f4\u8fc7\u671f redis\u5220\u9664\u8fc7\u671fkey\u7684\u673a\u5236\uff0c\u6bcf100\u6beb\u79d2\u5bf9\u4e00\u4e9bkey\u8fdb\u884c\u5220\u9664\u3002\u7b97\u6cd5\u5982\u4e0b \u91c7\u6837 ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP \u4e2a\u6570\u7684 key\uff0c\u5e76\u5c06\u5176\u4e2d\u8fc7\u671f\u7684 key \u5168\u90e8\u5220\u9664\uff1b \u679c\u8d85\u8fc7 25% \u7684 key \u8fc7\u671f\u4e86\uff0c\u5219\u91cd\u590d\u5220\u9664\u7684\u8fc7\u7a0b\uff0c\u76f4\u5230\u8fc7\u671f key \u7684\u6bd4\u4f8b\u964d\u81f3 25% \u4ee5\u4e0b\u3002","title":"\u8981\u70b9&amp;\u4eae\u70b9"},{"location":"chap4/4redis_fragmentation/","text":"\u7b2c\u56db\u8282 \u5220\u9664\u6570\u636e\u540e\uff0c\u5185\u5b58\u5360\u7528\u7387\u8fd8\u662f\u5f88\u9ad8 \u660e\u660e\u505a\u4e86\u6570\u636e\u5220\u9664\uff0c\u6570\u636e\u91cf\u5df2\u7ecf\u4e0d\u5927\u4e86\uff0c\u4e3a\u4ec0\u4e48\u4f7f\u7528 top \u547d\u4ee4\u67e5\u770b\u65f6\uff0c\u8fd8\u4f1a\u53d1\u73b0 Redis \u5360\u7528\u4e86\u5f88\u591a\u5185\u5b58\u5462\uff1f \u8fd9\u662f\u56e0\u4e3a\uff0c\u5f53\u6570\u636e\u5220\u9664\u540e\uff0c Redis \u91ca\u653e\u7684\u5185\u5b58\u7a7a\u95f4\u4f1a\u7531\u5185\u5b58\u5206\u914d\u5668\u7ba1\u7406\uff0c\u5e76\u4e0d\u4f1a\u7acb\u5373\u8fd4\u56de\u7ed9\u64cd\u4f5c\u7cfb\u7edf \u3002\u6240\u4ee5\uff0c \u64cd\u4f5c\u7cfb\u7edf\u4ecd\u7136\u4f1a\u8bb0\u5f55\u7740\u7ed9 Redis \u5206\u914d\u4e86\u5927\u91cf\u5185\u5b58 \u3002 \u6f5c\u5728\u7684\u98ce\u9669\u70b9\uff1a Redis \u91ca\u653e\u7684\u5185\u5b58\u7a7a\u95f4\u53ef\u80fd\u5e76\u4e0d\u662f\u8fde\u7eed\u7684\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e9b\u4e0d\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u5f88\u6709\u53ef\u80fd\u5904\u4e8e\u4e00\u79cd\u95f2\u7f6e\u7684\u72b6\u6001\u3002 \u8fd9\u5c31\u4f1a\u5bfc\u81f4\u4e00\u4e2a\u95ee\u9898\uff1a \u867d\u7136\u6709\u7a7a\u95f2\u7a7a\u95f4\uff0cRedis \u5374\u65e0\u6cd5\u7528\u6765\u4fdd\u5b58\u6570\u636e\uff0c\u4e0d\u4ec5\u4f1a\u51cf\u5c11 Redis \u80fd\u591f\u5b9e\u9645\u4fdd\u5b58\u7684\u6570\u636e\u91cf\uff0c\u8fd8\u4f1a\u964d\u4f4e Redis \u8fd0\u884c\u673a\u5668\u7684\u6210\u672c\u56de\u62a5\u7387 \u3002 1\u3001\u4ec0\u4e48\u662f\u5185\u5b58\u788e\u7247\uff1f \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5185\u5b58\u7a7a\u95f4\u95f2\u7f6e\uff0c\u5f80\u5f80\u662f\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u53d1\u751f\u4e86\u8f83\u4e3a\u4e25\u91cd\u7684\u5185\u5b58\u788e\u7247\u3002 \u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e9b\u5206\u6563\u7684\u7a7a\u5ea7\u4f4d\u53eb\u4f5c\u201c\u8f66\u53a2\u5ea7\u4f4d\u788e\u7247\u201d\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58\u788e\u7247\u5c31\u5f88\u5bb9\u6613\u7406\u89e3\u4e86\u3002 \u867d\u7136\u64cd\u4f5c\u7cfb\u7edf\u7684\u5269\u4f59\u5185\u5b58\u7a7a\u95f4\u603b\u91cf\u8db3\u591f\uff0c\u4f46\u662f\uff0c\u5e94\u7528\u7533\u8bf7\u7684\u662f\u4e00\u5757\u8fde\u7eed\u5730\u5740\u7a7a\u95f4\u7684 N \u5b57\u8282\uff0c\u4f46\u5728\u5269\u4f59\u7684\u5185\u5b58\u7a7a\u95f4\u4e2d\uff0c\u6ca1\u6709\u5927\u5c0f\u4e3a N \u5b57\u8282\u7684\u8fde\u7eed\u7a7a\u95f4\u4e86\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e9b\u5269\u4f59\u7a7a\u95f4\u5c31\u662f\u5185\u5b58\u788e\u7247\uff08\u6bd4\u5982\u4e0a\u56fe\u4e2d\u7684\u201c\u7a7a\u95f2 2 \u5b57\u8282\u201d\u548c\u201c\u7a7a\u95f2 1 \u5b57\u8282\u201d\uff0c\u5c31\u662f\u8fd9\u6837\u7684\u788e\u7247\uff09\u3002 2\u3001\u5185\u5b58\u788e\u7247\u662f\u5982\u4f55\u5f62\u6210\u7684\uff1f \u5185\u5b58\u788e\u7247\u7684\u5f62\u6210\u6709\u5185\u56e0\u548c\u5916\u56e0\u4e24\u4e2a\u5c42\u9762\u7684\u539f\u56e0\u3002\u7b80\u5355\u6765\u8bf4\uff0c \u5185\u56e0\u662f\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58\u5206\u914d\u673a\u5236\uff0c\u5916\u56e0\u662f Redis \u7684\u8d1f\u8f7d\u7279\u5f81\u3002 2-1 \u5185\u56e0\uff1a\u5185\u5b58\u5206\u914d\u5668\u7684\u5206\u914d\u7b56\u7565 \u5185\u5b58\u5206\u914d\u5668\u7684\u5206\u914d\u7b56\u7565\u5c31\u51b3\u5b9a\u4e86\u64cd\u4f5c\u7cfb\u7edf\u65e0\u6cd5\u505a\u5230\u201c\u6309\u9700\u5206\u914d\u201d \u3002\u8fd9\u662f\u56e0\u4e3a\uff0c\u5185\u5b58\u5206\u914d\u5668\u4e00\u822c\u662f\u6309\u56fa\u5b9a\u5927\u5c0f\u6765\u5206\u914d\u5185\u5b58\uff0c\u800c\u4e0d\u662f\u5b8c\u5168\u6309\u7167\u5e94\u7528\u7a0b\u5e8f\u7533\u8bf7\u7684\u5185\u5b58\u7a7a\u95f4\u5927\u5c0f\u7ed9\u7a0b\u5e8f\u5206\u914d\u3002 Redis \u53ef\u4ee5\u4f7f\u7528 libc\u3001jemalloc\u3001tcmalloc \u591a\u79cd\u5185\u5b58\u5206\u914d\u5668\u6765\u5206\u914d\u5185\u5b58\uff0c\u9ed8\u8ba4\u4f7f\u7528 jemalloc \u3002\u63a5\u4e0b\u6765\uff0c\u4ee5 jemalloc \u4e3a\u4f8b\uff0c\u6765\u5177\u4f53\u89e3\u91ca\u4e00\u4e0b\u3002\u5176\u4ed6\u5206\u914d\u5668\u4e5f\u5b58\u5728\u7c7b\u4f3c\u7684\u95ee\u9898\u3002 jemalloc \u7684\u5206\u914d\u7b56\u7565\u4e4b\u4e00\uff0c\u662f\u6309\u7167\u4e00\u7cfb\u5217\u56fa\u5b9a\u7684\u5927\u5c0f\u5212\u5206\u5185\u5b58\u7a7a\u95f4 \uff0c\u4f8b\u5982 8 \u5b57\u8282\u300116 \u5b57\u8282\u300132 \u5b57\u8282\u300148 \u5b57\u8282\uff0c\u2026, 2KB\u30014KB\u30018KB \u7b49\u3002\u5f53\u7a0b\u5e8f\u7533\u8bf7\u7684\u5185\u5b58\u6700\u63a5\u8fd1\u67d0\u4e2a\u56fa\u5b9a\u503c\u65f6\uff0cjemalloc \u4f1a\u7ed9\u5b83\u5206\u914d\u76f8\u5e94\u5927\u5c0f\u7684\u7a7a\u95f4\u3002 \u8fd9\u6837\u7684\u5206\u914d\u65b9\u5f0f\u672c\u8eab\u662f\u4e3a\u4e86\u51cf\u5c11\u5206\u914d\u6b21\u6570\u3002 \u4f8b\u5982\uff0cRedis \u7533\u8bf7\u4e00\u4e2a 20 \u5b57\u8282\u7684\u7a7a\u95f4\u4fdd\u5b58\u6570\u636e\uff0cjemalloc \u5c31\u4f1a\u5206\u914d 32 \u5b57\u8282 \uff0c\u6b64\u65f6\uff0c\u5982\u679c\u5e94\u7528\u8fd8\u8981\u5199\u5165 10 \u5b57\u8282\u7684\u6570\u636e\uff0cRedis \u5c31\u4e0d\u7528\u518d\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u7a7a\u95f4\u4e86\uff0c\u56e0\u4e3a\u521a\u624d\u5206\u914d\u7684 32 \u5b57\u8282\u5df2\u7ecf\u591f\u7528\u4e86\uff0c\u8fd9\u5c31\u907f\u514d\u4e86\u4e00\u6b21\u5206\u914d\u64cd\u4f5c\u3002 \u4f46\u662f\uff0c\u5982\u679c Redis \u6bcf\u6b21\u5411\u5206\u914d\u5668\u7533\u8bf7\u7684\u5185\u5b58\u7a7a\u95f4\u5927\u5c0f\u4e0d\u4e00\u6837\uff0c\u8fd9\u79cd\u5206\u914d\u65b9\u5f0f\u5c31\u4f1a\u6709\u5f62\u6210\u788e\u7247\u7684\u98ce\u9669\uff0c\u800c\u8fd9\u6b63\u597d\u6765\u6e90\u4e8e Redis \u7684\u5916\u56e0\u4e86\u3002 2-2 \u5916\u56e0\uff1a\u952e\u503c\u5bf9\u5927\u5c0f\u4e0d\u4e00\u6837\u548c\u5220\u6539\u64cd\u4f5c Redis \u901a\u5e38\u4f5c\u4e3a\u5171\u7528\u7684\u7f13\u5b58\u7cfb\u7edf\u6216\u952e\u503c\u6570\u636e\u5e93\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1 \uff0c\u6240\u4ee5\uff0c\u4e0d\u540c\u4e1a\u52a1\u5e94\u7528\u7684\u6570\u636e\u90fd\u53ef\u80fd\u4fdd\u5b58\u5728 Redis \u4e2d\uff0c\u8fd9\u5c31\u4f1a\u5e26\u6765\u4e0d\u540c\u5927\u5c0f\u7684\u952e\u503c\u5bf9\u3002 \u8fd9\u6837\u4e00\u6765\uff0cRedis \u7533\u8bf7\u5185\u5b58\u7a7a\u95f4\u5206\u914d\u65f6\uff0c\u672c\u8eab\u5c31\u4f1a\u6709\u5927\u5c0f\u4e0d\u4e00\u7684\u7a7a\u95f4\u9700\u6c42\u3002\u8fd9\u662f\u7b2c\u4e00\u4e2a\u5916\u56e0\u3002 \u5185\u5b58\u5206\u914d\u5668\u53ea\u80fd\u6309\u56fa\u5b9a\u5927\u5c0f\u5206\u914d\u5185\u5b58\uff0c\u6240\u4ee5\uff0c\u5206\u914d\u7684\u5185\u5b58\u7a7a\u95f4\u4e00\u822c\u90fd\u4f1a\u6bd4\u7533\u8bf7\u7684\u7a7a\u95f4\u5927\u4e00\u4e9b\uff0c\u4e0d\u4f1a\u5b8c\u5168\u4e00\u81f4\uff0c\u8fd9\u672c\u8eab\u5c31\u4f1a\u9020\u6210\u4e00\u5b9a\u7684\u788e\u7247\uff0c\u964d\u4f4e\u5185\u5b58\u7a7a\u95f4\u5b58\u50a8\u6548\u7387\u3002 \u6bd4\u5982\u8bf4\uff0c\u5e94\u7528 A \u4fdd\u5b58 6 \u5b57\u8282\u6570\u636e\uff0cjemalloc \u6309\u5206\u914d\u7b56\u7565\u5206\u914d 8 \u5b57\u8282\u3002\u5982\u679c\u5e94\u7528 A \u4e0d\u518d\u4fdd\u5b58\u65b0\u6570\u636e\uff0c\u90a3\u4e48\uff0c\u8fd9\u91cc\u591a\u51fa\u6765\u7684 2 \u5b57\u8282\u7a7a\u95f4\u5c31\u662f\u5185\u5b58\u788e\u7247\u4e86\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u7b2c\u4e8c\u4e2a\u5916\u56e0\u662f\uff0c\u8fd9\u4e9b\u952e\u503c\u5bf9\u4f1a\u88ab\u4fee\u6539\u548c\u5220\u9664\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u7a7a\u95f4\u7684\u6269\u5bb9\u548c\u91ca\u653e\u3002 \u5177\u4f53\u6765\u8bf4\uff0c \u4e00\u65b9\u9762\uff0c\u5982\u679c\u4fee\u6539\u540e\u7684\u952e\u503c\u5bf9\u53d8\u5927\u6216\u53d8\u5c0f\u4e86\uff0c \u5c31\u9700\u8981\u5360\u7528\u989d\u5916\u7684\u7a7a\u95f4\u6216\u8005\u91ca\u653e\u4e0d\u7528\u7684\u7a7a\u95f4 \u3002 \u53e6\u4e00\u65b9\u9762\uff0c\u5220\u9664\u7684\u952e\u503c\u5bf9\u5c31\u4e0d\u518d\u9700\u8981\u5185\u5b58\u7a7a\u95f4\u4e86\uff0c\u6b64\u65f6\uff0c \u5c31\u4f1a\u628a\u7a7a\u95f4\u91ca\u653e\u51fa\u6765\uff0c\u5f62\u6210\u7a7a\u95f2\u7a7a\u95f4 \u3002 \u4e00\u5f00\u59cb\uff0c\u5e94\u7528 A\u3001B\u3001C\u3001D \u5206\u522b\u4fdd\u5b58\u4e86 3\u30011\u30012\u30014 \u5b57\u8282\u7684\u6570\u636e\uff0c\u5e76\u5360\u636e\u4e86\u76f8\u5e94\u7684\u5185\u5b58\u7a7a\u95f4\u3002 \u7136\u540e\uff0c\u5e94\u7528 D \u5220\u9664\u4e86 1 \u4e2a\u5b57\u8282\uff0c\u8fd9\u4e2a 1 \u5b57\u8282\u7684\u5185\u5b58\u7a7a\u95f4\u5c31\u7a7a\u51fa\u6765\u4e86\u3002 \u7d27\u63a5\u7740\uff0c\u5e94\u7528 A \u4fee\u6539\u4e86\u6570\u636e\uff0c\u4ece 3 \u5b57\u8282\u53d8\u6210\u4e86 4 \u5b57\u8282\u3002 \u4e3a\u4e86\u4fdd\u6301 A \u6570\u636e\u7684\u7a7a\u95f4\u8fde\u7eed\u6027\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c31\u9700\u8981\u628a B \u7684\u6570\u636e\u62f7\u8d1d\u5230\u522b\u7684\u7a7a\u95f4\uff0c\u6bd4\u5982\u62f7\u8d1d\u5230 D \u521a\u521a\u91ca\u653e\u7684\u7a7a\u95f4\u4e2d\u3002 \u6b64\u65f6\uff0c\u5e94\u7528 C \u548c D \u4e5f\u5206\u522b\u5220\u9664\u4e86 2 \u5b57\u8282\u548c 1 \u5b57\u8282\u7684\u6570\u636e\uff0c\u6574\u4e2a\u5185\u5b58\u7a7a\u95f4\u4e0a\u5c31\u5206\u522b\u51fa\u73b0\u4e86 2 \u5b57\u8282\u548c 1 \u5b57\u8282\u7684\u7a7a\u95f2\u788e\u7247\u3002 \u5982\u679c\u5e94\u7528 E \u60f3\u8981\u4e00\u4e2a 3 \u5b57\u8282\u7684\u8fde\u7eed\u7a7a\u95f4\uff0c\u663e\u7136\u662f\u4e0d\u80fd\u5f97\u5230\u6ee1\u8db3\u7684\u3002\u56e0\u4e3a\uff0c\u867d\u7136\u7a7a\u95f4\u603b\u91cf\u591f\uff0c\u4f46\u5374\u662f\u788e\u7247\u7a7a\u95f4\uff0c\u5e76\u4e0d\u662f\u8fde\u7eed\u7684\u3002 \u597d\u4e86\uff0c\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u5c31\u77e5\u9053\u4e86\u9020\u6210\u5185\u5b58\u788e\u7247\u7684\u5185\u5916\u56e0\u7d20\uff0c\u5176\u4e2d\uff0c\u5185\u5b58\u5206\u914d\u5668\u7b56\u7565\u662f\u5185\u56e0\uff0c\u800c Redis \u7684\u8d1f\u8f7d\u5c5e\u4e8e\u5916\u56e0\uff0c\u5305\u62ec\u4e86\u5927\u5c0f\u4e0d\u4e00\u7684\u952e\u503c\u5bf9\u548c\u952e\u503c\u5bf9\u4fee\u6539\u5220\u9664\u5e26\u6765\u7684\u5185\u5b58\u7a7a\u95f4\u53d8\u5316\u3002 \u5927\u91cf\u5185\u5b58\u788e\u7247\u7684\u5b58\u5728\uff0c\u4f1a\u9020\u6210 Redis \u7684\u5185\u5b58\u5b9e\u9645\u5229\u7528\u7387\u53d8\u4f4e\uff0c\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u8981\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u4e86\u3002\u4e0d\u8fc7\uff0c\u5728\u89e3\u51b3\u95ee\u9898\u524d\uff0c\u6211\u4eec\u8981\u5148\u5224\u65ad Redis \u8fd0\u884c\u8fc7\u7a0b\u4e2d\u662f\u5426\u5b58\u5728\u5185\u5b58\u788e\u7247\u3002 3\u3001\u5982\u4f55\u5224\u65ad\u662f\u5426\u6709\u5185\u5b58\u788e\u7247\uff1f Redis \u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u5185\u5b58\u5229\u7528\u7387\u7684\u9ad8\u4f4e\u76f4\u63a5\u5173\u7cfb\u5230 Redis \u8fd0\u884c\u6548\u7387\u7684\u9ad8\u4f4e\u3002\u4e3a\u4e86\u8ba9\u7528\u6237\u80fd\u76d1\u63a7\u5230\u5b9e\u65f6\u7684\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\uff0cRedis \u81ea\u8eab\u63d0\u4f9b\u4e86 INFO \u547d\u4ee4\uff0c\u53ef\u4ee5\u7528\u6765\u67e5\u8be2\u5185\u5b58\u4f7f\u7528\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a INFO memory # Memory used_memory:1073741736 used_memory_human:1024.00M used_memory_rss:1997159792 used_memory_rss_human:1.86G \u2026 mem_fragmentation_ratio:1.86 \u8fd9\u91cc\u6709\u4e00\u4e2a mem_fragmentation_ratio \u7684\u6307\u6807\uff0c\u5b83\u8868\u793a\u7684\u5c31\u662f Redis \u5f53\u524d\u7684\u5185\u5b58\u788e\u7247\u7387\u3002 \u90a3\u4e48\uff0c\u8fd9\u4e2a\u788e\u7247\u7387\u662f\u600e\u4e48\u8ba1\u7b97\u7684\u5462\uff1f\u5176\u5b9e\uff0c\u5c31\u662f\u4e0a\u9762\u7684\u547d\u4ee4\u4e2d\u7684\u4e24\u4e2a\u6307\u6807 used_memory_rss \u548c used_memory \u76f8\u9664\u7684\u7ed3\u679c\u3002 mem_fragmentation_ratio = used_memory_rss/ used_memory used_memory_rss \u662f\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u9645\u5206\u914d\u7ed9 Redis \u7684\u7269\u7406\u5185\u5b58\u7a7a\u95f4\uff0c\u91cc\u9762\u5c31\u5305\u542b\u4e86\u788e\u7247\uff1b \u800c used_memory \u662f Redis \u4e3a\u4e86\u4fdd\u5b58\u6570\u636e\u5b9e\u9645\u7533\u8bf7\u4f7f\u7528\u7684\u7a7a\u95f4\u3002 \u6211\u7b80\u5355\u4e3e\u4e2a\u4f8b\u5b50\u3002\u4f8b\u5982\uff0cRedis \u7533\u8bf7\u4f7f\u7528\u4e86 100 \u5b57\u8282\uff08used_memory\uff09\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u9645\u5206\u914d\u4e86 128 \u5b57\u8282\uff08 used_memory_rss \uff09\uff0c\u6b64\u65f6\uff0c mem_fragmentation_ratio \u5c31\u662f 1.28 \u3002 mem_fragmentation_ratio \u5927\u4e8e 1 \u4f46\u5c0f\u4e8e 1.5\u3002\u8fd9\u79cd\u60c5\u51b5\u662f\u5408\u7406\u7684 \u3002\u8fd9\u662f\u56e0\u4e3a\uff0c\u521a\u624d\u6211\u4ecb\u7ecd\u7684\u90a3\u4e9b\u56e0\u7d20\u662f\u96be\u4ee5\u907f\u514d\u7684\u3002\u6bd5\u7adf\uff0c\u5185\u56e0\u7684\u5185\u5b58\u5206\u914d\u5668\u662f\u4e00\u5b9a\u8981\u4f7f\u7528\u7684\uff0c\u5206\u914d\u7b56\u7565\u90fd\u662f\u901a\u7528\u7684\uff0c \u4e0d\u4f1a\u8f7b\u6613\u4fee\u6539\uff1b\u800c\u5916\u56e0\u7531 Redis \u8d1f\u8f7d\u51b3\u5b9a\uff0c\u4e5f\u65e0\u6cd5\u9650\u5236\u3002\u6240\u4ee5\uff0c\u5b58\u5728\u5185\u5b58\u788e\u7247\u4e5f\u662f\u6b63\u5e38\u7684 \u3002 mem_fragmentation_ratio \u5927\u4e8e 1.5 \u3002\u8fd9\u8868\u660e\u5185\u5b58\u788e\u7247\u7387\u5df2\u7ecf\u8d85\u8fc7\u4e86 50%\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u9700\u8981\u91c7\u53d6\u4e00\u4e9b\u63aa\u65bd\u6765\u964d\u4f4e\u5185\u5b58\u788e\u7247\u7387\u4e86\u3002 4\u3001\u5982\u4f55\u6e05\u7406\u5185\u5b58\u788e\u7247\uff1f \u5f53 Redis \u53d1\u751f\u5185\u5b58\u788e\u7247\u540e\uff0c\u4e00\u4e2a\u201c\u7b80\u5355\u7c97\u66b4\u201d\u7684\u65b9\u6cd5\u5c31\u662f \u91cd\u542f Redis \u5b9e\u4f8b \u3002\u5f53\u7136\uff0c\u8fd9\u5e76\u4e0d\u662f\u4e00\u4e2a\u201c\u4f18\u96c5\u201d\u7684\u65b9\u6cd5\uff0c\u6bd5\u7adf\uff0c\u91cd\u542f Redis \u4f1a\u5e26\u6765\u4e24\u4e2a\u540e\u679c\uff1a \u5982\u679c Redis \u4e2d\u7684\u6570\u636e\u6ca1\u6709\u6301\u4e45\u5316\uff0c\u90a3\u4e48\uff0c\u6570\u636e\u5c31\u4f1a\u4e22\u5931\uff1b \u5373\u4f7f Redis \u6570\u636e\u6301\u4e45\u5316\u4e86\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u901a\u8fc7 AOF \u6216 RDB \u8fdb\u884c\u6062\u590d\uff0c\u6062\u590d\u65f6\u957f\u53d6\u51b3\u4e8e AOF \u6216 RDB \u7684\u5927\u5c0f\uff0c\u5982\u679c\u53ea\u6709\u4e00\u4e2a Redis \u5b9e\u4f8b\uff0c\u6062\u590d\u9636\u6bb5\u65e0\u6cd5\u63d0\u4f9b\u670d\u52a1\u3002 4-1 \u5185\u5b58\u788e\u7247\u6e05\u7406 \u5e78\u8fd0\u7684\u662f\uff0c\u4ece 4.0-RC3 \u7248\u672c\u4ee5\u540e\uff0cRedis \u81ea\u8eab\u63d0\u4f9b\u4e86\u4e00\u79cd\u5185\u5b58\u788e\u7247\u81ea\u52a8\u6e05\u7406\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u5148\u6765\u770b\u8fd9\u4e2a\u65b9\u6cd5\u7684\u57fa\u672c\u673a\u5236\u3002 \u5185\u5b58\u788e\u7247\u6e05\u7406\uff0c\u7b80\u5355\u6765\u8bf4\uff0c\u5c31\u662f\u201c\u642c\u5bb6\u8ba9\u4f4d\uff0c\u5408\u5e76\u7a7a\u95f4\u201d\u3002 \u5f53\u6709\u6570\u636e\u628a\u4e00\u5757\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u5206\u5272\u6210\u597d\u51e0\u5757\u4e0d\u8fde\u7eed\u7684\u7a7a\u95f4\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c31\u4f1a\u628a\u6570\u636e\u62f7\u8d1d\u5230\u522b\u5904\u3002\u6b64\u65f6\uff0c\u6570\u636e\u62f7\u8d1d\u9700\u8981\u80fd\u628a\u8fd9\u4e9b\u6570\u636e\u539f\u6765\u5360\u7528\u7684\u7a7a\u95f4\u90fd\u7a7a\u51fa\u6765\uff0c\u628a\u539f\u672c\u4e0d\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u53d8\u6210\u8fde\u7eed\u7684\u7a7a\u95f4\u3002 \u5426\u5219\uff0c\u5982\u679c\u6570\u636e\u62f7\u8d1d\u540e\uff0c\u5e76\u6ca1\u6709\u5f62\u6210\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u8fd9\u5c31\u4e0d\u80fd\u7b97\u662f\u6e05\u7406\u4e86\u3002 \u5728\u8fdb\u884c\u788e\u7247\u6e05\u7406\u524d\uff0c\u8fd9\u6bb5 10 \u5b57\u8282\u7684\u7a7a\u95f4\u4e2d\u5206\u522b\u6709 1 \u4e2a 2 \u5b57\u8282\u548c 1 \u4e2a 1 \u5b57\u8282\u7684\u7a7a\u95f2\u7a7a\u95f4\uff0c\u53ea\u662f\u8fd9\u4e24\u4e2a\u7a7a\u95f4\u5e76\u4e0d\u8fde\u7eed\u3002 \u64cd\u4f5c\u7cfb\u7edf\u5728\u6e05\u7406\u788e\u7247\u65f6\uff0c\u4f1a\u5148\u628a\u5e94\u7528 D \u7684\u6570\u636e\u62f7\u8d1d\u5230 2 \u5b57\u8282\u7684\u7a7a\u95f2\u7a7a\u95f4\u4e2d\uff0c\u5e76\u91ca\u653e D \u539f\u5148\u6240\u5360\u7684\u7a7a\u95f4\u3002\u7136\u540e\uff0c\u518d\u628a B \u7684\u6570\u636e\u62f7\u8d1d\u5230 D \u539f\u6765\u7684\u7a7a\u95f4\u4e2d\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u8fd9\u6bb5 10 \u5b57\u8282\u7a7a\u95f4\u7684\u6700\u540e\u4e09\u4e2a\u5b57\u8282\u5c31\u662f\u4e00\u5757\u8fde\u7eed\u7a7a\u95f4\u4e86\u3002\u5230\u8fd9\u91cc\uff0c\u788e\u7247\u6e05\u7406\u7ed3\u675f\u3002 4-2 \u788e\u7247\u6e05\u7406\u662f\u6709\u4ee3\u4ef7 \u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u628a\u591a\u4efd\u6570\u636e\u62f7\u8d1d\u5230\u65b0\u4f4d\u7f6e\uff0c\u628a\u539f\u6709\u7a7a\u95f4\u91ca\u653e\u51fa\u6765\uff0c\u8fd9\u4f1a\u5e26\u6765\u65f6\u95f4\u5f00\u9500\u3002 \u56e0\u4e3a Redis \u662f\u5355\u7ebf\u7a0b\uff0c\u5728\u6570\u636e\u62f7\u8d1d\u65f6\uff0cRedis \u53ea\u80fd\u7b49\u7740\uff0c\u8fd9\u5c31\u5bfc\u81f4 Redis \u65e0\u6cd5\u53ca\u65f6\u5904\u7406\u8bf7\u6c42\uff0c\u6027\u80fd\u5c31\u4f1a\u964d\u4f4e\u3002 \u800c\u4e14\uff0c\u6709\u7684\u65f6\u5019\uff0c\u6570\u636e\u62f7\u8d1d\u8fd8\u9700\u8981\u6ce8\u610f\u987a\u5e8f\uff0c\u5c31\u50cf\u521a\u521a\u8bf4\u7684\u6e05\u7406\u5185\u5b58\u788e\u7247\u7684\u4f8b\u5b50\uff0c\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u5148\u62f7\u8d1d D\uff0c\u5e76\u91ca\u653e D \u7684\u7a7a\u95f4\u540e\uff0c\u624d\u80fd\u62f7\u8d1d B\u3002 \u8fd9\u79cd\u5bf9\u987a\u5e8f\u6027\u7684\u8981\u6c42\uff0c\u4f1a\u8fdb\u4e00\u6b65\u589e\u52a0 Redis \u7684\u7b49\u5f85\u65f6\u95f4\uff0c\u5bfc\u81f4\u6027\u80fd\u964d\u4f4e\u3002 \u6709\u4ec0\u4e48\u529e\u6cd5\u53ef\u4ee5\u5c3d\u91cf\u7f13\u89e3\u8fd9\u4e2a\u95ee\u9898\u5417\uff1f Redis \u4e13\u95e8\u4e3a\u81ea\u52a8\u5185\u5b58\u788e\u7247\u6e05\u7406\u529f\u673a\u5236\u8bbe\u7f6e\u7684\u53c2\u6570\u4e86 \u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u53c2\u6570\uff0c\u6765\u63a7\u5236\u788e\u7247\u6e05\u7406\u7684\u5f00\u59cb\u548c\u7ed3\u675f\u65f6\u673a\uff0c\u4ee5\u53ca\u5360\u7528\u7684 CPU \u6bd4\u4f8b\uff0c\u4ece\u800c\u51cf\u5c11\u788e\u7247\u6e05\u7406\u5bf9 Redis \u672c\u8eab\u8bf7\u6c42\u5904\u7406\u7684\u6027\u80fd\u5f71\u54cd\u3002 \u9996\u5148\uff0cRedis \u9700\u8981\u542f\u7528\u81ea\u52a8\u5185\u5b58\u788e\u7247\u6e05\u7406\uff0c\u53ef\u4ee5\u628a activedefrag \u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a yes \uff0c\u547d\u4ee4\u5982\u4e0b\uff1a config set activedefrag yes \u8fd9\u4e2a\u547d\u4ee4\u53ea\u662f\u542f\u7528\u4e86\u81ea\u52a8\u6e05\u7406\u529f\u80fd\uff0c\u4f46\u662f\uff0c\u5177\u4f53\u4ec0\u4e48\u65f6\u5019\u6e05\u7406\uff0c\u4f1a\u53d7\u5230\u4e0b\u9762\u8fd9\u4e24\u4e2a\u53c2\u6570\u7684\u63a7\u5236\u3002 4-3 \u89e6\u53d1\u5185\u5b58\u6e05\u7406\u6761\u4ef6 \u8fd9\u4e24\u4e2a\u53c2\u6570\u5206\u522b\u8bbe\u7f6e\u4e86\u89e6\u53d1\u5185\u5b58\u6e05\u7406\u7684\u4e00\u4e2a\u6761\u4ef6\uff0c\u5982\u679c\u540c\u65f6\u6ee1\u8db3\u8fd9\u4e24\u4e2a\u6761\u4ef6\uff0c\u5c31\u5f00\u59cb\u6e05\u7406\u3002\u5728\u6e05\u7406\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53ea\u8981\u6709\u4e00\u4e2a\u6761\u4ef6\u4e0d\u6ee1\u8db3\u4e86\uff0c\u5c31\u505c\u6b62\u81ea\u52a8\u6e05\u7406\u3002 active-defrag-ignore-bytes 100mb \uff1a\u8868\u793a\u5185\u5b58\u788e\u7247\u7684\u5b57\u8282\u6570\u8fbe\u5230 100MB \u65f6\uff0c\u5f00\u59cb\u6e05\u7406\uff1b active-defrag-threshold-lower 10 \uff1a\u8868\u793a\u5185\u5b58\u788e\u7247\u7a7a\u95f4\u5360\u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u7ed9 Redis \u7684\u603b\u7a7a\u95f4\u6bd4\u4f8b\u8fbe\u5230 10% \u65f6\uff0c\u5f00\u59cb\u6e05\u7406\u3002 4-4 \u51cf\u5c11\u788e\u7247\u6e05\u7406\u5f71\u54cd \u4e3a\u4e86\u5c3d\u53ef\u80fd\u51cf\u5c11\u788e\u7247\u6e05\u7406\u5bf9 Redis \u6b63\u5e38\u8bf7\u6c42\u5904\u7406\u7684\u5f71\u54cd \uff0c\u81ea\u52a8\u5185\u5b58\u788e\u7247\u6e05\u7406\u529f\u80fd\u5728\u6267\u884c\u65f6\uff0c\u8fd8\u4f1a\u76d1\u63a7\u6e05\u7406\u64cd\u4f5c\u5360\u7528\u7684 CPU \u65f6\u95f4\uff0c\u800c\u4e14\u8fd8\u8bbe\u7f6e\u4e86\u4e24\u4e2a\u53c2\u6570\uff0c\u5206\u522b\u7528\u4e8e\u63a7\u5236\u6e05\u7406\u64cd\u4f5c\u5360\u7528\u7684 CPU \u65f6\u95f4\u6bd4\u4f8b\u7684\u4e0a\u3001\u4e0b\u9650\uff0c\u65e2\u4fdd\u8bc1\u6e05\u7406\u5de5\u4f5c\u80fd\u6b63\u5e38\u8fdb\u884c\uff0c\u53c8\u907f\u514d\u4e86\u964d\u4f4e Redis \u6027\u80fd\u3002\u8fd9\u4e24\u4e2a\u53c2\u6570\u5177\u4f53\u5982\u4e0b\uff1a active-defrag-cycle-min 25 \uff1a \u8868\u793a\u81ea\u52a8\u6e05\u7406\u8fc7\u7a0b\u6240\u7528 CPU \u65f6\u95f4\u7684\u6bd4\u4f8b\u4e0d\u4f4e\u4e8e 25%\uff0c\u4fdd\u8bc1\u6e05\u7406\u80fd\u6b63\u5e38\u5f00\u5c55\uff1b active-defrag-cycle-max 75 \uff1a\u8868\u793a\u81ea\u52a8\u6e05\u7406\u8fc7\u7a0b\u6240\u7528 CPU \u65f6\u95f4\u7684\u6bd4\u4f8b\u4e0d\u9ad8\u4e8e 75%\uff0c\u4e00\u65e6\u8d85\u8fc7\uff0c\u5c31\u505c\u6b62\u6e05\u7406\uff0c\u4ece\u800c\u907f\u514d\u5728\u6e05\u7406\u65f6\uff0c\u5927\u91cf\u7684\u5185\u5b58\u62f7\u8d1d\u963b\u585e Redis\uff0c\u5bfc\u81f4\u54cd\u5e94\u5ef6\u8fdf\u5347\u9ad8\u3002 \u81ea\u52a8\u5185\u5b58\u788e\u7247\u6e05\u7406\u673a\u5236\u5728\u63a7\u5236\u788e\u7247\u6e05\u7406\u542f\u505c\u7684\u65f6\u673a\u4e0a\uff0c \u65e2\u8003\u8651\u4e86\u788e\u7247\u7684\u7a7a\u95f4\u5360\u6bd4\u3001\u5bf9 Redis \u5185\u5b58\u4f7f\u7528\u6548\u7387\u7684\u5f71\u54cd\uff0c\u8fd8\u8003\u8651\u4e86\u6e05\u7406\u673a\u5236\u672c\u8eab\u7684 CPU \u65f6\u95f4\u5360\u6bd4\u3001\u5bf9 Redis \u6027\u80fd\u7684\u5f71\u54cd \u3002 5\u3001\u672c\u8282\u5c0f\u7ed3 Redis \u7684\u5185\u5b58\u7a7a\u95f4\u6548\u7387\u95ee\u9898 info memory \u547d\u4ee4\u662f\u4e00\u4e2a\u597d\u5de5\u5177\uff0c\u53ef\u4ee5\u5e2e\u52a9\u4f60\u67e5\u770b\u788e\u7247\u7387\u7684\u60c5\u51b5\uff1b \u788e\u7247\u7387\u9608\u503c\u662f\u4e00\u4e2a\u597d\u7ecf\u9a8c \uff0c\u53ef\u4ee5\u5e2e\u5fd9\u4f60\u6709\u6548\u5730\u5224\u65ad\u662f\u5426\u8981\u8fdb\u884c\u788e\u7247\u6e05\u7406\u4e86\uff1b \u5185\u5b58\u788e\u7247\u81ea\u52a8\u6e05\u7406\u662f\u4e00\u4e2a\u597d\u65b9\u6cd5 \uff0c\u53ef\u4ee5\u907f\u514d\u56e0\u4e3a\u788e\u7247\u5bfc\u81f4 Redis \u7684\u5185\u5b58\u5b9e\u9645\u5229\u7528\u7387\u964d\u4f4e\uff0c\u63d0\u5347\u6210\u672c\u6536\u76ca\u7387\u3002 \u5185\u5b58\u788e\u7247\u81ea\u52a8\u6e05\u7406\u6d89\u53ca\u5185\u5b58\u62f7\u8d1d\uff0c\u8fd9\u5bf9 Redis \u800c\u8a00\uff0c\u662f\u4e2a\u6f5c\u5728\u7684\u98ce\u9669\u3002\u5982\u679c\u4f60\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\u9047\u5230 Redis \u6027\u80fd\u53d8\u6162\uff0c\u8bb0\u5f97\u901a\u8fc7\u65e5\u5fd7\u770b\u4e0b\u662f\u5426\u6b63\u5728\u8fdb\u884c\u788e\u7247\u6e05\u7406\u3002 \u5982\u679c Redis \u7684\u786e\u6b63\u5728\u6e05\u7406\u788e\u7247\uff0c\u90a3\u4e48\uff0c\u6211\u5efa\u8bae\u4f60\u8c03\u5c0f active-defrag-cycle-max \u7684\u503c\uff0c\u4ee5\u51cf\u8f7b\u5bf9\u6b63\u5e38\u8bf7\u6c42\u5904\u7406\u7684\u5f71\u54cd\u3002","title":"\u7b2c\u56db\u8282 \u5220\u9664\u6570\u636e\u540e\uff0c\u5185\u5b58\u5360\u7528\u7387\u8fd8\u662f\u5f88\u9ad8"},{"location":"chap4/4redis_fragmentation/#_1","text":"\u660e\u660e\u505a\u4e86\u6570\u636e\u5220\u9664\uff0c\u6570\u636e\u91cf\u5df2\u7ecf\u4e0d\u5927\u4e86\uff0c\u4e3a\u4ec0\u4e48\u4f7f\u7528 top \u547d\u4ee4\u67e5\u770b\u65f6\uff0c\u8fd8\u4f1a\u53d1\u73b0 Redis \u5360\u7528\u4e86\u5f88\u591a\u5185\u5b58\u5462\uff1f \u8fd9\u662f\u56e0\u4e3a\uff0c\u5f53\u6570\u636e\u5220\u9664\u540e\uff0c Redis \u91ca\u653e\u7684\u5185\u5b58\u7a7a\u95f4\u4f1a\u7531\u5185\u5b58\u5206\u914d\u5668\u7ba1\u7406\uff0c\u5e76\u4e0d\u4f1a\u7acb\u5373\u8fd4\u56de\u7ed9\u64cd\u4f5c\u7cfb\u7edf \u3002\u6240\u4ee5\uff0c \u64cd\u4f5c\u7cfb\u7edf\u4ecd\u7136\u4f1a\u8bb0\u5f55\u7740\u7ed9 Redis \u5206\u914d\u4e86\u5927\u91cf\u5185\u5b58 \u3002 \u6f5c\u5728\u7684\u98ce\u9669\u70b9\uff1a Redis \u91ca\u653e\u7684\u5185\u5b58\u7a7a\u95f4\u53ef\u80fd\u5e76\u4e0d\u662f\u8fde\u7eed\u7684\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e9b\u4e0d\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u5f88\u6709\u53ef\u80fd\u5904\u4e8e\u4e00\u79cd\u95f2\u7f6e\u7684\u72b6\u6001\u3002 \u8fd9\u5c31\u4f1a\u5bfc\u81f4\u4e00\u4e2a\u95ee\u9898\uff1a \u867d\u7136\u6709\u7a7a\u95f2\u7a7a\u95f4\uff0cRedis \u5374\u65e0\u6cd5\u7528\u6765\u4fdd\u5b58\u6570\u636e\uff0c\u4e0d\u4ec5\u4f1a\u51cf\u5c11 Redis \u80fd\u591f\u5b9e\u9645\u4fdd\u5b58\u7684\u6570\u636e\u91cf\uff0c\u8fd8\u4f1a\u964d\u4f4e Redis \u8fd0\u884c\u673a\u5668\u7684\u6210\u672c\u56de\u62a5\u7387 \u3002","title":"\u7b2c\u56db\u8282 \u5220\u9664\u6570\u636e\u540e\uff0c\u5185\u5b58\u5360\u7528\u7387\u8fd8\u662f\u5f88\u9ad8"},{"location":"chap4/4redis_fragmentation/#1","text":"\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5185\u5b58\u7a7a\u95f4\u95f2\u7f6e\uff0c\u5f80\u5f80\u662f\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u53d1\u751f\u4e86\u8f83\u4e3a\u4e25\u91cd\u7684\u5185\u5b58\u788e\u7247\u3002 \u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e9b\u5206\u6563\u7684\u7a7a\u5ea7\u4f4d\u53eb\u4f5c\u201c\u8f66\u53a2\u5ea7\u4f4d\u788e\u7247\u201d\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58\u788e\u7247\u5c31\u5f88\u5bb9\u6613\u7406\u89e3\u4e86\u3002 \u867d\u7136\u64cd\u4f5c\u7cfb\u7edf\u7684\u5269\u4f59\u5185\u5b58\u7a7a\u95f4\u603b\u91cf\u8db3\u591f\uff0c\u4f46\u662f\uff0c\u5e94\u7528\u7533\u8bf7\u7684\u662f\u4e00\u5757\u8fde\u7eed\u5730\u5740\u7a7a\u95f4\u7684 N \u5b57\u8282\uff0c\u4f46\u5728\u5269\u4f59\u7684\u5185\u5b58\u7a7a\u95f4\u4e2d\uff0c\u6ca1\u6709\u5927\u5c0f\u4e3a N \u5b57\u8282\u7684\u8fde\u7eed\u7a7a\u95f4\u4e86\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e9b\u5269\u4f59\u7a7a\u95f4\u5c31\u662f\u5185\u5b58\u788e\u7247\uff08\u6bd4\u5982\u4e0a\u56fe\u4e2d\u7684\u201c\u7a7a\u95f2 2 \u5b57\u8282\u201d\u548c\u201c\u7a7a\u95f2 1 \u5b57\u8282\u201d\uff0c\u5c31\u662f\u8fd9\u6837\u7684\u788e\u7247\uff09\u3002","title":"1\u3001\u4ec0\u4e48\u662f\u5185\u5b58\u788e\u7247\uff1f"},{"location":"chap4/4redis_fragmentation/#2","text":"\u5185\u5b58\u788e\u7247\u7684\u5f62\u6210\u6709\u5185\u56e0\u548c\u5916\u56e0\u4e24\u4e2a\u5c42\u9762\u7684\u539f\u56e0\u3002\u7b80\u5355\u6765\u8bf4\uff0c \u5185\u56e0\u662f\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58\u5206\u914d\u673a\u5236\uff0c\u5916\u56e0\u662f Redis \u7684\u8d1f\u8f7d\u7279\u5f81\u3002","title":"2\u3001\u5185\u5b58\u788e\u7247\u662f\u5982\u4f55\u5f62\u6210\u7684\uff1f"},{"location":"chap4/4redis_fragmentation/#2-1","text":"\u5185\u5b58\u5206\u914d\u5668\u7684\u5206\u914d\u7b56\u7565\u5c31\u51b3\u5b9a\u4e86\u64cd\u4f5c\u7cfb\u7edf\u65e0\u6cd5\u505a\u5230\u201c\u6309\u9700\u5206\u914d\u201d \u3002\u8fd9\u662f\u56e0\u4e3a\uff0c\u5185\u5b58\u5206\u914d\u5668\u4e00\u822c\u662f\u6309\u56fa\u5b9a\u5927\u5c0f\u6765\u5206\u914d\u5185\u5b58\uff0c\u800c\u4e0d\u662f\u5b8c\u5168\u6309\u7167\u5e94\u7528\u7a0b\u5e8f\u7533\u8bf7\u7684\u5185\u5b58\u7a7a\u95f4\u5927\u5c0f\u7ed9\u7a0b\u5e8f\u5206\u914d\u3002 Redis \u53ef\u4ee5\u4f7f\u7528 libc\u3001jemalloc\u3001tcmalloc \u591a\u79cd\u5185\u5b58\u5206\u914d\u5668\u6765\u5206\u914d\u5185\u5b58\uff0c\u9ed8\u8ba4\u4f7f\u7528 jemalloc \u3002\u63a5\u4e0b\u6765\uff0c\u4ee5 jemalloc \u4e3a\u4f8b\uff0c\u6765\u5177\u4f53\u89e3\u91ca\u4e00\u4e0b\u3002\u5176\u4ed6\u5206\u914d\u5668\u4e5f\u5b58\u5728\u7c7b\u4f3c\u7684\u95ee\u9898\u3002 jemalloc \u7684\u5206\u914d\u7b56\u7565\u4e4b\u4e00\uff0c\u662f\u6309\u7167\u4e00\u7cfb\u5217\u56fa\u5b9a\u7684\u5927\u5c0f\u5212\u5206\u5185\u5b58\u7a7a\u95f4 \uff0c\u4f8b\u5982 8 \u5b57\u8282\u300116 \u5b57\u8282\u300132 \u5b57\u8282\u300148 \u5b57\u8282\uff0c\u2026, 2KB\u30014KB\u30018KB \u7b49\u3002\u5f53\u7a0b\u5e8f\u7533\u8bf7\u7684\u5185\u5b58\u6700\u63a5\u8fd1\u67d0\u4e2a\u56fa\u5b9a\u503c\u65f6\uff0cjemalloc \u4f1a\u7ed9\u5b83\u5206\u914d\u76f8\u5e94\u5927\u5c0f\u7684\u7a7a\u95f4\u3002 \u8fd9\u6837\u7684\u5206\u914d\u65b9\u5f0f\u672c\u8eab\u662f\u4e3a\u4e86\u51cf\u5c11\u5206\u914d\u6b21\u6570\u3002 \u4f8b\u5982\uff0cRedis \u7533\u8bf7\u4e00\u4e2a 20 \u5b57\u8282\u7684\u7a7a\u95f4\u4fdd\u5b58\u6570\u636e\uff0cjemalloc \u5c31\u4f1a\u5206\u914d 32 \u5b57\u8282 \uff0c\u6b64\u65f6\uff0c\u5982\u679c\u5e94\u7528\u8fd8\u8981\u5199\u5165 10 \u5b57\u8282\u7684\u6570\u636e\uff0cRedis \u5c31\u4e0d\u7528\u518d\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u7a7a\u95f4\u4e86\uff0c\u56e0\u4e3a\u521a\u624d\u5206\u914d\u7684 32 \u5b57\u8282\u5df2\u7ecf\u591f\u7528\u4e86\uff0c\u8fd9\u5c31\u907f\u514d\u4e86\u4e00\u6b21\u5206\u914d\u64cd\u4f5c\u3002 \u4f46\u662f\uff0c\u5982\u679c Redis \u6bcf\u6b21\u5411\u5206\u914d\u5668\u7533\u8bf7\u7684\u5185\u5b58\u7a7a\u95f4\u5927\u5c0f\u4e0d\u4e00\u6837\uff0c\u8fd9\u79cd\u5206\u914d\u65b9\u5f0f\u5c31\u4f1a\u6709\u5f62\u6210\u788e\u7247\u7684\u98ce\u9669\uff0c\u800c\u8fd9\u6b63\u597d\u6765\u6e90\u4e8e Redis \u7684\u5916\u56e0\u4e86\u3002","title":"2-1 \u5185\u56e0\uff1a\u5185\u5b58\u5206\u914d\u5668\u7684\u5206\u914d\u7b56\u7565"},{"location":"chap4/4redis_fragmentation/#2-2","text":"Redis \u901a\u5e38\u4f5c\u4e3a\u5171\u7528\u7684\u7f13\u5b58\u7cfb\u7edf\u6216\u952e\u503c\u6570\u636e\u5e93\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1 \uff0c\u6240\u4ee5\uff0c\u4e0d\u540c\u4e1a\u52a1\u5e94\u7528\u7684\u6570\u636e\u90fd\u53ef\u80fd\u4fdd\u5b58\u5728 Redis \u4e2d\uff0c\u8fd9\u5c31\u4f1a\u5e26\u6765\u4e0d\u540c\u5927\u5c0f\u7684\u952e\u503c\u5bf9\u3002 \u8fd9\u6837\u4e00\u6765\uff0cRedis \u7533\u8bf7\u5185\u5b58\u7a7a\u95f4\u5206\u914d\u65f6\uff0c\u672c\u8eab\u5c31\u4f1a\u6709\u5927\u5c0f\u4e0d\u4e00\u7684\u7a7a\u95f4\u9700\u6c42\u3002\u8fd9\u662f\u7b2c\u4e00\u4e2a\u5916\u56e0\u3002 \u5185\u5b58\u5206\u914d\u5668\u53ea\u80fd\u6309\u56fa\u5b9a\u5927\u5c0f\u5206\u914d\u5185\u5b58\uff0c\u6240\u4ee5\uff0c\u5206\u914d\u7684\u5185\u5b58\u7a7a\u95f4\u4e00\u822c\u90fd\u4f1a\u6bd4\u7533\u8bf7\u7684\u7a7a\u95f4\u5927\u4e00\u4e9b\uff0c\u4e0d\u4f1a\u5b8c\u5168\u4e00\u81f4\uff0c\u8fd9\u672c\u8eab\u5c31\u4f1a\u9020\u6210\u4e00\u5b9a\u7684\u788e\u7247\uff0c\u964d\u4f4e\u5185\u5b58\u7a7a\u95f4\u5b58\u50a8\u6548\u7387\u3002 \u6bd4\u5982\u8bf4\uff0c\u5e94\u7528 A \u4fdd\u5b58 6 \u5b57\u8282\u6570\u636e\uff0cjemalloc \u6309\u5206\u914d\u7b56\u7565\u5206\u914d 8 \u5b57\u8282\u3002\u5982\u679c\u5e94\u7528 A \u4e0d\u518d\u4fdd\u5b58\u65b0\u6570\u636e\uff0c\u90a3\u4e48\uff0c\u8fd9\u91cc\u591a\u51fa\u6765\u7684 2 \u5b57\u8282\u7a7a\u95f4\u5c31\u662f\u5185\u5b58\u788e\u7247\u4e86\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u7b2c\u4e8c\u4e2a\u5916\u56e0\u662f\uff0c\u8fd9\u4e9b\u952e\u503c\u5bf9\u4f1a\u88ab\u4fee\u6539\u548c\u5220\u9664\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u7a7a\u95f4\u7684\u6269\u5bb9\u548c\u91ca\u653e\u3002 \u5177\u4f53\u6765\u8bf4\uff0c \u4e00\u65b9\u9762\uff0c\u5982\u679c\u4fee\u6539\u540e\u7684\u952e\u503c\u5bf9\u53d8\u5927\u6216\u53d8\u5c0f\u4e86\uff0c \u5c31\u9700\u8981\u5360\u7528\u989d\u5916\u7684\u7a7a\u95f4\u6216\u8005\u91ca\u653e\u4e0d\u7528\u7684\u7a7a\u95f4 \u3002 \u53e6\u4e00\u65b9\u9762\uff0c\u5220\u9664\u7684\u952e\u503c\u5bf9\u5c31\u4e0d\u518d\u9700\u8981\u5185\u5b58\u7a7a\u95f4\u4e86\uff0c\u6b64\u65f6\uff0c \u5c31\u4f1a\u628a\u7a7a\u95f4\u91ca\u653e\u51fa\u6765\uff0c\u5f62\u6210\u7a7a\u95f2\u7a7a\u95f4 \u3002 \u4e00\u5f00\u59cb\uff0c\u5e94\u7528 A\u3001B\u3001C\u3001D \u5206\u522b\u4fdd\u5b58\u4e86 3\u30011\u30012\u30014 \u5b57\u8282\u7684\u6570\u636e\uff0c\u5e76\u5360\u636e\u4e86\u76f8\u5e94\u7684\u5185\u5b58\u7a7a\u95f4\u3002 \u7136\u540e\uff0c\u5e94\u7528 D \u5220\u9664\u4e86 1 \u4e2a\u5b57\u8282\uff0c\u8fd9\u4e2a 1 \u5b57\u8282\u7684\u5185\u5b58\u7a7a\u95f4\u5c31\u7a7a\u51fa\u6765\u4e86\u3002 \u7d27\u63a5\u7740\uff0c\u5e94\u7528 A \u4fee\u6539\u4e86\u6570\u636e\uff0c\u4ece 3 \u5b57\u8282\u53d8\u6210\u4e86 4 \u5b57\u8282\u3002 \u4e3a\u4e86\u4fdd\u6301 A \u6570\u636e\u7684\u7a7a\u95f4\u8fde\u7eed\u6027\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c31\u9700\u8981\u628a B \u7684\u6570\u636e\u62f7\u8d1d\u5230\u522b\u7684\u7a7a\u95f4\uff0c\u6bd4\u5982\u62f7\u8d1d\u5230 D \u521a\u521a\u91ca\u653e\u7684\u7a7a\u95f4\u4e2d\u3002 \u6b64\u65f6\uff0c\u5e94\u7528 C \u548c D \u4e5f\u5206\u522b\u5220\u9664\u4e86 2 \u5b57\u8282\u548c 1 \u5b57\u8282\u7684\u6570\u636e\uff0c\u6574\u4e2a\u5185\u5b58\u7a7a\u95f4\u4e0a\u5c31\u5206\u522b\u51fa\u73b0\u4e86 2 \u5b57\u8282\u548c 1 \u5b57\u8282\u7684\u7a7a\u95f2\u788e\u7247\u3002 \u5982\u679c\u5e94\u7528 E \u60f3\u8981\u4e00\u4e2a 3 \u5b57\u8282\u7684\u8fde\u7eed\u7a7a\u95f4\uff0c\u663e\u7136\u662f\u4e0d\u80fd\u5f97\u5230\u6ee1\u8db3\u7684\u3002\u56e0\u4e3a\uff0c\u867d\u7136\u7a7a\u95f4\u603b\u91cf\u591f\uff0c\u4f46\u5374\u662f\u788e\u7247\u7a7a\u95f4\uff0c\u5e76\u4e0d\u662f\u8fde\u7eed\u7684\u3002 \u597d\u4e86\uff0c\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u5c31\u77e5\u9053\u4e86\u9020\u6210\u5185\u5b58\u788e\u7247\u7684\u5185\u5916\u56e0\u7d20\uff0c\u5176\u4e2d\uff0c\u5185\u5b58\u5206\u914d\u5668\u7b56\u7565\u662f\u5185\u56e0\uff0c\u800c Redis \u7684\u8d1f\u8f7d\u5c5e\u4e8e\u5916\u56e0\uff0c\u5305\u62ec\u4e86\u5927\u5c0f\u4e0d\u4e00\u7684\u952e\u503c\u5bf9\u548c\u952e\u503c\u5bf9\u4fee\u6539\u5220\u9664\u5e26\u6765\u7684\u5185\u5b58\u7a7a\u95f4\u53d8\u5316\u3002 \u5927\u91cf\u5185\u5b58\u788e\u7247\u7684\u5b58\u5728\uff0c\u4f1a\u9020\u6210 Redis \u7684\u5185\u5b58\u5b9e\u9645\u5229\u7528\u7387\u53d8\u4f4e\uff0c\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u8981\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u4e86\u3002\u4e0d\u8fc7\uff0c\u5728\u89e3\u51b3\u95ee\u9898\u524d\uff0c\u6211\u4eec\u8981\u5148\u5224\u65ad Redis \u8fd0\u884c\u8fc7\u7a0b\u4e2d\u662f\u5426\u5b58\u5728\u5185\u5b58\u788e\u7247\u3002","title":"2-2 \u5916\u56e0\uff1a\u952e\u503c\u5bf9\u5927\u5c0f\u4e0d\u4e00\u6837\u548c\u5220\u6539\u64cd\u4f5c"},{"location":"chap4/4redis_fragmentation/#3","text":"Redis \u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u5185\u5b58\u5229\u7528\u7387\u7684\u9ad8\u4f4e\u76f4\u63a5\u5173\u7cfb\u5230 Redis \u8fd0\u884c\u6548\u7387\u7684\u9ad8\u4f4e\u3002\u4e3a\u4e86\u8ba9\u7528\u6237\u80fd\u76d1\u63a7\u5230\u5b9e\u65f6\u7684\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\uff0cRedis \u81ea\u8eab\u63d0\u4f9b\u4e86 INFO \u547d\u4ee4\uff0c\u53ef\u4ee5\u7528\u6765\u67e5\u8be2\u5185\u5b58\u4f7f\u7528\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a INFO memory # Memory used_memory:1073741736 used_memory_human:1024.00M used_memory_rss:1997159792 used_memory_rss_human:1.86G \u2026 mem_fragmentation_ratio:1.86 \u8fd9\u91cc\u6709\u4e00\u4e2a mem_fragmentation_ratio \u7684\u6307\u6807\uff0c\u5b83\u8868\u793a\u7684\u5c31\u662f Redis \u5f53\u524d\u7684\u5185\u5b58\u788e\u7247\u7387\u3002 \u90a3\u4e48\uff0c\u8fd9\u4e2a\u788e\u7247\u7387\u662f\u600e\u4e48\u8ba1\u7b97\u7684\u5462\uff1f\u5176\u5b9e\uff0c\u5c31\u662f\u4e0a\u9762\u7684\u547d\u4ee4\u4e2d\u7684\u4e24\u4e2a\u6307\u6807 used_memory_rss \u548c used_memory \u76f8\u9664\u7684\u7ed3\u679c\u3002 mem_fragmentation_ratio = used_memory_rss/ used_memory used_memory_rss \u662f\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u9645\u5206\u914d\u7ed9 Redis \u7684\u7269\u7406\u5185\u5b58\u7a7a\u95f4\uff0c\u91cc\u9762\u5c31\u5305\u542b\u4e86\u788e\u7247\uff1b \u800c used_memory \u662f Redis \u4e3a\u4e86\u4fdd\u5b58\u6570\u636e\u5b9e\u9645\u7533\u8bf7\u4f7f\u7528\u7684\u7a7a\u95f4\u3002 \u6211\u7b80\u5355\u4e3e\u4e2a\u4f8b\u5b50\u3002\u4f8b\u5982\uff0cRedis \u7533\u8bf7\u4f7f\u7528\u4e86 100 \u5b57\u8282\uff08used_memory\uff09\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u9645\u5206\u914d\u4e86 128 \u5b57\u8282\uff08 used_memory_rss \uff09\uff0c\u6b64\u65f6\uff0c mem_fragmentation_ratio \u5c31\u662f 1.28 \u3002 mem_fragmentation_ratio \u5927\u4e8e 1 \u4f46\u5c0f\u4e8e 1.5\u3002\u8fd9\u79cd\u60c5\u51b5\u662f\u5408\u7406\u7684 \u3002\u8fd9\u662f\u56e0\u4e3a\uff0c\u521a\u624d\u6211\u4ecb\u7ecd\u7684\u90a3\u4e9b\u56e0\u7d20\u662f\u96be\u4ee5\u907f\u514d\u7684\u3002\u6bd5\u7adf\uff0c\u5185\u56e0\u7684\u5185\u5b58\u5206\u914d\u5668\u662f\u4e00\u5b9a\u8981\u4f7f\u7528\u7684\uff0c\u5206\u914d\u7b56\u7565\u90fd\u662f\u901a\u7528\u7684\uff0c \u4e0d\u4f1a\u8f7b\u6613\u4fee\u6539\uff1b\u800c\u5916\u56e0\u7531 Redis \u8d1f\u8f7d\u51b3\u5b9a\uff0c\u4e5f\u65e0\u6cd5\u9650\u5236\u3002\u6240\u4ee5\uff0c\u5b58\u5728\u5185\u5b58\u788e\u7247\u4e5f\u662f\u6b63\u5e38\u7684 \u3002 mem_fragmentation_ratio \u5927\u4e8e 1.5 \u3002\u8fd9\u8868\u660e\u5185\u5b58\u788e\u7247\u7387\u5df2\u7ecf\u8d85\u8fc7\u4e86 50%\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u9700\u8981\u91c7\u53d6\u4e00\u4e9b\u63aa\u65bd\u6765\u964d\u4f4e\u5185\u5b58\u788e\u7247\u7387\u4e86\u3002","title":"3\u3001\u5982\u4f55\u5224\u65ad\u662f\u5426\u6709\u5185\u5b58\u788e\u7247\uff1f"},{"location":"chap4/4redis_fragmentation/#4","text":"\u5f53 Redis \u53d1\u751f\u5185\u5b58\u788e\u7247\u540e\uff0c\u4e00\u4e2a\u201c\u7b80\u5355\u7c97\u66b4\u201d\u7684\u65b9\u6cd5\u5c31\u662f \u91cd\u542f Redis \u5b9e\u4f8b \u3002\u5f53\u7136\uff0c\u8fd9\u5e76\u4e0d\u662f\u4e00\u4e2a\u201c\u4f18\u96c5\u201d\u7684\u65b9\u6cd5\uff0c\u6bd5\u7adf\uff0c\u91cd\u542f Redis \u4f1a\u5e26\u6765\u4e24\u4e2a\u540e\u679c\uff1a \u5982\u679c Redis \u4e2d\u7684\u6570\u636e\u6ca1\u6709\u6301\u4e45\u5316\uff0c\u90a3\u4e48\uff0c\u6570\u636e\u5c31\u4f1a\u4e22\u5931\uff1b \u5373\u4f7f Redis \u6570\u636e\u6301\u4e45\u5316\u4e86\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u901a\u8fc7 AOF \u6216 RDB \u8fdb\u884c\u6062\u590d\uff0c\u6062\u590d\u65f6\u957f\u53d6\u51b3\u4e8e AOF \u6216 RDB \u7684\u5927\u5c0f\uff0c\u5982\u679c\u53ea\u6709\u4e00\u4e2a Redis \u5b9e\u4f8b\uff0c\u6062\u590d\u9636\u6bb5\u65e0\u6cd5\u63d0\u4f9b\u670d\u52a1\u3002","title":"4\u3001\u5982\u4f55\u6e05\u7406\u5185\u5b58\u788e\u7247\uff1f"},{"location":"chap4/4redis_fragmentation/#4-1","text":"\u5e78\u8fd0\u7684\u662f\uff0c\u4ece 4.0-RC3 \u7248\u672c\u4ee5\u540e\uff0cRedis \u81ea\u8eab\u63d0\u4f9b\u4e86\u4e00\u79cd\u5185\u5b58\u788e\u7247\u81ea\u52a8\u6e05\u7406\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u5148\u6765\u770b\u8fd9\u4e2a\u65b9\u6cd5\u7684\u57fa\u672c\u673a\u5236\u3002 \u5185\u5b58\u788e\u7247\u6e05\u7406\uff0c\u7b80\u5355\u6765\u8bf4\uff0c\u5c31\u662f\u201c\u642c\u5bb6\u8ba9\u4f4d\uff0c\u5408\u5e76\u7a7a\u95f4\u201d\u3002 \u5f53\u6709\u6570\u636e\u628a\u4e00\u5757\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u5206\u5272\u6210\u597d\u51e0\u5757\u4e0d\u8fde\u7eed\u7684\u7a7a\u95f4\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c31\u4f1a\u628a\u6570\u636e\u62f7\u8d1d\u5230\u522b\u5904\u3002\u6b64\u65f6\uff0c\u6570\u636e\u62f7\u8d1d\u9700\u8981\u80fd\u628a\u8fd9\u4e9b\u6570\u636e\u539f\u6765\u5360\u7528\u7684\u7a7a\u95f4\u90fd\u7a7a\u51fa\u6765\uff0c\u628a\u539f\u672c\u4e0d\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u53d8\u6210\u8fde\u7eed\u7684\u7a7a\u95f4\u3002 \u5426\u5219\uff0c\u5982\u679c\u6570\u636e\u62f7\u8d1d\u540e\uff0c\u5e76\u6ca1\u6709\u5f62\u6210\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u8fd9\u5c31\u4e0d\u80fd\u7b97\u662f\u6e05\u7406\u4e86\u3002 \u5728\u8fdb\u884c\u788e\u7247\u6e05\u7406\u524d\uff0c\u8fd9\u6bb5 10 \u5b57\u8282\u7684\u7a7a\u95f4\u4e2d\u5206\u522b\u6709 1 \u4e2a 2 \u5b57\u8282\u548c 1 \u4e2a 1 \u5b57\u8282\u7684\u7a7a\u95f2\u7a7a\u95f4\uff0c\u53ea\u662f\u8fd9\u4e24\u4e2a\u7a7a\u95f4\u5e76\u4e0d\u8fde\u7eed\u3002 \u64cd\u4f5c\u7cfb\u7edf\u5728\u6e05\u7406\u788e\u7247\u65f6\uff0c\u4f1a\u5148\u628a\u5e94\u7528 D \u7684\u6570\u636e\u62f7\u8d1d\u5230 2 \u5b57\u8282\u7684\u7a7a\u95f2\u7a7a\u95f4\u4e2d\uff0c\u5e76\u91ca\u653e D \u539f\u5148\u6240\u5360\u7684\u7a7a\u95f4\u3002\u7136\u540e\uff0c\u518d\u628a B \u7684\u6570\u636e\u62f7\u8d1d\u5230 D \u539f\u6765\u7684\u7a7a\u95f4\u4e2d\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u8fd9\u6bb5 10 \u5b57\u8282\u7a7a\u95f4\u7684\u6700\u540e\u4e09\u4e2a\u5b57\u8282\u5c31\u662f\u4e00\u5757\u8fde\u7eed\u7a7a\u95f4\u4e86\u3002\u5230\u8fd9\u91cc\uff0c\u788e\u7247\u6e05\u7406\u7ed3\u675f\u3002","title":"4-1 \u5185\u5b58\u788e\u7247\u6e05\u7406"},{"location":"chap4/4redis_fragmentation/#4-2","text":"\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u628a\u591a\u4efd\u6570\u636e\u62f7\u8d1d\u5230\u65b0\u4f4d\u7f6e\uff0c\u628a\u539f\u6709\u7a7a\u95f4\u91ca\u653e\u51fa\u6765\uff0c\u8fd9\u4f1a\u5e26\u6765\u65f6\u95f4\u5f00\u9500\u3002 \u56e0\u4e3a Redis \u662f\u5355\u7ebf\u7a0b\uff0c\u5728\u6570\u636e\u62f7\u8d1d\u65f6\uff0cRedis \u53ea\u80fd\u7b49\u7740\uff0c\u8fd9\u5c31\u5bfc\u81f4 Redis \u65e0\u6cd5\u53ca\u65f6\u5904\u7406\u8bf7\u6c42\uff0c\u6027\u80fd\u5c31\u4f1a\u964d\u4f4e\u3002 \u800c\u4e14\uff0c\u6709\u7684\u65f6\u5019\uff0c\u6570\u636e\u62f7\u8d1d\u8fd8\u9700\u8981\u6ce8\u610f\u987a\u5e8f\uff0c\u5c31\u50cf\u521a\u521a\u8bf4\u7684\u6e05\u7406\u5185\u5b58\u788e\u7247\u7684\u4f8b\u5b50\uff0c\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u5148\u62f7\u8d1d D\uff0c\u5e76\u91ca\u653e D \u7684\u7a7a\u95f4\u540e\uff0c\u624d\u80fd\u62f7\u8d1d B\u3002 \u8fd9\u79cd\u5bf9\u987a\u5e8f\u6027\u7684\u8981\u6c42\uff0c\u4f1a\u8fdb\u4e00\u6b65\u589e\u52a0 Redis \u7684\u7b49\u5f85\u65f6\u95f4\uff0c\u5bfc\u81f4\u6027\u80fd\u964d\u4f4e\u3002 \u6709\u4ec0\u4e48\u529e\u6cd5\u53ef\u4ee5\u5c3d\u91cf\u7f13\u89e3\u8fd9\u4e2a\u95ee\u9898\u5417\uff1f Redis \u4e13\u95e8\u4e3a\u81ea\u52a8\u5185\u5b58\u788e\u7247\u6e05\u7406\u529f\u673a\u5236\u8bbe\u7f6e\u7684\u53c2\u6570\u4e86 \u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u53c2\u6570\uff0c\u6765\u63a7\u5236\u788e\u7247\u6e05\u7406\u7684\u5f00\u59cb\u548c\u7ed3\u675f\u65f6\u673a\uff0c\u4ee5\u53ca\u5360\u7528\u7684 CPU \u6bd4\u4f8b\uff0c\u4ece\u800c\u51cf\u5c11\u788e\u7247\u6e05\u7406\u5bf9 Redis \u672c\u8eab\u8bf7\u6c42\u5904\u7406\u7684\u6027\u80fd\u5f71\u54cd\u3002 \u9996\u5148\uff0cRedis \u9700\u8981\u542f\u7528\u81ea\u52a8\u5185\u5b58\u788e\u7247\u6e05\u7406\uff0c\u53ef\u4ee5\u628a activedefrag \u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a yes \uff0c\u547d\u4ee4\u5982\u4e0b\uff1a config set activedefrag yes \u8fd9\u4e2a\u547d\u4ee4\u53ea\u662f\u542f\u7528\u4e86\u81ea\u52a8\u6e05\u7406\u529f\u80fd\uff0c\u4f46\u662f\uff0c\u5177\u4f53\u4ec0\u4e48\u65f6\u5019\u6e05\u7406\uff0c\u4f1a\u53d7\u5230\u4e0b\u9762\u8fd9\u4e24\u4e2a\u53c2\u6570\u7684\u63a7\u5236\u3002","title":"4-2 \u788e\u7247\u6e05\u7406\u662f\u6709\u4ee3\u4ef7"},{"location":"chap4/4redis_fragmentation/#4-3","text":"\u8fd9\u4e24\u4e2a\u53c2\u6570\u5206\u522b\u8bbe\u7f6e\u4e86\u89e6\u53d1\u5185\u5b58\u6e05\u7406\u7684\u4e00\u4e2a\u6761\u4ef6\uff0c\u5982\u679c\u540c\u65f6\u6ee1\u8db3\u8fd9\u4e24\u4e2a\u6761\u4ef6\uff0c\u5c31\u5f00\u59cb\u6e05\u7406\u3002\u5728\u6e05\u7406\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53ea\u8981\u6709\u4e00\u4e2a\u6761\u4ef6\u4e0d\u6ee1\u8db3\u4e86\uff0c\u5c31\u505c\u6b62\u81ea\u52a8\u6e05\u7406\u3002 active-defrag-ignore-bytes 100mb \uff1a\u8868\u793a\u5185\u5b58\u788e\u7247\u7684\u5b57\u8282\u6570\u8fbe\u5230 100MB \u65f6\uff0c\u5f00\u59cb\u6e05\u7406\uff1b active-defrag-threshold-lower 10 \uff1a\u8868\u793a\u5185\u5b58\u788e\u7247\u7a7a\u95f4\u5360\u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u7ed9 Redis \u7684\u603b\u7a7a\u95f4\u6bd4\u4f8b\u8fbe\u5230 10% \u65f6\uff0c\u5f00\u59cb\u6e05\u7406\u3002","title":"4-3 \u89e6\u53d1\u5185\u5b58\u6e05\u7406\u6761\u4ef6"},{"location":"chap4/4redis_fragmentation/#4-4","text":"\u4e3a\u4e86\u5c3d\u53ef\u80fd\u51cf\u5c11\u788e\u7247\u6e05\u7406\u5bf9 Redis \u6b63\u5e38\u8bf7\u6c42\u5904\u7406\u7684\u5f71\u54cd \uff0c\u81ea\u52a8\u5185\u5b58\u788e\u7247\u6e05\u7406\u529f\u80fd\u5728\u6267\u884c\u65f6\uff0c\u8fd8\u4f1a\u76d1\u63a7\u6e05\u7406\u64cd\u4f5c\u5360\u7528\u7684 CPU \u65f6\u95f4\uff0c\u800c\u4e14\u8fd8\u8bbe\u7f6e\u4e86\u4e24\u4e2a\u53c2\u6570\uff0c\u5206\u522b\u7528\u4e8e\u63a7\u5236\u6e05\u7406\u64cd\u4f5c\u5360\u7528\u7684 CPU \u65f6\u95f4\u6bd4\u4f8b\u7684\u4e0a\u3001\u4e0b\u9650\uff0c\u65e2\u4fdd\u8bc1\u6e05\u7406\u5de5\u4f5c\u80fd\u6b63\u5e38\u8fdb\u884c\uff0c\u53c8\u907f\u514d\u4e86\u964d\u4f4e Redis \u6027\u80fd\u3002\u8fd9\u4e24\u4e2a\u53c2\u6570\u5177\u4f53\u5982\u4e0b\uff1a active-defrag-cycle-min 25 \uff1a \u8868\u793a\u81ea\u52a8\u6e05\u7406\u8fc7\u7a0b\u6240\u7528 CPU \u65f6\u95f4\u7684\u6bd4\u4f8b\u4e0d\u4f4e\u4e8e 25%\uff0c\u4fdd\u8bc1\u6e05\u7406\u80fd\u6b63\u5e38\u5f00\u5c55\uff1b active-defrag-cycle-max 75 \uff1a\u8868\u793a\u81ea\u52a8\u6e05\u7406\u8fc7\u7a0b\u6240\u7528 CPU \u65f6\u95f4\u7684\u6bd4\u4f8b\u4e0d\u9ad8\u4e8e 75%\uff0c\u4e00\u65e6\u8d85\u8fc7\uff0c\u5c31\u505c\u6b62\u6e05\u7406\uff0c\u4ece\u800c\u907f\u514d\u5728\u6e05\u7406\u65f6\uff0c\u5927\u91cf\u7684\u5185\u5b58\u62f7\u8d1d\u963b\u585e Redis\uff0c\u5bfc\u81f4\u54cd\u5e94\u5ef6\u8fdf\u5347\u9ad8\u3002 \u81ea\u52a8\u5185\u5b58\u788e\u7247\u6e05\u7406\u673a\u5236\u5728\u63a7\u5236\u788e\u7247\u6e05\u7406\u542f\u505c\u7684\u65f6\u673a\u4e0a\uff0c \u65e2\u8003\u8651\u4e86\u788e\u7247\u7684\u7a7a\u95f4\u5360\u6bd4\u3001\u5bf9 Redis \u5185\u5b58\u4f7f\u7528\u6548\u7387\u7684\u5f71\u54cd\uff0c\u8fd8\u8003\u8651\u4e86\u6e05\u7406\u673a\u5236\u672c\u8eab\u7684 CPU \u65f6\u95f4\u5360\u6bd4\u3001\u5bf9 Redis \u6027\u80fd\u7684\u5f71\u54cd \u3002","title":"4-4 \u51cf\u5c11\u788e\u7247\u6e05\u7406\u5f71\u54cd"},{"location":"chap4/4redis_fragmentation/#5","text":"Redis \u7684\u5185\u5b58\u7a7a\u95f4\u6548\u7387\u95ee\u9898 info memory \u547d\u4ee4\u662f\u4e00\u4e2a\u597d\u5de5\u5177\uff0c\u53ef\u4ee5\u5e2e\u52a9\u4f60\u67e5\u770b\u788e\u7247\u7387\u7684\u60c5\u51b5\uff1b \u788e\u7247\u7387\u9608\u503c\u662f\u4e00\u4e2a\u597d\u7ecf\u9a8c \uff0c\u53ef\u4ee5\u5e2e\u5fd9\u4f60\u6709\u6548\u5730\u5224\u65ad\u662f\u5426\u8981\u8fdb\u884c\u788e\u7247\u6e05\u7406\u4e86\uff1b \u5185\u5b58\u788e\u7247\u81ea\u52a8\u6e05\u7406\u662f\u4e00\u4e2a\u597d\u65b9\u6cd5 \uff0c\u53ef\u4ee5\u907f\u514d\u56e0\u4e3a\u788e\u7247\u5bfc\u81f4 Redis \u7684\u5185\u5b58\u5b9e\u9645\u5229\u7528\u7387\u964d\u4f4e\uff0c\u63d0\u5347\u6210\u672c\u6536\u76ca\u7387\u3002 \u5185\u5b58\u788e\u7247\u81ea\u52a8\u6e05\u7406\u6d89\u53ca\u5185\u5b58\u62f7\u8d1d\uff0c\u8fd9\u5bf9 Redis \u800c\u8a00\uff0c\u662f\u4e2a\u6f5c\u5728\u7684\u98ce\u9669\u3002\u5982\u679c\u4f60\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\u9047\u5230 Redis \u6027\u80fd\u53d8\u6162\uff0c\u8bb0\u5f97\u901a\u8fc7\u65e5\u5fd7\u770b\u4e0b\u662f\u5426\u6b63\u5728\u8fdb\u884c\u788e\u7247\u6e05\u7406\u3002 \u5982\u679c Redis \u7684\u786e\u6b63\u5728\u6e05\u7406\u788e\u7247\uff0c\u90a3\u4e48\uff0c\u6211\u5efa\u8bae\u4f60\u8c03\u5c0f active-defrag-cycle-max \u7684\u503c\uff0c\u4ee5\u51cf\u8f7b\u5bf9\u6b63\u5e38\u8bf7\u6c42\u5904\u7406\u7684\u5f71\u54cd\u3002","title":"5\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap4/5redis_buffer/","text":"\u7b2c\u4e94\u8282 Redis\u7f13\u51b2\u533a \u7f13\u51b2\u533a\u7684\u529f\u80fd\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u4e3b\u8981\u5c31\u662f\u7528\u4e00\u5757\u5185\u5b58\u7a7a\u95f4\u6765\u6682\u65f6\u5b58\u653e\u547d\u4ee4\u6570\u636e\uff0c\u4ee5\u514d\u51fa\u73b0\u56e0\u4e3a\u6570\u636e\u548c\u547d\u4ee4\u7684\u5904\u7406\u901f\u5ea6\u6162\u4e8e\u53d1\u9001\u901f\u5ea6\u800c\u5bfc\u81f4\u7684\u6570\u636e\u4e22\u5931\u548c\u6027\u80fd\u95ee\u9898\u3002 \u4f46\u56e0\u4e3a\u7f13\u51b2\u533a\u7684\u5185\u5b58\u7a7a\u95f4\u6709\u9650\uff0c \u5982\u679c\u5f80\u91cc\u9762\u5199\u5165\u6570\u636e\u7684\u901f\u5ea6\u6301\u7eed\u5730\u5927\u4e8e\u4ece\u91cc\u9762\u8bfb\u53d6\u6570\u636e\u7684\u901f\u5ea6\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7f13\u51b2\u533a\u9700\u8981\u8d8a\u6765\u8d8a\u591a\u7684\u5185\u5b58\u6765\u6682\u5b58\u6570\u636e\u3002\u5f53\u7f13\u51b2\u533a\u5360\u7528\u7684\u5185\u5b58\u8d85\u51fa\u4e86\u8bbe\u5b9a\u7684\u4e0a\u9650\u9608\u503c\u65f6\uff0c\u5c31\u4f1a\u51fa\u73b0\u7f13\u51b2\u533a\u6ea2\u51fa\u3002 \u5982\u679c\u4e0d\u7ed9\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u8bbe\u7f6e\u4e0a\u9650\uff0c\u968f\u7740\u7d2f\u79ef\u7684\u6570\u636e\u8d8a\u6765\u8d8a\u591a\uff0c \u7f13\u51b2\u533a\u5360\u7528\u5185\u5b58\u7a7a\u95f4\u8d8a\u6765\u8d8a\u5927\uff0c\u4e00\u65e6\u8017\u5c3d\u4e86 Redis \u5b9e\u4f8b\u6240\u5728\u673a\u5668\u7684\u53ef\u7528\u5185\u5b58\uff0c\u5c31\u4f1a\u5bfc\u81f4 Redis \u5b9e\u4f8b\u5d29\u6e83 \u3002 \u7f13\u51b2\u533a\u662f\u7528\u6765\u907f\u514d\u8bf7\u6c42\u6216\u6570\u636e\u4e22\u5931\u7684\u60e8\u6848\u7684 Redis \u662f\u5178\u578b\u7684 client-server \u67b6\u6784\uff0c\u6240\u6709\u7684\u64cd\u4f5c\u547d\u4ee4\u90fd\u9700\u8981\u901a\u8fc7\u5ba2\u6237\u7aef\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7aef\u3002 \u6240\u4ee5\uff0c\u7f13\u51b2\u533a\u5728 Redis \u4e2d\u7684\u4e00\u4e2a\u4e3b\u8981\u5e94\u7528\u573a\u666f\uff0c\u5c31\u662f\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u4e4b\u95f4\u8fdb\u884c\u901a\u4fe1\u65f6\uff0c\u7528\u6765\u6682\u5b58\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u547d\u4ee4\u6570\u636e\uff0c\u6216\u8005\u662f\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u6570\u636e\u7ed3\u679c\u3002 \u6b64\u5916\uff0c\u7f13\u51b2\u533a\u7684\u53e6\u4e00\u4e2a\u4e3b\u8981\u5e94\u7528\u573a\u666f\uff0c\u662f\u5728\u4e3b\u4ece\u8282\u70b9\u95f4\u8fdb\u884c\u6570\u636e\u540c\u6b65\u65f6\uff0c\u7528\u6765\u6682\u5b58\u4e3b\u8282\u70b9\u63a5\u6536\u7684\u5199\u547d\u4ee4\u548c\u6570\u636e \u3002 1\u3001\u5ba2\u6237\u7aef\u8f93\u5165\u548c\u8f93\u51fa\u7f13\u51b2\u533a \u770b\u770b\u670d\u52a1\u5668\u7aef\u548c\u5ba2\u6237\u7aef\u4e4b\u95f4\u7684\u7f13\u51b2\u533a \u4e3a\u4e86\u907f\u514d\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u7684\u8bf7\u6c42\u53d1\u9001\u548c\u5904\u7406\u901f\u5ea6\u4e0d\u5339\u914d\uff0c\u670d\u52a1\u5668\u7aef\u7ed9\u6bcf\u4e2a\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u90fd\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u8f93\u5165\u7f13\u51b2\u533a\u548c\u8f93\u51fa\u7f13\u51b2\u533a\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a \u5ba2\u6237\u7aef\u8f93\u5165\u7f13\u51b2\u533a\u548c\u8f93\u51fa\u7f13\u51b2\u533a \u3002 \u8f93\u5165\u7f13\u51b2\u533a\u4f1a\u5148\u628a\u5ba2\u6237\u7aef\u53d1\u9001\u8fc7\u6765\u7684\u547d\u4ee4\u6682\u5b58\u8d77\u6765\uff0c Redis \u4e3b\u7ebf\u7a0b\u518d\u4ece\u8f93\u5165\u7f13\u51b2\u533a\u4e2d\u8bfb\u53d6\u547d\u4ee4\uff0c\u8fdb\u884c\u5904\u7406 \u5f53 Redis \u4e3b\u7ebf\u7a0b\u5904\u7406\u5b8c\u6570\u636e\u540e\uff0c\u4f1a\u628a\u7ed3\u679c\u5199\u5165\u5230\u8f93\u51fa\u7f13\u51b2\u533a\uff0c\u518d\u901a\u8fc7\u8f93\u51fa\u7f13\u51b2\u533a\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef 2\u3001\u5982\u4f55\u5e94\u5bf9\u8f93\u5165\u7f13\u51b2\u533a\u6ea2\u51fa\uff1f 2-1 \u7f13\u51b2\u533a\u6ea2\u51fa\u68c0\u67e5 \u8f93\u5165\u7f13\u51b2\u533a\u5c31\u662f\u7528\u6765\u6682\u5b58\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\u547d\u4ee4\u7684\uff0c\u6240\u4ee5\u53ef\u80fd\u5bfc\u81f4\u6ea2\u51fa\u7684\u60c5\u51b5\u4e3b\u8981\u662f\u4e0b\u9762\u4e24\u79cd\uff1a \u5199\u5165\u4e86 bigkey\uff0c\u6bd4\u5982\u4e00\u4e0b\u5b50\u5199\u5165\u4e86\u591a\u4e2a\u767e\u4e07\u7ea7\u522b\u7684\u96c6\u5408\u7c7b\u578b\u6570\u636e\uff1b \u670d\u52a1\u5668\u7aef\u5904\u7406\u8bf7\u6c42\u7684\u901f\u5ea6\u8fc7\u6162\uff0c \u4f8b\u5982\uff0cRedis \u4e3b\u7ebf\u7a0b\u51fa\u73b0\u4e86\u95f4\u6b47\u6027\u963b\u585e\uff0c\u65e0\u6cd5\u53ca\u65f6\u5904\u7406\u6b63\u5e38\u53d1\u9001\u7684\u8bf7\u6c42\uff0c\u5bfc\u81f4\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\u5728\u7f13\u51b2\u533a\u8d8a\u79ef\u8d8a\u591a \u3002 \u5982\u4f55\u67e5\u770b\u8f93\u5165\u7f13\u51b2\u533a\u7684\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\uff0c\u4ee5\u53ca\u5982\u4f55\u907f\u514d\u6ea2\u51fa \u8981\u67e5\u770b\u548c\u670d\u52a1\u5668\u7aef\u76f8\u8fde\u7684\u6bcf\u4e2a\u5ba2\u6237\u7aef\u5bf9\u8f93\u5165\u7f13\u51b2\u533a\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 CLIENT LIST \u547d\u4ee4\uff1a CLIENT LIST id=5 addr=127.0.0.1:50487 fd=9 name= age=4 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=26 qbuf-free=32742 obl=0 oll=0 omem=0 events=r cmd=client CLIENT \u547d\u4ee4\u8fd4\u56de\u7684\u4fe1\u606f\u867d\u7136\u5f88\u591a\uff0c\u4f46\u6211\u4eec\u53ea\u9700\u8981\u91cd\u70b9\u5173\u6ce8\u4e24\u7c7b\u4fe1\u606f\u5c31\u53ef\u4ee5\u4e86\u3002 \u4e00\u7c7b\u662f\u4e0e\u670d\u52a1\u5668\u7aef\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u7684\u4fe1\u606f\u3002 \u8fd9\u4e2a\u6848\u4f8b\u5c55\u793a\u7684\u662f\u4e00\u4e2a\u5ba2\u6237\u7aef\u7684\u8f93\u5165\u7f13\u51b2\u533a\u60c5\u51b5\uff0c\u5982\u679c\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\uff0c\u8f93\u51fa\u7ed3\u679c\u4e2d\u7684 addr \u4f1a\u663e\u793a\u4e0d\u540c\u5ba2\u6237\u7aef\u7684 IP \u548c\u7aef\u53e3\u53f7\u3002 \u53e6\u4e00\u7c7b\u662f\u4e0e\u8f93\u5165\u7f13\u51b2\u533a\u76f8\u5173\u7684\u4e09\u4e2a\u53c2\u6570\uff1a cmd \uff0c \u8868\u793a\u5ba2\u6237\u7aef\u6700\u65b0\u6267\u884c\u7684\u547d\u4ee4 \u3002\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u6267\u884c\u7684\u662f CLIENT \u547d\u4ee4\u3002 qbuf \uff0c \u8868\u793a\u8f93\u5165\u7f13\u51b2\u533a\u5df2\u7ecf\u4f7f\u7528\u7684\u5927\u5c0f \u3002\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u7684 CLIENT \u547d\u4ee4\u5df2\u4f7f\u7528\u4e86 26 \u5b57\u8282\u5927\u5c0f\u7684\u7f13\u51b2\u533a\u3002 qbuf-free \uff0c\u8868\u793a\u8f93\u5165\u7f13\u51b2\u533a\u5c1a\u672a\u4f7f\u7528\u7684\u5927\u5c0f \u3002\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u7684 CLIENT \u547d\u4ee4\u8fd8\u53ef\u4ee5\u4f7f\u7528 32742 \u5b57\u8282\u7684\u7f13\u51b2\u533a\u3002 qbuf \u548c qbuf-free \u7684\u603b\u548c\u5c31\u662f\uff0cRedis \u670d\u52a1\u5668\u7aef\u5f53\u524d\u4e3a\u5df2\u8fde\u63a5\u7684\u8fd9\u4e2a\u5ba2\u6237\u7aef\u5206\u914d\u7684\u7f13\u51b2\u533a\u603b\u5927\u5c0f\u3002\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u603b\u5171\u5206\u914d\u4e86 26 + 32742 = 32768 \u5b57\u8282\uff0c\u4e5f\u5c31\u662f 32KB \u7684\u7f13\u51b2\u533a\u3002 2-2 \u7f13\u51b2\u533a\u6ea2\u7684\u98ce\u9669 \u6709\u4e86 CLIENT LIST \u547d\u4ee4\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u8f93\u51fa\u7ed3\u679c\u6765\u5224\u65ad\u5ba2\u6237\u7aef\u8f93\u5165\u7f13\u51b2\u533a\u7684\u5185\u5b58\u5360\u7528\u60c5\u51b5\u4e86\u3002 \u5982\u679c qbuf \u5f88\u5927\uff0c\u800c\u540c\u65f6 qbuf-free \u5f88\u5c0f\uff0c\u5c31\u8981\u5f15\u8d77\u6ce8\u610f\u4e86\uff0c\u56e0\u4e3a\u8fd9\u65f6\u5019\u8f93\u5165\u7f13\u51b2\u533a\u5df2\u7ecf\u5360\u7528\u4e86\u5f88\u591a\u5185\u5b58\uff0c\u800c\u4e14\u6ca1\u6709\u4ec0\u4e48\u7a7a\u95f2\u7a7a\u95f4\u4e86 \u3002 \u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u518d\u5199\u5165\u5927\u91cf\u547d\u4ee4\u7684\u8bdd\uff0c\u5c31\u4f1a\u5f15\u8d77\u5ba2\u6237\u7aef\u8f93\u5165\u7f13\u51b2\u533a\u6ea2\u51fa\uff0cRedis \u7684\u5904\u7406\u529e\u6cd5\u5c31\u662f\u628a\u5ba2\u6237\u7aef\u8fde\u63a5\u5173\u95ed\uff0c\u7ed3\u679c\u5c31\u662f\u4e1a\u52a1\u7a0b\u5e8f\u65e0\u6cd5\u8fdb\u884c\u6570\u636e\u5b58\u53d6\u4e86\u3002 \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c Redis \u670d\u52a1\u5668\u7aef\u4e0d\u6b62\u670d\u52a1\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u5f53\u591a\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u5360\u7528\u7684\u5185\u5b58\u603b\u91cf\uff0c\u8d85\u8fc7\u4e86 Redis \u7684 maxmemory \u914d\u7f6e\u9879\u65f6\uff08\u4f8b\u5982 4GB\uff09\uff0c\u5c31\u4f1a\u89e6\u53d1 Redis \u8fdb\u884c\u6570\u636e\u6dd8\u6c70 \u3002\u4e00\u65e6\u6570\u636e\u88ab\u6dd8\u6c70\u51fa Redis\uff0c\u518d\u8981\u8bbf\u95ee\u8fd9\u90e8\u5206\u6570\u636e\uff0c\u5c31\u9700\u8981\u53bb\u540e\u7aef\u6570\u636e\u5e93\u8bfb\u53d6\uff0c\u8fd9\u5c31\u964d\u4f4e\u4e86\u4e1a\u52a1\u5e94\u7528\u7684\u8bbf\u95ee\u6027\u80fd \u66f4\u7cdf\u7cd5\u7684\u662f\uff0c\u5982\u679c\u4f7f\u7528\u591a\u4e2a\u5ba2\u6237\u7aef\uff0c\u5bfc\u81f4 Redis \u5185\u5b58\u5360\u7528\u8fc7\u5927\uff0c\u4e5f\u4f1a\u5bfc\u81f4\u5185\u5b58\u6ea2\u51fa\uff08 out-of-memory \uff09\u95ee\u9898\uff0c\u8fdb\u800c\u4f1a\u5f15\u8d77 Redis \u5d29\u6e83\uff0c\u7ed9\u4e1a\u52a1\u5e94\u7528\u9020\u6210\u4e25\u91cd\u5f71\u54cd\u3002 2-3 \u907f\u514d\u8f93\u5165\u7f13\u51b2\u533a\u6ea2\u51fa \u907f\u514d\u8f93\u5165\u7f13\u51b2\u533a\u6ea2\u51fa\u3002\u6211\u4eec\u53ef\u4ee5\u4ece\u4e24\u4e2a\u89d2\u5ea6\u53bb\u8003\u8651\u5982\u4f55\u907f\u514d\uff0c \u4e00\u662f\u628a\u7f13\u51b2\u533a\u8c03\u5927\uff0c\u4e8c\u662f\u4ece\u6570\u636e\u547d\u4ee4\u7684\u53d1\u9001\u548c\u5904\u7406\u901f\u5ea6\u5165\u624b\u3002 \u5e95\u6709\u6ca1\u6709\u529e\u6cd5\u901a\u8fc7\u53c2\u6570\u8c03\u6574\u8f93\u5165\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u5462\uff1f\u7b54\u6848\u662f\u6ca1\u6709\u3002 Redis \u7684\u5ba2\u6237\u7aef\u8f93\u5165\u7f13\u51b2\u533a\u5927\u5c0f\u7684\u4e0a\u9650\u9608\u503c\uff0c\u5728\u4ee3\u7801\u4e2d\u5c31\u8bbe\u5b9a\u4e3a\u4e86 1GB\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cRedis \u670d\u52a1\u5668\u7aef\u5141\u8bb8\u4e3a\u6bcf\u4e2a\u5ba2\u6237\u7aef\u6700\u591a\u6682\u5b58 1GB \u7684\u547d\u4ee4\u548c\u6570\u636e\u3002 1GB \u7684\u5927\u5c0f\uff0c\u5bf9\u4e8e\u4e00\u822c\u7684\u751f\u4ea7\u73af\u5883\u5df2\u7ecf\u662f\u6bd4\u8f83\u5408\u9002\u7684\u4e86 \u3002 \u4e00\u65b9\u9762\uff0c\u8fd9\u4e2a\u5927\u5c0f\u5bf9\u4e8e\u5904\u7406\u7edd\u5927\u90e8\u5206\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u5df2\u7ecf\u591f\u7528\u4e86\uff1b \u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c\u518d\u5927\u7684\u8bdd\uff0c Redis \u5c31\u6709\u53ef\u80fd\u56e0\u4e3a\u5ba2\u6237\u7aef\u5360\u7528\u4e86\u8fc7\u591a\u7684\u5185\u5b58\u8d44\u6e90\u800c\u5d29\u6e83 \u3002 Redis \u5e76\u6ca1\u6709\u63d0\u4f9b\u53c2\u6570\u8ba9\u6211\u4eec\u8c03\u8282\u5ba2\u6237\u7aef\u8f93\u5165\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u3002 \u5982\u679c\u8981\u907f\u514d\u8f93\u5165\u7f13\u51b2\u533a\u6ea2\u51fa\uff0c\u90a3\u6211\u4eec\u5c31\u53ea\u80fd\u4ece\u6570\u636e\u547d\u4ee4\u7684\u53d1\u9001\u548c\u5904\u7406\u901f\u5ea6\u5165\u624b\uff0c\u4e5f\u5c31\u662f\u524d\u9762\u63d0\u5230\u7684\u907f\u514d\u5ba2\u6237\u7aef\u5199\u5165 bigkey\uff0c\u4ee5\u53ca\u907f\u514d Redis \u4e3b\u7ebf\u7a0b\u963b\u585e \u3002 3\u3001\u5982\u4f55\u5e94\u5bf9\u8f93\u51fa\u7f13\u51b2\u533a\u6ea2\u51fa\uff1f Redis \u7684\u8f93\u51fa\u7f13\u51b2\u533a\u6682\u5b58\u7684\u662f Redis \u4e3b\u7ebf\u7a0b\u8981\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u6570\u636e\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u4e3b\u7ebf\u7a0b\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u6570\u636e\uff0c\u65e2\u6709\u7b80\u5355\u4e14\u5927\u5c0f\u56fa\u5b9a\u7684 OK \u54cd\u5e94\uff08\u4f8b\u5982\uff0c\u6267\u884c SET \u547d\u4ee4\uff09\u6216\u62a5\u9519\u4fe1\u606f\uff0c\u4e5f\u6709\u5927\u5c0f\u4e0d\u56fa\u5b9a\u7684\u3001\u5305\u542b\u5177\u4f53\u6570\u636e\u7684\u6267\u884c\u7ed3\u679c\uff08\u4f8b\u5982\uff0c\u6267\u884c HGET \u547d\u4ee4\uff09\u3002 Redis \u4e3a\u6bcf\u4e2a\u5ba2\u6237\u7aef\u8bbe\u7f6e\u7684\u8f93\u51fa\u7f13\u51b2\u533a\u4e5f\u5305\u62ec\u4e24\u90e8\u5206\uff1a \u662f\u4e00\u4e2a\u5927\u5c0f\u4e3a 16KB \u7684\u56fa\u5b9a\u7f13\u51b2\u7a7a\u95f4\uff0c\u7528\u6765\u6682\u5b58 OK \u54cd\u5e94\u548c\u51fa\u9519\u4fe1\u606f\uff1b \u662f\u4e00\u4e2a\u53ef\u4ee5\u52a8\u6001\u589e\u52a0\u7684\u7f13\u51b2\u7a7a\u95f4\uff0c\u7528\u6765\u6682\u5b58\u5927\u5c0f\u53ef\u53d8\u7684\u54cd\u5e94\u7ed3\u679c\u3002 \u90a3\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u53d1\u751f\u8f93\u51fa\u7f13\u51b2\u533a\u6ea2\u51fa\u5462\uff1f \u6211\u4e3a\u4f60\u603b\u7ed3\u4e86\u4e09\u79cd\uff1a \u670d\u52a1\u5668\u7aef\u8fd4\u56de bigkey \u7684\u5927\u91cf\u7ed3\u679c\uff1b \u6267\u884c\u4e86 MONITOR \u547d\u4ee4\uff1b \u7f13\u51b2\u533a\u5927\u5c0f\u8bbe\u7f6e\u5f97\u4e0d\u5408\u7406\u3002 \u5176\u4e2d\uff0cbigkey \u539f\u672c\u5c31\u4f1a\u5360\u7528\u5927\u91cf\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u6240\u4ee5\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u7684\u7ed3\u679c\u5305\u542b bigkey\uff0c\u5fc5\u7136\u4f1a\u5f71\u54cd\u8f93\u51fa\u7f13\u51b2\u533a MONITOR \u547d\u4ee4\u662f\u7528\u6765\u76d1\u6d4b Redis \u6267\u884c\u7684\u3002 \u6267\u884c\u8fd9\u4e2a\u547d\u4ee4\u4e4b\u540e\uff0c\u5c31\u4f1a\u6301\u7eed\u8f93\u51fa\u76d1\u6d4b\u5230\u7684\u5404\u4e2a\u547d\u4ee4\u64cd\u4f5c\uff0c\u5982\u4e0b\u6240\u793a\uff1a MONITOR OK 1600617456.437129 [0 127.0.0.1:50487] \"COMMAND\" 1600617477.289667 [0 127.0.0.1:50487] \"info\" \"memory\" MONITOR \u7684\u8f93\u51fa\u7ed3\u679c\u4f1a\u6301\u7eed\u5360\u7528\u8f93\u51fa\u7f13\u51b2\u533a\uff0c\u5e76\u8d8a\u5360\u8d8a\u591a\uff0c\u6700\u540e\u7684\u7ed3\u679c\u5c31\u662f\u53d1\u751f\u6ea2\u51fa\u3002 \u6211\u8981\u7ed9\u4f60\u4e00\u4e2a\u5c0f\u5efa\u8bae\uff1a MONITOR \u547d\u4ee4\u4e3b\u8981\u7528\u5728\u8c03\u8bd5\u73af\u5883\u4e2d\uff0c\u4e0d\u8981\u5728\u7ebf\u4e0a\u751f\u4ea7\u73af\u5883\u4e2d\u6301\u7eed\u4f7f\u7528 MONITOR\u3002 \u5982\u679c\u5728\u7ebf\u4e0a\u73af\u5883\u4e2d\u5076\u5c14\u4f7f\u7528 MONITOR \u68c0\u67e5 Redis \u7684\u547d\u4ee4\u6267\u884c\u60c5\u51b5\uff0c\u662f\u6ca1\u95ee\u9898\u7684\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u770b\u4e0b\u8f93\u51fa\u7f13\u51b2\u533a\u5927\u5c0f\u8bbe\u7f6e\u7684\u95ee\u9898\u3002 \u548c\u8f93\u5165\u7f13\u51b2\u533a\u4e0d\u540c\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 client-output-buffer-limit \u914d\u7f6e\u9879\uff0c\u6765\u8bbe\u7f6e\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u3002\u5177\u4f53\u8bbe\u7f6e\u7684\u5185\u5bb9\u5305\u62ec\u4e24\u65b9\u9762\uff1a \u8bbe\u7f6e\u7f13\u51b2\u533a\u5927\u5c0f\u7684\u4e0a\u9650\u9608\u503c\uff1b \u8bbe\u7f6e\u8f93\u51fa\u7f13\u51b2\u533a\u6301\u7eed\u5199\u5165\u6570\u636e\u7684\u6570\u91cf\u4e0a\u9650\u9608\u503c\uff0c\u548c\u6301\u7eed\u5199\u5165\u6570\u636e\u7684\u65f6\u95f4\u7684\u4e0a\u9650\u9608\u503c\u3002 client-output-buffer-limit \u6765\u8bbe\u7f6e\u8f93\u51fa\u7f13\u51b2\u533a\u7684\u5927\u5c0f \u5728\u5177\u4f53\u4f7f\u7528 client-output-buffer-limit \u6765\u8bbe\u7f6e\u7f13\u51b2\u533a\u5927\u5c0f\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u5148\u533a\u5206\u4e0b\u5ba2\u6237\u7aef\u7684\u7c7b\u578b\u3002 \u5bf9\u4e8e\u548c Redis \u5b9e\u4f8b\u8fdb\u884c\u4ea4\u4e92\u7684\u5e94\u7528\u7a0b\u5e8f\u6765\u8bf4\uff0c\u4e3b\u8981\u4f7f\u7528\u4e24\u7c7b\u5ba2\u6237\u7aef\u548c Redis \u670d\u52a1\u5668\u7aef\u4ea4\u4e92\uff0c\u5206\u522b\u662f \u5e38\u89c4\u548c Redis \u670d\u52a1\u5668\u7aef\u8fdb\u884c\u8bfb\u5199\u547d\u4ee4\u4ea4\u4e92\u7684\u666e\u901a\u5ba2\u6237\u7aef \uff0c\u4ee5\u53ca\u8ba2\u9605\u4e86 Redis \u9891\u9053\u7684\u8ba2\u9605\u5ba2\u6237\u7aef\u3002 \u6b64\u5916\uff0c \u5728 Redis \u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c\u4e3b\u8282\u70b9\u4e0a\u4e5f\u6709\u4e00\u7c7b\u5ba2\u6237\u7aef\uff08\u4ece\u8282\u70b9\u5ba2\u6237\u7aef\uff09\u7528\u6765\u548c\u4ece\u8282\u70b9\u8fdb\u884c\u6570\u636e\u540c\u6b65 \uff0c\u6211\u4f1a\u5728\u4ecb\u7ecd\u4e3b\u4ece\u96c6\u7fa4\u4e2d\u7684\u7f13\u51b2\u533a\u65f6\uff0c\u5411\u4f60\u5177\u4f53\u4ecb\u7ecd\u3002 \u5f53\u6211\u4eec\u7ed9\u666e\u901a\u5ba2\u6237\u7aef\u8bbe\u7f6e\u7f13\u51b2\u533a\u5927\u5c0f\u65f6\uff0c\u901a\u5e38\u53ef\u4ee5\u5728 Redis \u914d\u7f6e\u6587\u4ef6\u4e2d\u8fdb\u884c\u8fd9\u6837\u7684\u8bbe\u7f6e\uff1a client-output-buffer-limit normal 0 0 0 \u5176\u4e2d\uff0cnormal \u8868\u793a\u5f53\u524d\u8bbe\u7f6e\u7684\u662f\u666e\u901a\u5ba2\u6237\u7aef\uff0c \u7b2c 1 \u4e2a 0 \u8bbe\u7f6e\u7684\u662f\u7f13\u51b2\u533a\u5927\u5c0f\u9650\u5236\uff0c\u7b2c 2 \u4e2a 0 \u548c\u7b2c 3 \u4e2a 0 \u5206\u522b\u8868\u793a\u7f13\u51b2\u533a\u6301\u7eed\u5199\u5165\u91cf\u9650\u5236\u548c\u6301\u7eed\u5199\u5165\u65f6\u95f4\u9650\u5236 \u3002 \u5bf9\u4e8e\u666e\u901a\u5ba2\u6237\u7aef\u6765\u8bf4\uff0c\u5b83\u6bcf\u53d1\u9001\u5b8c\u4e00\u4e2a\u8bf7\u6c42\uff0c\u4f1a\u7b49\u5230\u8bf7\u6c42\u7ed3\u679c\u8fd4\u56de\u540e\uff0c\u518d\u53d1\u9001\u4e0b\u4e00\u4e2a\u8bf7\u6c42\uff0c\u8fd9\u79cd\u53d1\u9001\u65b9\u5f0f\u79f0\u4e3a\u963b\u585e\u5f0f\u53d1\u9001\u3002 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u4e0d\u662f\u8bfb\u53d6\u4f53\u91cf\u7279\u522b\u5927\u7684 bigkey\uff0c\u670d\u52a1\u5668\u7aef\u7684\u8f93\u51fa\u7f13\u51b2\u533a\u4e00\u822c\u4e0d\u4f1a\u88ab\u963b\u585e\u7684\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u901a\u5e38\u628a\u666e\u901a\u5ba2\u6237\u7aef\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u9650\u5236\uff0c\u4ee5\u53ca\u6301\u7eed\u5199\u5165\u91cf\u9650\u5236\u3001\u6301\u7eed\u5199\u5165\u65f6\u95f4\u9650\u5236\u90fd\u8bbe\u7f6e\u4e3a 0\uff0c\u4e5f\u5c31\u662f\u4e0d\u505a\u9650\u5236\u3002 \u5bf9\u4e8e\u8ba2\u9605\u5ba2\u6237\u7aef\u6765\u8bf4\uff0c\u4e00\u65e6\u8ba2\u9605\u7684 Redis \u9891\u9053\u6709\u6d88\u606f\u4e86\uff0c\u670d\u52a1\u5668\u7aef\u90fd\u4f1a\u901a\u8fc7\u8f93\u51fa\u7f13\u51b2\u533a\u628a\u6d88\u606f\u53d1\u7ed9\u5ba2\u6237\u7aef\u3002 \u6240\u4ee5\uff0c\u8ba2\u9605\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u95f4\u7684\u6d88\u606f\u53d1\u9001\u65b9\u5f0f\uff0c\u4e0d\u5c5e\u4e8e\u963b\u585e\u5f0f\u53d1\u9001\u3002 \u4e0d\u8fc7\uff0c\u5982\u679c\u9891\u9053\u6d88\u606f\u8f83\u591a\u7684\u8bdd\uff0c\u4e5f\u4f1a\u5360\u7528\u8f83\u591a\u7684\u8f93\u51fa\u7f13\u51b2\u533a\u7a7a\u95f4\u3002 \u56e0\u6b64\uff0c \u6211\u4eec\u4f1a\u7ed9\u8ba2\u9605\u5ba2\u6237\u7aef\u8bbe\u7f6e\u7f13\u51b2\u533a\u5927\u5c0f\u9650\u5236\u3001\u7f13\u51b2\u533a\u6301\u7eed\u5199\u5165\u91cf\u9650\u5236\uff0c\u4ee5\u53ca\u6301\u7eed\u5199\u5165\u65f6\u95f4\u9650\u5236 \uff0c\u53ef\u4ee5\u5728 Redis \u914d\u7f6e\u6587\u4ef6\u4e2d\u8fd9\u6837\u8bbe\u7f6e\uff1a client-output-buffer-limit pubsub 8mb 2mb 60 \u5176\u4e2d\uff0cpubsub \u53c2\u6570\u8868\u793a\u5f53\u524d\u662f\u5bf9\u8ba2\u9605\u5ba2\u6237\u7aef\u8fdb\u884c\u8bbe\u7f6e\uff1b 8mb \u8868\u793a \u8f93\u51fa\u7f13\u51b2\u533a \u7684\u5927\u5c0f\u4e0a\u9650\u4e3a 8MB\uff0c\u4e00\u65e6\u5b9e\u9645\u5360\u7528\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u8981\u8d85\u8fc7 8MB\uff0c\u670d\u52a1\u5668\u7aef\u5c31\u4f1a\u76f4\u63a5\u5173\u95ed\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\uff1b 2mb \u548c 60 \u8868\u793a\uff0c\u5982\u679c\u8fde\u7eed 60 \u79d2\u5185\u5bf9\u8f93\u51fa\u7f13\u51b2\u533a\u7684\u5199\u5165\u91cf\u8d85\u8fc7 2MB \u7684\u8bdd\uff0c\u670d\u52a1\u5668\u7aef\u4e5f\u4f1a\u5173\u95ed\u5ba2\u6237\u7aef\u8fde\u63a5\u3002 \u597d\u4e86\uff0c\u6211\u4eec\u6765\u603b\u7ed3\u4e0b\u5982\u4f55\u5e94\u5bf9\u8f93\u51fa\u7f13\u51b2\u533a\u6ea2\u51fa\uff1a \u907f\u514d bigkey \u64cd\u4f5c\u8fd4\u56de\u5927\u91cf\u6570\u636e\u7ed3\u679c\uff1b \u907f\u514d\u5728\u7ebf\u4e0a\u73af\u5883\u4e2d\u6301\u7eed\u4f7f\u7528 MONITOR \u547d\u4ee4\u3002 \u4f7f\u7528 client-output-buffer-limit \u8bbe\u7f6e\u5408\u7406\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u4e0a\u9650\uff0c\u6216\u662f\u7f13\u51b2\u533a\u8fde\u7eed\u5199\u5165\u65f6\u95f4\u548c\u5199\u5165\u91cf\u4e0a\u9650\u3002 4\u3001\u4e3b\u4ece\u96c6\u7fa4\u4e2d\u7684\u7f13\u51b2\u533a \u4e3b\u4ece\u96c6\u7fa4\u95f4\u7684\u6570\u636e\u590d\u5236\u5305\u62ec\u5168\u91cf\u590d\u5236\u548c\u589e\u91cf\u590d\u5236\u4e24\u79cd\u3002 \u5168\u91cf\u590d\u5236\u662f\u540c\u6b65\u6240\u6709\u6570\u636e\uff0c\u800c\u589e\u91cf\u590d\u5236\u53ea\u4f1a\u628a\u4e3b\u4ece\u5e93\u7f51\u7edc\u65ad\u8fde\u671f\u95f4\u4e3b\u5e93\u6536\u5230\u7684\u547d\u4ee4\uff0c\u540c\u6b65\u7ed9\u4ece\u5e93 \u65e0\u8bba\u5728\u54ea\u79cd\u5f62\u5f0f\u7684\u590d\u5236\u4e2d\uff0c \u4e3a\u4e86\u4fdd\u8bc1\u4e3b\u4ece\u8282\u70b9\u7684\u6570\u636e\u4e00\u81f4\uff0c\u90fd\u4f1a\u7528\u5230\u7f13\u51b2\u533a \u3002 \u4f46\u662f\uff0c\u8fd9\u4e24\u79cd\u590d\u5236\u573a\u666f\u4e0b\u7684\u7f13\u51b2\u533a\uff0c\u5728\u6ea2\u51fa\u5f71\u54cd\u548c\u5927\u5c0f\u8bbe\u7f6e\u65b9\u9762\u5e76\u4e0d\u4e00\u6837\u3002 5\u3001\u590d\u5236\u7f13\u51b2\u533a\u7684\u6ea2\u51fa\u95ee\u9898 5-1 \u590d\u5236\u7f13\u51b2\u533a\u7684\u539f\u56e0 \u5728\u5168\u91cf\u590d\u5236\u8fc7\u7a0b\u4e2d\uff0c\u4e3b\u8282\u70b9\u5728\u5411\u4ece\u8282\u70b9\u4f20\u8f93 RDB \u6587\u4ef6\u7684\u540c\u65f6\uff0c\u4f1a\u7ee7\u7eed\u63a5\u6536\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u5199\u547d\u4ee4\u8bf7\u6c42\u3002 \u8fd9\u4e9b\u5199\u547d\u4ee4\u5c31\u4f1a\u5148\u4fdd\u5b58\u5728\u590d\u5236\u7f13\u51b2\u533a\u4e2d\uff0c\u7b49 RDB \u6587\u4ef6\u4f20\u8f93\u5b8c\u6210\u540e\uff0c\u518d\u53d1\u9001\u7ed9\u4ece\u8282\u70b9\u53bb\u6267\u884c \u3002 \u4e3b\u8282\u70b9\u4e0a\u4f1a\u4e3a\u6bcf\u4e2a\u4ece\u8282\u70b9\u90fd\u7ef4\u62a4\u4e00\u4e2a\u590d\u5236\u7f13\u51b2\u533a\uff0c\u6765\u4fdd\u8bc1\u4e3b\u4ece\u8282\u70b9\u95f4\u7684\u6570\u636e\u540c\u6b65\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u5728\u5168\u91cf\u590d\u5236\u65f6\uff0c\u4ece\u8282\u70b9\u63a5\u6536\u548c\u52a0\u8f7d RDB \u8f83\u6162\uff0c\u540c\u65f6\u4e3b\u8282\u70b9\u63a5\u6536\u5230\u4e86\u5927\u91cf\u7684\u5199\u547d\u4ee4\uff0c \u5199\u547d\u4ee4\u5728\u590d\u5236\u7f13\u51b2\u533a\u4e2d\u5c31\u4f1a\u8d8a\u79ef\u8d8a\u591a\uff0c\u6700\u7ec8\u5bfc\u81f4\u6ea2\u51fa \u3002 \u5176\u5b9e\uff0c\u4e3b\u8282\u70b9\u4e0a\u7684\u590d\u5236\u7f13\u51b2\u533a\uff0c\u672c\u8d28\u4e0a\u4e5f\u662f\u4e00\u4e2a\u7528\u4e8e\u548c\u4ece\u8282\u70b9\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\uff08\u6211\u4eec\u79f0\u4e4b\u4e3a\u4ece\u8282\u70b9\u5ba2\u6237\u7aef\uff09\uff0c\u4f7f\u7528\u7684\u8f93\u51fa\u7f13\u51b2\u533a\u3002 \u590d\u5236\u7f13\u51b2\u533a\u4e00\u65e6\u53d1\u751f\u6ea2\u51fa\uff0c\u4e3b\u8282\u70b9\u4e5f\u4f1a\u76f4\u63a5\u5173\u95ed\u548c\u4ece\u8282\u70b9\u8fdb\u884c\u590d\u5236\u64cd\u4f5c\u7684\u8fde\u63a5\uff0c\u5bfc\u81f4\u5168\u91cf\u590d\u5236\u5931\u8d25\u3002 5-2 \u5982\u4f55\u907f\u514d\u590d\u5236\u7f13\u51b2\u533a\u53d1\u751f\u6ea2\u51fa\u5462\uff1f \u6211\u4eec\u53ef\u4ee5\u63a7\u5236\u4e3b\u8282\u70b9\u4fdd\u5b58\u7684\u6570\u636e\u91cf\u5927\u5c0f \u3002\u6309\u901a\u5e38\u7684\u4f7f\u7528\u7ecf\u9a8c\uff0c\u6211\u4eec\u4f1a\u628a\u4e3b\u8282\u70b9\u7684\u6570\u636e\u91cf\u63a7\u5236\u5728 2~4GB\uff0c\u8fd9\u6837\u53ef\u4ee5\u8ba9\u5168\u91cf\u540c\u6b65\u6267\u884c\u5f97\u66f4\u5feb\u4e9b\uff0c\u907f\u514d\u590d\u5236\u7f13\u51b2\u533a\u7d2f\u79ef\u8fc7\u591a\u547d\u4ee4\u3002 \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 client-output-buffer-limit \u914d\u7f6e\u9879\uff0c\u6765\u8bbe\u7f6e\u5408\u7406\u7684\u590d\u5236\u7f13\u51b2\u533a\u5927\u5c0f \u3002\u8bbe\u7f6e\u7684\u4f9d\u636e\uff0c\u5c31\u662f\u4e3b\u8282\u70b9\u7684\u6570\u636e\u91cf\u5927\u5c0f\u3001\u4e3b\u8282\u70b9\u7684\u5199\u8d1f\u8f7d\u538b\u529b\u548c\u4e3b\u8282\u70b9\u672c\u8eab\u7684\u5185\u5b58\u5927\u5c0f\u3002 config set client-output-buffer-limit slave 512mb 128mb 60 slave \u53c2\u6570\u8868\u660e\u8be5\u914d\u7f6e\u9879\u662f \u9488\u5bf9\u590d\u5236\u7f13\u51b2\u533a\u7684 \u3002 512mb \u4ee3\u8868\u5c06\u7f13\u51b2\u533a\u5927\u5c0f\u7684\u4e0a\u9650\u8bbe\u7f6e\u4e3a 512MB\uff1b 128mb \u548c 60 \u4ee3\u8868\u7684\u8bbe\u7f6e\u662f\uff0c\u5982\u679c\u8fde\u7eed 60 \u79d2\u5185\u7684\u5199\u5165\u91cf\u8d85\u8fc7 128MB \u7684\u8bdd\uff0c\u4e5f\u4f1a\u89e6\u53d1\u7f13\u51b2\u533a\u6ea2\u51fa\u3002 \u5047\u8bbe\u4e00\u6761\u5199\u547d\u4ee4\u6570\u636e\u662f 1KB\uff0c\u90a3\u4e48\uff0c\u590d\u5236\u7f13\u51b2\u533a\u53ef\u4ee5\u7d2f\u79ef 512K \u6761\uff08512MB/1KB = 512K\uff09\u5199\u547d\u4ee4\u3002\u540c\u65f6\uff0c\u4e3b\u8282\u70b9\u5728\u5168\u91cf\u590d\u5236\u671f\u95f4\uff0c\u53ef\u4ee5\u627f\u53d7\u7684\u5199\u547d\u4ee4\u901f\u7387\u4e0a\u9650\u662f 2000 \u6761 /s\uff08128MB/1KB/60 \u7ea6\u7b49\u4e8e 2000\uff09\u3002 \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\u8bbe\u7f6e\u590d\u5236\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u65f6\uff0c \u53ef\u4ee5\u6839\u636e\u5199\u547d\u4ee4\u6570\u636e\u7684\u5927\u5c0f\u548c\u5e94\u7528\u7684\u5b9e\u9645\u8d1f\u8f7d\u60c5\u51b5\uff08\u4e5f\u5c31\u662f\u5199\u547d\u4ee4\u901f\u7387\uff09\uff0c\u6765\u7c97\u7565\u4f30\u8ba1\u7f13\u51b2\u533a\u4e2d\u4f1a\u7d2f\u79ef\u7684\u5199\u547d\u4ee4\u6570\u636e\u91cf\uff1b \u7136\u540e\uff0c\u518d\u548c\u6240\u8bbe\u7f6e\u7684\u590d\u5236\u7f13\u51b2\u533a\u5927\u5c0f\u8fdb\u884c\u6bd4\u8f83\uff0c\u5224\u65ad\u8bbe\u7f6e\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u662f\u5426\u8db3\u591f\u652f\u6491\u7d2f\u79ef\u7684\u5199\u547d\u4ee4\u6570\u636e\u91cf\u3002 \u4e3b\u8282\u70b9\u4e0a\u590d\u5236\u7f13\u51b2\u533a\u7684\u5185\u5b58\u5f00\u9500\uff0c\u4f1a\u662f\u6bcf\u4e2a\u4ece\u8282\u70b9\u5ba2\u6237\u7aef\u8f93\u51fa\u7f13\u51b2\u533a\u5360\u7528\u5185\u5b58\u7684\u603b\u548c\u3002\u5982\u679c\u96c6\u7fa4\u4e2d\u7684\u4ece\u8282\u70b9\u6570\u975e\u5e38\u591a\u7684\u8bdd\uff0c \u4e3b\u8282\u70b9\u7684\u5185\u5b58\u5f00\u9500\u5c31\u4f1a\u975e\u5e38\u5927\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u8fd8\u5fc5\u987b\u5f97\u63a7\u5236\u548c\u4e3b\u8282\u70b9\u8fde\u63a5\u7684\u4ece\u8282\u70b9\u4e2a\u6570\uff0c\u4e0d\u8981\u4f7f\u7528\u5927\u89c4\u6a21\u7684\u4e3b\u4ece\u96c6\u7fa4 \u3002 \u4e3a\u4e86\u907f\u514d\u590d\u5236\u7f13\u51b2\u533a\u7d2f\u79ef\u8fc7\u591a\u547d\u4ee4\u9020\u6210\u6ea2\u51fa\uff0c\u5f15\u53d1\u5168\u91cf\u590d\u5236\u5931\u8d25\uff0c \u6211\u4eec\u53ef\u4ee5\u63a7\u5236\u4e3b\u8282\u70b9\u4fdd\u5b58\u7684\u6570\u636e\u91cf\u5927\u5c0f\uff0c\u5e76\u8bbe\u7f6e\u5408\u7406\u7684\u590d\u5236\u7f13\u51b2\u533a\u5927\u5c0f\u3002\u540c\u65f6\uff0c\u6211\u4eec\u9700\u8981\u63a7\u5236\u4ece\u8282\u70b9\u7684\u6570\u91cf\uff0c\u6765\u907f\u514d\u4e3b\u8282\u70b9\u4e2d\u590d\u5236\u7f13\u51b2\u533a\u5360\u7528\u8fc7\u591a\u5185\u5b58\u7684\u95ee\u9898\u3002 6\u3001\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u7684\u6ea2\u51fa\u95ee\u9898 \u589e\u91cf\u590d\u5236\u65f6\u4f7f\u7528\u7684\u7f13\u51b2\u533a\uff0c\u8fd9\u4e2a\u7f13\u51b2\u533a\u79f0\u4e3a\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u3002 \u4e3b\u8282\u70b9\u5728\u628a\u63a5\u6536\u5230\u7684\u5199\u547d\u4ee4\u540c\u6b65\u7ed9\u4ece\u8282\u70b9\u65f6\uff0c\u540c\u65f6\u4f1a\u628a\u8fd9\u4e9b\u5199\u547d\u4ee4\u5199\u5165 \u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a \u3002 \u4e00\u65e6\u4ece\u8282\u70b9\u53d1\u751f\u7f51\u7edc\u95ea\u65ad\uff0c\u518d\u6b21\u548c\u4e3b\u8282\u70b9\u6062\u590d\u8fde\u63a5\u540e\uff0c \u4ece\u8282\u70b9\u5c31\u4f1a\u4ece\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u4e2d\uff0c\u8bfb\u53d6\u65ad\u8fde\u671f\u95f4\u4e3b\u8282\u70b9\u63a5\u6536\u5230\u7684\u5199\u547d\u4ee4\uff0c\u8fdb\u800c\u8fdb\u884c\u589e\u91cf\u540c\u6b65 \uff0c \u5982\u4e0b\u56fe\u6240\u793a\uff1a \u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u4e86\uff0c repl_backlog_buffer ,\u589e\u91cf\u590d\u5236 \uff0c\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u6ea2\u51fa\u7684\u5f71\u54cd\uff0c\u4ee5\u53ca\u5982\u4f55\u5e94\u5bf9\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u7684\u6ea2\u51fa\u95ee\u9898\u3002 \u9996\u5148\uff0c\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u662f\u4e00\u4e2a\u5927\u5c0f\u6709\u9650\u7684\u73af\u5f62\u7f13\u51b2\u533a\u3002\u5f53\u4e3b\u8282\u70b9\u628a\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u5199\u6ee1\u540e\uff0c\u4f1a\u8986\u76d6\u7f13\u51b2\u533a\u4e2d\u7684\u65e7\u547d\u4ee4\u6570\u636e\u3002\u5982\u679c\u4ece\u8282\u70b9\u8fd8\u6ca1\u6709\u540c\u6b65\u8fd9\u4e9b\u65e7\u547d\u4ee4\u6570\u636e\uff0c\u5c31\u4f1a\u9020\u6210\u4e3b\u4ece\u8282\u70b9\u95f4\u91cd\u65b0\u5f00\u59cb\u6267\u884c\u5168\u91cf\u590d\u5236\u3002 \u5176\u6b21\uff0c\u4e3a\u4e86\u5e94\u5bf9\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u7684\u6ea2\u51fa\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u8c03\u6574\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff0c\u4e5f\u5c31\u662f\u8bbe\u7f6e repl_backlog_size \u8fd9\u4e2a\u53c2\u6570\u7684\u503c\u3002 7\u3001\u672c\u8282\u5c0f\u7ed3 \u4f7f\u7528\u7f13\u51b2\u533a\u4ee5\u540e\uff0c\u5f53\u547d\u4ee4\u6570\u636e\u7684\u63a5\u6536\u65b9\u5904\u7406\u901f\u5ea6\u8ddf\u4e0d\u4e0a\u53d1\u9001\u65b9\u7684\u53d1\u9001\u901f\u5ea6\u65f6\uff0c\u7f13\u51b2\u533a\u53ef\u4ee5\u907f\u514d\u547d\u4ee4\u6570\u636e\u7684\u4e22\u5931\u3002 \u6309\u7167\u7f13\u51b2\u533a\u7684\u7528\u9014\uff0c\u4f8b\u5982\u662f\u7528\u4e8e\u5ba2\u6237\u7aef\u901a\u4fe1\u8fd8\u662f\u7528\u4e8e\u4e3b\u4ece\u8282\u70b9\u590d\u5236\uff0c\u6211\u628a\u7f13\u51b2\u533a\u5206\u6210\u4e86 \u5ba2\u6237\u7aef\u7684\u8f93\u5165 \u5ba2\u6237\u7aef\u8f93\u51fa\u7f13\u51b2\u533a \u4e3b\u4ece\u96c6\u7fa4\u4e2d\u4e3b\u8282\u70b9\u4e0a\u7684\u590d\u5236\u7f13\u51b2\u533a \u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a \u73b0\u5728\uff0c\u4ece\u7f13\u51b2\u533a\u6ea2\u51fa\u5bf9 Redis \u7684\u5f71\u54cd\u7684\u89d2\u5ea6\uff0c\u6211\u518d\u628a\u8fd9\u56db\u4e2a\u7f13\u51b2\u533a\u5206\u6210\u4e24\u7c7b\u505a\u4e2a\u603b\u7ed3\u3002 \u7f13\u51b2\u533a\u6ea2\u51fa\u5bfc\u81f4\u7f51\u7edc\u8fde\u63a5\u5173\u95ed\uff1a\u666e\u901a\u5ba2\u6237\u7aef\u3001\u8ba2\u9605\u5ba2\u6237\u7aef\uff0c\u4ee5\u53ca\u4ece\u8282\u70b9\u5ba2\u6237\u7aef\uff0c\u5b83\u4eec\u4f7f\u7528\u7684\u7f13\u51b2\u533a\uff0c\u672c\u8d28\u4e0a\u90fd\u662f Redis \u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u4e4b\u95f4\uff0c\u6216\u662f\u4e3b\u4ece\u8282\u70b9\u4e4b\u95f4\u4e3a\u4e86\u4f20\u8f93\u547d\u4ee4\u6570\u636e\u800c\u7ef4\u62a4\u7684\u3002\u8fd9\u4e9b\u7f13\u51b2\u533a\u4e00\u65e6\u53d1\u751f\u6ea2\u51fa\uff0c\u5904\u7406\u673a\u5236\u90fd\u662f\u76f4\u63a5\u628a\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u7684\u8fde\u63a5\uff0c\u6216\u662f\u4e3b\u4ece\u8282\u70b9\u95f4\u7684\u8fde\u63a5\u5173\u95ed\u3002\u7f51\u7edc\u8fde\u63a5\u5173\u95ed\u9020\u6210\u7684\u76f4\u63a5\u5f71\u54cd\uff0c\u5c31\u662f\u4e1a\u52a1\u7a0b\u5e8f\u65e0\u6cd5\u8bfb\u5199 Redis\uff0c\u6216\u8005\u662f\u4e3b\u4ece\u8282\u70b9\u5168\u91cf\u540c\u6b65\u5931\u8d25\uff0c\u9700\u8981\u91cd\u65b0\u6267\u884c\u3002 \u7f13\u51b2\u533a\u6ea2\u51fa\u5bfc\u81f4\u547d\u4ee4\u6570\u636e\u4e22\u5931\uff1a\u4e3b\u8282\u70b9\u4e0a\u7684\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u5c5e\u4e8e\u73af\u5f62\u7f13\u51b2\u533a\uff0c\u4e00\u65e6\u53d1\u751f\u6ea2\u51fa\uff0c\u65b0\u5199\u5165\u7684\u547d\u4ee4\u6570\u636e\u5c31\u4f1a\u8986\u76d6\u65e7\u7684\u547d\u4ee4\u6570\u636e\uff0c\u5bfc\u81f4\u65e7\u547d\u4ee4\u6570\u636e\u7684\u4e22\u5931\uff0c\u8fdb\u800c\u5bfc\u81f4\u4e3b\u4ece\u8282\u70b9\u91cd\u65b0\u8fdb\u884c\u5168\u91cf\u590d\u5236\u3002 \u4ece\u672c\u8d28\u4e0a\u770b\uff0c\u7f13\u51b2\u533a\u6ea2\u51fa\uff0c\u65e0\u975e\u5c31\u662f\u4e09\u4e2a\u539f\u56e0\uff1a \u547d\u4ee4\u6570\u636e\u53d1\u9001\u8fc7\u5feb\u8fc7\u5927\uff1b \u547d\u4ee4\u6570\u636e\u5904\u7406\u8f83\u6162\uff1b \u7f13\u51b2\u533a\u7a7a\u95f4\u8fc7\u5c0f\u3002 \u660e\u767d\u4e86\u8fd9\u4e2a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6709\u9488\u5bf9\u6027\u5730\u62ff\u51fa\u5e94\u5bf9\u7b56\u7565\u4e86\u3002 \u9488\u5bf9\u547d\u4ee4\u6570\u636e\u53d1\u9001\u8fc7\u5feb\u8fc7\u5927\u7684\u95ee\u9898\uff0c\u5bf9\u4e8e\u666e\u901a\u5ba2\u6237\u7aef\u6765\u8bf4\u53ef\u4ee5\u907f\u514d bigkey\uff0c\u800c\u5bf9\u4e8e\u590d\u5236\u7f13\u51b2\u533a\u6765\u8bf4\uff0c\u5c31\u662f\u907f\u514d\u8fc7\u5927\u7684 RDB \u6587\u4ef6\u3002 \u9488\u5bf9\u547d\u4ee4\u6570\u636e\u5904\u7406\u8f83\u6162\u7684\u95ee\u9898\uff0c\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u51cf\u5c11 Redis \u4e3b\u7ebf\u7a0b\u4e0a\u7684\u963b\u585e\u64cd\u4f5c\uff0c\u4f8b\u5982\u4f7f\u7528\u5f02\u6b65\u7684\u5220\u9664\u64cd\u4f5c\u3002 \u9488\u5bf9\u7f13\u51b2\u533a\u7a7a\u95f4\u8fc7\u5c0f\u7684\u95ee\u9898\uff0c\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u4f7f\u7528 client-output-buffer-limit \u914d\u7f6e\u9879\u8bbe\u7f6e\u5408\u7406\u7684\u8f93\u51fa\u7f13\u51b2\u533a\u3001\u590d\u5236\u7f13\u51b2\u533a\u548c\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u5927\u5c0f \u3002\u5f53\u7136\uff0c\u6211\u4eec\u4e0d\u8981\u5fd8\u4e86\uff0c\u8f93\u5165\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u9ed8\u8ba4\u662f\u56fa\u5b9a\u7684\uff0c\u6211\u4eec\u65e0\u6cd5\u901a\u8fc7\u914d\u7f6e\u6765\u4fee\u6539\u5b83\uff0c\u9664\u975e\u76f4\u63a5\u53bb\u4fee\u6539 Redis \u6e90\u7801\u3002","title":"\u7b2c\u4e94\u8282 Redis\u7f13\u51b2\u533a"},{"location":"chap4/5redis_buffer/#redis","text":"\u7f13\u51b2\u533a\u7684\u529f\u80fd\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u4e3b\u8981\u5c31\u662f\u7528\u4e00\u5757\u5185\u5b58\u7a7a\u95f4\u6765\u6682\u65f6\u5b58\u653e\u547d\u4ee4\u6570\u636e\uff0c\u4ee5\u514d\u51fa\u73b0\u56e0\u4e3a\u6570\u636e\u548c\u547d\u4ee4\u7684\u5904\u7406\u901f\u5ea6\u6162\u4e8e\u53d1\u9001\u901f\u5ea6\u800c\u5bfc\u81f4\u7684\u6570\u636e\u4e22\u5931\u548c\u6027\u80fd\u95ee\u9898\u3002 \u4f46\u56e0\u4e3a\u7f13\u51b2\u533a\u7684\u5185\u5b58\u7a7a\u95f4\u6709\u9650\uff0c \u5982\u679c\u5f80\u91cc\u9762\u5199\u5165\u6570\u636e\u7684\u901f\u5ea6\u6301\u7eed\u5730\u5927\u4e8e\u4ece\u91cc\u9762\u8bfb\u53d6\u6570\u636e\u7684\u901f\u5ea6\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7f13\u51b2\u533a\u9700\u8981\u8d8a\u6765\u8d8a\u591a\u7684\u5185\u5b58\u6765\u6682\u5b58\u6570\u636e\u3002\u5f53\u7f13\u51b2\u533a\u5360\u7528\u7684\u5185\u5b58\u8d85\u51fa\u4e86\u8bbe\u5b9a\u7684\u4e0a\u9650\u9608\u503c\u65f6\uff0c\u5c31\u4f1a\u51fa\u73b0\u7f13\u51b2\u533a\u6ea2\u51fa\u3002 \u5982\u679c\u4e0d\u7ed9\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u8bbe\u7f6e\u4e0a\u9650\uff0c\u968f\u7740\u7d2f\u79ef\u7684\u6570\u636e\u8d8a\u6765\u8d8a\u591a\uff0c \u7f13\u51b2\u533a\u5360\u7528\u5185\u5b58\u7a7a\u95f4\u8d8a\u6765\u8d8a\u5927\uff0c\u4e00\u65e6\u8017\u5c3d\u4e86 Redis \u5b9e\u4f8b\u6240\u5728\u673a\u5668\u7684\u53ef\u7528\u5185\u5b58\uff0c\u5c31\u4f1a\u5bfc\u81f4 Redis \u5b9e\u4f8b\u5d29\u6e83 \u3002 \u7f13\u51b2\u533a\u662f\u7528\u6765\u907f\u514d\u8bf7\u6c42\u6216\u6570\u636e\u4e22\u5931\u7684\u60e8\u6848\u7684 Redis \u662f\u5178\u578b\u7684 client-server \u67b6\u6784\uff0c\u6240\u6709\u7684\u64cd\u4f5c\u547d\u4ee4\u90fd\u9700\u8981\u901a\u8fc7\u5ba2\u6237\u7aef\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7aef\u3002 \u6240\u4ee5\uff0c\u7f13\u51b2\u533a\u5728 Redis \u4e2d\u7684\u4e00\u4e2a\u4e3b\u8981\u5e94\u7528\u573a\u666f\uff0c\u5c31\u662f\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u4e4b\u95f4\u8fdb\u884c\u901a\u4fe1\u65f6\uff0c\u7528\u6765\u6682\u5b58\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u547d\u4ee4\u6570\u636e\uff0c\u6216\u8005\u662f\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u6570\u636e\u7ed3\u679c\u3002 \u6b64\u5916\uff0c\u7f13\u51b2\u533a\u7684\u53e6\u4e00\u4e2a\u4e3b\u8981\u5e94\u7528\u573a\u666f\uff0c\u662f\u5728\u4e3b\u4ece\u8282\u70b9\u95f4\u8fdb\u884c\u6570\u636e\u540c\u6b65\u65f6\uff0c\u7528\u6765\u6682\u5b58\u4e3b\u8282\u70b9\u63a5\u6536\u7684\u5199\u547d\u4ee4\u548c\u6570\u636e \u3002","title":"\u7b2c\u4e94\u8282 Redis\u7f13\u51b2\u533a"},{"location":"chap4/5redis_buffer/#1","text":"\u770b\u770b\u670d\u52a1\u5668\u7aef\u548c\u5ba2\u6237\u7aef\u4e4b\u95f4\u7684\u7f13\u51b2\u533a \u4e3a\u4e86\u907f\u514d\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u7684\u8bf7\u6c42\u53d1\u9001\u548c\u5904\u7406\u901f\u5ea6\u4e0d\u5339\u914d\uff0c\u670d\u52a1\u5668\u7aef\u7ed9\u6bcf\u4e2a\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u90fd\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u8f93\u5165\u7f13\u51b2\u533a\u548c\u8f93\u51fa\u7f13\u51b2\u533a\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a \u5ba2\u6237\u7aef\u8f93\u5165\u7f13\u51b2\u533a\u548c\u8f93\u51fa\u7f13\u51b2\u533a \u3002 \u8f93\u5165\u7f13\u51b2\u533a\u4f1a\u5148\u628a\u5ba2\u6237\u7aef\u53d1\u9001\u8fc7\u6765\u7684\u547d\u4ee4\u6682\u5b58\u8d77\u6765\uff0c Redis \u4e3b\u7ebf\u7a0b\u518d\u4ece\u8f93\u5165\u7f13\u51b2\u533a\u4e2d\u8bfb\u53d6\u547d\u4ee4\uff0c\u8fdb\u884c\u5904\u7406 \u5f53 Redis \u4e3b\u7ebf\u7a0b\u5904\u7406\u5b8c\u6570\u636e\u540e\uff0c\u4f1a\u628a\u7ed3\u679c\u5199\u5165\u5230\u8f93\u51fa\u7f13\u51b2\u533a\uff0c\u518d\u901a\u8fc7\u8f93\u51fa\u7f13\u51b2\u533a\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef","title":"1\u3001\u5ba2\u6237\u7aef\u8f93\u5165\u548c\u8f93\u51fa\u7f13\u51b2\u533a"},{"location":"chap4/5redis_buffer/#2","text":"","title":"2\u3001\u5982\u4f55\u5e94\u5bf9\u8f93\u5165\u7f13\u51b2\u533a\u6ea2\u51fa\uff1f"},{"location":"chap4/5redis_buffer/#2-1","text":"\u8f93\u5165\u7f13\u51b2\u533a\u5c31\u662f\u7528\u6765\u6682\u5b58\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\u547d\u4ee4\u7684\uff0c\u6240\u4ee5\u53ef\u80fd\u5bfc\u81f4\u6ea2\u51fa\u7684\u60c5\u51b5\u4e3b\u8981\u662f\u4e0b\u9762\u4e24\u79cd\uff1a \u5199\u5165\u4e86 bigkey\uff0c\u6bd4\u5982\u4e00\u4e0b\u5b50\u5199\u5165\u4e86\u591a\u4e2a\u767e\u4e07\u7ea7\u522b\u7684\u96c6\u5408\u7c7b\u578b\u6570\u636e\uff1b \u670d\u52a1\u5668\u7aef\u5904\u7406\u8bf7\u6c42\u7684\u901f\u5ea6\u8fc7\u6162\uff0c \u4f8b\u5982\uff0cRedis \u4e3b\u7ebf\u7a0b\u51fa\u73b0\u4e86\u95f4\u6b47\u6027\u963b\u585e\uff0c\u65e0\u6cd5\u53ca\u65f6\u5904\u7406\u6b63\u5e38\u53d1\u9001\u7684\u8bf7\u6c42\uff0c\u5bfc\u81f4\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\u5728\u7f13\u51b2\u533a\u8d8a\u79ef\u8d8a\u591a \u3002 \u5982\u4f55\u67e5\u770b\u8f93\u5165\u7f13\u51b2\u533a\u7684\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\uff0c\u4ee5\u53ca\u5982\u4f55\u907f\u514d\u6ea2\u51fa \u8981\u67e5\u770b\u548c\u670d\u52a1\u5668\u7aef\u76f8\u8fde\u7684\u6bcf\u4e2a\u5ba2\u6237\u7aef\u5bf9\u8f93\u5165\u7f13\u51b2\u533a\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 CLIENT LIST \u547d\u4ee4\uff1a CLIENT LIST id=5 addr=127.0.0.1:50487 fd=9 name= age=4 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=26 qbuf-free=32742 obl=0 oll=0 omem=0 events=r cmd=client CLIENT \u547d\u4ee4\u8fd4\u56de\u7684\u4fe1\u606f\u867d\u7136\u5f88\u591a\uff0c\u4f46\u6211\u4eec\u53ea\u9700\u8981\u91cd\u70b9\u5173\u6ce8\u4e24\u7c7b\u4fe1\u606f\u5c31\u53ef\u4ee5\u4e86\u3002 \u4e00\u7c7b\u662f\u4e0e\u670d\u52a1\u5668\u7aef\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u7684\u4fe1\u606f\u3002 \u8fd9\u4e2a\u6848\u4f8b\u5c55\u793a\u7684\u662f\u4e00\u4e2a\u5ba2\u6237\u7aef\u7684\u8f93\u5165\u7f13\u51b2\u533a\u60c5\u51b5\uff0c\u5982\u679c\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\uff0c\u8f93\u51fa\u7ed3\u679c\u4e2d\u7684 addr \u4f1a\u663e\u793a\u4e0d\u540c\u5ba2\u6237\u7aef\u7684 IP \u548c\u7aef\u53e3\u53f7\u3002 \u53e6\u4e00\u7c7b\u662f\u4e0e\u8f93\u5165\u7f13\u51b2\u533a\u76f8\u5173\u7684\u4e09\u4e2a\u53c2\u6570\uff1a cmd \uff0c \u8868\u793a\u5ba2\u6237\u7aef\u6700\u65b0\u6267\u884c\u7684\u547d\u4ee4 \u3002\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u6267\u884c\u7684\u662f CLIENT \u547d\u4ee4\u3002 qbuf \uff0c \u8868\u793a\u8f93\u5165\u7f13\u51b2\u533a\u5df2\u7ecf\u4f7f\u7528\u7684\u5927\u5c0f \u3002\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u7684 CLIENT \u547d\u4ee4\u5df2\u4f7f\u7528\u4e86 26 \u5b57\u8282\u5927\u5c0f\u7684\u7f13\u51b2\u533a\u3002 qbuf-free \uff0c\u8868\u793a\u8f93\u5165\u7f13\u51b2\u533a\u5c1a\u672a\u4f7f\u7528\u7684\u5927\u5c0f \u3002\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u7684 CLIENT \u547d\u4ee4\u8fd8\u53ef\u4ee5\u4f7f\u7528 32742 \u5b57\u8282\u7684\u7f13\u51b2\u533a\u3002 qbuf \u548c qbuf-free \u7684\u603b\u548c\u5c31\u662f\uff0cRedis \u670d\u52a1\u5668\u7aef\u5f53\u524d\u4e3a\u5df2\u8fde\u63a5\u7684\u8fd9\u4e2a\u5ba2\u6237\u7aef\u5206\u914d\u7684\u7f13\u51b2\u533a\u603b\u5927\u5c0f\u3002\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u603b\u5171\u5206\u914d\u4e86 26 + 32742 = 32768 \u5b57\u8282\uff0c\u4e5f\u5c31\u662f 32KB \u7684\u7f13\u51b2\u533a\u3002","title":"2-1 \u7f13\u51b2\u533a\u6ea2\u51fa\u68c0\u67e5"},{"location":"chap4/5redis_buffer/#2-2","text":"\u6709\u4e86 CLIENT LIST \u547d\u4ee4\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u8f93\u51fa\u7ed3\u679c\u6765\u5224\u65ad\u5ba2\u6237\u7aef\u8f93\u5165\u7f13\u51b2\u533a\u7684\u5185\u5b58\u5360\u7528\u60c5\u51b5\u4e86\u3002 \u5982\u679c qbuf \u5f88\u5927\uff0c\u800c\u540c\u65f6 qbuf-free \u5f88\u5c0f\uff0c\u5c31\u8981\u5f15\u8d77\u6ce8\u610f\u4e86\uff0c\u56e0\u4e3a\u8fd9\u65f6\u5019\u8f93\u5165\u7f13\u51b2\u533a\u5df2\u7ecf\u5360\u7528\u4e86\u5f88\u591a\u5185\u5b58\uff0c\u800c\u4e14\u6ca1\u6709\u4ec0\u4e48\u7a7a\u95f2\u7a7a\u95f4\u4e86 \u3002 \u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u518d\u5199\u5165\u5927\u91cf\u547d\u4ee4\u7684\u8bdd\uff0c\u5c31\u4f1a\u5f15\u8d77\u5ba2\u6237\u7aef\u8f93\u5165\u7f13\u51b2\u533a\u6ea2\u51fa\uff0cRedis \u7684\u5904\u7406\u529e\u6cd5\u5c31\u662f\u628a\u5ba2\u6237\u7aef\u8fde\u63a5\u5173\u95ed\uff0c\u7ed3\u679c\u5c31\u662f\u4e1a\u52a1\u7a0b\u5e8f\u65e0\u6cd5\u8fdb\u884c\u6570\u636e\u5b58\u53d6\u4e86\u3002 \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c Redis \u670d\u52a1\u5668\u7aef\u4e0d\u6b62\u670d\u52a1\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u5f53\u591a\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u5360\u7528\u7684\u5185\u5b58\u603b\u91cf\uff0c\u8d85\u8fc7\u4e86 Redis \u7684 maxmemory \u914d\u7f6e\u9879\u65f6\uff08\u4f8b\u5982 4GB\uff09\uff0c\u5c31\u4f1a\u89e6\u53d1 Redis \u8fdb\u884c\u6570\u636e\u6dd8\u6c70 \u3002\u4e00\u65e6\u6570\u636e\u88ab\u6dd8\u6c70\u51fa Redis\uff0c\u518d\u8981\u8bbf\u95ee\u8fd9\u90e8\u5206\u6570\u636e\uff0c\u5c31\u9700\u8981\u53bb\u540e\u7aef\u6570\u636e\u5e93\u8bfb\u53d6\uff0c\u8fd9\u5c31\u964d\u4f4e\u4e86\u4e1a\u52a1\u5e94\u7528\u7684\u8bbf\u95ee\u6027\u80fd \u66f4\u7cdf\u7cd5\u7684\u662f\uff0c\u5982\u679c\u4f7f\u7528\u591a\u4e2a\u5ba2\u6237\u7aef\uff0c\u5bfc\u81f4 Redis \u5185\u5b58\u5360\u7528\u8fc7\u5927\uff0c\u4e5f\u4f1a\u5bfc\u81f4\u5185\u5b58\u6ea2\u51fa\uff08 out-of-memory \uff09\u95ee\u9898\uff0c\u8fdb\u800c\u4f1a\u5f15\u8d77 Redis \u5d29\u6e83\uff0c\u7ed9\u4e1a\u52a1\u5e94\u7528\u9020\u6210\u4e25\u91cd\u5f71\u54cd\u3002","title":"2-2 \u7f13\u51b2\u533a\u6ea2\u7684\u98ce\u9669"},{"location":"chap4/5redis_buffer/#2-3","text":"\u907f\u514d\u8f93\u5165\u7f13\u51b2\u533a\u6ea2\u51fa\u3002\u6211\u4eec\u53ef\u4ee5\u4ece\u4e24\u4e2a\u89d2\u5ea6\u53bb\u8003\u8651\u5982\u4f55\u907f\u514d\uff0c \u4e00\u662f\u628a\u7f13\u51b2\u533a\u8c03\u5927\uff0c\u4e8c\u662f\u4ece\u6570\u636e\u547d\u4ee4\u7684\u53d1\u9001\u548c\u5904\u7406\u901f\u5ea6\u5165\u624b\u3002 \u5e95\u6709\u6ca1\u6709\u529e\u6cd5\u901a\u8fc7\u53c2\u6570\u8c03\u6574\u8f93\u5165\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u5462\uff1f\u7b54\u6848\u662f\u6ca1\u6709\u3002 Redis \u7684\u5ba2\u6237\u7aef\u8f93\u5165\u7f13\u51b2\u533a\u5927\u5c0f\u7684\u4e0a\u9650\u9608\u503c\uff0c\u5728\u4ee3\u7801\u4e2d\u5c31\u8bbe\u5b9a\u4e3a\u4e86 1GB\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cRedis \u670d\u52a1\u5668\u7aef\u5141\u8bb8\u4e3a\u6bcf\u4e2a\u5ba2\u6237\u7aef\u6700\u591a\u6682\u5b58 1GB \u7684\u547d\u4ee4\u548c\u6570\u636e\u3002 1GB \u7684\u5927\u5c0f\uff0c\u5bf9\u4e8e\u4e00\u822c\u7684\u751f\u4ea7\u73af\u5883\u5df2\u7ecf\u662f\u6bd4\u8f83\u5408\u9002\u7684\u4e86 \u3002 \u4e00\u65b9\u9762\uff0c\u8fd9\u4e2a\u5927\u5c0f\u5bf9\u4e8e\u5904\u7406\u7edd\u5927\u90e8\u5206\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u5df2\u7ecf\u591f\u7528\u4e86\uff1b \u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c\u518d\u5927\u7684\u8bdd\uff0c Redis \u5c31\u6709\u53ef\u80fd\u56e0\u4e3a\u5ba2\u6237\u7aef\u5360\u7528\u4e86\u8fc7\u591a\u7684\u5185\u5b58\u8d44\u6e90\u800c\u5d29\u6e83 \u3002 Redis \u5e76\u6ca1\u6709\u63d0\u4f9b\u53c2\u6570\u8ba9\u6211\u4eec\u8c03\u8282\u5ba2\u6237\u7aef\u8f93\u5165\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u3002 \u5982\u679c\u8981\u907f\u514d\u8f93\u5165\u7f13\u51b2\u533a\u6ea2\u51fa\uff0c\u90a3\u6211\u4eec\u5c31\u53ea\u80fd\u4ece\u6570\u636e\u547d\u4ee4\u7684\u53d1\u9001\u548c\u5904\u7406\u901f\u5ea6\u5165\u624b\uff0c\u4e5f\u5c31\u662f\u524d\u9762\u63d0\u5230\u7684\u907f\u514d\u5ba2\u6237\u7aef\u5199\u5165 bigkey\uff0c\u4ee5\u53ca\u907f\u514d Redis \u4e3b\u7ebf\u7a0b\u963b\u585e \u3002","title":"2-3 \u907f\u514d\u8f93\u5165\u7f13\u51b2\u533a\u6ea2\u51fa"},{"location":"chap4/5redis_buffer/#3","text":"Redis \u7684\u8f93\u51fa\u7f13\u51b2\u533a\u6682\u5b58\u7684\u662f Redis \u4e3b\u7ebf\u7a0b\u8981\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u6570\u636e\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u4e3b\u7ebf\u7a0b\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u6570\u636e\uff0c\u65e2\u6709\u7b80\u5355\u4e14\u5927\u5c0f\u56fa\u5b9a\u7684 OK \u54cd\u5e94\uff08\u4f8b\u5982\uff0c\u6267\u884c SET \u547d\u4ee4\uff09\u6216\u62a5\u9519\u4fe1\u606f\uff0c\u4e5f\u6709\u5927\u5c0f\u4e0d\u56fa\u5b9a\u7684\u3001\u5305\u542b\u5177\u4f53\u6570\u636e\u7684\u6267\u884c\u7ed3\u679c\uff08\u4f8b\u5982\uff0c\u6267\u884c HGET \u547d\u4ee4\uff09\u3002 Redis \u4e3a\u6bcf\u4e2a\u5ba2\u6237\u7aef\u8bbe\u7f6e\u7684\u8f93\u51fa\u7f13\u51b2\u533a\u4e5f\u5305\u62ec\u4e24\u90e8\u5206\uff1a \u662f\u4e00\u4e2a\u5927\u5c0f\u4e3a 16KB \u7684\u56fa\u5b9a\u7f13\u51b2\u7a7a\u95f4\uff0c\u7528\u6765\u6682\u5b58 OK \u54cd\u5e94\u548c\u51fa\u9519\u4fe1\u606f\uff1b \u662f\u4e00\u4e2a\u53ef\u4ee5\u52a8\u6001\u589e\u52a0\u7684\u7f13\u51b2\u7a7a\u95f4\uff0c\u7528\u6765\u6682\u5b58\u5927\u5c0f\u53ef\u53d8\u7684\u54cd\u5e94\u7ed3\u679c\u3002 \u90a3\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u53d1\u751f\u8f93\u51fa\u7f13\u51b2\u533a\u6ea2\u51fa\u5462\uff1f \u6211\u4e3a\u4f60\u603b\u7ed3\u4e86\u4e09\u79cd\uff1a \u670d\u52a1\u5668\u7aef\u8fd4\u56de bigkey \u7684\u5927\u91cf\u7ed3\u679c\uff1b \u6267\u884c\u4e86 MONITOR \u547d\u4ee4\uff1b \u7f13\u51b2\u533a\u5927\u5c0f\u8bbe\u7f6e\u5f97\u4e0d\u5408\u7406\u3002 \u5176\u4e2d\uff0cbigkey \u539f\u672c\u5c31\u4f1a\u5360\u7528\u5927\u91cf\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u6240\u4ee5\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u7684\u7ed3\u679c\u5305\u542b bigkey\uff0c\u5fc5\u7136\u4f1a\u5f71\u54cd\u8f93\u51fa\u7f13\u51b2\u533a MONITOR \u547d\u4ee4\u662f\u7528\u6765\u76d1\u6d4b Redis \u6267\u884c\u7684\u3002 \u6267\u884c\u8fd9\u4e2a\u547d\u4ee4\u4e4b\u540e\uff0c\u5c31\u4f1a\u6301\u7eed\u8f93\u51fa\u76d1\u6d4b\u5230\u7684\u5404\u4e2a\u547d\u4ee4\u64cd\u4f5c\uff0c\u5982\u4e0b\u6240\u793a\uff1a MONITOR OK 1600617456.437129 [0 127.0.0.1:50487] \"COMMAND\" 1600617477.289667 [0 127.0.0.1:50487] \"info\" \"memory\" MONITOR \u7684\u8f93\u51fa\u7ed3\u679c\u4f1a\u6301\u7eed\u5360\u7528\u8f93\u51fa\u7f13\u51b2\u533a\uff0c\u5e76\u8d8a\u5360\u8d8a\u591a\uff0c\u6700\u540e\u7684\u7ed3\u679c\u5c31\u662f\u53d1\u751f\u6ea2\u51fa\u3002 \u6211\u8981\u7ed9\u4f60\u4e00\u4e2a\u5c0f\u5efa\u8bae\uff1a MONITOR \u547d\u4ee4\u4e3b\u8981\u7528\u5728\u8c03\u8bd5\u73af\u5883\u4e2d\uff0c\u4e0d\u8981\u5728\u7ebf\u4e0a\u751f\u4ea7\u73af\u5883\u4e2d\u6301\u7eed\u4f7f\u7528 MONITOR\u3002 \u5982\u679c\u5728\u7ebf\u4e0a\u73af\u5883\u4e2d\u5076\u5c14\u4f7f\u7528 MONITOR \u68c0\u67e5 Redis \u7684\u547d\u4ee4\u6267\u884c\u60c5\u51b5\uff0c\u662f\u6ca1\u95ee\u9898\u7684\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u770b\u4e0b\u8f93\u51fa\u7f13\u51b2\u533a\u5927\u5c0f\u8bbe\u7f6e\u7684\u95ee\u9898\u3002 \u548c\u8f93\u5165\u7f13\u51b2\u533a\u4e0d\u540c\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 client-output-buffer-limit \u914d\u7f6e\u9879\uff0c\u6765\u8bbe\u7f6e\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u3002\u5177\u4f53\u8bbe\u7f6e\u7684\u5185\u5bb9\u5305\u62ec\u4e24\u65b9\u9762\uff1a \u8bbe\u7f6e\u7f13\u51b2\u533a\u5927\u5c0f\u7684\u4e0a\u9650\u9608\u503c\uff1b \u8bbe\u7f6e\u8f93\u51fa\u7f13\u51b2\u533a\u6301\u7eed\u5199\u5165\u6570\u636e\u7684\u6570\u91cf\u4e0a\u9650\u9608\u503c\uff0c\u548c\u6301\u7eed\u5199\u5165\u6570\u636e\u7684\u65f6\u95f4\u7684\u4e0a\u9650\u9608\u503c\u3002 client-output-buffer-limit \u6765\u8bbe\u7f6e\u8f93\u51fa\u7f13\u51b2\u533a\u7684\u5927\u5c0f \u5728\u5177\u4f53\u4f7f\u7528 client-output-buffer-limit \u6765\u8bbe\u7f6e\u7f13\u51b2\u533a\u5927\u5c0f\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u5148\u533a\u5206\u4e0b\u5ba2\u6237\u7aef\u7684\u7c7b\u578b\u3002 \u5bf9\u4e8e\u548c Redis \u5b9e\u4f8b\u8fdb\u884c\u4ea4\u4e92\u7684\u5e94\u7528\u7a0b\u5e8f\u6765\u8bf4\uff0c\u4e3b\u8981\u4f7f\u7528\u4e24\u7c7b\u5ba2\u6237\u7aef\u548c Redis \u670d\u52a1\u5668\u7aef\u4ea4\u4e92\uff0c\u5206\u522b\u662f \u5e38\u89c4\u548c Redis \u670d\u52a1\u5668\u7aef\u8fdb\u884c\u8bfb\u5199\u547d\u4ee4\u4ea4\u4e92\u7684\u666e\u901a\u5ba2\u6237\u7aef \uff0c\u4ee5\u53ca\u8ba2\u9605\u4e86 Redis \u9891\u9053\u7684\u8ba2\u9605\u5ba2\u6237\u7aef\u3002 \u6b64\u5916\uff0c \u5728 Redis \u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c\u4e3b\u8282\u70b9\u4e0a\u4e5f\u6709\u4e00\u7c7b\u5ba2\u6237\u7aef\uff08\u4ece\u8282\u70b9\u5ba2\u6237\u7aef\uff09\u7528\u6765\u548c\u4ece\u8282\u70b9\u8fdb\u884c\u6570\u636e\u540c\u6b65 \uff0c\u6211\u4f1a\u5728\u4ecb\u7ecd\u4e3b\u4ece\u96c6\u7fa4\u4e2d\u7684\u7f13\u51b2\u533a\u65f6\uff0c\u5411\u4f60\u5177\u4f53\u4ecb\u7ecd\u3002 \u5f53\u6211\u4eec\u7ed9\u666e\u901a\u5ba2\u6237\u7aef\u8bbe\u7f6e\u7f13\u51b2\u533a\u5927\u5c0f\u65f6\uff0c\u901a\u5e38\u53ef\u4ee5\u5728 Redis \u914d\u7f6e\u6587\u4ef6\u4e2d\u8fdb\u884c\u8fd9\u6837\u7684\u8bbe\u7f6e\uff1a client-output-buffer-limit normal 0 0 0 \u5176\u4e2d\uff0cnormal \u8868\u793a\u5f53\u524d\u8bbe\u7f6e\u7684\u662f\u666e\u901a\u5ba2\u6237\u7aef\uff0c \u7b2c 1 \u4e2a 0 \u8bbe\u7f6e\u7684\u662f\u7f13\u51b2\u533a\u5927\u5c0f\u9650\u5236\uff0c\u7b2c 2 \u4e2a 0 \u548c\u7b2c 3 \u4e2a 0 \u5206\u522b\u8868\u793a\u7f13\u51b2\u533a\u6301\u7eed\u5199\u5165\u91cf\u9650\u5236\u548c\u6301\u7eed\u5199\u5165\u65f6\u95f4\u9650\u5236 \u3002 \u5bf9\u4e8e\u666e\u901a\u5ba2\u6237\u7aef\u6765\u8bf4\uff0c\u5b83\u6bcf\u53d1\u9001\u5b8c\u4e00\u4e2a\u8bf7\u6c42\uff0c\u4f1a\u7b49\u5230\u8bf7\u6c42\u7ed3\u679c\u8fd4\u56de\u540e\uff0c\u518d\u53d1\u9001\u4e0b\u4e00\u4e2a\u8bf7\u6c42\uff0c\u8fd9\u79cd\u53d1\u9001\u65b9\u5f0f\u79f0\u4e3a\u963b\u585e\u5f0f\u53d1\u9001\u3002 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u4e0d\u662f\u8bfb\u53d6\u4f53\u91cf\u7279\u522b\u5927\u7684 bigkey\uff0c\u670d\u52a1\u5668\u7aef\u7684\u8f93\u51fa\u7f13\u51b2\u533a\u4e00\u822c\u4e0d\u4f1a\u88ab\u963b\u585e\u7684\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u901a\u5e38\u628a\u666e\u901a\u5ba2\u6237\u7aef\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u9650\u5236\uff0c\u4ee5\u53ca\u6301\u7eed\u5199\u5165\u91cf\u9650\u5236\u3001\u6301\u7eed\u5199\u5165\u65f6\u95f4\u9650\u5236\u90fd\u8bbe\u7f6e\u4e3a 0\uff0c\u4e5f\u5c31\u662f\u4e0d\u505a\u9650\u5236\u3002 \u5bf9\u4e8e\u8ba2\u9605\u5ba2\u6237\u7aef\u6765\u8bf4\uff0c\u4e00\u65e6\u8ba2\u9605\u7684 Redis \u9891\u9053\u6709\u6d88\u606f\u4e86\uff0c\u670d\u52a1\u5668\u7aef\u90fd\u4f1a\u901a\u8fc7\u8f93\u51fa\u7f13\u51b2\u533a\u628a\u6d88\u606f\u53d1\u7ed9\u5ba2\u6237\u7aef\u3002 \u6240\u4ee5\uff0c\u8ba2\u9605\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u95f4\u7684\u6d88\u606f\u53d1\u9001\u65b9\u5f0f\uff0c\u4e0d\u5c5e\u4e8e\u963b\u585e\u5f0f\u53d1\u9001\u3002 \u4e0d\u8fc7\uff0c\u5982\u679c\u9891\u9053\u6d88\u606f\u8f83\u591a\u7684\u8bdd\uff0c\u4e5f\u4f1a\u5360\u7528\u8f83\u591a\u7684\u8f93\u51fa\u7f13\u51b2\u533a\u7a7a\u95f4\u3002 \u56e0\u6b64\uff0c \u6211\u4eec\u4f1a\u7ed9\u8ba2\u9605\u5ba2\u6237\u7aef\u8bbe\u7f6e\u7f13\u51b2\u533a\u5927\u5c0f\u9650\u5236\u3001\u7f13\u51b2\u533a\u6301\u7eed\u5199\u5165\u91cf\u9650\u5236\uff0c\u4ee5\u53ca\u6301\u7eed\u5199\u5165\u65f6\u95f4\u9650\u5236 \uff0c\u53ef\u4ee5\u5728 Redis \u914d\u7f6e\u6587\u4ef6\u4e2d\u8fd9\u6837\u8bbe\u7f6e\uff1a client-output-buffer-limit pubsub 8mb 2mb 60 \u5176\u4e2d\uff0cpubsub \u53c2\u6570\u8868\u793a\u5f53\u524d\u662f\u5bf9\u8ba2\u9605\u5ba2\u6237\u7aef\u8fdb\u884c\u8bbe\u7f6e\uff1b 8mb \u8868\u793a \u8f93\u51fa\u7f13\u51b2\u533a \u7684\u5927\u5c0f\u4e0a\u9650\u4e3a 8MB\uff0c\u4e00\u65e6\u5b9e\u9645\u5360\u7528\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u8981\u8d85\u8fc7 8MB\uff0c\u670d\u52a1\u5668\u7aef\u5c31\u4f1a\u76f4\u63a5\u5173\u95ed\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\uff1b 2mb \u548c 60 \u8868\u793a\uff0c\u5982\u679c\u8fde\u7eed 60 \u79d2\u5185\u5bf9\u8f93\u51fa\u7f13\u51b2\u533a\u7684\u5199\u5165\u91cf\u8d85\u8fc7 2MB \u7684\u8bdd\uff0c\u670d\u52a1\u5668\u7aef\u4e5f\u4f1a\u5173\u95ed\u5ba2\u6237\u7aef\u8fde\u63a5\u3002 \u597d\u4e86\uff0c\u6211\u4eec\u6765\u603b\u7ed3\u4e0b\u5982\u4f55\u5e94\u5bf9\u8f93\u51fa\u7f13\u51b2\u533a\u6ea2\u51fa\uff1a \u907f\u514d bigkey \u64cd\u4f5c\u8fd4\u56de\u5927\u91cf\u6570\u636e\u7ed3\u679c\uff1b \u907f\u514d\u5728\u7ebf\u4e0a\u73af\u5883\u4e2d\u6301\u7eed\u4f7f\u7528 MONITOR \u547d\u4ee4\u3002 \u4f7f\u7528 client-output-buffer-limit \u8bbe\u7f6e\u5408\u7406\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u4e0a\u9650\uff0c\u6216\u662f\u7f13\u51b2\u533a\u8fde\u7eed\u5199\u5165\u65f6\u95f4\u548c\u5199\u5165\u91cf\u4e0a\u9650\u3002","title":"3\u3001\u5982\u4f55\u5e94\u5bf9\u8f93\u51fa\u7f13\u51b2\u533a\u6ea2\u51fa\uff1f"},{"location":"chap4/5redis_buffer/#4","text":"\u4e3b\u4ece\u96c6\u7fa4\u95f4\u7684\u6570\u636e\u590d\u5236\u5305\u62ec\u5168\u91cf\u590d\u5236\u548c\u589e\u91cf\u590d\u5236\u4e24\u79cd\u3002 \u5168\u91cf\u590d\u5236\u662f\u540c\u6b65\u6240\u6709\u6570\u636e\uff0c\u800c\u589e\u91cf\u590d\u5236\u53ea\u4f1a\u628a\u4e3b\u4ece\u5e93\u7f51\u7edc\u65ad\u8fde\u671f\u95f4\u4e3b\u5e93\u6536\u5230\u7684\u547d\u4ee4\uff0c\u540c\u6b65\u7ed9\u4ece\u5e93 \u65e0\u8bba\u5728\u54ea\u79cd\u5f62\u5f0f\u7684\u590d\u5236\u4e2d\uff0c \u4e3a\u4e86\u4fdd\u8bc1\u4e3b\u4ece\u8282\u70b9\u7684\u6570\u636e\u4e00\u81f4\uff0c\u90fd\u4f1a\u7528\u5230\u7f13\u51b2\u533a \u3002 \u4f46\u662f\uff0c\u8fd9\u4e24\u79cd\u590d\u5236\u573a\u666f\u4e0b\u7684\u7f13\u51b2\u533a\uff0c\u5728\u6ea2\u51fa\u5f71\u54cd\u548c\u5927\u5c0f\u8bbe\u7f6e\u65b9\u9762\u5e76\u4e0d\u4e00\u6837\u3002","title":"4\u3001\u4e3b\u4ece\u96c6\u7fa4\u4e2d\u7684\u7f13\u51b2\u533a"},{"location":"chap4/5redis_buffer/#5","text":"","title":"5\u3001\u590d\u5236\u7f13\u51b2\u533a\u7684\u6ea2\u51fa\u95ee\u9898"},{"location":"chap4/5redis_buffer/#5-1","text":"\u5728\u5168\u91cf\u590d\u5236\u8fc7\u7a0b\u4e2d\uff0c\u4e3b\u8282\u70b9\u5728\u5411\u4ece\u8282\u70b9\u4f20\u8f93 RDB \u6587\u4ef6\u7684\u540c\u65f6\uff0c\u4f1a\u7ee7\u7eed\u63a5\u6536\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u5199\u547d\u4ee4\u8bf7\u6c42\u3002 \u8fd9\u4e9b\u5199\u547d\u4ee4\u5c31\u4f1a\u5148\u4fdd\u5b58\u5728\u590d\u5236\u7f13\u51b2\u533a\u4e2d\uff0c\u7b49 RDB \u6587\u4ef6\u4f20\u8f93\u5b8c\u6210\u540e\uff0c\u518d\u53d1\u9001\u7ed9\u4ece\u8282\u70b9\u53bb\u6267\u884c \u3002 \u4e3b\u8282\u70b9\u4e0a\u4f1a\u4e3a\u6bcf\u4e2a\u4ece\u8282\u70b9\u90fd\u7ef4\u62a4\u4e00\u4e2a\u590d\u5236\u7f13\u51b2\u533a\uff0c\u6765\u4fdd\u8bc1\u4e3b\u4ece\u8282\u70b9\u95f4\u7684\u6570\u636e\u540c\u6b65\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u5728\u5168\u91cf\u590d\u5236\u65f6\uff0c\u4ece\u8282\u70b9\u63a5\u6536\u548c\u52a0\u8f7d RDB \u8f83\u6162\uff0c\u540c\u65f6\u4e3b\u8282\u70b9\u63a5\u6536\u5230\u4e86\u5927\u91cf\u7684\u5199\u547d\u4ee4\uff0c \u5199\u547d\u4ee4\u5728\u590d\u5236\u7f13\u51b2\u533a\u4e2d\u5c31\u4f1a\u8d8a\u79ef\u8d8a\u591a\uff0c\u6700\u7ec8\u5bfc\u81f4\u6ea2\u51fa \u3002 \u5176\u5b9e\uff0c\u4e3b\u8282\u70b9\u4e0a\u7684\u590d\u5236\u7f13\u51b2\u533a\uff0c\u672c\u8d28\u4e0a\u4e5f\u662f\u4e00\u4e2a\u7528\u4e8e\u548c\u4ece\u8282\u70b9\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\uff08\u6211\u4eec\u79f0\u4e4b\u4e3a\u4ece\u8282\u70b9\u5ba2\u6237\u7aef\uff09\uff0c\u4f7f\u7528\u7684\u8f93\u51fa\u7f13\u51b2\u533a\u3002 \u590d\u5236\u7f13\u51b2\u533a\u4e00\u65e6\u53d1\u751f\u6ea2\u51fa\uff0c\u4e3b\u8282\u70b9\u4e5f\u4f1a\u76f4\u63a5\u5173\u95ed\u548c\u4ece\u8282\u70b9\u8fdb\u884c\u590d\u5236\u64cd\u4f5c\u7684\u8fde\u63a5\uff0c\u5bfc\u81f4\u5168\u91cf\u590d\u5236\u5931\u8d25\u3002","title":"5-1 \u590d\u5236\u7f13\u51b2\u533a\u7684\u539f\u56e0"},{"location":"chap4/5redis_buffer/#5-2","text":"\u6211\u4eec\u53ef\u4ee5\u63a7\u5236\u4e3b\u8282\u70b9\u4fdd\u5b58\u7684\u6570\u636e\u91cf\u5927\u5c0f \u3002\u6309\u901a\u5e38\u7684\u4f7f\u7528\u7ecf\u9a8c\uff0c\u6211\u4eec\u4f1a\u628a\u4e3b\u8282\u70b9\u7684\u6570\u636e\u91cf\u63a7\u5236\u5728 2~4GB\uff0c\u8fd9\u6837\u53ef\u4ee5\u8ba9\u5168\u91cf\u540c\u6b65\u6267\u884c\u5f97\u66f4\u5feb\u4e9b\uff0c\u907f\u514d\u590d\u5236\u7f13\u51b2\u533a\u7d2f\u79ef\u8fc7\u591a\u547d\u4ee4\u3002 \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 client-output-buffer-limit \u914d\u7f6e\u9879\uff0c\u6765\u8bbe\u7f6e\u5408\u7406\u7684\u590d\u5236\u7f13\u51b2\u533a\u5927\u5c0f \u3002\u8bbe\u7f6e\u7684\u4f9d\u636e\uff0c\u5c31\u662f\u4e3b\u8282\u70b9\u7684\u6570\u636e\u91cf\u5927\u5c0f\u3001\u4e3b\u8282\u70b9\u7684\u5199\u8d1f\u8f7d\u538b\u529b\u548c\u4e3b\u8282\u70b9\u672c\u8eab\u7684\u5185\u5b58\u5927\u5c0f\u3002 config set client-output-buffer-limit slave 512mb 128mb 60 slave \u53c2\u6570\u8868\u660e\u8be5\u914d\u7f6e\u9879\u662f \u9488\u5bf9\u590d\u5236\u7f13\u51b2\u533a\u7684 \u3002 512mb \u4ee3\u8868\u5c06\u7f13\u51b2\u533a\u5927\u5c0f\u7684\u4e0a\u9650\u8bbe\u7f6e\u4e3a 512MB\uff1b 128mb \u548c 60 \u4ee3\u8868\u7684\u8bbe\u7f6e\u662f\uff0c\u5982\u679c\u8fde\u7eed 60 \u79d2\u5185\u7684\u5199\u5165\u91cf\u8d85\u8fc7 128MB \u7684\u8bdd\uff0c\u4e5f\u4f1a\u89e6\u53d1\u7f13\u51b2\u533a\u6ea2\u51fa\u3002 \u5047\u8bbe\u4e00\u6761\u5199\u547d\u4ee4\u6570\u636e\u662f 1KB\uff0c\u90a3\u4e48\uff0c\u590d\u5236\u7f13\u51b2\u533a\u53ef\u4ee5\u7d2f\u79ef 512K \u6761\uff08512MB/1KB = 512K\uff09\u5199\u547d\u4ee4\u3002\u540c\u65f6\uff0c\u4e3b\u8282\u70b9\u5728\u5168\u91cf\u590d\u5236\u671f\u95f4\uff0c\u53ef\u4ee5\u627f\u53d7\u7684\u5199\u547d\u4ee4\u901f\u7387\u4e0a\u9650\u662f 2000 \u6761 /s\uff08128MB/1KB/60 \u7ea6\u7b49\u4e8e 2000\uff09\u3002 \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\u8bbe\u7f6e\u590d\u5236\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u65f6\uff0c \u53ef\u4ee5\u6839\u636e\u5199\u547d\u4ee4\u6570\u636e\u7684\u5927\u5c0f\u548c\u5e94\u7528\u7684\u5b9e\u9645\u8d1f\u8f7d\u60c5\u51b5\uff08\u4e5f\u5c31\u662f\u5199\u547d\u4ee4\u901f\u7387\uff09\uff0c\u6765\u7c97\u7565\u4f30\u8ba1\u7f13\u51b2\u533a\u4e2d\u4f1a\u7d2f\u79ef\u7684\u5199\u547d\u4ee4\u6570\u636e\u91cf\uff1b \u7136\u540e\uff0c\u518d\u548c\u6240\u8bbe\u7f6e\u7684\u590d\u5236\u7f13\u51b2\u533a\u5927\u5c0f\u8fdb\u884c\u6bd4\u8f83\uff0c\u5224\u65ad\u8bbe\u7f6e\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u662f\u5426\u8db3\u591f\u652f\u6491\u7d2f\u79ef\u7684\u5199\u547d\u4ee4\u6570\u636e\u91cf\u3002 \u4e3b\u8282\u70b9\u4e0a\u590d\u5236\u7f13\u51b2\u533a\u7684\u5185\u5b58\u5f00\u9500\uff0c\u4f1a\u662f\u6bcf\u4e2a\u4ece\u8282\u70b9\u5ba2\u6237\u7aef\u8f93\u51fa\u7f13\u51b2\u533a\u5360\u7528\u5185\u5b58\u7684\u603b\u548c\u3002\u5982\u679c\u96c6\u7fa4\u4e2d\u7684\u4ece\u8282\u70b9\u6570\u975e\u5e38\u591a\u7684\u8bdd\uff0c \u4e3b\u8282\u70b9\u7684\u5185\u5b58\u5f00\u9500\u5c31\u4f1a\u975e\u5e38\u5927\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u8fd8\u5fc5\u987b\u5f97\u63a7\u5236\u548c\u4e3b\u8282\u70b9\u8fde\u63a5\u7684\u4ece\u8282\u70b9\u4e2a\u6570\uff0c\u4e0d\u8981\u4f7f\u7528\u5927\u89c4\u6a21\u7684\u4e3b\u4ece\u96c6\u7fa4 \u3002 \u4e3a\u4e86\u907f\u514d\u590d\u5236\u7f13\u51b2\u533a\u7d2f\u79ef\u8fc7\u591a\u547d\u4ee4\u9020\u6210\u6ea2\u51fa\uff0c\u5f15\u53d1\u5168\u91cf\u590d\u5236\u5931\u8d25\uff0c \u6211\u4eec\u53ef\u4ee5\u63a7\u5236\u4e3b\u8282\u70b9\u4fdd\u5b58\u7684\u6570\u636e\u91cf\u5927\u5c0f\uff0c\u5e76\u8bbe\u7f6e\u5408\u7406\u7684\u590d\u5236\u7f13\u51b2\u533a\u5927\u5c0f\u3002\u540c\u65f6\uff0c\u6211\u4eec\u9700\u8981\u63a7\u5236\u4ece\u8282\u70b9\u7684\u6570\u91cf\uff0c\u6765\u907f\u514d\u4e3b\u8282\u70b9\u4e2d\u590d\u5236\u7f13\u51b2\u533a\u5360\u7528\u8fc7\u591a\u5185\u5b58\u7684\u95ee\u9898\u3002","title":"5-2 \u5982\u4f55\u907f\u514d\u590d\u5236\u7f13\u51b2\u533a\u53d1\u751f\u6ea2\u51fa\u5462\uff1f"},{"location":"chap4/5redis_buffer/#6","text":"\u589e\u91cf\u590d\u5236\u65f6\u4f7f\u7528\u7684\u7f13\u51b2\u533a\uff0c\u8fd9\u4e2a\u7f13\u51b2\u533a\u79f0\u4e3a\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u3002 \u4e3b\u8282\u70b9\u5728\u628a\u63a5\u6536\u5230\u7684\u5199\u547d\u4ee4\u540c\u6b65\u7ed9\u4ece\u8282\u70b9\u65f6\uff0c\u540c\u65f6\u4f1a\u628a\u8fd9\u4e9b\u5199\u547d\u4ee4\u5199\u5165 \u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a \u3002 \u4e00\u65e6\u4ece\u8282\u70b9\u53d1\u751f\u7f51\u7edc\u95ea\u65ad\uff0c\u518d\u6b21\u548c\u4e3b\u8282\u70b9\u6062\u590d\u8fde\u63a5\u540e\uff0c \u4ece\u8282\u70b9\u5c31\u4f1a\u4ece\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u4e2d\uff0c\u8bfb\u53d6\u65ad\u8fde\u671f\u95f4\u4e3b\u8282\u70b9\u63a5\u6536\u5230\u7684\u5199\u547d\u4ee4\uff0c\u8fdb\u800c\u8fdb\u884c\u589e\u91cf\u540c\u6b65 \uff0c \u5982\u4e0b\u56fe\u6240\u793a\uff1a \u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u4e86\uff0c repl_backlog_buffer ,\u589e\u91cf\u590d\u5236 \uff0c\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u6ea2\u51fa\u7684\u5f71\u54cd\uff0c\u4ee5\u53ca\u5982\u4f55\u5e94\u5bf9\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u7684\u6ea2\u51fa\u95ee\u9898\u3002 \u9996\u5148\uff0c\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u662f\u4e00\u4e2a\u5927\u5c0f\u6709\u9650\u7684\u73af\u5f62\u7f13\u51b2\u533a\u3002\u5f53\u4e3b\u8282\u70b9\u628a\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u5199\u6ee1\u540e\uff0c\u4f1a\u8986\u76d6\u7f13\u51b2\u533a\u4e2d\u7684\u65e7\u547d\u4ee4\u6570\u636e\u3002\u5982\u679c\u4ece\u8282\u70b9\u8fd8\u6ca1\u6709\u540c\u6b65\u8fd9\u4e9b\u65e7\u547d\u4ee4\u6570\u636e\uff0c\u5c31\u4f1a\u9020\u6210\u4e3b\u4ece\u8282\u70b9\u95f4\u91cd\u65b0\u5f00\u59cb\u6267\u884c\u5168\u91cf\u590d\u5236\u3002 \u5176\u6b21\uff0c\u4e3a\u4e86\u5e94\u5bf9\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u7684\u6ea2\u51fa\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u8c03\u6574\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff0c\u4e5f\u5c31\u662f\u8bbe\u7f6e repl_backlog_size \u8fd9\u4e2a\u53c2\u6570\u7684\u503c\u3002","title":"6\u3001\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u7684\u6ea2\u51fa\u95ee\u9898"},{"location":"chap4/5redis_buffer/#7","text":"\u4f7f\u7528\u7f13\u51b2\u533a\u4ee5\u540e\uff0c\u5f53\u547d\u4ee4\u6570\u636e\u7684\u63a5\u6536\u65b9\u5904\u7406\u901f\u5ea6\u8ddf\u4e0d\u4e0a\u53d1\u9001\u65b9\u7684\u53d1\u9001\u901f\u5ea6\u65f6\uff0c\u7f13\u51b2\u533a\u53ef\u4ee5\u907f\u514d\u547d\u4ee4\u6570\u636e\u7684\u4e22\u5931\u3002 \u6309\u7167\u7f13\u51b2\u533a\u7684\u7528\u9014\uff0c\u4f8b\u5982\u662f\u7528\u4e8e\u5ba2\u6237\u7aef\u901a\u4fe1\u8fd8\u662f\u7528\u4e8e\u4e3b\u4ece\u8282\u70b9\u590d\u5236\uff0c\u6211\u628a\u7f13\u51b2\u533a\u5206\u6210\u4e86 \u5ba2\u6237\u7aef\u7684\u8f93\u5165 \u5ba2\u6237\u7aef\u8f93\u51fa\u7f13\u51b2\u533a \u4e3b\u4ece\u96c6\u7fa4\u4e2d\u4e3b\u8282\u70b9\u4e0a\u7684\u590d\u5236\u7f13\u51b2\u533a \u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a \u73b0\u5728\uff0c\u4ece\u7f13\u51b2\u533a\u6ea2\u51fa\u5bf9 Redis \u7684\u5f71\u54cd\u7684\u89d2\u5ea6\uff0c\u6211\u518d\u628a\u8fd9\u56db\u4e2a\u7f13\u51b2\u533a\u5206\u6210\u4e24\u7c7b\u505a\u4e2a\u603b\u7ed3\u3002 \u7f13\u51b2\u533a\u6ea2\u51fa\u5bfc\u81f4\u7f51\u7edc\u8fde\u63a5\u5173\u95ed\uff1a\u666e\u901a\u5ba2\u6237\u7aef\u3001\u8ba2\u9605\u5ba2\u6237\u7aef\uff0c\u4ee5\u53ca\u4ece\u8282\u70b9\u5ba2\u6237\u7aef\uff0c\u5b83\u4eec\u4f7f\u7528\u7684\u7f13\u51b2\u533a\uff0c\u672c\u8d28\u4e0a\u90fd\u662f Redis \u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u4e4b\u95f4\uff0c\u6216\u662f\u4e3b\u4ece\u8282\u70b9\u4e4b\u95f4\u4e3a\u4e86\u4f20\u8f93\u547d\u4ee4\u6570\u636e\u800c\u7ef4\u62a4\u7684\u3002\u8fd9\u4e9b\u7f13\u51b2\u533a\u4e00\u65e6\u53d1\u751f\u6ea2\u51fa\uff0c\u5904\u7406\u673a\u5236\u90fd\u662f\u76f4\u63a5\u628a\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u7684\u8fde\u63a5\uff0c\u6216\u662f\u4e3b\u4ece\u8282\u70b9\u95f4\u7684\u8fde\u63a5\u5173\u95ed\u3002\u7f51\u7edc\u8fde\u63a5\u5173\u95ed\u9020\u6210\u7684\u76f4\u63a5\u5f71\u54cd\uff0c\u5c31\u662f\u4e1a\u52a1\u7a0b\u5e8f\u65e0\u6cd5\u8bfb\u5199 Redis\uff0c\u6216\u8005\u662f\u4e3b\u4ece\u8282\u70b9\u5168\u91cf\u540c\u6b65\u5931\u8d25\uff0c\u9700\u8981\u91cd\u65b0\u6267\u884c\u3002 \u7f13\u51b2\u533a\u6ea2\u51fa\u5bfc\u81f4\u547d\u4ee4\u6570\u636e\u4e22\u5931\uff1a\u4e3b\u8282\u70b9\u4e0a\u7684\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u5c5e\u4e8e\u73af\u5f62\u7f13\u51b2\u533a\uff0c\u4e00\u65e6\u53d1\u751f\u6ea2\u51fa\uff0c\u65b0\u5199\u5165\u7684\u547d\u4ee4\u6570\u636e\u5c31\u4f1a\u8986\u76d6\u65e7\u7684\u547d\u4ee4\u6570\u636e\uff0c\u5bfc\u81f4\u65e7\u547d\u4ee4\u6570\u636e\u7684\u4e22\u5931\uff0c\u8fdb\u800c\u5bfc\u81f4\u4e3b\u4ece\u8282\u70b9\u91cd\u65b0\u8fdb\u884c\u5168\u91cf\u590d\u5236\u3002 \u4ece\u672c\u8d28\u4e0a\u770b\uff0c\u7f13\u51b2\u533a\u6ea2\u51fa\uff0c\u65e0\u975e\u5c31\u662f\u4e09\u4e2a\u539f\u56e0\uff1a \u547d\u4ee4\u6570\u636e\u53d1\u9001\u8fc7\u5feb\u8fc7\u5927\uff1b \u547d\u4ee4\u6570\u636e\u5904\u7406\u8f83\u6162\uff1b \u7f13\u51b2\u533a\u7a7a\u95f4\u8fc7\u5c0f\u3002 \u660e\u767d\u4e86\u8fd9\u4e2a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6709\u9488\u5bf9\u6027\u5730\u62ff\u51fa\u5e94\u5bf9\u7b56\u7565\u4e86\u3002 \u9488\u5bf9\u547d\u4ee4\u6570\u636e\u53d1\u9001\u8fc7\u5feb\u8fc7\u5927\u7684\u95ee\u9898\uff0c\u5bf9\u4e8e\u666e\u901a\u5ba2\u6237\u7aef\u6765\u8bf4\u53ef\u4ee5\u907f\u514d bigkey\uff0c\u800c\u5bf9\u4e8e\u590d\u5236\u7f13\u51b2\u533a\u6765\u8bf4\uff0c\u5c31\u662f\u907f\u514d\u8fc7\u5927\u7684 RDB \u6587\u4ef6\u3002 \u9488\u5bf9\u547d\u4ee4\u6570\u636e\u5904\u7406\u8f83\u6162\u7684\u95ee\u9898\uff0c\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u51cf\u5c11 Redis \u4e3b\u7ebf\u7a0b\u4e0a\u7684\u963b\u585e\u64cd\u4f5c\uff0c\u4f8b\u5982\u4f7f\u7528\u5f02\u6b65\u7684\u5220\u9664\u64cd\u4f5c\u3002 \u9488\u5bf9\u7f13\u51b2\u533a\u7a7a\u95f4\u8fc7\u5c0f\u7684\u95ee\u9898\uff0c\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u4f7f\u7528 client-output-buffer-limit \u914d\u7f6e\u9879\u8bbe\u7f6e\u5408\u7406\u7684\u8f93\u51fa\u7f13\u51b2\u533a\u3001\u590d\u5236\u7f13\u51b2\u533a\u548c\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u5927\u5c0f \u3002\u5f53\u7136\uff0c\u6211\u4eec\u4e0d\u8981\u5fd8\u4e86\uff0c\u8f93\u5165\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u9ed8\u8ba4\u662f\u56fa\u5b9a\u7684\uff0c\u6211\u4eec\u65e0\u6cd5\u901a\u8fc7\u914d\u7f6e\u6765\u4fee\u6539\u5b83\uff0c\u9664\u975e\u76f4\u63a5\u53bb\u4fee\u6539 Redis \u6e90\u7801\u3002","title":"7\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap4/6redis_slow_respone/","text":"\u7b2c\u56db\u7ae0 Redis \u5f71\u54cd\u6027\u80fd\u7684\u6f5c\u5728\u56e0\u7d20 1\u3001Redis \u6027\u80fd\u7684 5 \u5927\u65b9\u9762\u7684\u6f5c\u5728\u56e0\u7d20\uff0c 1\u3001Redis\u6709\u54ea\u4e9b\u53ef\u80fd\u5bfc\u81f4\u963b\u585e\u7684\u64cd\u4f5c\uff0c\u4ee5\u53ca\u89e3\u51b3\u673a\u5236 Redis \u5185\u90e8\u7684\u963b\u585e\u5f0f\u64cd\u4f5c\uff1b CPU \u6838\u548c NUMA \u67b6\u6784\u7684\u5f71\u54cd\uff1b Redis \u5173\u952e\u7cfb\u7edf\u914d\u7f6e\uff1b Redis \u5185\u5b58\u788e\u7247\uff1b Redis \u7f13\u51b2\u533a\u3002 Redis \u5b9e\u4f8b\u8fd0\u884c\u65f6\u7684 4 \u5927\u7c7b\u4ea4\u4e92\u5bf9\u8c61\uff1a \u5ba2\u6237\u7aef\u3001\u78c1\u76d8\u3001\u4e3b\u4ece\u5e93\u5b9e\u4f8b\u3001\u5207\u7247\u96c6\u7fa4\u5b9e\u4f8b \u3002 \u57fa\u4e8e\u8fd9 4 \u5927\u7c7b\u4ea4\u4e92\u5bf9\u8c61\uff0c\u6211\u4eec\u68b3\u7406\u4e86\u4f1a\u5bfc\u81f4 Redis \u6027\u80fd\u53d7\u635f\u7684 5 \u5927\u963b\u585e\u70b9\uff0c\u5305\u62ec \u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\u3001bigkey \u5220\u9664\u3001\u6e05\u7a7a\u6570\u636e\u5e93\u3001AOF \u65e5\u5fd7\u540c\u6b65\u5199\uff0c\u4ee5\u53ca\u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6 \u3002 \u5728\u8fd9 5 \u5927\u963b\u585e\u70b9\u4e2d\uff0c bigkey \u5220\u9664\u3001\u6e05\u7a7a\u6570\u636e\u5e93\u3001AOF \u65e5\u5fd7\u540c\u6b65\u5199\u4e0d\u5c5e\u4e8e\u5173\u952e\u8def\u5f84\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4f7f\u7528\u5f02\u6b65\u5b50\u7ebf\u7a0b\u673a\u5236\u6765\u5b8c\u6210 \u3002 Redis \u5728\u8fd0\u884c\u65f6\u4f1a\u521b\u5efa\u4e09\u4e2a\u5b50\u7ebf\u7a0b\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u901a\u8fc7\u4e00\u4e2a\u4efb\u52a1\u961f\u5217\u548c\u4e09\u4e2a\u5b50\u7ebf\u7a0b\u8fdb\u884c\u4ea4\u4e92\u3002\u5b50\u7ebf\u7a0b\u4f1a\u6839\u636e\u4efb\u52a1\u7684\u5177\u4f53\u7c7b\u578b\uff0c\u6765\u6267\u884c\u76f8\u5e94\u7684\u5f02\u6b65\u64cd\u4f5c\u3002 \u4e0d\u8fc7\uff0c\u5f02\u6b65\u5220\u9664\u64cd\u4f5c\u662f Redis 4.0 \u4ee5\u540e\u624d\u6709\u7684\u529f\u80fd\uff0c\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f 4.0 \u4e4b\u524d\u7684\u7248\u672c\uff0c\u5f53\u4f60\u9047\u5230 bigkey \u5220\u9664\u65f6\uff1a \u4f7f\u7528\u96c6\u5408\u7c7b\u578b\u63d0\u4f9b\u7684 SCAN \u547d\u4ee4\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540e\u518d\u8fdb\u884c\u5220\u9664\u3002\u56e0\u4e3a\u7528 SCAN \u547d\u4ee4\u53ef\u4ee5\u6bcf\u6b21\u53ea\u8bfb\u53d6\u4e00\u90e8\u5206\u6570\u636e\u5e76\u8fdb\u884c\u5220\u9664\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u4e00\u6b21\u6027\u5220\u9664\u5927\u91cf key \u7ed9\u4e3b\u7ebf\u7a0b\u5e26\u6765\u7684\u963b\u585e \u3002 \u4f8b\u5982\uff0c\u5bf9\u4e8e Hash \u7c7b\u578b\u7684 bigkey \u5220\u9664\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 HSCAN \u547d\u4ee4\uff0c\u6bcf\u6b21\u4ece Hash \u96c6\u5408\u4e2d\u83b7\u53d6\u4e00\u90e8\u5206\u952e\u503c\u5bf9\uff08\u4f8b\u5982 200 \u4e2a\uff09\uff0c\u518d\u4f7f\u7528 HDEL \u5220\u9664\u8fd9\u4e9b\u952e\u503c\u5bf9\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u628a\u5220\u9664\u538b\u529b\u5206\u644a\u5230\u591a\u6b21\u64cd\u4f5c\u4e2d\uff0c\u90a3\u4e48\uff0c\u6bcf\u6b21\u5220\u9664\u64cd\u4f5c\u7684\u8017\u65f6\u5c31\u4e0d\u4f1a\u592a\u957f\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u4e86\u3002 \u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\u3001\u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6\u662f\u5728\u5173\u952e\u8def\u5f84\u4e0a\uff0c\u65e0\u6cd5\u4f7f\u7528\u5f02\u6b65\u64cd\u4f5c\u6765\u5b8c\u6210 \u3002\u5bf9\u4e8e\u8fd9\u4e24\u4e2a\u963b\u585e\u70b9\uff0c\u6211\u4e24\u4e2a\u5c0f\u5efa\u8bae\u3002 \u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\uff1a\u53ef\u4ee5\u4f7f\u7528 SCAN \u547d\u4ee4\uff0c\u5206\u6279\u8bfb\u53d6\u6570\u636e\uff0c\u518d\u5728\u5ba2\u6237\u7aef\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\uff1b \u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6\uff1a\u628a\u4e3b\u5e93\u7684\u6570\u636e\u91cf\u5927\u5c0f\u63a7\u5236\u5728 2~4GB \u5de6\u53f3\uff0c\u4ee5\u4fdd\u8bc1 RDB \u6587\u4ef6\u80fd\u4ee5\u8f83\u5feb\u7684\u901f\u5ea6\u52a0\u8f7d\u3002 \u8981\u70b9&\u4eae\u70b9 \u4e0e\u5ba2\u6237\u7aef\u4ea4\u4e92\u65f6\u7684\u963b\u585e\u70b9\uff1a\u9ad8\u590d\u6742\u5ea6\u7684\u589e\u5220\u6539\u64cd\u4f5c\uff08\u96c6\u5408\u5168\u91cf\u7684\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\uff0cbigKey \u5220\u9664\u64cd\u4f5c\uff0c\u6e05\u7a7a\u6570\u636e\u5e93\uff09 \u4e0e\u78c1\u76d8\u4ea4\u4e92\u7684\u963b\u585e\u70b9\uff1aaof\u65e5\u5fd7\u5b9e\u65f6\u540c\u6b65\u5199\u56de \u4e3b\u4ece\u8282\u70b9\u4ea4\u4e92\u65f6\u7684\u963b\u585e\u70b9\uff1a\u4ece\u5e93\u52a0\u8f7dRDB\u6587\u4ef6 \u5206\u7247\u96c6\u7fa4\u7684\u963b\u585e\u70b9\uff1a\u54c8\u5e0c\u69fdbigkey\u6570\u636e\u8fc1\u79fb \u5173\u952e\u8def\u5f84\u64cd\u4f5c\u6982\u5ff5\uff1a\u5ba2\u6237\u7aef\u628a\u8bf7\u6c42\u53d1\u7ed9Redis\u540e\uff0c\u8981\u7b49\u7740Redis\u8fd4\u56de\u6570\u636e\u7ed3\u679c\u7684\u64cd\u4f5c \u5f02\u6b65\u7684\u5b50\u7ebf\u7a0b\u673a\u5236\uff1a\u4e3b\u7ebf\u7a0b\u901a\u8fc7\u4e00\u4e2a\u94fe\u8868\u5f62\u5f0f\u7684\u4efb\u52a1\u961f\u5217\u548c\u5b50\u7ebf\u7a0b\u8fdb\u884c\u4ea4\u4e92 lazy free \u673a\u5236\uff1aRedis\u6536\u5230\u952e\u503c\u5bf9\u5220\u9664\u548c\u6e05\u7a7a\u6570\u636e\u5e93\u7684\u6307\u4ee4\u65f6\uff0c\u4e3b\u7ebf\u7ebf\u7a0b\u4f1a\u628a\u8fd9\u4e2a\u64cd\u4f5c\u5c01\u88c5\u6210\u4e00\u4e2a\u4efb\u52a1\uff0c\u653e\u5165\u4efb\u52a1\u961f\u5217\u4e2d\uff0c\u7136\u540e\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u4e00\u4e2a\u5b8c\u6210\u4fe1\u606f\uff0c\u4f46\u5b9e\u9645\u4e0a\uff0c\u8fd9\u4e2a\u5220\u9664\u8fd8\u6ca1\u6709\u6267\u884c\uff0c\u9700\u8981\u7b49\u5f85\u540e\u53f0\u5b50\u7ebf\u7a0b\u4ece\u4efb\u52a1\u961f\u5217\u4e2d\u8bfb\u53d6\u5230\u8fd9\u4e2a\u4efb\u52a1\u540e\uff0c\u624d\u5f00\u59cb\u5b9e\u9645\u5220\u9664\u952e\u503c\u5bf9\uff0c\u5e76\u91ca\u653e\u76f8\u5e94\u7684\u5185\u5b58\u7a7a\u95f4\u3002 \u4f46\u662f\uff1a lazy-free \u662f 4.0 \u65b0\u589e\u529f\u80fd\uff0c\u9ed8\u8ba4\u5173\u95ed\u3002\u5f00\u542f\u8fd9\u4e2a\u914d\u7f6e\u540e\uff0c \u9664\u4e86 replica-lazy-flush \u4e4b\u5916\uff0c\u5176\u4ed6\u60c5\u51b5\u90fd\u53ea\u662f \u53ef\u80fd \u53bb\u5f02\u6b65\u91ca\u653e key \u7684\u5185\u5b58\uff0c\u5e76\u4e0d\u662f\u6bcf\u6b21\u5fc5\u5b9a\u5f02\u6b65\u91ca\u653e\u5185\u5b58\u7684\u3002\u662f\u5426\u4f1a\u771f\u6b63\u5f02\u6b65\u91ca\u653e\u5185\u5b58\uff0c\u53d6\u51b3\u4e8e key \u7684\u7c7b\u578b\uff0c\u7f16\u7801\u65b9\u5f0f\uff0c\u5143\u7d20\u6570\u91cf\uff0c\u6240\u4ee5 \u5373\u4f7f\u5f00\u542f\u4e86 lazy-free \uff0c String \u7c7b\u578b\u7684 bigkey \uff0c\u5728\u5220\u9664\u65f6\u4f9d\u65e7\u6709\u963b\u585e\u4e3b\u7ebf\u7a0b\u7684\u98ce\u9669 2\u3001\u5728\u591a\u6838CPU\u67b6\u6784\u548cNUMA\u67b6\u6784\u4e0b\uff0c\u5982\u4f55\u5bf9redis\u8fdb\u884c\u4f18\u5316\u914d\u7f6e \u591a\u6838 CPU \u67b6\u6784\uff0c\u4ee5\u53ca NUMA \u67b6\u6784\u3002 \u5728\u591a\u6838 CPU \u67b6\u6784\u4e0b\uff0cRedis \u5982\u679c\u5728\u4e0d\u540c\u7684\u6838\u4e0a\u8fd0\u884c\uff0c\u5c31\u9700\u8981\u9891\u7e41\u5730\u8fdb\u884c\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u589e\u52a0 Redis \u7684\u6267\u884c\u65f6\u95f4\uff0c\u5ba2\u6237\u7aef\u4e5f\u4f1a\u89c2\u5bdf\u5230\u8f83\u9ad8\u7684\u5c3e\u5ef6\u8fdf\u4e86\u3002 \u6240\u4ee5\uff0c \u5efa\u8bae\u4f60\u5728 Redis \u8fd0\u884c\u65f6\uff0c\u628a\u5b9e\u4f8b\u548c\u67d0\u4e2a\u6838\u7ed1\u5b9a\uff0c\u8fd9\u6837\uff0c\u5c31\u80fd\u91cd\u590d\u5229\u7528\u6838\u4e0a\u7684 L1\u3001L2 \u7f13\u5b58\uff0c\u53ef\u4ee5\u964d\u4f4e\u54cd\u5e94\u5ef6\u8fdf \u3002 \u4e3a\u4e86\u63d0\u5347 Redis \u7684\u7f51\u7edc\u6027\u80fd\uff0c\u6211\u4eec\u6709\u65f6\u8fd8\u4f1a\u628a\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u548c CPU \u6838\u7ed1\u5b9a\u3002 \u5982\u679c\u670d\u52a1\u5668\u4f7f\u7528\u7684\u662f NUMA \u67b6\u6784\uff0cRedis \u5b9e\u4f8b\u4e00\u65e6\u88ab\u8c03\u5ea6\u5230\u548c\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u4e0d\u5728\u540c\u4e00\u4e2a CPU Socket\uff0c\u5c31\u8981\u8de8 CPU Socket \u8bbf\u95ee\u7f51\u7edc\u6570\u636e\uff0c\u8fd9\u5c31\u4f1a\u964d\u4f4e Redis \u7684\u6027\u80fd\u3002 \u5efa\u8bae\u4f60\u628a Redis \u5b9e\u4f8b\u548c\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u7ed1\u5728\u540c\u4e00\u4e2a CPU Socket \u4e0b\u7684\u4e0d\u540c\u6838\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u5347 Redis \u7684\u8fd0\u884c\u6027\u80fd\u3002 \u867d\u7136\u7ed1\u6838\u53ef\u4ee5\u5e2e\u52a9 Redis \u964d\u4f4e\u8bf7\u6c42\u6267\u884c\u65f6\u95f4\uff0c\u4f46\u662f\uff0c\u9664\u4e86\u4e3b\u7ebf\u7a0b\uff0cRedis \u8fd8\u6709\u7528\u4e8e RDB \u548c AOF \u91cd\u5199\u7684\u5b50\u8fdb\u7a0b\uff0c\u4ee5\u53ca 4.0 \u7248\u672c\u4e4b\u540e\u63d0\u4f9b\u7684\u7528\u4e8e\u60f0\u6027\u5220\u9664\u7684\u540e\u53f0\u7ebf\u7a0b\u3002 \u5f53 Redis \u5b9e\u4f8b\u548c\u4e00\u4e2a\u903b\u8f91\u6838\u7ed1\u5b9a\u540e\uff0c\u8fd9\u4e9b\u5b50\u8fdb\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\u4f1a\u548c\u4e3b\u7ebf\u7a0b\u7ade\u4e89 CPU \u8d44\u6e90\uff0c\u4e5f\u4f1a\u5bf9 Redis \u6027\u80fd\u9020\u6210\u5f71\u54cd \u3002\u6240\u4ee5\uff0c\u6211\u7ed9\u4e86\u4f60\u4e24\u4e2a\u5efa\u8bae\uff1a \u5982\u679c\u4f60\u4e0d\u60f3\u4fee\u6539 Redis \u4ee3\u7801\uff0c \u53ef\u4ee5\u628a\u6309\u4e00\u4e2a Redis \u5b9e\u4f8b\u4e00\u4e2a\u7269\u7406\u6838\u65b9\u5f0f\u8fdb\u884c\u7ed1\u5b9a\uff0c\u8fd9\u6837\uff0cRedis \u7684\u4e3b\u7ebf\u7a0b\u3001\u5b50\u8fdb\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\u53ef\u4ee5\u5171\u4eab\u4f7f\u7528\u4e00\u4e2a\u7269\u7406\u6838\u4e0a\u7684\u4e24\u4e2a\u903b\u8f91\u6838 \u3002 Redis \u7684\u6e90\u7801\uff0c\u5c31\u53ef\u4ee5\u5728\u6e90\u7801\u4e2d\u589e\u52a0\u7ed1\u6838\u64cd\u4f5c\uff0c\u628a\u5b50\u8fdb\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\u7ed1\u5230\u4e0d\u540c\u7684\u6838\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u5bf9\u4e3b\u7ebf\u7a0b\u7684 CPU \u8d44\u6e90\u7ade\u4e89 Redis 6.0 \u51fa\u6765\u540e\uff0c\u53ef\u4ee5\u652f\u6301 CPU \u6838\u7ed1\u5b9a\u7684\u914d\u7f6e\u64cd\u4f5c\u4e86 \u4eae\u70b9&\u8981\u70b9 \u4e3b\u6d41\u7684CPU\u67b6\u6784\uff0c\u4e3b\u8981\u6709\u591a\u6838CPU\u67b6\u6784\u548cNUMA\u67b6\u6784\u4e24\u4e2a\u67b6\u6784 \u591a\u6838CPU\u67b6\u6784\uff1a \u591a\u4e2a\u7269\u7406\u6838\uff0c\u5404\u7269\u7406\u6838\u4f7f\u7528\u79c1\u6709\u76841\u30012\u7ea7\u7f13\u5b58\uff0c\u5171\u4eab3\u7ea7\u7f13\u5b58\u3002\u7269\u7406\u6838\u53ef\u5305\u542b2\u4e2a\u8d85\u7ebf\u7a0b\uff0c\u79f0\u4e3a\u903b\u8f91\u6838 NUMA\u67b6\u6784\uff1a \u4e00\u4e2a\u670d\u52a1\u5668\u4e0a\u591a\u4e2acpu\uff0c\u79f0\u4e3aCPU Socket\uff0c\u6bcf\u4e2acpu socker\u5b58\u5728\u591a\u4e2a\u7269\u7406\u6838\u3002\u6bcf\u4e2asocket\u901a\u8fc7\u603b\u7ebf\u8fde\u63a5\uff0c\u5e76\u4e14\u6709\u7528\u79c1\u6709\u7684\u5185\u5b58\u7a7a\u95f4 cpu\u67b6\u6784\uff1a\u4e00\u4e2acpu\u4e00\u822c\u62e5\u6709\u591a\u4e2a\u7269\u7406\u6838\uff0c\u6bcf\u4e2a\u7269\u7406\u6838\u90fd\u62e5\u6709\u79c1\u6709\u7684\u4e00\u7ea7\u7f13\u5b58\uff0c\u4e8c\u7ea7\u7f13\u5b58\u3002\u4e09\u7ea7\u7f13\u5b58\u662f\u5404\u7269\u7406\u6838\u5171\u4eab\u7684\u7f13\u5b58\u7a7a\u95f4\u3002\u800c\u7269\u7406\u6838\u53c8\u53ef\u4ee5\u5206\u4e3a\u591a\u4e2a\u8d85\u7ebf\u7a0b\uff0c\u79f0\u4e3a\u903b\u8f91\u6838\uff0c\u540c\u4e00\u4e2a\u7269\u7406\u6838\u7684\u903b\u8f91\u6838\u4f1a\u5171\u4eab\u4f7f\u7528 L1\u3001L2 \u7f13\u5b58\u3002 \u4e00\u7ea7\u7f13\u5b58\u548c\u4e8c\u7ea7\u7f13\u5b58\u8bbf\u95ee\u5ef6\u8fdf\u4e0d\u8d85\u8fc710\u7eb3\u79d2\uff0c\u4f46\u7a7a\u95f4\u5f88\u5c0f\uff0c\u53ea\u662fKB\u5355\u4f4d\u3002\u800c\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u5185\u5b58\u5ef6\u8fdf\u662f\u767e\u7eb3\u79d2\u7ea7\u522b\uff0c\u57fa\u672c\u4e0a\u662f\u4e00\u4e8c\u7ea7\u7f13\u5b58\u768410\u500d \u4e0d\u540c\u7684\u7269\u7406\u6838\u8fd8\u4f1a\u5171\u4eab\u4e00\u4e2a\u5171\u540c\u7684\u4e09\u7ea7\u7f13\u5b58\uff0c\u4e09\u7ea7\u7f13\u5b58\u7a7a\u95f4\u6bd4\u8f83\u591a\uff0c\u4e3a\u51e0\u5230\u51e0\u5341MB\uff0c\u5f53 L1\u3001L2 \u7f13\u5b58\u4e2d\u6ca1\u6709\u6570\u636e\u7f13\u5b58\u65f6\uff0c\u53ef\u4ee5\u8bbf\u95ee L3\uff0c\u5c3d\u53ef\u80fd\u907f\u514d\u8bbf\u95ee\u5185\u5b58\u3002 \u591a\u6838CPU\u8fd0\u884credis\u5b9e\u4f8b\uff0c\u4f1a\u5bfc\u81f4context switch\uff0c\u5bfc\u81f4\u589e\u52a0\u5ef6\u8fdf\uff0c\u53ef\u4ee5\u901a\u8fc7taskset \u547d\u4ee4\u628aredis\u8fdb\u7a0b\u7ed1\u5b9a\u5230\u67d0\u4e2acup\u7269\u7406\u6838\u4e0a\u3002 NUMA\u67b6\u6784\u8fd0\u884credis\u5b9e\u4f8b\uff0c\u5982\u679c\u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u548credis\u5b9e\u4f8b\u8fd0\u884c\u5728\u4e0d\u540c\u7684socket\u4e0a\uff0c\u5c31\u9700\u8981\u8de8 CPU Socket \u8bbf\u95ee\u5185\u5b58\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u82b1\u8d39\u8f83\u591a\u65f6\u95f4\u3002 \u7ed1\u6838\u7684\u98ce\u9669\u548c\u89e3\u51b3\u65b9\u6848\uff1a \u4e00\u4e2a Redis \u5b9e\u4f8b\u5bf9\u5e94\u7ed1\u4e00\u4e2a\u7269\u7406\u6838 \uff1a \u5c06redis\u670d\u52a1\u7ed1\u5b9a\u5230\u4e00\u4e2a\u7269\u7406\u6838\u4e0a\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u903b\u8f91\u6838\u4e0a\uff0c\u5982 taskset -c 0,12 ./redis-server \u4f18\u5316 Redis \u6e90\u7801\u3002 3\u3001\u5f53redis\u67e5\u8be2\u53d8\u6162\u4e86\u600e\u4e48\u529e\uff1f \u5224\u65ad Redis \u53d8\u6162\u7684\u65b9\u6cd5\uff0c \u4e00\u4e2a\u662f\u770b\u54cd\u5e94\u5ef6\u8fdf\uff0c\u4e00\u4e2a\u662f\u770b\u57fa\u7ebf\u6027\u80fd \u3002\u540c\u65f6\uff0c\u6211\u8fd8\u7ed9\u4e86\u4f60\u4e24\u79cd\u6392\u67e5\u548c\u89e3\u51b3 Redis \u53d8\u6162\u8fd9\u4e2a\u95ee\u9898\u7684\u65b9\u6cd5\uff1a \u4ece\u6162\u67e5\u8be2\u547d\u4ee4\u5f00\u59cb\u6392\u67e5\uff0c\u5e76\u4e14\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u66ff\u6362\u6162\u67e5\u8be2\u547d\u4ee4 \uff1b \u6392\u67e5\u8fc7\u671f key \u7684\u65f6\u95f4\u8bbe\u7f6e\uff0c\u5e76\u6839\u636e\u5b9e\u9645\u4f7f\u7528\u9700\u6c42\uff0c\u8bbe\u7f6e\u4e0d\u540c\u7684\u8fc7\u671f\u65f6\u95f4 \u3002 9 \u4e2a\u68c0\u67e5\u70b9\u7684 Checklist\uff0c\u5e0c\u671b\u4f60\u5728\u9047\u5230 Redis \u6027\u80fd\u53d8\u6162\u65f6\uff0c\u6309\u7167\u8fd9\u4e9b\u6b65\u9aa4\u9010\u4e00\u68c0\u67e5\uff0c\u9ad8\u6548\u5730\u89e3\u51b3\u95ee\u9898: \u83b7\u53d6 Redis \u5b9e\u4f8b\u5728\u5f53\u524d\u73af\u5883\u4e0b\u7684\u57fa\u7ebf\u6027\u80fd\u3002 \u662f\u5426\u7528\u4e86\u6162\u67e5\u8be2\u547d\u4ee4\uff1f\u5982\u679c\u662f\u7684\u8bdd\uff0c\u5c31\u4f7f\u7528\u5176\u4ed6\u547d\u4ee4\u66ff\u4ee3\u6162\u67e5\u8be2\u547d\u4ee4\uff0c\u6216\u8005\u628a\u805a\u5408\u8ba1\u7b97\u547d\u4ee4\u653e\u5728\u5ba2\u6237\u7aef\u505a\u3002 \u662f\u5426\u5bf9\u8fc7\u671f key \u8bbe\u7f6e\u4e86\u76f8\u540c\u7684\u8fc7\u671f\u65f6\u95f4\uff1f \u5bf9\u4e8e\u6279\u91cf\u5220\u9664\u7684 key\uff0c\u53ef\u4ee5\u5728\u6bcf\u4e2a key \u7684\u8fc7\u671f\u65f6\u95f4\u4e0a\u52a0\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u907f\u514d\u540c\u65f6\u5220\u9664 \u3002 \u662f\u5426\u5b58\u5728 bigkey\uff1f \u5bf9\u4e8e bigkey \u7684\u5220\u9664\u64cd\u4f5c\uff0c\u5982\u679c\u4f60\u7684 Redis \u662f 4.0 \u53ca\u4ee5\u4e0a\u7684\u7248\u672c\uff0c\u53ef\u4ee5\u76f4\u63a5\u5229\u7528\u5f02\u6b65\u7ebf\u7a0b\u673a\u5236\u51cf\u5c11\u4e3b\u7ebf\u7a0b\u963b\u585e\uff1b\u5982\u679c\u662f Redis 4.0 \u4ee5\u524d\u7684\u7248\u672c\uff0c \u53ef\u4ee5\u4f7f\u7528 SCAN \u547d\u4ee4\u8fed\u4ee3\u5220\u9664\uff1b\u5bf9\u4e8e bigkey \u7684\u96c6\u5408\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4f7f\u7528 SCAN \u547d\u4ee4\u5728\u5ba2\u6237\u7aef\u5b8c\u6210 \u3002 Redis AOF \u914d\u7f6e\u7ea7\u522b\u662f\u4ec0\u4e48\uff1f\u4e1a\u52a1\u5c42\u9762\u662f\u5426\u7684\u786e\u9700\u8981\u8fd9\u4e00\u53ef\u9760\u6027\u7ea7\u522b\uff1f\u5982\u679c\u6211\u4eec\u9700\u8981\u9ad8\u6027\u80fd\uff0c\u540c\u65f6\u4e5f\u5141\u8bb8\u6570\u636e\u4e22\u5931\uff0c \u53ef\u4ee5\u5c06\u914d\u7f6e\u9879 no-appendfsync-on-rewrite \u8bbe\u7f6e\u4e3a yes \uff0c \u907f\u514d AOF \u91cd\u5199\u548c fsync \u7ade\u4e89\u78c1\u76d8 IO \u8d44\u6e90\uff0c\u5bfc\u81f4 Redis \u5ef6\u8fdf\u589e\u52a0 \u3002\u5f53\u7136\uff0c \u5982\u679c\u65e2\u9700\u8981\u9ad8\u6027\u80fd\u53c8\u9700\u8981\u9ad8\u53ef\u9760\u6027\uff0c\u6700\u597d\u4f7f\u7528\u9ad8\u901f\u56fa\u6001\u76d8\u4f5c\u4e3a AOF \u65e5\u5fd7\u7684\u5199\u5165\u76d8\u3002 Redis \u5b9e\u4f8b\u7684\u5185\u5b58\u4f7f\u7528\u662f\u5426\u8fc7\u5927\uff1f\u53d1\u751f swap \u4e86\u5417\uff1f\u5982\u679c\u662f\u7684\u8bdd\uff0c\u5c31\u589e\u52a0\u673a\u5668\u5185\u5b58\uff0c\u6216\u8005\u662f\u4f7f\u7528 Redis \u96c6\u7fa4\uff0c\u5206\u644a\u5355\u673a Redis \u7684\u952e\u503c\u5bf9\u6570\u91cf\u548c\u5185\u5b58\u538b\u529b\u3002\u540c\u65f6\uff0c\u8981\u907f\u514d\u51fa\u73b0 Redis \u548c\u5176\u4ed6\u5185\u5b58\u9700\u6c42\u5927\u7684\u5e94\u7528\u5171\u4eab\u673a\u5668\u7684\u60c5\u51b5\u3002 \u5728 Redis \u5b9e\u4f8b\u7684\u8fd0\u884c\u73af\u5883\u4e2d\uff0c\u662f\u5426\u542f\u7528\u4e86\u900f\u660e\u5927\u9875\u673a\u5236\uff1f\u5982\u679c\u662f\u7684\u8bdd\uff0c\u76f4\u63a5\u5173\u95ed\u5185\u5b58\u5927\u9875\u673a\u5236\u5c31\u884c\u4e86\u3002 \u662f\u5426\u8fd0\u884c\u4e86 Redis \u4e3b\u4ece\u96c6\u7fa4\uff1f\u5982\u679c\u662f\u7684\u8bdd\uff0c\u628a\u4e3b\u5e93\u5b9e\u4f8b\u7684\u6570\u636e\u91cf\u5927\u5c0f\u63a7\u5236\u5728 2~4GB\uff0c\u4ee5\u514d\u4e3b\u4ece\u590d\u5236\u65f6\uff0c\u4ece\u5e93\u56e0\u52a0\u8f7d\u5927\u7684 RDB \u6587\u4ef6\u800c\u963b\u585e\u3002 \u662f\u5426\u4f7f\u7528\u4e86\u591a\u6838 CPU \u6216 NUMA \u67b6\u6784\u7684\u673a\u5668\u8fd0\u884c Redis \u5b9e\u4f8b\uff1f\u4f7f\u7528\u591a\u6838 CPU \u65f6\uff0c\u53ef\u4ee5\u7ed9 Redis \u5b9e\u4f8b\u7ed1\u5b9a\u7269\u7406\u6838\uff1b\u4f7f\u7528 NUMA \u67b6\u6784\u65f6\uff0c\u6ce8\u610f\u628a Redis \u5b9e\u4f8b\u548c\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u8fd0\u884c\u5728\u540c\u4e00\u4e2a CPU Socket \u4e0a\u3002 \u4ed4\u7ec6\u68c0\u67e5\u4e0b\u6709\u6ca1\u6709\u607c\u4eba\u7684\u201c\u90bb\u5c45\u201d\uff0c\u5177\u4f53\u70b9\u8bf4\uff0c\u5c31\u662f Redis \u6240\u5728\u7684\u673a\u5668\u4e0a\u6709\u6ca1\u6709\u4e00\u4e9b\u5176\u4ed6\u5360\u5185\u5b58\u3001\u78c1\u76d8 IO \u548c\u7f51\u7edc IO \u7684\u7a0b\u5e8f\uff0c\u6bd4\u5982\u8bf4\u6570\u636e\u5e93\u7a0b\u5e8f\u6216\u8005\u6570\u636e\u91c7\u96c6\u7a0b\u5e8f\u3002 \u5982\u679c\u6709\u7684\u8bdd\uff0c\u6211\u5efa\u8bae\u4f60\u5c06\u8fd9\u4e9b\u7a0b\u5e8f\u8fc1\u79fb\u5230\u5176\u4ed6\u673a\u5668\u4e0a\u8fd0\u884c\u3002 \u5206\u6790\u3001\u6392\u67e5\u3001\u89e3\u51b3Redis\u53d8\u6162\u95ee\u9898 \u4f7f\u7528\u590d\u6742\u5ea6\u8fc7\u9ad8\u7684\u547d\u4ee4\uff08\u4f8b\u5982SORT/SUION/ZUNIONSTORE/KEYS\uff09\uff0c\u6216\u4e00\u6b21\u67e5\u8be2\u5168\u91cf\u6570\u636e\uff08\u4f8b\u5982LRANGE key 0 N\uff0c\u4f46N\u5f88\u5927\uff09 \u5206\u6790\uff1a a) \u67e5\u770bslowlog\u662f\u5426\u5b58\u5728\u8fd9\u4e9b\u547d\u4ee4 b) Redis\u8fdb\u7a0bCPU\u4f7f\u7528\u7387\u662f\u5426\u98d9\u5347\uff08\u805a\u5408\u8fd0\u7b97\u547d\u4ee4\u5bfc\u81f4\uff09 \u89e3\u51b3\uff1a a) \u4e0d\u4f7f\u7528\u590d\u6742\u5ea6\u8fc7\u9ad8\u7684\u547d\u4ee4\uff0c\u6216\u7528\u5176\u4ed6\u65b9\u5f0f\u4ee3\u66ff\u5b9e\u73b0\uff08\u653e\u5728\u5ba2\u6237\u7aef\u505a\uff09 b) \u6570\u636e\u5c3d\u91cf\u5206\u6279\u67e5\u8be2\uff08LRANGE key 0 N\uff0c\u5efa\u8baeN<=100\uff0c\u67e5\u8be2\u5168\u91cf\u6570\u636e\u5efa\u8bae\u4f7f\u7528HSCAN/SSCAN/ZSCAN\uff09 \u64cd\u4f5cbigkey \u5206\u6790\uff1a a) slowlog \u51fa\u73b0\u5f88\u591a SET/DELETE \u53d8\u6162\u547d\u4ee4\uff08bigkey\u5206\u914d\u5185\u5b58\u548c\u91ca\u653e\u5185\u5b58\u53d8\u6162\uff09 b) \u4f7f\u7528 redis-cli -h $host -p $port --bigkeys \u626b\u63cf\u51fa\u5f88\u591a bigkey \u89e3\u51b3\uff1a a) \u4f18\u5316\u4e1a\u52a1\uff0c\u907f\u514d\u5b58\u50a8bigkey b) Redis 4.0+\u53ef\u5f00\u542f lazy-free \u673a\u5236 \u5927\u91cfkey\u96c6\u4e2d\u8fc7\u671f \u5206\u6790\uff1a a) \u4e1a\u52a1\u4f7f\u7528EXPIREAT/PEXPIREAT\u547d\u4ee4 b) Redis info\u4e2d\u7684 expired_keys \u6307\u6807\u77ed\u671f\u7a81\u589e \u89e3\u51b3\uff1a a) \u4f18\u5316\u4e1a\u52a1\uff0c\u8fc7\u671f\u589e\u52a0\u968f\u673a\u65f6\u95f4\uff0c\u628a\u65f6\u95f4\u6253\u6563\uff0c\u51cf\u8f7b\u5220\u9664\u8fc7\u671fkey\u7684\u538b\u529b b) \u8fd0\u7ef4\u5c42\u9762\uff0c\u76d1\u63a7 expired_keys \u6307\u6807\uff0c\u6709\u77ed\u671f\u7a81\u589e\u53ca\u65f6\u62a5\u8b66\u6392\u67e5 Redis\u5185\u5b58\u8fbe\u5230maxmemory \u5206\u6790\uff1a a) \u5b9e\u4f8b\u5185\u5b58\u8fbe\u5230maxmemory\uff0c\u4e14\u5199\u5165\u91cf\u5927\uff0c\u6dd8\u6c70key\u538b\u529b\u53d8\u5927 b) Redis info\u4e2d\u7684 evicted_keys \u6307\u6807\u77ed\u671f\u7a81\u589e \u89e3\u51b3\uff1a a) \u4e1a\u52a1\u5c42\u9762\uff0c\u6839\u636e\u60c5\u51b5\u8c03\u6574\u6dd8\u6c70\u7b56\u7565\uff08\u968f\u673a\u6bd4LRU\u5feb\uff09 b) \u8fd0\u7ef4\u5c42\u9762\uff0c\u76d1\u63a7evicted_keys\u6307\u6807\uff0c\u6709\u77ed\u671f\u7a81\u589e\u53ca\u65f6\u62a5\u8b66 c) \u96c6\u7fa4\u6269\u5bb9\uff0c\u591a\u4e2a\u5b9e\u4f8b\u51cf\u8f7b\u6dd8\u6c70key\u7684\u538b\u529b \u5927\u91cf\u77ed\u8fde\u63a5\u8bf7\u6c42 \u5206\u6790\uff1aRedis\u5904\u7406\u5927\u91cf\u77ed\u8fde\u63a5\u8bf7\u6c42\uff0cTCP\u4e09\u6b21\u63e1\u624b\u548c\u56db\u6b21\u6325\u624b\u4e5f\u4f1a\u589e\u52a0\u8017\u65f6 \u89e3\u51b3\uff1a\u4f7f\u7528\u957f\u8fde\u63a5\u64cd\u4f5cRedis \u751f\u6210RDB\u548cAOF\u91cd\u5199fork\u8017\u65f6\u4e25\u91cd \u5206\u6790\uff1a a) Redis\u53d8\u6162\u53ea\u53d1\u751f\u5728\u751f\u6210RDB\u548cAOF\u91cd\u5199\u671f\u95f4 b) \u5b9e\u4f8b\u5360\u7528\u5185\u5b58\u8d8a\u5927\uff0cfork\u62f7\u8d1d\u5185\u5b58\u9875\u8868\u8d8a\u4e45 c) Redis info\u4e2d latest_fork_usec \u8017\u65f6\u53d8\u957f \u89e3\u51b3\uff1a a) \u5b9e\u4f8b\u5c3d\u91cf\u5c0f b) Redis\u5c3d\u91cf\u90e8\u7f72\u5728\u7269\u7406\u673a\u4e0a c) \u4f18\u5316\u5907\u4efd\u7b56\u7565\uff08\u4f8b\u5982\u4f4e\u5cf0\u671f\u5907\u4efd\uff09 d) \u5408\u7406\u914d\u7f6e repl-backlog \u548c slave client-output-buffer-limit \uff0c\u907f\u514d\u4e3b\u4ece\u5168\u91cf\u540c\u6b65 e) \u89c6\u60c5\u51b5\u8003\u8651\u5173\u95edAOF f) \u76d1\u63a7 latest_fork_usec \u8017\u65f6\u662f\u5426\u53d8\u957f AOF\u4f7f\u7528 awalys \u673a\u5236 \u5206\u6790\uff1a\u78c1\u76d8IO\u8d1f\u8f7d\u53d8\u9ad8 \u89e3\u51b3\uff1a a) \u4f7f\u7528everysec\u673a\u5236 b) \u4e22\u5931\u6570\u636e\u4e0d\u654f\u611f\u7684\u4e1a\u52a1\u4e0d\u5f00\u542fAOF \u4f7f\u7528Swap \u5206\u6790\uff1a a) \u6240\u6709\u8bf7\u6c42\u5168\u90e8\u5f00\u59cb\u53d8\u6162 b) slowlog\u5927\u91cf\u6162\u65e5\u5fd7 c) \u67e5\u770bRedis\u8fdb\u7a0b\u662f\u5426\u4f7f\u7528\u5230\u4e86Swap \u89e3\u51b3\uff1a a) \u589e\u52a0\u673a\u5668\u5185\u5b58 b) \u96c6\u7fa4\u6269\u5bb9 c) Swap\u4f7f\u7528\u65f6\u76d1\u63a7\u62a5\u8b66 \u8fdb\u7a0b\u7ed1\u5b9aCPU\u4e0d\u5408\u7406 \u5206\u6790 a) Redis\u8fdb\u7a0b\u53ea\u7ed1\u5b9a\u4e00\u4e2aCPU\u903b\u8f91\u6838 b) NUMA\u67b6\u6784\u4e0b\uff0c\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u548cRedis\u8fdb\u7a0b\u6ca1\u6709\u7ed1\u5b9a\u5728\u540c\u4e00\u4e2aSocket\u4e0b \u89e3\u51b3 a) Redis\u8fdb\u7a0b\u7ed1\u5b9a\u591a\u4e2aCPU\u903b\u8f91\u6838 b) \u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u548cRedis\u8fdb\u7a0b\u7ed1\u5b9a\u5728\u540c\u4e00\u4e2aSocket\u4e0b \u5f00\u542f\u900f\u660e\u5927\u9875\u673a\u5236 \u5206\u6790\uff1a\u751f\u6210RDB\u548cAOF\u91cd\u5199\u671f\u95f4\uff0c\u4e3b\u7ebf\u7a0b\u5904\u7406\u5199\u8bf7\u6c42\u8017\u65f6\u53d8\u957f\uff08\u62f7\u8d1d\u5185\u5b58\u526f\u672c\u8017\u65f6\u53d8\u957f\uff09 \u89e3\u51b3\uff1a\u5173\u95ed\u900f\u660e\u5927\u9875\u673a\u5236 \u7f51\u5361\u8d1f\u8f7d\u8fc7\u9ad8 \u5206\u6790\uff1a a) TCP/IP\u5c42\u5ef6\u8fdf\u53d8\u5927\uff0c\u4e22\u5305\u91cd\u4f20\u53d8\u591a b) \u662f\u5426\u5b58\u5728\u6d41\u91cf\u8fc7\u5927\u7684\u5b9e\u4f8b\u5360\u6ee1\u5e26\u5bbd \u89e3\u51b3\uff1a a) \u673a\u5668\u7f51\u7edc\u8d44\u6e90\u76d1\u63a7\uff0c\u8d1f\u8f7d\u8fc7\u9ad8\u53ca\u65f6\u62a5\u8b66 b) \u63d0\u524d\u89c4\u5212\u90e8\u7f72\u7b56\u7565\uff0c\u8bbf\u95ee\u91cf\u5927\u7684\u5b9e\u4f8b\u9694\u79bb\u90e8\u7f72 \u603b\u4e4b\uff0cRedis\u7684\u6027\u80fd\u4e0eCPU\u3001\u5185\u5b58\u3001\u7f51\u7edc\u3001\u78c1\u76d8\u90fd\u606f\u606f\u76f8\u5173\uff0c\u4efb\u4f55\u4e00\u5904\u53d1\u751f\u95ee\u9898\uff0c\u90fd\u4f1a\u5f71\u54cd\u5230Redis\u7684\u6027\u80fd\u3002 \u8981\u70b9&\u4eae\u70b9 \u901a\u8fc7 redis-cli --intrinsic-latency 120 \u53ef\u4ee5\u5f97\u77e5redis\u7684\u57fa\u51c6\u7ebf\u3002\u540e\u7eed\u53ef\u4ee5\u6839\u636e\u57fa\u51c6\u7ebf\u7684\u54cd\u5e94\u901f\u5ea6\u8fdb\u884c\u5224\u65ad\u662f\u5426\u67e5\u8be2\u6162 \u57fa\u4e8e\u81ea\u5df1\u5bf9 Redis \u672c\u8eab\u7684\u5de5\u4f5c\u539f\u7406\u7684\u7406\u89e3\uff0c\u5e76\u4e14\u7ed3\u5408\u548c\u5b83\u4ea4\u4e92\u7684\u64cd\u4f5c\u7cfb\u7edf\u3001\u5b58\u50a8\u4ee5\u53ca\u7f51\u7edc\u7b49\u5916\u90e8\u7cfb\u7edf\u5173\u952e\u673a\u5236\uff0c\u518d\u501f\u52a9\u4e00\u4e9b\u8f85\u52a9\u5de5\u5177\u6765\u5b9a\u4f4d\u539f\u56e0\uff0c\u5e76\u5236\u5b9a\u884c\u4e4b\u6709\u6548\u7684\u89e3\u51b3\u65b9\u6848 Redis \u81ea\u8eab\u64cd\u4f5c\u7279\u6027\u7684\u5f71\u54cd \u6162\u67e5\u8be2\u547d\u4ee4\uff1a\u547d\u4ee4\u64cd\u4f5c\u7684\u590d\u6742\u5ea6\u6709\u5173 \u6392\u67e5\u65b9\u6cd5\uff1a\u901a\u8fc7 Redis \u65e5\u5fd7\uff0c\u6216\u8005\u662f latency monitor \u5de5\u5177\uff0c\u67e5\u8be2\u53d8\u6162\u7684\u8bf7\u6c42 \u89e3\u51b3\u65b9\u6cd5\uff1a \u7528\u5176\u4ed6\u9ad8\u6548\u547d\u4ee4\u4ee3\u66ff\u3002\u5982\u4e0d\u8981\u4f7f\u7528keys\u67e5\u8be2\u6240\u6709key\uff0c\u53ef\u4ee5\u4f7f\u7528scan\u8fdb\u884c\u67e5\u8be2\uff0c\u4e0d\u4f1a\u963b\u585e\u7ebf\u7a0b \u5f53\u4f60\u9700\u8981\u6267\u884c\u6392\u5e8f\u3001\u4ea4\u96c6\u3001\u5e76\u96c6\u64cd\u4f5c\u65f6\uff0c\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u5b8c\u6210\uff0c\u800c\u4e0d\u8981\u7528 SORT\u3001SUNION\u3001SINTER \u8fd9\u4e9b\u547d\u4ee4\uff0c\u4ee5\u514d\u62d6\u6162 Redis \u5b9e\u4f8b\u3002 \u8fc7\u671f key \u64cd\u4f5c\uff1aredis\u672c\u8eab\u7684\u5185\u5b58\u56de\u6536\u673a\u5236\u4f1a\u9020\u6210redis\u64cd\u4f5c\u963b\u585e\uff0c\u5bfc\u81f4\u6027\u80fd\u53d8\u6162\uff08Redis 4.0 \u540e\u53ef\u4ee5\u7528\u5f02\u6b65\u7ebf\u7a0b\u673a\u5236\u6765\u51cf\u5c11\u963b\u585e\u5f71\u54cd\uff09 \u5bfc\u81f4\u539f\u56e0\uff1a\u5927\u6279\u91cf\u7684key\u540c\u65f6\u95f4\u5185\u8fc7\u671f\uff0c\u5bfc\u81f4\u5220\u9664\u8fc7\u671fkey\u7684\u673a\u5236\u4e00\u76f4\u89e6\u53d1\uff0c\u5f15\u8d77redis\u64cd\u4f5c\u963b\u585e \u89e3\u51b3\u65b9\u6cd5\uff1a\u5bf9key\u8bbe\u5b9a\u8fc7\u671f\u65f6\u95f4\u65f6\uff0c\u6dfb\u52a0\u4e00\u4e2a\u5220\u9664\u7684\u65f6\u95f4\u968f\u673a\u6570\uff0c\u80fd\u907f\u514dkey\u5b58\u5728\u540c\u4e00\u65f6\u95f4\u8fc7\u671f redis\u5220\u9664\u8fc7\u671fkey\u7684\u673a\u5236\uff0c\u6bcf100\u6beb\u79d2\u5bf9\u4e00\u4e9bkey\u8fdb\u884c\u5220\u9664\u3002\u7b97\u6cd5\u5982\u4e0b \u91c7\u6837 ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP \u4e2a\u6570\u7684 key\uff0c\u5e76\u5c06\u5176\u4e2d\u8fc7\u671f\u7684 key \u5168\u90e8\u5220\u9664\uff1b \u679c\u8d85\u8fc7 25% \u7684 key \u8fc7\u671f\u4e86\uff0c\u5219\u91cd\u590d\u5220\u9664\u7684\u8fc7\u7a0b\uff0c\u76f4\u5230\u8fc7\u671f key \u7684\u6bd4\u4f8b\u964d\u81f3 25% \u4ee5\u4e0b\u3002 4\u3001 \u5220\u9664\u6570\u636e\u540e\uff0c\u5185\u5b58\u5360\u7528\u7387\u8fd8\u662f\u5f88\u9ad8 Redis \u7684\u5185\u5b58\u7a7a\u95f4\u6548\u7387\u95ee\u9898 info memory \u547d\u4ee4\u662f\u4e00\u4e2a\u597d\u5de5\u5177\uff0c\u53ef\u4ee5\u5e2e\u52a9\u4f60\u67e5\u770b\u788e\u7247\u7387\u7684\u60c5\u51b5\uff1b \u788e\u7247\u7387\u9608\u503c\u662f\u4e00\u4e2a\u597d\u7ecf\u9a8c \uff0c\u53ef\u4ee5\u5e2e\u5fd9\u4f60\u6709\u6548\u5730\u5224\u65ad\u662f\u5426\u8981\u8fdb\u884c\u788e\u7247\u6e05\u7406\u4e86\uff1b \u5185\u5b58\u788e\u7247\u81ea\u52a8\u6e05\u7406\u662f\u4e00\u4e2a\u597d\u65b9\u6cd5 \uff0c\u53ef\u4ee5\u907f\u514d\u56e0\u4e3a\u788e\u7247\u5bfc\u81f4 Redis \u7684\u5185\u5b58\u5b9e\u9645\u5229\u7528\u7387\u964d\u4f4e\uff0c\u63d0\u5347\u6210\u672c\u6536\u76ca\u7387\u3002 \u5185\u5b58\u788e\u7247\u81ea\u52a8\u6e05\u7406\u6d89\u53ca\u5185\u5b58\u62f7\u8d1d\uff0c\u8fd9\u5bf9 Redis \u800c\u8a00\uff0c\u662f\u4e2a\u6f5c\u5728\u7684\u98ce\u9669\u3002\u5982\u679c\u4f60\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\u9047\u5230 Redis \u6027\u80fd\u53d8\u6162\uff0c\u8bb0\u5f97\u901a\u8fc7\u65e5\u5fd7\u770b\u4e0b\u662f\u5426\u6b63\u5728\u8fdb\u884c\u788e\u7247\u6e05\u7406\u3002 \u5982\u679c Redis \u7684\u786e\u6b63\u5728\u6e05\u7406\u788e\u7247\uff0c\u90a3\u4e48\uff0c\u6211\u5efa\u8bae\u4f60\u8c03\u5c0f active-defrag-cycle-max \u7684\u503c\uff0c\u4ee5\u51cf\u8f7b\u5bf9\u6b63\u5e38\u8bf7\u6c42\u5904\u7406\u7684\u5f71\u54cd\u3002 5\u3001Redis\u7f13\u51b2\u533a \u4f7f\u7528\u7f13\u51b2\u533a\u4ee5\u540e\uff0c\u5f53\u547d\u4ee4\u6570\u636e\u7684\u63a5\u6536\u65b9\u5904\u7406\u901f\u5ea6\u8ddf\u4e0d\u4e0a\u53d1\u9001\u65b9\u7684\u53d1\u9001\u901f\u5ea6\u65f6\uff0c\u7f13\u51b2\u533a\u53ef\u4ee5\u907f\u514d\u547d\u4ee4\u6570\u636e\u7684\u4e22\u5931\u3002 \u6309\u7167\u7f13\u51b2\u533a\u7684\u7528\u9014\uff0c\u4f8b\u5982\u662f\u7528\u4e8e\u5ba2\u6237\u7aef\u901a\u4fe1\u8fd8\u662f\u7528\u4e8e\u4e3b\u4ece\u8282\u70b9\u590d\u5236\uff0c\u6211\u628a\u7f13\u51b2\u533a\u5206\u6210\u4e86 \u5ba2\u6237\u7aef\u7684\u8f93\u5165 \u5ba2\u6237\u7aef\u8f93\u51fa\u7f13\u51b2\u533a \u4e3b\u4ece\u96c6\u7fa4\u4e2d\u4e3b\u8282\u70b9\u4e0a\u7684\u590d\u5236\u7f13\u51b2\u533a \u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a \u73b0\u5728\uff0c\u4ece\u7f13\u51b2\u533a\u6ea2\u51fa\u5bf9 Redis \u7684\u5f71\u54cd\u7684\u89d2\u5ea6\uff0c\u6211\u518d\u628a\u8fd9\u56db\u4e2a\u7f13\u51b2\u533a\u5206\u6210\u4e24\u7c7b\u505a\u4e2a\u603b\u7ed3\u3002 \u7f13\u51b2\u533a\u6ea2\u51fa\u5bfc\u81f4\u7f51\u7edc\u8fde\u63a5\u5173\u95ed\uff1a\u666e\u901a\u5ba2\u6237\u7aef\u3001\u8ba2\u9605\u5ba2\u6237\u7aef\uff0c\u4ee5\u53ca\u4ece\u8282\u70b9\u5ba2\u6237\u7aef\uff0c\u5b83\u4eec\u4f7f\u7528\u7684\u7f13\u51b2\u533a\uff0c\u672c\u8d28\u4e0a\u90fd\u662f Redis \u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u4e4b\u95f4\uff0c\u6216\u662f\u4e3b\u4ece\u8282\u70b9\u4e4b\u95f4\u4e3a\u4e86\u4f20\u8f93\u547d\u4ee4\u6570\u636e\u800c\u7ef4\u62a4\u7684\u3002\u8fd9\u4e9b\u7f13\u51b2\u533a\u4e00\u65e6\u53d1\u751f\u6ea2\u51fa\uff0c\u5904\u7406\u673a\u5236\u90fd\u662f\u76f4\u63a5\u628a\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u7684\u8fde\u63a5\uff0c\u6216\u662f\u4e3b\u4ece\u8282\u70b9\u95f4\u7684\u8fde\u63a5\u5173\u95ed\u3002\u7f51\u7edc\u8fde\u63a5\u5173\u95ed\u9020\u6210\u7684\u76f4\u63a5\u5f71\u54cd\uff0c\u5c31\u662f\u4e1a\u52a1\u7a0b\u5e8f\u65e0\u6cd5\u8bfb\u5199 Redis\uff0c\u6216\u8005\u662f\u4e3b\u4ece\u8282\u70b9\u5168\u91cf\u540c\u6b65\u5931\u8d25\uff0c\u9700\u8981\u91cd\u65b0\u6267\u884c\u3002 \u7f13\u51b2\u533a\u6ea2\u51fa\u5bfc\u81f4\u547d\u4ee4\u6570\u636e\u4e22\u5931\uff1a\u4e3b\u8282\u70b9\u4e0a\u7684\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u5c5e\u4e8e\u73af\u5f62\u7f13\u51b2\u533a\uff0c\u4e00\u65e6\u53d1\u751f\u6ea2\u51fa\uff0c\u65b0\u5199\u5165\u7684\u547d\u4ee4\u6570\u636e\u5c31\u4f1a\u8986\u76d6\u65e7\u7684\u547d\u4ee4\u6570\u636e\uff0c\u5bfc\u81f4\u65e7\u547d\u4ee4\u6570\u636e\u7684\u4e22\u5931\uff0c\u8fdb\u800c\u5bfc\u81f4\u4e3b\u4ece\u8282\u70b9\u91cd\u65b0\u8fdb\u884c\u5168\u91cf\u590d\u5236\u3002 \u4ece\u672c\u8d28\u4e0a\u770b\uff0c\u7f13\u51b2\u533a\u6ea2\u51fa\uff0c\u65e0\u975e\u5c31\u662f\u4e09\u4e2a\u539f\u56e0\uff1a \u547d\u4ee4\u6570\u636e\u53d1\u9001\u8fc7\u5feb\u8fc7\u5927\uff1b \u547d\u4ee4\u6570\u636e\u5904\u7406\u8f83\u6162\uff1b \u7f13\u51b2\u533a\u7a7a\u95f4\u8fc7\u5c0f\u3002 \u660e\u767d\u4e86\u8fd9\u4e2a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6709\u9488\u5bf9\u6027\u5730\u62ff\u51fa\u5e94\u5bf9\u7b56\u7565\u4e86\u3002 \u9488\u5bf9\u547d\u4ee4\u6570\u636e\u53d1\u9001\u8fc7\u5feb\u8fc7\u5927\u7684\u95ee\u9898\uff0c\u5bf9\u4e8e\u666e\u901a\u5ba2\u6237\u7aef\u6765\u8bf4\u53ef\u4ee5\u907f\u514d bigkey\uff0c\u800c\u5bf9\u4e8e\u590d\u5236\u7f13\u51b2\u533a\u6765\u8bf4\uff0c\u5c31\u662f\u907f\u514d\u8fc7\u5927\u7684 RDB \u6587\u4ef6\u3002 \u9488\u5bf9\u547d\u4ee4\u6570\u636e\u5904\u7406\u8f83\u6162\u7684\u95ee\u9898\uff0c\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u51cf\u5c11 Redis \u4e3b\u7ebf\u7a0b\u4e0a\u7684\u963b\u585e\u64cd\u4f5c\uff0c\u4f8b\u5982\u4f7f\u7528\u5f02\u6b65\u7684\u5220\u9664\u64cd\u4f5c\u3002 \u9488\u5bf9\u7f13\u51b2\u533a\u7a7a\u95f4\u8fc7\u5c0f\u7684\u95ee\u9898\uff0c\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u4f7f\u7528 client-output-buffer-limit \u914d\u7f6e\u9879\u8bbe\u7f6e\u5408\u7406\u7684\u8f93\u51fa\u7f13\u51b2\u533a\u3001\u590d\u5236\u7f13\u51b2\u533a\u548c\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u5927\u5c0f \u3002\u5f53\u7136\uff0c\u6211\u4eec\u4e0d\u8981\u5fd8\u4e86\uff0c\u8f93\u5165\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u9ed8\u8ba4\u662f\u56fa\u5b9a\u7684\uff0c\u6211\u4eec\u65e0\u6cd5\u901a\u8fc7\u914d\u7f6e\u6765\u4fee\u6539\u5b83\uff0c\u9664\u975e\u76f4\u63a5\u53bb\u4fee\u6539 Redis \u6e90\u7801\u3002 2\u3001\u672c\u7ae0\u64cd\u4f5c\u603b\u7ed3 2-1 \u5f02\u6b65\u7684\u5b50\u7ebf\u7a0b\u673a\u5236 \u952e\u503c\u5bf9\u5220\u9664 \uff1a\u5f53\u4f60\u7684\u96c6\u5408\u7c7b\u578b\u4e2d\u6709\u5927\u91cf\u5143\u7d20\uff08\u4f8b\u5982\u6709\u767e\u4e07\u7ea7\u522b\u6216\u5343\u4e07\u7ea7\u522b\u5143\u7d20\uff09\u9700\u8981\u5220\u9664\u65f6\uff0c\u6211\u5efa\u8bae\u4f60\u4f7f\u7528 UNLINK \u547d\u4ee4: UNLINK \u6e05\u7a7a\u6570\u636e\u5e93 \uff1a\u53ef\u4ee5\u5728 FLUSHDB \u548c FLUSHALL \u547d\u4ee4\u540e\u52a0\u4e0a ASYNC \u9009\u9879\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8ba9\u540e\u53f0\u5b50\u7ebf\u7a0b\u5f02\u6b65\u5730\u6e05\u7a7a\u6570\u636e\u5e93\uff0c\u5982\u4e0b\u6240\u793a\uff1a FLUSHDB ASYNC FLUSHALL AYSNC 2-2 CPU \u73af\u5883\u4e0b\u5bf9 Redis \u6027\u80fd\u8fdb\u884c\u8c03\u4f18 taskset \u547d\u4ee4\u628a\u4e00\u4e2a\u7a0b\u5e8f\u7ed1\u5b9a\u5728\u4e00\u4e2a\u6838\u4e0a\u8fd0\u884c\u3002 taskset -c 0 ./redis-server \u7ed1\u5b9a\u4ee5\u540e\uff0c\u6211\u4eec\u8fdb\u884c\u4e86\u6d4b\u8bd5\u3002\u6211\u4eec\u53d1\u73b0\uff0c Redis \u5b9e\u4f8b\u7684 GET \u548c PUT \u7684 99% \u5c3e\u5ef6\u8fdf\u4e00\u4e0b\u5b50\u5c31\u5206\u522b\u964d\u5230\u4e86 260 \u5fae\u79d2\u548c 482 \u5fae\u79d2 \uff0c\u8fbe\u5230\u4e86\u6211\u4eec\u671f\u671b\u7684\u76ee\u6807\u3002 CPU \u7684 NUMA \u67b6\u6784\u5bf9 Redis \u6027\u80fd\u7684\u5f71\u54cd \u5047\u8bbe\u6709 2 \u4e2a CPU Socket\uff0c\u6bcf\u4e2a Socket \u4e0a\u6709 6 \u4e2a\u7269\u7406\u6838\uff0c\u6bcf\u4e2a\u7269\u7406\u6838\u53c8\u6709 2 \u4e2a\u903b\u8f91\u6838\uff0c\u603b\u5171 24 \u4e2a\u903b\u8f91\u6838\u3002 \u6211\u4eec\u53ef\u4ee5\u6267\u884c lscpu \u547d\u4ee4 \uff0c\u67e5\u770b\u5230\u8fd9\u4e9b\u6838\u7684\u7f16\u53f7\uff1a lscpu Architecture: x86_64 ... NUMA node0 CPU(s): 0-5,12-17 NUMA node1 CPU(s): 6-11,18-23 NUMA node0 \u7684 CPU \u6838\u7f16\u53f7\u662f 0 \u5230 5\u300112 \u5230 17\u3002 \u5176\u4e2d\uff0c0 \u5230 5 \u662f node0 \u4e0a\u7684 6 \u4e2a\u7269\u7406\u6838\u4e2d\u7684\u7b2c\u4e00\u4e2a\u903b\u8f91\u6838\u7684\u7f16\u53f7\uff0c12 \u5230 17 \u662f\u76f8\u5e94\u7269\u7406\u6838\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u903b\u8f91\u6838\u7f16\u53f7\u3002 taskset -c 0,12 ./redis-server 2-3 redis\u67e5\u8be2 \u57fa\u4e8e\u5f53\u524d\u73af\u5883\u4e0b\u7684 Redis \u57fa\u7ebf\u6027\u80fd\u505a\u5224\u65ad \u5b9e\u9645\u4e0a\uff0c\u4ece 2.8.7 \u7248\u672c\u5f00\u59cb\uff0c redis-cli \u547d\u4ee4\u63d0\u4f9b\u4e86 \u2013intrinsic-latency \u9009\u9879\uff0c\u53ef\u4ee5\u7528\u6765\u76d1\u6d4b\u548c\u7edf\u8ba1\u6d4b\u8bd5\u671f\u95f4\u5185\u7684\u6700\u5927\u5ef6\u8fdf\uff0c\u8fd9\u4e2a\u5ef6\u8fdf\u53ef\u4ee5\u4f5c\u4e3a Redis \u7684\u57fa\u7ebf\u6027\u80fd\u3002\u5176\u4e2d\uff0c\u6d4b\u8bd5\u65f6\u957f\u53ef\u4ee5\u7528 \u2013intrinsic-latency \u9009\u9879\u7684\u53c2\u6570\u6765\u6307\u5b9a\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u8fd0\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u8be5\u547d\u4ee4\u4f1a\u6253\u5370 120 \u79d2\u5185\u76d1\u6d4b\u5230\u7684\u6700\u5927\u5ef6\u8fdf\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u7684\u6700\u5927\u5ef6\u8fdf\u662f 119 \u5fae\u79d2\uff0c\u4e5f\u5c31\u662f\u57fa\u7ebf\u6027\u80fd\u4e3a 119 \u5fae\u79d2\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd0\u884c 120 \u79d2\u5c31\u8db3\u591f\u76d1\u6d4b\u5230\u6700\u5927\u5ef6\u8fdf\u4e86\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u53c2\u6570\u8bbe\u7f6e\u4e3a 120\u3002 ./redis-cli --intrinsic-latency 120 Max latency so far: 17 microseconds. Max latency so far: 44 microseconds. Max latency so far: 94 microseconds. Max latency so far: 110 microseconds. Max latency so far: 119 microseconds. 36481658 total runs (avg latency: 3.2893 microseconds / 3289.32 nanoseconds per run). Worst \u4e0b\u9762\u7684\u6d4b\u8bd5\u7ed3\u679c\uff0c\u663e\u793a\u7684\u5c31\u662f\u67d0\u4e00\u4e2a\u865a\u62df\u673a\u4e0a\u8fd0\u884c Redis \u65f6\u6d4b\u7684\u57fa\u7ebf\u6027\u80fd\u3002 $ ./redis-cli --intrinsic-latency 120 Max latency so far: 692 microseconds. Max latency so far: 915 microseconds. Max latency so far: 2193 microseconds. Max latency so far: 9343 microseconds. Max latency so far: 9871 microseconds. \u53ef\u4ee5\u770b\u5230\uff0c\u7531\u4e8e\u865a\u62df\u5316\u8f6f\u4ef6\u672c\u8eab\u7684\u5f00\u9500\uff0c\u6b64\u65f6\u7684\u57fa\u7ebf\u6027\u80fd\u5df2\u7ecf\u8fbe\u5230\u4e86 9.871ms\u3002 \u5982\u679c\u8be5 Redis \u5b9e\u4f8b\u7684\u8fd0\u884c\u65f6\u5ef6\u8fdf\u4e3a 10ms\uff0c\u8fd9\u5e76\u4e0d\u80fd\u7b97\u4f5c\u6027\u80fd\u53d8\u6162\uff0c\u56e0\u4e3a\u6b64\u65f6\uff0c\u8fd0\u884c\u65f6\u5ef6\u8fdf\u53ea\u6bd4\u57fa\u7ebf\u6027\u80fd\u589e\u52a0\u4e86 1.3%\u3002 \u5982\u679c\u4f60\u4e0d\u4e86\u89e3\u57fa\u7ebf\u6027\u80fd\uff0c\u4e00\u770b\u5230\u8f83\u9ad8\u7684\u8fd0\u884c\u65f6\u5ef6\u8fdf\uff0c\u5c31\u5f88\u6709\u53ef\u80fd\u8bef\u5224 Redis \u53d8\u6162\u4e86\u3002 \u6162\u67e5\u8be2\u547d\u4ee4 \u7528\u5176\u4ed6\u9ad8\u6548\u547d\u4ee4\u4ee3\u66ff\u3002\u6bd4\u5982\u8bf4\uff0c\u5982\u679c\u4f60\u9700\u8981\u8fd4\u56de\u4e00\u4e2a SET \u4e2d\u7684\u6240\u6709\u6210\u5458\u65f6\uff0c \u4e0d\u8981\u4f7f\u7528 SMEMBERS \u547d\u4ee4\uff0c\u800c\u662f\u8981\u4f7f\u7528 SSCAN \u591a\u6b21\u8fed\u4ee3\u8fd4\u56de \uff0c\u907f\u514d\u4e00\u6b21\u8fd4\u56de\u5927\u91cf\u6570\u636e\uff0c\u9020\u6210\u7ebf\u7a0b\u963b\u585e\u3002 \u5f53\u4f60\u9700\u8981\u6267\u884c\u6392\u5e8f\u3001\u4ea4\u96c6\u3001\u5e76\u96c6\u64cd\u4f5c\u65f6\uff0c\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u5b8c\u6210\uff0c\u800c\u4e0d\u8981\u7528 SORT\u3001SUNION\u3001SINTER \u8fd9\u4e9b\u547d\u4ee4\uff0c\u4ee5\u514d\u62d6\u6162 Redis \u5b9e\u4f8b\u3002 \u8fd8\u6709\u4e00\u4e2a\u6bd4\u8f83\u5bb9\u6613\u5ffd\u7565\u7684\u6162\u67e5\u8be2\u547d\u4ee4\uff0c\u5c31\u662f KEYS \u3002 \u5b83\u7528\u4e8e\u8fd4\u56de\u548c\u8f93\u5165\u6a21\u5f0f\u5339\u914d\u7684\u6240\u6709 key\uff0c\u4f8b\u5982\uff0c\u4ee5\u4e0b\u547d\u4ee4\u8fd4\u56de\u6240\u6709\u5305\u542b\u201cname\u201d\u5b57\u7b26\u4e32\u7684 keys\u3002 redis> KEYS *name* 1) \"lastname\" 2) \"firstname\" \u6240\u4ee5\uff0cKEYS \u547d\u4ee4\u4e00\u822c\u4e0d\u88ab\u5efa\u8bae\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u4e2d AOF \u91cd\u5199 \u5728\u4f7f\u7528 AOF \u65e5\u5fd7\u65f6\uff0c\u4e3a\u4e86\u907f\u514d\u65e5\u5fd7\u6587\u4ef6\u4e0d\u65ad\u589e\u5927\uff0cRedis \u4f1a\u6267\u884c AOF \u91cd\u5199\uff0c\u751f\u6210\u4f53\u91cf\u7f29\u5c0f\u7684\u65b0\u7684 AOF \u65e5\u5fd7\u6587\u4ef6\u3002 \u5982\u679c AOF \u5199\u56de\u7b56\u7565\u4f7f\u7528\u4e86 everysec \u6216 always \u914d\u7f6e\uff0c\u8bf7\u5148\u786e\u8ba4\u4e0b\u4e1a\u52a1\u65b9\u5bf9\u6570\u636e\u53ef\u9760\u6027\u7684\u8981\u6c42\uff0c\u660e\u786e\u662f\u5426\u9700\u8981\u6bcf\u4e00\u79d2\u6216\u6bcf\u4e00\u4e2a\u64cd\u4f5c\u90fd\u8bb0\u65e5\u5fd7\u3002 \u5982\u679c\u4e1a\u52a1\u5e94\u7528\u5bf9\u5ef6\u8fdf\u975e\u5e38\u654f\u611f\uff0c\u4f46\u540c\u65f6\u5141\u8bb8\u4e00\u5b9a\u91cf\u7684\u6570\u636e\u4e22\u5931\uff0c\u90a3\u4e48\uff0c\u53ef\u4ee5\u628a\u914d\u7f6e\u9879 no-appendfsync-on-rewrite \u8bbe\u7f6e\u4e3a yes \uff0c\u5982\u4e0b\u6240\u793a\uff1a no-appendfsync-on-rewrite yes \u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a yes \u65f6\uff0c\u8868\u793a\u5728 AOF \u91cd\u5199\u65f6\uff0c\u4e0d\u8fdb\u884c fsync \u64cd\u4f5c\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cRedis \u5b9e\u4f8b\u628a\u5199\u547d\u4ee4\u5199\u5230\u5185\u5b58\u540e\uff0c\u4e0d\u8c03\u7528\u540e\u53f0\u7ebf\u7a0b\u8fdb\u884c fsync \u64cd\u4f5c\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de\u4e86\u3002 \u5f53\u7136\uff0c\u5982\u679c\u6b64\u65f6\u5b9e\u4f8b\u53d1\u751f\u5b95\u673a\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u3002\u53cd\u4e4b\uff0c\u5982\u679c\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a no\uff08\u4e5f\u662f\u9ed8\u8ba4\u914d\u7f6e\uff09\uff0c\u5728 AOF \u91cd\u5199\u65f6\uff0cRedis \u5b9e\u4f8b\u4ecd\u7136\u4f1a\u8c03\u7528\u540e\u53f0\u7ebf\u7a0b\u8fdb\u884c fsync \u64cd\u4f5c\uff0c\u8fd9\u5c31\u4f1a\u7ed9\u5b9e\u4f8b\u5e26\u6765\u963b\u585e\u3002 swap \u800c\u5bfc\u81f4\u6027\u80fd\u964d\u4f4e \u64cd\u4f5c\u7cfb\u7edf\u672c\u8eab\u4f1a\u5728\u540e\u53f0\u8bb0\u5f55\u6bcf\u4e2a\u8fdb\u7a0b\u7684 swap \u4f7f\u7528\u60c5\u51b5\uff0c\u5373\u6709\u591a\u5c11\u6570\u636e\u91cf\u53d1\u751f\u4e86 swap\u3002 $ redis-cli info | grep process_id process_id: 5332 $ cd /proc/5332 $cat smaps | egrep '^(Swap|Size)' Size: 584 kB Swap: 0 kB Size: 4 kB Swap: 4 kB Size: 4 kB Swap: 0 kB Size: 462044 kB Swap: 462008 kB Size: 21392 kB Swap: 0 kB \u5173\u95ed\u5185\u5b58\u5927\u9875 cat /sys/kernel/mm/transparent_hugepage/enabled echo never > /sys/kernel/mm/transparent_hugepage/enabled 2-4 Redis \u5185\u5b58\u788e\u7247 \u5982\u4f55\u5224\u65ad\u662f\u5426\u6709\u5185\u5b58\u788e\u7247 INFO memory # Memory used_memory:1073741736 used_memory_human:1024.00M used_memory_rss:1997159792 used_memory_rss_human:1.86G \u2026 mem_fragmentation_ratio:1.86 \u8fd9\u91cc\u6709\u4e00\u4e2a mem_fragmentation_ratio \u7684\u6307\u6807\uff0c\u5b83\u8868\u793a\u7684\u5c31\u662f Redis \u5f53\u524d\u7684\u5185\u5b58\u788e\u7247\u7387\u3002 \u90a3\u4e48\uff0c\u8fd9\u4e2a\u788e\u7247\u7387\u662f\u600e\u4e48\u8ba1\u7b97\u7684\u5462\uff1f\u5176\u5b9e\uff0c\u5c31\u662f\u4e0a\u9762\u7684\u547d\u4ee4\u4e2d\u7684\u4e24\u4e2a\u6307\u6807 used_memory_rss \u548c used_memory \u76f8\u9664\u7684\u7ed3\u679c\u3002 mem_fragmentation_ratio = used_memory_rss/ used_memory mem_fragmentation_ratio \u5927\u4e8e 1.5 \u3002\u8fd9\u8868\u660e\u5185\u5b58\u788e\u7247\u7387\u5df2\u7ecf\u8d85\u8fc7\u4e86 50%\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u9700\u8981\u91c7\u53d6\u4e00\u4e9b\u63aa\u65bd\u6765\u964d\u4f4e\u5185\u5b58\u788e\u7247\u7387\u4e86\u3002 Redis \u4e13\u95e8\u4e3a\u81ea\u52a8\u5185\u5b58\u788e\u7247\u6e05\u7406 \u9996\u5148\uff0cRedis \u9700\u8981\u542f\u7528\u81ea\u52a8\u5185\u5b58\u788e\u7247\u6e05\u7406\uff0c\u53ef\u4ee5\u628a activedefrag \u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a yes \uff0c\u547d\u4ee4\u5982\u4e0b\uff1a config set activedefrag yes \u89e6\u53d1\u5185\u5b58\u6e05\u7406\u6761\u4ef6: \u8fd9\u4e24\u4e2a\u53c2\u6570\u5206\u522b\u8bbe\u7f6e\u4e86\u89e6\u53d1\u5185\u5b58\u6e05\u7406\u7684\u4e00\u4e2a\u6761\u4ef6\uff0c\u5982\u679c\u540c\u65f6\u6ee1\u8db3\u8fd9\u4e24\u4e2a\u6761\u4ef6\uff0c\u5c31\u5f00\u59cb\u6e05\u7406\u3002\u5728\u6e05\u7406\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53ea\u8981\u6709\u4e00\u4e2a\u6761\u4ef6\u4e0d\u6ee1\u8db3\u4e86\uff0c\u5c31\u505c\u6b62\u81ea\u52a8\u6e05\u7406\u3002 active-defrag-ignore-bytes 100mb \uff1a\u8868\u793a\u5185\u5b58\u788e\u7247\u7684\u5b57\u8282\u6570\u8fbe\u5230 100MB \u65f6\uff0c\u5f00\u59cb\u6e05\u7406\uff1b active-defrag-threshold-lower 10 \uff1a\u8868\u793a\u5185\u5b58\u788e\u7247\u7a7a\u95f4\u5360\u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u7ed9 Redis \u7684\u603b\u7a7a\u95f4\u6bd4\u4f8b\u8fbe\u5230 10% \u65f6\uff0c\u5f00\u59cb\u6e05\u7406\u3002 \u51cf\u5c11\u788e\u7247\u6e05\u7406\u5f71\u54cd: active-defrag-cycle-min 25 \uff1a \u8868\u793a\u81ea\u52a8\u6e05\u7406\u8fc7\u7a0b\u6240\u7528 CPU \u65f6\u95f4\u7684\u6bd4\u4f8b\u4e0d\u4f4e\u4e8e 25%\uff0c\u4fdd\u8bc1\u6e05\u7406\u80fd\u6b63\u5e38\u5f00\u5c55\uff1b active-defrag-cycle-max 75 \uff1a\u8868\u793a\u81ea\u52a8\u6e05\u7406\u8fc7\u7a0b\u6240\u7528 CPU \u65f6\u95f4\u7684\u6bd4\u4f8b\u4e0d\u9ad8\u4e8e 75%\uff0c\u4e00\u65e6\u8d85\u8fc7\uff0c\u5c31\u505c\u6b62\u6e05\u7406\uff0c\u4ece\u800c\u907f\u514d\u5728\u6e05\u7406\u65f6\uff0c\u5927\u91cf\u7684\u5185\u5b58\u62f7\u8d1d\u963b\u585e Redis\uff0c\u5bfc\u81f4\u54cd\u5e94\u5ef6\u8fdf\u5347\u9ad8\u3002 2-5 \u7f13\u51b2\u533a\u6ea2\u51fa \u8981\u67e5\u770b\u548c\u670d\u52a1\u5668\u7aef\u76f8\u8fde\u7684\u6bcf\u4e2a\u5ba2\u6237\u7aef\u5bf9\u8f93\u5165\u7f13\u51b2\u533a\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 CLIENT LIST \u547d\u4ee4\uff1a CLIENT LIST id=5 addr=127.0.0.1:50487 fd=9 name= age=4 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=26 qbuf-free=32742 obl=0 oll=0 omem=0 events=r cmd=client CLIENT \u547d\u4ee4\u8fd4\u56de\u7684\u4fe1\u606f\u867d\u7136\u5f88\u591a\uff0c\u4f46\u6211\u4eec\u53ea\u9700\u8981\u91cd\u70b9\u5173\u6ce8\u4e24\u7c7b\u4fe1\u606f\u5c31\u53ef\u4ee5\u4e86\u3002 \u4e00\u7c7b\u662f\u4e0e\u670d\u52a1\u5668\u7aef\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u7684\u4fe1\u606f\u3002 \u8fd9\u4e2a\u6848\u4f8b\u5c55\u793a\u7684\u662f\u4e00\u4e2a\u5ba2\u6237\u7aef\u7684\u8f93\u5165\u7f13\u51b2\u533a\u60c5\u51b5\uff0c\u5982\u679c\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\uff0c\u8f93\u51fa\u7ed3\u679c\u4e2d\u7684 addr \u4f1a\u663e\u793a\u4e0d\u540c\u5ba2\u6237\u7aef\u7684 IP \u548c\u7aef\u53e3\u53f7\u3002 \u53e6\u4e00\u7c7b\u662f\u4e0e\u8f93\u5165\u7f13\u51b2\u533a\u76f8\u5173\u7684\u4e09\u4e2a\u53c2\u6570\uff1a cmd \uff0c \u8868\u793a\u5ba2\u6237\u7aef\u6700\u65b0\u6267\u884c\u7684\u547d\u4ee4 \u3002\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u6267\u884c\u7684\u662f CLIENT \u547d\u4ee4\u3002 qbuf \uff0c \u8868\u793a\u8f93\u5165\u7f13\u51b2\u533a\u5df2\u7ecf\u4f7f\u7528\u7684\u5927\u5c0f \u3002\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u7684 CLIENT \u547d\u4ee4\u5df2\u4f7f\u7528\u4e86 26 \u5b57\u8282\u5927\u5c0f\u7684\u7f13\u51b2\u533a\u3002 qbuf-free \uff0c\u8868\u793a\u8f93\u5165\u7f13\u51b2\u533a\u5c1a\u672a\u4f7f\u7528\u7684\u5927\u5c0f \u3002\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u7684 CLIENT \u547d\u4ee4\u8fd8\u53ef\u4ee5\u4f7f\u7528 32742 \u5b57\u8282\u7684\u7f13\u51b2\u533a\u3002 qbuf \u548c qbuf-free \u7684\u603b\u548c\u5c31\u662f\uff0cRedis \u670d\u52a1\u5668\u7aef\u5f53\u524d\u4e3a\u5df2\u8fde\u63a5\u7684\u8fd9\u4e2a\u5ba2\u6237\u7aef\u5206\u914d\u7684\u7f13\u51b2\u533a\u603b\u5927\u5c0f\u3002\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u603b\u5171\u5206\u914d\u4e86 26 + 32742 = 32768 \u5b57\u8282\uff0c\u4e5f\u5c31\u662f 32KB \u7684\u7f13\u51b2\u533a\u3002 MONITOR \u547d\u4ee4\u662f\u7528\u6765\u76d1\u6d4b Redis \u6267\u884c\u7684\u3002 \u6267\u884c\u8fd9\u4e2a\u547d\u4ee4\u4e4b\u540e\uff0c\u5c31\u4f1a\u6301\u7eed\u8f93\u51fa\u76d1\u6d4b\u5230\u7684\u5404\u4e2a\u547d\u4ee4\u64cd\u4f5c\uff0c\u5982\u4e0b\u6240\u793a\uff1a MONITOR OK 1600617456.437129 [0 127.0.0.1:50487] \"COMMAND\" 1600617477.289667 [0 127.0.0.1:50487] \"info\" \"memory\" MONITOR \u7684\u8f93\u51fa\u7ed3\u679c\u4f1a\u6301\u7eed\u5360\u7528\u8f93\u51fa\u7f13\u51b2\u533a\uff0c\u5e76\u8d8a\u5360\u8d8a\u591a\uff0c\u6700\u540e\u7684\u7ed3\u679c\u5c31\u662f\u53d1\u751f\u6ea2\u51fa\u3002 \u6211\u8981\u7ed9\u4f60\u4e00\u4e2a\u5c0f\u5efa\u8bae\uff1a MONITOR \u547d\u4ee4\u4e3b\u8981\u7528\u5728\u8c03\u8bd5\u73af\u5883\u4e2d\uff0c\u4e0d\u8981\u5728\u7ebf\u4e0a\u751f\u4ea7\u73af\u5883\u4e2d\u6301\u7eed\u4f7f\u7528 MONITOR\u3002 \u5982\u679c\u5728\u7ebf\u4e0a\u73af\u5883\u4e2d\u5076\u5c14\u4f7f\u7528 MONITOR \u68c0\u67e5 Redis \u7684\u547d\u4ee4\u6267\u884c\u60c5\u51b5\uff0c\u662f\u6ca1\u95ee\u9898\u7684\u3002 \u5f53\u6211\u4eec\u7ed9\u666e\u901a\u5ba2\u6237\u7aef\u8bbe\u7f6e\u7f13\u51b2\u533a\u5927\u5c0f\u65f6\uff0c\u901a\u5e38\u53ef\u4ee5\u5728 Redis \u914d\u7f6e\u6587\u4ef6\u4e2d\u8fdb\u884c\u8fd9\u6837\u7684\u8bbe\u7f6e\uff1a client-output-buffer-limit normal 0 0 0 \u5176\u4e2d\uff0cnormal \u8868\u793a\u5f53\u524d\u8bbe\u7f6e\u7684\u662f\u666e\u901a\u5ba2\u6237\u7aef\uff0c \u7b2c 1 \u4e2a 0 \u8bbe\u7f6e\u7684\u662f\u7f13\u51b2\u533a\u5927\u5c0f\u9650\u5236\uff0c\u7b2c 2 \u4e2a 0 \u548c\u7b2c 3 \u4e2a 0 \u5206\u522b\u8868\u793a\u7f13\u51b2\u533a\u6301\u7eed\u5199\u5165\u91cf\u9650\u5236\u548c\u6301\u7eed\u5199\u5165\u65f6\u95f4\u9650\u5236 \u3002 \u6211\u4eec\u4f1a\u7ed9\u8ba2\u9605\u5ba2\u6237\u7aef\u8bbe\u7f6e\u7f13\u51b2\u533a\u5927\u5c0f\u9650\u5236\u3001\u7f13\u51b2\u533a\u6301\u7eed\u5199\u5165\u91cf\u9650\u5236\uff0c\u4ee5\u53ca\u6301\u7eed\u5199\u5165\u65f6\u95f4\u9650\u5236 \uff0c\u53ef\u4ee5\u5728 Redis \u914d\u7f6e\u6587\u4ef6\u4e2d\u8fd9\u6837\u8bbe\u7f6e\uff1a client-output-buffer-limit pubsub 8mb 2mb 60 \u5176\u4e2d\uff0cpubsub \u53c2\u6570\u8868\u793a\u5f53\u524d\u662f\u5bf9\u8ba2\u9605\u5ba2\u6237\u7aef\u8fdb\u884c\u8bbe\u7f6e\uff1b 8mb \u8868\u793a \u8f93\u51fa\u7f13\u51b2\u533a \u7684\u5927\u5c0f\u4e0a\u9650\u4e3a 8MB\uff0c\u4e00\u65e6\u5b9e\u9645\u5360\u7528\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u8981\u8d85\u8fc7 8MB\uff0c\u670d\u52a1\u5668\u7aef\u5c31\u4f1a\u76f4\u63a5\u5173\u95ed\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\uff1b 2mb \u548c 60 \u8868\u793a\uff0c\u5982\u679c\u8fde\u7eed 60 \u79d2\u5185\u5bf9\u8f93\u51fa\u7f13\u51b2\u533a\u7684\u5199\u5165\u91cf\u8d85\u8fc7 2MB \u7684\u8bdd\uff0c\u670d\u52a1\u5668\u7aef\u4e5f\u4f1a\u5173\u95ed\u5ba2\u6237\u7aef\u8fde\u63a5\u3002 3\u3001\u672c\u7ae0\u95ee\u9898 1\u3001\u95ee\u9898\uff1aRedis \u7684\u5199\u64cd\u4f5c\uff08\u4f8b\u5982 SET\u3001HSET\u3001SADD \u7b49\uff09\u662f\u5728\u5173\u952e\u8def\u5f84\u4e0a\u5417\uff1f \u7b54\u6848\uff1aRedis \u672c\u8eab\u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u6240\u4ee5\uff0c\u5199\u64cd\u4f5c\u90fd\u9700\u8981\u5728\u5185\u5b58\u4e0a\u5b8c\u6210\u6267\u884c\u540e\u624d\u80fd\u8fd4\u56de\uff0c\u8fd9\u5c31\u610f\u5473\u7740\uff0c\u5982\u679c\u8fd9\u4e9b\u5199\u64cd\u4f5c\u5904\u7406\u7684\u662f\u5927\u6570\u636e\u96c6\uff0c\u4f8b\u5982 1 \u4e07\u4e2a\u6570\u636e\uff0c \u90a3\u4e48\uff0c\u4e3b\u7ebf\u7a0b\u9700\u8981\u7b49\u8fd9 1 \u4e07\u4e2a\u6570\u636e\u90fd\u5199\u5b8c\uff0c\u624d\u80fd\u7ee7\u7eed\u6267\u884c\u540e\u9762\u7684\u547d\u4ee4\u3002\u6240\u4ee5\u8bf4\uff0cRedis \u7684\u5199\u64cd\u4f5c\u4e5f\u662f\u5728\u5173\u952e\u8def\u5f84\u4e0a\u7684 \u3002 \u8fd9\u4e2a\u95ee\u9898\u662f\u5e0c\u671b\u4f60\u628a\u9762\u5411\u5185\u5b58\u548c\u9762\u5411\u78c1\u76d8\u7684\u5199\u64cd\u4f5c\u533a\u5206\u5f00\u3002\u5f53\u4e00\u4e2a\u5199\u64cd\u4f5c\u9700\u8981\u628a\u6570\u636e\u5199\u5230\u78c1\u76d8\u65f6\uff0c\u4e00\u822c\u6765\u8bf4\uff0c\u5199\u64cd\u4f5c\u53ea\u8981\u628a\u6570\u636e\u5199\u5230\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u6838\u7f13\u51b2\u533a\u5c31\u884c\u3002\u4e0d\u8fc7\uff0c\u5982\u679c\u6211\u4eec\u6267\u884c\u4e86\u540c\u6b65\u5199\u64cd\u4f5c\uff0c\u90a3\u5c31\u5fc5\u987b\u8981\u7b49\u5230\u6570\u636e\u5199\u56de\u78c1\u76d8\u3002\u6240\u4ee5\uff0c\u9762\u5411\u78c1\u76d8\u7684\u5199\u64cd\u4f5c\u4e00\u822c\u4e0d\u4f1a\u5728\u5173\u952e\u8def\u5f84\u4e0a\u3002 2\u3001\u95ee\u9898\uff1a\u5728\u4e00\u53f0\u6709\u4e24\u4e2a CPU Socket\uff08\u6bcf\u4e2a Socket 8 \u4e2a\u7269\u7406\u6838\uff09\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u6211\u4eec\u90e8\u7f72\u4e86\u4e00\u4e2a\u6709\u7740 8 \u4e2a\u5b9e\u4f8b\u7684 Redis \u5207\u7247\u96c6\u7fa4\uff088 \u4e2a\u5b9e\u4f8b\u90fd\u4e3a\u4e3b\u8282\u70b9\uff0c\u6ca1\u6709\u4e3b\u5907\u5173\u7cfb\uff09\uff0c\u73b0\u5728\u6709\u4e24\u4e2a\u65b9\u6848\uff1a \u5728\u540c\u4e00\u4e2a CPU Socket \u4e0a\u8fd0\u884c 8 \u4e2a\u5b9e\u4f8b\uff0c\u5e76\u548c 8 \u4e2a CPU \u6838\u7ed1\u5b9a\uff1b \u5728\u4e24\u4e2a CPU Socket \u4e0a\u5404\u8fd0\u884c 4 \u4e2a\u5b9e\u4f8b\uff0c\u5e76\u548c\u76f8\u5e94 Socket \u4e0a\u7684\u6838\u7ed1\u5b9a\u3002 \u5982\u679c\u4e0d\u8003\u8651\u7f51\u7edc\u6570\u636e\u8bfb\u53d6\u7684\u5f71\u54cd\uff0c\u4f60\u4f1a\u9009\u62e9\u54ea\u4e2a\u65b9\u6848\u5462\uff1f \u7b54\u6848\uff1a\u5efa\u8bae\u4f7f\u7528\u7b2c\u4e8c\u4e2a\u65b9\u6848\uff0c\u4e3b\u8981\u6709\u4e24\u65b9\u9762\u7684\u539f\u56e0\u3002 \u540c\u4e00\u4e2a CPU Socket \u4e0a\u7684\u8fdb\u7a0b\uff0c\u4f1a\u5171\u4eab L3 \u7f13\u5b58\u3002 \u5982\u679c\u628a 8 \u4e2a\u5b9e\u4f8b\u90fd\u90e8\u7f72\u5728\u540c\u4e00\u4e2a Socket \u4e0a\uff0c\u5b83\u4eec\u4f1a\u7ade\u4e89 L3 \u7f13\u5b58\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u5b83\u4eec\u7684 L3 \u7f13\u5b58\u547d\u4e2d\u7387\u964d\u4f4e\uff0c\u5f71\u54cd\u8bbf\u95ee\u6027\u80fd \u3002 \u540c\u4e00\u4e2a CPU Socket \u4e0a\u7684\u8fdb\u7a0b\uff0c\u4f1a\u4f7f\u7528\u540c\u4e00\u4e2a Socket \u4e0a\u7684\u5185\u5b58\u7a7a\u95f4\u30028 \u4e2a\u5b9e\u4f8b\u5171\u4eab\u540c\u4e00\u4e2a Socket \u4e0a\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u80af\u5b9a\u4f1a\u7ade\u4e89\u5185\u5b58\u8d44\u6e90\u3002 \u5982\u679c\u6709\u5b9e\u4f8b\u4fdd\u5b58\u7684\u6570\u636e\u91cf\u5927\uff0c\u5176\u4ed6\u5b9e\u4f8b\u80fd\u7528\u5230\u7684\u5185\u5b58\u7a7a\u95f4\u53ef\u80fd\u5c31\u4e0d\u591f\u4e86\uff0c\u6b64\u65f6\uff0c\u5176\u4ed6\u5b9e\u4f8b\u5c31\u4f1a\u8de8 Socket \u7533\u8bf7\u5185\u5b58\uff0c\u8fdb\u800c\u9020\u6210\u8de8 Socket \u8bbf\u95ee\u5185\u5b58\uff0c\u9020\u6210\u5b9e\u4f8b\u7684\u6027\u80fd\u964d\u4f4e\u3002 \u53e6\u5916\uff0c\u5728\u5207\u7247\u96c6\u7fa4\u4e2d\uff0c\u4e0d\u540c\u5b9e\u4f8b\u95f4\u901a\u8fc7\u7f51\u7edc\u8fdb\u884c\u6d88\u606f\u901a\u4fe1\u548c\u6570\u636e\u8fc1\u79fb\uff0c\u5e76\u4e0d\u4f1a\u4f7f\u7528\u5171\u4eab\u5185\u5b58\u7a7a\u95f4\u8fdb\u884c\u8de8\u5b9e\u4f8b\u7684\u6570\u636e\u8bbf\u95ee\u3002\u6240\u4ee5\uff0c\u5373\u4f7f\u628a\u4e0d\u540c\u7684\u5b9e\u4f8b\u90e8\u7f72\u5230\u4e0d\u540c\u7684 Socket \u4e0a\uff0c\u5b83\u4eec\u4e4b\u95f4\u4e5f\u4e0d\u4f1a\u53d1\u751f\u8de8 Socket \u5185\u5b58\u7684\u8bbf\u95ee\uff0c\u4e0d\u4f1a\u53d7\u8de8 Socket \u5185\u5b58\u8bbf\u95ee\u7684\u8d1f\u9762\u5f71\u54cd\u3002 3\u3001\u95ee\u9898\uff1a\u5728 Redis \u4e2d\uff0c\u8fd8\u6709\u54ea\u4e9b\u547d\u4ee4\u53ef\u4ee5\u4ee3\u66ff KEYS \u547d\u4ee4\uff0c\u5b9e\u73b0\u5bf9\u952e\u503c\u5bf9\u7684 key \u7684\u6a21\u7cca\u67e5\u8be2\u5462\uff1f\u8fd9\u4e9b\u547d\u4ee4\u7684\u590d\u6742\u5ea6\u4f1a\u5bfc\u81f4 Redis \u53d8\u6162\u5417\uff1f \uff1aRedis \u63d0\u4f9b\u7684 SCAN \u547d\u4ee4\uff0c\u4ee5\u53ca\u9488\u5bf9\u96c6\u5408\u7c7b\u578b\u6570\u636e\u63d0\u4f9b\u7684 SSCAN\u3001HSCAN \u7b49\uff0c\u53ef\u4ee5\u6839\u636e\u6267\u884c\u65f6\u8bbe\u5b9a\u7684\u6570\u91cf\u53c2\u6570\uff0c\u8fd4\u56de\u6307\u5b9a\u6570\u91cf\u7684\u6570\u636e\uff0c\u8fd9\u5c31\u53ef\u4ee5\u907f\u514d\u50cf KEYS \u547d\u4ee4\u4e00\u6837\u540c\u65f6\u8fd4\u56de\u6240\u6709\u5339\u914d\u7684\u6570\u636e\uff0c\u4e0d\u4f1a\u5bfc\u81f4 Redis \u53d8\u6162\u3002 \u4ee5 HSCAN \u4e3a\u4f8b\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c \u4ece user \u8fd9\u4e2a Hash \u96c6\u5408\u4e2d\u8fd4\u56de key \u524d\u7f00\u4ee5 103 \u5f00\u5934\u7684 100 \u4e2a\u952e\u503c\u5bf9\u3002 HSCAN user 0 match \"103*\" 100 4\u3001\u4f60\u9047\u5230\u8fc7 Redis \u53d8\u6162\u7684\u60c5\u51b5\u5417\uff1f\u5982\u679c\u6709\u7684\u8bdd\uff0c\u4f60\u662f\u600e\u4e48\u89e3\u51b3\u7684\u5462\uff1f \u4f7f\u7528\u590d\u6742\u5ea6\u8fc7\u9ad8\u7684\u547d\u4ee4\u6216\u4e00\u6b21\u67e5\u8be2\u5168\u91cf\u6570\u636e\uff1b\u64cd\u4f5c bigkey\uff1b \u5927\u91cf key \u96c6\u4e2d\u8fc7\u671f\uff1b\u5185\u5b58\u8fbe\u5230 maxmemory\uff1b \u5ba2\u6237\u7aef\u4f7f\u7528\u77ed\u8fde\u63a5\u548c Redis \u76f8\u8fde\uff1b \u5f53 Redis \u5b9e\u4f8b\u7684\u6570\u636e\u91cf\u5927\u65f6\uff0c\u65e0\u8bba\u662f\u751f\u6210 RDB\uff0c\u8fd8\u662f AOF \u91cd\u5199\uff0c\u90fd\u4f1a\u5bfc\u81f4 fork \u8017\u65f6\u4e25\u91cd\uff1b AOF \u7684\u5199\u56de\u7b56\u7565\u4e3a always\uff0c\u5bfc\u81f4\u6bcf\u4e2a\u64cd\u4f5c\u90fd\u8981\u540c\u6b65\u5237\u56de\u78c1\u76d8\uff1b Redis \u5b9e\u4f8b\u8fd0\u884c\u673a\u5668\u7684\u5185\u5b58\u4e0d\u8db3\uff0c\u5bfc\u81f4 swap \u53d1\u751f\uff0cRedis \u9700\u8981\u5230 swap \u5206\u533a\u8bfb\u53d6\u6570\u636e\uff1b \u8fdb\u7a0b\u7ed1\u5b9a CPU \u4e0d\u5408\u7406\uff1b Redis \u5b9e\u4f8b\u8fd0\u884c\u673a\u5668\u4e0a\u5f00\u542f\u4e86\u900f\u660e\u5185\u5b58\u5927\u9875\u673a\u5236\uff1b \u7f51\u5361\u538b\u529b\u8fc7\u5927\u3002 5\u3001\u95ee\u9898\uff1a\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 mem_fragmentation_ratio \u6765\u5224\u65ad Redis \u5f53\u524d\u7684\u5185\u5b58\u788e\u7247\u7387\u662f\u5426\u4e25\u91cd\uff0c\u6211\u7ed9\u51fa\u7684\u7ecf\u9a8c\u9608\u503c\u90fd\u662f\u5927\u4e8e 1 \u7684\u3002\u6211\u60f3\u8bf7\u4f60\u601d\u8003\u4e00\u4e0b\uff0c\u5982\u679c mem_fragmentation_ratio \u5c0f\u4e8e 1\uff0cRedis \u7684\u5185\u5b58\u4f7f\u7528\u662f\u4ec0\u4e48\u60c5\u51b5\u5462\uff1f\u4f1a\u5bf9 Redis \u7684\u6027\u80fd\u548c\u5185\u5b58\u7a7a\u95f4\u5229\u7528\u7387\u9020\u6210\u4ec0\u4e48\u5f71\u54cd\u5462\uff1f \u7b54\u6848\uff1a\u5982\u679c mem_fragmentation_ratio \u5c0f\u4e8e 1\uff0c\u5c31\u8868\u660e\uff0c \u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u7ed9 Redis \u7684\u5185\u5b58\u7a7a\u95f4\u5df2\u7ecf\u5c0f\u4e8e Redis \u6240\u7533\u8bf7\u7684\u7a7a\u95f4\u5927\u5c0f\u4e86\uff0c\u6b64\u65f6\uff0c\u8fd0\u884c Redis \u5b9e\u4f8b\u7684\u670d\u52a1\u5668\u4e0a\u7684\u5185\u5b58\u5df2\u7ecf\u4e0d\u591f\u7528\u4e86 \uff0c\u53ef\u80fd\u5df2\u7ecf\u53d1\u751f swap \u4e86\u3002\u8fd9\u6837\u4e00\u6765\uff0cRedis \u7684\u8bfb\u5199\u6027\u80fd\u4e5f\u4f1a\u53d7\u5230\u5f71\u54cd\uff0c\u56e0\u4e3a Redis \u5b9e\u4f8b\u9700\u8981\u5728\u78c1\u76d8\u4e0a\u7684 swap \u5206\u533a\u4e2d\u8bfb\u5199\u6570\u636e\uff0c\u901f\u5ea6\u8f83\u6162\u3002 6\u3001\u5728\u548c Redis \u5b9e\u4f8b\u4ea4\u4e92\u65f6\uff0c\u5e94\u7528\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u7684\u5ba2\u6237\u7aef\u9700\u8981\u4f7f\u7528\u7f13\u51b2\u533a\u5417\uff1f\u5982\u679c\u4f7f\u7528\u7684\u8bdd\uff0c\u5bf9 Redis \u7684\u6027\u80fd\u548c\u5185\u5b58\u4f7f\u7528\u4f1a\u6709\u5f71\u54cd\u5417\uff1f \u7b54\u6848\uff1a \u5e94\u7528\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u7684 Redis \u5ba2\u6237\u7aef\uff0c\u9700\u8981\u628a\u8981\u53d1\u9001\u7684\u8bf7\u6c42\u6682\u5b58\u5728\u7f13\u51b2\u533a \u3002\u8fd9\u6709\u4e24\u65b9\u9762\u7684\u597d\u5904\u3002 \u4e00\u65b9\u9762\uff0c \u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u63a7\u5236\u53d1\u9001\u901f\u7387\uff0c\u907f\u514d\u628a\u8fc7\u591a\u7684\u8bf7\u6c42\u4e00\u4e0b\u5b50\u5168\u90e8\u53d1\u5230 Redis \u5b9e\u4f8b \uff0c\u5bfc\u81f4\u5b9e\u4f8b\u56e0\u538b\u529b\u8fc7\u5927\u800c\u6027\u80fd\u4e0b\u964d\u3002\u4e0d\u8fc7\uff0c\u5ba2\u6237\u7aef\u7f13\u51b2\u533a\u4e0d\u4f1a\u592a\u5927\uff0c\u6240\u4ee5\uff0c\u5bf9 Redis \u5b9e\u4f8b\u7684\u5185\u5b58\u4f7f\u7528\u6ca1\u6709\u4ec0\u4e48\u5f71\u54cd\u3002 \u53e6\u4e00\u65b9\u9762\uff0c \u5728\u5e94\u7528 Redis \u4e3b\u4ece\u96c6\u7fa4\u65f6\uff0c\u4e3b\u4ece\u8282\u70b9\u8fdb\u884c\u6545\u969c\u5207\u6362\u662f\u9700\u8981\u4e00\u5b9a\u65f6\u95f4\u7684\uff0c\u6b64\u65f6\uff0c\u4e3b\u8282\u70b9\u65e0\u6cd5\u670d\u52a1\u5916\u6765\u8bf7\u6c42 \u3002\u5982\u679c\u5ba2\u6237\u7aef\u6709\u7f13\u51b2\u533a\u6682\u5b58\u8bf7\u6c42\uff0c\u90a3\u4e48\uff0c\u5ba2\u6237\u7aef\u4ecd\u7136\u53ef\u4ee5\u6b63\u5e38\u63a5\u6536\u4e1a\u52a1\u5e94\u7528\u7684\u8bf7\u6c42\uff0c\u8fd9\u5c31\u53ef\u4ee5\u907f\u514d\u76f4\u63a5\u7ed9\u5e94\u7528\u8fd4\u56de\u65e0\u6cd5\u670d\u52a1\u7684\u9519\u8bef\u3002 4\u3001\u4ee3\u8868\u6027\u95ee\u9898 \u95ee\u9898 1\uff1a\u5982\u4f55\u4f7f\u7528\u6162\u67e5\u8be2\u65e5\u5fd7\u548c latency monitor \u6392\u67e5\u6267\u884c\u6162\u7684\u64cd\u4f5c\uff1f Redis \u7684\u6162\u67e5\u8be2\u65e5\u5fd7\u8bb0\u5f55\u4e86\u6267\u884c\u65f6\u95f4\u8d85\u8fc7\u4e00\u5b9a\u9608\u503c\u7684\u547d\u4ee4\u64cd\u4f5c\u3002\u5f53\u6211\u4eec\u53d1\u73b0 Redis \u54cd\u5e94\u53d8\u6162\u3001\u8bf7\u6c42\u5ef6\u8fdf\u589e\u52a0\u65f6\uff0c\u5c31\u53ef\u4ee5\u5728\u6162\u67e5\u8be2\u65e5\u5fd7\u4e2d\u8fdb\u884c\u67e5\u627e\uff0c\u786e\u5b9a\u7a76\u7adf\u662f\u54ea\u4e9b\u547d\u4ee4\u6267\u884c\u65f6\u95f4\u5f88\u957f\u3002 \u5728\u4f7f\u7528\u6162\u67e5\u8be2\u65e5\u5fd7\u524d\uff0c\u6211\u4eec\u9700\u8981\u8bbe\u7f6e\u4e24\u4e2a\u53c2\u6570\u3002 slowlog-log-slower-than \uff1a\u8fd9\u4e2a\u53c2\u6570\u8868\u793a\uff0c\u6162\u67e5\u8be2\u65e5\u5fd7\u5bf9\u6267\u884c\u65f6\u95f4\u5927\u4e8e\u591a\u5c11\u5fae\u79d2\u7684\u547d\u4ee4\u8fdb\u884c\u8bb0\u5f55\u3002 slowlog-max-len \uff1a\u8fd9\u4e2a\u53c2\u6570\u8868\u793a\uff0c\u6162\u67e5\u8be2\u65e5\u5fd7\u6700\u591a\u80fd\u8bb0\u5f55\u591a\u5c11\u6761\u547d\u4ee4\u8bb0\u5f55 \u3002\u6162\u67e5\u8be2\u65e5\u5fd7\u7684\u5e95\u5c42\u5b9e\u73b0\u662f\u4e00\u4e2a\u5177\u6709\u9884\u5b9a\u5927\u5c0f\u7684\u5148\u8fdb\u5148\u51fa\u961f\u5217\uff0c\u4e00\u65e6\u8bb0\u5f55\u7684\u547d\u4ee4\u6570\u91cf\u8d85\u8fc7\u4e86\u961f\u5217\u957f\u5ea6\uff0c\u6700\u5148\u8bb0\u5f55\u7684\u547d\u4ee4\u64cd\u4f5c\u5c31\u4f1a\u88ab\u5220\u9664\u3002\u8fd9\u4e2a\u503c\u9ed8\u8ba4\u662f 128\u3002\u4f46\u662f\uff0c\u5982\u679c\u6162\u67e5\u8be2\u547d\u4ee4\u8f83\u591a\u7684\u8bdd\uff0c\u65e5\u5fd7\u91cc\u5c31\u5b58\u4e0d\u4e0b\u4e86\uff1b\u5982\u679c\u8fd9\u4e2a\u503c\u592a\u5927\u4e86\uff0c\u53c8\u4f1a\u5360\u7528\u4e00\u5b9a\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u6240\u4ee5\uff0c\u4e00\u822c\u5efa\u8bae\u8bbe\u7f6e\u4e3a 1000 \u5de6\u53f3\uff0c\u8fd9\u6837\u65e2\u53ef\u4ee5\u591a\u8bb0\u5f55\u4e9b\u6162\u67e5\u8be2\u547d\u4ee4\uff0c\u65b9\u4fbf\u6392\u67e5\uff0c\u4e5f\u53ef\u4ee5\u907f\u514d\u5185\u5b58\u5f00\u9500\u3002 \u8bbe\u7f6e\u597d\u53c2\u6570\u540e\uff0c\u6162\u67e5\u8be2\u65e5\u5fd7\u5c31\u4f1a\u628a\u6267\u884c\u65f6\u95f4\u8d85\u8fc7 slowlog-log-slower-than \u9608\u503c\u7684\u547d\u4ee4\u64cd\u4f5c\u8bb0\u5f55\u5728\u65e5\u5fd7\u4e2d\u3002 \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 SLOWLOG GET \u547d\u4ee4\uff0c\u6765\u67e5\u770b\u6162\u67e5\u8be2\u65e5\u5fd7\u4e2d\u8bb0\u5f55\u7684\u547d\u4ee4\u64cd\u4f5c\uff0c\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u53ef\u4ee5\u67e5\u770b\u6700\u8fd1\u7684\u4e00\u6761\u6162\u67e5\u8be2\u7684\u65e5\u5fd7\u4fe1\u606f\u3002 SLOWLOG GET 1 1) 1) (integer) 33 //\u6bcf\u6761\u65e5\u5fd7\u7684\u552f\u4e00ID\u7f16\u53f7 2) (integer) 1600990583 //\u547d\u4ee4\u6267\u884c\u65f6\u7684\u65f6\u95f4\u6233 3) (integer) 20906 //\u547d\u4ee4\u6267\u884c\u7684\u65f6\u957f\uff0c\u5355\u4f4d\u662f\u5fae\u79d2 4) 1) \"keys\" //\u5177\u4f53\u7684\u6267\u884c\u547d\u4ee4\u548c\u53c2\u6570 2) \"abc*\" 5) \"127.0.0.1:54793\" //\u5ba2\u6237\u7aef\u7684IP\u548c\u7aef\u53e3\u53f7 6) \"\" //\u5ba2\u6237\u7aef\u7684\u540d\u79f0\uff0c\u6b64\u5904\u4e3a\u7a7a \u53ef\u4ee5\u770b\u5230\uff0c KEYS \"abc*\" \u8fd9\u6761\u547d\u4ee4\u7684\u6267\u884c\u65f6\u95f4\u662f 20906 \u5fae\u79d2\uff0c\u5927\u7ea6 20 \u6beb\u79d2\uff0c\u7684\u786e\u662f\u4e00\u6761\u6267\u884c\u8f83\u6162\u7684\u547d\u4ee4\u64cd\u4f5c\u3002 \u5982\u679c\u6211\u4eec\u60f3\u67e5\u770b\u66f4\u591a\u7684\u6162\u65e5\u5fd7\uff0c\u53ea\u8981\u628a SLOWLOG GET \u540e\u9762\u7684\u6570\u5b57\u53c2\u6570\u6539\u4e3a\u60f3\u67e5\u770b\u7684\u65e5\u5fd7\u6761\u6570\uff0c\u5c31\u53ef\u4ee5\u4e86\u3002 \u9664\u4e86\u6162\u67e5\u8be2\u65e5\u5fd7\u4ee5\u5916\uff0cRedis \u4ece 2.8.13 \u7248\u672c\u5f00\u59cb\uff0c\u8fd8\u63d0\u4f9b\u4e86 latency monitor \u76d1\u63a7\u5de5\u5177\uff0c\u8fd9\u4e2a\u5de5\u5177\u53ef\u4ee5\u7528\u6765\u76d1\u63a7 Redis \u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u5cf0\u503c\u5ef6\u8fdf\u60c5\u51b5\u3002 \u548c\u6162\u67e5\u8be2\u65e5\u5fd7\u7684\u8bbe\u7f6e\u76f8\u7c7b\u4f3c\uff0c\u8981\u4f7f\u7528 latency monitor \uff0c\u9996\u5148\u8981\u8bbe\u7f6e\u547d\u4ee4\u6267\u884c\u65f6\u957f\u7684\u9608\u503c\u3002\u5f53\u4e00\u4e2a\u547d\u4ee4\u7684\u5b9e\u9645\u6267\u884c\u65f6\u957f\u8d85\u8fc7\u8be5\u9608\u503c\u65f6\uff0c\u5c31\u4f1a\u88ab latency monitor \u76d1\u63a7\u5230\u3002\u6bd4\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u628a latency monitor \u76d1\u63a7\u7684\u547d\u4ee4\u6267\u884c\u65f6\u957f\u9608\u503c\u8bbe\u4e3a 1000 \u5fae\u79d2\uff0c\u5982\u4e0b\u6240\u793a\uff1a config set latency-monitor-threshold 1000 \u8bbe\u7f6e\u597d\u4e86 latency monitor \u7684\u53c2\u6570\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 latency latest \u547d\u4ee4\uff0c\u67e5\u770b\u6700\u65b0\u548c\u6700\u5927\u7684\u8d85\u8fc7\u9608\u503c\u7684\u5ef6\u8fdf\u60c5\u51b5\uff0c\u5982\u4e0b\u6240\u793a\uff1a latency latest 1) 1) \"command\" 2) (integer) 1600991500 //\u547d\u4ee4\u6267\u884c\u7684\u65f6\u95f4\u6233 3) (integer) 2500 //\u6700\u8fd1\u7684\u8d85\u8fc7\u9608\u503c\u7684\u5ef6\u8fdf 4) (integer) 10100 //\u6700\u5927\u7684\u8d85\u8fc7\u9608\u503c\u7684\u5ef6\u8fdf \u95ee\u9898 2\uff1a\u5982\u4f55\u6392\u67e5 Redis \u7684 bigkey\uff1f \u5728\u5e94\u7528 Redis \u65f6\uff0c\u6211\u4eec\u8981\u5c3d\u91cf\u907f\u514d bigkey \u7684\u4f7f\u7528\uff0c\u8fd9\u662f\u56e0\u4e3a\uff0cRedis \u4e3b\u7ebf\u7a0b\u5728\u64cd\u4f5c bigkey \u65f6\uff0c\u4f1a\u88ab\u963b\u585e\u3002\u90a3\u4e48\uff0c\u4e00\u65e6\u4e1a\u52a1\u5e94\u7528\u4e2d\u4f7f\u7528\u4e86 bigkey\uff0c\u6211\u4eec\u8be5\u5982\u4f55\u8fdb\u884c\u6392\u67e5\u5462\uff1f Redis \u53ef\u4ee5\u5728\u6267\u884c redis-cli \u547d\u4ee4\u65f6\u5e26\u4e0a \u2013bigkeys \u9009\u9879\uff0c\u8fdb\u800c\u5bf9\u6574\u4e2a\u6570\u636e\u5e93\u4e2d\u7684\u952e\u503c\u5bf9\u5927\u5c0f\u60c5\u51b5\u8fdb\u884c\u7edf\u8ba1\u5206\u6790\uff0c\u6bd4\u5982\u8bf4\uff0c\u7edf\u8ba1\u6bcf\u79cd\u6570\u636e\u7c7b\u578b\u7684\u952e\u503c\u5bf9\u4e2a\u6570\u4ee5\u53ca\u5e73\u5747\u5927\u5c0f\u3002 \u6b64\u5916\uff0c\u8fd9\u4e2a\u547d\u4ee4\u6267\u884c\u540e\uff0c\u4f1a\u8f93\u51fa\u6bcf\u79cd\u6570\u636e\u7c7b\u578b\u4e2d\u6700\u5927\u7684 bigkey \u7684\u4fe1\u606f\uff0c\u5bf9\u4e8e String \u7c7b\u578b\u6765\u8bf4\uff0c\u4f1a\u8f93\u51fa\u6700\u5927 bigkey \u7684\u5b57\u8282\u957f\u5ea6\uff0c\u5bf9\u4e8e\u96c6\u5408\u7c7b\u578b\u6765\u8bf4\uff0c\u4f1a\u8f93\u51fa\u6700\u5927 bigkey \u7684\u5143\u7d20\u4e2a\u6570\uff0c\u5982\u4e0b\u6240\u793a\uff1a ./redis-cli --bigkeys -------- summary ------- Sampled 32 keys in the keyspace! Total key length in bytes is 184 (avg len 5.75) //\u7edf\u8ba1\u6bcf\u79cd\u6570\u636e\u7c7b\u578b\u4e2d\u5143\u7d20\u4e2a\u6570\u6700\u591a\u7684bigkey Biggest list found 'product1' has 8 items Biggest hash found 'dtemp' has 5 fields Biggest string found 'page2' has 28 bytes Biggest stream found 'mqstream' has 4 entries Biggest set found 'userid' has 5 members Biggest zset found 'device:temperature' has 6 members //\u7edf\u8ba1\u6bcf\u79cd\u6570\u636e\u7c7b\u578b\u7684\u603b\u952e\u503c\u4e2a\u6570\uff0c\u5360\u6240\u6709\u952e\u503c\u4e2a\u6570\u7684\u6bd4\u4f8b\uff0c\u4ee5\u53ca\u5e73\u5747\u5927\u5c0f 4 lists with 15 items (12.50% of keys, avg size 3.75) 5 hashs with 14 fields (15.62% of keys, avg size 2.80) 10 strings with 68 bytes (31.25% of keys, avg size 6.80) 1 streams with 4 entries (03.12% of keys, avg size 4.00) 7 sets with 19 members (21.88% of keys, avg size 2.71) 5 zsets with 17 members (15.62% of keys, avg size 3.40) \u4e0d\u8fc7\uff0c\u5728\u4f7f\u7528 \u2013bigkeys \u9009\u9879\u65f6\uff0c\u6709\u4e00\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\u4e00\u4e0b\u3002 \u8fd9\u4e2a\u5de5\u5177\u662f\u901a\u8fc7\u626b\u63cf\u6570\u636e\u5e93\u6765\u67e5\u627e bigkey \u7684\uff0c\u6240\u4ee5\uff0c\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u5bf9 Redis \u5b9e\u4f8b\u7684\u6027\u80fd\u4ea7\u751f\u5f71\u54cd\u3002\u5982\u679c\u4f60\u5728\u4f7f\u7528\u4e3b\u4ece\u96c6\u7fa4\uff0c\u6211\u5efa\u8bae\u4f60\u5728\u4ece\u8282\u70b9\u4e0a\u6267\u884c\u8be5\u547d\u4ee4 \u56e0\u4e3a\u4e3b\u8282\u70b9\u4e0a\u6267\u884c\u65f6\uff0c\u4f1a\u963b\u585e\u4e3b\u8282\u70b9\u3002\u5982\u679c\u6ca1\u6709\u4ece\u8282\u70b9\uff0c\u90a3\u4e48\uff0c\u6211\u7ed9\u4f60\u4e24\u4e2a\u5c0f\u5efa\u8bae\uff1a \u7b2c\u4e00\u4e2a\u5efa\u8bae\u662f\uff0c\u5728 Redis \u5b9e\u4f8b\u4e1a\u52a1\u538b\u529b\u7684\u4f4e\u5cf0\u9636\u6bb5\u8fdb\u884c\u626b\u63cf\u67e5\u8be2\uff0c\u4ee5\u514d\u5f71\u54cd\u5230\u5b9e\u4f8b\u7684\u6b63\u5e38\u8fd0\u884c\uff1b \u7b2c\u4e8c\u4e2a\u5efa\u8bae\u662f\uff0c\u53ef\u4ee5\u4f7f\u7528 -i \u53c2\u6570\u63a7\u5236\u626b\u63cf\u95f4\u9694\uff0c\u907f\u514d\u957f\u65f6\u95f4\u626b\u63cf\u964d\u4f4e Redis \u5b9e\u4f8b\u7684\u6027\u80fd\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u65f6\uff0c redis-cli \u4f1a\u6bcf\u626b\u63cf 100 \u6b21\u6682\u505c 100 \u6beb\u79d2\uff080.1 \u79d2\uff09\u3002 ./redis-cli --bigkeys -i 0.1 \u5f53\u7136\uff0c\u4f7f\u7528 Redis \u81ea\u5e26\u7684 \u2013bigkeys \u9009\u9879\u6392\u67e5 bigkey \uff0c\u6709\u4e24\u4e2a\u4e0d\u8db3\u7684\u5730\u65b9\uff1a \u8fd9\u4e2a\u65b9\u6cd5\u53ea\u80fd\u8fd4\u56de\u6bcf\u79cd\u7c7b\u578b\u4e2d\u6700\u5927\u7684\u90a3\u4e2a bigkey\uff0c\u65e0\u6cd5\u5f97\u5230\u5927\u5c0f\u6392\u5728\u524d N \u4f4d\u7684 bigkey\uff1b \u5bf9\u4e8e\u96c6\u5408\u7c7b\u578b\u6765\u8bf4\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u53ea\u7edf\u8ba1\u96c6\u5408\u5143\u7d20\u4e2a\u6570\u7684\u591a\u5c11\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u5360\u7528\u7684\u5185\u5b58\u91cf\u3002\u4f46\u662f\uff0c\u4e00\u4e2a\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u4e2a\u6570\u591a\uff0c\u5e76\u4e0d\u4e00\u5b9a\u5360\u7528\u7684\u5185\u5b58\u5c31\u591a\u3002\u56e0\u4e3a\uff0c\u6709\u53ef\u80fd\u6bcf\u4e2a\u5143\u7d20\u5360\u7528\u7684\u5185\u5b58\u5f88\u5c0f\uff0c\u8fd9\u6837\u7684\u8bdd\uff0c\u5373\u4f7f\u5143\u7d20\u4e2a\u6570\u6709\u5f88\u591a\uff0c\u603b\u5185\u5b58\u5f00\u9500\u4e5f\u4e0d\u5927\u3002 \u5f00\u53d1\u601d\u8def\uff1a\u4f7f\u7528 SCAN \u547d\u4ee4\u5bf9\u6570\u636e\u5e93\u626b\u63cf\uff0c\u7136\u540e\u7528 TYPE \u547d\u4ee4\u83b7\u53d6\u8fd4\u56de\u7684\u6bcf\u4e00\u4e2a key \u7684\u7c7b\u578b\u3002\u63a5\u4e0b\u6765\uff0c\u5bf9\u4e8e String \u7c7b\u578b\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 STRLEN \u547d\u4ee4\u83b7\u53d6\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\uff0c\u4e5f\u5c31\u662f\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u5b57\u8282\u6570\u3002 \u5982\u679c\u4f60\u80fd\u591f\u9884\u5148\u4ece\u4e1a\u52a1\u5c42\u77e5\u9053\u96c6\u5408\u5143\u7d20\u7684\u5e73\u5747\u5927\u5c0f\uff0c\u90a3\u4e48\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u83b7\u53d6\u96c6\u5408\u5143\u7d20\u7684\u4e2a\u6570\uff0c\u7136\u540e\u4e58\u4ee5\u96c6\u5408\u5143\u7d20\u7684\u5e73\u5747\u5927\u5c0f\uff0c\u8fd9\u6837\u5c31\u80fd\u83b7\u5f97\u96c6\u5408\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f\u4e86\u3002 List \u7c7b\u578b\uff1aLLEN \u547d\u4ee4\uff1b Hash \u7c7b\u578b\uff1aHLEN \u547d\u4ee4\uff1b Set \u7c7b\u578b\uff1aSCARD \u547d\u4ee4\uff1b Sorted Set \u7c7b\u578b\uff1aZCARD \u547d\u4ee4\uff1b \u5982\u679c\u4f60\u4e0d\u80fd\u63d0\u524d\u77e5\u9053\u5199\u5165\u96c6\u5408\u7684\u5143\u7d20\u5927\u5c0f\uff0c\u53ef\u4ee5\u4f7f\u7528 MEMORY USAGE \u547d\u4ee4\uff08\u9700\u8981 Redis 4.0 \u53ca\u4ee5\u4e0a\u7248\u672c\uff09\uff0c\u67e5\u8be2\u4e00\u4e2a\u952e\u503c\u5bf9\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u4f8b\u5982\uff0c\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u53ef\u4ee5\u83b7\u5f97 key \u4e3a user:info \u8fd9\u4e2a\u96c6\u5408\u7c7b\u578b\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u5927\u5c0f\u3002 MEMORY USAGE user:info (integer) 315663239","title":"\u7b2c\u56db\u7ae0 Redis \u5f71\u54cd\u6027\u80fd\u7684\u6f5c\u5728\u56e0\u7d20"},{"location":"chap4/6redis_slow_respone/#redis","text":"","title":"\u7b2c\u56db\u7ae0 Redis \u5f71\u54cd\u6027\u80fd\u7684\u6f5c\u5728\u56e0\u7d20"},{"location":"chap4/6redis_slow_respone/#1redis-5","text":"","title":"1\u3001Redis \u6027\u80fd\u7684 5 \u5927\u65b9\u9762\u7684\u6f5c\u5728\u56e0\u7d20\uff0c"},{"location":"chap4/6redis_slow_respone/#1redis","text":"Redis \u5185\u90e8\u7684\u963b\u585e\u5f0f\u64cd\u4f5c\uff1b CPU \u6838\u548c NUMA \u67b6\u6784\u7684\u5f71\u54cd\uff1b Redis \u5173\u952e\u7cfb\u7edf\u914d\u7f6e\uff1b Redis \u5185\u5b58\u788e\u7247\uff1b Redis \u7f13\u51b2\u533a\u3002 Redis \u5b9e\u4f8b\u8fd0\u884c\u65f6\u7684 4 \u5927\u7c7b\u4ea4\u4e92\u5bf9\u8c61\uff1a \u5ba2\u6237\u7aef\u3001\u78c1\u76d8\u3001\u4e3b\u4ece\u5e93\u5b9e\u4f8b\u3001\u5207\u7247\u96c6\u7fa4\u5b9e\u4f8b \u3002 \u57fa\u4e8e\u8fd9 4 \u5927\u7c7b\u4ea4\u4e92\u5bf9\u8c61\uff0c\u6211\u4eec\u68b3\u7406\u4e86\u4f1a\u5bfc\u81f4 Redis \u6027\u80fd\u53d7\u635f\u7684 5 \u5927\u963b\u585e\u70b9\uff0c\u5305\u62ec \u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\u3001bigkey \u5220\u9664\u3001\u6e05\u7a7a\u6570\u636e\u5e93\u3001AOF \u65e5\u5fd7\u540c\u6b65\u5199\uff0c\u4ee5\u53ca\u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6 \u3002 \u5728\u8fd9 5 \u5927\u963b\u585e\u70b9\u4e2d\uff0c bigkey \u5220\u9664\u3001\u6e05\u7a7a\u6570\u636e\u5e93\u3001AOF \u65e5\u5fd7\u540c\u6b65\u5199\u4e0d\u5c5e\u4e8e\u5173\u952e\u8def\u5f84\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4f7f\u7528\u5f02\u6b65\u5b50\u7ebf\u7a0b\u673a\u5236\u6765\u5b8c\u6210 \u3002 Redis \u5728\u8fd0\u884c\u65f6\u4f1a\u521b\u5efa\u4e09\u4e2a\u5b50\u7ebf\u7a0b\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u901a\u8fc7\u4e00\u4e2a\u4efb\u52a1\u961f\u5217\u548c\u4e09\u4e2a\u5b50\u7ebf\u7a0b\u8fdb\u884c\u4ea4\u4e92\u3002\u5b50\u7ebf\u7a0b\u4f1a\u6839\u636e\u4efb\u52a1\u7684\u5177\u4f53\u7c7b\u578b\uff0c\u6765\u6267\u884c\u76f8\u5e94\u7684\u5f02\u6b65\u64cd\u4f5c\u3002 \u4e0d\u8fc7\uff0c\u5f02\u6b65\u5220\u9664\u64cd\u4f5c\u662f Redis 4.0 \u4ee5\u540e\u624d\u6709\u7684\u529f\u80fd\uff0c\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f 4.0 \u4e4b\u524d\u7684\u7248\u672c\uff0c\u5f53\u4f60\u9047\u5230 bigkey \u5220\u9664\u65f6\uff1a \u4f7f\u7528\u96c6\u5408\u7c7b\u578b\u63d0\u4f9b\u7684 SCAN \u547d\u4ee4\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540e\u518d\u8fdb\u884c\u5220\u9664\u3002\u56e0\u4e3a\u7528 SCAN \u547d\u4ee4\u53ef\u4ee5\u6bcf\u6b21\u53ea\u8bfb\u53d6\u4e00\u90e8\u5206\u6570\u636e\u5e76\u8fdb\u884c\u5220\u9664\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u4e00\u6b21\u6027\u5220\u9664\u5927\u91cf key \u7ed9\u4e3b\u7ebf\u7a0b\u5e26\u6765\u7684\u963b\u585e \u3002 \u4f8b\u5982\uff0c\u5bf9\u4e8e Hash \u7c7b\u578b\u7684 bigkey \u5220\u9664\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 HSCAN \u547d\u4ee4\uff0c\u6bcf\u6b21\u4ece Hash \u96c6\u5408\u4e2d\u83b7\u53d6\u4e00\u90e8\u5206\u952e\u503c\u5bf9\uff08\u4f8b\u5982 200 \u4e2a\uff09\uff0c\u518d\u4f7f\u7528 HDEL \u5220\u9664\u8fd9\u4e9b\u952e\u503c\u5bf9\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u628a\u5220\u9664\u538b\u529b\u5206\u644a\u5230\u591a\u6b21\u64cd\u4f5c\u4e2d\uff0c\u90a3\u4e48\uff0c\u6bcf\u6b21\u5220\u9664\u64cd\u4f5c\u7684\u8017\u65f6\u5c31\u4e0d\u4f1a\u592a\u957f\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u4e86\u3002 \u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\u3001\u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6\u662f\u5728\u5173\u952e\u8def\u5f84\u4e0a\uff0c\u65e0\u6cd5\u4f7f\u7528\u5f02\u6b65\u64cd\u4f5c\u6765\u5b8c\u6210 \u3002\u5bf9\u4e8e\u8fd9\u4e24\u4e2a\u963b\u585e\u70b9\uff0c\u6211\u4e24\u4e2a\u5c0f\u5efa\u8bae\u3002 \u96c6\u5408\u5168\u91cf\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\uff1a\u53ef\u4ee5\u4f7f\u7528 SCAN \u547d\u4ee4\uff0c\u5206\u6279\u8bfb\u53d6\u6570\u636e\uff0c\u518d\u5728\u5ba2\u6237\u7aef\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\uff1b \u4ece\u5e93\u52a0\u8f7d RDB \u6587\u4ef6\uff1a\u628a\u4e3b\u5e93\u7684\u6570\u636e\u91cf\u5927\u5c0f\u63a7\u5236\u5728 2~4GB \u5de6\u53f3\uff0c\u4ee5\u4fdd\u8bc1 RDB \u6587\u4ef6\u80fd\u4ee5\u8f83\u5feb\u7684\u901f\u5ea6\u52a0\u8f7d\u3002 \u8981\u70b9&\u4eae\u70b9 \u4e0e\u5ba2\u6237\u7aef\u4ea4\u4e92\u65f6\u7684\u963b\u585e\u70b9\uff1a\u9ad8\u590d\u6742\u5ea6\u7684\u589e\u5220\u6539\u64cd\u4f5c\uff08\u96c6\u5408\u5168\u91cf\u7684\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\uff0cbigKey \u5220\u9664\u64cd\u4f5c\uff0c\u6e05\u7a7a\u6570\u636e\u5e93\uff09 \u4e0e\u78c1\u76d8\u4ea4\u4e92\u7684\u963b\u585e\u70b9\uff1aaof\u65e5\u5fd7\u5b9e\u65f6\u540c\u6b65\u5199\u56de \u4e3b\u4ece\u8282\u70b9\u4ea4\u4e92\u65f6\u7684\u963b\u585e\u70b9\uff1a\u4ece\u5e93\u52a0\u8f7dRDB\u6587\u4ef6 \u5206\u7247\u96c6\u7fa4\u7684\u963b\u585e\u70b9\uff1a\u54c8\u5e0c\u69fdbigkey\u6570\u636e\u8fc1\u79fb \u5173\u952e\u8def\u5f84\u64cd\u4f5c\u6982\u5ff5\uff1a\u5ba2\u6237\u7aef\u628a\u8bf7\u6c42\u53d1\u7ed9Redis\u540e\uff0c\u8981\u7b49\u7740Redis\u8fd4\u56de\u6570\u636e\u7ed3\u679c\u7684\u64cd\u4f5c \u5f02\u6b65\u7684\u5b50\u7ebf\u7a0b\u673a\u5236\uff1a\u4e3b\u7ebf\u7a0b\u901a\u8fc7\u4e00\u4e2a\u94fe\u8868\u5f62\u5f0f\u7684\u4efb\u52a1\u961f\u5217\u548c\u5b50\u7ebf\u7a0b\u8fdb\u884c\u4ea4\u4e92 lazy free \u673a\u5236\uff1aRedis\u6536\u5230\u952e\u503c\u5bf9\u5220\u9664\u548c\u6e05\u7a7a\u6570\u636e\u5e93\u7684\u6307\u4ee4\u65f6\uff0c\u4e3b\u7ebf\u7ebf\u7a0b\u4f1a\u628a\u8fd9\u4e2a\u64cd\u4f5c\u5c01\u88c5\u6210\u4e00\u4e2a\u4efb\u52a1\uff0c\u653e\u5165\u4efb\u52a1\u961f\u5217\u4e2d\uff0c\u7136\u540e\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u4e00\u4e2a\u5b8c\u6210\u4fe1\u606f\uff0c\u4f46\u5b9e\u9645\u4e0a\uff0c\u8fd9\u4e2a\u5220\u9664\u8fd8\u6ca1\u6709\u6267\u884c\uff0c\u9700\u8981\u7b49\u5f85\u540e\u53f0\u5b50\u7ebf\u7a0b\u4ece\u4efb\u52a1\u961f\u5217\u4e2d\u8bfb\u53d6\u5230\u8fd9\u4e2a\u4efb\u52a1\u540e\uff0c\u624d\u5f00\u59cb\u5b9e\u9645\u5220\u9664\u952e\u503c\u5bf9\uff0c\u5e76\u91ca\u653e\u76f8\u5e94\u7684\u5185\u5b58\u7a7a\u95f4\u3002 \u4f46\u662f\uff1a lazy-free \u662f 4.0 \u65b0\u589e\u529f\u80fd\uff0c\u9ed8\u8ba4\u5173\u95ed\u3002\u5f00\u542f\u8fd9\u4e2a\u914d\u7f6e\u540e\uff0c \u9664\u4e86 replica-lazy-flush \u4e4b\u5916\uff0c\u5176\u4ed6\u60c5\u51b5\u90fd\u53ea\u662f \u53ef\u80fd \u53bb\u5f02\u6b65\u91ca\u653e key \u7684\u5185\u5b58\uff0c\u5e76\u4e0d\u662f\u6bcf\u6b21\u5fc5\u5b9a\u5f02\u6b65\u91ca\u653e\u5185\u5b58\u7684\u3002\u662f\u5426\u4f1a\u771f\u6b63\u5f02\u6b65\u91ca\u653e\u5185\u5b58\uff0c\u53d6\u51b3\u4e8e key \u7684\u7c7b\u578b\uff0c\u7f16\u7801\u65b9\u5f0f\uff0c\u5143\u7d20\u6570\u91cf\uff0c\u6240\u4ee5 \u5373\u4f7f\u5f00\u542f\u4e86 lazy-free \uff0c String \u7c7b\u578b\u7684 bigkey \uff0c\u5728\u5220\u9664\u65f6\u4f9d\u65e7\u6709\u963b\u585e\u4e3b\u7ebf\u7a0b\u7684\u98ce\u9669","title":"1\u3001Redis\u6709\u54ea\u4e9b\u53ef\u80fd\u5bfc\u81f4\u963b\u585e\u7684\u64cd\u4f5c\uff0c\u4ee5\u53ca\u89e3\u51b3\u673a\u5236"},{"location":"chap4/6redis_slow_respone/#2cpunumaredis","text":"\u591a\u6838 CPU \u67b6\u6784\uff0c\u4ee5\u53ca NUMA \u67b6\u6784\u3002 \u5728\u591a\u6838 CPU \u67b6\u6784\u4e0b\uff0cRedis \u5982\u679c\u5728\u4e0d\u540c\u7684\u6838\u4e0a\u8fd0\u884c\uff0c\u5c31\u9700\u8981\u9891\u7e41\u5730\u8fdb\u884c\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u589e\u52a0 Redis \u7684\u6267\u884c\u65f6\u95f4\uff0c\u5ba2\u6237\u7aef\u4e5f\u4f1a\u89c2\u5bdf\u5230\u8f83\u9ad8\u7684\u5c3e\u5ef6\u8fdf\u4e86\u3002 \u6240\u4ee5\uff0c \u5efa\u8bae\u4f60\u5728 Redis \u8fd0\u884c\u65f6\uff0c\u628a\u5b9e\u4f8b\u548c\u67d0\u4e2a\u6838\u7ed1\u5b9a\uff0c\u8fd9\u6837\uff0c\u5c31\u80fd\u91cd\u590d\u5229\u7528\u6838\u4e0a\u7684 L1\u3001L2 \u7f13\u5b58\uff0c\u53ef\u4ee5\u964d\u4f4e\u54cd\u5e94\u5ef6\u8fdf \u3002 \u4e3a\u4e86\u63d0\u5347 Redis \u7684\u7f51\u7edc\u6027\u80fd\uff0c\u6211\u4eec\u6709\u65f6\u8fd8\u4f1a\u628a\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u548c CPU \u6838\u7ed1\u5b9a\u3002 \u5982\u679c\u670d\u52a1\u5668\u4f7f\u7528\u7684\u662f NUMA \u67b6\u6784\uff0cRedis \u5b9e\u4f8b\u4e00\u65e6\u88ab\u8c03\u5ea6\u5230\u548c\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u4e0d\u5728\u540c\u4e00\u4e2a CPU Socket\uff0c\u5c31\u8981\u8de8 CPU Socket \u8bbf\u95ee\u7f51\u7edc\u6570\u636e\uff0c\u8fd9\u5c31\u4f1a\u964d\u4f4e Redis \u7684\u6027\u80fd\u3002 \u5efa\u8bae\u4f60\u628a Redis \u5b9e\u4f8b\u548c\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u7ed1\u5728\u540c\u4e00\u4e2a CPU Socket \u4e0b\u7684\u4e0d\u540c\u6838\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u5347 Redis \u7684\u8fd0\u884c\u6027\u80fd\u3002 \u867d\u7136\u7ed1\u6838\u53ef\u4ee5\u5e2e\u52a9 Redis \u964d\u4f4e\u8bf7\u6c42\u6267\u884c\u65f6\u95f4\uff0c\u4f46\u662f\uff0c\u9664\u4e86\u4e3b\u7ebf\u7a0b\uff0cRedis \u8fd8\u6709\u7528\u4e8e RDB \u548c AOF \u91cd\u5199\u7684\u5b50\u8fdb\u7a0b\uff0c\u4ee5\u53ca 4.0 \u7248\u672c\u4e4b\u540e\u63d0\u4f9b\u7684\u7528\u4e8e\u60f0\u6027\u5220\u9664\u7684\u540e\u53f0\u7ebf\u7a0b\u3002 \u5f53 Redis \u5b9e\u4f8b\u548c\u4e00\u4e2a\u903b\u8f91\u6838\u7ed1\u5b9a\u540e\uff0c\u8fd9\u4e9b\u5b50\u8fdb\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\u4f1a\u548c\u4e3b\u7ebf\u7a0b\u7ade\u4e89 CPU \u8d44\u6e90\uff0c\u4e5f\u4f1a\u5bf9 Redis \u6027\u80fd\u9020\u6210\u5f71\u54cd \u3002\u6240\u4ee5\uff0c\u6211\u7ed9\u4e86\u4f60\u4e24\u4e2a\u5efa\u8bae\uff1a \u5982\u679c\u4f60\u4e0d\u60f3\u4fee\u6539 Redis \u4ee3\u7801\uff0c \u53ef\u4ee5\u628a\u6309\u4e00\u4e2a Redis \u5b9e\u4f8b\u4e00\u4e2a\u7269\u7406\u6838\u65b9\u5f0f\u8fdb\u884c\u7ed1\u5b9a\uff0c\u8fd9\u6837\uff0cRedis \u7684\u4e3b\u7ebf\u7a0b\u3001\u5b50\u8fdb\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\u53ef\u4ee5\u5171\u4eab\u4f7f\u7528\u4e00\u4e2a\u7269\u7406\u6838\u4e0a\u7684\u4e24\u4e2a\u903b\u8f91\u6838 \u3002 Redis \u7684\u6e90\u7801\uff0c\u5c31\u53ef\u4ee5\u5728\u6e90\u7801\u4e2d\u589e\u52a0\u7ed1\u6838\u64cd\u4f5c\uff0c\u628a\u5b50\u8fdb\u7a0b\u548c\u540e\u53f0\u7ebf\u7a0b\u7ed1\u5230\u4e0d\u540c\u7684\u6838\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u5bf9\u4e3b\u7ebf\u7a0b\u7684 CPU \u8d44\u6e90\u7ade\u4e89 Redis 6.0 \u51fa\u6765\u540e\uff0c\u53ef\u4ee5\u652f\u6301 CPU \u6838\u7ed1\u5b9a\u7684\u914d\u7f6e\u64cd\u4f5c\u4e86 \u4eae\u70b9&\u8981\u70b9 \u4e3b\u6d41\u7684CPU\u67b6\u6784\uff0c\u4e3b\u8981\u6709\u591a\u6838CPU\u67b6\u6784\u548cNUMA\u67b6\u6784\u4e24\u4e2a\u67b6\u6784 \u591a\u6838CPU\u67b6\u6784\uff1a \u591a\u4e2a\u7269\u7406\u6838\uff0c\u5404\u7269\u7406\u6838\u4f7f\u7528\u79c1\u6709\u76841\u30012\u7ea7\u7f13\u5b58\uff0c\u5171\u4eab3\u7ea7\u7f13\u5b58\u3002\u7269\u7406\u6838\u53ef\u5305\u542b2\u4e2a\u8d85\u7ebf\u7a0b\uff0c\u79f0\u4e3a\u903b\u8f91\u6838 NUMA\u67b6\u6784\uff1a \u4e00\u4e2a\u670d\u52a1\u5668\u4e0a\u591a\u4e2acpu\uff0c\u79f0\u4e3aCPU Socket\uff0c\u6bcf\u4e2acpu socker\u5b58\u5728\u591a\u4e2a\u7269\u7406\u6838\u3002\u6bcf\u4e2asocket\u901a\u8fc7\u603b\u7ebf\u8fde\u63a5\uff0c\u5e76\u4e14\u6709\u7528\u79c1\u6709\u7684\u5185\u5b58\u7a7a\u95f4 cpu\u67b6\u6784\uff1a\u4e00\u4e2acpu\u4e00\u822c\u62e5\u6709\u591a\u4e2a\u7269\u7406\u6838\uff0c\u6bcf\u4e2a\u7269\u7406\u6838\u90fd\u62e5\u6709\u79c1\u6709\u7684\u4e00\u7ea7\u7f13\u5b58\uff0c\u4e8c\u7ea7\u7f13\u5b58\u3002\u4e09\u7ea7\u7f13\u5b58\u662f\u5404\u7269\u7406\u6838\u5171\u4eab\u7684\u7f13\u5b58\u7a7a\u95f4\u3002\u800c\u7269\u7406\u6838\u53c8\u53ef\u4ee5\u5206\u4e3a\u591a\u4e2a\u8d85\u7ebf\u7a0b\uff0c\u79f0\u4e3a\u903b\u8f91\u6838\uff0c\u540c\u4e00\u4e2a\u7269\u7406\u6838\u7684\u903b\u8f91\u6838\u4f1a\u5171\u4eab\u4f7f\u7528 L1\u3001L2 \u7f13\u5b58\u3002 \u4e00\u7ea7\u7f13\u5b58\u548c\u4e8c\u7ea7\u7f13\u5b58\u8bbf\u95ee\u5ef6\u8fdf\u4e0d\u8d85\u8fc710\u7eb3\u79d2\uff0c\u4f46\u7a7a\u95f4\u5f88\u5c0f\uff0c\u53ea\u662fKB\u5355\u4f4d\u3002\u800c\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u5185\u5b58\u5ef6\u8fdf\u662f\u767e\u7eb3\u79d2\u7ea7\u522b\uff0c\u57fa\u672c\u4e0a\u662f\u4e00\u4e8c\u7ea7\u7f13\u5b58\u768410\u500d \u4e0d\u540c\u7684\u7269\u7406\u6838\u8fd8\u4f1a\u5171\u4eab\u4e00\u4e2a\u5171\u540c\u7684\u4e09\u7ea7\u7f13\u5b58\uff0c\u4e09\u7ea7\u7f13\u5b58\u7a7a\u95f4\u6bd4\u8f83\u591a\uff0c\u4e3a\u51e0\u5230\u51e0\u5341MB\uff0c\u5f53 L1\u3001L2 \u7f13\u5b58\u4e2d\u6ca1\u6709\u6570\u636e\u7f13\u5b58\u65f6\uff0c\u53ef\u4ee5\u8bbf\u95ee L3\uff0c\u5c3d\u53ef\u80fd\u907f\u514d\u8bbf\u95ee\u5185\u5b58\u3002 \u591a\u6838CPU\u8fd0\u884credis\u5b9e\u4f8b\uff0c\u4f1a\u5bfc\u81f4context switch\uff0c\u5bfc\u81f4\u589e\u52a0\u5ef6\u8fdf\uff0c\u53ef\u4ee5\u901a\u8fc7taskset \u547d\u4ee4\u628aredis\u8fdb\u7a0b\u7ed1\u5b9a\u5230\u67d0\u4e2acup\u7269\u7406\u6838\u4e0a\u3002 NUMA\u67b6\u6784\u8fd0\u884credis\u5b9e\u4f8b\uff0c\u5982\u679c\u7f51\u7edc\u4e2d\u65ad\u7a0b\u5e8f\u548credis\u5b9e\u4f8b\u8fd0\u884c\u5728\u4e0d\u540c\u7684socket\u4e0a\uff0c\u5c31\u9700\u8981\u8de8 CPU Socket \u8bbf\u95ee\u5185\u5b58\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u82b1\u8d39\u8f83\u591a\u65f6\u95f4\u3002 \u7ed1\u6838\u7684\u98ce\u9669\u548c\u89e3\u51b3\u65b9\u6848\uff1a \u4e00\u4e2a Redis \u5b9e\u4f8b\u5bf9\u5e94\u7ed1\u4e00\u4e2a\u7269\u7406\u6838 \uff1a \u5c06redis\u670d\u52a1\u7ed1\u5b9a\u5230\u4e00\u4e2a\u7269\u7406\u6838\u4e0a\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u903b\u8f91\u6838\u4e0a\uff0c\u5982 taskset -c 0,12 ./redis-server \u4f18\u5316 Redis \u6e90\u7801\u3002","title":"2\u3001\u5728\u591a\u6838CPU\u67b6\u6784\u548cNUMA\u67b6\u6784\u4e0b\uff0c\u5982\u4f55\u5bf9redis\u8fdb\u884c\u4f18\u5316\u914d\u7f6e"},{"location":"chap4/6redis_slow_respone/#3redis","text":"\u5224\u65ad Redis \u53d8\u6162\u7684\u65b9\u6cd5\uff0c \u4e00\u4e2a\u662f\u770b\u54cd\u5e94\u5ef6\u8fdf\uff0c\u4e00\u4e2a\u662f\u770b\u57fa\u7ebf\u6027\u80fd \u3002\u540c\u65f6\uff0c\u6211\u8fd8\u7ed9\u4e86\u4f60\u4e24\u79cd\u6392\u67e5\u548c\u89e3\u51b3 Redis \u53d8\u6162\u8fd9\u4e2a\u95ee\u9898\u7684\u65b9\u6cd5\uff1a \u4ece\u6162\u67e5\u8be2\u547d\u4ee4\u5f00\u59cb\u6392\u67e5\uff0c\u5e76\u4e14\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u66ff\u6362\u6162\u67e5\u8be2\u547d\u4ee4 \uff1b \u6392\u67e5\u8fc7\u671f key \u7684\u65f6\u95f4\u8bbe\u7f6e\uff0c\u5e76\u6839\u636e\u5b9e\u9645\u4f7f\u7528\u9700\u6c42\uff0c\u8bbe\u7f6e\u4e0d\u540c\u7684\u8fc7\u671f\u65f6\u95f4 \u3002 9 \u4e2a\u68c0\u67e5\u70b9\u7684 Checklist\uff0c\u5e0c\u671b\u4f60\u5728\u9047\u5230 Redis \u6027\u80fd\u53d8\u6162\u65f6\uff0c\u6309\u7167\u8fd9\u4e9b\u6b65\u9aa4\u9010\u4e00\u68c0\u67e5\uff0c\u9ad8\u6548\u5730\u89e3\u51b3\u95ee\u9898: \u83b7\u53d6 Redis \u5b9e\u4f8b\u5728\u5f53\u524d\u73af\u5883\u4e0b\u7684\u57fa\u7ebf\u6027\u80fd\u3002 \u662f\u5426\u7528\u4e86\u6162\u67e5\u8be2\u547d\u4ee4\uff1f\u5982\u679c\u662f\u7684\u8bdd\uff0c\u5c31\u4f7f\u7528\u5176\u4ed6\u547d\u4ee4\u66ff\u4ee3\u6162\u67e5\u8be2\u547d\u4ee4\uff0c\u6216\u8005\u628a\u805a\u5408\u8ba1\u7b97\u547d\u4ee4\u653e\u5728\u5ba2\u6237\u7aef\u505a\u3002 \u662f\u5426\u5bf9\u8fc7\u671f key \u8bbe\u7f6e\u4e86\u76f8\u540c\u7684\u8fc7\u671f\u65f6\u95f4\uff1f \u5bf9\u4e8e\u6279\u91cf\u5220\u9664\u7684 key\uff0c\u53ef\u4ee5\u5728\u6bcf\u4e2a key \u7684\u8fc7\u671f\u65f6\u95f4\u4e0a\u52a0\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u907f\u514d\u540c\u65f6\u5220\u9664 \u3002 \u662f\u5426\u5b58\u5728 bigkey\uff1f \u5bf9\u4e8e bigkey \u7684\u5220\u9664\u64cd\u4f5c\uff0c\u5982\u679c\u4f60\u7684 Redis \u662f 4.0 \u53ca\u4ee5\u4e0a\u7684\u7248\u672c\uff0c\u53ef\u4ee5\u76f4\u63a5\u5229\u7528\u5f02\u6b65\u7ebf\u7a0b\u673a\u5236\u51cf\u5c11\u4e3b\u7ebf\u7a0b\u963b\u585e\uff1b\u5982\u679c\u662f Redis 4.0 \u4ee5\u524d\u7684\u7248\u672c\uff0c \u53ef\u4ee5\u4f7f\u7528 SCAN \u547d\u4ee4\u8fed\u4ee3\u5220\u9664\uff1b\u5bf9\u4e8e bigkey \u7684\u96c6\u5408\u67e5\u8be2\u548c\u805a\u5408\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4f7f\u7528 SCAN \u547d\u4ee4\u5728\u5ba2\u6237\u7aef\u5b8c\u6210 \u3002 Redis AOF \u914d\u7f6e\u7ea7\u522b\u662f\u4ec0\u4e48\uff1f\u4e1a\u52a1\u5c42\u9762\u662f\u5426\u7684\u786e\u9700\u8981\u8fd9\u4e00\u53ef\u9760\u6027\u7ea7\u522b\uff1f\u5982\u679c\u6211\u4eec\u9700\u8981\u9ad8\u6027\u80fd\uff0c\u540c\u65f6\u4e5f\u5141\u8bb8\u6570\u636e\u4e22\u5931\uff0c \u53ef\u4ee5\u5c06\u914d\u7f6e\u9879 no-appendfsync-on-rewrite \u8bbe\u7f6e\u4e3a yes \uff0c \u907f\u514d AOF \u91cd\u5199\u548c fsync \u7ade\u4e89\u78c1\u76d8 IO \u8d44\u6e90\uff0c\u5bfc\u81f4 Redis \u5ef6\u8fdf\u589e\u52a0 \u3002\u5f53\u7136\uff0c \u5982\u679c\u65e2\u9700\u8981\u9ad8\u6027\u80fd\u53c8\u9700\u8981\u9ad8\u53ef\u9760\u6027\uff0c\u6700\u597d\u4f7f\u7528\u9ad8\u901f\u56fa\u6001\u76d8\u4f5c\u4e3a AOF \u65e5\u5fd7\u7684\u5199\u5165\u76d8\u3002 Redis \u5b9e\u4f8b\u7684\u5185\u5b58\u4f7f\u7528\u662f\u5426\u8fc7\u5927\uff1f\u53d1\u751f swap \u4e86\u5417\uff1f\u5982\u679c\u662f\u7684\u8bdd\uff0c\u5c31\u589e\u52a0\u673a\u5668\u5185\u5b58\uff0c\u6216\u8005\u662f\u4f7f\u7528 Redis \u96c6\u7fa4\uff0c\u5206\u644a\u5355\u673a Redis \u7684\u952e\u503c\u5bf9\u6570\u91cf\u548c\u5185\u5b58\u538b\u529b\u3002\u540c\u65f6\uff0c\u8981\u907f\u514d\u51fa\u73b0 Redis \u548c\u5176\u4ed6\u5185\u5b58\u9700\u6c42\u5927\u7684\u5e94\u7528\u5171\u4eab\u673a\u5668\u7684\u60c5\u51b5\u3002 \u5728 Redis \u5b9e\u4f8b\u7684\u8fd0\u884c\u73af\u5883\u4e2d\uff0c\u662f\u5426\u542f\u7528\u4e86\u900f\u660e\u5927\u9875\u673a\u5236\uff1f\u5982\u679c\u662f\u7684\u8bdd\uff0c\u76f4\u63a5\u5173\u95ed\u5185\u5b58\u5927\u9875\u673a\u5236\u5c31\u884c\u4e86\u3002 \u662f\u5426\u8fd0\u884c\u4e86 Redis \u4e3b\u4ece\u96c6\u7fa4\uff1f\u5982\u679c\u662f\u7684\u8bdd\uff0c\u628a\u4e3b\u5e93\u5b9e\u4f8b\u7684\u6570\u636e\u91cf\u5927\u5c0f\u63a7\u5236\u5728 2~4GB\uff0c\u4ee5\u514d\u4e3b\u4ece\u590d\u5236\u65f6\uff0c\u4ece\u5e93\u56e0\u52a0\u8f7d\u5927\u7684 RDB \u6587\u4ef6\u800c\u963b\u585e\u3002 \u662f\u5426\u4f7f\u7528\u4e86\u591a\u6838 CPU \u6216 NUMA \u67b6\u6784\u7684\u673a\u5668\u8fd0\u884c Redis \u5b9e\u4f8b\uff1f\u4f7f\u7528\u591a\u6838 CPU \u65f6\uff0c\u53ef\u4ee5\u7ed9 Redis \u5b9e\u4f8b\u7ed1\u5b9a\u7269\u7406\u6838\uff1b\u4f7f\u7528 NUMA \u67b6\u6784\u65f6\uff0c\u6ce8\u610f\u628a Redis \u5b9e\u4f8b\u548c\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u8fd0\u884c\u5728\u540c\u4e00\u4e2a CPU Socket \u4e0a\u3002 \u4ed4\u7ec6\u68c0\u67e5\u4e0b\u6709\u6ca1\u6709\u607c\u4eba\u7684\u201c\u90bb\u5c45\u201d\uff0c\u5177\u4f53\u70b9\u8bf4\uff0c\u5c31\u662f Redis \u6240\u5728\u7684\u673a\u5668\u4e0a\u6709\u6ca1\u6709\u4e00\u4e9b\u5176\u4ed6\u5360\u5185\u5b58\u3001\u78c1\u76d8 IO \u548c\u7f51\u7edc IO \u7684\u7a0b\u5e8f\uff0c\u6bd4\u5982\u8bf4\u6570\u636e\u5e93\u7a0b\u5e8f\u6216\u8005\u6570\u636e\u91c7\u96c6\u7a0b\u5e8f\u3002 \u5982\u679c\u6709\u7684\u8bdd\uff0c\u6211\u5efa\u8bae\u4f60\u5c06\u8fd9\u4e9b\u7a0b\u5e8f\u8fc1\u79fb\u5230\u5176\u4ed6\u673a\u5668\u4e0a\u8fd0\u884c\u3002 \u5206\u6790\u3001\u6392\u67e5\u3001\u89e3\u51b3Redis\u53d8\u6162\u95ee\u9898 \u4f7f\u7528\u590d\u6742\u5ea6\u8fc7\u9ad8\u7684\u547d\u4ee4\uff08\u4f8b\u5982SORT/SUION/ZUNIONSTORE/KEYS\uff09\uff0c\u6216\u4e00\u6b21\u67e5\u8be2\u5168\u91cf\u6570\u636e\uff08\u4f8b\u5982LRANGE key 0 N\uff0c\u4f46N\u5f88\u5927\uff09 \u5206\u6790\uff1a a) \u67e5\u770bslowlog\u662f\u5426\u5b58\u5728\u8fd9\u4e9b\u547d\u4ee4 b) Redis\u8fdb\u7a0bCPU\u4f7f\u7528\u7387\u662f\u5426\u98d9\u5347\uff08\u805a\u5408\u8fd0\u7b97\u547d\u4ee4\u5bfc\u81f4\uff09 \u89e3\u51b3\uff1a a) \u4e0d\u4f7f\u7528\u590d\u6742\u5ea6\u8fc7\u9ad8\u7684\u547d\u4ee4\uff0c\u6216\u7528\u5176\u4ed6\u65b9\u5f0f\u4ee3\u66ff\u5b9e\u73b0\uff08\u653e\u5728\u5ba2\u6237\u7aef\u505a\uff09 b) \u6570\u636e\u5c3d\u91cf\u5206\u6279\u67e5\u8be2\uff08LRANGE key 0 N\uff0c\u5efa\u8baeN<=100\uff0c\u67e5\u8be2\u5168\u91cf\u6570\u636e\u5efa\u8bae\u4f7f\u7528HSCAN/SSCAN/ZSCAN\uff09 \u64cd\u4f5cbigkey \u5206\u6790\uff1a a) slowlog \u51fa\u73b0\u5f88\u591a SET/DELETE \u53d8\u6162\u547d\u4ee4\uff08bigkey\u5206\u914d\u5185\u5b58\u548c\u91ca\u653e\u5185\u5b58\u53d8\u6162\uff09 b) \u4f7f\u7528 redis-cli -h $host -p $port --bigkeys \u626b\u63cf\u51fa\u5f88\u591a bigkey \u89e3\u51b3\uff1a a) \u4f18\u5316\u4e1a\u52a1\uff0c\u907f\u514d\u5b58\u50a8bigkey b) Redis 4.0+\u53ef\u5f00\u542f lazy-free \u673a\u5236 \u5927\u91cfkey\u96c6\u4e2d\u8fc7\u671f \u5206\u6790\uff1a a) \u4e1a\u52a1\u4f7f\u7528EXPIREAT/PEXPIREAT\u547d\u4ee4 b) Redis info\u4e2d\u7684 expired_keys \u6307\u6807\u77ed\u671f\u7a81\u589e \u89e3\u51b3\uff1a a) \u4f18\u5316\u4e1a\u52a1\uff0c\u8fc7\u671f\u589e\u52a0\u968f\u673a\u65f6\u95f4\uff0c\u628a\u65f6\u95f4\u6253\u6563\uff0c\u51cf\u8f7b\u5220\u9664\u8fc7\u671fkey\u7684\u538b\u529b b) \u8fd0\u7ef4\u5c42\u9762\uff0c\u76d1\u63a7 expired_keys \u6307\u6807\uff0c\u6709\u77ed\u671f\u7a81\u589e\u53ca\u65f6\u62a5\u8b66\u6392\u67e5 Redis\u5185\u5b58\u8fbe\u5230maxmemory \u5206\u6790\uff1a a) \u5b9e\u4f8b\u5185\u5b58\u8fbe\u5230maxmemory\uff0c\u4e14\u5199\u5165\u91cf\u5927\uff0c\u6dd8\u6c70key\u538b\u529b\u53d8\u5927 b) Redis info\u4e2d\u7684 evicted_keys \u6307\u6807\u77ed\u671f\u7a81\u589e \u89e3\u51b3\uff1a a) \u4e1a\u52a1\u5c42\u9762\uff0c\u6839\u636e\u60c5\u51b5\u8c03\u6574\u6dd8\u6c70\u7b56\u7565\uff08\u968f\u673a\u6bd4LRU\u5feb\uff09 b) \u8fd0\u7ef4\u5c42\u9762\uff0c\u76d1\u63a7evicted_keys\u6307\u6807\uff0c\u6709\u77ed\u671f\u7a81\u589e\u53ca\u65f6\u62a5\u8b66 c) \u96c6\u7fa4\u6269\u5bb9\uff0c\u591a\u4e2a\u5b9e\u4f8b\u51cf\u8f7b\u6dd8\u6c70key\u7684\u538b\u529b \u5927\u91cf\u77ed\u8fde\u63a5\u8bf7\u6c42 \u5206\u6790\uff1aRedis\u5904\u7406\u5927\u91cf\u77ed\u8fde\u63a5\u8bf7\u6c42\uff0cTCP\u4e09\u6b21\u63e1\u624b\u548c\u56db\u6b21\u6325\u624b\u4e5f\u4f1a\u589e\u52a0\u8017\u65f6 \u89e3\u51b3\uff1a\u4f7f\u7528\u957f\u8fde\u63a5\u64cd\u4f5cRedis \u751f\u6210RDB\u548cAOF\u91cd\u5199fork\u8017\u65f6\u4e25\u91cd \u5206\u6790\uff1a a) Redis\u53d8\u6162\u53ea\u53d1\u751f\u5728\u751f\u6210RDB\u548cAOF\u91cd\u5199\u671f\u95f4 b) \u5b9e\u4f8b\u5360\u7528\u5185\u5b58\u8d8a\u5927\uff0cfork\u62f7\u8d1d\u5185\u5b58\u9875\u8868\u8d8a\u4e45 c) Redis info\u4e2d latest_fork_usec \u8017\u65f6\u53d8\u957f \u89e3\u51b3\uff1a a) \u5b9e\u4f8b\u5c3d\u91cf\u5c0f b) Redis\u5c3d\u91cf\u90e8\u7f72\u5728\u7269\u7406\u673a\u4e0a c) \u4f18\u5316\u5907\u4efd\u7b56\u7565\uff08\u4f8b\u5982\u4f4e\u5cf0\u671f\u5907\u4efd\uff09 d) \u5408\u7406\u914d\u7f6e repl-backlog \u548c slave client-output-buffer-limit \uff0c\u907f\u514d\u4e3b\u4ece\u5168\u91cf\u540c\u6b65 e) \u89c6\u60c5\u51b5\u8003\u8651\u5173\u95edAOF f) \u76d1\u63a7 latest_fork_usec \u8017\u65f6\u662f\u5426\u53d8\u957f AOF\u4f7f\u7528 awalys \u673a\u5236 \u5206\u6790\uff1a\u78c1\u76d8IO\u8d1f\u8f7d\u53d8\u9ad8 \u89e3\u51b3\uff1a a) \u4f7f\u7528everysec\u673a\u5236 b) \u4e22\u5931\u6570\u636e\u4e0d\u654f\u611f\u7684\u4e1a\u52a1\u4e0d\u5f00\u542fAOF \u4f7f\u7528Swap \u5206\u6790\uff1a a) \u6240\u6709\u8bf7\u6c42\u5168\u90e8\u5f00\u59cb\u53d8\u6162 b) slowlog\u5927\u91cf\u6162\u65e5\u5fd7 c) \u67e5\u770bRedis\u8fdb\u7a0b\u662f\u5426\u4f7f\u7528\u5230\u4e86Swap \u89e3\u51b3\uff1a a) \u589e\u52a0\u673a\u5668\u5185\u5b58 b) \u96c6\u7fa4\u6269\u5bb9 c) Swap\u4f7f\u7528\u65f6\u76d1\u63a7\u62a5\u8b66 \u8fdb\u7a0b\u7ed1\u5b9aCPU\u4e0d\u5408\u7406 \u5206\u6790 a) Redis\u8fdb\u7a0b\u53ea\u7ed1\u5b9a\u4e00\u4e2aCPU\u903b\u8f91\u6838 b) NUMA\u67b6\u6784\u4e0b\uff0c\u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u548cRedis\u8fdb\u7a0b\u6ca1\u6709\u7ed1\u5b9a\u5728\u540c\u4e00\u4e2aSocket\u4e0b \u89e3\u51b3 a) Redis\u8fdb\u7a0b\u7ed1\u5b9a\u591a\u4e2aCPU\u903b\u8f91\u6838 b) \u7f51\u7edc\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u548cRedis\u8fdb\u7a0b\u7ed1\u5b9a\u5728\u540c\u4e00\u4e2aSocket\u4e0b \u5f00\u542f\u900f\u660e\u5927\u9875\u673a\u5236 \u5206\u6790\uff1a\u751f\u6210RDB\u548cAOF\u91cd\u5199\u671f\u95f4\uff0c\u4e3b\u7ebf\u7a0b\u5904\u7406\u5199\u8bf7\u6c42\u8017\u65f6\u53d8\u957f\uff08\u62f7\u8d1d\u5185\u5b58\u526f\u672c\u8017\u65f6\u53d8\u957f\uff09 \u89e3\u51b3\uff1a\u5173\u95ed\u900f\u660e\u5927\u9875\u673a\u5236 \u7f51\u5361\u8d1f\u8f7d\u8fc7\u9ad8 \u5206\u6790\uff1a a) TCP/IP\u5c42\u5ef6\u8fdf\u53d8\u5927\uff0c\u4e22\u5305\u91cd\u4f20\u53d8\u591a b) \u662f\u5426\u5b58\u5728\u6d41\u91cf\u8fc7\u5927\u7684\u5b9e\u4f8b\u5360\u6ee1\u5e26\u5bbd \u89e3\u51b3\uff1a a) \u673a\u5668\u7f51\u7edc\u8d44\u6e90\u76d1\u63a7\uff0c\u8d1f\u8f7d\u8fc7\u9ad8\u53ca\u65f6\u62a5\u8b66 b) \u63d0\u524d\u89c4\u5212\u90e8\u7f72\u7b56\u7565\uff0c\u8bbf\u95ee\u91cf\u5927\u7684\u5b9e\u4f8b\u9694\u79bb\u90e8\u7f72 \u603b\u4e4b\uff0cRedis\u7684\u6027\u80fd\u4e0eCPU\u3001\u5185\u5b58\u3001\u7f51\u7edc\u3001\u78c1\u76d8\u90fd\u606f\u606f\u76f8\u5173\uff0c\u4efb\u4f55\u4e00\u5904\u53d1\u751f\u95ee\u9898\uff0c\u90fd\u4f1a\u5f71\u54cd\u5230Redis\u7684\u6027\u80fd\u3002 \u8981\u70b9&\u4eae\u70b9 \u901a\u8fc7 redis-cli --intrinsic-latency 120 \u53ef\u4ee5\u5f97\u77e5redis\u7684\u57fa\u51c6\u7ebf\u3002\u540e\u7eed\u53ef\u4ee5\u6839\u636e\u57fa\u51c6\u7ebf\u7684\u54cd\u5e94\u901f\u5ea6\u8fdb\u884c\u5224\u65ad\u662f\u5426\u67e5\u8be2\u6162 \u57fa\u4e8e\u81ea\u5df1\u5bf9 Redis \u672c\u8eab\u7684\u5de5\u4f5c\u539f\u7406\u7684\u7406\u89e3\uff0c\u5e76\u4e14\u7ed3\u5408\u548c\u5b83\u4ea4\u4e92\u7684\u64cd\u4f5c\u7cfb\u7edf\u3001\u5b58\u50a8\u4ee5\u53ca\u7f51\u7edc\u7b49\u5916\u90e8\u7cfb\u7edf\u5173\u952e\u673a\u5236\uff0c\u518d\u501f\u52a9\u4e00\u4e9b\u8f85\u52a9\u5de5\u5177\u6765\u5b9a\u4f4d\u539f\u56e0\uff0c\u5e76\u5236\u5b9a\u884c\u4e4b\u6709\u6548\u7684\u89e3\u51b3\u65b9\u6848 Redis \u81ea\u8eab\u64cd\u4f5c\u7279\u6027\u7684\u5f71\u54cd \u6162\u67e5\u8be2\u547d\u4ee4\uff1a\u547d\u4ee4\u64cd\u4f5c\u7684\u590d\u6742\u5ea6\u6709\u5173 \u6392\u67e5\u65b9\u6cd5\uff1a\u901a\u8fc7 Redis \u65e5\u5fd7\uff0c\u6216\u8005\u662f latency monitor \u5de5\u5177\uff0c\u67e5\u8be2\u53d8\u6162\u7684\u8bf7\u6c42 \u89e3\u51b3\u65b9\u6cd5\uff1a \u7528\u5176\u4ed6\u9ad8\u6548\u547d\u4ee4\u4ee3\u66ff\u3002\u5982\u4e0d\u8981\u4f7f\u7528keys\u67e5\u8be2\u6240\u6709key\uff0c\u53ef\u4ee5\u4f7f\u7528scan\u8fdb\u884c\u67e5\u8be2\uff0c\u4e0d\u4f1a\u963b\u585e\u7ebf\u7a0b \u5f53\u4f60\u9700\u8981\u6267\u884c\u6392\u5e8f\u3001\u4ea4\u96c6\u3001\u5e76\u96c6\u64cd\u4f5c\u65f6\uff0c\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u5b8c\u6210\uff0c\u800c\u4e0d\u8981\u7528 SORT\u3001SUNION\u3001SINTER \u8fd9\u4e9b\u547d\u4ee4\uff0c\u4ee5\u514d\u62d6\u6162 Redis \u5b9e\u4f8b\u3002 \u8fc7\u671f key \u64cd\u4f5c\uff1aredis\u672c\u8eab\u7684\u5185\u5b58\u56de\u6536\u673a\u5236\u4f1a\u9020\u6210redis\u64cd\u4f5c\u963b\u585e\uff0c\u5bfc\u81f4\u6027\u80fd\u53d8\u6162\uff08Redis 4.0 \u540e\u53ef\u4ee5\u7528\u5f02\u6b65\u7ebf\u7a0b\u673a\u5236\u6765\u51cf\u5c11\u963b\u585e\u5f71\u54cd\uff09 \u5bfc\u81f4\u539f\u56e0\uff1a\u5927\u6279\u91cf\u7684key\u540c\u65f6\u95f4\u5185\u8fc7\u671f\uff0c\u5bfc\u81f4\u5220\u9664\u8fc7\u671fkey\u7684\u673a\u5236\u4e00\u76f4\u89e6\u53d1\uff0c\u5f15\u8d77redis\u64cd\u4f5c\u963b\u585e \u89e3\u51b3\u65b9\u6cd5\uff1a\u5bf9key\u8bbe\u5b9a\u8fc7\u671f\u65f6\u95f4\u65f6\uff0c\u6dfb\u52a0\u4e00\u4e2a\u5220\u9664\u7684\u65f6\u95f4\u968f\u673a\u6570\uff0c\u80fd\u907f\u514dkey\u5b58\u5728\u540c\u4e00\u65f6\u95f4\u8fc7\u671f redis\u5220\u9664\u8fc7\u671fkey\u7684\u673a\u5236\uff0c\u6bcf100\u6beb\u79d2\u5bf9\u4e00\u4e9bkey\u8fdb\u884c\u5220\u9664\u3002\u7b97\u6cd5\u5982\u4e0b \u91c7\u6837 ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP \u4e2a\u6570\u7684 key\uff0c\u5e76\u5c06\u5176\u4e2d\u8fc7\u671f\u7684 key \u5168\u90e8\u5220\u9664\uff1b \u679c\u8d85\u8fc7 25% \u7684 key \u8fc7\u671f\u4e86\uff0c\u5219\u91cd\u590d\u5220\u9664\u7684\u8fc7\u7a0b\uff0c\u76f4\u5230\u8fc7\u671f key \u7684\u6bd4\u4f8b\u964d\u81f3 25% \u4ee5\u4e0b\u3002","title":"3\u3001\u5f53redis\u67e5\u8be2\u53d8\u6162\u4e86\u600e\u4e48\u529e\uff1f"},{"location":"chap4/6redis_slow_respone/#4","text":"Redis \u7684\u5185\u5b58\u7a7a\u95f4\u6548\u7387\u95ee\u9898 info memory \u547d\u4ee4\u662f\u4e00\u4e2a\u597d\u5de5\u5177\uff0c\u53ef\u4ee5\u5e2e\u52a9\u4f60\u67e5\u770b\u788e\u7247\u7387\u7684\u60c5\u51b5\uff1b \u788e\u7247\u7387\u9608\u503c\u662f\u4e00\u4e2a\u597d\u7ecf\u9a8c \uff0c\u53ef\u4ee5\u5e2e\u5fd9\u4f60\u6709\u6548\u5730\u5224\u65ad\u662f\u5426\u8981\u8fdb\u884c\u788e\u7247\u6e05\u7406\u4e86\uff1b \u5185\u5b58\u788e\u7247\u81ea\u52a8\u6e05\u7406\u662f\u4e00\u4e2a\u597d\u65b9\u6cd5 \uff0c\u53ef\u4ee5\u907f\u514d\u56e0\u4e3a\u788e\u7247\u5bfc\u81f4 Redis \u7684\u5185\u5b58\u5b9e\u9645\u5229\u7528\u7387\u964d\u4f4e\uff0c\u63d0\u5347\u6210\u672c\u6536\u76ca\u7387\u3002 \u5185\u5b58\u788e\u7247\u81ea\u52a8\u6e05\u7406\u6d89\u53ca\u5185\u5b58\u62f7\u8d1d\uff0c\u8fd9\u5bf9 Redis \u800c\u8a00\uff0c\u662f\u4e2a\u6f5c\u5728\u7684\u98ce\u9669\u3002\u5982\u679c\u4f60\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\u9047\u5230 Redis \u6027\u80fd\u53d8\u6162\uff0c\u8bb0\u5f97\u901a\u8fc7\u65e5\u5fd7\u770b\u4e0b\u662f\u5426\u6b63\u5728\u8fdb\u884c\u788e\u7247\u6e05\u7406\u3002 \u5982\u679c Redis \u7684\u786e\u6b63\u5728\u6e05\u7406\u788e\u7247\uff0c\u90a3\u4e48\uff0c\u6211\u5efa\u8bae\u4f60\u8c03\u5c0f active-defrag-cycle-max \u7684\u503c\uff0c\u4ee5\u51cf\u8f7b\u5bf9\u6b63\u5e38\u8bf7\u6c42\u5904\u7406\u7684\u5f71\u54cd\u3002","title":"4\u3001 \u5220\u9664\u6570\u636e\u540e\uff0c\u5185\u5b58\u5360\u7528\u7387\u8fd8\u662f\u5f88\u9ad8"},{"location":"chap4/6redis_slow_respone/#5redis","text":"\u4f7f\u7528\u7f13\u51b2\u533a\u4ee5\u540e\uff0c\u5f53\u547d\u4ee4\u6570\u636e\u7684\u63a5\u6536\u65b9\u5904\u7406\u901f\u5ea6\u8ddf\u4e0d\u4e0a\u53d1\u9001\u65b9\u7684\u53d1\u9001\u901f\u5ea6\u65f6\uff0c\u7f13\u51b2\u533a\u53ef\u4ee5\u907f\u514d\u547d\u4ee4\u6570\u636e\u7684\u4e22\u5931\u3002 \u6309\u7167\u7f13\u51b2\u533a\u7684\u7528\u9014\uff0c\u4f8b\u5982\u662f\u7528\u4e8e\u5ba2\u6237\u7aef\u901a\u4fe1\u8fd8\u662f\u7528\u4e8e\u4e3b\u4ece\u8282\u70b9\u590d\u5236\uff0c\u6211\u628a\u7f13\u51b2\u533a\u5206\u6210\u4e86 \u5ba2\u6237\u7aef\u7684\u8f93\u5165 \u5ba2\u6237\u7aef\u8f93\u51fa\u7f13\u51b2\u533a \u4e3b\u4ece\u96c6\u7fa4\u4e2d\u4e3b\u8282\u70b9\u4e0a\u7684\u590d\u5236\u7f13\u51b2\u533a \u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a \u73b0\u5728\uff0c\u4ece\u7f13\u51b2\u533a\u6ea2\u51fa\u5bf9 Redis \u7684\u5f71\u54cd\u7684\u89d2\u5ea6\uff0c\u6211\u518d\u628a\u8fd9\u56db\u4e2a\u7f13\u51b2\u533a\u5206\u6210\u4e24\u7c7b\u505a\u4e2a\u603b\u7ed3\u3002 \u7f13\u51b2\u533a\u6ea2\u51fa\u5bfc\u81f4\u7f51\u7edc\u8fde\u63a5\u5173\u95ed\uff1a\u666e\u901a\u5ba2\u6237\u7aef\u3001\u8ba2\u9605\u5ba2\u6237\u7aef\uff0c\u4ee5\u53ca\u4ece\u8282\u70b9\u5ba2\u6237\u7aef\uff0c\u5b83\u4eec\u4f7f\u7528\u7684\u7f13\u51b2\u533a\uff0c\u672c\u8d28\u4e0a\u90fd\u662f Redis \u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u4e4b\u95f4\uff0c\u6216\u662f\u4e3b\u4ece\u8282\u70b9\u4e4b\u95f4\u4e3a\u4e86\u4f20\u8f93\u547d\u4ee4\u6570\u636e\u800c\u7ef4\u62a4\u7684\u3002\u8fd9\u4e9b\u7f13\u51b2\u533a\u4e00\u65e6\u53d1\u751f\u6ea2\u51fa\uff0c\u5904\u7406\u673a\u5236\u90fd\u662f\u76f4\u63a5\u628a\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u7684\u8fde\u63a5\uff0c\u6216\u662f\u4e3b\u4ece\u8282\u70b9\u95f4\u7684\u8fde\u63a5\u5173\u95ed\u3002\u7f51\u7edc\u8fde\u63a5\u5173\u95ed\u9020\u6210\u7684\u76f4\u63a5\u5f71\u54cd\uff0c\u5c31\u662f\u4e1a\u52a1\u7a0b\u5e8f\u65e0\u6cd5\u8bfb\u5199 Redis\uff0c\u6216\u8005\u662f\u4e3b\u4ece\u8282\u70b9\u5168\u91cf\u540c\u6b65\u5931\u8d25\uff0c\u9700\u8981\u91cd\u65b0\u6267\u884c\u3002 \u7f13\u51b2\u533a\u6ea2\u51fa\u5bfc\u81f4\u547d\u4ee4\u6570\u636e\u4e22\u5931\uff1a\u4e3b\u8282\u70b9\u4e0a\u7684\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u5c5e\u4e8e\u73af\u5f62\u7f13\u51b2\u533a\uff0c\u4e00\u65e6\u53d1\u751f\u6ea2\u51fa\uff0c\u65b0\u5199\u5165\u7684\u547d\u4ee4\u6570\u636e\u5c31\u4f1a\u8986\u76d6\u65e7\u7684\u547d\u4ee4\u6570\u636e\uff0c\u5bfc\u81f4\u65e7\u547d\u4ee4\u6570\u636e\u7684\u4e22\u5931\uff0c\u8fdb\u800c\u5bfc\u81f4\u4e3b\u4ece\u8282\u70b9\u91cd\u65b0\u8fdb\u884c\u5168\u91cf\u590d\u5236\u3002 \u4ece\u672c\u8d28\u4e0a\u770b\uff0c\u7f13\u51b2\u533a\u6ea2\u51fa\uff0c\u65e0\u975e\u5c31\u662f\u4e09\u4e2a\u539f\u56e0\uff1a \u547d\u4ee4\u6570\u636e\u53d1\u9001\u8fc7\u5feb\u8fc7\u5927\uff1b \u547d\u4ee4\u6570\u636e\u5904\u7406\u8f83\u6162\uff1b \u7f13\u51b2\u533a\u7a7a\u95f4\u8fc7\u5c0f\u3002 \u660e\u767d\u4e86\u8fd9\u4e2a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6709\u9488\u5bf9\u6027\u5730\u62ff\u51fa\u5e94\u5bf9\u7b56\u7565\u4e86\u3002 \u9488\u5bf9\u547d\u4ee4\u6570\u636e\u53d1\u9001\u8fc7\u5feb\u8fc7\u5927\u7684\u95ee\u9898\uff0c\u5bf9\u4e8e\u666e\u901a\u5ba2\u6237\u7aef\u6765\u8bf4\u53ef\u4ee5\u907f\u514d bigkey\uff0c\u800c\u5bf9\u4e8e\u590d\u5236\u7f13\u51b2\u533a\u6765\u8bf4\uff0c\u5c31\u662f\u907f\u514d\u8fc7\u5927\u7684 RDB \u6587\u4ef6\u3002 \u9488\u5bf9\u547d\u4ee4\u6570\u636e\u5904\u7406\u8f83\u6162\u7684\u95ee\u9898\uff0c\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u51cf\u5c11 Redis \u4e3b\u7ebf\u7a0b\u4e0a\u7684\u963b\u585e\u64cd\u4f5c\uff0c\u4f8b\u5982\u4f7f\u7528\u5f02\u6b65\u7684\u5220\u9664\u64cd\u4f5c\u3002 \u9488\u5bf9\u7f13\u51b2\u533a\u7a7a\u95f4\u8fc7\u5c0f\u7684\u95ee\u9898\uff0c\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u4f7f\u7528 client-output-buffer-limit \u914d\u7f6e\u9879\u8bbe\u7f6e\u5408\u7406\u7684\u8f93\u51fa\u7f13\u51b2\u533a\u3001\u590d\u5236\u7f13\u51b2\u533a\u548c\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u5927\u5c0f \u3002\u5f53\u7136\uff0c\u6211\u4eec\u4e0d\u8981\u5fd8\u4e86\uff0c\u8f93\u5165\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u9ed8\u8ba4\u662f\u56fa\u5b9a\u7684\uff0c\u6211\u4eec\u65e0\u6cd5\u901a\u8fc7\u914d\u7f6e\u6765\u4fee\u6539\u5b83\uff0c\u9664\u975e\u76f4\u63a5\u53bb\u4fee\u6539 Redis \u6e90\u7801\u3002","title":"5\u3001Redis\u7f13\u51b2\u533a"},{"location":"chap4/6redis_slow_respone/#2","text":"","title":"2\u3001\u672c\u7ae0\u64cd\u4f5c\u603b\u7ed3"},{"location":"chap4/6redis_slow_respone/#2-1","text":"\u952e\u503c\u5bf9\u5220\u9664 \uff1a\u5f53\u4f60\u7684\u96c6\u5408\u7c7b\u578b\u4e2d\u6709\u5927\u91cf\u5143\u7d20\uff08\u4f8b\u5982\u6709\u767e\u4e07\u7ea7\u522b\u6216\u5343\u4e07\u7ea7\u522b\u5143\u7d20\uff09\u9700\u8981\u5220\u9664\u65f6\uff0c\u6211\u5efa\u8bae\u4f60\u4f7f\u7528 UNLINK \u547d\u4ee4: UNLINK \u6e05\u7a7a\u6570\u636e\u5e93 \uff1a\u53ef\u4ee5\u5728 FLUSHDB \u548c FLUSHALL \u547d\u4ee4\u540e\u52a0\u4e0a ASYNC \u9009\u9879\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8ba9\u540e\u53f0\u5b50\u7ebf\u7a0b\u5f02\u6b65\u5730\u6e05\u7a7a\u6570\u636e\u5e93\uff0c\u5982\u4e0b\u6240\u793a\uff1a FLUSHDB ASYNC FLUSHALL AYSNC","title":"2-1 \u5f02\u6b65\u7684\u5b50\u7ebf\u7a0b\u673a\u5236"},{"location":"chap4/6redis_slow_respone/#2-2-cpu-redis","text":"taskset \u547d\u4ee4\u628a\u4e00\u4e2a\u7a0b\u5e8f\u7ed1\u5b9a\u5728\u4e00\u4e2a\u6838\u4e0a\u8fd0\u884c\u3002 taskset -c 0 ./redis-server \u7ed1\u5b9a\u4ee5\u540e\uff0c\u6211\u4eec\u8fdb\u884c\u4e86\u6d4b\u8bd5\u3002\u6211\u4eec\u53d1\u73b0\uff0c Redis \u5b9e\u4f8b\u7684 GET \u548c PUT \u7684 99% \u5c3e\u5ef6\u8fdf\u4e00\u4e0b\u5b50\u5c31\u5206\u522b\u964d\u5230\u4e86 260 \u5fae\u79d2\u548c 482 \u5fae\u79d2 \uff0c\u8fbe\u5230\u4e86\u6211\u4eec\u671f\u671b\u7684\u76ee\u6807\u3002 CPU \u7684 NUMA \u67b6\u6784\u5bf9 Redis \u6027\u80fd\u7684\u5f71\u54cd \u5047\u8bbe\u6709 2 \u4e2a CPU Socket\uff0c\u6bcf\u4e2a Socket \u4e0a\u6709 6 \u4e2a\u7269\u7406\u6838\uff0c\u6bcf\u4e2a\u7269\u7406\u6838\u53c8\u6709 2 \u4e2a\u903b\u8f91\u6838\uff0c\u603b\u5171 24 \u4e2a\u903b\u8f91\u6838\u3002 \u6211\u4eec\u53ef\u4ee5\u6267\u884c lscpu \u547d\u4ee4 \uff0c\u67e5\u770b\u5230\u8fd9\u4e9b\u6838\u7684\u7f16\u53f7\uff1a lscpu Architecture: x86_64 ... NUMA node0 CPU(s): 0-5,12-17 NUMA node1 CPU(s): 6-11,18-23 NUMA node0 \u7684 CPU \u6838\u7f16\u53f7\u662f 0 \u5230 5\u300112 \u5230 17\u3002 \u5176\u4e2d\uff0c0 \u5230 5 \u662f node0 \u4e0a\u7684 6 \u4e2a\u7269\u7406\u6838\u4e2d\u7684\u7b2c\u4e00\u4e2a\u903b\u8f91\u6838\u7684\u7f16\u53f7\uff0c12 \u5230 17 \u662f\u76f8\u5e94\u7269\u7406\u6838\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u903b\u8f91\u6838\u7f16\u53f7\u3002 taskset -c 0,12 ./redis-server","title":"2-2 CPU \u73af\u5883\u4e0b\u5bf9 Redis \u6027\u80fd\u8fdb\u884c\u8c03\u4f18"},{"location":"chap4/6redis_slow_respone/#2-3-redis","text":"\u57fa\u4e8e\u5f53\u524d\u73af\u5883\u4e0b\u7684 Redis \u57fa\u7ebf\u6027\u80fd\u505a\u5224\u65ad \u5b9e\u9645\u4e0a\uff0c\u4ece 2.8.7 \u7248\u672c\u5f00\u59cb\uff0c redis-cli \u547d\u4ee4\u63d0\u4f9b\u4e86 \u2013intrinsic-latency \u9009\u9879\uff0c\u53ef\u4ee5\u7528\u6765\u76d1\u6d4b\u548c\u7edf\u8ba1\u6d4b\u8bd5\u671f\u95f4\u5185\u7684\u6700\u5927\u5ef6\u8fdf\uff0c\u8fd9\u4e2a\u5ef6\u8fdf\u53ef\u4ee5\u4f5c\u4e3a Redis \u7684\u57fa\u7ebf\u6027\u80fd\u3002\u5176\u4e2d\uff0c\u6d4b\u8bd5\u65f6\u957f\u53ef\u4ee5\u7528 \u2013intrinsic-latency \u9009\u9879\u7684\u53c2\u6570\u6765\u6307\u5b9a\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u8fd0\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u8be5\u547d\u4ee4\u4f1a\u6253\u5370 120 \u79d2\u5185\u76d1\u6d4b\u5230\u7684\u6700\u5927\u5ef6\u8fdf\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u7684\u6700\u5927\u5ef6\u8fdf\u662f 119 \u5fae\u79d2\uff0c\u4e5f\u5c31\u662f\u57fa\u7ebf\u6027\u80fd\u4e3a 119 \u5fae\u79d2\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd0\u884c 120 \u79d2\u5c31\u8db3\u591f\u76d1\u6d4b\u5230\u6700\u5927\u5ef6\u8fdf\u4e86\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u53c2\u6570\u8bbe\u7f6e\u4e3a 120\u3002 ./redis-cli --intrinsic-latency 120 Max latency so far: 17 microseconds. Max latency so far: 44 microseconds. Max latency so far: 94 microseconds. Max latency so far: 110 microseconds. Max latency so far: 119 microseconds. 36481658 total runs (avg latency: 3.2893 microseconds / 3289.32 nanoseconds per run). Worst \u4e0b\u9762\u7684\u6d4b\u8bd5\u7ed3\u679c\uff0c\u663e\u793a\u7684\u5c31\u662f\u67d0\u4e00\u4e2a\u865a\u62df\u673a\u4e0a\u8fd0\u884c Redis \u65f6\u6d4b\u7684\u57fa\u7ebf\u6027\u80fd\u3002 $ ./redis-cli --intrinsic-latency 120 Max latency so far: 692 microseconds. Max latency so far: 915 microseconds. Max latency so far: 2193 microseconds. Max latency so far: 9343 microseconds. Max latency so far: 9871 microseconds. \u53ef\u4ee5\u770b\u5230\uff0c\u7531\u4e8e\u865a\u62df\u5316\u8f6f\u4ef6\u672c\u8eab\u7684\u5f00\u9500\uff0c\u6b64\u65f6\u7684\u57fa\u7ebf\u6027\u80fd\u5df2\u7ecf\u8fbe\u5230\u4e86 9.871ms\u3002 \u5982\u679c\u8be5 Redis \u5b9e\u4f8b\u7684\u8fd0\u884c\u65f6\u5ef6\u8fdf\u4e3a 10ms\uff0c\u8fd9\u5e76\u4e0d\u80fd\u7b97\u4f5c\u6027\u80fd\u53d8\u6162\uff0c\u56e0\u4e3a\u6b64\u65f6\uff0c\u8fd0\u884c\u65f6\u5ef6\u8fdf\u53ea\u6bd4\u57fa\u7ebf\u6027\u80fd\u589e\u52a0\u4e86 1.3%\u3002 \u5982\u679c\u4f60\u4e0d\u4e86\u89e3\u57fa\u7ebf\u6027\u80fd\uff0c\u4e00\u770b\u5230\u8f83\u9ad8\u7684\u8fd0\u884c\u65f6\u5ef6\u8fdf\uff0c\u5c31\u5f88\u6709\u53ef\u80fd\u8bef\u5224 Redis \u53d8\u6162\u4e86\u3002 \u6162\u67e5\u8be2\u547d\u4ee4 \u7528\u5176\u4ed6\u9ad8\u6548\u547d\u4ee4\u4ee3\u66ff\u3002\u6bd4\u5982\u8bf4\uff0c\u5982\u679c\u4f60\u9700\u8981\u8fd4\u56de\u4e00\u4e2a SET \u4e2d\u7684\u6240\u6709\u6210\u5458\u65f6\uff0c \u4e0d\u8981\u4f7f\u7528 SMEMBERS \u547d\u4ee4\uff0c\u800c\u662f\u8981\u4f7f\u7528 SSCAN \u591a\u6b21\u8fed\u4ee3\u8fd4\u56de \uff0c\u907f\u514d\u4e00\u6b21\u8fd4\u56de\u5927\u91cf\u6570\u636e\uff0c\u9020\u6210\u7ebf\u7a0b\u963b\u585e\u3002 \u5f53\u4f60\u9700\u8981\u6267\u884c\u6392\u5e8f\u3001\u4ea4\u96c6\u3001\u5e76\u96c6\u64cd\u4f5c\u65f6\uff0c\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u5b8c\u6210\uff0c\u800c\u4e0d\u8981\u7528 SORT\u3001SUNION\u3001SINTER \u8fd9\u4e9b\u547d\u4ee4\uff0c\u4ee5\u514d\u62d6\u6162 Redis \u5b9e\u4f8b\u3002 \u8fd8\u6709\u4e00\u4e2a\u6bd4\u8f83\u5bb9\u6613\u5ffd\u7565\u7684\u6162\u67e5\u8be2\u547d\u4ee4\uff0c\u5c31\u662f KEYS \u3002 \u5b83\u7528\u4e8e\u8fd4\u56de\u548c\u8f93\u5165\u6a21\u5f0f\u5339\u914d\u7684\u6240\u6709 key\uff0c\u4f8b\u5982\uff0c\u4ee5\u4e0b\u547d\u4ee4\u8fd4\u56de\u6240\u6709\u5305\u542b\u201cname\u201d\u5b57\u7b26\u4e32\u7684 keys\u3002 redis> KEYS *name* 1) \"lastname\" 2) \"firstname\" \u6240\u4ee5\uff0cKEYS \u547d\u4ee4\u4e00\u822c\u4e0d\u88ab\u5efa\u8bae\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u4e2d AOF \u91cd\u5199 \u5728\u4f7f\u7528 AOF \u65e5\u5fd7\u65f6\uff0c\u4e3a\u4e86\u907f\u514d\u65e5\u5fd7\u6587\u4ef6\u4e0d\u65ad\u589e\u5927\uff0cRedis \u4f1a\u6267\u884c AOF \u91cd\u5199\uff0c\u751f\u6210\u4f53\u91cf\u7f29\u5c0f\u7684\u65b0\u7684 AOF \u65e5\u5fd7\u6587\u4ef6\u3002 \u5982\u679c AOF \u5199\u56de\u7b56\u7565\u4f7f\u7528\u4e86 everysec \u6216 always \u914d\u7f6e\uff0c\u8bf7\u5148\u786e\u8ba4\u4e0b\u4e1a\u52a1\u65b9\u5bf9\u6570\u636e\u53ef\u9760\u6027\u7684\u8981\u6c42\uff0c\u660e\u786e\u662f\u5426\u9700\u8981\u6bcf\u4e00\u79d2\u6216\u6bcf\u4e00\u4e2a\u64cd\u4f5c\u90fd\u8bb0\u65e5\u5fd7\u3002 \u5982\u679c\u4e1a\u52a1\u5e94\u7528\u5bf9\u5ef6\u8fdf\u975e\u5e38\u654f\u611f\uff0c\u4f46\u540c\u65f6\u5141\u8bb8\u4e00\u5b9a\u91cf\u7684\u6570\u636e\u4e22\u5931\uff0c\u90a3\u4e48\uff0c\u53ef\u4ee5\u628a\u914d\u7f6e\u9879 no-appendfsync-on-rewrite \u8bbe\u7f6e\u4e3a yes \uff0c\u5982\u4e0b\u6240\u793a\uff1a no-appendfsync-on-rewrite yes \u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a yes \u65f6\uff0c\u8868\u793a\u5728 AOF \u91cd\u5199\u65f6\uff0c\u4e0d\u8fdb\u884c fsync \u64cd\u4f5c\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cRedis \u5b9e\u4f8b\u628a\u5199\u547d\u4ee4\u5199\u5230\u5185\u5b58\u540e\uff0c\u4e0d\u8c03\u7528\u540e\u53f0\u7ebf\u7a0b\u8fdb\u884c fsync \u64cd\u4f5c\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de\u4e86\u3002 \u5f53\u7136\uff0c\u5982\u679c\u6b64\u65f6\u5b9e\u4f8b\u53d1\u751f\u5b95\u673a\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u3002\u53cd\u4e4b\uff0c\u5982\u679c\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a no\uff08\u4e5f\u662f\u9ed8\u8ba4\u914d\u7f6e\uff09\uff0c\u5728 AOF \u91cd\u5199\u65f6\uff0cRedis \u5b9e\u4f8b\u4ecd\u7136\u4f1a\u8c03\u7528\u540e\u53f0\u7ebf\u7a0b\u8fdb\u884c fsync \u64cd\u4f5c\uff0c\u8fd9\u5c31\u4f1a\u7ed9\u5b9e\u4f8b\u5e26\u6765\u963b\u585e\u3002 swap \u800c\u5bfc\u81f4\u6027\u80fd\u964d\u4f4e \u64cd\u4f5c\u7cfb\u7edf\u672c\u8eab\u4f1a\u5728\u540e\u53f0\u8bb0\u5f55\u6bcf\u4e2a\u8fdb\u7a0b\u7684 swap \u4f7f\u7528\u60c5\u51b5\uff0c\u5373\u6709\u591a\u5c11\u6570\u636e\u91cf\u53d1\u751f\u4e86 swap\u3002 $ redis-cli info | grep process_id process_id: 5332 $ cd /proc/5332 $cat smaps | egrep '^(Swap|Size)' Size: 584 kB Swap: 0 kB Size: 4 kB Swap: 4 kB Size: 4 kB Swap: 0 kB Size: 462044 kB Swap: 462008 kB Size: 21392 kB Swap: 0 kB \u5173\u95ed\u5185\u5b58\u5927\u9875 cat /sys/kernel/mm/transparent_hugepage/enabled echo never > /sys/kernel/mm/transparent_hugepage/enabled","title":"2-3 redis\u67e5\u8be2"},{"location":"chap4/6redis_slow_respone/#2-4-redis","text":"\u5982\u4f55\u5224\u65ad\u662f\u5426\u6709\u5185\u5b58\u788e\u7247 INFO memory # Memory used_memory:1073741736 used_memory_human:1024.00M used_memory_rss:1997159792 used_memory_rss_human:1.86G \u2026 mem_fragmentation_ratio:1.86 \u8fd9\u91cc\u6709\u4e00\u4e2a mem_fragmentation_ratio \u7684\u6307\u6807\uff0c\u5b83\u8868\u793a\u7684\u5c31\u662f Redis \u5f53\u524d\u7684\u5185\u5b58\u788e\u7247\u7387\u3002 \u90a3\u4e48\uff0c\u8fd9\u4e2a\u788e\u7247\u7387\u662f\u600e\u4e48\u8ba1\u7b97\u7684\u5462\uff1f\u5176\u5b9e\uff0c\u5c31\u662f\u4e0a\u9762\u7684\u547d\u4ee4\u4e2d\u7684\u4e24\u4e2a\u6307\u6807 used_memory_rss \u548c used_memory \u76f8\u9664\u7684\u7ed3\u679c\u3002 mem_fragmentation_ratio = used_memory_rss/ used_memory mem_fragmentation_ratio \u5927\u4e8e 1.5 \u3002\u8fd9\u8868\u660e\u5185\u5b58\u788e\u7247\u7387\u5df2\u7ecf\u8d85\u8fc7\u4e86 50%\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u9700\u8981\u91c7\u53d6\u4e00\u4e9b\u63aa\u65bd\u6765\u964d\u4f4e\u5185\u5b58\u788e\u7247\u7387\u4e86\u3002 Redis \u4e13\u95e8\u4e3a\u81ea\u52a8\u5185\u5b58\u788e\u7247\u6e05\u7406 \u9996\u5148\uff0cRedis \u9700\u8981\u542f\u7528\u81ea\u52a8\u5185\u5b58\u788e\u7247\u6e05\u7406\uff0c\u53ef\u4ee5\u628a activedefrag \u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a yes \uff0c\u547d\u4ee4\u5982\u4e0b\uff1a config set activedefrag yes \u89e6\u53d1\u5185\u5b58\u6e05\u7406\u6761\u4ef6: \u8fd9\u4e24\u4e2a\u53c2\u6570\u5206\u522b\u8bbe\u7f6e\u4e86\u89e6\u53d1\u5185\u5b58\u6e05\u7406\u7684\u4e00\u4e2a\u6761\u4ef6\uff0c\u5982\u679c\u540c\u65f6\u6ee1\u8db3\u8fd9\u4e24\u4e2a\u6761\u4ef6\uff0c\u5c31\u5f00\u59cb\u6e05\u7406\u3002\u5728\u6e05\u7406\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53ea\u8981\u6709\u4e00\u4e2a\u6761\u4ef6\u4e0d\u6ee1\u8db3\u4e86\uff0c\u5c31\u505c\u6b62\u81ea\u52a8\u6e05\u7406\u3002 active-defrag-ignore-bytes 100mb \uff1a\u8868\u793a\u5185\u5b58\u788e\u7247\u7684\u5b57\u8282\u6570\u8fbe\u5230 100MB \u65f6\uff0c\u5f00\u59cb\u6e05\u7406\uff1b active-defrag-threshold-lower 10 \uff1a\u8868\u793a\u5185\u5b58\u788e\u7247\u7a7a\u95f4\u5360\u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u7ed9 Redis \u7684\u603b\u7a7a\u95f4\u6bd4\u4f8b\u8fbe\u5230 10% \u65f6\uff0c\u5f00\u59cb\u6e05\u7406\u3002 \u51cf\u5c11\u788e\u7247\u6e05\u7406\u5f71\u54cd: active-defrag-cycle-min 25 \uff1a \u8868\u793a\u81ea\u52a8\u6e05\u7406\u8fc7\u7a0b\u6240\u7528 CPU \u65f6\u95f4\u7684\u6bd4\u4f8b\u4e0d\u4f4e\u4e8e 25%\uff0c\u4fdd\u8bc1\u6e05\u7406\u80fd\u6b63\u5e38\u5f00\u5c55\uff1b active-defrag-cycle-max 75 \uff1a\u8868\u793a\u81ea\u52a8\u6e05\u7406\u8fc7\u7a0b\u6240\u7528 CPU \u65f6\u95f4\u7684\u6bd4\u4f8b\u4e0d\u9ad8\u4e8e 75%\uff0c\u4e00\u65e6\u8d85\u8fc7\uff0c\u5c31\u505c\u6b62\u6e05\u7406\uff0c\u4ece\u800c\u907f\u514d\u5728\u6e05\u7406\u65f6\uff0c\u5927\u91cf\u7684\u5185\u5b58\u62f7\u8d1d\u963b\u585e Redis\uff0c\u5bfc\u81f4\u54cd\u5e94\u5ef6\u8fdf\u5347\u9ad8\u3002","title":"2-4 Redis \u5185\u5b58\u788e\u7247"},{"location":"chap4/6redis_slow_respone/#2-5","text":"\u8981\u67e5\u770b\u548c\u670d\u52a1\u5668\u7aef\u76f8\u8fde\u7684\u6bcf\u4e2a\u5ba2\u6237\u7aef\u5bf9\u8f93\u5165\u7f13\u51b2\u533a\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 CLIENT LIST \u547d\u4ee4\uff1a CLIENT LIST id=5 addr=127.0.0.1:50487 fd=9 name= age=4 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=26 qbuf-free=32742 obl=0 oll=0 omem=0 events=r cmd=client CLIENT \u547d\u4ee4\u8fd4\u56de\u7684\u4fe1\u606f\u867d\u7136\u5f88\u591a\uff0c\u4f46\u6211\u4eec\u53ea\u9700\u8981\u91cd\u70b9\u5173\u6ce8\u4e24\u7c7b\u4fe1\u606f\u5c31\u53ef\u4ee5\u4e86\u3002 \u4e00\u7c7b\u662f\u4e0e\u670d\u52a1\u5668\u7aef\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u7684\u4fe1\u606f\u3002 \u8fd9\u4e2a\u6848\u4f8b\u5c55\u793a\u7684\u662f\u4e00\u4e2a\u5ba2\u6237\u7aef\u7684\u8f93\u5165\u7f13\u51b2\u533a\u60c5\u51b5\uff0c\u5982\u679c\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\uff0c\u8f93\u51fa\u7ed3\u679c\u4e2d\u7684 addr \u4f1a\u663e\u793a\u4e0d\u540c\u5ba2\u6237\u7aef\u7684 IP \u548c\u7aef\u53e3\u53f7\u3002 \u53e6\u4e00\u7c7b\u662f\u4e0e\u8f93\u5165\u7f13\u51b2\u533a\u76f8\u5173\u7684\u4e09\u4e2a\u53c2\u6570\uff1a cmd \uff0c \u8868\u793a\u5ba2\u6237\u7aef\u6700\u65b0\u6267\u884c\u7684\u547d\u4ee4 \u3002\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u6267\u884c\u7684\u662f CLIENT \u547d\u4ee4\u3002 qbuf \uff0c \u8868\u793a\u8f93\u5165\u7f13\u51b2\u533a\u5df2\u7ecf\u4f7f\u7528\u7684\u5927\u5c0f \u3002\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u7684 CLIENT \u547d\u4ee4\u5df2\u4f7f\u7528\u4e86 26 \u5b57\u8282\u5927\u5c0f\u7684\u7f13\u51b2\u533a\u3002 qbuf-free \uff0c\u8868\u793a\u8f93\u5165\u7f13\u51b2\u533a\u5c1a\u672a\u4f7f\u7528\u7684\u5927\u5c0f \u3002\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u7684 CLIENT \u547d\u4ee4\u8fd8\u53ef\u4ee5\u4f7f\u7528 32742 \u5b57\u8282\u7684\u7f13\u51b2\u533a\u3002 qbuf \u548c qbuf-free \u7684\u603b\u548c\u5c31\u662f\uff0cRedis \u670d\u52a1\u5668\u7aef\u5f53\u524d\u4e3a\u5df2\u8fde\u63a5\u7684\u8fd9\u4e2a\u5ba2\u6237\u7aef\u5206\u914d\u7684\u7f13\u51b2\u533a\u603b\u5927\u5c0f\u3002\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u603b\u5171\u5206\u914d\u4e86 26 + 32742 = 32768 \u5b57\u8282\uff0c\u4e5f\u5c31\u662f 32KB \u7684\u7f13\u51b2\u533a\u3002 MONITOR \u547d\u4ee4\u662f\u7528\u6765\u76d1\u6d4b Redis \u6267\u884c\u7684\u3002 \u6267\u884c\u8fd9\u4e2a\u547d\u4ee4\u4e4b\u540e\uff0c\u5c31\u4f1a\u6301\u7eed\u8f93\u51fa\u76d1\u6d4b\u5230\u7684\u5404\u4e2a\u547d\u4ee4\u64cd\u4f5c\uff0c\u5982\u4e0b\u6240\u793a\uff1a MONITOR OK 1600617456.437129 [0 127.0.0.1:50487] \"COMMAND\" 1600617477.289667 [0 127.0.0.1:50487] \"info\" \"memory\" MONITOR \u7684\u8f93\u51fa\u7ed3\u679c\u4f1a\u6301\u7eed\u5360\u7528\u8f93\u51fa\u7f13\u51b2\u533a\uff0c\u5e76\u8d8a\u5360\u8d8a\u591a\uff0c\u6700\u540e\u7684\u7ed3\u679c\u5c31\u662f\u53d1\u751f\u6ea2\u51fa\u3002 \u6211\u8981\u7ed9\u4f60\u4e00\u4e2a\u5c0f\u5efa\u8bae\uff1a MONITOR \u547d\u4ee4\u4e3b\u8981\u7528\u5728\u8c03\u8bd5\u73af\u5883\u4e2d\uff0c\u4e0d\u8981\u5728\u7ebf\u4e0a\u751f\u4ea7\u73af\u5883\u4e2d\u6301\u7eed\u4f7f\u7528 MONITOR\u3002 \u5982\u679c\u5728\u7ebf\u4e0a\u73af\u5883\u4e2d\u5076\u5c14\u4f7f\u7528 MONITOR \u68c0\u67e5 Redis \u7684\u547d\u4ee4\u6267\u884c\u60c5\u51b5\uff0c\u662f\u6ca1\u95ee\u9898\u7684\u3002 \u5f53\u6211\u4eec\u7ed9\u666e\u901a\u5ba2\u6237\u7aef\u8bbe\u7f6e\u7f13\u51b2\u533a\u5927\u5c0f\u65f6\uff0c\u901a\u5e38\u53ef\u4ee5\u5728 Redis \u914d\u7f6e\u6587\u4ef6\u4e2d\u8fdb\u884c\u8fd9\u6837\u7684\u8bbe\u7f6e\uff1a client-output-buffer-limit normal 0 0 0 \u5176\u4e2d\uff0cnormal \u8868\u793a\u5f53\u524d\u8bbe\u7f6e\u7684\u662f\u666e\u901a\u5ba2\u6237\u7aef\uff0c \u7b2c 1 \u4e2a 0 \u8bbe\u7f6e\u7684\u662f\u7f13\u51b2\u533a\u5927\u5c0f\u9650\u5236\uff0c\u7b2c 2 \u4e2a 0 \u548c\u7b2c 3 \u4e2a 0 \u5206\u522b\u8868\u793a\u7f13\u51b2\u533a\u6301\u7eed\u5199\u5165\u91cf\u9650\u5236\u548c\u6301\u7eed\u5199\u5165\u65f6\u95f4\u9650\u5236 \u3002 \u6211\u4eec\u4f1a\u7ed9\u8ba2\u9605\u5ba2\u6237\u7aef\u8bbe\u7f6e\u7f13\u51b2\u533a\u5927\u5c0f\u9650\u5236\u3001\u7f13\u51b2\u533a\u6301\u7eed\u5199\u5165\u91cf\u9650\u5236\uff0c\u4ee5\u53ca\u6301\u7eed\u5199\u5165\u65f6\u95f4\u9650\u5236 \uff0c\u53ef\u4ee5\u5728 Redis \u914d\u7f6e\u6587\u4ef6\u4e2d\u8fd9\u6837\u8bbe\u7f6e\uff1a client-output-buffer-limit pubsub 8mb 2mb 60 \u5176\u4e2d\uff0cpubsub \u53c2\u6570\u8868\u793a\u5f53\u524d\u662f\u5bf9\u8ba2\u9605\u5ba2\u6237\u7aef\u8fdb\u884c\u8bbe\u7f6e\uff1b 8mb \u8868\u793a \u8f93\u51fa\u7f13\u51b2\u533a \u7684\u5927\u5c0f\u4e0a\u9650\u4e3a 8MB\uff0c\u4e00\u65e6\u5b9e\u9645\u5360\u7528\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u8981\u8d85\u8fc7 8MB\uff0c\u670d\u52a1\u5668\u7aef\u5c31\u4f1a\u76f4\u63a5\u5173\u95ed\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\uff1b 2mb \u548c 60 \u8868\u793a\uff0c\u5982\u679c\u8fde\u7eed 60 \u79d2\u5185\u5bf9\u8f93\u51fa\u7f13\u51b2\u533a\u7684\u5199\u5165\u91cf\u8d85\u8fc7 2MB \u7684\u8bdd\uff0c\u670d\u52a1\u5668\u7aef\u4e5f\u4f1a\u5173\u95ed\u5ba2\u6237\u7aef\u8fde\u63a5\u3002","title":"2-5 \u7f13\u51b2\u533a\u6ea2\u51fa"},{"location":"chap4/6redis_slow_respone/#3","text":"1\u3001\u95ee\u9898\uff1aRedis \u7684\u5199\u64cd\u4f5c\uff08\u4f8b\u5982 SET\u3001HSET\u3001SADD \u7b49\uff09\u662f\u5728\u5173\u952e\u8def\u5f84\u4e0a\u5417\uff1f \u7b54\u6848\uff1aRedis \u672c\u8eab\u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u6240\u4ee5\uff0c\u5199\u64cd\u4f5c\u90fd\u9700\u8981\u5728\u5185\u5b58\u4e0a\u5b8c\u6210\u6267\u884c\u540e\u624d\u80fd\u8fd4\u56de\uff0c\u8fd9\u5c31\u610f\u5473\u7740\uff0c\u5982\u679c\u8fd9\u4e9b\u5199\u64cd\u4f5c\u5904\u7406\u7684\u662f\u5927\u6570\u636e\u96c6\uff0c\u4f8b\u5982 1 \u4e07\u4e2a\u6570\u636e\uff0c \u90a3\u4e48\uff0c\u4e3b\u7ebf\u7a0b\u9700\u8981\u7b49\u8fd9 1 \u4e07\u4e2a\u6570\u636e\u90fd\u5199\u5b8c\uff0c\u624d\u80fd\u7ee7\u7eed\u6267\u884c\u540e\u9762\u7684\u547d\u4ee4\u3002\u6240\u4ee5\u8bf4\uff0cRedis \u7684\u5199\u64cd\u4f5c\u4e5f\u662f\u5728\u5173\u952e\u8def\u5f84\u4e0a\u7684 \u3002 \u8fd9\u4e2a\u95ee\u9898\u662f\u5e0c\u671b\u4f60\u628a\u9762\u5411\u5185\u5b58\u548c\u9762\u5411\u78c1\u76d8\u7684\u5199\u64cd\u4f5c\u533a\u5206\u5f00\u3002\u5f53\u4e00\u4e2a\u5199\u64cd\u4f5c\u9700\u8981\u628a\u6570\u636e\u5199\u5230\u78c1\u76d8\u65f6\uff0c\u4e00\u822c\u6765\u8bf4\uff0c\u5199\u64cd\u4f5c\u53ea\u8981\u628a\u6570\u636e\u5199\u5230\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u6838\u7f13\u51b2\u533a\u5c31\u884c\u3002\u4e0d\u8fc7\uff0c\u5982\u679c\u6211\u4eec\u6267\u884c\u4e86\u540c\u6b65\u5199\u64cd\u4f5c\uff0c\u90a3\u5c31\u5fc5\u987b\u8981\u7b49\u5230\u6570\u636e\u5199\u56de\u78c1\u76d8\u3002\u6240\u4ee5\uff0c\u9762\u5411\u78c1\u76d8\u7684\u5199\u64cd\u4f5c\u4e00\u822c\u4e0d\u4f1a\u5728\u5173\u952e\u8def\u5f84\u4e0a\u3002 2\u3001\u95ee\u9898\uff1a\u5728\u4e00\u53f0\u6709\u4e24\u4e2a CPU Socket\uff08\u6bcf\u4e2a Socket 8 \u4e2a\u7269\u7406\u6838\uff09\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u6211\u4eec\u90e8\u7f72\u4e86\u4e00\u4e2a\u6709\u7740 8 \u4e2a\u5b9e\u4f8b\u7684 Redis \u5207\u7247\u96c6\u7fa4\uff088 \u4e2a\u5b9e\u4f8b\u90fd\u4e3a\u4e3b\u8282\u70b9\uff0c\u6ca1\u6709\u4e3b\u5907\u5173\u7cfb\uff09\uff0c\u73b0\u5728\u6709\u4e24\u4e2a\u65b9\u6848\uff1a \u5728\u540c\u4e00\u4e2a CPU Socket \u4e0a\u8fd0\u884c 8 \u4e2a\u5b9e\u4f8b\uff0c\u5e76\u548c 8 \u4e2a CPU \u6838\u7ed1\u5b9a\uff1b \u5728\u4e24\u4e2a CPU Socket \u4e0a\u5404\u8fd0\u884c 4 \u4e2a\u5b9e\u4f8b\uff0c\u5e76\u548c\u76f8\u5e94 Socket \u4e0a\u7684\u6838\u7ed1\u5b9a\u3002 \u5982\u679c\u4e0d\u8003\u8651\u7f51\u7edc\u6570\u636e\u8bfb\u53d6\u7684\u5f71\u54cd\uff0c\u4f60\u4f1a\u9009\u62e9\u54ea\u4e2a\u65b9\u6848\u5462\uff1f \u7b54\u6848\uff1a\u5efa\u8bae\u4f7f\u7528\u7b2c\u4e8c\u4e2a\u65b9\u6848\uff0c\u4e3b\u8981\u6709\u4e24\u65b9\u9762\u7684\u539f\u56e0\u3002 \u540c\u4e00\u4e2a CPU Socket \u4e0a\u7684\u8fdb\u7a0b\uff0c\u4f1a\u5171\u4eab L3 \u7f13\u5b58\u3002 \u5982\u679c\u628a 8 \u4e2a\u5b9e\u4f8b\u90fd\u90e8\u7f72\u5728\u540c\u4e00\u4e2a Socket \u4e0a\uff0c\u5b83\u4eec\u4f1a\u7ade\u4e89 L3 \u7f13\u5b58\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u5b83\u4eec\u7684 L3 \u7f13\u5b58\u547d\u4e2d\u7387\u964d\u4f4e\uff0c\u5f71\u54cd\u8bbf\u95ee\u6027\u80fd \u3002 \u540c\u4e00\u4e2a CPU Socket \u4e0a\u7684\u8fdb\u7a0b\uff0c\u4f1a\u4f7f\u7528\u540c\u4e00\u4e2a Socket \u4e0a\u7684\u5185\u5b58\u7a7a\u95f4\u30028 \u4e2a\u5b9e\u4f8b\u5171\u4eab\u540c\u4e00\u4e2a Socket \u4e0a\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u80af\u5b9a\u4f1a\u7ade\u4e89\u5185\u5b58\u8d44\u6e90\u3002 \u5982\u679c\u6709\u5b9e\u4f8b\u4fdd\u5b58\u7684\u6570\u636e\u91cf\u5927\uff0c\u5176\u4ed6\u5b9e\u4f8b\u80fd\u7528\u5230\u7684\u5185\u5b58\u7a7a\u95f4\u53ef\u80fd\u5c31\u4e0d\u591f\u4e86\uff0c\u6b64\u65f6\uff0c\u5176\u4ed6\u5b9e\u4f8b\u5c31\u4f1a\u8de8 Socket \u7533\u8bf7\u5185\u5b58\uff0c\u8fdb\u800c\u9020\u6210\u8de8 Socket \u8bbf\u95ee\u5185\u5b58\uff0c\u9020\u6210\u5b9e\u4f8b\u7684\u6027\u80fd\u964d\u4f4e\u3002 \u53e6\u5916\uff0c\u5728\u5207\u7247\u96c6\u7fa4\u4e2d\uff0c\u4e0d\u540c\u5b9e\u4f8b\u95f4\u901a\u8fc7\u7f51\u7edc\u8fdb\u884c\u6d88\u606f\u901a\u4fe1\u548c\u6570\u636e\u8fc1\u79fb\uff0c\u5e76\u4e0d\u4f1a\u4f7f\u7528\u5171\u4eab\u5185\u5b58\u7a7a\u95f4\u8fdb\u884c\u8de8\u5b9e\u4f8b\u7684\u6570\u636e\u8bbf\u95ee\u3002\u6240\u4ee5\uff0c\u5373\u4f7f\u628a\u4e0d\u540c\u7684\u5b9e\u4f8b\u90e8\u7f72\u5230\u4e0d\u540c\u7684 Socket \u4e0a\uff0c\u5b83\u4eec\u4e4b\u95f4\u4e5f\u4e0d\u4f1a\u53d1\u751f\u8de8 Socket \u5185\u5b58\u7684\u8bbf\u95ee\uff0c\u4e0d\u4f1a\u53d7\u8de8 Socket \u5185\u5b58\u8bbf\u95ee\u7684\u8d1f\u9762\u5f71\u54cd\u3002 3\u3001\u95ee\u9898\uff1a\u5728 Redis \u4e2d\uff0c\u8fd8\u6709\u54ea\u4e9b\u547d\u4ee4\u53ef\u4ee5\u4ee3\u66ff KEYS \u547d\u4ee4\uff0c\u5b9e\u73b0\u5bf9\u952e\u503c\u5bf9\u7684 key \u7684\u6a21\u7cca\u67e5\u8be2\u5462\uff1f\u8fd9\u4e9b\u547d\u4ee4\u7684\u590d\u6742\u5ea6\u4f1a\u5bfc\u81f4 Redis \u53d8\u6162\u5417\uff1f \uff1aRedis \u63d0\u4f9b\u7684 SCAN \u547d\u4ee4\uff0c\u4ee5\u53ca\u9488\u5bf9\u96c6\u5408\u7c7b\u578b\u6570\u636e\u63d0\u4f9b\u7684 SSCAN\u3001HSCAN \u7b49\uff0c\u53ef\u4ee5\u6839\u636e\u6267\u884c\u65f6\u8bbe\u5b9a\u7684\u6570\u91cf\u53c2\u6570\uff0c\u8fd4\u56de\u6307\u5b9a\u6570\u91cf\u7684\u6570\u636e\uff0c\u8fd9\u5c31\u53ef\u4ee5\u907f\u514d\u50cf KEYS \u547d\u4ee4\u4e00\u6837\u540c\u65f6\u8fd4\u56de\u6240\u6709\u5339\u914d\u7684\u6570\u636e\uff0c\u4e0d\u4f1a\u5bfc\u81f4 Redis \u53d8\u6162\u3002 \u4ee5 HSCAN \u4e3a\u4f8b\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c \u4ece user \u8fd9\u4e2a Hash \u96c6\u5408\u4e2d\u8fd4\u56de key \u524d\u7f00\u4ee5 103 \u5f00\u5934\u7684 100 \u4e2a\u952e\u503c\u5bf9\u3002 HSCAN user 0 match \"103*\" 100 4\u3001\u4f60\u9047\u5230\u8fc7 Redis \u53d8\u6162\u7684\u60c5\u51b5\u5417\uff1f\u5982\u679c\u6709\u7684\u8bdd\uff0c\u4f60\u662f\u600e\u4e48\u89e3\u51b3\u7684\u5462\uff1f \u4f7f\u7528\u590d\u6742\u5ea6\u8fc7\u9ad8\u7684\u547d\u4ee4\u6216\u4e00\u6b21\u67e5\u8be2\u5168\u91cf\u6570\u636e\uff1b\u64cd\u4f5c bigkey\uff1b \u5927\u91cf key \u96c6\u4e2d\u8fc7\u671f\uff1b\u5185\u5b58\u8fbe\u5230 maxmemory\uff1b \u5ba2\u6237\u7aef\u4f7f\u7528\u77ed\u8fde\u63a5\u548c Redis \u76f8\u8fde\uff1b \u5f53 Redis \u5b9e\u4f8b\u7684\u6570\u636e\u91cf\u5927\u65f6\uff0c\u65e0\u8bba\u662f\u751f\u6210 RDB\uff0c\u8fd8\u662f AOF \u91cd\u5199\uff0c\u90fd\u4f1a\u5bfc\u81f4 fork \u8017\u65f6\u4e25\u91cd\uff1b AOF \u7684\u5199\u56de\u7b56\u7565\u4e3a always\uff0c\u5bfc\u81f4\u6bcf\u4e2a\u64cd\u4f5c\u90fd\u8981\u540c\u6b65\u5237\u56de\u78c1\u76d8\uff1b Redis \u5b9e\u4f8b\u8fd0\u884c\u673a\u5668\u7684\u5185\u5b58\u4e0d\u8db3\uff0c\u5bfc\u81f4 swap \u53d1\u751f\uff0cRedis \u9700\u8981\u5230 swap \u5206\u533a\u8bfb\u53d6\u6570\u636e\uff1b \u8fdb\u7a0b\u7ed1\u5b9a CPU \u4e0d\u5408\u7406\uff1b Redis \u5b9e\u4f8b\u8fd0\u884c\u673a\u5668\u4e0a\u5f00\u542f\u4e86\u900f\u660e\u5185\u5b58\u5927\u9875\u673a\u5236\uff1b \u7f51\u5361\u538b\u529b\u8fc7\u5927\u3002 5\u3001\u95ee\u9898\uff1a\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 mem_fragmentation_ratio \u6765\u5224\u65ad Redis \u5f53\u524d\u7684\u5185\u5b58\u788e\u7247\u7387\u662f\u5426\u4e25\u91cd\uff0c\u6211\u7ed9\u51fa\u7684\u7ecf\u9a8c\u9608\u503c\u90fd\u662f\u5927\u4e8e 1 \u7684\u3002\u6211\u60f3\u8bf7\u4f60\u601d\u8003\u4e00\u4e0b\uff0c\u5982\u679c mem_fragmentation_ratio \u5c0f\u4e8e 1\uff0cRedis \u7684\u5185\u5b58\u4f7f\u7528\u662f\u4ec0\u4e48\u60c5\u51b5\u5462\uff1f\u4f1a\u5bf9 Redis \u7684\u6027\u80fd\u548c\u5185\u5b58\u7a7a\u95f4\u5229\u7528\u7387\u9020\u6210\u4ec0\u4e48\u5f71\u54cd\u5462\uff1f \u7b54\u6848\uff1a\u5982\u679c mem_fragmentation_ratio \u5c0f\u4e8e 1\uff0c\u5c31\u8868\u660e\uff0c \u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u7ed9 Redis \u7684\u5185\u5b58\u7a7a\u95f4\u5df2\u7ecf\u5c0f\u4e8e Redis \u6240\u7533\u8bf7\u7684\u7a7a\u95f4\u5927\u5c0f\u4e86\uff0c\u6b64\u65f6\uff0c\u8fd0\u884c Redis \u5b9e\u4f8b\u7684\u670d\u52a1\u5668\u4e0a\u7684\u5185\u5b58\u5df2\u7ecf\u4e0d\u591f\u7528\u4e86 \uff0c\u53ef\u80fd\u5df2\u7ecf\u53d1\u751f swap \u4e86\u3002\u8fd9\u6837\u4e00\u6765\uff0cRedis \u7684\u8bfb\u5199\u6027\u80fd\u4e5f\u4f1a\u53d7\u5230\u5f71\u54cd\uff0c\u56e0\u4e3a Redis \u5b9e\u4f8b\u9700\u8981\u5728\u78c1\u76d8\u4e0a\u7684 swap \u5206\u533a\u4e2d\u8bfb\u5199\u6570\u636e\uff0c\u901f\u5ea6\u8f83\u6162\u3002 6\u3001\u5728\u548c Redis \u5b9e\u4f8b\u4ea4\u4e92\u65f6\uff0c\u5e94\u7528\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u7684\u5ba2\u6237\u7aef\u9700\u8981\u4f7f\u7528\u7f13\u51b2\u533a\u5417\uff1f\u5982\u679c\u4f7f\u7528\u7684\u8bdd\uff0c\u5bf9 Redis \u7684\u6027\u80fd\u548c\u5185\u5b58\u4f7f\u7528\u4f1a\u6709\u5f71\u54cd\u5417\uff1f \u7b54\u6848\uff1a \u5e94\u7528\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u7684 Redis \u5ba2\u6237\u7aef\uff0c\u9700\u8981\u628a\u8981\u53d1\u9001\u7684\u8bf7\u6c42\u6682\u5b58\u5728\u7f13\u51b2\u533a \u3002\u8fd9\u6709\u4e24\u65b9\u9762\u7684\u597d\u5904\u3002 \u4e00\u65b9\u9762\uff0c \u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u63a7\u5236\u53d1\u9001\u901f\u7387\uff0c\u907f\u514d\u628a\u8fc7\u591a\u7684\u8bf7\u6c42\u4e00\u4e0b\u5b50\u5168\u90e8\u53d1\u5230 Redis \u5b9e\u4f8b \uff0c\u5bfc\u81f4\u5b9e\u4f8b\u56e0\u538b\u529b\u8fc7\u5927\u800c\u6027\u80fd\u4e0b\u964d\u3002\u4e0d\u8fc7\uff0c\u5ba2\u6237\u7aef\u7f13\u51b2\u533a\u4e0d\u4f1a\u592a\u5927\uff0c\u6240\u4ee5\uff0c\u5bf9 Redis \u5b9e\u4f8b\u7684\u5185\u5b58\u4f7f\u7528\u6ca1\u6709\u4ec0\u4e48\u5f71\u54cd\u3002 \u53e6\u4e00\u65b9\u9762\uff0c \u5728\u5e94\u7528 Redis \u4e3b\u4ece\u96c6\u7fa4\u65f6\uff0c\u4e3b\u4ece\u8282\u70b9\u8fdb\u884c\u6545\u969c\u5207\u6362\u662f\u9700\u8981\u4e00\u5b9a\u65f6\u95f4\u7684\uff0c\u6b64\u65f6\uff0c\u4e3b\u8282\u70b9\u65e0\u6cd5\u670d\u52a1\u5916\u6765\u8bf7\u6c42 \u3002\u5982\u679c\u5ba2\u6237\u7aef\u6709\u7f13\u51b2\u533a\u6682\u5b58\u8bf7\u6c42\uff0c\u90a3\u4e48\uff0c\u5ba2\u6237\u7aef\u4ecd\u7136\u53ef\u4ee5\u6b63\u5e38\u63a5\u6536\u4e1a\u52a1\u5e94\u7528\u7684\u8bf7\u6c42\uff0c\u8fd9\u5c31\u53ef\u4ee5\u907f\u514d\u76f4\u63a5\u7ed9\u5e94\u7528\u8fd4\u56de\u65e0\u6cd5\u670d\u52a1\u7684\u9519\u8bef\u3002","title":"3\u3001\u672c\u7ae0\u95ee\u9898"},{"location":"chap4/6redis_slow_respone/#4_1","text":"\u95ee\u9898 1\uff1a\u5982\u4f55\u4f7f\u7528\u6162\u67e5\u8be2\u65e5\u5fd7\u548c latency monitor \u6392\u67e5\u6267\u884c\u6162\u7684\u64cd\u4f5c\uff1f Redis \u7684\u6162\u67e5\u8be2\u65e5\u5fd7\u8bb0\u5f55\u4e86\u6267\u884c\u65f6\u95f4\u8d85\u8fc7\u4e00\u5b9a\u9608\u503c\u7684\u547d\u4ee4\u64cd\u4f5c\u3002\u5f53\u6211\u4eec\u53d1\u73b0 Redis \u54cd\u5e94\u53d8\u6162\u3001\u8bf7\u6c42\u5ef6\u8fdf\u589e\u52a0\u65f6\uff0c\u5c31\u53ef\u4ee5\u5728\u6162\u67e5\u8be2\u65e5\u5fd7\u4e2d\u8fdb\u884c\u67e5\u627e\uff0c\u786e\u5b9a\u7a76\u7adf\u662f\u54ea\u4e9b\u547d\u4ee4\u6267\u884c\u65f6\u95f4\u5f88\u957f\u3002 \u5728\u4f7f\u7528\u6162\u67e5\u8be2\u65e5\u5fd7\u524d\uff0c\u6211\u4eec\u9700\u8981\u8bbe\u7f6e\u4e24\u4e2a\u53c2\u6570\u3002 slowlog-log-slower-than \uff1a\u8fd9\u4e2a\u53c2\u6570\u8868\u793a\uff0c\u6162\u67e5\u8be2\u65e5\u5fd7\u5bf9\u6267\u884c\u65f6\u95f4\u5927\u4e8e\u591a\u5c11\u5fae\u79d2\u7684\u547d\u4ee4\u8fdb\u884c\u8bb0\u5f55\u3002 slowlog-max-len \uff1a\u8fd9\u4e2a\u53c2\u6570\u8868\u793a\uff0c\u6162\u67e5\u8be2\u65e5\u5fd7\u6700\u591a\u80fd\u8bb0\u5f55\u591a\u5c11\u6761\u547d\u4ee4\u8bb0\u5f55 \u3002\u6162\u67e5\u8be2\u65e5\u5fd7\u7684\u5e95\u5c42\u5b9e\u73b0\u662f\u4e00\u4e2a\u5177\u6709\u9884\u5b9a\u5927\u5c0f\u7684\u5148\u8fdb\u5148\u51fa\u961f\u5217\uff0c\u4e00\u65e6\u8bb0\u5f55\u7684\u547d\u4ee4\u6570\u91cf\u8d85\u8fc7\u4e86\u961f\u5217\u957f\u5ea6\uff0c\u6700\u5148\u8bb0\u5f55\u7684\u547d\u4ee4\u64cd\u4f5c\u5c31\u4f1a\u88ab\u5220\u9664\u3002\u8fd9\u4e2a\u503c\u9ed8\u8ba4\u662f 128\u3002\u4f46\u662f\uff0c\u5982\u679c\u6162\u67e5\u8be2\u547d\u4ee4\u8f83\u591a\u7684\u8bdd\uff0c\u65e5\u5fd7\u91cc\u5c31\u5b58\u4e0d\u4e0b\u4e86\uff1b\u5982\u679c\u8fd9\u4e2a\u503c\u592a\u5927\u4e86\uff0c\u53c8\u4f1a\u5360\u7528\u4e00\u5b9a\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u6240\u4ee5\uff0c\u4e00\u822c\u5efa\u8bae\u8bbe\u7f6e\u4e3a 1000 \u5de6\u53f3\uff0c\u8fd9\u6837\u65e2\u53ef\u4ee5\u591a\u8bb0\u5f55\u4e9b\u6162\u67e5\u8be2\u547d\u4ee4\uff0c\u65b9\u4fbf\u6392\u67e5\uff0c\u4e5f\u53ef\u4ee5\u907f\u514d\u5185\u5b58\u5f00\u9500\u3002 \u8bbe\u7f6e\u597d\u53c2\u6570\u540e\uff0c\u6162\u67e5\u8be2\u65e5\u5fd7\u5c31\u4f1a\u628a\u6267\u884c\u65f6\u95f4\u8d85\u8fc7 slowlog-log-slower-than \u9608\u503c\u7684\u547d\u4ee4\u64cd\u4f5c\u8bb0\u5f55\u5728\u65e5\u5fd7\u4e2d\u3002 \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 SLOWLOG GET \u547d\u4ee4\uff0c\u6765\u67e5\u770b\u6162\u67e5\u8be2\u65e5\u5fd7\u4e2d\u8bb0\u5f55\u7684\u547d\u4ee4\u64cd\u4f5c\uff0c\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u53ef\u4ee5\u67e5\u770b\u6700\u8fd1\u7684\u4e00\u6761\u6162\u67e5\u8be2\u7684\u65e5\u5fd7\u4fe1\u606f\u3002 SLOWLOG GET 1 1) 1) (integer) 33 //\u6bcf\u6761\u65e5\u5fd7\u7684\u552f\u4e00ID\u7f16\u53f7 2) (integer) 1600990583 //\u547d\u4ee4\u6267\u884c\u65f6\u7684\u65f6\u95f4\u6233 3) (integer) 20906 //\u547d\u4ee4\u6267\u884c\u7684\u65f6\u957f\uff0c\u5355\u4f4d\u662f\u5fae\u79d2 4) 1) \"keys\" //\u5177\u4f53\u7684\u6267\u884c\u547d\u4ee4\u548c\u53c2\u6570 2) \"abc*\" 5) \"127.0.0.1:54793\" //\u5ba2\u6237\u7aef\u7684IP\u548c\u7aef\u53e3\u53f7 6) \"\" //\u5ba2\u6237\u7aef\u7684\u540d\u79f0\uff0c\u6b64\u5904\u4e3a\u7a7a \u53ef\u4ee5\u770b\u5230\uff0c KEYS \"abc*\" \u8fd9\u6761\u547d\u4ee4\u7684\u6267\u884c\u65f6\u95f4\u662f 20906 \u5fae\u79d2\uff0c\u5927\u7ea6 20 \u6beb\u79d2\uff0c\u7684\u786e\u662f\u4e00\u6761\u6267\u884c\u8f83\u6162\u7684\u547d\u4ee4\u64cd\u4f5c\u3002 \u5982\u679c\u6211\u4eec\u60f3\u67e5\u770b\u66f4\u591a\u7684\u6162\u65e5\u5fd7\uff0c\u53ea\u8981\u628a SLOWLOG GET \u540e\u9762\u7684\u6570\u5b57\u53c2\u6570\u6539\u4e3a\u60f3\u67e5\u770b\u7684\u65e5\u5fd7\u6761\u6570\uff0c\u5c31\u53ef\u4ee5\u4e86\u3002 \u9664\u4e86\u6162\u67e5\u8be2\u65e5\u5fd7\u4ee5\u5916\uff0cRedis \u4ece 2.8.13 \u7248\u672c\u5f00\u59cb\uff0c\u8fd8\u63d0\u4f9b\u4e86 latency monitor \u76d1\u63a7\u5de5\u5177\uff0c\u8fd9\u4e2a\u5de5\u5177\u53ef\u4ee5\u7528\u6765\u76d1\u63a7 Redis \u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u5cf0\u503c\u5ef6\u8fdf\u60c5\u51b5\u3002 \u548c\u6162\u67e5\u8be2\u65e5\u5fd7\u7684\u8bbe\u7f6e\u76f8\u7c7b\u4f3c\uff0c\u8981\u4f7f\u7528 latency monitor \uff0c\u9996\u5148\u8981\u8bbe\u7f6e\u547d\u4ee4\u6267\u884c\u65f6\u957f\u7684\u9608\u503c\u3002\u5f53\u4e00\u4e2a\u547d\u4ee4\u7684\u5b9e\u9645\u6267\u884c\u65f6\u957f\u8d85\u8fc7\u8be5\u9608\u503c\u65f6\uff0c\u5c31\u4f1a\u88ab latency monitor \u76d1\u63a7\u5230\u3002\u6bd4\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u628a latency monitor \u76d1\u63a7\u7684\u547d\u4ee4\u6267\u884c\u65f6\u957f\u9608\u503c\u8bbe\u4e3a 1000 \u5fae\u79d2\uff0c\u5982\u4e0b\u6240\u793a\uff1a config set latency-monitor-threshold 1000 \u8bbe\u7f6e\u597d\u4e86 latency monitor \u7684\u53c2\u6570\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 latency latest \u547d\u4ee4\uff0c\u67e5\u770b\u6700\u65b0\u548c\u6700\u5927\u7684\u8d85\u8fc7\u9608\u503c\u7684\u5ef6\u8fdf\u60c5\u51b5\uff0c\u5982\u4e0b\u6240\u793a\uff1a latency latest 1) 1) \"command\" 2) (integer) 1600991500 //\u547d\u4ee4\u6267\u884c\u7684\u65f6\u95f4\u6233 3) (integer) 2500 //\u6700\u8fd1\u7684\u8d85\u8fc7\u9608\u503c\u7684\u5ef6\u8fdf 4) (integer) 10100 //\u6700\u5927\u7684\u8d85\u8fc7\u9608\u503c\u7684\u5ef6\u8fdf \u95ee\u9898 2\uff1a\u5982\u4f55\u6392\u67e5 Redis \u7684 bigkey\uff1f \u5728\u5e94\u7528 Redis \u65f6\uff0c\u6211\u4eec\u8981\u5c3d\u91cf\u907f\u514d bigkey \u7684\u4f7f\u7528\uff0c\u8fd9\u662f\u56e0\u4e3a\uff0cRedis \u4e3b\u7ebf\u7a0b\u5728\u64cd\u4f5c bigkey \u65f6\uff0c\u4f1a\u88ab\u963b\u585e\u3002\u90a3\u4e48\uff0c\u4e00\u65e6\u4e1a\u52a1\u5e94\u7528\u4e2d\u4f7f\u7528\u4e86 bigkey\uff0c\u6211\u4eec\u8be5\u5982\u4f55\u8fdb\u884c\u6392\u67e5\u5462\uff1f Redis \u53ef\u4ee5\u5728\u6267\u884c redis-cli \u547d\u4ee4\u65f6\u5e26\u4e0a \u2013bigkeys \u9009\u9879\uff0c\u8fdb\u800c\u5bf9\u6574\u4e2a\u6570\u636e\u5e93\u4e2d\u7684\u952e\u503c\u5bf9\u5927\u5c0f\u60c5\u51b5\u8fdb\u884c\u7edf\u8ba1\u5206\u6790\uff0c\u6bd4\u5982\u8bf4\uff0c\u7edf\u8ba1\u6bcf\u79cd\u6570\u636e\u7c7b\u578b\u7684\u952e\u503c\u5bf9\u4e2a\u6570\u4ee5\u53ca\u5e73\u5747\u5927\u5c0f\u3002 \u6b64\u5916\uff0c\u8fd9\u4e2a\u547d\u4ee4\u6267\u884c\u540e\uff0c\u4f1a\u8f93\u51fa\u6bcf\u79cd\u6570\u636e\u7c7b\u578b\u4e2d\u6700\u5927\u7684 bigkey \u7684\u4fe1\u606f\uff0c\u5bf9\u4e8e String \u7c7b\u578b\u6765\u8bf4\uff0c\u4f1a\u8f93\u51fa\u6700\u5927 bigkey \u7684\u5b57\u8282\u957f\u5ea6\uff0c\u5bf9\u4e8e\u96c6\u5408\u7c7b\u578b\u6765\u8bf4\uff0c\u4f1a\u8f93\u51fa\u6700\u5927 bigkey \u7684\u5143\u7d20\u4e2a\u6570\uff0c\u5982\u4e0b\u6240\u793a\uff1a ./redis-cli --bigkeys -------- summary ------- Sampled 32 keys in the keyspace! Total key length in bytes is 184 (avg len 5.75) //\u7edf\u8ba1\u6bcf\u79cd\u6570\u636e\u7c7b\u578b\u4e2d\u5143\u7d20\u4e2a\u6570\u6700\u591a\u7684bigkey Biggest list found 'product1' has 8 items Biggest hash found 'dtemp' has 5 fields Biggest string found 'page2' has 28 bytes Biggest stream found 'mqstream' has 4 entries Biggest set found 'userid' has 5 members Biggest zset found 'device:temperature' has 6 members //\u7edf\u8ba1\u6bcf\u79cd\u6570\u636e\u7c7b\u578b\u7684\u603b\u952e\u503c\u4e2a\u6570\uff0c\u5360\u6240\u6709\u952e\u503c\u4e2a\u6570\u7684\u6bd4\u4f8b\uff0c\u4ee5\u53ca\u5e73\u5747\u5927\u5c0f 4 lists with 15 items (12.50% of keys, avg size 3.75) 5 hashs with 14 fields (15.62% of keys, avg size 2.80) 10 strings with 68 bytes (31.25% of keys, avg size 6.80) 1 streams with 4 entries (03.12% of keys, avg size 4.00) 7 sets with 19 members (21.88% of keys, avg size 2.71) 5 zsets with 17 members (15.62% of keys, avg size 3.40) \u4e0d\u8fc7\uff0c\u5728\u4f7f\u7528 \u2013bigkeys \u9009\u9879\u65f6\uff0c\u6709\u4e00\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\u4e00\u4e0b\u3002 \u8fd9\u4e2a\u5de5\u5177\u662f\u901a\u8fc7\u626b\u63cf\u6570\u636e\u5e93\u6765\u67e5\u627e bigkey \u7684\uff0c\u6240\u4ee5\uff0c\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u5bf9 Redis \u5b9e\u4f8b\u7684\u6027\u80fd\u4ea7\u751f\u5f71\u54cd\u3002\u5982\u679c\u4f60\u5728\u4f7f\u7528\u4e3b\u4ece\u96c6\u7fa4\uff0c\u6211\u5efa\u8bae\u4f60\u5728\u4ece\u8282\u70b9\u4e0a\u6267\u884c\u8be5\u547d\u4ee4 \u56e0\u4e3a\u4e3b\u8282\u70b9\u4e0a\u6267\u884c\u65f6\uff0c\u4f1a\u963b\u585e\u4e3b\u8282\u70b9\u3002\u5982\u679c\u6ca1\u6709\u4ece\u8282\u70b9\uff0c\u90a3\u4e48\uff0c\u6211\u7ed9\u4f60\u4e24\u4e2a\u5c0f\u5efa\u8bae\uff1a \u7b2c\u4e00\u4e2a\u5efa\u8bae\u662f\uff0c\u5728 Redis \u5b9e\u4f8b\u4e1a\u52a1\u538b\u529b\u7684\u4f4e\u5cf0\u9636\u6bb5\u8fdb\u884c\u626b\u63cf\u67e5\u8be2\uff0c\u4ee5\u514d\u5f71\u54cd\u5230\u5b9e\u4f8b\u7684\u6b63\u5e38\u8fd0\u884c\uff1b \u7b2c\u4e8c\u4e2a\u5efa\u8bae\u662f\uff0c\u53ef\u4ee5\u4f7f\u7528 -i \u53c2\u6570\u63a7\u5236\u626b\u63cf\u95f4\u9694\uff0c\u907f\u514d\u957f\u65f6\u95f4\u626b\u63cf\u964d\u4f4e Redis \u5b9e\u4f8b\u7684\u6027\u80fd\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u65f6\uff0c redis-cli \u4f1a\u6bcf\u626b\u63cf 100 \u6b21\u6682\u505c 100 \u6beb\u79d2\uff080.1 \u79d2\uff09\u3002 ./redis-cli --bigkeys -i 0.1 \u5f53\u7136\uff0c\u4f7f\u7528 Redis \u81ea\u5e26\u7684 \u2013bigkeys \u9009\u9879\u6392\u67e5 bigkey \uff0c\u6709\u4e24\u4e2a\u4e0d\u8db3\u7684\u5730\u65b9\uff1a \u8fd9\u4e2a\u65b9\u6cd5\u53ea\u80fd\u8fd4\u56de\u6bcf\u79cd\u7c7b\u578b\u4e2d\u6700\u5927\u7684\u90a3\u4e2a bigkey\uff0c\u65e0\u6cd5\u5f97\u5230\u5927\u5c0f\u6392\u5728\u524d N \u4f4d\u7684 bigkey\uff1b \u5bf9\u4e8e\u96c6\u5408\u7c7b\u578b\u6765\u8bf4\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u53ea\u7edf\u8ba1\u96c6\u5408\u5143\u7d20\u4e2a\u6570\u7684\u591a\u5c11\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u5360\u7528\u7684\u5185\u5b58\u91cf\u3002\u4f46\u662f\uff0c\u4e00\u4e2a\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u4e2a\u6570\u591a\uff0c\u5e76\u4e0d\u4e00\u5b9a\u5360\u7528\u7684\u5185\u5b58\u5c31\u591a\u3002\u56e0\u4e3a\uff0c\u6709\u53ef\u80fd\u6bcf\u4e2a\u5143\u7d20\u5360\u7528\u7684\u5185\u5b58\u5f88\u5c0f\uff0c\u8fd9\u6837\u7684\u8bdd\uff0c\u5373\u4f7f\u5143\u7d20\u4e2a\u6570\u6709\u5f88\u591a\uff0c\u603b\u5185\u5b58\u5f00\u9500\u4e5f\u4e0d\u5927\u3002 \u5f00\u53d1\u601d\u8def\uff1a\u4f7f\u7528 SCAN \u547d\u4ee4\u5bf9\u6570\u636e\u5e93\u626b\u63cf\uff0c\u7136\u540e\u7528 TYPE \u547d\u4ee4\u83b7\u53d6\u8fd4\u56de\u7684\u6bcf\u4e00\u4e2a key \u7684\u7c7b\u578b\u3002\u63a5\u4e0b\u6765\uff0c\u5bf9\u4e8e String \u7c7b\u578b\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 STRLEN \u547d\u4ee4\u83b7\u53d6\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\uff0c\u4e5f\u5c31\u662f\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u5b57\u8282\u6570\u3002 \u5982\u679c\u4f60\u80fd\u591f\u9884\u5148\u4ece\u4e1a\u52a1\u5c42\u77e5\u9053\u96c6\u5408\u5143\u7d20\u7684\u5e73\u5747\u5927\u5c0f\uff0c\u90a3\u4e48\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u83b7\u53d6\u96c6\u5408\u5143\u7d20\u7684\u4e2a\u6570\uff0c\u7136\u540e\u4e58\u4ee5\u96c6\u5408\u5143\u7d20\u7684\u5e73\u5747\u5927\u5c0f\uff0c\u8fd9\u6837\u5c31\u80fd\u83b7\u5f97\u96c6\u5408\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f\u4e86\u3002 List \u7c7b\u578b\uff1aLLEN \u547d\u4ee4\uff1b Hash \u7c7b\u578b\uff1aHLEN \u547d\u4ee4\uff1b Set \u7c7b\u578b\uff1aSCARD \u547d\u4ee4\uff1b Sorted Set \u7c7b\u578b\uff1aZCARD \u547d\u4ee4\uff1b \u5982\u679c\u4f60\u4e0d\u80fd\u63d0\u524d\u77e5\u9053\u5199\u5165\u96c6\u5408\u7684\u5143\u7d20\u5927\u5c0f\uff0c\u53ef\u4ee5\u4f7f\u7528 MEMORY USAGE \u547d\u4ee4\uff08\u9700\u8981 Redis 4.0 \u53ca\u4ee5\u4e0a\u7248\u672c\uff09\uff0c\u67e5\u8be2\u4e00\u4e2a\u952e\u503c\u5bf9\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u4f8b\u5982\uff0c\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u53ef\u4ee5\u83b7\u5f97 key \u4e3a user:info \u8fd9\u4e2a\u96c6\u5408\u7c7b\u578b\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u5927\u5c0f\u3002 MEMORY USAGE user:info (integer) 315663239","title":"4\u3001\u4ee3\u8868\u6027\u95ee\u9898"},{"location":"chap5/1redis_cache/","text":"\u7b2c\u4e00\u8282 Redis \u65c1\u8def\u7f13\u5b58 Redis \u63d0\u4f9b\u4e86\u9ad8\u6027\u80fd\u7684\u6570\u636e\u5b58\u53d6\u529f\u80fd\uff0c\u6240\u4ee5\u5e7f\u6cdb\u5e94\u7528\u5728\u7f13\u5b58\u573a\u666f\u4e2d\uff0c\u65e2\u80fd\u6709\u6548\u5730\u63d0\u5347\u4e1a\u52a1\u5e94\u7528\u7684\u54cd\u5e94\u901f\u5ea6\uff0c\u8fd8\u53ef\u4ee5\u907f\u514d\u628a\u9ad8\u5e76\u53d1\u5927\u538b\u529b\u7684\u8bf7\u6c42\u53d1\u9001\u5230\u6570\u636e\u5e93\u5c42\u3002 \u4f46\u662f\uff0c\u5982\u679c Redis \u505a\u7f13\u5b58\u65f6\u51fa\u73b0\u4e86\u95ee\u9898\uff0c \u6bd4\u5982\u8bf4\u7f13\u5b58\u5931\u6548\uff0c\u90a3\u4e48\uff0c\u5927\u91cf\u8bf7\u6c42\u5c31\u4f1a\u76f4\u63a5\u79ef\u538b\u5230\u6570\u636e\u5e93\u5c42\uff0c\u5fc5\u7136\u4f1a\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u5de8\u5927\u7684\u538b\u529b \uff0c\u5f88\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u5b95\u673a\u6216\u662f\u6545\u969c\uff0c\u90a3\u4e48\uff0c\u4e1a\u52a1\u5e94\u7528\u5c31\u6ca1\u6709\u529e\u6cd5\u5b58\u53d6\u6570\u636e\u3001\u54cd\u5e94\u7528\u6237\u8bf7\u6c42\u4e86\u3002 \u6b63\u56e0\u4e3a Redis \u7528\u4f5c\u7f13\u5b58\u7684\u666e\u904d\u6027\u4ee5\u53ca\u5b83\u5728\u4e1a\u52a1\u5e94\u7528\u4e2d\u7684\u91cd\u8981\u4f5c\u7528\uff0c\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u9700\u8981\u89e3\u51b3\u56db\u4e2a\u5173\u952e\u95ee\u9898\uff1a Redis \u7f13\u5b58\u5177\u4f53\u662f\u600e\u4e48\u5de5\u4f5c\u7684\uff1f Redis \u7f13\u5b58\u5982\u679c\u6ee1\u4e86\uff0c\u8be5\u600e\u4e48\u529e\uff1f \u4e3a\u4ec0\u4e48\u4f1a\u6709\u7f13\u5b58\u4e00\u81f4\u6027\u3001\u7f13\u5b58\u7a7f\u900f\u3001\u7f13\u5b58\u96ea\u5d29\u3001\u7f13\u5b58\u51fb\u7a7f\u7b49\u5f02\u5e38\uff0c\u8be5\u5982\u4f55\u5e94\u5bf9\uff1f Redis \u7684\u5185\u5b58\u6bd5\u7adf\u6709\u9650\uff0c\u5982\u679c\u7528\u5feb\u901f\u7684\u56fa\u6001\u786c\u76d8\u6765\u4fdd\u5b58\u6570\u636e\uff0c\u53ef\u4ee5\u589e\u52a0\u7f13\u5b58\u7684\u6570\u636e\u91cf\uff0c\u90a3\u4e48\uff0cRedis \u7f13\u5b58\u53ef\u4ee5\u4f7f\u7528\u5feb\u901f\u56fa\u6001\u786c\u76d8\u5417\uff1f 1\u3001\u7f13\u5b58\u7684\u7279\u5f81 \u9996\u5148\uff0c \u4e00\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4e0d\u540c\u5c42\u4e4b\u95f4\u7684\u8bbf\u95ee\u901f\u5ea6\u4e0d\u4e00\u6837\uff0c\u6240\u4ee5\u6211\u4eec\u624d\u9700\u8981\u7f13\u5b58\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u628a\u4e00\u4e9b\u9700\u8981\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\u653e\u5728\u7f13\u5b58\u4e2d\uff0c\u4ee5\u52a0\u5feb\u5b83\u4eec\u7684\u8bbf\u95ee\u901f\u5ea6 \u3002 \u4e3a\u4e86\u8ba9\u4f60\u80fd\u66f4\u597d\u5730\u7406\u89e3\uff0c\u6211\u4ee5\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e3a\u4f8b\uff0c\u6765\u89e3\u91ca\u4e00\u4e0b\u3002\u4e0b\u56fe\u662f\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\u7684\u4e09\u5c42\u5b58\u50a8\u7ed3\u6784\uff0c\u4ee5\u53ca\u5b83\u4eec\u5404\u81ea\u7684\u5e38\u7528\u5bb9\u91cf\u548c\u8bbf\u95ee\u6027\u80fd\u3002 \u6700\u4e0a\u9762\u662f\u5904\u7406\u5668\uff0c\u4e2d\u95f4\u662f\u5185\u5b58\uff0c\u6700\u4e0b\u9762\u662f\u78c1\u76d8\u3002 \u4ece\u56fe\u4e0a\u53ef\u4ee5\u770b\u5230\uff0cCPU\u3001\u5185\u5b58\u548c\u78c1\u76d8\u8fd9\u4e09\u5c42\u7684\u8bbf\u95ee\u901f\u5ea6\u4ece\u51e0\u5341 ns \u5230 100ns\uff0c\u518d\u5230\u51e0 ms\uff0c\u6027\u80fd\u7684\u5dee\u5f02\u5f88\u5927\u3002 \u5982\u679c\u6bcf\u6b21 CPU \u5904\u7406\u6570\u636e\u65f6\uff0c\u90fd\u8981\u4ece ms \u7ea7\u522b\u7684\u6162\u901f\u78c1\u76d8\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540e\u518d\u8fdb\u884c\u5904\u7406\uff0c\u90a3\u4e48\uff0cCPU \u53ea\u80fd\u7b49\u78c1\u76d8\u7684\u6570\u636e\u4f20\u8f93\u5b8c\u6210\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u9ad8\u901f\u7684 CPU \u5c31\u88ab\u6162\u901f\u7684\u78c1\u76d8\u62d6\u7d2f\u4e86\uff0c\u6574\u4e2a\u8ba1\u7b97\u673a\u7cfb\u7edf\u7684\u8fd0\u884c\u901f\u5ea6\u4f1a\u53d8\u5f97\u975e\u5e38\u6162\u3002 \u6240\u4ee5\uff0c\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\uff0c\u9ed8\u8ba4\u6709\u4e24\u79cd\u7f13\u5b58\uff1a CPU \u91cc\u9762\u7684\u672b\u7ea7\u7f13\u5b58\uff0c\u5373 LLC \uff0c \u7528\u6765\u7f13\u5b58\u5185\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u907f\u514d\u6bcf\u6b21\u4ece\u5185\u5b58\u4e2d\u5b58\u53d6\u6570\u636e\uff1b \u5185\u5b58\u4e2d\u7684\u9ad8\u901f\u9875\u7f13\u5b58\uff0c\u5373 page cache\uff0c\u7528\u6765\u7f13\u5b58\u78c1\u76d8\u4e2d\u7684\u6570\u636e\uff0c\u907f\u514d\u6bcf\u6b21\u4ece\u78c1\u76d8\u4e2d\u5b58\u53d6\u6570\u636e\u3002 \u8ddf\u5185\u5b58\u76f8\u6bd4\uff0cLLC \u7684\u8bbf\u95ee\u901f\u5ea6\u66f4\u5feb\uff0c\u800c\u8ddf\u78c1\u76d8\u76f8\u6bd4\uff0c\u5185\u5b58\u7684\u8bbf\u95ee\u662f\u66f4\u5feb\u7684\u3002 \u7f13\u5b58\u7684\u7b2c\u4e00\u4e2a\u7279\u5f81: \u5728\u4e00\u4e2a\u5c42\u6b21\u5316\u7684\u7cfb\u7edf\u4e2d\uff0c\u7f13\u5b58\u4e00\u5b9a\u662f\u4e00\u4e2a\u5feb\u901f\u5b50\u7cfb\u7edf\uff0c\u6570\u636e\u5b58\u5728\u7f13\u5b58\u4e2d\u65f6\uff0c\u80fd\u907f\u514d\u6bcf\u6b21\u4ece\u6162\u901f\u5b50\u7cfb\u7edf\u4e2d\u5b58\u53d6\u6570\u636e\u3002\u5bf9\u5e94\u5230\u4e92\u8054\u7f51\u5e94\u7528\u6765\u8bf4\uff0cRedis \u5c31\u662f\u5feb\u901f\u5b50\u7cfb\u7edf\uff0c\u800c\u6570\u636e\u5e93\u5c31\u662f\u6162\u901f\u5b50\u7cfb\u7edf\u4e86\u3002 \u7f13\u5b58\u7684\u7b2c\u4e8c\u4e2a\u7279\u5f81: \u3002LLC \u7684\u5927\u5c0f\u662f MB \u7ea7\u522b\uff0cpage cache \u7684\u5927\u5c0f\u662f GB \u7ea7\u522b\uff0c\u800c\u78c1\u76d8\u7684\u5927\u5c0f\u662f TB \u7ea7\u522b \u7f13\u5b58\u7cfb\u7edf\u7684\u5bb9\u91cf\u5927\u5c0f\u603b\u662f\u5c0f\u4e8e\u540e\u7aef\u6162\u901f\u7cfb\u7edf\u7684\uff0c\u6211\u4eec\u4e0d\u53ef\u80fd\u628a\u6240\u6709\u6570\u636e\u90fd\u653e\u5728\u7f13\u5b58\u7cfb\u7edf\u4e2d\u3002 \u7f13\u5b58\u7684\u5bb9\u91cf\u7ec8\u7a76\u662f\u6709\u9650\u7684\uff0c\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u91cf\u4e5f\u662f\u6709\u9650\u7684\uff0c\u80af\u5b9a\u662f\u6ca1\u6cd5\u65f6\u523b\u90fd\u6ee1\u8db3\u8bbf\u95ee\u9700\u6c42\u7684\u3002 \u6240\u4ee5\uff0c\u7f13\u5b58\u548c\u540e\u7aef\u6162\u901f\u7cfb\u7edf\u4e4b\u95f4\uff0c\u5fc5\u7136\u5b58\u5728\u6570\u636e\u5199\u56de\u548c\u518d\u8bfb\u53d6\u7684\u4ea4\u4e92\u8fc7\u7a0b\u3002 \u7b80\u5355\u6765\u8bf4\uff0c\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u9700\u8981\u6309\u4e00\u5b9a\u89c4\u5219\u6dd8\u6c70\u51fa\u53bb\uff0c\u5199\u56de\u540e\u7aef\u7cfb\u7edf\uff0c\u800c\u65b0\u7684\u6570\u636e\u53c8\u8981\u4ece\u540e\u7aef\u7cfb\u7edf\u4e2d\u8bfb\u53d6\u8fdb\u6765\uff0c\u5199\u5165\u7f13\u5b58\u3002 Redis \u672c\u8eab\u662f\u652f\u6301\u6309\u4e00\u5b9a\u89c4\u5219\u6dd8\u6c70\u6570\u636e\u7684\uff0c\u76f8\u5f53\u4e8e\u5b9e\u73b0\u4e86\u7f13\u5b58\u7684\u6570\u636e\u6dd8\u6c70\uff0c\u5176\u5b9e\uff0c\u8fd9\u4e5f\u662f Redis \u9002\u5408\u7528\u4f5c\u7f13\u5b58\u7684\u4e00\u4e2a\u91cd\u8981\u539f\u56e0\u3002 2\u3001Redis \u7f13\u5b58\u5904\u7406\u8bf7\u6c42\u7684\u4e24\u79cd\u60c5\u51b5 \u628a Redis \u7528\u4f5c\u7f13\u5b58\u65f6\uff0c\u6211\u4eec\u4f1a\u628a Redis \u90e8\u7f72\u5728\u6570\u636e\u5e93\u7684\u524d\u7aef\uff0c\u4e1a\u52a1\u5e94\u7528\u5728\u8bbf\u95ee\u6570\u636e\u65f6\uff0c\u4f1a\u5148\u67e5\u8be2 Redis \u4e2d\u662f\u5426\u4fdd\u5b58\u4e86\u76f8\u5e94\u7684\u6570\u636e\u3002\u6b64\u65f6\uff0c\u6839\u636e\u6570\u636e\u662f\u5426\u5b58\u5728\u7f13\u5b58\u4e2d\uff0c\u4f1a\u6709\u4e24\u79cd\u60c5\u51b5\u3002 \u7f13\u5b58\u547d\u4e2d \uff1a Redis \u4e2d\u6709\u76f8\u5e94\u6570\u636e\uff0c\u5c31\u76f4\u63a5\u8bfb\u53d6 Redis\uff0c\u6027\u80fd\u975e\u5e38\u5feb\u3002 \u7f13\u5b58\u7f3a\u5931 \uff1aRedis \u4e2d\u6ca1\u6709\u4fdd\u5b58\u76f8\u5e94\u6570\u636e\uff0c\u5c31\u4ece\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u6027\u80fd\u5c31\u4f1a\u53d8\u6162\u3002 \u800c\u4e14\uff0c\u4e00\u65e6\u53d1\u751f\u7f13\u5b58\u7f3a\u5931\uff0c\u4e3a\u4e86\u8ba9\u540e\u7eed\u8bf7\u6c42\u80fd\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u5230\u6570\u636e\uff0c \u6211\u4eec\u9700\u8981\u628a\u7f3a\u5931\u7684\u6570\u636e\u5199\u5165 Redis\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u4f5c\u7f13\u5b58\u66f4\u65b0 \u3002 \u7f13\u5b58\u66f4\u65b0\u64cd\u4f5c\u4f1a\u6d89\u53ca\u5230\u4fdd\u8bc1\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e4b\u95f4\u7684\u6570\u636e\u4e00\u81f4\u6027\u95ee\u9898 \u5047\u8bbe\u6211\u4eec\u5728\u4e00\u4e2a Web \u5e94\u7528\u4e2d\uff0c\u4f7f\u7528 Redis \u4f5c\u4e3a\u7f13\u5b58\u3002 \u7528\u6237\u8bf7\u6c42\u53d1\u9001\u7ed9 Tomcat\uff0cTomcat \u8d1f\u8d23\u5904\u7406\u4e1a\u52a1\u903b\u8f91\u3002 \u5982\u679c\u8981\u8bbf\u95ee\u6570\u636e\uff0c\u5c31\u9700\u8981\u4ece MySQL \u4e2d\u8bfb\u5199\u6570\u636e\u3002 \u90a3\u4e48\uff0c\u6211\u4eec\u53ef\u4ee5\u628a Redis \u90e8\u7f72\u5728 MySQL \u524d\u7aef\u3002 \u5982\u679c\u8bbf\u95ee\u7684\u6570\u636e\u5728 Redis \u4e2d\uff0c\u6b64\u65f6\u7f13\u5b58\u547d\u4e2d\uff0cTomcat \u53ef\u4ee5\u76f4\u63a5\u4ece Redis \u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u52a0\u901f\u5e94\u7528\u7684\u8bbf\u95ee\u3002 \u5426\u5219\uff0cTomcat \u5c31\u9700\u8981\u4ece\u6162\u901f\u7684\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\u4e86\u3002 \u5230\u8fd9\u91cc\uff0c\u4f60\u53ef\u80fd\u5df2\u7ecf\u53d1\u73b0\u4e86\uff0c\u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u6211\u4eec\u57fa\u672c\u6709\u4e09\u4e2a\u64cd\u4f5c\uff1a \u5e94\u7528\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u9700\u8981\u5148\u8bfb\u53d6 Redis\uff1b \u53d1\u751f\u7f13\u5b58\u7f3a\u5931\u65f6\uff0c\u9700\u8981\u4ece\u6570\u636e\u5e93\u8bfb\u53d6\u6570\u636e\uff1b \u53d1\u751f\u7f13\u5b58\u7f3a\u5931\u65f6\uff0c\u8fd8\u9700\u8981\u66f4\u65b0\u7f13\u5b58\u3002 3\u3001Redis \u4f5c\u4e3a\u65c1\u8def\u7f13\u5b58\u7684\u4f7f\u7528\u64cd\u4f5c Redis \u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u7cfb\u7edf\u8f6f\u4ef6\uff0c\u548c\u4e1a\u52a1\u5e94\u7528\u7a0b\u5e8f\u662f\u4e24\u4e2a\u8f6f\u4ef6\uff0c\u5f53\u6211\u4eec\u90e8\u7f72\u4e86 Redis \u5b9e\u4f8b\u540e\uff0c\u5b83\u53ea\u4f1a\u88ab\u52a8\u5730\u7b49\u5f85\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\uff0c\u7136\u540e\u518d\u8fdb\u884c\u5904\u7406\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u60f3\u8981\u4f7f\u7528 Redis \u7f13\u5b58\uff0c\u6211\u4eec\u5c31\u8981\u5728\u7a0b\u5e8f\u4e2d\u589e\u52a0\u76f8\u5e94\u7684\u7f13\u5b58\u64cd\u4f5c\u4ee3\u7801\u3002 \u6211\u4eec\u4e5f\u628a Redis \u79f0\u4e3a\u65c1\u8def\u7f13\u5b58\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8bfb\u53d6\u7f13\u5b58\u3001\u8bfb\u53d6\u6570\u636e\u5e93\u548c\u66f4\u65b0\u7f13\u5b58\u7684\u64cd\u4f5c\u90fd\u9700\u8981\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u6765\u5b8c\u6210\u3002 \u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u9700\u8981\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u589e\u52a0\u4e09\u65b9\u9762\u7684\u4ee3\u7801\uff1a \u5f53\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5728\u4ee3\u7801\u4e2d\u663e\u5f0f\u8c03\u7528 Redis \u7684 GET \u64cd\u4f5c\u63a5\u53e3\uff0c\u8fdb\u884c\u67e5\u8be2\uff1b \u5982\u679c\u7f13\u5b58\u7f3a\u5931\u4e86\uff0c\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u518d\u548c\u6570\u636e\u5e93\u8fde\u63a5\uff0c\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\uff1b \u5f53\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u9700\u8981\u66f4\u65b0\u65f6\uff0c\u6211\u4eec\u4e5f\u9700\u8981\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u663e\u5f0f\u5730\u8c03\u7528 SET \u64cd\u4f5c\u63a5\u53e3\uff0c\u628a\u66f4\u65b0\u7684\u6570\u636e\u5199\u5165\u7f13\u5b58\u3002 \u5c55\u793a\u4e00\u6bb5 Web \u5e94\u7528\u4e2d\u4f7f\u7528 Redis \u7f13\u5b58\u7684\u4f2a\u4ee3\u7801\u793a\u4f8b\u3002 String cacheKey = \u201cproductid_11010003\u201d; String cacheValue = redisCache.get(cacheKey)\uff1b //\u7f13\u5b58\u547d\u4e2d if ( cacheValue != NULL) return cacheValue; //\u7f13\u5b58\u7f3a\u5931 else cacheValue = getProductFromDB(); redisCache.put(cacheValue) //\u7f13\u5b58\u66f4\u65b0 \u53ef\u4ee5\u770b\u5230\uff0c\u4e3a\u4e86\u4f7f\u7528\u7f13\u5b58\uff0c Web \u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u6709\u4e00\u4e2a\u8868\u793a\u7f13\u5b58\u7cfb\u7edf\u7684\u5b9e\u4f8b\u5bf9\u8c61 redisCache \uff0c\u8fd8\u9700\u8981\u4e3b\u52a8\u8c03\u7528 Redis \u7684 GET \u63a5\u53e3\uff0c\u5e76\u4e14\u8981\u5904\u7406\u7f13\u5b58\u547d\u4e2d\u548c\u7f13\u5b58\u7f3a\u5931\u65f6\u7684\u903b\u8f91\uff0c\u4f8b\u5982\u5728\u7f13\u5b58\u7f3a\u5931\u65f6\uff0c\u9700\u8981\u66f4\u65b0\u7f13\u5b58 \u3002 \u5728\u4f7f\u7528\u65c1\u8def\u7f13\u5b58\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u589e\u52a0\u64cd\u4f5c\u4ee3\u7801\uff0c\u589e\u52a0\u4e86\u4f7f\u7528 Redis \u7f13\u5b58\u7684\u989d\u5916\u5de5\u4f5c\u91cf\uff0c\u4f46\u662f\uff0c\u4e5f\u6b63\u56e0\u4e3a Redis \u662f\u65c1\u8def\u7f13\u5b58\uff0c\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u7cfb\u7edf\uff0c\u6211\u4eec\u53ef\u4ee5\u5355\u72ec\u5bf9 Redis \u7f13\u5b58\u8fdb\u884c\u6269\u5bb9\u6216\u6027\u80fd\u4f18\u5316\u3002\u800c\u4e14\uff0c\u53ea\u8981\u4fdd\u6301\u64cd\u4f5c\u63a5\u53e3\u4e0d\u53d8\uff0c\u6211\u4eec\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u589e\u52a0\u7684\u4ee3\u7801\u5c31\u4e0d\u7528\u518d\u4fee\u6539\u4e86\u3002 \u9664\u4e86\u4ece Redis \u7f13\u5b58\u4e2d\u67e5\u8be2\u3001\u8bfb\u53d6\u6570\u636e\u4ee5\u5916\uff0c\u5e94\u7528\u7a0b\u5e8f\u8fd8\u53ef\u80fd\u4f1a\u5bf9\u6570\u636e\u8fdb\u884c\u4fee\u6539\uff0c\u8fd9\u65f6\uff0c\u6211\u4eec\u65e2\u53ef\u4ee5\u5728\u7f13\u5b58\u4e2d\u4fee\u6539\uff0c\u4e5f\u53ef\u4ee5\u5728\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u8fdb\u884c\u4fee\u6539\uff0c\u6211\u4eec\u8be5\u600e\u4e48\u9009\u62e9\u5462\uff1f Redis \u7f13\u5b58\u7684\u4e24\u79cd\u7c7b\u578b \uff1a\u53ea\u8bfb\u7f13\u5b58\u548c\u8bfb\u5199\u7f13\u5b58\u3002 \u53ea\u8bfb\u7f13\u5b58\u80fd\u52a0\u901f\u8bfb\u8bf7\u6c42\uff0c\u800c\u8bfb\u5199\u7f13\u5b58\u53ef\u4ee5\u540c\u65f6\u52a0\u901f\u8bfb\u5199\u8bf7\u6c42 \u3002 \u8bfb\u5199\u7f13\u5b58\u53c8\u6709\u4e24\u79cd\u6570\u636e\u5199\u56de\u7b56\u7565\uff0c\u53ef\u4ee5\u8ba9\u6211\u4eec\u6839\u636e\u4e1a\u52a1\u9700\u6c42\uff0c\u5728\u4fdd\u8bc1\u6027\u80fd\u548c\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\u4e4b\u95f4\u8fdb\u884c\u9009\u62e9\u3002 \u6240\u4ee5\uff0c\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6765\u5177\u4f53\u4e86\u89e3\u4e0b Redis \u7684\u7f13\u5b58\u7c7b\u578b\u548c\u76f8\u5e94\u7684\u5199\u56de\u7b56\u7565\u3002 4\u3001\u7f13\u5b58\u7684\u7c7b\u578b \u6309\u7167 Redis \u7f13\u5b58\u662f\u5426\u63a5\u53d7\u5199\u8bf7\u6c42\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u5206\u6210 \u53ea\u8bfb\u7f13\u5b58\u548c\u8bfb\u5199\u7f13\u5b58 \u3002 4-1 \u53ea\u8bfb\u7f13\u5b58 \u5f53 Redis \u7528\u4f5c\u53ea\u8bfb\u7f13\u5b58\u65f6\uff0c\u5e94\u7528\u8981\u8bfb\u53d6\u6570\u636e\u7684\u8bdd\uff0c\u4f1a\u5148\u8c03\u7528 Redis GET \u63a5\u53e3\uff0c\u67e5\u8be2\u6570\u636e\u662f\u5426\u5b58\u5728\u3002 \u800c\u6240\u6709\u7684\u6570\u636e\u5199\u8bf7\u6c42\uff0c\u4f1a\u76f4\u63a5\u53d1\u5f80\u540e\u7aef\u7684\u6570\u636e\u5e93\uff0c\u5728\u6570\u636e\u5e93\u4e2d\u589e\u5220\u6539\u3002 \u5bf9\u4e8e\u5220\u6539\u7684\u6570\u636e\u6765\u8bf4\uff0c\u5982\u679c Redis \u5df2\u7ecf\u7f13\u5b58\u4e86\u76f8\u5e94\u7684\u6570\u636e\uff0c\u5e94\u7528\u9700\u8981\u628a\u8fd9\u4e9b\u7f13\u5b58\u7684\u6570\u636e\u5220\u9664\uff0cRedis \u4e2d\u5c31\u6ca1\u6709\u8fd9\u4e9b\u6570\u636e\u4e86\u3002 \u5f53\u5e94\u7528\u518d\u6b21\u8bfb\u53d6\u8fd9\u4e9b\u6570\u636e\u65f6\uff0c\u4f1a\u53d1\u751f\u7f13\u5b58\u7f3a\u5931\uff0c\u5e94\u7528\u4f1a\u628a\u8fd9\u4e9b\u6570\u636e\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u51fa\u6765\uff0c\u5e76\u5199\u5230\u7f13\u5b58\u4e2d\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u8fd9\u4e9b\u6570\u636e\u540e\u7eed\u518d\u88ab\u8bfb\u53d6\u65f6\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u4e86\uff0c\u80fd\u8d77\u5230\u52a0\u901f\u8bbf\u95ee\u7684\u6548\u679c\u3002 \u5047\u8bbe\u4e1a\u52a1\u5e94\u7528\u8981\u4fee\u6539\u6570\u636e A\uff0c\u6b64\u65f6\uff0c\u6570\u636e A \u5728 Redis \u4e2d\u4e5f\u7f13\u5b58\u4e86\uff0c \u5e94\u7528\u4f1a\u5148\u76f4\u63a5\u5728 \u6570\u636e\u5e93\u91cc\u4fee\u6539 A\uff0c\u5e76\u628a Redis \u4e2d\u7684 A \u5220\u9664 \u3002 \u7b49\u5230\u5e94\u7528\u9700\u8981\u8bfb\u53d6\u6570\u636e A \u65f6\uff0c\u4f1a\u53d1\u751f \u7f13\u5b58\u7f3a\u5931\uff0c\u6b64\u65f6\uff0c\u5e94\u7528\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6 A\uff0c\u5e76\u5199\u5165 Redis \uff0c\u4ee5\u4fbf\u540e\u7eed\u8bf7\u6c42\u4ece\u7f13\u5b58\u4e2d\u76f4\u63a5\u8bfb\u53d6\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u53ea\u8bfb\u7f13\u5b58\u76f4\u63a5\u5728\u6570\u636e\u5e93\u4e2d\u66f4\u65b0\u6570\u636e\u7684\u597d\u5904\u662f\uff0c\u6240\u6709\u6700\u65b0\u7684\u6570\u636e\u90fd\u5728\u6570\u636e\u5e93\u4e2d\uff0c\u800c\u6570\u636e\u5e93\u662f\u63d0\u4f9b\u6570\u636e\u53ef\u9760\u6027\u4fdd\u969c\u7684\uff0c\u8fd9\u4e9b\u6570\u636e\u4e0d\u4f1a\u6709\u4e22\u5931\u7684\u98ce\u9669\u3002 \u5f53\u6211\u4eec\u9700\u8981\u7f13\u5b58\u56fe\u7247\u3001\u77ed\u89c6\u9891\u8fd9\u4e9b\u7528\u6237\u53ea\u8bfb\u7684\u6570\u636e\u65f6\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u53ea\u8bfb\u7f13\u5b58\u8fd9\u4e2a\u7c7b\u578b\u4e86\u3002 4-2 \u8bfb\u5199\u7f13\u5b58 \u5bf9\u4e8e\u8bfb\u5199\u7f13\u5b58\u6765\u8bf4\uff0c\u9664\u4e86\u8bfb\u8bf7\u6c42\u4f1a\u53d1\u9001\u5230\u7f13\u5b58\u8fdb\u884c\u5904\u7406\uff08\u76f4\u63a5\u5728\u7f13\u5b58\u4e2d\u67e5\u8be2\u6570\u636e\u662f\u5426\u5b58\u5728)\uff0c\u6240\u6709\u7684\u5199\u8bf7\u6c42\u4e5f\u4f1a\u53d1\u9001\u5230\u7f13\u5b58\uff0c\u5728\u7f13\u5b58\u4e2d\u76f4\u63a5\u5bf9\u6570\u636e\u8fdb\u884c\u589e\u5220\u6539\u64cd\u4f5c\u3002 \u6b64\u65f6\uff0c\u5f97\u76ca\u4e8e Redis \u7684\u9ad8\u6027\u80fd\u8bbf\u95ee\u7279\u6027\uff0c\u6570\u636e\u7684\u589e\u5220\u6539\u64cd\u4f5c\u53ef\u4ee5\u5728\u7f13\u5b58\u4e2d\u5feb\u901f\u5b8c\u6210\uff0c\u5904\u7406\u7ed3\u679c\u4e5f\u4f1a\u5feb\u901f\u8fd4\u56de\u7ed9\u4e1a\u52a1\u5e94\u7528\uff0c\u8fd9\u5c31\u53ef\u4ee5\u63d0\u5347\u4e1a\u52a1\u5e94\u7528\u7684\u54cd\u5e94\u901f\u5ea6\u3002 \u4f46\u662f\uff0c\u548c\u53ea\u8bfb\u7f13\u5b58\u4e0d\u4e00\u6837\u7684\u662f\uff0c\u5728\u4f7f\u7528\u8bfb\u5199\u7f13\u5b58\u65f6\uff0c\u6700\u65b0\u7684\u6570\u636e\u662f\u5728 Redis \u4e2d\uff0c\u800c Redis \u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u4e00\u65e6\u51fa\u73b0\u6389\u7535\u6216\u5b95\u673a \uff0c\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u3002\u8fd9\u4e5f\u5c31\u662f\u8bf4\uff0c\u5e94\u7528\u7684\u6700\u65b0\u6570\u636e\u53ef\u80fd\u4f1a\u4e22\u5931\uff0c\u7ed9\u5e94\u7528\u4e1a\u52a1\u5e26\u6765\u98ce\u9669\u3002 \u6240\u4ee5\uff0c\u6839\u636e\u4e1a\u52a1\u5e94\u7528\u5bf9\u6570\u636e\u53ef\u9760\u6027\u548c\u7f13\u5b58\u6027\u80fd\u7684\u4e0d\u540c\u8981\u6c42\uff0c \u6211\u4eec\u4f1a\u6709\u540c\u6b65\u76f4\u5199\u548c\u5f02\u6b65\u5199\u56de\u4e24\u79cd\u7b56\u7565\u3002\u5176\u4e2d\uff0c\u540c\u6b65\u76f4\u5199\u7b56\u7565\u4f18\u5148\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\uff0c\u800c\u5f02\u6b65\u5199\u56de\u7b56\u7565\u4f18\u5148\u63d0\u4f9b\u5feb\u901f\u54cd\u5e94\u3002 4-2 \u8bfb\u5199\u7f13\u5b58:\u540c\u6b65\u76f4\u5199 \u5199\u8bf7\u6c42\u53d1\u7ed9\u7f13\u5b58\u7684\u540c\u65f6\uff0c\u4e5f\u4f1a\u53d1\u7ed9\u540e\u7aef\u6570\u636e\u5e93\u8fdb\u884c\u5904\u7406\uff0c\u7b49\u5230\u7f13\u5b58\u548c\u6570\u636e\u5e93\u90fd\u5199\u5b8c\u6570\u636e\uff0c\u624d\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de \u5373\u4f7f\u7f13\u5b58\u5b95\u673a\u6216\u53d1\u751f\u6545\u969c\uff0c\u6700\u65b0\u7684\u6570\u636e\u4ecd\u7136\u4fdd\u5b58\u5728\u6570\u636e\u5e93\u4e2d\uff0c\u8fd9\u5c31\u63d0\u4f9b\u4e86\u6570\u636e\u53ef\u9760\u6027\u4fdd\u8bc1\u3002 \u4e0d\u8fc7\uff0c\u540c\u6b65\u76f4\u5199\u4f1a\u964d\u4f4e\u7f13\u5b58\u7684\u8bbf\u95ee\u6027\u80fd\u3002 \u8fd9\u662f\u56e0\u4e3a\u7f13\u5b58\u4e2d\u5904\u7406\u5199\u8bf7\u6c42\u7684\u901f\u5ea6\u662f\u5f88\u5feb\u7684\uff0c\u800c\u6570\u636e\u5e93\u5904\u7406\u5199\u8bf7\u6c42\u7684\u901f\u5ea6\u8f83\u6162\u3002 \u5373\u4f7f\u7f13\u5b58\u5f88\u5feb\u5730\u5904\u7406\u4e86\u5199\u8bf7\u6c42\uff0c\u4e5f\u9700\u8981\u7b49\u5f85\u6570\u636e\u5e93\u5904\u7406\u5b8c\u6240\u6709\u7684\u5199\u8bf7\u6c42\uff0c\u624d\u80fd\u7ed9\u5e94\u7528\u8fd4\u56de\u7ed3\u679c\uff0c\u8fd9\u5c31\u589e\u52a0\u4e86\u7f13\u5b58\u7684\u54cd\u5e94\u5ef6\u8fdf\u3002 4-3 \u8bfb\u5199\u7f13\u5b58:\u800c\u5f02\u6b65\u5199\u56de \u800c\u5f02\u6b65\u5199\u56de\u7b56\u7565\uff0c\u5219\u662f\u4f18\u5148\u8003\u8651\u4e86\u54cd\u5e94\u5ef6\u8fdf\u3002\u6b64\u65f6\uff0c \u6240\u6709\u5199\u8bf7\u6c42\u90fd\u5148\u5728\u7f13\u5b58\u4e2d\u5904\u7406\u3002\u7b49\u5230\u8fd9\u4e9b\u589e\u6539\u7684\u6570\u636e\u8981\u88ab\u4ece\u7f13\u5b58\u4e2d\u6dd8\u6c70\u51fa\u6765\u65f6\uff0c\u7f13\u5b58\u5c06\u5b83\u4eec\u5199\u56de\u540e\u7aef\u6570\u636e\u5e93\u3002 \u53ea\u4e0d\u8fc7\uff0c\u5982\u679c\u53d1\u751f\u4e86\u6389\u7535\uff0c\u800c\u5b83\u4eec\u8fd8\u6ca1\u6709\u88ab\u5199\u56de\u6570\u636e\u5e93\uff0c\u5c31\u4f1a\u6709\u4e22\u5931\u7684\u98ce\u9669\u4e86\u3002 \u5173\u4e8e\u662f\u9009\u62e9\u53ea\u8bfb\u7f13\u5b58\uff0c\u8fd8\u662f\u8bfb\u5199\u7f13\u5b58\uff0c\u4e3b\u8981\u770b\u6211\u4eec\u5bf9\u5199\u8bf7\u6c42\u662f\u5426\u6709\u52a0\u901f\u7684\u9700\u6c42\u3002 \u5982\u679c\u9700\u8981\u5bf9\u5199\u8bf7\u6c42\u8fdb\u884c\u52a0\u901f\uff0c\u6211\u4eec\u9009\u62e9\u8bfb\u5199\u7f13\u5b58\uff1b \u5982\u679c\u5199\u8bf7\u6c42\u5f88\u5c11\uff0c\u6216\u8005\u662f\u53ea\u9700\u8981\u63d0\u5347\u8bfb\u8bf7\u6c42\u7684\u54cd\u5e94\u901f\u5ea6\u7684\u8bdd\uff0c\u6211\u4eec\u9009\u62e9\u53ea\u8bfb\u7f13\u5b58\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5728\u5546\u54c1\u5927\u4fc3\u7684\u573a\u666f\u4e2d\uff0c\u5546\u54c1\u7684\u5e93\u5b58\u4fe1\u606f\u4f1a\u4e00\u76f4\u88ab\u4fee\u6539\u3002\u5982\u679c\u6bcf\u6b21\u4fee\u6539\u90fd\u9700\u5230\u6570\u636e\u5e93\u4e2d\u5904\u7406\uff0c\u5c31\u4f1a\u62d6\u6162\u6574\u4e2a\u5e94\u7528\uff0c\u6b64\u65f6\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u9009\u62e9\u8bfb\u5199\u7f13\u5b58\u7684\u6a21\u5f0f\u3002 \u800c\u5728\u77ed\u89c6\u9891 App \u7684\u573a\u666f\u4e2d\uff0c\u867d\u7136\u89c6\u9891\u7684\u5c5e\u6027\u6709\u5f88\u591a\uff0c\u4f46\u662f\uff0c\u4e00\u822c\u786e\u5b9a\u540e\uff0c\u4fee\u6539\u5e76\u4e0d\u9891\u7e41\uff0c\u6b64\u65f6\uff0c\u5728\u6570\u636e\u5e93\u4e2d\u8fdb\u884c\u4fee\u6539\u5bf9\u7f13\u5b58\u5f71\u54cd\u4e0d\u5927\uff0c\u6240\u4ee5\u53ea\u8bfb\u7f13\u5b58\u6a21\u5f0f\u662f\u4e00\u4e2a\u5408\u9002\u7684\u9009\u62e9\u3002 5\u3001\u672c\u8282\u5c0f\u7ed3 \u5206\u5c42\u7cfb\u7edf\u4e2d\uff0c\u6570\u636e\u6682\u5b58\u5728\u5feb\u901f\u5b50\u7cfb\u7edf\u4e2d\u6709\u52a9\u4e8e\u52a0\u901f\u8bbf\u95ee\uff1b\u7f13\u5b58\u5bb9\u91cf\u6709\u9650\uff0c\u7f13\u5b58\u5199\u6ee1\u65f6\uff0c\u6570\u636e\u9700\u8981\u88ab\u6dd8\u6c70 Redis \u5929\u7136\u5c31\u5177\u6709\u9ad8\u6027\u80fd\u8bbf\u95ee\u548c\u6570\u636e\u6dd8\u6c70\u673a\u5236\uff0c\u6b63\u597d\u7b26\u5408\u7f13\u5b58\u7684\u8fd9\u4e24\u4e2a\u7279\u5f81\u7684\u8981\u6c42\uff0c\u6240\u4ee5\u975e\u5e38\u9002\u5408\u7528\u4f5c\u7f13\u5b58\u3002 Redis \u4f5c\u4e3a\u65c1\u8def\u7f13\u5b58\u7684\u7279\u6027\uff0c\u65c1\u8def\u7f13\u5b58\u5c31\u610f\u5473\u7740\u9700\u8981\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u65b0\u589e\u7f13\u5b58\u903b\u8f91\u5904\u7406\u7684\u4ee3\u7801\u3002\u5f53\u7136\uff0c\u5982\u679c\u662f\u65e0\u6cd5\u4fee\u6539\u6e90\u7801\u7684\u5e94\u7528\u573a\u666f\uff0c\u5c31\u4e0d\u80fd\u4f7f\u7528 Redis \u505a\u7f13\u5b58\u4e86\u3002 Redis \u505a\u7f13\u5b58\u65f6\uff0c\u8fd8\u6709\u4e24\u79cd\u6a21\u5f0f\uff0c\u5206\u522b\u662f\u53ea\u8bfb\u7f13\u5b58\u548c\u8bfb\u5199\u7f13\u5b58\u3002 \u8bfb\u5199\u7f13\u5b58\u8fd8\u63d0\u4f9b\u4e86\u540c\u6b65\u76f4\u5199\u548c\u5f02\u6b65\u5199\u56de\u8fd9\u4e24\u79cd\u6a21\u5f0f\uff0c\u540c\u6b65\u76f4\u5199\u6a21\u5f0f\u4fa7\u91cd\u4e8e\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\uff0c\u800c\u5f02\u6b65\u5199\u56de\u6a21\u5f0f\u5219\u4fa7\u91cd\u4e8e\u63d0\u4f9b\u4f4e\u5ef6\u8fdf\u8bbf\u95ee\uff0c \u5982\u679c\u9700\u8981\u5bf9\u5199\u8bf7\u6c42\u8fdb\u884c\u52a0\u901f\uff0c\u6211\u4eec\u9009\u62e9\u8bfb\u5199\u7f13\u5b58\uff1b \u5982\u679c\u5199\u8bf7\u6c42\u5f88\u5c11\uff0c\u6216\u8005\u662f\u53ea\u9700\u8981\u63d0\u5347\u8bfb\u8bf7\u6c42\u7684\u54cd\u5e94\u901f\u5ea6\u7684\u8bdd\uff0c\u6211\u4eec\u9009\u62e9\u53ea\u8bfb\u7f13\u5b58\u3002","title":"\u7b2c\u4e00\u8282 Redis \u65c1\u8def\u7f13\u5b58"},{"location":"chap5/1redis_cache/#redis","text":"Redis \u63d0\u4f9b\u4e86\u9ad8\u6027\u80fd\u7684\u6570\u636e\u5b58\u53d6\u529f\u80fd\uff0c\u6240\u4ee5\u5e7f\u6cdb\u5e94\u7528\u5728\u7f13\u5b58\u573a\u666f\u4e2d\uff0c\u65e2\u80fd\u6709\u6548\u5730\u63d0\u5347\u4e1a\u52a1\u5e94\u7528\u7684\u54cd\u5e94\u901f\u5ea6\uff0c\u8fd8\u53ef\u4ee5\u907f\u514d\u628a\u9ad8\u5e76\u53d1\u5927\u538b\u529b\u7684\u8bf7\u6c42\u53d1\u9001\u5230\u6570\u636e\u5e93\u5c42\u3002 \u4f46\u662f\uff0c\u5982\u679c Redis \u505a\u7f13\u5b58\u65f6\u51fa\u73b0\u4e86\u95ee\u9898\uff0c \u6bd4\u5982\u8bf4\u7f13\u5b58\u5931\u6548\uff0c\u90a3\u4e48\uff0c\u5927\u91cf\u8bf7\u6c42\u5c31\u4f1a\u76f4\u63a5\u79ef\u538b\u5230\u6570\u636e\u5e93\u5c42\uff0c\u5fc5\u7136\u4f1a\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u5de8\u5927\u7684\u538b\u529b \uff0c\u5f88\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u5b95\u673a\u6216\u662f\u6545\u969c\uff0c\u90a3\u4e48\uff0c\u4e1a\u52a1\u5e94\u7528\u5c31\u6ca1\u6709\u529e\u6cd5\u5b58\u53d6\u6570\u636e\u3001\u54cd\u5e94\u7528\u6237\u8bf7\u6c42\u4e86\u3002 \u6b63\u56e0\u4e3a Redis \u7528\u4f5c\u7f13\u5b58\u7684\u666e\u904d\u6027\u4ee5\u53ca\u5b83\u5728\u4e1a\u52a1\u5e94\u7528\u4e2d\u7684\u91cd\u8981\u4f5c\u7528\uff0c\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u9700\u8981\u89e3\u51b3\u56db\u4e2a\u5173\u952e\u95ee\u9898\uff1a Redis \u7f13\u5b58\u5177\u4f53\u662f\u600e\u4e48\u5de5\u4f5c\u7684\uff1f Redis \u7f13\u5b58\u5982\u679c\u6ee1\u4e86\uff0c\u8be5\u600e\u4e48\u529e\uff1f \u4e3a\u4ec0\u4e48\u4f1a\u6709\u7f13\u5b58\u4e00\u81f4\u6027\u3001\u7f13\u5b58\u7a7f\u900f\u3001\u7f13\u5b58\u96ea\u5d29\u3001\u7f13\u5b58\u51fb\u7a7f\u7b49\u5f02\u5e38\uff0c\u8be5\u5982\u4f55\u5e94\u5bf9\uff1f Redis \u7684\u5185\u5b58\u6bd5\u7adf\u6709\u9650\uff0c\u5982\u679c\u7528\u5feb\u901f\u7684\u56fa\u6001\u786c\u76d8\u6765\u4fdd\u5b58\u6570\u636e\uff0c\u53ef\u4ee5\u589e\u52a0\u7f13\u5b58\u7684\u6570\u636e\u91cf\uff0c\u90a3\u4e48\uff0cRedis \u7f13\u5b58\u53ef\u4ee5\u4f7f\u7528\u5feb\u901f\u56fa\u6001\u786c\u76d8\u5417\uff1f","title":"\u7b2c\u4e00\u8282 Redis \u65c1\u8def\u7f13\u5b58"},{"location":"chap5/1redis_cache/#1","text":"\u9996\u5148\uff0c \u4e00\u4e2a\u7cfb\u7edf\u4e2d\u7684\u4e0d\u540c\u5c42\u4e4b\u95f4\u7684\u8bbf\u95ee\u901f\u5ea6\u4e0d\u4e00\u6837\uff0c\u6240\u4ee5\u6211\u4eec\u624d\u9700\u8981\u7f13\u5b58\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u628a\u4e00\u4e9b\u9700\u8981\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\u653e\u5728\u7f13\u5b58\u4e2d\uff0c\u4ee5\u52a0\u5feb\u5b83\u4eec\u7684\u8bbf\u95ee\u901f\u5ea6 \u3002 \u4e3a\u4e86\u8ba9\u4f60\u80fd\u66f4\u597d\u5730\u7406\u89e3\uff0c\u6211\u4ee5\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e3a\u4f8b\uff0c\u6765\u89e3\u91ca\u4e00\u4e0b\u3002\u4e0b\u56fe\u662f\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\u7684\u4e09\u5c42\u5b58\u50a8\u7ed3\u6784\uff0c\u4ee5\u53ca\u5b83\u4eec\u5404\u81ea\u7684\u5e38\u7528\u5bb9\u91cf\u548c\u8bbf\u95ee\u6027\u80fd\u3002 \u6700\u4e0a\u9762\u662f\u5904\u7406\u5668\uff0c\u4e2d\u95f4\u662f\u5185\u5b58\uff0c\u6700\u4e0b\u9762\u662f\u78c1\u76d8\u3002 \u4ece\u56fe\u4e0a\u53ef\u4ee5\u770b\u5230\uff0cCPU\u3001\u5185\u5b58\u548c\u78c1\u76d8\u8fd9\u4e09\u5c42\u7684\u8bbf\u95ee\u901f\u5ea6\u4ece\u51e0\u5341 ns \u5230 100ns\uff0c\u518d\u5230\u51e0 ms\uff0c\u6027\u80fd\u7684\u5dee\u5f02\u5f88\u5927\u3002 \u5982\u679c\u6bcf\u6b21 CPU \u5904\u7406\u6570\u636e\u65f6\uff0c\u90fd\u8981\u4ece ms \u7ea7\u522b\u7684\u6162\u901f\u78c1\u76d8\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540e\u518d\u8fdb\u884c\u5904\u7406\uff0c\u90a3\u4e48\uff0cCPU \u53ea\u80fd\u7b49\u78c1\u76d8\u7684\u6570\u636e\u4f20\u8f93\u5b8c\u6210\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u9ad8\u901f\u7684 CPU \u5c31\u88ab\u6162\u901f\u7684\u78c1\u76d8\u62d6\u7d2f\u4e86\uff0c\u6574\u4e2a\u8ba1\u7b97\u673a\u7cfb\u7edf\u7684\u8fd0\u884c\u901f\u5ea6\u4f1a\u53d8\u5f97\u975e\u5e38\u6162\u3002 \u6240\u4ee5\uff0c\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\uff0c\u9ed8\u8ba4\u6709\u4e24\u79cd\u7f13\u5b58\uff1a CPU \u91cc\u9762\u7684\u672b\u7ea7\u7f13\u5b58\uff0c\u5373 LLC \uff0c \u7528\u6765\u7f13\u5b58\u5185\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u907f\u514d\u6bcf\u6b21\u4ece\u5185\u5b58\u4e2d\u5b58\u53d6\u6570\u636e\uff1b \u5185\u5b58\u4e2d\u7684\u9ad8\u901f\u9875\u7f13\u5b58\uff0c\u5373 page cache\uff0c\u7528\u6765\u7f13\u5b58\u78c1\u76d8\u4e2d\u7684\u6570\u636e\uff0c\u907f\u514d\u6bcf\u6b21\u4ece\u78c1\u76d8\u4e2d\u5b58\u53d6\u6570\u636e\u3002 \u8ddf\u5185\u5b58\u76f8\u6bd4\uff0cLLC \u7684\u8bbf\u95ee\u901f\u5ea6\u66f4\u5feb\uff0c\u800c\u8ddf\u78c1\u76d8\u76f8\u6bd4\uff0c\u5185\u5b58\u7684\u8bbf\u95ee\u662f\u66f4\u5feb\u7684\u3002 \u7f13\u5b58\u7684\u7b2c\u4e00\u4e2a\u7279\u5f81: \u5728\u4e00\u4e2a\u5c42\u6b21\u5316\u7684\u7cfb\u7edf\u4e2d\uff0c\u7f13\u5b58\u4e00\u5b9a\u662f\u4e00\u4e2a\u5feb\u901f\u5b50\u7cfb\u7edf\uff0c\u6570\u636e\u5b58\u5728\u7f13\u5b58\u4e2d\u65f6\uff0c\u80fd\u907f\u514d\u6bcf\u6b21\u4ece\u6162\u901f\u5b50\u7cfb\u7edf\u4e2d\u5b58\u53d6\u6570\u636e\u3002\u5bf9\u5e94\u5230\u4e92\u8054\u7f51\u5e94\u7528\u6765\u8bf4\uff0cRedis \u5c31\u662f\u5feb\u901f\u5b50\u7cfb\u7edf\uff0c\u800c\u6570\u636e\u5e93\u5c31\u662f\u6162\u901f\u5b50\u7cfb\u7edf\u4e86\u3002 \u7f13\u5b58\u7684\u7b2c\u4e8c\u4e2a\u7279\u5f81: \u3002LLC \u7684\u5927\u5c0f\u662f MB \u7ea7\u522b\uff0cpage cache \u7684\u5927\u5c0f\u662f GB \u7ea7\u522b\uff0c\u800c\u78c1\u76d8\u7684\u5927\u5c0f\u662f TB \u7ea7\u522b \u7f13\u5b58\u7cfb\u7edf\u7684\u5bb9\u91cf\u5927\u5c0f\u603b\u662f\u5c0f\u4e8e\u540e\u7aef\u6162\u901f\u7cfb\u7edf\u7684\uff0c\u6211\u4eec\u4e0d\u53ef\u80fd\u628a\u6240\u6709\u6570\u636e\u90fd\u653e\u5728\u7f13\u5b58\u7cfb\u7edf\u4e2d\u3002 \u7f13\u5b58\u7684\u5bb9\u91cf\u7ec8\u7a76\u662f\u6709\u9650\u7684\uff0c\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u91cf\u4e5f\u662f\u6709\u9650\u7684\uff0c\u80af\u5b9a\u662f\u6ca1\u6cd5\u65f6\u523b\u90fd\u6ee1\u8db3\u8bbf\u95ee\u9700\u6c42\u7684\u3002 \u6240\u4ee5\uff0c\u7f13\u5b58\u548c\u540e\u7aef\u6162\u901f\u7cfb\u7edf\u4e4b\u95f4\uff0c\u5fc5\u7136\u5b58\u5728\u6570\u636e\u5199\u56de\u548c\u518d\u8bfb\u53d6\u7684\u4ea4\u4e92\u8fc7\u7a0b\u3002 \u7b80\u5355\u6765\u8bf4\uff0c\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u9700\u8981\u6309\u4e00\u5b9a\u89c4\u5219\u6dd8\u6c70\u51fa\u53bb\uff0c\u5199\u56de\u540e\u7aef\u7cfb\u7edf\uff0c\u800c\u65b0\u7684\u6570\u636e\u53c8\u8981\u4ece\u540e\u7aef\u7cfb\u7edf\u4e2d\u8bfb\u53d6\u8fdb\u6765\uff0c\u5199\u5165\u7f13\u5b58\u3002 Redis \u672c\u8eab\u662f\u652f\u6301\u6309\u4e00\u5b9a\u89c4\u5219\u6dd8\u6c70\u6570\u636e\u7684\uff0c\u76f8\u5f53\u4e8e\u5b9e\u73b0\u4e86\u7f13\u5b58\u7684\u6570\u636e\u6dd8\u6c70\uff0c\u5176\u5b9e\uff0c\u8fd9\u4e5f\u662f Redis \u9002\u5408\u7528\u4f5c\u7f13\u5b58\u7684\u4e00\u4e2a\u91cd\u8981\u539f\u56e0\u3002","title":"1\u3001\u7f13\u5b58\u7684\u7279\u5f81"},{"location":"chap5/1redis_cache/#2redis","text":"\u628a Redis \u7528\u4f5c\u7f13\u5b58\u65f6\uff0c\u6211\u4eec\u4f1a\u628a Redis \u90e8\u7f72\u5728\u6570\u636e\u5e93\u7684\u524d\u7aef\uff0c\u4e1a\u52a1\u5e94\u7528\u5728\u8bbf\u95ee\u6570\u636e\u65f6\uff0c\u4f1a\u5148\u67e5\u8be2 Redis \u4e2d\u662f\u5426\u4fdd\u5b58\u4e86\u76f8\u5e94\u7684\u6570\u636e\u3002\u6b64\u65f6\uff0c\u6839\u636e\u6570\u636e\u662f\u5426\u5b58\u5728\u7f13\u5b58\u4e2d\uff0c\u4f1a\u6709\u4e24\u79cd\u60c5\u51b5\u3002 \u7f13\u5b58\u547d\u4e2d \uff1a Redis \u4e2d\u6709\u76f8\u5e94\u6570\u636e\uff0c\u5c31\u76f4\u63a5\u8bfb\u53d6 Redis\uff0c\u6027\u80fd\u975e\u5e38\u5feb\u3002 \u7f13\u5b58\u7f3a\u5931 \uff1aRedis \u4e2d\u6ca1\u6709\u4fdd\u5b58\u76f8\u5e94\u6570\u636e\uff0c\u5c31\u4ece\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u6027\u80fd\u5c31\u4f1a\u53d8\u6162\u3002 \u800c\u4e14\uff0c\u4e00\u65e6\u53d1\u751f\u7f13\u5b58\u7f3a\u5931\uff0c\u4e3a\u4e86\u8ba9\u540e\u7eed\u8bf7\u6c42\u80fd\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u5230\u6570\u636e\uff0c \u6211\u4eec\u9700\u8981\u628a\u7f3a\u5931\u7684\u6570\u636e\u5199\u5165 Redis\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u4f5c\u7f13\u5b58\u66f4\u65b0 \u3002 \u7f13\u5b58\u66f4\u65b0\u64cd\u4f5c\u4f1a\u6d89\u53ca\u5230\u4fdd\u8bc1\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e4b\u95f4\u7684\u6570\u636e\u4e00\u81f4\u6027\u95ee\u9898 \u5047\u8bbe\u6211\u4eec\u5728\u4e00\u4e2a Web \u5e94\u7528\u4e2d\uff0c\u4f7f\u7528 Redis \u4f5c\u4e3a\u7f13\u5b58\u3002 \u7528\u6237\u8bf7\u6c42\u53d1\u9001\u7ed9 Tomcat\uff0cTomcat \u8d1f\u8d23\u5904\u7406\u4e1a\u52a1\u903b\u8f91\u3002 \u5982\u679c\u8981\u8bbf\u95ee\u6570\u636e\uff0c\u5c31\u9700\u8981\u4ece MySQL \u4e2d\u8bfb\u5199\u6570\u636e\u3002 \u90a3\u4e48\uff0c\u6211\u4eec\u53ef\u4ee5\u628a Redis \u90e8\u7f72\u5728 MySQL \u524d\u7aef\u3002 \u5982\u679c\u8bbf\u95ee\u7684\u6570\u636e\u5728 Redis \u4e2d\uff0c\u6b64\u65f6\u7f13\u5b58\u547d\u4e2d\uff0cTomcat \u53ef\u4ee5\u76f4\u63a5\u4ece Redis \u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u52a0\u901f\u5e94\u7528\u7684\u8bbf\u95ee\u3002 \u5426\u5219\uff0cTomcat \u5c31\u9700\u8981\u4ece\u6162\u901f\u7684\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\u4e86\u3002 \u5230\u8fd9\u91cc\uff0c\u4f60\u53ef\u80fd\u5df2\u7ecf\u53d1\u73b0\u4e86\uff0c\u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u6211\u4eec\u57fa\u672c\u6709\u4e09\u4e2a\u64cd\u4f5c\uff1a \u5e94\u7528\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u9700\u8981\u5148\u8bfb\u53d6 Redis\uff1b \u53d1\u751f\u7f13\u5b58\u7f3a\u5931\u65f6\uff0c\u9700\u8981\u4ece\u6570\u636e\u5e93\u8bfb\u53d6\u6570\u636e\uff1b \u53d1\u751f\u7f13\u5b58\u7f3a\u5931\u65f6\uff0c\u8fd8\u9700\u8981\u66f4\u65b0\u7f13\u5b58\u3002","title":"2\u3001Redis \u7f13\u5b58\u5904\u7406\u8bf7\u6c42\u7684\u4e24\u79cd\u60c5\u51b5"},{"location":"chap5/1redis_cache/#3redis","text":"Redis \u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u7cfb\u7edf\u8f6f\u4ef6\uff0c\u548c\u4e1a\u52a1\u5e94\u7528\u7a0b\u5e8f\u662f\u4e24\u4e2a\u8f6f\u4ef6\uff0c\u5f53\u6211\u4eec\u90e8\u7f72\u4e86 Redis \u5b9e\u4f8b\u540e\uff0c\u5b83\u53ea\u4f1a\u88ab\u52a8\u5730\u7b49\u5f85\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\uff0c\u7136\u540e\u518d\u8fdb\u884c\u5904\u7406\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u60f3\u8981\u4f7f\u7528 Redis \u7f13\u5b58\uff0c\u6211\u4eec\u5c31\u8981\u5728\u7a0b\u5e8f\u4e2d\u589e\u52a0\u76f8\u5e94\u7684\u7f13\u5b58\u64cd\u4f5c\u4ee3\u7801\u3002 \u6211\u4eec\u4e5f\u628a Redis \u79f0\u4e3a\u65c1\u8def\u7f13\u5b58\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8bfb\u53d6\u7f13\u5b58\u3001\u8bfb\u53d6\u6570\u636e\u5e93\u548c\u66f4\u65b0\u7f13\u5b58\u7684\u64cd\u4f5c\u90fd\u9700\u8981\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u6765\u5b8c\u6210\u3002 \u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u9700\u8981\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u589e\u52a0\u4e09\u65b9\u9762\u7684\u4ee3\u7801\uff1a \u5f53\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5728\u4ee3\u7801\u4e2d\u663e\u5f0f\u8c03\u7528 Redis \u7684 GET \u64cd\u4f5c\u63a5\u53e3\uff0c\u8fdb\u884c\u67e5\u8be2\uff1b \u5982\u679c\u7f13\u5b58\u7f3a\u5931\u4e86\uff0c\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u518d\u548c\u6570\u636e\u5e93\u8fde\u63a5\uff0c\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\uff1b \u5f53\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u9700\u8981\u66f4\u65b0\u65f6\uff0c\u6211\u4eec\u4e5f\u9700\u8981\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u663e\u5f0f\u5730\u8c03\u7528 SET \u64cd\u4f5c\u63a5\u53e3\uff0c\u628a\u66f4\u65b0\u7684\u6570\u636e\u5199\u5165\u7f13\u5b58\u3002 \u5c55\u793a\u4e00\u6bb5 Web \u5e94\u7528\u4e2d\u4f7f\u7528 Redis \u7f13\u5b58\u7684\u4f2a\u4ee3\u7801\u793a\u4f8b\u3002 String cacheKey = \u201cproductid_11010003\u201d; String cacheValue = redisCache.get(cacheKey)\uff1b //\u7f13\u5b58\u547d\u4e2d if ( cacheValue != NULL) return cacheValue; //\u7f13\u5b58\u7f3a\u5931 else cacheValue = getProductFromDB(); redisCache.put(cacheValue) //\u7f13\u5b58\u66f4\u65b0 \u53ef\u4ee5\u770b\u5230\uff0c\u4e3a\u4e86\u4f7f\u7528\u7f13\u5b58\uff0c Web \u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u6709\u4e00\u4e2a\u8868\u793a\u7f13\u5b58\u7cfb\u7edf\u7684\u5b9e\u4f8b\u5bf9\u8c61 redisCache \uff0c\u8fd8\u9700\u8981\u4e3b\u52a8\u8c03\u7528 Redis \u7684 GET \u63a5\u53e3\uff0c\u5e76\u4e14\u8981\u5904\u7406\u7f13\u5b58\u547d\u4e2d\u548c\u7f13\u5b58\u7f3a\u5931\u65f6\u7684\u903b\u8f91\uff0c\u4f8b\u5982\u5728\u7f13\u5b58\u7f3a\u5931\u65f6\uff0c\u9700\u8981\u66f4\u65b0\u7f13\u5b58 \u3002 \u5728\u4f7f\u7528\u65c1\u8def\u7f13\u5b58\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u589e\u52a0\u64cd\u4f5c\u4ee3\u7801\uff0c\u589e\u52a0\u4e86\u4f7f\u7528 Redis \u7f13\u5b58\u7684\u989d\u5916\u5de5\u4f5c\u91cf\uff0c\u4f46\u662f\uff0c\u4e5f\u6b63\u56e0\u4e3a Redis \u662f\u65c1\u8def\u7f13\u5b58\uff0c\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u7cfb\u7edf\uff0c\u6211\u4eec\u53ef\u4ee5\u5355\u72ec\u5bf9 Redis \u7f13\u5b58\u8fdb\u884c\u6269\u5bb9\u6216\u6027\u80fd\u4f18\u5316\u3002\u800c\u4e14\uff0c\u53ea\u8981\u4fdd\u6301\u64cd\u4f5c\u63a5\u53e3\u4e0d\u53d8\uff0c\u6211\u4eec\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u589e\u52a0\u7684\u4ee3\u7801\u5c31\u4e0d\u7528\u518d\u4fee\u6539\u4e86\u3002 \u9664\u4e86\u4ece Redis \u7f13\u5b58\u4e2d\u67e5\u8be2\u3001\u8bfb\u53d6\u6570\u636e\u4ee5\u5916\uff0c\u5e94\u7528\u7a0b\u5e8f\u8fd8\u53ef\u80fd\u4f1a\u5bf9\u6570\u636e\u8fdb\u884c\u4fee\u6539\uff0c\u8fd9\u65f6\uff0c\u6211\u4eec\u65e2\u53ef\u4ee5\u5728\u7f13\u5b58\u4e2d\u4fee\u6539\uff0c\u4e5f\u53ef\u4ee5\u5728\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u8fdb\u884c\u4fee\u6539\uff0c\u6211\u4eec\u8be5\u600e\u4e48\u9009\u62e9\u5462\uff1f Redis \u7f13\u5b58\u7684\u4e24\u79cd\u7c7b\u578b \uff1a\u53ea\u8bfb\u7f13\u5b58\u548c\u8bfb\u5199\u7f13\u5b58\u3002 \u53ea\u8bfb\u7f13\u5b58\u80fd\u52a0\u901f\u8bfb\u8bf7\u6c42\uff0c\u800c\u8bfb\u5199\u7f13\u5b58\u53ef\u4ee5\u540c\u65f6\u52a0\u901f\u8bfb\u5199\u8bf7\u6c42 \u3002 \u8bfb\u5199\u7f13\u5b58\u53c8\u6709\u4e24\u79cd\u6570\u636e\u5199\u56de\u7b56\u7565\uff0c\u53ef\u4ee5\u8ba9\u6211\u4eec\u6839\u636e\u4e1a\u52a1\u9700\u6c42\uff0c\u5728\u4fdd\u8bc1\u6027\u80fd\u548c\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\u4e4b\u95f4\u8fdb\u884c\u9009\u62e9\u3002 \u6240\u4ee5\uff0c\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6765\u5177\u4f53\u4e86\u89e3\u4e0b Redis \u7684\u7f13\u5b58\u7c7b\u578b\u548c\u76f8\u5e94\u7684\u5199\u56de\u7b56\u7565\u3002","title":"3\u3001Redis \u4f5c\u4e3a\u65c1\u8def\u7f13\u5b58\u7684\u4f7f\u7528\u64cd\u4f5c"},{"location":"chap5/1redis_cache/#4","text":"\u6309\u7167 Redis \u7f13\u5b58\u662f\u5426\u63a5\u53d7\u5199\u8bf7\u6c42\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u5206\u6210 \u53ea\u8bfb\u7f13\u5b58\u548c\u8bfb\u5199\u7f13\u5b58 \u3002","title":"4\u3001\u7f13\u5b58\u7684\u7c7b\u578b"},{"location":"chap5/1redis_cache/#4-1","text":"\u5f53 Redis \u7528\u4f5c\u53ea\u8bfb\u7f13\u5b58\u65f6\uff0c\u5e94\u7528\u8981\u8bfb\u53d6\u6570\u636e\u7684\u8bdd\uff0c\u4f1a\u5148\u8c03\u7528 Redis GET \u63a5\u53e3\uff0c\u67e5\u8be2\u6570\u636e\u662f\u5426\u5b58\u5728\u3002 \u800c\u6240\u6709\u7684\u6570\u636e\u5199\u8bf7\u6c42\uff0c\u4f1a\u76f4\u63a5\u53d1\u5f80\u540e\u7aef\u7684\u6570\u636e\u5e93\uff0c\u5728\u6570\u636e\u5e93\u4e2d\u589e\u5220\u6539\u3002 \u5bf9\u4e8e\u5220\u6539\u7684\u6570\u636e\u6765\u8bf4\uff0c\u5982\u679c Redis \u5df2\u7ecf\u7f13\u5b58\u4e86\u76f8\u5e94\u7684\u6570\u636e\uff0c\u5e94\u7528\u9700\u8981\u628a\u8fd9\u4e9b\u7f13\u5b58\u7684\u6570\u636e\u5220\u9664\uff0cRedis \u4e2d\u5c31\u6ca1\u6709\u8fd9\u4e9b\u6570\u636e\u4e86\u3002 \u5f53\u5e94\u7528\u518d\u6b21\u8bfb\u53d6\u8fd9\u4e9b\u6570\u636e\u65f6\uff0c\u4f1a\u53d1\u751f\u7f13\u5b58\u7f3a\u5931\uff0c\u5e94\u7528\u4f1a\u628a\u8fd9\u4e9b\u6570\u636e\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u51fa\u6765\uff0c\u5e76\u5199\u5230\u7f13\u5b58\u4e2d\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u8fd9\u4e9b\u6570\u636e\u540e\u7eed\u518d\u88ab\u8bfb\u53d6\u65f6\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u4e86\uff0c\u80fd\u8d77\u5230\u52a0\u901f\u8bbf\u95ee\u7684\u6548\u679c\u3002 \u5047\u8bbe\u4e1a\u52a1\u5e94\u7528\u8981\u4fee\u6539\u6570\u636e A\uff0c\u6b64\u65f6\uff0c\u6570\u636e A \u5728 Redis \u4e2d\u4e5f\u7f13\u5b58\u4e86\uff0c \u5e94\u7528\u4f1a\u5148\u76f4\u63a5\u5728 \u6570\u636e\u5e93\u91cc\u4fee\u6539 A\uff0c\u5e76\u628a Redis \u4e2d\u7684 A \u5220\u9664 \u3002 \u7b49\u5230\u5e94\u7528\u9700\u8981\u8bfb\u53d6\u6570\u636e A \u65f6\uff0c\u4f1a\u53d1\u751f \u7f13\u5b58\u7f3a\u5931\uff0c\u6b64\u65f6\uff0c\u5e94\u7528\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6 A\uff0c\u5e76\u5199\u5165 Redis \uff0c\u4ee5\u4fbf\u540e\u7eed\u8bf7\u6c42\u4ece\u7f13\u5b58\u4e2d\u76f4\u63a5\u8bfb\u53d6\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u53ea\u8bfb\u7f13\u5b58\u76f4\u63a5\u5728\u6570\u636e\u5e93\u4e2d\u66f4\u65b0\u6570\u636e\u7684\u597d\u5904\u662f\uff0c\u6240\u6709\u6700\u65b0\u7684\u6570\u636e\u90fd\u5728\u6570\u636e\u5e93\u4e2d\uff0c\u800c\u6570\u636e\u5e93\u662f\u63d0\u4f9b\u6570\u636e\u53ef\u9760\u6027\u4fdd\u969c\u7684\uff0c\u8fd9\u4e9b\u6570\u636e\u4e0d\u4f1a\u6709\u4e22\u5931\u7684\u98ce\u9669\u3002 \u5f53\u6211\u4eec\u9700\u8981\u7f13\u5b58\u56fe\u7247\u3001\u77ed\u89c6\u9891\u8fd9\u4e9b\u7528\u6237\u53ea\u8bfb\u7684\u6570\u636e\u65f6\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u53ea\u8bfb\u7f13\u5b58\u8fd9\u4e2a\u7c7b\u578b\u4e86\u3002","title":"4-1 \u53ea\u8bfb\u7f13\u5b58"},{"location":"chap5/1redis_cache/#4-2","text":"\u5bf9\u4e8e\u8bfb\u5199\u7f13\u5b58\u6765\u8bf4\uff0c\u9664\u4e86\u8bfb\u8bf7\u6c42\u4f1a\u53d1\u9001\u5230\u7f13\u5b58\u8fdb\u884c\u5904\u7406\uff08\u76f4\u63a5\u5728\u7f13\u5b58\u4e2d\u67e5\u8be2\u6570\u636e\u662f\u5426\u5b58\u5728)\uff0c\u6240\u6709\u7684\u5199\u8bf7\u6c42\u4e5f\u4f1a\u53d1\u9001\u5230\u7f13\u5b58\uff0c\u5728\u7f13\u5b58\u4e2d\u76f4\u63a5\u5bf9\u6570\u636e\u8fdb\u884c\u589e\u5220\u6539\u64cd\u4f5c\u3002 \u6b64\u65f6\uff0c\u5f97\u76ca\u4e8e Redis \u7684\u9ad8\u6027\u80fd\u8bbf\u95ee\u7279\u6027\uff0c\u6570\u636e\u7684\u589e\u5220\u6539\u64cd\u4f5c\u53ef\u4ee5\u5728\u7f13\u5b58\u4e2d\u5feb\u901f\u5b8c\u6210\uff0c\u5904\u7406\u7ed3\u679c\u4e5f\u4f1a\u5feb\u901f\u8fd4\u56de\u7ed9\u4e1a\u52a1\u5e94\u7528\uff0c\u8fd9\u5c31\u53ef\u4ee5\u63d0\u5347\u4e1a\u52a1\u5e94\u7528\u7684\u54cd\u5e94\u901f\u5ea6\u3002 \u4f46\u662f\uff0c\u548c\u53ea\u8bfb\u7f13\u5b58\u4e0d\u4e00\u6837\u7684\u662f\uff0c\u5728\u4f7f\u7528\u8bfb\u5199\u7f13\u5b58\u65f6\uff0c\u6700\u65b0\u7684\u6570\u636e\u662f\u5728 Redis \u4e2d\uff0c\u800c Redis \u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u4e00\u65e6\u51fa\u73b0\u6389\u7535\u6216\u5b95\u673a \uff0c\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u3002\u8fd9\u4e5f\u5c31\u662f\u8bf4\uff0c\u5e94\u7528\u7684\u6700\u65b0\u6570\u636e\u53ef\u80fd\u4f1a\u4e22\u5931\uff0c\u7ed9\u5e94\u7528\u4e1a\u52a1\u5e26\u6765\u98ce\u9669\u3002 \u6240\u4ee5\uff0c\u6839\u636e\u4e1a\u52a1\u5e94\u7528\u5bf9\u6570\u636e\u53ef\u9760\u6027\u548c\u7f13\u5b58\u6027\u80fd\u7684\u4e0d\u540c\u8981\u6c42\uff0c \u6211\u4eec\u4f1a\u6709\u540c\u6b65\u76f4\u5199\u548c\u5f02\u6b65\u5199\u56de\u4e24\u79cd\u7b56\u7565\u3002\u5176\u4e2d\uff0c\u540c\u6b65\u76f4\u5199\u7b56\u7565\u4f18\u5148\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\uff0c\u800c\u5f02\u6b65\u5199\u56de\u7b56\u7565\u4f18\u5148\u63d0\u4f9b\u5feb\u901f\u54cd\u5e94\u3002","title":"4-2 \u8bfb\u5199\u7f13\u5b58"},{"location":"chap5/1redis_cache/#4-2_1","text":"\u5199\u8bf7\u6c42\u53d1\u7ed9\u7f13\u5b58\u7684\u540c\u65f6\uff0c\u4e5f\u4f1a\u53d1\u7ed9\u540e\u7aef\u6570\u636e\u5e93\u8fdb\u884c\u5904\u7406\uff0c\u7b49\u5230\u7f13\u5b58\u548c\u6570\u636e\u5e93\u90fd\u5199\u5b8c\u6570\u636e\uff0c\u624d\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de \u5373\u4f7f\u7f13\u5b58\u5b95\u673a\u6216\u53d1\u751f\u6545\u969c\uff0c\u6700\u65b0\u7684\u6570\u636e\u4ecd\u7136\u4fdd\u5b58\u5728\u6570\u636e\u5e93\u4e2d\uff0c\u8fd9\u5c31\u63d0\u4f9b\u4e86\u6570\u636e\u53ef\u9760\u6027\u4fdd\u8bc1\u3002 \u4e0d\u8fc7\uff0c\u540c\u6b65\u76f4\u5199\u4f1a\u964d\u4f4e\u7f13\u5b58\u7684\u8bbf\u95ee\u6027\u80fd\u3002 \u8fd9\u662f\u56e0\u4e3a\u7f13\u5b58\u4e2d\u5904\u7406\u5199\u8bf7\u6c42\u7684\u901f\u5ea6\u662f\u5f88\u5feb\u7684\uff0c\u800c\u6570\u636e\u5e93\u5904\u7406\u5199\u8bf7\u6c42\u7684\u901f\u5ea6\u8f83\u6162\u3002 \u5373\u4f7f\u7f13\u5b58\u5f88\u5feb\u5730\u5904\u7406\u4e86\u5199\u8bf7\u6c42\uff0c\u4e5f\u9700\u8981\u7b49\u5f85\u6570\u636e\u5e93\u5904\u7406\u5b8c\u6240\u6709\u7684\u5199\u8bf7\u6c42\uff0c\u624d\u80fd\u7ed9\u5e94\u7528\u8fd4\u56de\u7ed3\u679c\uff0c\u8fd9\u5c31\u589e\u52a0\u4e86\u7f13\u5b58\u7684\u54cd\u5e94\u5ef6\u8fdf\u3002","title":"4-2  \u8bfb\u5199\u7f13\u5b58:\u540c\u6b65\u76f4\u5199"},{"location":"chap5/1redis_cache/#4-3","text":"\u800c\u5f02\u6b65\u5199\u56de\u7b56\u7565\uff0c\u5219\u662f\u4f18\u5148\u8003\u8651\u4e86\u54cd\u5e94\u5ef6\u8fdf\u3002\u6b64\u65f6\uff0c \u6240\u6709\u5199\u8bf7\u6c42\u90fd\u5148\u5728\u7f13\u5b58\u4e2d\u5904\u7406\u3002\u7b49\u5230\u8fd9\u4e9b\u589e\u6539\u7684\u6570\u636e\u8981\u88ab\u4ece\u7f13\u5b58\u4e2d\u6dd8\u6c70\u51fa\u6765\u65f6\uff0c\u7f13\u5b58\u5c06\u5b83\u4eec\u5199\u56de\u540e\u7aef\u6570\u636e\u5e93\u3002 \u53ea\u4e0d\u8fc7\uff0c\u5982\u679c\u53d1\u751f\u4e86\u6389\u7535\uff0c\u800c\u5b83\u4eec\u8fd8\u6ca1\u6709\u88ab\u5199\u56de\u6570\u636e\u5e93\uff0c\u5c31\u4f1a\u6709\u4e22\u5931\u7684\u98ce\u9669\u4e86\u3002 \u5173\u4e8e\u662f\u9009\u62e9\u53ea\u8bfb\u7f13\u5b58\uff0c\u8fd8\u662f\u8bfb\u5199\u7f13\u5b58\uff0c\u4e3b\u8981\u770b\u6211\u4eec\u5bf9\u5199\u8bf7\u6c42\u662f\u5426\u6709\u52a0\u901f\u7684\u9700\u6c42\u3002 \u5982\u679c\u9700\u8981\u5bf9\u5199\u8bf7\u6c42\u8fdb\u884c\u52a0\u901f\uff0c\u6211\u4eec\u9009\u62e9\u8bfb\u5199\u7f13\u5b58\uff1b \u5982\u679c\u5199\u8bf7\u6c42\u5f88\u5c11\uff0c\u6216\u8005\u662f\u53ea\u9700\u8981\u63d0\u5347\u8bfb\u8bf7\u6c42\u7684\u54cd\u5e94\u901f\u5ea6\u7684\u8bdd\uff0c\u6211\u4eec\u9009\u62e9\u53ea\u8bfb\u7f13\u5b58\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5728\u5546\u54c1\u5927\u4fc3\u7684\u573a\u666f\u4e2d\uff0c\u5546\u54c1\u7684\u5e93\u5b58\u4fe1\u606f\u4f1a\u4e00\u76f4\u88ab\u4fee\u6539\u3002\u5982\u679c\u6bcf\u6b21\u4fee\u6539\u90fd\u9700\u5230\u6570\u636e\u5e93\u4e2d\u5904\u7406\uff0c\u5c31\u4f1a\u62d6\u6162\u6574\u4e2a\u5e94\u7528\uff0c\u6b64\u65f6\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u9009\u62e9\u8bfb\u5199\u7f13\u5b58\u7684\u6a21\u5f0f\u3002 \u800c\u5728\u77ed\u89c6\u9891 App \u7684\u573a\u666f\u4e2d\uff0c\u867d\u7136\u89c6\u9891\u7684\u5c5e\u6027\u6709\u5f88\u591a\uff0c\u4f46\u662f\uff0c\u4e00\u822c\u786e\u5b9a\u540e\uff0c\u4fee\u6539\u5e76\u4e0d\u9891\u7e41\uff0c\u6b64\u65f6\uff0c\u5728\u6570\u636e\u5e93\u4e2d\u8fdb\u884c\u4fee\u6539\u5bf9\u7f13\u5b58\u5f71\u54cd\u4e0d\u5927\uff0c\u6240\u4ee5\u53ea\u8bfb\u7f13\u5b58\u6a21\u5f0f\u662f\u4e00\u4e2a\u5408\u9002\u7684\u9009\u62e9\u3002","title":"4-3  \u8bfb\u5199\u7f13\u5b58:\u800c\u5f02\u6b65\u5199\u56de"},{"location":"chap5/1redis_cache/#5","text":"\u5206\u5c42\u7cfb\u7edf\u4e2d\uff0c\u6570\u636e\u6682\u5b58\u5728\u5feb\u901f\u5b50\u7cfb\u7edf\u4e2d\u6709\u52a9\u4e8e\u52a0\u901f\u8bbf\u95ee\uff1b\u7f13\u5b58\u5bb9\u91cf\u6709\u9650\uff0c\u7f13\u5b58\u5199\u6ee1\u65f6\uff0c\u6570\u636e\u9700\u8981\u88ab\u6dd8\u6c70 Redis \u5929\u7136\u5c31\u5177\u6709\u9ad8\u6027\u80fd\u8bbf\u95ee\u548c\u6570\u636e\u6dd8\u6c70\u673a\u5236\uff0c\u6b63\u597d\u7b26\u5408\u7f13\u5b58\u7684\u8fd9\u4e24\u4e2a\u7279\u5f81\u7684\u8981\u6c42\uff0c\u6240\u4ee5\u975e\u5e38\u9002\u5408\u7528\u4f5c\u7f13\u5b58\u3002 Redis \u4f5c\u4e3a\u65c1\u8def\u7f13\u5b58\u7684\u7279\u6027\uff0c\u65c1\u8def\u7f13\u5b58\u5c31\u610f\u5473\u7740\u9700\u8981\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u65b0\u589e\u7f13\u5b58\u903b\u8f91\u5904\u7406\u7684\u4ee3\u7801\u3002\u5f53\u7136\uff0c\u5982\u679c\u662f\u65e0\u6cd5\u4fee\u6539\u6e90\u7801\u7684\u5e94\u7528\u573a\u666f\uff0c\u5c31\u4e0d\u80fd\u4f7f\u7528 Redis \u505a\u7f13\u5b58\u4e86\u3002 Redis \u505a\u7f13\u5b58\u65f6\uff0c\u8fd8\u6709\u4e24\u79cd\u6a21\u5f0f\uff0c\u5206\u522b\u662f\u53ea\u8bfb\u7f13\u5b58\u548c\u8bfb\u5199\u7f13\u5b58\u3002 \u8bfb\u5199\u7f13\u5b58\u8fd8\u63d0\u4f9b\u4e86\u540c\u6b65\u76f4\u5199\u548c\u5f02\u6b65\u5199\u56de\u8fd9\u4e24\u79cd\u6a21\u5f0f\uff0c\u540c\u6b65\u76f4\u5199\u6a21\u5f0f\u4fa7\u91cd\u4e8e\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\uff0c\u800c\u5f02\u6b65\u5199\u56de\u6a21\u5f0f\u5219\u4fa7\u91cd\u4e8e\u63d0\u4f9b\u4f4e\u5ef6\u8fdf\u8bbf\u95ee\uff0c \u5982\u679c\u9700\u8981\u5bf9\u5199\u8bf7\u6c42\u8fdb\u884c\u52a0\u901f\uff0c\u6211\u4eec\u9009\u62e9\u8bfb\u5199\u7f13\u5b58\uff1b \u5982\u679c\u5199\u8bf7\u6c42\u5f88\u5c11\uff0c\u6216\u8005\u662f\u53ea\u9700\u8981\u63d0\u5347\u8bfb\u8bf7\u6c42\u7684\u54cd\u5e94\u901f\u5ea6\u7684\u8bdd\uff0c\u6211\u4eec\u9009\u62e9\u53ea\u8bfb\u7f13\u5b58\u3002","title":"5\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap5/2redis_cache_full/","text":"\u7b2c\u4e8c\u8282 \u7f13\u5b58\u6ee1\u540e\u7684\u66ff\u6362\u7b56\u7565 Redis \u7f13\u5b58\u4f7f\u7528\u5185\u5b58\u6765\u4fdd\u5b58\u6570\u636e\uff0c\u907f\u514d\u4e1a\u52a1\u5e94\u7528\u4ece\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u53ef\u4ee5\u63d0\u5347\u5e94\u7528\u7684\u54cd\u5e94\u901f\u5ea6\u3002\u90a3\u4e48\uff0c\u5982\u679c\u6211\u4eec\u628a\u6240\u6709\u8981\u8bbf\u95ee\u7684\u6570\u636e\u90fd\u653e\u5165\u7f13\u5b58\uff0c\u8fd9\u6837\u505a\u7684\u6027\u4ef7\u6bd4\u53cd\u800c\u4e0d\u9ad8\u3002 \u4e3e\u4e2a\u4f8b\u5b50\u5427\u3002MySQL \u4e2d\u6709 1TB \u7684\u6570\u636e\uff0c\u5982\u679c\u6211\u4eec\u4f7f\u7528 Redis \u628a\u8fd9 1TB \u7684\u6570\u636e\u90fd\u7f13\u5b58\u8d77\u6765\uff0c\u867d\u7136\u5e94\u7528\u90fd\u80fd\u5728\u5185\u5b58\u4e2d\u8bbf\u95ee\u6570\u636e\u4e86\uff0c\u4f46\u662f\uff0c\u8fd9\u6837\u914d\u7f6e\u5e76\u4e0d\u5408\u7406\uff0c\u56e0\u4e3a\u6027\u4ef7\u6bd4\u5f88\u4f4e\u3002\u4e00\u65b9\u9762\uff0c1TB \u5185\u5b58\u7684\u4ef7\u683c\u5927\u7ea6\u662f 3.5 \u4e07\u5143\uff0c\u800c 1TB \u78c1\u76d8\u7684\u4ef7\u683c\u5927\u7ea6\u662f 1000 \u5143\u3002 \u53e6\u4e00\u65b9\u9762\uff0c\u6570\u636e\u8bbf\u95ee\u90fd\u662f\u6709\u5c40\u90e8\u6027\u7684\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u901a\u5e38\u6240\u8bf4\u7684\u201c\u516b\u4e8c\u539f\u7406\u201d\uff0c80% \u7684\u8bf7\u6c42\u5b9e\u9645\u53ea\u8bbf\u95ee\u4e86 20% \u7684\u6570\u636e\u3002\u6240\u4ee5\uff0c\u7528 1TB \u7684\u5185\u5b58\u505a\u7f13\u5b58\uff0c\u5e76\u6ca1\u6709\u5fc5\u8981\u3002 \u4e3a\u4e86\u4fdd\u8bc1\u8f83\u9ad8\u7684\u6027\u4ef7\u6bd4\uff0c\u7f13\u5b58\u7684\u7a7a\u95f4\u5bb9\u91cf\u5fc5\u7136\u8981\u5c0f\u4e8e\u540e\u7aef\u6570\u636e\u5e93\u7684\u6570\u636e\u603b\u91cf\u3002\u4e0d\u8fc7\uff0c\u5185\u5b58\u5927\u5c0f\u6bd5\u7adf\u6709\u9650\uff0c\u968f\u7740\u8981\u7f13\u5b58\u7684\u6570\u636e\u91cf\u8d8a\u6765\u8d8a\u5927\uff0c\u6709\u9650\u7684\u7f13\u5b58\u7a7a\u95f4\u4e0d\u53ef\u907f\u514d\u5730\u4f1a\u88ab\u5199\u6ee1\u3002 \u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5c31\u6d89\u53ca\u5230\u7f13\u5b58\u7cfb\u7edf\u7684\u4e00\u4e2a\u91cd\u8981\u673a\u5236\uff0c \u5373\u7f13\u5b58\u6570\u636e\u7684\u6dd8\u6c70\u673a\u5236 \u6570\u636e\u6dd8\u6c70\u673a\u5236\u5305\u62ec\u4e24\u6b65\uff1a \u7b2c\u4e00\uff0c\u6839\u636e\u4e00\u5b9a\u7684\u7b56\u7565\uff0c\u7b5b\u9009\u51fa\u5bf9\u5e94\u7528\u8bbf\u95ee\u6765\u8bf4\u201c\u4e0d\u91cd\u8981\u201d\u7684\u6570\u636e\uff1b \u7b2c\u4e8c\uff0c\u5c06\u8fd9\u4e9b\u6570\u636e\u4ece\u7f13\u5b58\u4e2d\u5220\u9664\uff0c\u4e3a\u65b0\u6765\u7684\u6570\u636e\u817e\u51fa\u7a7a\u95f4\uff0c\u2019 1\u3001\u8bbe\u7f6e\u591a\u5927\u7684\u7f13\u5b58\u5bb9\u91cf\u5408\u9002\uff1f \u7f13\u5b58\u5bb9\u91cf\u8bbe\u7f6e\u5f97\u662f\u5426\u5408\u7406\uff0c\u4f1a\u76f4\u63a5\u5f71\u54cd\u5230\u4f7f\u7528\u7f13\u5b58\u7684\u6027\u4ef7\u6bd4 1-1 \u957f\u5c3e\u6548\u5e94 \u84dd\u7ebf\u4ee3\u8868\u4e86\u201c\u516b\u4e8c\u539f\u7406\u201d\u8868\u793a\u7684\u6570\u636e\u5c40\u90e8\u6027\uff0c\u800c\u7ea2\u7ebf\u5219\u8868\u793a\u5728\u5f53\u524d\u5e94\u7528\u8d1f\u8f7d\u4e0b\uff0c\u6570\u636e\u5c40\u90e8\u6027\u7684\u53d8\u5316\u3002 \u84dd\u7ebf\u3002\u5b83\u8868\u793a\u7684\u5c31\u662f\u201c\u516b\u4e8c\u539f\u7406\u201d\uff0c\u6709 20% \u7684\u6570\u636e\u8d21\u732e\u4e86 80% \u7684\u8bbf\u95ee\u4e86\uff0c\u800c\u5269\u4f59\u7684\u6570\u636e\u867d\u7136\u4f53\u91cf\u5f88\u5927\uff0c\u4f46\u53ea\u8d21\u732e\u4e86 20% \u7684\u8bbf\u95ee\u91cf\u3002 \u8fd9 80% \u7684\u6570\u636e\u5728\u8bbf\u95ee\u91cf\u4e0a\u5c31\u5f62\u6210\u4e86\u4e00\u6761\u957f\u957f\u7684\u5c3e\u5df4\uff0c\u6211\u4eec\u4e5f\u79f0\u4e3a\u201c\u957f\u5c3e\u6548\u5e94\u201d\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u6309\u7167\u201c\u516b\u4e8c\u539f\u7406\u201d\u6765\u8bbe\u7f6e\u7f13\u5b58\u7a7a\u95f4\u5bb9\u91cf\uff0c\u4e5f\u5c31\u662f\u628a\u7f13\u5b58\u7a7a\u95f4\u5bb9\u91cf\u8bbe\u7f6e\u4e3a\u603b\u6570\u636e\u91cf\u7684 20% \u7684\u8bdd\uff0c\u5c31\u6709\u53ef\u80fd\u62e6\u622a\u5230 80% \u7684\u8bbf\u95ee\u3002 \u4e3a\u4ec0\u4e48\u8bf4\u662f\u201c\u6709\u53ef\u80fd\u201d\u5462\uff1f \u8fd9\u662f\u56e0\u4e3a\uff0c\u201c\u516b\u4e8c\u539f\u7406\u201d\u662f\u5bf9\u5927\u91cf\u5b9e\u9645\u5e94\u7528\u7684\u6570\u636e\u8bbf\u95ee\u60c5\u51b5\u505a\u4e86\u7edf\u8ba1\u540e\uff0c\u5f97\u51fa\u7684\u4e00\u4e2a\u7edf\u8ba1\u5b66\u610f\u4e49\u4e0a\u7684\u6570\u636e\u91cf\u548c\u8bbf\u95ee\u91cf\u7684\u6bd4\u4f8b\u3002\u5177\u4f53\u5230\u67d0\u4e00\u4e2a\u5e94\u7528\u6765\u8bf4\uff0c\u6570\u636e\u8bbf\u95ee\u7684\u89c4\u5f8b\u4f1a\u548c\u5177\u4f53\u7684\u4e1a\u52a1\u573a\u666f\u6709\u5173\u3002\u5bf9\u4e8e\u6700\u5e38\u88ab\u8bbf\u95ee\u7684 20% \u7684\u6570\u636e\u6765\u8bf4\uff0c\u5b83\u4eec\u8d21\u732e\u7684\u8bbf\u95ee\u91cf\uff0c\u65e2\u6709\u53ef\u80fd\u8d85\u8fc7 80%\uff0c\u4e5f\u6709\u53ef\u80fd\u4e0d\u5230 80%\u3002 \u4e00\u4e2a\u7535\u5546\u5546\u54c1\u7684\u573a\u666f\u3002 \u4e00\u65b9\u9762\uff0c\u5728\u5546\u54c1\u4fc3\u9500\u65f6\uff0c \u70ed\u95e8\u5546\u54c1\u7684\u4fe1\u606f\u53ef\u80fd\u53ea\u5360\u5230\u603b\u5546\u54c1\u6570\u636e\u4fe1\u606f\u91cf\u7684 5%\uff0c\u800c\u8fd9\u4e9b\u5546\u54c1\u4fe1\u606f\u627f\u8f7d\u7684\u53ef\u80fd\u662f\u8d85\u8fc7 90% \u7684\u8bbf\u95ee\u8bf7\u6c42 \u3002\u8fd9\u65f6\uff0c\u6211\u4eec\u53ea\u8981\u7f13\u5b58\u8fd9 5% \u7684\u6570\u636e\uff0c\u5c31\u80fd\u83b7\u5f97\u5f88\u597d\u7684\u6027\u80fd\u6536\u76ca \u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c\u4e1a\u52a1\u5e94\u7528\u8981\u5bf9\u6240\u6709\u5546\u54c1\u4fe1\u606f\u8fdb\u884c\u67e5\u8be2\u7edf\u8ba1\uff0c\u8fd9\u65f6\u5019\uff0c \u5373\u4f7f\u6309\u7167\u201c\u516b\u4e8c\u539f\u7406\u201d\u7f13\u5b58\u4e86 20% \u7684\u5546\u54c1\u6570\u636e\uff0c\u4e5f\u4e0d\u80fd\u83b7\u5f97\u5f88\u597d\u7684\u8bbf\u95ee\u6027\u80fd\uff0c\u56e0\u4e3a 80% \u7684\u6570\u636e\u4ecd\u7136\u9700\u8981\u4ece\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u83b7\u53d6\u3002 1-2 \u91cd\u5c3e\u6548\u5e94 \u5728\u8fd9\u6761\u7ea2\u7ebf\u4e0a\uff0c80% \u7684\u6570\u636e\u8d21\u732e\u7684\u8bbf\u95ee\u91cf\uff0c\u8d85\u8fc7\u4e86\u4f20\u7edf\u7684\u957f\u5c3e\u6548\u5e94\u4e2d 80% \u6570\u636e\u80fd\u8d21\u732e\u7684\u8bbf\u95ee\u91cf\u3002 \u539f\u56e0\u5728\u4e8e\uff0c\u7528\u6237\u7684\u4e2a\u6027\u5316\u9700\u6c42\u8d8a\u6765\u8d8a\u591a\uff0c\u5728\u4e00\u4e2a\u4e1a\u52a1\u5e94\u7528\u4e2d\uff0c\u4e0d\u540c\u7528\u6237\u8bbf\u95ee\u7684\u5185\u5bb9\u53ef\u80fd\u5dee\u522b\u5f88\u5927\uff0c\u6240\u4ee5\uff0c\u7528\u6237\u8bf7\u6c42\u7684\u6570\u636e\u548c\u5b83\u4eec\u8d21\u732e\u7684\u8bbf\u95ee\u91cf\u6bd4\u4f8b\uff0c\u4e0d\u518d\u5177\u5907\u957f\u5c3e\u6548\u5e94\u4e2d\u7684\u201c\u516b\u4e8c\u539f\u7406\u201d\u5206\u5e03\u7279\u5f81\u4e86\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c20% \u7684\u6570\u636e\u53ef\u80fd\u8d21\u732e\u4e0d\u4e86 80% \u7684\u8bbf\u95ee\uff0c\u800c\u5269\u4f59\u7684 80% \u6570\u636e\u53cd\u800c\u8d21\u732e\u4e86\u66f4\u591a\u7684\u8bbf\u95ee\u91cf\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u91cd\u5c3e\u6548\u5e94\u3002 \u6b63\u662f\u56e0\u4e3a 20% \u7684\u6570\u636e\u4e0d\u4e00\u5b9a\u80fd\u8d21\u732e 80% \u7684\u8bbf\u95ee\u91cf\uff0c\u6211\u4eec\u4e0d\u80fd\u7b80\u5355\u5730\u6309\u7167\u201c\u603b\u6570\u636e\u91cf\u7684 20%\u201d\u6765\u8bbe\u7f6e\u7f13\u5b58\u6700\u5927\u7a7a\u95f4\u5bb9\u91cf\u3002 \u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\uff0c\u6211\u770b\u5230\u8fc7\u7684\u7f13\u5b58\u5bb9\u91cf\u5360\u603b\u6570\u636e\u91cf\u7684\u6bd4\u4f8b\uff0c\u4ece 5% \u5230 40% \u7684\u90fd\u6709\u3002\u8fd9\u4e2a\u5bb9\u91cf\u89c4\u5212\u4e0d\u80fd\u4e00\u6982\u800c\u8bba\uff0c \u662f\u9700\u8981\u7ed3\u5408\u5e94\u7528\u6570\u636e\u5b9e\u9645\u8bbf\u95ee\u7279\u5f81\u548c\u6210\u672c\u5f00\u9500\u6765\u7efc\u5408\u8003\u8651\u7684 \u3002 1-3 \u7cfb\u7edf\u7684\u8bbe\u8ba1 \u7cfb\u7edf\u7684\u8bbe\u8ba1\u9009\u62e9\u662f\u4e00\u4e2a\u6743\u8861\u7684\u8fc7\u7a0b\uff1a \u5927\u5bb9\u91cf\u7f13\u5b58\u662f\u80fd\u5e26\u6765\u6027\u80fd\u52a0\u901f\u7684\u6536\u76ca\uff0c\u4f46\u662f\u6210\u672c\u4e5f\u4f1a\u66f4\u9ad8\uff0c\u800c\u5c0f\u5bb9\u91cf\u7f13\u5b58\u4e0d\u4e00\u5b9a\u5c31\u8d77\u4e0d\u5230\u52a0\u901f\u8bbf\u95ee\u7684\u6548\u679c\u3002 \u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4f1a\u5efa\u8bae\u628a\u7f13\u5b58\u5bb9\u91cf\u8bbe\u7f6e\u4e3a\u603b\u6570\u636e\u91cf\u7684 15% \u5230 30%\uff0c\u517c\u987e\u8bbf\u95ee\u6027\u80fd\u548c\u5185\u5b58\u7a7a\u95f4\u5f00\u9500\u3002 \u5bf9\u4e8e Redis \u6765\u8bf4\uff0c\u4e00\u65e6\u786e\u5b9a\u4e86\u7f13\u5b58\u6700\u5927\u5bb9\u91cf\uff0c\u6bd4\u5982 4GB\uff0c\u4f60\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u4e2a\u547d\u4ee4\u6765\u8bbe\u5b9a\u7f13\u5b58\u7684\u5927\u5c0f\u4e86\uff1a CONFIG SET maxmemory 4gb \u4e0d\u8fc7\uff0c\u7f13\u5b58\u88ab\u5199\u6ee1\u662f\u4e0d\u53ef\u907f\u514d\u7684\u3002 \u5373\u4f7f\u4f60\u7cbe\u6311\u7ec6\u9009\uff0c\u786e\u5b9a\u4e86\u7f13\u5b58\u5bb9\u91cf\uff0c\u8fd8\u662f\u8981\u9762\u5bf9\u7f13\u5b58\u5199\u6ee1\u65f6\u7684\u66ff\u6362\u64cd\u4f5c\u3002\u7f13\u5b58\u66ff\u6362\u9700\u8981\u89e3\u51b3\u4e24\u4e2a\u95ee\u9898\uff1a \u51b3\u5b9a\u6dd8\u6c70\u54ea\u4e9b\u6570\u636e\uff0c\u5982\u4f55\u5904\u7406\u90a3\u4e9b\u88ab\u6dd8\u6c70\u7684\u6570\u636e\u3002 2\u3001Redis \u7f13\u5b58\u6709\u54ea\u4e9b\u6dd8\u6c70\u7b56\u7565\uff1f 2-1 \u6570\u636e\u6dd8\u6c70\u7684\u7b56\u7565 Redis 4.0 \u4e4b\u524d\u4e00\u5171\u5b9e\u73b0\u4e86 6 \u79cd\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff0c\u5728 4.0 \u4e4b\u540e\uff0c\u53c8\u589e\u52a0\u4e86 2 \u79cd\u7b56\u7565\u3002 \u6211\u4eec\u53ef\u4ee5\u6309\u7167\u662f\u5426\u4f1a\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u628a\u5b83\u4eec\u5206\u6210\u4e24\u7c7b\uff1a \u4e0d\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u7684\u7b56\u7565\uff0c\u53ea\u6709 noeviction \u8fd9\u4e00\u79cd\u3002 \u4f1a\u8fdb\u884c\u6dd8\u6c70\u7684 7 \u79cd\u5176\u4ed6\u7b56\u7565\u3002 \u4f1a\u8fdb\u884c\u6dd8\u6c70\u7684 7 \u79cd\u7b56\u7565\uff0c\u6211\u4eec\u53ef\u4ee5\u518d\u8fdb\u4e00\u6b65\u6839\u636e\u6dd8\u6c70\u5019\u9009\u6570\u636e\u96c6\u7684\u8303\u56f4\u628a\u5b83\u4eec\u5206\u6210\u4e24\u7c7b\uff1a \u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u4e2d\u8fdb\u884c\u6dd8\u6c70 \uff0c\u5305\u62ec volatile-random \u3001 volatile-ttl \u3001 volatile-lru \u3001 volatile-lfu \uff08Redis 4.0 \u540e\u65b0\u589e\uff09\u56db\u79cd\u3002 \u5728\u6240\u6709\u6570\u636e\u8303\u56f4\u5185\u8fdb\u884c\u6dd8\u6c70 \uff0c\u5305\u62ec allkeys-lru \u3001 allkeys-random \u3001 allkeys-lfu \uff08Redis 4.0 \u540e\u65b0\u589e\uff09\u4e09\u79cd\u3002 \u4e0b\u9762\u6211\u5c31\u6765\u5177\u4f53\u89e3\u91ca\u4e0b\u5404\u4e2a\u7b56\u7565\u3002 2-2 noeviction \u7b56\u7565 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c Redis \u5728\u4f7f\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u8d85\u8fc7 maxmemory \u503c\u65f6\uff0c \u5e76\u4e0d\u4f1a\u6dd8\u6c70\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u8bbe\u5b9a\u7684 noeviction \u7b56\u7565 \u5bf9\u5e94\u5230 Redis \u7f13\u5b58\uff0c\u4e5f\u5c31\u662f\u6307\uff0c\u4e00\u65e6\u7f13\u5b58\u88ab\u5199\u6ee1\u4e86\uff0c\u518d\u6709\u5199\u8bf7\u6c42\u6765\u65f6\uff0cRedis \u4e0d\u518d\u63d0\u4f9b\u670d\u52a1\uff0c\u800c\u662f\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\u3002 Redis \u7528\u4f5c\u7f13\u5b58\u65f6\uff0c \u5b9e\u9645\u7684\u6570\u636e\u96c6\u901a\u5e38\u90fd\u662f\u5927\u4e8e\u7f13\u5b58\u5bb9\u91cf\u7684\uff0c\u603b\u4f1a\u6709\u65b0\u7684\u6570\u636e\u8981\u5199\u5165\u7f13\u5b58\uff0c\u8fd9\u4e2a\u7b56\u7565\u672c\u8eab\u4e0d\u6dd8\u6c70\u6570\u636e\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u817e\u51fa\u65b0\u7684\u7f13\u5b58\u7a7a\u95f4\uff0c\u6211\u4eec\u4e0d\u628a\u5b83\u7528\u5728 Redis \u7f13\u5b58\u4e2d\u3002 2-3 volatile-random\u3001volatile-ttl\u3001volatile-lru \u548c volatile-lfu \u5b83\u4eec\u7b5b\u9009\u7684\u5019\u9009\u6570\u636e\u8303\u56f4\uff0c\u88ab\u9650\u5236\u5728\u5df2\u7ecf\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u503c\u5bf9\u4e0a\u3002\u4e5f\u6b63\u56e0\u4e3a\u6b64\uff0c\u5373\u4f7f\u7f13\u5b58\u6ca1\u6709\u5199\u6ee1\uff0c \u8fd9\u4e9b\u6570\u636e\u5982\u679c\u8fc7\u671f\u4e86\uff0c\u4e5f\u4f1a\u88ab\u5220\u9664 \u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u4f7f\u7528 EXPIRE \u547d\u4ee4\u5bf9\u4e00\u6279\u952e\u503c\u5bf9\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u540e\uff0c \u65e0\u8bba\u662f\u8fd9\u4e9b\u952e\u503c\u5bf9\u7684\u8fc7\u671f\u65f6\u95f4\u662f\u5feb\u5230\u4e86\uff0c\u8fd8\u662f Redis \u7684\u5185\u5b58\u4f7f\u7528\u91cf\u8fbe\u5230\u4e86 maxmemory \u9608\u503c \uff0c Redis \u90fd\u4f1a\u8fdb\u4e00\u6b65\u6309\u7167 volatile-ttl\u3001volatile-random\u3001volatile-lru\u3001volatile-lfu \u8fd9\u56db\u79cd\u7b56\u7565\u7684\u5177\u4f53\u7b5b\u9009\u89c4\u5219\u8fdb\u884c\u6dd8\u6c70\u3002 volatile-ttl \u5728\u7b5b\u9009\u65f6\uff0c\u4f1a\u9488\u5bf9\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u503c\u5bf9\uff0c\u6839\u636e\u8fc7\u671f\u65f6\u95f4\u7684\u5148\u540e\u8fdb\u884c\u5220\u9664\uff0c\u8d8a \u65e9\u8fc7\u671f\u7684\u8d8a\u5148\u88ab\u5220\u9664\u3002 volatile-random \u5c31\u50cf\u5b83\u7684\u540d\u79f0\u4e00\u6837\uff0c\u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u503c\u5bf9\u4e2d\uff0c \u8fdb\u884c\u968f\u673a\u5220\u9664 volatile-lru \u4f1a\u4f7f\u7528 LRU \u7b97\u6cd5\u7b5b\u9009\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u503c\u5bf9 \u3002 volatile-lfu \u4f1a\u4f7f\u7528 LFU \u7b97\u6cd5\u9009\u62e9\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u503c\u5bf9\u3002 volatile-ttl \u548c volatile-random \u7b5b\u9009\u89c4\u5219\u6bd4\u8f83\u7b80\u5355\uff0c\u800c volatile-lru \u56e0\u4e3a\u6d89\u53ca\u4e86 LRU \u7b97\u6cd5\uff0c\u6240\u4ee5\u6211\u4f1a\u5728\u5206\u6790 allkeys-lru \u7b56\u7565\u65f6\u518d\u8be6\u7ec6\u89e3\u91ca\u3002 volatile-lfu \u4f7f\u7528\u4e86 LFU \u7b97\u6cd5\uff0c \u76f8\u5bf9\u4e8e volatile-ttl \u3001 volatile-random \u3001 volatile-lru \u3001 volatile-lfu \u8fd9\u56db\u79cd\u7b56\u7565\u6dd8\u6c70\u7684\u662f\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\uff0c 2-4 allkeys-lru \u3001 allkeys-random \u3001 allkeys-lfu allkeys-lru \u3001 allkeys-random \u3001 allkeys-lfu \u8fd9\u4e09\u79cd\u6dd8\u6c70\u7b56\u7565\u7684\u5907\u9009\u6dd8\u6c70\u6570\u636e\u8303\u56f4 \uff0c\u5c31\u6269\u5927\u5230\u4e86\u6240\u6709\u952e\u503c\u5bf9\uff0c\u65e0\u8bba\u8fd9\u4e9b\u952e\u503c\u5bf9\u662f\u5426\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u3002\u5b83\u4eec\u7b5b\u9009\u6570\u636e\u8fdb\u884c\u6dd8\u6c70\u7684\u89c4\u5219\u662f\uff1a allkeys-random \u7b56\u7565\uff0c\u4ece\u6240\u6709\u952e\u503c\u5bf9\u4e2d\u968f\u673a\u9009\u62e9\u5e76\u5220\u9664\u6570\u636e\uff1b allkeys-lru \u7b56\u7565\uff0c\u4f7f\u7528 LRU \u7b97\u6cd5\u5728\u6240\u6709\u6570\u636e\u4e2d\u8fdb\u884c\u7b5b\u9009\u3002 allkeys-lfu \u7b56\u7565\uff0c\u4f7f\u7528 LFU \u7b97\u6cd5\u5728\u6240\u6709\u6570\u636e\u4e2d\u8fdb\u884c\u7b5b\u9009\u3002 \u8fd9\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u4e00\u4e2a\u952e\u503c\u5bf9\u88ab\u5220\u9664\u7b56\u7565\u9009\u4e2d\u4e86\uff0c\u5373\u4f7f\u5b83\u7684\u8fc7\u671f\u65f6\u95f4\u8fd8\u6ca1\u5230\uff0c\u4e5f\u9700\u8981\u88ab\u5220\u9664\u3002\u5f53\u7136\uff0c\u5982\u679c\u5b83\u7684\u8fc7\u671f\u65f6\u95f4\u5230\u4e86\u4f46\u672a\u88ab\u7b56\u7565\u9009\u4e2d\uff0c\u540c\u6837\u4e5f\u4f1a\u88ab\u5220\u9664\u3002 2-5 LRU \u7b97\u6cd5 LRU \u7b97\u6cd5\u7684\u5168\u79f0\u662f Least Recently Used \uff0c\u4ece\u540d\u5b57\u4e0a\u5c31\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u662f\u6309\u7167\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u539f\u5219\u6765\u7b5b\u9009\u6570\u636e\uff0c \u6700\u4e0d\u5e38\u7528\u7684\u6570\u636e\u4f1a\u88ab\u7b5b\u9009\u51fa\u6765\uff0c\u800c\u6700\u8fd1\u9891\u7e41\u4f7f\u7528\u7684\u6570\u636e\u4f1a\u7559\u5728\u7f13\u5b58\u4e2d LRU \u4f1a\u628a\u6240\u6709\u7684\u6570\u636e\u7ec4\u7ec7\u6210\u4e00\u4e2a\u94fe\u8868\uff0c\u94fe\u8868\u7684\u5934\u548c\u5c3e\u5206\u522b\u8868\u793a MRU \u7aef\u548c LRU \u7aef \uff0c\u5206\u522b\u4ee3\u8868\u6700\u8fd1\u6700\u5e38\u4f7f\u7528\u7684\u6570\u636e\u548c\u6700\u8fd1\u6700\u4e0d\u5e38\u7528\u7684\u6570\u636e\u3002\u6211\u4eec\u770b\u4e00\u4e2a\u4f8b\u5b50\u3002 \u6211\u4eec\u73b0\u5728\u6709\u6570\u636e 6\u30013\u30019\u300120\u30015\u3002 \u5982\u679c\u6570\u636e 20 \u548c 3 \u88ab\u5148\u540e\u8bbf\u95ee\uff0c\u5b83\u4eec\u90fd\u4f1a\u4ece\u73b0\u6709\u7684\u94fe\u8868\u4f4d\u7f6e\u79fb\u5230 MRU \u7aef\uff0c\u800c\u94fe\u8868\u4e2d\u5728\u5b83\u4eec\u4e4b\u524d\u7684\u6570\u636e\u5219\u76f8\u5e94\u5730\u5f80\u540e\u79fb\u4e00\u4f4d\u3002 \u56e0\u4e3a\uff0cLRU \u7b97\u6cd5\u9009\u62e9\u5220\u9664\u6570\u636e\u65f6\uff0c\u90fd\u662f\u4ece LRU \u7aef\u5f00\u59cb\uff0c\u6240\u4ee5\u628a\u521a\u521a\u88ab\u8bbf\u95ee\u7684\u6570\u636e\u79fb\u5230 MRU \u7aef\uff0c\u5c31\u53ef\u4ee5\u8ba9\u5b83\u4eec\u5c3d\u53ef\u80fd\u5730\u7559\u5728\u7f13\u5b58\u4e2d\u3002 \u5982\u679c\u6709\u4e00\u4e2a\u65b0\u6570\u636e 15 \u8981\u88ab\u5199\u5165\u7f13\u5b58\uff0c\u4f46\u6b64\u65f6\u5df2\u7ecf\u6ca1\u6709\u7f13\u5b58\u7a7a\u95f4\u4e86\uff0c\u4e5f\u5c31\u662f\u94fe\u8868\u6ca1\u6709\u7a7a\u4f59\u4f4d\u7f6e\u4e86\uff0c\u90a3\u4e48\uff0cLRU \u7b97\u6cd5\u505a\u4e24\u4ef6\u4e8b\uff1a \u6570\u636e 15 \u662f\u521a\u88ab\u8bbf\u95ee\u7684\uff0c\u6240\u4ee5\u5b83\u4f1a\u88ab\u653e\u5230 MRU \u7aef\uff1b \u7b97\u6cd5\u628a LRU \u7aef\u7684\u6570\u636e 5 \u4ece\u7f13\u5b58\u4e2d\u5220\u9664\uff0c\u76f8\u5e94\u7684\u94fe\u8868\u4e2d\u5c31\u6ca1\u6709\u6570\u636e 5 \u7684\u8bb0\u5f55\u4e86\u3002 \u5176\u5b9e\uff0cLRU \u7b97\u6cd5\u80cc\u540e\u7684\u60f3\u6cd5\u975e\u5e38\u6734\u7d20\uff1a \u5b83\u8ba4\u4e3a\u521a\u521a\u88ab\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u80af\u5b9a\u8fd8\u4f1a\u88ab\u518d\u6b21\u8bbf\u95ee\uff0c\u6240\u4ee5\u5c31\u628a\u5b83\u653e\u5728 MRU \u7aef\uff1b \u957f\u4e45\u4e0d\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u80af\u5b9a\u5c31\u4e0d\u4f1a\u518d\u88ab\u8bbf\u95ee\u4e86\uff0c\u6240\u4ee5\u5c31\u8ba9\u5b83\u9010\u6e10\u540e\u79fb\u5230 LRU \u7aef\uff0c\u5728\u7f13\u5b58\u6ee1\u65f6\uff0c\u5c31\u4f18\u5148\u5220\u9664\u5b83\u3002 LRU \u7b97\u6cd5\u5728\u5b9e\u9645\u5b9e\u73b0\u65f6\uff0c\u9700\u8981\u7528\u94fe\u8868\u7ba1\u7406\u6240\u6709\u7684\u7f13\u5b58\u6570\u636e\uff0c\u8fd9\u4f1a\u5e26\u6765\u989d\u5916\u7684\u7a7a\u95f4\u5f00\u9500 \u5f53\u6709\u6570\u636e\u88ab\u8bbf\u95ee\u65f6\uff0c\u9700\u8981\u5728\u94fe\u8868\u4e0a\u628a\u8be5\u6570\u636e\u79fb\u52a8\u5230 MRU \u7aef\uff0c\u5982\u679c\u6709\u5927\u91cf\u6570\u636e\u88ab\u8bbf\u95ee\uff0c\u5c31\u4f1a\u5e26\u6765\u5f88\u591a\u94fe\u8868\u79fb\u52a8\u64cd\u4f5c\uff0c\u4f1a\u5f88\u8017\u65f6\uff0c\u8fdb\u800c\u4f1a\u964d\u4f4e Redis \u7f13\u5b58\u6027\u80fd\u3002 \u5f53\u6709\u6570\u636e\u88ab\u8bbf\u95ee\u65f6\uff0c\u9700\u8981\u5728\u94fe\u8868\u4e0a\u628a\u8be5\u6570\u636e\u79fb\u52a8\u5230 MRU \u7aef\uff0c\u5982\u679c\u6709\u5927\u91cf\u6570\u636e\u88ab\u8bbf\u95ee\uff0c\u5c31\u4f1a\u5e26\u6765\u5f88\u591a\u94fe\u8868\u79fb\u52a8\u64cd\u4f5c\uff0c\u4f1a\u5f88\u8017\u65f6\uff0c\u8fdb\u800c\u4f1a\u964d\u4f4e Redis \u7f13\u5b58\u6027\u80fd \u3002 \u6240\u4ee5\uff0c\u5728 Redis \u4e2d\uff0cLRU \u7b97\u6cd5\u88ab\u505a\u4e86\u7b80\u5316\uff0c\u4ee5\u51cf\u8f7b\u6570\u636e\u6dd8\u6c70\u5bf9\u7f13\u5b58\u6027\u80fd\u7684\u5f71\u54cd\u3002 \u5177\u4f53\u6765\u8bf4\uff0cRedis \u9ed8\u8ba4\u4f1a\u8bb0\u5f55\u6bcf\u4e2a\u6570\u636e\u7684\u6700\u8fd1\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u95f4\u6233\uff08\u7531\u952e\u503c\u5bf9\u6570\u636e\u7ed3\u6784 RedisObject \u4e2d\u7684 lru \u5b57\u6bb5\u8bb0\u5f55\uff09\u3002 \u7136\u540e\uff0cRedis \u5728\u51b3\u5b9a\u6dd8\u6c70\u7684\u6570\u636e\u65f6\uff0c\u7b2c\u4e00\u6b21\u4f1a\u968f\u673a\u9009\u51fa N \u4e2a\u6570\u636e\uff0c\u628a\u5b83\u4eec\u4f5c\u4e3a\u4e00\u4e2a\u5019\u9009\u96c6\u5408\u3002 \u63a5\u4e0b\u6765\uff0c Redis \u4f1a\u6bd4\u8f83\u8fd9 N \u4e2a\u6570\u636e\u7684 lru \u5b57\u6bb5\uff0c\u628a lru \u5b57\u6bb5\u503c\u6700\u5c0f\u7684\u6570\u636e\u4ece\u7f13\u5b58\u4e2d\u6dd8\u6c70\u51fa\u53bb \u3002 Redis \u63d0\u4f9b\u4e86\u4e00\u4e2a\u914d\u7f6e\u53c2\u6570 maxmemory-samples \uff0c\u8fd9\u4e2a\u53c2\u6570\u5c31\u662f Redis \u9009\u51fa\u7684\u6570\u636e\u4e2a\u6570 N \u3002\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u53ef\u4ee5\u8ba9 Redis \u9009\u51fa 100 \u4e2a\u6570\u636e\u4f5c\u4e3a\u5019\u9009\u6570\u636e\u96c6\uff1a CONFIG SET maxmemory-samples 100 \u5f53\u9700\u8981\u518d\u6b21\u6dd8\u6c70\u6570\u636e\u65f6\uff0cRedis \u9700\u8981\u6311\u9009\u6570\u636e\u8fdb\u5165\u7b2c\u4e00\u6b21\u6dd8\u6c70\u65f6\u521b\u5efa\u7684\u5019\u9009\u96c6\u5408\u3002 \u8fd9\u513f\u7684\u6311\u9009\u6807\u51c6\u662f\uff1a \u80fd\u8fdb\u5165\u5019\u9009\u96c6\u5408\u7684\u6570\u636e\u7684 lru \u5b57\u6bb5\u503c\u5fc5\u987b\u5c0f\u4e8e\u5019\u9009\u96c6\u5408\u4e2d\u6700\u5c0f\u7684 lru \u503c \u3002 \u5f53\u6709\u65b0\u6570\u636e\u8fdb\u5165\u5019\u9009\u6570\u636e\u96c6\u540e\uff0c\u5982\u679c\u5019\u9009\u6570\u636e\u96c6\u4e2d\u7684\u6570\u636e\u4e2a\u6570\u8fbe\u5230\u4e86 maxmemory-samples \uff0cRedis \u5c31\u628a\u5019\u9009\u6570\u636e\u96c6\u4e2d lru \u5b57\u6bb5\u503c\u6700\u5c0f\u7684\u6570\u636e\u6dd8\u6c70\u51fa\u53bb\u3002 \u8fd9\u6837\u4e00\u6765\uff0cRedis \u7f13\u5b58\u4e0d\u7528\u4e3a\u6240\u6709\u7684\u6570\u636e\u7ef4\u62a4\u4e00\u4e2a\u5927\u94fe\u8868\uff0c\u4e5f\u4e0d\u7528\u5728\u6bcf\u6b21\u6570\u636e\u8bbf\u95ee\u65f6\u90fd\u79fb\u52a8\u94fe\u8868\u9879\uff0c\u63d0\u5347\u4e86\u7f13\u5b58\u7684\u6027\u80fd\u3002 2-6 \u6dd8\u6c70\u7b56\u7565\u4e09\u4e2a\u5efa\u8bae \u4f18\u5148\u4f7f\u7528 allkeys-lru \u7b56\u7565 \u3002\u8fd9\u6837\uff0c\u53ef\u4ee5\u5145\u5206\u5229\u7528 LRU \u8fd9\u4e00\u7ecf\u5178\u7f13\u5b58\u7b97\u6cd5\u7684\u4f18\u52bf\uff0c \u628a\u6700\u8fd1\u6700\u5e38\u8bbf\u95ee\u7684\u6570\u636e\u7559\u5728\u7f13\u5b58\u4e2d\uff0c\u63d0\u5347\u5e94\u7528\u7684\u8bbf\u95ee\u6027\u80fd \u3002\u5982\u679c\u4f60\u7684\u4e1a\u52a1\u6570\u636e\u4e2d\u6709\u660e\u663e\u7684\u51b7\u70ed\u6570\u636e\u533a\u5206\uff0c\u6211\u5efa\u8bae\u4f60\u4f7f\u7528 allkeys-lru \u7b56\u7565\u3002 \u5982\u679c\u4e1a\u52a1\u5e94\u7528\u4e2d\u7684\u6570\u636e\u8bbf\u95ee\u9891\u7387\u76f8\u5dee\u4e0d\u5927\uff0c\u6ca1\u6709\u660e\u663e\u7684\u51b7\u70ed\u6570\u636e\u533a\u5206\uff0c \u5efa\u8bae\u4f7f\u7528 allkeys-random \u7b56\u7565\uff0c\u968f\u673a\u9009\u62e9\u6dd8\u6c70\u7684\u6570\u636e\u5c31\u884c \u3002 \u5982\u679c\u4f60\u7684\u4e1a\u52a1\u4e2d\u6709\u7f6e\u9876\u7684\u9700\u6c42\uff0c\u6bd4\u5982\u7f6e\u9876\u65b0\u95fb\u3001\u7f6e\u9876\u89c6\u9891\uff0c\u90a3\u4e48\uff0c\u53ef\u4ee5\u4f7f\u7528 volatile-lru \u7b56\u7565\uff0c\u540c\u65f6\u4e0d\u7ed9\u8fd9\u4e9b\u7f6e\u9876\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4 \u3002\u8fd9\u6837\u4e00\u6765\uff0c\u8fd9\u4e9b\u9700\u8981\u7f6e\u9876\u7684\u6570\u636e\u4e00\u76f4\u4e0d\u4f1a\u88ab\u5220\u9664\uff0c\u800c\u5176\u4ed6\u6570\u636e\u4f1a\u5728\u8fc7\u671f\u65f6\u6839\u636e LRU \u89c4\u5219\u8fdb\u884c\u7b5b\u9009\u3002 3\u3001\u5982\u4f55\u5904\u7406\u88ab\u6dd8\u6c70\u7684\u6570\u636e\uff1f \u4e00\u822c\u6765\u8bf4\uff0c\u4e00\u65e6\u88ab\u6dd8\u6c70\u7684\u6570\u636e\u9009\u5b9a\u540e\uff0c\u5982\u679c\u8fd9\u4e2a\u6570\u636e\u662f\u5e72\u51c0\u6570\u636e\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u76f4\u63a5\u5220\u9664\uff1b\u5982\u679c\u8fd9\u4e2a\u6570\u636e\u662f\u810f\u6570\u636e\uff0c\u6211\u4eec\u9700\u8981\u628a\u5b83\u5199\u56de\u6570\u636e\u5e93\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u90a3\u600e\u4e48\u5224\u65ad\u4e00\u4e2a\u6570\u636e\u5230\u5e95\u662f\u5e72\u51c0\u7684\u8fd8\u662f\u810f\u7684\u5462\uff1f \u5e72\u51c0\u6570\u636e\u548c\u810f\u6570\u636e\u7684\u533a\u522b\u5c31\u5728\u4e8e\uff0c\u548c\u6700\u521d\u4ece\u540e\u7aef\u6570\u636e\u5e93\u91cc\u8bfb\u53d6\u65f6\u7684\u503c\u76f8\u6bd4\uff0c\u6709\u6ca1\u6709\u88ab\u4fee\u6539\u8fc7 \u3002 \u5e72\u51c0\u6570\u636e\u4e00\u76f4\u6ca1\u6709\u88ab\u4fee\u6539\uff0c\u6240\u4ee5\u540e\u7aef\u6570\u636e\u5e93\u91cc\u7684\u6570\u636e\u4e5f\u662f\u6700\u65b0\u503c\u3002\u5728\u66ff\u6362\u65f6\uff0c\u5b83\u53ef\u4ee5\u88ab\u76f4\u63a5\u5220\u9664\u3002 \u800c\u810f\u6570\u636e\u5c31\u662f\u66fe\u7ecf\u88ab\u4fee\u6539\u8fc7\u7684\uff0c\u5df2\u7ecf\u548c\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u4fdd\u5b58\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u4e86\u3002\u6b64\u65f6\uff0c\u5982\u679c\u4e0d\u628a\u810f\u6570\u636e\u5199\u56de\u5230\u6570\u636e\u5e93\u4e2d\uff0c\u8fd9\u4e2a\u6570\u636e\u7684\u6700\u65b0\u503c\u5c31\u4e22\u5931\u4e86\uff0c\u5c31\u4f1a\u5f71\u54cd\u5e94\u7528\u7684\u6b63\u5e38\u4f7f\u7528\u3002 \u8fd9\u4e48\u4e00\u6765\uff0c\u7f13\u5b58\u66ff\u6362\u65e2\u817e\u51fa\u4e86\u7f13 \u6211\u4eec\u5728\u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u5982\u679c\u6570\u636e\u88ab\u4fee\u6539\u4e86\uff0c\u9700\u8981\u5728\u6570\u636e\u4fee\u6539\u65f6\u5c31\u5c06\u5b83\u5199\u56de\u6570\u636e\u5e93\u3002\u5426\u5219\uff0c\u8fd9\u4e2a\u810f\u6570\u636e\u88ab\u6dd8\u6c70\u65f6\uff0c\u4f1a\u88ab Redis \u5220\u9664\uff0c\u800c\u6570\u636e\u5e93\u91cc\u4e5f\u6ca1\u6709\u6700\u65b0\u7684\u6570\u636e\u4e86\u3002 4\u3001\u672c\u8282\u5c0f\u7ed3 \u7f13\u5b58\u66ff\u6362\u65f6\u7684\u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff0c\u4ee5\u53ca\u88ab\u6dd8\u6c70\u6570\u636e\u7684\u5904\u7406\u65b9\u6cd5\u3002 Redis 4.0 \u7248\u672c\u4ee5\u540e\u4e00\u5171\u63d0\u4f9b\u4e86 8 \u79cd\u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff0c\u4ece\u6dd8\u6c70\u6570\u636e\u7684\u5019\u9009\u96c6\u8303\u56f4\u6765\u770b\uff0c\u6211\u4eec\u6709\u4e24\u79cd\u5019\u9009\u8303\u56f4\uff1a \u4e00\u79cd\u662f\u6240\u6709\u6570\u636e\u90fd\u662f\u5019\u9009\u96c6\uff0c\u4e00\u79cd\u662f\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u662f\u5019\u9009\u96c6\u3002 \u53e6\u5916\uff0c\u65e0\u8bba\u662f\u9762\u5411\u54ea\u79cd\u5019\u9009\u6570\u636e\u96c6\u8fdb\u884c\u6dd8\u6c70\u6570\u636e\u9009\u62e9\uff0c\u6211\u4eec\u90fd\u6709\u4e09\u79cd\u7b56\u7565\uff0c \u5206\u522b\u662f\u968f\u673a\u9009\u62e9\uff0c\u6839\u636e LRU \u7b97\u6cd5\u9009\u62e9\uff0c\u4ee5\u53ca\u6839\u636e LFU \u7b97\u6cd5\u9009\u62e9 \u3002 \u5f53\u7136\uff0c\u5f53\u9762\u5411\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u9009\u62e9\u6dd8\u6c70\u6570\u636e\u65f6\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u6839\u636e\u6570\u636e\u79bb\u8fc7\u671f\u65f6\u95f4\u7684\u8fdc\u8fd1\u6765\u51b3\u5b9a\u3002 \u4e00\u822c\u6765\u8bf4\uff0c\u7f13\u5b58\u7cfb\u7edf\u5bf9\u4e8e\u9009\u5b9a\u7684\u88ab\u6dd8\u6c70\u6570\u636e\uff0c \u4f1a\u6839\u636e\u5176\u662f\u5e72\u51c0\u6570\u636e\u8fd8\u662f\u810f\u6570\u636e\uff0c\u9009\u62e9\u76f4\u63a5\u5220\u9664\u8fd8\u662f\u5199\u56de\u6570\u636e\u5e93 \u3002 \u4f46\u662f\uff0c\u5728 Redis \u4e2d\uff0c\u88ab\u6dd8\u6c70\u6570\u636e\u65e0\u8bba\u5e72\u51c0\u4e0e\u5426\u90fd\u4f1a\u88ab\u5220\u9664\uff0c\u6240\u4ee5\uff0c\u8fd9\u662f\u6211\u4eec\u5728\u4f7f\u7528 Redis \u7f13\u5b58\u65f6\u8981\u7279\u522b\u6ce8\u610f\u7684\uff1a\u5f53\u6570\u636e\u4fee\u6539\u6210\u4e3a\u810f\u6570\u636e\u65f6\uff0c\u9700\u8981\u5728\u6570\u636e\u5e93\u4e2d\u4e5f\u628a\u6570\u636e\u4fee\u6539\u8fc7\u6765\u3002 \u5148\u6839\u636e\u662f\u5426\u6709\u59cb\u7ec8\u4f1a\u88ab\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\uff08\u4f8b\u5982\u7f6e\u9876\u6d88\u606f\uff09\uff0c\u6765\u9009\u62e9\u6dd8\u6c70\u6570\u636e\u7684\u5019\u9009\u96c6\uff0c\u4e5f\u5c31\u662f\u51b3\u5b9a\u662f\u9488\u5bf9\u6240\u6709\u6570\u636e\u8fdb\u884c\u6dd8\u6c70\uff0c\u8fd8\u662f\u9488\u5bf9\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u8fdb\u884c\u6dd8\u6c70\u3002 \u5019\u9009\u6570\u636e\u96c6\u8303\u56f4\u9009\u5b9a\u540e\uff0c\u5efa\u8bae\u4f18\u5148\u4f7f\u7528 LRU \u7b97\u6cd5\uff0c\u4e5f\u5c31\u662f\uff0callkeys-lru \u6216 volatile-lru \u7b56\u7565\u3002 \u5408\u5b9e\u9645\u5e94\u7528\u7684\u6570\u636e\u603b\u91cf\u3001\u70ed\u6570\u636e\u7684\u4f53\u91cf\uff0c\u4ee5\u53ca\u6210\u672c\u9884\u7b97\uff0c\u628a\u7f13\u5b58\u7a7a\u95f4\u5927\u5c0f\u8bbe\u7f6e\u5728\u603b\u6570\u636e\u91cf\u7684 15% \u5230 30% \u8fd9\u4e2a\u533a\u95f4\u5c31\u53ef\u4ee5\u3002","title":"\u7b2c\u4e8c\u8282 \u7f13\u5b58\u6ee1\u540e\u7684\u66ff\u6362\u7b56\u7565"},{"location":"chap5/2redis_cache_full/#_1","text":"Redis \u7f13\u5b58\u4f7f\u7528\u5185\u5b58\u6765\u4fdd\u5b58\u6570\u636e\uff0c\u907f\u514d\u4e1a\u52a1\u5e94\u7528\u4ece\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u53ef\u4ee5\u63d0\u5347\u5e94\u7528\u7684\u54cd\u5e94\u901f\u5ea6\u3002\u90a3\u4e48\uff0c\u5982\u679c\u6211\u4eec\u628a\u6240\u6709\u8981\u8bbf\u95ee\u7684\u6570\u636e\u90fd\u653e\u5165\u7f13\u5b58\uff0c\u8fd9\u6837\u505a\u7684\u6027\u4ef7\u6bd4\u53cd\u800c\u4e0d\u9ad8\u3002 \u4e3e\u4e2a\u4f8b\u5b50\u5427\u3002MySQL \u4e2d\u6709 1TB \u7684\u6570\u636e\uff0c\u5982\u679c\u6211\u4eec\u4f7f\u7528 Redis \u628a\u8fd9 1TB \u7684\u6570\u636e\u90fd\u7f13\u5b58\u8d77\u6765\uff0c\u867d\u7136\u5e94\u7528\u90fd\u80fd\u5728\u5185\u5b58\u4e2d\u8bbf\u95ee\u6570\u636e\u4e86\uff0c\u4f46\u662f\uff0c\u8fd9\u6837\u914d\u7f6e\u5e76\u4e0d\u5408\u7406\uff0c\u56e0\u4e3a\u6027\u4ef7\u6bd4\u5f88\u4f4e\u3002\u4e00\u65b9\u9762\uff0c1TB \u5185\u5b58\u7684\u4ef7\u683c\u5927\u7ea6\u662f 3.5 \u4e07\u5143\uff0c\u800c 1TB \u78c1\u76d8\u7684\u4ef7\u683c\u5927\u7ea6\u662f 1000 \u5143\u3002 \u53e6\u4e00\u65b9\u9762\uff0c\u6570\u636e\u8bbf\u95ee\u90fd\u662f\u6709\u5c40\u90e8\u6027\u7684\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u901a\u5e38\u6240\u8bf4\u7684\u201c\u516b\u4e8c\u539f\u7406\u201d\uff0c80% \u7684\u8bf7\u6c42\u5b9e\u9645\u53ea\u8bbf\u95ee\u4e86 20% \u7684\u6570\u636e\u3002\u6240\u4ee5\uff0c\u7528 1TB \u7684\u5185\u5b58\u505a\u7f13\u5b58\uff0c\u5e76\u6ca1\u6709\u5fc5\u8981\u3002 \u4e3a\u4e86\u4fdd\u8bc1\u8f83\u9ad8\u7684\u6027\u4ef7\u6bd4\uff0c\u7f13\u5b58\u7684\u7a7a\u95f4\u5bb9\u91cf\u5fc5\u7136\u8981\u5c0f\u4e8e\u540e\u7aef\u6570\u636e\u5e93\u7684\u6570\u636e\u603b\u91cf\u3002\u4e0d\u8fc7\uff0c\u5185\u5b58\u5927\u5c0f\u6bd5\u7adf\u6709\u9650\uff0c\u968f\u7740\u8981\u7f13\u5b58\u7684\u6570\u636e\u91cf\u8d8a\u6765\u8d8a\u5927\uff0c\u6709\u9650\u7684\u7f13\u5b58\u7a7a\u95f4\u4e0d\u53ef\u907f\u514d\u5730\u4f1a\u88ab\u5199\u6ee1\u3002 \u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5c31\u6d89\u53ca\u5230\u7f13\u5b58\u7cfb\u7edf\u7684\u4e00\u4e2a\u91cd\u8981\u673a\u5236\uff0c \u5373\u7f13\u5b58\u6570\u636e\u7684\u6dd8\u6c70\u673a\u5236 \u6570\u636e\u6dd8\u6c70\u673a\u5236\u5305\u62ec\u4e24\u6b65\uff1a \u7b2c\u4e00\uff0c\u6839\u636e\u4e00\u5b9a\u7684\u7b56\u7565\uff0c\u7b5b\u9009\u51fa\u5bf9\u5e94\u7528\u8bbf\u95ee\u6765\u8bf4\u201c\u4e0d\u91cd\u8981\u201d\u7684\u6570\u636e\uff1b \u7b2c\u4e8c\uff0c\u5c06\u8fd9\u4e9b\u6570\u636e\u4ece\u7f13\u5b58\u4e2d\u5220\u9664\uff0c\u4e3a\u65b0\u6765\u7684\u6570\u636e\u817e\u51fa\u7a7a\u95f4\uff0c\u2019","title":"\u7b2c\u4e8c\u8282 \u7f13\u5b58\u6ee1\u540e\u7684\u66ff\u6362\u7b56\u7565"},{"location":"chap5/2redis_cache_full/#1","text":"\u7f13\u5b58\u5bb9\u91cf\u8bbe\u7f6e\u5f97\u662f\u5426\u5408\u7406\uff0c\u4f1a\u76f4\u63a5\u5f71\u54cd\u5230\u4f7f\u7528\u7f13\u5b58\u7684\u6027\u4ef7\u6bd4","title":"1\u3001\u8bbe\u7f6e\u591a\u5927\u7684\u7f13\u5b58\u5bb9\u91cf\u5408\u9002\uff1f"},{"location":"chap5/2redis_cache_full/#1-1","text":"\u84dd\u7ebf\u4ee3\u8868\u4e86\u201c\u516b\u4e8c\u539f\u7406\u201d\u8868\u793a\u7684\u6570\u636e\u5c40\u90e8\u6027\uff0c\u800c\u7ea2\u7ebf\u5219\u8868\u793a\u5728\u5f53\u524d\u5e94\u7528\u8d1f\u8f7d\u4e0b\uff0c\u6570\u636e\u5c40\u90e8\u6027\u7684\u53d8\u5316\u3002 \u84dd\u7ebf\u3002\u5b83\u8868\u793a\u7684\u5c31\u662f\u201c\u516b\u4e8c\u539f\u7406\u201d\uff0c\u6709 20% \u7684\u6570\u636e\u8d21\u732e\u4e86 80% \u7684\u8bbf\u95ee\u4e86\uff0c\u800c\u5269\u4f59\u7684\u6570\u636e\u867d\u7136\u4f53\u91cf\u5f88\u5927\uff0c\u4f46\u53ea\u8d21\u732e\u4e86 20% \u7684\u8bbf\u95ee\u91cf\u3002 \u8fd9 80% \u7684\u6570\u636e\u5728\u8bbf\u95ee\u91cf\u4e0a\u5c31\u5f62\u6210\u4e86\u4e00\u6761\u957f\u957f\u7684\u5c3e\u5df4\uff0c\u6211\u4eec\u4e5f\u79f0\u4e3a\u201c\u957f\u5c3e\u6548\u5e94\u201d\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u6309\u7167\u201c\u516b\u4e8c\u539f\u7406\u201d\u6765\u8bbe\u7f6e\u7f13\u5b58\u7a7a\u95f4\u5bb9\u91cf\uff0c\u4e5f\u5c31\u662f\u628a\u7f13\u5b58\u7a7a\u95f4\u5bb9\u91cf\u8bbe\u7f6e\u4e3a\u603b\u6570\u636e\u91cf\u7684 20% \u7684\u8bdd\uff0c\u5c31\u6709\u53ef\u80fd\u62e6\u622a\u5230 80% \u7684\u8bbf\u95ee\u3002 \u4e3a\u4ec0\u4e48\u8bf4\u662f\u201c\u6709\u53ef\u80fd\u201d\u5462\uff1f \u8fd9\u662f\u56e0\u4e3a\uff0c\u201c\u516b\u4e8c\u539f\u7406\u201d\u662f\u5bf9\u5927\u91cf\u5b9e\u9645\u5e94\u7528\u7684\u6570\u636e\u8bbf\u95ee\u60c5\u51b5\u505a\u4e86\u7edf\u8ba1\u540e\uff0c\u5f97\u51fa\u7684\u4e00\u4e2a\u7edf\u8ba1\u5b66\u610f\u4e49\u4e0a\u7684\u6570\u636e\u91cf\u548c\u8bbf\u95ee\u91cf\u7684\u6bd4\u4f8b\u3002\u5177\u4f53\u5230\u67d0\u4e00\u4e2a\u5e94\u7528\u6765\u8bf4\uff0c\u6570\u636e\u8bbf\u95ee\u7684\u89c4\u5f8b\u4f1a\u548c\u5177\u4f53\u7684\u4e1a\u52a1\u573a\u666f\u6709\u5173\u3002\u5bf9\u4e8e\u6700\u5e38\u88ab\u8bbf\u95ee\u7684 20% \u7684\u6570\u636e\u6765\u8bf4\uff0c\u5b83\u4eec\u8d21\u732e\u7684\u8bbf\u95ee\u91cf\uff0c\u65e2\u6709\u53ef\u80fd\u8d85\u8fc7 80%\uff0c\u4e5f\u6709\u53ef\u80fd\u4e0d\u5230 80%\u3002 \u4e00\u4e2a\u7535\u5546\u5546\u54c1\u7684\u573a\u666f\u3002 \u4e00\u65b9\u9762\uff0c\u5728\u5546\u54c1\u4fc3\u9500\u65f6\uff0c \u70ed\u95e8\u5546\u54c1\u7684\u4fe1\u606f\u53ef\u80fd\u53ea\u5360\u5230\u603b\u5546\u54c1\u6570\u636e\u4fe1\u606f\u91cf\u7684 5%\uff0c\u800c\u8fd9\u4e9b\u5546\u54c1\u4fe1\u606f\u627f\u8f7d\u7684\u53ef\u80fd\u662f\u8d85\u8fc7 90% \u7684\u8bbf\u95ee\u8bf7\u6c42 \u3002\u8fd9\u65f6\uff0c\u6211\u4eec\u53ea\u8981\u7f13\u5b58\u8fd9 5% \u7684\u6570\u636e\uff0c\u5c31\u80fd\u83b7\u5f97\u5f88\u597d\u7684\u6027\u80fd\u6536\u76ca \u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c\u4e1a\u52a1\u5e94\u7528\u8981\u5bf9\u6240\u6709\u5546\u54c1\u4fe1\u606f\u8fdb\u884c\u67e5\u8be2\u7edf\u8ba1\uff0c\u8fd9\u65f6\u5019\uff0c \u5373\u4f7f\u6309\u7167\u201c\u516b\u4e8c\u539f\u7406\u201d\u7f13\u5b58\u4e86 20% \u7684\u5546\u54c1\u6570\u636e\uff0c\u4e5f\u4e0d\u80fd\u83b7\u5f97\u5f88\u597d\u7684\u8bbf\u95ee\u6027\u80fd\uff0c\u56e0\u4e3a 80% \u7684\u6570\u636e\u4ecd\u7136\u9700\u8981\u4ece\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u83b7\u53d6\u3002","title":"1-1 \u957f\u5c3e\u6548\u5e94"},{"location":"chap5/2redis_cache_full/#1-2","text":"\u5728\u8fd9\u6761\u7ea2\u7ebf\u4e0a\uff0c80% \u7684\u6570\u636e\u8d21\u732e\u7684\u8bbf\u95ee\u91cf\uff0c\u8d85\u8fc7\u4e86\u4f20\u7edf\u7684\u957f\u5c3e\u6548\u5e94\u4e2d 80% \u6570\u636e\u80fd\u8d21\u732e\u7684\u8bbf\u95ee\u91cf\u3002 \u539f\u56e0\u5728\u4e8e\uff0c\u7528\u6237\u7684\u4e2a\u6027\u5316\u9700\u6c42\u8d8a\u6765\u8d8a\u591a\uff0c\u5728\u4e00\u4e2a\u4e1a\u52a1\u5e94\u7528\u4e2d\uff0c\u4e0d\u540c\u7528\u6237\u8bbf\u95ee\u7684\u5185\u5bb9\u53ef\u80fd\u5dee\u522b\u5f88\u5927\uff0c\u6240\u4ee5\uff0c\u7528\u6237\u8bf7\u6c42\u7684\u6570\u636e\u548c\u5b83\u4eec\u8d21\u732e\u7684\u8bbf\u95ee\u91cf\u6bd4\u4f8b\uff0c\u4e0d\u518d\u5177\u5907\u957f\u5c3e\u6548\u5e94\u4e2d\u7684\u201c\u516b\u4e8c\u539f\u7406\u201d\u5206\u5e03\u7279\u5f81\u4e86\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c20% \u7684\u6570\u636e\u53ef\u80fd\u8d21\u732e\u4e0d\u4e86 80% \u7684\u8bbf\u95ee\uff0c\u800c\u5269\u4f59\u7684 80% \u6570\u636e\u53cd\u800c\u8d21\u732e\u4e86\u66f4\u591a\u7684\u8bbf\u95ee\u91cf\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u91cd\u5c3e\u6548\u5e94\u3002 \u6b63\u662f\u56e0\u4e3a 20% \u7684\u6570\u636e\u4e0d\u4e00\u5b9a\u80fd\u8d21\u732e 80% \u7684\u8bbf\u95ee\u91cf\uff0c\u6211\u4eec\u4e0d\u80fd\u7b80\u5355\u5730\u6309\u7167\u201c\u603b\u6570\u636e\u91cf\u7684 20%\u201d\u6765\u8bbe\u7f6e\u7f13\u5b58\u6700\u5927\u7a7a\u95f4\u5bb9\u91cf\u3002 \u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\uff0c\u6211\u770b\u5230\u8fc7\u7684\u7f13\u5b58\u5bb9\u91cf\u5360\u603b\u6570\u636e\u91cf\u7684\u6bd4\u4f8b\uff0c\u4ece 5% \u5230 40% \u7684\u90fd\u6709\u3002\u8fd9\u4e2a\u5bb9\u91cf\u89c4\u5212\u4e0d\u80fd\u4e00\u6982\u800c\u8bba\uff0c \u662f\u9700\u8981\u7ed3\u5408\u5e94\u7528\u6570\u636e\u5b9e\u9645\u8bbf\u95ee\u7279\u5f81\u548c\u6210\u672c\u5f00\u9500\u6765\u7efc\u5408\u8003\u8651\u7684 \u3002","title":"1-2 \u91cd\u5c3e\u6548\u5e94"},{"location":"chap5/2redis_cache_full/#1-3","text":"\u7cfb\u7edf\u7684\u8bbe\u8ba1\u9009\u62e9\u662f\u4e00\u4e2a\u6743\u8861\u7684\u8fc7\u7a0b\uff1a \u5927\u5bb9\u91cf\u7f13\u5b58\u662f\u80fd\u5e26\u6765\u6027\u80fd\u52a0\u901f\u7684\u6536\u76ca\uff0c\u4f46\u662f\u6210\u672c\u4e5f\u4f1a\u66f4\u9ad8\uff0c\u800c\u5c0f\u5bb9\u91cf\u7f13\u5b58\u4e0d\u4e00\u5b9a\u5c31\u8d77\u4e0d\u5230\u52a0\u901f\u8bbf\u95ee\u7684\u6548\u679c\u3002 \u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4f1a\u5efa\u8bae\u628a\u7f13\u5b58\u5bb9\u91cf\u8bbe\u7f6e\u4e3a\u603b\u6570\u636e\u91cf\u7684 15% \u5230 30%\uff0c\u517c\u987e\u8bbf\u95ee\u6027\u80fd\u548c\u5185\u5b58\u7a7a\u95f4\u5f00\u9500\u3002 \u5bf9\u4e8e Redis \u6765\u8bf4\uff0c\u4e00\u65e6\u786e\u5b9a\u4e86\u7f13\u5b58\u6700\u5927\u5bb9\u91cf\uff0c\u6bd4\u5982 4GB\uff0c\u4f60\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u4e2a\u547d\u4ee4\u6765\u8bbe\u5b9a\u7f13\u5b58\u7684\u5927\u5c0f\u4e86\uff1a CONFIG SET maxmemory 4gb \u4e0d\u8fc7\uff0c\u7f13\u5b58\u88ab\u5199\u6ee1\u662f\u4e0d\u53ef\u907f\u514d\u7684\u3002 \u5373\u4f7f\u4f60\u7cbe\u6311\u7ec6\u9009\uff0c\u786e\u5b9a\u4e86\u7f13\u5b58\u5bb9\u91cf\uff0c\u8fd8\u662f\u8981\u9762\u5bf9\u7f13\u5b58\u5199\u6ee1\u65f6\u7684\u66ff\u6362\u64cd\u4f5c\u3002\u7f13\u5b58\u66ff\u6362\u9700\u8981\u89e3\u51b3\u4e24\u4e2a\u95ee\u9898\uff1a \u51b3\u5b9a\u6dd8\u6c70\u54ea\u4e9b\u6570\u636e\uff0c\u5982\u4f55\u5904\u7406\u90a3\u4e9b\u88ab\u6dd8\u6c70\u7684\u6570\u636e\u3002","title":"1-3 \u7cfb\u7edf\u7684\u8bbe\u8ba1"},{"location":"chap5/2redis_cache_full/#2redis","text":"","title":"2\u3001Redis \u7f13\u5b58\u6709\u54ea\u4e9b\u6dd8\u6c70\u7b56\u7565\uff1f"},{"location":"chap5/2redis_cache_full/#2-1","text":"Redis 4.0 \u4e4b\u524d\u4e00\u5171\u5b9e\u73b0\u4e86 6 \u79cd\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff0c\u5728 4.0 \u4e4b\u540e\uff0c\u53c8\u589e\u52a0\u4e86 2 \u79cd\u7b56\u7565\u3002 \u6211\u4eec\u53ef\u4ee5\u6309\u7167\u662f\u5426\u4f1a\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u628a\u5b83\u4eec\u5206\u6210\u4e24\u7c7b\uff1a \u4e0d\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u7684\u7b56\u7565\uff0c\u53ea\u6709 noeviction \u8fd9\u4e00\u79cd\u3002 \u4f1a\u8fdb\u884c\u6dd8\u6c70\u7684 7 \u79cd\u5176\u4ed6\u7b56\u7565\u3002 \u4f1a\u8fdb\u884c\u6dd8\u6c70\u7684 7 \u79cd\u7b56\u7565\uff0c\u6211\u4eec\u53ef\u4ee5\u518d\u8fdb\u4e00\u6b65\u6839\u636e\u6dd8\u6c70\u5019\u9009\u6570\u636e\u96c6\u7684\u8303\u56f4\u628a\u5b83\u4eec\u5206\u6210\u4e24\u7c7b\uff1a \u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u4e2d\u8fdb\u884c\u6dd8\u6c70 \uff0c\u5305\u62ec volatile-random \u3001 volatile-ttl \u3001 volatile-lru \u3001 volatile-lfu \uff08Redis 4.0 \u540e\u65b0\u589e\uff09\u56db\u79cd\u3002 \u5728\u6240\u6709\u6570\u636e\u8303\u56f4\u5185\u8fdb\u884c\u6dd8\u6c70 \uff0c\u5305\u62ec allkeys-lru \u3001 allkeys-random \u3001 allkeys-lfu \uff08Redis 4.0 \u540e\u65b0\u589e\uff09\u4e09\u79cd\u3002 \u4e0b\u9762\u6211\u5c31\u6765\u5177\u4f53\u89e3\u91ca\u4e0b\u5404\u4e2a\u7b56\u7565\u3002","title":"2-1 \u6570\u636e\u6dd8\u6c70\u7684\u7b56\u7565"},{"location":"chap5/2redis_cache_full/#2-2-noeviction","text":"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c Redis \u5728\u4f7f\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u8d85\u8fc7 maxmemory \u503c\u65f6\uff0c \u5e76\u4e0d\u4f1a\u6dd8\u6c70\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u8bbe\u5b9a\u7684 noeviction \u7b56\u7565 \u5bf9\u5e94\u5230 Redis \u7f13\u5b58\uff0c\u4e5f\u5c31\u662f\u6307\uff0c\u4e00\u65e6\u7f13\u5b58\u88ab\u5199\u6ee1\u4e86\uff0c\u518d\u6709\u5199\u8bf7\u6c42\u6765\u65f6\uff0cRedis \u4e0d\u518d\u63d0\u4f9b\u670d\u52a1\uff0c\u800c\u662f\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\u3002 Redis \u7528\u4f5c\u7f13\u5b58\u65f6\uff0c \u5b9e\u9645\u7684\u6570\u636e\u96c6\u901a\u5e38\u90fd\u662f\u5927\u4e8e\u7f13\u5b58\u5bb9\u91cf\u7684\uff0c\u603b\u4f1a\u6709\u65b0\u7684\u6570\u636e\u8981\u5199\u5165\u7f13\u5b58\uff0c\u8fd9\u4e2a\u7b56\u7565\u672c\u8eab\u4e0d\u6dd8\u6c70\u6570\u636e\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u817e\u51fa\u65b0\u7684\u7f13\u5b58\u7a7a\u95f4\uff0c\u6211\u4eec\u4e0d\u628a\u5b83\u7528\u5728 Redis \u7f13\u5b58\u4e2d\u3002","title":"2-2 noeviction \u7b56\u7565"},{"location":"chap5/2redis_cache_full/#2-3-volatile-randomvolatile-ttlvolatile-lru-volatile-lfu","text":"\u5b83\u4eec\u7b5b\u9009\u7684\u5019\u9009\u6570\u636e\u8303\u56f4\uff0c\u88ab\u9650\u5236\u5728\u5df2\u7ecf\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u503c\u5bf9\u4e0a\u3002\u4e5f\u6b63\u56e0\u4e3a\u6b64\uff0c\u5373\u4f7f\u7f13\u5b58\u6ca1\u6709\u5199\u6ee1\uff0c \u8fd9\u4e9b\u6570\u636e\u5982\u679c\u8fc7\u671f\u4e86\uff0c\u4e5f\u4f1a\u88ab\u5220\u9664 \u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u4f7f\u7528 EXPIRE \u547d\u4ee4\u5bf9\u4e00\u6279\u952e\u503c\u5bf9\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u540e\uff0c \u65e0\u8bba\u662f\u8fd9\u4e9b\u952e\u503c\u5bf9\u7684\u8fc7\u671f\u65f6\u95f4\u662f\u5feb\u5230\u4e86\uff0c\u8fd8\u662f Redis \u7684\u5185\u5b58\u4f7f\u7528\u91cf\u8fbe\u5230\u4e86 maxmemory \u9608\u503c \uff0c Redis \u90fd\u4f1a\u8fdb\u4e00\u6b65\u6309\u7167 volatile-ttl\u3001volatile-random\u3001volatile-lru\u3001volatile-lfu \u8fd9\u56db\u79cd\u7b56\u7565\u7684\u5177\u4f53\u7b5b\u9009\u89c4\u5219\u8fdb\u884c\u6dd8\u6c70\u3002 volatile-ttl \u5728\u7b5b\u9009\u65f6\uff0c\u4f1a\u9488\u5bf9\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u503c\u5bf9\uff0c\u6839\u636e\u8fc7\u671f\u65f6\u95f4\u7684\u5148\u540e\u8fdb\u884c\u5220\u9664\uff0c\u8d8a \u65e9\u8fc7\u671f\u7684\u8d8a\u5148\u88ab\u5220\u9664\u3002 volatile-random \u5c31\u50cf\u5b83\u7684\u540d\u79f0\u4e00\u6837\uff0c\u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u503c\u5bf9\u4e2d\uff0c \u8fdb\u884c\u968f\u673a\u5220\u9664 volatile-lru \u4f1a\u4f7f\u7528 LRU \u7b97\u6cd5\u7b5b\u9009\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u503c\u5bf9 \u3002 volatile-lfu \u4f1a\u4f7f\u7528 LFU \u7b97\u6cd5\u9009\u62e9\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u503c\u5bf9\u3002 volatile-ttl \u548c volatile-random \u7b5b\u9009\u89c4\u5219\u6bd4\u8f83\u7b80\u5355\uff0c\u800c volatile-lru \u56e0\u4e3a\u6d89\u53ca\u4e86 LRU \u7b97\u6cd5\uff0c\u6240\u4ee5\u6211\u4f1a\u5728\u5206\u6790 allkeys-lru \u7b56\u7565\u65f6\u518d\u8be6\u7ec6\u89e3\u91ca\u3002 volatile-lfu \u4f7f\u7528\u4e86 LFU \u7b97\u6cd5\uff0c \u76f8\u5bf9\u4e8e volatile-ttl \u3001 volatile-random \u3001 volatile-lru \u3001 volatile-lfu \u8fd9\u56db\u79cd\u7b56\u7565\u6dd8\u6c70\u7684\u662f\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\uff0c","title":"2-3 volatile-random\u3001volatile-ttl\u3001volatile-lru \u548c volatile-lfu"},{"location":"chap5/2redis_cache_full/#2-4-allkeys-lruallkeys-randomallkeys-lfu","text":"allkeys-lru \u3001 allkeys-random \u3001 allkeys-lfu \u8fd9\u4e09\u79cd\u6dd8\u6c70\u7b56\u7565\u7684\u5907\u9009\u6dd8\u6c70\u6570\u636e\u8303\u56f4 \uff0c\u5c31\u6269\u5927\u5230\u4e86\u6240\u6709\u952e\u503c\u5bf9\uff0c\u65e0\u8bba\u8fd9\u4e9b\u952e\u503c\u5bf9\u662f\u5426\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u3002\u5b83\u4eec\u7b5b\u9009\u6570\u636e\u8fdb\u884c\u6dd8\u6c70\u7684\u89c4\u5219\u662f\uff1a allkeys-random \u7b56\u7565\uff0c\u4ece\u6240\u6709\u952e\u503c\u5bf9\u4e2d\u968f\u673a\u9009\u62e9\u5e76\u5220\u9664\u6570\u636e\uff1b allkeys-lru \u7b56\u7565\uff0c\u4f7f\u7528 LRU \u7b97\u6cd5\u5728\u6240\u6709\u6570\u636e\u4e2d\u8fdb\u884c\u7b5b\u9009\u3002 allkeys-lfu \u7b56\u7565\uff0c\u4f7f\u7528 LFU \u7b97\u6cd5\u5728\u6240\u6709\u6570\u636e\u4e2d\u8fdb\u884c\u7b5b\u9009\u3002 \u8fd9\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u4e00\u4e2a\u952e\u503c\u5bf9\u88ab\u5220\u9664\u7b56\u7565\u9009\u4e2d\u4e86\uff0c\u5373\u4f7f\u5b83\u7684\u8fc7\u671f\u65f6\u95f4\u8fd8\u6ca1\u5230\uff0c\u4e5f\u9700\u8981\u88ab\u5220\u9664\u3002\u5f53\u7136\uff0c\u5982\u679c\u5b83\u7684\u8fc7\u671f\u65f6\u95f4\u5230\u4e86\u4f46\u672a\u88ab\u7b56\u7565\u9009\u4e2d\uff0c\u540c\u6837\u4e5f\u4f1a\u88ab\u5220\u9664\u3002","title":"2-4 allkeys-lru\u3001allkeys-random\u3001allkeys-lfu"},{"location":"chap5/2redis_cache_full/#2-5-lru","text":"LRU \u7b97\u6cd5\u7684\u5168\u79f0\u662f Least Recently Used \uff0c\u4ece\u540d\u5b57\u4e0a\u5c31\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u662f\u6309\u7167\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u539f\u5219\u6765\u7b5b\u9009\u6570\u636e\uff0c \u6700\u4e0d\u5e38\u7528\u7684\u6570\u636e\u4f1a\u88ab\u7b5b\u9009\u51fa\u6765\uff0c\u800c\u6700\u8fd1\u9891\u7e41\u4f7f\u7528\u7684\u6570\u636e\u4f1a\u7559\u5728\u7f13\u5b58\u4e2d LRU \u4f1a\u628a\u6240\u6709\u7684\u6570\u636e\u7ec4\u7ec7\u6210\u4e00\u4e2a\u94fe\u8868\uff0c\u94fe\u8868\u7684\u5934\u548c\u5c3e\u5206\u522b\u8868\u793a MRU \u7aef\u548c LRU \u7aef \uff0c\u5206\u522b\u4ee3\u8868\u6700\u8fd1\u6700\u5e38\u4f7f\u7528\u7684\u6570\u636e\u548c\u6700\u8fd1\u6700\u4e0d\u5e38\u7528\u7684\u6570\u636e\u3002\u6211\u4eec\u770b\u4e00\u4e2a\u4f8b\u5b50\u3002 \u6211\u4eec\u73b0\u5728\u6709\u6570\u636e 6\u30013\u30019\u300120\u30015\u3002 \u5982\u679c\u6570\u636e 20 \u548c 3 \u88ab\u5148\u540e\u8bbf\u95ee\uff0c\u5b83\u4eec\u90fd\u4f1a\u4ece\u73b0\u6709\u7684\u94fe\u8868\u4f4d\u7f6e\u79fb\u5230 MRU \u7aef\uff0c\u800c\u94fe\u8868\u4e2d\u5728\u5b83\u4eec\u4e4b\u524d\u7684\u6570\u636e\u5219\u76f8\u5e94\u5730\u5f80\u540e\u79fb\u4e00\u4f4d\u3002 \u56e0\u4e3a\uff0cLRU \u7b97\u6cd5\u9009\u62e9\u5220\u9664\u6570\u636e\u65f6\uff0c\u90fd\u662f\u4ece LRU \u7aef\u5f00\u59cb\uff0c\u6240\u4ee5\u628a\u521a\u521a\u88ab\u8bbf\u95ee\u7684\u6570\u636e\u79fb\u5230 MRU \u7aef\uff0c\u5c31\u53ef\u4ee5\u8ba9\u5b83\u4eec\u5c3d\u53ef\u80fd\u5730\u7559\u5728\u7f13\u5b58\u4e2d\u3002 \u5982\u679c\u6709\u4e00\u4e2a\u65b0\u6570\u636e 15 \u8981\u88ab\u5199\u5165\u7f13\u5b58\uff0c\u4f46\u6b64\u65f6\u5df2\u7ecf\u6ca1\u6709\u7f13\u5b58\u7a7a\u95f4\u4e86\uff0c\u4e5f\u5c31\u662f\u94fe\u8868\u6ca1\u6709\u7a7a\u4f59\u4f4d\u7f6e\u4e86\uff0c\u90a3\u4e48\uff0cLRU \u7b97\u6cd5\u505a\u4e24\u4ef6\u4e8b\uff1a \u6570\u636e 15 \u662f\u521a\u88ab\u8bbf\u95ee\u7684\uff0c\u6240\u4ee5\u5b83\u4f1a\u88ab\u653e\u5230 MRU \u7aef\uff1b \u7b97\u6cd5\u628a LRU \u7aef\u7684\u6570\u636e 5 \u4ece\u7f13\u5b58\u4e2d\u5220\u9664\uff0c\u76f8\u5e94\u7684\u94fe\u8868\u4e2d\u5c31\u6ca1\u6709\u6570\u636e 5 \u7684\u8bb0\u5f55\u4e86\u3002 \u5176\u5b9e\uff0cLRU \u7b97\u6cd5\u80cc\u540e\u7684\u60f3\u6cd5\u975e\u5e38\u6734\u7d20\uff1a \u5b83\u8ba4\u4e3a\u521a\u521a\u88ab\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u80af\u5b9a\u8fd8\u4f1a\u88ab\u518d\u6b21\u8bbf\u95ee\uff0c\u6240\u4ee5\u5c31\u628a\u5b83\u653e\u5728 MRU \u7aef\uff1b \u957f\u4e45\u4e0d\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u80af\u5b9a\u5c31\u4e0d\u4f1a\u518d\u88ab\u8bbf\u95ee\u4e86\uff0c\u6240\u4ee5\u5c31\u8ba9\u5b83\u9010\u6e10\u540e\u79fb\u5230 LRU \u7aef\uff0c\u5728\u7f13\u5b58\u6ee1\u65f6\uff0c\u5c31\u4f18\u5148\u5220\u9664\u5b83\u3002 LRU \u7b97\u6cd5\u5728\u5b9e\u9645\u5b9e\u73b0\u65f6\uff0c\u9700\u8981\u7528\u94fe\u8868\u7ba1\u7406\u6240\u6709\u7684\u7f13\u5b58\u6570\u636e\uff0c\u8fd9\u4f1a\u5e26\u6765\u989d\u5916\u7684\u7a7a\u95f4\u5f00\u9500 \u5f53\u6709\u6570\u636e\u88ab\u8bbf\u95ee\u65f6\uff0c\u9700\u8981\u5728\u94fe\u8868\u4e0a\u628a\u8be5\u6570\u636e\u79fb\u52a8\u5230 MRU \u7aef\uff0c\u5982\u679c\u6709\u5927\u91cf\u6570\u636e\u88ab\u8bbf\u95ee\uff0c\u5c31\u4f1a\u5e26\u6765\u5f88\u591a\u94fe\u8868\u79fb\u52a8\u64cd\u4f5c\uff0c\u4f1a\u5f88\u8017\u65f6\uff0c\u8fdb\u800c\u4f1a\u964d\u4f4e Redis \u7f13\u5b58\u6027\u80fd\u3002 \u5f53\u6709\u6570\u636e\u88ab\u8bbf\u95ee\u65f6\uff0c\u9700\u8981\u5728\u94fe\u8868\u4e0a\u628a\u8be5\u6570\u636e\u79fb\u52a8\u5230 MRU \u7aef\uff0c\u5982\u679c\u6709\u5927\u91cf\u6570\u636e\u88ab\u8bbf\u95ee\uff0c\u5c31\u4f1a\u5e26\u6765\u5f88\u591a\u94fe\u8868\u79fb\u52a8\u64cd\u4f5c\uff0c\u4f1a\u5f88\u8017\u65f6\uff0c\u8fdb\u800c\u4f1a\u964d\u4f4e Redis \u7f13\u5b58\u6027\u80fd \u3002 \u6240\u4ee5\uff0c\u5728 Redis \u4e2d\uff0cLRU \u7b97\u6cd5\u88ab\u505a\u4e86\u7b80\u5316\uff0c\u4ee5\u51cf\u8f7b\u6570\u636e\u6dd8\u6c70\u5bf9\u7f13\u5b58\u6027\u80fd\u7684\u5f71\u54cd\u3002 \u5177\u4f53\u6765\u8bf4\uff0cRedis \u9ed8\u8ba4\u4f1a\u8bb0\u5f55\u6bcf\u4e2a\u6570\u636e\u7684\u6700\u8fd1\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u95f4\u6233\uff08\u7531\u952e\u503c\u5bf9\u6570\u636e\u7ed3\u6784 RedisObject \u4e2d\u7684 lru \u5b57\u6bb5\u8bb0\u5f55\uff09\u3002 \u7136\u540e\uff0cRedis \u5728\u51b3\u5b9a\u6dd8\u6c70\u7684\u6570\u636e\u65f6\uff0c\u7b2c\u4e00\u6b21\u4f1a\u968f\u673a\u9009\u51fa N \u4e2a\u6570\u636e\uff0c\u628a\u5b83\u4eec\u4f5c\u4e3a\u4e00\u4e2a\u5019\u9009\u96c6\u5408\u3002 \u63a5\u4e0b\u6765\uff0c Redis \u4f1a\u6bd4\u8f83\u8fd9 N \u4e2a\u6570\u636e\u7684 lru \u5b57\u6bb5\uff0c\u628a lru \u5b57\u6bb5\u503c\u6700\u5c0f\u7684\u6570\u636e\u4ece\u7f13\u5b58\u4e2d\u6dd8\u6c70\u51fa\u53bb \u3002 Redis \u63d0\u4f9b\u4e86\u4e00\u4e2a\u914d\u7f6e\u53c2\u6570 maxmemory-samples \uff0c\u8fd9\u4e2a\u53c2\u6570\u5c31\u662f Redis \u9009\u51fa\u7684\u6570\u636e\u4e2a\u6570 N \u3002\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u53ef\u4ee5\u8ba9 Redis \u9009\u51fa 100 \u4e2a\u6570\u636e\u4f5c\u4e3a\u5019\u9009\u6570\u636e\u96c6\uff1a CONFIG SET maxmemory-samples 100 \u5f53\u9700\u8981\u518d\u6b21\u6dd8\u6c70\u6570\u636e\u65f6\uff0cRedis \u9700\u8981\u6311\u9009\u6570\u636e\u8fdb\u5165\u7b2c\u4e00\u6b21\u6dd8\u6c70\u65f6\u521b\u5efa\u7684\u5019\u9009\u96c6\u5408\u3002 \u8fd9\u513f\u7684\u6311\u9009\u6807\u51c6\u662f\uff1a \u80fd\u8fdb\u5165\u5019\u9009\u96c6\u5408\u7684\u6570\u636e\u7684 lru \u5b57\u6bb5\u503c\u5fc5\u987b\u5c0f\u4e8e\u5019\u9009\u96c6\u5408\u4e2d\u6700\u5c0f\u7684 lru \u503c \u3002 \u5f53\u6709\u65b0\u6570\u636e\u8fdb\u5165\u5019\u9009\u6570\u636e\u96c6\u540e\uff0c\u5982\u679c\u5019\u9009\u6570\u636e\u96c6\u4e2d\u7684\u6570\u636e\u4e2a\u6570\u8fbe\u5230\u4e86 maxmemory-samples \uff0cRedis \u5c31\u628a\u5019\u9009\u6570\u636e\u96c6\u4e2d lru \u5b57\u6bb5\u503c\u6700\u5c0f\u7684\u6570\u636e\u6dd8\u6c70\u51fa\u53bb\u3002 \u8fd9\u6837\u4e00\u6765\uff0cRedis \u7f13\u5b58\u4e0d\u7528\u4e3a\u6240\u6709\u7684\u6570\u636e\u7ef4\u62a4\u4e00\u4e2a\u5927\u94fe\u8868\uff0c\u4e5f\u4e0d\u7528\u5728\u6bcf\u6b21\u6570\u636e\u8bbf\u95ee\u65f6\u90fd\u79fb\u52a8\u94fe\u8868\u9879\uff0c\u63d0\u5347\u4e86\u7f13\u5b58\u7684\u6027\u80fd\u3002","title":"2-5 LRU \u7b97\u6cd5"},{"location":"chap5/2redis_cache_full/#2-6","text":"\u4f18\u5148\u4f7f\u7528 allkeys-lru \u7b56\u7565 \u3002\u8fd9\u6837\uff0c\u53ef\u4ee5\u5145\u5206\u5229\u7528 LRU \u8fd9\u4e00\u7ecf\u5178\u7f13\u5b58\u7b97\u6cd5\u7684\u4f18\u52bf\uff0c \u628a\u6700\u8fd1\u6700\u5e38\u8bbf\u95ee\u7684\u6570\u636e\u7559\u5728\u7f13\u5b58\u4e2d\uff0c\u63d0\u5347\u5e94\u7528\u7684\u8bbf\u95ee\u6027\u80fd \u3002\u5982\u679c\u4f60\u7684\u4e1a\u52a1\u6570\u636e\u4e2d\u6709\u660e\u663e\u7684\u51b7\u70ed\u6570\u636e\u533a\u5206\uff0c\u6211\u5efa\u8bae\u4f60\u4f7f\u7528 allkeys-lru \u7b56\u7565\u3002 \u5982\u679c\u4e1a\u52a1\u5e94\u7528\u4e2d\u7684\u6570\u636e\u8bbf\u95ee\u9891\u7387\u76f8\u5dee\u4e0d\u5927\uff0c\u6ca1\u6709\u660e\u663e\u7684\u51b7\u70ed\u6570\u636e\u533a\u5206\uff0c \u5efa\u8bae\u4f7f\u7528 allkeys-random \u7b56\u7565\uff0c\u968f\u673a\u9009\u62e9\u6dd8\u6c70\u7684\u6570\u636e\u5c31\u884c \u3002 \u5982\u679c\u4f60\u7684\u4e1a\u52a1\u4e2d\u6709\u7f6e\u9876\u7684\u9700\u6c42\uff0c\u6bd4\u5982\u7f6e\u9876\u65b0\u95fb\u3001\u7f6e\u9876\u89c6\u9891\uff0c\u90a3\u4e48\uff0c\u53ef\u4ee5\u4f7f\u7528 volatile-lru \u7b56\u7565\uff0c\u540c\u65f6\u4e0d\u7ed9\u8fd9\u4e9b\u7f6e\u9876\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4 \u3002\u8fd9\u6837\u4e00\u6765\uff0c\u8fd9\u4e9b\u9700\u8981\u7f6e\u9876\u7684\u6570\u636e\u4e00\u76f4\u4e0d\u4f1a\u88ab\u5220\u9664\uff0c\u800c\u5176\u4ed6\u6570\u636e\u4f1a\u5728\u8fc7\u671f\u65f6\u6839\u636e LRU \u89c4\u5219\u8fdb\u884c\u7b5b\u9009\u3002","title":"2-6 \u6dd8\u6c70\u7b56\u7565\u4e09\u4e2a\u5efa\u8bae"},{"location":"chap5/2redis_cache_full/#3","text":"\u4e00\u822c\u6765\u8bf4\uff0c\u4e00\u65e6\u88ab\u6dd8\u6c70\u7684\u6570\u636e\u9009\u5b9a\u540e\uff0c\u5982\u679c\u8fd9\u4e2a\u6570\u636e\u662f\u5e72\u51c0\u6570\u636e\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u76f4\u63a5\u5220\u9664\uff1b\u5982\u679c\u8fd9\u4e2a\u6570\u636e\u662f\u810f\u6570\u636e\uff0c\u6211\u4eec\u9700\u8981\u628a\u5b83\u5199\u56de\u6570\u636e\u5e93\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u90a3\u600e\u4e48\u5224\u65ad\u4e00\u4e2a\u6570\u636e\u5230\u5e95\u662f\u5e72\u51c0\u7684\u8fd8\u662f\u810f\u7684\u5462\uff1f \u5e72\u51c0\u6570\u636e\u548c\u810f\u6570\u636e\u7684\u533a\u522b\u5c31\u5728\u4e8e\uff0c\u548c\u6700\u521d\u4ece\u540e\u7aef\u6570\u636e\u5e93\u91cc\u8bfb\u53d6\u65f6\u7684\u503c\u76f8\u6bd4\uff0c\u6709\u6ca1\u6709\u88ab\u4fee\u6539\u8fc7 \u3002 \u5e72\u51c0\u6570\u636e\u4e00\u76f4\u6ca1\u6709\u88ab\u4fee\u6539\uff0c\u6240\u4ee5\u540e\u7aef\u6570\u636e\u5e93\u91cc\u7684\u6570\u636e\u4e5f\u662f\u6700\u65b0\u503c\u3002\u5728\u66ff\u6362\u65f6\uff0c\u5b83\u53ef\u4ee5\u88ab\u76f4\u63a5\u5220\u9664\u3002 \u800c\u810f\u6570\u636e\u5c31\u662f\u66fe\u7ecf\u88ab\u4fee\u6539\u8fc7\u7684\uff0c\u5df2\u7ecf\u548c\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u4fdd\u5b58\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u4e86\u3002\u6b64\u65f6\uff0c\u5982\u679c\u4e0d\u628a\u810f\u6570\u636e\u5199\u56de\u5230\u6570\u636e\u5e93\u4e2d\uff0c\u8fd9\u4e2a\u6570\u636e\u7684\u6700\u65b0\u503c\u5c31\u4e22\u5931\u4e86\uff0c\u5c31\u4f1a\u5f71\u54cd\u5e94\u7528\u7684\u6b63\u5e38\u4f7f\u7528\u3002 \u8fd9\u4e48\u4e00\u6765\uff0c\u7f13\u5b58\u66ff\u6362\u65e2\u817e\u51fa\u4e86\u7f13 \u6211\u4eec\u5728\u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u5982\u679c\u6570\u636e\u88ab\u4fee\u6539\u4e86\uff0c\u9700\u8981\u5728\u6570\u636e\u4fee\u6539\u65f6\u5c31\u5c06\u5b83\u5199\u56de\u6570\u636e\u5e93\u3002\u5426\u5219\uff0c\u8fd9\u4e2a\u810f\u6570\u636e\u88ab\u6dd8\u6c70\u65f6\uff0c\u4f1a\u88ab Redis \u5220\u9664\uff0c\u800c\u6570\u636e\u5e93\u91cc\u4e5f\u6ca1\u6709\u6700\u65b0\u7684\u6570\u636e\u4e86\u3002","title":"3\u3001\u5982\u4f55\u5904\u7406\u88ab\u6dd8\u6c70\u7684\u6570\u636e\uff1f"},{"location":"chap5/2redis_cache_full/#4","text":"\u7f13\u5b58\u66ff\u6362\u65f6\u7684\u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff0c\u4ee5\u53ca\u88ab\u6dd8\u6c70\u6570\u636e\u7684\u5904\u7406\u65b9\u6cd5\u3002 Redis 4.0 \u7248\u672c\u4ee5\u540e\u4e00\u5171\u63d0\u4f9b\u4e86 8 \u79cd\u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff0c\u4ece\u6dd8\u6c70\u6570\u636e\u7684\u5019\u9009\u96c6\u8303\u56f4\u6765\u770b\uff0c\u6211\u4eec\u6709\u4e24\u79cd\u5019\u9009\u8303\u56f4\uff1a \u4e00\u79cd\u662f\u6240\u6709\u6570\u636e\u90fd\u662f\u5019\u9009\u96c6\uff0c\u4e00\u79cd\u662f\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u662f\u5019\u9009\u96c6\u3002 \u53e6\u5916\uff0c\u65e0\u8bba\u662f\u9762\u5411\u54ea\u79cd\u5019\u9009\u6570\u636e\u96c6\u8fdb\u884c\u6dd8\u6c70\u6570\u636e\u9009\u62e9\uff0c\u6211\u4eec\u90fd\u6709\u4e09\u79cd\u7b56\u7565\uff0c \u5206\u522b\u662f\u968f\u673a\u9009\u62e9\uff0c\u6839\u636e LRU \u7b97\u6cd5\u9009\u62e9\uff0c\u4ee5\u53ca\u6839\u636e LFU \u7b97\u6cd5\u9009\u62e9 \u3002 \u5f53\u7136\uff0c\u5f53\u9762\u5411\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u9009\u62e9\u6dd8\u6c70\u6570\u636e\u65f6\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u6839\u636e\u6570\u636e\u79bb\u8fc7\u671f\u65f6\u95f4\u7684\u8fdc\u8fd1\u6765\u51b3\u5b9a\u3002 \u4e00\u822c\u6765\u8bf4\uff0c\u7f13\u5b58\u7cfb\u7edf\u5bf9\u4e8e\u9009\u5b9a\u7684\u88ab\u6dd8\u6c70\u6570\u636e\uff0c \u4f1a\u6839\u636e\u5176\u662f\u5e72\u51c0\u6570\u636e\u8fd8\u662f\u810f\u6570\u636e\uff0c\u9009\u62e9\u76f4\u63a5\u5220\u9664\u8fd8\u662f\u5199\u56de\u6570\u636e\u5e93 \u3002 \u4f46\u662f\uff0c\u5728 Redis \u4e2d\uff0c\u88ab\u6dd8\u6c70\u6570\u636e\u65e0\u8bba\u5e72\u51c0\u4e0e\u5426\u90fd\u4f1a\u88ab\u5220\u9664\uff0c\u6240\u4ee5\uff0c\u8fd9\u662f\u6211\u4eec\u5728\u4f7f\u7528 Redis \u7f13\u5b58\u65f6\u8981\u7279\u522b\u6ce8\u610f\u7684\uff1a\u5f53\u6570\u636e\u4fee\u6539\u6210\u4e3a\u810f\u6570\u636e\u65f6\uff0c\u9700\u8981\u5728\u6570\u636e\u5e93\u4e2d\u4e5f\u628a\u6570\u636e\u4fee\u6539\u8fc7\u6765\u3002 \u5148\u6839\u636e\u662f\u5426\u6709\u59cb\u7ec8\u4f1a\u88ab\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\uff08\u4f8b\u5982\u7f6e\u9876\u6d88\u606f\uff09\uff0c\u6765\u9009\u62e9\u6dd8\u6c70\u6570\u636e\u7684\u5019\u9009\u96c6\uff0c\u4e5f\u5c31\u662f\u51b3\u5b9a\u662f\u9488\u5bf9\u6240\u6709\u6570\u636e\u8fdb\u884c\u6dd8\u6c70\uff0c\u8fd8\u662f\u9488\u5bf9\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u8fdb\u884c\u6dd8\u6c70\u3002 \u5019\u9009\u6570\u636e\u96c6\u8303\u56f4\u9009\u5b9a\u540e\uff0c\u5efa\u8bae\u4f18\u5148\u4f7f\u7528 LRU \u7b97\u6cd5\uff0c\u4e5f\u5c31\u662f\uff0callkeys-lru \u6216 volatile-lru \u7b56\u7565\u3002 \u5408\u5b9e\u9645\u5e94\u7528\u7684\u6570\u636e\u603b\u91cf\u3001\u70ed\u6570\u636e\u7684\u4f53\u91cf\uff0c\u4ee5\u53ca\u6210\u672c\u9884\u7b97\uff0c\u628a\u7f13\u5b58\u7a7a\u95f4\u5927\u5c0f\u8bbe\u7f6e\u5728\u603b\u6570\u636e\u91cf\u7684 15% \u5230 30% \u8fd9\u4e2a\u533a\u95f4\u5c31\u53ef\u4ee5\u3002","title":"4\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap5/3redis_mysql_uncon/","text":"\u7b2c\u4e09\u8282 \u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u7f13\u5b58\u5f02\u5e38 Redis \u7f13\u5b58\u65f6\u7684\u5f02\u5e38\u95ee\u9898\uff0c\u6982\u62ec\u6765\u8bf4\u6709 4 \u4e2a\u65b9\u9762\uff1a \u7f13\u5b58\u4e2d\u7684\u6570\u636e\u548c\u6570\u636e\u5e93\u4e2d\u7684\u4e0d\u4e00\u81f4\uff1b \u7f13\u5b58\u96ea\u5d29\uff1b \u7f13\u5b58\u51fb\u7a7f\u548c\u7f13\u5b58\u7a7f\u900f\u3002 \u53ea\u8981\u6211\u4eec\u4f7f\u7528 Redis \u7f13\u5b58\uff0c\u5c31\u5fc5\u7136\u4f1a\u9762\u5bf9\u7f13\u5b58\u548c\u6570\u636e\u5e93\u95f4\u7684\u4e00\u81f4\u6027\u4fdd\u8bc1\u95ee\u9898\uff0c\u5982\u679c\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u90a3\u4e48\u4e1a\u52a1\u5e94\u7528\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u7684\u6570\u636e\u5c31\u4e0d\u662f\u6700\u65b0\u6570\u636e\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u4e25\u91cd\u7684\u9519\u8bef\u3002 \u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u628a\u7535\u5546\u5546\u54c1\u7684\u5e93\u5b58\u4fe1\u606f\u7f13\u5b58\u5728 Redis \u4e2d\uff0c\u5982\u679c\u5e93\u5b58\u4fe1\u606f\u4e0d\u5bf9\uff0c\u90a3\u4e48\u4e1a\u52a1\u5c42\u4e0b\u5355\u64cd\u4f5c\u5c31\u53ef\u80fd\u51fa\u9519\uff0c\u8fd9\u5f53\u7136\u662f\u4e0d\u80fd\u63a5\u53d7\u7684\u3002 1\u3001\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u662f\u5982\u4f55\u53d1\u751f\u7684\uff1f \u7f13\u5b58\u4e2d\u6709\u6570\u636e\uff0c\u90a3\u4e48\uff0c\u7f13\u5b58\u7684\u6570\u636e\u503c\u9700\u8981\u548c\u6570\u636e\u5e93\u4e2d\u7684\u503c\u76f8\u540c\uff1b \u7f13\u5b58\u4e2d\u672c\u8eab\u6ca1\u6709\u6570\u636e\uff0c\u90a3\u4e48\uff0c\u6570\u636e\u5e93\u4e2d\u7684\u503c\u5fc5\u987b\u662f\u6700\u65b0\u503c\u3002 \u4e0d\u7b26\u5408\u8fd9\u4e24\u79cd\u60c5\u51b5\u7684\uff0c\u5c31\u5c5e\u4e8e\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\u4e86\u3002 \u4e0d\u8fc7\uff0c\u5f53\u7f13\u5b58\u7684\u8bfb\u5199\u6a21\u5f0f\u4e0d\u540c\u65f6\uff0c\u7f13\u5b58\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u53d1\u751f\u60c5\u51b5\u4e0d\u4e00\u6837\uff0c\u6211\u4eec\u7684\u5e94\u5bf9\u65b9\u6cd5\u4e5f\u4f1a\u6709\u6240\u4e0d\u540c\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5148\u6309\u7167\u7f13\u5b58\u8bfb\u5199\u6a21\u5f0f\uff0c\u6765\u5206\u522b\u4e86\u89e3\u4e0b\u4e0d\u540c\u6a21\u5f0f\u4e0b\u7684\u7f13\u5b58\u4e0d\u4e00\u81f4\u60c5\u51b5 \u6839\u636e\u662f\u5426\u63a5\u6536\u5199\u8bf7\u6c42\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u7f13\u5b58\u5206\u6210\u8bfb\u5199\u7f13\u5b58\u548c\u53ea\u8bfb\u7f13\u5b58\u3002 1-1 \u8bfb\u5199\u7f13\u5b58 \u5bf9\u4e8e\u8bfb\u5199\u7f13\u5b58\u6765\u8bf4\uff0c\u5982\u679c\u8981\u5bf9\u6570\u636e\u8fdb\u884c\u589e\u5220\u6539\uff0c\u5c31\u9700\u8981\u5728\u7f13\u5b58\u4e2d\u8fdb\u884c\uff0c\u540c\u65f6\u8fd8\u8981\u6839\u636e\u91c7\u53d6\u7684\u5199\u56de\u7b56\u7565\uff0c\u51b3\u5b9a\u662f\u5426\u540c\u6b65\u5199\u56de\u5230\u6570\u636e\u5e93\u4e2d\u3002 \u540c\u6b65\u76f4\u5199\u7b56\u7565\uff1a\u5199\u7f13\u5b58\u65f6\uff0c\u4e5f\u540c\u6b65\u5199\u6570\u636e\u5e93\uff0c\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u4e00\u81f4\uff1b \u5f02\u6b65\u5199\u56de\u7b56\u7565\uff1a\u5199\u7f13\u5b58\u65f6\u4e0d\u540c\u6b65\u5199\u6570\u636e\u5e93\uff0c\u7b49\u5230\u6570\u636e\u4ece\u7f13\u5b58\u4e2d\u6dd8\u6c70\u65f6\uff0c\u518d\u5199\u56de\u6570\u636e\u5e93\u3002\u4f7f\u7528\u8fd9\u79cd\u7b56\u7565\u65f6\uff0c\u5982\u679c\u6570\u636e\u8fd8\u6ca1\u6709\u5199\u56de\u6570\u636e\u5e93\uff0c\u7f13\u5b58\u5c31\u53d1\u751f\u4e86\u6545\u969c\uff0c\u90a3\u4e48\uff0c\u6b64\u65f6\uff0c\u6570\u636e\u5e93\u5c31\u6ca1\u6709\u6700\u65b0\u7684\u6570\u636e\u4e86\u3002 \u6240\u4ee5\uff0c\u5bf9\u4e8e\u8bfb\u5199\u7f13\u5b58\u6765\u8bf4\uff0c\u8981\u60f3\u4fdd\u8bc1\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u4e00\u81f4\uff0c\u5c31\u8981\u91c7\u7528\u540c\u6b65\u76f4\u5199\u7b56\u7565\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u91c7\u7528\u8fd9\u79cd\u7b56\u7565\uff0c\u5c31\u9700\u8981\u540c\u65f6\u66f4\u65b0\u7f13\u5b58\u548c\u6570\u636e\u5e93 \u3002\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u5728\u4e1a\u52a1\u5e94\u7528\u4e2d\u4f7f\u7528\u4e8b\u52a1\u673a\u5236\uff0c\u6765\u4fdd\u8bc1\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u66f4\u65b0\u5177\u6709\u539f\u5b50\u6027\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e24\u8005\u8981\u4e0d\u4e00\u8d77\u66f4\u65b0\uff0c\u8981\u4e0d\u90fd\u4e0d\u66f4\u65b0\uff0c\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\uff0c\u8fdb\u884c\u91cd\u8bd5\u3002\u5426\u5219\uff0c\u6211\u4eec\u5c31\u65e0\u6cd5\u5b9e\u73b0\u540c\u6b65\u76f4\u5199\u3002 \u5728\u6709\u4e9b\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u5bf9 \u6570\u636e\u4e00\u81f4\u6027\u7684\u8981\u6c42\u53ef\u80fd\u4e0d\u662f\u90a3\u4e48\u9ad8 \uff0c\u6bd4\u5982\u8bf4\u7f13\u5b58\u7684\u662f\u7535\u5546\u5546\u54c1\u7684\u975e\u5173\u952e\u5c5e\u6027\u6216\u8005\u77ed\u89c6\u9891\u7684\u521b\u5efa\u6216\u4fee\u6539\u65f6\u95f4\u7b49\uff0c\u90a3\u4e48\uff0c \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5f02\u6b65\u5199\u56de\u7b56\u7565 \u3002 1-2 \u53ea\u8bfb\u7f13\u5b58 \u5bf9\u4e8e\u53ea\u8bfb\u7f13\u5b58\u6765\u8bf4\uff0c\u5982\u679c\u6709\u6570\u636e\u65b0\u589e\uff0c\u4f1a\u76f4\u63a5\u5199\u5165\u6570\u636e\u5e93\uff1b \u800c\u6709\u6570\u636e\u5220\u6539\u65f6\uff0c\u5c31\u9700\u8981\u628a\u53ea\u8bfb\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u6807\u8bb0\u4e3a\u65e0\u6548\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5e94\u7528\u540e\u7eed\u518d\u8bbf\u95ee\u8fd9\u4e9b\u589e\u5220\u6539\u7684\u6570\u636e\u65f6\uff0c\u56e0\u4e3a\u7f13\u5b58\u4e2d\u6ca1\u6709\u76f8\u5e94\u7684\u6570\u636e\uff0c\u5c31\u4f1a\u53d1\u751f\u7f13\u5b58\u7f3a\u5931 \u3002 \u6b64\u65f6\uff0c\u5e94\u7528\u518d\u4ece\u6570\u636e\u5e93\u4e2d\u628a\u6570\u636e\u8bfb\u5165\u7f13\u5b58\uff0c\u8fd9\u6837\u540e\u7eed\u518d\u8bbf\u95ee\u6570\u636e\u65f6\uff0c\u5c31\u80fd\u591f\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u4e86\u3002 Tomcat \u5411 MySQL \u4e2d\u5199\u5165\u548c\u5220\u6539\u6570\u636e \uff0cTomcat \u4e0a\u8fd0\u884c\u7684\u5e94\u7528\uff0c\u65e0\u8bba\u662f\u65b0\u589e\uff08Insert \u64cd\u4f5c\uff09\u3001\u4fee\u6539\uff08Update \u64cd\u4f5c\uff09\u3001\u8fd8\u662f\u5220\u9664\uff08Delete \u64cd\u4f5c\uff09\u6570\u636e X\uff0c\u90fd\u4f1a\u76f4\u63a5\u5728\u6570\u636e\u5e93\u4e2d\u589e\u6539\u5220\u3002 \u5f53\u7136\uff0c\u5982\u679c\u5e94\u7528\u6267\u884c\u7684\u662f\u4fee\u6539\u6216\u5220\u9664\u64cd\u4f5c\uff0c\u8fd8\u4f1a\u5220\u9664\u7f13\u5b58\u7684\u6570\u636e X\u3002 1-2-1 \u65b0\u589e\u6570\u636e \u5982\u679c\u662f\u65b0\u589e\u6570\u636e\uff0c\u6570\u636e\u4f1a\u76f4\u63a5\u5199\u5230\u6570\u636e\u5e93\u4e2d\uff0c\u4e0d\u7528\u5bf9\u7f13\u5b58\u505a\u4efb\u4f55\u64cd\u4f5c\uff0c\u6b64\u65f6\uff0c\u7f13\u5b58\u4e2d\u672c\u8eab\u5c31\u6ca1\u6709\u65b0\u589e\u6570\u636e\uff0c\u800c\u6570\u636e\u5e93\u4e2d\u662f\u6700\u65b0\u503c\uff0c\u8fd9\u79cd\u60c5\u51b5\u7b26\u5408\u6211\u4eec\u521a\u521a\u6240\u8bf4\u7684\u4e00\u81f4\u6027\u7684\u7b2c 2 \u79cd\u60c5\u51b5\uff0c\u6240\u4ee5\uff0c\u6b64\u65f6\uff0c\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684 1-2-2 \u5220\u6539\u6570\u636e \u5982\u679c\u53d1\u751f\u5220\u6539\u64cd\u4f5c\uff0c\u5e94\u7528\u65e2\u8981\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u4e5f\u8981\u5728\u7f13\u5b58\u4e2d\u5220\u9664\u6570\u636e\u3002\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u5982\u679c\u65e0\u6cd5\u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8981\u4e0d\u90fd\u5b8c\u6210\uff0c\u8981\u4e0d\u90fd\u6ca1\u5b8c\u6210 \uff0c\u6b64\u65f6\uff0c\u5c31\u4f1a\u51fa\u73b0\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\u4e86\u3002\u8fd9\u4e2a\u95ee\u9898\u6bd4\u8f83\u590d\u6742\uff0c\u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\u3002 \u6211\u4eec\u5047\u8bbe\u5e94\u7528\u5148\u5220\u9664\u7f13\u5b58\uff0c\u518d\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u5982\u679c\u7f13\u5b58\u5220\u9664\u6210\u529f\uff0c\u4f46\u662f\u6570\u636e\u5e93\u66f4\u65b0\u5931\u8d25\uff0c\u90a3\u4e48\uff0c\u5e94\u7528\u518d\u8bbf\u95ee\u6570\u636e\u65f6\uff0c\u7f13\u5b58\u4e2d\u6ca1\u6709\u6570\u636e\uff0c\u5c31\u4f1a\u53d1\u751f\u7f13\u5b58\u7f3a\u5931 \u7136\u540e\uff0c\u5e94\u7528\u518d\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u4f46\u662f\u6570\u636e\u5e93\u4e2d\u7684\u503c\u4e3a\u65e7\u503c\uff0c\u5e94\u7528\u5c31\u8bbf\u95ee\u5230\u65e7\u503c\u4e86\u3002 \u5e94\u7528\u8981\u628a\u6570\u636e X \u7684\u503c\u4ece 10 \u66f4\u65b0\u4e3a 3\uff0c\u5148\u5728 Redis \u7f13\u5b58\u4e2d\u5220\u9664\u4e86 X \u7684\u7f13\u5b58\u503c\uff0c\u4f46\u662f\u66f4\u65b0\u6570\u636e\u5e93\u5374\u5931\u8d25\u4e86\u3002 \u5982\u679c\u6b64\u65f6\u6709\u5176\u4ed6\u5e76\u53d1\u7684\u8bf7\u6c42\u8bbf\u95ee X\uff0c\u4f1a\u53d1\u73b0 Redis \u4e2d\u7f13\u5b58\u7f3a\u5931\uff0c\u7d27\u63a5\u7740\uff0c\u8bf7\u6c42\u5c31\u4f1a\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u8bfb\u5230\u7684\u5374\u662f\u65e7\u503c 10\u3002 \u5982\u679c\u5e94\u7528\u5148\u5b8c\u6210\u4e86\u6570\u636e\u5e93\u7684\u66f4\u65b0\uff0c\u4f46\u662f\uff0c\u5728\u5220\u9664\u7f13\u5b58\u65f6\u5931\u8d25\u4e86\uff0c\u90a3\u4e48\uff0c\u6570\u636e\u5e93\u4e2d\u7684\u503c\u662f\u65b0\u503c\uff0c\u800c\u7f13\u5b58\u4e2d\u7684\u662f\u65e7\u503c\uff0c\u8fd9\u80af\u5b9a\u662f\u4e0d\u4e00\u81f4\u7684\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u5982\u679c\u6709\u5176\u4ed6\u7684\u5e76\u53d1\u8bf7\u6c42\u6765\u8bbf\u95ee\u6570\u636e\uff0c\u6309\u7167\u6b63\u5e38\u7684\u7f13\u5b58\u8bbf\u95ee\u6d41\u7a0b\uff0c\u5c31\u4f1a\u5148\u5728\u7f13\u5b58\u4e2d\u67e5\u8be2\uff0c\u4f46\u6b64\u65f6\uff0c\u5c31\u4f1a\u8bfb\u5230\u65e7\u503c\u4e86\u3002 \u5e94\u7528\u8981\u628a\u6570\u636e X \u7684\u503c\u4ece 10 \u66f4\u65b0\u4e3a 3\uff0c\u5148\u6210\u529f\u66f4\u65b0\u4e86\u6570\u636e\u5e93\uff0c\u7136\u540e\u5728 Redis \u7f13\u5b58\u4e2d\u5220\u9664 X \u7684\u7f13\u5b58\uff0c\u4f46\u662f\u8fd9\u4e2a\u64cd\u4f5c\u5374\u5931\u8d25\u4e86\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u6570\u636e\u5e93\u4e2d X \u7684\u65b0\u503c\u4e3a 3\uff0cRedis \u4e2d\u7684 X \u7684\u7f13\u5b58\u503c\u4e3a 10\uff0c\u8fd9\u80af\u5b9a\u662f\u4e0d\u4e00\u81f4\u7684\u3002\u5982\u679c\u521a\u597d\u6b64\u65f6\u6709\u5176\u4ed6\u5ba2\u6237\u7aef\u4e5f\u53d1\u9001\u8bf7\u6c42\u8bbf\u95ee X\uff0c\u4f1a\u5148\u5728 Redis \u4e2d\u67e5\u8be2\uff0c\u8be5\u5ba2\u6237\u7aef\u4f1a\u53d1\u73b0\u7f13\u5b58\u547d\u4e2d\uff0c\u4f46\u662f\u8bfb\u5230\u7684\u5374\u662f\u65e7\u503c 10\u3002 \u5728\u66f4\u65b0\u6570\u636e\u5e93\u548c\u5220\u9664\u7f13\u5b58\u503c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u65e0\u8bba\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7684\u6267\u884c\u987a\u5e8f\u8c01\u5148\u8c01\u540e\uff0c\u53ea\u8981\u6709\u4e00\u4e2a\u64cd\u4f5c\u5931\u8d25\u4e86\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5ba2\u6237\u7aef\u8bfb\u53d6\u5230\u65e7\u503c\u3002 2\u3001\u5982\u4f55\u89e3\u51b3\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\uff1f 2-1 \u91cd\u8bd5\u673a\u5236 \u5177\u4f53\u6765\u8bf4\uff0c\u53ef\u4ee5\u628a\u8981\u5220\u9664\u7684\u7f13\u5b58\u503c\u6216\u8005\u662f\u8981\u66f4\u65b0\u7684\u6570\u636e\u5e93\u503c\u6682\u5b58\u5230\u6d88\u606f\u961f\u5217\u4e2d\uff08\u4f8b\u5982\u4f7f\u7528 Kafka \u6d88\u606f\u961f\u5217\uff09\u3002 \u5f53\u5e94\u7528\u6ca1\u6709\u80fd\u591f\u6210\u529f\u5730\u5220\u9664\u7f13\u5b58\u503c\u6216\u8005\u662f\u66f4\u65b0\u6570\u636e\u5e93\u503c\u65f6\uff0c\u53ef\u4ee5\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u91cd\u65b0\u8bfb\u53d6\u8fd9\u4e9b\u503c\uff0c\u7136\u540e\u518d\u6b21\u8fdb\u884c\u5220\u9664\u6216\u66f4\u65b0\u3002 \u5982\u679c\u80fd\u591f\u6210\u529f\u5730\u5220\u9664\u6216\u66f4\u65b0\uff0c\u6211\u4eec\u5c31\u8981\u628a\u8fd9\u4e9b\u503c\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u53bb\u9664\uff0c\u4ee5\u514d\u91cd\u590d\u64cd\u4f5c\uff0c\u6b64\u65f6\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u5e93\u548c\u7f13\u5b58\u7684\u6570\u636e\u4e00\u81f4\u4e86\u3002\u5426\u5219\u7684\u8bdd\uff0c \u6211\u4eec\u8fd8\u9700\u8981\u518d\u6b21\u8fdb\u884c\u91cd\u8bd5\u3002\u5982\u679c\u91cd\u8bd5\u8d85\u8fc7\u7684\u4e00\u5b9a\u6b21\u6570\uff0c\u8fd8\u662f\u6ca1\u6709\u6210\u529f\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5411\u4e1a\u52a1\u5c42\u53d1\u9001\u62a5\u9519\u4fe1\u606f\u4e86\u3002 \u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58\u503c\u65f6\uff0c\u5982\u679c\u7f13\u5b58\u5220\u9664\u5931\u8d25\uff0c\u518d\u6b21\u91cd\u8bd5\u540e\u5220\u9664\u6210\u529f\u7684\u60c5\u51b5 \u5b9e\u9645\u4e0a\uff0c\u5373\u4f7f\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7b2c\u4e00\u6b21\u6267\u884c\u65f6\u90fd\u6ca1\u6709\u5931\u8d25\uff0c\u5f53\u6709\u5927\u91cf\u5e76\u53d1\u8bf7\u6c42\u65f6\uff0c\u5e94\u7528\u8fd8\u662f\u6709\u53ef\u80fd\u8bfb\u5230\u4e0d\u4e00\u81f4\u7684\u6570\u636e\u3002 \u6211\u4eec\u6309\u7167\u4e0d\u540c\u7684\u5220\u9664\u548c\u66f4\u65b0\u987a\u5e8f\uff0c\u5206\u6210\u4e24\u79cd\u60c5\u51b5\u6765\u770b\u3002\u5728\u8fd9\u4e24\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u7684\u89e3\u51b3\u65b9\u6cd5\u4e5f\u6709\u6240\u4e0d\u540c\u3002 2-2 \u60c5\u51b5\u4e00\uff1a\u5148\u5220\u9664\u7f13\u5b58\uff0c\u518d\u66f4\u65b0\u6570\u636e\u5e93 \u5047\u8bbe\u7ebf\u7a0b A \u5220\u9664\u7f13\u5b58\u503c\u540e\uff0c\u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u66f4\u65b0\u6570\u636e\u5e93\uff08\u6bd4\u5982\u8bf4\u6709\u7f51\u7edc\u5ef6\u8fdf\uff09\uff0c\u7ebf\u7a0b B \u5c31\u5f00\u59cb\u8bfb\u53d6\u6570\u636e\u4e86\uff0c\u90a3\u4e48\u8fd9\u4e2a\u65f6\u5019\uff0c\u7ebf\u7a0b B \u4f1a\u53d1\u73b0\u7f13\u5b58\u7f3a\u5931\uff0c\u5c31\u53ea\u80fd\u53bb\u6570\u636e\u5e93\u8bfb\u53d6\u3002\u8fd9\u4f1a\u5e26\u6765\u4e24\u4e2a\u95ee\u9898\uff1a \u7ebf\u7a0b B \u8bfb\u53d6\u5230\u4e86\u65e7\u503c\uff1b \u7ebf\u7a0b B \u662f\u5728\u7f13\u5b58\u7f3a\u5931\u7684\u60c5\u51b5\u4e0b\u8bfb\u53d6\u7684\u6570\u636e\u5e93\uff0c\u6240\u4ee5\uff0c\u5b83\u8fd8\u4f1a\u628a\u65e7\u503c\u5199\u5165\u7f13\u5b58\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5176\u4ed6\u7ebf\u7a0b\u4ece\u7f13\u5b58\u4e2d\u8bfb\u5230\u65e7\u503c\u3002 \u7b49\u5230\u7ebf\u7a0b B \u4ece\u6570\u636e\u5e93\u8bfb\u53d6\u5b8c\u6570\u636e\u3001\u66f4\u65b0\u4e86\u7f13\u5b58\u540e\uff0c\u7ebf\u7a0b A \u624d\u5f00\u59cb\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u6b64\u65f6\uff0c\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u662f\u65e7\u503c\uff0c\u800c\u6570\u636e\u5e93\u4e2d\u7684\u662f\u6700\u65b0\u503c\uff0c\u4e24\u8005\u5c31\u4e0d\u4e00\u81f4\u4e86\u3002 \u5728\u7ebf\u7a0b A \u66f4\u65b0\u5b8c\u6570\u636e\u5e93\u503c\u4ee5\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba9\u5b83\u5148 sleep \u4e00\u5c0f\u6bb5\u65f6\u95f4\uff0c\u518d\u8fdb\u884c\u4e00\u6b21\u7f13\u5b58\u5220\u9664\u64cd\u4f5c\u3002 \u4e4b\u6240\u4ee5\u8981\u52a0\u4e0a sleep \u7684\u8fd9\u6bb5\u65f6\u95f4\uff0c\u5c31\u662f\u4e3a\u4e86\u8ba9\u7ebf\u7a0b B \u80fd\u591f\u5148\u4ece\u6570\u636e\u5e93\u8bfb\u53d6\u6570\u636e\uff0c \u518d\u628a\u7f3a\u5931\u7684\u6570\u636e\u5199\u5165\u7f13\u5b58\uff0c \u7136\u540e\uff0c\u7ebf\u7a0b A \u518d\u8fdb\u884c\u5220\u9664\u3002 \u6240\u4ee5\uff0c\u7ebf\u7a0b A sleep \u7684\u65f6\u95f4\uff0c\u5c31\u9700\u8981\u5927\u4e8e\u7ebf\u7a0b B \u8bfb\u53d6\u6570\u636e\u518d\u5199\u5165\u7f13\u5b58\u7684\u65f6\u95f4 \u3002 \u8fd9\u4e2a\u65f6\u95f4\u600e\u4e48\u786e\u5b9a\u5462\uff1f \u5efa\u8bae\u4f60\u5728\u4e1a\u52a1\u7a0b\u5e8f\u8fd0\u884c\u7684\u65f6\u5019\uff0c\u7edf\u8ba1\u4e0b\u7ebf\u7a0b\u8bfb\u6570\u636e\u548c\u5199\u7f13\u5b58\u7684\u64cd\u4f5c\u65f6\u95f4\uff0c\u4ee5\u6b64\u4e3a\u57fa\u7840\u6765\u8fdb\u884c\u4f30\u7b97\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5176\u5b83\u7ebf\u7a0b\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u4f1a\u53d1\u73b0\u7f13\u5b58\u7f3a\u5931\uff0c\u6240\u4ee5\u4f1a\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6700\u65b0\u503c\u3002\u56e0\u4e3a\u8fd9\u4e2a\u65b9\u6848\u4f1a\u5728\u7b2c\u4e00\u6b21\u5220\u9664\u7f13\u5b58\u503c\u540e\uff0c\u5ef6\u8fdf\u4e00\u6bb5\u65f6\u95f4\u518d\u6b21\u8fdb\u884c\u5220\u9664\uff0c\u6240\u4ee5\u6211\u4eec\u4e5f\u628a\u5b83\u53eb\u505a\u201c\u5ef6\u8fdf\u53cc\u5220\u201d\u3002 redis.delKey(X) db.update(X) Thread.sleep(N) redis.delKey(X) 2-3 \u60c5\u51b5\u4e8c\uff1a\u5148\u66f4\u65b0\u6570\u636e\u5e93\u503c\uff0c\u518d\u5220\u9664\u7f13\u5b58\u503c \u5982\u679c\u7ebf\u7a0b A \u5220\u9664\u4e86\u6570\u636e\u5e93\u4e2d\u7684\u503c\uff0c\u4f46\u8fd8\u6ca1\u6765\u5f97\u53ca\u5220\u9664\u7f13\u5b58\u503c\uff0c\u7ebf\u7a0b B \u5c31\u5f00\u59cb\u8bfb\u53d6\u6570\u636e\u4e86\uff0c\u90a3\u4e48\u6b64\u65f6\uff0c\u7ebf\u7a0b B \u67e5\u8be2\u7f13\u5b58\u65f6\uff0c\u53d1\u73b0\u7f13\u5b58\u547d\u4e2d\uff0c\u5c31\u4f1a\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u65e7\u503c\u3002 \u4e0d\u8fc7\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5176\u4ed6\u7ebf\u7a0b\u5e76\u53d1\u8bfb\u7f13\u5b58\u7684\u8bf7\u6c42\u4e0d\u591a\uff0c\u90a3\u4e48\uff0c\u5c31\u4e0d\u4f1a\u6709\u5f88\u591a\u8bf7\u6c42\u8bfb\u53d6\u5230\u65e7\u503c\u3002\u800c\u4e14\uff0c\u7ebf\u7a0b A \u4e00\u822c\u4e5f\u4f1a\u5f88\u5feb\u5220\u9664\u7f13\u5b58\u503c\uff0c \u8fd9\u6837\u4e00\u6765\uff0c\u5176\u4ed6\u7ebf\u7a0b\u518d\u6b21\u8bfb\u53d6\u65f6\uff0c\u5c31\u4f1a\u53d1\u751f\u7f13\u5b58\u7f3a\u5931\uff0c\u8fdb\u800c\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6700\u65b0\u503c\u3002\u6240\u4ee5\uff0c\u8fd9\u79cd\u60c5\u51b5\u5bf9\u4e1a\u52a1\u7684\u5f71\u54cd\u8f83\u5c0f\u3002 \u5220\u9664\u7f13\u5b58\u503c\u6216\u66f4\u65b0\u6570\u636e\u5e93\u5931\u8d25\u800c\u5bfc\u81f4\u6570\u636e\u4e0d\u4e00\u81f4\uff0c \u4f60\u53ef\u4ee5\u4f7f\u7528\u91cd\u8bd5\u673a\u5236\u786e\u4fdd\u5220\u9664\u6216\u66f4\u65b0\u64cd\u4f5c\u6210\u529f \u5728\u5220\u9664\u7f13\u5b58\u503c\u3001\u66f4\u65b0\u6570\u636e\u5e93\u7684\u8fd9\u4e24\u6b65\u64cd\u4f5c\u4e2d\uff0c \u6709\u5176\u4ed6\u7ebf\u7a0b\u7684\u5e76\u53d1\u8bfb\u64cd\u4f5c\uff0c\u5bfc\u81f4\u5176\u4ed6\u7ebf\u7a0b\u8bfb\u53d6\u5230\u65e7\u503c\uff0c\u5e94\u5bf9\u65b9\u6848\u662f\u5ef6\u8fdf\u53cc\u5220\u3002 3\u3001\u7f13\u5b58\u96ea\u5d29 \u7f13\u5b58\u96ea\u5d29\u662f\u6307\u5927\u91cf\u7684\u5e94\u7528\u8bf7\u6c42\u65e0\u6cd5\u5728 Redis \u7f13\u5b58\u4e2d\u8fdb\u884c\u5904\u7406\uff0c\u7d27\u63a5\u7740\uff0c\u5e94\u7528\u5c06\u5927\u91cf\u8bf7\u6c42\u53d1\u9001\u5230\u6570\u636e\u5e93\u5c42\uff0c\u5bfc\u81f4\u6570\u636e\u5e93\u5c42\u7684\u538b\u529b\u6fc0\u589e\u3002 \u7b2c\u4e00\u4e2a\u539f\u56e0\u662f\uff1a\u7f13\u5b58\u4e2d\u6709\u5927\u91cf\u6570\u636e\u540c\u65f6\u8fc7\u671f\uff0c\u5bfc\u81f4\u5927\u91cf\u8bf7\u6c42\u65e0\u6cd5\u5f97\u5230\u5904\u7406\u3002 \u5177\u4f53\u6765\u8bf4\uff0c \u5f53\u6570\u636e\u4fdd\u5b58\u5728\u7f13\u5b58\u4e2d\uff0c\u5e76\u4e14\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u65f6\uff0c\u5982\u679c\u5728\u67d0\u4e00\u4e2a\u65f6\u523b\uff0c\u5927\u91cf\u6570\u636e\u540c\u65f6\u8fc7\u671f\uff0c\u6b64\u65f6\uff0c\u5e94\u7528\u518d\u8bbf\u95ee\u8fd9\u4e9b\u6570\u636e\u7684\u8bdd\uff0c\u5c31\u4f1a\u53d1\u751f\u7f13\u5b58\u7f3a\u5931\u3002 \u7d27\u63a5\u7740\uff0c\u5e94\u7528\u5c31\u4f1a\u628a\u8bf7\u6c42\u53d1\u9001\u7ed9\u6570\u636e\u5e93\uff0c\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\u3002\u5982\u679c\u5e94\u7528\u7684\u5e76\u53d1\u8bf7\u6c42\u91cf\u5f88\u5927\uff0c\u90a3\u4e48\u6570\u636e\u5e93\u7684\u538b\u529b\u4e5f\u5c31\u5f88\u5927\uff0c\u8fd9\u4f1a\u8fdb\u4e00\u6b65\u5f71\u54cd\u5230\u6570\u636e\u5e93\u7684\u5176\u4ed6\u6b63\u5e38\u4e1a\u52a1\u8bf7\u6c42\u5904\u7406\u3002 \u9488\u5bf9\u5927\u91cf\u6570\u636e\u540c\u65f6\u5931\u6548\u5e26\u6765\u7684\u7f13\u5b58\u96ea\u5d29\u95ee\u9898\uff0c\u63d0\u4f9b\u4e24\u79cd\u89e3\u51b3\u65b9\u6848\u3002 3-1 \u907f\u514d\u7ed9\u5927\u91cf\u7684\u6570\u636e\u8bbe\u7f6e\u76f8\u540c\u7684\u8fc7\u671f\u65f6\u95f4 \u9996\u5148\uff0c\u6211\u4eec\u53ef\u4ee5\u907f\u514d\u7ed9\u5927\u91cf\u7684\u6570\u636e\u8bbe\u7f6e\u76f8\u540c\u7684\u8fc7\u671f\u65f6\u95f4\u3002 \u5982\u679c\u4e1a\u52a1\u5c42\u7684\u786e\u8981\u6c42\u6709\u4e9b\u6570\u636e\u540c\u65f6\u5931\u6548\uff0c\u4f60\u53ef\u4ee5\u5728\u7528 EXPIRE \u547d\u4ee4\u7ed9\u6bcf\u4e2a\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u65f6\uff0c\u7ed9 \u8fd9\u4e9b\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u589e\u52a0\u4e00\u4e2a\u8f83\u5c0f\u7684\u968f\u673a\u6570\uff08\u4f8b\u5982\uff0c\u968f\u673a\u589e\u52a0 1~3 \u5206\u949f\uff09 \uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u4e0d\u540c\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u6709\u6240\u5dee\u522b\uff0c\u4f46\u5dee\u522b\u53c8\u4e0d\u4f1a\u592a\u5927\uff0c\u65e2\u907f\u514d\u4e86\u5927\u91cf\u6570\u636e\u540c\u65f6\u8fc7\u671f\uff0c\u540c\u65f6\u4e5f\u4fdd\u8bc1\u4e86\u8fd9\u4e9b\u6570\u636e\u57fa\u672c\u5728\u76f8\u8fd1\u7684\u65f6\u95f4\u5931\u6548\uff0c\u4ecd\u7136\u80fd\u6ee1\u8db3\u4e1a\u52a1\u9700\u6c42\u3002 3-2 \u670d\u52a1\u964d\u7ea7 \u6211\u4eec\u8fd8\u53ef\u4ee5\u901a\u8fc7\u670d\u52a1\u964d\u7ea7\uff0c\u6765\u5e94\u5bf9\u7f13\u5b58\u96ea\u5d29\u3002\u6240\u8c13\u7684\u670d\u52a1\u964d\u7ea7\uff0c\u662f\u6307\u53d1\u751f\u7f13\u5b58\u96ea\u5d29\u65f6\uff0c\u9488\u5bf9\u4e0d\u540c\u7684\u6570\u636e\u91c7\u53d6\u4e0d\u540c\u7684\u5904\u7406\u65b9\u5f0f\u3002 \u5f53\u4e1a\u52a1\u5e94\u7528\u8bbf\u95ee\u7684\u662f\u975e\u6838\u5fc3\u6570\u636e\uff08\u4f8b\u5982\u7535\u5546\u5546\u54c1\u5c5e\u6027\uff09\u65f6\uff0c \u6682\u65f6\u505c\u6b62\u4ece\u7f13\u5b58\u4e2d\u67e5\u8be2\u8fd9\u4e9b\u6570\u636e\uff0c\u800c\u662f\u76f4\u63a5\u8fd4\u56de\u9884\u5b9a\u4e49\u4fe1\u606f\u3001\u7a7a\u503c\u6216\u662f\u9519\u8bef\u4fe1\u606f\uff1b \u5f53\u4e1a\u52a1\u5e94\u7528\u8bbf\u95ee\u7684\u662f\u6838\u5fc3\u6570\u636e\uff08\u4f8b\u5982\u7535\u5546\u5546\u54c1\u5e93\u5b58\uff09\u65f6\uff0c\u4ecd\u7136\u5141\u8bb8\u67e5\u8be2\u7f13\u5b58 \uff0c\u5982\u679c\u7f13\u5b58\u7f3a\u5931\uff0c\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u901a\u8fc7\u6570\u636e\u5e93\u8bfb\u53d6\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u53ea\u6709\u90e8\u5206\u8fc7\u671f\u6570\u636e\u7684\u8bf7\u6c42\u4f1a\u53d1\u9001\u5230\u6570\u636e\u5e93\uff0c\u6570\u636e\u5e93\u7684\u538b\u529b\u5c31\u6ca1\u6709\u90a3\u4e48\u5927\u4e86\u3002 \u9664\u4e86\u5927\u91cf\u6570\u636e\u540c\u65f6\u5931\u6548\u4f1a\u5bfc\u81f4\u7f13\u5b58\u96ea\u5d29\uff0c\u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\u4e5f\u4f1a\u53d1\u751f\u7f13\u5b58\u96ea\u5d29\uff0c\u90a3\u5c31\u662f\uff0cRedis \u7f13\u5b58\u5b9e\u4f8b\u53d1\u751f\u6545\u969c\u5b95\u673a\u4e86\uff0c\u65e0\u6cd5\u5904\u7406\u8bf7\u6c42\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u5927\u91cf\u8bf7\u6c42\u4e00\u4e0b\u5b50\u79ef\u538b\u5230\u6570\u636e\u5e93\u5c42\uff0c\u4ece\u800c\u53d1\u751f\u7f13\u5b58\u96ea\u5d29\u3002 \u4e00\u822c\u6765\u8bf4\uff0c\u4e00\u4e2a Redis \u5b9e\u4f8b\u53ef\u4ee5\u652f\u6301\u6570\u4e07\u7ea7\u522b\u7684\u8bf7\u6c42\u5904\u7406\u541e\u5410\u91cf\uff0c\u800c\u5355\u4e2a\u6570\u636e\u5e93\u53ef\u80fd\u53ea\u80fd\u652f\u6301\u6570\u5343\u7ea7\u522b\u7684\u8bf7\u6c42\u5904\u7406\u541e\u5410\u91cf\uff0c\u5b83\u4eec\u4e24\u4e2a\u7684\u5904\u7406\u80fd\u529b\u53ef\u80fd\u76f8\u5dee\u4e86\u8fd1\u5341\u500d\u3002\u7531\u4e8e\u7f13\u5b58\u96ea\u5d29\uff0cRedis \u7f13\u5b58\u5931\u6548\uff0c\u6240\u4ee5\uff0c\u6570\u636e\u5e93\u5c31\u53ef\u80fd\u8981\u627f\u53d7\u8fd1\u5341\u500d\u7684\u8bf7\u6c42\u538b\u529b\uff0c\u4ece\u800c\u56e0\u4e3a\u538b\u529b\u8fc7\u5927\u800c\u5d29\u6e83\u3002 \u56e0\u4e3a Redis \u5b9e\u4f8b\u53d1\u751f\u4e86\u5b95\u673a\uff0c\u6211\u4eec\u9700\u8981\u901a\u8fc7\u5176\u4ed6\u65b9\u6cd5\u6765\u5e94\u5bf9\u7f13\u5b58\u96ea\u5d29\u4e86 3-3 \u5efa\u8bae\u4e00\uff1a\u662f\u5728\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u5b9e\u73b0\u670d\u52a1\u7194\u65ad\u6216\u8bf7\u6c42\u9650\u6d41\u673a\u5236 \u6240\u8c13\u7684\u670d\u52a1\u7194\u65ad\uff0c\u662f\u6307\u5728\u53d1\u751f\u7f13\u5b58\u96ea\u5d29\u65f6\uff0c\u4e3a\u4e86\u9632\u6b62\u5f15\u53d1\u8fde\u9501\u7684\u6570\u636e\u5e93\u96ea\u5d29\uff0c\u751a\u81f3\u662f\u6574\u4e2a\u7cfb\u7edf\u7684\u5d29\u6e83\uff0c \u6211\u4eec\u6682\u505c\u4e1a\u52a1\u5e94\u7528\u5bf9\u7f13\u5b58\u7cfb\u7edf\u7684\u63a5\u53e3\u8bbf\u95ee\u3002 \u518d\u5177\u4f53\u70b9\u8bf4\uff0c \u5c31\u662f\u4e1a\u52a1\u5e94\u7528\u8c03\u7528\u7f13\u5b58\u63a5\u53e3\u65f6\uff0c\u7f13\u5b58\u5ba2\u6237\u7aef\u5e76\u4e0d\u628a\u8bf7\u6c42\u53d1\u7ed9 Redis \u7f13\u5b58\u5b9e\u4f8b \uff0c\u800c\u662f\u76f4\u63a5\u8fd4\u56de\uff0c\u7b49\u5230 Redis \u7f13\u5b58\u5b9e\u4f8b\u91cd\u65b0\u6062\u590d\u670d\u52a1\u540e\uff0c\u518d\u5141\u8bb8\u5e94\u7528\u8bf7\u6c42\u53d1\u9001\u5230\u7f13\u5b58\u7cfb\u7edf\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5c31\u907f\u514d\u4e86\u5927\u91cf\u8bf7\u6c42\u56e0\u7f13\u5b58\u7f3a\u5931\uff0c\u800c\u79ef\u538b\u5230\u6570\u636e\u5e93\u7cfb\u7edf\uff0c\u4fdd\u8bc1\u4e86\u6570\u636e\u5e93\u7cfb\u7edf\u7684\u6b63\u5e38\u8fd0\u884c\u3002 \u5728\u4e1a\u52a1\u7cfb\u7edf\u8fd0\u884c\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u76d1\u6d4b Redis \u7f13\u5b58\u6240\u5728\u673a\u5668\u548c\u6570\u636e\u5e93\u6240\u5728\u673a\u5668\u7684\u8d1f\u8f7d\u6307\u6807\uff0c\u4f8b\u5982\u6bcf\u79d2\u8bf7\u6c42\u6570\u3001CPU \u5229\u7528\u7387\u3001\u5185\u5b58\u5229\u7528\u7387\u7b49\u3002\u5982\u679c\u6211\u4eec\u53d1\u73b0 Redis \u7f13\u5b58\u5b9e\u4f8b\u5b95\u673a\u4e86\uff0c\u800c\u6570\u636e\u5e93\u6240\u5728\u673a\u5668\u7684\u8d1f\u8f7d\u538b\u529b\u7a81\u7136\u589e\u52a0\uff08\u4f8b\u5982\u6bcf\u79d2\u8bf7\u6c42\u6570\u6fc0\u589e\uff09\uff0c\u6b64\u65f6\uff0c\u5c31\u53d1\u751f\u7f13\u5b58\u96ea\u5d29\u4e86\u3002 \u5927\u91cf\u8bf7\u6c42\u88ab\u53d1\u9001\u5230\u6570\u636e\u5e93\u8fdb\u884c\u5904\u7406\u3002\u6211\u4eec\u53ef\u4ee5\u542f\u52a8\u670d\u52a1\u7194\u65ad\u673a\u5236\uff0c\u6682\u505c\u4e1a\u52a1\u5e94\u7528\u5bf9\u7f13\u5b58\u670d\u52a1\u7684\u8bbf\u95ee\uff0c\u4ece\u800c\u964d\u4f4e\u5bf9\u6570\u636e\u5e93\u7684\u8bbf\u95ee\u538b\u529b\uff0c \u5982\u4e0b\u56fe\u6240\u793a\uff1a \u670d\u52a1\u7194\u65ad\u867d\u7136\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u5e93\u7684\u6b63\u5e38\u8fd0\u884c\uff0c\u4f46\u662f\u6682\u505c\u4e86\u6574\u4e2a\u7f13\u5b58\u7cfb\u7edf\u7684\u8bbf\u95ee\uff0c\u5bf9\u4e1a\u52a1\u5e94\u7528\u7684\u5f71\u54cd\u8303\u56f4\u5927\u3002 \u4e3a\u4e86\u5c3d\u53ef\u80fd\u51cf\u5c11\u8fd9\u79cd\u5f71\u54cd\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u8fdb\u884c\u8bf7\u6c42\u9650\u6d41\u3002\u8fd9\u91cc\u8bf4\u7684\u8bf7\u6c42\u9650\u6d41\uff0c\u5c31\u662f\u6307\uff0c\u6211\u4eec\u5728\u4e1a\u52a1\u7cfb\u7edf\u7684\u8bf7\u6c42\u5165\u53e3\u524d\u7aef\u63a7\u5236\u6bcf\u79d2\u8fdb\u5165\u7cfb\u7edf\u7684\u8bf7\u6c42\u6570\uff0c\u907f\u514d\u8fc7\u591a\u7684\u8bf7\u6c42\u88ab\u53d1\u9001\u5230\u6570\u636e\u5e93\u3002 \u4f60\u4e3e\u4e2a\u4f8b\u5b50\u3002\u5047\u8bbe\u4e1a\u52a1\u7cfb\u7edf\u6b63\u5e38\u8fd0\u884c\u65f6\uff0c\u8bf7\u6c42\u5165\u53e3\u524d\u7aef\u5141\u8bb8\u6bcf\u79d2\u8fdb\u5165\u7cfb\u7edf\u7684\u8bf7\u6c42\u662f 1 \u4e07\u4e2a\uff0c\u5176\u4e2d\uff0c9000 \u4e2a\u8bf7\u6c42\u90fd\u80fd\u5728\u7f13\u5b58\u7cfb\u7edf\u4e2d\u8fdb\u884c\u5904\u7406\uff0c\u53ea\u6709 1000 \u4e2a\u8bf7\u6c42\u4f1a\u88ab\u5e94\u7528\u53d1\u9001\u5230\u6570\u636e\u5e93\u8fdb\u884c\u5904\u7406\u3002 \u4e00\u65e6\u53d1\u751f\u4e86\u7f13\u5b58\u96ea\u5d29\uff0c\u6570\u636e\u5e93\u7684\u6bcf\u79d2\u8bf7\u6c42\u6570\u7a81\u7136\u589e\u52a0\u5230\u6bcf\u79d2 1 \u4e07\u4e2a\uff0c\u6b64\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u542f\u52a8\u8bf7\u6c42\u9650\u6d41\u673a\u5236\uff0c\u5728\u8bf7\u6c42\u5165\u53e3\u524d\u7aef\u53ea\u5141\u8bb8\u6bcf\u79d2\u8fdb\u5165\u7cfb\u7edf\u7684\u8bf7\u6c42\u6570\u4e3a 1000 \u4e2a\uff0c\u518d\u591a\u7684\u8bf7\u6c42\u5c31\u4f1a\u5728\u5165\u53e3\u524d\u7aef\u88ab\u76f4\u63a5\u62d2\u7edd\u670d\u52a1\u3002\u6240\u4ee5\uff0c\u4f7f\u7528\u4e86\u8bf7\u6c42\u9650\u6d41\uff0c\u5c31\u53ef\u4ee5\u907f\u514d\u5927\u91cf\u5e76\u53d1\u8bf7\u6c42\u538b\u529b\u4f20\u9012\u5230\u6570\u636e\u5e93\u5c42\u3002 3-4 \u5efa\u8bae\u4e8c\uff1a\u4e8b\u524d\u9884\u9632 \u901a\u8fc7\u4e3b\u4ece\u8282\u70b9\u7684\u65b9\u5f0f\u6784\u5efa Redis \u7f13\u5b58\u9ad8\u53ef\u9760\u96c6\u7fa4\u3002 \u5982\u679c Redis \u7f13\u5b58\u7684\u4e3b\u8282\u70b9\u6545\u969c\u5b95\u673a\u4e86\uff0c\u4ece\u8282\u70b9\u8fd8\u53ef\u4ee5\u5207\u6362\u6210\u4e3a\u4e3b\u8282\u70b9\uff0c\u7ee7\u7eed\u63d0\u4f9b\u7f13\u5b58\u670d\u52a1\uff0c\u907f\u514d\u4e86\u7531\u4e8e\u7f13\u5b58\u5b9e\u4f8b\u5b95\u673a\u800c\u5bfc\u81f4\u7684\u7f13\u5b58\u96ea\u5d29\u95ee\u9898 \u3002 \u7f13\u5b58\u96ea\u5d29\u662f\u53d1\u751f\u5728\u5927\u91cf\u6570\u636e\u540c\u65f6\u5931\u6548\u7684\u573a\u666f\u4e0b\uff0c\u548c\u7f13\u5b58\u96ea\u5d29\u76f8\u6bd4\uff0c\u7f13\u5b58\u51fb\u7a7f\u5931\u6548\u7684\u6570\u636e\u6570\u91cf\u8981\u5c0f\u5f88\u591a\u3002 4\u3001\u7f13\u5b58\u51fb\u7a7f \u7f13\u5b58\u51fb\u7a7f\u662f\u6307\uff0c\u9488\u5bf9\u67d0\u4e2a\u8bbf\u95ee\u975e\u5e38\u9891\u7e41\u7684\u70ed\u70b9\u6570\u636e\u7684\u8bf7\u6c42\uff0c\u65e0\u6cd5\u5728\u7f13\u5b58\u4e2d\u8fdb\u884c\u5904\u7406\uff0c\u7d27\u63a5\u7740\uff0c\u8bbf\u95ee\u8be5\u6570\u636e\u7684\u5927\u91cf\u8bf7\u6c42\uff0c\u4e00\u4e0b\u5b50\u90fd\u53d1\u9001\u5230\u4e86\u540e\u7aef\u6570\u636e\u5e93\uff0c \u5bfc\u81f4\u4e86\u6570\u636e\u5e93\u538b\u529b\u6fc0\u589e\uff0c\u4f1a\u5f71\u54cd\u6570\u636e\u5e93\u5904\u7406\u5176\u4ed6\u8bf7\u6c42 \u3002 \u7f13\u5b58\u51fb\u7a7f\u7684\u60c5\u51b5\uff0c\u7ecf\u5e38\u53d1\u751f\u5728\u70ed\u70b9\u6570\u636e\u8fc7\u671f\u5931\u6548\u65f6 \uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u4e3a\u4e86\u907f\u514d\u7f13\u5b58\u51fb\u7a7f\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u7684\u6fc0\u589e\u538b\u529b\uff0c\u89e3\u51b3\u65b9\u6cd5\u4e5f\u6bd4\u8f83\u76f4\u63a5\uff0c \u5bf9\u4e8e\u8bbf\u95ee\u7279\u522b\u9891\u7e41\u7684\u70ed\u70b9\u6570\u636e\uff0c\u6211\u4eec\u5c31\u4e0d\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u4e86 \u5bf9\u70ed\u70b9\u6570\u636e\u7684\u8bbf\u95ee\u8bf7\u6c42\uff0c\u90fd\u53ef\u4ee5\u5728\u7f13\u5b58\u4e2d\u8fdb\u884c\u5904\u7406\uff0c\u800c Redis \u6570\u4e07\u7ea7\u522b\u7684\u9ad8\u541e\u5410\u91cf\u53ef\u4ee5\u5f88\u597d\u5730\u5e94\u5bf9\u5927\u91cf\u7684\u5e76\u53d1\u8bf7\u6c42\u8bbf\u95ee\u3002 5\u3001\u7f13\u5b58\u7a7f\u900f \u7f13\u5b58\u7a7f\u900f\u662f\u6307\u8981\u8bbf\u95ee\u7684\u6570\u636e\u65e2 \u4e0d\u5728 Redis \u7f13\u5b58\u4e2d\uff0c\u4e5f\u4e0d\u5728\u6570\u636e\u5e93\u4e2d\uff0c\u5bfc\u81f4\u8bf7\u6c42\u5728\u8bbf\u95ee\u7f13\u5b58\u65f6\uff0c\u53d1\u751f\u7f13\u5b58\u7f3a\u5931 \uff0c\u518d\u53bb\u8bbf\u95ee\u6570\u636e\u5e93\u65f6\uff0c\u53d1\u73b0\u6570\u636e\u5e93\u4e2d\u4e5f\u6ca1\u6709\u8981\u8bbf\u95ee\u7684\u6570\u636e \u5e94\u7528\u4e5f\u65e0\u6cd5\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\u518d\u5199\u5165\u7f13\u5b58\uff0c\u6765\u670d\u52a1\u540e\u7eed\u8bf7\u6c42\uff0c\u8fd9\u6837\u4e00\u6765\uff0c \u7f13\u5b58\u4e5f\u5c31\u6210\u4e86\u201c\u6446\u8bbe\u201d\uff0c\u5982\u679c\u5e94\u7528\u6301\u7eed\u6709\u5927\u91cf\u8bf7\u6c42\u8bbf\u95ee\u6570\u636e\uff0c\u5c31\u4f1a\u540c\u65f6\u7ed9\u7f13\u5b58\u548c\u6570\u636e\u5e93\u5e26\u6765\u5de8\u5927\u538b\u529b \u7f13\u5b58\u7a7f\u900f\u4f1a\u53d1\u751f\u5728\u4ec0\u4e48\u65f6\u5019\u5462\uff1f\u4e00\u822c\u6765\u8bf4\uff0c\u6709\u4e24\u79cd\u60c5\u51b5\u3002 \u4e1a\u52a1\u5c42\u8bef\u64cd\u4f5c\uff1a\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u88ab\u8bef\u5220\u9664\u4e86\uff0c\u6240\u4ee5\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u90fd\u6ca1\u6709\u6570\u636e\uff1b \u6076\u610f\u653b\u51fb\uff1a\u4e13\u95e8\u8bbf\u95ee\u6570\u636e\u5e93\u4e2d\u6ca1\u6709\u7684\u6570\u636e\u3002 5-1 \u65b9\u6848\u4e00\uff1a\u7f13\u5b58\u7a7a\u503c\u6216\u7f3a\u7701\u503c \u4e00\u65e6\u53d1\u751f\u7f13\u5b58\u7a7f\u900f\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u9488\u5bf9\u67e5\u8be2\u7684\u6570\u636e\uff0c \u5728 Redis \u4e2d\u7f13\u5b58\u4e00\u4e2a\u7a7a\u503c\u6216\u662f\u548c\u4e1a\u52a1\u5c42\u534f\u5546\u786e\u5b9a\u7684\u7f3a\u7701\u503c\uff08\u4f8b\u5982\uff0c\u5e93\u5b58\u7684\u7f3a\u7701\u503c\u53ef\u4ee5\u8bbe\u4e3a 0\uff09\u3002 \u7d27\u63a5\u7740\uff0c \u5e94\u7528\u53d1\u9001\u7684\u540e\u7eed\u8bf7\u6c42\u518d\u8fdb\u884c\u67e5\u8be2\u65f6\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u4ece Redis \u4e2d\u8bfb\u53d6\u7a7a\u503c\u6216\u7f3a\u7701\u503c \uff0c\u8fd4\u56de\u7ed9\u4e1a\u52a1\u5e94\u7528\u4e86\uff0c\u907f\u514d\u4e86\u628a\u5927\u91cf\u8bf7\u6c42\u53d1\u9001\u7ed9\u6570\u636e\u5e93\u5904\u7406\uff0c\u4fdd\u6301\u4e86\u6570\u636e\u5e93\u7684\u6b63\u5e38\u8fd0\u884c\u3002 5-2 \u65b9\u6848\u4e8c \u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u5feb\u901f\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728 \u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u5feb\u901f\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728\uff0c\u907f\u514d\u4ece\u6570\u636e\u5e93\u4e2d\u67e5\u8be2\u6570\u636e\u662f\u5426\u5b58\u5728\uff0c\u51cf\u8f7b\u6570\u636e\u5e93\u538b\u529b\u3002 \u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u5feb\u901f\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728 \u5e03\u9686\u8fc7\u6ee4\u5668\u7531\u4e00\u4e2a\u521d\u503c\u90fd\u4e3a 0 \u7684 bit \u6570\u7ec4\u548c N \u4e2a\u54c8\u5e0c\u51fd\u6570\u7ec4\u6210\uff0c\u53ef\u4ee5\u7528\u6765\u5feb\u901f\u5224\u65ad\u67d0\u4e2a\u6570\u636e\u662f\u5426\u5b58\u5728\u3002\u5f53\u6211\u4eec\u60f3\u6807\u8bb0\u67d0\u4e2a\u6570\u636e\u5b58\u5728\u65f6\uff08\u4f8b\u5982\uff0c\u6570\u636e\u5df2\u88ab\u5199\u5165\u6570\u636e\u5e93\uff09\uff0c\u5e03\u9686\u8fc7\u6ee4\u5668\u4f1a\u901a\u8fc7\u4e09\u4e2a\u64cd\u4f5c\u5b8c\u6210\u6807\u8bb0\uff1a \u9996\u5148\uff0c\u4f7f\u7528 N \u4e2a\u54c8\u5e0c\u51fd\u6570\uff0c\u5206\u522b\u8ba1\u7b97\u8fd9\u4e2a\u6570\u636e\u7684\u54c8\u5e0c\u503c\uff0c\u5f97\u5230 N \u4e2a\u54c8\u5e0c\u503c\u3002 \u7136\u540e\uff0c\u6211\u4eec\u628a\u8fd9 N \u4e2a\u54c8\u5e0c\u503c\u5bf9 bit \u6570\u7ec4\u7684\u957f\u5ea6\u53d6\u6a21\uff0c\u5f97\u5230\u6bcf\u4e2a\u54c8\u5e0c\u503c\u5728\u6570\u7ec4\u4e2d\u7684\u5bf9\u5e94\u4f4d\u7f6e\u3002 \u6700\u540e\uff0c\u6211\u4eec\u628a\u5bf9\u5e94\u4f4d\u7f6e\u7684 bit \u4f4d\u8bbe\u7f6e\u4e3a 1\uff0c\u8fd9\u5c31\u5b8c\u6210\u4e86\u5728\u5e03\u9686\u8fc7\u6ee4\u5668\u4e2d\u6807\u8bb0\u6570\u636e\u7684\u64cd\u4f5c\u3002 \u5982\u679c\u6570\u636e\u4e0d\u5b58\u5728\uff08\u4f8b\u5982\uff0c\u6570\u636e\u5e93\u91cc\u6ca1\u6709\u5199\u5165\u6570\u636e\uff09\uff0c\u6211\u4eec\u4e5f\u5c31\u6ca1\u6709\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u6807\u8bb0\u8fc7\u6570\u636e\uff0c\u90a3\u4e48\uff0cbit \u6570\u7ec4\u5bf9\u5e94 bit \u4f4d\u7684\u503c\u4ecd\u7136\u4e3a 0\u3002 \u5f53\u9700\u8981\u67e5\u8be2\u67d0\u4e2a\u6570\u636e\u65f6\uff0c\u6211\u4eec\u5c31\u6267\u884c\u521a\u521a\u8bf4\u7684\u8ba1\u7b97\u8fc7\u7a0b\uff0c\u5148\u5f97\u5230\u8fd9\u4e2a\u6570\u636e\u5728 bit \u6570\u7ec4\u4e2d\u5bf9\u5e94\u7684 N \u4e2a\u4f4d\u7f6e\u3002\u7d27\u63a5\u7740\uff0c\u6211\u4eec\u67e5\u770b bit \u6570\u7ec4\u4e2d\u8fd9 N \u4e2a\u4f4d\u7f6e\u4e0a\u7684 bit \u503c\u3002\u53ea\u8981\u8fd9 N \u4e2a bit \u503c\u6709\u4e00\u4e2a\u4e0d\u4e3a 1\uff0c\u8fd9\u5c31\u8868\u660e\u5e03\u9686\u8fc7\u6ee4\u5668\u6ca1\u6709\u5bf9\u8be5\u6570\u636e\u505a\u8fc7\u6807\u8bb0\uff0c\u6240\u4ee5\uff0c\u67e5\u8be2\u7684\u6570\u636e\u4e00\u5b9a\u6ca1\u6709\u5728\u6570\u636e\u5e93\u4e2d\u4fdd\u5b58\u3002 \u6b63\u662f\u57fa\u4e8e\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u5feb\u901f\u68c0\u6d4b\u7279\u6027\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u628a\u6570\u636e\u5199\u5165\u6570\u636e\u5e93\u65f6\uff0c\u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u505a\u4e2a\u6807\u8bb0\u3002\u5f53\u7f13\u5b58\u7f3a\u5931\u540e\uff0c\u5e94\u7528\u67e5\u8be2\u6570\u636e\u5e93\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u67e5\u8be2\u5e03\u9686\u8fc7\u6ee4\u5668\u5feb\u901f\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728\u3002\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5c31\u4e0d\u7528\u518d\u53bb\u6570\u636e\u5e93\u4e2d\u67e5\u8be2\u4e86\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u53d1\u751f\u7f13\u5b58\u7a7f\u900f\u4e86\uff0c\u5927\u91cf\u8bf7\u6c42\u53ea\u4f1a\u67e5\u8be2 Redis \u548c\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u800c\u4e0d\u4f1a\u79ef\u538b\u5230\u6570\u636e\u5e93\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u5f71\u54cd\u6570\u636e\u5e93\u7684\u6b63\u5e38\u8fd0\u884c\u3002\u5e03\u9686\u8fc7\u6ee4\u5668\u53ef\u4ee5\u4f7f\u7528 Redis \u5b9e\u73b0\uff0c\u672c\u8eab\u5c31\u80fd\u627f\u62c5\u8f83\u5927\u7684\u5e76\u53d1\u8bbf\u95ee\u538b\u529b\u3002 5-2 \u65b9\u6848\u4e09 \u8bf7\u6c42\u5165\u53e3\u7684\u524d\u7aef\u8fdb\u884c\u8bf7\u6c42\u68c0\u6d4b \u7f13\u5b58\u7a7f\u900f\u7684\u4e00\u4e2a\u539f\u56e0\u662f\u6709\u5927\u91cf\u7684\u6076\u610f\u8bf7\u6c42\u8bbf\u95ee\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u6240\u4ee5\uff0c\u4e00\u4e2a\u6709\u6548\u7684\u5e94\u5bf9\u65b9\u6848\u662f\u5728\u8bf7\u6c42\u5165\u53e3\u524d\u7aef\uff0c\u5bf9\u4e1a\u52a1\u7cfb\u7edf\u63a5\u6536\u5230\u7684\u8bf7\u6c42\u8fdb\u884c\u5408\u6cd5\u6027\u68c0\u6d4b \uff0c\u628a\u6076\u610f\u7684\u8bf7\u6c42\uff08\u4f8b\u5982\u8bf7\u6c42\u53c2\u6570\u4e0d\u5408\u7406\u3001\u8bf7\u6c42\u53c2\u6570\u662f\u975e\u6cd5\u503c\u3001\u8bf7\u6c42\u5b57\u6bb5\u4e0d\u5b58\u5728\uff09\u76f4\u63a5\u8fc7\u6ee4\u6389\uff0c\u4e0d\u8ba9\u5b83\u4eec\u8bbf\u95ee\u540e\u7aef\u7f13\u5b58\u548c\u6570\u636e\u5e93\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u51fa\u73b0\u7f13\u5b58\u7a7f\u900f\u95ee\u9898\u4e86\u3002 \u8ddf\u7f13\u5b58\u96ea\u5d29\u3001\u7f13\u5b58\u51fb\u7a7f\u8fd9\u4e24\u7c7b\u95ee\u9898\u76f8\u6bd4\uff0c\u7f13\u5b58\u7a7f\u900f\u7684\u5f71\u54cd\u66f4\u5927\u4e00\u4e9b \u4ece\u9884\u9632\u7684\u89d2\u5ea6\u6765\u8bf4\uff0c\u6211\u4eec\u9700\u8981\u907f\u514d\u8bef\u5220\u9664\u6570\u636e\u5e93\u548c\u7f13\u5b58\u4e2d\u7684\u6570\u636e\uff1b \u4ece\u5e94\u5bf9\u89d2\u5ea6\u6765\u8bf4\uff0c \u6211\u4eec\u53ef\u4ee5\u5728\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u4f7f\u7528\u7f13\u5b58\u7a7a\u503c\u6216\u7f3a\u7701\u503c\u3001\u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u4ee5\u53ca\u8fdb\u884c\u6076\u610f\u8bf7\u6c42\u68c0\u6d4b\u7b49\u65b9\u6cd5 \u3002 \u672c\u8282\u5c0f\u7ed3 \u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u6700\u5e38\u9047\u89c1\u7684\u4e00\u4e2a\u95ee\u9898\uff0c\u4e5f\u5c31\u662f\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e0d\u4e00\u81f4\u7684\u95ee\u9898 \u5bf9\u4e8e\u8bfb\u5199\u7f13\u5b58\u6765\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u91c7\u7528\u540c\u6b65\u5199\u56de\u7b56\u7565\uff0c\u90a3\u4e48\u53ef\u4ee5\u4fdd\u8bc1\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u4e00\u81f4\u3002 \u5728\u5927\u591a\u6570\u4e1a\u52a1\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u4f1a\u628a Redis \u4f5c\u4e3a\u53ea\u8bfb\u7f13\u5b58\u4f7f\u7528 \u9488\u5bf9\u53ea\u8bfb\u7f13\u5b58\u6765\u8bf4\uff0c\u6211\u4eec\u65e2\u53ef\u4ee5\u5148\u5220\u9664\u7f13\u5b58\u503c\u518d\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u4e5f\u53ef\u4ee5\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u9664\u7f13\u5b58\u3002\u6211\u7684\u5efa\u8bae\u662f\uff0c \u4f18\u5148\u4f7f\u7528\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u9664\u7f13\u5b58\u7684\u65b9\u6cd5 \uff0c\u539f\u56e0\u4e3b\u8981\u6709\u4e24\u4e2a\uff1a \u5148\u5220\u9664\u7f13\u5b58\u503c\u518d\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u6709\u53ef\u80fd\u5bfc\u81f4\u8bf7\u6c42\u56e0\u7f13\u5b58\u7f3a\u5931\u800c\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u538b\u529b\uff1b \u5982\u679c\u4e1a\u52a1\u5e94\u7528\u4e2d\u8bfb\u53d6\u6570\u636e\u5e93\u548c\u5199\u7f13\u5b58\u7684\u65f6\u95f4\u4e0d\u597d\u4f30\u7b97\uff0c\u90a3\u4e48\uff0c\u5ef6\u8fdf\u53cc\u5220\u4e2d\u7684\u7b49\u5f85\u65f6\u95f4\u5c31\u4e0d\u597d\u8bbe\u7f6e\u3002 \u4e0d\u8fc7\uff0c\u5f53\u4f7f\u7528\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u9664\u7f13\u5b58\u65f6\uff0c\u4e5f\u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\uff0c \u5982\u679c\u4e1a\u52a1\u5c42\u8981\u6c42\u5fc5\u987b\u8bfb\u53d6\u4e00\u81f4\u7684\u6570\u636e\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5728\u66f4\u65b0\u6570\u636e\u5e93\u65f6\uff0c\u5148\u5728 Redis \u7f13\u5b58\u5ba2\u6237\u7aef\u6682\u5b58\u5e76\u53d1\u8bfb\u8bf7\u6c42\uff0c\u7b49\u6570\u636e\u5e93\u66f4\u65b0\u5b8c\u3001\u7f13\u5b58\u503c\u5220\u9664\u540e\uff0c\u518d\u8bfb\u53d6\u6570\u636e\uff0c\u4ece\u800c\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027 \u3002 \u7f13\u5b58\u96ea\u5d29\u548c\u51fb\u7a7f\u4e3b\u8981\u662f\u56e0\u4e3a\u6570\u636e\u4e0d\u5728\u7f13\u5b58\u4e2d\u4e86\uff0c\u800c\u7f13\u5b58\u7a7f\u900f\u5219\u662f\u56e0\u4e3a\u6570\u636e\u65e2\u4e0d\u5728\u7f13\u5b58\u4e2d\uff0c\u4e5f\u4e0d\u5728\u6570\u636e\u5e93\u4e2d\u3002 \u6240\u4ee5\uff0c\u7f13\u5b58\u96ea\u5d29\u6216\u51fb\u7a7f\u65f6\uff0c \u4e00\u65e6\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u88ab\u518d\u6b21\u5199\u5165\u5230\u7f13\u5b58\u540e\uff0c\u5e94\u7528\u53c8\u53ef\u4ee5\u5728\u7f13\u5b58\u4e2d\u5feb\u901f\u8bbf\u95ee\u6570\u636e\u4e86 \uff0c\u6570\u636e\u5e93\u7684\u538b\u529b\u4e5f\u4f1a\u76f8\u5e94\u5730\u964d\u4f4e\u4e0b\u6765 \u800c\u7f13\u5b58\u7a7f\u900f\u53d1\u751f\u65f6 \uff0cRedis \u7f13\u5b58\u548c\u6570\u636e\u5e93\u4f1a\u540c\u65f6\u6301\u7eed\u627f\u53d7\u8bf7\u6c42\u538b\u529b\u3002 \u670d\u52a1\u7194\u65ad\u3001\u670d\u52a1\u964d\u7ea7\u3001\u8bf7\u6c42\u9650\u6d41\u8fd9\u4e9b\u65b9\u6cd5\u90fd\u662f\u5c5e\u4e8e\u201c\u6709\u635f\u201d\u65b9\u6848\uff0c\u5728\u4fdd\u8bc1\u6570\u636e\u5e93\u548c\u6574\u4f53\u7cfb\u7edf\u7a33\u5b9a\u7684\u540c\u65f6\uff0c\u4f1a\u5bf9\u4e1a\u52a1\u5e94\u7528\u5e26\u6765\u8d1f\u9762\u5f71\u54cd\u3002 \u4f8b\u5982\u4f7f\u7528\u670d\u52a1\u964d\u7ea7\u65f6\uff0c\u6709\u90e8\u5206\u6570\u636e\u7684\u8bf7\u6c42\u5c31\u53ea\u80fd\u5f97\u5230\u9519\u8bef\u8fd4\u56de\u4fe1\u606f\uff0c\u65e0\u6cd5\u6b63\u5e38\u5904\u7406\u3002\u5982\u679c\u4f7f\u7528\u4e86\u670d\u52a1\u7194\u65ad\uff0c\u90a3\u4e48\uff0c\u6574\u4e2a\u7f13\u5b58\u7cfb\u7edf\u7684\u670d\u52a1\u90fd\u88ab\u6682\u505c\u4e86\uff0c\u5f71\u54cd\u7684\u4e1a\u52a1\u8303\u56f4\u66f4\u5927\u3002\u800c\u4f7f\u7528\u4e86\u8bf7\u6c42\u9650\u6d41\u673a\u5236\u540e\uff0c\u6574\u4e2a\u4e1a\u52a1\u7cfb\u7edf\u7684\u541e\u5410\u7387\u4f1a\u964d\u4f4e\uff0c\u80fd\u5e76\u53d1\u5904\u7406\u7684\u7528\u6237\u8bf7\u6c42\u4f1a\u51cf\u5c11\uff0c\u4f1a\u5f71\u54cd\u5230\u7528\u6237\u4f53\u9a8c \u5c3d\u91cf\u4f7f\u7528\u9884\u9632\u5f0f\u65b9\u6848\uff1a \u9488\u5bf9\u7f13\u5b58\u96ea\u5d29\uff0c\u5408\u7406\u5730\u8bbe\u7f6e\u6570\u636e\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u53ca\u642d\u5efa\u9ad8\u53ef\u9760\u7f13\u5b58\u96c6\u7fa4 \uff1b \u9488\u5bf9\u7f13\u5b58\u51fb\u7a7f\uff0c\u5728\u7f13\u5b58\u8bbf\u95ee\u975e\u5e38\u9891\u7e41\u7684\u70ed\u70b9\u6570\u636e\u65f6\uff0c\u4e0d\u8981\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff1b \u9488\u5bf9\u7f13\u5b58\u7a7f\u900f\uff0c\u63d0\u524d\u5728\u5165\u53e3\u524d\u7aef\u5b9e\u73b0\u6076\u610f\u8bf7\u6c42\u68c0\u6d4b\uff0c\u6216\u8005\u89c4\u8303\u6570\u636e\u5e93\u7684\u6570\u636e\u5220\u9664\u64cd\u4f5c\uff0c\u907f\u514d\u8bef\u5220\u9664\u3002","title":"\u7b2c\u4e09\u8282 \u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u7f13\u5b58\u5f02\u5e38"},{"location":"chap5/3redis_mysql_uncon/#_1","text":"Redis \u7f13\u5b58\u65f6\u7684\u5f02\u5e38\u95ee\u9898\uff0c\u6982\u62ec\u6765\u8bf4\u6709 4 \u4e2a\u65b9\u9762\uff1a \u7f13\u5b58\u4e2d\u7684\u6570\u636e\u548c\u6570\u636e\u5e93\u4e2d\u7684\u4e0d\u4e00\u81f4\uff1b \u7f13\u5b58\u96ea\u5d29\uff1b \u7f13\u5b58\u51fb\u7a7f\u548c\u7f13\u5b58\u7a7f\u900f\u3002 \u53ea\u8981\u6211\u4eec\u4f7f\u7528 Redis \u7f13\u5b58\uff0c\u5c31\u5fc5\u7136\u4f1a\u9762\u5bf9\u7f13\u5b58\u548c\u6570\u636e\u5e93\u95f4\u7684\u4e00\u81f4\u6027\u4fdd\u8bc1\u95ee\u9898\uff0c\u5982\u679c\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u90a3\u4e48\u4e1a\u52a1\u5e94\u7528\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u7684\u6570\u636e\u5c31\u4e0d\u662f\u6700\u65b0\u6570\u636e\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u4e25\u91cd\u7684\u9519\u8bef\u3002 \u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u628a\u7535\u5546\u5546\u54c1\u7684\u5e93\u5b58\u4fe1\u606f\u7f13\u5b58\u5728 Redis \u4e2d\uff0c\u5982\u679c\u5e93\u5b58\u4fe1\u606f\u4e0d\u5bf9\uff0c\u90a3\u4e48\u4e1a\u52a1\u5c42\u4e0b\u5355\u64cd\u4f5c\u5c31\u53ef\u80fd\u51fa\u9519\uff0c\u8fd9\u5f53\u7136\u662f\u4e0d\u80fd\u63a5\u53d7\u7684\u3002","title":"\u7b2c\u4e09\u8282 \u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u7f13\u5b58\u5f02\u5e38"},{"location":"chap5/3redis_mysql_uncon/#1","text":"\u7f13\u5b58\u4e2d\u6709\u6570\u636e\uff0c\u90a3\u4e48\uff0c\u7f13\u5b58\u7684\u6570\u636e\u503c\u9700\u8981\u548c\u6570\u636e\u5e93\u4e2d\u7684\u503c\u76f8\u540c\uff1b \u7f13\u5b58\u4e2d\u672c\u8eab\u6ca1\u6709\u6570\u636e\uff0c\u90a3\u4e48\uff0c\u6570\u636e\u5e93\u4e2d\u7684\u503c\u5fc5\u987b\u662f\u6700\u65b0\u503c\u3002 \u4e0d\u7b26\u5408\u8fd9\u4e24\u79cd\u60c5\u51b5\u7684\uff0c\u5c31\u5c5e\u4e8e\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\u4e86\u3002 \u4e0d\u8fc7\uff0c\u5f53\u7f13\u5b58\u7684\u8bfb\u5199\u6a21\u5f0f\u4e0d\u540c\u65f6\uff0c\u7f13\u5b58\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u53d1\u751f\u60c5\u51b5\u4e0d\u4e00\u6837\uff0c\u6211\u4eec\u7684\u5e94\u5bf9\u65b9\u6cd5\u4e5f\u4f1a\u6709\u6240\u4e0d\u540c\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5148\u6309\u7167\u7f13\u5b58\u8bfb\u5199\u6a21\u5f0f\uff0c\u6765\u5206\u522b\u4e86\u89e3\u4e0b\u4e0d\u540c\u6a21\u5f0f\u4e0b\u7684\u7f13\u5b58\u4e0d\u4e00\u81f4\u60c5\u51b5 \u6839\u636e\u662f\u5426\u63a5\u6536\u5199\u8bf7\u6c42\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u7f13\u5b58\u5206\u6210\u8bfb\u5199\u7f13\u5b58\u548c\u53ea\u8bfb\u7f13\u5b58\u3002","title":"1\u3001\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u662f\u5982\u4f55\u53d1\u751f\u7684\uff1f"},{"location":"chap5/3redis_mysql_uncon/#1-1","text":"\u5bf9\u4e8e\u8bfb\u5199\u7f13\u5b58\u6765\u8bf4\uff0c\u5982\u679c\u8981\u5bf9\u6570\u636e\u8fdb\u884c\u589e\u5220\u6539\uff0c\u5c31\u9700\u8981\u5728\u7f13\u5b58\u4e2d\u8fdb\u884c\uff0c\u540c\u65f6\u8fd8\u8981\u6839\u636e\u91c7\u53d6\u7684\u5199\u56de\u7b56\u7565\uff0c\u51b3\u5b9a\u662f\u5426\u540c\u6b65\u5199\u56de\u5230\u6570\u636e\u5e93\u4e2d\u3002 \u540c\u6b65\u76f4\u5199\u7b56\u7565\uff1a\u5199\u7f13\u5b58\u65f6\uff0c\u4e5f\u540c\u6b65\u5199\u6570\u636e\u5e93\uff0c\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u4e00\u81f4\uff1b \u5f02\u6b65\u5199\u56de\u7b56\u7565\uff1a\u5199\u7f13\u5b58\u65f6\u4e0d\u540c\u6b65\u5199\u6570\u636e\u5e93\uff0c\u7b49\u5230\u6570\u636e\u4ece\u7f13\u5b58\u4e2d\u6dd8\u6c70\u65f6\uff0c\u518d\u5199\u56de\u6570\u636e\u5e93\u3002\u4f7f\u7528\u8fd9\u79cd\u7b56\u7565\u65f6\uff0c\u5982\u679c\u6570\u636e\u8fd8\u6ca1\u6709\u5199\u56de\u6570\u636e\u5e93\uff0c\u7f13\u5b58\u5c31\u53d1\u751f\u4e86\u6545\u969c\uff0c\u90a3\u4e48\uff0c\u6b64\u65f6\uff0c\u6570\u636e\u5e93\u5c31\u6ca1\u6709\u6700\u65b0\u7684\u6570\u636e\u4e86\u3002 \u6240\u4ee5\uff0c\u5bf9\u4e8e\u8bfb\u5199\u7f13\u5b58\u6765\u8bf4\uff0c\u8981\u60f3\u4fdd\u8bc1\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u4e00\u81f4\uff0c\u5c31\u8981\u91c7\u7528\u540c\u6b65\u76f4\u5199\u7b56\u7565\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u91c7\u7528\u8fd9\u79cd\u7b56\u7565\uff0c\u5c31\u9700\u8981\u540c\u65f6\u66f4\u65b0\u7f13\u5b58\u548c\u6570\u636e\u5e93 \u3002\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u5728\u4e1a\u52a1\u5e94\u7528\u4e2d\u4f7f\u7528\u4e8b\u52a1\u673a\u5236\uff0c\u6765\u4fdd\u8bc1\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u66f4\u65b0\u5177\u6709\u539f\u5b50\u6027\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e24\u8005\u8981\u4e0d\u4e00\u8d77\u66f4\u65b0\uff0c\u8981\u4e0d\u90fd\u4e0d\u66f4\u65b0\uff0c\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\uff0c\u8fdb\u884c\u91cd\u8bd5\u3002\u5426\u5219\uff0c\u6211\u4eec\u5c31\u65e0\u6cd5\u5b9e\u73b0\u540c\u6b65\u76f4\u5199\u3002 \u5728\u6709\u4e9b\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u5bf9 \u6570\u636e\u4e00\u81f4\u6027\u7684\u8981\u6c42\u53ef\u80fd\u4e0d\u662f\u90a3\u4e48\u9ad8 \uff0c\u6bd4\u5982\u8bf4\u7f13\u5b58\u7684\u662f\u7535\u5546\u5546\u54c1\u7684\u975e\u5173\u952e\u5c5e\u6027\u6216\u8005\u77ed\u89c6\u9891\u7684\u521b\u5efa\u6216\u4fee\u6539\u65f6\u95f4\u7b49\uff0c\u90a3\u4e48\uff0c \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5f02\u6b65\u5199\u56de\u7b56\u7565 \u3002","title":"1-1 \u8bfb\u5199\u7f13\u5b58"},{"location":"chap5/3redis_mysql_uncon/#1-2","text":"\u5bf9\u4e8e\u53ea\u8bfb\u7f13\u5b58\u6765\u8bf4\uff0c\u5982\u679c\u6709\u6570\u636e\u65b0\u589e\uff0c\u4f1a\u76f4\u63a5\u5199\u5165\u6570\u636e\u5e93\uff1b \u800c\u6709\u6570\u636e\u5220\u6539\u65f6\uff0c\u5c31\u9700\u8981\u628a\u53ea\u8bfb\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u6807\u8bb0\u4e3a\u65e0\u6548\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5e94\u7528\u540e\u7eed\u518d\u8bbf\u95ee\u8fd9\u4e9b\u589e\u5220\u6539\u7684\u6570\u636e\u65f6\uff0c\u56e0\u4e3a\u7f13\u5b58\u4e2d\u6ca1\u6709\u76f8\u5e94\u7684\u6570\u636e\uff0c\u5c31\u4f1a\u53d1\u751f\u7f13\u5b58\u7f3a\u5931 \u3002 \u6b64\u65f6\uff0c\u5e94\u7528\u518d\u4ece\u6570\u636e\u5e93\u4e2d\u628a\u6570\u636e\u8bfb\u5165\u7f13\u5b58\uff0c\u8fd9\u6837\u540e\u7eed\u518d\u8bbf\u95ee\u6570\u636e\u65f6\uff0c\u5c31\u80fd\u591f\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u4e86\u3002 Tomcat \u5411 MySQL \u4e2d\u5199\u5165\u548c\u5220\u6539\u6570\u636e \uff0cTomcat \u4e0a\u8fd0\u884c\u7684\u5e94\u7528\uff0c\u65e0\u8bba\u662f\u65b0\u589e\uff08Insert \u64cd\u4f5c\uff09\u3001\u4fee\u6539\uff08Update \u64cd\u4f5c\uff09\u3001\u8fd8\u662f\u5220\u9664\uff08Delete \u64cd\u4f5c\uff09\u6570\u636e X\uff0c\u90fd\u4f1a\u76f4\u63a5\u5728\u6570\u636e\u5e93\u4e2d\u589e\u6539\u5220\u3002 \u5f53\u7136\uff0c\u5982\u679c\u5e94\u7528\u6267\u884c\u7684\u662f\u4fee\u6539\u6216\u5220\u9664\u64cd\u4f5c\uff0c\u8fd8\u4f1a\u5220\u9664\u7f13\u5b58\u7684\u6570\u636e X\u3002","title":"1-2 \u53ea\u8bfb\u7f13\u5b58"},{"location":"chap5/3redis_mysql_uncon/#1-2-1","text":"\u5982\u679c\u662f\u65b0\u589e\u6570\u636e\uff0c\u6570\u636e\u4f1a\u76f4\u63a5\u5199\u5230\u6570\u636e\u5e93\u4e2d\uff0c\u4e0d\u7528\u5bf9\u7f13\u5b58\u505a\u4efb\u4f55\u64cd\u4f5c\uff0c\u6b64\u65f6\uff0c\u7f13\u5b58\u4e2d\u672c\u8eab\u5c31\u6ca1\u6709\u65b0\u589e\u6570\u636e\uff0c\u800c\u6570\u636e\u5e93\u4e2d\u662f\u6700\u65b0\u503c\uff0c\u8fd9\u79cd\u60c5\u51b5\u7b26\u5408\u6211\u4eec\u521a\u521a\u6240\u8bf4\u7684\u4e00\u81f4\u6027\u7684\u7b2c 2 \u79cd\u60c5\u51b5\uff0c\u6240\u4ee5\uff0c\u6b64\u65f6\uff0c\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684","title":"1-2-1 \u65b0\u589e\u6570\u636e"},{"location":"chap5/3redis_mysql_uncon/#1-2-2","text":"\u5982\u679c\u53d1\u751f\u5220\u6539\u64cd\u4f5c\uff0c\u5e94\u7528\u65e2\u8981\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u4e5f\u8981\u5728\u7f13\u5b58\u4e2d\u5220\u9664\u6570\u636e\u3002\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u5982\u679c\u65e0\u6cd5\u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8981\u4e0d\u90fd\u5b8c\u6210\uff0c\u8981\u4e0d\u90fd\u6ca1\u5b8c\u6210 \uff0c\u6b64\u65f6\uff0c\u5c31\u4f1a\u51fa\u73b0\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\u4e86\u3002\u8fd9\u4e2a\u95ee\u9898\u6bd4\u8f83\u590d\u6742\uff0c\u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\u3002 \u6211\u4eec\u5047\u8bbe\u5e94\u7528\u5148\u5220\u9664\u7f13\u5b58\uff0c\u518d\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u5982\u679c\u7f13\u5b58\u5220\u9664\u6210\u529f\uff0c\u4f46\u662f\u6570\u636e\u5e93\u66f4\u65b0\u5931\u8d25\uff0c\u90a3\u4e48\uff0c\u5e94\u7528\u518d\u8bbf\u95ee\u6570\u636e\u65f6\uff0c\u7f13\u5b58\u4e2d\u6ca1\u6709\u6570\u636e\uff0c\u5c31\u4f1a\u53d1\u751f\u7f13\u5b58\u7f3a\u5931 \u7136\u540e\uff0c\u5e94\u7528\u518d\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u4f46\u662f\u6570\u636e\u5e93\u4e2d\u7684\u503c\u4e3a\u65e7\u503c\uff0c\u5e94\u7528\u5c31\u8bbf\u95ee\u5230\u65e7\u503c\u4e86\u3002 \u5e94\u7528\u8981\u628a\u6570\u636e X \u7684\u503c\u4ece 10 \u66f4\u65b0\u4e3a 3\uff0c\u5148\u5728 Redis \u7f13\u5b58\u4e2d\u5220\u9664\u4e86 X \u7684\u7f13\u5b58\u503c\uff0c\u4f46\u662f\u66f4\u65b0\u6570\u636e\u5e93\u5374\u5931\u8d25\u4e86\u3002 \u5982\u679c\u6b64\u65f6\u6709\u5176\u4ed6\u5e76\u53d1\u7684\u8bf7\u6c42\u8bbf\u95ee X\uff0c\u4f1a\u53d1\u73b0 Redis \u4e2d\u7f13\u5b58\u7f3a\u5931\uff0c\u7d27\u63a5\u7740\uff0c\u8bf7\u6c42\u5c31\u4f1a\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u8bfb\u5230\u7684\u5374\u662f\u65e7\u503c 10\u3002 \u5982\u679c\u5e94\u7528\u5148\u5b8c\u6210\u4e86\u6570\u636e\u5e93\u7684\u66f4\u65b0\uff0c\u4f46\u662f\uff0c\u5728\u5220\u9664\u7f13\u5b58\u65f6\u5931\u8d25\u4e86\uff0c\u90a3\u4e48\uff0c\u6570\u636e\u5e93\u4e2d\u7684\u503c\u662f\u65b0\u503c\uff0c\u800c\u7f13\u5b58\u4e2d\u7684\u662f\u65e7\u503c\uff0c\u8fd9\u80af\u5b9a\u662f\u4e0d\u4e00\u81f4\u7684\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u5982\u679c\u6709\u5176\u4ed6\u7684\u5e76\u53d1\u8bf7\u6c42\u6765\u8bbf\u95ee\u6570\u636e\uff0c\u6309\u7167\u6b63\u5e38\u7684\u7f13\u5b58\u8bbf\u95ee\u6d41\u7a0b\uff0c\u5c31\u4f1a\u5148\u5728\u7f13\u5b58\u4e2d\u67e5\u8be2\uff0c\u4f46\u6b64\u65f6\uff0c\u5c31\u4f1a\u8bfb\u5230\u65e7\u503c\u4e86\u3002 \u5e94\u7528\u8981\u628a\u6570\u636e X \u7684\u503c\u4ece 10 \u66f4\u65b0\u4e3a 3\uff0c\u5148\u6210\u529f\u66f4\u65b0\u4e86\u6570\u636e\u5e93\uff0c\u7136\u540e\u5728 Redis \u7f13\u5b58\u4e2d\u5220\u9664 X \u7684\u7f13\u5b58\uff0c\u4f46\u662f\u8fd9\u4e2a\u64cd\u4f5c\u5374\u5931\u8d25\u4e86\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u6570\u636e\u5e93\u4e2d X \u7684\u65b0\u503c\u4e3a 3\uff0cRedis \u4e2d\u7684 X \u7684\u7f13\u5b58\u503c\u4e3a 10\uff0c\u8fd9\u80af\u5b9a\u662f\u4e0d\u4e00\u81f4\u7684\u3002\u5982\u679c\u521a\u597d\u6b64\u65f6\u6709\u5176\u4ed6\u5ba2\u6237\u7aef\u4e5f\u53d1\u9001\u8bf7\u6c42\u8bbf\u95ee X\uff0c\u4f1a\u5148\u5728 Redis \u4e2d\u67e5\u8be2\uff0c\u8be5\u5ba2\u6237\u7aef\u4f1a\u53d1\u73b0\u7f13\u5b58\u547d\u4e2d\uff0c\u4f46\u662f\u8bfb\u5230\u7684\u5374\u662f\u65e7\u503c 10\u3002 \u5728\u66f4\u65b0\u6570\u636e\u5e93\u548c\u5220\u9664\u7f13\u5b58\u503c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u65e0\u8bba\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7684\u6267\u884c\u987a\u5e8f\u8c01\u5148\u8c01\u540e\uff0c\u53ea\u8981\u6709\u4e00\u4e2a\u64cd\u4f5c\u5931\u8d25\u4e86\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5ba2\u6237\u7aef\u8bfb\u53d6\u5230\u65e7\u503c\u3002","title":"1-2-2 \u5220\u6539\u6570\u636e"},{"location":"chap5/3redis_mysql_uncon/#2","text":"","title":"2\u3001\u5982\u4f55\u89e3\u51b3\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\uff1f"},{"location":"chap5/3redis_mysql_uncon/#2-1","text":"\u5177\u4f53\u6765\u8bf4\uff0c\u53ef\u4ee5\u628a\u8981\u5220\u9664\u7684\u7f13\u5b58\u503c\u6216\u8005\u662f\u8981\u66f4\u65b0\u7684\u6570\u636e\u5e93\u503c\u6682\u5b58\u5230\u6d88\u606f\u961f\u5217\u4e2d\uff08\u4f8b\u5982\u4f7f\u7528 Kafka \u6d88\u606f\u961f\u5217\uff09\u3002 \u5f53\u5e94\u7528\u6ca1\u6709\u80fd\u591f\u6210\u529f\u5730\u5220\u9664\u7f13\u5b58\u503c\u6216\u8005\u662f\u66f4\u65b0\u6570\u636e\u5e93\u503c\u65f6\uff0c\u53ef\u4ee5\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u91cd\u65b0\u8bfb\u53d6\u8fd9\u4e9b\u503c\uff0c\u7136\u540e\u518d\u6b21\u8fdb\u884c\u5220\u9664\u6216\u66f4\u65b0\u3002 \u5982\u679c\u80fd\u591f\u6210\u529f\u5730\u5220\u9664\u6216\u66f4\u65b0\uff0c\u6211\u4eec\u5c31\u8981\u628a\u8fd9\u4e9b\u503c\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u53bb\u9664\uff0c\u4ee5\u514d\u91cd\u590d\u64cd\u4f5c\uff0c\u6b64\u65f6\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u5e93\u548c\u7f13\u5b58\u7684\u6570\u636e\u4e00\u81f4\u4e86\u3002\u5426\u5219\u7684\u8bdd\uff0c \u6211\u4eec\u8fd8\u9700\u8981\u518d\u6b21\u8fdb\u884c\u91cd\u8bd5\u3002\u5982\u679c\u91cd\u8bd5\u8d85\u8fc7\u7684\u4e00\u5b9a\u6b21\u6570\uff0c\u8fd8\u662f\u6ca1\u6709\u6210\u529f\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5411\u4e1a\u52a1\u5c42\u53d1\u9001\u62a5\u9519\u4fe1\u606f\u4e86\u3002 \u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58\u503c\u65f6\uff0c\u5982\u679c\u7f13\u5b58\u5220\u9664\u5931\u8d25\uff0c\u518d\u6b21\u91cd\u8bd5\u540e\u5220\u9664\u6210\u529f\u7684\u60c5\u51b5 \u5b9e\u9645\u4e0a\uff0c\u5373\u4f7f\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7b2c\u4e00\u6b21\u6267\u884c\u65f6\u90fd\u6ca1\u6709\u5931\u8d25\uff0c\u5f53\u6709\u5927\u91cf\u5e76\u53d1\u8bf7\u6c42\u65f6\uff0c\u5e94\u7528\u8fd8\u662f\u6709\u53ef\u80fd\u8bfb\u5230\u4e0d\u4e00\u81f4\u7684\u6570\u636e\u3002 \u6211\u4eec\u6309\u7167\u4e0d\u540c\u7684\u5220\u9664\u548c\u66f4\u65b0\u987a\u5e8f\uff0c\u5206\u6210\u4e24\u79cd\u60c5\u51b5\u6765\u770b\u3002\u5728\u8fd9\u4e24\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u7684\u89e3\u51b3\u65b9\u6cd5\u4e5f\u6709\u6240\u4e0d\u540c\u3002","title":"2-1 \u91cd\u8bd5\u673a\u5236"},{"location":"chap5/3redis_mysql_uncon/#2-2","text":"\u5047\u8bbe\u7ebf\u7a0b A \u5220\u9664\u7f13\u5b58\u503c\u540e\uff0c\u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u66f4\u65b0\u6570\u636e\u5e93\uff08\u6bd4\u5982\u8bf4\u6709\u7f51\u7edc\u5ef6\u8fdf\uff09\uff0c\u7ebf\u7a0b B \u5c31\u5f00\u59cb\u8bfb\u53d6\u6570\u636e\u4e86\uff0c\u90a3\u4e48\u8fd9\u4e2a\u65f6\u5019\uff0c\u7ebf\u7a0b B \u4f1a\u53d1\u73b0\u7f13\u5b58\u7f3a\u5931\uff0c\u5c31\u53ea\u80fd\u53bb\u6570\u636e\u5e93\u8bfb\u53d6\u3002\u8fd9\u4f1a\u5e26\u6765\u4e24\u4e2a\u95ee\u9898\uff1a \u7ebf\u7a0b B \u8bfb\u53d6\u5230\u4e86\u65e7\u503c\uff1b \u7ebf\u7a0b B \u662f\u5728\u7f13\u5b58\u7f3a\u5931\u7684\u60c5\u51b5\u4e0b\u8bfb\u53d6\u7684\u6570\u636e\u5e93\uff0c\u6240\u4ee5\uff0c\u5b83\u8fd8\u4f1a\u628a\u65e7\u503c\u5199\u5165\u7f13\u5b58\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5176\u4ed6\u7ebf\u7a0b\u4ece\u7f13\u5b58\u4e2d\u8bfb\u5230\u65e7\u503c\u3002 \u7b49\u5230\u7ebf\u7a0b B \u4ece\u6570\u636e\u5e93\u8bfb\u53d6\u5b8c\u6570\u636e\u3001\u66f4\u65b0\u4e86\u7f13\u5b58\u540e\uff0c\u7ebf\u7a0b A \u624d\u5f00\u59cb\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u6b64\u65f6\uff0c\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u662f\u65e7\u503c\uff0c\u800c\u6570\u636e\u5e93\u4e2d\u7684\u662f\u6700\u65b0\u503c\uff0c\u4e24\u8005\u5c31\u4e0d\u4e00\u81f4\u4e86\u3002 \u5728\u7ebf\u7a0b A \u66f4\u65b0\u5b8c\u6570\u636e\u5e93\u503c\u4ee5\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba9\u5b83\u5148 sleep \u4e00\u5c0f\u6bb5\u65f6\u95f4\uff0c\u518d\u8fdb\u884c\u4e00\u6b21\u7f13\u5b58\u5220\u9664\u64cd\u4f5c\u3002 \u4e4b\u6240\u4ee5\u8981\u52a0\u4e0a sleep \u7684\u8fd9\u6bb5\u65f6\u95f4\uff0c\u5c31\u662f\u4e3a\u4e86\u8ba9\u7ebf\u7a0b B \u80fd\u591f\u5148\u4ece\u6570\u636e\u5e93\u8bfb\u53d6\u6570\u636e\uff0c \u518d\u628a\u7f3a\u5931\u7684\u6570\u636e\u5199\u5165\u7f13\u5b58\uff0c \u7136\u540e\uff0c\u7ebf\u7a0b A \u518d\u8fdb\u884c\u5220\u9664\u3002 \u6240\u4ee5\uff0c\u7ebf\u7a0b A sleep \u7684\u65f6\u95f4\uff0c\u5c31\u9700\u8981\u5927\u4e8e\u7ebf\u7a0b B \u8bfb\u53d6\u6570\u636e\u518d\u5199\u5165\u7f13\u5b58\u7684\u65f6\u95f4 \u3002 \u8fd9\u4e2a\u65f6\u95f4\u600e\u4e48\u786e\u5b9a\u5462\uff1f \u5efa\u8bae\u4f60\u5728\u4e1a\u52a1\u7a0b\u5e8f\u8fd0\u884c\u7684\u65f6\u5019\uff0c\u7edf\u8ba1\u4e0b\u7ebf\u7a0b\u8bfb\u6570\u636e\u548c\u5199\u7f13\u5b58\u7684\u64cd\u4f5c\u65f6\u95f4\uff0c\u4ee5\u6b64\u4e3a\u57fa\u7840\u6765\u8fdb\u884c\u4f30\u7b97\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5176\u5b83\u7ebf\u7a0b\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u4f1a\u53d1\u73b0\u7f13\u5b58\u7f3a\u5931\uff0c\u6240\u4ee5\u4f1a\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6700\u65b0\u503c\u3002\u56e0\u4e3a\u8fd9\u4e2a\u65b9\u6848\u4f1a\u5728\u7b2c\u4e00\u6b21\u5220\u9664\u7f13\u5b58\u503c\u540e\uff0c\u5ef6\u8fdf\u4e00\u6bb5\u65f6\u95f4\u518d\u6b21\u8fdb\u884c\u5220\u9664\uff0c\u6240\u4ee5\u6211\u4eec\u4e5f\u628a\u5b83\u53eb\u505a\u201c\u5ef6\u8fdf\u53cc\u5220\u201d\u3002 redis.delKey(X) db.update(X) Thread.sleep(N) redis.delKey(X)","title":"2-2 \u60c5\u51b5\u4e00\uff1a\u5148\u5220\u9664\u7f13\u5b58\uff0c\u518d\u66f4\u65b0\u6570\u636e\u5e93"},{"location":"chap5/3redis_mysql_uncon/#2-3","text":"\u5982\u679c\u7ebf\u7a0b A \u5220\u9664\u4e86\u6570\u636e\u5e93\u4e2d\u7684\u503c\uff0c\u4f46\u8fd8\u6ca1\u6765\u5f97\u53ca\u5220\u9664\u7f13\u5b58\u503c\uff0c\u7ebf\u7a0b B \u5c31\u5f00\u59cb\u8bfb\u53d6\u6570\u636e\u4e86\uff0c\u90a3\u4e48\u6b64\u65f6\uff0c\u7ebf\u7a0b B \u67e5\u8be2\u7f13\u5b58\u65f6\uff0c\u53d1\u73b0\u7f13\u5b58\u547d\u4e2d\uff0c\u5c31\u4f1a\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u65e7\u503c\u3002 \u4e0d\u8fc7\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5176\u4ed6\u7ebf\u7a0b\u5e76\u53d1\u8bfb\u7f13\u5b58\u7684\u8bf7\u6c42\u4e0d\u591a\uff0c\u90a3\u4e48\uff0c\u5c31\u4e0d\u4f1a\u6709\u5f88\u591a\u8bf7\u6c42\u8bfb\u53d6\u5230\u65e7\u503c\u3002\u800c\u4e14\uff0c\u7ebf\u7a0b A \u4e00\u822c\u4e5f\u4f1a\u5f88\u5feb\u5220\u9664\u7f13\u5b58\u503c\uff0c \u8fd9\u6837\u4e00\u6765\uff0c\u5176\u4ed6\u7ebf\u7a0b\u518d\u6b21\u8bfb\u53d6\u65f6\uff0c\u5c31\u4f1a\u53d1\u751f\u7f13\u5b58\u7f3a\u5931\uff0c\u8fdb\u800c\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6700\u65b0\u503c\u3002\u6240\u4ee5\uff0c\u8fd9\u79cd\u60c5\u51b5\u5bf9\u4e1a\u52a1\u7684\u5f71\u54cd\u8f83\u5c0f\u3002 \u5220\u9664\u7f13\u5b58\u503c\u6216\u66f4\u65b0\u6570\u636e\u5e93\u5931\u8d25\u800c\u5bfc\u81f4\u6570\u636e\u4e0d\u4e00\u81f4\uff0c \u4f60\u53ef\u4ee5\u4f7f\u7528\u91cd\u8bd5\u673a\u5236\u786e\u4fdd\u5220\u9664\u6216\u66f4\u65b0\u64cd\u4f5c\u6210\u529f \u5728\u5220\u9664\u7f13\u5b58\u503c\u3001\u66f4\u65b0\u6570\u636e\u5e93\u7684\u8fd9\u4e24\u6b65\u64cd\u4f5c\u4e2d\uff0c \u6709\u5176\u4ed6\u7ebf\u7a0b\u7684\u5e76\u53d1\u8bfb\u64cd\u4f5c\uff0c\u5bfc\u81f4\u5176\u4ed6\u7ebf\u7a0b\u8bfb\u53d6\u5230\u65e7\u503c\uff0c\u5e94\u5bf9\u65b9\u6848\u662f\u5ef6\u8fdf\u53cc\u5220\u3002","title":"2-3 \u60c5\u51b5\u4e8c\uff1a\u5148\u66f4\u65b0\u6570\u636e\u5e93\u503c\uff0c\u518d\u5220\u9664\u7f13\u5b58\u503c"},{"location":"chap5/3redis_mysql_uncon/#3","text":"\u7f13\u5b58\u96ea\u5d29\u662f\u6307\u5927\u91cf\u7684\u5e94\u7528\u8bf7\u6c42\u65e0\u6cd5\u5728 Redis \u7f13\u5b58\u4e2d\u8fdb\u884c\u5904\u7406\uff0c\u7d27\u63a5\u7740\uff0c\u5e94\u7528\u5c06\u5927\u91cf\u8bf7\u6c42\u53d1\u9001\u5230\u6570\u636e\u5e93\u5c42\uff0c\u5bfc\u81f4\u6570\u636e\u5e93\u5c42\u7684\u538b\u529b\u6fc0\u589e\u3002 \u7b2c\u4e00\u4e2a\u539f\u56e0\u662f\uff1a\u7f13\u5b58\u4e2d\u6709\u5927\u91cf\u6570\u636e\u540c\u65f6\u8fc7\u671f\uff0c\u5bfc\u81f4\u5927\u91cf\u8bf7\u6c42\u65e0\u6cd5\u5f97\u5230\u5904\u7406\u3002 \u5177\u4f53\u6765\u8bf4\uff0c \u5f53\u6570\u636e\u4fdd\u5b58\u5728\u7f13\u5b58\u4e2d\uff0c\u5e76\u4e14\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u65f6\uff0c\u5982\u679c\u5728\u67d0\u4e00\u4e2a\u65f6\u523b\uff0c\u5927\u91cf\u6570\u636e\u540c\u65f6\u8fc7\u671f\uff0c\u6b64\u65f6\uff0c\u5e94\u7528\u518d\u8bbf\u95ee\u8fd9\u4e9b\u6570\u636e\u7684\u8bdd\uff0c\u5c31\u4f1a\u53d1\u751f\u7f13\u5b58\u7f3a\u5931\u3002 \u7d27\u63a5\u7740\uff0c\u5e94\u7528\u5c31\u4f1a\u628a\u8bf7\u6c42\u53d1\u9001\u7ed9\u6570\u636e\u5e93\uff0c\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\u3002\u5982\u679c\u5e94\u7528\u7684\u5e76\u53d1\u8bf7\u6c42\u91cf\u5f88\u5927\uff0c\u90a3\u4e48\u6570\u636e\u5e93\u7684\u538b\u529b\u4e5f\u5c31\u5f88\u5927\uff0c\u8fd9\u4f1a\u8fdb\u4e00\u6b65\u5f71\u54cd\u5230\u6570\u636e\u5e93\u7684\u5176\u4ed6\u6b63\u5e38\u4e1a\u52a1\u8bf7\u6c42\u5904\u7406\u3002 \u9488\u5bf9\u5927\u91cf\u6570\u636e\u540c\u65f6\u5931\u6548\u5e26\u6765\u7684\u7f13\u5b58\u96ea\u5d29\u95ee\u9898\uff0c\u63d0\u4f9b\u4e24\u79cd\u89e3\u51b3\u65b9\u6848\u3002","title":"3\u3001\u7f13\u5b58\u96ea\u5d29"},{"location":"chap5/3redis_mysql_uncon/#3-1","text":"\u9996\u5148\uff0c\u6211\u4eec\u53ef\u4ee5\u907f\u514d\u7ed9\u5927\u91cf\u7684\u6570\u636e\u8bbe\u7f6e\u76f8\u540c\u7684\u8fc7\u671f\u65f6\u95f4\u3002 \u5982\u679c\u4e1a\u52a1\u5c42\u7684\u786e\u8981\u6c42\u6709\u4e9b\u6570\u636e\u540c\u65f6\u5931\u6548\uff0c\u4f60\u53ef\u4ee5\u5728\u7528 EXPIRE \u547d\u4ee4\u7ed9\u6bcf\u4e2a\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u65f6\uff0c\u7ed9 \u8fd9\u4e9b\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u589e\u52a0\u4e00\u4e2a\u8f83\u5c0f\u7684\u968f\u673a\u6570\uff08\u4f8b\u5982\uff0c\u968f\u673a\u589e\u52a0 1~3 \u5206\u949f\uff09 \uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u4e0d\u540c\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u6709\u6240\u5dee\u522b\uff0c\u4f46\u5dee\u522b\u53c8\u4e0d\u4f1a\u592a\u5927\uff0c\u65e2\u907f\u514d\u4e86\u5927\u91cf\u6570\u636e\u540c\u65f6\u8fc7\u671f\uff0c\u540c\u65f6\u4e5f\u4fdd\u8bc1\u4e86\u8fd9\u4e9b\u6570\u636e\u57fa\u672c\u5728\u76f8\u8fd1\u7684\u65f6\u95f4\u5931\u6548\uff0c\u4ecd\u7136\u80fd\u6ee1\u8db3\u4e1a\u52a1\u9700\u6c42\u3002","title":"3-1 \u907f\u514d\u7ed9\u5927\u91cf\u7684\u6570\u636e\u8bbe\u7f6e\u76f8\u540c\u7684\u8fc7\u671f\u65f6\u95f4"},{"location":"chap5/3redis_mysql_uncon/#3-2","text":"\u6211\u4eec\u8fd8\u53ef\u4ee5\u901a\u8fc7\u670d\u52a1\u964d\u7ea7\uff0c\u6765\u5e94\u5bf9\u7f13\u5b58\u96ea\u5d29\u3002\u6240\u8c13\u7684\u670d\u52a1\u964d\u7ea7\uff0c\u662f\u6307\u53d1\u751f\u7f13\u5b58\u96ea\u5d29\u65f6\uff0c\u9488\u5bf9\u4e0d\u540c\u7684\u6570\u636e\u91c7\u53d6\u4e0d\u540c\u7684\u5904\u7406\u65b9\u5f0f\u3002 \u5f53\u4e1a\u52a1\u5e94\u7528\u8bbf\u95ee\u7684\u662f\u975e\u6838\u5fc3\u6570\u636e\uff08\u4f8b\u5982\u7535\u5546\u5546\u54c1\u5c5e\u6027\uff09\u65f6\uff0c \u6682\u65f6\u505c\u6b62\u4ece\u7f13\u5b58\u4e2d\u67e5\u8be2\u8fd9\u4e9b\u6570\u636e\uff0c\u800c\u662f\u76f4\u63a5\u8fd4\u56de\u9884\u5b9a\u4e49\u4fe1\u606f\u3001\u7a7a\u503c\u6216\u662f\u9519\u8bef\u4fe1\u606f\uff1b \u5f53\u4e1a\u52a1\u5e94\u7528\u8bbf\u95ee\u7684\u662f\u6838\u5fc3\u6570\u636e\uff08\u4f8b\u5982\u7535\u5546\u5546\u54c1\u5e93\u5b58\uff09\u65f6\uff0c\u4ecd\u7136\u5141\u8bb8\u67e5\u8be2\u7f13\u5b58 \uff0c\u5982\u679c\u7f13\u5b58\u7f3a\u5931\uff0c\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u901a\u8fc7\u6570\u636e\u5e93\u8bfb\u53d6\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u53ea\u6709\u90e8\u5206\u8fc7\u671f\u6570\u636e\u7684\u8bf7\u6c42\u4f1a\u53d1\u9001\u5230\u6570\u636e\u5e93\uff0c\u6570\u636e\u5e93\u7684\u538b\u529b\u5c31\u6ca1\u6709\u90a3\u4e48\u5927\u4e86\u3002 \u9664\u4e86\u5927\u91cf\u6570\u636e\u540c\u65f6\u5931\u6548\u4f1a\u5bfc\u81f4\u7f13\u5b58\u96ea\u5d29\uff0c\u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\u4e5f\u4f1a\u53d1\u751f\u7f13\u5b58\u96ea\u5d29\uff0c\u90a3\u5c31\u662f\uff0cRedis \u7f13\u5b58\u5b9e\u4f8b\u53d1\u751f\u6545\u969c\u5b95\u673a\u4e86\uff0c\u65e0\u6cd5\u5904\u7406\u8bf7\u6c42\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u5927\u91cf\u8bf7\u6c42\u4e00\u4e0b\u5b50\u79ef\u538b\u5230\u6570\u636e\u5e93\u5c42\uff0c\u4ece\u800c\u53d1\u751f\u7f13\u5b58\u96ea\u5d29\u3002 \u4e00\u822c\u6765\u8bf4\uff0c\u4e00\u4e2a Redis \u5b9e\u4f8b\u53ef\u4ee5\u652f\u6301\u6570\u4e07\u7ea7\u522b\u7684\u8bf7\u6c42\u5904\u7406\u541e\u5410\u91cf\uff0c\u800c\u5355\u4e2a\u6570\u636e\u5e93\u53ef\u80fd\u53ea\u80fd\u652f\u6301\u6570\u5343\u7ea7\u522b\u7684\u8bf7\u6c42\u5904\u7406\u541e\u5410\u91cf\uff0c\u5b83\u4eec\u4e24\u4e2a\u7684\u5904\u7406\u80fd\u529b\u53ef\u80fd\u76f8\u5dee\u4e86\u8fd1\u5341\u500d\u3002\u7531\u4e8e\u7f13\u5b58\u96ea\u5d29\uff0cRedis \u7f13\u5b58\u5931\u6548\uff0c\u6240\u4ee5\uff0c\u6570\u636e\u5e93\u5c31\u53ef\u80fd\u8981\u627f\u53d7\u8fd1\u5341\u500d\u7684\u8bf7\u6c42\u538b\u529b\uff0c\u4ece\u800c\u56e0\u4e3a\u538b\u529b\u8fc7\u5927\u800c\u5d29\u6e83\u3002 \u56e0\u4e3a Redis \u5b9e\u4f8b\u53d1\u751f\u4e86\u5b95\u673a\uff0c\u6211\u4eec\u9700\u8981\u901a\u8fc7\u5176\u4ed6\u65b9\u6cd5\u6765\u5e94\u5bf9\u7f13\u5b58\u96ea\u5d29\u4e86","title":"3-2 \u670d\u52a1\u964d\u7ea7"},{"location":"chap5/3redis_mysql_uncon/#3-3","text":"\u6240\u8c13\u7684\u670d\u52a1\u7194\u65ad\uff0c\u662f\u6307\u5728\u53d1\u751f\u7f13\u5b58\u96ea\u5d29\u65f6\uff0c\u4e3a\u4e86\u9632\u6b62\u5f15\u53d1\u8fde\u9501\u7684\u6570\u636e\u5e93\u96ea\u5d29\uff0c\u751a\u81f3\u662f\u6574\u4e2a\u7cfb\u7edf\u7684\u5d29\u6e83\uff0c \u6211\u4eec\u6682\u505c\u4e1a\u52a1\u5e94\u7528\u5bf9\u7f13\u5b58\u7cfb\u7edf\u7684\u63a5\u53e3\u8bbf\u95ee\u3002 \u518d\u5177\u4f53\u70b9\u8bf4\uff0c \u5c31\u662f\u4e1a\u52a1\u5e94\u7528\u8c03\u7528\u7f13\u5b58\u63a5\u53e3\u65f6\uff0c\u7f13\u5b58\u5ba2\u6237\u7aef\u5e76\u4e0d\u628a\u8bf7\u6c42\u53d1\u7ed9 Redis \u7f13\u5b58\u5b9e\u4f8b \uff0c\u800c\u662f\u76f4\u63a5\u8fd4\u56de\uff0c\u7b49\u5230 Redis \u7f13\u5b58\u5b9e\u4f8b\u91cd\u65b0\u6062\u590d\u670d\u52a1\u540e\uff0c\u518d\u5141\u8bb8\u5e94\u7528\u8bf7\u6c42\u53d1\u9001\u5230\u7f13\u5b58\u7cfb\u7edf\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5c31\u907f\u514d\u4e86\u5927\u91cf\u8bf7\u6c42\u56e0\u7f13\u5b58\u7f3a\u5931\uff0c\u800c\u79ef\u538b\u5230\u6570\u636e\u5e93\u7cfb\u7edf\uff0c\u4fdd\u8bc1\u4e86\u6570\u636e\u5e93\u7cfb\u7edf\u7684\u6b63\u5e38\u8fd0\u884c\u3002 \u5728\u4e1a\u52a1\u7cfb\u7edf\u8fd0\u884c\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u76d1\u6d4b Redis \u7f13\u5b58\u6240\u5728\u673a\u5668\u548c\u6570\u636e\u5e93\u6240\u5728\u673a\u5668\u7684\u8d1f\u8f7d\u6307\u6807\uff0c\u4f8b\u5982\u6bcf\u79d2\u8bf7\u6c42\u6570\u3001CPU \u5229\u7528\u7387\u3001\u5185\u5b58\u5229\u7528\u7387\u7b49\u3002\u5982\u679c\u6211\u4eec\u53d1\u73b0 Redis \u7f13\u5b58\u5b9e\u4f8b\u5b95\u673a\u4e86\uff0c\u800c\u6570\u636e\u5e93\u6240\u5728\u673a\u5668\u7684\u8d1f\u8f7d\u538b\u529b\u7a81\u7136\u589e\u52a0\uff08\u4f8b\u5982\u6bcf\u79d2\u8bf7\u6c42\u6570\u6fc0\u589e\uff09\uff0c\u6b64\u65f6\uff0c\u5c31\u53d1\u751f\u7f13\u5b58\u96ea\u5d29\u4e86\u3002 \u5927\u91cf\u8bf7\u6c42\u88ab\u53d1\u9001\u5230\u6570\u636e\u5e93\u8fdb\u884c\u5904\u7406\u3002\u6211\u4eec\u53ef\u4ee5\u542f\u52a8\u670d\u52a1\u7194\u65ad\u673a\u5236\uff0c\u6682\u505c\u4e1a\u52a1\u5e94\u7528\u5bf9\u7f13\u5b58\u670d\u52a1\u7684\u8bbf\u95ee\uff0c\u4ece\u800c\u964d\u4f4e\u5bf9\u6570\u636e\u5e93\u7684\u8bbf\u95ee\u538b\u529b\uff0c \u5982\u4e0b\u56fe\u6240\u793a\uff1a \u670d\u52a1\u7194\u65ad\u867d\u7136\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u5e93\u7684\u6b63\u5e38\u8fd0\u884c\uff0c\u4f46\u662f\u6682\u505c\u4e86\u6574\u4e2a\u7f13\u5b58\u7cfb\u7edf\u7684\u8bbf\u95ee\uff0c\u5bf9\u4e1a\u52a1\u5e94\u7528\u7684\u5f71\u54cd\u8303\u56f4\u5927\u3002 \u4e3a\u4e86\u5c3d\u53ef\u80fd\u51cf\u5c11\u8fd9\u79cd\u5f71\u54cd\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u8fdb\u884c\u8bf7\u6c42\u9650\u6d41\u3002\u8fd9\u91cc\u8bf4\u7684\u8bf7\u6c42\u9650\u6d41\uff0c\u5c31\u662f\u6307\uff0c\u6211\u4eec\u5728\u4e1a\u52a1\u7cfb\u7edf\u7684\u8bf7\u6c42\u5165\u53e3\u524d\u7aef\u63a7\u5236\u6bcf\u79d2\u8fdb\u5165\u7cfb\u7edf\u7684\u8bf7\u6c42\u6570\uff0c\u907f\u514d\u8fc7\u591a\u7684\u8bf7\u6c42\u88ab\u53d1\u9001\u5230\u6570\u636e\u5e93\u3002 \u4f60\u4e3e\u4e2a\u4f8b\u5b50\u3002\u5047\u8bbe\u4e1a\u52a1\u7cfb\u7edf\u6b63\u5e38\u8fd0\u884c\u65f6\uff0c\u8bf7\u6c42\u5165\u53e3\u524d\u7aef\u5141\u8bb8\u6bcf\u79d2\u8fdb\u5165\u7cfb\u7edf\u7684\u8bf7\u6c42\u662f 1 \u4e07\u4e2a\uff0c\u5176\u4e2d\uff0c9000 \u4e2a\u8bf7\u6c42\u90fd\u80fd\u5728\u7f13\u5b58\u7cfb\u7edf\u4e2d\u8fdb\u884c\u5904\u7406\uff0c\u53ea\u6709 1000 \u4e2a\u8bf7\u6c42\u4f1a\u88ab\u5e94\u7528\u53d1\u9001\u5230\u6570\u636e\u5e93\u8fdb\u884c\u5904\u7406\u3002 \u4e00\u65e6\u53d1\u751f\u4e86\u7f13\u5b58\u96ea\u5d29\uff0c\u6570\u636e\u5e93\u7684\u6bcf\u79d2\u8bf7\u6c42\u6570\u7a81\u7136\u589e\u52a0\u5230\u6bcf\u79d2 1 \u4e07\u4e2a\uff0c\u6b64\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u542f\u52a8\u8bf7\u6c42\u9650\u6d41\u673a\u5236\uff0c\u5728\u8bf7\u6c42\u5165\u53e3\u524d\u7aef\u53ea\u5141\u8bb8\u6bcf\u79d2\u8fdb\u5165\u7cfb\u7edf\u7684\u8bf7\u6c42\u6570\u4e3a 1000 \u4e2a\uff0c\u518d\u591a\u7684\u8bf7\u6c42\u5c31\u4f1a\u5728\u5165\u53e3\u524d\u7aef\u88ab\u76f4\u63a5\u62d2\u7edd\u670d\u52a1\u3002\u6240\u4ee5\uff0c\u4f7f\u7528\u4e86\u8bf7\u6c42\u9650\u6d41\uff0c\u5c31\u53ef\u4ee5\u907f\u514d\u5927\u91cf\u5e76\u53d1\u8bf7\u6c42\u538b\u529b\u4f20\u9012\u5230\u6570\u636e\u5e93\u5c42\u3002","title":"3-3 \u5efa\u8bae\u4e00\uff1a\u662f\u5728\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u5b9e\u73b0\u670d\u52a1\u7194\u65ad\u6216\u8bf7\u6c42\u9650\u6d41\u673a\u5236"},{"location":"chap5/3redis_mysql_uncon/#3-4","text":"\u901a\u8fc7\u4e3b\u4ece\u8282\u70b9\u7684\u65b9\u5f0f\u6784\u5efa Redis \u7f13\u5b58\u9ad8\u53ef\u9760\u96c6\u7fa4\u3002 \u5982\u679c Redis \u7f13\u5b58\u7684\u4e3b\u8282\u70b9\u6545\u969c\u5b95\u673a\u4e86\uff0c\u4ece\u8282\u70b9\u8fd8\u53ef\u4ee5\u5207\u6362\u6210\u4e3a\u4e3b\u8282\u70b9\uff0c\u7ee7\u7eed\u63d0\u4f9b\u7f13\u5b58\u670d\u52a1\uff0c\u907f\u514d\u4e86\u7531\u4e8e\u7f13\u5b58\u5b9e\u4f8b\u5b95\u673a\u800c\u5bfc\u81f4\u7684\u7f13\u5b58\u96ea\u5d29\u95ee\u9898 \u3002 \u7f13\u5b58\u96ea\u5d29\u662f\u53d1\u751f\u5728\u5927\u91cf\u6570\u636e\u540c\u65f6\u5931\u6548\u7684\u573a\u666f\u4e0b\uff0c\u548c\u7f13\u5b58\u96ea\u5d29\u76f8\u6bd4\uff0c\u7f13\u5b58\u51fb\u7a7f\u5931\u6548\u7684\u6570\u636e\u6570\u91cf\u8981\u5c0f\u5f88\u591a\u3002","title":"3-4  \u5efa\u8bae\u4e8c\uff1a\u4e8b\u524d\u9884\u9632"},{"location":"chap5/3redis_mysql_uncon/#4","text":"\u7f13\u5b58\u51fb\u7a7f\u662f\u6307\uff0c\u9488\u5bf9\u67d0\u4e2a\u8bbf\u95ee\u975e\u5e38\u9891\u7e41\u7684\u70ed\u70b9\u6570\u636e\u7684\u8bf7\u6c42\uff0c\u65e0\u6cd5\u5728\u7f13\u5b58\u4e2d\u8fdb\u884c\u5904\u7406\uff0c\u7d27\u63a5\u7740\uff0c\u8bbf\u95ee\u8be5\u6570\u636e\u7684\u5927\u91cf\u8bf7\u6c42\uff0c\u4e00\u4e0b\u5b50\u90fd\u53d1\u9001\u5230\u4e86\u540e\u7aef\u6570\u636e\u5e93\uff0c \u5bfc\u81f4\u4e86\u6570\u636e\u5e93\u538b\u529b\u6fc0\u589e\uff0c\u4f1a\u5f71\u54cd\u6570\u636e\u5e93\u5904\u7406\u5176\u4ed6\u8bf7\u6c42 \u3002 \u7f13\u5b58\u51fb\u7a7f\u7684\u60c5\u51b5\uff0c\u7ecf\u5e38\u53d1\u751f\u5728\u70ed\u70b9\u6570\u636e\u8fc7\u671f\u5931\u6548\u65f6 \uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u4e3a\u4e86\u907f\u514d\u7f13\u5b58\u51fb\u7a7f\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u7684\u6fc0\u589e\u538b\u529b\uff0c\u89e3\u51b3\u65b9\u6cd5\u4e5f\u6bd4\u8f83\u76f4\u63a5\uff0c \u5bf9\u4e8e\u8bbf\u95ee\u7279\u522b\u9891\u7e41\u7684\u70ed\u70b9\u6570\u636e\uff0c\u6211\u4eec\u5c31\u4e0d\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u4e86 \u5bf9\u70ed\u70b9\u6570\u636e\u7684\u8bbf\u95ee\u8bf7\u6c42\uff0c\u90fd\u53ef\u4ee5\u5728\u7f13\u5b58\u4e2d\u8fdb\u884c\u5904\u7406\uff0c\u800c Redis \u6570\u4e07\u7ea7\u522b\u7684\u9ad8\u541e\u5410\u91cf\u53ef\u4ee5\u5f88\u597d\u5730\u5e94\u5bf9\u5927\u91cf\u7684\u5e76\u53d1\u8bf7\u6c42\u8bbf\u95ee\u3002","title":"4\u3001\u7f13\u5b58\u51fb\u7a7f"},{"location":"chap5/3redis_mysql_uncon/#5","text":"\u7f13\u5b58\u7a7f\u900f\u662f\u6307\u8981\u8bbf\u95ee\u7684\u6570\u636e\u65e2 \u4e0d\u5728 Redis \u7f13\u5b58\u4e2d\uff0c\u4e5f\u4e0d\u5728\u6570\u636e\u5e93\u4e2d\uff0c\u5bfc\u81f4\u8bf7\u6c42\u5728\u8bbf\u95ee\u7f13\u5b58\u65f6\uff0c\u53d1\u751f\u7f13\u5b58\u7f3a\u5931 \uff0c\u518d\u53bb\u8bbf\u95ee\u6570\u636e\u5e93\u65f6\uff0c\u53d1\u73b0\u6570\u636e\u5e93\u4e2d\u4e5f\u6ca1\u6709\u8981\u8bbf\u95ee\u7684\u6570\u636e \u5e94\u7528\u4e5f\u65e0\u6cd5\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\u518d\u5199\u5165\u7f13\u5b58\uff0c\u6765\u670d\u52a1\u540e\u7eed\u8bf7\u6c42\uff0c\u8fd9\u6837\u4e00\u6765\uff0c \u7f13\u5b58\u4e5f\u5c31\u6210\u4e86\u201c\u6446\u8bbe\u201d\uff0c\u5982\u679c\u5e94\u7528\u6301\u7eed\u6709\u5927\u91cf\u8bf7\u6c42\u8bbf\u95ee\u6570\u636e\uff0c\u5c31\u4f1a\u540c\u65f6\u7ed9\u7f13\u5b58\u548c\u6570\u636e\u5e93\u5e26\u6765\u5de8\u5927\u538b\u529b \u7f13\u5b58\u7a7f\u900f\u4f1a\u53d1\u751f\u5728\u4ec0\u4e48\u65f6\u5019\u5462\uff1f\u4e00\u822c\u6765\u8bf4\uff0c\u6709\u4e24\u79cd\u60c5\u51b5\u3002 \u4e1a\u52a1\u5c42\u8bef\u64cd\u4f5c\uff1a\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u88ab\u8bef\u5220\u9664\u4e86\uff0c\u6240\u4ee5\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u90fd\u6ca1\u6709\u6570\u636e\uff1b \u6076\u610f\u653b\u51fb\uff1a\u4e13\u95e8\u8bbf\u95ee\u6570\u636e\u5e93\u4e2d\u6ca1\u6709\u7684\u6570\u636e\u3002","title":"5\u3001\u7f13\u5b58\u7a7f\u900f"},{"location":"chap5/3redis_mysql_uncon/#5-1","text":"\u4e00\u65e6\u53d1\u751f\u7f13\u5b58\u7a7f\u900f\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u9488\u5bf9\u67e5\u8be2\u7684\u6570\u636e\uff0c \u5728 Redis \u4e2d\u7f13\u5b58\u4e00\u4e2a\u7a7a\u503c\u6216\u662f\u548c\u4e1a\u52a1\u5c42\u534f\u5546\u786e\u5b9a\u7684\u7f3a\u7701\u503c\uff08\u4f8b\u5982\uff0c\u5e93\u5b58\u7684\u7f3a\u7701\u503c\u53ef\u4ee5\u8bbe\u4e3a 0\uff09\u3002 \u7d27\u63a5\u7740\uff0c \u5e94\u7528\u53d1\u9001\u7684\u540e\u7eed\u8bf7\u6c42\u518d\u8fdb\u884c\u67e5\u8be2\u65f6\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u4ece Redis \u4e2d\u8bfb\u53d6\u7a7a\u503c\u6216\u7f3a\u7701\u503c \uff0c\u8fd4\u56de\u7ed9\u4e1a\u52a1\u5e94\u7528\u4e86\uff0c\u907f\u514d\u4e86\u628a\u5927\u91cf\u8bf7\u6c42\u53d1\u9001\u7ed9\u6570\u636e\u5e93\u5904\u7406\uff0c\u4fdd\u6301\u4e86\u6570\u636e\u5e93\u7684\u6b63\u5e38\u8fd0\u884c\u3002","title":"5-1 \u65b9\u6848\u4e00\uff1a\u7f13\u5b58\u7a7a\u503c\u6216\u7f3a\u7701\u503c"},{"location":"chap5/3redis_mysql_uncon/#5-2","text":"\u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u5feb\u901f\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728\uff0c\u907f\u514d\u4ece\u6570\u636e\u5e93\u4e2d\u67e5\u8be2\u6570\u636e\u662f\u5426\u5b58\u5728\uff0c\u51cf\u8f7b\u6570\u636e\u5e93\u538b\u529b\u3002 \u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u5feb\u901f\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728 \u5e03\u9686\u8fc7\u6ee4\u5668\u7531\u4e00\u4e2a\u521d\u503c\u90fd\u4e3a 0 \u7684 bit \u6570\u7ec4\u548c N \u4e2a\u54c8\u5e0c\u51fd\u6570\u7ec4\u6210\uff0c\u53ef\u4ee5\u7528\u6765\u5feb\u901f\u5224\u65ad\u67d0\u4e2a\u6570\u636e\u662f\u5426\u5b58\u5728\u3002\u5f53\u6211\u4eec\u60f3\u6807\u8bb0\u67d0\u4e2a\u6570\u636e\u5b58\u5728\u65f6\uff08\u4f8b\u5982\uff0c\u6570\u636e\u5df2\u88ab\u5199\u5165\u6570\u636e\u5e93\uff09\uff0c\u5e03\u9686\u8fc7\u6ee4\u5668\u4f1a\u901a\u8fc7\u4e09\u4e2a\u64cd\u4f5c\u5b8c\u6210\u6807\u8bb0\uff1a \u9996\u5148\uff0c\u4f7f\u7528 N \u4e2a\u54c8\u5e0c\u51fd\u6570\uff0c\u5206\u522b\u8ba1\u7b97\u8fd9\u4e2a\u6570\u636e\u7684\u54c8\u5e0c\u503c\uff0c\u5f97\u5230 N \u4e2a\u54c8\u5e0c\u503c\u3002 \u7136\u540e\uff0c\u6211\u4eec\u628a\u8fd9 N \u4e2a\u54c8\u5e0c\u503c\u5bf9 bit \u6570\u7ec4\u7684\u957f\u5ea6\u53d6\u6a21\uff0c\u5f97\u5230\u6bcf\u4e2a\u54c8\u5e0c\u503c\u5728\u6570\u7ec4\u4e2d\u7684\u5bf9\u5e94\u4f4d\u7f6e\u3002 \u6700\u540e\uff0c\u6211\u4eec\u628a\u5bf9\u5e94\u4f4d\u7f6e\u7684 bit \u4f4d\u8bbe\u7f6e\u4e3a 1\uff0c\u8fd9\u5c31\u5b8c\u6210\u4e86\u5728\u5e03\u9686\u8fc7\u6ee4\u5668\u4e2d\u6807\u8bb0\u6570\u636e\u7684\u64cd\u4f5c\u3002 \u5982\u679c\u6570\u636e\u4e0d\u5b58\u5728\uff08\u4f8b\u5982\uff0c\u6570\u636e\u5e93\u91cc\u6ca1\u6709\u5199\u5165\u6570\u636e\uff09\uff0c\u6211\u4eec\u4e5f\u5c31\u6ca1\u6709\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u6807\u8bb0\u8fc7\u6570\u636e\uff0c\u90a3\u4e48\uff0cbit \u6570\u7ec4\u5bf9\u5e94 bit \u4f4d\u7684\u503c\u4ecd\u7136\u4e3a 0\u3002 \u5f53\u9700\u8981\u67e5\u8be2\u67d0\u4e2a\u6570\u636e\u65f6\uff0c\u6211\u4eec\u5c31\u6267\u884c\u521a\u521a\u8bf4\u7684\u8ba1\u7b97\u8fc7\u7a0b\uff0c\u5148\u5f97\u5230\u8fd9\u4e2a\u6570\u636e\u5728 bit \u6570\u7ec4\u4e2d\u5bf9\u5e94\u7684 N \u4e2a\u4f4d\u7f6e\u3002\u7d27\u63a5\u7740\uff0c\u6211\u4eec\u67e5\u770b bit \u6570\u7ec4\u4e2d\u8fd9 N \u4e2a\u4f4d\u7f6e\u4e0a\u7684 bit \u503c\u3002\u53ea\u8981\u8fd9 N \u4e2a bit \u503c\u6709\u4e00\u4e2a\u4e0d\u4e3a 1\uff0c\u8fd9\u5c31\u8868\u660e\u5e03\u9686\u8fc7\u6ee4\u5668\u6ca1\u6709\u5bf9\u8be5\u6570\u636e\u505a\u8fc7\u6807\u8bb0\uff0c\u6240\u4ee5\uff0c\u67e5\u8be2\u7684\u6570\u636e\u4e00\u5b9a\u6ca1\u6709\u5728\u6570\u636e\u5e93\u4e2d\u4fdd\u5b58\u3002 \u6b63\u662f\u57fa\u4e8e\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u5feb\u901f\u68c0\u6d4b\u7279\u6027\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u628a\u6570\u636e\u5199\u5165\u6570\u636e\u5e93\u65f6\uff0c\u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u505a\u4e2a\u6807\u8bb0\u3002\u5f53\u7f13\u5b58\u7f3a\u5931\u540e\uff0c\u5e94\u7528\u67e5\u8be2\u6570\u636e\u5e93\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u67e5\u8be2\u5e03\u9686\u8fc7\u6ee4\u5668\u5feb\u901f\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728\u3002\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5c31\u4e0d\u7528\u518d\u53bb\u6570\u636e\u5e93\u4e2d\u67e5\u8be2\u4e86\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u53d1\u751f\u7f13\u5b58\u7a7f\u900f\u4e86\uff0c\u5927\u91cf\u8bf7\u6c42\u53ea\u4f1a\u67e5\u8be2 Redis \u548c\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u800c\u4e0d\u4f1a\u79ef\u538b\u5230\u6570\u636e\u5e93\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u5f71\u54cd\u6570\u636e\u5e93\u7684\u6b63\u5e38\u8fd0\u884c\u3002\u5e03\u9686\u8fc7\u6ee4\u5668\u53ef\u4ee5\u4f7f\u7528 Redis \u5b9e\u73b0\uff0c\u672c\u8eab\u5c31\u80fd\u627f\u62c5\u8f83\u5927\u7684\u5e76\u53d1\u8bbf\u95ee\u538b\u529b\u3002","title":"5-2 \u65b9\u6848\u4e8c \u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u5feb\u901f\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728"},{"location":"chap5/3redis_mysql_uncon/#5-2_1","text":"\u7f13\u5b58\u7a7f\u900f\u7684\u4e00\u4e2a\u539f\u56e0\u662f\u6709\u5927\u91cf\u7684\u6076\u610f\u8bf7\u6c42\u8bbf\u95ee\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u6240\u4ee5\uff0c\u4e00\u4e2a\u6709\u6548\u7684\u5e94\u5bf9\u65b9\u6848\u662f\u5728\u8bf7\u6c42\u5165\u53e3\u524d\u7aef\uff0c\u5bf9\u4e1a\u52a1\u7cfb\u7edf\u63a5\u6536\u5230\u7684\u8bf7\u6c42\u8fdb\u884c\u5408\u6cd5\u6027\u68c0\u6d4b \uff0c\u628a\u6076\u610f\u7684\u8bf7\u6c42\uff08\u4f8b\u5982\u8bf7\u6c42\u53c2\u6570\u4e0d\u5408\u7406\u3001\u8bf7\u6c42\u53c2\u6570\u662f\u975e\u6cd5\u503c\u3001\u8bf7\u6c42\u5b57\u6bb5\u4e0d\u5b58\u5728\uff09\u76f4\u63a5\u8fc7\u6ee4\u6389\uff0c\u4e0d\u8ba9\u5b83\u4eec\u8bbf\u95ee\u540e\u7aef\u7f13\u5b58\u548c\u6570\u636e\u5e93\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u51fa\u73b0\u7f13\u5b58\u7a7f\u900f\u95ee\u9898\u4e86\u3002 \u8ddf\u7f13\u5b58\u96ea\u5d29\u3001\u7f13\u5b58\u51fb\u7a7f\u8fd9\u4e24\u7c7b\u95ee\u9898\u76f8\u6bd4\uff0c\u7f13\u5b58\u7a7f\u900f\u7684\u5f71\u54cd\u66f4\u5927\u4e00\u4e9b \u4ece\u9884\u9632\u7684\u89d2\u5ea6\u6765\u8bf4\uff0c\u6211\u4eec\u9700\u8981\u907f\u514d\u8bef\u5220\u9664\u6570\u636e\u5e93\u548c\u7f13\u5b58\u4e2d\u7684\u6570\u636e\uff1b \u4ece\u5e94\u5bf9\u89d2\u5ea6\u6765\u8bf4\uff0c \u6211\u4eec\u53ef\u4ee5\u5728\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u4f7f\u7528\u7f13\u5b58\u7a7a\u503c\u6216\u7f3a\u7701\u503c\u3001\u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u4ee5\u53ca\u8fdb\u884c\u6076\u610f\u8bf7\u6c42\u68c0\u6d4b\u7b49\u65b9\u6cd5 \u3002","title":"5-2 \u65b9\u6848\u4e09 \u8bf7\u6c42\u5165\u53e3\u7684\u524d\u7aef\u8fdb\u884c\u8bf7\u6c42\u68c0\u6d4b"},{"location":"chap5/3redis_mysql_uncon/#_2","text":"\u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u6700\u5e38\u9047\u89c1\u7684\u4e00\u4e2a\u95ee\u9898\uff0c\u4e5f\u5c31\u662f\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e0d\u4e00\u81f4\u7684\u95ee\u9898 \u5bf9\u4e8e\u8bfb\u5199\u7f13\u5b58\u6765\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u91c7\u7528\u540c\u6b65\u5199\u56de\u7b56\u7565\uff0c\u90a3\u4e48\u53ef\u4ee5\u4fdd\u8bc1\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u4e00\u81f4\u3002 \u5728\u5927\u591a\u6570\u4e1a\u52a1\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u4f1a\u628a Redis \u4f5c\u4e3a\u53ea\u8bfb\u7f13\u5b58\u4f7f\u7528 \u9488\u5bf9\u53ea\u8bfb\u7f13\u5b58\u6765\u8bf4\uff0c\u6211\u4eec\u65e2\u53ef\u4ee5\u5148\u5220\u9664\u7f13\u5b58\u503c\u518d\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u4e5f\u53ef\u4ee5\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u9664\u7f13\u5b58\u3002\u6211\u7684\u5efa\u8bae\u662f\uff0c \u4f18\u5148\u4f7f\u7528\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u9664\u7f13\u5b58\u7684\u65b9\u6cd5 \uff0c\u539f\u56e0\u4e3b\u8981\u6709\u4e24\u4e2a\uff1a \u5148\u5220\u9664\u7f13\u5b58\u503c\u518d\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u6709\u53ef\u80fd\u5bfc\u81f4\u8bf7\u6c42\u56e0\u7f13\u5b58\u7f3a\u5931\u800c\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u538b\u529b\uff1b \u5982\u679c\u4e1a\u52a1\u5e94\u7528\u4e2d\u8bfb\u53d6\u6570\u636e\u5e93\u548c\u5199\u7f13\u5b58\u7684\u65f6\u95f4\u4e0d\u597d\u4f30\u7b97\uff0c\u90a3\u4e48\uff0c\u5ef6\u8fdf\u53cc\u5220\u4e2d\u7684\u7b49\u5f85\u65f6\u95f4\u5c31\u4e0d\u597d\u8bbe\u7f6e\u3002 \u4e0d\u8fc7\uff0c\u5f53\u4f7f\u7528\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u9664\u7f13\u5b58\u65f6\uff0c\u4e5f\u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\uff0c \u5982\u679c\u4e1a\u52a1\u5c42\u8981\u6c42\u5fc5\u987b\u8bfb\u53d6\u4e00\u81f4\u7684\u6570\u636e\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5728\u66f4\u65b0\u6570\u636e\u5e93\u65f6\uff0c\u5148\u5728 Redis \u7f13\u5b58\u5ba2\u6237\u7aef\u6682\u5b58\u5e76\u53d1\u8bfb\u8bf7\u6c42\uff0c\u7b49\u6570\u636e\u5e93\u66f4\u65b0\u5b8c\u3001\u7f13\u5b58\u503c\u5220\u9664\u540e\uff0c\u518d\u8bfb\u53d6\u6570\u636e\uff0c\u4ece\u800c\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027 \u3002 \u7f13\u5b58\u96ea\u5d29\u548c\u51fb\u7a7f\u4e3b\u8981\u662f\u56e0\u4e3a\u6570\u636e\u4e0d\u5728\u7f13\u5b58\u4e2d\u4e86\uff0c\u800c\u7f13\u5b58\u7a7f\u900f\u5219\u662f\u56e0\u4e3a\u6570\u636e\u65e2\u4e0d\u5728\u7f13\u5b58\u4e2d\uff0c\u4e5f\u4e0d\u5728\u6570\u636e\u5e93\u4e2d\u3002 \u6240\u4ee5\uff0c\u7f13\u5b58\u96ea\u5d29\u6216\u51fb\u7a7f\u65f6\uff0c \u4e00\u65e6\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u88ab\u518d\u6b21\u5199\u5165\u5230\u7f13\u5b58\u540e\uff0c\u5e94\u7528\u53c8\u53ef\u4ee5\u5728\u7f13\u5b58\u4e2d\u5feb\u901f\u8bbf\u95ee\u6570\u636e\u4e86 \uff0c\u6570\u636e\u5e93\u7684\u538b\u529b\u4e5f\u4f1a\u76f8\u5e94\u5730\u964d\u4f4e\u4e0b\u6765 \u800c\u7f13\u5b58\u7a7f\u900f\u53d1\u751f\u65f6 \uff0cRedis \u7f13\u5b58\u548c\u6570\u636e\u5e93\u4f1a\u540c\u65f6\u6301\u7eed\u627f\u53d7\u8bf7\u6c42\u538b\u529b\u3002 \u670d\u52a1\u7194\u65ad\u3001\u670d\u52a1\u964d\u7ea7\u3001\u8bf7\u6c42\u9650\u6d41\u8fd9\u4e9b\u65b9\u6cd5\u90fd\u662f\u5c5e\u4e8e\u201c\u6709\u635f\u201d\u65b9\u6848\uff0c\u5728\u4fdd\u8bc1\u6570\u636e\u5e93\u548c\u6574\u4f53\u7cfb\u7edf\u7a33\u5b9a\u7684\u540c\u65f6\uff0c\u4f1a\u5bf9\u4e1a\u52a1\u5e94\u7528\u5e26\u6765\u8d1f\u9762\u5f71\u54cd\u3002 \u4f8b\u5982\u4f7f\u7528\u670d\u52a1\u964d\u7ea7\u65f6\uff0c\u6709\u90e8\u5206\u6570\u636e\u7684\u8bf7\u6c42\u5c31\u53ea\u80fd\u5f97\u5230\u9519\u8bef\u8fd4\u56de\u4fe1\u606f\uff0c\u65e0\u6cd5\u6b63\u5e38\u5904\u7406\u3002\u5982\u679c\u4f7f\u7528\u4e86\u670d\u52a1\u7194\u65ad\uff0c\u90a3\u4e48\uff0c\u6574\u4e2a\u7f13\u5b58\u7cfb\u7edf\u7684\u670d\u52a1\u90fd\u88ab\u6682\u505c\u4e86\uff0c\u5f71\u54cd\u7684\u4e1a\u52a1\u8303\u56f4\u66f4\u5927\u3002\u800c\u4f7f\u7528\u4e86\u8bf7\u6c42\u9650\u6d41\u673a\u5236\u540e\uff0c\u6574\u4e2a\u4e1a\u52a1\u7cfb\u7edf\u7684\u541e\u5410\u7387\u4f1a\u964d\u4f4e\uff0c\u80fd\u5e76\u53d1\u5904\u7406\u7684\u7528\u6237\u8bf7\u6c42\u4f1a\u51cf\u5c11\uff0c\u4f1a\u5f71\u54cd\u5230\u7528\u6237\u4f53\u9a8c \u5c3d\u91cf\u4f7f\u7528\u9884\u9632\u5f0f\u65b9\u6848\uff1a \u9488\u5bf9\u7f13\u5b58\u96ea\u5d29\uff0c\u5408\u7406\u5730\u8bbe\u7f6e\u6570\u636e\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u53ca\u642d\u5efa\u9ad8\u53ef\u9760\u7f13\u5b58\u96c6\u7fa4 \uff1b \u9488\u5bf9\u7f13\u5b58\u51fb\u7a7f\uff0c\u5728\u7f13\u5b58\u8bbf\u95ee\u975e\u5e38\u9891\u7e41\u7684\u70ed\u70b9\u6570\u636e\u65f6\uff0c\u4e0d\u8981\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff1b \u9488\u5bf9\u7f13\u5b58\u7a7f\u900f\uff0c\u63d0\u524d\u5728\u5165\u53e3\u524d\u7aef\u5b9e\u73b0\u6076\u610f\u8bf7\u6c42\u68c0\u6d4b\uff0c\u6216\u8005\u89c4\u8303\u6570\u636e\u5e93\u7684\u6570\u636e\u5220\u9664\u64cd\u4f5c\uff0c\u907f\u514d\u8bef\u5220\u9664\u3002","title":"\u672c\u8282\u5c0f\u7ed3"},{"location":"chap5/4redis_contamination/","text":"\u7b2c\u56db\u8282 \u7f13\u5b58\u88ab\u6c61\u67d3\u7684\u89e3\u51b3\u95ee\u9898 1\u3001\u7f13\u5b58\u6c61\u67d3 \u90a3\u4ec0\u4e48\u662f\u7f13\u5b58\u6c61\u67d3\u5462\uff1f\u5728\u4e00\u4e9b\u573a\u666f\u4e0b\uff0c\u6709\u4e9b\u6570\u636e\u88ab\u8bbf\u95ee\u7684\u6b21\u6570\u975e\u5e38\u5c11\uff0c \u751a\u81f3\u53ea\u4f1a\u88ab\u8bbf\u95ee\u4e00\u6b21\u3002\u5f53\u8fd9\u4e9b\u6570\u636e\u670d\u52a1\u5b8c\u8bbf\u95ee\u8bf7\u6c42\u540e\uff0c\u5982\u679c\u8fd8\u7ee7\u7eed\u7559\u5b58\u5728\u7f13\u5b58\u4e2d\u7684\u8bdd\uff0c\u5c31\u53ea\u4f1a\u767d\u767d\u5360\u7528\u7f13\u5b58\u7a7a\u95f4\u3002\u8fd9\u79cd\u60c5\u51b5\uff0c\u5c31\u662f\u7f13\u5b58\u6c61\u67d3 \u3002 \u5f53\u7f13\u5b58\u6c61\u67d3\u4e0d\u4e25\u91cd\u65f6\uff0c\u53ea\u6709\u5c11\u91cf\u6570\u636e\u5360\u636e\u7f13\u5b58\u7a7a\u95f4\uff0c\u6b64\u65f6\uff0c\u5bf9\u7f13\u5b58\u7cfb\u7edf\u7684\u5f71\u54cd\u4e0d\u5927\u3002 \u4f46\u662f\uff0c\u7f13\u5b58\u6c61\u67d3\u4e00\u65e6\u53d8\u5f97\u4e25\u91cd\u540e\uff0c\u5c31\u4f1a\u6709\u5927\u91cf\u4e0d\u518d\u8bbf\u95ee\u7684\u6570\u636e\u6ede\u7559\u5728\u7f13\u5b58\u4e2d\u3002\u5982\u679c\u8fd9\u65f6\u6570\u636e\u5360\u6ee1\u4e86\u7f13\u5b58\u7a7a\u95f4\uff0c\u6211\u4eec\u518d\u5f80\u7f13\u5b58\u4e2d\u5199\u5165\u65b0\u6570\u636e\u65f6\uff0c\u5c31\u9700\u8981\u5148\u628a\u8fd9\u4e9b\u6570\u636e\u9010\u6b65\u6dd8\u6c70\u51fa\u7f13\u5b58\uff0c\u8fd9\u5c31\u4f1a\u5f15\u5165\u989d\u5916\u7684\u64cd\u4f5c\u65f6\u95f4\u5f00\u9500\uff0c\u8fdb\u800c\u4f1a\u5f71\u54cd\u5e94\u7528\u7684\u6027\u80fd\u3002 2\u3001\u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u6c61\u67d3\u95ee\u9898\uff1f 8 \u79cd\u6570\u636e\u6dd8\u6c70\u7b56\u7565 \u5b83\u4eec\u5206\u522b\u662f noeviction \u3001 volatile-random \u3001 volatile-ttl \u3001 volatile-lru \u3001 volatile-lfu \u3001 allkeys-lru \u3001 allkeys-random \u548c allkeys-lfu \u7b56\u7565\u3002 \u5728\u8fd9 8 \u79cd\u7b56\u7565\u4e2d\uff0c noeviction \u7b56\u7565\u662f\u4e0d\u4f1a\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u7684 \u3002\u6240\u4ee5\uff0c\u5b83\u80af\u5b9a\u4e0d\u80fd\u7528\u6765\u89e3\u51b3\u7f13\u5b58\u6c61\u67d3\u95ee\u9898\u3002\u5176\u4ed6\u7684 7 \u79cd\u7b56\u7565\uff0c\u90fd\u4f1a\u6309\u7167\u4e00\u5b9a\u7684\u89c4\u5219\u6765\u6dd8\u6c70\u6570\u636e\u3002 \u56e0\u4e3a LRU \u7b97\u6cd5\u662f\u6211\u4eec\u5728\u7f13\u5b58\u6570\u636e\u6dd8\u6c70\u7b56\u7565\u4e2d\u5e7f\u6cdb\u5e94\u7528\u7684\u7b97\u6cd5\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u5206\u6790\u5176\u4ed6\u7b56\u7565\uff0c\u7136\u540e\u5355\u72ec\u5206\u6790\u6dd8\u6c70\u7b56\u7565\u4f7f\u7528 LRU \u7b97\u6cd5\u7684\u60c5\u51b5\uff0c\u6700\u540e\u518d\u5b66\u4e60\u4e0b LFU \u7b97\u6cd5\u7528\u4e8e\u6dd8\u6c70\u7b56\u7565\u65f6\uff0c\u5bf9\u7f13\u5b58\u6c61\u67d3\u7684\u5e94\u5bf9\u63aa\u65bd\u3002 \u4f7f\u7528 LRU \u7b97\u6cd5\u548c LFU \u7b97\u6cd5\u7684\u7b56\u7565\u5404\u6709\u4e24\u79cd\uff08volatile-lru \u548c allkeys-lru\uff0c\u4ee5\u53ca volatile-lfu \u548c allkeys-lfu\uff09\uff0c\u4e3a\u4e86\u4fbf\u4e8e\u7406\u89e3\uff0c\u63a5\u4e0b\u6765\u6211\u4f1a\u7edf\u4e00\u628a\u5b83\u4eec\u53eb\u4f5c LRU \u7b56\u7565\u548c LFU \u7b56\u7565\u3002 2-1 volatile-random \u548c allkeys-random \u5b83\u4eec\u90fd\u662f\u91c7\u7528\u968f\u673a\u6311\u9009\u6570\u636e\u7684\u65b9\u5f0f\uff0c\u6765\u7b5b\u9009\u5373\u5c06\u88ab\u6dd8\u6c70\u7684\u6570\u636e\u3002 \u65e2\u7136\u662f\u968f\u673a\u6311\u9009\uff0c\u90a3\u4e48 Redis \u5c31\u4e0d\u4f1a\u6839\u636e\u6570\u636e\u7684\u8bbf\u95ee\u60c5\u51b5\u6765\u7b5b\u9009\u6570\u636e\u3002 \u5982\u679c\u88ab\u6dd8\u6c70\u7684\u6570\u636e\u53c8\u88ab\u8bbf\u95ee\u4e86\uff0c\u5c31\u4f1a\u53d1\u751f\u7f13\u5b58\u7f3a\u5931\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5e94\u7528\u9700\u8981\u5230\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u8bbf\u95ee\u8fd9\u4e9b\u6570\u636e\uff0c\u964d\u4f4e\u4e86\u5e94\u7528\u7684\u8bf7\u6c42\u54cd\u5e94\u901f\u5ea6\u3002\u6240\u4ee5\uff0c volatile-random \u548c allkeys-random \u7b56\u7565\uff0c\u5728\u907f\u514d\u7f13\u5b58\u6c61\u67d3\u8fd9\u4e2a\u95ee\u9898\u4e0a\u7684\u6548\u679c\u975e\u5e38\u6709\u9650\u3002 \u6211\u7ed9\u4f60\u4e3e\u4e2a\u4f8b\u5b50\u5427\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5047\u8bbe\u6211\u4eec\u914d\u7f6e Redis \u7f13\u5b58\u4f7f\u7528 allkeys-random \u6dd8\u6c70\u7b56\u7565\uff0c\u5f53\u7f13\u5b58\u5199\u6ee1\u65f6\uff0callkeys-random \u7b56\u7565\u968f\u673a\u9009\u62e9\u4e86\u6570\u636e 20 \u8fdb\u884c\u6dd8\u6c70\u3002\u4e0d\u5de7\u7684\u662f\uff0c\u6570\u636e 20 \u7d27\u63a5\u7740\u53c8\u88ab\u8bbf\u95ee\u4e86\uff0c\u6b64\u65f6\uff0cRedis \u5c31\u4f1a\u53d1\u751f\u4e86\u7f13\u5b58\u7f3a\u5931\u3002 \u7ee7\u7eed\u770b volatile-ttl \u7b56\u7565\u662f\u5426\u80fd\u6709\u6548\u5e94\u5bf9\u7f13\u5b58\u6c61\u67d3\u3002 volatile-ttl \u9488\u5bf9\u7684\u662f\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\uff0c\u628a\u8fd9\u4e9b\u6570\u636e\u4e2d\u5269\u4f59\u5b58\u6d3b\u65f6\u95f4\u6700\u77ed\u7684\u7b5b\u9009\u51fa\u6765\u5e76\u6dd8\u6c70\u6389\u3002 \u867d\u7136 volatile-ttl \u7b56\u7565\u4e0d\u518d\u662f\u968f\u673a\u9009\u62e9\u6dd8\u6c70\u6570\u636e\u4e86 \uff0c\u4f46\u662f\u5269\u4f59\u5b58\u6d3b\u65f6\u95f4\u5e76\u4e0d\u80fd\u76f4\u63a5\u53cd\u6620\u6570\u636e\u518d\u6b21\u8bbf\u95ee\u7684\u60c5\u51b5 \u3002\u6240\u4ee5\uff0c\u6309\u7167 volatile-ttl \u7b56\u7565\u6dd8\u6c70\u6570\u636e\uff0c \u548c\u6309\u968f\u673a\u65b9\u5f0f\u6dd8\u6c70\u6570\u636e\u7c7b\u4f3c\uff0c\u4e5f\u53ef\u80fd\u51fa\u73b0\u6570\u636e\u88ab\u6dd8\u6c70\u540e\uff0c\u88ab\u518d\u6b21\u8bbf\u95ee\u5bfc\u81f4\u7684\u7f13\u5b58\u7f3a\u5931\u95ee\u9898\u3002 \u4f8b\u5916\u7684\u60c5\u51b5\uff1a\u4e1a\u52a1\u5e94\u7528\u5728\u7ed9\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u65f6\u5019\uff0c\u5c31\u660e\u786e\u77e5\u9053\u6570\u636e\u88ab\u518d\u6b21\u8bbf\u95ee\u7684\u60c5\u51b5\uff0c\u5e76\u6839\u636e\u8bbf\u95ee\u60c5\u51b5\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002 \u6b64\u65f6\uff0cRedis \u6309\u7167\u6570\u636e\u7684\u5269\u4f59\u6700\u77ed\u5b58\u6d3b\u65f6\u95f4\u8fdb\u884c\u7b5b\u9009\uff0c\u662f\u53ef\u4ee5\u628a\u4e0d\u4f1a\u518d\u88ab\u8bbf\u95ee\u7684\u6570\u636e\u7b5b\u9009\u51fa\u6765\u7684\uff0c\u8fdb\u800c\u907f\u514d\u7f13\u5b58\u6c61\u67d3\u3002\u4f8b\u5982\uff0c\u4e1a\u52a1\u90e8\u95e8\u77e5\u9053\u6570\u636e\u88ab\u8bbf\u95ee\u7684\u65f6\u957f\u5c31\u662f\u4e00\u4e2a\u5c0f\u65f6\uff0c\u5e76\u628a\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u5c0f\u65f6\u540e\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u88ab\u6dd8\u6c70\u7684\u6570\u636e\u7684\u786e\u662f\u4e0d\u4f1a\u518d\u88ab\u8bbf\u95ee\u4e86\u3002 \u5c0f\u7ed3: \u9664\u4e86\u5728\u660e\u786e\u77e5\u9053\u6570\u636e\u88ab\u518d\u6b21\u8bbf\u95ee\u7684\u60c5\u51b5\u4e0b\uff0c volatile-ttl \u53ef\u4ee5\u6709\u6548\u907f\u514d\u7f13\u5b58\u6c61\u67d3\u3002\u5728\u5176\u4ed6\u60c5\u51b5\u4e0b\uff0c volatile-random \u3001 allkeys-random \u3001 volatile-ttl \u8fd9\u4e09\u79cd\u7b56\u7565\u5e76\u4e0d\u80fd\u5e94\u5bf9\u7f13\u5b58\u6c61\u67d3\u95ee\u9898\u3002 \u518d\u5206\u522b\u5206\u6790\u4e0b LRU \u7b56\u7565\uff0c\u4ee5\u53ca Redis 4.0 \u540e\u5b9e\u73b0\u7684 LFU \u7b56\u7565 \u3002LRU \u7b56\u7565\u4f1a\u6309\u7167\u6570\u636e\u8bbf\u95ee\u7684\u65f6\u6548\u6027\uff0c\u6765\u7b5b\u9009\u5373\u5c06\u88ab\u6dd8\u6c70\u7684\u6570\u636e\uff0c\u5e94\u7528\u975e\u5e38\u5e7f\u6cdb\u3002 3\u3001LRU \u7f13\u5b58\u7b56\u7565 LRU \u7b56\u7565\u7684\u6838\u5fc3\u601d\u60f3\uff1a\u5982\u679c\u4e00\u4e2a\u6570\u636e\u521a\u521a\u88ab\u8bbf\u95ee\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6570\u636e\u80af\u5b9a\u662f\u70ed\u6570\u636e\uff0c\u8fd8\u4f1a\u88ab\u518d\u6b21\u8bbf\u95ee\u3002 Redis \u4e2d\u7684 LRU \u7b56\u7565\uff0c\u4f1a\u5728\u6bcf\u4e2a\u6570\u636e\u5bf9\u5e94\u7684 RedisObject \u7ed3\u6784\u4f53\u4e2d\u8bbe\u7f6e\u4e00\u4e2a lru \u5b57\u6bb5\uff0c\u7528\u6765\u8bb0\u5f55\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u95f4\u6233\u3002 \u5728\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u65f6\uff0cLRU \u7b56\u7565\u4f1a\u5728\u5019\u9009\u6570\u636e\u96c6\u4e2d\u6dd8\u6c70\u6389 lru \u5b57\u6bb5\u503c\u6700\u5c0f\u7684\u6570\u636e\uff08\u4e5f\u5c31\u662f\u8bbf\u95ee\u65f6\u95f4\u6700\u4e45\u7684\u6570\u636e\uff09\u3002 \u6240\u4ee5\uff0c\u5728\u6570\u636e\u88ab\u9891\u7e41\u8bbf\u95ee\u7684\u4e1a\u52a1\u573a\u666f\u4e2d\uff0cLRU \u7b56\u7565\u7684\u786e\u80fd\u6709\u6548\u7559\u5b58\u8bbf\u95ee\u65f6\u95f4\u6700\u8fd1\u7684\u6570\u636e\u3002\u800c\u4e14\uff0c\u56e0\u4e3a\u7559\u5b58\u7684\u8fd9\u4e9b\u6570\u636e\u8fd8\u4f1a\u88ab\u518d\u6b21\u8bbf\u95ee\uff0c\u6240\u4ee5\u53c8\u53ef\u4ee5\u63d0\u5347\u4e1a\u52a1\u5e94\u7528\u7684\u8bbf\u95ee\u901f\u5ea6\u3002 \u4f46\u662f\uff0c\u4e5f\u6b63\u662f\u56e0\u4e3a\u53ea\u770b\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u95f4\uff0c\u4f7f\u7528 LRU \u7b56\u7565\u5728\u5904\u7406\u626b\u63cf\u5f0f\u5355\u6b21\u67e5\u8be2\u64cd\u4f5c\u65f6\uff0c\u65e0\u6cd5\u89e3\u51b3\u7f13\u5b58\u6c61\u67d3\u3002 \u6240\u8c13\u7684\u626b\u63cf\u5f0f\u5355\u6b21\u67e5\u8be2\u64cd\u4f5c\uff0c\u5c31\u662f\u6307\u5e94\u7528\u5bf9\u5927\u91cf\u7684\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u5168\u4f53\u8bfb\u53d6\uff0c\u6bcf\u4e2a\u6570\u636e\u90fd\u4f1a\u88ab\u8bfb\u53d6\uff0c\u800c\u4e14\u53ea\u4f1a\u88ab\u8bfb\u53d6\u4e00\u6b21\u3002\u6b64\u65f6\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u88ab\u67e5\u8be2\u7684\u6570\u636e\u521a\u521a\u88ab\u8bbf\u95ee\u8fc7\uff0c\u6240\u4ee5 lru \u5b57\u6bb5\u503c\u90fd\u5f88\u5927\u3002 \u5728\u4f7f\u7528 LRU \u7b56\u7565\u6dd8\u6c70\u6570\u636e\u65f6\uff0c\u8fd9\u4e9b\u6570\u636e\u4f1a\u7559\u5b58\u5728\u7f13\u5b58\u4e2d\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\uff0c\u9020\u6210\u7f13\u5b58\u6c61\u67d3\u3002 \u5982\u679c\u67e5\u8be2\u7684\u6570\u636e\u91cf\u5f88\u5927\uff0c\u8fd9\u4e9b\u6570\u636e\u5360\u6ee1\u4e86\u7f13\u5b58\u7a7a\u95f4\uff0c\u5374\u53c8\u4e0d\u4f1a\u670d\u52a1\u65b0\u7684\u7f13\u5b58\u8bf7\u6c42\uff0c\u6b64\u65f6\uff0c \u518d\u6709\u65b0\u6570\u636e\u8981\u5199\u5165\u7f13\u5b58\u7684\u8bdd\uff0c\u8fd8\u662f\u9700\u8981\u5148\u628a\u8fd9\u4e9b\u65e7\u6570\u636e\u66ff\u6362\u51fa\u7f13\u5b58\u624d\u884c\uff0c\u8fd9\u4f1a\u5f71\u54cd\u7f13\u5b58\u7684\u6027\u80fd\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff0c\u6570\u636e 6 \u88ab\u8bbf\u95ee\u540e\uff0c\u88ab\u5199\u5165 Redis \u7f13\u5b58\u3002\u4f46\u662f\uff0c\u5728\u6b64\u4e4b\u540e\uff0c\u6570\u636e 6 \u4e00\u76f4\u6ca1\u6709\u88ab\u518d\u6b21\u8bbf\u95ee\uff0c\u8fd9\u5c31\u5bfc\u81f4\u6570\u636e 6 \u6ede\u7559\u5728\u7f13\u5b58\u4e2d\uff0c\u9020\u6210\u4e86\u6c61\u67d3\u3002 \u6240\u4ee5\uff0c\u5bf9\u4e8e\u91c7\u7528\u4e86 LRU \u7b56\u7565\u7684 Redis \u7f13\u5b58\u6765\u8bf4\uff0c\u626b\u63cf\u5f0f\u5355\u6b21\u67e5\u8be2\u4f1a\u9020\u6210\u7f13\u5b58\u6c61\u67d3\u3002 \u4e3a\u4e86\u5e94\u5bf9\u8fd9\u7c7b\u7f13\u5b58\u6c61\u67d3\u95ee\u9898\uff0cRedis \u4ece 4.0 \u7248\u672c\u5f00\u59cb\u589e\u52a0\u4e86 LFU \u6dd8\u6c70\u7b56\u7565\u3002 \u4e0e LRU \u7b56\u7565\u76f8\u6bd4\uff0cLFU \uff08Frequent\uff09\u7b56\u7565\u4e2d\u4f1a\u4ece\u4e24\u4e2a\u7ef4\u5ea6\u6765\u7b5b\u9009\u5e76\u6dd8\u6c70\u6570\u636e\uff1a \u4e00\u662f\uff0c\u6570\u636e\u8bbf\u95ee\u7684\u65f6\u6548\u6027\uff08\u8bbf\u95ee\u65f6\u95f4\u79bb\u5f53\u524d\u65f6\u95f4\u7684\u8fdc\u8fd1\uff09\uff1b \u4e8c\u662f\uff0c\u6570\u636e\u7684\u88ab\u8bbf\u95ee\u6b21\u6570\u3002 4\u3001LFU \u7f13\u5b58\u7b56\u7565\u7684\u4f18\u5316 4-1 LFU\u4ecb\u7ecd LFU \u7f13\u5b58\u7b56\u7565\u662f\u5728 LRU \u7b56\u7565\u57fa\u7840\u4e0a\uff0c\u4e3a\u6bcf\u4e2a\u6570\u636e\u589e\u52a0\u4e86\u4e00\u4e2a\u8ba1\u6570\u5668\uff0c\u6765\u7edf\u8ba1\u8fd9\u4e2a\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u3002 \u5f53\u4f7f\u7528 LFU \u7b56\u7565\u7b5b\u9009\u6dd8\u6c70\u6570\u636e\u65f6\uff0c \u9996\u5148\u4f1a\u6839\u636e\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u8fdb\u884c\u7b5b\u9009\uff0c\u628a\u8bbf\u95ee\u6b21\u6570\u6700\u4f4e\u7684\u6570\u636e\u6dd8\u6c70\u51fa\u7f13\u5b58\u3002 \u5982\u679c\u4e24\u4e2a\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u76f8\u540c\uff0c LFU \u7b56\u7565\u518d\u6bd4\u8f83\u8fd9\u4e24\u4e2a\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u6548\u6027\uff0c\u628a\u8ddd\u79bb\u4e0a\u4e00\u6b21\u8bbf\u95ee\u65f6\u95f4\u66f4\u4e45\u7684\u6570\u636e\u6dd8\u6c70\u51fa\u7f13\u5b58\u3002 \u548c\u90a3\u4e9b\u88ab\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\u76f8\u6bd4\uff0c\u626b\u63cf\u5f0f\u5355\u6b21\u67e5\u8be2\u7684\u6570\u636e\u56e0\u4e3a\u4e0d\u4f1a\u88ab\u518d\u6b21\u8bbf\u95ee\uff0c\u6240\u4ee5\u5b83\u4eec\u7684\u8bbf\u95ee\u6b21\u6570\u4e0d\u4f1a\u518d\u589e\u52a0\u3002\u56e0\u6b64\uff0c LFU \u7b56\u7565\u4f1a\u4f18\u5148\u628a\u8fd9\u4e9b\u8bbf\u95ee\u6b21\u6570\u4f4e\u7684\u6570\u636e\u6dd8\u6c70\u51fa\u7f13\u5b58 \u3002\u8fd9\u6837\u4e00\u6765\uff0cLFU \u7b56\u7565\u5c31\u53ef\u4ee5\u907f\u514d\u8fd9\u4e9b\u6570\u636e\u5bf9\u7f13\u5b58\u9020\u6210\u6c61\u67d3\u4e86\u3002 4-2 LFU \u7b56\u7565\u5177\u4f53\u53c8\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u5462 \u4e3a\u4e86\u907f\u514d\u64cd\u4f5c\u94fe\u8868\u7684\u5f00\u9500\uff0cRedis \u5728\u5b9e\u73b0 LRU \u7b56\u7565\u65f6\u4f7f\u7528\u4e86\u4e24\u4e2a\u8fd1\u4f3c\u65b9\u6cd5\uff1a Redis \u662f\u7528 RedisObject \u7ed3\u6784\u6765\u4fdd\u5b58\u6570\u636e\u7684\uff0cRedisObject \u7ed3\u6784\u4e2d\u8bbe\u7f6e\u4e86\u4e00\u4e2a lru \u5b57\u6bb5\uff0c\u7528\u6765\u8bb0\u5f55\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u95f4\u6233\uff1b Redis \u5e76\u6ca1\u6709\u4e3a\u6240\u6709\u7684\u6570\u636e\u7ef4\u62a4\u4e00\u4e2a\u5168\u5c40\u7684\u94fe\u8868\uff0c\u800c\u662f\u901a\u8fc7\u968f\u673a\u91c7\u6837\u65b9\u5f0f\uff0c\u9009\u53d6\u4e00\u5b9a\u6570\u91cf\uff08\u4f8b\u5982 10 \u4e2a\uff09\u7684\u6570\u636e\u653e\u5165\u5019\u9009\u96c6\u5408\uff0c\u540e\u7eed\u5728\u5019\u9009\u96c6\u5408\u4e2d\u6839\u636e lru \u5b57\u6bb5\u503c\u7684\u5927\u5c0f\u8fdb\u884c\u7b5b\u9009\u3002 \u5728\u6b64\u57fa\u7840\u4e0a\uff0cRedis \u5728\u5b9e\u73b0 LFU \u7b56\u7565\u7684\u65f6\u5019\uff0c\u53ea\u662f\u628a\u539f\u6765 24bit \u5927\u5c0f\u7684 lru \u5b57\u6bb5\uff0c\u53c8\u8fdb\u4e00\u6b65\u62c6\u5206\u6210\u4e86\u4e24\u90e8\u5206\u3002 ldt \u503c\uff1alru \u5b57\u6bb5\u7684\u524d 16bit\uff0c\u8868\u793a\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u95f4\u6233\uff1b counter \u503c\uff1alru \u5b57\u6bb5\u7684\u540e 8bit\uff0c\u8868\u793a\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u3002 Redis \u53ea\u4f7f\u7528\u4e86 8bit \u8bb0\u5f55\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u800c 8bit \u8bb0\u5f55\u7684\u6700\u5927\u503c\u662f 255\uff0c\u8fd9\u6837\u53ef\u4ee5\u5417\uff1f \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u4e00\u4e2a\u6570\u636e\u53ef\u80fd\u4f1a\u88ab\u8bbf\u95ee\u6210\u5343\u4e0a\u4e07\u6b21\u3002 \u5982\u679c\u6bcf\u88ab\u8bbf\u95ee\u4e00\u6b21\uff0ccounter \u503c\u5c31\u52a0 1 \u7684\u8bdd\uff0c\u90a3\u4e48\uff0c\u53ea\u8981\u8bbf\u95ee\u6b21\u6570\u8d85\u8fc7\u4e86 255\uff0c\u6570\u636e\u7684 counter \u503c\u5c31\u4e00\u6837\u4e86 \u3002\u5728\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u65f6\uff0cLFU \u7b56\u7565\u5c31\u65e0\u6cd5\u5f88\u597d\u5730\u533a\u5206\u5e76\u7b5b\u9009\u8fd9\u4e9b\u6570\u636e\uff0c\u53cd\u800c\u8fd8\u53ef\u80fd\u4f1a\u628a\u4e0d\u600e\u4e48\u8bbf\u95ee\u7684\u6570\u636e\u7559\u5b58\u5728\u4e86\u7f13\u5b58\u4e2d\u3002 \u5047\u8bbe\u7b2c\u4e00\u4e2a\u6570\u636e A \u7684\u7d2f\u8ba1\u8bbf\u95ee\u6b21\u6570\u662f 256\uff0c\u8bbf\u95ee\u65f6\u95f4\u6233\u662f 202010010909\uff0c\u6240\u4ee5\u5b83\u7684 counter \u503c\u4e3a 255\uff0c\u800c\u7b2c\u4e8c\u4e2a\u6570\u636e B \u7684\u7d2f\u8ba1\u8bbf\u95ee\u6b21\u6570\u662f 1024\uff0c\u8bbf\u95ee\u65f6\u95f4\u6233\u662f 202010010810\u3002\u5982\u679c counter \u503c\u53ea\u80fd\u8bb0\u5f55\u5230 255\uff0c\u90a3\u4e48\u6570\u636e B \u7684 counter \u503c\u4e5f\u662f 255\u3002 \u6b64\u65f6\uff0c\u7f13\u5b58\u5199\u6ee1\u4e86\uff0cRedis \u4f7f\u7528 LFU \u7b56\u7565\u8fdb\u884c\u6dd8\u6c70\u3002\u6570\u636e A \u548c B \u7684 counter \u503c\u90fd\u662f 255\uff0cLFU \u7b56\u7565\u518d\u6bd4\u8f83 A \u548c B \u7684\u8bbf\u95ee\u65f6\u95f4\u6233\uff0c\u53d1\u73b0\u6570\u636e B \u7684\u4e0a\u4e00\u6b21\u8bbf\u95ee\u65f6\u95f4\u65e9\u4e8e A\uff0c\u5c31\u4f1a\u628a B \u6dd8\u6c70\u6389\u3002 \u4f46\u5176\u5b9e\u6570\u636e B \u7684\u8bbf\u95ee\u6b21\u6570\u8fdc\u5927\u4e8e\u6570\u636e A\uff0c\u5f88\u53ef\u80fd\u4f1a\u88ab\u518d\u6b21\u8bbf\u95ee\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4f7f\u7528 LFU \u7b56\u7565\u6765\u6dd8\u6c70\u6570\u636e\u5c31\u4e0d\u5408\u9002\u4e86\u3002 Redis \u4e5f\u6ce8\u610f\u5230\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002\u56e0\u6b64\uff0c \u5728\u5b9e\u73b0 LFU \u7b56\u7565\u65f6\uff0cRedis \u5e76\u6ca1\u6709\u91c7\u7528\u6570\u636e\u6bcf\u88ab\u8bbf\u95ee\u4e00\u6b21\uff0c\u5c31\u7ed9\u5bf9\u5e94\u7684 counter \u503c\u52a0 1 \u7684\u8ba1\u6570\u89c4\u5219\uff0c\u800c\u662f\u91c7\u7528\u4e86\u4e00\u4e2a\u66f4\u4f18\u5316\u7684\u8ba1\u6570\u89c4\u5219\u3002 LFU \u7b56\u7565\u5b9e\u73b0\u7684\u8ba1\u6570\u89c4\u5219\u662f \uff1a\u6bcf\u5f53\u6570\u636e\u88ab\u8bbf\u95ee\u4e00\u6b21\u65f6\uff0c \u9996\u5148\uff0c\u7528\u8ba1\u6570\u5668\u5f53\u524d\u7684\u503c\u4e58\u4ee5\u914d\u7f6e\u9879 lfu_log_factor \u518d\u52a0 1\uff0c\u518d\u53d6\u5176\u5012\u6570\uff0c\u5f97\u5230\u4e00\u4e2a p \u503c\uff1b \u7136\u540e\uff0c\u628a\u8fd9\u4e2a p \u503c\u548c\u4e00\u4e2a\u53d6\u503c\u8303\u56f4\u5728`\uff080\uff0c1\uff09\u95f4\u7684\u968f\u673a\u6570 r \u503c\u6bd4\u5927\u5c0f\uff0c\u53ea\u6709 p \u503c\u5927\u4e8e r \u503c\u65f6\uff0c\u8ba1\u6570\u5668\u624d\u52a0 1\u3002 Redis \u7684\u90e8\u5206\u6e90\u7801\uff0c\u663e\u793a\u4e86 LFU \u7b56\u7565\u589e\u52a0\u8ba1\u6570\u5668\u503c\u7684\u8ba1\u7b97\u903b\u8f91\u3002\u5176\u4e2d\uff0cbaseval \u662f\u8ba1\u6570\u5668\u5f53\u524d\u7684\u503c\u3002\u8ba1\u6570\u5668\u7684\u521d\u59cb\u503c\u9ed8\u8ba4\u662f 5\uff08\u7531\u4ee3\u7801\u4e2d\u7684 LFU_INIT_VAL \u5e38\u91cf\u8bbe\u7f6e\uff09\uff0c\u800c\u4e0d\u662f 0\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u6570\u636e\u521a\u88ab\u5199\u5165\u7f13\u5b58\uff0c\u5c31\u56e0\u4e3a\u8bbf\u95ee\u6b21\u6570\u5c11\u800c\u88ab\u7acb\u5373\u6dd8\u6c70 double r = (double)rand()/RAND_MAX; ... double p = 1.0/(baseval*server.lfu_log_factor+1); if (r < p) counter++; \u4f7f\u7528\u4e86\u8fd9\u79cd\u8ba1\u7b97\u89c4\u5219\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u4e0d\u540c\u7684 lfu_log_factor \u914d\u7f6e\u9879\uff0c\u6765\u63a7\u5236\u8ba1\u6570\u5668\u503c\u589e\u52a0\u7684\u901f\u5ea6\uff0c\u907f\u514d counter \u503c\u5f88\u5feb\u5c31\u5230 255 \u4e86\u3002 \u4e3a\u4e86\u66f4\u8fdb\u4e00\u6b65\u8bf4\u660e LFU \u7b56\u7565\u8ba1\u6570\u5668\u9012\u589e\u7684\u6548\u679c.\u8fd9\u662f Redis\u5b98\u7f51\u4e0a\u63d0\u4f9b\u7684\u4e00\u5f20\u8868\uff0c\u5b83\u8bb0\u5f55\u4e86\u5f53 lfu_log_factor \u53d6\u4e0d\u540c\u503c\u65f6\uff0c\u5728\u4e0d\u540c\u7684\u5b9e\u9645\u8bbf\u95ee\u6b21\u6570\u60c5\u51b5\u4e0b\uff0c\u8ba1\u6570\u5668\u7684\u503c\u662f\u5982\u4f55\u53d8\u5316\u7684\u3002 \u53ef\u4ee5\u770b\u5230\uff0c \u5f53 lfu_log_factor \u53d6\u503c\u4e3a 1 \u65f6\uff0c\u5b9e\u9645\u8bbf\u95ee\u6b21\u6570\u4e3a 100K \u540e\uff0ccounter \u503c\u5c31\u8fbe\u5230 255 \u4e86\uff0c \u65e0\u6cd5\u518d\u533a\u5206\u5b9e\u9645\u8bbf\u95ee\u6b21\u6570\u66f4\u591a\u7684\u6570\u636e\u4e86 \u3002 \u800c\u5f53 lfu_log_factor \u53d6\u503c\u4e3a 100 \u65f6\uff0c\u5f53\u5b9e\u9645\u8bbf\u95ee\u6b21\u6570\u4e3a 10M \u65f6\uff0ccounter \u503c\u624d\u8fbe\u5230 255\uff0c\u6b64\u65f6\uff0c\u5b9e\u9645\u8bbf\u95ee\u6b21\u6570\u5c0f\u4e8e 10M \u7684\u4e0d\u540c\u6570\u636e\u90fd\u53ef\u4ee5\u901a\u8fc7 counter \u503c\u533a\u5206\u51fa\u6765\u3002 \u6b63\u662f\u56e0\u4e3a\u4f7f\u7528\u4e86\u975e\u7ebf\u6027\u9012\u589e\u7684\u8ba1\u6570\u5668\u65b9\u6cd5\uff0c\u5373\u4f7f\u7f13\u5b58\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u6210\u5343\u4e0a\u4e07\uff0cLFU \u7b56\u7565\u4e5f\u53ef\u4ee5\u6709\u6548\u5730\u533a\u5206\u4e0d\u540c\u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u4ece\u800c\u8fdb\u884c\u5408\u7406\u7684\u6570\u636e\u7b5b\u9009\u3002 \u4ece\u521a\u624d\u7684\u8868\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u5f53 lfu_log_factor \u53d6\u503c\u4e3a 10 \u65f6\uff0c\u767e\u3001\u5343\u3001\u5341\u4e07\u7ea7\u522b\u7684\u8bbf\u95ee\u6b21\u6570\u5bf9\u5e94\u7684 counter \u503c\u5df2\u7ecf\u6709\u660e\u663e\u7684\u533a\u5206\u4e86\uff0c \u6240\u4ee5\uff0c\u6211\u4eec\u5728\u5e94\u7528 LFU \u7b56\u7565\u65f6\uff0c\u4e00\u822c\u53ef\u4ee5\u5c06 lfu_log_factor \u53d6\u503c\u4e3a 10 4-3 LFU counter \u503c\u7684\u8870\u51cf\u673a\u5236 \u5e94\u7528\u8d1f\u8f7d\u7684\u60c5\u51b5\u662f\u5f88\u590d\u6742\u7684\u3002\u5728\u4e00\u4e9b\u573a\u666f\u4e0b\uff0c\u6709\u4e9b\u6570\u636e\u5728\u77ed\u65f6\u95f4\u5185\u88ab\u5927\u91cf\u8bbf\u95ee\u540e\u5c31\u4e0d\u4f1a\u518d\u88ab\u8bbf\u95ee\u4e86\u3002\u90a3\u4e48\u518d\u6309\u7167\u8bbf\u95ee\u6b21\u6570\u6765\u7b5b\u9009\u7684\u8bdd\uff0c\u8fd9\u4e9b\u6570\u636e\u4f1a\u88ab\u7559\u5b58\u5728\u7f13\u5b58\u4e2d\uff0c\u4f46\u4e0d\u4f1a\u63d0\u5347\u7f13\u5b58\u547d\u4e2d\u7387\u3002 \u4e3a\u6b64\uff0cRedis \u5728\u5b9e\u73b0 LFU \u7b56\u7565\u65f6\uff0c\u8fd8\u8bbe\u8ba1\u4e86\u4e00\u4e2a counter \u503c\u7684\u8870\u51cf\u673a\u5236\u3002 \u7b80\u5355\u6765\u8bf4\uff0cLFU \u7b56\u7565\u4f7f\u7528\u8870\u51cf\u56e0\u5b50\u914d\u7f6e\u9879 lfu_decay_time \u6765\u63a7\u5236\u8bbf\u95ee\u6b21\u6570\u7684\u8870\u51cf\u3002 LFU \u7b56\u7565\u4f1a\u8ba1\u7b97\u5f53\u524d\u65f6\u95f4\u548c\u6570\u636e\u6700\u8fd1\u4e00\u6b21\u8bbf\u95ee\u65f6\u95f4\u7684\u5dee\u503c\uff0c\u5e76\u628a\u8fd9\u4e2a\u5dee\u503c\u6362\u7b97\u6210\u4ee5\u5206\u949f\u4e3a\u5355\u4f4d\u3002\u7136\u540e\uff0cLFU \u7b56\u7565\u518d\u628a\u8fd9\u4e2a\u5dee\u503c\u9664\u4ee5 lfu_decay_time \u503c\uff0c\u6240\u5f97\u7684\u7ed3\u679c\u5c31\u662f\u6570\u636e counter \u8981\u8870\u51cf\u7684\u503c\u3002 \u7b80\u5355\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe lfu_decay_time \u53d6\u503c\u4e3a 1\uff0c\u5982\u679c\u6570\u636e\u5728 N \u5206\u949f\u5185\u6ca1\u6709\u88ab\u8bbf\u95ee\uff0c\u90a3\u4e48\u5b83\u7684\u8bbf\u95ee\u6b21\u6570\u5c31\u8981\u51cf N\u3002\u5982\u679c lfu_decay_time \u53d6\u503c\u66f4\u5927\uff0c\u90a3\u4e48\u76f8\u5e94\u7684\u8870\u51cf\u503c\u4f1a\u53d8\u5c0f\uff0c\u8870\u51cf\u6548\u679c\u4e5f\u4f1a\u51cf\u5f31\u3002 \u6240\u4ee5\uff0c \u5982\u679c\u4e1a\u52a1\u5e94\u7528\u4e2d\u6709\u77ed\u65f6\u9ad8\u9891\u8bbf\u95ee\u7684\u6570\u636e\u7684\u8bdd\uff0c\u5efa\u8bae\u628a lfu_decay_time \u503c\u8bbe\u7f6e\u4e3a 1\uff0c\u8fd9\u6837\u4e00\u6765\uff0cLFU \u7b56\u7565\u5728\u5b83\u4eec\u4e0d\u518d\u88ab\u8bbf\u95ee\u540e\uff0c\u4f1a\u8f83\u5feb\u5730\u8870\u51cf\u5b83\u4eec\u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u5c3d\u65e9\u628a\u5b83\u4eec\u4ece\u7f13\u5b58\u4e2d\u6dd8\u6c70\u51fa\u53bb\uff0c\u907f\u514d\u7f13\u5b58\u6c61\u67d3 \u3002 5\u3001\u672c\u8282\u5c0f\u7ed3 \u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u6c61\u67d3 \u7f13\u5b58\u6c61\u67d3\u95ee\u9898\u6307\u7684\u662f\u7559\u5b58\u5728\u7f13\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u5b9e\u9645\u4e0d\u4f1a\u88ab\u518d\u6b21\u8bbf\u95ee\u4e86\uff0c\u4f46\u662f\u53c8\u5360\u636e\u4e86\u7f13\u5b58\u7a7a\u95f4\u3002\u5982\u679c\u8fd9\u6837\u7684\u6570\u636e\u4f53\u91cf\u5f88\u5927\uff0c\u751a\u81f3\u5360\u6ee1\u4e86\u7f13\u5b58\uff0c\u6bcf\u6b21\u6709\u65b0\u6570\u636e\u5199\u5165\u7f13\u5b58\u65f6\uff0c\u8fd8\u9700\u8981\u628a\u8fd9\u4e9b\u6570\u636e\u9010\u6b65\u6dd8\u6c70\u51fa\u7f13\u5b58\uff0c\u5c31\u4f1a\u589e\u52a0\u7f13\u5b58\u64cd\u4f5c\u7684\u65f6\u95f4\u5f00\u9500\u3002 \u8981\u89e3\u51b3\u7f13\u5b58\u6c61\u67d3\u95ee\u9898\uff0c\u6700\u5173\u952e\u7684\u6280\u672f\u70b9\u5c31\u662f\u80fd\u8bc6\u522b\u51fa\u8fd9\u4e9b\u53ea\u8bbf\u95ee\u4e00\u6b21\u6216\u662f\u8bbf\u95ee\u6b21\u6570\u5f88\u5c11\u7684\u6570\u636e\uff0c\u5728\u6dd8\u6c70\u6570\u636e\u65f6\uff0c\u4f18\u5148\u628a\u5b83\u4eec\u7b5b\u9009\u51fa\u6765\u5e76\u6dd8\u6c70\u6389\u3002 volatile-random \u548c allkeys-random \u662f\u968f\u673a\u9009\u62e9\u6570\u636e\u8fdb\u884c\u6dd8\u6c70\uff0c\u65e0\u6cd5\u628a\u4e0d\u518d\u8bbf\u95ee\u7684\u6570\u636e\u7b5b\u9009\u51fa\u6765\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u7f13\u5b58\u6c61\u67d3\u3002 \u5982\u679c\u4e1a\u52a1\u5c42\u660e\u786e\u77e5\u9053\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u957f\uff0c\u53ef\u4ee5\u7ed9\u6570\u636e\u8bbe\u7f6e\u5408\u7406\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u518d\u8bbe\u7f6e Redis \u7f13\u5b58\u4f7f\u7528 volatile-ttl \u7b56\u7565\u3002\u5f53\u7f13\u5b58\u5199\u6ee1\u65f6\uff0c\u5269\u4f59\u5b58\u6d3b\u65f6\u95f4\u6700\u77ed\u7684\u6570\u636e\u5c31\u4f1a\u88ab\u6dd8\u6c70\u51fa\u7f13\u5b58\uff0c\u907f\u514d\u6ede\u7559\u5728\u7f13\u5b58\u4e2d\uff0c\u9020\u6210\u6c61\u67d3\u3002 \u5f53\u6211\u4eec\u4f7f\u7528 LRU \u7b56\u7565\u65f6\uff0c\u7531\u4e8e LRU \u7b56\u7565\u53ea\u8003\u8651\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u6548\uff0c\u5bf9\u4e8e\u53ea\u8bbf\u95ee\u4e00\u6b21\u7684\u6570\u636e\u6765\u8bf4\uff0cLRU \u7b56\u7565\u65e0\u6cd5\u5f88\u5feb\u5c06\u5176\u7b5b\u9009\u51fa\u6765\u3002 \u800c LFU \u7b56\u7565\u5728 LRU \u7b56\u7565\u57fa\u7840\u4e0a\u8fdb\u884c\u4e86\u4f18\u5316\uff0c\u5728\u7b5b\u9009\u6570\u636e\u65f6\uff0c\u9996\u5148\u4f1a\u7b5b\u9009\u5e76\u6dd8\u6c70\u8bbf\u95ee\u6b21\u6570\u5c11\u7684\u6570\u636e\uff0c\u7136\u540e\u9488\u5bf9\u8bbf\u95ee\u6b21\u6570\u76f8\u540c\u7684\u6570\u636e\uff0c\u518d\u7b5b\u9009\u5e76\u6dd8\u6c70\u8bbf\u95ee\u65f6\u95f4\u6700\u4e45\u8fdc\u7684\u6570\u636e\u3002 \u5728\u5177\u4f53\u5b9e\u73b0\u4e0a\uff0c\u76f8\u5bf9\u4e8e LRU \u7b56\u7565\uff0cRedis \u53ea\u662f\u628a\u539f\u6765 24bit \u5927\u5c0f\u7684 lru \u5b57\u6bb5\uff0c\u53c8\u8fdb\u4e00\u6b65\u62c6\u5206\u6210\u4e86 16bit \u7684 ldt \u548c 8bit \u7684 counter\uff0c\u5206\u522b\u7528\u6765\u8868\u793a\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u95f4\u6233\u548c\u8bbf\u95ee\u6b21\u6570\u3002 \u4e3a\u4e86\u907f\u5f00 8bit \u6700\u5927\u53ea\u80fd\u8bb0\u5f55 255 \u7684\u9650\u5236\uff0cLFU \u7b56\u7565\u8bbe\u8ba1\u4f7f\u7528\u975e\u7ebf\u6027\u589e\u957f\u7684\u8ba1\u6570\u5668\u6765\u8868\u793a\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u3002 \u5728\u5b9e\u9645\u4e1a\u52a1\u5e94\u7528\u4e2d\uff0cLRU \u548c LFU \u4e24\u4e2a\u7b56\u7565\u90fd\u6709\u5e94\u7528\u3002LRU \u548c LFU \u4e24\u4e2a\u7b56\u7565\u5173\u6ce8\u7684\u6570\u636e\u8bbf\u95ee\u7279\u5f81\u5404\u6709\u4fa7\u91cd\uff0cLRU \u7b56\u7565\u66f4\u52a0\u5173\u6ce8\u6570\u636e\u7684\u65f6\u6548\u6027\uff0c\u800c LFU \u7b56\u7565\u66f4\u52a0\u5173\u6ce8\u6570\u636e\u7684\u8bbf\u95ee\u9891\u6b21 \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5b9e\u9645\u5e94\u7528\u7684\u8d1f\u8f7d\u5177\u6709\u8f83\u597d\u7684\u65f6\u95f4\u5c40\u90e8\u6027\uff0c\u6240\u4ee5 LRU \u7b56\u7565\u7684\u5e94\u7528\u4f1a\u66f4\u52a0\u5e7f\u6cdb\u3002\u4f46\u662f\uff0c\u5728\u626b\u63cf\u5f0f\u67e5\u8be2\u7684\u5e94\u7528\u573a\u666f\u4e2d\uff0cLFU \u7b56\u7565\u5c31\u53ef\u4ee5\u5f88\u597d\u5730\u5e94\u5bf9\u7f13\u5b58\u6c61\u67d3\u95ee\u9898\u4e86\uff0c\u5efa\u8bae\u4f60\u4f18\u5148\u4f7f\u7528\u3002 \u5916\uff0c\u5982\u679c\u4e1a\u52a1\u5e94\u7528\u4e2d\u6709\u77ed\u65f6\u9ad8\u9891\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u9664\u4e86 LFU \u7b56\u7565\u672c\u8eab\u4f1a\u5bf9\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u8fdb\u884c\u81ea\u52a8\u8870\u51cf\u4ee5\u5916\uff0c\u6211\u518d\u7ed9\u4f60\u4e2a\u5c0f\u5efa\u8bae\uff1a\u4f60\u53ef\u4ee5\u4f18\u5148\u4f7f\u7528 volatile-lfu \u7b56\u7565\uff0c\u5e76\u6839\u636e\u8fd9\u4e9b\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u9650\u8bbe\u7f6e\u5b83\u4eec\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u514d\u5b83\u4eec\u7559\u5b58\u5728\u7f13\u5b58\u4e2d\u9020\u6210\u6c61\u67d3","title":"\u7b2c\u56db\u8282 \u7f13\u5b58\u88ab\u6c61\u67d3\u7684\u89e3\u51b3\u95ee\u9898"},{"location":"chap5/4redis_contamination/#_1","text":"","title":"\u7b2c\u56db\u8282 \u7f13\u5b58\u88ab\u6c61\u67d3\u7684\u89e3\u51b3\u95ee\u9898"},{"location":"chap5/4redis_contamination/#1","text":"\u90a3\u4ec0\u4e48\u662f\u7f13\u5b58\u6c61\u67d3\u5462\uff1f\u5728\u4e00\u4e9b\u573a\u666f\u4e0b\uff0c\u6709\u4e9b\u6570\u636e\u88ab\u8bbf\u95ee\u7684\u6b21\u6570\u975e\u5e38\u5c11\uff0c \u751a\u81f3\u53ea\u4f1a\u88ab\u8bbf\u95ee\u4e00\u6b21\u3002\u5f53\u8fd9\u4e9b\u6570\u636e\u670d\u52a1\u5b8c\u8bbf\u95ee\u8bf7\u6c42\u540e\uff0c\u5982\u679c\u8fd8\u7ee7\u7eed\u7559\u5b58\u5728\u7f13\u5b58\u4e2d\u7684\u8bdd\uff0c\u5c31\u53ea\u4f1a\u767d\u767d\u5360\u7528\u7f13\u5b58\u7a7a\u95f4\u3002\u8fd9\u79cd\u60c5\u51b5\uff0c\u5c31\u662f\u7f13\u5b58\u6c61\u67d3 \u3002 \u5f53\u7f13\u5b58\u6c61\u67d3\u4e0d\u4e25\u91cd\u65f6\uff0c\u53ea\u6709\u5c11\u91cf\u6570\u636e\u5360\u636e\u7f13\u5b58\u7a7a\u95f4\uff0c\u6b64\u65f6\uff0c\u5bf9\u7f13\u5b58\u7cfb\u7edf\u7684\u5f71\u54cd\u4e0d\u5927\u3002 \u4f46\u662f\uff0c\u7f13\u5b58\u6c61\u67d3\u4e00\u65e6\u53d8\u5f97\u4e25\u91cd\u540e\uff0c\u5c31\u4f1a\u6709\u5927\u91cf\u4e0d\u518d\u8bbf\u95ee\u7684\u6570\u636e\u6ede\u7559\u5728\u7f13\u5b58\u4e2d\u3002\u5982\u679c\u8fd9\u65f6\u6570\u636e\u5360\u6ee1\u4e86\u7f13\u5b58\u7a7a\u95f4\uff0c\u6211\u4eec\u518d\u5f80\u7f13\u5b58\u4e2d\u5199\u5165\u65b0\u6570\u636e\u65f6\uff0c\u5c31\u9700\u8981\u5148\u628a\u8fd9\u4e9b\u6570\u636e\u9010\u6b65\u6dd8\u6c70\u51fa\u7f13\u5b58\uff0c\u8fd9\u5c31\u4f1a\u5f15\u5165\u989d\u5916\u7684\u64cd\u4f5c\u65f6\u95f4\u5f00\u9500\uff0c\u8fdb\u800c\u4f1a\u5f71\u54cd\u5e94\u7528\u7684\u6027\u80fd\u3002","title":"1\u3001\u7f13\u5b58\u6c61\u67d3"},{"location":"chap5/4redis_contamination/#2","text":"8 \u79cd\u6570\u636e\u6dd8\u6c70\u7b56\u7565 \u5b83\u4eec\u5206\u522b\u662f noeviction \u3001 volatile-random \u3001 volatile-ttl \u3001 volatile-lru \u3001 volatile-lfu \u3001 allkeys-lru \u3001 allkeys-random \u548c allkeys-lfu \u7b56\u7565\u3002 \u5728\u8fd9 8 \u79cd\u7b56\u7565\u4e2d\uff0c noeviction \u7b56\u7565\u662f\u4e0d\u4f1a\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u7684 \u3002\u6240\u4ee5\uff0c\u5b83\u80af\u5b9a\u4e0d\u80fd\u7528\u6765\u89e3\u51b3\u7f13\u5b58\u6c61\u67d3\u95ee\u9898\u3002\u5176\u4ed6\u7684 7 \u79cd\u7b56\u7565\uff0c\u90fd\u4f1a\u6309\u7167\u4e00\u5b9a\u7684\u89c4\u5219\u6765\u6dd8\u6c70\u6570\u636e\u3002 \u56e0\u4e3a LRU \u7b97\u6cd5\u662f\u6211\u4eec\u5728\u7f13\u5b58\u6570\u636e\u6dd8\u6c70\u7b56\u7565\u4e2d\u5e7f\u6cdb\u5e94\u7528\u7684\u7b97\u6cd5\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u5206\u6790\u5176\u4ed6\u7b56\u7565\uff0c\u7136\u540e\u5355\u72ec\u5206\u6790\u6dd8\u6c70\u7b56\u7565\u4f7f\u7528 LRU \u7b97\u6cd5\u7684\u60c5\u51b5\uff0c\u6700\u540e\u518d\u5b66\u4e60\u4e0b LFU \u7b97\u6cd5\u7528\u4e8e\u6dd8\u6c70\u7b56\u7565\u65f6\uff0c\u5bf9\u7f13\u5b58\u6c61\u67d3\u7684\u5e94\u5bf9\u63aa\u65bd\u3002 \u4f7f\u7528 LRU \u7b97\u6cd5\u548c LFU \u7b97\u6cd5\u7684\u7b56\u7565\u5404\u6709\u4e24\u79cd\uff08volatile-lru \u548c allkeys-lru\uff0c\u4ee5\u53ca volatile-lfu \u548c allkeys-lfu\uff09\uff0c\u4e3a\u4e86\u4fbf\u4e8e\u7406\u89e3\uff0c\u63a5\u4e0b\u6765\u6211\u4f1a\u7edf\u4e00\u628a\u5b83\u4eec\u53eb\u4f5c LRU \u7b56\u7565\u548c LFU \u7b56\u7565\u3002","title":"2\u3001\u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u6c61\u67d3\u95ee\u9898\uff1f"},{"location":"chap5/4redis_contamination/#2-1-volatile-random-allkeys-random","text":"\u5b83\u4eec\u90fd\u662f\u91c7\u7528\u968f\u673a\u6311\u9009\u6570\u636e\u7684\u65b9\u5f0f\uff0c\u6765\u7b5b\u9009\u5373\u5c06\u88ab\u6dd8\u6c70\u7684\u6570\u636e\u3002 \u65e2\u7136\u662f\u968f\u673a\u6311\u9009\uff0c\u90a3\u4e48 Redis \u5c31\u4e0d\u4f1a\u6839\u636e\u6570\u636e\u7684\u8bbf\u95ee\u60c5\u51b5\u6765\u7b5b\u9009\u6570\u636e\u3002 \u5982\u679c\u88ab\u6dd8\u6c70\u7684\u6570\u636e\u53c8\u88ab\u8bbf\u95ee\u4e86\uff0c\u5c31\u4f1a\u53d1\u751f\u7f13\u5b58\u7f3a\u5931\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5e94\u7528\u9700\u8981\u5230\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u8bbf\u95ee\u8fd9\u4e9b\u6570\u636e\uff0c\u964d\u4f4e\u4e86\u5e94\u7528\u7684\u8bf7\u6c42\u54cd\u5e94\u901f\u5ea6\u3002\u6240\u4ee5\uff0c volatile-random \u548c allkeys-random \u7b56\u7565\uff0c\u5728\u907f\u514d\u7f13\u5b58\u6c61\u67d3\u8fd9\u4e2a\u95ee\u9898\u4e0a\u7684\u6548\u679c\u975e\u5e38\u6709\u9650\u3002 \u6211\u7ed9\u4f60\u4e3e\u4e2a\u4f8b\u5b50\u5427\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5047\u8bbe\u6211\u4eec\u914d\u7f6e Redis \u7f13\u5b58\u4f7f\u7528 allkeys-random \u6dd8\u6c70\u7b56\u7565\uff0c\u5f53\u7f13\u5b58\u5199\u6ee1\u65f6\uff0callkeys-random \u7b56\u7565\u968f\u673a\u9009\u62e9\u4e86\u6570\u636e 20 \u8fdb\u884c\u6dd8\u6c70\u3002\u4e0d\u5de7\u7684\u662f\uff0c\u6570\u636e 20 \u7d27\u63a5\u7740\u53c8\u88ab\u8bbf\u95ee\u4e86\uff0c\u6b64\u65f6\uff0cRedis \u5c31\u4f1a\u53d1\u751f\u4e86\u7f13\u5b58\u7f3a\u5931\u3002 \u7ee7\u7eed\u770b volatile-ttl \u7b56\u7565\u662f\u5426\u80fd\u6709\u6548\u5e94\u5bf9\u7f13\u5b58\u6c61\u67d3\u3002 volatile-ttl \u9488\u5bf9\u7684\u662f\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\uff0c\u628a\u8fd9\u4e9b\u6570\u636e\u4e2d\u5269\u4f59\u5b58\u6d3b\u65f6\u95f4\u6700\u77ed\u7684\u7b5b\u9009\u51fa\u6765\u5e76\u6dd8\u6c70\u6389\u3002 \u867d\u7136 volatile-ttl \u7b56\u7565\u4e0d\u518d\u662f\u968f\u673a\u9009\u62e9\u6dd8\u6c70\u6570\u636e\u4e86 \uff0c\u4f46\u662f\u5269\u4f59\u5b58\u6d3b\u65f6\u95f4\u5e76\u4e0d\u80fd\u76f4\u63a5\u53cd\u6620\u6570\u636e\u518d\u6b21\u8bbf\u95ee\u7684\u60c5\u51b5 \u3002\u6240\u4ee5\uff0c\u6309\u7167 volatile-ttl \u7b56\u7565\u6dd8\u6c70\u6570\u636e\uff0c \u548c\u6309\u968f\u673a\u65b9\u5f0f\u6dd8\u6c70\u6570\u636e\u7c7b\u4f3c\uff0c\u4e5f\u53ef\u80fd\u51fa\u73b0\u6570\u636e\u88ab\u6dd8\u6c70\u540e\uff0c\u88ab\u518d\u6b21\u8bbf\u95ee\u5bfc\u81f4\u7684\u7f13\u5b58\u7f3a\u5931\u95ee\u9898\u3002 \u4f8b\u5916\u7684\u60c5\u51b5\uff1a\u4e1a\u52a1\u5e94\u7528\u5728\u7ed9\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u65f6\u5019\uff0c\u5c31\u660e\u786e\u77e5\u9053\u6570\u636e\u88ab\u518d\u6b21\u8bbf\u95ee\u7684\u60c5\u51b5\uff0c\u5e76\u6839\u636e\u8bbf\u95ee\u60c5\u51b5\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002 \u6b64\u65f6\uff0cRedis \u6309\u7167\u6570\u636e\u7684\u5269\u4f59\u6700\u77ed\u5b58\u6d3b\u65f6\u95f4\u8fdb\u884c\u7b5b\u9009\uff0c\u662f\u53ef\u4ee5\u628a\u4e0d\u4f1a\u518d\u88ab\u8bbf\u95ee\u7684\u6570\u636e\u7b5b\u9009\u51fa\u6765\u7684\uff0c\u8fdb\u800c\u907f\u514d\u7f13\u5b58\u6c61\u67d3\u3002\u4f8b\u5982\uff0c\u4e1a\u52a1\u90e8\u95e8\u77e5\u9053\u6570\u636e\u88ab\u8bbf\u95ee\u7684\u65f6\u957f\u5c31\u662f\u4e00\u4e2a\u5c0f\u65f6\uff0c\u5e76\u628a\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u5c0f\u65f6\u540e\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u88ab\u6dd8\u6c70\u7684\u6570\u636e\u7684\u786e\u662f\u4e0d\u4f1a\u518d\u88ab\u8bbf\u95ee\u4e86\u3002 \u5c0f\u7ed3: \u9664\u4e86\u5728\u660e\u786e\u77e5\u9053\u6570\u636e\u88ab\u518d\u6b21\u8bbf\u95ee\u7684\u60c5\u51b5\u4e0b\uff0c volatile-ttl \u53ef\u4ee5\u6709\u6548\u907f\u514d\u7f13\u5b58\u6c61\u67d3\u3002\u5728\u5176\u4ed6\u60c5\u51b5\u4e0b\uff0c volatile-random \u3001 allkeys-random \u3001 volatile-ttl \u8fd9\u4e09\u79cd\u7b56\u7565\u5e76\u4e0d\u80fd\u5e94\u5bf9\u7f13\u5b58\u6c61\u67d3\u95ee\u9898\u3002 \u518d\u5206\u522b\u5206\u6790\u4e0b LRU \u7b56\u7565\uff0c\u4ee5\u53ca Redis 4.0 \u540e\u5b9e\u73b0\u7684 LFU \u7b56\u7565 \u3002LRU \u7b56\u7565\u4f1a\u6309\u7167\u6570\u636e\u8bbf\u95ee\u7684\u65f6\u6548\u6027\uff0c\u6765\u7b5b\u9009\u5373\u5c06\u88ab\u6dd8\u6c70\u7684\u6570\u636e\uff0c\u5e94\u7528\u975e\u5e38\u5e7f\u6cdb\u3002","title":"2-1 volatile-random \u548c allkeys-random"},{"location":"chap5/4redis_contamination/#3lru","text":"LRU \u7b56\u7565\u7684\u6838\u5fc3\u601d\u60f3\uff1a\u5982\u679c\u4e00\u4e2a\u6570\u636e\u521a\u521a\u88ab\u8bbf\u95ee\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6570\u636e\u80af\u5b9a\u662f\u70ed\u6570\u636e\uff0c\u8fd8\u4f1a\u88ab\u518d\u6b21\u8bbf\u95ee\u3002 Redis \u4e2d\u7684 LRU \u7b56\u7565\uff0c\u4f1a\u5728\u6bcf\u4e2a\u6570\u636e\u5bf9\u5e94\u7684 RedisObject \u7ed3\u6784\u4f53\u4e2d\u8bbe\u7f6e\u4e00\u4e2a lru \u5b57\u6bb5\uff0c\u7528\u6765\u8bb0\u5f55\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u95f4\u6233\u3002 \u5728\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u65f6\uff0cLRU \u7b56\u7565\u4f1a\u5728\u5019\u9009\u6570\u636e\u96c6\u4e2d\u6dd8\u6c70\u6389 lru \u5b57\u6bb5\u503c\u6700\u5c0f\u7684\u6570\u636e\uff08\u4e5f\u5c31\u662f\u8bbf\u95ee\u65f6\u95f4\u6700\u4e45\u7684\u6570\u636e\uff09\u3002 \u6240\u4ee5\uff0c\u5728\u6570\u636e\u88ab\u9891\u7e41\u8bbf\u95ee\u7684\u4e1a\u52a1\u573a\u666f\u4e2d\uff0cLRU \u7b56\u7565\u7684\u786e\u80fd\u6709\u6548\u7559\u5b58\u8bbf\u95ee\u65f6\u95f4\u6700\u8fd1\u7684\u6570\u636e\u3002\u800c\u4e14\uff0c\u56e0\u4e3a\u7559\u5b58\u7684\u8fd9\u4e9b\u6570\u636e\u8fd8\u4f1a\u88ab\u518d\u6b21\u8bbf\u95ee\uff0c\u6240\u4ee5\u53c8\u53ef\u4ee5\u63d0\u5347\u4e1a\u52a1\u5e94\u7528\u7684\u8bbf\u95ee\u901f\u5ea6\u3002 \u4f46\u662f\uff0c\u4e5f\u6b63\u662f\u56e0\u4e3a\u53ea\u770b\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u95f4\uff0c\u4f7f\u7528 LRU \u7b56\u7565\u5728\u5904\u7406\u626b\u63cf\u5f0f\u5355\u6b21\u67e5\u8be2\u64cd\u4f5c\u65f6\uff0c\u65e0\u6cd5\u89e3\u51b3\u7f13\u5b58\u6c61\u67d3\u3002 \u6240\u8c13\u7684\u626b\u63cf\u5f0f\u5355\u6b21\u67e5\u8be2\u64cd\u4f5c\uff0c\u5c31\u662f\u6307\u5e94\u7528\u5bf9\u5927\u91cf\u7684\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u5168\u4f53\u8bfb\u53d6\uff0c\u6bcf\u4e2a\u6570\u636e\u90fd\u4f1a\u88ab\u8bfb\u53d6\uff0c\u800c\u4e14\u53ea\u4f1a\u88ab\u8bfb\u53d6\u4e00\u6b21\u3002\u6b64\u65f6\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u88ab\u67e5\u8be2\u7684\u6570\u636e\u521a\u521a\u88ab\u8bbf\u95ee\u8fc7\uff0c\u6240\u4ee5 lru \u5b57\u6bb5\u503c\u90fd\u5f88\u5927\u3002 \u5728\u4f7f\u7528 LRU \u7b56\u7565\u6dd8\u6c70\u6570\u636e\u65f6\uff0c\u8fd9\u4e9b\u6570\u636e\u4f1a\u7559\u5b58\u5728\u7f13\u5b58\u4e2d\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\uff0c\u9020\u6210\u7f13\u5b58\u6c61\u67d3\u3002 \u5982\u679c\u67e5\u8be2\u7684\u6570\u636e\u91cf\u5f88\u5927\uff0c\u8fd9\u4e9b\u6570\u636e\u5360\u6ee1\u4e86\u7f13\u5b58\u7a7a\u95f4\uff0c\u5374\u53c8\u4e0d\u4f1a\u670d\u52a1\u65b0\u7684\u7f13\u5b58\u8bf7\u6c42\uff0c\u6b64\u65f6\uff0c \u518d\u6709\u65b0\u6570\u636e\u8981\u5199\u5165\u7f13\u5b58\u7684\u8bdd\uff0c\u8fd8\u662f\u9700\u8981\u5148\u628a\u8fd9\u4e9b\u65e7\u6570\u636e\u66ff\u6362\u51fa\u7f13\u5b58\u624d\u884c\uff0c\u8fd9\u4f1a\u5f71\u54cd\u7f13\u5b58\u7684\u6027\u80fd\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff0c\u6570\u636e 6 \u88ab\u8bbf\u95ee\u540e\uff0c\u88ab\u5199\u5165 Redis \u7f13\u5b58\u3002\u4f46\u662f\uff0c\u5728\u6b64\u4e4b\u540e\uff0c\u6570\u636e 6 \u4e00\u76f4\u6ca1\u6709\u88ab\u518d\u6b21\u8bbf\u95ee\uff0c\u8fd9\u5c31\u5bfc\u81f4\u6570\u636e 6 \u6ede\u7559\u5728\u7f13\u5b58\u4e2d\uff0c\u9020\u6210\u4e86\u6c61\u67d3\u3002 \u6240\u4ee5\uff0c\u5bf9\u4e8e\u91c7\u7528\u4e86 LRU \u7b56\u7565\u7684 Redis \u7f13\u5b58\u6765\u8bf4\uff0c\u626b\u63cf\u5f0f\u5355\u6b21\u67e5\u8be2\u4f1a\u9020\u6210\u7f13\u5b58\u6c61\u67d3\u3002 \u4e3a\u4e86\u5e94\u5bf9\u8fd9\u7c7b\u7f13\u5b58\u6c61\u67d3\u95ee\u9898\uff0cRedis \u4ece 4.0 \u7248\u672c\u5f00\u59cb\u589e\u52a0\u4e86 LFU \u6dd8\u6c70\u7b56\u7565\u3002 \u4e0e LRU \u7b56\u7565\u76f8\u6bd4\uff0cLFU \uff08Frequent\uff09\u7b56\u7565\u4e2d\u4f1a\u4ece\u4e24\u4e2a\u7ef4\u5ea6\u6765\u7b5b\u9009\u5e76\u6dd8\u6c70\u6570\u636e\uff1a \u4e00\u662f\uff0c\u6570\u636e\u8bbf\u95ee\u7684\u65f6\u6548\u6027\uff08\u8bbf\u95ee\u65f6\u95f4\u79bb\u5f53\u524d\u65f6\u95f4\u7684\u8fdc\u8fd1\uff09\uff1b \u4e8c\u662f\uff0c\u6570\u636e\u7684\u88ab\u8bbf\u95ee\u6b21\u6570\u3002","title":"3\u3001LRU \u7f13\u5b58\u7b56\u7565"},{"location":"chap5/4redis_contamination/#4lfu","text":"","title":"4\u3001LFU \u7f13\u5b58\u7b56\u7565\u7684\u4f18\u5316"},{"location":"chap5/4redis_contamination/#4-1-lfu","text":"LFU \u7f13\u5b58\u7b56\u7565\u662f\u5728 LRU \u7b56\u7565\u57fa\u7840\u4e0a\uff0c\u4e3a\u6bcf\u4e2a\u6570\u636e\u589e\u52a0\u4e86\u4e00\u4e2a\u8ba1\u6570\u5668\uff0c\u6765\u7edf\u8ba1\u8fd9\u4e2a\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u3002 \u5f53\u4f7f\u7528 LFU \u7b56\u7565\u7b5b\u9009\u6dd8\u6c70\u6570\u636e\u65f6\uff0c \u9996\u5148\u4f1a\u6839\u636e\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u8fdb\u884c\u7b5b\u9009\uff0c\u628a\u8bbf\u95ee\u6b21\u6570\u6700\u4f4e\u7684\u6570\u636e\u6dd8\u6c70\u51fa\u7f13\u5b58\u3002 \u5982\u679c\u4e24\u4e2a\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u76f8\u540c\uff0c LFU \u7b56\u7565\u518d\u6bd4\u8f83\u8fd9\u4e24\u4e2a\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u6548\u6027\uff0c\u628a\u8ddd\u79bb\u4e0a\u4e00\u6b21\u8bbf\u95ee\u65f6\u95f4\u66f4\u4e45\u7684\u6570\u636e\u6dd8\u6c70\u51fa\u7f13\u5b58\u3002 \u548c\u90a3\u4e9b\u88ab\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\u76f8\u6bd4\uff0c\u626b\u63cf\u5f0f\u5355\u6b21\u67e5\u8be2\u7684\u6570\u636e\u56e0\u4e3a\u4e0d\u4f1a\u88ab\u518d\u6b21\u8bbf\u95ee\uff0c\u6240\u4ee5\u5b83\u4eec\u7684\u8bbf\u95ee\u6b21\u6570\u4e0d\u4f1a\u518d\u589e\u52a0\u3002\u56e0\u6b64\uff0c LFU \u7b56\u7565\u4f1a\u4f18\u5148\u628a\u8fd9\u4e9b\u8bbf\u95ee\u6b21\u6570\u4f4e\u7684\u6570\u636e\u6dd8\u6c70\u51fa\u7f13\u5b58 \u3002\u8fd9\u6837\u4e00\u6765\uff0cLFU \u7b56\u7565\u5c31\u53ef\u4ee5\u907f\u514d\u8fd9\u4e9b\u6570\u636e\u5bf9\u7f13\u5b58\u9020\u6210\u6c61\u67d3\u4e86\u3002","title":"4-1 LFU\u4ecb\u7ecd"},{"location":"chap5/4redis_contamination/#4-2-lfu","text":"\u4e3a\u4e86\u907f\u514d\u64cd\u4f5c\u94fe\u8868\u7684\u5f00\u9500\uff0cRedis \u5728\u5b9e\u73b0 LRU \u7b56\u7565\u65f6\u4f7f\u7528\u4e86\u4e24\u4e2a\u8fd1\u4f3c\u65b9\u6cd5\uff1a Redis \u662f\u7528 RedisObject \u7ed3\u6784\u6765\u4fdd\u5b58\u6570\u636e\u7684\uff0cRedisObject \u7ed3\u6784\u4e2d\u8bbe\u7f6e\u4e86\u4e00\u4e2a lru \u5b57\u6bb5\uff0c\u7528\u6765\u8bb0\u5f55\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u95f4\u6233\uff1b Redis \u5e76\u6ca1\u6709\u4e3a\u6240\u6709\u7684\u6570\u636e\u7ef4\u62a4\u4e00\u4e2a\u5168\u5c40\u7684\u94fe\u8868\uff0c\u800c\u662f\u901a\u8fc7\u968f\u673a\u91c7\u6837\u65b9\u5f0f\uff0c\u9009\u53d6\u4e00\u5b9a\u6570\u91cf\uff08\u4f8b\u5982 10 \u4e2a\uff09\u7684\u6570\u636e\u653e\u5165\u5019\u9009\u96c6\u5408\uff0c\u540e\u7eed\u5728\u5019\u9009\u96c6\u5408\u4e2d\u6839\u636e lru \u5b57\u6bb5\u503c\u7684\u5927\u5c0f\u8fdb\u884c\u7b5b\u9009\u3002 \u5728\u6b64\u57fa\u7840\u4e0a\uff0cRedis \u5728\u5b9e\u73b0 LFU \u7b56\u7565\u7684\u65f6\u5019\uff0c\u53ea\u662f\u628a\u539f\u6765 24bit \u5927\u5c0f\u7684 lru \u5b57\u6bb5\uff0c\u53c8\u8fdb\u4e00\u6b65\u62c6\u5206\u6210\u4e86\u4e24\u90e8\u5206\u3002 ldt \u503c\uff1alru \u5b57\u6bb5\u7684\u524d 16bit\uff0c\u8868\u793a\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u95f4\u6233\uff1b counter \u503c\uff1alru \u5b57\u6bb5\u7684\u540e 8bit\uff0c\u8868\u793a\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u3002 Redis \u53ea\u4f7f\u7528\u4e86 8bit \u8bb0\u5f55\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u800c 8bit \u8bb0\u5f55\u7684\u6700\u5927\u503c\u662f 255\uff0c\u8fd9\u6837\u53ef\u4ee5\u5417\uff1f \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u4e00\u4e2a\u6570\u636e\u53ef\u80fd\u4f1a\u88ab\u8bbf\u95ee\u6210\u5343\u4e0a\u4e07\u6b21\u3002 \u5982\u679c\u6bcf\u88ab\u8bbf\u95ee\u4e00\u6b21\uff0ccounter \u503c\u5c31\u52a0 1 \u7684\u8bdd\uff0c\u90a3\u4e48\uff0c\u53ea\u8981\u8bbf\u95ee\u6b21\u6570\u8d85\u8fc7\u4e86 255\uff0c\u6570\u636e\u7684 counter \u503c\u5c31\u4e00\u6837\u4e86 \u3002\u5728\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u65f6\uff0cLFU \u7b56\u7565\u5c31\u65e0\u6cd5\u5f88\u597d\u5730\u533a\u5206\u5e76\u7b5b\u9009\u8fd9\u4e9b\u6570\u636e\uff0c\u53cd\u800c\u8fd8\u53ef\u80fd\u4f1a\u628a\u4e0d\u600e\u4e48\u8bbf\u95ee\u7684\u6570\u636e\u7559\u5b58\u5728\u4e86\u7f13\u5b58\u4e2d\u3002 \u5047\u8bbe\u7b2c\u4e00\u4e2a\u6570\u636e A \u7684\u7d2f\u8ba1\u8bbf\u95ee\u6b21\u6570\u662f 256\uff0c\u8bbf\u95ee\u65f6\u95f4\u6233\u662f 202010010909\uff0c\u6240\u4ee5\u5b83\u7684 counter \u503c\u4e3a 255\uff0c\u800c\u7b2c\u4e8c\u4e2a\u6570\u636e B \u7684\u7d2f\u8ba1\u8bbf\u95ee\u6b21\u6570\u662f 1024\uff0c\u8bbf\u95ee\u65f6\u95f4\u6233\u662f 202010010810\u3002\u5982\u679c counter \u503c\u53ea\u80fd\u8bb0\u5f55\u5230 255\uff0c\u90a3\u4e48\u6570\u636e B \u7684 counter \u503c\u4e5f\u662f 255\u3002 \u6b64\u65f6\uff0c\u7f13\u5b58\u5199\u6ee1\u4e86\uff0cRedis \u4f7f\u7528 LFU \u7b56\u7565\u8fdb\u884c\u6dd8\u6c70\u3002\u6570\u636e A \u548c B \u7684 counter \u503c\u90fd\u662f 255\uff0cLFU \u7b56\u7565\u518d\u6bd4\u8f83 A \u548c B \u7684\u8bbf\u95ee\u65f6\u95f4\u6233\uff0c\u53d1\u73b0\u6570\u636e B \u7684\u4e0a\u4e00\u6b21\u8bbf\u95ee\u65f6\u95f4\u65e9\u4e8e A\uff0c\u5c31\u4f1a\u628a B \u6dd8\u6c70\u6389\u3002 \u4f46\u5176\u5b9e\u6570\u636e B \u7684\u8bbf\u95ee\u6b21\u6570\u8fdc\u5927\u4e8e\u6570\u636e A\uff0c\u5f88\u53ef\u80fd\u4f1a\u88ab\u518d\u6b21\u8bbf\u95ee\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4f7f\u7528 LFU \u7b56\u7565\u6765\u6dd8\u6c70\u6570\u636e\u5c31\u4e0d\u5408\u9002\u4e86\u3002 Redis \u4e5f\u6ce8\u610f\u5230\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002\u56e0\u6b64\uff0c \u5728\u5b9e\u73b0 LFU \u7b56\u7565\u65f6\uff0cRedis \u5e76\u6ca1\u6709\u91c7\u7528\u6570\u636e\u6bcf\u88ab\u8bbf\u95ee\u4e00\u6b21\uff0c\u5c31\u7ed9\u5bf9\u5e94\u7684 counter \u503c\u52a0 1 \u7684\u8ba1\u6570\u89c4\u5219\uff0c\u800c\u662f\u91c7\u7528\u4e86\u4e00\u4e2a\u66f4\u4f18\u5316\u7684\u8ba1\u6570\u89c4\u5219\u3002 LFU \u7b56\u7565\u5b9e\u73b0\u7684\u8ba1\u6570\u89c4\u5219\u662f \uff1a\u6bcf\u5f53\u6570\u636e\u88ab\u8bbf\u95ee\u4e00\u6b21\u65f6\uff0c \u9996\u5148\uff0c\u7528\u8ba1\u6570\u5668\u5f53\u524d\u7684\u503c\u4e58\u4ee5\u914d\u7f6e\u9879 lfu_log_factor \u518d\u52a0 1\uff0c\u518d\u53d6\u5176\u5012\u6570\uff0c\u5f97\u5230\u4e00\u4e2a p \u503c\uff1b \u7136\u540e\uff0c\u628a\u8fd9\u4e2a p \u503c\u548c\u4e00\u4e2a\u53d6\u503c\u8303\u56f4\u5728`\uff080\uff0c1\uff09\u95f4\u7684\u968f\u673a\u6570 r \u503c\u6bd4\u5927\u5c0f\uff0c\u53ea\u6709 p \u503c\u5927\u4e8e r \u503c\u65f6\uff0c\u8ba1\u6570\u5668\u624d\u52a0 1\u3002 Redis \u7684\u90e8\u5206\u6e90\u7801\uff0c\u663e\u793a\u4e86 LFU \u7b56\u7565\u589e\u52a0\u8ba1\u6570\u5668\u503c\u7684\u8ba1\u7b97\u903b\u8f91\u3002\u5176\u4e2d\uff0cbaseval \u662f\u8ba1\u6570\u5668\u5f53\u524d\u7684\u503c\u3002\u8ba1\u6570\u5668\u7684\u521d\u59cb\u503c\u9ed8\u8ba4\u662f 5\uff08\u7531\u4ee3\u7801\u4e2d\u7684 LFU_INIT_VAL \u5e38\u91cf\u8bbe\u7f6e\uff09\uff0c\u800c\u4e0d\u662f 0\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u6570\u636e\u521a\u88ab\u5199\u5165\u7f13\u5b58\uff0c\u5c31\u56e0\u4e3a\u8bbf\u95ee\u6b21\u6570\u5c11\u800c\u88ab\u7acb\u5373\u6dd8\u6c70 double r = (double)rand()/RAND_MAX; ... double p = 1.0/(baseval*server.lfu_log_factor+1); if (r < p) counter++; \u4f7f\u7528\u4e86\u8fd9\u79cd\u8ba1\u7b97\u89c4\u5219\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u4e0d\u540c\u7684 lfu_log_factor \u914d\u7f6e\u9879\uff0c\u6765\u63a7\u5236\u8ba1\u6570\u5668\u503c\u589e\u52a0\u7684\u901f\u5ea6\uff0c\u907f\u514d counter \u503c\u5f88\u5feb\u5c31\u5230 255 \u4e86\u3002 \u4e3a\u4e86\u66f4\u8fdb\u4e00\u6b65\u8bf4\u660e LFU \u7b56\u7565\u8ba1\u6570\u5668\u9012\u589e\u7684\u6548\u679c.\u8fd9\u662f Redis\u5b98\u7f51\u4e0a\u63d0\u4f9b\u7684\u4e00\u5f20\u8868\uff0c\u5b83\u8bb0\u5f55\u4e86\u5f53 lfu_log_factor \u53d6\u4e0d\u540c\u503c\u65f6\uff0c\u5728\u4e0d\u540c\u7684\u5b9e\u9645\u8bbf\u95ee\u6b21\u6570\u60c5\u51b5\u4e0b\uff0c\u8ba1\u6570\u5668\u7684\u503c\u662f\u5982\u4f55\u53d8\u5316\u7684\u3002 \u53ef\u4ee5\u770b\u5230\uff0c \u5f53 lfu_log_factor \u53d6\u503c\u4e3a 1 \u65f6\uff0c\u5b9e\u9645\u8bbf\u95ee\u6b21\u6570\u4e3a 100K \u540e\uff0ccounter \u503c\u5c31\u8fbe\u5230 255 \u4e86\uff0c \u65e0\u6cd5\u518d\u533a\u5206\u5b9e\u9645\u8bbf\u95ee\u6b21\u6570\u66f4\u591a\u7684\u6570\u636e\u4e86 \u3002 \u800c\u5f53 lfu_log_factor \u53d6\u503c\u4e3a 100 \u65f6\uff0c\u5f53\u5b9e\u9645\u8bbf\u95ee\u6b21\u6570\u4e3a 10M \u65f6\uff0ccounter \u503c\u624d\u8fbe\u5230 255\uff0c\u6b64\u65f6\uff0c\u5b9e\u9645\u8bbf\u95ee\u6b21\u6570\u5c0f\u4e8e 10M \u7684\u4e0d\u540c\u6570\u636e\u90fd\u53ef\u4ee5\u901a\u8fc7 counter \u503c\u533a\u5206\u51fa\u6765\u3002 \u6b63\u662f\u56e0\u4e3a\u4f7f\u7528\u4e86\u975e\u7ebf\u6027\u9012\u589e\u7684\u8ba1\u6570\u5668\u65b9\u6cd5\uff0c\u5373\u4f7f\u7f13\u5b58\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u6210\u5343\u4e0a\u4e07\uff0cLFU \u7b56\u7565\u4e5f\u53ef\u4ee5\u6709\u6548\u5730\u533a\u5206\u4e0d\u540c\u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u4ece\u800c\u8fdb\u884c\u5408\u7406\u7684\u6570\u636e\u7b5b\u9009\u3002 \u4ece\u521a\u624d\u7684\u8868\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u5f53 lfu_log_factor \u53d6\u503c\u4e3a 10 \u65f6\uff0c\u767e\u3001\u5343\u3001\u5341\u4e07\u7ea7\u522b\u7684\u8bbf\u95ee\u6b21\u6570\u5bf9\u5e94\u7684 counter \u503c\u5df2\u7ecf\u6709\u660e\u663e\u7684\u533a\u5206\u4e86\uff0c \u6240\u4ee5\uff0c\u6211\u4eec\u5728\u5e94\u7528 LFU \u7b56\u7565\u65f6\uff0c\u4e00\u822c\u53ef\u4ee5\u5c06 lfu_log_factor \u53d6\u503c\u4e3a 10","title":"4-2 LFU \u7b56\u7565\u5177\u4f53\u53c8\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u5462"},{"location":"chap5/4redis_contamination/#4-3-lfu-counter","text":"\u5e94\u7528\u8d1f\u8f7d\u7684\u60c5\u51b5\u662f\u5f88\u590d\u6742\u7684\u3002\u5728\u4e00\u4e9b\u573a\u666f\u4e0b\uff0c\u6709\u4e9b\u6570\u636e\u5728\u77ed\u65f6\u95f4\u5185\u88ab\u5927\u91cf\u8bbf\u95ee\u540e\u5c31\u4e0d\u4f1a\u518d\u88ab\u8bbf\u95ee\u4e86\u3002\u90a3\u4e48\u518d\u6309\u7167\u8bbf\u95ee\u6b21\u6570\u6765\u7b5b\u9009\u7684\u8bdd\uff0c\u8fd9\u4e9b\u6570\u636e\u4f1a\u88ab\u7559\u5b58\u5728\u7f13\u5b58\u4e2d\uff0c\u4f46\u4e0d\u4f1a\u63d0\u5347\u7f13\u5b58\u547d\u4e2d\u7387\u3002 \u4e3a\u6b64\uff0cRedis \u5728\u5b9e\u73b0 LFU \u7b56\u7565\u65f6\uff0c\u8fd8\u8bbe\u8ba1\u4e86\u4e00\u4e2a counter \u503c\u7684\u8870\u51cf\u673a\u5236\u3002 \u7b80\u5355\u6765\u8bf4\uff0cLFU \u7b56\u7565\u4f7f\u7528\u8870\u51cf\u56e0\u5b50\u914d\u7f6e\u9879 lfu_decay_time \u6765\u63a7\u5236\u8bbf\u95ee\u6b21\u6570\u7684\u8870\u51cf\u3002 LFU \u7b56\u7565\u4f1a\u8ba1\u7b97\u5f53\u524d\u65f6\u95f4\u548c\u6570\u636e\u6700\u8fd1\u4e00\u6b21\u8bbf\u95ee\u65f6\u95f4\u7684\u5dee\u503c\uff0c\u5e76\u628a\u8fd9\u4e2a\u5dee\u503c\u6362\u7b97\u6210\u4ee5\u5206\u949f\u4e3a\u5355\u4f4d\u3002\u7136\u540e\uff0cLFU \u7b56\u7565\u518d\u628a\u8fd9\u4e2a\u5dee\u503c\u9664\u4ee5 lfu_decay_time \u503c\uff0c\u6240\u5f97\u7684\u7ed3\u679c\u5c31\u662f\u6570\u636e counter \u8981\u8870\u51cf\u7684\u503c\u3002 \u7b80\u5355\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe lfu_decay_time \u53d6\u503c\u4e3a 1\uff0c\u5982\u679c\u6570\u636e\u5728 N \u5206\u949f\u5185\u6ca1\u6709\u88ab\u8bbf\u95ee\uff0c\u90a3\u4e48\u5b83\u7684\u8bbf\u95ee\u6b21\u6570\u5c31\u8981\u51cf N\u3002\u5982\u679c lfu_decay_time \u53d6\u503c\u66f4\u5927\uff0c\u90a3\u4e48\u76f8\u5e94\u7684\u8870\u51cf\u503c\u4f1a\u53d8\u5c0f\uff0c\u8870\u51cf\u6548\u679c\u4e5f\u4f1a\u51cf\u5f31\u3002 \u6240\u4ee5\uff0c \u5982\u679c\u4e1a\u52a1\u5e94\u7528\u4e2d\u6709\u77ed\u65f6\u9ad8\u9891\u8bbf\u95ee\u7684\u6570\u636e\u7684\u8bdd\uff0c\u5efa\u8bae\u628a lfu_decay_time \u503c\u8bbe\u7f6e\u4e3a 1\uff0c\u8fd9\u6837\u4e00\u6765\uff0cLFU \u7b56\u7565\u5728\u5b83\u4eec\u4e0d\u518d\u88ab\u8bbf\u95ee\u540e\uff0c\u4f1a\u8f83\u5feb\u5730\u8870\u51cf\u5b83\u4eec\u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u5c3d\u65e9\u628a\u5b83\u4eec\u4ece\u7f13\u5b58\u4e2d\u6dd8\u6c70\u51fa\u53bb\uff0c\u907f\u514d\u7f13\u5b58\u6c61\u67d3 \u3002","title":"4-3 LFU counter \u503c\u7684\u8870\u51cf\u673a\u5236"},{"location":"chap5/4redis_contamination/#5","text":"\u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u6c61\u67d3 \u7f13\u5b58\u6c61\u67d3\u95ee\u9898\u6307\u7684\u662f\u7559\u5b58\u5728\u7f13\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u5b9e\u9645\u4e0d\u4f1a\u88ab\u518d\u6b21\u8bbf\u95ee\u4e86\uff0c\u4f46\u662f\u53c8\u5360\u636e\u4e86\u7f13\u5b58\u7a7a\u95f4\u3002\u5982\u679c\u8fd9\u6837\u7684\u6570\u636e\u4f53\u91cf\u5f88\u5927\uff0c\u751a\u81f3\u5360\u6ee1\u4e86\u7f13\u5b58\uff0c\u6bcf\u6b21\u6709\u65b0\u6570\u636e\u5199\u5165\u7f13\u5b58\u65f6\uff0c\u8fd8\u9700\u8981\u628a\u8fd9\u4e9b\u6570\u636e\u9010\u6b65\u6dd8\u6c70\u51fa\u7f13\u5b58\uff0c\u5c31\u4f1a\u589e\u52a0\u7f13\u5b58\u64cd\u4f5c\u7684\u65f6\u95f4\u5f00\u9500\u3002 \u8981\u89e3\u51b3\u7f13\u5b58\u6c61\u67d3\u95ee\u9898\uff0c\u6700\u5173\u952e\u7684\u6280\u672f\u70b9\u5c31\u662f\u80fd\u8bc6\u522b\u51fa\u8fd9\u4e9b\u53ea\u8bbf\u95ee\u4e00\u6b21\u6216\u662f\u8bbf\u95ee\u6b21\u6570\u5f88\u5c11\u7684\u6570\u636e\uff0c\u5728\u6dd8\u6c70\u6570\u636e\u65f6\uff0c\u4f18\u5148\u628a\u5b83\u4eec\u7b5b\u9009\u51fa\u6765\u5e76\u6dd8\u6c70\u6389\u3002 volatile-random \u548c allkeys-random \u662f\u968f\u673a\u9009\u62e9\u6570\u636e\u8fdb\u884c\u6dd8\u6c70\uff0c\u65e0\u6cd5\u628a\u4e0d\u518d\u8bbf\u95ee\u7684\u6570\u636e\u7b5b\u9009\u51fa\u6765\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u7f13\u5b58\u6c61\u67d3\u3002 \u5982\u679c\u4e1a\u52a1\u5c42\u660e\u786e\u77e5\u9053\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u957f\uff0c\u53ef\u4ee5\u7ed9\u6570\u636e\u8bbe\u7f6e\u5408\u7406\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u518d\u8bbe\u7f6e Redis \u7f13\u5b58\u4f7f\u7528 volatile-ttl \u7b56\u7565\u3002\u5f53\u7f13\u5b58\u5199\u6ee1\u65f6\uff0c\u5269\u4f59\u5b58\u6d3b\u65f6\u95f4\u6700\u77ed\u7684\u6570\u636e\u5c31\u4f1a\u88ab\u6dd8\u6c70\u51fa\u7f13\u5b58\uff0c\u907f\u514d\u6ede\u7559\u5728\u7f13\u5b58\u4e2d\uff0c\u9020\u6210\u6c61\u67d3\u3002 \u5f53\u6211\u4eec\u4f7f\u7528 LRU \u7b56\u7565\u65f6\uff0c\u7531\u4e8e LRU \u7b56\u7565\u53ea\u8003\u8651\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u6548\uff0c\u5bf9\u4e8e\u53ea\u8bbf\u95ee\u4e00\u6b21\u7684\u6570\u636e\u6765\u8bf4\uff0cLRU \u7b56\u7565\u65e0\u6cd5\u5f88\u5feb\u5c06\u5176\u7b5b\u9009\u51fa\u6765\u3002 \u800c LFU \u7b56\u7565\u5728 LRU \u7b56\u7565\u57fa\u7840\u4e0a\u8fdb\u884c\u4e86\u4f18\u5316\uff0c\u5728\u7b5b\u9009\u6570\u636e\u65f6\uff0c\u9996\u5148\u4f1a\u7b5b\u9009\u5e76\u6dd8\u6c70\u8bbf\u95ee\u6b21\u6570\u5c11\u7684\u6570\u636e\uff0c\u7136\u540e\u9488\u5bf9\u8bbf\u95ee\u6b21\u6570\u76f8\u540c\u7684\u6570\u636e\uff0c\u518d\u7b5b\u9009\u5e76\u6dd8\u6c70\u8bbf\u95ee\u65f6\u95f4\u6700\u4e45\u8fdc\u7684\u6570\u636e\u3002 \u5728\u5177\u4f53\u5b9e\u73b0\u4e0a\uff0c\u76f8\u5bf9\u4e8e LRU \u7b56\u7565\uff0cRedis \u53ea\u662f\u628a\u539f\u6765 24bit \u5927\u5c0f\u7684 lru \u5b57\u6bb5\uff0c\u53c8\u8fdb\u4e00\u6b65\u62c6\u5206\u6210\u4e86 16bit \u7684 ldt \u548c 8bit \u7684 counter\uff0c\u5206\u522b\u7528\u6765\u8868\u793a\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u95f4\u6233\u548c\u8bbf\u95ee\u6b21\u6570\u3002 \u4e3a\u4e86\u907f\u5f00 8bit \u6700\u5927\u53ea\u80fd\u8bb0\u5f55 255 \u7684\u9650\u5236\uff0cLFU \u7b56\u7565\u8bbe\u8ba1\u4f7f\u7528\u975e\u7ebf\u6027\u589e\u957f\u7684\u8ba1\u6570\u5668\u6765\u8868\u793a\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u3002 \u5728\u5b9e\u9645\u4e1a\u52a1\u5e94\u7528\u4e2d\uff0cLRU \u548c LFU \u4e24\u4e2a\u7b56\u7565\u90fd\u6709\u5e94\u7528\u3002LRU \u548c LFU \u4e24\u4e2a\u7b56\u7565\u5173\u6ce8\u7684\u6570\u636e\u8bbf\u95ee\u7279\u5f81\u5404\u6709\u4fa7\u91cd\uff0cLRU \u7b56\u7565\u66f4\u52a0\u5173\u6ce8\u6570\u636e\u7684\u65f6\u6548\u6027\uff0c\u800c LFU \u7b56\u7565\u66f4\u52a0\u5173\u6ce8\u6570\u636e\u7684\u8bbf\u95ee\u9891\u6b21 \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5b9e\u9645\u5e94\u7528\u7684\u8d1f\u8f7d\u5177\u6709\u8f83\u597d\u7684\u65f6\u95f4\u5c40\u90e8\u6027\uff0c\u6240\u4ee5 LRU \u7b56\u7565\u7684\u5e94\u7528\u4f1a\u66f4\u52a0\u5e7f\u6cdb\u3002\u4f46\u662f\uff0c\u5728\u626b\u63cf\u5f0f\u67e5\u8be2\u7684\u5e94\u7528\u573a\u666f\u4e2d\uff0cLFU \u7b56\u7565\u5c31\u53ef\u4ee5\u5f88\u597d\u5730\u5e94\u5bf9\u7f13\u5b58\u6c61\u67d3\u95ee\u9898\u4e86\uff0c\u5efa\u8bae\u4f60\u4f18\u5148\u4f7f\u7528\u3002 \u5916\uff0c\u5982\u679c\u4e1a\u52a1\u5e94\u7528\u4e2d\u6709\u77ed\u65f6\u9ad8\u9891\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u9664\u4e86 LFU \u7b56\u7565\u672c\u8eab\u4f1a\u5bf9\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u8fdb\u884c\u81ea\u52a8\u8870\u51cf\u4ee5\u5916\uff0c\u6211\u518d\u7ed9\u4f60\u4e2a\u5c0f\u5efa\u8bae\uff1a\u4f60\u53ef\u4ee5\u4f18\u5148\u4f7f\u7528 volatile-lfu \u7b56\u7565\uff0c\u5e76\u6839\u636e\u8fd9\u4e9b\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u9650\u8bbe\u7f6e\u5b83\u4eec\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u514d\u5b83\u4eec\u7559\u5b58\u5728\u7f13\u5b58\u4e2d\u9020\u6210\u6c61\u67d3","title":"5\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap5/5redis_cache_summary/","text":"\u7b2c\u4e94\u7ae0 Redis \u7f13\u5b58\u603b\u7ed3 1\u3001\u672c\u7ae0\u5c0f\u7ed3 1-1 Redis \u65c1\u8def\u7f13\u5b58 \u5206\u5c42\u7cfb\u7edf\u4e2d\uff0c\u6570\u636e\u6682\u5b58\u5728\u5feb\u901f\u5b50\u7cfb\u7edf\u4e2d\u6709\u52a9\u4e8e\u52a0\u901f\u8bbf\u95ee\uff1b\u7f13\u5b58\u5bb9\u91cf\u6709\u9650\uff0c\u7f13\u5b58\u5199\u6ee1\u65f6\uff0c\u6570\u636e\u9700\u8981\u88ab\u6dd8\u6c70 Redis \u5929\u7136\u5c31\u5177\u6709\u9ad8\u6027\u80fd\u8bbf\u95ee\u548c\u6570\u636e\u6dd8\u6c70\u673a\u5236\uff0c\u6b63\u597d\u7b26\u5408\u7f13\u5b58\u7684\u8fd9\u4e24\u4e2a\u7279\u5f81\u7684\u8981\u6c42\uff0c\u6240\u4ee5\u975e\u5e38\u9002\u5408\u7528\u4f5c\u7f13\u5b58\u3002 Redis \u4f5c\u4e3a\u65c1\u8def\u7f13\u5b58\u7684\u7279\u6027\uff0c\u65c1\u8def\u7f13\u5b58\u5c31\u610f\u5473\u7740\u9700\u8981\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u65b0\u589e\u7f13\u5b58\u903b\u8f91\u5904\u7406\u7684\u4ee3\u7801\u3002\u5f53\u7136\uff0c\u5982\u679c\u662f\u65e0\u6cd5\u4fee\u6539\u6e90\u7801\u7684\u5e94\u7528\u573a\u666f\uff0c\u5c31\u4e0d\u80fd\u4f7f\u7528 Redis \u505a\u7f13\u5b58\u4e86\u3002 Redis \u505a\u7f13\u5b58\u65f6\uff0c\u8fd8\u6709\u4e24\u79cd\u6a21\u5f0f\uff0c\u5206\u522b\u662f\u53ea\u8bfb\u7f13\u5b58\u548c\u8bfb\u5199\u7f13\u5b58\u3002 \u8bfb\u5199\u7f13\u5b58\u8fd8\u63d0\u4f9b\u4e86\u540c\u6b65\u76f4\u5199\u548c\u5f02\u6b65\u5199\u56de\u8fd9\u4e24\u79cd\u6a21\u5f0f\uff0c\u540c\u6b65\u76f4\u5199\u6a21\u5f0f\u4fa7\u91cd\u4e8e\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\uff0c\u800c\u5f02\u6b65\u5199\u56de\u6a21\u5f0f\u5219\u4fa7\u91cd\u4e8e\u63d0\u4f9b\u4f4e\u5ef6\u8fdf\u8bbf\u95ee\uff0c \u5982\u679c\u9700\u8981\u5bf9\u5199\u8bf7\u6c42\u8fdb\u884c\u52a0\u901f\uff0c\u6211\u4eec\u9009\u62e9\u8bfb\u5199\u7f13\u5b58\uff1b \u5982\u679c\u5199\u8bf7\u6c42\u5f88\u5c11\uff0c\u6216\u8005\u662f\u53ea\u9700\u8981\u63d0\u5347\u8bfb\u8bf7\u6c42\u7684\u54cd\u5e94\u901f\u5ea6\u7684\u8bdd\uff0c\u6211\u4eec\u9009\u62e9\u53ea\u8bfb\u7f13\u5b58\u3002 1-2 \u7f13\u5b58\u6ee1\u540e\u7684\u66ff\u6362\u7b56\u7565 \u7f13\u5b58\u66ff\u6362\u65f6\u7684\u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff0c\u4ee5\u53ca\u88ab\u6dd8\u6c70\u6570\u636e\u7684\u5904\u7406\u65b9\u6cd5\u3002 Redis 4.0 \u7248\u672c\u4ee5\u540e\u4e00\u5171\u63d0\u4f9b\u4e86 8 \u79cd\u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff0c\u4ece\u6dd8\u6c70\u6570\u636e\u7684\u5019\u9009\u96c6\u8303\u56f4\u6765\u770b\uff0c\u6211\u4eec\u6709\u4e24\u79cd\u5019\u9009\u8303\u56f4\uff1a \u4e00\u79cd\u662f\u6240\u6709\u6570\u636e\u90fd\u662f\u5019\u9009\u96c6\uff0c\u4e00\u79cd\u662f\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u662f\u5019\u9009\u96c6\u3002 \u53e6\u5916\uff0c\u65e0\u8bba\u662f\u9762\u5411\u54ea\u79cd\u5019\u9009\u6570\u636e\u96c6\u8fdb\u884c\u6dd8\u6c70\u6570\u636e\u9009\u62e9\uff0c\u6211\u4eec\u90fd\u6709\u4e09\u79cd\u7b56\u7565\uff0c \u5206\u522b\u662f\u968f\u673a\u9009\u62e9\uff0c\u6839\u636e LRU \u7b97\u6cd5\u9009\u62e9\uff0c\u4ee5\u53ca\u6839\u636e LFU \u7b97\u6cd5\u9009\u62e9 \u3002 \u5f53\u7136\uff0c\u5f53\u9762\u5411\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u9009\u62e9\u6dd8\u6c70\u6570\u636e\u65f6\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u6839\u636e\u6570\u636e\u79bb\u8fc7\u671f\u65f6\u95f4\u7684\u8fdc\u8fd1\u6765\u51b3\u5b9a\u3002 \u4e00\u822c\u6765\u8bf4\uff0c\u7f13\u5b58\u7cfb\u7edf\u5bf9\u4e8e\u9009\u5b9a\u7684\u88ab\u6dd8\u6c70\u6570\u636e\uff0c \u4f1a\u6839\u636e\u5176\u662f\u5e72\u51c0\u6570\u636e\u8fd8\u662f\u810f\u6570\u636e\uff0c\u9009\u62e9\u76f4\u63a5\u5220\u9664\u8fd8\u662f\u5199\u56de\u6570\u636e\u5e93 \u3002 \u4f46\u662f\uff0c\u5728 Redis \u4e2d\uff0c\u88ab\u6dd8\u6c70\u6570\u636e\u65e0\u8bba\u5e72\u51c0\u4e0e\u5426\u90fd\u4f1a\u88ab\u5220\u9664\uff0c\u6240\u4ee5\uff0c\u8fd9\u662f\u6211\u4eec\u5728\u4f7f\u7528 Redis \u7f13\u5b58\u65f6\u8981\u7279\u522b\u6ce8\u610f\u7684\uff1a\u5f53\u6570\u636e\u4fee\u6539\u6210\u4e3a\u810f\u6570\u636e\u65f6\uff0c\u9700\u8981\u5728\u6570\u636e\u5e93\u4e2d\u4e5f\u628a\u6570\u636e\u4fee\u6539\u8fc7\u6765\u3002 \u5148\u6839\u636e\u662f\u5426\u6709\u59cb\u7ec8\u4f1a\u88ab\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\uff08\u4f8b\u5982\u7f6e\u9876\u6d88\u606f\uff09\uff0c\u6765\u9009\u62e9\u6dd8\u6c70\u6570\u636e\u7684\u5019\u9009\u96c6\uff0c\u4e5f\u5c31\u662f\u51b3\u5b9a\u662f\u9488\u5bf9\u6240\u6709\u6570\u636e\u8fdb\u884c\u6dd8\u6c70\uff0c\u8fd8\u662f\u9488\u5bf9\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u8fdb\u884c\u6dd8\u6c70\u3002 \u5019\u9009\u6570\u636e\u96c6\u8303\u56f4\u9009\u5b9a\u540e\uff0c\u5efa\u8bae\u4f18\u5148\u4f7f\u7528 LRU \u7b97\u6cd5\uff0c\u4e5f\u5c31\u662f\uff0callkeys-lru \u6216 volatile-lru \u7b56\u7565\u3002 \u5408\u5b9e\u9645\u5e94\u7528\u7684\u6570\u636e\u603b\u91cf\u3001\u70ed\u6570\u636e\u7684\u4f53\u91cf\uff0c\u4ee5\u53ca\u6210\u672c\u9884\u7b97\uff0c\u628a\u7f13\u5b58\u7a7a\u95f4\u5927\u5c0f\u8bbe\u7f6e\u5728\u603b\u6570\u636e\u91cf\u7684 15% \u5230 30% \u8fd9\u4e2a\u533a\u95f4\u5c31\u53ef\u4ee5\u3002 1-3 \u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u7f13\u5b58\u5f02\u5e38 \u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u6700\u5e38\u9047\u89c1\u7684\u4e00\u4e2a\u95ee\u9898\uff0c\u4e5f\u5c31\u662f\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e0d\u4e00\u81f4\u7684\u95ee\u9898 \u5bf9\u4e8e\u8bfb\u5199\u7f13\u5b58\u6765\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u91c7\u7528\u540c\u6b65\u5199\u56de\u7b56\u7565\uff0c\u90a3\u4e48\u53ef\u4ee5\u4fdd\u8bc1\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u4e00\u81f4\u3002 \u5728\u5927\u591a\u6570\u4e1a\u52a1\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u4f1a\u628a Redis \u4f5c\u4e3a\u53ea\u8bfb\u7f13\u5b58\u4f7f\u7528 \u9488\u5bf9\u53ea\u8bfb\u7f13\u5b58\u6765\u8bf4\uff0c\u6211\u4eec\u65e2\u53ef\u4ee5\u5148\u5220\u9664\u7f13\u5b58\u503c\u518d\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u4e5f\u53ef\u4ee5\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u9664\u7f13\u5b58\u3002\u6211\u7684\u5efa\u8bae\u662f\uff0c \u4f18\u5148\u4f7f\u7528\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u9664\u7f13\u5b58\u7684\u65b9\u6cd5 \uff0c\u539f\u56e0\u4e3b\u8981\u6709\u4e24\u4e2a\uff1a \u5148\u5220\u9664\u7f13\u5b58\u503c\u518d\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u6709\u53ef\u80fd\u5bfc\u81f4\u8bf7\u6c42\u56e0\u7f13\u5b58\u7f3a\u5931\u800c\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u538b\u529b\uff1b \u5982\u679c\u4e1a\u52a1\u5e94\u7528\u4e2d\u8bfb\u53d6\u6570\u636e\u5e93\u548c\u5199\u7f13\u5b58\u7684\u65f6\u95f4\u4e0d\u597d\u4f30\u7b97\uff0c\u90a3\u4e48\uff0c\u5ef6\u8fdf\u53cc\u5220\u4e2d\u7684\u7b49\u5f85\u65f6\u95f4\u5c31\u4e0d\u597d\u8bbe\u7f6e\u3002 \u4e0d\u8fc7\uff0c\u5f53\u4f7f\u7528\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u9664\u7f13\u5b58\u65f6\uff0c\u4e5f\u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\uff0c \u5982\u679c\u4e1a\u52a1\u5c42\u8981\u6c42\u5fc5\u987b\u8bfb\u53d6\u4e00\u81f4\u7684\u6570\u636e\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5728\u66f4\u65b0\u6570\u636e\u5e93\u65f6\uff0c\u5148\u5728 Redis \u7f13\u5b58\u5ba2\u6237\u7aef\u6682\u5b58\u5e76\u53d1\u8bfb\u8bf7\u6c42\uff0c\u7b49\u6570\u636e\u5e93\u66f4\u65b0\u5b8c\u3001\u7f13\u5b58\u503c\u5220\u9664\u540e\uff0c\u518d\u8bfb\u53d6\u6570\u636e\uff0c\u4ece\u800c\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027 \u3002 \u7f13\u5b58\u96ea\u5d29\u548c\u51fb\u7a7f\u4e3b\u8981\u662f\u56e0\u4e3a\u6570\u636e\u4e0d\u5728\u7f13\u5b58\u4e2d\u4e86\uff0c\u800c\u7f13\u5b58\u7a7f\u900f\u5219\u662f\u56e0\u4e3a\u6570\u636e\u65e2\u4e0d\u5728\u7f13\u5b58\u4e2d\uff0c\u4e5f\u4e0d\u5728\u6570\u636e\u5e93\u4e2d\u3002 \u6240\u4ee5\uff0c\u7f13\u5b58\u96ea\u5d29\u6216\u51fb\u7a7f\u65f6\uff0c \u4e00\u65e6\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u88ab\u518d\u6b21\u5199\u5165\u5230\u7f13\u5b58\u540e\uff0c\u5e94\u7528\u53c8\u53ef\u4ee5\u5728\u7f13\u5b58\u4e2d\u5feb\u901f\u8bbf\u95ee\u6570\u636e\u4e86 \uff0c\u6570\u636e\u5e93\u7684\u538b\u529b\u4e5f\u4f1a\u76f8\u5e94\u5730\u964d\u4f4e\u4e0b\u6765 \u800c\u7f13\u5b58\u7a7f\u900f\u53d1\u751f\u65f6 \uff0cRedis \u7f13\u5b58\u548c\u6570\u636e\u5e93\u4f1a\u540c\u65f6\u6301\u7eed\u627f\u53d7\u8bf7\u6c42\u538b\u529b\u3002 \u670d\u52a1\u7194\u65ad\u3001\u670d\u52a1\u964d\u7ea7\u3001\u8bf7\u6c42\u9650\u6d41\u8fd9\u4e9b\u65b9\u6cd5\u90fd\u662f\u5c5e\u4e8e\u201c\u6709\u635f\u201d\u65b9\u6848\uff0c\u5728\u4fdd\u8bc1\u6570\u636e\u5e93\u548c\u6574\u4f53\u7cfb\u7edf\u7a33\u5b9a\u7684\u540c\u65f6\uff0c\u4f1a\u5bf9\u4e1a\u52a1\u5e94\u7528\u5e26\u6765\u8d1f\u9762\u5f71\u54cd\u3002 \u4f8b\u5982\u4f7f\u7528\u670d\u52a1\u964d\u7ea7\u65f6\uff0c\u6709\u90e8\u5206\u6570\u636e\u7684\u8bf7\u6c42\u5c31\u53ea\u80fd\u5f97\u5230\u9519\u8bef\u8fd4\u56de\u4fe1\u606f\uff0c\u65e0\u6cd5\u6b63\u5e38\u5904\u7406\u3002\u5982\u679c\u4f7f\u7528\u4e86\u670d\u52a1\u7194\u65ad\uff0c\u90a3\u4e48\uff0c\u6574\u4e2a\u7f13\u5b58\u7cfb\u7edf\u7684\u670d\u52a1\u90fd\u88ab\u6682\u505c\u4e86\uff0c\u5f71\u54cd\u7684\u4e1a\u52a1\u8303\u56f4\u66f4\u5927\u3002\u800c\u4f7f\u7528\u4e86\u8bf7\u6c42\u9650\u6d41\u673a\u5236\u540e\uff0c\u6574\u4e2a\u4e1a\u52a1\u7cfb\u7edf\u7684\u541e\u5410\u7387\u4f1a\u964d\u4f4e\uff0c\u80fd\u5e76\u53d1\u5904\u7406\u7684\u7528\u6237\u8bf7\u6c42\u4f1a\u51cf\u5c11\uff0c\u4f1a\u5f71\u54cd\u5230\u7528\u6237\u4f53\u9a8c \u5c3d\u91cf\u4f7f\u7528\u9884\u9632\u5f0f\u65b9\u6848\uff1a \u9488\u5bf9\u7f13\u5b58\u96ea\u5d29\uff0c\u5408\u7406\u5730\u8bbe\u7f6e\u6570\u636e\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u53ca\u642d\u5efa\u9ad8\u53ef\u9760\u7f13\u5b58\u96c6\u7fa4 \uff1b \u9488\u5bf9\u7f13\u5b58\u51fb\u7a7f\uff0c\u5728\u7f13\u5b58\u8bbf\u95ee\u975e\u5e38\u9891\u7e41\u7684\u70ed\u70b9\u6570\u636e\u65f6\uff0c\u4e0d\u8981\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff1b \u9488\u5bf9\u7f13\u5b58\u7a7f\u900f\uff0c\u63d0\u524d\u5728\u5165\u53e3\u524d\u7aef\u5b9e\u73b0\u6076\u610f\u8bf7\u6c42\u68c0\u6d4b\uff0c\u6216\u8005\u89c4\u8303\u6570\u636e\u5e93\u7684\u6570\u636e\u5220\u9664\u64cd\u4f5c\uff0c\u907f\u514d\u8bef\u5220\u9664\u3002 1-4 \u7f13\u5b58\u88ab\u6c61\u67d3\u7684\u89e3\u51b3\u95ee\u9898 \u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u6c61\u67d3 \u7f13\u5b58\u6c61\u67d3\u95ee\u9898\u6307\u7684\u662f\u7559\u5b58\u5728\u7f13\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u5b9e\u9645\u4e0d\u4f1a\u88ab\u518d\u6b21\u8bbf\u95ee\u4e86\uff0c\u4f46\u662f\u53c8\u5360\u636e\u4e86\u7f13\u5b58\u7a7a\u95f4\u3002\u5982\u679c\u8fd9\u6837\u7684\u6570\u636e\u4f53\u91cf\u5f88\u5927\uff0c\u751a\u81f3\u5360\u6ee1\u4e86\u7f13\u5b58\uff0c\u6bcf\u6b21\u6709\u65b0\u6570\u636e\u5199\u5165\u7f13\u5b58\u65f6\uff0c\u8fd8\u9700\u8981\u628a\u8fd9\u4e9b\u6570\u636e\u9010\u6b65\u6dd8\u6c70\u51fa\u7f13\u5b58\uff0c\u5c31\u4f1a\u589e\u52a0\u7f13\u5b58\u64cd\u4f5c\u7684\u65f6\u95f4\u5f00\u9500\u3002 \u8981\u89e3\u51b3\u7f13\u5b58\u6c61\u67d3\u95ee\u9898\uff0c\u6700\u5173\u952e\u7684\u6280\u672f\u70b9\u5c31\u662f\u80fd\u8bc6\u522b\u51fa\u8fd9\u4e9b\u53ea\u8bbf\u95ee\u4e00\u6b21\u6216\u662f\u8bbf\u95ee\u6b21\u6570\u5f88\u5c11\u7684\u6570\u636e\uff0c\u5728\u6dd8\u6c70\u6570\u636e\u65f6\uff0c\u4f18\u5148\u628a\u5b83\u4eec\u7b5b\u9009\u51fa\u6765\u5e76\u6dd8\u6c70\u6389\u3002 volatile-random \u548c allkeys-random \u662f\u968f\u673a\u9009\u62e9\u6570\u636e\u8fdb\u884c\u6dd8\u6c70\uff0c\u65e0\u6cd5\u628a\u4e0d\u518d\u8bbf\u95ee\u7684\u6570\u636e\u7b5b\u9009\u51fa\u6765\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u7f13\u5b58\u6c61\u67d3\u3002 \u5982\u679c\u4e1a\u52a1\u5c42\u660e\u786e\u77e5\u9053\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u957f\uff0c\u53ef\u4ee5\u7ed9\u6570\u636e\u8bbe\u7f6e\u5408\u7406\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u518d\u8bbe\u7f6e Redis \u7f13\u5b58\u4f7f\u7528 volatile-ttl \u7b56\u7565\u3002\u5f53\u7f13\u5b58\u5199\u6ee1\u65f6\uff0c\u5269\u4f59\u5b58\u6d3b\u65f6\u95f4\u6700\u77ed\u7684\u6570\u636e\u5c31\u4f1a\u88ab\u6dd8\u6c70\u51fa\u7f13\u5b58\uff0c\u907f\u514d\u6ede\u7559\u5728\u7f13\u5b58\u4e2d\uff0c\u9020\u6210\u6c61\u67d3\u3002 \u5f53\u6211\u4eec\u4f7f\u7528 LRU \u7b56\u7565\u65f6\uff0c\u7531\u4e8e LRU \u7b56\u7565\u53ea\u8003\u8651\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u6548\uff0c\u5bf9\u4e8e\u53ea\u8bbf\u95ee\u4e00\u6b21\u7684\u6570\u636e\u6765\u8bf4\uff0cLRU \u7b56\u7565\u65e0\u6cd5\u5f88\u5feb\u5c06\u5176\u7b5b\u9009\u51fa\u6765\u3002 \u800c LFU \u7b56\u7565\u5728 LRU \u7b56\u7565\u57fa\u7840\u4e0a\u8fdb\u884c\u4e86\u4f18\u5316\uff0c\u5728\u7b5b\u9009\u6570\u636e\u65f6\uff0c\u9996\u5148\u4f1a\u7b5b\u9009\u5e76\u6dd8\u6c70\u8bbf\u95ee\u6b21\u6570\u5c11\u7684\u6570\u636e\uff0c\u7136\u540e\u9488\u5bf9\u8bbf\u95ee\u6b21\u6570\u76f8\u540c\u7684\u6570\u636e\uff0c\u518d\u7b5b\u9009\u5e76\u6dd8\u6c70\u8bbf\u95ee\u65f6\u95f4\u6700\u4e45\u8fdc\u7684\u6570\u636e\u3002 \u5728\u5177\u4f53\u5b9e\u73b0\u4e0a\uff0c\u76f8\u5bf9\u4e8e LRU \u7b56\u7565\uff0cRedis \u53ea\u662f\u628a\u539f\u6765 24bit \u5927\u5c0f\u7684 lru \u5b57\u6bb5\uff0c\u53c8\u8fdb\u4e00\u6b65\u62c6\u5206\u6210\u4e86 16bit \u7684 ldt \u548c 8bit \u7684 counter\uff0c\u5206\u522b\u7528\u6765\u8868\u793a\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u95f4\u6233\u548c\u8bbf\u95ee\u6b21\u6570\u3002 \u4e3a\u4e86\u907f\u5f00 8bit \u6700\u5927\u53ea\u80fd\u8bb0\u5f55 255 \u7684\u9650\u5236\uff0cLFU \u7b56\u7565\u8bbe\u8ba1\u4f7f\u7528\u975e\u7ebf\u6027\u589e\u957f\u7684\u8ba1\u6570\u5668\u6765\u8868\u793a\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u3002 \u5728\u5b9e\u9645\u4e1a\u52a1\u5e94\u7528\u4e2d\uff0cLRU \u548c LFU \u4e24\u4e2a\u7b56\u7565\u90fd\u6709\u5e94\u7528\u3002LRU \u548c LFU \u4e24\u4e2a\u7b56\u7565\u5173\u6ce8\u7684\u6570\u636e\u8bbf\u95ee\u7279\u5f81\u5404\u6709\u4fa7\u91cd\uff0cLRU \u7b56\u7565\u66f4\u52a0\u5173\u6ce8\u6570\u636e\u7684\u65f6\u6548\u6027\uff0c\u800c LFU \u7b56\u7565\u66f4\u52a0\u5173\u6ce8\u6570\u636e\u7684\u8bbf\u95ee\u9891\u6b21 \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5b9e\u9645\u5e94\u7528\u7684\u8d1f\u8f7d\u5177\u6709\u8f83\u597d\u7684\u65f6\u95f4\u5c40\u90e8\u6027\uff0c\u6240\u4ee5 LRU \u7b56\u7565\u7684\u5e94\u7528\u4f1a\u66f4\u52a0\u5e7f\u6cdb\u3002\u4f46\u662f\uff0c\u5728\u626b\u63cf\u5f0f\u67e5\u8be2\u7684\u5e94\u7528\u573a\u666f\u4e2d\uff0cLFU \u7b56\u7565\u5c31\u53ef\u4ee5\u5f88\u597d\u5730\u5e94\u5bf9\u7f13\u5b58\u6c61\u67d3\u95ee\u9898\u4e86\uff0c\u5efa\u8bae\u4f60\u4f18\u5148\u4f7f\u7528\u3002 \u5916\uff0c\u5982\u679c\u4e1a\u52a1\u5e94\u7528\u4e2d\u6709\u77ed\u65f6\u9ad8\u9891\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u9664\u4e86 LFU \u7b56\u7565\u672c\u8eab\u4f1a\u5bf9\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u8fdb\u884c\u81ea\u52a8\u8870\u51cf\u4ee5\u5916\uff0c\u6211\u518d\u7ed9\u4f60\u4e2a\u5c0f\u5efa\u8bae\uff1a\u4f60\u53ef\u4ee5\u4f18\u5148\u4f7f\u7528 volatile-lfu \u7b56\u7565\uff0c\u5e76\u6839\u636e\u8fd9\u4e9b\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u9650\u8bbe\u7f6e\u5b83\u4eec\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u514d\u5b83\u4eec\u7559\u5b58\u5728\u7f13\u5b58\u4e2d\u9020\u6210\u6c61\u67d3 2\u3001\u672c\u7ae0\u64cd\u4f5c\u603b\u7ed3 \u5c55\u793a\u4e00\u6bb5 Web \u5e94\u7528\u4e2d\u4f7f\u7528 Redis \u7f13\u5b58\u7684\u4f2a\u4ee3\u7801\u793a\u4f8b\u3002 String cacheKey = \u201cproductid_11010003\u201d; String cacheValue = redisCache.get(cacheKey)\uff1b //\u7f13\u5b58\u547d\u4e2d if ( cacheValue != NULL) return cacheValue; //\u7f13\u5b58\u7f3a\u5931 else cacheValue = getProductFromDB(); redisCache.put(cacheValue) //\u7f13\u5b58\u66f4\u65b0 \u5bf9\u4e8e Redis \u6765\u8bf4\uff0c\u4e00\u65e6\u786e\u5b9a\u4e86\u7f13\u5b58\u6700\u5927\u5bb9\u91cf\uff0c\u6bd4\u5982 4GB\uff0c\u4f60\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u4e2a\u547d\u4ee4\u6765\u8bbe\u5b9a\u7f13\u5b58\u7684\u5927\u5c0f\u4e86\uff1a CONFIG SET maxmemory 4gb \u8fd9\u6837\u4e00\u6765\uff0c\u5176\u5b83\u7ebf\u7a0b\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u4f1a\u53d1\u73b0\u7f13\u5b58\u7f3a\u5931\uff0c\u6240\u4ee5\u4f1a\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6700\u65b0\u503c\u3002\u56e0\u4e3a\u8fd9\u4e2a\u65b9\u6848\u4f1a\u5728\u7b2c\u4e00\u6b21\u5220\u9664\u7f13\u5b58\u503c\u540e\uff0c\u5ef6\u8fdf\u4e00\u6bb5\u65f6\u95f4\u518d\u6b21\u8fdb\u884c\u5220\u9664\uff0c\u6240\u4ee5\u6211\u4eec\u4e5f\u628a\u5b83\u53eb\u505a\u201c\u5ef6\u8fdf\u53cc\u5220\u201d\u3002 redis.delKey(X) db.update(X) Thread.sleep(N) redis.delKey(X) 3\u3001\u672c\u7ae0\u95ee\u9898 \u95ee\u9898 \uff1aRedis \u7684\u53ea\u8bfb\u7f13\u5b58\u548c\u4f7f\u7528\u76f4\u5199\u7b56\u7565\u7684\u8bfb\u5199\u7f13\u5b58\uff0c\u90fd\u4f1a\u628a\u6570\u636e\u540c\u6b65\u5199\u5230\u540e\u7aef\u6570\u636e\u5e93\u4e2d\uff0c\u4f60\u89c9\u5f97\u5b83\u4eec\u6709\u4ec0\u4e48\u533a\u522b\u5417\uff1f \u7b54\u6848\uff1a\u4e3b\u8981\u7684\u533a\u522b\u5728\u4e8e\uff0c\u5f53\u6709\u7f13\u5b58\u6570\u636e\u88ab\u4fee\u6539\u65f6\uff0c \u5728\u53ea\u8bfb\u7f13\u5b58\u4e2d\uff0c\u4e1a\u52a1\u5e94\u7528\u4f1a\u76f4\u63a5\u4fee\u6539\u6570\u636e\u5e93\uff0c\u5e76\u628a\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u6807\u8bb0\u4e3a\u65e0\u6548\uff1b\u800c\u5728\u8bfb\u5199\u7f13\u5b58\u4e2d\uff0c\u4e1a\u52a1\u5e94\u7528\u9700\u8981\u540c\u65f6\u4fee\u6539\u7f13\u5b58\u548c\u6570\u636e\u5e93 \u3002 \u95ee\u9898 \uff1aRedis \u7f13\u5b58\u5728\u5904\u7406\u810f\u6570\u636e\u65f6\uff0c\u4e0d\u4ec5\u4f1a\u4fee\u6539\u6570\u636e\uff0c\u8fd8\u4f1a\u628a\u5b83\u5199\u56de\u6570\u636e\u5e93\u3002\u6211\u4eec\u5728\u524d\u9762\u5b66\u8fc7 Redis \u7684\u53ea\u8bfb\u7f13\u5b58\u6a21\u5f0f\u548c\u4e24\u79cd\u8bfb\u5199\u7f13\u5b58\u6a21\u5f0f\uff08\u5e26\u540c\u6b65\u76f4\u5199\u7684\u8bfb\u5199\u6a21\u5f0f\uff0c\u5e26\u5f02\u6b65\u5199\u56de\u7684\u8bfb\u5199\u6a21\u5f0f\uff09\uff09\uff0c\u8bf7\u4f60\u601d\u8003\u4e0b\uff0cRedis \u7f13\u5b58\u5bf9\u5e94\u54ea\u4e00\u79cd\u6216\u54ea\u51e0\u79cd\u6a21\u5f0f\uff1f \u7b54\u6848\uff1a\u5982\u679c\u6211\u4eec\u5728\u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u9700\u8981\u628a\u810f\u6570\u636e\u5199\u56de\u6570\u636e\u5e93\uff0c \u8fd9\u5c31\u610f\u5473\u7740\uff0cRedis \u4e2d\u7f13\u5b58\u7684\u6570\u636e\u53ef\u4ee5\u76f4\u63a5\u88ab\u4fee\u6539\uff0c\u8fd9\u5c31\u5bf9\u5e94\u4e86\u8bfb\u5199\u7f13\u5b58\u6a21\u5f0f \u3002\u66f4\u8fdb\u4e00\u6b65\u5206\u6790\u7684\u8bdd\uff0c \u810f\u6570\u636e\u662f\u5728\u88ab\u66ff\u6362\u51fa\u7f13\u5b58\u65f6\u5199\u56de\u540e\u7aef\u6570\u636e\u5e93\u7684\uff0c\u8fd9\u5c31\u5bf9\u5e94\u4e86\u5e26\u6709\u5f02\u6b65\u5199\u56de\u7b56\u7565\u7684\u8bfb\u5199\u7f13\u5b58\u6a21\u5f0f \u3002 \u95ee\u9898 \uff1a\u5728\u53ea\u8bfb\u7f13\u5b58\u4e2d\u5bf9\u6570\u636e\u8fdb\u884c\u5220\u6539\u65f6\uff0c\u9700\u8981\u5728\u7f13\u5b58\u4e2d\u5220\u9664\u76f8\u5e94\u7684\u7f13\u5b58\u503c\u3002\u5982\u679c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e0d\u662f\u5220\u9664\u7f13\u5b58\u503c\uff0c\u800c\u662f\u76f4\u63a5\u66f4\u65b0\u7f13\u5b58\u7684\u503c\uff0c\u4f60\u89c9\u5f97\uff0c\u548c\u5220\u9664\u7f13\u5b58\u503c\u76f8\u6bd4\uff0c\u76f4\u63a5\u66f4\u65b0\u7f13\u5b58\u503c\u6709\u4ec0\u4e48\u597d\u5904\u548c\u4e0d\u8db3\u5417\uff1f \u7b54\u6848\uff1a\u5982\u679c\u6211\u4eec\u76f4\u63a5\u5728\u7f13\u5b58\u4e2d\u66f4\u65b0\u7f13\u5b58\u503c\uff0c\u7b49\u5230\u4e0b\u6b21\u6570\u636e\u518d\u88ab\u8bbf\u95ee\u65f6\uff0c\u4e1a\u52a1\u5e94\u7528\u53ef\u4ee5\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u8fd9\u662f\u5b83\u7684\u4e00\u5927\u597d\u5904\u3002 \u4e0d\u8db3\u4e4b\u5904\u5728\u4e8e\uff0c\u5f53\u6709\u6570\u636e\u66f4\u65b0\u64cd\u4f5c\u65f6\uff0c\u6211\u4eec\u8981\u4fdd\u8bc1\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\uff0c \u8fd9\u5c31\u53ef\u4ee5\u91c7\u7528\u91cd\u8bd5\u6216\u5ef6\u65f6\u53cc\u5220\u65b9\u6cd5 \u3002\u4e0d\u8fc7\uff0c\u8fd9\u6837\u5c31\u9700\u8981\u5728\u4e1a\u52a1\u5e94\u7528\u4e2d\u589e\u52a0\u989d\u5916\u4ee3\u7801\uff0c\u6709\u4e00\u5b9a\u7684\u5f00\u9500\u3002 \u95ee\u9898 \uff1a\u5728\u8bb2\u5230\u7f13\u5b58\u96ea\u5d29\u65f6\uff0c\u6211\u63d0\u5230\uff0c\u53ef\u4ee5\u91c7\u7528\u670d\u52a1\u7194\u65ad\u3001\u670d\u52a1\u964d\u7ea7\u3001\u8bf7\u6c42\u9650\u6d41\u4e09\u79cd\u65b9\u6cd5\u6765\u5e94\u5bf9\u3002\u8bf7\u4f60\u601d\u8003\u4e0b\uff0c\u8fd9\u4e09\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u7528\u6765\u5e94\u5bf9\u7f13\u5b58\u7a7f\u900f\u95ee\u9898\u5417\uff1f \u7f13\u5b58\u7a7f\u900f\u8fd9\u4e2a\u95ee\u9898\u7684\u672c\u8d28\u662f\u67e5\u8be2\u4e86 Redis \u548c\u6570\u636e\u5e93\u4e2d\u6ca1\u6709\u7684\u6570\u636e\uff0c \u670d\u52a1\u7194\u65ad\u3001\u670d\u52a1\u964d\u7ea7\u548c\u8bf7\u6c42\u9650\u6d41\u7684\u65b9\u6cd5\uff0c\u672c\u8d28\u4e0a\u662f\u4e3a\u4e86\u89e3\u51b3 Redis \u5b9e\u4f8b\u6ca1\u6709\u8d77\u5230\u7f13\u5b58\u5c42\u4f5c\u7528\u7684\u95ee\u9898\uff0c\u7f13\u5b58\u96ea\u5d29\u548c\u7f13\u5b58\u51fb\u7a7f\u90fd\u5c5e\u4e8e\u8fd9\u7c7b\u95ee\u9898\u3002 \u5728\u7f13\u5b58\u7a7f\u900f\u7684\u573a\u666f\u4e0b\uff0c\u4e1a\u52a1\u5e94\u7528\u662f\u8981\u4ece Redis \u548c\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u6b64\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u4eba\u5de5\u4ecb\u5165\uff0cRedis \u662f\u65e0\u6cd5\u53d1\u6325\u7f13\u5b58\u4f5c\u7528\u7684\u3002 \u4e00\u4e2a\u53ef\u884c\u7684\u529e\u6cd5\u5c31\u662f \u4e8b\u524d\u62e6\u622a \uff0c\u4e0d\u8ba9\u8fd9\u79cd\u67e5\u8be2 Redis \u548c\u6570\u636e\u5e93\u4e2d\u90fd\u6ca1\u6709\u7684\u6570\u636e\u7684\u8bf7\u6c42\u53d1\u9001\u5230\u6570\u636e\u5e93\u5c42\u3002 \u5728\u7f13\u5b58\u7a7f\u900f\u7684\u573a\u666f\u4e0b\uff0c\u4e1a\u52a1\u5e94\u7528\u662f\u8981\u4ece Redis \u548c\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u6b64\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u4eba\u5de5\u4ecb\u5165\uff0cRedis \u662f\u65e0\u6cd5\u53d1\u6325\u7f13\u5b58\u4f5c\u7528\u7684\u3002\u4e00\u4e2a\u53ef\u884c\u7684\u529e\u6cd5\u5c31\u662f\u4e8b\u524d\u62e6\u622a\uff0c\u4e0d\u8ba9\u8fd9\u79cd\u67e5\u8be2 Redis \u548c\u6570\u636e\u5e93\u4e2d\u90fd\u6ca1\u6709\u7684\u6570\u636e\u7684\u8bf7\u6c42\u53d1\u9001\u5230\u6570\u636e\u5e93\u5c42\u3002 \u53e6\u5916\uff0c\u8fd9\u91cc\uff0c\u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\u4e0b\uff0c\u5bf9\u4e8e\u7f13\u5b58\u96ea\u5d29\u548c\u51fb\u7a7f\u95ee\u9898\u6765\u8bf4\uff0c\u670d\u52a1\u7194\u65ad\u3001\u670d\u52a1\u964d\u7ea7\u548c\u8bf7\u6c42\u9650\u6d41\u8fd9\u4e09\u79cd\u65b9\u6cd5\u5c5e\u4e8e\u6709\u635f\u65b9\u6cd5\uff0c\u4f1a\u964d\u4f4e\u4e1a\u52a1\u541e\u5410\u91cf\u3001\u62d6\u6162\u7cfb\u7edf\u54cd\u5e94\u3001\u964d\u4f4e\u7528\u6237\u4f53\u9a8c\u3002\u4e0d\u8fc7\uff0c\u91c7\u7528\u8fd9\u4e9b\u65b9\u6cd5\u540e\uff0c\u968f\u7740\u6570\u636e\u6162\u6162\u5730\u91cd\u65b0\u586b\u5145\u56de Redis\uff0cRedis \u8fd8\u662f\u53ef\u4ee5\u9010\u6b65\u6062\u590d\u7f13\u5b58\u5c42\u4f5c\u7528\u7684\u3002 \u95ee\u9898 \uff1a\u4f7f\u7528\u4e86 LFU \u7b56\u7565\u540e\uff0c\u7f13\u5b58\u8fd8\u4f1a\u88ab\u6c61\u67d3\u5417\uff1f \u7b54\u6848\uff1a\u5728 Redis \u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u4e86 LFU \u7b56\u7565\u540e\uff0c\u8fd8\u662f\u6709\u53ef\u80fd\u53d1\u751f\u7f13\u5b58\u6c61\u67d3\u7684\u3002 \u5728\u4e00\u4e9b\u6781\u7aef\u60c5\u51b5\u4e0b\uff0cLFU \u7b56\u7565\u4f7f\u7528\u7684\u8ba1\u6570\u5668\u53ef\u80fd\u4f1a\u5728\u77ed\u65f6\u95f4\u5185\u8fbe\u5230\u4e00\u4e2a\u5f88\u5927\u503c\uff0c\u800c\u8ba1\u6570\u5668\u7684\u8870\u51cf\u914d\u7f6e\u9879\u8bbe\u7f6e\u5f97\u8f83\u5927\uff0c\u5bfc\u81f4\u8ba1\u6570\u5668\u503c\u8870\u51cf\u5f88\u6162\uff0c \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6570\u636e\u5c31\u53ef\u80fd\u5728\u7f13\u5b58\u4e2d\u957f\u671f\u9a7b\u7559\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a\u6570\u636e\u5728\u77ed\u65f6\u95f4\u5185\u88ab\u9ad8\u9891\u8bbf\u95ee\uff0c\u5373\u4f7f\u6211\u4eec\u4f7f\u7528\u4e86 LFU \u7b56\u7565\uff0c\u8fd9\u4e2a\u6570\u636e\u4e5f\u6709\u53ef\u80fd\u6ede\u7559\u5728\u7f13\u5b58\u4e2d\uff0c\u9020\u6210\u6c61\u67d3\u3002 4\u3001\u5178\u578b\u95ee\u9898\u7b54\u7591 4-1 \u5982\u4f55\u7406\u89e3\u628a Redis \u79f0\u4e3a\u65c1\u8def\u7f13\u5b58\uff1f Redis \u79f0\u4e3a\u65c1\u8def\u7f13\u5b58\uff0c\u66f4\u591a\u7684\u662f\u4ece\u201c\u4e1a\u52a1\u5e94\u7528\u7a0b\u5e8f\u5982\u4f55\u4f7f\u7528 Redis \u7f13\u5b58\u201d\u8fd9\u4e2a\u89d2\u5ea6\u6765\u8bf4\u7684\u3002 \u4e1a\u52a1\u5e94\u7528\u5728\u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u9700\u8981\u5728\u4e1a\u52a1\u4ee3\u7801\u4e2d\u663e\u5f0f\u5730\u589e\u52a0\u7f13\u5b58\u7684\u64cd\u4f5c\u903b\u8f91 \u3002 \u4f8b\u5982\uff0c\u4e00\u4e2a\u57fa\u672c\u7684\u7f13\u5b58\u64cd\u4f5c\u5c31\u662f\uff0c\u4e00\u65e6\u53d1\u751f\u7f13\u5b58\u7f3a\u5931\uff0c\u4e1a\u52a1\u5e94\u7528\u9700\u8981\u81ea\u884c\u53bb\u8bfb\u53d6\u6570\u636e\u5e93\uff0c\u800c\u4e0d\u662f\u7f13\u5b58\u81ea\u8eab\u53bb\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\u518d\u8fd4\u56de\u3002\u4e3a\u4e86\u4fbf\u4e8e\u4f60\u7406\u89e3\uff0c\u6211\u4eec\u518d\u6765\u770b\u4e0b\u548c\u65c1\u8def\u7f13\u5b58\u76f8\u5bf9\u5e94\u7684\u3001\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\u7684 CPU \u7f13\u5b58\u548c page cache\u3002\u8fd9\u4e24\u79cd\u7f13\u5b58\u9ed8\u8ba4\u5c31\u5728\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u5185\u5b58\u548c\u78c1\u76d8\u7684\u8def\u5f84\u4e0a\uff0c\u6211\u4eec\u5199\u7684\u5e94\u7528\u7a0b\u5e8f\u90fd\u80fd\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e24\u79cd\u7f13\u5b58\u3002 \u6211\u4e4b\u6240\u4ee5\u5f3a\u8c03 Redis \u662f\u4e00\u4e2a\u65c1\u8def\u7f13\u5b58\uff0c\u4e5f\u662f\u5e0c\u671b\u4f60\u80fd\u591f\u8bb0\u4f4f\uff0c\u5728\u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u6211\u4eec\u9700\u8981\u4fee\u6539\u4e1a\u52a1\u4ee3\u7801\u3002 4-2 \u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u5e94\u8be5\u7528\u54ea\u79cd\u6a21\u5f0f\uff1f \u7f13\u5b58\u6a21\u5f0f\u6709\u4e09\u79cd\uff1a \u53ea\u8bfb\u7f13\u5b58\u6a21\u5f0f\u3001\u91c7\u7528\u540c\u6b65\u76f4\u5199\u7b56\u7565\u7684\u8bfb\u5199\u7f13\u5b58\u6a21\u5f0f\u3001\u91c7\u7528\u5f02\u6b65\u5199\u56de\u7b56\u7565\u7684\u8bfb\u5199\u7f13\u5b58\u6a21\u5f0f\u3002 \u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u4f1a\u628a Redis \u7f13\u5b58\u7528\u4f5c\u53ea\u8bfb\u7f13\u5b58\u3002 \u53ea\u8bfb\u7f13\u5b58\u6d89\u53ca\u7684\u64cd\u4f5c\uff0c\u5305\u62ec\u67e5\u8be2\u7f13\u5b58\u3001\u7f13\u5b58\u7f3a\u5931\u65f6\u8bfb\u6570\u636e\u5e93\u548c\u56de\u586b\uff0c\u6570\u636e\u66f4\u65b0\u65f6\u5220\u9664\u7f13\u5b58\u6570\u636e\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u53ef\u4ee5\u52a0\u5230\u4e1a\u52a1\u5e94\u7528\u4e2d\u3002\u800c\u4e14\uff0c\u5f53\u6570\u636e\u66f4\u65b0\u65f6\uff0c\u7f13\u5b58\u76f4\u63a5\u5220\u9664\u6570\u636e\uff0c\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e00\u81f4\u6027\u8f83\u4e3a\u5bb9\u6613\u4fdd\u8bc1\u3002 \u5f53\u7136\uff0c\u6709\u65f6\u6211\u4eec\u4e5f\u4f1a\u628a Redis \u7528\u4f5c\u8bfb\u5199\u7f13\u5b58\uff0c\u540c\u65f6\u91c7\u7528\u540c\u6b65\u76f4\u5199\u7b56\u7565\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7f13\u5b58\u6d89\u53ca\u7684\u64cd\u4f5c\u4e5f\u90fd\u53ef\u4ee5\u52a0\u5230\u4e1a\u52a1\u5e94\u7528\u4e2d\u3002\u800c\u4e14\uff0c\u548c\u53ea\u8bfb\u7f13\u5b58\u76f8\u6bd4\u6709\u4e00\u4e2a\u597d\u5904\uff0c\u5c31\u662f\u6570\u636e\u4fee\u6539\u540e\u7684\u6700\u65b0\u503c\u53ef\u4ee5\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u3002 \u5bf9\u4e8e\u91c7\u7528\u5f02\u6b65\u5199\u56de\u7b56\u7565\u7684\u8bfb\u5199\u7f13\u5b58\u6a21\u5f0f\u6765\u8bf4\uff0c\u7f13\u5b58\u7cfb\u7edf\u9700\u8981\u80fd\u5728\u810f\u6570\u636e\u88ab\u6dd8\u6c70\u65f6\uff0c\u81ea\u884c\u628a\u6570\u636e\u5199\u56de\u6570\u636e\u5e93\uff0c\u4f46\u662f\uff0cRedis \u662f\u65e0\u6cd5\u5b9e\u73b0\u8fd9\u4e00\u70b9\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u5e76\u4e0d\u91c7\u7528\u8fd9\u4e2a\u6a21\u5f0f\u3002","title":"\u7b2c\u4e94\u7ae0 Redis \u7f13\u5b58\u603b\u7ed3"},{"location":"chap5/5redis_cache_summary/#redis","text":"","title":"\u7b2c\u4e94\u7ae0 Redis \u7f13\u5b58\u603b\u7ed3"},{"location":"chap5/5redis_cache_summary/#1","text":"","title":"1\u3001\u672c\u7ae0\u5c0f\u7ed3"},{"location":"chap5/5redis_cache_summary/#1-1-redis","text":"\u5206\u5c42\u7cfb\u7edf\u4e2d\uff0c\u6570\u636e\u6682\u5b58\u5728\u5feb\u901f\u5b50\u7cfb\u7edf\u4e2d\u6709\u52a9\u4e8e\u52a0\u901f\u8bbf\u95ee\uff1b\u7f13\u5b58\u5bb9\u91cf\u6709\u9650\uff0c\u7f13\u5b58\u5199\u6ee1\u65f6\uff0c\u6570\u636e\u9700\u8981\u88ab\u6dd8\u6c70 Redis \u5929\u7136\u5c31\u5177\u6709\u9ad8\u6027\u80fd\u8bbf\u95ee\u548c\u6570\u636e\u6dd8\u6c70\u673a\u5236\uff0c\u6b63\u597d\u7b26\u5408\u7f13\u5b58\u7684\u8fd9\u4e24\u4e2a\u7279\u5f81\u7684\u8981\u6c42\uff0c\u6240\u4ee5\u975e\u5e38\u9002\u5408\u7528\u4f5c\u7f13\u5b58\u3002 Redis \u4f5c\u4e3a\u65c1\u8def\u7f13\u5b58\u7684\u7279\u6027\uff0c\u65c1\u8def\u7f13\u5b58\u5c31\u610f\u5473\u7740\u9700\u8981\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u65b0\u589e\u7f13\u5b58\u903b\u8f91\u5904\u7406\u7684\u4ee3\u7801\u3002\u5f53\u7136\uff0c\u5982\u679c\u662f\u65e0\u6cd5\u4fee\u6539\u6e90\u7801\u7684\u5e94\u7528\u573a\u666f\uff0c\u5c31\u4e0d\u80fd\u4f7f\u7528 Redis \u505a\u7f13\u5b58\u4e86\u3002 Redis \u505a\u7f13\u5b58\u65f6\uff0c\u8fd8\u6709\u4e24\u79cd\u6a21\u5f0f\uff0c\u5206\u522b\u662f\u53ea\u8bfb\u7f13\u5b58\u548c\u8bfb\u5199\u7f13\u5b58\u3002 \u8bfb\u5199\u7f13\u5b58\u8fd8\u63d0\u4f9b\u4e86\u540c\u6b65\u76f4\u5199\u548c\u5f02\u6b65\u5199\u56de\u8fd9\u4e24\u79cd\u6a21\u5f0f\uff0c\u540c\u6b65\u76f4\u5199\u6a21\u5f0f\u4fa7\u91cd\u4e8e\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\uff0c\u800c\u5f02\u6b65\u5199\u56de\u6a21\u5f0f\u5219\u4fa7\u91cd\u4e8e\u63d0\u4f9b\u4f4e\u5ef6\u8fdf\u8bbf\u95ee\uff0c \u5982\u679c\u9700\u8981\u5bf9\u5199\u8bf7\u6c42\u8fdb\u884c\u52a0\u901f\uff0c\u6211\u4eec\u9009\u62e9\u8bfb\u5199\u7f13\u5b58\uff1b \u5982\u679c\u5199\u8bf7\u6c42\u5f88\u5c11\uff0c\u6216\u8005\u662f\u53ea\u9700\u8981\u63d0\u5347\u8bfb\u8bf7\u6c42\u7684\u54cd\u5e94\u901f\u5ea6\u7684\u8bdd\uff0c\u6211\u4eec\u9009\u62e9\u53ea\u8bfb\u7f13\u5b58\u3002","title":"1-1 Redis \u65c1\u8def\u7f13\u5b58"},{"location":"chap5/5redis_cache_summary/#1-2","text":"\u7f13\u5b58\u66ff\u6362\u65f6\u7684\u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff0c\u4ee5\u53ca\u88ab\u6dd8\u6c70\u6570\u636e\u7684\u5904\u7406\u65b9\u6cd5\u3002 Redis 4.0 \u7248\u672c\u4ee5\u540e\u4e00\u5171\u63d0\u4f9b\u4e86 8 \u79cd\u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff0c\u4ece\u6dd8\u6c70\u6570\u636e\u7684\u5019\u9009\u96c6\u8303\u56f4\u6765\u770b\uff0c\u6211\u4eec\u6709\u4e24\u79cd\u5019\u9009\u8303\u56f4\uff1a \u4e00\u79cd\u662f\u6240\u6709\u6570\u636e\u90fd\u662f\u5019\u9009\u96c6\uff0c\u4e00\u79cd\u662f\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u662f\u5019\u9009\u96c6\u3002 \u53e6\u5916\uff0c\u65e0\u8bba\u662f\u9762\u5411\u54ea\u79cd\u5019\u9009\u6570\u636e\u96c6\u8fdb\u884c\u6dd8\u6c70\u6570\u636e\u9009\u62e9\uff0c\u6211\u4eec\u90fd\u6709\u4e09\u79cd\u7b56\u7565\uff0c \u5206\u522b\u662f\u968f\u673a\u9009\u62e9\uff0c\u6839\u636e LRU \u7b97\u6cd5\u9009\u62e9\uff0c\u4ee5\u53ca\u6839\u636e LFU \u7b97\u6cd5\u9009\u62e9 \u3002 \u5f53\u7136\uff0c\u5f53\u9762\u5411\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u9009\u62e9\u6dd8\u6c70\u6570\u636e\u65f6\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u6839\u636e\u6570\u636e\u79bb\u8fc7\u671f\u65f6\u95f4\u7684\u8fdc\u8fd1\u6765\u51b3\u5b9a\u3002 \u4e00\u822c\u6765\u8bf4\uff0c\u7f13\u5b58\u7cfb\u7edf\u5bf9\u4e8e\u9009\u5b9a\u7684\u88ab\u6dd8\u6c70\u6570\u636e\uff0c \u4f1a\u6839\u636e\u5176\u662f\u5e72\u51c0\u6570\u636e\u8fd8\u662f\u810f\u6570\u636e\uff0c\u9009\u62e9\u76f4\u63a5\u5220\u9664\u8fd8\u662f\u5199\u56de\u6570\u636e\u5e93 \u3002 \u4f46\u662f\uff0c\u5728 Redis \u4e2d\uff0c\u88ab\u6dd8\u6c70\u6570\u636e\u65e0\u8bba\u5e72\u51c0\u4e0e\u5426\u90fd\u4f1a\u88ab\u5220\u9664\uff0c\u6240\u4ee5\uff0c\u8fd9\u662f\u6211\u4eec\u5728\u4f7f\u7528 Redis \u7f13\u5b58\u65f6\u8981\u7279\u522b\u6ce8\u610f\u7684\uff1a\u5f53\u6570\u636e\u4fee\u6539\u6210\u4e3a\u810f\u6570\u636e\u65f6\uff0c\u9700\u8981\u5728\u6570\u636e\u5e93\u4e2d\u4e5f\u628a\u6570\u636e\u4fee\u6539\u8fc7\u6765\u3002 \u5148\u6839\u636e\u662f\u5426\u6709\u59cb\u7ec8\u4f1a\u88ab\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\uff08\u4f8b\u5982\u7f6e\u9876\u6d88\u606f\uff09\uff0c\u6765\u9009\u62e9\u6dd8\u6c70\u6570\u636e\u7684\u5019\u9009\u96c6\uff0c\u4e5f\u5c31\u662f\u51b3\u5b9a\u662f\u9488\u5bf9\u6240\u6709\u6570\u636e\u8fdb\u884c\u6dd8\u6c70\uff0c\u8fd8\u662f\u9488\u5bf9\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u8fdb\u884c\u6dd8\u6c70\u3002 \u5019\u9009\u6570\u636e\u96c6\u8303\u56f4\u9009\u5b9a\u540e\uff0c\u5efa\u8bae\u4f18\u5148\u4f7f\u7528 LRU \u7b97\u6cd5\uff0c\u4e5f\u5c31\u662f\uff0callkeys-lru \u6216 volatile-lru \u7b56\u7565\u3002 \u5408\u5b9e\u9645\u5e94\u7528\u7684\u6570\u636e\u603b\u91cf\u3001\u70ed\u6570\u636e\u7684\u4f53\u91cf\uff0c\u4ee5\u53ca\u6210\u672c\u9884\u7b97\uff0c\u628a\u7f13\u5b58\u7a7a\u95f4\u5927\u5c0f\u8bbe\u7f6e\u5728\u603b\u6570\u636e\u91cf\u7684 15% \u5230 30% \u8fd9\u4e2a\u533a\u95f4\u5c31\u53ef\u4ee5\u3002","title":"1-2 \u7f13\u5b58\u6ee1\u540e\u7684\u66ff\u6362\u7b56\u7565"},{"location":"chap5/5redis_cache_summary/#1-3","text":"\u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u6700\u5e38\u9047\u89c1\u7684\u4e00\u4e2a\u95ee\u9898\uff0c\u4e5f\u5c31\u662f\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e0d\u4e00\u81f4\u7684\u95ee\u9898 \u5bf9\u4e8e\u8bfb\u5199\u7f13\u5b58\u6765\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u91c7\u7528\u540c\u6b65\u5199\u56de\u7b56\u7565\uff0c\u90a3\u4e48\u53ef\u4ee5\u4fdd\u8bc1\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u4e00\u81f4\u3002 \u5728\u5927\u591a\u6570\u4e1a\u52a1\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u4f1a\u628a Redis \u4f5c\u4e3a\u53ea\u8bfb\u7f13\u5b58\u4f7f\u7528 \u9488\u5bf9\u53ea\u8bfb\u7f13\u5b58\u6765\u8bf4\uff0c\u6211\u4eec\u65e2\u53ef\u4ee5\u5148\u5220\u9664\u7f13\u5b58\u503c\u518d\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u4e5f\u53ef\u4ee5\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u9664\u7f13\u5b58\u3002\u6211\u7684\u5efa\u8bae\u662f\uff0c \u4f18\u5148\u4f7f\u7528\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u9664\u7f13\u5b58\u7684\u65b9\u6cd5 \uff0c\u539f\u56e0\u4e3b\u8981\u6709\u4e24\u4e2a\uff1a \u5148\u5220\u9664\u7f13\u5b58\u503c\u518d\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u6709\u53ef\u80fd\u5bfc\u81f4\u8bf7\u6c42\u56e0\u7f13\u5b58\u7f3a\u5931\u800c\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u538b\u529b\uff1b \u5982\u679c\u4e1a\u52a1\u5e94\u7528\u4e2d\u8bfb\u53d6\u6570\u636e\u5e93\u548c\u5199\u7f13\u5b58\u7684\u65f6\u95f4\u4e0d\u597d\u4f30\u7b97\uff0c\u90a3\u4e48\uff0c\u5ef6\u8fdf\u53cc\u5220\u4e2d\u7684\u7b49\u5f85\u65f6\u95f4\u5c31\u4e0d\u597d\u8bbe\u7f6e\u3002 \u4e0d\u8fc7\uff0c\u5f53\u4f7f\u7528\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u9664\u7f13\u5b58\u65f6\uff0c\u4e5f\u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\uff0c \u5982\u679c\u4e1a\u52a1\u5c42\u8981\u6c42\u5fc5\u987b\u8bfb\u53d6\u4e00\u81f4\u7684\u6570\u636e\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5728\u66f4\u65b0\u6570\u636e\u5e93\u65f6\uff0c\u5148\u5728 Redis \u7f13\u5b58\u5ba2\u6237\u7aef\u6682\u5b58\u5e76\u53d1\u8bfb\u8bf7\u6c42\uff0c\u7b49\u6570\u636e\u5e93\u66f4\u65b0\u5b8c\u3001\u7f13\u5b58\u503c\u5220\u9664\u540e\uff0c\u518d\u8bfb\u53d6\u6570\u636e\uff0c\u4ece\u800c\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027 \u3002 \u7f13\u5b58\u96ea\u5d29\u548c\u51fb\u7a7f\u4e3b\u8981\u662f\u56e0\u4e3a\u6570\u636e\u4e0d\u5728\u7f13\u5b58\u4e2d\u4e86\uff0c\u800c\u7f13\u5b58\u7a7f\u900f\u5219\u662f\u56e0\u4e3a\u6570\u636e\u65e2\u4e0d\u5728\u7f13\u5b58\u4e2d\uff0c\u4e5f\u4e0d\u5728\u6570\u636e\u5e93\u4e2d\u3002 \u6240\u4ee5\uff0c\u7f13\u5b58\u96ea\u5d29\u6216\u51fb\u7a7f\u65f6\uff0c \u4e00\u65e6\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u88ab\u518d\u6b21\u5199\u5165\u5230\u7f13\u5b58\u540e\uff0c\u5e94\u7528\u53c8\u53ef\u4ee5\u5728\u7f13\u5b58\u4e2d\u5feb\u901f\u8bbf\u95ee\u6570\u636e\u4e86 \uff0c\u6570\u636e\u5e93\u7684\u538b\u529b\u4e5f\u4f1a\u76f8\u5e94\u5730\u964d\u4f4e\u4e0b\u6765 \u800c\u7f13\u5b58\u7a7f\u900f\u53d1\u751f\u65f6 \uff0cRedis \u7f13\u5b58\u548c\u6570\u636e\u5e93\u4f1a\u540c\u65f6\u6301\u7eed\u627f\u53d7\u8bf7\u6c42\u538b\u529b\u3002 \u670d\u52a1\u7194\u65ad\u3001\u670d\u52a1\u964d\u7ea7\u3001\u8bf7\u6c42\u9650\u6d41\u8fd9\u4e9b\u65b9\u6cd5\u90fd\u662f\u5c5e\u4e8e\u201c\u6709\u635f\u201d\u65b9\u6848\uff0c\u5728\u4fdd\u8bc1\u6570\u636e\u5e93\u548c\u6574\u4f53\u7cfb\u7edf\u7a33\u5b9a\u7684\u540c\u65f6\uff0c\u4f1a\u5bf9\u4e1a\u52a1\u5e94\u7528\u5e26\u6765\u8d1f\u9762\u5f71\u54cd\u3002 \u4f8b\u5982\u4f7f\u7528\u670d\u52a1\u964d\u7ea7\u65f6\uff0c\u6709\u90e8\u5206\u6570\u636e\u7684\u8bf7\u6c42\u5c31\u53ea\u80fd\u5f97\u5230\u9519\u8bef\u8fd4\u56de\u4fe1\u606f\uff0c\u65e0\u6cd5\u6b63\u5e38\u5904\u7406\u3002\u5982\u679c\u4f7f\u7528\u4e86\u670d\u52a1\u7194\u65ad\uff0c\u90a3\u4e48\uff0c\u6574\u4e2a\u7f13\u5b58\u7cfb\u7edf\u7684\u670d\u52a1\u90fd\u88ab\u6682\u505c\u4e86\uff0c\u5f71\u54cd\u7684\u4e1a\u52a1\u8303\u56f4\u66f4\u5927\u3002\u800c\u4f7f\u7528\u4e86\u8bf7\u6c42\u9650\u6d41\u673a\u5236\u540e\uff0c\u6574\u4e2a\u4e1a\u52a1\u7cfb\u7edf\u7684\u541e\u5410\u7387\u4f1a\u964d\u4f4e\uff0c\u80fd\u5e76\u53d1\u5904\u7406\u7684\u7528\u6237\u8bf7\u6c42\u4f1a\u51cf\u5c11\uff0c\u4f1a\u5f71\u54cd\u5230\u7528\u6237\u4f53\u9a8c \u5c3d\u91cf\u4f7f\u7528\u9884\u9632\u5f0f\u65b9\u6848\uff1a \u9488\u5bf9\u7f13\u5b58\u96ea\u5d29\uff0c\u5408\u7406\u5730\u8bbe\u7f6e\u6570\u636e\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u53ca\u642d\u5efa\u9ad8\u53ef\u9760\u7f13\u5b58\u96c6\u7fa4 \uff1b \u9488\u5bf9\u7f13\u5b58\u51fb\u7a7f\uff0c\u5728\u7f13\u5b58\u8bbf\u95ee\u975e\u5e38\u9891\u7e41\u7684\u70ed\u70b9\u6570\u636e\u65f6\uff0c\u4e0d\u8981\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff1b \u9488\u5bf9\u7f13\u5b58\u7a7f\u900f\uff0c\u63d0\u524d\u5728\u5165\u53e3\u524d\u7aef\u5b9e\u73b0\u6076\u610f\u8bf7\u6c42\u68c0\u6d4b\uff0c\u6216\u8005\u89c4\u8303\u6570\u636e\u5e93\u7684\u6570\u636e\u5220\u9664\u64cd\u4f5c\uff0c\u907f\u514d\u8bef\u5220\u9664\u3002","title":"1-3 \u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u7f13\u5b58\u5f02\u5e38"},{"location":"chap5/5redis_cache_summary/#1-4","text":"\u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u6c61\u67d3 \u7f13\u5b58\u6c61\u67d3\u95ee\u9898\u6307\u7684\u662f\u7559\u5b58\u5728\u7f13\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u5b9e\u9645\u4e0d\u4f1a\u88ab\u518d\u6b21\u8bbf\u95ee\u4e86\uff0c\u4f46\u662f\u53c8\u5360\u636e\u4e86\u7f13\u5b58\u7a7a\u95f4\u3002\u5982\u679c\u8fd9\u6837\u7684\u6570\u636e\u4f53\u91cf\u5f88\u5927\uff0c\u751a\u81f3\u5360\u6ee1\u4e86\u7f13\u5b58\uff0c\u6bcf\u6b21\u6709\u65b0\u6570\u636e\u5199\u5165\u7f13\u5b58\u65f6\uff0c\u8fd8\u9700\u8981\u628a\u8fd9\u4e9b\u6570\u636e\u9010\u6b65\u6dd8\u6c70\u51fa\u7f13\u5b58\uff0c\u5c31\u4f1a\u589e\u52a0\u7f13\u5b58\u64cd\u4f5c\u7684\u65f6\u95f4\u5f00\u9500\u3002 \u8981\u89e3\u51b3\u7f13\u5b58\u6c61\u67d3\u95ee\u9898\uff0c\u6700\u5173\u952e\u7684\u6280\u672f\u70b9\u5c31\u662f\u80fd\u8bc6\u522b\u51fa\u8fd9\u4e9b\u53ea\u8bbf\u95ee\u4e00\u6b21\u6216\u662f\u8bbf\u95ee\u6b21\u6570\u5f88\u5c11\u7684\u6570\u636e\uff0c\u5728\u6dd8\u6c70\u6570\u636e\u65f6\uff0c\u4f18\u5148\u628a\u5b83\u4eec\u7b5b\u9009\u51fa\u6765\u5e76\u6dd8\u6c70\u6389\u3002 volatile-random \u548c allkeys-random \u662f\u968f\u673a\u9009\u62e9\u6570\u636e\u8fdb\u884c\u6dd8\u6c70\uff0c\u65e0\u6cd5\u628a\u4e0d\u518d\u8bbf\u95ee\u7684\u6570\u636e\u7b5b\u9009\u51fa\u6765\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u7f13\u5b58\u6c61\u67d3\u3002 \u5982\u679c\u4e1a\u52a1\u5c42\u660e\u786e\u77e5\u9053\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u957f\uff0c\u53ef\u4ee5\u7ed9\u6570\u636e\u8bbe\u7f6e\u5408\u7406\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u518d\u8bbe\u7f6e Redis \u7f13\u5b58\u4f7f\u7528 volatile-ttl \u7b56\u7565\u3002\u5f53\u7f13\u5b58\u5199\u6ee1\u65f6\uff0c\u5269\u4f59\u5b58\u6d3b\u65f6\u95f4\u6700\u77ed\u7684\u6570\u636e\u5c31\u4f1a\u88ab\u6dd8\u6c70\u51fa\u7f13\u5b58\uff0c\u907f\u514d\u6ede\u7559\u5728\u7f13\u5b58\u4e2d\uff0c\u9020\u6210\u6c61\u67d3\u3002 \u5f53\u6211\u4eec\u4f7f\u7528 LRU \u7b56\u7565\u65f6\uff0c\u7531\u4e8e LRU \u7b56\u7565\u53ea\u8003\u8651\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u6548\uff0c\u5bf9\u4e8e\u53ea\u8bbf\u95ee\u4e00\u6b21\u7684\u6570\u636e\u6765\u8bf4\uff0cLRU \u7b56\u7565\u65e0\u6cd5\u5f88\u5feb\u5c06\u5176\u7b5b\u9009\u51fa\u6765\u3002 \u800c LFU \u7b56\u7565\u5728 LRU \u7b56\u7565\u57fa\u7840\u4e0a\u8fdb\u884c\u4e86\u4f18\u5316\uff0c\u5728\u7b5b\u9009\u6570\u636e\u65f6\uff0c\u9996\u5148\u4f1a\u7b5b\u9009\u5e76\u6dd8\u6c70\u8bbf\u95ee\u6b21\u6570\u5c11\u7684\u6570\u636e\uff0c\u7136\u540e\u9488\u5bf9\u8bbf\u95ee\u6b21\u6570\u76f8\u540c\u7684\u6570\u636e\uff0c\u518d\u7b5b\u9009\u5e76\u6dd8\u6c70\u8bbf\u95ee\u65f6\u95f4\u6700\u4e45\u8fdc\u7684\u6570\u636e\u3002 \u5728\u5177\u4f53\u5b9e\u73b0\u4e0a\uff0c\u76f8\u5bf9\u4e8e LRU \u7b56\u7565\uff0cRedis \u53ea\u662f\u628a\u539f\u6765 24bit \u5927\u5c0f\u7684 lru \u5b57\u6bb5\uff0c\u53c8\u8fdb\u4e00\u6b65\u62c6\u5206\u6210\u4e86 16bit \u7684 ldt \u548c 8bit \u7684 counter\uff0c\u5206\u522b\u7528\u6765\u8868\u793a\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u95f4\u6233\u548c\u8bbf\u95ee\u6b21\u6570\u3002 \u4e3a\u4e86\u907f\u5f00 8bit \u6700\u5927\u53ea\u80fd\u8bb0\u5f55 255 \u7684\u9650\u5236\uff0cLFU \u7b56\u7565\u8bbe\u8ba1\u4f7f\u7528\u975e\u7ebf\u6027\u589e\u957f\u7684\u8ba1\u6570\u5668\u6765\u8868\u793a\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u3002 \u5728\u5b9e\u9645\u4e1a\u52a1\u5e94\u7528\u4e2d\uff0cLRU \u548c LFU \u4e24\u4e2a\u7b56\u7565\u90fd\u6709\u5e94\u7528\u3002LRU \u548c LFU \u4e24\u4e2a\u7b56\u7565\u5173\u6ce8\u7684\u6570\u636e\u8bbf\u95ee\u7279\u5f81\u5404\u6709\u4fa7\u91cd\uff0cLRU \u7b56\u7565\u66f4\u52a0\u5173\u6ce8\u6570\u636e\u7684\u65f6\u6548\u6027\uff0c\u800c LFU \u7b56\u7565\u66f4\u52a0\u5173\u6ce8\u6570\u636e\u7684\u8bbf\u95ee\u9891\u6b21 \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5b9e\u9645\u5e94\u7528\u7684\u8d1f\u8f7d\u5177\u6709\u8f83\u597d\u7684\u65f6\u95f4\u5c40\u90e8\u6027\uff0c\u6240\u4ee5 LRU \u7b56\u7565\u7684\u5e94\u7528\u4f1a\u66f4\u52a0\u5e7f\u6cdb\u3002\u4f46\u662f\uff0c\u5728\u626b\u63cf\u5f0f\u67e5\u8be2\u7684\u5e94\u7528\u573a\u666f\u4e2d\uff0cLFU \u7b56\u7565\u5c31\u53ef\u4ee5\u5f88\u597d\u5730\u5e94\u5bf9\u7f13\u5b58\u6c61\u67d3\u95ee\u9898\u4e86\uff0c\u5efa\u8bae\u4f60\u4f18\u5148\u4f7f\u7528\u3002 \u5916\uff0c\u5982\u679c\u4e1a\u52a1\u5e94\u7528\u4e2d\u6709\u77ed\u65f6\u9ad8\u9891\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u9664\u4e86 LFU \u7b56\u7565\u672c\u8eab\u4f1a\u5bf9\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u8fdb\u884c\u81ea\u52a8\u8870\u51cf\u4ee5\u5916\uff0c\u6211\u518d\u7ed9\u4f60\u4e2a\u5c0f\u5efa\u8bae\uff1a\u4f60\u53ef\u4ee5\u4f18\u5148\u4f7f\u7528 volatile-lfu \u7b56\u7565\uff0c\u5e76\u6839\u636e\u8fd9\u4e9b\u6570\u636e\u7684\u8bbf\u95ee\u65f6\u9650\u8bbe\u7f6e\u5b83\u4eec\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u514d\u5b83\u4eec\u7559\u5b58\u5728\u7f13\u5b58\u4e2d\u9020\u6210\u6c61\u67d3","title":"1-4 \u7f13\u5b58\u88ab\u6c61\u67d3\u7684\u89e3\u51b3\u95ee\u9898"},{"location":"chap5/5redis_cache_summary/#2","text":"\u5c55\u793a\u4e00\u6bb5 Web \u5e94\u7528\u4e2d\u4f7f\u7528 Redis \u7f13\u5b58\u7684\u4f2a\u4ee3\u7801\u793a\u4f8b\u3002 String cacheKey = \u201cproductid_11010003\u201d; String cacheValue = redisCache.get(cacheKey)\uff1b //\u7f13\u5b58\u547d\u4e2d if ( cacheValue != NULL) return cacheValue; //\u7f13\u5b58\u7f3a\u5931 else cacheValue = getProductFromDB(); redisCache.put(cacheValue) //\u7f13\u5b58\u66f4\u65b0 \u5bf9\u4e8e Redis \u6765\u8bf4\uff0c\u4e00\u65e6\u786e\u5b9a\u4e86\u7f13\u5b58\u6700\u5927\u5bb9\u91cf\uff0c\u6bd4\u5982 4GB\uff0c\u4f60\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u4e2a\u547d\u4ee4\u6765\u8bbe\u5b9a\u7f13\u5b58\u7684\u5927\u5c0f\u4e86\uff1a CONFIG SET maxmemory 4gb \u8fd9\u6837\u4e00\u6765\uff0c\u5176\u5b83\u7ebf\u7a0b\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u4f1a\u53d1\u73b0\u7f13\u5b58\u7f3a\u5931\uff0c\u6240\u4ee5\u4f1a\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6700\u65b0\u503c\u3002\u56e0\u4e3a\u8fd9\u4e2a\u65b9\u6848\u4f1a\u5728\u7b2c\u4e00\u6b21\u5220\u9664\u7f13\u5b58\u503c\u540e\uff0c\u5ef6\u8fdf\u4e00\u6bb5\u65f6\u95f4\u518d\u6b21\u8fdb\u884c\u5220\u9664\uff0c\u6240\u4ee5\u6211\u4eec\u4e5f\u628a\u5b83\u53eb\u505a\u201c\u5ef6\u8fdf\u53cc\u5220\u201d\u3002 redis.delKey(X) db.update(X) Thread.sleep(N) redis.delKey(X)","title":"2\u3001\u672c\u7ae0\u64cd\u4f5c\u603b\u7ed3"},{"location":"chap5/5redis_cache_summary/#3","text":"\u95ee\u9898 \uff1aRedis \u7684\u53ea\u8bfb\u7f13\u5b58\u548c\u4f7f\u7528\u76f4\u5199\u7b56\u7565\u7684\u8bfb\u5199\u7f13\u5b58\uff0c\u90fd\u4f1a\u628a\u6570\u636e\u540c\u6b65\u5199\u5230\u540e\u7aef\u6570\u636e\u5e93\u4e2d\uff0c\u4f60\u89c9\u5f97\u5b83\u4eec\u6709\u4ec0\u4e48\u533a\u522b\u5417\uff1f \u7b54\u6848\uff1a\u4e3b\u8981\u7684\u533a\u522b\u5728\u4e8e\uff0c\u5f53\u6709\u7f13\u5b58\u6570\u636e\u88ab\u4fee\u6539\u65f6\uff0c \u5728\u53ea\u8bfb\u7f13\u5b58\u4e2d\uff0c\u4e1a\u52a1\u5e94\u7528\u4f1a\u76f4\u63a5\u4fee\u6539\u6570\u636e\u5e93\uff0c\u5e76\u628a\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u6807\u8bb0\u4e3a\u65e0\u6548\uff1b\u800c\u5728\u8bfb\u5199\u7f13\u5b58\u4e2d\uff0c\u4e1a\u52a1\u5e94\u7528\u9700\u8981\u540c\u65f6\u4fee\u6539\u7f13\u5b58\u548c\u6570\u636e\u5e93 \u3002 \u95ee\u9898 \uff1aRedis \u7f13\u5b58\u5728\u5904\u7406\u810f\u6570\u636e\u65f6\uff0c\u4e0d\u4ec5\u4f1a\u4fee\u6539\u6570\u636e\uff0c\u8fd8\u4f1a\u628a\u5b83\u5199\u56de\u6570\u636e\u5e93\u3002\u6211\u4eec\u5728\u524d\u9762\u5b66\u8fc7 Redis \u7684\u53ea\u8bfb\u7f13\u5b58\u6a21\u5f0f\u548c\u4e24\u79cd\u8bfb\u5199\u7f13\u5b58\u6a21\u5f0f\uff08\u5e26\u540c\u6b65\u76f4\u5199\u7684\u8bfb\u5199\u6a21\u5f0f\uff0c\u5e26\u5f02\u6b65\u5199\u56de\u7684\u8bfb\u5199\u6a21\u5f0f\uff09\uff09\uff0c\u8bf7\u4f60\u601d\u8003\u4e0b\uff0cRedis \u7f13\u5b58\u5bf9\u5e94\u54ea\u4e00\u79cd\u6216\u54ea\u51e0\u79cd\u6a21\u5f0f\uff1f \u7b54\u6848\uff1a\u5982\u679c\u6211\u4eec\u5728\u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u9700\u8981\u628a\u810f\u6570\u636e\u5199\u56de\u6570\u636e\u5e93\uff0c \u8fd9\u5c31\u610f\u5473\u7740\uff0cRedis \u4e2d\u7f13\u5b58\u7684\u6570\u636e\u53ef\u4ee5\u76f4\u63a5\u88ab\u4fee\u6539\uff0c\u8fd9\u5c31\u5bf9\u5e94\u4e86\u8bfb\u5199\u7f13\u5b58\u6a21\u5f0f \u3002\u66f4\u8fdb\u4e00\u6b65\u5206\u6790\u7684\u8bdd\uff0c \u810f\u6570\u636e\u662f\u5728\u88ab\u66ff\u6362\u51fa\u7f13\u5b58\u65f6\u5199\u56de\u540e\u7aef\u6570\u636e\u5e93\u7684\uff0c\u8fd9\u5c31\u5bf9\u5e94\u4e86\u5e26\u6709\u5f02\u6b65\u5199\u56de\u7b56\u7565\u7684\u8bfb\u5199\u7f13\u5b58\u6a21\u5f0f \u3002 \u95ee\u9898 \uff1a\u5728\u53ea\u8bfb\u7f13\u5b58\u4e2d\u5bf9\u6570\u636e\u8fdb\u884c\u5220\u6539\u65f6\uff0c\u9700\u8981\u5728\u7f13\u5b58\u4e2d\u5220\u9664\u76f8\u5e94\u7684\u7f13\u5b58\u503c\u3002\u5982\u679c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e0d\u662f\u5220\u9664\u7f13\u5b58\u503c\uff0c\u800c\u662f\u76f4\u63a5\u66f4\u65b0\u7f13\u5b58\u7684\u503c\uff0c\u4f60\u89c9\u5f97\uff0c\u548c\u5220\u9664\u7f13\u5b58\u503c\u76f8\u6bd4\uff0c\u76f4\u63a5\u66f4\u65b0\u7f13\u5b58\u503c\u6709\u4ec0\u4e48\u597d\u5904\u548c\u4e0d\u8db3\u5417\uff1f \u7b54\u6848\uff1a\u5982\u679c\u6211\u4eec\u76f4\u63a5\u5728\u7f13\u5b58\u4e2d\u66f4\u65b0\u7f13\u5b58\u503c\uff0c\u7b49\u5230\u4e0b\u6b21\u6570\u636e\u518d\u88ab\u8bbf\u95ee\u65f6\uff0c\u4e1a\u52a1\u5e94\u7528\u53ef\u4ee5\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u8fd9\u662f\u5b83\u7684\u4e00\u5927\u597d\u5904\u3002 \u4e0d\u8db3\u4e4b\u5904\u5728\u4e8e\uff0c\u5f53\u6709\u6570\u636e\u66f4\u65b0\u64cd\u4f5c\u65f6\uff0c\u6211\u4eec\u8981\u4fdd\u8bc1\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\uff0c \u8fd9\u5c31\u53ef\u4ee5\u91c7\u7528\u91cd\u8bd5\u6216\u5ef6\u65f6\u53cc\u5220\u65b9\u6cd5 \u3002\u4e0d\u8fc7\uff0c\u8fd9\u6837\u5c31\u9700\u8981\u5728\u4e1a\u52a1\u5e94\u7528\u4e2d\u589e\u52a0\u989d\u5916\u4ee3\u7801\uff0c\u6709\u4e00\u5b9a\u7684\u5f00\u9500\u3002 \u95ee\u9898 \uff1a\u5728\u8bb2\u5230\u7f13\u5b58\u96ea\u5d29\u65f6\uff0c\u6211\u63d0\u5230\uff0c\u53ef\u4ee5\u91c7\u7528\u670d\u52a1\u7194\u65ad\u3001\u670d\u52a1\u964d\u7ea7\u3001\u8bf7\u6c42\u9650\u6d41\u4e09\u79cd\u65b9\u6cd5\u6765\u5e94\u5bf9\u3002\u8bf7\u4f60\u601d\u8003\u4e0b\uff0c\u8fd9\u4e09\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u7528\u6765\u5e94\u5bf9\u7f13\u5b58\u7a7f\u900f\u95ee\u9898\u5417\uff1f \u7f13\u5b58\u7a7f\u900f\u8fd9\u4e2a\u95ee\u9898\u7684\u672c\u8d28\u662f\u67e5\u8be2\u4e86 Redis \u548c\u6570\u636e\u5e93\u4e2d\u6ca1\u6709\u7684\u6570\u636e\uff0c \u670d\u52a1\u7194\u65ad\u3001\u670d\u52a1\u964d\u7ea7\u548c\u8bf7\u6c42\u9650\u6d41\u7684\u65b9\u6cd5\uff0c\u672c\u8d28\u4e0a\u662f\u4e3a\u4e86\u89e3\u51b3 Redis \u5b9e\u4f8b\u6ca1\u6709\u8d77\u5230\u7f13\u5b58\u5c42\u4f5c\u7528\u7684\u95ee\u9898\uff0c\u7f13\u5b58\u96ea\u5d29\u548c\u7f13\u5b58\u51fb\u7a7f\u90fd\u5c5e\u4e8e\u8fd9\u7c7b\u95ee\u9898\u3002 \u5728\u7f13\u5b58\u7a7f\u900f\u7684\u573a\u666f\u4e0b\uff0c\u4e1a\u52a1\u5e94\u7528\u662f\u8981\u4ece Redis \u548c\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u6b64\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u4eba\u5de5\u4ecb\u5165\uff0cRedis \u662f\u65e0\u6cd5\u53d1\u6325\u7f13\u5b58\u4f5c\u7528\u7684\u3002 \u4e00\u4e2a\u53ef\u884c\u7684\u529e\u6cd5\u5c31\u662f \u4e8b\u524d\u62e6\u622a \uff0c\u4e0d\u8ba9\u8fd9\u79cd\u67e5\u8be2 Redis \u548c\u6570\u636e\u5e93\u4e2d\u90fd\u6ca1\u6709\u7684\u6570\u636e\u7684\u8bf7\u6c42\u53d1\u9001\u5230\u6570\u636e\u5e93\u5c42\u3002 \u5728\u7f13\u5b58\u7a7f\u900f\u7684\u573a\u666f\u4e0b\uff0c\u4e1a\u52a1\u5e94\u7528\u662f\u8981\u4ece Redis \u548c\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u6b64\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u4eba\u5de5\u4ecb\u5165\uff0cRedis \u662f\u65e0\u6cd5\u53d1\u6325\u7f13\u5b58\u4f5c\u7528\u7684\u3002\u4e00\u4e2a\u53ef\u884c\u7684\u529e\u6cd5\u5c31\u662f\u4e8b\u524d\u62e6\u622a\uff0c\u4e0d\u8ba9\u8fd9\u79cd\u67e5\u8be2 Redis \u548c\u6570\u636e\u5e93\u4e2d\u90fd\u6ca1\u6709\u7684\u6570\u636e\u7684\u8bf7\u6c42\u53d1\u9001\u5230\u6570\u636e\u5e93\u5c42\u3002 \u53e6\u5916\uff0c\u8fd9\u91cc\uff0c\u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\u4e0b\uff0c\u5bf9\u4e8e\u7f13\u5b58\u96ea\u5d29\u548c\u51fb\u7a7f\u95ee\u9898\u6765\u8bf4\uff0c\u670d\u52a1\u7194\u65ad\u3001\u670d\u52a1\u964d\u7ea7\u548c\u8bf7\u6c42\u9650\u6d41\u8fd9\u4e09\u79cd\u65b9\u6cd5\u5c5e\u4e8e\u6709\u635f\u65b9\u6cd5\uff0c\u4f1a\u964d\u4f4e\u4e1a\u52a1\u541e\u5410\u91cf\u3001\u62d6\u6162\u7cfb\u7edf\u54cd\u5e94\u3001\u964d\u4f4e\u7528\u6237\u4f53\u9a8c\u3002\u4e0d\u8fc7\uff0c\u91c7\u7528\u8fd9\u4e9b\u65b9\u6cd5\u540e\uff0c\u968f\u7740\u6570\u636e\u6162\u6162\u5730\u91cd\u65b0\u586b\u5145\u56de Redis\uff0cRedis \u8fd8\u662f\u53ef\u4ee5\u9010\u6b65\u6062\u590d\u7f13\u5b58\u5c42\u4f5c\u7528\u7684\u3002 \u95ee\u9898 \uff1a\u4f7f\u7528\u4e86 LFU \u7b56\u7565\u540e\uff0c\u7f13\u5b58\u8fd8\u4f1a\u88ab\u6c61\u67d3\u5417\uff1f \u7b54\u6848\uff1a\u5728 Redis \u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u4e86 LFU \u7b56\u7565\u540e\uff0c\u8fd8\u662f\u6709\u53ef\u80fd\u53d1\u751f\u7f13\u5b58\u6c61\u67d3\u7684\u3002 \u5728\u4e00\u4e9b\u6781\u7aef\u60c5\u51b5\u4e0b\uff0cLFU \u7b56\u7565\u4f7f\u7528\u7684\u8ba1\u6570\u5668\u53ef\u80fd\u4f1a\u5728\u77ed\u65f6\u95f4\u5185\u8fbe\u5230\u4e00\u4e2a\u5f88\u5927\u503c\uff0c\u800c\u8ba1\u6570\u5668\u7684\u8870\u51cf\u914d\u7f6e\u9879\u8bbe\u7f6e\u5f97\u8f83\u5927\uff0c\u5bfc\u81f4\u8ba1\u6570\u5668\u503c\u8870\u51cf\u5f88\u6162\uff0c \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6570\u636e\u5c31\u53ef\u80fd\u5728\u7f13\u5b58\u4e2d\u957f\u671f\u9a7b\u7559\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a\u6570\u636e\u5728\u77ed\u65f6\u95f4\u5185\u88ab\u9ad8\u9891\u8bbf\u95ee\uff0c\u5373\u4f7f\u6211\u4eec\u4f7f\u7528\u4e86 LFU \u7b56\u7565\uff0c\u8fd9\u4e2a\u6570\u636e\u4e5f\u6709\u53ef\u80fd\u6ede\u7559\u5728\u7f13\u5b58\u4e2d\uff0c\u9020\u6210\u6c61\u67d3\u3002","title":"3\u3001\u672c\u7ae0\u95ee\u9898"},{"location":"chap5/5redis_cache_summary/#4","text":"4-1 \u5982\u4f55\u7406\u89e3\u628a Redis \u79f0\u4e3a\u65c1\u8def\u7f13\u5b58\uff1f Redis \u79f0\u4e3a\u65c1\u8def\u7f13\u5b58\uff0c\u66f4\u591a\u7684\u662f\u4ece\u201c\u4e1a\u52a1\u5e94\u7528\u7a0b\u5e8f\u5982\u4f55\u4f7f\u7528 Redis \u7f13\u5b58\u201d\u8fd9\u4e2a\u89d2\u5ea6\u6765\u8bf4\u7684\u3002 \u4e1a\u52a1\u5e94\u7528\u5728\u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u9700\u8981\u5728\u4e1a\u52a1\u4ee3\u7801\u4e2d\u663e\u5f0f\u5730\u589e\u52a0\u7f13\u5b58\u7684\u64cd\u4f5c\u903b\u8f91 \u3002 \u4f8b\u5982\uff0c\u4e00\u4e2a\u57fa\u672c\u7684\u7f13\u5b58\u64cd\u4f5c\u5c31\u662f\uff0c\u4e00\u65e6\u53d1\u751f\u7f13\u5b58\u7f3a\u5931\uff0c\u4e1a\u52a1\u5e94\u7528\u9700\u8981\u81ea\u884c\u53bb\u8bfb\u53d6\u6570\u636e\u5e93\uff0c\u800c\u4e0d\u662f\u7f13\u5b58\u81ea\u8eab\u53bb\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\u518d\u8fd4\u56de\u3002\u4e3a\u4e86\u4fbf\u4e8e\u4f60\u7406\u89e3\uff0c\u6211\u4eec\u518d\u6765\u770b\u4e0b\u548c\u65c1\u8def\u7f13\u5b58\u76f8\u5bf9\u5e94\u7684\u3001\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\u7684 CPU \u7f13\u5b58\u548c page cache\u3002\u8fd9\u4e24\u79cd\u7f13\u5b58\u9ed8\u8ba4\u5c31\u5728\u5e94\u7528\u7a0b\u5e8f\u8bbf\u95ee\u5185\u5b58\u548c\u78c1\u76d8\u7684\u8def\u5f84\u4e0a\uff0c\u6211\u4eec\u5199\u7684\u5e94\u7528\u7a0b\u5e8f\u90fd\u80fd\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e24\u79cd\u7f13\u5b58\u3002 \u6211\u4e4b\u6240\u4ee5\u5f3a\u8c03 Redis \u662f\u4e00\u4e2a\u65c1\u8def\u7f13\u5b58\uff0c\u4e5f\u662f\u5e0c\u671b\u4f60\u80fd\u591f\u8bb0\u4f4f\uff0c\u5728\u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u6211\u4eec\u9700\u8981\u4fee\u6539\u4e1a\u52a1\u4ee3\u7801\u3002","title":"4\u3001\u5178\u578b\u95ee\u9898\u7b54\u7591"},{"location":"chap5/5redis_cache_summary/#4-2-redis","text":"\u7f13\u5b58\u6a21\u5f0f\u6709\u4e09\u79cd\uff1a \u53ea\u8bfb\u7f13\u5b58\u6a21\u5f0f\u3001\u91c7\u7528\u540c\u6b65\u76f4\u5199\u7b56\u7565\u7684\u8bfb\u5199\u7f13\u5b58\u6a21\u5f0f\u3001\u91c7\u7528\u5f02\u6b65\u5199\u56de\u7b56\u7565\u7684\u8bfb\u5199\u7f13\u5b58\u6a21\u5f0f\u3002 \u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u4f1a\u628a Redis \u7f13\u5b58\u7528\u4f5c\u53ea\u8bfb\u7f13\u5b58\u3002 \u53ea\u8bfb\u7f13\u5b58\u6d89\u53ca\u7684\u64cd\u4f5c\uff0c\u5305\u62ec\u67e5\u8be2\u7f13\u5b58\u3001\u7f13\u5b58\u7f3a\u5931\u65f6\u8bfb\u6570\u636e\u5e93\u548c\u56de\u586b\uff0c\u6570\u636e\u66f4\u65b0\u65f6\u5220\u9664\u7f13\u5b58\u6570\u636e\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u53ef\u4ee5\u52a0\u5230\u4e1a\u52a1\u5e94\u7528\u4e2d\u3002\u800c\u4e14\uff0c\u5f53\u6570\u636e\u66f4\u65b0\u65f6\uff0c\u7f13\u5b58\u76f4\u63a5\u5220\u9664\u6570\u636e\uff0c\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e00\u81f4\u6027\u8f83\u4e3a\u5bb9\u6613\u4fdd\u8bc1\u3002 \u5f53\u7136\uff0c\u6709\u65f6\u6211\u4eec\u4e5f\u4f1a\u628a Redis \u7528\u4f5c\u8bfb\u5199\u7f13\u5b58\uff0c\u540c\u65f6\u91c7\u7528\u540c\u6b65\u76f4\u5199\u7b56\u7565\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7f13\u5b58\u6d89\u53ca\u7684\u64cd\u4f5c\u4e5f\u90fd\u53ef\u4ee5\u52a0\u5230\u4e1a\u52a1\u5e94\u7528\u4e2d\u3002\u800c\u4e14\uff0c\u548c\u53ea\u8bfb\u7f13\u5b58\u76f8\u6bd4\u6709\u4e00\u4e2a\u597d\u5904\uff0c\u5c31\u662f\u6570\u636e\u4fee\u6539\u540e\u7684\u6700\u65b0\u503c\u53ef\u4ee5\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u3002 \u5bf9\u4e8e\u91c7\u7528\u5f02\u6b65\u5199\u56de\u7b56\u7565\u7684\u8bfb\u5199\u7f13\u5b58\u6a21\u5f0f\u6765\u8bf4\uff0c\u7f13\u5b58\u7cfb\u7edf\u9700\u8981\u80fd\u5728\u810f\u6570\u636e\u88ab\u6dd8\u6c70\u65f6\uff0c\u81ea\u884c\u628a\u6570\u636e\u5199\u56de\u6570\u636e\u5e93\uff0c\u4f46\u662f\uff0cRedis \u662f\u65e0\u6cd5\u5b9e\u73b0\u8fd9\u4e00\u70b9\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u5e76\u4e0d\u91c7\u7528\u8fd9\u4e2a\u6a21\u5f0f\u3002","title":"4-2 \u4f7f\u7528 Redis \u7f13\u5b58\u65f6\uff0c\u5e94\u8be5\u7528\u54ea\u79cd\u6a21\u5f0f\uff1f"},{"location":"chap6/1redis_pika_ssd/","text":"\u7b2c\u4e00\u8282 \u57fa\u4e8eSSD\u5b9e\u73b0\u5927\u5bb9\u91cfRedis:Pika \u5e94\u7528 Redis \u65f6\uff0c\u968f\u7740\u4e1a\u52a1\u6570\u636e\u7684\u589e\u52a0\uff08\u6bd4\u5982\u8bf4\u7535\u5546\u4e1a\u52a1\u4e2d\uff0c\u968f\u7740\u7528\u6237\u89c4\u6a21\u548c\u5546\u54c1\u6570\u91cf\u7684\u589e\u52a0\uff09\uff0c\u5c31\u9700\u8981 Redis \u80fd\u4fdd\u5b58\u66f4\u591a\u7684\u6570\u636e\u3002\u4f60\u53ef\u80fd\u4f1a\u60f3\u5230\u4f7f\u7528 Redis \u5207\u7247\u96c6\u7fa4 \uff0c\u628a\u6570\u636e\u5206\u6563\u4fdd\u5b58\u5230\u591a\u4e2a\u5b9e\u4f8b\u4e0a\u3002\u4f46\u662f\u8fd9\u6837\u505a\u7684\u8bdd\uff0c\u4f1a\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5982\u679c\u8981\u4fdd\u5b58\u7684\u6570\u636e\u603b\u91cf\u5f88\u5927\uff0c \u4f46\u662f\u6bcf\u4e2a\u5b9e\u4f8b\u4fdd\u5b58\u7684\u6570\u636e\u91cf\u8f83\u5c0f\u7684\u8bdd\uff0c\u5c31\u4f1a\u5bfc\u81f4\u96c6\u7fa4\u7684\u5b9e\u4f8b\u89c4\u6a21\u589e\u52a0\uff0c\u8fd9\u4f1a\u8ba9\u96c6\u7fa4\u7684\u8fd0\u7ef4\u7ba1\u7406\u53d8\u5f97\u590d\u6742\uff0c\u589e\u52a0\u5f00\u9500 \u3002 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0 Redis \u5355\u5b9e\u4f8b\u7684\u5185\u5b58\u5bb9\u91cf\uff0c\u5f62\u6210\u5927\u5185\u5b58\u5b9e\u4f8b\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u53ef\u4ee5\u4fdd\u5b58\u66f4\u591a\u7684\u6570\u636e\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5728\u4fdd\u5b58\u76f8\u540c\u7684\u6570\u636e\u603b\u91cf\u65f6\uff0c\u6240\u9700\u8981\u7684\u5927\u5185\u5b58\u5b9e\u4f8b\u7684\u4e2a\u6570\u5c31\u4f1a\u51cf\u5c11\uff0c\u5c31\u53ef\u4ee5\u8282\u7701\u5f00\u9500\u3002 \u8fd9\u662f\u4e00\u4e2a\u597d\u4e3b\u610f\uff0c\u4f46\u8fd9\u4e5f\u5e76\u4e0d\u662f\u5b8c\u7f8e\u7684\u65b9\u6848\uff1a \u57fa\u4e8e\u5927\u5185\u5b58\u7684\u5927\u5bb9\u91cf\u5b9e\u4f8b\u5728\u5b9e\u4f8b\u6062\u590d\u3001\u4e3b\u4ece\u540c\u6b65\u8fc7\u7a0b\u4e2d\u4f1a\u5f15\u8d77\u4e00\u7cfb\u5217\u6f5c\u5728\u95ee\u9898\uff0c\u4f8b\u5982\u6062\u590d\u65f6\u95f4\u589e\u957f\u3001\u4e3b\u4ece\u5207\u6362\u5f00\u9500\u5927\u3001\u7f13\u51b2\u533a\u6613\u6ea2\u51fa\u3002 \u63a8\u8350\u4f60\u4f7f\u7528\u56fa\u6001\u786c\u76d8\uff08Solid State Drive\uff0cSSD\uff09\u3002\u5b83\u7684\u6210\u672c\u5f88\u4f4e\uff08\u6bcf GB \u7684\u6210\u672c\u7ea6\u662f\u5185\u5b58\u7684\u5341\u5206\u4e4b\u4e00\uff09\uff0c\u800c\u4e14\u5bb9\u91cf\u5927\uff0c\u8bfb\u5199\u901f\u5ea6\u5feb\uff0c\u6211\u4eec\u53ef\u4ee5\u57fa\u4e8e SSD \u6765\u5b9e\u73b0\u5927\u5bb9\u91cf\u7684 Redis \u5b9e\u4f8b\u3002360 \u516c\u53f8 DBA \u548c\u57fa\u7840\u67b6\u6784\u7ec4\u8054\u5408\u5f00\u53d1\u7684 Pika\u952e\u503c\u6570\u636e\u5e93 \uff0c\u6b63\u597d\u5b9e\u73b0\u4e86\u8fd9\u4e00\u9700\u6c42\u3002 Pika \u5728\u521a\u5f00\u59cb\u8bbe\u8ba1\u7684\u65f6\u5019\uff0c\u5c31\u6709\u4e24\u4e2a\u76ee\u6807\uff1a \u5355\u5b9e\u4f8b\u53ef\u4ee5\u4fdd\u5b58\u5927\u5bb9\u91cf\u6570\u636e\uff0c\u540c\u65f6\u907f\u514d\u4e86\u5b9e\u4f8b\u6062\u590d\u548c\u4e3b\u4ece\u540c\u6b65\u65f6\u7684\u6f5c\u5728\u95ee\u9898\uff1b \u548c Redis \u6570\u636e\u7c7b\u578b\u4fdd\u6301\u517c\u5bb9\uff0c\u53ef\u4ee5\u652f\u6301\u4f7f\u7528 Redis \u7684\u5e94\u7528\u5e73\u6ed1\u5730\u8fc1\u79fb\u5230 Pika \u4e0a \u3002\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u4e00\u76f4\u5728\u4f7f\u7528 Redis\uff0c\u5e76\u4e14\u60f3\u4f7f\u7528 SSD \u6765\u6269\u5c55\u5355\u5b9e\u4f8b\u5bb9\u91cf\uff0cPika \u5c31\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\u3002 1\u3001\u5927\u5185\u5b58 Redis \u5b9e\u4f8b\u7684\u6f5c\u5728\u95ee\u9898 Redis \u4f7f\u7528\u5185\u5b58\u4fdd\u5b58\u6570\u636e\uff0c\u5185\u5b58\u5bb9\u91cf\u589e\u52a0\u540e\uff0c\u5c31\u4f1a\u5e26\u6765\u4e24\u65b9\u9762\u7684\u6f5c\u5728\u95ee\u9898\uff0c\u5206\u522b\u662f\uff0c \u5185\u5b58\u5feb\u7167 RDB \u751f\u6210\u548c\u6062\u590d\u6548\u7387\u4f4e\uff0c\u4ee5\u53ca\u4e3b\u4ece\u8282\u70b9\u5168\u91cf\u540c\u6b65\u65f6\u957f\u589e\u52a0\u3001\u7f13\u51b2\u533a\u6613\u6ea2\u51fa \u3002 \u5185\u5b58\u5927\u5c0f\u548c\u5185\u5b58\u5feb\u7167 RDB \u7684\u5173\u7cfb\u662f\u975e\u5e38\u76f4\u63a5\u7684\uff1a \u5b9e\u4f8b\u5185\u5b58\u5bb9\u91cf\u5927\uff0c RDB \u6587\u4ef6\u4e5f\u4f1a\u76f8\u5e94\u589e\u5927\uff0c\u90a3\u4e48\uff0cRDB \u6587\u4ef6\u751f\u6210\u65f6\u7684 fork \u65f6\u957f\u5c31\u4f1a\u589e\u52a0 \uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4 Redis \u5b9e\u4f8b\u963b\u585e\u3002 RDB \u6587\u4ef6\u589e\u5927\u540e\uff0c\u4f7f\u7528 RDB \u8fdb\u884c\u6062\u590d\u7684\u65f6\u957f\u4e5f\u4f1a\u589e\u52a0\uff0c\u4f1a\u5bfc\u81f4 Redis \u8f83\u957f\u65f6\u95f4\u65e0\u6cd5\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1 \u3002 \u4e3b\u4ece\u540c\u6b65\u53d7\u5230\u7684\u5f71\u54cd \u4e3b\u4ece\u8282\u70b9\u95f4\u7684\u540c\u6b65\u7684\u7b2c\u4e00\u6b65\u5c31\u662f\u8981\u505a\u5168\u91cf\u540c\u6b65\u3002 \u5168\u91cf\u540c\u6b65\u662f\u4e3b\u8282\u70b9\u751f\u6210 RDB \u6587\u4ef6\uff0c\u5e76\u4f20\u7ed9\u4ece\u8282\u70b9\uff0c\u4ece\u8282\u70b9\u518d\u8fdb\u884c\u52a0\u8f7d\u3002 \u8bd5\u60f3\u4e00\u4e0b\uff0c\u5982\u679c RDB \u6587\u4ef6\u5f88\u5927\uff0c\u80af\u5b9a\u4f1a\u5bfc\u81f4\u5168\u91cf\u540c\u6b65\u7684\u65f6\u957f\u589e\u52a0\uff0c\u6548\u7387\u4e0d\u9ad8\uff0c\u800c\u4e14\u8fd8\u53ef\u80fd\u4f1a\u5bfc\u81f4\u590d\u5236\u7f13\u51b2\u533a\u6ea2\u51fa\u3002\u4e00\u65e6\u7f13\u51b2\u533a\u6ea2\u51fa\u4e86\uff0c\u4e3b\u4ece\u8282\u70b9\u95f4\u5c31\u4f1a\u53c8\u5f00\u59cb\u5168\u91cf\u540c\u6b65\uff0c\u5f71\u54cd\u4e1a\u52a1\u5e94\u7528\u7684\u6b63\u5e38\u4f7f\u7528\u3002\u5982\u679c\u6211\u4eec\u589e\u52a0\u590d\u5236\u7f13\u51b2\u533a\u7684\u5bb9\u91cf\uff0c\u8fd9\u53c8\u4f1a\u6d88\u8017\u5b9d\u8d35\u7684\u5185\u5b58\u8d44\u6e90\u3002 \u6b64\u5916\uff0c\u5982\u679c\u4e3b\u5e93\u53d1\u751f\u4e86\u6545\u969c\uff0c\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\u540e\uff0c\u5176\u4ed6\u4ece\u5e93\u90fd\u9700\u8981\u548c\u65b0\u4e3b\u5e93\u8fdb\u884c\u4e00\u6b21\u5168\u91cf\u540c\u6b65 \u3002\u5982\u679c RDB \u6587\u4ef6\u5f88\u5927\uff0c\u4e5f\u4f1a\u5bfc\u81f4\u4e3b\u4ece\u5207\u6362\u7684\u8fc7\u7a0b\u8017\u65f6\u589e\u52a0\uff0c\u540c\u6837\u4f1a\u5f71\u54cd\u4e1a\u52a1\u7684\u53ef\u7528\u6027\u3002 Pika \u662f\u5982\u4f55\u89e3\u51b3\u8fd9\u4e24\u65b9\u9762\u7684\u95ee\u9898\u5462\uff1f Pika \u4e2d\u7684\u5173\u952e\u6a21\u5757 RocksDB\u3001binlog \u673a\u5236\u548c Nemo \u4e86\uff0c\u8fd9\u4e9b\u6a21\u5757\u90fd\u662f Pika \u67b6\u6784\u4e2d\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206\u3002 2\u3001Pika \u7684\u6574\u4f53\u67b6\u6784 Pika \u952e\u503c\u6570\u636e\u5e93\u7684\u6574\u4f53\u67b6\u6784\u4e2d\u5305\u62ec\u4e86\u4e94\u90e8\u5206\uff0c \u5206\u522b\u662f\u7f51\u7edc\u6846\u67b6\u3001Pika \u7ebf\u7a0b\u6a21\u5757\u3001Nemo \u5b58\u50a8\u6a21\u5757\u3001RocksDB \u548c binlog \u673a\u5236 \uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u9996\u5148\uff0c\u7f51\u7edc\u6846\u67b6\u4e3b\u8981\u8d1f\u8d23\u5e95\u5c42\u7f51\u7edc\u8bf7\u6c42\u7684\u63a5\u6536\u548c\u53d1\u9001\u3002Pika \u7684\u7f51\u7edc\u6846\u67b6\u662f\u5bf9\u64cd\u4f5c\u7cfb\u7edf\u5e95\u5c42\u7684\u7f51\u7edc\u51fd\u6570\u8fdb\u884c\u4e86\u5c01\u88c5\u3002Pika \u5728\u8fdb\u884c\u7f51\u7edc\u901a\u4fe1\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u7f51\u7edc\u6846\u67b6\u5c01\u88c5\u597d\u7684\u51fd\u6570\u3002 \u5176\u6b21\uff0cPika \u7ebf\u7a0b\u6a21\u5757\u91c7\u7528\u4e86\u591a\u7ebf\u7a0b\u6a21\u578b\u6765\u5177\u4f53\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c \u5305\u62ec\u4e00\u4e2a\u8bf7\u6c42\u5206\u53d1\u7ebf\u7a0b\uff08DispatchThread\uff09\u3001\u4e00\u7ec4\u5de5\u4f5c\u7ebf\u7a0b\uff08WorkerThread\uff09\u4ee5\u53ca\u4e00\u4e2a\u7ebf\u7a0b\u6c60\uff08ThreadPool\uff09 \u3002 \u8bf7\u6c42\u5206\u53d1\u7ebf\u7a0b\u4e13\u95e8\u76d1\u542c\u7f51\u7edc\u7aef\u53e3\uff0c\u4e00\u65e6\u63a5\u6536\u5230\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u8bf7\u6c42\u540e\uff0c\u5c31\u548c\u5ba2\u6237\u7aef\u5efa\u7acb\u8fde\u63a5\uff0c\u5e76\u628a\u8fde\u63a5\u4ea4\u7531\u5de5\u4f5c\u7ebf\u7a0b\u5904\u7406\u3002 \u5de5\u4f5c\u7ebf\u7a0b\u8d1f\u8d23\u63a5\u6536\u5ba2\u6237\u7aef\u8fde\u63a5\u4e0a\u53d1\u9001\u7684\u5177\u4f53\u547d\u4ee4\u8bf7\u6c42\uff0c\u5e76\u628a\u547d\u4ee4\u8bf7\u6c42\u5c01\u88c5\u6210 Task\uff0c\u518d\u4ea4\u7ed9\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\uff0c\u7531\u8fd9\u4e9b\u7ebf\u7a0b\u8fdb\u884c\u5b9e\u9645\u7684\u6570\u636e\u5b58\u53d6\u5904\u7406\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u5728\u5b9e\u9645\u5e94\u7528 Pika \u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0\u5de5\u4f5c\u7ebf\u7a0b\u6570\u548c\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u6570\uff0c\u6765\u63d0\u5347 Pika \u7684\u8bf7\u6c42\u5904\u7406\u541e\u5410\u7387\uff0c\u8fdb\u800c\u6ee1\u8db3\u4e1a\u52a1\u5c42\u5bf9\u6570\u636e\u5904\u7406\u6027\u80fd\u7684\u9700\u6c42\u3002 Nemo \u6a21\u5757\u5f88\u5bb9\u6613\u7406\u89e3\uff0c\u5b83\u5b9e\u73b0\u4e86 Pika \u548c Redis \u7684\u6570\u636e\u7c7b\u578b\u517c\u5bb9\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5f53\u6211\u4eec\u628a Redis \u670d\u52a1\u8fc1\u79fb\u5230 Pika \u65f6\uff0c \u4e0d\u7528\u4fee\u6539\u4e1a\u52a1\u5e94\u7528\u4e2d\u64cd\u4f5c Redis \u7684\u4ee3\u7801\uff0c\u800c\u4e14\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u5e94\u7528\u8fd0\u7ef4 Redis \u7684\u7ecf\u9a8c\uff0c\u8fd9\u4f7f\u5f97 Pika \u7684\u5b66\u4e60\u6210\u672c\u5c31\u8f83\u4f4e\u3002 \u6700\u540e\uff0c\u6211\u4eec\u518d\u6765\u770b\u770b RocksDB \u63d0\u4f9b\u7684\u57fa\u4e8e SSD \u4fdd\u5b58\u6570\u636e\u7684\u529f\u80fd\u3002 \u5b83\u4f7f\u5f97 Pika \u53ef\u4ee5\u4e0d\u7528\u5927\u5bb9\u91cf\u7684\u5185\u5b58\uff0c\u5c31\u80fd\u4fdd\u5b58\u66f4\u591a\u6570\u636e\uff0c\u8fd8\u907f\u514d\u4e86\u4f7f\u7528\u5185\u5b58\u5feb\u7167\u3002\u800c\u4e14\uff0cPika \u4f7f\u7528 binlog \u673a\u5236\u8bb0\u5f55\u5199\u547d\u4ee4\uff0c\u7528\u4e8e\u4e3b\u4ece\u8282\u70b9\u7684\u547d\u4ee4\u540c\u6b65\uff0c\u907f\u514d\u4e86\u521a\u521a\u6240\u8bf4\u7684\u5927\u5185\u5b58\u5b9e\u4f8b\u5728\u4e3b\u4ece\u540c\u6b65\u8fc7\u7a0b\u4e2d\u7684\u6f5c\u5728\u95ee\u9898\u3002 3\u3001Pika \u5982\u4f55\u57fa\u4e8e SSD \u4fdd\u5b58\u66f4\u591a\u6570\u636e\uff1f \u4e3a\u4e86\u628a\u6570\u636e\u4fdd\u5b58\u5230 SSD\uff0cPika \u4f7f\u7528\u4e86\u4e1a\u754c\u5e7f\u6cdb\u5e94\u7528\u7684\u6301\u4e45\u5316 \u952e\u503c\u6570\u636e\u5e93RocksDB \u3002 \u4e0b\u9762\u6211\u6765\u89e3\u91ca\u4e0b\u8fd9\u4e2a\u57fa\u672c\u8bfb\u5199\u673a\u5236\u3002\u6765\u7ed9\u4f60\u5177\u4f53\u4ecb\u7ecd\u4e0b RocksDB \u5199\u5165\u6570\u636e\u7684\u57fa\u672c\u6d41\u7a0b \u5f53 Pika \u9700\u8981\u4fdd\u5b58\u6570\u636e\u65f6\uff0cRocksDB \u4f1a\u4f7f\u7528\u4e24\u5c0f\u5757\u5185\u5b58\u7a7a\u95f4\uff08Memtable1 \u548c Memtable2\uff09\u6765\u4ea4\u66ff\u7f13\u5b58\u5199\u5165\u7684\u6570\u636e\u3002 Memtable \u7684\u5927\u5c0f\u53ef\u4ee5\u8bbe\u7f6e\uff0c \u4e00\u4e2a Memtable \u7684\u5927\u5c0f\u4e00\u822c\u4e3a\u51e0 MB \u6216\u51e0\u5341 MB \u3002 \u5f53\u6709\u6570\u636e\u8981\u5199\u5165 RocksDB \u65f6\uff0cRocksDB \u4f1a\u5148\u628a\u6570\u636e\u5199\u5165\u5230 Memtable1\u3002 \u7b49\u5230 Memtable1 \u5199\u6ee1\u540e\uff0cRocksDB \u518d\u628a\u6570\u636e\u4ee5\u6587\u4ef6\u7684\u5f62\u5f0f\uff0c\u5feb\u901f\u5199\u5165\u5e95\u5c42\u7684 SSD\u3002 \u540c\u65f6\uff0cRocksDB \u4f1a\u4f7f\u7528 Memtable2 \u6765\u4ee3\u66ff Memtable1\uff0c\u7f13\u5b58\u65b0\u5199\u5165\u7684\u6570\u636e\u3002 \u7b49\u5230 Memtable1 \u7684\u6570\u636e\u90fd\u5199\u5165 SSD \u4e86\uff0cRocksDB \u4f1a\u5728 Memtable2 \u5199\u6ee1\u540e\uff0c\u518d\u7528 Memtable1 \u7f13\u5b58\u65b0\u5199\u5165\u7684\u6570\u636e\u3002 RocksDB \u4f1a\u5148\u7528 Memtable \u7f13\u5b58\u6570\u636e\uff0c\u518d\u5c06\u6570\u636e\u5feb\u901f\u5199\u5165 SSD\uff0c\u5373\u4f7f\u6570\u636e\u91cf\u518d\u5927\uff0c\u6240\u6709\u6570\u636e\u4e5f\u90fd\u80fd\u4fdd\u5b58\u5230 SSD \u4e2d\u3002 \u800c\u4e14\uff0c Memtable \u672c\u8eab\u5bb9\u91cf\u4e0d\u5927\uff0c\u5373\u4f7f RocksDB \u4f7f\u7528\u4e86\u4e24\u4e2a Memtable\uff0c\u4e5f\u4e0d\u4f1a\u5360\u7528\u8fc7\u591a\u7684\u5185\u5b58\uff0c\u8fd9\u6837\u4e00\u6765\uff0cPika \u5728\u4fdd\u5b58\u5927\u5bb9\u91cf\u6570\u636e\u65f6\uff0c\u4e5f\u4e0d\u7528\u5360\u636e\u592a\u5927\u7684\u5185\u5b58\u7a7a\u95f4\u4e86\u3002 \u5f53 Pika \u9700\u8981\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\uff0cRocksDB \u4f1a\u5148\u5728 Memtable \u4e2d\u67e5\u8be2\u662f\u5426\u6709\u8981\u8bfb\u53d6\u7684\u6570\u636e\u3002\u8fd9\u662f\u56e0\u4e3a\uff0c\u6700\u65b0\u7684\u6570\u636e\u90fd\u662f\u5148\u5199\u5165\u5230 Memtable \u4e2d\u7684\u3002 \u5982\u679c Memtable \u4e2d\u6ca1\u6709\u8981\u8bfb\u53d6\u7684\u6570\u636e\uff0cRocksDB \u4f1a\u518d\u67e5\u8be2\u4fdd\u5b58\u5728 SSD \u4e0a\u7684\u6570\u636e\u6587\u4ef6\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u5f53\u4f7f\u7528\u4e86 RocksDB \u4fdd\u5b58\u6570\u636e\u540e\uff0cPika \u5c31\u53ef\u4ee5\u628a\u5927\u91cf\u6570\u636e\u4fdd\u5b58\u5230\u5927\u5bb9\u91cf\u7684 SSD \u4e0a\u4e86\uff0c\u5b9e\u73b0\u4e86\u5927\u5bb9\u91cf\u5b9e\u4f8b\u3002 \u4e0d\u8fc7\uff0c\u6211\u521a\u624d\u5411\u4f60\u4ecb\u7ecd\u8fc7\uff0c\u5f53\u4f7f\u7528\u5927\u5185\u5b58\u5b9e\u4f8b\u4fdd\u5b58\u5927\u91cf\u6570\u636e\u65f6\uff0c Redis \u4f1a\u9762\u4e34 RDB \u751f\u6210\u548c\u6062\u590d\u7684\u6548\u7387\u95ee\u9898\uff0c\u4ee5\u53ca\u4e3b\u4ece\u540c\u6b65\u65f6\u7684\u6548\u7387\u548c\u7f13\u51b2\u533a\u6ea2\u51fa\u95ee\u9898\u3002\u90a3\u4e48\uff0c\u5f53 Pika \u4fdd\u5b58\u5927\u91cf\u6570\u636e\u65f6\uff0c\u8fd8\u4f1a\u9762\u4e34\u76f8\u540c\u7684\u95ee\u9898\u5417\uff1f \u5176\u5b9e\u4e0d\u4f1a\u4e86 \u4e00\u65b9\u9762\uff0cPika \u57fa\u4e8e RocksDB \u4fdd\u5b58\u4e86\u6570\u636e\u6587\u4ef6\uff0c\u76f4\u63a5\u8bfb\u53d6\u6570\u636e\u6587\u4ef6\u5c31\u80fd\u6062\u590d\uff0c\u4e0d\u9700\u8981\u518d\u901a\u8fc7\u5185\u5b58\u5feb\u7167\u8fdb\u884c\u6062\u590d\u4e86\u3002\u800c\u4e14\uff0cPika \u4ece\u5e93\u5728\u8fdb\u884c\u5168\u91cf\u540c\u6b65\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ece\u4e3b\u5e93\u62f7\u8d1d\u6570\u636e\u6587\u4ef6\uff0c\u4e0d\u9700\u8981\u4f7f\u7528\u5185\u5b58\u5feb\u7167\uff0c\u8fd9\u6837\u4e00\u6765\uff0cPika \u5c31\u907f\u514d\u4e86\u5927\u5185\u5b58\u5feb\u7167\u751f\u6210\u6548\u7387\u4f4e\u7684\u95ee\u9898\u3002 \u53e6\u4e00\u65b9\u9762\uff0cPika \u4f7f\u7528\u4e86 binlog \u673a\u5236\u5b9e\u73b0\u589e\u91cf\u547d\u4ee4\u540c\u6b65\uff0c\u65e2\u8282\u7701\u4e86\u5185\u5b58\uff0c\u8fd8\u907f\u514d\u4e86\u7f13\u51b2\u533a\u6ea2\u51fa\u7684\u95ee\u9898\u3002binlog \u662f\u4fdd\u5b58\u5728 SSD \u4e0a\u7684\u6587\u4ef6\uff0cPika \u63a5\u6536\u5230\u5199\u547d\u4ee4\u540e\uff0c\u5728\u628a\u6570\u636e\u5199\u5165 Memtable \u65f6\uff0c\u4e5f\u4f1a\u628a\u547d\u4ee4\u64cd\u4f5c\u5199\u5230 binlog \u6587\u4ef6\u4e2d\u3002 \u548c Redis \u7c7b\u4f3c\uff0c\u5f53\u5168\u91cf\u540c\u6b65\u7ed3\u675f\u540e\uff0c\u4ece\u5e93\u4f1a\u4ece binlog \u4e2d\u628a\u5c1a\u672a\u540c\u6b65\u7684\u547d\u4ee4\u8bfb\u53d6\u8fc7\u6765\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u548c\u4e3b\u5e93\u7684\u6570\u636e\u4fdd\u6301\u4e00\u81f4\u3002\u5f53\u8fdb\u884c\u589e\u91cf\u540c\u6b65\u65f6\uff0c\u4ece\u5e93\u4e5f\u662f\u628a\u81ea\u5df1\u5df2\u7ecf\u590d\u5236\u7684\u504f\u79fb\u91cf\u53d1\u7ed9\u4e3b\u5e93\uff0c\u4e3b\u5e93\u628a\u5c1a\u672a\u540c\u6b65\u7684\u547d\u4ee4\u53d1\u7ed9\u4ece\u5e93\uff0c\u6765\u4fdd\u6301\u4e3b\u4ece\u5e93\u7684\u6570\u636e\u4e00\u81f4\u3002 \u548c Redis \u4f7f\u7528\u7f13\u51b2\u533a\u76f8\u6bd4\uff0c\u4f7f\u7528 binlog \u597d\u5904\u662f\u975e\u5e38\u660e\u663e\u7684\uff1a binlog \u662f\u4fdd\u5b58\u5728 SSD \u4e0a\u7684\u6587\u4ef6\uff0c\u6587\u4ef6\u5927\u5c0f\u4e0d\u50cf\u7f13\u51b2\u533a\uff0c\u4f1a\u53d7\u5230\u5185\u5b58\u5bb9\u91cf\u7684\u8f83\u591a\u9650\u5236\u3002 \u800c\u4e14\uff0c\u5f53 binlog \u6587\u4ef6\u589e\u5927\u540e\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u8f6e\u66ff\u64cd\u4f5c\uff0c\u751f\u6210\u65b0\u7684 binlog \u6587\u4ef6\uff0c\u518d\u628a\u65e7\u7684 binlog \u6587\u4ef6\u72ec\u7acb\u4fdd\u5b58\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f Pika \u5b9e\u4f8b\u4fdd\u5b58\u4e86\u5927\u91cf\u7684\u6570\u636e\uff0c\u5728\u540c\u6b65\u8fc7\u7a0b\u4e2d\u4e5f\u4e0d\u4f1a\u51fa\u73b0\u7f13\u51b2\u533a\u6ea2\u51fa\u7684\u95ee\u9898\u4e86\u3002 Pika \u4f7f\u7528 RocksDB \u628a\u5927\u91cf\u6570\u636e\u4fdd\u5b58\u5230\u4e86 SSD\uff0c\u540c\u65f6\u907f\u514d\u4e86\u5185\u5b58\u5feb\u7167\u7684\u751f\u6210\u548c\u6062\u590d\u95ee\u9898\u3002\u800c\u4e14\uff0cPika \u4f7f\u7528 binlog \u673a\u5236\u8fdb\u884c\u4e3b\u4ece\u540c\u6b65\uff0c\u907f\u514d\u5927\u5185\u5b58\u65f6\u7684\u5f71\u54cd\uff0cPika \u7684\u7b2c\u4e00\u4e2a\u8bbe\u8ba1\u76ee\u6807\u5c31\u5b9e\u73b0\u4e86\u3002 2\u3001Pika \u5982\u4f55\u5b9e\u73b0 Redis \u6570\u636e\u7c7b\u578b\u517c\u5bb9\uff1f Pika \u7684\u5e95\u5c42\u5b58\u50a8\u4f7f\u7528\u4e86 RocksDB \u6765\u4fdd\u5b58\u6570\u636e\uff0c\u4f46\u662f\uff0c RocksDB \u53ea\u63d0\u4f9b\u4e86\u5355\u503c\u7684\u952e\u503c\u5bf9\u7c7b\u578b\uff0cRocksDB \u952e\u503c\u5bf9\u4e2d\u7684\u503c\u5c31\u662f\u5355\u4e2a\u503c\uff0c\u800c Redis \u952e\u503c\u5bf9\u4e2d\u7684\u503c\u8fd8\u53ef\u4ee5\u662f\u96c6\u5408\u7c7b\u578b \u3002 \u5bf9\u4e8e Redis \u7684 String \u7c7b\u578b\u6765\u8bf4\uff0c\u5b83\u672c\u8eab\u5c31\u662f\u5355\u503c\u7684\u952e\u503c\u5bf9\uff0c\u6211\u4eec\u76f4\u63a5\u7528 RocksDB \u4fdd\u5b58\u5c31\u884c\u3002\u4f46\u662f\uff0c\u5bf9\u4e8e\u96c6\u5408\u7c7b\u578b\u6765\u8bf4\uff0c\u6211\u4eec\u5c31\u65e0\u6cd5\u76f4\u63a5\u628a\u96c6\u5408\u4fdd\u5b58\u4e3a\u5355\u503c\u7684\u952e\u503c\u5bf9\uff0c\u800c\u662f\u9700\u8981\u8fdb\u884c\u8f6c\u6362\u64cd\u4f5c\u3002 \u4e3a\u4e86\u4fdd\u6301\u548c Redis \u7684\u517c\u5bb9\u6027\uff0c Pika \u7684 Nemo \u6a21\u5757\u5c31\u8d1f\u8d23\u628a Redis \u7684\u96c6\u5408\u7c7b\u578b\u8f6c\u6362\u6210\u5355\u503c\u7684\u952e\u503c\u5bf9\u3002 \u7b80\u5355\u6765\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u628a Redis \u7684\u96c6\u5408\u7c7b\u578b\u5206\u6210\u4e24\u7c7b\uff1a \u4e00\u7c7b\u662f List \u548c Set \u7c7b\u578b\uff0c\u5b83\u4eec\u7684\u96c6\u5408\u4e2d\u4e5f\u53ea\u6709\u5355\u503c\uff1b \u53e6\u4e00\u7c7b\u662f Hash \u548c Sorted Set \u7c7b\u578b\uff0c\u5b83\u4eec\u7684\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u662f\u6210\u5bf9\u7684\uff0c\u5176\u4e2d\uff0cHash \u96c6\u5408\u5143\u7d20\u662f field-value \u7c7b\u578b\uff0c\u800c Sorted Set \u96c6\u5408\u5143\u7d20\u662f member-score \u7c7b\u578b \u3002 Nemo \u6a21\u5757\u901a\u8fc7\u8f6c\u6362\u64cd\u4f5c\uff0c\u628a\u8fd9 4 \u79cd\u96c6\u5408\u7c7b\u578b\u7684\u5143\u7d20\u8868\u793a\u4e3a\u5355\u503c\u7684\u952e\u503c\u5bf9\u3002\u5177\u4f53\u600e\u4e48\u8f6c\u6362\u5462\uff1f \u9996\u5148\u6211\u4eec\u6765\u770b List \u7c7b\u578b\u3002 \u5728 Pika \u4e2d\uff0cList \u96c6\u5408\u7684 key \u88ab\u5d4c\u5165\u5230\u4e86\u5355\u503c\u952e\u503c\u5bf9\u7684\u952e\u5f53\u4e2d\uff0c\u7528 key \u5b57\u6bb5\u8868\u793a\uff1b \u800c List \u96c6\u5408\u7684\u5143\u7d20\u503c\uff0c\u5219\u88ab\u5d4c\u5165\u5230\u5355\u503c\u952e\u503c\u5bf9\u7684\u503c\u5f53\u4e2d\uff0c\u7528 value \u5b57\u6bb5\u8868\u793a\u3002 \u56e0\u4e3a List \u96c6\u5408\u4e2d\u7684\u5143\u7d20\u662f\u6709\u5e8f\u7684\uff0c\u6240\u4ee5\uff0cNemo \u6a21\u5757\u8fd8\u5728\u5355\u503c\u952e\u503c\u5bf9\u7684 key \u540e\u9762\u589e\u52a0\u4e86 sequence \u5b57\u6bb5\uff0c\u8868\u793a\u5f53\u524d\u5143\u7d20\u5728 List \u4e2d\u7684\u987a\u5e8f\uff0c\u540c\u65f6\uff0c\u8fd8\u5728 value \u7684\u524d\u9762\u589e\u52a0\u4e86 previous sequence \u548c next sequence \u8fd9\u4e24\u4e2a\u5b57\u6bb5\uff0c\u5206\u522b\u8868\u793a\u5f53\u524d\u5143\u7d20\u7684\u524d\u4e00\u4e2a\u5143\u7d20\u548c\u540e\u4e00\u4e2a\u5143\u7d20\u3002 \u6b64\u5916\uff0c\u5728\u5355\u503c\u952e\u503c\u5bf9\u7684 key \u524d\u9762\uff0cNemo \u6a21\u5757\u8fd8\u589e\u52a0\u4e86\u4e00\u4e2a\u503c\u201cl\u201d\uff0c\u8868\u793a\u5f53\u524d\u6570\u636e\u662f List \u7c7b\u578b\uff0c\u4ee5\u53ca\u589e\u52a0\u4e86\u4e00\u4e2a 1 \u5b57\u8282\u7684 size \u5b57\u6bb5\uff0c\u8868\u793a List \u96c6\u5408 key \u7684\u5927\u5c0f\u3002 \u5728\u5355\u503c\u952e\u503c\u5bf9\u7684 value \u540e\u9762\uff0cNemo \u6a21\u5757\u8fd8\u589e\u52a0\u4e86 version \u548c ttl \u5b57\u6bb5\uff0c\u5206\u522b\u8868\u793a\u5f53\u524d\u6570\u636e\u7684\u7248\u672c\u53f7\u548c\u5269\u4f59\u5b58\u6d3b\u65f6\u95f4\uff08\u7528\u6765\u652f\u6301\u8fc7\u671f key \u529f\u80fd\uff09\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a Set \u96c6\u5408 Set \u96c6\u5408\u7684 key \u548c\u5143\u7d20 member \u503c\uff0c\u90fd\u88ab\u5d4c\u5165\u5230\u4e86 Pika \u5355\u503c\u952e\u503c\u5bf9\u7684\u952e\u5f53\u4e2d\uff0c\u5206\u522b\u7528 key \u548c member \u5b57\u6bb5\u8868\u793a\u3002 \u540c\u65f6\uff0c\u548c List \u96c6\u5408\u7c7b\u4f3c\uff0c\u5355\u503c\u952e\u503c\u5bf9\u7684 key \u524d\u9762\u6709\u503c\u201cs\u201d\uff0c\u7528\u6765\u8868\u793a\u6570\u636e\u662f Set \u7c7b\u578b\uff0c\u540c\u65f6\u8fd8\u6709 size \u5b57\u6bb5\uff0c\u7528\u6765\u8868\u793a key \u7684\u5927\u5c0f\u3002Pika \u5355\u503c\u952e\u503c\u5bf9\u7684\u503c\u53ea\u4fdd\u5b58\u4e86\u6570\u636e\u7684\u7248\u672c\u4fe1\u606f\u548c\u5269\u4f59\u5b58\u6d3b\u65f6\u95f4\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u5bf9\u4e8e Hash \u7c7b\u578b\u6765\u8bf4\uff0cHash \u96c6\u5408\u7684 key \u88ab\u5d4c\u5165\u5230\u5355\u503c\u952e\u503c\u5bf9\u7684\u952e\u5f53\u4e2d\uff0c\u7528 key \u5b57\u6bb5\u8868\u793a\uff0c\u800c Hash \u96c6\u5408\u5143\u7d20\u7684 field \u4e5f\u88ab\u5d4c\u5165\u5230\u5355\u503c\u952e\u503c\u5bf9\u7684\u952e\u5f53\u4e2d\uff0c\u7d27\u63a5\u7740 key \u5b57\u6bb5\uff0c\u7528 field \u5b57\u6bb5\u8868\u793a\u3002 Hash \u96c6\u5408\u5143\u7d20\u7684 value \u5219\u662f\u5d4c\u5165\u5230\u5355\u503c\u952e\u503c\u5bf9\u7684\u503c\u5f53\u4e2d\uff0c\u5e76\u4e14\u4e5f\u5e26\u6709\u7248\u672c\u4fe1\u606f\u548c\u5269\u4f59\u5b58\u6d3b\u65f6\u95f4\uff0c \u5982\u4e0b\u56fe\u6240\u793a\uff1a \u6700\u540e\uff0c\u5bf9\u4e8e Sorted Set \u7c7b\u578b\u6765\u8bf4\uff0c\u8be5\u7c7b\u578b\u662f\u9700\u8981\u80fd\u591f\u6309\u7167\u96c6\u5408\u5143\u7d20\u7684 score \u503c\u6392\u5e8f\u7684\uff0c\u800c RocksDB \u53ea\u652f\u6301\u6309\u7167\u5355\u503c\u952e\u503c\u5bf9\u7684\u952e\u6765\u6392\u5e8f\u3002 \u6240\u4ee5\uff0cNemo \u6a21\u5757\u5728\u8f6c\u6362\u6570\u636e\u65f6\uff0c\u5c31\u628a Sorted Set \u96c6\u5408 key\u3001\u5143\u7d20\u7684 score \u548c member \u503c\u90fd\u5d4c\u5165\u5230\u4e86\u5355\u503c\u952e\u503c\u5bf9\u7684\u952e\u5f53\u4e2d \uff0c\u6b64\u65f6\uff0c\u5355\u503c\u952e\u503c\u5bf9\u4e2d\u7684\u503c\u53ea\u4fdd\u5b58\u4e86\u6570\u636e\u7684\u7248\u672c\u4fe1\u606f\u548c\u5269\u4f59\u5b58\u6d3b\u65f6\u95f4\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u91c7\u7528\u4e86\u4e0a\u9762\u7684\u8f6c\u6362\u65b9\u5f0f\u4e4b\u540e\uff0c Pika \u4e0d\u4ec5\u80fd\u517c\u5bb9\u652f\u6301 Redis \u7684\u6570\u636e\u7c7b\u578b\uff0c\u800c\u4e14\u8fd8\u4fdd\u7559\u4e86\u8fd9\u4e9b\u6570\u636e\u7c7b\u578b\u7684\u7279\u5f81\uff0c\u4f8b\u5982 List \u7684\u5143\u7d20\u4fdd\u5e8f\u3001Sorted Set \u7684\u5143\u7d20\u6309 score \u6392\u5e8f \u3002 \u4e86\u89e3\u4e86 Pika \u7684\u8f6c\u6362\u673a\u5236\u540e\uff0c\u4f60\u5c31\u4f1a\u660e\u767d\uff0c\u5982\u679c\u4f60\u6709\u4e1a\u52a1\u5e94\u7528\u8ba1\u5212\u4ece\u4f7f\u7528 Redis \u5207\u6362\u5230\u4f7f\u7528 Pika\uff0c\u5c31\u4e0d\u7528\u62c5\u5fc3\u9762\u4e34\u56e0\u4e3a\u64cd\u4f5c\u63a5\u53e3\u4e0d\u517c\u5bb9\u800c\u8981\u4fee\u6539\u4e1a\u52a1\u5e94\u7528\u7684\u95ee\u9898\u4e86\u3002 3\u3001Pika \u7684\u5176\u4ed6\u4f18\u52bf\u4e0e\u4e0d\u8db3 \u8ddf Redis \u76f8\u6bd4\uff0cPika \u6700\u5927\u7684\u7279\u70b9\u5c31\u662f\u4f7f\u7528\u4e86 SSD \u6765\u4fdd\u5b58\u6570\u636e\uff0c\u8fd9\u4e2a\u7279\u70b9\u80fd\u5e26\u6765\u7684\u6700\u76f4\u63a5\u597d\u5904\u5c31\u662f\uff0cPika \u5355\u5b9e\u4f8b\u80fd\u4fdd\u5b58\u66f4\u591a\u7684\u6570\u636e\u4e86\uff0c\u5b9e\u73b0\u4e86\u5b9e\u4f8b\u6570\u636e\u6269\u5bb9\u3002 \u9664\u6b64\u4e4b\u5916\uff0cPika \u4f7f\u7528 SSD \u6765\u4fdd\u5b58\u6570\u636e\uff0c\u8fd8\u6709\u989d\u5916\u7684\u4e24\u4e2a\u4f18\u52bf\u3002 \u9996\u5148\uff0c \u5b9e\u4f8b\u91cd\u542f\u5feb\u3002Pika \u7684\u6570\u636e\u5728\u5199\u5165\u6570\u636e\u5e93\u65f6\uff0c\u662f\u4f1a\u4fdd\u5b58\u5230 SSD \u4e0a\u7684 \u3002\u5f53 Pika \u5b9e\u4f8b\u91cd\u542f\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ece SSD \u4e0a\u7684\u6570\u636e\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c \u4e0d\u9700\u8981\u50cf Redis \u4e00\u6837\uff0c\u4ece RDB \u6587\u4ef6\u5168\u90e8\u91cd\u65b0\u52a0\u8f7d\u6570\u636e\u6216\u662f\u4ece AOF \u6587\u4ef6\u4e2d\u5168\u90e8\u56de\u653e\u64cd\u4f5c \uff0c\u8fd9\u6781\u5927\u5730\u63d0\u9ad8\u4e86 Pika \u5b9e\u4f8b\u7684\u91cd\u542f\u901f\u5ea6\uff0c\u53ef\u4ee5\u5feb\u901f\u5904\u7406\u4e1a\u52a1\u5e94\u7528\u8bf7\u6c42\u3002 \u53e6\u5916\uff0c\u4e3b\u4ece\u5e93\u91cd\u65b0\u6267\u884c\u5168\u91cf\u540c\u6b65\u7684\u98ce\u9669\u4f4e \u3002 Pika \u901a\u8fc7 binlog \u673a\u5236\u5b9e\u73b0\u5199\u547d\u4ee4\u7684\u589e\u91cf\u540c\u6b65\uff0c\u4e0d\u518d\u53d7\u5185\u5b58\u7f13\u51b2\u533a\u5927\u5c0f\u7684\u9650\u5236\uff0c\u6240\u4ee5\uff0c\u5373\u4f7f\u5728\u6570\u636e\u91cf\u5f88\u5927\u5bfc\u81f4\u4e3b\u4ece\u5e93\u540c\u6b65\u8017\u65f6\u5f88\u957f\u7684\u60c5\u51b5\u4e0b\uff0cPika \u4e5f\u4e0d\u7528\u62c5\u5fc3\u7f13\u51b2\u533a\u6ea2\u51fa\u800c\u89e6\u53d1\u7684\u4e3b\u4ece\u5e93\u91cd\u65b0\u5168\u91cf\u540c\u6b65 \u3002 Pika \u4e5f\u6709\u81ea\u8eab\u7684\u4e00\u4e9b\u4e0d\u8db3\u3002 \u867d\u7136\u5b83\u4fdd\u6301\u4e86 Redis \u64cd\u4f5c\u63a5\u53e3\uff0c\u4e5f\u80fd\u5b9e\u73b0\u6570\u636e\u5e93\u6269\u5bb9\uff0c\u4f46\u662f\uff0c\u5f53\u628a\u6570\u636e\u4fdd\u5b58\u5230 SSD \u4e0a\u540e\uff0c\u4f1a\u964d\u4f4e\u6570\u636e\u7684\u8bbf\u95ee\u6027\u80fd\u3002 \u8fd9\u662f\u56e0\u4e3a\uff0c\u6570\u636e\u64cd\u4f5c\u6bd5\u7adf\u4e0d\u80fd\u5728\u5185\u5b58\u4e2d\u76f4\u63a5\u6267\u884c\u4e86\uff0c\u800c\u662f\u8981\u5728\u5e95\u5c42\u7684 SSD \u4e2d\u8fdb\u884c\u5b58\u53d6\uff0c\u8fd9\u80af\u5b9a\u4f1a\u5f71\u54cd\uff0cPika \u7684\u6027\u80fd\u3002\u800c\u4e14\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u628a binlog \u673a\u5236\u8bb0\u5f55\u7684\u5199\u547d\u4ee4\u540c\u6b65\u5230 SSD \u4e0a\uff0c\u8fd9\u4f1a\u964d\u4f4e Pika \u7684\u5199\u6027\u80fd\u3002 \u4e0d\u8fc7\uff0cPika \u7684\u591a\u7ebf\u7a0b\u6a21\u578b\uff0c\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528\u591a\u4e2a\u7ebf\u7a0b\u8fdb\u884c\u6570\u636e\u8bfb\u5199\uff0c\u8fd9\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u5f25\u8865\u4e86\u4ece SSD \u5b58\u53d6\u6570\u636e\u9020\u6210\u7684\u6027\u80fd\u635f\u5931\u3002 \u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u9ad8\u914d\u7684 SSD \u6765\u63d0\u5347\u8bbf\u95ee\u6027\u80fd\uff0c\u8fdb\u800c\u51cf\u5c11\u8bfb\u5199 SSD \u5bf9 Pika \u6027\u80fd\u7684\u5f71\u54cd\u3002 \u8fd9\u4e9b\u6570\u636e\u662f\u5728 Pika 3.2 \u7248\u672c\u4e2d\uff0cString \u548c Hash \u7c7b\u578b\u5728\u591a\u7ebf\u7a0b\u60c5\u51b5\u4e0b\u7684\u57fa\u672c\u64cd\u4f5c\u6027\u80fd\u7ed3\u679c\u3002 \u4ece\u8868\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u5728 \u4e0d\u5199 binlog \u65f6\uff0cPika \u7684 SET/GET\u3001HSET/HGET \u7684\u6027\u80fd\u90fd\u80fd\u8fbe\u5230 200K OPS \u4ee5\u4e0a\uff0c\u800c\u4e00\u65e6\u589e\u52a0\u4e86\u5199 binlog \u64cd\u4f5c\uff0cSET \u548c HSET \u64cd\u4f5c\u6027\u80fd\u5927\u7ea6\u4e0b\u964d\u4e86 41%\uff0c\u53ea\u6709\u7ea6 120K OPS\u3002 \u4f7f\u7528 Pika \u65f6\uff0c\u9700\u8981\u5728\u5355\u5b9e\u4f8b\u6269\u5bb9\u7684\u5fc5\u8981\u6027\u548c\u53ef\u80fd\u7684\u6027\u80fd\u635f\u5931\u95f4\u505a\u4e2a\u6743\u8861 4\u3001\u672c\u8282\u5c0f\u7ed3 \u8ddf Redis \u76f8\u6bd4\uff0cPika \u7684\u597d\u5904\u975e\u5e38\u660e\u663e\uff1a\u65e2\u652f\u6301 Redis \u64cd\u4f5c\u63a5\u53e3\uff0c\u53c8\u80fd\u652f\u6301\u4fdd\u5b58\u5927\u5bb9\u91cf\u7684\u6570\u636e\u3002 \u5982\u679c\u4f60\u539f\u6765\u5c31\u5728\u5e94\u7528 Redis\uff0c\u73b0\u5728\u60f3\u8fdb\u884c\u6269\u5bb9\uff0c\u90a3\u4e48\uff0cPika \u65e0\u7591\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\uff0c\u65e0\u8bba\u662f\u4ee3\u7801\u8fc1\u79fb\u8fd8\u662f\u8fd0\u7ef4\u7ba1\u7406\uff0cPika \u57fa\u672c\u4e0d\u9700\u8981\u989d\u5916\u7684\u5de5\u4f5c\u91cf\u3002 \u4e0d\u8fc7\uff0cPika \u6bd5\u7adf\u662f\u628a\u6570\u636e\u4fdd\u5b58\u5230\u4e86 SSD \u4e0a\uff0c\u6570\u636e\u8bbf\u95ee\u8981\u8bfb\u5199 SSD\uff0c\u6240\u4ee5\uff0c\u8bfb\u5199\u6027\u80fd\u8981\u5f31\u4e8e Redis\u3002\u9488\u5bf9\u8fd9\u4e00\u70b9\uff0c\u6211\u7ed9\u4f60\u63d0\u4f9b\u4e24\u4e2a\u964d\u4f4e\u8bfb\u5199 SSD \u5bf9 Pika \u7684\u6027\u80fd\u5f71\u54cd\u7684\u5c0f\u5efa\u8bae\uff1a \u5229\u7528 Pika \u7684\u591a\u7ebf\u7a0b\u6a21\u578b\uff0c\u589e\u52a0\u7ebf\u7a0b\u6570\u91cf\uff0c\u63d0\u5347 Pika \u7684\u5e76\u53d1\u8bf7\u6c42\u5904\u7406\u80fd\u529b\uff1b \u4e3a Pika \u914d\u7f6e\u9ad8\u914d\u7684 SSD\uff0c\u63d0\u5347 SSD \u81ea\u8eab\u7684\u8bbf\u95ee\u6027\u80fd\u3002 Pika \u672c\u8eab\u63d0\u4f9b\u4e86\u5f88\u591a\u5de5\u5177\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u628a Redis \u6570\u636e\u8fc1\u79fb\u5230 Pika\uff0c\u6216\u8005\u662f\u628a Redis \u8bf7\u6c42\u8f6c\u53d1\u7ed9 Pika\u3002\u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u4f7f\u7528 aof_to_pika \u547d\u4ee4\uff0c\u5e76\u4e14\u6307\u5b9a Redis \u7684 AOF \u6587\u4ef6\u4ee5\u53ca Pika \u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u5c31\u53ef\u4ee5\u628a Redis \u6570\u636e\u8fc1\u79fb\u5230 Pika \u4e2d\u4e86\uff0c\u5982\u4e0b\u6240\u793a\uff1a aof_to_pika -i [Redis AOF\u6587\u4ef6] -h [Pika IP] -p [Pika port] -a [\u8ba4\u8bc1\u4fe1\u606f] \u4f60\u90fd\u53ef\u4ee5\u76f4\u63a5\u5728 Pika \u7684 GitHub \u4e0a\u627e\u5230\u3002\u800c\u4e14\uff0cPika \u672c\u8eab\u4e5f\u8fd8\u5728\u8fed\u4ee3\u5f00\u53d1\u4e2d\uff0c\u6211\u4e5f\u5efa\u8bae\u4f60\u591a\u53bb\u770b\u770b GitHub\uff0c\u8fdb\u4e00\u6b65\u5730\u4e86\u89e3\u5b83\u3002 \u8fd9\u6837\uff0c\u4f60\u5c31\u53ef\u4ee5\u83b7\u5f97 Pika \u7684\u6700\u65b0\u8fdb\u5c55\uff0c\u4e5f\u80fd\u66f4\u597d\u5730\u628a\u5b83\u5e94\u7528\u5230\u4f60\u7684\u4e1a\u52a1\u5b9e\u8df5\u4e2d\u3002","title":"\u7b2c\u4e00\u8282 \u57fa\u4e8eSSD\u5b9e\u73b0\u5927\u5bb9\u91cfRedis:Pika"},{"location":"chap6/1redis_pika_ssd/#ssdredispika","text":"\u5e94\u7528 Redis \u65f6\uff0c\u968f\u7740\u4e1a\u52a1\u6570\u636e\u7684\u589e\u52a0\uff08\u6bd4\u5982\u8bf4\u7535\u5546\u4e1a\u52a1\u4e2d\uff0c\u968f\u7740\u7528\u6237\u89c4\u6a21\u548c\u5546\u54c1\u6570\u91cf\u7684\u589e\u52a0\uff09\uff0c\u5c31\u9700\u8981 Redis \u80fd\u4fdd\u5b58\u66f4\u591a\u7684\u6570\u636e\u3002\u4f60\u53ef\u80fd\u4f1a\u60f3\u5230\u4f7f\u7528 Redis \u5207\u7247\u96c6\u7fa4 \uff0c\u628a\u6570\u636e\u5206\u6563\u4fdd\u5b58\u5230\u591a\u4e2a\u5b9e\u4f8b\u4e0a\u3002\u4f46\u662f\u8fd9\u6837\u505a\u7684\u8bdd\uff0c\u4f1a\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5982\u679c\u8981\u4fdd\u5b58\u7684\u6570\u636e\u603b\u91cf\u5f88\u5927\uff0c \u4f46\u662f\u6bcf\u4e2a\u5b9e\u4f8b\u4fdd\u5b58\u7684\u6570\u636e\u91cf\u8f83\u5c0f\u7684\u8bdd\uff0c\u5c31\u4f1a\u5bfc\u81f4\u96c6\u7fa4\u7684\u5b9e\u4f8b\u89c4\u6a21\u589e\u52a0\uff0c\u8fd9\u4f1a\u8ba9\u96c6\u7fa4\u7684\u8fd0\u7ef4\u7ba1\u7406\u53d8\u5f97\u590d\u6742\uff0c\u589e\u52a0\u5f00\u9500 \u3002 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0 Redis \u5355\u5b9e\u4f8b\u7684\u5185\u5b58\u5bb9\u91cf\uff0c\u5f62\u6210\u5927\u5185\u5b58\u5b9e\u4f8b\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u53ef\u4ee5\u4fdd\u5b58\u66f4\u591a\u7684\u6570\u636e\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5728\u4fdd\u5b58\u76f8\u540c\u7684\u6570\u636e\u603b\u91cf\u65f6\uff0c\u6240\u9700\u8981\u7684\u5927\u5185\u5b58\u5b9e\u4f8b\u7684\u4e2a\u6570\u5c31\u4f1a\u51cf\u5c11\uff0c\u5c31\u53ef\u4ee5\u8282\u7701\u5f00\u9500\u3002 \u8fd9\u662f\u4e00\u4e2a\u597d\u4e3b\u610f\uff0c\u4f46\u8fd9\u4e5f\u5e76\u4e0d\u662f\u5b8c\u7f8e\u7684\u65b9\u6848\uff1a \u57fa\u4e8e\u5927\u5185\u5b58\u7684\u5927\u5bb9\u91cf\u5b9e\u4f8b\u5728\u5b9e\u4f8b\u6062\u590d\u3001\u4e3b\u4ece\u540c\u6b65\u8fc7\u7a0b\u4e2d\u4f1a\u5f15\u8d77\u4e00\u7cfb\u5217\u6f5c\u5728\u95ee\u9898\uff0c\u4f8b\u5982\u6062\u590d\u65f6\u95f4\u589e\u957f\u3001\u4e3b\u4ece\u5207\u6362\u5f00\u9500\u5927\u3001\u7f13\u51b2\u533a\u6613\u6ea2\u51fa\u3002 \u63a8\u8350\u4f60\u4f7f\u7528\u56fa\u6001\u786c\u76d8\uff08Solid State Drive\uff0cSSD\uff09\u3002\u5b83\u7684\u6210\u672c\u5f88\u4f4e\uff08\u6bcf GB \u7684\u6210\u672c\u7ea6\u662f\u5185\u5b58\u7684\u5341\u5206\u4e4b\u4e00\uff09\uff0c\u800c\u4e14\u5bb9\u91cf\u5927\uff0c\u8bfb\u5199\u901f\u5ea6\u5feb\uff0c\u6211\u4eec\u53ef\u4ee5\u57fa\u4e8e SSD \u6765\u5b9e\u73b0\u5927\u5bb9\u91cf\u7684 Redis \u5b9e\u4f8b\u3002360 \u516c\u53f8 DBA \u548c\u57fa\u7840\u67b6\u6784\u7ec4\u8054\u5408\u5f00\u53d1\u7684 Pika\u952e\u503c\u6570\u636e\u5e93 \uff0c\u6b63\u597d\u5b9e\u73b0\u4e86\u8fd9\u4e00\u9700\u6c42\u3002 Pika \u5728\u521a\u5f00\u59cb\u8bbe\u8ba1\u7684\u65f6\u5019\uff0c\u5c31\u6709\u4e24\u4e2a\u76ee\u6807\uff1a \u5355\u5b9e\u4f8b\u53ef\u4ee5\u4fdd\u5b58\u5927\u5bb9\u91cf\u6570\u636e\uff0c\u540c\u65f6\u907f\u514d\u4e86\u5b9e\u4f8b\u6062\u590d\u548c\u4e3b\u4ece\u540c\u6b65\u65f6\u7684\u6f5c\u5728\u95ee\u9898\uff1b \u548c Redis \u6570\u636e\u7c7b\u578b\u4fdd\u6301\u517c\u5bb9\uff0c\u53ef\u4ee5\u652f\u6301\u4f7f\u7528 Redis \u7684\u5e94\u7528\u5e73\u6ed1\u5730\u8fc1\u79fb\u5230 Pika \u4e0a \u3002\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u4e00\u76f4\u5728\u4f7f\u7528 Redis\uff0c\u5e76\u4e14\u60f3\u4f7f\u7528 SSD \u6765\u6269\u5c55\u5355\u5b9e\u4f8b\u5bb9\u91cf\uff0cPika \u5c31\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\u3002","title":"\u7b2c\u4e00\u8282 \u57fa\u4e8eSSD\u5b9e\u73b0\u5927\u5bb9\u91cfRedis:Pika"},{"location":"chap6/1redis_pika_ssd/#1-redis","text":"Redis \u4f7f\u7528\u5185\u5b58\u4fdd\u5b58\u6570\u636e\uff0c\u5185\u5b58\u5bb9\u91cf\u589e\u52a0\u540e\uff0c\u5c31\u4f1a\u5e26\u6765\u4e24\u65b9\u9762\u7684\u6f5c\u5728\u95ee\u9898\uff0c\u5206\u522b\u662f\uff0c \u5185\u5b58\u5feb\u7167 RDB \u751f\u6210\u548c\u6062\u590d\u6548\u7387\u4f4e\uff0c\u4ee5\u53ca\u4e3b\u4ece\u8282\u70b9\u5168\u91cf\u540c\u6b65\u65f6\u957f\u589e\u52a0\u3001\u7f13\u51b2\u533a\u6613\u6ea2\u51fa \u3002 \u5185\u5b58\u5927\u5c0f\u548c\u5185\u5b58\u5feb\u7167 RDB \u7684\u5173\u7cfb\u662f\u975e\u5e38\u76f4\u63a5\u7684\uff1a \u5b9e\u4f8b\u5185\u5b58\u5bb9\u91cf\u5927\uff0c RDB \u6587\u4ef6\u4e5f\u4f1a\u76f8\u5e94\u589e\u5927\uff0c\u90a3\u4e48\uff0cRDB \u6587\u4ef6\u751f\u6210\u65f6\u7684 fork \u65f6\u957f\u5c31\u4f1a\u589e\u52a0 \uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4 Redis \u5b9e\u4f8b\u963b\u585e\u3002 RDB \u6587\u4ef6\u589e\u5927\u540e\uff0c\u4f7f\u7528 RDB \u8fdb\u884c\u6062\u590d\u7684\u65f6\u957f\u4e5f\u4f1a\u589e\u52a0\uff0c\u4f1a\u5bfc\u81f4 Redis \u8f83\u957f\u65f6\u95f4\u65e0\u6cd5\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1 \u3002 \u4e3b\u4ece\u540c\u6b65\u53d7\u5230\u7684\u5f71\u54cd \u4e3b\u4ece\u8282\u70b9\u95f4\u7684\u540c\u6b65\u7684\u7b2c\u4e00\u6b65\u5c31\u662f\u8981\u505a\u5168\u91cf\u540c\u6b65\u3002 \u5168\u91cf\u540c\u6b65\u662f\u4e3b\u8282\u70b9\u751f\u6210 RDB \u6587\u4ef6\uff0c\u5e76\u4f20\u7ed9\u4ece\u8282\u70b9\uff0c\u4ece\u8282\u70b9\u518d\u8fdb\u884c\u52a0\u8f7d\u3002 \u8bd5\u60f3\u4e00\u4e0b\uff0c\u5982\u679c RDB \u6587\u4ef6\u5f88\u5927\uff0c\u80af\u5b9a\u4f1a\u5bfc\u81f4\u5168\u91cf\u540c\u6b65\u7684\u65f6\u957f\u589e\u52a0\uff0c\u6548\u7387\u4e0d\u9ad8\uff0c\u800c\u4e14\u8fd8\u53ef\u80fd\u4f1a\u5bfc\u81f4\u590d\u5236\u7f13\u51b2\u533a\u6ea2\u51fa\u3002\u4e00\u65e6\u7f13\u51b2\u533a\u6ea2\u51fa\u4e86\uff0c\u4e3b\u4ece\u8282\u70b9\u95f4\u5c31\u4f1a\u53c8\u5f00\u59cb\u5168\u91cf\u540c\u6b65\uff0c\u5f71\u54cd\u4e1a\u52a1\u5e94\u7528\u7684\u6b63\u5e38\u4f7f\u7528\u3002\u5982\u679c\u6211\u4eec\u589e\u52a0\u590d\u5236\u7f13\u51b2\u533a\u7684\u5bb9\u91cf\uff0c\u8fd9\u53c8\u4f1a\u6d88\u8017\u5b9d\u8d35\u7684\u5185\u5b58\u8d44\u6e90\u3002 \u6b64\u5916\uff0c\u5982\u679c\u4e3b\u5e93\u53d1\u751f\u4e86\u6545\u969c\uff0c\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\u540e\uff0c\u5176\u4ed6\u4ece\u5e93\u90fd\u9700\u8981\u548c\u65b0\u4e3b\u5e93\u8fdb\u884c\u4e00\u6b21\u5168\u91cf\u540c\u6b65 \u3002\u5982\u679c RDB \u6587\u4ef6\u5f88\u5927\uff0c\u4e5f\u4f1a\u5bfc\u81f4\u4e3b\u4ece\u5207\u6362\u7684\u8fc7\u7a0b\u8017\u65f6\u589e\u52a0\uff0c\u540c\u6837\u4f1a\u5f71\u54cd\u4e1a\u52a1\u7684\u53ef\u7528\u6027\u3002 Pika \u662f\u5982\u4f55\u89e3\u51b3\u8fd9\u4e24\u65b9\u9762\u7684\u95ee\u9898\u5462\uff1f Pika \u4e2d\u7684\u5173\u952e\u6a21\u5757 RocksDB\u3001binlog \u673a\u5236\u548c Nemo \u4e86\uff0c\u8fd9\u4e9b\u6a21\u5757\u90fd\u662f Pika \u67b6\u6784\u4e2d\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206\u3002","title":"1\u3001\u5927\u5185\u5b58 Redis \u5b9e\u4f8b\u7684\u6f5c\u5728\u95ee\u9898"},{"location":"chap6/1redis_pika_ssd/#2pika","text":"Pika \u952e\u503c\u6570\u636e\u5e93\u7684\u6574\u4f53\u67b6\u6784\u4e2d\u5305\u62ec\u4e86\u4e94\u90e8\u5206\uff0c \u5206\u522b\u662f\u7f51\u7edc\u6846\u67b6\u3001Pika \u7ebf\u7a0b\u6a21\u5757\u3001Nemo \u5b58\u50a8\u6a21\u5757\u3001RocksDB \u548c binlog \u673a\u5236 \uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u9996\u5148\uff0c\u7f51\u7edc\u6846\u67b6\u4e3b\u8981\u8d1f\u8d23\u5e95\u5c42\u7f51\u7edc\u8bf7\u6c42\u7684\u63a5\u6536\u548c\u53d1\u9001\u3002Pika \u7684\u7f51\u7edc\u6846\u67b6\u662f\u5bf9\u64cd\u4f5c\u7cfb\u7edf\u5e95\u5c42\u7684\u7f51\u7edc\u51fd\u6570\u8fdb\u884c\u4e86\u5c01\u88c5\u3002Pika \u5728\u8fdb\u884c\u7f51\u7edc\u901a\u4fe1\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u7f51\u7edc\u6846\u67b6\u5c01\u88c5\u597d\u7684\u51fd\u6570\u3002 \u5176\u6b21\uff0cPika \u7ebf\u7a0b\u6a21\u5757\u91c7\u7528\u4e86\u591a\u7ebf\u7a0b\u6a21\u578b\u6765\u5177\u4f53\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c \u5305\u62ec\u4e00\u4e2a\u8bf7\u6c42\u5206\u53d1\u7ebf\u7a0b\uff08DispatchThread\uff09\u3001\u4e00\u7ec4\u5de5\u4f5c\u7ebf\u7a0b\uff08WorkerThread\uff09\u4ee5\u53ca\u4e00\u4e2a\u7ebf\u7a0b\u6c60\uff08ThreadPool\uff09 \u3002 \u8bf7\u6c42\u5206\u53d1\u7ebf\u7a0b\u4e13\u95e8\u76d1\u542c\u7f51\u7edc\u7aef\u53e3\uff0c\u4e00\u65e6\u63a5\u6536\u5230\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u8bf7\u6c42\u540e\uff0c\u5c31\u548c\u5ba2\u6237\u7aef\u5efa\u7acb\u8fde\u63a5\uff0c\u5e76\u628a\u8fde\u63a5\u4ea4\u7531\u5de5\u4f5c\u7ebf\u7a0b\u5904\u7406\u3002 \u5de5\u4f5c\u7ebf\u7a0b\u8d1f\u8d23\u63a5\u6536\u5ba2\u6237\u7aef\u8fde\u63a5\u4e0a\u53d1\u9001\u7684\u5177\u4f53\u547d\u4ee4\u8bf7\u6c42\uff0c\u5e76\u628a\u547d\u4ee4\u8bf7\u6c42\u5c01\u88c5\u6210 Task\uff0c\u518d\u4ea4\u7ed9\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\uff0c\u7531\u8fd9\u4e9b\u7ebf\u7a0b\u8fdb\u884c\u5b9e\u9645\u7684\u6570\u636e\u5b58\u53d6\u5904\u7406\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u5728\u5b9e\u9645\u5e94\u7528 Pika \u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0\u5de5\u4f5c\u7ebf\u7a0b\u6570\u548c\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u6570\uff0c\u6765\u63d0\u5347 Pika \u7684\u8bf7\u6c42\u5904\u7406\u541e\u5410\u7387\uff0c\u8fdb\u800c\u6ee1\u8db3\u4e1a\u52a1\u5c42\u5bf9\u6570\u636e\u5904\u7406\u6027\u80fd\u7684\u9700\u6c42\u3002 Nemo \u6a21\u5757\u5f88\u5bb9\u6613\u7406\u89e3\uff0c\u5b83\u5b9e\u73b0\u4e86 Pika \u548c Redis \u7684\u6570\u636e\u7c7b\u578b\u517c\u5bb9\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5f53\u6211\u4eec\u628a Redis \u670d\u52a1\u8fc1\u79fb\u5230 Pika \u65f6\uff0c \u4e0d\u7528\u4fee\u6539\u4e1a\u52a1\u5e94\u7528\u4e2d\u64cd\u4f5c Redis \u7684\u4ee3\u7801\uff0c\u800c\u4e14\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u5e94\u7528\u8fd0\u7ef4 Redis \u7684\u7ecf\u9a8c\uff0c\u8fd9\u4f7f\u5f97 Pika \u7684\u5b66\u4e60\u6210\u672c\u5c31\u8f83\u4f4e\u3002 \u6700\u540e\uff0c\u6211\u4eec\u518d\u6765\u770b\u770b RocksDB \u63d0\u4f9b\u7684\u57fa\u4e8e SSD \u4fdd\u5b58\u6570\u636e\u7684\u529f\u80fd\u3002 \u5b83\u4f7f\u5f97 Pika \u53ef\u4ee5\u4e0d\u7528\u5927\u5bb9\u91cf\u7684\u5185\u5b58\uff0c\u5c31\u80fd\u4fdd\u5b58\u66f4\u591a\u6570\u636e\uff0c\u8fd8\u907f\u514d\u4e86\u4f7f\u7528\u5185\u5b58\u5feb\u7167\u3002\u800c\u4e14\uff0cPika \u4f7f\u7528 binlog \u673a\u5236\u8bb0\u5f55\u5199\u547d\u4ee4\uff0c\u7528\u4e8e\u4e3b\u4ece\u8282\u70b9\u7684\u547d\u4ee4\u540c\u6b65\uff0c\u907f\u514d\u4e86\u521a\u521a\u6240\u8bf4\u7684\u5927\u5185\u5b58\u5b9e\u4f8b\u5728\u4e3b\u4ece\u540c\u6b65\u8fc7\u7a0b\u4e2d\u7684\u6f5c\u5728\u95ee\u9898\u3002","title":"2\u3001Pika \u7684\u6574\u4f53\u67b6\u6784"},{"location":"chap6/1redis_pika_ssd/#3pika-ssd","text":"\u4e3a\u4e86\u628a\u6570\u636e\u4fdd\u5b58\u5230 SSD\uff0cPika \u4f7f\u7528\u4e86\u4e1a\u754c\u5e7f\u6cdb\u5e94\u7528\u7684\u6301\u4e45\u5316 \u952e\u503c\u6570\u636e\u5e93RocksDB \u3002 \u4e0b\u9762\u6211\u6765\u89e3\u91ca\u4e0b\u8fd9\u4e2a\u57fa\u672c\u8bfb\u5199\u673a\u5236\u3002\u6765\u7ed9\u4f60\u5177\u4f53\u4ecb\u7ecd\u4e0b RocksDB \u5199\u5165\u6570\u636e\u7684\u57fa\u672c\u6d41\u7a0b \u5f53 Pika \u9700\u8981\u4fdd\u5b58\u6570\u636e\u65f6\uff0cRocksDB \u4f1a\u4f7f\u7528\u4e24\u5c0f\u5757\u5185\u5b58\u7a7a\u95f4\uff08Memtable1 \u548c Memtable2\uff09\u6765\u4ea4\u66ff\u7f13\u5b58\u5199\u5165\u7684\u6570\u636e\u3002 Memtable \u7684\u5927\u5c0f\u53ef\u4ee5\u8bbe\u7f6e\uff0c \u4e00\u4e2a Memtable \u7684\u5927\u5c0f\u4e00\u822c\u4e3a\u51e0 MB \u6216\u51e0\u5341 MB \u3002 \u5f53\u6709\u6570\u636e\u8981\u5199\u5165 RocksDB \u65f6\uff0cRocksDB \u4f1a\u5148\u628a\u6570\u636e\u5199\u5165\u5230 Memtable1\u3002 \u7b49\u5230 Memtable1 \u5199\u6ee1\u540e\uff0cRocksDB \u518d\u628a\u6570\u636e\u4ee5\u6587\u4ef6\u7684\u5f62\u5f0f\uff0c\u5feb\u901f\u5199\u5165\u5e95\u5c42\u7684 SSD\u3002 \u540c\u65f6\uff0cRocksDB \u4f1a\u4f7f\u7528 Memtable2 \u6765\u4ee3\u66ff Memtable1\uff0c\u7f13\u5b58\u65b0\u5199\u5165\u7684\u6570\u636e\u3002 \u7b49\u5230 Memtable1 \u7684\u6570\u636e\u90fd\u5199\u5165 SSD \u4e86\uff0cRocksDB \u4f1a\u5728 Memtable2 \u5199\u6ee1\u540e\uff0c\u518d\u7528 Memtable1 \u7f13\u5b58\u65b0\u5199\u5165\u7684\u6570\u636e\u3002 RocksDB \u4f1a\u5148\u7528 Memtable \u7f13\u5b58\u6570\u636e\uff0c\u518d\u5c06\u6570\u636e\u5feb\u901f\u5199\u5165 SSD\uff0c\u5373\u4f7f\u6570\u636e\u91cf\u518d\u5927\uff0c\u6240\u6709\u6570\u636e\u4e5f\u90fd\u80fd\u4fdd\u5b58\u5230 SSD \u4e2d\u3002 \u800c\u4e14\uff0c Memtable \u672c\u8eab\u5bb9\u91cf\u4e0d\u5927\uff0c\u5373\u4f7f RocksDB \u4f7f\u7528\u4e86\u4e24\u4e2a Memtable\uff0c\u4e5f\u4e0d\u4f1a\u5360\u7528\u8fc7\u591a\u7684\u5185\u5b58\uff0c\u8fd9\u6837\u4e00\u6765\uff0cPika \u5728\u4fdd\u5b58\u5927\u5bb9\u91cf\u6570\u636e\u65f6\uff0c\u4e5f\u4e0d\u7528\u5360\u636e\u592a\u5927\u7684\u5185\u5b58\u7a7a\u95f4\u4e86\u3002 \u5f53 Pika \u9700\u8981\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\uff0cRocksDB \u4f1a\u5148\u5728 Memtable \u4e2d\u67e5\u8be2\u662f\u5426\u6709\u8981\u8bfb\u53d6\u7684\u6570\u636e\u3002\u8fd9\u662f\u56e0\u4e3a\uff0c\u6700\u65b0\u7684\u6570\u636e\u90fd\u662f\u5148\u5199\u5165\u5230 Memtable \u4e2d\u7684\u3002 \u5982\u679c Memtable \u4e2d\u6ca1\u6709\u8981\u8bfb\u53d6\u7684\u6570\u636e\uff0cRocksDB \u4f1a\u518d\u67e5\u8be2\u4fdd\u5b58\u5728 SSD \u4e0a\u7684\u6570\u636e\u6587\u4ef6\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u5f53\u4f7f\u7528\u4e86 RocksDB \u4fdd\u5b58\u6570\u636e\u540e\uff0cPika \u5c31\u53ef\u4ee5\u628a\u5927\u91cf\u6570\u636e\u4fdd\u5b58\u5230\u5927\u5bb9\u91cf\u7684 SSD \u4e0a\u4e86\uff0c\u5b9e\u73b0\u4e86\u5927\u5bb9\u91cf\u5b9e\u4f8b\u3002 \u4e0d\u8fc7\uff0c\u6211\u521a\u624d\u5411\u4f60\u4ecb\u7ecd\u8fc7\uff0c\u5f53\u4f7f\u7528\u5927\u5185\u5b58\u5b9e\u4f8b\u4fdd\u5b58\u5927\u91cf\u6570\u636e\u65f6\uff0c Redis \u4f1a\u9762\u4e34 RDB \u751f\u6210\u548c\u6062\u590d\u7684\u6548\u7387\u95ee\u9898\uff0c\u4ee5\u53ca\u4e3b\u4ece\u540c\u6b65\u65f6\u7684\u6548\u7387\u548c\u7f13\u51b2\u533a\u6ea2\u51fa\u95ee\u9898\u3002\u90a3\u4e48\uff0c\u5f53 Pika \u4fdd\u5b58\u5927\u91cf\u6570\u636e\u65f6\uff0c\u8fd8\u4f1a\u9762\u4e34\u76f8\u540c\u7684\u95ee\u9898\u5417\uff1f \u5176\u5b9e\u4e0d\u4f1a\u4e86 \u4e00\u65b9\u9762\uff0cPika \u57fa\u4e8e RocksDB \u4fdd\u5b58\u4e86\u6570\u636e\u6587\u4ef6\uff0c\u76f4\u63a5\u8bfb\u53d6\u6570\u636e\u6587\u4ef6\u5c31\u80fd\u6062\u590d\uff0c\u4e0d\u9700\u8981\u518d\u901a\u8fc7\u5185\u5b58\u5feb\u7167\u8fdb\u884c\u6062\u590d\u4e86\u3002\u800c\u4e14\uff0cPika \u4ece\u5e93\u5728\u8fdb\u884c\u5168\u91cf\u540c\u6b65\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ece\u4e3b\u5e93\u62f7\u8d1d\u6570\u636e\u6587\u4ef6\uff0c\u4e0d\u9700\u8981\u4f7f\u7528\u5185\u5b58\u5feb\u7167\uff0c\u8fd9\u6837\u4e00\u6765\uff0cPika \u5c31\u907f\u514d\u4e86\u5927\u5185\u5b58\u5feb\u7167\u751f\u6210\u6548\u7387\u4f4e\u7684\u95ee\u9898\u3002 \u53e6\u4e00\u65b9\u9762\uff0cPika \u4f7f\u7528\u4e86 binlog \u673a\u5236\u5b9e\u73b0\u589e\u91cf\u547d\u4ee4\u540c\u6b65\uff0c\u65e2\u8282\u7701\u4e86\u5185\u5b58\uff0c\u8fd8\u907f\u514d\u4e86\u7f13\u51b2\u533a\u6ea2\u51fa\u7684\u95ee\u9898\u3002binlog \u662f\u4fdd\u5b58\u5728 SSD \u4e0a\u7684\u6587\u4ef6\uff0cPika \u63a5\u6536\u5230\u5199\u547d\u4ee4\u540e\uff0c\u5728\u628a\u6570\u636e\u5199\u5165 Memtable \u65f6\uff0c\u4e5f\u4f1a\u628a\u547d\u4ee4\u64cd\u4f5c\u5199\u5230 binlog \u6587\u4ef6\u4e2d\u3002 \u548c Redis \u7c7b\u4f3c\uff0c\u5f53\u5168\u91cf\u540c\u6b65\u7ed3\u675f\u540e\uff0c\u4ece\u5e93\u4f1a\u4ece binlog \u4e2d\u628a\u5c1a\u672a\u540c\u6b65\u7684\u547d\u4ee4\u8bfb\u53d6\u8fc7\u6765\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u548c\u4e3b\u5e93\u7684\u6570\u636e\u4fdd\u6301\u4e00\u81f4\u3002\u5f53\u8fdb\u884c\u589e\u91cf\u540c\u6b65\u65f6\uff0c\u4ece\u5e93\u4e5f\u662f\u628a\u81ea\u5df1\u5df2\u7ecf\u590d\u5236\u7684\u504f\u79fb\u91cf\u53d1\u7ed9\u4e3b\u5e93\uff0c\u4e3b\u5e93\u628a\u5c1a\u672a\u540c\u6b65\u7684\u547d\u4ee4\u53d1\u7ed9\u4ece\u5e93\uff0c\u6765\u4fdd\u6301\u4e3b\u4ece\u5e93\u7684\u6570\u636e\u4e00\u81f4\u3002 \u548c Redis \u4f7f\u7528\u7f13\u51b2\u533a\u76f8\u6bd4\uff0c\u4f7f\u7528 binlog \u597d\u5904\u662f\u975e\u5e38\u660e\u663e\u7684\uff1a binlog \u662f\u4fdd\u5b58\u5728 SSD \u4e0a\u7684\u6587\u4ef6\uff0c\u6587\u4ef6\u5927\u5c0f\u4e0d\u50cf\u7f13\u51b2\u533a\uff0c\u4f1a\u53d7\u5230\u5185\u5b58\u5bb9\u91cf\u7684\u8f83\u591a\u9650\u5236\u3002 \u800c\u4e14\uff0c\u5f53 binlog \u6587\u4ef6\u589e\u5927\u540e\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u8f6e\u66ff\u64cd\u4f5c\uff0c\u751f\u6210\u65b0\u7684 binlog \u6587\u4ef6\uff0c\u518d\u628a\u65e7\u7684 binlog \u6587\u4ef6\u72ec\u7acb\u4fdd\u5b58\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f Pika \u5b9e\u4f8b\u4fdd\u5b58\u4e86\u5927\u91cf\u7684\u6570\u636e\uff0c\u5728\u540c\u6b65\u8fc7\u7a0b\u4e2d\u4e5f\u4e0d\u4f1a\u51fa\u73b0\u7f13\u51b2\u533a\u6ea2\u51fa\u7684\u95ee\u9898\u4e86\u3002 Pika \u4f7f\u7528 RocksDB \u628a\u5927\u91cf\u6570\u636e\u4fdd\u5b58\u5230\u4e86 SSD\uff0c\u540c\u65f6\u907f\u514d\u4e86\u5185\u5b58\u5feb\u7167\u7684\u751f\u6210\u548c\u6062\u590d\u95ee\u9898\u3002\u800c\u4e14\uff0cPika \u4f7f\u7528 binlog \u673a\u5236\u8fdb\u884c\u4e3b\u4ece\u540c\u6b65\uff0c\u907f\u514d\u5927\u5185\u5b58\u65f6\u7684\u5f71\u54cd\uff0cPika \u7684\u7b2c\u4e00\u4e2a\u8bbe\u8ba1\u76ee\u6807\u5c31\u5b9e\u73b0\u4e86\u3002","title":"3\u3001Pika \u5982\u4f55\u57fa\u4e8e SSD \u4fdd\u5b58\u66f4\u591a\u6570\u636e\uff1f"},{"location":"chap6/1redis_pika_ssd/#2pika-redis","text":"Pika \u7684\u5e95\u5c42\u5b58\u50a8\u4f7f\u7528\u4e86 RocksDB \u6765\u4fdd\u5b58\u6570\u636e\uff0c\u4f46\u662f\uff0c RocksDB \u53ea\u63d0\u4f9b\u4e86\u5355\u503c\u7684\u952e\u503c\u5bf9\u7c7b\u578b\uff0cRocksDB \u952e\u503c\u5bf9\u4e2d\u7684\u503c\u5c31\u662f\u5355\u4e2a\u503c\uff0c\u800c Redis \u952e\u503c\u5bf9\u4e2d\u7684\u503c\u8fd8\u53ef\u4ee5\u662f\u96c6\u5408\u7c7b\u578b \u3002 \u5bf9\u4e8e Redis \u7684 String \u7c7b\u578b\u6765\u8bf4\uff0c\u5b83\u672c\u8eab\u5c31\u662f\u5355\u503c\u7684\u952e\u503c\u5bf9\uff0c\u6211\u4eec\u76f4\u63a5\u7528 RocksDB \u4fdd\u5b58\u5c31\u884c\u3002\u4f46\u662f\uff0c\u5bf9\u4e8e\u96c6\u5408\u7c7b\u578b\u6765\u8bf4\uff0c\u6211\u4eec\u5c31\u65e0\u6cd5\u76f4\u63a5\u628a\u96c6\u5408\u4fdd\u5b58\u4e3a\u5355\u503c\u7684\u952e\u503c\u5bf9\uff0c\u800c\u662f\u9700\u8981\u8fdb\u884c\u8f6c\u6362\u64cd\u4f5c\u3002 \u4e3a\u4e86\u4fdd\u6301\u548c Redis \u7684\u517c\u5bb9\u6027\uff0c Pika \u7684 Nemo \u6a21\u5757\u5c31\u8d1f\u8d23\u628a Redis \u7684\u96c6\u5408\u7c7b\u578b\u8f6c\u6362\u6210\u5355\u503c\u7684\u952e\u503c\u5bf9\u3002 \u7b80\u5355\u6765\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u628a Redis \u7684\u96c6\u5408\u7c7b\u578b\u5206\u6210\u4e24\u7c7b\uff1a \u4e00\u7c7b\u662f List \u548c Set \u7c7b\u578b\uff0c\u5b83\u4eec\u7684\u96c6\u5408\u4e2d\u4e5f\u53ea\u6709\u5355\u503c\uff1b \u53e6\u4e00\u7c7b\u662f Hash \u548c Sorted Set \u7c7b\u578b\uff0c\u5b83\u4eec\u7684\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u662f\u6210\u5bf9\u7684\uff0c\u5176\u4e2d\uff0cHash \u96c6\u5408\u5143\u7d20\u662f field-value \u7c7b\u578b\uff0c\u800c Sorted Set \u96c6\u5408\u5143\u7d20\u662f member-score \u7c7b\u578b \u3002 Nemo \u6a21\u5757\u901a\u8fc7\u8f6c\u6362\u64cd\u4f5c\uff0c\u628a\u8fd9 4 \u79cd\u96c6\u5408\u7c7b\u578b\u7684\u5143\u7d20\u8868\u793a\u4e3a\u5355\u503c\u7684\u952e\u503c\u5bf9\u3002\u5177\u4f53\u600e\u4e48\u8f6c\u6362\u5462\uff1f \u9996\u5148\u6211\u4eec\u6765\u770b List \u7c7b\u578b\u3002 \u5728 Pika \u4e2d\uff0cList \u96c6\u5408\u7684 key \u88ab\u5d4c\u5165\u5230\u4e86\u5355\u503c\u952e\u503c\u5bf9\u7684\u952e\u5f53\u4e2d\uff0c\u7528 key \u5b57\u6bb5\u8868\u793a\uff1b \u800c List \u96c6\u5408\u7684\u5143\u7d20\u503c\uff0c\u5219\u88ab\u5d4c\u5165\u5230\u5355\u503c\u952e\u503c\u5bf9\u7684\u503c\u5f53\u4e2d\uff0c\u7528 value \u5b57\u6bb5\u8868\u793a\u3002 \u56e0\u4e3a List \u96c6\u5408\u4e2d\u7684\u5143\u7d20\u662f\u6709\u5e8f\u7684\uff0c\u6240\u4ee5\uff0cNemo \u6a21\u5757\u8fd8\u5728\u5355\u503c\u952e\u503c\u5bf9\u7684 key \u540e\u9762\u589e\u52a0\u4e86 sequence \u5b57\u6bb5\uff0c\u8868\u793a\u5f53\u524d\u5143\u7d20\u5728 List \u4e2d\u7684\u987a\u5e8f\uff0c\u540c\u65f6\uff0c\u8fd8\u5728 value \u7684\u524d\u9762\u589e\u52a0\u4e86 previous sequence \u548c next sequence \u8fd9\u4e24\u4e2a\u5b57\u6bb5\uff0c\u5206\u522b\u8868\u793a\u5f53\u524d\u5143\u7d20\u7684\u524d\u4e00\u4e2a\u5143\u7d20\u548c\u540e\u4e00\u4e2a\u5143\u7d20\u3002 \u6b64\u5916\uff0c\u5728\u5355\u503c\u952e\u503c\u5bf9\u7684 key \u524d\u9762\uff0cNemo \u6a21\u5757\u8fd8\u589e\u52a0\u4e86\u4e00\u4e2a\u503c\u201cl\u201d\uff0c\u8868\u793a\u5f53\u524d\u6570\u636e\u662f List \u7c7b\u578b\uff0c\u4ee5\u53ca\u589e\u52a0\u4e86\u4e00\u4e2a 1 \u5b57\u8282\u7684 size \u5b57\u6bb5\uff0c\u8868\u793a List \u96c6\u5408 key \u7684\u5927\u5c0f\u3002 \u5728\u5355\u503c\u952e\u503c\u5bf9\u7684 value \u540e\u9762\uff0cNemo \u6a21\u5757\u8fd8\u589e\u52a0\u4e86 version \u548c ttl \u5b57\u6bb5\uff0c\u5206\u522b\u8868\u793a\u5f53\u524d\u6570\u636e\u7684\u7248\u672c\u53f7\u548c\u5269\u4f59\u5b58\u6d3b\u65f6\u95f4\uff08\u7528\u6765\u652f\u6301\u8fc7\u671f key \u529f\u80fd\uff09\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a Set \u96c6\u5408 Set \u96c6\u5408\u7684 key \u548c\u5143\u7d20 member \u503c\uff0c\u90fd\u88ab\u5d4c\u5165\u5230\u4e86 Pika \u5355\u503c\u952e\u503c\u5bf9\u7684\u952e\u5f53\u4e2d\uff0c\u5206\u522b\u7528 key \u548c member \u5b57\u6bb5\u8868\u793a\u3002 \u540c\u65f6\uff0c\u548c List \u96c6\u5408\u7c7b\u4f3c\uff0c\u5355\u503c\u952e\u503c\u5bf9\u7684 key \u524d\u9762\u6709\u503c\u201cs\u201d\uff0c\u7528\u6765\u8868\u793a\u6570\u636e\u662f Set \u7c7b\u578b\uff0c\u540c\u65f6\u8fd8\u6709 size \u5b57\u6bb5\uff0c\u7528\u6765\u8868\u793a key \u7684\u5927\u5c0f\u3002Pika \u5355\u503c\u952e\u503c\u5bf9\u7684\u503c\u53ea\u4fdd\u5b58\u4e86\u6570\u636e\u7684\u7248\u672c\u4fe1\u606f\u548c\u5269\u4f59\u5b58\u6d3b\u65f6\u95f4\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u5bf9\u4e8e Hash \u7c7b\u578b\u6765\u8bf4\uff0cHash \u96c6\u5408\u7684 key \u88ab\u5d4c\u5165\u5230\u5355\u503c\u952e\u503c\u5bf9\u7684\u952e\u5f53\u4e2d\uff0c\u7528 key \u5b57\u6bb5\u8868\u793a\uff0c\u800c Hash \u96c6\u5408\u5143\u7d20\u7684 field \u4e5f\u88ab\u5d4c\u5165\u5230\u5355\u503c\u952e\u503c\u5bf9\u7684\u952e\u5f53\u4e2d\uff0c\u7d27\u63a5\u7740 key \u5b57\u6bb5\uff0c\u7528 field \u5b57\u6bb5\u8868\u793a\u3002 Hash \u96c6\u5408\u5143\u7d20\u7684 value \u5219\u662f\u5d4c\u5165\u5230\u5355\u503c\u952e\u503c\u5bf9\u7684\u503c\u5f53\u4e2d\uff0c\u5e76\u4e14\u4e5f\u5e26\u6709\u7248\u672c\u4fe1\u606f\u548c\u5269\u4f59\u5b58\u6d3b\u65f6\u95f4\uff0c \u5982\u4e0b\u56fe\u6240\u793a\uff1a \u6700\u540e\uff0c\u5bf9\u4e8e Sorted Set \u7c7b\u578b\u6765\u8bf4\uff0c\u8be5\u7c7b\u578b\u662f\u9700\u8981\u80fd\u591f\u6309\u7167\u96c6\u5408\u5143\u7d20\u7684 score \u503c\u6392\u5e8f\u7684\uff0c\u800c RocksDB \u53ea\u652f\u6301\u6309\u7167\u5355\u503c\u952e\u503c\u5bf9\u7684\u952e\u6765\u6392\u5e8f\u3002 \u6240\u4ee5\uff0cNemo \u6a21\u5757\u5728\u8f6c\u6362\u6570\u636e\u65f6\uff0c\u5c31\u628a Sorted Set \u96c6\u5408 key\u3001\u5143\u7d20\u7684 score \u548c member \u503c\u90fd\u5d4c\u5165\u5230\u4e86\u5355\u503c\u952e\u503c\u5bf9\u7684\u952e\u5f53\u4e2d \uff0c\u6b64\u65f6\uff0c\u5355\u503c\u952e\u503c\u5bf9\u4e2d\u7684\u503c\u53ea\u4fdd\u5b58\u4e86\u6570\u636e\u7684\u7248\u672c\u4fe1\u606f\u548c\u5269\u4f59\u5b58\u6d3b\u65f6\u95f4\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u91c7\u7528\u4e86\u4e0a\u9762\u7684\u8f6c\u6362\u65b9\u5f0f\u4e4b\u540e\uff0c Pika \u4e0d\u4ec5\u80fd\u517c\u5bb9\u652f\u6301 Redis \u7684\u6570\u636e\u7c7b\u578b\uff0c\u800c\u4e14\u8fd8\u4fdd\u7559\u4e86\u8fd9\u4e9b\u6570\u636e\u7c7b\u578b\u7684\u7279\u5f81\uff0c\u4f8b\u5982 List \u7684\u5143\u7d20\u4fdd\u5e8f\u3001Sorted Set \u7684\u5143\u7d20\u6309 score \u6392\u5e8f \u3002 \u4e86\u89e3\u4e86 Pika \u7684\u8f6c\u6362\u673a\u5236\u540e\uff0c\u4f60\u5c31\u4f1a\u660e\u767d\uff0c\u5982\u679c\u4f60\u6709\u4e1a\u52a1\u5e94\u7528\u8ba1\u5212\u4ece\u4f7f\u7528 Redis \u5207\u6362\u5230\u4f7f\u7528 Pika\uff0c\u5c31\u4e0d\u7528\u62c5\u5fc3\u9762\u4e34\u56e0\u4e3a\u64cd\u4f5c\u63a5\u53e3\u4e0d\u517c\u5bb9\u800c\u8981\u4fee\u6539\u4e1a\u52a1\u5e94\u7528\u7684\u95ee\u9898\u4e86\u3002","title":"2\u3001Pika \u5982\u4f55\u5b9e\u73b0 Redis \u6570\u636e\u7c7b\u578b\u517c\u5bb9\uff1f"},{"location":"chap6/1redis_pika_ssd/#3pika","text":"\u8ddf Redis \u76f8\u6bd4\uff0cPika \u6700\u5927\u7684\u7279\u70b9\u5c31\u662f\u4f7f\u7528\u4e86 SSD \u6765\u4fdd\u5b58\u6570\u636e\uff0c\u8fd9\u4e2a\u7279\u70b9\u80fd\u5e26\u6765\u7684\u6700\u76f4\u63a5\u597d\u5904\u5c31\u662f\uff0cPika \u5355\u5b9e\u4f8b\u80fd\u4fdd\u5b58\u66f4\u591a\u7684\u6570\u636e\u4e86\uff0c\u5b9e\u73b0\u4e86\u5b9e\u4f8b\u6570\u636e\u6269\u5bb9\u3002 \u9664\u6b64\u4e4b\u5916\uff0cPika \u4f7f\u7528 SSD \u6765\u4fdd\u5b58\u6570\u636e\uff0c\u8fd8\u6709\u989d\u5916\u7684\u4e24\u4e2a\u4f18\u52bf\u3002 \u9996\u5148\uff0c \u5b9e\u4f8b\u91cd\u542f\u5feb\u3002Pika \u7684\u6570\u636e\u5728\u5199\u5165\u6570\u636e\u5e93\u65f6\uff0c\u662f\u4f1a\u4fdd\u5b58\u5230 SSD \u4e0a\u7684 \u3002\u5f53 Pika \u5b9e\u4f8b\u91cd\u542f\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ece SSD \u4e0a\u7684\u6570\u636e\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c \u4e0d\u9700\u8981\u50cf Redis \u4e00\u6837\uff0c\u4ece RDB \u6587\u4ef6\u5168\u90e8\u91cd\u65b0\u52a0\u8f7d\u6570\u636e\u6216\u662f\u4ece AOF \u6587\u4ef6\u4e2d\u5168\u90e8\u56de\u653e\u64cd\u4f5c \uff0c\u8fd9\u6781\u5927\u5730\u63d0\u9ad8\u4e86 Pika \u5b9e\u4f8b\u7684\u91cd\u542f\u901f\u5ea6\uff0c\u53ef\u4ee5\u5feb\u901f\u5904\u7406\u4e1a\u52a1\u5e94\u7528\u8bf7\u6c42\u3002 \u53e6\u5916\uff0c\u4e3b\u4ece\u5e93\u91cd\u65b0\u6267\u884c\u5168\u91cf\u540c\u6b65\u7684\u98ce\u9669\u4f4e \u3002 Pika \u901a\u8fc7 binlog \u673a\u5236\u5b9e\u73b0\u5199\u547d\u4ee4\u7684\u589e\u91cf\u540c\u6b65\uff0c\u4e0d\u518d\u53d7\u5185\u5b58\u7f13\u51b2\u533a\u5927\u5c0f\u7684\u9650\u5236\uff0c\u6240\u4ee5\uff0c\u5373\u4f7f\u5728\u6570\u636e\u91cf\u5f88\u5927\u5bfc\u81f4\u4e3b\u4ece\u5e93\u540c\u6b65\u8017\u65f6\u5f88\u957f\u7684\u60c5\u51b5\u4e0b\uff0cPika \u4e5f\u4e0d\u7528\u62c5\u5fc3\u7f13\u51b2\u533a\u6ea2\u51fa\u800c\u89e6\u53d1\u7684\u4e3b\u4ece\u5e93\u91cd\u65b0\u5168\u91cf\u540c\u6b65 \u3002 Pika \u4e5f\u6709\u81ea\u8eab\u7684\u4e00\u4e9b\u4e0d\u8db3\u3002 \u867d\u7136\u5b83\u4fdd\u6301\u4e86 Redis \u64cd\u4f5c\u63a5\u53e3\uff0c\u4e5f\u80fd\u5b9e\u73b0\u6570\u636e\u5e93\u6269\u5bb9\uff0c\u4f46\u662f\uff0c\u5f53\u628a\u6570\u636e\u4fdd\u5b58\u5230 SSD \u4e0a\u540e\uff0c\u4f1a\u964d\u4f4e\u6570\u636e\u7684\u8bbf\u95ee\u6027\u80fd\u3002 \u8fd9\u662f\u56e0\u4e3a\uff0c\u6570\u636e\u64cd\u4f5c\u6bd5\u7adf\u4e0d\u80fd\u5728\u5185\u5b58\u4e2d\u76f4\u63a5\u6267\u884c\u4e86\uff0c\u800c\u662f\u8981\u5728\u5e95\u5c42\u7684 SSD \u4e2d\u8fdb\u884c\u5b58\u53d6\uff0c\u8fd9\u80af\u5b9a\u4f1a\u5f71\u54cd\uff0cPika \u7684\u6027\u80fd\u3002\u800c\u4e14\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u628a binlog \u673a\u5236\u8bb0\u5f55\u7684\u5199\u547d\u4ee4\u540c\u6b65\u5230 SSD \u4e0a\uff0c\u8fd9\u4f1a\u964d\u4f4e Pika \u7684\u5199\u6027\u80fd\u3002 \u4e0d\u8fc7\uff0cPika \u7684\u591a\u7ebf\u7a0b\u6a21\u578b\uff0c\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528\u591a\u4e2a\u7ebf\u7a0b\u8fdb\u884c\u6570\u636e\u8bfb\u5199\uff0c\u8fd9\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u5f25\u8865\u4e86\u4ece SSD \u5b58\u53d6\u6570\u636e\u9020\u6210\u7684\u6027\u80fd\u635f\u5931\u3002 \u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u9ad8\u914d\u7684 SSD \u6765\u63d0\u5347\u8bbf\u95ee\u6027\u80fd\uff0c\u8fdb\u800c\u51cf\u5c11\u8bfb\u5199 SSD \u5bf9 Pika \u6027\u80fd\u7684\u5f71\u54cd\u3002 \u8fd9\u4e9b\u6570\u636e\u662f\u5728 Pika 3.2 \u7248\u672c\u4e2d\uff0cString \u548c Hash \u7c7b\u578b\u5728\u591a\u7ebf\u7a0b\u60c5\u51b5\u4e0b\u7684\u57fa\u672c\u64cd\u4f5c\u6027\u80fd\u7ed3\u679c\u3002 \u4ece\u8868\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u5728 \u4e0d\u5199 binlog \u65f6\uff0cPika \u7684 SET/GET\u3001HSET/HGET \u7684\u6027\u80fd\u90fd\u80fd\u8fbe\u5230 200K OPS \u4ee5\u4e0a\uff0c\u800c\u4e00\u65e6\u589e\u52a0\u4e86\u5199 binlog \u64cd\u4f5c\uff0cSET \u548c HSET \u64cd\u4f5c\u6027\u80fd\u5927\u7ea6\u4e0b\u964d\u4e86 41%\uff0c\u53ea\u6709\u7ea6 120K OPS\u3002 \u4f7f\u7528 Pika \u65f6\uff0c\u9700\u8981\u5728\u5355\u5b9e\u4f8b\u6269\u5bb9\u7684\u5fc5\u8981\u6027\u548c\u53ef\u80fd\u7684\u6027\u80fd\u635f\u5931\u95f4\u505a\u4e2a\u6743\u8861","title":"3\u3001Pika \u7684\u5176\u4ed6\u4f18\u52bf\u4e0e\u4e0d\u8db3"},{"location":"chap6/1redis_pika_ssd/#4","text":"\u8ddf Redis \u76f8\u6bd4\uff0cPika \u7684\u597d\u5904\u975e\u5e38\u660e\u663e\uff1a\u65e2\u652f\u6301 Redis \u64cd\u4f5c\u63a5\u53e3\uff0c\u53c8\u80fd\u652f\u6301\u4fdd\u5b58\u5927\u5bb9\u91cf\u7684\u6570\u636e\u3002 \u5982\u679c\u4f60\u539f\u6765\u5c31\u5728\u5e94\u7528 Redis\uff0c\u73b0\u5728\u60f3\u8fdb\u884c\u6269\u5bb9\uff0c\u90a3\u4e48\uff0cPika \u65e0\u7591\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\uff0c\u65e0\u8bba\u662f\u4ee3\u7801\u8fc1\u79fb\u8fd8\u662f\u8fd0\u7ef4\u7ba1\u7406\uff0cPika \u57fa\u672c\u4e0d\u9700\u8981\u989d\u5916\u7684\u5de5\u4f5c\u91cf\u3002 \u4e0d\u8fc7\uff0cPika \u6bd5\u7adf\u662f\u628a\u6570\u636e\u4fdd\u5b58\u5230\u4e86 SSD \u4e0a\uff0c\u6570\u636e\u8bbf\u95ee\u8981\u8bfb\u5199 SSD\uff0c\u6240\u4ee5\uff0c\u8bfb\u5199\u6027\u80fd\u8981\u5f31\u4e8e Redis\u3002\u9488\u5bf9\u8fd9\u4e00\u70b9\uff0c\u6211\u7ed9\u4f60\u63d0\u4f9b\u4e24\u4e2a\u964d\u4f4e\u8bfb\u5199 SSD \u5bf9 Pika \u7684\u6027\u80fd\u5f71\u54cd\u7684\u5c0f\u5efa\u8bae\uff1a \u5229\u7528 Pika \u7684\u591a\u7ebf\u7a0b\u6a21\u578b\uff0c\u589e\u52a0\u7ebf\u7a0b\u6570\u91cf\uff0c\u63d0\u5347 Pika \u7684\u5e76\u53d1\u8bf7\u6c42\u5904\u7406\u80fd\u529b\uff1b \u4e3a Pika \u914d\u7f6e\u9ad8\u914d\u7684 SSD\uff0c\u63d0\u5347 SSD \u81ea\u8eab\u7684\u8bbf\u95ee\u6027\u80fd\u3002 Pika \u672c\u8eab\u63d0\u4f9b\u4e86\u5f88\u591a\u5de5\u5177\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u628a Redis \u6570\u636e\u8fc1\u79fb\u5230 Pika\uff0c\u6216\u8005\u662f\u628a Redis \u8bf7\u6c42\u8f6c\u53d1\u7ed9 Pika\u3002\u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u4f7f\u7528 aof_to_pika \u547d\u4ee4\uff0c\u5e76\u4e14\u6307\u5b9a Redis \u7684 AOF \u6587\u4ef6\u4ee5\u53ca Pika \u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u5c31\u53ef\u4ee5\u628a Redis \u6570\u636e\u8fc1\u79fb\u5230 Pika \u4e2d\u4e86\uff0c\u5982\u4e0b\u6240\u793a\uff1a aof_to_pika -i [Redis AOF\u6587\u4ef6] -h [Pika IP] -p [Pika port] -a [\u8ba4\u8bc1\u4fe1\u606f] \u4f60\u90fd\u53ef\u4ee5\u76f4\u63a5\u5728 Pika \u7684 GitHub \u4e0a\u627e\u5230\u3002\u800c\u4e14\uff0cPika \u672c\u8eab\u4e5f\u8fd8\u5728\u8fed\u4ee3\u5f00\u53d1\u4e2d\uff0c\u6211\u4e5f\u5efa\u8bae\u4f60\u591a\u53bb\u770b\u770b GitHub\uff0c\u8fdb\u4e00\u6b65\u5730\u4e86\u89e3\u5b83\u3002 \u8fd9\u6837\uff0c\u4f60\u5c31\u53ef\u4ee5\u83b7\u5f97 Pika \u7684\u6700\u65b0\u8fdb\u5c55\uff0c\u4e5f\u80fd\u66f4\u597d\u5730\u628a\u5b83\u5e94\u7528\u5230\u4f60\u7684\u4e1a\u52a1\u5b9e\u8df5\u4e2d\u3002","title":"4\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap6/2redis_locks/","text":"\u7b2c\u4e8c\u8282 Redis\u5e94\u5bf9\u5e76\u53d1\u8bbf\u95ee\uff1a\u65e0\u9501\u7684\u539f\u5b50\u64cd\u4f5c Redis \u65f6\uff0c\u4e0d\u53ef\u907f\u514d\u5730\u4f1a\u9047\u5230\u5e76\u53d1\u8bbf\u95ee\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u8bf4\u5982\u679c\u591a\u4e2a\u7528\u6237\u540c\u65f6\u4e0b\u5355\uff0c\u5c31\u4f1a\u5bf9\u7f13\u5b58\u5728 Redis \u4e2d\u7684\u5546\u54c1\u5e93\u5b58\u5e76\u53d1\u66f4\u65b0\u3002 \u4e00\u65e6\u6709\u4e86\u5e76\u53d1\u5199\u64cd\u4f5c\uff0c\u6570\u636e\u5c31\u4f1a\u88ab\u4fee\u6539\uff0c\u5982\u679c\u6ca1\u6709\u5bf9\u5e76\u53d1\u5199\u8bf7\u6c42\u505a\u597d\u63a7\u5236\uff0c\u5c31\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u88ab\u6539\u9519\uff0c\u5f71\u54cd\u5230\u4e1a\u52a1\u7684\u6b63\u5e38\u4f7f\u7528\uff08\u4f8b\u5982\u5e93\u5b58\u6570\u636e\u9519\u8bef\uff0c\u5bfc\u81f4\u4e0b\u5355\u5f02\u5e38\uff09\u3002 \u4e3a\u4e86\u4fdd\u8bc1\u5e76\u53d1\u8bbf\u95ee\u7684\u6b63\u786e\u6027\uff0cRedis \u63d0\u4f9b\u4e86\u4e24\u79cd\u65b9\u6cd5\uff0c \u5206\u522b\u662f\u52a0\u9501\u548c\u539f\u5b50\u64cd\u4f5c\u3002 \u52a0\u9501\u662f\u4e00\u79cd\u5e38\u7528\u7684\u65b9\u6cd5 \uff0c\u5728\u8bfb\u53d6\u6570\u636e\u524d\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u5148\u83b7\u5f97\u9501\uff0c\u5426\u5219\u5c31\u65e0\u6cd5\u8fdb\u884c\u64cd\u4f5c\u3002\u5f53\u4e00\u4e2a\u5ba2\u6237\u7aef\u83b7\u5f97\u9501\u540e\uff0c\u5c31\u4f1a\u4e00\u76f4\u6301\u6709\u8fd9\u628a\u9501\uff0c\u76f4\u5230\u5ba2\u6237\u7aef\u5b8c\u6210\u6570\u636e\u66f4\u65b0\uff0c\u624d\u91ca\u653e\u8fd9\u628a\u9501\u3002 \u4f46\u662f\uff0c\u5176\u5b9e\u8fd9\u91cc\u4f1a\u6709\u4e24\u4e2a\u95ee\u9898\uff1a \u4e00\u4e2a\u662f\uff0c\u5982\u679c\u52a0\u9501\u64cd\u4f5c\u591a\uff0c\u4f1a\u964d\u4f4e\u7cfb\u7edf\u7684\u5e76\u53d1\u8bbf\u95ee\u6027\u80fd\uff1b \u7b2c\u4e8c\u4e2a\u662f\uff0cRedis \u5ba2\u6237\u7aef\u8981\u52a0\u9501\u65f6\uff0c\u9700\u8981\u7528\u5230\u5206\u5e03\u5f0f\u9501\uff0c\u800c\u5206\u5e03\u5f0f\u9501\u5b9e\u73b0\u590d\u6742\uff0c\u9700\u8981\u7528\u989d\u5916\u7684\u5b58\u50a8\u7cfb\u7edf\u6765\u63d0\u4f9b\u52a0\u89e3\u9501\u64cd\u4f5c\u3002 \u539f\u5b50\u64cd\u4f5c\u662f\u53e6\u4e00\u79cd\u63d0\u4f9b\u5e76\u53d1\u8bbf\u95ee\u63a7\u5236\u7684\u65b9\u6cd5 \u3002\u539f\u5b50\u64cd\u4f5c\u662f\u6307\u6267\u884c\u8fc7\u7a0b\u4fdd\u6301\u539f\u5b50\u6027\u7684\u64cd\u4f5c\uff0c\u800c\u4e14\u539f\u5b50\u64cd\u4f5c\u6267\u884c\u65f6\u5e76\u4e0d\u9700\u8981\u518d\u52a0\u9501\uff0c\u5b9e\u73b0\u4e86\u65e0\u9501\u64cd\u4f5c\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u65e2\u80fd\u4fdd\u8bc1\u5e76\u53d1\u63a7\u5236\uff0c\u8fd8\u80fd\u51cf\u5c11\u5bf9\u7cfb\u7edf\u5e76\u53d1\u6027\u80fd\u7684\u5f71\u54cd\u3002 1\u3001\u5e76\u53d1\u8bbf\u95ee\u4e2d\u9700\u8981\u5bf9\u4ec0\u4e48\u8fdb\u884c\u63a7\u5236\uff1f \u5e76\u53d1\u8bbf\u95ee\u63a7\u5236\uff0c\u662f\u6307\u5bf9\u591a\u4e2a\u5ba2\u6237\u7aef\u8bbf\u95ee\u64cd\u4f5c\u540c\u4e00\u4efd\u6570\u636e\u7684\u8fc7\u7a0b\u8fdb\u884c\u63a7\u5236\uff0c\u4ee5\u4fdd\u8bc1\u4efb\u4f55\u4e00\u4e2a\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u64cd\u4f5c\u5728 Redis \u5b9e\u4f8b\u4e0a\u6267\u884c\u65f6\u5177\u6709\u4e92\u65a5\u6027\u3002 \u4f8b\u5982\uff0c\u5ba2\u6237\u7aef A \u7684\u8bbf\u95ee\u64cd\u4f5c\u5728\u6267\u884c\u65f6\uff0c\u5ba2\u6237\u7aef B \u7684\u64cd\u4f5c\u4e0d\u80fd\u6267\u884c\uff0c\u9700\u8981\u7b49\u5230 A \u7684\u64cd\u4f5c\u7ed3\u675f\u540e\uff0c\u624d\u80fd\u6267\u884c \u5e76\u53d1\u8bbf\u95ee\u63a7\u5236\u5bf9\u5e94\u7684\u64cd\u4f5c\u4e3b\u8981\u662f\u6570\u636e\u4fee\u6539\u64cd\u4f5c\u3002\u5f53\u5ba2\u6237\u7aef\u9700\u8981\u4fee\u6539\u6570\u636e\u65f6\uff0c\u57fa\u672c\u6d41\u7a0b\u5206\u6210\u4e24\u6b65\uff1a \u5ba2\u6237\u7aef\u5148\u628a\u6570\u636e\u8bfb\u53d6\u5230\u672c\u5730\uff0c\u5728\u672c\u5730\u8fdb\u884c\u4fee\u6539\uff1b \u5ba2\u6237\u7aef\u4fee\u6539\u5b8c\u6570\u636e\u540e\uff0c\u518d\u5199\u56de Redis\u3002 \u6574\u4e2a\u6d41\u7a0b\u53eb\u505a\u201c\u8bfb\u53d6 - \u4fee\u6539 - \u5199\u56de\u201d\u64cd\u4f5c\uff08Read-Modify-Write\uff0c\u7b80\u79f0\u4e3a RMW \u64cd\u4f5c\uff09\u3002 \u5f53\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u5bf9\u540c\u4e00\u4efd\u6570\u636e\u6267\u884c RMW \u64cd\u4f5c\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u9700\u8981\u8ba9 RMW \u64cd\u4f5c\u6d89\u53ca\u7684\u4ee3\u7801\u4ee5\u539f\u5b50\u6027\u65b9\u5f0f\u6267\u884c\u3002\u8bbf\u95ee\u540c\u4e00\u4efd\u6570\u636e\u7684 RMW \u64cd\u4f5c\u4ee3\u7801\uff0c\u5c31\u53eb\u505a\u4e34\u754c\u533a\u4ee3\u7801\u3002 \u5f53\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u5e76\u53d1\u6267\u884c\u4e34\u754c\u533a\u4ee3\u7801\u65f6\uff0c\u5c31\u4f1a\u5b58\u5728\u4e00\u4e9b\u6f5c\u5728\u95ee\u9898 current = GET(id) current-- SET(id, current) \u53ef\u4ee5\u770b\u5230\uff0c\u5ba2\u6237\u7aef\u9996\u5148\u4f1a\u6839\u636e\u5546\u54c1 id\uff0c\u4ece Redis \u4e2d\u8bfb\u53d6\u5546\u54c1\u5f53\u524d\u7684\u5e93\u5b58\u503c current\uff08\u5bf9\u5e94 Read)\uff0c\u7136\u540e\uff0c\u5ba2\u6237\u7aef\u5bf9\u5e93\u5b58\u503c\u51cf 1\uff08\u5bf9\u5e94 Modify\uff09\uff0c\u518d\u628a\u5e93\u5b58\u503c\u5199\u56de Redis\uff08\u5bf9\u5e94 Write\uff09\u3002 \u5f53\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u6267\u884c\u8fd9\u6bb5\u4ee3\u7801\u65f6\uff0c\u8fd9\u5c31\u662f\u4e00\u4efd\u4e34\u754c\u533a\u4ee3\u7801\u3002 \u5982\u679c\u6211\u4eec\u5bf9\u4e34\u754c\u533a\u4ee3\u7801\u7684\u6267\u884c\u6ca1\u6709\u63a7\u5236\u673a\u5236\uff0c\u5c31\u4f1a\u51fa\u73b0\u6570\u636e\u66f4\u65b0\u9519\u8bef\u3002\u5728\u521a\u624d\u7684\u4f8b\u5b50\u4e2d\uff0c\u5047\u8bbe\u73b0\u5728\u6709\u4e24\u4e2a\u5ba2\u6237\u7aef A \u548c B\uff0c\u540c\u65f6\u6267\u884c\u521a\u624d\u7684\u4e34\u754c\u533a\u4ee3\u7801\uff0c\u5c31\u4f1a\u51fa\u73b0\u9519\u8bef \u5ba2\u6237\u7aef A \u5728 t1 \u65f6\u8bfb\u53d6\u5e93\u5b58\u503c 10 \u5e76\u6263\u51cf 1\uff0c \u5728 t2 \u65f6\uff0c\u5ba2\u6237\u7aef A \u8fd8\u6ca1\u6709\u628a\u6263\u51cf\u540e\u7684\u5e93\u5b58\u503c 9 \u5199\u56de Redis\uff0c \u800c\u5728\u6b64\u65f6\uff0c\u5ba2\u6237\u7aef B \u8bfb\u5230\u5e93\u5b58\u503c 10\uff0c\u4e5f\u6263\u51cf\u4e86 1\uff0cB \u8bb0\u5f55\u7684\u5e93\u5b58\u503c\u4e5f\u4e3a 9 \u4e86\u3002 \u7b49\u5230 t3 \u65f6\uff0cA \u5f80 Redis \u5199\u56de\u4e86\u5e93\u5b58\u503c 9\uff0c\u800c\u5230 t4 \u65f6\uff0cB \u4e5f\u5199\u56de\u4e86\u5e93\u5b58\u503c 9\u3002 \u5982\u679c\u6309\u6b63\u786e\u7684\u903b\u8f91\u5904\u7406\uff0c\u5ba2\u6237\u7aef A \u548c B \u5bf9\u5e93\u5b58\u503c\u5404\u505a\u4e86\u4e00\u6b21\u6263\u51cf\uff0c\u5e93\u5b58\u503c\u5e94\u8be5\u4e3a 8\u3002\u6240\u4ee5\uff0c\u8fd9\u91cc\u7684\u5e93\u5b58\u503c\u660e\u663e\u66f4\u65b0\u9519\u4e86 \u51fa\u73b0\u8fd9\u4e2a\u73b0\u8c61\u7684\u539f\u56e0\u662f\uff0c\u4e34\u754c\u533a\u4ee3\u7801\u4e2d\u7684 \u5ba2\u6237\u7aef\u8bfb\u53d6\u6570\u636e\u3001\u66f4\u65b0\u6570\u636e\u3001\u518d\u5199\u56de\u6570\u636e\u6d89\u53ca\u4e86\u4e09\u4e2a\u64cd\u4f5c \uff0c\u800c\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u5728\u6267\u884c\u65f6\u5e76\u4e0d\u5177\u6709\u4e92\u65a5\u6027\uff0c\u591a\u4e2a\u5ba2\u6237\u7aef\u57fa\u4e8e\u76f8\u540c\u7684\u521d\u59cb\u503c\u8fdb\u884c\u4fee\u6539\uff0c\u800c\u4e0d\u662f\u57fa\u4e8e\u524d\u4e00\u4e2a\u5ba2\u6237\u7aef\u4fee\u6539\u540e\u7684\u503c\u518d\u4fee\u6539\u3002 \u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u5e76\u53d1\u4fee\u6539\u7684\u6b63\u786e\u6027\uff0c\u53ef\u4ee5\u7528\u9501\u628a\u5e76\u884c\u64cd\u4f5c\u53d8\u6210\u4e32\u884c\u64cd\u4f5c\uff0c\u4e32\u884c\u64cd\u4f5c\u5c31\u5177\u6709\u4e92\u65a5\u6027\u3002\u4e00\u4e2a\u5ba2\u6237\u7aef\u6301\u6709\u9501\u540e\uff0c\u5176\u4ed6\u5ba2\u6237\u7aef\u53ea\u80fd\u7b49\u5230\u9501\u91ca\u653e\uff0c\u624d\u80fd\u62ff\u9501\u518d\u8fdb\u884c\u4fee\u6539\u3002 LOCK() current = GET(id) current-- SET(id, current) UNLOCK() \u867d\u7136\u52a0\u9501\u4fdd\u8bc1\u4e86\u4e92\u65a5\u6027\uff0c \u4f46\u662f\u52a0\u9501\u4e5f\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u5e76\u53d1\u6027\u80fd\u964d\u4f4e \u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff0c \u5f53\u5ba2\u6237\u7aef A \u52a0\u9501\u6267\u884c\u64cd\u4f5c\u65f6\uff0c\u5ba2\u6237\u7aef B\u3001C \u5c31\u9700\u8981\u7b49\u5f85\u3002 A \u91ca\u653e\u9501\u540e\uff0c\u5047\u8bbe B \u62ff\u5230\u9501\uff0c\u90a3\u4e48 C \u8fd8\u9700\u8981\u7ee7\u7eed\u7b49\u5f85\uff0c\u6240\u4ee5\uff0ct1 \u65f6\u6bb5\u5185\u53ea\u6709 A \u80fd\u8bbf\u95ee\u5171\u4eab\u6570\u636e\uff0ct2 \u65f6\u6bb5\u5185\u53ea\u6709 B \u80fd\u8bbf\u95ee\u5171\u4eab\u6570\u636e\uff0c\u7cfb\u7edf\u7684\u5e76\u53d1\u6027\u80fd\u5f53\u7136\u5c31\u4e0b\u964d\u4e86\u3002 \u548c\u52a0\u9501\u7c7b\u4f3c\uff0c\u539f\u5b50\u64cd\u4f5c\u4e5f\u80fd\u5b9e\u73b0\u5e76\u53d1\u63a7\u5236\uff0c\u4f46\u662f\u539f\u5b50\u64cd\u4f5c\u5bf9\u7cfb\u7edf\u5e76\u53d1\u6027\u80fd\u7684\u5f71\u54cd\u8f83\u5c0f\uff0c 2\u3001Redis \u7684\u4e24\u79cd\u539f\u5b50\u64cd\u4f5c\u65b9\u6cd5 \u4e3a\u4e86\u5b9e\u73b0\u5e76\u53d1\u63a7\u5236\u8981\u6c42\u7684\u4e34\u754c\u533a\u4ee3\u7801\u4e92\u65a5\u6267\u884c\uff0cRedis \u7684\u539f\u5b50\u64cd\u4f5c\u91c7\u7528\u4e86\u4e24\u79cd\u65b9\u6cd5\uff1a \u628a\u591a\u4e2a\u64cd\u4f5c\u5728 Redis \u4e2d\u5b9e\u73b0\u6210\u4e00\u4e2a\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u5355\u547d\u4ee4\u64cd\u4f5c \uff1b \u628a\u591a\u4e2a\u64cd\u4f5c\u5199\u5230\u4e00\u4e2a Lua \u811a\u672c\u4e2d\uff0c\u4ee5\u539f\u5b50\u6027\u65b9\u5f0f\u6267\u884c\u5355\u4e2a Lua \u811a\u672c\u3002 2-1 Redis \u672c\u8eab\u7684\u5355\u547d\u4ee4\u64cd\u4f5c Redis \u662f\u4f7f\u7528\u5355\u7ebf\u7a0b\u6765\u4e32\u884c\u5904\u7406\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u64cd\u4f5c\u547d\u4ee4\u7684\uff0c\u6240\u4ee5\uff0c\u5f53 Redis \u6267\u884c\u67d0\u4e2a\u547d\u4ee4\u64cd\u4f5c\u65f6\uff0c\u5176\u4ed6\u547d\u4ee4\u662f\u65e0\u6cd5\u6267\u884c\u7684\uff0c\u8fd9\u76f8\u5f53\u4e8e\u547d\u4ee4\u64cd\u4f5c\u662f\u4e92\u65a5\u6267\u884c\u7684\u3002 \u5f53\u7136\uff0cRedis \u7684\u5feb\u7167\u751f\u6210\u3001AOF \u91cd\u5199\u8fd9\u4e9b\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4f7f\u7528\u540e\u53f0\u7ebf\u7a0b\u6216\u8005\u662f\u5b50\u8fdb\u7a0b\u6267\u884c\uff0c\u4e5f\u5c31\u662f\u548c\u4e3b\u7ebf\u7a0b\u7684\u64cd\u4f5c\u5e76\u884c\u6267\u884c\u3002 \u4e0d\u8fc7\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u53ea\u662f\u8bfb\u53d6\u6570\u636e\uff0c\u4e0d\u4f1a\u4fee\u6539\u6570\u636e\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u5bf9\u5b83\u4eec\u505a\u5e76\u53d1\u63a7\u5236\u3002 \u867d\u7136 Redis \u7684\u5355\u4e2a\u547d\u4ee4\u64cd\u4f5c\u53ef\u4ee5\u539f\u5b50\u6027\u5730\u6267\u884c\uff0c\u4f46\u662f\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u6570\u636e\u4fee\u6539\u65f6\u53ef\u80fd\u5305\u542b\u591a\u4e2a\u64cd\u4f5c\uff0c\u81f3\u5c11\u5305\u62ec\u8bfb\u6570\u636e\u3001\u6570\u636e\u589e\u51cf\u3001\u5199\u56de\u6570\u636e\u4e09\u4e2a\u64cd\u4f5c\uff0c\u8fd9\u663e\u7136\u5c31\u4e0d\u662f\u5355\u4e2a\u547d\u4ee4\u64cd\u4f5c\u4e86\uff0c\u90a3\u8be5\u600e\u4e48\u529e\u5462\uff1f Redis \u63d0\u4f9b\u4e86 INCR/DECR \u547d\u4ee4\uff0c\u628a\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u8f6c\u53d8\u4e3a\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\u4e86 \u3002 INCR/DECR \u547d\u4ee4\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u589e\u503c / \u51cf\u503c\u64cd\u4f5c\uff0c\u800c\u4e14\u5b83\u4eec\u672c\u8eab\u5c31\u662f\u5355\u4e2a\u547d\u4ee4\u64cd\u4f5c\uff0cRedis \u5728\u6267\u884c\u5b83\u4eec\u65f6\uff0c\u672c\u8eab\u5c31\u5177\u6709\u4e92\u65a5\u6027 \u6bd4\u5982\u8bf4\uff0c\u5728\u521a\u624d\u7684\u5e93\u5b58\u6263\u51cf\u4f8b\u5b50\u4e2d\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u76f4\u63a5\u5b8c\u6210\u5bf9\u5546\u54c1 id \u7684\u5e93\u5b58\u503c\u51cf 1 \u64cd\u4f5c\u3002 \u5373\u4f7f\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u6267\u884c\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u4e5f\u4e0d\u7528\u62c5\u5fc3\u51fa\u73b0\u5e93\u5b58\u503c\u6263\u51cf\u9519\u8bef\u7684\u95ee\u9898 \u3002 DECR id \u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u8981\u6267\u884c\u7684\u64cd\u4f5c\u4e0d\u662f\u7b80\u5355\u5730\u589e\u51cf\u6570\u636e\uff0c\u800c\u662f\u6709\u66f4\u52a0\u590d\u6742\u7684\u5224\u65ad\u903b\u8f91\u6216\u8005\u662f\u5176\u4ed6\u64cd\u4f5c\uff0c\u90a3\u4e48\uff0cRedis \u7684\u5355\u547d\u4ee4\u64cd\u4f5c\u5df2\u7ecf\u65e0\u6cd5\u4fdd\u8bc1\u591a\u4e2a\u64cd\u4f5c\u7684\u4e92\u65a5\u6267\u884c\u4e86\u3002 \u6240\u4ee5\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528\u7b2c\u4e8c\u4e2a\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f Lua \u811a\u672c\u3002 2-2 Lua \u811a\u672c Redis \u4f1a\u628a\u6574\u4e2a Lua \u811a\u672c\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u6267\u884c\uff0c\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u4e0d\u4f1a\u88ab\u5176\u4ed6\u547d\u4ee4\u6253\u65ad\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86 Lua \u811a\u672c\u4e2d\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002 \u5982\u679c\u6211\u4eec\u6709\u591a\u4e2a\u64cd\u4f5c\u8981\u6267\u884c\uff0c\u4f46\u662f\u53c8\u65e0\u6cd5\u7528 INCR/DECR \u8fd9\u79cd\u547d\u4ee4\u64cd\u4f5c\u6765\u5b9e\u73b0\uff0c\u5c31\u53ef\u4ee5\u628a\u8fd9\u4e9b\u8981\u6267\u884c\u7684\u64cd\u4f5c\u7f16\u5199\u5230\u4e00\u4e2a Lua \u811a\u672c\u4e2d\u3002 \u7136\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Redis \u7684 EVAL \u547d\u4ee4\u6765\u6267\u884c\u811a\u672c\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u5728\u6267\u884c\u65f6\u5c31\u5177\u6709\u4e86\u4e92\u65a5\u6027\u3002 \u5f53\u4e00\u4e2a\u4e1a\u52a1\u5e94\u7528\u7684\u8bbf\u95ee\u7528\u6237\u589e\u52a0\u65f6\uff0c\u6211\u4eec\u6709\u65f6\u9700\u8981\u9650\u5236\u67d0\u4e2a\u5ba2\u6237\u7aef\u5728\u4e00\u5b9a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u6bd4\u5982\u7206\u6b3e\u5546\u54c1\u7684\u8d2d\u4e70\u9650\u6d41\u3001\u793e\u4ea4\u7f51\u7edc\u4e2d\u7684\u6bcf\u5206\u949f\u70b9\u8d5e\u6b21\u6570\u9650\u5236\u7b49\u3002 \u90a3\u8be5\u600e\u4e48\u9650\u5236\u5462\uff1f \u6211\u4eec\u53ef\u4ee5\u628a\u5ba2\u6237\u7aef IP \u4f5c\u4e3a key\uff0c\u628a\u5ba2\u6237\u7aef\u7684\u8bbf\u95ee\u6b21\u6570\u4f5c\u4e3a value\uff0c\u4fdd\u5b58\u5230 Redis \u4e2d\u3002\u5ba2\u6237\u7aef\u6bcf\u8bbf\u95ee\u4e00\u6b21\u540e\uff0c\u6211\u4eec\u5c31\u7528 INCR \u589e\u52a0\u8bbf\u95ee\u6b21\u6570\u3002 \u4e0d\u8fc7\uff0c\u5728\u8fd9\u79cd\u573a\u666f\u4e0b\uff0c\u5ba2\u6237\u7aef\u9650\u6d41\u5176\u5b9e\u540c\u65f6\u5305\u542b\u4e86\u5bf9\u8bbf\u95ee\u6b21\u6570\u548c\u65f6\u95f4\u8303\u56f4\u7684\u9650\u5236\uff0c\u4f8b\u5982\u6bcf\u5206\u949f\u7684\u8bbf\u95ee\u6b21\u6570\u4e0d\u80fd\u8d85\u8fc7 20\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u7b2c\u4e00\u6b21\u8bbf\u95ee\u65f6\uff0c\u7ed9\u5bf9\u5e94\u952e\u503c\u5bf9\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u4f8b\u5982\u8bbe\u7f6e\u4e3a 60s \u540e\u8fc7\u671f\u3002 \u540c\u65f6\uff0c\u5728\u5ba2\u6237\u7aef\u6bcf\u6b21\u8bbf\u95ee\u65f6\uff0c\u6211\u4eec\u8bfb\u53d6\u5ba2\u6237\u7aef\u5f53\u524d\u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u5982\u679c\u6b21\u6570\u8d85\u8fc7\u9608\u503c\uff0c\u5c31\u62a5\u9519\uff0c\u9650\u5236\u5ba2\u6237\u7aef\u518d\u6b21\u8bbf\u95ee\u3002 \u4e0b\u9762\u7684\u8fd9\u6bb5\u4ee3\u7801\uff0c\u5b83\u5b9e\u73b0\u4e86\u5bf9\u5ba2\u6237\u7aef\u6bcf\u5206\u949f\u8bbf\u95ee\u6b21\u6570\u4e0d\u8d85\u8fc7 20 \u6b21\u7684\u9650\u5236\u3002 //\u83b7\u53d6ip\u5bf9\u5e94\u7684\u8bbf\u95ee\u6b21\u6570 current = GET(ip) //\u5982\u679c\u8d85\u8fc7\u8bbf\u95ee\u6b21\u6570\u8d85\u8fc720\u6b21\uff0c\u5219\u62a5\u9519 IF current != NULL AND current > 20 THEN ERROR \"exceed 20 accesses per second\" ELSE //\u5982\u679c\u8bbf\u95ee\u6b21\u6570\u4e0d\u8db320\u6b21\uff0c\u589e\u52a0\u4e00\u6b21\u8bbf\u95ee\u8ba1\u6570 value = INCR(ip) //\u5982\u679c\u662f\u7b2c\u4e00\u6b21\u8bbf\u95ee\uff0c\u5c06\u952e\u503c\u5bf9\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a60s\u540e IF value == 1 THEN EXPIRE(ip,60) END //\u6267\u884c\u5176\u4ed6\u64cd\u4f5c DO THINGS END \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u5df2\u7ecf\u4f7f\u7528\u4e86 INCR \u6765\u539f\u5b50\u6027\u5730\u589e\u52a0\u8ba1\u6570\u3002\u4f46\u662f\uff0c\u5ba2\u6237\u7aef\u9650\u6d41\u7684\u903b\u8f91\u4e0d\u53ea\u6709\u8ba1\u6570\uff0c \u8fd8\u5305\u62ec\u8bbf\u95ee\u6b21\u6570\u5224\u65ad\u548c\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u3002 \u5bf9\u4e8e\u8fd9\u4e9b\u64cd\u4f5c\uff0c\u6211\u4eec\u540c\u6837\u9700\u8981\u4fdd\u8bc1\u5b83\u4eec\u7684\u539f\u5b50\u6027\u3002 \u5426\u5219\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u4f7f\u7528\u591a\u7ebf\u7a0b\u8bbf\u95ee\uff0c\u8bbf\u95ee\u6b21\u6570\u521d\u59cb\u503c\u4e3a 0\uff0c\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u4e86 INCR(ip) \u64cd\u4f5c\u540e\uff0c\u7b2c\u4e8c\u4e2a\u7ebf\u7a0b\u7d27\u63a5\u7740\u4e5f\u6267\u884c\u4e86 INCR(ip)\uff0c\u6b64\u65f6\uff0cip \u5bf9\u5e94\u7684\u8bbf\u95ee\u6b21\u6570\u5c31\u88ab\u589e\u52a0\u5230\u4e86 2\uff0c\u6211\u4eec\u5c31\u65e0\u6cd5\u518d\u5bf9\u8fd9\u4e2a ip \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u4e86\u3002 \u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\uff0c\u8fd9\u4e2a ip \u5bf9\u5e94\u7684\u5ba2\u6237\u7aef\u8bbf\u95ee\u6b21\u6570\u8fbe\u5230 20 \u6b21\u4e4b\u540e\uff0c\u5c31\u65e0\u6cd5\u518d\u8fdb\u884c\u8bbf\u95ee\u4e86\u3002\u5373\u4f7f\u8fc7\u4e86 60s\uff0c\u4e5f\u4e0d\u80fd\u518d\u7ee7\u7eed\u8bbf\u95ee\uff0c\u663e\u7136\u4e0d\u7b26\u5408\u4e1a\u52a1\u8981\u6c42\u3002 \u6240\u4ee5\uff0c\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u7684\u64cd\u4f5c\u65e0\u6cd5\u7528 Redis \u5355\u4e2a\u547d\u4ee4\u6765\u5b9e\u73b0\uff0c\u6b64\u65f6\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 Lua \u811a\u672c\u6765\u4fdd\u8bc1\u5e76\u53d1\u63a7\u5236\u3002 \u6211\u4eec\u53ef\u4ee5\u628a\u8bbf\u95ee\u6b21\u6570\u52a0 1 \u5224\u65ad\u8bbf\u95ee\u6b21\u6570\u662f\u5426\u4e3a 1 \u4ee5\u53ca\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u5199\u5165\u4e00\u4e2a Lua \u811a\u672c \u5982\u4e0b\u6240\u793a\uff1a local current current = redis.call(\"incr\",KEYS[1]) if tonumber(current) == 1 then redis.call(\"expire\",KEYS[1],60) end \u7f16\u5199\u7684\u811a\u672c\u540d\u79f0\u4e3a lua.script \uff0c\u6211\u4eec\u63a5\u7740\u5c31\u53ef\u4ee5\u4f7f\u7528 Redis \u5ba2\u6237\u7aef\uff0c\u5e26\u4e0a eval \u9009\u9879\uff0c\u6765\u6267\u884c\u8be5\u811a\u672c\u3002\u811a\u672c\u6240\u9700\u7684\u53c2\u6570\u5c06\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u4e2d\u7684 keys \u548c args \u8fdb\u884c\u4f20\u9012\u3002 redis-cli --eval lua.script keys , args \u8fd9\u6837\u4e00\u6765\uff0c\u8bbf\u95ee\u6b21\u6570\u52a0 1\u3001\u5224\u65ad\u8bbf\u95ee\u6b21\u6570\u662f\u5426\u4e3a 1\uff0c\u4ee5\u53ca\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u5c31\u53ef\u4ee5\u539f\u5b50\u6027\u5730\u6267\u884c\u4e86\u3002\u5373\u4f7f\u5ba2\u6237\u7aef\u6709\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u6267\u884c\u8fd9\u4e2a\u811a\u672c\uff0cRedis \u4e5f\u4f1a\u4f9d\u6b21\u4e32\u884c\u6267\u884c\u811a\u672c\u4ee3\u7801\uff0c\u907f\u514d\u4e86\u5e76\u53d1\u64cd\u4f5c\u5e26\u6765\u7684\u6570\u636e\u9519\u8bef\u3002 3\u3001\u672c\u8282\u5c0f\u7ed3 \u5728\u5e76\u53d1\u8bbf\u95ee\u65f6\uff0c\u5e76\u53d1\u7684 RMW \u64cd\u4f5c\u4f1a\u5bfc\u81f4\u6570\u636e\u9519\u8bef\uff0c\u6240\u4ee5\u9700\u8981\u8fdb\u884c\u5e76\u53d1\u63a7\u5236\u3002\u6240\u8c13\u5e76\u53d1\u63a7\u5236\uff0c\u5c31\u662f\u8981\u4fdd\u8bc1\u4e34\u754c\u533a\u4ee3\u7801\u7684\u4e92\u65a5\u6267\u884c\u3002 Redis \u63d0\u4f9b\u4e86\u4e24\u79cd\u539f\u5b50\u64cd\u4f5c\u7684\u65b9\u6cd5\u6765\u5b9e\u73b0\u5e76\u53d1\u63a7\u5236\uff0c\u5206\u522b\u662f\u5355\u547d\u4ee4\u64cd\u4f5c\u548c Lua \u811a\u672c\u3002 \u56e0\u4e3a\u539f\u5b50\u64cd\u4f5c\u672c\u8eab\u4e0d\u4f1a\u5bf9\u592a\u591a\u7684\u8d44\u6e90\u9650\u5236\u8bbf\u95ee\uff0c\u53ef\u4ee5\u7ef4\u6301\u8f83\u9ad8\u7684\u7cfb\u7edf\u5e76\u53d1\u6027\u80fd\u3002 \u4f46\u662f\uff0c\u5355\u547d\u4ee4\u539f\u5b50\u64cd\u4f5c\u7684\u9002\u7528\u8303\u56f4\u8f83\u5c0f\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u7684 RMW \u64cd\u4f5c\u90fd\u80fd\u8f6c\u53d8\u6210\u5355\u547d\u4ee4\u7684\u539f\u5b50\u64cd\u4f5c\uff08\u4f8b\u5982 INCR/DECR \u547d\u4ee4\u53ea\u80fd\u5728\u8bfb\u53d6\u6570\u636e\u540e\u505a\u539f\u5b50\u589e\u51cf\uff09\uff0c\u5f53\u6211\u4eec\u9700\u8981\u5bf9\u8bfb\u53d6\u7684\u6570\u636e\u505a\u66f4\u591a\u5224\u65ad\uff0c\u6216\u8005\u662f\u6211\u4eec\u5bf9\u6570\u636e\u7684\u4fee\u6539\u4e0d\u662f\u7b80\u5355\u7684\u589e\u51cf\u65f6\uff0c\u5355\u547d\u4ee4\u64cd\u4f5c\u5c31\u4e0d\u9002\u7528\u4e86\u3002 \u800c Redis \u7684 Lua \u811a\u672c\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u64cd\u4f5c\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u4f1a\u4ee5\u539f\u5b50\u6027\u7684\u65b9\u5f0f\u6267\u884c\uff0c\u7ed5\u5f00\u4e86\u5355\u547d\u4ee4\u64cd\u4f5c\u7684\u9650\u5236\u3002 \u4e0d\u8fc7\uff0c\u5982\u679c\u628a\u5f88\u591a\u64cd\u4f5c\u90fd\u653e\u5728 Lua \u811a\u672c\u4e2d\u539f\u5b50\u6267\u884c\uff0c\u4f1a\u5bfc\u81f4 Redis \u6267\u884c\u811a\u672c\u7684\u65f6\u95f4\u589e\u52a0\uff0c\u540c\u6837\u4e5f\u4f1a\u964d\u4f4e Redis \u7684\u5e76\u53d1\u6027\u80fd\u3002\u6240\u4ee5\uff0c\u6211\u7ed9\u4f60\u4e00\u4e2a\u5c0f\u5efa\u8bae\uff1a\u5728\u7f16\u5199 Lua \u811a\u672c\u65f6\uff0c\u4f60\u8981\u907f\u514d\u628a\u4e0d\u9700\u8981\u505a\u5e76\u53d1\u63a7\u5236\u7684\u64cd\u4f5c\u5199\u5165\u811a\u672c\u4e2d\u3002 \u5f53\u7136\uff0c\u52a0\u9501\u4e5f\u80fd\u5b9e\u73b0\u4e34\u754c\u533a\u4ee3\u7801\u7684\u4e92\u65a5\u6267\u884c\uff0c\u53ea\u662f\u5982\u679c\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u52a0\u9501\u65f6\uff0c\u5c31\u9700\u8981\u5206\u5e03\u5f0f\u9501\u7684\u652f\u6301\u4e86","title":"\u7b2c\u4e8c\u8282 Redis\u5e94\u5bf9\u5e76\u53d1\u8bbf\u95ee\uff1a\u65e0\u9501\u7684\u539f\u5b50\u64cd\u4f5c"},{"location":"chap6/2redis_locks/#redis","text":"Redis \u65f6\uff0c\u4e0d\u53ef\u907f\u514d\u5730\u4f1a\u9047\u5230\u5e76\u53d1\u8bbf\u95ee\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u8bf4\u5982\u679c\u591a\u4e2a\u7528\u6237\u540c\u65f6\u4e0b\u5355\uff0c\u5c31\u4f1a\u5bf9\u7f13\u5b58\u5728 Redis \u4e2d\u7684\u5546\u54c1\u5e93\u5b58\u5e76\u53d1\u66f4\u65b0\u3002 \u4e00\u65e6\u6709\u4e86\u5e76\u53d1\u5199\u64cd\u4f5c\uff0c\u6570\u636e\u5c31\u4f1a\u88ab\u4fee\u6539\uff0c\u5982\u679c\u6ca1\u6709\u5bf9\u5e76\u53d1\u5199\u8bf7\u6c42\u505a\u597d\u63a7\u5236\uff0c\u5c31\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u88ab\u6539\u9519\uff0c\u5f71\u54cd\u5230\u4e1a\u52a1\u7684\u6b63\u5e38\u4f7f\u7528\uff08\u4f8b\u5982\u5e93\u5b58\u6570\u636e\u9519\u8bef\uff0c\u5bfc\u81f4\u4e0b\u5355\u5f02\u5e38\uff09\u3002 \u4e3a\u4e86\u4fdd\u8bc1\u5e76\u53d1\u8bbf\u95ee\u7684\u6b63\u786e\u6027\uff0cRedis \u63d0\u4f9b\u4e86\u4e24\u79cd\u65b9\u6cd5\uff0c \u5206\u522b\u662f\u52a0\u9501\u548c\u539f\u5b50\u64cd\u4f5c\u3002 \u52a0\u9501\u662f\u4e00\u79cd\u5e38\u7528\u7684\u65b9\u6cd5 \uff0c\u5728\u8bfb\u53d6\u6570\u636e\u524d\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u5148\u83b7\u5f97\u9501\uff0c\u5426\u5219\u5c31\u65e0\u6cd5\u8fdb\u884c\u64cd\u4f5c\u3002\u5f53\u4e00\u4e2a\u5ba2\u6237\u7aef\u83b7\u5f97\u9501\u540e\uff0c\u5c31\u4f1a\u4e00\u76f4\u6301\u6709\u8fd9\u628a\u9501\uff0c\u76f4\u5230\u5ba2\u6237\u7aef\u5b8c\u6210\u6570\u636e\u66f4\u65b0\uff0c\u624d\u91ca\u653e\u8fd9\u628a\u9501\u3002 \u4f46\u662f\uff0c\u5176\u5b9e\u8fd9\u91cc\u4f1a\u6709\u4e24\u4e2a\u95ee\u9898\uff1a \u4e00\u4e2a\u662f\uff0c\u5982\u679c\u52a0\u9501\u64cd\u4f5c\u591a\uff0c\u4f1a\u964d\u4f4e\u7cfb\u7edf\u7684\u5e76\u53d1\u8bbf\u95ee\u6027\u80fd\uff1b \u7b2c\u4e8c\u4e2a\u662f\uff0cRedis \u5ba2\u6237\u7aef\u8981\u52a0\u9501\u65f6\uff0c\u9700\u8981\u7528\u5230\u5206\u5e03\u5f0f\u9501\uff0c\u800c\u5206\u5e03\u5f0f\u9501\u5b9e\u73b0\u590d\u6742\uff0c\u9700\u8981\u7528\u989d\u5916\u7684\u5b58\u50a8\u7cfb\u7edf\u6765\u63d0\u4f9b\u52a0\u89e3\u9501\u64cd\u4f5c\u3002 \u539f\u5b50\u64cd\u4f5c\u662f\u53e6\u4e00\u79cd\u63d0\u4f9b\u5e76\u53d1\u8bbf\u95ee\u63a7\u5236\u7684\u65b9\u6cd5 \u3002\u539f\u5b50\u64cd\u4f5c\u662f\u6307\u6267\u884c\u8fc7\u7a0b\u4fdd\u6301\u539f\u5b50\u6027\u7684\u64cd\u4f5c\uff0c\u800c\u4e14\u539f\u5b50\u64cd\u4f5c\u6267\u884c\u65f6\u5e76\u4e0d\u9700\u8981\u518d\u52a0\u9501\uff0c\u5b9e\u73b0\u4e86\u65e0\u9501\u64cd\u4f5c\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u65e2\u80fd\u4fdd\u8bc1\u5e76\u53d1\u63a7\u5236\uff0c\u8fd8\u80fd\u51cf\u5c11\u5bf9\u7cfb\u7edf\u5e76\u53d1\u6027\u80fd\u7684\u5f71\u54cd\u3002","title":"\u7b2c\u4e8c\u8282 Redis\u5e94\u5bf9\u5e76\u53d1\u8bbf\u95ee\uff1a\u65e0\u9501\u7684\u539f\u5b50\u64cd\u4f5c"},{"location":"chap6/2redis_locks/#1","text":"\u5e76\u53d1\u8bbf\u95ee\u63a7\u5236\uff0c\u662f\u6307\u5bf9\u591a\u4e2a\u5ba2\u6237\u7aef\u8bbf\u95ee\u64cd\u4f5c\u540c\u4e00\u4efd\u6570\u636e\u7684\u8fc7\u7a0b\u8fdb\u884c\u63a7\u5236\uff0c\u4ee5\u4fdd\u8bc1\u4efb\u4f55\u4e00\u4e2a\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u64cd\u4f5c\u5728 Redis \u5b9e\u4f8b\u4e0a\u6267\u884c\u65f6\u5177\u6709\u4e92\u65a5\u6027\u3002 \u4f8b\u5982\uff0c\u5ba2\u6237\u7aef A \u7684\u8bbf\u95ee\u64cd\u4f5c\u5728\u6267\u884c\u65f6\uff0c\u5ba2\u6237\u7aef B \u7684\u64cd\u4f5c\u4e0d\u80fd\u6267\u884c\uff0c\u9700\u8981\u7b49\u5230 A \u7684\u64cd\u4f5c\u7ed3\u675f\u540e\uff0c\u624d\u80fd\u6267\u884c \u5e76\u53d1\u8bbf\u95ee\u63a7\u5236\u5bf9\u5e94\u7684\u64cd\u4f5c\u4e3b\u8981\u662f\u6570\u636e\u4fee\u6539\u64cd\u4f5c\u3002\u5f53\u5ba2\u6237\u7aef\u9700\u8981\u4fee\u6539\u6570\u636e\u65f6\uff0c\u57fa\u672c\u6d41\u7a0b\u5206\u6210\u4e24\u6b65\uff1a \u5ba2\u6237\u7aef\u5148\u628a\u6570\u636e\u8bfb\u53d6\u5230\u672c\u5730\uff0c\u5728\u672c\u5730\u8fdb\u884c\u4fee\u6539\uff1b \u5ba2\u6237\u7aef\u4fee\u6539\u5b8c\u6570\u636e\u540e\uff0c\u518d\u5199\u56de Redis\u3002 \u6574\u4e2a\u6d41\u7a0b\u53eb\u505a\u201c\u8bfb\u53d6 - \u4fee\u6539 - \u5199\u56de\u201d\u64cd\u4f5c\uff08Read-Modify-Write\uff0c\u7b80\u79f0\u4e3a RMW \u64cd\u4f5c\uff09\u3002 \u5f53\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u5bf9\u540c\u4e00\u4efd\u6570\u636e\u6267\u884c RMW \u64cd\u4f5c\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u9700\u8981\u8ba9 RMW \u64cd\u4f5c\u6d89\u53ca\u7684\u4ee3\u7801\u4ee5\u539f\u5b50\u6027\u65b9\u5f0f\u6267\u884c\u3002\u8bbf\u95ee\u540c\u4e00\u4efd\u6570\u636e\u7684 RMW \u64cd\u4f5c\u4ee3\u7801\uff0c\u5c31\u53eb\u505a\u4e34\u754c\u533a\u4ee3\u7801\u3002 \u5f53\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u5e76\u53d1\u6267\u884c\u4e34\u754c\u533a\u4ee3\u7801\u65f6\uff0c\u5c31\u4f1a\u5b58\u5728\u4e00\u4e9b\u6f5c\u5728\u95ee\u9898 current = GET(id) current-- SET(id, current) \u53ef\u4ee5\u770b\u5230\uff0c\u5ba2\u6237\u7aef\u9996\u5148\u4f1a\u6839\u636e\u5546\u54c1 id\uff0c\u4ece Redis \u4e2d\u8bfb\u53d6\u5546\u54c1\u5f53\u524d\u7684\u5e93\u5b58\u503c current\uff08\u5bf9\u5e94 Read)\uff0c\u7136\u540e\uff0c\u5ba2\u6237\u7aef\u5bf9\u5e93\u5b58\u503c\u51cf 1\uff08\u5bf9\u5e94 Modify\uff09\uff0c\u518d\u628a\u5e93\u5b58\u503c\u5199\u56de Redis\uff08\u5bf9\u5e94 Write\uff09\u3002 \u5f53\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u6267\u884c\u8fd9\u6bb5\u4ee3\u7801\u65f6\uff0c\u8fd9\u5c31\u662f\u4e00\u4efd\u4e34\u754c\u533a\u4ee3\u7801\u3002 \u5982\u679c\u6211\u4eec\u5bf9\u4e34\u754c\u533a\u4ee3\u7801\u7684\u6267\u884c\u6ca1\u6709\u63a7\u5236\u673a\u5236\uff0c\u5c31\u4f1a\u51fa\u73b0\u6570\u636e\u66f4\u65b0\u9519\u8bef\u3002\u5728\u521a\u624d\u7684\u4f8b\u5b50\u4e2d\uff0c\u5047\u8bbe\u73b0\u5728\u6709\u4e24\u4e2a\u5ba2\u6237\u7aef A \u548c B\uff0c\u540c\u65f6\u6267\u884c\u521a\u624d\u7684\u4e34\u754c\u533a\u4ee3\u7801\uff0c\u5c31\u4f1a\u51fa\u73b0\u9519\u8bef \u5ba2\u6237\u7aef A \u5728 t1 \u65f6\u8bfb\u53d6\u5e93\u5b58\u503c 10 \u5e76\u6263\u51cf 1\uff0c \u5728 t2 \u65f6\uff0c\u5ba2\u6237\u7aef A \u8fd8\u6ca1\u6709\u628a\u6263\u51cf\u540e\u7684\u5e93\u5b58\u503c 9 \u5199\u56de Redis\uff0c \u800c\u5728\u6b64\u65f6\uff0c\u5ba2\u6237\u7aef B \u8bfb\u5230\u5e93\u5b58\u503c 10\uff0c\u4e5f\u6263\u51cf\u4e86 1\uff0cB \u8bb0\u5f55\u7684\u5e93\u5b58\u503c\u4e5f\u4e3a 9 \u4e86\u3002 \u7b49\u5230 t3 \u65f6\uff0cA \u5f80 Redis \u5199\u56de\u4e86\u5e93\u5b58\u503c 9\uff0c\u800c\u5230 t4 \u65f6\uff0cB \u4e5f\u5199\u56de\u4e86\u5e93\u5b58\u503c 9\u3002 \u5982\u679c\u6309\u6b63\u786e\u7684\u903b\u8f91\u5904\u7406\uff0c\u5ba2\u6237\u7aef A \u548c B \u5bf9\u5e93\u5b58\u503c\u5404\u505a\u4e86\u4e00\u6b21\u6263\u51cf\uff0c\u5e93\u5b58\u503c\u5e94\u8be5\u4e3a 8\u3002\u6240\u4ee5\uff0c\u8fd9\u91cc\u7684\u5e93\u5b58\u503c\u660e\u663e\u66f4\u65b0\u9519\u4e86 \u51fa\u73b0\u8fd9\u4e2a\u73b0\u8c61\u7684\u539f\u56e0\u662f\uff0c\u4e34\u754c\u533a\u4ee3\u7801\u4e2d\u7684 \u5ba2\u6237\u7aef\u8bfb\u53d6\u6570\u636e\u3001\u66f4\u65b0\u6570\u636e\u3001\u518d\u5199\u56de\u6570\u636e\u6d89\u53ca\u4e86\u4e09\u4e2a\u64cd\u4f5c \uff0c\u800c\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u5728\u6267\u884c\u65f6\u5e76\u4e0d\u5177\u6709\u4e92\u65a5\u6027\uff0c\u591a\u4e2a\u5ba2\u6237\u7aef\u57fa\u4e8e\u76f8\u540c\u7684\u521d\u59cb\u503c\u8fdb\u884c\u4fee\u6539\uff0c\u800c\u4e0d\u662f\u57fa\u4e8e\u524d\u4e00\u4e2a\u5ba2\u6237\u7aef\u4fee\u6539\u540e\u7684\u503c\u518d\u4fee\u6539\u3002 \u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u5e76\u53d1\u4fee\u6539\u7684\u6b63\u786e\u6027\uff0c\u53ef\u4ee5\u7528\u9501\u628a\u5e76\u884c\u64cd\u4f5c\u53d8\u6210\u4e32\u884c\u64cd\u4f5c\uff0c\u4e32\u884c\u64cd\u4f5c\u5c31\u5177\u6709\u4e92\u65a5\u6027\u3002\u4e00\u4e2a\u5ba2\u6237\u7aef\u6301\u6709\u9501\u540e\uff0c\u5176\u4ed6\u5ba2\u6237\u7aef\u53ea\u80fd\u7b49\u5230\u9501\u91ca\u653e\uff0c\u624d\u80fd\u62ff\u9501\u518d\u8fdb\u884c\u4fee\u6539\u3002 LOCK() current = GET(id) current-- SET(id, current) UNLOCK() \u867d\u7136\u52a0\u9501\u4fdd\u8bc1\u4e86\u4e92\u65a5\u6027\uff0c \u4f46\u662f\u52a0\u9501\u4e5f\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u5e76\u53d1\u6027\u80fd\u964d\u4f4e \u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff0c \u5f53\u5ba2\u6237\u7aef A \u52a0\u9501\u6267\u884c\u64cd\u4f5c\u65f6\uff0c\u5ba2\u6237\u7aef B\u3001C \u5c31\u9700\u8981\u7b49\u5f85\u3002 A \u91ca\u653e\u9501\u540e\uff0c\u5047\u8bbe B \u62ff\u5230\u9501\uff0c\u90a3\u4e48 C \u8fd8\u9700\u8981\u7ee7\u7eed\u7b49\u5f85\uff0c\u6240\u4ee5\uff0ct1 \u65f6\u6bb5\u5185\u53ea\u6709 A \u80fd\u8bbf\u95ee\u5171\u4eab\u6570\u636e\uff0ct2 \u65f6\u6bb5\u5185\u53ea\u6709 B \u80fd\u8bbf\u95ee\u5171\u4eab\u6570\u636e\uff0c\u7cfb\u7edf\u7684\u5e76\u53d1\u6027\u80fd\u5f53\u7136\u5c31\u4e0b\u964d\u4e86\u3002 \u548c\u52a0\u9501\u7c7b\u4f3c\uff0c\u539f\u5b50\u64cd\u4f5c\u4e5f\u80fd\u5b9e\u73b0\u5e76\u53d1\u63a7\u5236\uff0c\u4f46\u662f\u539f\u5b50\u64cd\u4f5c\u5bf9\u7cfb\u7edf\u5e76\u53d1\u6027\u80fd\u7684\u5f71\u54cd\u8f83\u5c0f\uff0c","title":"1\u3001\u5e76\u53d1\u8bbf\u95ee\u4e2d\u9700\u8981\u5bf9\u4ec0\u4e48\u8fdb\u884c\u63a7\u5236\uff1f"},{"location":"chap6/2redis_locks/#2redis","text":"\u4e3a\u4e86\u5b9e\u73b0\u5e76\u53d1\u63a7\u5236\u8981\u6c42\u7684\u4e34\u754c\u533a\u4ee3\u7801\u4e92\u65a5\u6267\u884c\uff0cRedis \u7684\u539f\u5b50\u64cd\u4f5c\u91c7\u7528\u4e86\u4e24\u79cd\u65b9\u6cd5\uff1a \u628a\u591a\u4e2a\u64cd\u4f5c\u5728 Redis \u4e2d\u5b9e\u73b0\u6210\u4e00\u4e2a\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u5355\u547d\u4ee4\u64cd\u4f5c \uff1b \u628a\u591a\u4e2a\u64cd\u4f5c\u5199\u5230\u4e00\u4e2a Lua \u811a\u672c\u4e2d\uff0c\u4ee5\u539f\u5b50\u6027\u65b9\u5f0f\u6267\u884c\u5355\u4e2a Lua \u811a\u672c\u3002","title":"2\u3001Redis \u7684\u4e24\u79cd\u539f\u5b50\u64cd\u4f5c\u65b9\u6cd5"},{"location":"chap6/2redis_locks/#2-1-redis","text":"Redis \u662f\u4f7f\u7528\u5355\u7ebf\u7a0b\u6765\u4e32\u884c\u5904\u7406\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u64cd\u4f5c\u547d\u4ee4\u7684\uff0c\u6240\u4ee5\uff0c\u5f53 Redis \u6267\u884c\u67d0\u4e2a\u547d\u4ee4\u64cd\u4f5c\u65f6\uff0c\u5176\u4ed6\u547d\u4ee4\u662f\u65e0\u6cd5\u6267\u884c\u7684\uff0c\u8fd9\u76f8\u5f53\u4e8e\u547d\u4ee4\u64cd\u4f5c\u662f\u4e92\u65a5\u6267\u884c\u7684\u3002 \u5f53\u7136\uff0cRedis \u7684\u5feb\u7167\u751f\u6210\u3001AOF \u91cd\u5199\u8fd9\u4e9b\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4f7f\u7528\u540e\u53f0\u7ebf\u7a0b\u6216\u8005\u662f\u5b50\u8fdb\u7a0b\u6267\u884c\uff0c\u4e5f\u5c31\u662f\u548c\u4e3b\u7ebf\u7a0b\u7684\u64cd\u4f5c\u5e76\u884c\u6267\u884c\u3002 \u4e0d\u8fc7\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u53ea\u662f\u8bfb\u53d6\u6570\u636e\uff0c\u4e0d\u4f1a\u4fee\u6539\u6570\u636e\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u5bf9\u5b83\u4eec\u505a\u5e76\u53d1\u63a7\u5236\u3002 \u867d\u7136 Redis \u7684\u5355\u4e2a\u547d\u4ee4\u64cd\u4f5c\u53ef\u4ee5\u539f\u5b50\u6027\u5730\u6267\u884c\uff0c\u4f46\u662f\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u6570\u636e\u4fee\u6539\u65f6\u53ef\u80fd\u5305\u542b\u591a\u4e2a\u64cd\u4f5c\uff0c\u81f3\u5c11\u5305\u62ec\u8bfb\u6570\u636e\u3001\u6570\u636e\u589e\u51cf\u3001\u5199\u56de\u6570\u636e\u4e09\u4e2a\u64cd\u4f5c\uff0c\u8fd9\u663e\u7136\u5c31\u4e0d\u662f\u5355\u4e2a\u547d\u4ee4\u64cd\u4f5c\u4e86\uff0c\u90a3\u8be5\u600e\u4e48\u529e\u5462\uff1f Redis \u63d0\u4f9b\u4e86 INCR/DECR \u547d\u4ee4\uff0c\u628a\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u8f6c\u53d8\u4e3a\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\u4e86 \u3002 INCR/DECR \u547d\u4ee4\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u589e\u503c / \u51cf\u503c\u64cd\u4f5c\uff0c\u800c\u4e14\u5b83\u4eec\u672c\u8eab\u5c31\u662f\u5355\u4e2a\u547d\u4ee4\u64cd\u4f5c\uff0cRedis \u5728\u6267\u884c\u5b83\u4eec\u65f6\uff0c\u672c\u8eab\u5c31\u5177\u6709\u4e92\u65a5\u6027 \u6bd4\u5982\u8bf4\uff0c\u5728\u521a\u624d\u7684\u5e93\u5b58\u6263\u51cf\u4f8b\u5b50\u4e2d\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u76f4\u63a5\u5b8c\u6210\u5bf9\u5546\u54c1 id \u7684\u5e93\u5b58\u503c\u51cf 1 \u64cd\u4f5c\u3002 \u5373\u4f7f\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u6267\u884c\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u4e5f\u4e0d\u7528\u62c5\u5fc3\u51fa\u73b0\u5e93\u5b58\u503c\u6263\u51cf\u9519\u8bef\u7684\u95ee\u9898 \u3002 DECR id \u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u8981\u6267\u884c\u7684\u64cd\u4f5c\u4e0d\u662f\u7b80\u5355\u5730\u589e\u51cf\u6570\u636e\uff0c\u800c\u662f\u6709\u66f4\u52a0\u590d\u6742\u7684\u5224\u65ad\u903b\u8f91\u6216\u8005\u662f\u5176\u4ed6\u64cd\u4f5c\uff0c\u90a3\u4e48\uff0cRedis \u7684\u5355\u547d\u4ee4\u64cd\u4f5c\u5df2\u7ecf\u65e0\u6cd5\u4fdd\u8bc1\u591a\u4e2a\u64cd\u4f5c\u7684\u4e92\u65a5\u6267\u884c\u4e86\u3002 \u6240\u4ee5\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528\u7b2c\u4e8c\u4e2a\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f Lua \u811a\u672c\u3002","title":"2-1 Redis \u672c\u8eab\u7684\u5355\u547d\u4ee4\u64cd\u4f5c"},{"location":"chap6/2redis_locks/#2-2-lua","text":"Redis \u4f1a\u628a\u6574\u4e2a Lua \u811a\u672c\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u6267\u884c\uff0c\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u4e0d\u4f1a\u88ab\u5176\u4ed6\u547d\u4ee4\u6253\u65ad\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86 Lua \u811a\u672c\u4e2d\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002 \u5982\u679c\u6211\u4eec\u6709\u591a\u4e2a\u64cd\u4f5c\u8981\u6267\u884c\uff0c\u4f46\u662f\u53c8\u65e0\u6cd5\u7528 INCR/DECR \u8fd9\u79cd\u547d\u4ee4\u64cd\u4f5c\u6765\u5b9e\u73b0\uff0c\u5c31\u53ef\u4ee5\u628a\u8fd9\u4e9b\u8981\u6267\u884c\u7684\u64cd\u4f5c\u7f16\u5199\u5230\u4e00\u4e2a Lua \u811a\u672c\u4e2d\u3002 \u7136\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Redis \u7684 EVAL \u547d\u4ee4\u6765\u6267\u884c\u811a\u672c\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u5728\u6267\u884c\u65f6\u5c31\u5177\u6709\u4e86\u4e92\u65a5\u6027\u3002 \u5f53\u4e00\u4e2a\u4e1a\u52a1\u5e94\u7528\u7684\u8bbf\u95ee\u7528\u6237\u589e\u52a0\u65f6\uff0c\u6211\u4eec\u6709\u65f6\u9700\u8981\u9650\u5236\u67d0\u4e2a\u5ba2\u6237\u7aef\u5728\u4e00\u5b9a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u6bd4\u5982\u7206\u6b3e\u5546\u54c1\u7684\u8d2d\u4e70\u9650\u6d41\u3001\u793e\u4ea4\u7f51\u7edc\u4e2d\u7684\u6bcf\u5206\u949f\u70b9\u8d5e\u6b21\u6570\u9650\u5236\u7b49\u3002 \u90a3\u8be5\u600e\u4e48\u9650\u5236\u5462\uff1f \u6211\u4eec\u53ef\u4ee5\u628a\u5ba2\u6237\u7aef IP \u4f5c\u4e3a key\uff0c\u628a\u5ba2\u6237\u7aef\u7684\u8bbf\u95ee\u6b21\u6570\u4f5c\u4e3a value\uff0c\u4fdd\u5b58\u5230 Redis \u4e2d\u3002\u5ba2\u6237\u7aef\u6bcf\u8bbf\u95ee\u4e00\u6b21\u540e\uff0c\u6211\u4eec\u5c31\u7528 INCR \u589e\u52a0\u8bbf\u95ee\u6b21\u6570\u3002 \u4e0d\u8fc7\uff0c\u5728\u8fd9\u79cd\u573a\u666f\u4e0b\uff0c\u5ba2\u6237\u7aef\u9650\u6d41\u5176\u5b9e\u540c\u65f6\u5305\u542b\u4e86\u5bf9\u8bbf\u95ee\u6b21\u6570\u548c\u65f6\u95f4\u8303\u56f4\u7684\u9650\u5236\uff0c\u4f8b\u5982\u6bcf\u5206\u949f\u7684\u8bbf\u95ee\u6b21\u6570\u4e0d\u80fd\u8d85\u8fc7 20\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u7b2c\u4e00\u6b21\u8bbf\u95ee\u65f6\uff0c\u7ed9\u5bf9\u5e94\u952e\u503c\u5bf9\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u4f8b\u5982\u8bbe\u7f6e\u4e3a 60s \u540e\u8fc7\u671f\u3002 \u540c\u65f6\uff0c\u5728\u5ba2\u6237\u7aef\u6bcf\u6b21\u8bbf\u95ee\u65f6\uff0c\u6211\u4eec\u8bfb\u53d6\u5ba2\u6237\u7aef\u5f53\u524d\u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u5982\u679c\u6b21\u6570\u8d85\u8fc7\u9608\u503c\uff0c\u5c31\u62a5\u9519\uff0c\u9650\u5236\u5ba2\u6237\u7aef\u518d\u6b21\u8bbf\u95ee\u3002 \u4e0b\u9762\u7684\u8fd9\u6bb5\u4ee3\u7801\uff0c\u5b83\u5b9e\u73b0\u4e86\u5bf9\u5ba2\u6237\u7aef\u6bcf\u5206\u949f\u8bbf\u95ee\u6b21\u6570\u4e0d\u8d85\u8fc7 20 \u6b21\u7684\u9650\u5236\u3002 //\u83b7\u53d6ip\u5bf9\u5e94\u7684\u8bbf\u95ee\u6b21\u6570 current = GET(ip) //\u5982\u679c\u8d85\u8fc7\u8bbf\u95ee\u6b21\u6570\u8d85\u8fc720\u6b21\uff0c\u5219\u62a5\u9519 IF current != NULL AND current > 20 THEN ERROR \"exceed 20 accesses per second\" ELSE //\u5982\u679c\u8bbf\u95ee\u6b21\u6570\u4e0d\u8db320\u6b21\uff0c\u589e\u52a0\u4e00\u6b21\u8bbf\u95ee\u8ba1\u6570 value = INCR(ip) //\u5982\u679c\u662f\u7b2c\u4e00\u6b21\u8bbf\u95ee\uff0c\u5c06\u952e\u503c\u5bf9\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a60s\u540e IF value == 1 THEN EXPIRE(ip,60) END //\u6267\u884c\u5176\u4ed6\u64cd\u4f5c DO THINGS END \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u5df2\u7ecf\u4f7f\u7528\u4e86 INCR \u6765\u539f\u5b50\u6027\u5730\u589e\u52a0\u8ba1\u6570\u3002\u4f46\u662f\uff0c\u5ba2\u6237\u7aef\u9650\u6d41\u7684\u903b\u8f91\u4e0d\u53ea\u6709\u8ba1\u6570\uff0c \u8fd8\u5305\u62ec\u8bbf\u95ee\u6b21\u6570\u5224\u65ad\u548c\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u3002 \u5bf9\u4e8e\u8fd9\u4e9b\u64cd\u4f5c\uff0c\u6211\u4eec\u540c\u6837\u9700\u8981\u4fdd\u8bc1\u5b83\u4eec\u7684\u539f\u5b50\u6027\u3002 \u5426\u5219\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u4f7f\u7528\u591a\u7ebf\u7a0b\u8bbf\u95ee\uff0c\u8bbf\u95ee\u6b21\u6570\u521d\u59cb\u503c\u4e3a 0\uff0c\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u4e86 INCR(ip) \u64cd\u4f5c\u540e\uff0c\u7b2c\u4e8c\u4e2a\u7ebf\u7a0b\u7d27\u63a5\u7740\u4e5f\u6267\u884c\u4e86 INCR(ip)\uff0c\u6b64\u65f6\uff0cip \u5bf9\u5e94\u7684\u8bbf\u95ee\u6b21\u6570\u5c31\u88ab\u589e\u52a0\u5230\u4e86 2\uff0c\u6211\u4eec\u5c31\u65e0\u6cd5\u518d\u5bf9\u8fd9\u4e2a ip \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u4e86\u3002 \u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\uff0c\u8fd9\u4e2a ip \u5bf9\u5e94\u7684\u5ba2\u6237\u7aef\u8bbf\u95ee\u6b21\u6570\u8fbe\u5230 20 \u6b21\u4e4b\u540e\uff0c\u5c31\u65e0\u6cd5\u518d\u8fdb\u884c\u8bbf\u95ee\u4e86\u3002\u5373\u4f7f\u8fc7\u4e86 60s\uff0c\u4e5f\u4e0d\u80fd\u518d\u7ee7\u7eed\u8bbf\u95ee\uff0c\u663e\u7136\u4e0d\u7b26\u5408\u4e1a\u52a1\u8981\u6c42\u3002 \u6240\u4ee5\uff0c\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u7684\u64cd\u4f5c\u65e0\u6cd5\u7528 Redis \u5355\u4e2a\u547d\u4ee4\u6765\u5b9e\u73b0\uff0c\u6b64\u65f6\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 Lua \u811a\u672c\u6765\u4fdd\u8bc1\u5e76\u53d1\u63a7\u5236\u3002 \u6211\u4eec\u53ef\u4ee5\u628a\u8bbf\u95ee\u6b21\u6570\u52a0 1 \u5224\u65ad\u8bbf\u95ee\u6b21\u6570\u662f\u5426\u4e3a 1 \u4ee5\u53ca\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u5199\u5165\u4e00\u4e2a Lua \u811a\u672c \u5982\u4e0b\u6240\u793a\uff1a local current current = redis.call(\"incr\",KEYS[1]) if tonumber(current) == 1 then redis.call(\"expire\",KEYS[1],60) end \u7f16\u5199\u7684\u811a\u672c\u540d\u79f0\u4e3a lua.script \uff0c\u6211\u4eec\u63a5\u7740\u5c31\u53ef\u4ee5\u4f7f\u7528 Redis \u5ba2\u6237\u7aef\uff0c\u5e26\u4e0a eval \u9009\u9879\uff0c\u6765\u6267\u884c\u8be5\u811a\u672c\u3002\u811a\u672c\u6240\u9700\u7684\u53c2\u6570\u5c06\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u4e2d\u7684 keys \u548c args \u8fdb\u884c\u4f20\u9012\u3002 redis-cli --eval lua.script keys , args \u8fd9\u6837\u4e00\u6765\uff0c\u8bbf\u95ee\u6b21\u6570\u52a0 1\u3001\u5224\u65ad\u8bbf\u95ee\u6b21\u6570\u662f\u5426\u4e3a 1\uff0c\u4ee5\u53ca\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u5c31\u53ef\u4ee5\u539f\u5b50\u6027\u5730\u6267\u884c\u4e86\u3002\u5373\u4f7f\u5ba2\u6237\u7aef\u6709\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u6267\u884c\u8fd9\u4e2a\u811a\u672c\uff0cRedis \u4e5f\u4f1a\u4f9d\u6b21\u4e32\u884c\u6267\u884c\u811a\u672c\u4ee3\u7801\uff0c\u907f\u514d\u4e86\u5e76\u53d1\u64cd\u4f5c\u5e26\u6765\u7684\u6570\u636e\u9519\u8bef\u3002","title":"2-2 Lua \u811a\u672c"},{"location":"chap6/2redis_locks/#3","text":"\u5728\u5e76\u53d1\u8bbf\u95ee\u65f6\uff0c\u5e76\u53d1\u7684 RMW \u64cd\u4f5c\u4f1a\u5bfc\u81f4\u6570\u636e\u9519\u8bef\uff0c\u6240\u4ee5\u9700\u8981\u8fdb\u884c\u5e76\u53d1\u63a7\u5236\u3002\u6240\u8c13\u5e76\u53d1\u63a7\u5236\uff0c\u5c31\u662f\u8981\u4fdd\u8bc1\u4e34\u754c\u533a\u4ee3\u7801\u7684\u4e92\u65a5\u6267\u884c\u3002 Redis \u63d0\u4f9b\u4e86\u4e24\u79cd\u539f\u5b50\u64cd\u4f5c\u7684\u65b9\u6cd5\u6765\u5b9e\u73b0\u5e76\u53d1\u63a7\u5236\uff0c\u5206\u522b\u662f\u5355\u547d\u4ee4\u64cd\u4f5c\u548c Lua \u811a\u672c\u3002 \u56e0\u4e3a\u539f\u5b50\u64cd\u4f5c\u672c\u8eab\u4e0d\u4f1a\u5bf9\u592a\u591a\u7684\u8d44\u6e90\u9650\u5236\u8bbf\u95ee\uff0c\u53ef\u4ee5\u7ef4\u6301\u8f83\u9ad8\u7684\u7cfb\u7edf\u5e76\u53d1\u6027\u80fd\u3002 \u4f46\u662f\uff0c\u5355\u547d\u4ee4\u539f\u5b50\u64cd\u4f5c\u7684\u9002\u7528\u8303\u56f4\u8f83\u5c0f\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u7684 RMW \u64cd\u4f5c\u90fd\u80fd\u8f6c\u53d8\u6210\u5355\u547d\u4ee4\u7684\u539f\u5b50\u64cd\u4f5c\uff08\u4f8b\u5982 INCR/DECR \u547d\u4ee4\u53ea\u80fd\u5728\u8bfb\u53d6\u6570\u636e\u540e\u505a\u539f\u5b50\u589e\u51cf\uff09\uff0c\u5f53\u6211\u4eec\u9700\u8981\u5bf9\u8bfb\u53d6\u7684\u6570\u636e\u505a\u66f4\u591a\u5224\u65ad\uff0c\u6216\u8005\u662f\u6211\u4eec\u5bf9\u6570\u636e\u7684\u4fee\u6539\u4e0d\u662f\u7b80\u5355\u7684\u589e\u51cf\u65f6\uff0c\u5355\u547d\u4ee4\u64cd\u4f5c\u5c31\u4e0d\u9002\u7528\u4e86\u3002 \u800c Redis \u7684 Lua \u811a\u672c\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u64cd\u4f5c\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u4f1a\u4ee5\u539f\u5b50\u6027\u7684\u65b9\u5f0f\u6267\u884c\uff0c\u7ed5\u5f00\u4e86\u5355\u547d\u4ee4\u64cd\u4f5c\u7684\u9650\u5236\u3002 \u4e0d\u8fc7\uff0c\u5982\u679c\u628a\u5f88\u591a\u64cd\u4f5c\u90fd\u653e\u5728 Lua \u811a\u672c\u4e2d\u539f\u5b50\u6267\u884c\uff0c\u4f1a\u5bfc\u81f4 Redis \u6267\u884c\u811a\u672c\u7684\u65f6\u95f4\u589e\u52a0\uff0c\u540c\u6837\u4e5f\u4f1a\u964d\u4f4e Redis \u7684\u5e76\u53d1\u6027\u80fd\u3002\u6240\u4ee5\uff0c\u6211\u7ed9\u4f60\u4e00\u4e2a\u5c0f\u5efa\u8bae\uff1a\u5728\u7f16\u5199 Lua \u811a\u672c\u65f6\uff0c\u4f60\u8981\u907f\u514d\u628a\u4e0d\u9700\u8981\u505a\u5e76\u53d1\u63a7\u5236\u7684\u64cd\u4f5c\u5199\u5165\u811a\u672c\u4e2d\u3002 \u5f53\u7136\uff0c\u52a0\u9501\u4e5f\u80fd\u5b9e\u73b0\u4e34\u754c\u533a\u4ee3\u7801\u7684\u4e92\u65a5\u6267\u884c\uff0c\u53ea\u662f\u5982\u679c\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u52a0\u9501\u65f6\uff0c\u5c31\u9700\u8981\u5206\u5e03\u5f0f\u9501\u7684\u652f\u6301\u4e86","title":"3\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap6/3redis_distributed_locks/","text":"\u7b2c\u4e09\u8282 Redis\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501 \u5e94\u5bf9\u5e76\u53d1\u95ee\u9898\u65f6\uff0c\u9664\u4e86\u539f\u5b50\u64cd\u4f5c\uff0cRedis \u5ba2\u6237\u7aef\u8fd8\u53ef\u4ee5\u901a\u8fc7\u52a0\u9501\u7684\u65b9\u5f0f\uff0c\u6765\u63a7\u5236\u5e76\u53d1\u5199\u64cd\u4f5c\u5bf9\u5171\u4eab\u6570\u636e\u7684\u4fee\u6539\uff0c\u4ece\u800c\u4fdd\u8bc1\u6570\u636e\u7684\u6b63\u786e\u6027\u3002 Redis \u5c5e\u4e8e\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u5f53\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u9700\u8981\u4e89\u62a2\u9501\u65f6\uff0c\u5fc5\u987b\u8981\u4fdd\u8bc1\uff0c \u8fd9\u628a\u9501\u4e0d\u80fd\u662f\u67d0\u4e2a\u5ba2\u6237\u7aef\u672c\u5730\u7684\u9501 \u3002\u5426\u5219\u7684\u8bdd\uff0c\u5176\u5b83\u5ba2\u6237\u7aef\u662f\u65e0\u6cd5\u8bbf\u95ee\u8fd9\u628a\u9501\u7684\uff0c\u5f53\u7136\u4e5f\u5c31\u4e0d\u80fd\u83b7\u53d6\u8fd9\u628a\u9501\u4e86\u3002 \u6240\u4ee5\uff0c\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u5f53\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u9700\u8981\u83b7\u53d6\u9501\u65f6\uff0c\u6211\u4eec\u9700\u8981 \u5206\u5e03\u5f0f\u9501 \u3002\u6b64\u65f6\uff0c \u9501\u662f\u4fdd\u5b58\u5728\u4e00\u4e2a\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u4e2d\u7684\uff0c\u53ef\u4ee5\u88ab\u591a\u4e2a\u5ba2\u6237\u7aef\u5171\u4eab\u8bbf\u95ee\u548c\u83b7\u53d6\u3002 Redis \u672c\u8eab\u53ef\u4ee5\u88ab\u591a\u4e2a\u5ba2\u6237\u7aef\u5171\u4eab\u8bbf\u95ee\uff0c\u6b63\u597d\u5c31\u662f\u4e00\u4e2a\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\uff0c\u53ef\u4ee5\u7528\u6765\u4fdd\u5b58\u5206\u5e03\u5f0f\u9501\u3002 \u800c\u4e14 Redis \u7684\u8bfb\u5199\u6027\u80fd\u9ad8\uff0c\u53ef\u4ee5\u5e94\u5bf9\u9ad8\u5e76\u53d1\u7684\u9501\u64cd\u4f5c\u573a\u666f\u3002 1\u3001\u5355\u673a\u4e0a\u7684\u9501\u548c\u5206\u5e03\u5f0f\u9501\u7684\u8054\u7cfb\u4e0e\u533a\u522b 1-1 \u5355\u673a\u4e0a\u7684\u9501 \u5bf9\u4e8e\u5728\u5355\u673a\u4e0a\u8fd0\u884c\u7684\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u6765\u8bf4\uff0c\u9501\u672c\u8eab\u53ef\u4ee5\u7528\u4e00\u4e2a\u53d8\u91cf\u8868\u793a\u3002 \u53d8\u91cf\u503c\u4e3a 0 \u65f6\uff0c\u8868\u793a\u6ca1\u6709\u7ebf\u7a0b\u83b7\u53d6\u9501\uff1b \u53d8\u91cf\u503c\u4e3a 1 \u65f6\uff0c\u8868\u793a\u5df2\u7ecf\u6709\u7ebf\u7a0b\u83b7\u53d6\u5230\u9501\u4e86\u3002 \u7ebf\u7a0b\u8c03\u7528\u52a0\u9501\u548c\u91ca\u653e\u9501\u7684\u64cd\u4f5c\uff0c\u5230\u5e95\u662f\u5565\u610f\u601d\u5462\uff1f \u5b9e\u9645\u4e0a\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u8c03\u7528\u52a0\u9501\u64cd\u4f5c\uff0c\u5176\u5b9e\u5c31\u662f\u68c0\u67e5\u9501\u53d8\u91cf\u503c\u662f\u5426\u4e3a 0\u3002\u5982\u679c\u662f 0\uff0c\u5c31\u628a\u9501\u7684\u53d8\u91cf\u503c\u8bbe\u7f6e\u4e3a 1\uff0c\u8868\u793a\u83b7\u53d6\u5230\u9501\uff0c\u5982\u679c\u4e0d\u662f 0\uff0c\u5c31\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\uff0c\u8868\u793a\u52a0\u9501\u5931\u8d25\uff0c\u5df2\u7ecf\u6709\u522b\u7684\u7ebf\u7a0b\u83b7\u53d6\u5230\u9501\u4e86\u3002\u800c\u4e00\u4e2a\u7ebf\u7a0b\u8c03\u7528\u91ca\u653e\u9501\u64cd\u4f5c\uff0c\u5176\u5b9e\u5c31\u662f\u5c06\u9501\u53d8\u91cf\u7684\u503c\u7f6e\u4e3a 0\uff0c\u4ee5\u4fbf\u5176\u5b83\u7ebf\u7a0b\u53ef\u4ee5\u6765\u83b7\u53d6\u9501\u3002 acquire_lock(){ if lock == 0 lock = 1 return 1 else return 0 } release_lock(){ lock = 0 return 1 } 1-2 \u5206\u5e03\u5f0f\u9501 \u548c\u5355\u673a\u4e0a\u7684\u9501\u7c7b\u4f3c\uff0c\u5206\u5e03\u5f0f\u9501\u540c\u6837\u53ef\u4ee5 \u7528\u4e00\u4e2a\u53d8\u91cf\u6765\u5b9e\u73b0 \u3002 \u5ba2\u6237\u7aef\u52a0\u9501\u548c\u91ca\u653e\u9501\u7684\u64cd\u4f5c\u903b\u8f91\uff0c\u4e5f\u548c\u5355\u673a\u4e0a\u7684\u52a0\u9501\u548c\u91ca\u653e\u9501\u64cd\u4f5c\u903b\u8f91\u4e00\u81f4\uff1a \u52a0\u9501\u65f6\u540c\u6837\u9700\u8981\u5224\u65ad\u9501\u53d8\u91cf\u7684\u503c\uff0c\u6839\u636e\u9501\u53d8\u91cf\u503c\u6765\u5224\u65ad\u80fd\u5426\u52a0\u9501\u6210\u529f\uff1b\u91ca\u653e\u9501\u65f6\u9700\u8981\u628a\u9501\u53d8\u91cf\u503c\u8bbe\u7f6e\u4e3a 0\uff0c\u8868\u660e\u5ba2\u6237\u7aef\u4e0d\u518d\u6301\u6709\u9501\u3002 \u548c\u7ebf\u7a0b\u5728\u5355\u673a\u4e0a\u64cd\u4f5c\u9501\u4e0d\u540c\u7684\u662f\uff0c\u5728\u5206\u5e03\u5f0f\u573a\u666f\u4e0b\uff0c \u9501\u53d8\u91cf\u9700\u8981\u7531\u4e00\u4e2a\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u6765\u7ef4\u62a4\uff0c\u53ea\u6709\u8fd9\u6837\uff0c\u591a\u4e2a\u5ba2\u6237\u7aef\u624d\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u6765\u8bbf\u95ee\u9501\u53d8\u91cf\u3002\u76f8\u5e94\u7684\uff0c\u52a0\u9501\u548c\u91ca\u653e\u9501\u7684\u64cd\u4f5c\u5c31\u53d8\u6210\u4e86\u8bfb\u53d6\u3001\u5224\u65ad\u548c\u8bbe\u7f6e\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u4e2d\u7684\u9501\u53d8\u91cf\u503c \u3002 \u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u7684\u4e24\u4e2a\u8981\u6c42 \u8981\u6c42\u4e00\uff1a\u5206\u5e03\u5f0f\u9501\u7684\u52a0\u9501\u548c\u91ca\u653e\u9501\u7684\u8fc7\u7a0b\uff0c\u6d89\u53ca\u591a\u4e2a\u64cd\u4f5c\u3002\u6240 \u4ee5\uff0c\u5728\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u65f6\uff0c\u6211\u4eec\u9700\u8981\u4fdd\u8bc1\u8fd9\u4e9b\u9501\u64cd\u4f5c\u7684\u539f\u5b50\u6027 \uff1b \u8981\u6c42\u4e8c\uff1a\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u4fdd\u5b58\u4e86\u9501\u53d8\u91cf\uff0c\u5982\u679c\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u53d1\u751f\u6545\u969c\u6216\u5b95\u673a\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u4e5f\u5c31\u65e0\u6cd5\u8fdb\u884c\u9501\u64cd\u4f5c\u4e86 \u3002\u5728\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u65f6\uff0c\u6211\u4eec\u9700\u8981\u8003\u8651\u4fdd\u8bc1\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u7684\u53ef\u9760\u6027\uff0c\u8fdb\u800c\u4fdd\u8bc1\u9501\u7684\u53ef\u9760\u6027 \u3002 2\u3001\u57fa\u4e8e\u5355\u4e2a Redis \u8282\u70b9\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501 2-1 \u9501\u53d8\u91cf \u4f5c\u4e3a\u5206\u5e03\u5f0f\u9501\u5b9e\u73b0\u8fc7\u7a0b\u4e2d\u7684\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\uff0c Redis \u53ef\u4ee5\u4f7f\u7528\u952e\u503c\u5bf9\u6765\u4fdd\u5b58\u9501\u53d8\u91cf \uff0c\u518d\u63a5\u6536\u548c\u5904\u7406\u4e0d\u540c\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u52a0\u9501\u548c\u91ca\u653e\u9501\u7684\u64cd\u4f5c\u8bf7\u6c42\u3002 \u6211\u4eec\u8981\u8d4b\u4e88\u9501\u53d8\u91cf\u4e00\u4e2a\u53d8\u91cf\u540d \uff0c\u628a\u8fd9\u4e2a\u53d8\u91cf\u540d\u4f5c\u4e3a\u952e\u503c\u5bf9\u7684\u952e\uff0c\u800c\u9501\u53d8\u91cf\u7684\u503c\uff0c\u5219\u662f\u952e\u503c\u5bf9\u7684\u503c \uff0c\u8fd9\u6837\u4e00\u6765\uff0cRedis \u5c31\u80fd\u4fdd\u5b58\u9501\u53d8\u91cf\u4e86\uff0c\u5ba2\u6237\u7aef\u4e5f\u5c31\u53ef\u4ee5\u901a\u8fc7 Redis \u7684\u547d\u4ee4\u64cd\u4f5c\u6765\u5b9e\u73b0\u9501\u64cd\u4f5c\u3002 Redis \u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u952e\u503c\u5bf9 lock_key:0 \u6765\u4fdd\u5b58\u9501\u53d8\u91cf\uff0c\u5176\u4e2d\uff0c\u952e\u662f lock_key \uff0c\u4e5f\u662f\u9501\u53d8\u91cf\u7684\u540d\u79f0\uff0c\u9501\u53d8\u91cf\u7684\u521d\u59cb\u503c\u662f 0\u3002 2-2 \u52a0\u9501\u64cd\u4f5c \u5728\u56fe\u4e2d\uff0c\u5ba2\u6237\u7aef A \u548c C \u540c\u65f6\u8bf7\u6c42\u52a0\u9501\u3002\u56e0\u4e3a Redis \u4f7f\u7528\u5355\u7ebf\u7a0b\u5904\u7406\u8bf7\u6c42\uff0c\u6240\u4ee5\uff0c\u5373\u4f7f\u5ba2\u6237\u7aef A \u548c C \u540c\u65f6\u628a\u52a0\u9501\u8bf7\u6c42\u53d1\u7ed9\u4e86 Redis\uff0cRedis \u4e5f\u4f1a\u4e32\u884c\u5904\u7406\u5b83\u4eec\u7684\u8bf7\u6c42\u3002 \u6211\u4eec\u5047\u8bbe Redis \u5148\u5904\u7406\u5ba2\u6237\u7aef A \u7684\u8bf7\u6c42\uff0c\u8bfb\u53d6 lock_key \u7684\u503c\uff0c\u53d1\u73b0 lock_key \u4e3a 0 \uff0c\u6240\u4ee5\uff0cRedis \u5c31\u628a lock_key \u7684 value \u7f6e\u4e3a 1 \uff0c\u8868\u793a\u5df2\u7ecf\u52a0\u9501\u4e86\u3002 \u7d27\u63a5\u7740\uff0cRedis \u5904\u7406\u5ba2\u6237\u7aef C \u7684\u8bf7\u6c42\uff0c\u6b64\u65f6\uff0cRedis \u4f1a\u53d1\u73b0 lock_key \u7684\u503c\u5df2\u7ecf\u4e3a 1 \u4e86\uff0c\u6240\u4ee5\u5c31\u8fd4\u56de\u52a0\u9501\u5931\u8d25\u7684\u4fe1\u606f\u3002 \u521a\u521a\u8bf4\u7684\u662f\u52a0\u9501\u7684\u64cd\u4f5c\uff0c\u90a3\u91ca\u653e\u9501\u8be5\u600e\u4e48\u64cd\u4f5c\u5462\uff1f\u5176\u5b9e\uff0c\u91ca\u653e\u9501\u5c31\u662f\u76f4\u63a5\u628a\u9501\u53d8\u91cf\u503c\u8bbe\u7f6e\u4e3a 0\u3002 \u8fd9\u5f20\u56fe\u7247\u5c55\u793a\u4e86\u5ba2\u6237\u7aef A \u8bf7\u6c42\u91ca\u653e\u9501\u7684\u8fc7\u7a0b\u3002\u5f53\u5ba2\u6237\u7aef A \u6301\u6709\u9501\u65f6\uff0c\u9501\u53d8\u91cf lock_key \u7684\u503c\u4e3a 1\u3002\u5ba2\u6237\u7aef A \u6267\u884c\u91ca\u653e\u9501\u64cd\u4f5c\u540e\uff0cRedis \u5c06 lock_key \u7684\u503c\u7f6e\u4e3a 0\uff0c\u8868\u660e\u5df2\u7ecf\u6ca1\u6709\u5ba2\u6237\u7aef\u6301\u6709\u9501\u4e86\u3002 \u56e0\u4e3a\u52a0\u9501\u5305\u542b\u4e86\u4e09\u4e2a\u64cd\u4f5c\uff08\u8bfb\u53d6\u9501\u53d8\u91cf\u3001\u5224\u65ad\u9501\u53d8\u91cf\u503c\u4ee5\u53ca\u628a\u9501\u53d8\u91cf\u503c\u8bbe\u7f6e\u4e3a 1\uff09\uff0c\u800c\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u5728\u6267\u884c\u65f6\u9700\u8981\u4fdd\u8bc1\u539f\u5b50\u6027\u3002\u90a3\u600e\u4e48\u4fdd\u8bc1\u539f\u5b50\u6027\u5462\uff1f \u8981\u60f3\u4fdd\u8bc1\u64cd\u4f5c\u7684\u539f\u5b50\u6027\uff0c\u6709\u4e24\u79cd\u901a\u7528\u7684\u65b9\u6cd5\uff0c\u5206\u522b\u662f\u4f7f\u7528 Redis \u7684\u5355\u547d\u4ee4\u64cd\u4f5c\u548c\u4f7f\u7528 Lua \u811a\u672c\u3002\u90a3\u4e48\uff0c \u5728\u5206\u5e03\u5f0f\u52a0\u9501\u573a\u666f\u4e0b\uff0c\u8be5\u600e\u4e48\u5e94\u7528\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u5462\uff1f 2-3 \u5206\u5e03\u5f0f\u52a0\u9501\u573a\u666f\u4e0b\u7684\u539f\u5b50\u6027 \u5355\u547d\u4ee4\u64cd\u4f5c\u5b9e\u73b0\u52a0\u9501\u64cd\u4f5c \u9996\u5148\u662f SETNX \u547d\u4ee4\uff0c\u5b83\u7528\u4e8e\u8bbe\u7f6e\u952e\u503c\u5bf9\u7684\u503c\u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u5c31\u662f\u8fd9\u4e2a\u547d\u4ee4\u5728\u6267\u884c\u65f6\u4f1a\u5224\u65ad\u952e\u503c\u5bf9\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5c31\u8bbe\u7f6e\u952e\u503c\u5bf9\u7684\u503c\uff0c\u5982\u679c\u5b58\u5728\uff0c\u5c31\u4e0d\u505a\u4efb\u4f55\u8bbe\u7f6e\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c \u5982\u679c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0ckey \u4e0d\u5b58\u5728\uff0c\u90a3\u4e48 key \u4f1a\u88ab\u521b\u5efa\uff0c\u5e76\u4e14\u503c\u4f1a\u88ab\u8bbe\u7f6e\u4e3a value\uff1b\u5982\u679c key \u5df2\u7ecf\u5b58\u5728\uff0cSETNX \u4e0d\u505a\u4efb\u4f55\u8d4b\u503c\u64cd\u4f5c \u3002 SETNX key value \u5bf9\u4e8e\u91ca\u653e\u9501\u64cd\u4f5c\u6765\u8bf4\uff0c\u53ef\u4ee5\u5728\u6267\u884c\u5b8c\u4e1a\u52a1\u903b\u8f91\u540e\uff0c \u4f7f\u7528 DEL \u547d\u4ee4\u5220\u9664\u9501\u53d8\u91cf\u3002 \u4e0d\u8fc7\uff0c\u4f60\u4e0d\u7528\u62c5\u5fc3\u9501\u53d8\u91cf\u88ab\u5220\u9664\u540e\uff0c\u5176\u4ed6\u5ba2\u6237\u7aef\u65e0\u6cd5\u8bf7\u6c42\u52a0\u9501\u4e86\u3002 \u56e0\u4e3a SETNX \u547d\u4ee4\u5728\u6267\u884c\u65f6\uff0c\u5982\u679c\u8981\u8bbe\u7f6e\u7684\u952e\u503c\u5bf9\uff08\u4e5f\u5c31\u662f\u9501\u53d8\u91cf\uff09\u4e0d\u5b58\u5728\uff0cSETNX \u547d\u4ee4\u4f1a\u5148\u521b\u5efa\u952e\u503c\u5bf9\uff0c\u7136\u540e\u8bbe\u7f6e\u5b83\u7684\u503c \u3002 \u6240\u4ee5\uff0c\u91ca\u653e\u9501\u4e4b\u540e\uff0c\u518d\u6709\u5ba2\u6237\u7aef\u8bf7\u6c42\u52a0\u9501\u65f6\uff0cSETNX \u547d\u4ee4\u4f1a\u521b\u5efa\u4fdd\u5b58\u9501\u53d8\u91cf\u7684\u952e\u503c\u5bf9\uff0c\u5e76\u8bbe\u7f6e\u9501\u53d8\u91cf\u7684\u503c\uff0c\u5b8c\u6210\u52a0\u9501\u3002 \u603b\u7ed3\u6765\u8bf4\uff0c \u53ef\u4ee5\u7528 SETNX \u548c DEL \u547d\u4ee4\u7ec4\u5408\u6765\u5b9e\u73b0\u52a0\u9501\u548c\u91ca\u653e\u9501\u64cd\u4f5c \u3002\u4e0b\u9762\u7684\u4f2a\u4ee3\u7801\u793a\u4f8b\u663e\u793a\u4e86\u9501\u64cd\u4f5c\u7684\u8fc7\u7a0b\uff0c\u4f60\u53ef\u4ee5\u770b\u4e0b\u3002 // \u52a0\u9501 SETNX lock_key 1 // \u4e1a\u52a1\u903b\u8f91 DO THINGS // \u91ca\u653e\u9501 DEL lock_key \u4f7f\u7528 SETNX \u548c DEL \u547d\u4ee4\u7ec4\u5408\u5b9e\u73b0\u5206\u5e03\u9501\uff0c\u5b58\u5728\u4e24\u4e2a\u6f5c\u5728\u7684\u98ce\u9669\u3002 \u7b2c\u4e00\u4e2a\u98ce\u9669\u662f\uff0c\u5047\u5982\u67d0\u4e2a\u5ba2\u6237\u7aef\u5728\u6267\u884c\u4e86 SETNX \u547d\u4ee4\u3001\u52a0\u9501\u4e4b\u540e\uff0c\u7d27\u63a5\u7740\u5374\u5728\u64cd\u4f5c\u5171\u4eab\u6570\u636e\u65f6\u53d1\u751f\u4e86\u5f02\u5e38\uff0c \u7ed3\u679c\u4e00\u76f4\u6ca1\u6709\u6267\u884c\u6700\u540e\u7684 DEL \u547d\u4ee4\u91ca\u653e\u9501\u3002\u56e0\u6b64\uff0c\u9501\u5c31\u4e00\u76f4\u88ab\u8fd9\u4e2a\u5ba2\u6237\u7aef\u6301\u6709\uff0c\u5176\u5b83\u5ba2\u6237\u7aef\u65e0\u6cd5\u62ff\u5230\u9501\uff0c\u4e5f\u65e0\u6cd5\u8bbf\u95ee\u5171\u4eab\u6570\u636e\u548c\u6267\u884c\u540e\u7eed\u64cd\u4f5c\uff0c\u8fd9\u4f1a\u7ed9\u4e1a\u52a1\u5e94\u7528\u5e26\u6765\u5f71\u54cd\u3002 \u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c \u4e00\u4e2a\u6709\u6548\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\uff0c\u7ed9\u9501\u53d8\u91cf\u8bbe\u7f6e\u4e00\u4e2a\u8fc7\u671f\u65f6\u95f4 \u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u6301\u6709\u9501\u7684\u5ba2\u6237\u7aef\u53d1\u751f\u4e86\u5f02\u5e38\uff0c\u65e0\u6cd5\u4e3b\u52a8\u5730\u91ca\u653e\u9501\uff0cRedis \u4e5f\u4f1a\u6839\u636e\u9501\u53d8\u91cf\u7684\u8fc7\u671f\u65f6\u95f4\uff0c \u5728\u9501\u53d8\u91cf\u8fc7\u671f\u540e\uff0c\u628a\u5b83\u5220\u9664\u3002\u5176\u5b83\u5ba2\u6237\u7aef\u5728\u9501\u53d8\u91cf\u8fc7\u671f\u540e\uff0c\u5c31\u53ef\u4ee5\u91cd\u65b0\u8bf7\u6c42\u52a0\u9501\uff0c\u8fd9\u5c31\u4e0d\u4f1a\u51fa\u73b0\u65e0\u6cd5\u52a0\u9501\u7684\u95ee\u9898\u4e86\u3002 \u7b2c\u4e8c\u4e2a\u98ce\u9669\u3002 \u5982\u679c\u5ba2\u6237\u7aef A \u6267\u884c\u4e86 SETNX \u547d\u4ee4\u52a0\u9501\u540e\uff0c\u5047\u8bbe\u5ba2\u6237\u7aef B \u6267\u884c\u4e86 DEL \u547d\u4ee4\u91ca\u653e\u9501\uff0c\u6b64\u65f6\uff0c\u5ba2\u6237\u7aef A \u7684\u9501\u5c31\u88ab\u8bef\u91ca\u653e\u4e86 \u3002 \u5982\u679c\u5ba2\u6237\u7aef C \u6b63\u597d\u4e5f\u5728\u7533\u8bf7\u52a0\u9501\uff0c\u5c31\u53ef\u4ee5\u6210\u529f\u83b7\u5f97\u9501\uff0c\u8fdb\u800c\u5f00\u59cb\u64cd\u4f5c\u5171\u4eab\u6570\u636e\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5ba2\u6237\u7aef A \u548c C \u540c\u65f6\u5728\u5bf9\u5171\u4eab\u6570\u636e\u8fdb\u884c\u64cd\u4f5c \uff0c\u6570\u636e\u5c31\u4f1a\u88ab\u4fee\u6539\u9519\u8bef\uff0c\u8fd9\u4e5f\u662f\u4e1a\u52a1\u5c42\u4e0d\u80fd\u63a5\u53d7\u7684\u3002 \u4e3a\u4e86\u5e94\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c \u6211\u4eec\u9700\u8981\u80fd\u533a\u5206\u6765\u81ea\u4e0d\u540c\u5ba2\u6237\u7aef\u7684\u9501\u64cd\u4f5c \uff0c\u5177\u4f53\u548b\u505a\u5462\uff1f \u5728\u4f7f\u7528 SETNX \u547d\u4ee4\u8fdb\u884c\u52a0\u9501\u7684\u65b9\u6cd5\u4e2d\uff0c\u901a\u8fc7\u628a\u9501\u53d8\u91cf\u503c\u8bbe\u7f6e\u4e3a 1 \u6216 0\uff0c\u8868\u793a\u662f\u5426\u52a0\u9501\u6210\u529f\u3002 1 \u548c 0 \u53ea\u6709\u4e24\u79cd\u72b6\u6001\uff0c\u65e0\u6cd5\u8868\u793a\u7a76\u7adf\u662f\u54ea\u4e2a\u5ba2\u6237\u7aef\u8fdb\u884c\u7684\u9501\u64cd\u4f5c\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u5728\u52a0\u9501\u64cd\u4f5c\u65f6\uff0c \u53ef\u4ee5\u8ba9\u6bcf\u4e2a\u5ba2\u6237\u7aef\u7ed9\u9501\u53d8\u91cf\u8bbe\u7f6e\u4e00\u4e2a\u552f\u4e00\u503c\uff0c\u8fd9\u91cc\u7684\u552f\u4e00\u503c\u5c31\u53ef\u4ee5\u7528\u6765\u6807\u8bc6\u5f53\u524d\u64cd\u4f5c\u7684\u5ba2\u6237\u7aef \u3002 \u5728\u91ca\u653e\u9501\u64cd\u4f5c\u65f6\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u5224\u65ad\uff0c\u5f53\u524d\u9501\u53d8\u91cf\u7684\u503c\u662f\u5426\u548c\u81ea\u5df1\u7684\u552f\u4e00\u6807\u8bc6\u76f8\u7b49\uff0c\u53ea\u6709\u5728\u76f8\u7b49\u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u80fd\u91ca\u653e\u9501\u3002 2-4 Redis \u7684 SET \u547d\u4ee4 Redis \u7ed9 SET \u547d\u4ee4\u63d0\u4f9b\u4e86\u7c7b\u4f3c\u7684\u9009\u9879 NX\uff0c\u7528\u6765\u5b9e\u73b0\u201c\u4e0d\u5b58\u5728\u5373\u8bbe\u7f6e\u201d\u3002 \u5982\u679c\u4f7f\u7528\u4e86 NX \u9009\u9879\uff0cSET \u547d\u4ee4\u53ea\u6709\u5728\u952e\u503c\u5bf9\u4e0d\u5b58\u5728\u65f6\uff0c\u624d\u4f1a\u8fdb\u884c\u8bbe\u7f6e\uff0c\u5426\u5219\u4e0d\u505a\u8d4b\u503c\u64cd\u4f5c\u3002\u6b64\u5916\uff0c SET \u547d\u4ee4\u5728\u6267\u884c\u65f6\u8fd8\u53ef\u4ee5\u5e26\u4e0a EX \u6216 PX \u9009\u9879\uff0c\u7528\u6765\u8bbe\u7f6e\u952e\u503c\u5bf9\u7684\u8fc7\u671f\u65f6\u95f4 \u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0c\u53ea\u6709 key \u4e0d\u5b58\u5728\u65f6\uff0cSET \u624d\u4f1a\u521b\u5efa key\uff0c\u5e76\u5bf9 key \u8fdb\u884c\u8d4b\u503c\u3002\u53e6\u5916\uff0c key \u7684\u5b58\u6d3b\u65f6\u95f4\u7531 seconds \u6216\u8005 milliseconds \u9009\u9879\u503c\u6765\u51b3\u5b9a\u3002 SET key value [EX seconds | PX milliseconds] [NX] \u6709\u4e86 SET \u547d\u4ee4\u7684 NX \u548c EX/PX \u9009\u9879\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6765\u5b9e\u73b0\u52a0\u9501\u64cd\u4f5c\u4e86\u3002 // \u52a0\u9501, unique_value\u4f5c\u4e3a\u5ba2\u6237\u7aef\u552f\u4e00\u6027\u7684\u6807\u8bc6 SET lock_key unique_value NX PX 10000 \u5176\u4e2d\uff0c unique_value \u662f\u5ba2\u6237\u7aef\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u53ef\u4ee5\u7528\u4e00\u4e2a\u968f\u673a\u751f\u6210\u7684\u5b57\u7b26\u4e32\u6765\u8868\u793a\uff0c PX 10000 \u5219\u8868\u793a lock_key \u4f1a\u5728 10s \u540e\u8fc7\u671f\uff0c\u4ee5\u514d\u5ba2\u6237\u7aef\u5728\u8fd9\u671f\u95f4\u53d1\u751f\u5f02\u5e38\u800c\u65e0\u6cd5\u91ca\u653e\u9501\u3002 \u56e0\u4e3a\u5728\u52a0\u9501\u64cd\u4f5c\u4e2d\uff0c\u6bcf\u4e2a\u5ba2\u6237\u7aef\u90fd\u4f7f\u7528\u4e86\u4e00\u4e2a\u552f\u4e00\u6807\u8bc6\uff0c\u6240\u4ee5\u5728\u91ca\u653e\u9501\u64cd\u4f5c\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5224\u65ad\u9501\u53d8\u91cf\u7684\u503c\uff0c\u662f\u5426\u7b49\u4e8e\u6267\u884c\u91ca\u653e\u9501\u64cd\u4f5c\u7684\u5ba2\u6237\u7aef\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u5982\u4e0b\u6240\u793a\uff1a //\u91ca\u653e\u9501 \u6bd4\u8f83unique_value\u662f\u5426\u76f8\u7b49\uff0c\u907f\u514d\u8bef\u91ca\u653e if redis.call(\"get\",KEYS[1]) == ARGV[1] then return redis.call(\"del\",KEYS[1]) else return 0 end \u8fd9\u662f\u4f7f\u7528 Lua \u811a\u672c\uff08 unlock.script \uff09\u5b9e\u73b0\u7684\u91ca\u653e\u9501\u64cd\u4f5c\u7684\u4f2a\u4ee3\u7801\uff0c\u5176\u4e2d\uff0c KEYS[1] \u8868\u793a lock_key \uff0c ARGV[1] \u662f\u5f53\u524d\u5ba2\u6237\u7aef\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u8fd9\u4e24\u4e2a\u503c\u90fd\u662f\u6211\u4eec\u5728\u6267\u884c Lua \u811a\u672c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u7684\u3002 \u6700\u540e\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u9501\u91ca\u653e\u64cd\u4f5c\u4e86\u3002 redis-cli --eval unlock.script lock_key , unique_value \u5728\u91ca\u653e\u9501\u64cd\u4f5c\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u4e86 Lua \u811a\u672c\uff0c\u8fd9\u662f\u56e0\u4e3a\uff0c\u91ca\u653e\u9501\u64cd\u4f5c\u7684\u903b\u8f91\u4e5f\u5305\u542b\u4e86\u8bfb\u53d6\u9501\u53d8\u91cf\u3001\u5224\u65ad\u503c\u3001\u5220\u9664\u9501\u53d8\u91cf\u7684\u591a\u4e2a\u64cd\u4f5c\uff0c\u800c Redis \u5728\u6267\u884c Lua \u811a\u672c\u65f6\uff0c\u53ef\u4ee5\u4ee5\u539f\u5b50\u6027\u7684\u65b9\u5f0f\u6267\u884c\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86\u9501\u91ca\u653e\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002 3\u3001\u57fa\u4e8e\u591a\u4e2a Redis \u8282\u70b9\u5b9e\u73b0\u9ad8\u53ef\u9760\u7684\u5206\u5e03\u5f0f\u9501 \u4e3a\u4e86\u907f\u514d Redis \u5b9e\u4f8b\u6545\u969c\u800c\u5bfc\u81f4\u7684\u9501\u65e0\u6cd5\u5de5\u4f5c\u7684\u95ee\u9898\uff0cRedis \u7684\u5f00\u53d1\u8005 Antirez \u63d0\u51fa\u4e86\u5206\u5e03\u5f0f\u9501\u7b97\u6cd5 Redlock\u3002 Redlock \u7b97\u6cd5\u7684\u57fa\u672c\u601d\u8def\uff0c\u662f\u8ba9\u5ba2\u6237\u7aef\u548c\u591a\u4e2a\u72ec\u7acb\u7684 Redis \u5b9e\u4f8b\u4f9d\u6b21\u8bf7\u6c42\u52a0\u9501\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u80fd\u591f\u548c\u534a\u6570\u4ee5\u4e0a\u7684\u5b9e\u4f8b\u6210\u529f\u5730\u5b8c\u6210\u52a0\u9501\u64cd\u4f5c\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u8ba4\u4e3a\uff0c\u5ba2\u6237\u7aef\u6210\u529f\u5730\u83b7\u5f97\u5206\u5e03\u5f0f\u9501\u4e86\uff0c\u5426\u5219\u52a0\u9501\u5931\u8d25 \u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u6709\u5355\u4e2a Redis \u5b9e\u4f8b\u53d1\u751f\u6545\u969c\uff0c\u56e0\u4e3a\u9501\u53d8\u91cf\u5728\u5176\u5b83\u5b9e\u4f8b\u4e0a\u4e5f\u6709\u4fdd\u5b58\uff0c\u6240\u4ee5\uff0c\u5ba2\u6237\u7aef\u4ecd\u7136\u53ef\u4ee5\u6b63\u5e38\u5730\u8fdb\u884c\u9501\u64cd\u4f5c\uff0c\u9501\u53d8\u91cf\u5e76\u4e0d\u4f1a\u4e22\u5931\u3002 Redlock \u7b97\u6cd5\u7684\u6267\u884c\u6b65\u9aa4\u3002Redlock \u7b97\u6cd5\u7684\u5b9e\u73b0\u9700\u8981\u6709 N \u4e2a\u72ec\u7acb\u7684 Redis \u5b9e\u4f8b\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u53ef\u4ee5\u5206\u6210 3 \u6b65\u6765\u5b8c\u6210\u52a0\u9501\u64cd\u4f5c\u3002 \u7b2c\u4e00\u6b65\u662f\uff0c\u5ba2\u6237\u7aef\u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u3002 \u7b2c\u4e8c\u6b65\u662f\uff0c\u5ba2\u6237\u7aef\u6309\u987a\u5e8f\u4f9d\u6b21\u5411 N \u4e2a Redis \u5b9e\u4f8b\u6267\u884c\u52a0\u9501\u64cd\u4f5c\u3002 \u8fd9\u91cc\u7684\u52a0\u9501\u64cd\u4f5c\u548c\u5728\u5355\u5b9e\u4f8b\u4e0a\u6267\u884c\u7684\u52a0\u9501\u64cd\u4f5c\u4e00\u6837\uff0c\u4f7f\u7528 SET \u547d\u4ee4\uff0c\u5e26\u4e0a NX\uff0cEX/PX \u9009\u9879\uff0c\u4ee5\u53ca\u5e26\u4e0a\u5ba2\u6237\u7aef\u7684\u552f\u4e00\u6807\u8bc6\u3002\u5f53\u7136\uff0c\u5982\u679c\u67d0\u4e2a Redis \u5b9e\u4f8b\u53d1\u751f\u6545\u969c\u4e86\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cRedlock \u7b97\u6cd5\u80fd\u591f\u7ee7\u7eed\u8fd0\u884c\uff0c\u6211\u4eec\u9700\u8981\u7ed9\u52a0\u9501\u64cd\u4f5c\u8bbe\u7f6e\u4e00\u4e2a\u8d85\u65f6\u65f6\u95f4 \u5982\u679c\u5ba2\u6237\u7aef\u5728\u548c\u4e00\u4e2a Redis \u5b9e\u4f8b\u8bf7\u6c42\u52a0\u9501\u65f6\uff0c\u4e00\u76f4\u5230\u8d85\u65f6\u90fd\u6ca1\u6709\u6210\u529f\uff0c\u90a3\u4e48\u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u4f1a\u548c\u4e0b\u4e00\u4e2a Redis \u5b9e\u4f8b\u7ee7\u7eed\u8bf7\u6c42\u52a0\u9501\u3002\u52a0\u9501\u64cd\u4f5c\u7684\u8d85\u65f6\u65f6\u95f4\u9700\u8981\u8fdc\u8fdc\u5730\u5c0f\u4e8e\u9501\u7684\u6709\u6548\u65f6\u95f4\uff0c\u4e00\u822c\u4e5f\u5c31\u662f\u8bbe\u7f6e\u4e3a\u51e0\u5341\u6beb\u79d2\u3002 \u7b2c\u4e09\u6b65\u662f\uff0c\u4e00\u65e6\u5ba2\u6237\u7aef\u5b8c\u6210\u4e86\u548c\u6240\u6709 Redis \u5b9e\u4f8b\u7684\u52a0\u9501\u64cd\u4f5c\uff0c\u5ba2\u6237\u7aef\u5c31\u8981\u8ba1\u7b97\u6574\u4e2a\u52a0\u9501\u8fc7\u7a0b\u7684\u603b\u8017\u65f6\u3002 \u5ba2\u6237\u7aef\u53ea\u6709\u5728\u6ee1\u8db3\u4e0b\u9762\u7684\u8fd9\u4e24\u4e2a\u6761\u4ef6\u65f6\uff0c\u624d\u80fd\u8ba4\u4e3a\u662f\u52a0\u9501\u6210\u529f\u3002 \u6761\u4ef6\u4e00\uff1a\u5ba2\u6237\u7aef\u4ece\u8d85\u8fc7\u534a\u6570 \uff08\u5927\u4e8e\u7b49\u4e8e N/2+1\uff09 \u7684 Redis \u5b9e\u4f8b\u4e0a\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff1b \u6761\u4ef6\u4e8c\uff1a\u5ba2\u6237\u7aef\u83b7\u53d6\u9501\u7684\u603b\u8017\u65f6\u6ca1\u6709\u8d85\u8fc7\u9501\u7684\u6709\u6548\u65f6\u95f4\u3002 \u5728\u6ee1\u8db3\u4e86\u8fd9\u4e24\u4e2a\u6761\u4ef6\u540e\uff0c\u6211\u4eec\u9700\u8981\u91cd\u65b0\u8ba1\u7b97\u8fd9\u628a\u9501\u7684\u6709\u6548\u65f6\u95f4\uff0c\u8ba1\u7b97\u7684\u7ed3\u679c\u662f\u9501\u7684\u6700\u521d\u6709\u6548\u65f6\u95f4\u51cf\u53bb\u5ba2\u6237\u7aef\u4e3a\u83b7\u53d6\u9501\u7684\u603b\u8017\u65f6\u3002 \u5982\u679c\u9501\u7684\u6709\u6548\u65f6\u95f4\u5df2\u7ecf\u6765\u4e0d\u53ca\u5b8c\u6210\u5171\u4eab\u6570\u636e\u7684\u64cd\u4f5c\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u91ca\u653e\u9501\uff0c\u4ee5\u514d\u51fa\u73b0\u8fd8\u6ca1\u5b8c\u6210\u6570\u636e\u64cd\u4f5c\uff0c\u9501\u5c31\u8fc7\u671f\u4e86\u7684\u60c5\u51b5\u3002 \u5728 Redlock \u7b97\u6cd5\u4e2d\uff0c\u91ca\u653e\u9501\u7684\u64cd\u4f5c\u548c\u5728\u5355\u5b9e\u4f8b\u4e0a\u91ca\u653e\u9501\u7684\u64cd\u4f5c\u4e00\u6837\uff0c\u53ea\u8981\u6267\u884c\u91ca\u653e\u9501\u7684 Lua \u811a\u672c\u5c31\u53ef\u4ee5\u4e86\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u53ea\u8981 N \u4e2a Redis \u5b9e\u4f8b\u4e2d\u7684\u534a\u6570\u4ee5\u4e0a\u5b9e\u4f8b\u80fd\u6b63\u5e38\u5de5\u4f5c\uff0c\u5c31\u80fd\u4fdd\u8bc1\u5206\u5e03\u5f0f\u9501\u7684\u6b63\u5e38\u5de5\u4f5c\u4e86\u3002 4\u3001\u672c\u8282\u603b\u7ed3 \u5206\u5e03\u5f0f\u9501\u662f\u7531\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u7ef4\u62a4\u7684\u53d8\u91cf\uff0c\u591a\u4e2a\u5ba2\u6237\u7aef\u53ef\u4ee5\u5411\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u53d1\u9001\u547d\u4ee4\u8fdb\u884c\u52a0\u9501\u6216\u91ca\u653e\u9501\u64cd\u4f5c\u3002 Redis \u4f5c\u4e3a\u4e00\u4e2a\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\uff0c\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u3002 \u5728\u57fa\u4e8e\u5355\u4e2a Redis \u5b9e\u4f8b\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u65f6\uff0c\u5bf9\u4e8e\u52a0\u9501\u64cd\u4f5c\uff0c\u6211\u4eec\u9700\u8981\u6ee1\u8db3\u4e09\u4e2a\u6761\u4ef6\u3002 \u52a0\u9501\u5305\u62ec\u4e86 \u8bfb\u53d6\u9501\u53d8\u91cf\u3001\u68c0\u67e5\u9501\u53d8\u91cf\u503c\u548c\u8bbe\u7f6e\u9501\u53d8\u91cf\u503c \u4e09\u4e2a\u64cd\u4f5c\uff0c\u4f46\u9700\u8981\u4ee5\u539f\u5b50\u64cd\u4f5c\u7684\u65b9\u5f0f\u5b8c\u6210\uff0c\u6240\u4ee5 \uff0c\u6211\u4eec\u4f7f\u7528 SET \u547d\u4ee4\u5e26\u4e0a NX \u9009\u9879\u6765\u5b9e\u73b0\u52a0\u9501 \uff1b \u9501\u53d8\u91cf\u9700\u8981\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u514d\u5ba2\u6237\u7aef\u62ff\u5230\u9501\u540e\u53d1\u751f\u5f02\u5e38\uff0c\u5bfc\u81f4\u9501\u4e00\u76f4\u65e0\u6cd5\u91ca\u653e\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5728 SET \u547d\u4ee4\u6267\u884c\u65f6\u52a0\u4e0a EX/PX \u9009\u9879 \uff0c\u8bbe\u7f6e\u5176\u8fc7\u671f\u65f6\u95f4\uff1b \u9501\u53d8\u91cf\u7684\u503c\u9700\u8981\u80fd\u533a\u5206\u6765\u81ea\u4e0d\u540c\u5ba2\u6237\u7aef\u7684\u52a0\u9501\u64cd\u4f5c\uff0c\u4ee5\u514d\u5728\u91ca\u653e\u9501\u65f6\uff0c\u51fa\u73b0\u8bef\u91ca\u653e\u64cd\u4f5c\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u4f7f\u7528 SET \u547d\u4ee4\u8bbe\u7f6e\u9501\u53d8\u91cf\u503c\u65f6\uff0c\u6bcf\u4e2a\u5ba2\u6237\u7aef\u8bbe\u7f6e\u7684\u503c\u662f\u4e00\u4e2a\u552f\u4e00\u503c\uff0c\u7528\u4e8e\u6807\u8bc6\u5ba2\u6237\u7aef\u3002 \u548c\u52a0\u9501\u7c7b\u4f3c\uff0c\u91ca\u653e\u9501\u4e5f\u5305\u542b\u4e86\u8bfb\u53d6\u9501\u53d8\u91cf\u503c\u3001\u5224\u65ad\u9501\u53d8\u91cf\u503c\u548c\u5220\u9664\u9501\u53d8\u91cf\u4e09\u4e2a\u64cd\u4f5c\uff0c\u4e0d\u8fc7\uff0c\u6211\u4eec\u65e0\u6cd5\u4f7f\u7528\u5355\u4e2a\u547d\u4ee4\u6765\u5b9e\u73b0\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528 Lua \u811a\u672c\u6267\u884c\u91ca\u653e\u9501\u64cd\u4f5c\uff0c\u901a\u8fc7 Redis \u539f\u5b50\u6027\u5730\u6267\u884c Lua \u811a\u672c\uff0c\u6765\u4fdd\u8bc1\u91ca\u653e\u9501\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002 \u4e0d\u8fc7\uff0c\u57fa\u4e8e\u5355\u4e2a Redis \u5b9e\u4f8b\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u65f6\uff0c\u4f1a\u9762\u4e34\u5b9e\u4f8b\u5f02\u5e38\u6216\u5d29\u6e83\u7684\u60c5\u51b5\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u5b9e\u4f8b\u65e0\u6cd5\u63d0\u4f9b\u9501\u64cd\u4f5c\uff0c \u6b63\u56e0\u4e3a\u6b64\uff0cRedis \u4e5f\u63d0\u4f9b\u4e86 Redlock \u7b97\u6cd5\uff0c\u7528\u6765\u5b9e\u73b0\u57fa\u4e8e\u591a\u4e2a\u5b9e\u4f8b\u7684\u5206\u5e03\u5f0f\u9501 \u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u9501\u53d8\u91cf\u7531\u591a\u4e2a\u5b9e\u4f8b\u7ef4\u62a4\uff0c\u5373\u4f7f\u6709\u5b9e\u4f8b\u53d1\u751f\u4e86\u6545\u969c\uff0c\u9501\u53d8\u91cf\u4ecd\u7136\u662f\u5b58\u5728\u7684\uff0c\u5ba2\u6237\u7aef\u8fd8\u662f\u53ef\u4ee5\u5b8c\u6210\u9501\u64cd\u4f5c","title":"\u7b2c\u4e09\u8282 Redis\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501"},{"location":"chap6/3redis_distributed_locks/#redis","text":"\u5e94\u5bf9\u5e76\u53d1\u95ee\u9898\u65f6\uff0c\u9664\u4e86\u539f\u5b50\u64cd\u4f5c\uff0cRedis \u5ba2\u6237\u7aef\u8fd8\u53ef\u4ee5\u901a\u8fc7\u52a0\u9501\u7684\u65b9\u5f0f\uff0c\u6765\u63a7\u5236\u5e76\u53d1\u5199\u64cd\u4f5c\u5bf9\u5171\u4eab\u6570\u636e\u7684\u4fee\u6539\uff0c\u4ece\u800c\u4fdd\u8bc1\u6570\u636e\u7684\u6b63\u786e\u6027\u3002 Redis \u5c5e\u4e8e\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u5f53\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u9700\u8981\u4e89\u62a2\u9501\u65f6\uff0c\u5fc5\u987b\u8981\u4fdd\u8bc1\uff0c \u8fd9\u628a\u9501\u4e0d\u80fd\u662f\u67d0\u4e2a\u5ba2\u6237\u7aef\u672c\u5730\u7684\u9501 \u3002\u5426\u5219\u7684\u8bdd\uff0c\u5176\u5b83\u5ba2\u6237\u7aef\u662f\u65e0\u6cd5\u8bbf\u95ee\u8fd9\u628a\u9501\u7684\uff0c\u5f53\u7136\u4e5f\u5c31\u4e0d\u80fd\u83b7\u53d6\u8fd9\u628a\u9501\u4e86\u3002 \u6240\u4ee5\uff0c\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u5f53\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u9700\u8981\u83b7\u53d6\u9501\u65f6\uff0c\u6211\u4eec\u9700\u8981 \u5206\u5e03\u5f0f\u9501 \u3002\u6b64\u65f6\uff0c \u9501\u662f\u4fdd\u5b58\u5728\u4e00\u4e2a\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u4e2d\u7684\uff0c\u53ef\u4ee5\u88ab\u591a\u4e2a\u5ba2\u6237\u7aef\u5171\u4eab\u8bbf\u95ee\u548c\u83b7\u53d6\u3002 Redis \u672c\u8eab\u53ef\u4ee5\u88ab\u591a\u4e2a\u5ba2\u6237\u7aef\u5171\u4eab\u8bbf\u95ee\uff0c\u6b63\u597d\u5c31\u662f\u4e00\u4e2a\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\uff0c\u53ef\u4ee5\u7528\u6765\u4fdd\u5b58\u5206\u5e03\u5f0f\u9501\u3002 \u800c\u4e14 Redis \u7684\u8bfb\u5199\u6027\u80fd\u9ad8\uff0c\u53ef\u4ee5\u5e94\u5bf9\u9ad8\u5e76\u53d1\u7684\u9501\u64cd\u4f5c\u573a\u666f\u3002","title":"\u7b2c\u4e09\u8282 Redis\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501"},{"location":"chap6/3redis_distributed_locks/#1","text":"","title":"1\u3001\u5355\u673a\u4e0a\u7684\u9501\u548c\u5206\u5e03\u5f0f\u9501\u7684\u8054\u7cfb\u4e0e\u533a\u522b"},{"location":"chap6/3redis_distributed_locks/#1-1","text":"\u5bf9\u4e8e\u5728\u5355\u673a\u4e0a\u8fd0\u884c\u7684\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u6765\u8bf4\uff0c\u9501\u672c\u8eab\u53ef\u4ee5\u7528\u4e00\u4e2a\u53d8\u91cf\u8868\u793a\u3002 \u53d8\u91cf\u503c\u4e3a 0 \u65f6\uff0c\u8868\u793a\u6ca1\u6709\u7ebf\u7a0b\u83b7\u53d6\u9501\uff1b \u53d8\u91cf\u503c\u4e3a 1 \u65f6\uff0c\u8868\u793a\u5df2\u7ecf\u6709\u7ebf\u7a0b\u83b7\u53d6\u5230\u9501\u4e86\u3002 \u7ebf\u7a0b\u8c03\u7528\u52a0\u9501\u548c\u91ca\u653e\u9501\u7684\u64cd\u4f5c\uff0c\u5230\u5e95\u662f\u5565\u610f\u601d\u5462\uff1f \u5b9e\u9645\u4e0a\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u8c03\u7528\u52a0\u9501\u64cd\u4f5c\uff0c\u5176\u5b9e\u5c31\u662f\u68c0\u67e5\u9501\u53d8\u91cf\u503c\u662f\u5426\u4e3a 0\u3002\u5982\u679c\u662f 0\uff0c\u5c31\u628a\u9501\u7684\u53d8\u91cf\u503c\u8bbe\u7f6e\u4e3a 1\uff0c\u8868\u793a\u83b7\u53d6\u5230\u9501\uff0c\u5982\u679c\u4e0d\u662f 0\uff0c\u5c31\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\uff0c\u8868\u793a\u52a0\u9501\u5931\u8d25\uff0c\u5df2\u7ecf\u6709\u522b\u7684\u7ebf\u7a0b\u83b7\u53d6\u5230\u9501\u4e86\u3002\u800c\u4e00\u4e2a\u7ebf\u7a0b\u8c03\u7528\u91ca\u653e\u9501\u64cd\u4f5c\uff0c\u5176\u5b9e\u5c31\u662f\u5c06\u9501\u53d8\u91cf\u7684\u503c\u7f6e\u4e3a 0\uff0c\u4ee5\u4fbf\u5176\u5b83\u7ebf\u7a0b\u53ef\u4ee5\u6765\u83b7\u53d6\u9501\u3002 acquire_lock(){ if lock == 0 lock = 1 return 1 else return 0 } release_lock(){ lock = 0 return 1 }","title":"1-1 \u5355\u673a\u4e0a\u7684\u9501"},{"location":"chap6/3redis_distributed_locks/#1-2","text":"\u548c\u5355\u673a\u4e0a\u7684\u9501\u7c7b\u4f3c\uff0c\u5206\u5e03\u5f0f\u9501\u540c\u6837\u53ef\u4ee5 \u7528\u4e00\u4e2a\u53d8\u91cf\u6765\u5b9e\u73b0 \u3002 \u5ba2\u6237\u7aef\u52a0\u9501\u548c\u91ca\u653e\u9501\u7684\u64cd\u4f5c\u903b\u8f91\uff0c\u4e5f\u548c\u5355\u673a\u4e0a\u7684\u52a0\u9501\u548c\u91ca\u653e\u9501\u64cd\u4f5c\u903b\u8f91\u4e00\u81f4\uff1a \u52a0\u9501\u65f6\u540c\u6837\u9700\u8981\u5224\u65ad\u9501\u53d8\u91cf\u7684\u503c\uff0c\u6839\u636e\u9501\u53d8\u91cf\u503c\u6765\u5224\u65ad\u80fd\u5426\u52a0\u9501\u6210\u529f\uff1b\u91ca\u653e\u9501\u65f6\u9700\u8981\u628a\u9501\u53d8\u91cf\u503c\u8bbe\u7f6e\u4e3a 0\uff0c\u8868\u660e\u5ba2\u6237\u7aef\u4e0d\u518d\u6301\u6709\u9501\u3002 \u548c\u7ebf\u7a0b\u5728\u5355\u673a\u4e0a\u64cd\u4f5c\u9501\u4e0d\u540c\u7684\u662f\uff0c\u5728\u5206\u5e03\u5f0f\u573a\u666f\u4e0b\uff0c \u9501\u53d8\u91cf\u9700\u8981\u7531\u4e00\u4e2a\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u6765\u7ef4\u62a4\uff0c\u53ea\u6709\u8fd9\u6837\uff0c\u591a\u4e2a\u5ba2\u6237\u7aef\u624d\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u6765\u8bbf\u95ee\u9501\u53d8\u91cf\u3002\u76f8\u5e94\u7684\uff0c\u52a0\u9501\u548c\u91ca\u653e\u9501\u7684\u64cd\u4f5c\u5c31\u53d8\u6210\u4e86\u8bfb\u53d6\u3001\u5224\u65ad\u548c\u8bbe\u7f6e\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u4e2d\u7684\u9501\u53d8\u91cf\u503c \u3002 \u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u7684\u4e24\u4e2a\u8981\u6c42 \u8981\u6c42\u4e00\uff1a\u5206\u5e03\u5f0f\u9501\u7684\u52a0\u9501\u548c\u91ca\u653e\u9501\u7684\u8fc7\u7a0b\uff0c\u6d89\u53ca\u591a\u4e2a\u64cd\u4f5c\u3002\u6240 \u4ee5\uff0c\u5728\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u65f6\uff0c\u6211\u4eec\u9700\u8981\u4fdd\u8bc1\u8fd9\u4e9b\u9501\u64cd\u4f5c\u7684\u539f\u5b50\u6027 \uff1b \u8981\u6c42\u4e8c\uff1a\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u4fdd\u5b58\u4e86\u9501\u53d8\u91cf\uff0c\u5982\u679c\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u53d1\u751f\u6545\u969c\u6216\u5b95\u673a\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u4e5f\u5c31\u65e0\u6cd5\u8fdb\u884c\u9501\u64cd\u4f5c\u4e86 \u3002\u5728\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u65f6\uff0c\u6211\u4eec\u9700\u8981\u8003\u8651\u4fdd\u8bc1\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u7684\u53ef\u9760\u6027\uff0c\u8fdb\u800c\u4fdd\u8bc1\u9501\u7684\u53ef\u9760\u6027 \u3002","title":"1-2 \u5206\u5e03\u5f0f\u9501"},{"location":"chap6/3redis_distributed_locks/#2-redis","text":"","title":"2\u3001\u57fa\u4e8e\u5355\u4e2a Redis \u8282\u70b9\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501"},{"location":"chap6/3redis_distributed_locks/#2-1","text":"\u4f5c\u4e3a\u5206\u5e03\u5f0f\u9501\u5b9e\u73b0\u8fc7\u7a0b\u4e2d\u7684\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\uff0c Redis \u53ef\u4ee5\u4f7f\u7528\u952e\u503c\u5bf9\u6765\u4fdd\u5b58\u9501\u53d8\u91cf \uff0c\u518d\u63a5\u6536\u548c\u5904\u7406\u4e0d\u540c\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u52a0\u9501\u548c\u91ca\u653e\u9501\u7684\u64cd\u4f5c\u8bf7\u6c42\u3002 \u6211\u4eec\u8981\u8d4b\u4e88\u9501\u53d8\u91cf\u4e00\u4e2a\u53d8\u91cf\u540d \uff0c\u628a\u8fd9\u4e2a\u53d8\u91cf\u540d\u4f5c\u4e3a\u952e\u503c\u5bf9\u7684\u952e\uff0c\u800c\u9501\u53d8\u91cf\u7684\u503c\uff0c\u5219\u662f\u952e\u503c\u5bf9\u7684\u503c \uff0c\u8fd9\u6837\u4e00\u6765\uff0cRedis \u5c31\u80fd\u4fdd\u5b58\u9501\u53d8\u91cf\u4e86\uff0c\u5ba2\u6237\u7aef\u4e5f\u5c31\u53ef\u4ee5\u901a\u8fc7 Redis \u7684\u547d\u4ee4\u64cd\u4f5c\u6765\u5b9e\u73b0\u9501\u64cd\u4f5c\u3002 Redis \u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u952e\u503c\u5bf9 lock_key:0 \u6765\u4fdd\u5b58\u9501\u53d8\u91cf\uff0c\u5176\u4e2d\uff0c\u952e\u662f lock_key \uff0c\u4e5f\u662f\u9501\u53d8\u91cf\u7684\u540d\u79f0\uff0c\u9501\u53d8\u91cf\u7684\u521d\u59cb\u503c\u662f 0\u3002","title":"2-1 \u9501\u53d8\u91cf"},{"location":"chap6/3redis_distributed_locks/#2-2","text":"\u5728\u56fe\u4e2d\uff0c\u5ba2\u6237\u7aef A \u548c C \u540c\u65f6\u8bf7\u6c42\u52a0\u9501\u3002\u56e0\u4e3a Redis \u4f7f\u7528\u5355\u7ebf\u7a0b\u5904\u7406\u8bf7\u6c42\uff0c\u6240\u4ee5\uff0c\u5373\u4f7f\u5ba2\u6237\u7aef A \u548c C \u540c\u65f6\u628a\u52a0\u9501\u8bf7\u6c42\u53d1\u7ed9\u4e86 Redis\uff0cRedis \u4e5f\u4f1a\u4e32\u884c\u5904\u7406\u5b83\u4eec\u7684\u8bf7\u6c42\u3002 \u6211\u4eec\u5047\u8bbe Redis \u5148\u5904\u7406\u5ba2\u6237\u7aef A \u7684\u8bf7\u6c42\uff0c\u8bfb\u53d6 lock_key \u7684\u503c\uff0c\u53d1\u73b0 lock_key \u4e3a 0 \uff0c\u6240\u4ee5\uff0cRedis \u5c31\u628a lock_key \u7684 value \u7f6e\u4e3a 1 \uff0c\u8868\u793a\u5df2\u7ecf\u52a0\u9501\u4e86\u3002 \u7d27\u63a5\u7740\uff0cRedis \u5904\u7406\u5ba2\u6237\u7aef C \u7684\u8bf7\u6c42\uff0c\u6b64\u65f6\uff0cRedis \u4f1a\u53d1\u73b0 lock_key \u7684\u503c\u5df2\u7ecf\u4e3a 1 \u4e86\uff0c\u6240\u4ee5\u5c31\u8fd4\u56de\u52a0\u9501\u5931\u8d25\u7684\u4fe1\u606f\u3002 \u521a\u521a\u8bf4\u7684\u662f\u52a0\u9501\u7684\u64cd\u4f5c\uff0c\u90a3\u91ca\u653e\u9501\u8be5\u600e\u4e48\u64cd\u4f5c\u5462\uff1f\u5176\u5b9e\uff0c\u91ca\u653e\u9501\u5c31\u662f\u76f4\u63a5\u628a\u9501\u53d8\u91cf\u503c\u8bbe\u7f6e\u4e3a 0\u3002 \u8fd9\u5f20\u56fe\u7247\u5c55\u793a\u4e86\u5ba2\u6237\u7aef A \u8bf7\u6c42\u91ca\u653e\u9501\u7684\u8fc7\u7a0b\u3002\u5f53\u5ba2\u6237\u7aef A \u6301\u6709\u9501\u65f6\uff0c\u9501\u53d8\u91cf lock_key \u7684\u503c\u4e3a 1\u3002\u5ba2\u6237\u7aef A \u6267\u884c\u91ca\u653e\u9501\u64cd\u4f5c\u540e\uff0cRedis \u5c06 lock_key \u7684\u503c\u7f6e\u4e3a 0\uff0c\u8868\u660e\u5df2\u7ecf\u6ca1\u6709\u5ba2\u6237\u7aef\u6301\u6709\u9501\u4e86\u3002 \u56e0\u4e3a\u52a0\u9501\u5305\u542b\u4e86\u4e09\u4e2a\u64cd\u4f5c\uff08\u8bfb\u53d6\u9501\u53d8\u91cf\u3001\u5224\u65ad\u9501\u53d8\u91cf\u503c\u4ee5\u53ca\u628a\u9501\u53d8\u91cf\u503c\u8bbe\u7f6e\u4e3a 1\uff09\uff0c\u800c\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u5728\u6267\u884c\u65f6\u9700\u8981\u4fdd\u8bc1\u539f\u5b50\u6027\u3002\u90a3\u600e\u4e48\u4fdd\u8bc1\u539f\u5b50\u6027\u5462\uff1f \u8981\u60f3\u4fdd\u8bc1\u64cd\u4f5c\u7684\u539f\u5b50\u6027\uff0c\u6709\u4e24\u79cd\u901a\u7528\u7684\u65b9\u6cd5\uff0c\u5206\u522b\u662f\u4f7f\u7528 Redis \u7684\u5355\u547d\u4ee4\u64cd\u4f5c\u548c\u4f7f\u7528 Lua \u811a\u672c\u3002\u90a3\u4e48\uff0c \u5728\u5206\u5e03\u5f0f\u52a0\u9501\u573a\u666f\u4e0b\uff0c\u8be5\u600e\u4e48\u5e94\u7528\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u5462\uff1f","title":"2-2 \u52a0\u9501\u64cd\u4f5c"},{"location":"chap6/3redis_distributed_locks/#2-3","text":"\u5355\u547d\u4ee4\u64cd\u4f5c\u5b9e\u73b0\u52a0\u9501\u64cd\u4f5c \u9996\u5148\u662f SETNX \u547d\u4ee4\uff0c\u5b83\u7528\u4e8e\u8bbe\u7f6e\u952e\u503c\u5bf9\u7684\u503c\u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u5c31\u662f\u8fd9\u4e2a\u547d\u4ee4\u5728\u6267\u884c\u65f6\u4f1a\u5224\u65ad\u952e\u503c\u5bf9\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5c31\u8bbe\u7f6e\u952e\u503c\u5bf9\u7684\u503c\uff0c\u5982\u679c\u5b58\u5728\uff0c\u5c31\u4e0d\u505a\u4efb\u4f55\u8bbe\u7f6e\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c \u5982\u679c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0ckey \u4e0d\u5b58\u5728\uff0c\u90a3\u4e48 key \u4f1a\u88ab\u521b\u5efa\uff0c\u5e76\u4e14\u503c\u4f1a\u88ab\u8bbe\u7f6e\u4e3a value\uff1b\u5982\u679c key \u5df2\u7ecf\u5b58\u5728\uff0cSETNX \u4e0d\u505a\u4efb\u4f55\u8d4b\u503c\u64cd\u4f5c \u3002 SETNX key value \u5bf9\u4e8e\u91ca\u653e\u9501\u64cd\u4f5c\u6765\u8bf4\uff0c\u53ef\u4ee5\u5728\u6267\u884c\u5b8c\u4e1a\u52a1\u903b\u8f91\u540e\uff0c \u4f7f\u7528 DEL \u547d\u4ee4\u5220\u9664\u9501\u53d8\u91cf\u3002 \u4e0d\u8fc7\uff0c\u4f60\u4e0d\u7528\u62c5\u5fc3\u9501\u53d8\u91cf\u88ab\u5220\u9664\u540e\uff0c\u5176\u4ed6\u5ba2\u6237\u7aef\u65e0\u6cd5\u8bf7\u6c42\u52a0\u9501\u4e86\u3002 \u56e0\u4e3a SETNX \u547d\u4ee4\u5728\u6267\u884c\u65f6\uff0c\u5982\u679c\u8981\u8bbe\u7f6e\u7684\u952e\u503c\u5bf9\uff08\u4e5f\u5c31\u662f\u9501\u53d8\u91cf\uff09\u4e0d\u5b58\u5728\uff0cSETNX \u547d\u4ee4\u4f1a\u5148\u521b\u5efa\u952e\u503c\u5bf9\uff0c\u7136\u540e\u8bbe\u7f6e\u5b83\u7684\u503c \u3002 \u6240\u4ee5\uff0c\u91ca\u653e\u9501\u4e4b\u540e\uff0c\u518d\u6709\u5ba2\u6237\u7aef\u8bf7\u6c42\u52a0\u9501\u65f6\uff0cSETNX \u547d\u4ee4\u4f1a\u521b\u5efa\u4fdd\u5b58\u9501\u53d8\u91cf\u7684\u952e\u503c\u5bf9\uff0c\u5e76\u8bbe\u7f6e\u9501\u53d8\u91cf\u7684\u503c\uff0c\u5b8c\u6210\u52a0\u9501\u3002 \u603b\u7ed3\u6765\u8bf4\uff0c \u53ef\u4ee5\u7528 SETNX \u548c DEL \u547d\u4ee4\u7ec4\u5408\u6765\u5b9e\u73b0\u52a0\u9501\u548c\u91ca\u653e\u9501\u64cd\u4f5c \u3002\u4e0b\u9762\u7684\u4f2a\u4ee3\u7801\u793a\u4f8b\u663e\u793a\u4e86\u9501\u64cd\u4f5c\u7684\u8fc7\u7a0b\uff0c\u4f60\u53ef\u4ee5\u770b\u4e0b\u3002 // \u52a0\u9501 SETNX lock_key 1 // \u4e1a\u52a1\u903b\u8f91 DO THINGS // \u91ca\u653e\u9501 DEL lock_key \u4f7f\u7528 SETNX \u548c DEL \u547d\u4ee4\u7ec4\u5408\u5b9e\u73b0\u5206\u5e03\u9501\uff0c\u5b58\u5728\u4e24\u4e2a\u6f5c\u5728\u7684\u98ce\u9669\u3002 \u7b2c\u4e00\u4e2a\u98ce\u9669\u662f\uff0c\u5047\u5982\u67d0\u4e2a\u5ba2\u6237\u7aef\u5728\u6267\u884c\u4e86 SETNX \u547d\u4ee4\u3001\u52a0\u9501\u4e4b\u540e\uff0c\u7d27\u63a5\u7740\u5374\u5728\u64cd\u4f5c\u5171\u4eab\u6570\u636e\u65f6\u53d1\u751f\u4e86\u5f02\u5e38\uff0c \u7ed3\u679c\u4e00\u76f4\u6ca1\u6709\u6267\u884c\u6700\u540e\u7684 DEL \u547d\u4ee4\u91ca\u653e\u9501\u3002\u56e0\u6b64\uff0c\u9501\u5c31\u4e00\u76f4\u88ab\u8fd9\u4e2a\u5ba2\u6237\u7aef\u6301\u6709\uff0c\u5176\u5b83\u5ba2\u6237\u7aef\u65e0\u6cd5\u62ff\u5230\u9501\uff0c\u4e5f\u65e0\u6cd5\u8bbf\u95ee\u5171\u4eab\u6570\u636e\u548c\u6267\u884c\u540e\u7eed\u64cd\u4f5c\uff0c\u8fd9\u4f1a\u7ed9\u4e1a\u52a1\u5e94\u7528\u5e26\u6765\u5f71\u54cd\u3002 \u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c \u4e00\u4e2a\u6709\u6548\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\uff0c\u7ed9\u9501\u53d8\u91cf\u8bbe\u7f6e\u4e00\u4e2a\u8fc7\u671f\u65f6\u95f4 \u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u6301\u6709\u9501\u7684\u5ba2\u6237\u7aef\u53d1\u751f\u4e86\u5f02\u5e38\uff0c\u65e0\u6cd5\u4e3b\u52a8\u5730\u91ca\u653e\u9501\uff0cRedis \u4e5f\u4f1a\u6839\u636e\u9501\u53d8\u91cf\u7684\u8fc7\u671f\u65f6\u95f4\uff0c \u5728\u9501\u53d8\u91cf\u8fc7\u671f\u540e\uff0c\u628a\u5b83\u5220\u9664\u3002\u5176\u5b83\u5ba2\u6237\u7aef\u5728\u9501\u53d8\u91cf\u8fc7\u671f\u540e\uff0c\u5c31\u53ef\u4ee5\u91cd\u65b0\u8bf7\u6c42\u52a0\u9501\uff0c\u8fd9\u5c31\u4e0d\u4f1a\u51fa\u73b0\u65e0\u6cd5\u52a0\u9501\u7684\u95ee\u9898\u4e86\u3002 \u7b2c\u4e8c\u4e2a\u98ce\u9669\u3002 \u5982\u679c\u5ba2\u6237\u7aef A \u6267\u884c\u4e86 SETNX \u547d\u4ee4\u52a0\u9501\u540e\uff0c\u5047\u8bbe\u5ba2\u6237\u7aef B \u6267\u884c\u4e86 DEL \u547d\u4ee4\u91ca\u653e\u9501\uff0c\u6b64\u65f6\uff0c\u5ba2\u6237\u7aef A \u7684\u9501\u5c31\u88ab\u8bef\u91ca\u653e\u4e86 \u3002 \u5982\u679c\u5ba2\u6237\u7aef C \u6b63\u597d\u4e5f\u5728\u7533\u8bf7\u52a0\u9501\uff0c\u5c31\u53ef\u4ee5\u6210\u529f\u83b7\u5f97\u9501\uff0c\u8fdb\u800c\u5f00\u59cb\u64cd\u4f5c\u5171\u4eab\u6570\u636e\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5ba2\u6237\u7aef A \u548c C \u540c\u65f6\u5728\u5bf9\u5171\u4eab\u6570\u636e\u8fdb\u884c\u64cd\u4f5c \uff0c\u6570\u636e\u5c31\u4f1a\u88ab\u4fee\u6539\u9519\u8bef\uff0c\u8fd9\u4e5f\u662f\u4e1a\u52a1\u5c42\u4e0d\u80fd\u63a5\u53d7\u7684\u3002 \u4e3a\u4e86\u5e94\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c \u6211\u4eec\u9700\u8981\u80fd\u533a\u5206\u6765\u81ea\u4e0d\u540c\u5ba2\u6237\u7aef\u7684\u9501\u64cd\u4f5c \uff0c\u5177\u4f53\u548b\u505a\u5462\uff1f \u5728\u4f7f\u7528 SETNX \u547d\u4ee4\u8fdb\u884c\u52a0\u9501\u7684\u65b9\u6cd5\u4e2d\uff0c\u901a\u8fc7\u628a\u9501\u53d8\u91cf\u503c\u8bbe\u7f6e\u4e3a 1 \u6216 0\uff0c\u8868\u793a\u662f\u5426\u52a0\u9501\u6210\u529f\u3002 1 \u548c 0 \u53ea\u6709\u4e24\u79cd\u72b6\u6001\uff0c\u65e0\u6cd5\u8868\u793a\u7a76\u7adf\u662f\u54ea\u4e2a\u5ba2\u6237\u7aef\u8fdb\u884c\u7684\u9501\u64cd\u4f5c\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u5728\u52a0\u9501\u64cd\u4f5c\u65f6\uff0c \u53ef\u4ee5\u8ba9\u6bcf\u4e2a\u5ba2\u6237\u7aef\u7ed9\u9501\u53d8\u91cf\u8bbe\u7f6e\u4e00\u4e2a\u552f\u4e00\u503c\uff0c\u8fd9\u91cc\u7684\u552f\u4e00\u503c\u5c31\u53ef\u4ee5\u7528\u6765\u6807\u8bc6\u5f53\u524d\u64cd\u4f5c\u7684\u5ba2\u6237\u7aef \u3002 \u5728\u91ca\u653e\u9501\u64cd\u4f5c\u65f6\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u5224\u65ad\uff0c\u5f53\u524d\u9501\u53d8\u91cf\u7684\u503c\u662f\u5426\u548c\u81ea\u5df1\u7684\u552f\u4e00\u6807\u8bc6\u76f8\u7b49\uff0c\u53ea\u6709\u5728\u76f8\u7b49\u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u80fd\u91ca\u653e\u9501\u3002","title":"2-3 \u5206\u5e03\u5f0f\u52a0\u9501\u573a\u666f\u4e0b\u7684\u539f\u5b50\u6027"},{"location":"chap6/3redis_distributed_locks/#2-4-redis-set","text":"Redis \u7ed9 SET \u547d\u4ee4\u63d0\u4f9b\u4e86\u7c7b\u4f3c\u7684\u9009\u9879 NX\uff0c\u7528\u6765\u5b9e\u73b0\u201c\u4e0d\u5b58\u5728\u5373\u8bbe\u7f6e\u201d\u3002 \u5982\u679c\u4f7f\u7528\u4e86 NX \u9009\u9879\uff0cSET \u547d\u4ee4\u53ea\u6709\u5728\u952e\u503c\u5bf9\u4e0d\u5b58\u5728\u65f6\uff0c\u624d\u4f1a\u8fdb\u884c\u8bbe\u7f6e\uff0c\u5426\u5219\u4e0d\u505a\u8d4b\u503c\u64cd\u4f5c\u3002\u6b64\u5916\uff0c SET \u547d\u4ee4\u5728\u6267\u884c\u65f6\u8fd8\u53ef\u4ee5\u5e26\u4e0a EX \u6216 PX \u9009\u9879\uff0c\u7528\u6765\u8bbe\u7f6e\u952e\u503c\u5bf9\u7684\u8fc7\u671f\u65f6\u95f4 \u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0c\u53ea\u6709 key \u4e0d\u5b58\u5728\u65f6\uff0cSET \u624d\u4f1a\u521b\u5efa key\uff0c\u5e76\u5bf9 key \u8fdb\u884c\u8d4b\u503c\u3002\u53e6\u5916\uff0c key \u7684\u5b58\u6d3b\u65f6\u95f4\u7531 seconds \u6216\u8005 milliseconds \u9009\u9879\u503c\u6765\u51b3\u5b9a\u3002 SET key value [EX seconds | PX milliseconds] [NX] \u6709\u4e86 SET \u547d\u4ee4\u7684 NX \u548c EX/PX \u9009\u9879\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6765\u5b9e\u73b0\u52a0\u9501\u64cd\u4f5c\u4e86\u3002 // \u52a0\u9501, unique_value\u4f5c\u4e3a\u5ba2\u6237\u7aef\u552f\u4e00\u6027\u7684\u6807\u8bc6 SET lock_key unique_value NX PX 10000 \u5176\u4e2d\uff0c unique_value \u662f\u5ba2\u6237\u7aef\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u53ef\u4ee5\u7528\u4e00\u4e2a\u968f\u673a\u751f\u6210\u7684\u5b57\u7b26\u4e32\u6765\u8868\u793a\uff0c PX 10000 \u5219\u8868\u793a lock_key \u4f1a\u5728 10s \u540e\u8fc7\u671f\uff0c\u4ee5\u514d\u5ba2\u6237\u7aef\u5728\u8fd9\u671f\u95f4\u53d1\u751f\u5f02\u5e38\u800c\u65e0\u6cd5\u91ca\u653e\u9501\u3002 \u56e0\u4e3a\u5728\u52a0\u9501\u64cd\u4f5c\u4e2d\uff0c\u6bcf\u4e2a\u5ba2\u6237\u7aef\u90fd\u4f7f\u7528\u4e86\u4e00\u4e2a\u552f\u4e00\u6807\u8bc6\uff0c\u6240\u4ee5\u5728\u91ca\u653e\u9501\u64cd\u4f5c\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5224\u65ad\u9501\u53d8\u91cf\u7684\u503c\uff0c\u662f\u5426\u7b49\u4e8e\u6267\u884c\u91ca\u653e\u9501\u64cd\u4f5c\u7684\u5ba2\u6237\u7aef\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u5982\u4e0b\u6240\u793a\uff1a //\u91ca\u653e\u9501 \u6bd4\u8f83unique_value\u662f\u5426\u76f8\u7b49\uff0c\u907f\u514d\u8bef\u91ca\u653e if redis.call(\"get\",KEYS[1]) == ARGV[1] then return redis.call(\"del\",KEYS[1]) else return 0 end \u8fd9\u662f\u4f7f\u7528 Lua \u811a\u672c\uff08 unlock.script \uff09\u5b9e\u73b0\u7684\u91ca\u653e\u9501\u64cd\u4f5c\u7684\u4f2a\u4ee3\u7801\uff0c\u5176\u4e2d\uff0c KEYS[1] \u8868\u793a lock_key \uff0c ARGV[1] \u662f\u5f53\u524d\u5ba2\u6237\u7aef\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u8fd9\u4e24\u4e2a\u503c\u90fd\u662f\u6211\u4eec\u5728\u6267\u884c Lua \u811a\u672c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u7684\u3002 \u6700\u540e\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u9501\u91ca\u653e\u64cd\u4f5c\u4e86\u3002 redis-cli --eval unlock.script lock_key , unique_value \u5728\u91ca\u653e\u9501\u64cd\u4f5c\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u4e86 Lua \u811a\u672c\uff0c\u8fd9\u662f\u56e0\u4e3a\uff0c\u91ca\u653e\u9501\u64cd\u4f5c\u7684\u903b\u8f91\u4e5f\u5305\u542b\u4e86\u8bfb\u53d6\u9501\u53d8\u91cf\u3001\u5224\u65ad\u503c\u3001\u5220\u9664\u9501\u53d8\u91cf\u7684\u591a\u4e2a\u64cd\u4f5c\uff0c\u800c Redis \u5728\u6267\u884c Lua \u811a\u672c\u65f6\uff0c\u53ef\u4ee5\u4ee5\u539f\u5b50\u6027\u7684\u65b9\u5f0f\u6267\u884c\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86\u9501\u91ca\u653e\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002","title":"2-4 Redis \u7684 SET \u547d\u4ee4"},{"location":"chap6/3redis_distributed_locks/#3-redis","text":"\u4e3a\u4e86\u907f\u514d Redis \u5b9e\u4f8b\u6545\u969c\u800c\u5bfc\u81f4\u7684\u9501\u65e0\u6cd5\u5de5\u4f5c\u7684\u95ee\u9898\uff0cRedis \u7684\u5f00\u53d1\u8005 Antirez \u63d0\u51fa\u4e86\u5206\u5e03\u5f0f\u9501\u7b97\u6cd5 Redlock\u3002 Redlock \u7b97\u6cd5\u7684\u57fa\u672c\u601d\u8def\uff0c\u662f\u8ba9\u5ba2\u6237\u7aef\u548c\u591a\u4e2a\u72ec\u7acb\u7684 Redis \u5b9e\u4f8b\u4f9d\u6b21\u8bf7\u6c42\u52a0\u9501\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u80fd\u591f\u548c\u534a\u6570\u4ee5\u4e0a\u7684\u5b9e\u4f8b\u6210\u529f\u5730\u5b8c\u6210\u52a0\u9501\u64cd\u4f5c\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u8ba4\u4e3a\uff0c\u5ba2\u6237\u7aef\u6210\u529f\u5730\u83b7\u5f97\u5206\u5e03\u5f0f\u9501\u4e86\uff0c\u5426\u5219\u52a0\u9501\u5931\u8d25 \u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u6709\u5355\u4e2a Redis \u5b9e\u4f8b\u53d1\u751f\u6545\u969c\uff0c\u56e0\u4e3a\u9501\u53d8\u91cf\u5728\u5176\u5b83\u5b9e\u4f8b\u4e0a\u4e5f\u6709\u4fdd\u5b58\uff0c\u6240\u4ee5\uff0c\u5ba2\u6237\u7aef\u4ecd\u7136\u53ef\u4ee5\u6b63\u5e38\u5730\u8fdb\u884c\u9501\u64cd\u4f5c\uff0c\u9501\u53d8\u91cf\u5e76\u4e0d\u4f1a\u4e22\u5931\u3002 Redlock \u7b97\u6cd5\u7684\u6267\u884c\u6b65\u9aa4\u3002Redlock \u7b97\u6cd5\u7684\u5b9e\u73b0\u9700\u8981\u6709 N \u4e2a\u72ec\u7acb\u7684 Redis \u5b9e\u4f8b\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u53ef\u4ee5\u5206\u6210 3 \u6b65\u6765\u5b8c\u6210\u52a0\u9501\u64cd\u4f5c\u3002 \u7b2c\u4e00\u6b65\u662f\uff0c\u5ba2\u6237\u7aef\u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u3002 \u7b2c\u4e8c\u6b65\u662f\uff0c\u5ba2\u6237\u7aef\u6309\u987a\u5e8f\u4f9d\u6b21\u5411 N \u4e2a Redis \u5b9e\u4f8b\u6267\u884c\u52a0\u9501\u64cd\u4f5c\u3002 \u8fd9\u91cc\u7684\u52a0\u9501\u64cd\u4f5c\u548c\u5728\u5355\u5b9e\u4f8b\u4e0a\u6267\u884c\u7684\u52a0\u9501\u64cd\u4f5c\u4e00\u6837\uff0c\u4f7f\u7528 SET \u547d\u4ee4\uff0c\u5e26\u4e0a NX\uff0cEX/PX \u9009\u9879\uff0c\u4ee5\u53ca\u5e26\u4e0a\u5ba2\u6237\u7aef\u7684\u552f\u4e00\u6807\u8bc6\u3002\u5f53\u7136\uff0c\u5982\u679c\u67d0\u4e2a Redis \u5b9e\u4f8b\u53d1\u751f\u6545\u969c\u4e86\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cRedlock \u7b97\u6cd5\u80fd\u591f\u7ee7\u7eed\u8fd0\u884c\uff0c\u6211\u4eec\u9700\u8981\u7ed9\u52a0\u9501\u64cd\u4f5c\u8bbe\u7f6e\u4e00\u4e2a\u8d85\u65f6\u65f6\u95f4 \u5982\u679c\u5ba2\u6237\u7aef\u5728\u548c\u4e00\u4e2a Redis \u5b9e\u4f8b\u8bf7\u6c42\u52a0\u9501\u65f6\uff0c\u4e00\u76f4\u5230\u8d85\u65f6\u90fd\u6ca1\u6709\u6210\u529f\uff0c\u90a3\u4e48\u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u4f1a\u548c\u4e0b\u4e00\u4e2a Redis \u5b9e\u4f8b\u7ee7\u7eed\u8bf7\u6c42\u52a0\u9501\u3002\u52a0\u9501\u64cd\u4f5c\u7684\u8d85\u65f6\u65f6\u95f4\u9700\u8981\u8fdc\u8fdc\u5730\u5c0f\u4e8e\u9501\u7684\u6709\u6548\u65f6\u95f4\uff0c\u4e00\u822c\u4e5f\u5c31\u662f\u8bbe\u7f6e\u4e3a\u51e0\u5341\u6beb\u79d2\u3002 \u7b2c\u4e09\u6b65\u662f\uff0c\u4e00\u65e6\u5ba2\u6237\u7aef\u5b8c\u6210\u4e86\u548c\u6240\u6709 Redis \u5b9e\u4f8b\u7684\u52a0\u9501\u64cd\u4f5c\uff0c\u5ba2\u6237\u7aef\u5c31\u8981\u8ba1\u7b97\u6574\u4e2a\u52a0\u9501\u8fc7\u7a0b\u7684\u603b\u8017\u65f6\u3002 \u5ba2\u6237\u7aef\u53ea\u6709\u5728\u6ee1\u8db3\u4e0b\u9762\u7684\u8fd9\u4e24\u4e2a\u6761\u4ef6\u65f6\uff0c\u624d\u80fd\u8ba4\u4e3a\u662f\u52a0\u9501\u6210\u529f\u3002 \u6761\u4ef6\u4e00\uff1a\u5ba2\u6237\u7aef\u4ece\u8d85\u8fc7\u534a\u6570 \uff08\u5927\u4e8e\u7b49\u4e8e N/2+1\uff09 \u7684 Redis \u5b9e\u4f8b\u4e0a\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff1b \u6761\u4ef6\u4e8c\uff1a\u5ba2\u6237\u7aef\u83b7\u53d6\u9501\u7684\u603b\u8017\u65f6\u6ca1\u6709\u8d85\u8fc7\u9501\u7684\u6709\u6548\u65f6\u95f4\u3002 \u5728\u6ee1\u8db3\u4e86\u8fd9\u4e24\u4e2a\u6761\u4ef6\u540e\uff0c\u6211\u4eec\u9700\u8981\u91cd\u65b0\u8ba1\u7b97\u8fd9\u628a\u9501\u7684\u6709\u6548\u65f6\u95f4\uff0c\u8ba1\u7b97\u7684\u7ed3\u679c\u662f\u9501\u7684\u6700\u521d\u6709\u6548\u65f6\u95f4\u51cf\u53bb\u5ba2\u6237\u7aef\u4e3a\u83b7\u53d6\u9501\u7684\u603b\u8017\u65f6\u3002 \u5982\u679c\u9501\u7684\u6709\u6548\u65f6\u95f4\u5df2\u7ecf\u6765\u4e0d\u53ca\u5b8c\u6210\u5171\u4eab\u6570\u636e\u7684\u64cd\u4f5c\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u91ca\u653e\u9501\uff0c\u4ee5\u514d\u51fa\u73b0\u8fd8\u6ca1\u5b8c\u6210\u6570\u636e\u64cd\u4f5c\uff0c\u9501\u5c31\u8fc7\u671f\u4e86\u7684\u60c5\u51b5\u3002 \u5728 Redlock \u7b97\u6cd5\u4e2d\uff0c\u91ca\u653e\u9501\u7684\u64cd\u4f5c\u548c\u5728\u5355\u5b9e\u4f8b\u4e0a\u91ca\u653e\u9501\u7684\u64cd\u4f5c\u4e00\u6837\uff0c\u53ea\u8981\u6267\u884c\u91ca\u653e\u9501\u7684 Lua \u811a\u672c\u5c31\u53ef\u4ee5\u4e86\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u53ea\u8981 N \u4e2a Redis \u5b9e\u4f8b\u4e2d\u7684\u534a\u6570\u4ee5\u4e0a\u5b9e\u4f8b\u80fd\u6b63\u5e38\u5de5\u4f5c\uff0c\u5c31\u80fd\u4fdd\u8bc1\u5206\u5e03\u5f0f\u9501\u7684\u6b63\u5e38\u5de5\u4f5c\u4e86\u3002","title":"3\u3001\u57fa\u4e8e\u591a\u4e2a Redis \u8282\u70b9\u5b9e\u73b0\u9ad8\u53ef\u9760\u7684\u5206\u5e03\u5f0f\u9501"},{"location":"chap6/3redis_distributed_locks/#4","text":"\u5206\u5e03\u5f0f\u9501\u662f\u7531\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u7ef4\u62a4\u7684\u53d8\u91cf\uff0c\u591a\u4e2a\u5ba2\u6237\u7aef\u53ef\u4ee5\u5411\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u53d1\u9001\u547d\u4ee4\u8fdb\u884c\u52a0\u9501\u6216\u91ca\u653e\u9501\u64cd\u4f5c\u3002 Redis \u4f5c\u4e3a\u4e00\u4e2a\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\uff0c\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u3002 \u5728\u57fa\u4e8e\u5355\u4e2a Redis \u5b9e\u4f8b\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u65f6\uff0c\u5bf9\u4e8e\u52a0\u9501\u64cd\u4f5c\uff0c\u6211\u4eec\u9700\u8981\u6ee1\u8db3\u4e09\u4e2a\u6761\u4ef6\u3002 \u52a0\u9501\u5305\u62ec\u4e86 \u8bfb\u53d6\u9501\u53d8\u91cf\u3001\u68c0\u67e5\u9501\u53d8\u91cf\u503c\u548c\u8bbe\u7f6e\u9501\u53d8\u91cf\u503c \u4e09\u4e2a\u64cd\u4f5c\uff0c\u4f46\u9700\u8981\u4ee5\u539f\u5b50\u64cd\u4f5c\u7684\u65b9\u5f0f\u5b8c\u6210\uff0c\u6240\u4ee5 \uff0c\u6211\u4eec\u4f7f\u7528 SET \u547d\u4ee4\u5e26\u4e0a NX \u9009\u9879\u6765\u5b9e\u73b0\u52a0\u9501 \uff1b \u9501\u53d8\u91cf\u9700\u8981\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u514d\u5ba2\u6237\u7aef\u62ff\u5230\u9501\u540e\u53d1\u751f\u5f02\u5e38\uff0c\u5bfc\u81f4\u9501\u4e00\u76f4\u65e0\u6cd5\u91ca\u653e\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5728 SET \u547d\u4ee4\u6267\u884c\u65f6\u52a0\u4e0a EX/PX \u9009\u9879 \uff0c\u8bbe\u7f6e\u5176\u8fc7\u671f\u65f6\u95f4\uff1b \u9501\u53d8\u91cf\u7684\u503c\u9700\u8981\u80fd\u533a\u5206\u6765\u81ea\u4e0d\u540c\u5ba2\u6237\u7aef\u7684\u52a0\u9501\u64cd\u4f5c\uff0c\u4ee5\u514d\u5728\u91ca\u653e\u9501\u65f6\uff0c\u51fa\u73b0\u8bef\u91ca\u653e\u64cd\u4f5c\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u4f7f\u7528 SET \u547d\u4ee4\u8bbe\u7f6e\u9501\u53d8\u91cf\u503c\u65f6\uff0c\u6bcf\u4e2a\u5ba2\u6237\u7aef\u8bbe\u7f6e\u7684\u503c\u662f\u4e00\u4e2a\u552f\u4e00\u503c\uff0c\u7528\u4e8e\u6807\u8bc6\u5ba2\u6237\u7aef\u3002 \u548c\u52a0\u9501\u7c7b\u4f3c\uff0c\u91ca\u653e\u9501\u4e5f\u5305\u542b\u4e86\u8bfb\u53d6\u9501\u53d8\u91cf\u503c\u3001\u5224\u65ad\u9501\u53d8\u91cf\u503c\u548c\u5220\u9664\u9501\u53d8\u91cf\u4e09\u4e2a\u64cd\u4f5c\uff0c\u4e0d\u8fc7\uff0c\u6211\u4eec\u65e0\u6cd5\u4f7f\u7528\u5355\u4e2a\u547d\u4ee4\u6765\u5b9e\u73b0\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528 Lua \u811a\u672c\u6267\u884c\u91ca\u653e\u9501\u64cd\u4f5c\uff0c\u901a\u8fc7 Redis \u539f\u5b50\u6027\u5730\u6267\u884c Lua \u811a\u672c\uff0c\u6765\u4fdd\u8bc1\u91ca\u653e\u9501\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002 \u4e0d\u8fc7\uff0c\u57fa\u4e8e\u5355\u4e2a Redis \u5b9e\u4f8b\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u65f6\uff0c\u4f1a\u9762\u4e34\u5b9e\u4f8b\u5f02\u5e38\u6216\u5d29\u6e83\u7684\u60c5\u51b5\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u5b9e\u4f8b\u65e0\u6cd5\u63d0\u4f9b\u9501\u64cd\u4f5c\uff0c \u6b63\u56e0\u4e3a\u6b64\uff0cRedis \u4e5f\u63d0\u4f9b\u4e86 Redlock \u7b97\u6cd5\uff0c\u7528\u6765\u5b9e\u73b0\u57fa\u4e8e\u591a\u4e2a\u5b9e\u4f8b\u7684\u5206\u5e03\u5f0f\u9501 \u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u9501\u53d8\u91cf\u7531\u591a\u4e2a\u5b9e\u4f8b\u7ef4\u62a4\uff0c\u5373\u4f7f\u6709\u5b9e\u4f8b\u53d1\u751f\u4e86\u6545\u969c\uff0c\u9501\u53d8\u91cf\u4ecd\u7136\u662f\u5b58\u5728\u7684\uff0c\u5ba2\u6237\u7aef\u8fd8\u662f\u53ef\u4ee5\u5b8c\u6210\u9501\u64cd\u4f5c","title":"4\u3001\u672c\u8282\u603b\u7ed3"},{"location":"chap6/4redis_acid/","text":"\u7b2c\u56db\u8282 \u4e8b\u52a1\u673a\u5236 Redis\u5b9e\u73b0ACID\u5c5e\u6027 \u4e8b\u52a1\u662f\u6570\u636e\u5e93\u7684\u4e00\u4e2a\u91cd\u8981\u529f\u80fd\u3002\u6240\u8c13\u7684\u4e8b\u52a1\uff0c\u5c31\u662f\u6307\u5bf9\u6570\u636e\u8fdb\u884c\u8bfb\u5199\u7684\u4e00\u7cfb\u5217\u64cd\u4f5c\u3002 \u4e8b\u52a1\u5728\u6267\u884c\u65f6\uff0c\u4f1a\u63d0\u4f9b\u4e13\u95e8\u7684\u5c5e\u6027\u4fdd\u8bc1\uff0c\u5305\u62ec\u539f\u5b50\u6027\uff08Atomicity\uff09\u3001\u4e00\u81f4\u6027\uff08Consistency\uff09\u3001\u9694\u79bb\u6027\uff08Isolation\uff09\u548c\u6301\u4e45\u6027\uff08Durability\uff09\uff0c\u4e5f\u5c31\u662f ACID \u5c5e\u6027\u3002 \u8fd9\u4e9b\u5c5e\u6027\u65e2\u5305\u62ec\u4e86\u5bf9\u4e8b\u52a1\u6267\u884c\u7ed3\u679c\u7684\u8981\u6c42\uff0c\u4e5f\u6709\u5bf9\u6570\u636e\u5e93\u5728\u4e8b\u52a1\u6267\u884c\u524d\u540e\u7684\u6570\u636e\u72b6\u6001\u53d8\u5316\u7684\u8981\u6c42 1\u3001\u4e8b\u52a1 ACID \u5c5e\u6027\u7684\u8981\u6c42 \u9996\u5148\u6765\u770b\u539f\u5b50\u6027\u3002\u539f\u5b50\u6027\u7684\u8981\u6c42\u5f88\u660e\u786e\uff0c \u5c31\u662f\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u7684\u591a\u4e2a\u64cd\u4f5c\u5fc5\u987b\u90fd\u5b8c\u6210\uff0c\u6216\u8005\u90fd\u4e0d\u5b8c\u6210 \u3002\u4e1a\u52a1\u5e94\u7528\u4f7f\u7528\u4e8b\u52a1\u65f6\uff0c\u539f\u5b50\u6027\u4e5f\u662f\u6700\u88ab\u770b\u91cd\u7684\u4e00\u4e2a\u5c5e\u6027\u3002 \u6211\u7ed9\u4f60\u4e3e\u4e2a\u4f8b\u5b50\u3002\u5047\u5982\u7528\u6237\u5728\u4e00\u4e2a\u8ba2\u5355\u4e2d\u8d2d\u4e70\u4e86\u4e24\u4e2a\u5546\u54c1 A \u548c B\uff0c\u90a3\u4e48\uff0c\u6570\u636e\u5e93\u5c31\u9700\u8981\u628a\u8fd9\u4e24\u4e2a\u5546\u54c1\u7684\u5e93\u5b58\u90fd\u8fdb\u884c\u6263\u51cf\u3002\u5982\u679c\u53ea\u6263\u51cf\u4e86\u4e00\u4e2a\u5546\u54c1\u7684\u5e93\u5b58\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e2a\u8ba2\u5355\u5b8c\u6210\u540e\uff0c\u53e6\u4e00\u4e2a\u5546\u54c1\u7684\u5e93\u5b58\u80af\u5b9a\u5c31\u9519\u4e86\u3002 \u7b2c\u4e8c\u4e2a\u5c5e\u6027\u662f\u4e00\u81f4\u6027\u3002\u8fd9\u4e2a\u5f88\u5bb9\u6613\u7406\u89e3\uff0c \u5c31\u662f\u6307\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u5728\u4e8b\u52a1\u6267\u884c\u524d\u540e\u662f\u4e00\u81f4\u7684 \u3002 \u7b2c\u4e09\u4e2a\u5c5e\u6027\u662f\u9694\u79bb\u6027\u3002 \u5b83\u8981\u6c42\u6570\u636e\u5e93\u5728\u6267\u884c\u4e00\u4e2a\u4e8b\u52a1\u65f6\uff0c\u5176\u5b83\u64cd\u4f5c\u65e0\u6cd5\u5b58\u53d6\u5230\u6b63\u5728\u6267\u884c\u4e8b\u52a1\u8bbf\u95ee\u7684\u6570\u636e\u3002 \u501f\u52a9\u7528\u6237\u4e0b\u5355\u7684\u4f8b\u5b50\u7ed9\u4f60\u89e3\u91ca\u4e0b\u3002\u5047\u8bbe\u5546\u54c1 A \u548c B \u7684\u73b0\u6709\u5e93\u5b58\u5206\u522b\u662f 5 \u548c 10\uff0c \u7528\u6237 X \u5bf9 A\u3001B \u4e0b\u5355\u7684\u6570\u91cf\u5206\u522b\u662f 3\u30016 \u3002\u5982\u679c\u4e8b\u52a1\u4e0d\u5177\u5907\u9694\u79bb\u6027\uff0c\u5728\u7528\u6237 X \u4e0b\u5355\u4e8b\u52a1\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u7528\u6237 Y \u4e00\u4e0b\u5b50\u4e5f\u8d2d\u4e70\u4e86 5 \u4ef6 B\uff0c\u8fd9\u548c X \u8d2d\u4e70\u7684 6 \u4ef6 B \u7d2f\u52a0\u540e\uff0c\u5c31\u8d85\u8fc7 B \u7684\u603b\u5e93\u5b58\u503c\u4e86\uff0c\u8fd9\u5c31\u4e0d\u7b26\u5408\u4e1a\u52a1\u8981\u6c42\u4e86\u3002 \u6700\u540e\u4e00\u4e2a\u5c5e\u6027\u662f\u6301\u4e45\u6027\u3002\u6570\u636e\u5e93\u6267\u884c\u4e8b\u52a1\u540e\uff0c\u6570\u636e\u7684\u4fee\u6539\u8981\u88ab\u6301\u4e45\u5316\u4fdd\u5b58\u4e0b\u6765\u3002\u5f53\u6570\u636e\u5e93\u91cd\u542f\u540e\uff0c\u6570\u636e\u7684\u503c\u9700\u8981\u662f\u88ab\u4fee\u6539\u540e\u7684\u503c\u3002 2\u3001Redis \u5982\u4f55\u5b9e\u73b0\u4e8b\u52a1\uff1f \u4e8b\u52a1\u7684\u6267\u884c\u8fc7\u7a0b\u5305\u542b\u4e09\u4e2a\u6b65\u9aa4\uff0cRedis \u63d0\u4f9b\u4e86 MULTI \u3001 EXEC \u4e24\u4e2a\u547d\u4ee4\u6765\u5b8c\u6210\u8fd9\u4e09\u4e2a\u6b65\u9aa4\u3002\u4e0b\u9762\u6211\u4eec\u6765\u5206\u6790\u4e0b\u3002 \u7b2c\u4e00\u6b65\uff0c\u5ba2\u6237\u7aef\u8981\u4f7f\u7528\u4e00\u4e2a\u547d\u4ee4\u663e\u5f0f\u5730\u8868\u793a\u4e00\u4e2a\u4e8b\u52a1\u7684\u5f00\u542f \u3002\u5728 Redis \u4e2d\uff0c\u8fd9\u4e2a\u547d\u4ee4\u5c31\u662f MULTI\u3002 \u7b2c\u4e8c\u6b65\uff0c\u5ba2\u6237\u7aef\u628a\u4e8b\u52a1\u4e2d\u672c\u8eab\u8981\u6267\u884c\u7684\u5177\u4f53\u64cd\u4f5c\uff08\u4f8b\u5982\u589e\u5220\u6539\u6570\u636e\uff09\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7aef \u3002\u8fd9\u4e9b\u64cd\u4f5c\u5c31\u662f Redis \u672c\u8eab\u63d0\u4f9b\u7684\u6570\u636e\u8bfb\u5199\u547d\u4ee4\uff0c\u4f8b\u5982 GET\u3001SET \u7b49\u3002\u4e0d\u8fc7\uff0c\u8fd9\u4e9b\u547d\u4ee4\u867d\u7136\u88ab\u5ba2\u6237\u7aef\u53d1\u9001\u5230\u4e86\u670d\u52a1\u5668\u7aef\uff0c\u4f46 Redis \u5b9e\u4f8b\u53ea\u662f\u628a\u8fd9\u4e9b\u547d\u4ee4\u6682\u5b58\u5230\u4e00\u4e2a\u547d\u4ee4\u961f\u5217\u4e2d\uff0c\u5e76\u4e0d\u4f1a\u7acb\u5373\u6267\u884c\u3002 \u7b2c\u4e09\u6b65\uff0c\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u7aef\u53d1\u9001\u63d0\u4ea4\u4e8b\u52a1\u7684\u547d\u4ee4\uff0c\u8ba9\u6570\u636e\u5e93\u5b9e\u9645\u6267\u884c\u7b2c\u4e8c\u6b65\u4e2d\u53d1\u9001\u7684\u5177\u4f53\u64cd\u4f5c\u3002 Redis \u63d0\u4f9b\u7684 EXEC \u547d\u4ee4 \u5c31\u662f\u6267\u884c\u4e8b\u52a1\u63d0\u4ea4\u7684\u3002\u5f53\u670d\u52a1\u5668\u7aef\u6536\u5230 EXEC \u547d\u4ee4\u540e\uff0c\u624d\u4f1a\u5b9e\u9645\u6267\u884c\u547d\u4ee4\u961f\u5217\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u3002 \u4e0b\u9762\u7684\u4ee3\u7801\u5c31\u663e\u793a\u4e86\u4f7f\u7528 MULTI \u548c EXEC \u6267\u884c\u4e00\u4e2a\u4e8b\u52a1\u7684\u8fc7\u7a0b #\u5f00\u542f\u4e8b\u52a1 127.0.0.1:6379> MULTI OK #\u5c06a:stock\u51cf1\uff0c 127.0.0.1:6379> DECR a:stock QUEUED #\u5c06b:stock\u51cf1 127.0.0.1:6379> DECR b:stock QUEUED #\u5b9e\u9645\u6267\u884c\u4e8b\u52a1 127.0.0.1:6379> EXEC 1) (integer) 4 2) (integer) 9 \u5047\u8bbe a:stock \u3001 b:stock \u4e24\u4e2a\u952e\u7684\u521d\u59cb\u503c\u662f 5 \u548c 10\u3002 \u5728 MULTI \u547d\u4ee4\u540e\u6267\u884c\u7684\u4e24\u4e2a DECR \u547d\u4ee4\uff0c\u662f\u628a a:stock \u3001 b:stock \u4e24\u4e2a\u952e\u7684\u503c\u5206\u522b\u51cf 1\uff0c\u5b83\u4eec\u6267\u884c\u540e\u7684\u8fd4\u56de\u7ed3\u679c\u90fd\u662f QUEUED \uff0c\u8fd9\u5c31\u8868\u793a\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u88ab\u6682\u5b58\u5230\u4e86\u547d\u4ee4\u961f\u5217\uff0c\u8fd8\u6ca1\u6709\u5b9e\u9645\u6267\u884c\u3002 \u7b49\u5230\u6267\u884c\u4e86 EXEC \u547d\u4ee4\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u8fd4\u56de\u4e86 4\u30019\uff0c\u8fd9\u5c31\u8868\u660e\uff0c\u4e24\u4e2a DECR \u547d\u4ee4\u5df2\u7ecf\u6210\u529f\u5730\u6267\u884c\u4e86\u3002 3\u3001Redis \u7684\u4e8b\u52a1\u673a\u5236\u80fd\u4fdd\u8bc1\u54ea\u4e9b\u5c5e\u6027\uff1f 3-1 \u539f\u5b50\u6027 \u5982\u679c\u4e8b\u52a1\u6b63\u5e38\u6267\u884c\uff0c\u6ca1\u6709\u53d1\u751f\u4efb\u4f55\u9519\u8bef\uff0c\u90a3\u4e48\uff0cMULTI \u548c EXEC \u914d\u5408\u4f7f\u7528\uff0c\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u591a\u4e2a\u64cd\u4f5c\u90fd\u5b8c\u6210\u3002\u4f46\u662f\uff0c\u5982\u679c\u4e8b\u52a1\u6267\u884c\u53d1\u751f\u9519\u8bef\u4e86\uff0c\u539f\u5b50\u6027\u8fd8\u80fd\u4fdd\u8bc1\u5417 \u7b2c\u4e00\u79cd\u60c5\u51b5\u662f\uff0c \u5728\u6267\u884c EXEC \u547d\u4ee4\u524d\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u64cd\u4f5c\u547d\u4ee4\u672c\u8eab\u5c31\u6709\u9519\u8bef\uff08\u6bd4\u5982\u8bed\u6cd5\u9519\u8bef\uff0c\u4f7f\u7528\u4e86\u4e0d\u5b58\u5728\u7684\u547d\u4ee4\uff09 \uff0c\u5728\u547d\u4ee4\u5165\u961f\u65f6\u5c31\u88ab Redis \u5b9e\u4f8b\u5224\u65ad\u51fa\u6765\u4e86\u3002 \u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\uff0c \u5728\u547d\u4ee4\u5165\u961f\u65f6\uff0cRedis \u5c31\u4f1a\u62a5\u9519\u5e76\u4e14\u8bb0\u5f55\u4e0b\u8fd9\u4e2a\u9519\u8bef \u3002 \u6b64\u65f6\uff0c\u8fd8\u80fd\u7ee7\u7eed\u63d0\u4ea4\u547d\u4ee4\u64cd\u4f5c\u3002 \u7b49\u5230\u6267\u884c\u4e86 EXEC \u547d\u4ee4\u4e4b\u540e\uff0cRedis \u5c31\u4f1a\u62d2\u7edd\u6267\u884c\u6240\u6709\u63d0\u4ea4\u7684\u547d\u4ee4\u64cd\u4f5c\uff0c\u8fd4\u56de\u4e8b\u52a1\u5931\u8d25\u7684\u7ed3\u679c \u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u90fd\u4e0d\u4f1a\u518d\u88ab\u6267\u884c\u4e86\uff0c\u4fdd\u8bc1\u4e86\u539f\u5b50\u6027\u3002 \u4e8b\u52a1\u64cd\u4f5c\u5165\u961f\u65f6\u53d1\u751f\u9519\u8bef\uff0c\u800c\u5bfc\u81f4\u4e8b\u52a1\u5931\u8d25\u7684\u5c0f\u4f8b\u5b50\u3002 #\u5f00\u542f\u4e8b\u52a1 127.0.0.1:6379> MULTI OK #\u53d1\u9001\u4e8b\u52a1\u4e2d\u7684\u7b2c\u4e00\u4e2a\u64cd\u4f5c\uff0c\u4f46\u662fRedis\u4e0d\u652f\u6301\u8be5\u547d\u4ee4\uff0c\u8fd4\u56de\u62a5\u9519\u4fe1\u606f 127.0.0.1:6379> PUT a:stock 5 (error) ERR unknown command `PUT`, with args beginning with: `a:stock`, `5`, #\u53d1\u9001\u4e8b\u52a1\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u662f\u6b63\u786e\u7684\u547d\u4ee4\uff0cRedis\u628a\u8be5\u547d\u4ee4\u5165\u961f 127.0.0.1:6379> DECR b:stock QUEUED #\u5b9e\u9645\u6267\u884c\u4e8b\u52a1\uff0c\u4f46\u662f\u4e4b\u524d\u547d\u4ee4\u6709\u9519\u8bef\uff0c\u6240\u4ee5Redis\u62d2\u7edd\u6267\u884c 127.0.0.1:6379> EXEC (error) EXECABORT Transaction discarded because of previous errors. \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c \u4e8b\u52a1\u91cc\u5305\u542b\u4e86\u4e00\u4e2a Redis \u672c\u8eab\u5c31\u4e0d\u652f\u6301\u7684 PUT \u547d\u4ee4\uff0c\u6240\u4ee5\uff0c\u5728 PUT \u547d\u4ee4\u5165\u961f\u65f6\uff0cRedis \u5c31\u62a5\u9519\u4e86 \u3002 \u867d\u7136\uff0c\u4e8b\u52a1\u91cc\u8fd8\u6709\u4e00\u4e2a\u6b63\u786e\u7684 DECR \u547d\u4ee4\uff0c\u4f46\u662f\uff0c\u5728\u6700\u540e\u6267\u884c EXEC \u547d\u4ee4\u540e\uff0c\u6574\u4e2a\u4e8b\u52a1\u88ab\u653e\u5f03\u6267\u884c\u4e86\u3002 \u7b2c\u4e8c\u79cd\u60c5\u51b5\u3002\u548c\u7b2c\u4e00\u79cd\u60c5\u51b5\u4e0d\u540c\u7684\u662f\uff1a \u4e8b\u52a1\u64cd\u4f5c\u5165\u961f\u65f6\uff0c\u547d\u4ee4\u548c\u64cd\u4f5c\u7684\u6570\u636e\u7c7b\u578b\u4e0d\u5339\u914d\uff0c\u4f46 Redis \u5b9e\u4f8b\u6ca1\u6709\u68c0\u67e5\u51fa\u9519\u8bef \u3002\u4f46\u662f\uff0c\u5728\u6267\u884c\u5b8c EXEC \u547d\u4ee4\u4ee5\u540e\uff0cRedis \u5b9e\u9645\u6267\u884c\u8fd9\u4e9b\u4e8b\u52a1\u64cd\u4f5c\u65f6\uff0c\u5c31\u4f1a\u62a5\u9519\u3002\u4e0d\u8fc7\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u867d\u7136 Redis \u4f1a\u5bf9\u9519\u8bef\u547d\u4ee4\u62a5\u9519\uff0c \u4f46\u8fd8\u662f\u4f1a\u628a\u6b63\u786e\u7684\u547d\u4ee4\u6267\u884c\u5b8c\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e8b\u52a1\u7684\u539f\u5b50\u6027\u5c31\u65e0\u6cd5\u5f97\u5230\u4fdd\u8bc1\u4e86 \u3002 \u4e3e\u4e2a\u5c0f\u4f8b\u5b50\u3002\u4e8b\u52a1\u4e2d\u7684 LPOP \u547d\u4ee4\u5bf9 String \u7c7b\u578b\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\uff0c\u5165\u961f\u65f6\u6ca1\u6709\u62a5\u9519\uff0c\u4f46\u662f\uff0c\u5728 EXEC \u6267\u884c\u65f6\u62a5\u9519\u4e86\u3002LPOP \u547d\u4ee4\u672c\u8eab\u6ca1\u6709\u6267\u884c\u6210\u529f\uff0c\u4f46\u662f\u4e8b\u52a1\u4e2d\u7684 DECR \u547d\u4ee4\u5374\u6210\u529f\u6267\u884c\u4e86\u3002 #\u5f00\u542f\u4e8b\u52a1 127.0.0.1:6379> MULTI OK #\u53d1\u9001\u4e8b\u52a1\u4e2d\u7684\u7b2c\u4e00\u4e2a\u64cd\u4f5c\uff0cLPOP\u547d\u4ee4\u64cd\u4f5c\u7684\u6570\u636e\u7c7b\u578b\u4e0d\u5339\u914d\uff0c\u6b64\u65f6\u5e76\u4e0d\u62a5\u9519 127.0.0.1:6379> LPOP a:stock QUEUED #\u53d1\u9001\u4e8b\u52a1\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u64cd\u4f5c 127.0.0.1:6379> DECR b:stock QUEUED #\u5b9e\u9645\u6267\u884c\u4e8b\u52a1\uff0c\u4e8b\u52a1\u7b2c\u4e00\u4e2a\u64cd\u4f5c\u6267\u884c\u62a5\u9519 127.0.0.1:6379> EXEC 1) (error) WRONGTYPE Operation against a key holding the wrong kind of value 2) (integer) 8 Redis \u4e2d\u5e76\u6ca1\u6709\u63d0\u4f9b\u56de\u6eda\u673a\u5236\u3002 \u867d\u7136 Redis \u63d0\u4f9b\u4e86 DISCARD \u547d\u4ee4\uff0c\u4f46\u662f\uff0c\u8fd9\u4e2a\u547d\u4ee4\u53ea\u80fd\u7528\u6765\u4e3b\u52a8\u653e\u5f03\u4e8b\u52a1\u6267\u884c\uff0c\u628a\u6682\u5b58\u7684\u547d\u4ee4\u961f\u5217\u6e05\u7a7a\uff0c\u8d77\u4e0d\u5230\u56de\u6eda\u7684\u6548\u679c\u3002 #\u8bfb\u53d6a:stock\u7684\u503c4 127.0.0.1:6379> GET a:stock \"4\" #\u5f00\u542f\u4e8b\u52a1 127.0.0.1:6379> MULTI OK #\u53d1\u9001\u4e8b\u52a1\u7684\u7b2c\u4e00\u4e2a\u64cd\u4f5c\uff0c\u5bf9a:stock\u51cf1 127.0.0.1:6379> DECR a:stock QUEUED #\u6267\u884cDISCARD\u547d\u4ee4\uff0c\u4e3b\u52a8\u653e\u5f03\u4e8b\u52a1 127.0.0.1:6379> DISCARD OK #\u518d\u6b21\u8bfb\u53d6a:stock\u7684\u503c\uff0c\u503c\u6ca1\u6709\u88ab\u4fee\u6539 127.0.0.1:6379> GET a:stock \"4\" \u4f8b\u5b50\u4e2d\uff0ca:stock \u952e\u7684\u503c\u4e00\u5f00\u59cb\u4e3a 4\uff0c\u7136\u540e\uff0c\u6211\u4eec\u6267\u884c\u4e00\u4e2a\u4e8b\u52a1\uff0c\u60f3\u5bf9 a:stock \u7684\u503c\u51cf 1\u3002\u4f46\u662f\uff0c\u5728\u4e8b\u52a1\u7684\u6700\u540e\uff0c\u6211\u4eec\u6267\u884c\u7684\u662f DISCARD \u547d\u4ee4\uff0c\u6240\u4ee5\u4e8b\u52a1\u5c31\u88ab\u653e\u5f03\u4e86\u3002\u6211\u4eec\u518d\u6b21\u67e5\u770b a:stock \u7684\u503c\uff0c\u4f1a\u53d1\u73b0\u4ecd\u7136\u4e3a 4\u3002 \u7b2c\u4e09\u79cd\u60c5\u51b5\uff1a\u5728\u6267\u884c\u4e8b\u52a1\u7684 EXEC \u547d\u4ee4\u65f6\uff0cRedis \u5b9e\u4f8b\u53d1\u751f\u4e86\u6545\u969c\uff0c\u5bfc\u81f4\u4e8b\u52a1\u6267\u884c\u5931\u8d25\u3002 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c Redis \u5f00\u542f\u4e86 AOF \u65e5\u5fd7\uff0c\u90a3\u4e48\uff0c\u53ea\u4f1a\u6709\u90e8\u5206\u7684\u4e8b\u52a1\u64cd\u4f5c\u88ab\u8bb0\u5f55\u5230 AOF \u65e5\u5fd7\u4e2d\u3002 \u6211\u4eec\u9700\u8981\u4f7f\u7528 redis-check-aof \u5de5\u5177\u68c0\u67e5 AOF \u65e5\u5fd7\u6587\u4ef6\uff0c\u8fd9\u4e2a\u5de5\u5177\u53ef\u4ee5\u628a\u672a\u5b8c\u6210\u7684\u4e8b\u52a1\u64cd\u4f5c\u4ece AO F \u6587\u4ef6\u4e2d\u53bb\u9664\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u4f7f\u7528 AOF \u6062\u590d\u5b9e\u4f8b\u540e\uff0c\u4e8b\u52a1\u64cd\u4f5c\u4e0d\u4f1a\u518d\u88ab\u6267\u884c\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86\u539f\u5b50\u6027\u3002 \u5982\u679c AOF \u65e5\u5fd7\u5e76\u6ca1\u6709\u5f00\u542f\uff0c\u90a3\u4e48\u5b9e\u4f8b\u91cd\u542f\u540e\uff0c\u6570\u636e\u4e5f\u90fd\u6ca1\u6cd5\u6062\u590d\u4e86\uff0c\u6b64\u65f6\uff0c\u4e5f\u5c31\u8c08\u4e0d\u4e0a\u539f\u5b50\u6027\u4e86\u3002 Redis \u5bf9\u4e8b\u52a1\u539f\u5b50\u6027\u5c5e\u6027\u7684\u4fdd\u8bc1\u60c5\u51b5 \u547d\u4ee4\u5165\u961f\u65f6\u5c31\u62a5\u9519\uff0c\u4f1a\u653e\u5f03\u4e8b\u52a1\u6267\u884c\uff0c\u4fdd\u8bc1\u539f\u5b50\u6027\uff1b \u547d\u4ee4\u5165\u961f\u65f6\u6ca1\u62a5\u9519\uff0c\u5b9e\u9645\u6267\u884c\u65f6\u62a5\u9519\uff0c\u4e0d\u4fdd\u8bc1\u539f\u5b50\u6027\uff1b EXEC \u547d\u4ee4\u6267\u884c\u65f6\u5b9e\u4f8b\u6545\u969c\uff0c\u5982\u679c\u5f00\u542f\u4e86 AOF \u65e5\u5fd7\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u539f\u5b50\u6027\u3002 3-2 \u4e00\u81f4\u6027 \u4e8b\u52a1\u7684\u4e00\u81f4\u6027\u4fdd\u8bc1\u4f1a\u53d7\u5230\u9519\u8bef\u547d\u4ee4\u3001\u5b9e\u4f8b\u6545\u969c\u7684\u5f71\u54cd\u3002 \u60c5\u51b5\u4e00\uff1a\u547d\u4ee4\u5165\u961f\u65f6\u5c31\u62a5\u9519 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e8b\u52a1\u672c\u8eab\u5c31\u4f1a\u88ab\u653e\u5f03\u6267\u884c\uff0c\u6240\u4ee5\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u5e93\u7684\u4e00\u81f4\u6027\u3002 \u60c5\u51b5\u4e8c\uff1a\u547d\u4ee4\u5165\u961f\u65f6\u6ca1\u62a5\u9519\uff0c\u5b9e\u9645\u6267\u884c\u65f6\u62a5\u9519 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6709\u9519\u8bef\u7684\u547d\u4ee4\u4e0d\u4f1a\u88ab\u6267\u884c\uff0c\u6b63\u786e\u7684\u547d\u4ee4\u53ef\u4ee5\u6b63\u5e38\u6267\u884c\uff0c\u4e5f\u4e0d\u4f1a\u6539\u53d8\u6570\u636e\u5e93\u7684\u4e00\u81f4\u6027\u3002 \u60c5\u51b5\u4e09\uff1aEXEC \u547d\u4ee4\u6267\u884c\u65f6\u5b9e\u4f8b\u53d1\u751f\u6545\u969c \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b9e\u4f8b\u6545\u969c\u540e\u4f1a\u8fdb\u884c\u91cd\u542f\uff0c\u8fd9\u5c31\u548c\u6570\u636e\u6062\u590d\u7684\u65b9\u5f0f\u6709\u5173\u4e86\uff0c\u6211\u4eec\u8981\u6839\u636e\u5b9e\u4f8b\u662f\u5426\u5f00\u542f\u4e86 RDB \u6216 AOF \u6765\u5206\u60c5\u51b5\u8ba8\u8bba\u4e0b\u3002 \u5982\u679c\u6211\u4eec\u6ca1\u6709\u5f00\u542f RDB \u6216 AOF\uff0c\u90a3\u4e48\uff0c\u5b9e\u4f8b\u6545\u969c\u91cd\u542f\u540e\uff0c\u6570\u636e\u90fd\u6ca1\u6709\u4e86\uff0c\u6570\u636e\u5e93\u662f\u4e00\u81f4\u7684\u3002 \u5982\u679c\u6211\u4eec\u4f7f\u7528\u4e86 RDB \u5feb\u7167\uff0c\u56e0\u4e3a RDB \u5feb\u7167\u4e0d\u4f1a\u5728\u4e8b\u52a1\u6267\u884c\u65f6\u6267\u884c\uff0c\u6240\u4ee5\uff0c\u4e8b\u52a1\u547d\u4ee4\u64cd\u4f5c\u7684\u7ed3\u679c\u4e0d\u4f1a\u88ab\u4fdd\u5b58\u5230 RDB \u5feb\u7167\u4e2d\uff0c\u4f7f\u7528 RDB \u5feb\u7167\u8fdb\u884c\u6062\u590d\u65f6\uff0c\u6570\u636e\u5e93\u91cc\u7684\u6570\u636e\u4e5f\u662f\u4e00\u81f4\u7684\u3002 \u5982\u679c\u6211\u4eec\u4f7f\u7528\u4e86 AOF \u65e5\u5fd7\uff0c\u800c\u4e8b\u52a1\u64cd\u4f5c\u8fd8\u6ca1\u6709\u88ab\u8bb0\u5f55\u5230 AOF \u65e5\u5fd7\u65f6\uff0c\u5b9e\u4f8b\u5c31\u53d1\u751f\u4e86\u6545\u969c\uff0c\u90a3\u4e48\uff0c\u4f7f\u7528 AOF \u65e5\u5fd7\u6062\u590d\u7684\u6570\u636e\u5e93\u6570\u636e\u662f\u4e00\u81f4\u7684\u3002\u5982\u679c\u53ea\u6709\u90e8\u5206\u64cd\u4f5c\u88ab\u8bb0\u5f55\u5230\u4e86 AOF \u65e5\u5fd7\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 redis-check-aof \u6e05\u9664\u4e8b\u52a1\u4e2d\u5df2\u7ecf\u5b8c\u6210\u7684\u64cd\u4f5c\uff0c\u6570\u636e\u5e93\u6062\u590d\u540e\u4e5f\u662f\u4e00\u81f4\u7684\u3002 3-3 \u9694\u79bb\u6027 \u52a1\u7684\u9694\u79bb\u6027\u4fdd\u8bc1\uff0c\u4f1a\u53d7\u5230\u548c\u4e8b\u52a1\u4e00\u8d77\u6267\u884c\u7684\u5e76\u53d1\u64cd\u4f5c\u7684\u5f71\u54cd\u3002 \u800c\u4e8b\u52a1\u6267\u884c\u53c8\u53ef\u4ee5\u5206\u6210\u547d\u4ee4\u5165\u961f\uff08EXEC \u547d\u4ee4\u6267\u884c\u524d\uff09\u548c\u547d\u4ee4\u5b9e\u9645\u6267\u884c\uff08EXEC \u547d\u4ee4\u6267\u884c\u540e\uff09\u4e24\u4e2a\u9636\u6bb5 \uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5c31\u9488\u5bf9\u8fd9\u4e24\u4e2a\u9636\u6bb5\uff0c\u5206\u6210\u4e24\u79cd\u60c5\u51b5\u6765\u5206\u6790\uff1a \u5e76\u53d1\u64cd\u4f5c\u5728 EXEC \u547d\u4ee4\u524d\u6267\u884c\uff0c\u6b64\u65f6\uff0c\u9694\u79bb\u6027\u7684\u4fdd\u8bc1\u8981\u4f7f\u7528 WATCH \u673a\u5236\u6765\u5b9e\u73b0\uff0c\u5426\u5219\u9694\u79bb\u6027\u65e0\u6cd5\u4fdd\u8bc1\uff1b \u5e76\u53d1\u64cd\u4f5c\u5728 EXEC \u547d\u4ee4\u540e\u6267\u884c\uff0c\u6b64\u65f6\uff0c\u9694\u79bb\u6027\u53ef\u4ee5\u4fdd\u8bc1\u3002 \u7b2c\u4e00\u79cd\u60c5\u51b5\u3002 \u4e00\u4e2a\u4e8b\u52a1\u7684 EXEC \u547d\u4ee4\u8fd8\u6ca1\u6709\u6267\u884c\u65f6\uff0c\u4e8b\u52a1\u7684\u547d\u4ee4\u64cd\u4f5c\u662f\u6682\u5b58\u5728\u547d\u4ee4\u961f\u5217\u4e2d\u7684\u3002\u6b64\u65f6\uff0c\u5982\u679c\u6709\u5176\u5b83\u7684\u5e76\u53d1\u64cd\u4f5c\uff0c\u6211\u4eec\u5c31\u9700\u8981\u770b\u4e8b\u52a1\u662f\u5426\u4f7f\u7528\u4e86 WATCH \u673a\u5236 \u3002 WATCH \u673a\u5236\u7684\u4f5c\u7528\u662f\uff0c\u5728\u4e8b\u52a1\u6267\u884c\u524d\uff0c\u76d1\u63a7\u4e00\u4e2a\u6216\u591a\u4e2a\u952e\u7684\u503c\u53d8\u5316\u60c5\u51b5\uff0c\u5f53\u4e8b\u52a1\u8c03\u7528 EXEC \u547d\u4ee4\u6267\u884c\u65f6\uff0cWATCH \u673a\u5236\u4f1a\u5148\u68c0\u67e5\u76d1\u63a7\u7684\u952e\u662f\u5426\u88ab\u5176\u5b83\u5ba2\u6237\u7aef\u4fee\u6539\u4e86\u3002\u5982\u679c\u4fee\u6539\u4e86\uff0c\u5c31\u653e\u5f03\u4e8b\u52a1\u6267\u884c\uff0c\u907f\u514d\u4e8b\u52a1\u7684\u9694\u79bb\u6027\u88ab\u7834\u574f\u3002\u7136\u540e\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u518d\u6b21\u6267\u884c\u4e8b\u52a1\uff0c\u6b64\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u5e76\u53d1\u4fee\u6539\u4e8b\u52a1\u6570\u636e\u7684\u64cd\u4f5c\u4e86\uff0c\u4e8b\u52a1\u5c31\u80fd\u6b63\u5e38\u6267\u884c\uff0c\u9694\u79bb\u6027\u4e5f\u5f97\u5230\u4e86\u4fdd\u8bc1\u3002 WATCH \u673a\u5236\u7684\u5177\u4f53\u5b9e\u73b0\u662f\u7531 WATCH \u547d\u4ee4\u5b9e\u73b0\u7684 \u5728 t1 \u65f6\uff0c\u5ba2\u6237\u7aef X \u5411\u5b9e\u4f8b\u53d1\u9001\u4e86 WATCH \u547d\u4ee4\u3002\u5b9e\u4f8b\u6536\u5230 WATCH \u547d\u4ee4\u540e\uff0c\u5f00\u59cb\u76d1\u6d4b a:stock \u7684\u503c\u7684\u53d8\u5316\u60c5\u51b5\u3002 \u7d27\u63a5\u7740\uff0c\u5728 t2 \u65f6\uff0c\u5ba2\u6237\u7aef X \u628a MULTI \u547d\u4ee4\u548c DECR \u547d\u4ee4\u53d1\u9001\u7ed9\u5b9e\u4f8b\uff0c\u5b9e\u4f8b\u628a DECR \u547d\u4ee4\u6682\u5b58\u5165\u547d\u4ee4\u961f\u5217\u3002 \u5728 t3 \u65f6\uff0c\u5ba2\u6237\u7aef Y \u4e5f\u7ed9\u5b9e\u4f8b\u53d1\u9001\u4e86\u4e00\u4e2a DECR \u547d\u4ee4\uff0c\u8981\u4fee\u6539 a:stock \u7684\u503c\uff0c\u5b9e\u4f8b\u6536\u5230\u547d\u4ee4\u540e\u5c31\u76f4\u63a5\u6267\u884c\u4e86\u3002 \u7b49\u5230 t4 \u65f6\uff0c\u5b9e\u4f8b\u6536\u5230\u5ba2\u6237\u7aef X \u53d1\u9001\u7684 EXEC \u547d\u4ee4\uff0c\u4f46\u662f\uff0c\u5b9e\u4f8b\u7684 WATCH \u673a\u5236\u53d1\u73b0 a:stock \u5df2\u7ecf\u88ab\u4fee\u6539\u4e86\uff0c\u5c31\u4f1a\u653e\u5f03\u4e8b\u52a1\u6267\u884c\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4e8b\u52a1\u7684\u9694\u79bb\u6027\u5c31\u53ef\u4ee5\u5f97\u5230\u4fdd\u8bc1\u4e86\u3002 \u5f53\u7136\uff0c\u5982\u679c\u6ca1\u6709\u4f7f\u7528 WATCH \u673a\u5236\uff0c\u5728 EXEC \u547d\u4ee4\u524d\u6267\u884c\u7684\u5e76\u53d1\u64cd\u4f5c\u662f\u4f1a\u5bf9\u6570\u636e\u8fdb\u884c\u8bfb\u5199\u7684\u3002\u800c\u4e14\uff0c\u5728\u6267\u884c EXEC \u547d\u4ee4\u7684\u65f6\u5019\uff0c\u4e8b\u52a1\u8981\u64cd\u4f5c\u7684\u6570\u636e\u5df2\u7ecf\u6539\u53d8\u4e86\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cRedis \u5e76\u6ca1\u6709\u505a\u5230\u8ba9\u4e8b\u52a1\u5bf9\u5176\u5b83\u64cd\u4f5c\u9694\u79bb\uff0c\u9694\u79bb\u6027\u4e5f\u5c31\u6ca1\u6709\u5f97\u5230\u4fdd\u969c\u3002 \u4e0b\u9762\u8fd9\u5f20\u56fe\u663e\u793a\u4e86\u6ca1\u6709 WATCH \u673a\u5236\u65f6\u7684\u60c5\u51b5 \u5728 t2 \u65f6\u523b\uff0c\u5ba2\u6237\u7aef X \u53d1\u9001\u7684 EXEC \u547d\u4ee4\u8fd8\u6ca1\u6709\u6267\u884c\uff0c\u4f46\u662f\u5ba2\u6237\u7aef Y \u7684 DECR \u547d\u4ee4\u5c31\u6267\u884c\u4e86\uff0c\u6b64\u65f6\uff0ca:stock \u7684\u503c\u4f1a\u88ab\u4fee\u6539\uff0c\u8fd9\u5c31\u65e0\u6cd5\u4fdd\u8bc1 X \u53d1\u8d77\u7684\u4e8b\u52a1\u7684\u9694\u79bb\u6027\u4e86\u3002 \u5e76\u53d1\u64cd\u4f5c\u5728 EXEC \u547d\u4ee4\u4e4b\u540e\u88ab\u670d\u52a1\u5668\u7aef\u63a5\u6536\u5e76\u6267\u884c\u3002 \u56e0\u4e3a Redis \u662f\u7528\u5355\u7ebf\u7a0b\u6267\u884c\u547d\u4ee4\uff0c\u800c\u4e14\uff0cEXEC \u547d\u4ee4\u6267\u884c\u540e\uff0cRedis \u4f1a\u4fdd\u8bc1\u5148\u628a\u547d\u4ee4\u961f\u5217\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u6267\u884c\u5b8c\u3002\u6240\u4ee5\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5e76\u53d1\u64cd\u4f5c\u4e0d\u4f1a\u7834\u574f\u4e8b\u52a1\u7684\u9694\u79bb\u6027\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a 3-4 \u6301\u4e45\u6027 \u56e0\u4e3a Redis \u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u6240\u4ee5\uff0c\u6570\u636e\u662f\u5426\u6301\u4e45\u5316\u4fdd\u5b58\u5b8c\u5168\u53d6\u51b3\u4e8e Redis \u7684\u6301\u4e45\u5316\u914d\u7f6e\u6a21\u5f0f\u3002 \u5982\u679c Redis \u6ca1\u6709\u4f7f\u7528 RDB \u6216 AOF\uff0c\u90a3\u4e48\u4e8b\u52a1\u7684\u6301\u4e45\u5316\u5c5e\u6027\u80af\u5b9a\u5f97\u4e0d\u5230\u4fdd\u8bc1\u3002\u5982\u679c Redis \u4f7f\u7528\u4e86 RDB \u6a21\u5f0f\uff0c\u90a3\u4e48\uff0c\u5728\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u540e\uff0c\u800c\u4e0b\u4e00\u6b21\u7684 RDB \u5feb\u7167\u8fd8\u672a\u6267\u884c\u524d\uff0c\u5982\u679c\u53d1\u751f\u4e86\u5b9e\u4f8b\u5b95\u673a\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e8b\u52a1\u4fee\u6539\u7684\u6570\u636e\u4e5f\u662f\u4e0d\u80fd\u4fdd\u8bc1\u6301\u4e45\u5316\u7684\u3002 \u5982\u679c Redis \u91c7\u7528\u4e86 AOF \u6a21\u5f0f\uff0c\u56e0\u4e3a AOF \u6a21\u5f0f\u7684\u4e09\u79cd\u914d\u7f6e\u9009\u9879 no\u3001everysec \u548c always \u90fd\u4f1a\u5b58\u5728\u6570\u636e\u4e22\u5931\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\uff0c\u4e8b\u52a1\u7684\u6301\u4e45\u6027\u5c5e\u6027\u4e5f\u8fd8\u662f\u5f97\u4e0d\u5230\u4fdd\u8bc1\u3002 \u4e0d\u7ba1 Redis \u91c7\u7528\u4ec0\u4e48\u6301\u4e45\u5316\u6a21\u5f0f\uff0c\u4e8b\u52a1\u7684\u6301\u4e45\u6027\u5c5e\u6027\u662f\u5f97\u4e0d\u5230\u4fdd\u8bc1\u7684\u3002 4\u3001\u672c\u8282\u5c0f\u7ed3 Redis \u901a\u8fc7 MULTI\u3001EXEC\u3001DISCARD \u548c WATCH \u56db\u4e2a\u547d\u4ee4\u6765\u652f\u6301\u4e8b\u52a1\u673a\u5236\uff0c\u8fd9 4 \u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\uff0c\u603b\u7ed3\u5728\u4e0b\u9762\u7684\u8868\u4e2d\uff0c\u4f60\u53ef\u4ee5\u518d\u770b\u4e0b\u3002 Redis \u7684\u4e8b\u52a1\u673a\u5236\u53ef\u4ee5\u4fdd\u8bc1\u4e00\u81f4\u6027\u548c\u9694\u79bb\u6027\uff0c\u4f46\u662f\u65e0\u6cd5\u4fdd\u8bc1\u6301\u4e45\u6027\u3002\u4e0d\u8fc7\uff0c\u56e0\u4e3a Redis \u672c\u8eab\u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u6301\u4e45\u6027\u5e76\u4e0d\u662f\u4e00\u4e2a\u5fc5\u987b\u7684\u5c5e\u6027\uff0c\u6211\u4eec\u66f4\u52a0\u5173\u6ce8\u7684\u8fd8\u662f\u539f\u5b50\u6027\u3001\u4e00\u81f4\u6027\u548c\u9694\u79bb\u6027\u8fd9\u4e09\u4e2a\u5c5e\u6027\u3002 \u539f\u5b50\u6027\u7684\u60c5\u51b5\u6bd4\u8f83\u590d\u6742\uff0c \u53ea\u6709\u5f53\u4e8b\u52a1\u4e2d\u4f7f\u7528\u7684\u547d\u4ee4\u8bed\u6cd5\u6709\u8bef\u65f6\uff0c\u539f\u5b50\u6027\u5f97\u4e0d\u5230\u4fdd\u8bc1\uff0c\u5728\u5176\u5b83\u60c5\u51b5\u4e0b\uff0c\u4e8b\u52a1\u90fd\u53ef\u4ee5\u539f\u5b50\u6027\u6267\u884c\u3002 \u5c0f\u5efa\u8bae\uff1a\u4e25\u683c\u6309\u7167 Redis \u7684\u547d\u4ee4\u89c4\u8303\u8fdb\u884c\u7a0b\u5e8f\u5f00\u53d1\uff0c\u5e76\u4e14\u901a\u8fc7 code review \u786e\u4fdd\u547d\u4ee4\u7684\u6b63\u786e\u6027\u3002\u8fd9","title":"\u7b2c\u56db\u8282 \u4e8b\u52a1\u673a\u5236 Redis\u5b9e\u73b0ACID\u5c5e\u6027"},{"location":"chap6/4redis_acid/#redisacid","text":"\u4e8b\u52a1\u662f\u6570\u636e\u5e93\u7684\u4e00\u4e2a\u91cd\u8981\u529f\u80fd\u3002\u6240\u8c13\u7684\u4e8b\u52a1\uff0c\u5c31\u662f\u6307\u5bf9\u6570\u636e\u8fdb\u884c\u8bfb\u5199\u7684\u4e00\u7cfb\u5217\u64cd\u4f5c\u3002 \u4e8b\u52a1\u5728\u6267\u884c\u65f6\uff0c\u4f1a\u63d0\u4f9b\u4e13\u95e8\u7684\u5c5e\u6027\u4fdd\u8bc1\uff0c\u5305\u62ec\u539f\u5b50\u6027\uff08Atomicity\uff09\u3001\u4e00\u81f4\u6027\uff08Consistency\uff09\u3001\u9694\u79bb\u6027\uff08Isolation\uff09\u548c\u6301\u4e45\u6027\uff08Durability\uff09\uff0c\u4e5f\u5c31\u662f ACID \u5c5e\u6027\u3002 \u8fd9\u4e9b\u5c5e\u6027\u65e2\u5305\u62ec\u4e86\u5bf9\u4e8b\u52a1\u6267\u884c\u7ed3\u679c\u7684\u8981\u6c42\uff0c\u4e5f\u6709\u5bf9\u6570\u636e\u5e93\u5728\u4e8b\u52a1\u6267\u884c\u524d\u540e\u7684\u6570\u636e\u72b6\u6001\u53d8\u5316\u7684\u8981\u6c42","title":"\u7b2c\u56db\u8282 \u4e8b\u52a1\u673a\u5236 Redis\u5b9e\u73b0ACID\u5c5e\u6027"},{"location":"chap6/4redis_acid/#1-acid","text":"\u9996\u5148\u6765\u770b\u539f\u5b50\u6027\u3002\u539f\u5b50\u6027\u7684\u8981\u6c42\u5f88\u660e\u786e\uff0c \u5c31\u662f\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u7684\u591a\u4e2a\u64cd\u4f5c\u5fc5\u987b\u90fd\u5b8c\u6210\uff0c\u6216\u8005\u90fd\u4e0d\u5b8c\u6210 \u3002\u4e1a\u52a1\u5e94\u7528\u4f7f\u7528\u4e8b\u52a1\u65f6\uff0c\u539f\u5b50\u6027\u4e5f\u662f\u6700\u88ab\u770b\u91cd\u7684\u4e00\u4e2a\u5c5e\u6027\u3002 \u6211\u7ed9\u4f60\u4e3e\u4e2a\u4f8b\u5b50\u3002\u5047\u5982\u7528\u6237\u5728\u4e00\u4e2a\u8ba2\u5355\u4e2d\u8d2d\u4e70\u4e86\u4e24\u4e2a\u5546\u54c1 A \u548c B\uff0c\u90a3\u4e48\uff0c\u6570\u636e\u5e93\u5c31\u9700\u8981\u628a\u8fd9\u4e24\u4e2a\u5546\u54c1\u7684\u5e93\u5b58\u90fd\u8fdb\u884c\u6263\u51cf\u3002\u5982\u679c\u53ea\u6263\u51cf\u4e86\u4e00\u4e2a\u5546\u54c1\u7684\u5e93\u5b58\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e2a\u8ba2\u5355\u5b8c\u6210\u540e\uff0c\u53e6\u4e00\u4e2a\u5546\u54c1\u7684\u5e93\u5b58\u80af\u5b9a\u5c31\u9519\u4e86\u3002 \u7b2c\u4e8c\u4e2a\u5c5e\u6027\u662f\u4e00\u81f4\u6027\u3002\u8fd9\u4e2a\u5f88\u5bb9\u6613\u7406\u89e3\uff0c \u5c31\u662f\u6307\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u5728\u4e8b\u52a1\u6267\u884c\u524d\u540e\u662f\u4e00\u81f4\u7684 \u3002 \u7b2c\u4e09\u4e2a\u5c5e\u6027\u662f\u9694\u79bb\u6027\u3002 \u5b83\u8981\u6c42\u6570\u636e\u5e93\u5728\u6267\u884c\u4e00\u4e2a\u4e8b\u52a1\u65f6\uff0c\u5176\u5b83\u64cd\u4f5c\u65e0\u6cd5\u5b58\u53d6\u5230\u6b63\u5728\u6267\u884c\u4e8b\u52a1\u8bbf\u95ee\u7684\u6570\u636e\u3002 \u501f\u52a9\u7528\u6237\u4e0b\u5355\u7684\u4f8b\u5b50\u7ed9\u4f60\u89e3\u91ca\u4e0b\u3002\u5047\u8bbe\u5546\u54c1 A \u548c B \u7684\u73b0\u6709\u5e93\u5b58\u5206\u522b\u662f 5 \u548c 10\uff0c \u7528\u6237 X \u5bf9 A\u3001B \u4e0b\u5355\u7684\u6570\u91cf\u5206\u522b\u662f 3\u30016 \u3002\u5982\u679c\u4e8b\u52a1\u4e0d\u5177\u5907\u9694\u79bb\u6027\uff0c\u5728\u7528\u6237 X \u4e0b\u5355\u4e8b\u52a1\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u7528\u6237 Y \u4e00\u4e0b\u5b50\u4e5f\u8d2d\u4e70\u4e86 5 \u4ef6 B\uff0c\u8fd9\u548c X \u8d2d\u4e70\u7684 6 \u4ef6 B \u7d2f\u52a0\u540e\uff0c\u5c31\u8d85\u8fc7 B \u7684\u603b\u5e93\u5b58\u503c\u4e86\uff0c\u8fd9\u5c31\u4e0d\u7b26\u5408\u4e1a\u52a1\u8981\u6c42\u4e86\u3002 \u6700\u540e\u4e00\u4e2a\u5c5e\u6027\u662f\u6301\u4e45\u6027\u3002\u6570\u636e\u5e93\u6267\u884c\u4e8b\u52a1\u540e\uff0c\u6570\u636e\u7684\u4fee\u6539\u8981\u88ab\u6301\u4e45\u5316\u4fdd\u5b58\u4e0b\u6765\u3002\u5f53\u6570\u636e\u5e93\u91cd\u542f\u540e\uff0c\u6570\u636e\u7684\u503c\u9700\u8981\u662f\u88ab\u4fee\u6539\u540e\u7684\u503c\u3002","title":"1\u3001\u4e8b\u52a1 ACID \u5c5e\u6027\u7684\u8981\u6c42"},{"location":"chap6/4redis_acid/#2redis","text":"\u4e8b\u52a1\u7684\u6267\u884c\u8fc7\u7a0b\u5305\u542b\u4e09\u4e2a\u6b65\u9aa4\uff0cRedis \u63d0\u4f9b\u4e86 MULTI \u3001 EXEC \u4e24\u4e2a\u547d\u4ee4\u6765\u5b8c\u6210\u8fd9\u4e09\u4e2a\u6b65\u9aa4\u3002\u4e0b\u9762\u6211\u4eec\u6765\u5206\u6790\u4e0b\u3002 \u7b2c\u4e00\u6b65\uff0c\u5ba2\u6237\u7aef\u8981\u4f7f\u7528\u4e00\u4e2a\u547d\u4ee4\u663e\u5f0f\u5730\u8868\u793a\u4e00\u4e2a\u4e8b\u52a1\u7684\u5f00\u542f \u3002\u5728 Redis \u4e2d\uff0c\u8fd9\u4e2a\u547d\u4ee4\u5c31\u662f MULTI\u3002 \u7b2c\u4e8c\u6b65\uff0c\u5ba2\u6237\u7aef\u628a\u4e8b\u52a1\u4e2d\u672c\u8eab\u8981\u6267\u884c\u7684\u5177\u4f53\u64cd\u4f5c\uff08\u4f8b\u5982\u589e\u5220\u6539\u6570\u636e\uff09\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7aef \u3002\u8fd9\u4e9b\u64cd\u4f5c\u5c31\u662f Redis \u672c\u8eab\u63d0\u4f9b\u7684\u6570\u636e\u8bfb\u5199\u547d\u4ee4\uff0c\u4f8b\u5982 GET\u3001SET \u7b49\u3002\u4e0d\u8fc7\uff0c\u8fd9\u4e9b\u547d\u4ee4\u867d\u7136\u88ab\u5ba2\u6237\u7aef\u53d1\u9001\u5230\u4e86\u670d\u52a1\u5668\u7aef\uff0c\u4f46 Redis \u5b9e\u4f8b\u53ea\u662f\u628a\u8fd9\u4e9b\u547d\u4ee4\u6682\u5b58\u5230\u4e00\u4e2a\u547d\u4ee4\u961f\u5217\u4e2d\uff0c\u5e76\u4e0d\u4f1a\u7acb\u5373\u6267\u884c\u3002 \u7b2c\u4e09\u6b65\uff0c\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u7aef\u53d1\u9001\u63d0\u4ea4\u4e8b\u52a1\u7684\u547d\u4ee4\uff0c\u8ba9\u6570\u636e\u5e93\u5b9e\u9645\u6267\u884c\u7b2c\u4e8c\u6b65\u4e2d\u53d1\u9001\u7684\u5177\u4f53\u64cd\u4f5c\u3002 Redis \u63d0\u4f9b\u7684 EXEC \u547d\u4ee4 \u5c31\u662f\u6267\u884c\u4e8b\u52a1\u63d0\u4ea4\u7684\u3002\u5f53\u670d\u52a1\u5668\u7aef\u6536\u5230 EXEC \u547d\u4ee4\u540e\uff0c\u624d\u4f1a\u5b9e\u9645\u6267\u884c\u547d\u4ee4\u961f\u5217\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u3002 \u4e0b\u9762\u7684\u4ee3\u7801\u5c31\u663e\u793a\u4e86\u4f7f\u7528 MULTI \u548c EXEC \u6267\u884c\u4e00\u4e2a\u4e8b\u52a1\u7684\u8fc7\u7a0b #\u5f00\u542f\u4e8b\u52a1 127.0.0.1:6379> MULTI OK #\u5c06a:stock\u51cf1\uff0c 127.0.0.1:6379> DECR a:stock QUEUED #\u5c06b:stock\u51cf1 127.0.0.1:6379> DECR b:stock QUEUED #\u5b9e\u9645\u6267\u884c\u4e8b\u52a1 127.0.0.1:6379> EXEC 1) (integer) 4 2) (integer) 9 \u5047\u8bbe a:stock \u3001 b:stock \u4e24\u4e2a\u952e\u7684\u521d\u59cb\u503c\u662f 5 \u548c 10\u3002 \u5728 MULTI \u547d\u4ee4\u540e\u6267\u884c\u7684\u4e24\u4e2a DECR \u547d\u4ee4\uff0c\u662f\u628a a:stock \u3001 b:stock \u4e24\u4e2a\u952e\u7684\u503c\u5206\u522b\u51cf 1\uff0c\u5b83\u4eec\u6267\u884c\u540e\u7684\u8fd4\u56de\u7ed3\u679c\u90fd\u662f QUEUED \uff0c\u8fd9\u5c31\u8868\u793a\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u88ab\u6682\u5b58\u5230\u4e86\u547d\u4ee4\u961f\u5217\uff0c\u8fd8\u6ca1\u6709\u5b9e\u9645\u6267\u884c\u3002 \u7b49\u5230\u6267\u884c\u4e86 EXEC \u547d\u4ee4\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u8fd4\u56de\u4e86 4\u30019\uff0c\u8fd9\u5c31\u8868\u660e\uff0c\u4e24\u4e2a DECR \u547d\u4ee4\u5df2\u7ecf\u6210\u529f\u5730\u6267\u884c\u4e86\u3002","title":"2\u3001Redis \u5982\u4f55\u5b9e\u73b0\u4e8b\u52a1\uff1f"},{"location":"chap6/4redis_acid/#3redis","text":"","title":"3\u3001Redis \u7684\u4e8b\u52a1\u673a\u5236\u80fd\u4fdd\u8bc1\u54ea\u4e9b\u5c5e\u6027\uff1f"},{"location":"chap6/4redis_acid/#3-1","text":"\u5982\u679c\u4e8b\u52a1\u6b63\u5e38\u6267\u884c\uff0c\u6ca1\u6709\u53d1\u751f\u4efb\u4f55\u9519\u8bef\uff0c\u90a3\u4e48\uff0cMULTI \u548c EXEC \u914d\u5408\u4f7f\u7528\uff0c\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u591a\u4e2a\u64cd\u4f5c\u90fd\u5b8c\u6210\u3002\u4f46\u662f\uff0c\u5982\u679c\u4e8b\u52a1\u6267\u884c\u53d1\u751f\u9519\u8bef\u4e86\uff0c\u539f\u5b50\u6027\u8fd8\u80fd\u4fdd\u8bc1\u5417 \u7b2c\u4e00\u79cd\u60c5\u51b5\u662f\uff0c \u5728\u6267\u884c EXEC \u547d\u4ee4\u524d\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u64cd\u4f5c\u547d\u4ee4\u672c\u8eab\u5c31\u6709\u9519\u8bef\uff08\u6bd4\u5982\u8bed\u6cd5\u9519\u8bef\uff0c\u4f7f\u7528\u4e86\u4e0d\u5b58\u5728\u7684\u547d\u4ee4\uff09 \uff0c\u5728\u547d\u4ee4\u5165\u961f\u65f6\u5c31\u88ab Redis \u5b9e\u4f8b\u5224\u65ad\u51fa\u6765\u4e86\u3002 \u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\uff0c \u5728\u547d\u4ee4\u5165\u961f\u65f6\uff0cRedis \u5c31\u4f1a\u62a5\u9519\u5e76\u4e14\u8bb0\u5f55\u4e0b\u8fd9\u4e2a\u9519\u8bef \u3002 \u6b64\u65f6\uff0c\u8fd8\u80fd\u7ee7\u7eed\u63d0\u4ea4\u547d\u4ee4\u64cd\u4f5c\u3002 \u7b49\u5230\u6267\u884c\u4e86 EXEC \u547d\u4ee4\u4e4b\u540e\uff0cRedis \u5c31\u4f1a\u62d2\u7edd\u6267\u884c\u6240\u6709\u63d0\u4ea4\u7684\u547d\u4ee4\u64cd\u4f5c\uff0c\u8fd4\u56de\u4e8b\u52a1\u5931\u8d25\u7684\u7ed3\u679c \u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u90fd\u4e0d\u4f1a\u518d\u88ab\u6267\u884c\u4e86\uff0c\u4fdd\u8bc1\u4e86\u539f\u5b50\u6027\u3002 \u4e8b\u52a1\u64cd\u4f5c\u5165\u961f\u65f6\u53d1\u751f\u9519\u8bef\uff0c\u800c\u5bfc\u81f4\u4e8b\u52a1\u5931\u8d25\u7684\u5c0f\u4f8b\u5b50\u3002 #\u5f00\u542f\u4e8b\u52a1 127.0.0.1:6379> MULTI OK #\u53d1\u9001\u4e8b\u52a1\u4e2d\u7684\u7b2c\u4e00\u4e2a\u64cd\u4f5c\uff0c\u4f46\u662fRedis\u4e0d\u652f\u6301\u8be5\u547d\u4ee4\uff0c\u8fd4\u56de\u62a5\u9519\u4fe1\u606f 127.0.0.1:6379> PUT a:stock 5 (error) ERR unknown command `PUT`, with args beginning with: `a:stock`, `5`, #\u53d1\u9001\u4e8b\u52a1\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u662f\u6b63\u786e\u7684\u547d\u4ee4\uff0cRedis\u628a\u8be5\u547d\u4ee4\u5165\u961f 127.0.0.1:6379> DECR b:stock QUEUED #\u5b9e\u9645\u6267\u884c\u4e8b\u52a1\uff0c\u4f46\u662f\u4e4b\u524d\u547d\u4ee4\u6709\u9519\u8bef\uff0c\u6240\u4ee5Redis\u62d2\u7edd\u6267\u884c 127.0.0.1:6379> EXEC (error) EXECABORT Transaction discarded because of previous errors. \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c \u4e8b\u52a1\u91cc\u5305\u542b\u4e86\u4e00\u4e2a Redis \u672c\u8eab\u5c31\u4e0d\u652f\u6301\u7684 PUT \u547d\u4ee4\uff0c\u6240\u4ee5\uff0c\u5728 PUT \u547d\u4ee4\u5165\u961f\u65f6\uff0cRedis \u5c31\u62a5\u9519\u4e86 \u3002 \u867d\u7136\uff0c\u4e8b\u52a1\u91cc\u8fd8\u6709\u4e00\u4e2a\u6b63\u786e\u7684 DECR \u547d\u4ee4\uff0c\u4f46\u662f\uff0c\u5728\u6700\u540e\u6267\u884c EXEC \u547d\u4ee4\u540e\uff0c\u6574\u4e2a\u4e8b\u52a1\u88ab\u653e\u5f03\u6267\u884c\u4e86\u3002 \u7b2c\u4e8c\u79cd\u60c5\u51b5\u3002\u548c\u7b2c\u4e00\u79cd\u60c5\u51b5\u4e0d\u540c\u7684\u662f\uff1a \u4e8b\u52a1\u64cd\u4f5c\u5165\u961f\u65f6\uff0c\u547d\u4ee4\u548c\u64cd\u4f5c\u7684\u6570\u636e\u7c7b\u578b\u4e0d\u5339\u914d\uff0c\u4f46 Redis \u5b9e\u4f8b\u6ca1\u6709\u68c0\u67e5\u51fa\u9519\u8bef \u3002\u4f46\u662f\uff0c\u5728\u6267\u884c\u5b8c EXEC \u547d\u4ee4\u4ee5\u540e\uff0cRedis \u5b9e\u9645\u6267\u884c\u8fd9\u4e9b\u4e8b\u52a1\u64cd\u4f5c\u65f6\uff0c\u5c31\u4f1a\u62a5\u9519\u3002\u4e0d\u8fc7\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u867d\u7136 Redis \u4f1a\u5bf9\u9519\u8bef\u547d\u4ee4\u62a5\u9519\uff0c \u4f46\u8fd8\u662f\u4f1a\u628a\u6b63\u786e\u7684\u547d\u4ee4\u6267\u884c\u5b8c\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e8b\u52a1\u7684\u539f\u5b50\u6027\u5c31\u65e0\u6cd5\u5f97\u5230\u4fdd\u8bc1\u4e86 \u3002 \u4e3e\u4e2a\u5c0f\u4f8b\u5b50\u3002\u4e8b\u52a1\u4e2d\u7684 LPOP \u547d\u4ee4\u5bf9 String \u7c7b\u578b\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\uff0c\u5165\u961f\u65f6\u6ca1\u6709\u62a5\u9519\uff0c\u4f46\u662f\uff0c\u5728 EXEC \u6267\u884c\u65f6\u62a5\u9519\u4e86\u3002LPOP \u547d\u4ee4\u672c\u8eab\u6ca1\u6709\u6267\u884c\u6210\u529f\uff0c\u4f46\u662f\u4e8b\u52a1\u4e2d\u7684 DECR \u547d\u4ee4\u5374\u6210\u529f\u6267\u884c\u4e86\u3002 #\u5f00\u542f\u4e8b\u52a1 127.0.0.1:6379> MULTI OK #\u53d1\u9001\u4e8b\u52a1\u4e2d\u7684\u7b2c\u4e00\u4e2a\u64cd\u4f5c\uff0cLPOP\u547d\u4ee4\u64cd\u4f5c\u7684\u6570\u636e\u7c7b\u578b\u4e0d\u5339\u914d\uff0c\u6b64\u65f6\u5e76\u4e0d\u62a5\u9519 127.0.0.1:6379> LPOP a:stock QUEUED #\u53d1\u9001\u4e8b\u52a1\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u64cd\u4f5c 127.0.0.1:6379> DECR b:stock QUEUED #\u5b9e\u9645\u6267\u884c\u4e8b\u52a1\uff0c\u4e8b\u52a1\u7b2c\u4e00\u4e2a\u64cd\u4f5c\u6267\u884c\u62a5\u9519 127.0.0.1:6379> EXEC 1) (error) WRONGTYPE Operation against a key holding the wrong kind of value 2) (integer) 8 Redis \u4e2d\u5e76\u6ca1\u6709\u63d0\u4f9b\u56de\u6eda\u673a\u5236\u3002 \u867d\u7136 Redis \u63d0\u4f9b\u4e86 DISCARD \u547d\u4ee4\uff0c\u4f46\u662f\uff0c\u8fd9\u4e2a\u547d\u4ee4\u53ea\u80fd\u7528\u6765\u4e3b\u52a8\u653e\u5f03\u4e8b\u52a1\u6267\u884c\uff0c\u628a\u6682\u5b58\u7684\u547d\u4ee4\u961f\u5217\u6e05\u7a7a\uff0c\u8d77\u4e0d\u5230\u56de\u6eda\u7684\u6548\u679c\u3002 #\u8bfb\u53d6a:stock\u7684\u503c4 127.0.0.1:6379> GET a:stock \"4\" #\u5f00\u542f\u4e8b\u52a1 127.0.0.1:6379> MULTI OK #\u53d1\u9001\u4e8b\u52a1\u7684\u7b2c\u4e00\u4e2a\u64cd\u4f5c\uff0c\u5bf9a:stock\u51cf1 127.0.0.1:6379> DECR a:stock QUEUED #\u6267\u884cDISCARD\u547d\u4ee4\uff0c\u4e3b\u52a8\u653e\u5f03\u4e8b\u52a1 127.0.0.1:6379> DISCARD OK #\u518d\u6b21\u8bfb\u53d6a:stock\u7684\u503c\uff0c\u503c\u6ca1\u6709\u88ab\u4fee\u6539 127.0.0.1:6379> GET a:stock \"4\" \u4f8b\u5b50\u4e2d\uff0ca:stock \u952e\u7684\u503c\u4e00\u5f00\u59cb\u4e3a 4\uff0c\u7136\u540e\uff0c\u6211\u4eec\u6267\u884c\u4e00\u4e2a\u4e8b\u52a1\uff0c\u60f3\u5bf9 a:stock \u7684\u503c\u51cf 1\u3002\u4f46\u662f\uff0c\u5728\u4e8b\u52a1\u7684\u6700\u540e\uff0c\u6211\u4eec\u6267\u884c\u7684\u662f DISCARD \u547d\u4ee4\uff0c\u6240\u4ee5\u4e8b\u52a1\u5c31\u88ab\u653e\u5f03\u4e86\u3002\u6211\u4eec\u518d\u6b21\u67e5\u770b a:stock \u7684\u503c\uff0c\u4f1a\u53d1\u73b0\u4ecd\u7136\u4e3a 4\u3002 \u7b2c\u4e09\u79cd\u60c5\u51b5\uff1a\u5728\u6267\u884c\u4e8b\u52a1\u7684 EXEC \u547d\u4ee4\u65f6\uff0cRedis \u5b9e\u4f8b\u53d1\u751f\u4e86\u6545\u969c\uff0c\u5bfc\u81f4\u4e8b\u52a1\u6267\u884c\u5931\u8d25\u3002 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c Redis \u5f00\u542f\u4e86 AOF \u65e5\u5fd7\uff0c\u90a3\u4e48\uff0c\u53ea\u4f1a\u6709\u90e8\u5206\u7684\u4e8b\u52a1\u64cd\u4f5c\u88ab\u8bb0\u5f55\u5230 AOF \u65e5\u5fd7\u4e2d\u3002 \u6211\u4eec\u9700\u8981\u4f7f\u7528 redis-check-aof \u5de5\u5177\u68c0\u67e5 AOF \u65e5\u5fd7\u6587\u4ef6\uff0c\u8fd9\u4e2a\u5de5\u5177\u53ef\u4ee5\u628a\u672a\u5b8c\u6210\u7684\u4e8b\u52a1\u64cd\u4f5c\u4ece AO F \u6587\u4ef6\u4e2d\u53bb\u9664\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u4f7f\u7528 AOF \u6062\u590d\u5b9e\u4f8b\u540e\uff0c\u4e8b\u52a1\u64cd\u4f5c\u4e0d\u4f1a\u518d\u88ab\u6267\u884c\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86\u539f\u5b50\u6027\u3002 \u5982\u679c AOF \u65e5\u5fd7\u5e76\u6ca1\u6709\u5f00\u542f\uff0c\u90a3\u4e48\u5b9e\u4f8b\u91cd\u542f\u540e\uff0c\u6570\u636e\u4e5f\u90fd\u6ca1\u6cd5\u6062\u590d\u4e86\uff0c\u6b64\u65f6\uff0c\u4e5f\u5c31\u8c08\u4e0d\u4e0a\u539f\u5b50\u6027\u4e86\u3002 Redis \u5bf9\u4e8b\u52a1\u539f\u5b50\u6027\u5c5e\u6027\u7684\u4fdd\u8bc1\u60c5\u51b5 \u547d\u4ee4\u5165\u961f\u65f6\u5c31\u62a5\u9519\uff0c\u4f1a\u653e\u5f03\u4e8b\u52a1\u6267\u884c\uff0c\u4fdd\u8bc1\u539f\u5b50\u6027\uff1b \u547d\u4ee4\u5165\u961f\u65f6\u6ca1\u62a5\u9519\uff0c\u5b9e\u9645\u6267\u884c\u65f6\u62a5\u9519\uff0c\u4e0d\u4fdd\u8bc1\u539f\u5b50\u6027\uff1b EXEC \u547d\u4ee4\u6267\u884c\u65f6\u5b9e\u4f8b\u6545\u969c\uff0c\u5982\u679c\u5f00\u542f\u4e86 AOF \u65e5\u5fd7\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u539f\u5b50\u6027\u3002","title":"3-1 \u539f\u5b50\u6027"},{"location":"chap6/4redis_acid/#3-2","text":"\u4e8b\u52a1\u7684\u4e00\u81f4\u6027\u4fdd\u8bc1\u4f1a\u53d7\u5230\u9519\u8bef\u547d\u4ee4\u3001\u5b9e\u4f8b\u6545\u969c\u7684\u5f71\u54cd\u3002 \u60c5\u51b5\u4e00\uff1a\u547d\u4ee4\u5165\u961f\u65f6\u5c31\u62a5\u9519 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e8b\u52a1\u672c\u8eab\u5c31\u4f1a\u88ab\u653e\u5f03\u6267\u884c\uff0c\u6240\u4ee5\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u5e93\u7684\u4e00\u81f4\u6027\u3002 \u60c5\u51b5\u4e8c\uff1a\u547d\u4ee4\u5165\u961f\u65f6\u6ca1\u62a5\u9519\uff0c\u5b9e\u9645\u6267\u884c\u65f6\u62a5\u9519 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6709\u9519\u8bef\u7684\u547d\u4ee4\u4e0d\u4f1a\u88ab\u6267\u884c\uff0c\u6b63\u786e\u7684\u547d\u4ee4\u53ef\u4ee5\u6b63\u5e38\u6267\u884c\uff0c\u4e5f\u4e0d\u4f1a\u6539\u53d8\u6570\u636e\u5e93\u7684\u4e00\u81f4\u6027\u3002 \u60c5\u51b5\u4e09\uff1aEXEC \u547d\u4ee4\u6267\u884c\u65f6\u5b9e\u4f8b\u53d1\u751f\u6545\u969c \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b9e\u4f8b\u6545\u969c\u540e\u4f1a\u8fdb\u884c\u91cd\u542f\uff0c\u8fd9\u5c31\u548c\u6570\u636e\u6062\u590d\u7684\u65b9\u5f0f\u6709\u5173\u4e86\uff0c\u6211\u4eec\u8981\u6839\u636e\u5b9e\u4f8b\u662f\u5426\u5f00\u542f\u4e86 RDB \u6216 AOF \u6765\u5206\u60c5\u51b5\u8ba8\u8bba\u4e0b\u3002 \u5982\u679c\u6211\u4eec\u6ca1\u6709\u5f00\u542f RDB \u6216 AOF\uff0c\u90a3\u4e48\uff0c\u5b9e\u4f8b\u6545\u969c\u91cd\u542f\u540e\uff0c\u6570\u636e\u90fd\u6ca1\u6709\u4e86\uff0c\u6570\u636e\u5e93\u662f\u4e00\u81f4\u7684\u3002 \u5982\u679c\u6211\u4eec\u4f7f\u7528\u4e86 RDB \u5feb\u7167\uff0c\u56e0\u4e3a RDB \u5feb\u7167\u4e0d\u4f1a\u5728\u4e8b\u52a1\u6267\u884c\u65f6\u6267\u884c\uff0c\u6240\u4ee5\uff0c\u4e8b\u52a1\u547d\u4ee4\u64cd\u4f5c\u7684\u7ed3\u679c\u4e0d\u4f1a\u88ab\u4fdd\u5b58\u5230 RDB \u5feb\u7167\u4e2d\uff0c\u4f7f\u7528 RDB \u5feb\u7167\u8fdb\u884c\u6062\u590d\u65f6\uff0c\u6570\u636e\u5e93\u91cc\u7684\u6570\u636e\u4e5f\u662f\u4e00\u81f4\u7684\u3002 \u5982\u679c\u6211\u4eec\u4f7f\u7528\u4e86 AOF \u65e5\u5fd7\uff0c\u800c\u4e8b\u52a1\u64cd\u4f5c\u8fd8\u6ca1\u6709\u88ab\u8bb0\u5f55\u5230 AOF \u65e5\u5fd7\u65f6\uff0c\u5b9e\u4f8b\u5c31\u53d1\u751f\u4e86\u6545\u969c\uff0c\u90a3\u4e48\uff0c\u4f7f\u7528 AOF \u65e5\u5fd7\u6062\u590d\u7684\u6570\u636e\u5e93\u6570\u636e\u662f\u4e00\u81f4\u7684\u3002\u5982\u679c\u53ea\u6709\u90e8\u5206\u64cd\u4f5c\u88ab\u8bb0\u5f55\u5230\u4e86 AOF \u65e5\u5fd7\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 redis-check-aof \u6e05\u9664\u4e8b\u52a1\u4e2d\u5df2\u7ecf\u5b8c\u6210\u7684\u64cd\u4f5c\uff0c\u6570\u636e\u5e93\u6062\u590d\u540e\u4e5f\u662f\u4e00\u81f4\u7684\u3002","title":"3-2 \u4e00\u81f4\u6027"},{"location":"chap6/4redis_acid/#3-3","text":"\u52a1\u7684\u9694\u79bb\u6027\u4fdd\u8bc1\uff0c\u4f1a\u53d7\u5230\u548c\u4e8b\u52a1\u4e00\u8d77\u6267\u884c\u7684\u5e76\u53d1\u64cd\u4f5c\u7684\u5f71\u54cd\u3002 \u800c\u4e8b\u52a1\u6267\u884c\u53c8\u53ef\u4ee5\u5206\u6210\u547d\u4ee4\u5165\u961f\uff08EXEC \u547d\u4ee4\u6267\u884c\u524d\uff09\u548c\u547d\u4ee4\u5b9e\u9645\u6267\u884c\uff08EXEC \u547d\u4ee4\u6267\u884c\u540e\uff09\u4e24\u4e2a\u9636\u6bb5 \uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5c31\u9488\u5bf9\u8fd9\u4e24\u4e2a\u9636\u6bb5\uff0c\u5206\u6210\u4e24\u79cd\u60c5\u51b5\u6765\u5206\u6790\uff1a \u5e76\u53d1\u64cd\u4f5c\u5728 EXEC \u547d\u4ee4\u524d\u6267\u884c\uff0c\u6b64\u65f6\uff0c\u9694\u79bb\u6027\u7684\u4fdd\u8bc1\u8981\u4f7f\u7528 WATCH \u673a\u5236\u6765\u5b9e\u73b0\uff0c\u5426\u5219\u9694\u79bb\u6027\u65e0\u6cd5\u4fdd\u8bc1\uff1b \u5e76\u53d1\u64cd\u4f5c\u5728 EXEC \u547d\u4ee4\u540e\u6267\u884c\uff0c\u6b64\u65f6\uff0c\u9694\u79bb\u6027\u53ef\u4ee5\u4fdd\u8bc1\u3002 \u7b2c\u4e00\u79cd\u60c5\u51b5\u3002 \u4e00\u4e2a\u4e8b\u52a1\u7684 EXEC \u547d\u4ee4\u8fd8\u6ca1\u6709\u6267\u884c\u65f6\uff0c\u4e8b\u52a1\u7684\u547d\u4ee4\u64cd\u4f5c\u662f\u6682\u5b58\u5728\u547d\u4ee4\u961f\u5217\u4e2d\u7684\u3002\u6b64\u65f6\uff0c\u5982\u679c\u6709\u5176\u5b83\u7684\u5e76\u53d1\u64cd\u4f5c\uff0c\u6211\u4eec\u5c31\u9700\u8981\u770b\u4e8b\u52a1\u662f\u5426\u4f7f\u7528\u4e86 WATCH \u673a\u5236 \u3002 WATCH \u673a\u5236\u7684\u4f5c\u7528\u662f\uff0c\u5728\u4e8b\u52a1\u6267\u884c\u524d\uff0c\u76d1\u63a7\u4e00\u4e2a\u6216\u591a\u4e2a\u952e\u7684\u503c\u53d8\u5316\u60c5\u51b5\uff0c\u5f53\u4e8b\u52a1\u8c03\u7528 EXEC \u547d\u4ee4\u6267\u884c\u65f6\uff0cWATCH \u673a\u5236\u4f1a\u5148\u68c0\u67e5\u76d1\u63a7\u7684\u952e\u662f\u5426\u88ab\u5176\u5b83\u5ba2\u6237\u7aef\u4fee\u6539\u4e86\u3002\u5982\u679c\u4fee\u6539\u4e86\uff0c\u5c31\u653e\u5f03\u4e8b\u52a1\u6267\u884c\uff0c\u907f\u514d\u4e8b\u52a1\u7684\u9694\u79bb\u6027\u88ab\u7834\u574f\u3002\u7136\u540e\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u518d\u6b21\u6267\u884c\u4e8b\u52a1\uff0c\u6b64\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u5e76\u53d1\u4fee\u6539\u4e8b\u52a1\u6570\u636e\u7684\u64cd\u4f5c\u4e86\uff0c\u4e8b\u52a1\u5c31\u80fd\u6b63\u5e38\u6267\u884c\uff0c\u9694\u79bb\u6027\u4e5f\u5f97\u5230\u4e86\u4fdd\u8bc1\u3002 WATCH \u673a\u5236\u7684\u5177\u4f53\u5b9e\u73b0\u662f\u7531 WATCH \u547d\u4ee4\u5b9e\u73b0\u7684 \u5728 t1 \u65f6\uff0c\u5ba2\u6237\u7aef X \u5411\u5b9e\u4f8b\u53d1\u9001\u4e86 WATCH \u547d\u4ee4\u3002\u5b9e\u4f8b\u6536\u5230 WATCH \u547d\u4ee4\u540e\uff0c\u5f00\u59cb\u76d1\u6d4b a:stock \u7684\u503c\u7684\u53d8\u5316\u60c5\u51b5\u3002 \u7d27\u63a5\u7740\uff0c\u5728 t2 \u65f6\uff0c\u5ba2\u6237\u7aef X \u628a MULTI \u547d\u4ee4\u548c DECR \u547d\u4ee4\u53d1\u9001\u7ed9\u5b9e\u4f8b\uff0c\u5b9e\u4f8b\u628a DECR \u547d\u4ee4\u6682\u5b58\u5165\u547d\u4ee4\u961f\u5217\u3002 \u5728 t3 \u65f6\uff0c\u5ba2\u6237\u7aef Y \u4e5f\u7ed9\u5b9e\u4f8b\u53d1\u9001\u4e86\u4e00\u4e2a DECR \u547d\u4ee4\uff0c\u8981\u4fee\u6539 a:stock \u7684\u503c\uff0c\u5b9e\u4f8b\u6536\u5230\u547d\u4ee4\u540e\u5c31\u76f4\u63a5\u6267\u884c\u4e86\u3002 \u7b49\u5230 t4 \u65f6\uff0c\u5b9e\u4f8b\u6536\u5230\u5ba2\u6237\u7aef X \u53d1\u9001\u7684 EXEC \u547d\u4ee4\uff0c\u4f46\u662f\uff0c\u5b9e\u4f8b\u7684 WATCH \u673a\u5236\u53d1\u73b0 a:stock \u5df2\u7ecf\u88ab\u4fee\u6539\u4e86\uff0c\u5c31\u4f1a\u653e\u5f03\u4e8b\u52a1\u6267\u884c\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4e8b\u52a1\u7684\u9694\u79bb\u6027\u5c31\u53ef\u4ee5\u5f97\u5230\u4fdd\u8bc1\u4e86\u3002 \u5f53\u7136\uff0c\u5982\u679c\u6ca1\u6709\u4f7f\u7528 WATCH \u673a\u5236\uff0c\u5728 EXEC \u547d\u4ee4\u524d\u6267\u884c\u7684\u5e76\u53d1\u64cd\u4f5c\u662f\u4f1a\u5bf9\u6570\u636e\u8fdb\u884c\u8bfb\u5199\u7684\u3002\u800c\u4e14\uff0c\u5728\u6267\u884c EXEC \u547d\u4ee4\u7684\u65f6\u5019\uff0c\u4e8b\u52a1\u8981\u64cd\u4f5c\u7684\u6570\u636e\u5df2\u7ecf\u6539\u53d8\u4e86\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cRedis \u5e76\u6ca1\u6709\u505a\u5230\u8ba9\u4e8b\u52a1\u5bf9\u5176\u5b83\u64cd\u4f5c\u9694\u79bb\uff0c\u9694\u79bb\u6027\u4e5f\u5c31\u6ca1\u6709\u5f97\u5230\u4fdd\u969c\u3002 \u4e0b\u9762\u8fd9\u5f20\u56fe\u663e\u793a\u4e86\u6ca1\u6709 WATCH \u673a\u5236\u65f6\u7684\u60c5\u51b5 \u5728 t2 \u65f6\u523b\uff0c\u5ba2\u6237\u7aef X \u53d1\u9001\u7684 EXEC \u547d\u4ee4\u8fd8\u6ca1\u6709\u6267\u884c\uff0c\u4f46\u662f\u5ba2\u6237\u7aef Y \u7684 DECR \u547d\u4ee4\u5c31\u6267\u884c\u4e86\uff0c\u6b64\u65f6\uff0ca:stock \u7684\u503c\u4f1a\u88ab\u4fee\u6539\uff0c\u8fd9\u5c31\u65e0\u6cd5\u4fdd\u8bc1 X \u53d1\u8d77\u7684\u4e8b\u52a1\u7684\u9694\u79bb\u6027\u4e86\u3002 \u5e76\u53d1\u64cd\u4f5c\u5728 EXEC \u547d\u4ee4\u4e4b\u540e\u88ab\u670d\u52a1\u5668\u7aef\u63a5\u6536\u5e76\u6267\u884c\u3002 \u56e0\u4e3a Redis \u662f\u7528\u5355\u7ebf\u7a0b\u6267\u884c\u547d\u4ee4\uff0c\u800c\u4e14\uff0cEXEC \u547d\u4ee4\u6267\u884c\u540e\uff0cRedis \u4f1a\u4fdd\u8bc1\u5148\u628a\u547d\u4ee4\u961f\u5217\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u6267\u884c\u5b8c\u3002\u6240\u4ee5\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5e76\u53d1\u64cd\u4f5c\u4e0d\u4f1a\u7834\u574f\u4e8b\u52a1\u7684\u9694\u79bb\u6027\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a","title":"3-3 \u9694\u79bb\u6027"},{"location":"chap6/4redis_acid/#3-4","text":"\u56e0\u4e3a Redis \u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u6240\u4ee5\uff0c\u6570\u636e\u662f\u5426\u6301\u4e45\u5316\u4fdd\u5b58\u5b8c\u5168\u53d6\u51b3\u4e8e Redis \u7684\u6301\u4e45\u5316\u914d\u7f6e\u6a21\u5f0f\u3002 \u5982\u679c Redis \u6ca1\u6709\u4f7f\u7528 RDB \u6216 AOF\uff0c\u90a3\u4e48\u4e8b\u52a1\u7684\u6301\u4e45\u5316\u5c5e\u6027\u80af\u5b9a\u5f97\u4e0d\u5230\u4fdd\u8bc1\u3002\u5982\u679c Redis \u4f7f\u7528\u4e86 RDB \u6a21\u5f0f\uff0c\u90a3\u4e48\uff0c\u5728\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u540e\uff0c\u800c\u4e0b\u4e00\u6b21\u7684 RDB \u5feb\u7167\u8fd8\u672a\u6267\u884c\u524d\uff0c\u5982\u679c\u53d1\u751f\u4e86\u5b9e\u4f8b\u5b95\u673a\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e8b\u52a1\u4fee\u6539\u7684\u6570\u636e\u4e5f\u662f\u4e0d\u80fd\u4fdd\u8bc1\u6301\u4e45\u5316\u7684\u3002 \u5982\u679c Redis \u91c7\u7528\u4e86 AOF \u6a21\u5f0f\uff0c\u56e0\u4e3a AOF \u6a21\u5f0f\u7684\u4e09\u79cd\u914d\u7f6e\u9009\u9879 no\u3001everysec \u548c always \u90fd\u4f1a\u5b58\u5728\u6570\u636e\u4e22\u5931\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\uff0c\u4e8b\u52a1\u7684\u6301\u4e45\u6027\u5c5e\u6027\u4e5f\u8fd8\u662f\u5f97\u4e0d\u5230\u4fdd\u8bc1\u3002 \u4e0d\u7ba1 Redis \u91c7\u7528\u4ec0\u4e48\u6301\u4e45\u5316\u6a21\u5f0f\uff0c\u4e8b\u52a1\u7684\u6301\u4e45\u6027\u5c5e\u6027\u662f\u5f97\u4e0d\u5230\u4fdd\u8bc1\u7684\u3002","title":"3-4 \u6301\u4e45\u6027"},{"location":"chap6/4redis_acid/#4","text":"Redis \u901a\u8fc7 MULTI\u3001EXEC\u3001DISCARD \u548c WATCH \u56db\u4e2a\u547d\u4ee4\u6765\u652f\u6301\u4e8b\u52a1\u673a\u5236\uff0c\u8fd9 4 \u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\uff0c\u603b\u7ed3\u5728\u4e0b\u9762\u7684\u8868\u4e2d\uff0c\u4f60\u53ef\u4ee5\u518d\u770b\u4e0b\u3002 Redis \u7684\u4e8b\u52a1\u673a\u5236\u53ef\u4ee5\u4fdd\u8bc1\u4e00\u81f4\u6027\u548c\u9694\u79bb\u6027\uff0c\u4f46\u662f\u65e0\u6cd5\u4fdd\u8bc1\u6301\u4e45\u6027\u3002\u4e0d\u8fc7\uff0c\u56e0\u4e3a Redis \u672c\u8eab\u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u6301\u4e45\u6027\u5e76\u4e0d\u662f\u4e00\u4e2a\u5fc5\u987b\u7684\u5c5e\u6027\uff0c\u6211\u4eec\u66f4\u52a0\u5173\u6ce8\u7684\u8fd8\u662f\u539f\u5b50\u6027\u3001\u4e00\u81f4\u6027\u548c\u9694\u79bb\u6027\u8fd9\u4e09\u4e2a\u5c5e\u6027\u3002 \u539f\u5b50\u6027\u7684\u60c5\u51b5\u6bd4\u8f83\u590d\u6742\uff0c \u53ea\u6709\u5f53\u4e8b\u52a1\u4e2d\u4f7f\u7528\u7684\u547d\u4ee4\u8bed\u6cd5\u6709\u8bef\u65f6\uff0c\u539f\u5b50\u6027\u5f97\u4e0d\u5230\u4fdd\u8bc1\uff0c\u5728\u5176\u5b83\u60c5\u51b5\u4e0b\uff0c\u4e8b\u52a1\u90fd\u53ef\u4ee5\u539f\u5b50\u6027\u6267\u884c\u3002 \u5c0f\u5efa\u8bae\uff1a\u4e25\u683c\u6309\u7167 Redis \u7684\u547d\u4ee4\u89c4\u8303\u8fdb\u884c\u7a0b\u5e8f\u5f00\u53d1\uff0c\u5e76\u4e14\u901a\u8fc7 code review \u786e\u4fdd\u547d\u4ee4\u7684\u6b63\u786e\u6027\u3002\u8fd9","title":"4\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap6/5redis_perf/","text":"\u7b2c\u516d\u7ae0 Redis\u6027\u80fd\u4e0e\u9501\u673a\u5236\u4ee5\u53caACID 1\u3001\u672c\u7ae0\u5c0f\u7ed3 1-1 \u57fa\u4e8eSSD\u5b9e\u73b0\u5927\u5bb9\u91cfRedis:Pika \u8ddf Redis \u76f8\u6bd4\uff0cPika \u7684\u597d\u5904\u975e\u5e38\u660e\u663e\uff1a\u65e2\u652f\u6301 Redis \u64cd\u4f5c\u63a5\u53e3\uff0c\u53c8\u80fd\u652f\u6301\u4fdd\u5b58\u5927\u5bb9\u91cf\u7684\u6570\u636e\u3002 \u5982\u679c\u4f60\u539f\u6765\u5c31\u5728\u5e94\u7528 Redis\uff0c\u73b0\u5728\u60f3\u8fdb\u884c\u6269\u5bb9\uff0c\u90a3\u4e48\uff0cPika \u65e0\u7591\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\uff0c\u65e0\u8bba\u662f\u4ee3\u7801\u8fc1\u79fb\u8fd8\u662f\u8fd0\u7ef4\u7ba1\u7406\uff0cPika \u57fa\u672c\u4e0d\u9700\u8981\u989d\u5916\u7684\u5de5\u4f5c\u91cf\u3002 \u4e0d\u8fc7\uff0cPika \u6bd5\u7adf\u662f\u628a\u6570\u636e\u4fdd\u5b58\u5230\u4e86 SSD \u4e0a\uff0c\u6570\u636e\u8bbf\u95ee\u8981\u8bfb\u5199 SSD\uff0c\u6240\u4ee5\uff0c\u8bfb\u5199\u6027\u80fd\u8981\u5f31\u4e8e Redis\u3002\u9488\u5bf9\u8fd9\u4e00\u70b9\uff0c\u6211\u7ed9\u4f60\u63d0\u4f9b\u4e24\u4e2a\u964d\u4f4e\u8bfb\u5199 SSD \u5bf9 Pika \u7684\u6027\u80fd\u5f71\u54cd\u7684\u5c0f\u5efa\u8bae\uff1a \u5229\u7528 Pika \u7684\u591a\u7ebf\u7a0b\u6a21\u578b\uff0c\u589e\u52a0\u7ebf\u7a0b\u6570\u91cf\uff0c\u63d0\u5347 Pika \u7684\u5e76\u53d1\u8bf7\u6c42\u5904\u7406\u80fd\u529b\uff1b \u4e3a Pika \u914d\u7f6e\u9ad8\u914d\u7684 SSD\uff0c\u63d0\u5347 SSD \u81ea\u8eab\u7684\u8bbf\u95ee\u6027\u80fd\u3002 Pika \u672c\u8eab\u63d0\u4f9b\u4e86\u5f88\u591a\u5de5\u5177\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u628a Redis \u6570\u636e\u8fc1\u79fb\u5230 Pika\uff0c\u6216\u8005\u662f\u628a Redis \u8bf7\u6c42\u8f6c\u53d1\u7ed9 Pika\u3002\u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u4f7f\u7528 aof_to_pika \u547d\u4ee4\uff0c\u5e76\u4e14\u6307\u5b9a Redis \u7684 AOF \u6587\u4ef6\u4ee5\u53ca Pika \u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u5c31\u53ef\u4ee5\u628a Redis \u6570\u636e\u8fc1\u79fb\u5230 Pika \u4e2d\u4e86\uff0c\u5982\u4e0b\u6240\u793a\uff1a aof_to_pika -i [Redis AOF\u6587\u4ef6] -h [Pika IP] -p [Pika port] -a [\u8ba4\u8bc1\u4fe1\u606f] \u4f60\u90fd\u53ef\u4ee5\u76f4\u63a5\u5728 Pika \u7684 GitHub \u4e0a\u627e\u5230\u3002\u800c\u4e14\uff0cPika \u672c\u8eab\u4e5f\u8fd8\u5728\u8fed\u4ee3\u5f00\u53d1\u4e2d\uff0c\u6211\u4e5f\u5efa\u8bae\u4f60\u591a\u53bb\u770b\u770b GitHub\uff0c\u8fdb\u4e00\u6b65\u5730\u4e86\u89e3\u5b83\u3002 \u8fd9\u6837\uff0c\u4f60\u5c31\u53ef\u4ee5\u83b7\u5f97 Pika \u7684\u6700\u65b0\u8fdb\u5c55\uff0c\u4e5f\u80fd\u66f4\u597d\u5730\u628a\u5b83\u5e94\u7528\u5230\u4f60\u7684\u4e1a\u52a1\u5b9e\u8df5\u4e2d\u3002 1-2 Redis\u5e94\u5bf9\u5e76\u53d1\u8bbf\u95ee\uff1a\u65e0\u9501\u7684\u539f\u5b50\u64cd\u4f5c \u5728\u5e76\u53d1\u8bbf\u95ee\u65f6\uff0c\u5e76\u53d1\u7684 RMW \u64cd\u4f5c\u4f1a\u5bfc\u81f4\u6570\u636e\u9519\u8bef\uff0c\u6240\u4ee5\u9700\u8981\u8fdb\u884c\u5e76\u53d1\u63a7\u5236\u3002\u6240\u8c13\u5e76\u53d1\u63a7\u5236\uff0c\u5c31\u662f\u8981\u4fdd\u8bc1\u4e34\u754c\u533a\u4ee3\u7801\u7684\u4e92\u65a5\u6267\u884c\u3002 Redis \u63d0\u4f9b\u4e86\u4e24\u79cd\u539f\u5b50\u64cd\u4f5c\u7684\u65b9\u6cd5\u6765\u5b9e\u73b0\u5e76\u53d1\u63a7\u5236\uff0c\u5206\u522b\u662f\u5355\u547d\u4ee4\u64cd\u4f5c\u548c Lua \u811a\u672c\u3002 \u56e0\u4e3a\u539f\u5b50\u64cd\u4f5c\u672c\u8eab\u4e0d\u4f1a\u5bf9\u592a\u591a\u7684\u8d44\u6e90\u9650\u5236\u8bbf\u95ee\uff0c\u53ef\u4ee5\u7ef4\u6301\u8f83\u9ad8\u7684\u7cfb\u7edf\u5e76\u53d1\u6027\u80fd\u3002 \u4f46\u662f\uff0c\u5355\u547d\u4ee4\u539f\u5b50\u64cd\u4f5c\u7684\u9002\u7528\u8303\u56f4\u8f83\u5c0f\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u7684 RMW \u64cd\u4f5c\u90fd\u80fd\u8f6c\u53d8\u6210\u5355\u547d\u4ee4\u7684\u539f\u5b50\u64cd\u4f5c\uff08\u4f8b\u5982 INCR/DECR \u547d\u4ee4\u53ea\u80fd\u5728\u8bfb\u53d6\u6570\u636e\u540e\u505a\u539f\u5b50\u589e\u51cf\uff09\uff0c\u5f53\u6211\u4eec\u9700\u8981\u5bf9\u8bfb\u53d6\u7684\u6570\u636e\u505a\u66f4\u591a\u5224\u65ad\uff0c\u6216\u8005\u662f\u6211\u4eec\u5bf9\u6570\u636e\u7684\u4fee\u6539\u4e0d\u662f\u7b80\u5355\u7684\u589e\u51cf\u65f6\uff0c\u5355\u547d\u4ee4\u64cd\u4f5c\u5c31\u4e0d\u9002\u7528\u4e86\u3002 \u800c Redis \u7684 Lua \u811a\u672c\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u64cd\u4f5c\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u4f1a\u4ee5\u539f\u5b50\u6027\u7684\u65b9\u5f0f\u6267\u884c\uff0c\u7ed5\u5f00\u4e86\u5355\u547d\u4ee4\u64cd\u4f5c\u7684\u9650\u5236\u3002 \u4e0d\u8fc7\uff0c\u5982\u679c\u628a\u5f88\u591a\u64cd\u4f5c\u90fd\u653e\u5728 Lua \u811a\u672c\u4e2d\u539f\u5b50\u6267\u884c\uff0c\u4f1a\u5bfc\u81f4 Redis \u6267\u884c\u811a\u672c\u7684\u65f6\u95f4\u589e\u52a0\uff0c\u540c\u6837\u4e5f\u4f1a\u964d\u4f4e Redis \u7684\u5e76\u53d1\u6027\u80fd\u3002\u6240\u4ee5\uff0c\u6211\u7ed9\u4f60\u4e00\u4e2a\u5c0f\u5efa\u8bae\uff1a\u5728\u7f16\u5199 Lua \u811a\u672c\u65f6\uff0c\u4f60\u8981\u907f\u514d\u628a\u4e0d\u9700\u8981\u505a\u5e76\u53d1\u63a7\u5236\u7684\u64cd\u4f5c\u5199\u5165\u811a\u672c\u4e2d\u3002 \u5f53\u7136\uff0c\u52a0\u9501\u4e5f\u80fd\u5b9e\u73b0\u4e34\u754c\u533a\u4ee3\u7801\u7684\u4e92\u65a5\u6267\u884c\uff0c\u53ea\u662f\u5982\u679c\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u52a0\u9501\u65f6\uff0c\u5c31\u9700\u8981\u5206\u5e03\u5f0f\u9501\u7684\u652f\u6301\u4e86 1-3 Redis\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501 \u5206\u5e03\u5f0f\u9501\u662f\u7531\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u7ef4\u62a4\u7684\u53d8\u91cf\uff0c\u591a\u4e2a\u5ba2\u6237\u7aef\u53ef\u4ee5\u5411\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u53d1\u9001\u547d\u4ee4\u8fdb\u884c\u52a0\u9501\u6216\u91ca\u653e\u9501\u64cd\u4f5c\u3002 Redis \u4f5c\u4e3a\u4e00\u4e2a\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\uff0c\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u3002 \u5728\u57fa\u4e8e\u5355\u4e2a Redis \u5b9e\u4f8b\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u65f6\uff0c\u5bf9\u4e8e\u52a0\u9501\u64cd\u4f5c\uff0c\u6211\u4eec\u9700\u8981\u6ee1\u8db3\u4e09\u4e2a\u6761\u4ef6\u3002 \u52a0\u9501\u5305\u62ec\u4e86 \u8bfb\u53d6\u9501\u53d8\u91cf\u3001\u68c0\u67e5\u9501\u53d8\u91cf\u503c\u548c\u8bbe\u7f6e\u9501\u53d8\u91cf\u503c \u4e09\u4e2a\u64cd\u4f5c\uff0c\u4f46\u9700\u8981\u4ee5\u539f\u5b50\u64cd\u4f5c\u7684\u65b9\u5f0f\u5b8c\u6210\uff0c\u6240\u4ee5 \uff0c\u6211\u4eec\u4f7f\u7528 SET \u547d\u4ee4\u5e26\u4e0a NX \u9009\u9879\u6765\u5b9e\u73b0\u52a0\u9501 \uff1b \u9501\u53d8\u91cf\u9700\u8981\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u514d\u5ba2\u6237\u7aef\u62ff\u5230\u9501\u540e\u53d1\u751f\u5f02\u5e38\uff0c\u5bfc\u81f4\u9501\u4e00\u76f4\u65e0\u6cd5\u91ca\u653e\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5728 SET \u547d\u4ee4\u6267\u884c\u65f6\u52a0\u4e0a EX/PX \u9009\u9879 \uff0c\u8bbe\u7f6e\u5176\u8fc7\u671f\u65f6\u95f4\uff1b \u9501\u53d8\u91cf\u7684\u503c\u9700\u8981\u80fd\u533a\u5206\u6765\u81ea\u4e0d\u540c\u5ba2\u6237\u7aef\u7684\u52a0\u9501\u64cd\u4f5c\uff0c\u4ee5\u514d\u5728\u91ca\u653e\u9501\u65f6\uff0c\u51fa\u73b0\u8bef\u91ca\u653e\u64cd\u4f5c\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u4f7f\u7528 SET \u547d\u4ee4\u8bbe\u7f6e\u9501\u53d8\u91cf\u503c\u65f6\uff0c\u6bcf\u4e2a\u5ba2\u6237\u7aef\u8bbe\u7f6e\u7684\u503c\u662f\u4e00\u4e2a\u552f\u4e00\u503c\uff0c\u7528\u4e8e\u6807\u8bc6\u5ba2\u6237\u7aef\u3002 \u548c\u52a0\u9501\u7c7b\u4f3c\uff0c\u91ca\u653e\u9501\u4e5f\u5305\u542b\u4e86\u8bfb\u53d6\u9501\u53d8\u91cf\u503c\u3001\u5224\u65ad\u9501\u53d8\u91cf\u503c\u548c\u5220\u9664\u9501\u53d8\u91cf\u4e09\u4e2a\u64cd\u4f5c\uff0c\u4e0d\u8fc7\uff0c\u6211\u4eec\u65e0\u6cd5\u4f7f\u7528\u5355\u4e2a\u547d\u4ee4\u6765\u5b9e\u73b0\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528 Lua \u811a\u672c\u6267\u884c\u91ca\u653e\u9501\u64cd\u4f5c\uff0c\u901a\u8fc7 Redis \u539f\u5b50\u6027\u5730\u6267\u884c Lua \u811a\u672c\uff0c\u6765\u4fdd\u8bc1\u91ca\u653e\u9501\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002 \u4e0d\u8fc7\uff0c\u57fa\u4e8e\u5355\u4e2a Redis \u5b9e\u4f8b\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u65f6\uff0c\u4f1a\u9762\u4e34\u5b9e\u4f8b\u5f02\u5e38\u6216\u5d29\u6e83\u7684\u60c5\u51b5\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u5b9e\u4f8b\u65e0\u6cd5\u63d0\u4f9b\u9501\u64cd\u4f5c\uff0c \u6b63\u56e0\u4e3a\u6b64\uff0cRedis \u4e5f\u63d0\u4f9b\u4e86 Redlock \u7b97\u6cd5\uff0c\u7528\u6765\u5b9e\u73b0\u57fa\u4e8e\u591a\u4e2a\u5b9e\u4f8b\u7684\u5206\u5e03\u5f0f\u9501 \u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u9501\u53d8\u91cf\u7531\u591a\u4e2a\u5b9e\u4f8b\u7ef4\u62a4\uff0c\u5373\u4f7f\u6709\u5b9e\u4f8b\u53d1\u751f\u4e86\u6545\u969c\uff0c\u9501\u53d8\u91cf\u4ecd\u7136\u662f\u5b58\u5728\u7684\uff0c\u5ba2\u6237\u7aef\u8fd8\u662f\u53ef\u4ee5\u5b8c\u6210\u9501\u64cd\u4f5c 1-4 \u4e8b\u52a1\u673a\u5236 Redis\u5b9e\u73b0ACID\u5c5e\u6027 Redis \u901a\u8fc7 MULTI\u3001EXEC\u3001DISCARD \u548c WATCH \u56db\u4e2a\u547d\u4ee4\u6765\u652f\u6301\u4e8b\u52a1\u673a\u5236\uff0c\u8fd9 4 \u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\uff0c\u603b\u7ed3\u5728\u4e0b\u9762\u7684\u8868\u4e2d\uff0c\u4f60\u53ef\u4ee5\u518d\u770b\u4e0b\u3002 Redis \u7684\u4e8b\u52a1\u673a\u5236\u53ef\u4ee5\u4fdd\u8bc1\u4e00\u81f4\u6027\u548c\u9694\u79bb\u6027\uff0c\u4f46\u662f\u65e0\u6cd5\u4fdd\u8bc1\u6301\u4e45\u6027\u3002\u4e0d\u8fc7\uff0c\u56e0\u4e3a Redis \u672c\u8eab\u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u6301\u4e45\u6027\u5e76\u4e0d\u662f\u4e00\u4e2a\u5fc5\u987b\u7684\u5c5e\u6027\uff0c\u6211\u4eec\u66f4\u52a0\u5173\u6ce8\u7684\u8fd8\u662f\u539f\u5b50\u6027\u3001\u4e00\u81f4\u6027\u548c\u9694\u79bb\u6027\u8fd9\u4e09\u4e2a\u5c5e\u6027\u3002 \u539f\u5b50\u6027\u7684\u60c5\u51b5\u6bd4\u8f83\u590d\u6742\uff0c \u53ea\u6709\u5f53\u4e8b\u52a1\u4e2d\u4f7f\u7528\u7684\u547d\u4ee4\u8bed\u6cd5\u6709\u8bef\u65f6\uff0c\u539f\u5b50\u6027\u5f97\u4e0d\u5230\u4fdd\u8bc1\uff0c\u5728\u5176\u5b83\u60c5\u51b5\u4e0b\uff0c\u4e8b\u52a1\u90fd\u53ef\u4ee5\u539f\u5b50\u6027\u6267\u884c\u3002 \u5c0f\u5efa\u8bae\uff1a\u4e25\u683c\u6309\u7167 Redis \u7684\u547d\u4ee4\u89c4\u8303\u8fdb\u884c\u7a0b\u5e8f\u5f00\u53d1\uff0c\u5e76\u4e14\u901a\u8fc7 code review \u786e\u4fdd\u547d\u4ee4\u7684\u6b63\u786e\u6027\u3002\u8fd9 2\u3001\u672c\u7ae0\u64cd\u4f5c\u603b\u7ed3 Redis \u63d0\u4f9b\u4e86 INCR/DECR \u547d\u4ee4\uff0c\u628a\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u8f6c\u53d8\u4e3a\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\u4e86 \u3002 INCR/DECR \u547d\u4ee4\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u589e\u503c / \u51cf\u503c\u64cd\u4f5c\uff0c\u800c\u4e14\u5b83\u4eec\u672c\u8eab\u5c31\u662f\u5355\u4e2a\u547d\u4ee4\u64cd\u4f5c\uff0cRedis \u5728\u6267\u884c\u5b83\u4eec\u65f6\uff0c\u672c\u8eab\u5c31\u5177\u6709\u4e92\u65a5\u6027 \u6bd4\u5982\u8bf4\uff0c\u5728\u521a\u624d\u7684\u5e93\u5b58\u6263\u51cf\u4f8b\u5b50\u4e2d\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u76f4\u63a5\u5b8c\u6210\u5bf9\u5546\u54c1 id \u7684\u5e93\u5b58\u503c\u51cf 1 \u64cd\u4f5c\u3002 \u5373\u4f7f\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u6267\u884c\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u4e5f\u4e0d\u7528\u62c5\u5fc3\u51fa\u73b0\u5e93\u5b58\u503c\u6263\u51cf\u9519\u8bef\u7684\u95ee\u9898 \u3002 DECR id Lua \u811a\u672c\uff0c \u4e0b\u9762\u7684\u8fd9\u6bb5\u4ee3\u7801\uff0c\u5b83\u5b9e\u73b0\u4e86\u5bf9\u5ba2\u6237\u7aef\u6bcf\u5206\u949f\u8bbf\u95ee\u6b21\u6570\u4e0d\u8d85\u8fc7 20 \u6b21\u7684\u9650\u5236\u3002 //\u83b7\u53d6ip\u5bf9\u5e94\u7684\u8bbf\u95ee\u6b21\u6570 current = GET(ip) //\u5982\u679c\u8d85\u8fc7\u8bbf\u95ee\u6b21\u6570\u8d85\u8fc720\u6b21\uff0c\u5219\u62a5\u9519 IF current != NULL AND current > 20 THEN ERROR \"exceed 20 accesses per second\" ELSE //\u5982\u679c\u8bbf\u95ee\u6b21\u6570\u4e0d\u8db320\u6b21\uff0c\u589e\u52a0\u4e00\u6b21\u8bbf\u95ee\u8ba1\u6570 value = INCR(ip) //\u5982\u679c\u662f\u7b2c\u4e00\u6b21\u8bbf\u95ee\uff0c\u5c06\u952e\u503c\u5bf9\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a60s\u540e IF value == 1 THEN EXPIRE(ip,60) END //\u6267\u884c\u5176\u4ed6\u64cd\u4f5c DO THINGS END \u4f7f\u7528 Lua \u811a\u672c\u6765\u4fdd\u8bc1\u5e76\u53d1\u63a7\u5236\u3002 \u6211\u4eec\u53ef\u4ee5\u628a\u8bbf\u95ee\u6b21\u6570\u52a0 1 \u5224\u65ad\u8bbf\u95ee\u6b21\u6570\u662f\u5426\u4e3a 1 \u4ee5\u53ca\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u5199\u5165\u4e00\u4e2a Lua \u811a\u672c \u5982\u4e0b\u6240\u793a\uff1a local current current = redis.call(\"incr\",KEYS[1]) if tonumber(current) == 1 then redis.call(\"expire\",KEYS[1],60) end \u7f16\u5199\u7684\u811a\u672c\u540d\u79f0\u4e3a lua.script \uff0c\u6211\u4eec\u63a5\u7740\u5c31\u53ef\u4ee5\u4f7f\u7528 Redis \u5ba2\u6237\u7aef\uff0c\u5e26\u4e0a eval \u9009\u9879\uff0c\u6765\u6267\u884c\u8be5\u811a\u672c\u3002\u811a\u672c\u6240\u9700\u7684\u53c2\u6570\u5c06\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u4e2d\u7684 keys \u548c args \u8fdb\u884c\u4f20\u9012\u3002 redis-cli --eval lua.script keys , args \u8fd9\u6837\u4e00\u6765\uff0c\u8bbf\u95ee\u6b21\u6570\u52a0 1\u3001\u5224\u65ad\u8bbf\u95ee\u6b21\u6570\u662f\u5426\u4e3a 1\uff0c\u4ee5\u53ca\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u5c31\u53ef\u4ee5\u539f\u5b50\u6027\u5730\u6267\u884c\u4e86\u3002\u5373\u4f7f\u5ba2\u6237\u7aef\u6709\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u6267\u884c\u8fd9\u4e2a\u811a\u672c\uff0cRedis \u4e5f\u4f1a\u4f9d\u6b21\u4e32\u884c\u6267\u884c\u811a\u672c\u4ee3\u7801\uff0c\u907f\u514d\u4e86\u5e76\u53d1\u64cd\u4f5c\u5e26\u6765\u7684\u6570\u636e\u9519\u8bef\u3002 Redis\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501 \u5982\u679c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0ckey \u4e0d\u5b58\u5728\uff0c\u90a3\u4e48 key \u4f1a\u88ab\u521b\u5efa\uff0c\u5e76\u4e14\u503c\u4f1a\u88ab\u8bbe\u7f6e\u4e3a value\uff1b\u5982\u679c key \u5df2\u7ecf\u5b58\u5728\uff0cSETNX \u4e0d\u505a\u4efb\u4f55\u8d4b\u503c\u64cd\u4f5c \u3002 SETNX key value \u53ef\u4ee5\u7528 SETNX \u548c DEL \u547d\u4ee4\u7ec4\u5408\u6765\u5b9e\u73b0\u52a0\u9501\u548c\u91ca\u653e\u9501\u64cd\u4f5c \u3002\u4e0b\u9762\u7684\u4f2a\u4ee3\u7801\u793a\u4f8b\u663e\u793a\u4e86\u9501\u64cd\u4f5c\u7684\u8fc7\u7a0b\uff0c\u4f60\u53ef\u4ee5\u770b\u4e0b\u3002 // \u52a0\u9501 SETNX lock_key 1 // \u4e1a\u52a1\u903b\u8f91 DO THINGS // \u91ca\u653e\u9501 DEL lock_key \u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0c\u53ea\u6709 key \u4e0d\u5b58\u5728\u65f6\uff0cSET \u624d\u4f1a\u521b\u5efa key\uff0c\u5e76\u5bf9 key \u8fdb\u884c\u8d4b\u503c\u3002\u53e6\u5916\uff0c key \u7684\u5b58\u6d3b\u65f6\u95f4\u7531 seconds \u6216\u8005 milliseconds \u9009\u9879\u503c\u6765\u51b3\u5b9a\u3002 SET key value [EX seconds | PX milliseconds] [NX] \u6709\u4e86 SET \u547d\u4ee4\u7684 NX \u548c EX/PX \u9009\u9879\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6765\u5b9e\u73b0\u52a0\u9501\u64cd\u4f5c\u4e86\u3002 // \u52a0\u9501, unique_value\u4f5c\u4e3a\u5ba2\u6237\u7aef\u552f\u4e00\u6027\u7684\u6807\u8bc6 SET lock_key unique_value NX PX 10000 \u5176\u4e2d\uff0c unique_value \u662f\u5ba2\u6237\u7aef\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u53ef\u4ee5\u7528\u4e00\u4e2a\u968f\u673a\u751f\u6210\u7684\u5b57\u7b26\u4e32\u6765\u8868\u793a\uff0c PX 10000 \u5219\u8868\u793a lock_key \u4f1a\u5728 10s \u540e\u8fc7\u671f\uff0c\u4ee5\u514d\u5ba2\u6237\u7aef\u5728\u8fd9\u671f\u95f4\u53d1\u751f\u5f02\u5e38\u800c\u65e0\u6cd5\u91ca\u653e\u9501\u3002 \u56e0\u4e3a\u5728\u52a0\u9501\u64cd\u4f5c\u4e2d\uff0c\u6bcf\u4e2a\u5ba2\u6237\u7aef\u90fd\u4f7f\u7528\u4e86\u4e00\u4e2a\u552f\u4e00\u6807\u8bc6\uff0c\u6240\u4ee5\u5728\u91ca\u653e\u9501\u64cd\u4f5c\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5224\u65ad\u9501\u53d8\u91cf\u7684\u503c\uff0c\u662f\u5426\u7b49\u4e8e\u6267\u884c\u91ca\u653e\u9501\u64cd\u4f5c\u7684\u5ba2\u6237\u7aef\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u5982\u4e0b\u6240\u793a\uff1a //\u91ca\u653e\u9501 \u6bd4\u8f83unique_value\u662f\u5426\u76f8\u7b49\uff0c\u907f\u514d\u8bef\u91ca\u653e if redis.call(\"get\",KEYS[1]) == ARGV[1] then return redis.call(\"del\",KEYS[1]) else return 0 end \u8fd9\u662f\u4f7f\u7528 Lua \u811a\u672c\uff08 unlock.script \uff09\u5b9e\u73b0\u7684\u91ca\u653e\u9501\u64cd\u4f5c\u7684\u4f2a\u4ee3\u7801\uff0c\u5176\u4e2d\uff0c KEYS[1] \u8868\u793a lock_key \uff0c ARGV[1] \u662f\u5f53\u524d\u5ba2\u6237\u7aef\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u8fd9\u4e24\u4e2a\u503c\u90fd\u662f\u6211\u4eec\u5728\u6267\u884c Lua \u811a\u672c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u7684\u3002 \u6700\u540e\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u9501\u91ca\u653e\u64cd\u4f5c\u4e86\u3002 redis-cli --eval unlock.script lock_key , unique_value \u4e8b\u52a1\u673a\u5236 Redis\u5b9e\u73b0ACID\u5c5e\u6027 \u4f7f\u7528 MULTI \u548c EXEC \u6267\u884c\u4e00\u4e2a\u4e8b\u52a1\u7684\u8fc7\u7a0b #\u5f00\u542f\u4e8b\u52a1 127.0.0.1:6379> MULTI OK #\u5c06a:stock\u51cf1\uff0c 127.0.0.1:6379> DECR a:stock QUEUED #\u5c06b:stock\u51cf1 127.0.0.1:6379> DECR b:stock QUEUED #\u5b9e\u9645\u6267\u884c\u4e8b\u52a1 127.0.0.1:6379> EXEC 1) (integer) 4 2) (integer) 9 \u5047\u8bbe a:stock \u3001 b:stock \u4e24\u4e2a\u952e\u7684\u521d\u59cb\u503c\u662f 5 \u548c 10\u3002 \u5728 MULTI \u547d\u4ee4\u540e\u6267\u884c\u7684\u4e24\u4e2a DECR \u547d\u4ee4\uff0c\u662f\u628a a:stock \u3001 b:stock \u4e24\u4e2a\u952e\u7684\u503c\u5206\u522b\u51cf 1\uff0c\u5b83\u4eec\u6267\u884c\u540e\u7684\u8fd4\u56de\u7ed3\u679c\u90fd\u662f QUEUED \uff0c\u8fd9\u5c31\u8868\u793a\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u88ab\u6682\u5b58\u5230\u4e86\u547d\u4ee4\u961f\u5217\uff0c\u8fd8\u6ca1\u6709\u5b9e\u9645\u6267\u884c\u3002 \u7b49\u5230\u6267\u884c\u4e86 EXEC \u547d\u4ee4\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u8fd4\u56de\u4e86 4\u30019\uff0c\u8fd9\u5c31\u8868\u660e\uff0c\u4e24\u4e2a DECR \u547d\u4ee4\u5df2\u7ecf\u6210\u529f\u5730\u6267\u884c\u4e86\u3002 #\u5f00\u542f\u4e8b\u52a1 127.0.0.1:6379> MULTI OK #\u53d1\u9001\u4e8b\u52a1\u4e2d\u7684\u7b2c\u4e00\u4e2a\u64cd\u4f5c\uff0c\u4f46\u662fRedis\u4e0d\u652f\u6301\u8be5\u547d\u4ee4\uff0c\u8fd4\u56de\u62a5\u9519\u4fe1\u606f 127.0.0.1:6379> PUT a:stock 5 (error) ERR unknown command `PUT`, with args beginning with: `a:stock`, `5`, #\u53d1\u9001\u4e8b\u52a1\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u662f\u6b63\u786e\u7684\u547d\u4ee4\uff0cRedis\u628a\u8be5\u547d\u4ee4\u5165\u961f 127.0.0.1:6379> DECR b:stock QUEUED #\u5b9e\u9645\u6267\u884c\u4e8b\u52a1\uff0c\u4f46\u662f\u4e4b\u524d\u547d\u4ee4\u6709\u9519\u8bef\uff0c\u6240\u4ee5Redis\u62d2\u7edd\u6267\u884c 127.0.0.1:6379> EXEC (error) EXECABORT Transaction discarded because of previous errors. \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c \u4e8b\u52a1\u91cc\u5305\u542b\u4e86\u4e00\u4e2a Redis \u672c\u8eab\u5c31\u4e0d\u652f\u6301\u7684 PUT \u547d\u4ee4\uff0c\u6240\u4ee5\uff0c\u5728 PUT \u547d\u4ee4\u5165\u961f\u65f6\uff0cRedis \u5c31\u62a5\u9519\u4e86 \u3002 \u867d\u7136\uff0c\u4e8b\u52a1\u91cc\u8fd8\u6709\u4e00\u4e2a\u6b63\u786e\u7684 DECR \u547d\u4ee4\uff0c\u4f46\u662f\uff0c\u5728\u6700\u540e\u6267\u884c EXEC \u547d\u4ee4\u540e\uff0c\u6574\u4e2a\u4e8b\u52a1\u88ab\u653e\u5f03\u6267\u884c\u4e86\u3002 \u4e8b\u52a1\u4e2d\u7684 LPOP \u547d\u4ee4\u5bf9 String \u7c7b\u578b\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\uff0c\u5165\u961f\u65f6\u6ca1\u6709\u62a5\u9519\uff0c\u4f46\u662f\uff0c\u5728 EXEC \u6267\u884c\u65f6\u62a5\u9519\u4e86\u3002LPOP \u547d\u4ee4\u672c\u8eab\u6ca1\u6709\u6267\u884c\u6210\u529f\uff0c\u4f46\u662f\u4e8b\u52a1\u4e2d\u7684 DECR \u547d\u4ee4\u5374\u6210\u529f\u6267\u884c\u4e86\u3002 #\u5f00\u542f\u4e8b\u52a1 127.0.0.1:6379> MULTI OK #\u53d1\u9001\u4e8b\u52a1\u4e2d\u7684\u7b2c\u4e00\u4e2a\u64cd\u4f5c\uff0cLPOP\u547d\u4ee4\u64cd\u4f5c\u7684\u6570\u636e\u7c7b\u578b\u4e0d\u5339\u914d\uff0c\u6b64\u65f6\u5e76\u4e0d\u62a5\u9519 127.0.0.1:6379> LPOP a:stock QUEUED #\u53d1\u9001\u4e8b\u52a1\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u64cd\u4f5c 127.0.0.1:6379> DECR b:stock QUEUED #\u5b9e\u9645\u6267\u884c\u4e8b\u52a1\uff0c\u4e8b\u52a1\u7b2c\u4e00\u4e2a\u64cd\u4f5c\u6267\u884c\u62a5\u9519 127.0.0.1:6379> EXEC 1) (error) WRONGTYPE Operation against a key holding the wrong kind of value 2) (integer) 8 Redis \u4e2d\u5e76\u6ca1\u6709\u63d0\u4f9b\u56de\u6eda\u673a\u5236\u3002 \u867d\u7136 Redis \u63d0\u4f9b\u4e86 DISCARD \u547d\u4ee4\uff0c\u4f46\u662f\uff0c\u8fd9\u4e2a\u547d\u4ee4\u53ea\u80fd\u7528\u6765\u4e3b\u52a8\u653e\u5f03\u4e8b\u52a1\u6267\u884c\uff0c\u628a\u6682\u5b58\u7684\u547d\u4ee4\u961f\u5217\u6e05\u7a7a\uff0c\u8d77\u4e0d\u5230\u56de\u6eda\u7684\u6548\u679c\u3002 #\u8bfb\u53d6a:stock\u7684\u503c4 127.0.0.1:6379> GET a:stock \"4\" #\u5f00\u542f\u4e8b\u52a1 127.0.0.1:6379> MULTI OK #\u53d1\u9001\u4e8b\u52a1\u7684\u7b2c\u4e00\u4e2a\u64cd\u4f5c\uff0c\u5bf9a:stock\u51cf1 127.0.0.1:6379> DECR a:stock QUEUED #\u6267\u884cDISCARD\u547d\u4ee4\uff0c\u4e3b\u52a8\u653e\u5f03\u4e8b\u52a1 127.0.0.1:6379> DISCARD OK #\u518d\u6b21\u8bfb\u53d6a:stock\u7684\u503c\uff0c\u503c\u6ca1\u6709\u88ab\u4fee\u6539 127.0.0.1:6379> GET a:stock \"4\" \u4f8b\u5b50\u4e2d\uff0ca:stock \u952e\u7684\u503c\u4e00\u5f00\u59cb\u4e3a 4\uff0c\u7136\u540e\uff0c\u6211\u4eec\u6267\u884c\u4e00\u4e2a\u4e8b\u52a1\uff0c\u60f3\u5bf9 a:stock \u7684\u503c\u51cf 1\u3002\u4f46\u662f\uff0c\u5728\u4e8b\u52a1\u7684\u6700\u540e\uff0c\u6211\u4eec\u6267\u884c\u7684\u662f DISCARD \u547d\u4ee4\uff0c\u6240\u4ee5\u4e8b\u52a1\u5c31\u88ab\u653e\u5f03\u4e86\u3002\u6211\u4eec\u518d\u6b21\u67e5\u770b a:stock \u7684\u503c\uff0c\u4f1a\u53d1\u73b0\u4ecd\u7136\u4e3a 4\u3002 3\u3001\u672c\u7ae0\u95ee\u9898 \u95ee\u9898 \uff1a\u4ecb\u7ecd\u7684\u662f\u4f7f\u7528 SSD \u4f5c\u4e3a\u5185\u5b58\u5bb9\u91cf\u7684\u6269\u5c55\uff0c\u589e\u52a0 Redis \u5b9e\u4f8b\u7684\u6570\u636e\u4fdd\u5b58\u91cf\uff0c\u53ef\u4ee5\u4f7f\u7528\u673a\u68b0\u786c\u76d8\u6765\u4f5c\u4e3a\u5b9e\u4f8b\u5bb9\u91cf\u6269\u5c55\u5417\uff1f\u6709\u4ec0\u4e48\u597d\u5904\u6216\u4e0d\u8db3\u5417\uff1f \u4ece\u5bb9\u91cf\u7ef4\u5ea6\u6765\u770b\uff0c\u673a\u68b0\u786c\u76d8\u7684\u6027\u4ef7\u6bd4\u66f4\u9ad8\uff0c\u673a\u68b0\u786c\u76d8\u6bcf GB \u7684\u6210\u672c\u5927\u7ea6\u5728 0.1 \u5143\u5de6\u53f3\uff0c\u800c SSD \u6bcf GB \u7684\u6210\u672c\u5927\u7ea6\u662f 0.4~0.6 \u5143\u5de6\u53f3\u3002 \u4ece\u6027\u80fd\u89d2\u5ea6\u6765\u770b\uff0c\u673a\u68b0\u786c\u76d8\uff08\u4f8b\u5982 SAS \u76d8\uff09\u7684\u5ef6\u8fdf\u5927\u7ea6\u5728 3~5ms\uff0c\u800c\u4f01\u4e1a\u7ea7 SSD \u7684\u8bfb\u5ef6\u8fdf\u5927\u7ea6\u662f 60~80us\uff0c\u5199\u5ef6\u8fdf\u5728 20us\u3002\u7f13\u5b58\u7684\u8d1f\u8f7d\u7279\u5f81\u4e00\u822c\u662f\u5c0f\u7c92\u5ea6\u6570\u636e\u3001\u9ad8\u5e76\u53d1\u8bf7\u6c42\uff0c\u8981\u6c42\u8bbf\u95ee\u5ef6\u8fdf\u4f4e\u3002\u6240\u4ee5\uff0c\u5982\u679c\u4f7f\u7528\u673a\u68b0\u786c\u76d8\u4f5c\u4e3a Pika \u5e95\u5c42\u5b58\u50a8\u8bbe\u5907\u7684\u8bdd\uff0c\u7f13\u5b58\u7684\u8bbf\u95ee\u6027\u80fd\u5c31\u4f1a\u964d\u4f4e\u3002 \u6240\u4ee5\uff0c\u6211\u7684\u5efa\u8bae\u662f\uff0c\u5982\u679c\u4e1a\u52a1\u5e94\u7528\u9700\u8981\u7f13\u5b58\u5927\u5bb9\u91cf\u6570\u636e\uff0c \u4f46\u662f\u5bf9\u7f13\u5b58\u7684\u6027\u80fd\u8981\u6c42\u4e0d\u9ad8\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u673a\u68b0\u786c\u76d8\uff0c\u5426\u5219\u6700\u597d\u662f\u7528 SSD\u3002 \u95ee\u9898 \uff1aRedis \u5728\u6267\u884c Lua \u811a\u672c\u65f6\uff0c\u662f\u53ef\u4ee5\u4fdd\u8bc1\u539f\u5b50\u6027\u7684\uff0c\u90a3\u4e48\uff0c\u5728\u8bfe\u7a0b\u91cc\u4e3e\u7684 Lua \u811a\u672c\u4f8b\u5b50\uff08lua.script\uff09\u4e2d\uff0c\u4f60\u89c9\u5f97\u662f\u5426\u9700\u8981\u628a\u8bfb\u53d6\u5ba2\u6237\u7aef ip \u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u4e5f\u5c31\u662f GET(ip)\uff0c\u4ee5\u53ca\u5224\u65ad\u8bbf\u95ee\u6b21\u6570\u662f\u5426\u8d85\u8fc7 20 \u7684\u5224\u65ad\u903b\u8f91\uff0c\u4e5f\u52a0\u5230 Lua \u811a\u672c\u4e2d\u5417\uff1f\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a local current current = redis.call(\"incr\",KEYS[1]) if tonumber(current) == 1 then redis.call(\"expire\",KEYS[1],60) end \u7b54\u6848\uff1a\u5982\u679c\u4f7f\u7528\u8fd9\u4e2a\u65b9\u6cd5\u5b9e\u73b0\u52a0\u9501\u7684\u8bdd\uff0cSETNX \u548c EXPIRE \u4e24\u4e2a\u547d\u4ee4\u867d\u7136\u5206\u522b\u5b8c\u6210\u4e86\u5bf9\u9501\u53d8\u91cf\u8fdb\u884c\u539f\u5b50\u5224\u65ad\u548c\u503c\u8bbe\u7f6e\uff0c\u4ee5\u53ca\u8bbe\u7f6e\u9501\u53d8\u91cf\u7684\u8fc7\u671f\u65f6\u95f4\u7684\u64cd\u4f5c\uff0c\u4f46\u662f\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u4e00\u8d77\u6267\u884c\u65f6\uff0c\u5e76\u6ca1\u6709\u4fdd\u8bc1\u539f\u5b50\u6027\u3002 \u5982\u679c\u5728\u6267\u884c\u4e86 SETNX \u547d\u4ee4\u540e\uff0c\u5ba2\u6237\u7aef\u53d1\u751f\u4e86\u6545\u969c\uff0c\u4f46\u9501\u53d8\u91cf\u8fd8\u6ca1\u6709\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u5c31\u65e0\u6cd5\u5728\u5b9e\u4f8b\u4e0a\u91ca\u653e\u4e86\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u522b\u7684\u5ba2\u6237\u7aef\u65e0\u6cd5\u6267\u884c\u52a0\u9501\u64cd\u4f5c\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u4e0d\u80fd\u4f7f\u7528\u8fd9\u4e2a\u65b9\u6cd5\u8fdb\u884c\u52a0\u9501\u3002 \u95ee\u9898 \uff1a\u5728\u6267\u884c\u4e8b\u52a1\u65f6\uff0c\u5982\u679c Redis \u5b9e\u4f8b\u53d1\u751f\u6545\u969c\uff0c\u800c Redis \u4f7f\u7528\u7684\u662f RDB \u673a\u5236\uff0c\u90a3\u4e48\uff0c\u4e8b\u52a1\u7684\u539f\u5b50\u6027\u8fd8\u80fd\u5f97\u5230\u4fdd\u8bc1\u5417\uff1f \u7b54\u6848\uff1a \u5f53 Redis \u91c7\u7528 RDB \u673a\u5236\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\u65f6\uff0cRedis \u4f1a\u6309\u7167\u4e00\u5b9a\u7684\u5468\u671f\u6267\u884c\u5185\u5b58\u5feb\u7167\u3002 \u4e00\u4e2a\u4e8b\u52a1\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u4e8b\u52a1\u64cd\u4f5c\u5bf9\u6570\u636e\u6240\u505a\u7684\u4fee\u6539\u5e76\u4e0d\u4f1a\u5b9e\u65f6\u5730\u8bb0\u5f55\u5230 RDB \u4e2d\uff0c\u800c\u4e14\uff0cRedis \u4e5f\u4e0d\u4f1a\u521b\u5efa RDB \u5feb\u7167\u3002\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u6545\u969c\u53d1\u751f\u7684\u65f6\u673a\u4ee5\u53ca RDB \u662f\u5426\u751f\u6210\uff0c\u5206\u6210\u4e09\u79cd\u60c5\u51b5\u6765\u8ba8\u8bba\u4e8b\u52a1\u7684\u539f\u5b50\u6027\u4fdd\u8bc1\u3002 \u5047\u8bbe\u4e8b\u52a1\u5728\u6267\u884c\u5230\u4e00\u534a\u65f6\uff0c\u5b9e\u4f8b\u53d1\u751f\u4e86\u6545\u969c\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e0a\u4e00\u6b21 RDB \u5feb\u7167\u4e2d\u4e0d\u4f1a\u5305\u542b\u4e8b\u52a1\u6240\u505a\u7684\u4fee\u6539\uff0c\u800c\u4e0b\u4e00\u6b21 RDB \u5feb\u7167\u8fd8\u6ca1\u6709\u6267\u884c\u3002\u6240\u4ee5\uff0c\u5b9e\u4f8b\u6062\u590d\u540e\uff0c\u4e8b\u52a1\u4fee\u6539\u7684\u6570\u636e\u4f1a\u4e22\u5931\uff0c\u4e8b\u52a1\u7684\u539f\u5b50\u6027\u80fd\u5f97\u5230\u4fdd\u8bc1\u3002 \u5047\u8bbe\u4e8b\u52a1\u6267\u884c\u5b8c\u6210\u540e\uff0cRDB \u5feb\u7167\u5df2\u7ecf\u751f\u6210\u4e86\uff0c\u5982\u679c\u5b9e\u4f8b\u53d1\u751f\u4e86\u6545\u969c\uff0c\u4e8b\u52a1\u4fee\u6539\u7684\u6570\u636e\u53ef\u4ee5\u4ece RDB \u4e2d\u6062\u590d\uff0c\u4e8b\u52a1\u7684\u539f\u5b50\u6027\u4e5f\u5c31\u5f97\u5230\u4e86\u4fdd\u8bc1\u3002 \u5047\u8bbe\u4e8b\u52a1\u6267\u884c\u5df2\u7ecf\u5b8c\u6210\uff0c\u4f46\u662f RDB \u5feb\u7167\u8fd8\u6ca1\u6709\u751f\u6210\uff0c\u5982\u679c\u5b9e\u4f8b\u53d1\u751f\u4e86\u6545\u969c\uff0c\u90a3\u4e48\uff0c\u4e8b\u52a1\u4fee\u6539\u7684\u6570\u636e\u5c31\u4f1a\u5168\u90e8\u4e22\u5931\uff0c\u4e5f\u5c31\u8c08\u4e0d\u4e0a\u539f\u5b50\u6027\u4e86\u3002","title":"\u7b2c\u516d\u7ae0 Redis\u6027\u80fd\u4e0e\u9501\u673a\u5236\u4ee5\u53caACID\u603b\u7ed3"},{"location":"chap6/5redis_perf/#redisacid","text":"","title":"\u7b2c\u516d\u7ae0 Redis\u6027\u80fd\u4e0e\u9501\u673a\u5236\u4ee5\u53caACID"},{"location":"chap6/5redis_perf/#1","text":"","title":"1\u3001\u672c\u7ae0\u5c0f\u7ed3"},{"location":"chap6/5redis_perf/#1-1-ssdredispika","text":"\u8ddf Redis \u76f8\u6bd4\uff0cPika \u7684\u597d\u5904\u975e\u5e38\u660e\u663e\uff1a\u65e2\u652f\u6301 Redis \u64cd\u4f5c\u63a5\u53e3\uff0c\u53c8\u80fd\u652f\u6301\u4fdd\u5b58\u5927\u5bb9\u91cf\u7684\u6570\u636e\u3002 \u5982\u679c\u4f60\u539f\u6765\u5c31\u5728\u5e94\u7528 Redis\uff0c\u73b0\u5728\u60f3\u8fdb\u884c\u6269\u5bb9\uff0c\u90a3\u4e48\uff0cPika \u65e0\u7591\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\uff0c\u65e0\u8bba\u662f\u4ee3\u7801\u8fc1\u79fb\u8fd8\u662f\u8fd0\u7ef4\u7ba1\u7406\uff0cPika \u57fa\u672c\u4e0d\u9700\u8981\u989d\u5916\u7684\u5de5\u4f5c\u91cf\u3002 \u4e0d\u8fc7\uff0cPika \u6bd5\u7adf\u662f\u628a\u6570\u636e\u4fdd\u5b58\u5230\u4e86 SSD \u4e0a\uff0c\u6570\u636e\u8bbf\u95ee\u8981\u8bfb\u5199 SSD\uff0c\u6240\u4ee5\uff0c\u8bfb\u5199\u6027\u80fd\u8981\u5f31\u4e8e Redis\u3002\u9488\u5bf9\u8fd9\u4e00\u70b9\uff0c\u6211\u7ed9\u4f60\u63d0\u4f9b\u4e24\u4e2a\u964d\u4f4e\u8bfb\u5199 SSD \u5bf9 Pika \u7684\u6027\u80fd\u5f71\u54cd\u7684\u5c0f\u5efa\u8bae\uff1a \u5229\u7528 Pika \u7684\u591a\u7ebf\u7a0b\u6a21\u578b\uff0c\u589e\u52a0\u7ebf\u7a0b\u6570\u91cf\uff0c\u63d0\u5347 Pika \u7684\u5e76\u53d1\u8bf7\u6c42\u5904\u7406\u80fd\u529b\uff1b \u4e3a Pika \u914d\u7f6e\u9ad8\u914d\u7684 SSD\uff0c\u63d0\u5347 SSD \u81ea\u8eab\u7684\u8bbf\u95ee\u6027\u80fd\u3002 Pika \u672c\u8eab\u63d0\u4f9b\u4e86\u5f88\u591a\u5de5\u5177\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u628a Redis \u6570\u636e\u8fc1\u79fb\u5230 Pika\uff0c\u6216\u8005\u662f\u628a Redis \u8bf7\u6c42\u8f6c\u53d1\u7ed9 Pika\u3002\u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u4f7f\u7528 aof_to_pika \u547d\u4ee4\uff0c\u5e76\u4e14\u6307\u5b9a Redis \u7684 AOF \u6587\u4ef6\u4ee5\u53ca Pika \u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u5c31\u53ef\u4ee5\u628a Redis \u6570\u636e\u8fc1\u79fb\u5230 Pika \u4e2d\u4e86\uff0c\u5982\u4e0b\u6240\u793a\uff1a aof_to_pika -i [Redis AOF\u6587\u4ef6] -h [Pika IP] -p [Pika port] -a [\u8ba4\u8bc1\u4fe1\u606f] \u4f60\u90fd\u53ef\u4ee5\u76f4\u63a5\u5728 Pika \u7684 GitHub \u4e0a\u627e\u5230\u3002\u800c\u4e14\uff0cPika \u672c\u8eab\u4e5f\u8fd8\u5728\u8fed\u4ee3\u5f00\u53d1\u4e2d\uff0c\u6211\u4e5f\u5efa\u8bae\u4f60\u591a\u53bb\u770b\u770b GitHub\uff0c\u8fdb\u4e00\u6b65\u5730\u4e86\u89e3\u5b83\u3002 \u8fd9\u6837\uff0c\u4f60\u5c31\u53ef\u4ee5\u83b7\u5f97 Pika \u7684\u6700\u65b0\u8fdb\u5c55\uff0c\u4e5f\u80fd\u66f4\u597d\u5730\u628a\u5b83\u5e94\u7528\u5230\u4f60\u7684\u4e1a\u52a1\u5b9e\u8df5\u4e2d\u3002","title":"1-1 \u57fa\u4e8eSSD\u5b9e\u73b0\u5927\u5bb9\u91cfRedis:Pika"},{"location":"chap6/5redis_perf/#1-2-redis","text":"\u5728\u5e76\u53d1\u8bbf\u95ee\u65f6\uff0c\u5e76\u53d1\u7684 RMW \u64cd\u4f5c\u4f1a\u5bfc\u81f4\u6570\u636e\u9519\u8bef\uff0c\u6240\u4ee5\u9700\u8981\u8fdb\u884c\u5e76\u53d1\u63a7\u5236\u3002\u6240\u8c13\u5e76\u53d1\u63a7\u5236\uff0c\u5c31\u662f\u8981\u4fdd\u8bc1\u4e34\u754c\u533a\u4ee3\u7801\u7684\u4e92\u65a5\u6267\u884c\u3002 Redis \u63d0\u4f9b\u4e86\u4e24\u79cd\u539f\u5b50\u64cd\u4f5c\u7684\u65b9\u6cd5\u6765\u5b9e\u73b0\u5e76\u53d1\u63a7\u5236\uff0c\u5206\u522b\u662f\u5355\u547d\u4ee4\u64cd\u4f5c\u548c Lua \u811a\u672c\u3002 \u56e0\u4e3a\u539f\u5b50\u64cd\u4f5c\u672c\u8eab\u4e0d\u4f1a\u5bf9\u592a\u591a\u7684\u8d44\u6e90\u9650\u5236\u8bbf\u95ee\uff0c\u53ef\u4ee5\u7ef4\u6301\u8f83\u9ad8\u7684\u7cfb\u7edf\u5e76\u53d1\u6027\u80fd\u3002 \u4f46\u662f\uff0c\u5355\u547d\u4ee4\u539f\u5b50\u64cd\u4f5c\u7684\u9002\u7528\u8303\u56f4\u8f83\u5c0f\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u7684 RMW \u64cd\u4f5c\u90fd\u80fd\u8f6c\u53d8\u6210\u5355\u547d\u4ee4\u7684\u539f\u5b50\u64cd\u4f5c\uff08\u4f8b\u5982 INCR/DECR \u547d\u4ee4\u53ea\u80fd\u5728\u8bfb\u53d6\u6570\u636e\u540e\u505a\u539f\u5b50\u589e\u51cf\uff09\uff0c\u5f53\u6211\u4eec\u9700\u8981\u5bf9\u8bfb\u53d6\u7684\u6570\u636e\u505a\u66f4\u591a\u5224\u65ad\uff0c\u6216\u8005\u662f\u6211\u4eec\u5bf9\u6570\u636e\u7684\u4fee\u6539\u4e0d\u662f\u7b80\u5355\u7684\u589e\u51cf\u65f6\uff0c\u5355\u547d\u4ee4\u64cd\u4f5c\u5c31\u4e0d\u9002\u7528\u4e86\u3002 \u800c Redis \u7684 Lua \u811a\u672c\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u64cd\u4f5c\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u4f1a\u4ee5\u539f\u5b50\u6027\u7684\u65b9\u5f0f\u6267\u884c\uff0c\u7ed5\u5f00\u4e86\u5355\u547d\u4ee4\u64cd\u4f5c\u7684\u9650\u5236\u3002 \u4e0d\u8fc7\uff0c\u5982\u679c\u628a\u5f88\u591a\u64cd\u4f5c\u90fd\u653e\u5728 Lua \u811a\u672c\u4e2d\u539f\u5b50\u6267\u884c\uff0c\u4f1a\u5bfc\u81f4 Redis \u6267\u884c\u811a\u672c\u7684\u65f6\u95f4\u589e\u52a0\uff0c\u540c\u6837\u4e5f\u4f1a\u964d\u4f4e Redis \u7684\u5e76\u53d1\u6027\u80fd\u3002\u6240\u4ee5\uff0c\u6211\u7ed9\u4f60\u4e00\u4e2a\u5c0f\u5efa\u8bae\uff1a\u5728\u7f16\u5199 Lua \u811a\u672c\u65f6\uff0c\u4f60\u8981\u907f\u514d\u628a\u4e0d\u9700\u8981\u505a\u5e76\u53d1\u63a7\u5236\u7684\u64cd\u4f5c\u5199\u5165\u811a\u672c\u4e2d\u3002 \u5f53\u7136\uff0c\u52a0\u9501\u4e5f\u80fd\u5b9e\u73b0\u4e34\u754c\u533a\u4ee3\u7801\u7684\u4e92\u65a5\u6267\u884c\uff0c\u53ea\u662f\u5982\u679c\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u52a0\u9501\u65f6\uff0c\u5c31\u9700\u8981\u5206\u5e03\u5f0f\u9501\u7684\u652f\u6301\u4e86","title":"1-2 Redis\u5e94\u5bf9\u5e76\u53d1\u8bbf\u95ee\uff1a\u65e0\u9501\u7684\u539f\u5b50\u64cd\u4f5c"},{"location":"chap6/5redis_perf/#1-3-redis","text":"\u5206\u5e03\u5f0f\u9501\u662f\u7531\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u7ef4\u62a4\u7684\u53d8\u91cf\uff0c\u591a\u4e2a\u5ba2\u6237\u7aef\u53ef\u4ee5\u5411\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\u53d1\u9001\u547d\u4ee4\u8fdb\u884c\u52a0\u9501\u6216\u91ca\u653e\u9501\u64cd\u4f5c\u3002 Redis \u4f5c\u4e3a\u4e00\u4e2a\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\uff0c\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u3002 \u5728\u57fa\u4e8e\u5355\u4e2a Redis \u5b9e\u4f8b\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u65f6\uff0c\u5bf9\u4e8e\u52a0\u9501\u64cd\u4f5c\uff0c\u6211\u4eec\u9700\u8981\u6ee1\u8db3\u4e09\u4e2a\u6761\u4ef6\u3002 \u52a0\u9501\u5305\u62ec\u4e86 \u8bfb\u53d6\u9501\u53d8\u91cf\u3001\u68c0\u67e5\u9501\u53d8\u91cf\u503c\u548c\u8bbe\u7f6e\u9501\u53d8\u91cf\u503c \u4e09\u4e2a\u64cd\u4f5c\uff0c\u4f46\u9700\u8981\u4ee5\u539f\u5b50\u64cd\u4f5c\u7684\u65b9\u5f0f\u5b8c\u6210\uff0c\u6240\u4ee5 \uff0c\u6211\u4eec\u4f7f\u7528 SET \u547d\u4ee4\u5e26\u4e0a NX \u9009\u9879\u6765\u5b9e\u73b0\u52a0\u9501 \uff1b \u9501\u53d8\u91cf\u9700\u8981\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u514d\u5ba2\u6237\u7aef\u62ff\u5230\u9501\u540e\u53d1\u751f\u5f02\u5e38\uff0c\u5bfc\u81f4\u9501\u4e00\u76f4\u65e0\u6cd5\u91ca\u653e\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5728 SET \u547d\u4ee4\u6267\u884c\u65f6\u52a0\u4e0a EX/PX \u9009\u9879 \uff0c\u8bbe\u7f6e\u5176\u8fc7\u671f\u65f6\u95f4\uff1b \u9501\u53d8\u91cf\u7684\u503c\u9700\u8981\u80fd\u533a\u5206\u6765\u81ea\u4e0d\u540c\u5ba2\u6237\u7aef\u7684\u52a0\u9501\u64cd\u4f5c\uff0c\u4ee5\u514d\u5728\u91ca\u653e\u9501\u65f6\uff0c\u51fa\u73b0\u8bef\u91ca\u653e\u64cd\u4f5c\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u4f7f\u7528 SET \u547d\u4ee4\u8bbe\u7f6e\u9501\u53d8\u91cf\u503c\u65f6\uff0c\u6bcf\u4e2a\u5ba2\u6237\u7aef\u8bbe\u7f6e\u7684\u503c\u662f\u4e00\u4e2a\u552f\u4e00\u503c\uff0c\u7528\u4e8e\u6807\u8bc6\u5ba2\u6237\u7aef\u3002 \u548c\u52a0\u9501\u7c7b\u4f3c\uff0c\u91ca\u653e\u9501\u4e5f\u5305\u542b\u4e86\u8bfb\u53d6\u9501\u53d8\u91cf\u503c\u3001\u5224\u65ad\u9501\u53d8\u91cf\u503c\u548c\u5220\u9664\u9501\u53d8\u91cf\u4e09\u4e2a\u64cd\u4f5c\uff0c\u4e0d\u8fc7\uff0c\u6211\u4eec\u65e0\u6cd5\u4f7f\u7528\u5355\u4e2a\u547d\u4ee4\u6765\u5b9e\u73b0\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528 Lua \u811a\u672c\u6267\u884c\u91ca\u653e\u9501\u64cd\u4f5c\uff0c\u901a\u8fc7 Redis \u539f\u5b50\u6027\u5730\u6267\u884c Lua \u811a\u672c\uff0c\u6765\u4fdd\u8bc1\u91ca\u653e\u9501\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002 \u4e0d\u8fc7\uff0c\u57fa\u4e8e\u5355\u4e2a Redis \u5b9e\u4f8b\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u65f6\uff0c\u4f1a\u9762\u4e34\u5b9e\u4f8b\u5f02\u5e38\u6216\u5d29\u6e83\u7684\u60c5\u51b5\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u5b9e\u4f8b\u65e0\u6cd5\u63d0\u4f9b\u9501\u64cd\u4f5c\uff0c \u6b63\u56e0\u4e3a\u6b64\uff0cRedis \u4e5f\u63d0\u4f9b\u4e86 Redlock \u7b97\u6cd5\uff0c\u7528\u6765\u5b9e\u73b0\u57fa\u4e8e\u591a\u4e2a\u5b9e\u4f8b\u7684\u5206\u5e03\u5f0f\u9501 \u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u9501\u53d8\u91cf\u7531\u591a\u4e2a\u5b9e\u4f8b\u7ef4\u62a4\uff0c\u5373\u4f7f\u6709\u5b9e\u4f8b\u53d1\u751f\u4e86\u6545\u969c\uff0c\u9501\u53d8\u91cf\u4ecd\u7136\u662f\u5b58\u5728\u7684\uff0c\u5ba2\u6237\u7aef\u8fd8\u662f\u53ef\u4ee5\u5b8c\u6210\u9501\u64cd\u4f5c","title":"1-3 Redis\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501"},{"location":"chap6/5redis_perf/#1-4-redisacid","text":"Redis \u901a\u8fc7 MULTI\u3001EXEC\u3001DISCARD \u548c WATCH \u56db\u4e2a\u547d\u4ee4\u6765\u652f\u6301\u4e8b\u52a1\u673a\u5236\uff0c\u8fd9 4 \u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\uff0c\u603b\u7ed3\u5728\u4e0b\u9762\u7684\u8868\u4e2d\uff0c\u4f60\u53ef\u4ee5\u518d\u770b\u4e0b\u3002 Redis \u7684\u4e8b\u52a1\u673a\u5236\u53ef\u4ee5\u4fdd\u8bc1\u4e00\u81f4\u6027\u548c\u9694\u79bb\u6027\uff0c\u4f46\u662f\u65e0\u6cd5\u4fdd\u8bc1\u6301\u4e45\u6027\u3002\u4e0d\u8fc7\uff0c\u56e0\u4e3a Redis \u672c\u8eab\u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u6301\u4e45\u6027\u5e76\u4e0d\u662f\u4e00\u4e2a\u5fc5\u987b\u7684\u5c5e\u6027\uff0c\u6211\u4eec\u66f4\u52a0\u5173\u6ce8\u7684\u8fd8\u662f\u539f\u5b50\u6027\u3001\u4e00\u81f4\u6027\u548c\u9694\u79bb\u6027\u8fd9\u4e09\u4e2a\u5c5e\u6027\u3002 \u539f\u5b50\u6027\u7684\u60c5\u51b5\u6bd4\u8f83\u590d\u6742\uff0c \u53ea\u6709\u5f53\u4e8b\u52a1\u4e2d\u4f7f\u7528\u7684\u547d\u4ee4\u8bed\u6cd5\u6709\u8bef\u65f6\uff0c\u539f\u5b50\u6027\u5f97\u4e0d\u5230\u4fdd\u8bc1\uff0c\u5728\u5176\u5b83\u60c5\u51b5\u4e0b\uff0c\u4e8b\u52a1\u90fd\u53ef\u4ee5\u539f\u5b50\u6027\u6267\u884c\u3002 \u5c0f\u5efa\u8bae\uff1a\u4e25\u683c\u6309\u7167 Redis \u7684\u547d\u4ee4\u89c4\u8303\u8fdb\u884c\u7a0b\u5e8f\u5f00\u53d1\uff0c\u5e76\u4e14\u901a\u8fc7 code review \u786e\u4fdd\u547d\u4ee4\u7684\u6b63\u786e\u6027\u3002\u8fd9","title":"1-4 \u4e8b\u52a1\u673a\u5236 Redis\u5b9e\u73b0ACID\u5c5e\u6027"},{"location":"chap6/5redis_perf/#2","text":"Redis \u63d0\u4f9b\u4e86 INCR/DECR \u547d\u4ee4\uff0c\u628a\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u8f6c\u53d8\u4e3a\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\u4e86 \u3002 INCR/DECR \u547d\u4ee4\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u589e\u503c / \u51cf\u503c\u64cd\u4f5c\uff0c\u800c\u4e14\u5b83\u4eec\u672c\u8eab\u5c31\u662f\u5355\u4e2a\u547d\u4ee4\u64cd\u4f5c\uff0cRedis \u5728\u6267\u884c\u5b83\u4eec\u65f6\uff0c\u672c\u8eab\u5c31\u5177\u6709\u4e92\u65a5\u6027 \u6bd4\u5982\u8bf4\uff0c\u5728\u521a\u624d\u7684\u5e93\u5b58\u6263\u51cf\u4f8b\u5b50\u4e2d\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u76f4\u63a5\u5b8c\u6210\u5bf9\u5546\u54c1 id \u7684\u5e93\u5b58\u503c\u51cf 1 \u64cd\u4f5c\u3002 \u5373\u4f7f\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u6267\u884c\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u4e5f\u4e0d\u7528\u62c5\u5fc3\u51fa\u73b0\u5e93\u5b58\u503c\u6263\u51cf\u9519\u8bef\u7684\u95ee\u9898 \u3002 DECR id Lua \u811a\u672c\uff0c \u4e0b\u9762\u7684\u8fd9\u6bb5\u4ee3\u7801\uff0c\u5b83\u5b9e\u73b0\u4e86\u5bf9\u5ba2\u6237\u7aef\u6bcf\u5206\u949f\u8bbf\u95ee\u6b21\u6570\u4e0d\u8d85\u8fc7 20 \u6b21\u7684\u9650\u5236\u3002 //\u83b7\u53d6ip\u5bf9\u5e94\u7684\u8bbf\u95ee\u6b21\u6570 current = GET(ip) //\u5982\u679c\u8d85\u8fc7\u8bbf\u95ee\u6b21\u6570\u8d85\u8fc720\u6b21\uff0c\u5219\u62a5\u9519 IF current != NULL AND current > 20 THEN ERROR \"exceed 20 accesses per second\" ELSE //\u5982\u679c\u8bbf\u95ee\u6b21\u6570\u4e0d\u8db320\u6b21\uff0c\u589e\u52a0\u4e00\u6b21\u8bbf\u95ee\u8ba1\u6570 value = INCR(ip) //\u5982\u679c\u662f\u7b2c\u4e00\u6b21\u8bbf\u95ee\uff0c\u5c06\u952e\u503c\u5bf9\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a60s\u540e IF value == 1 THEN EXPIRE(ip,60) END //\u6267\u884c\u5176\u4ed6\u64cd\u4f5c DO THINGS END \u4f7f\u7528 Lua \u811a\u672c\u6765\u4fdd\u8bc1\u5e76\u53d1\u63a7\u5236\u3002 \u6211\u4eec\u53ef\u4ee5\u628a\u8bbf\u95ee\u6b21\u6570\u52a0 1 \u5224\u65ad\u8bbf\u95ee\u6b21\u6570\u662f\u5426\u4e3a 1 \u4ee5\u53ca\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u5199\u5165\u4e00\u4e2a Lua \u811a\u672c \u5982\u4e0b\u6240\u793a\uff1a local current current = redis.call(\"incr\",KEYS[1]) if tonumber(current) == 1 then redis.call(\"expire\",KEYS[1],60) end \u7f16\u5199\u7684\u811a\u672c\u540d\u79f0\u4e3a lua.script \uff0c\u6211\u4eec\u63a5\u7740\u5c31\u53ef\u4ee5\u4f7f\u7528 Redis \u5ba2\u6237\u7aef\uff0c\u5e26\u4e0a eval \u9009\u9879\uff0c\u6765\u6267\u884c\u8be5\u811a\u672c\u3002\u811a\u672c\u6240\u9700\u7684\u53c2\u6570\u5c06\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u4e2d\u7684 keys \u548c args \u8fdb\u884c\u4f20\u9012\u3002 redis-cli --eval lua.script keys , args \u8fd9\u6837\u4e00\u6765\uff0c\u8bbf\u95ee\u6b21\u6570\u52a0 1\u3001\u5224\u65ad\u8bbf\u95ee\u6b21\u6570\u662f\u5426\u4e3a 1\uff0c\u4ee5\u53ca\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u5c31\u53ef\u4ee5\u539f\u5b50\u6027\u5730\u6267\u884c\u4e86\u3002\u5373\u4f7f\u5ba2\u6237\u7aef\u6709\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u6267\u884c\u8fd9\u4e2a\u811a\u672c\uff0cRedis \u4e5f\u4f1a\u4f9d\u6b21\u4e32\u884c\u6267\u884c\u811a\u672c\u4ee3\u7801\uff0c\u907f\u514d\u4e86\u5e76\u53d1\u64cd\u4f5c\u5e26\u6765\u7684\u6570\u636e\u9519\u8bef\u3002 Redis\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501 \u5982\u679c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0ckey \u4e0d\u5b58\u5728\uff0c\u90a3\u4e48 key \u4f1a\u88ab\u521b\u5efa\uff0c\u5e76\u4e14\u503c\u4f1a\u88ab\u8bbe\u7f6e\u4e3a value\uff1b\u5982\u679c key \u5df2\u7ecf\u5b58\u5728\uff0cSETNX \u4e0d\u505a\u4efb\u4f55\u8d4b\u503c\u64cd\u4f5c \u3002 SETNX key value \u53ef\u4ee5\u7528 SETNX \u548c DEL \u547d\u4ee4\u7ec4\u5408\u6765\u5b9e\u73b0\u52a0\u9501\u548c\u91ca\u653e\u9501\u64cd\u4f5c \u3002\u4e0b\u9762\u7684\u4f2a\u4ee3\u7801\u793a\u4f8b\u663e\u793a\u4e86\u9501\u64cd\u4f5c\u7684\u8fc7\u7a0b\uff0c\u4f60\u53ef\u4ee5\u770b\u4e0b\u3002 // \u52a0\u9501 SETNX lock_key 1 // \u4e1a\u52a1\u903b\u8f91 DO THINGS // \u91ca\u653e\u9501 DEL lock_key \u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0c\u53ea\u6709 key \u4e0d\u5b58\u5728\u65f6\uff0cSET \u624d\u4f1a\u521b\u5efa key\uff0c\u5e76\u5bf9 key \u8fdb\u884c\u8d4b\u503c\u3002\u53e6\u5916\uff0c key \u7684\u5b58\u6d3b\u65f6\u95f4\u7531 seconds \u6216\u8005 milliseconds \u9009\u9879\u503c\u6765\u51b3\u5b9a\u3002 SET key value [EX seconds | PX milliseconds] [NX] \u6709\u4e86 SET \u547d\u4ee4\u7684 NX \u548c EX/PX \u9009\u9879\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6765\u5b9e\u73b0\u52a0\u9501\u64cd\u4f5c\u4e86\u3002 // \u52a0\u9501, unique_value\u4f5c\u4e3a\u5ba2\u6237\u7aef\u552f\u4e00\u6027\u7684\u6807\u8bc6 SET lock_key unique_value NX PX 10000 \u5176\u4e2d\uff0c unique_value \u662f\u5ba2\u6237\u7aef\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u53ef\u4ee5\u7528\u4e00\u4e2a\u968f\u673a\u751f\u6210\u7684\u5b57\u7b26\u4e32\u6765\u8868\u793a\uff0c PX 10000 \u5219\u8868\u793a lock_key \u4f1a\u5728 10s \u540e\u8fc7\u671f\uff0c\u4ee5\u514d\u5ba2\u6237\u7aef\u5728\u8fd9\u671f\u95f4\u53d1\u751f\u5f02\u5e38\u800c\u65e0\u6cd5\u91ca\u653e\u9501\u3002 \u56e0\u4e3a\u5728\u52a0\u9501\u64cd\u4f5c\u4e2d\uff0c\u6bcf\u4e2a\u5ba2\u6237\u7aef\u90fd\u4f7f\u7528\u4e86\u4e00\u4e2a\u552f\u4e00\u6807\u8bc6\uff0c\u6240\u4ee5\u5728\u91ca\u653e\u9501\u64cd\u4f5c\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5224\u65ad\u9501\u53d8\u91cf\u7684\u503c\uff0c\u662f\u5426\u7b49\u4e8e\u6267\u884c\u91ca\u653e\u9501\u64cd\u4f5c\u7684\u5ba2\u6237\u7aef\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u5982\u4e0b\u6240\u793a\uff1a //\u91ca\u653e\u9501 \u6bd4\u8f83unique_value\u662f\u5426\u76f8\u7b49\uff0c\u907f\u514d\u8bef\u91ca\u653e if redis.call(\"get\",KEYS[1]) == ARGV[1] then return redis.call(\"del\",KEYS[1]) else return 0 end \u8fd9\u662f\u4f7f\u7528 Lua \u811a\u672c\uff08 unlock.script \uff09\u5b9e\u73b0\u7684\u91ca\u653e\u9501\u64cd\u4f5c\u7684\u4f2a\u4ee3\u7801\uff0c\u5176\u4e2d\uff0c KEYS[1] \u8868\u793a lock_key \uff0c ARGV[1] \u662f\u5f53\u524d\u5ba2\u6237\u7aef\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u8fd9\u4e24\u4e2a\u503c\u90fd\u662f\u6211\u4eec\u5728\u6267\u884c Lua \u811a\u672c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u7684\u3002 \u6700\u540e\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u9501\u91ca\u653e\u64cd\u4f5c\u4e86\u3002 redis-cli --eval unlock.script lock_key , unique_value \u4e8b\u52a1\u673a\u5236 Redis\u5b9e\u73b0ACID\u5c5e\u6027 \u4f7f\u7528 MULTI \u548c EXEC \u6267\u884c\u4e00\u4e2a\u4e8b\u52a1\u7684\u8fc7\u7a0b #\u5f00\u542f\u4e8b\u52a1 127.0.0.1:6379> MULTI OK #\u5c06a:stock\u51cf1\uff0c 127.0.0.1:6379> DECR a:stock QUEUED #\u5c06b:stock\u51cf1 127.0.0.1:6379> DECR b:stock QUEUED #\u5b9e\u9645\u6267\u884c\u4e8b\u52a1 127.0.0.1:6379> EXEC 1) (integer) 4 2) (integer) 9 \u5047\u8bbe a:stock \u3001 b:stock \u4e24\u4e2a\u952e\u7684\u521d\u59cb\u503c\u662f 5 \u548c 10\u3002 \u5728 MULTI \u547d\u4ee4\u540e\u6267\u884c\u7684\u4e24\u4e2a DECR \u547d\u4ee4\uff0c\u662f\u628a a:stock \u3001 b:stock \u4e24\u4e2a\u952e\u7684\u503c\u5206\u522b\u51cf 1\uff0c\u5b83\u4eec\u6267\u884c\u540e\u7684\u8fd4\u56de\u7ed3\u679c\u90fd\u662f QUEUED \uff0c\u8fd9\u5c31\u8868\u793a\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u88ab\u6682\u5b58\u5230\u4e86\u547d\u4ee4\u961f\u5217\uff0c\u8fd8\u6ca1\u6709\u5b9e\u9645\u6267\u884c\u3002 \u7b49\u5230\u6267\u884c\u4e86 EXEC \u547d\u4ee4\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u8fd4\u56de\u4e86 4\u30019\uff0c\u8fd9\u5c31\u8868\u660e\uff0c\u4e24\u4e2a DECR \u547d\u4ee4\u5df2\u7ecf\u6210\u529f\u5730\u6267\u884c\u4e86\u3002 #\u5f00\u542f\u4e8b\u52a1 127.0.0.1:6379> MULTI OK #\u53d1\u9001\u4e8b\u52a1\u4e2d\u7684\u7b2c\u4e00\u4e2a\u64cd\u4f5c\uff0c\u4f46\u662fRedis\u4e0d\u652f\u6301\u8be5\u547d\u4ee4\uff0c\u8fd4\u56de\u62a5\u9519\u4fe1\u606f 127.0.0.1:6379> PUT a:stock 5 (error) ERR unknown command `PUT`, with args beginning with: `a:stock`, `5`, #\u53d1\u9001\u4e8b\u52a1\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u662f\u6b63\u786e\u7684\u547d\u4ee4\uff0cRedis\u628a\u8be5\u547d\u4ee4\u5165\u961f 127.0.0.1:6379> DECR b:stock QUEUED #\u5b9e\u9645\u6267\u884c\u4e8b\u52a1\uff0c\u4f46\u662f\u4e4b\u524d\u547d\u4ee4\u6709\u9519\u8bef\uff0c\u6240\u4ee5Redis\u62d2\u7edd\u6267\u884c 127.0.0.1:6379> EXEC (error) EXECABORT Transaction discarded because of previous errors. \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c \u4e8b\u52a1\u91cc\u5305\u542b\u4e86\u4e00\u4e2a Redis \u672c\u8eab\u5c31\u4e0d\u652f\u6301\u7684 PUT \u547d\u4ee4\uff0c\u6240\u4ee5\uff0c\u5728 PUT \u547d\u4ee4\u5165\u961f\u65f6\uff0cRedis \u5c31\u62a5\u9519\u4e86 \u3002 \u867d\u7136\uff0c\u4e8b\u52a1\u91cc\u8fd8\u6709\u4e00\u4e2a\u6b63\u786e\u7684 DECR \u547d\u4ee4\uff0c\u4f46\u662f\uff0c\u5728\u6700\u540e\u6267\u884c EXEC \u547d\u4ee4\u540e\uff0c\u6574\u4e2a\u4e8b\u52a1\u88ab\u653e\u5f03\u6267\u884c\u4e86\u3002 \u4e8b\u52a1\u4e2d\u7684 LPOP \u547d\u4ee4\u5bf9 String \u7c7b\u578b\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\uff0c\u5165\u961f\u65f6\u6ca1\u6709\u62a5\u9519\uff0c\u4f46\u662f\uff0c\u5728 EXEC \u6267\u884c\u65f6\u62a5\u9519\u4e86\u3002LPOP \u547d\u4ee4\u672c\u8eab\u6ca1\u6709\u6267\u884c\u6210\u529f\uff0c\u4f46\u662f\u4e8b\u52a1\u4e2d\u7684 DECR \u547d\u4ee4\u5374\u6210\u529f\u6267\u884c\u4e86\u3002 #\u5f00\u542f\u4e8b\u52a1 127.0.0.1:6379> MULTI OK #\u53d1\u9001\u4e8b\u52a1\u4e2d\u7684\u7b2c\u4e00\u4e2a\u64cd\u4f5c\uff0cLPOP\u547d\u4ee4\u64cd\u4f5c\u7684\u6570\u636e\u7c7b\u578b\u4e0d\u5339\u914d\uff0c\u6b64\u65f6\u5e76\u4e0d\u62a5\u9519 127.0.0.1:6379> LPOP a:stock QUEUED #\u53d1\u9001\u4e8b\u52a1\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u64cd\u4f5c 127.0.0.1:6379> DECR b:stock QUEUED #\u5b9e\u9645\u6267\u884c\u4e8b\u52a1\uff0c\u4e8b\u52a1\u7b2c\u4e00\u4e2a\u64cd\u4f5c\u6267\u884c\u62a5\u9519 127.0.0.1:6379> EXEC 1) (error) WRONGTYPE Operation against a key holding the wrong kind of value 2) (integer) 8 Redis \u4e2d\u5e76\u6ca1\u6709\u63d0\u4f9b\u56de\u6eda\u673a\u5236\u3002 \u867d\u7136 Redis \u63d0\u4f9b\u4e86 DISCARD \u547d\u4ee4\uff0c\u4f46\u662f\uff0c\u8fd9\u4e2a\u547d\u4ee4\u53ea\u80fd\u7528\u6765\u4e3b\u52a8\u653e\u5f03\u4e8b\u52a1\u6267\u884c\uff0c\u628a\u6682\u5b58\u7684\u547d\u4ee4\u961f\u5217\u6e05\u7a7a\uff0c\u8d77\u4e0d\u5230\u56de\u6eda\u7684\u6548\u679c\u3002 #\u8bfb\u53d6a:stock\u7684\u503c4 127.0.0.1:6379> GET a:stock \"4\" #\u5f00\u542f\u4e8b\u52a1 127.0.0.1:6379> MULTI OK #\u53d1\u9001\u4e8b\u52a1\u7684\u7b2c\u4e00\u4e2a\u64cd\u4f5c\uff0c\u5bf9a:stock\u51cf1 127.0.0.1:6379> DECR a:stock QUEUED #\u6267\u884cDISCARD\u547d\u4ee4\uff0c\u4e3b\u52a8\u653e\u5f03\u4e8b\u52a1 127.0.0.1:6379> DISCARD OK #\u518d\u6b21\u8bfb\u53d6a:stock\u7684\u503c\uff0c\u503c\u6ca1\u6709\u88ab\u4fee\u6539 127.0.0.1:6379> GET a:stock \"4\" \u4f8b\u5b50\u4e2d\uff0ca:stock \u952e\u7684\u503c\u4e00\u5f00\u59cb\u4e3a 4\uff0c\u7136\u540e\uff0c\u6211\u4eec\u6267\u884c\u4e00\u4e2a\u4e8b\u52a1\uff0c\u60f3\u5bf9 a:stock \u7684\u503c\u51cf 1\u3002\u4f46\u662f\uff0c\u5728\u4e8b\u52a1\u7684\u6700\u540e\uff0c\u6211\u4eec\u6267\u884c\u7684\u662f DISCARD \u547d\u4ee4\uff0c\u6240\u4ee5\u4e8b\u52a1\u5c31\u88ab\u653e\u5f03\u4e86\u3002\u6211\u4eec\u518d\u6b21\u67e5\u770b a:stock \u7684\u503c\uff0c\u4f1a\u53d1\u73b0\u4ecd\u7136\u4e3a 4\u3002","title":"2\u3001\u672c\u7ae0\u64cd\u4f5c\u603b\u7ed3"},{"location":"chap6/5redis_perf/#3","text":"\u95ee\u9898 \uff1a\u4ecb\u7ecd\u7684\u662f\u4f7f\u7528 SSD \u4f5c\u4e3a\u5185\u5b58\u5bb9\u91cf\u7684\u6269\u5c55\uff0c\u589e\u52a0 Redis \u5b9e\u4f8b\u7684\u6570\u636e\u4fdd\u5b58\u91cf\uff0c\u53ef\u4ee5\u4f7f\u7528\u673a\u68b0\u786c\u76d8\u6765\u4f5c\u4e3a\u5b9e\u4f8b\u5bb9\u91cf\u6269\u5c55\u5417\uff1f\u6709\u4ec0\u4e48\u597d\u5904\u6216\u4e0d\u8db3\u5417\uff1f \u4ece\u5bb9\u91cf\u7ef4\u5ea6\u6765\u770b\uff0c\u673a\u68b0\u786c\u76d8\u7684\u6027\u4ef7\u6bd4\u66f4\u9ad8\uff0c\u673a\u68b0\u786c\u76d8\u6bcf GB \u7684\u6210\u672c\u5927\u7ea6\u5728 0.1 \u5143\u5de6\u53f3\uff0c\u800c SSD \u6bcf GB \u7684\u6210\u672c\u5927\u7ea6\u662f 0.4~0.6 \u5143\u5de6\u53f3\u3002 \u4ece\u6027\u80fd\u89d2\u5ea6\u6765\u770b\uff0c\u673a\u68b0\u786c\u76d8\uff08\u4f8b\u5982 SAS \u76d8\uff09\u7684\u5ef6\u8fdf\u5927\u7ea6\u5728 3~5ms\uff0c\u800c\u4f01\u4e1a\u7ea7 SSD \u7684\u8bfb\u5ef6\u8fdf\u5927\u7ea6\u662f 60~80us\uff0c\u5199\u5ef6\u8fdf\u5728 20us\u3002\u7f13\u5b58\u7684\u8d1f\u8f7d\u7279\u5f81\u4e00\u822c\u662f\u5c0f\u7c92\u5ea6\u6570\u636e\u3001\u9ad8\u5e76\u53d1\u8bf7\u6c42\uff0c\u8981\u6c42\u8bbf\u95ee\u5ef6\u8fdf\u4f4e\u3002\u6240\u4ee5\uff0c\u5982\u679c\u4f7f\u7528\u673a\u68b0\u786c\u76d8\u4f5c\u4e3a Pika \u5e95\u5c42\u5b58\u50a8\u8bbe\u5907\u7684\u8bdd\uff0c\u7f13\u5b58\u7684\u8bbf\u95ee\u6027\u80fd\u5c31\u4f1a\u964d\u4f4e\u3002 \u6240\u4ee5\uff0c\u6211\u7684\u5efa\u8bae\u662f\uff0c\u5982\u679c\u4e1a\u52a1\u5e94\u7528\u9700\u8981\u7f13\u5b58\u5927\u5bb9\u91cf\u6570\u636e\uff0c \u4f46\u662f\u5bf9\u7f13\u5b58\u7684\u6027\u80fd\u8981\u6c42\u4e0d\u9ad8\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u673a\u68b0\u786c\u76d8\uff0c\u5426\u5219\u6700\u597d\u662f\u7528 SSD\u3002 \u95ee\u9898 \uff1aRedis \u5728\u6267\u884c Lua \u811a\u672c\u65f6\uff0c\u662f\u53ef\u4ee5\u4fdd\u8bc1\u539f\u5b50\u6027\u7684\uff0c\u90a3\u4e48\uff0c\u5728\u8bfe\u7a0b\u91cc\u4e3e\u7684 Lua \u811a\u672c\u4f8b\u5b50\uff08lua.script\uff09\u4e2d\uff0c\u4f60\u89c9\u5f97\u662f\u5426\u9700\u8981\u628a\u8bfb\u53d6\u5ba2\u6237\u7aef ip \u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u4e5f\u5c31\u662f GET(ip)\uff0c\u4ee5\u53ca\u5224\u65ad\u8bbf\u95ee\u6b21\u6570\u662f\u5426\u8d85\u8fc7 20 \u7684\u5224\u65ad\u903b\u8f91\uff0c\u4e5f\u52a0\u5230 Lua \u811a\u672c\u4e2d\u5417\uff1f\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a local current current = redis.call(\"incr\",KEYS[1]) if tonumber(current) == 1 then redis.call(\"expire\",KEYS[1],60) end \u7b54\u6848\uff1a\u5982\u679c\u4f7f\u7528\u8fd9\u4e2a\u65b9\u6cd5\u5b9e\u73b0\u52a0\u9501\u7684\u8bdd\uff0cSETNX \u548c EXPIRE \u4e24\u4e2a\u547d\u4ee4\u867d\u7136\u5206\u522b\u5b8c\u6210\u4e86\u5bf9\u9501\u53d8\u91cf\u8fdb\u884c\u539f\u5b50\u5224\u65ad\u548c\u503c\u8bbe\u7f6e\uff0c\u4ee5\u53ca\u8bbe\u7f6e\u9501\u53d8\u91cf\u7684\u8fc7\u671f\u65f6\u95f4\u7684\u64cd\u4f5c\uff0c\u4f46\u662f\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u4e00\u8d77\u6267\u884c\u65f6\uff0c\u5e76\u6ca1\u6709\u4fdd\u8bc1\u539f\u5b50\u6027\u3002 \u5982\u679c\u5728\u6267\u884c\u4e86 SETNX \u547d\u4ee4\u540e\uff0c\u5ba2\u6237\u7aef\u53d1\u751f\u4e86\u6545\u969c\uff0c\u4f46\u9501\u53d8\u91cf\u8fd8\u6ca1\u6709\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u5c31\u65e0\u6cd5\u5728\u5b9e\u4f8b\u4e0a\u91ca\u653e\u4e86\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u522b\u7684\u5ba2\u6237\u7aef\u65e0\u6cd5\u6267\u884c\u52a0\u9501\u64cd\u4f5c\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u4e0d\u80fd\u4f7f\u7528\u8fd9\u4e2a\u65b9\u6cd5\u8fdb\u884c\u52a0\u9501\u3002 \u95ee\u9898 \uff1a\u5728\u6267\u884c\u4e8b\u52a1\u65f6\uff0c\u5982\u679c Redis \u5b9e\u4f8b\u53d1\u751f\u6545\u969c\uff0c\u800c Redis \u4f7f\u7528\u7684\u662f RDB \u673a\u5236\uff0c\u90a3\u4e48\uff0c\u4e8b\u52a1\u7684\u539f\u5b50\u6027\u8fd8\u80fd\u5f97\u5230\u4fdd\u8bc1\u5417\uff1f \u7b54\u6848\uff1a \u5f53 Redis \u91c7\u7528 RDB \u673a\u5236\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\u65f6\uff0cRedis \u4f1a\u6309\u7167\u4e00\u5b9a\u7684\u5468\u671f\u6267\u884c\u5185\u5b58\u5feb\u7167\u3002 \u4e00\u4e2a\u4e8b\u52a1\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u4e8b\u52a1\u64cd\u4f5c\u5bf9\u6570\u636e\u6240\u505a\u7684\u4fee\u6539\u5e76\u4e0d\u4f1a\u5b9e\u65f6\u5730\u8bb0\u5f55\u5230 RDB \u4e2d\uff0c\u800c\u4e14\uff0cRedis \u4e5f\u4e0d\u4f1a\u521b\u5efa RDB \u5feb\u7167\u3002\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u6545\u969c\u53d1\u751f\u7684\u65f6\u673a\u4ee5\u53ca RDB \u662f\u5426\u751f\u6210\uff0c\u5206\u6210\u4e09\u79cd\u60c5\u51b5\u6765\u8ba8\u8bba\u4e8b\u52a1\u7684\u539f\u5b50\u6027\u4fdd\u8bc1\u3002 \u5047\u8bbe\u4e8b\u52a1\u5728\u6267\u884c\u5230\u4e00\u534a\u65f6\uff0c\u5b9e\u4f8b\u53d1\u751f\u4e86\u6545\u969c\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e0a\u4e00\u6b21 RDB \u5feb\u7167\u4e2d\u4e0d\u4f1a\u5305\u542b\u4e8b\u52a1\u6240\u505a\u7684\u4fee\u6539\uff0c\u800c\u4e0b\u4e00\u6b21 RDB \u5feb\u7167\u8fd8\u6ca1\u6709\u6267\u884c\u3002\u6240\u4ee5\uff0c\u5b9e\u4f8b\u6062\u590d\u540e\uff0c\u4e8b\u52a1\u4fee\u6539\u7684\u6570\u636e\u4f1a\u4e22\u5931\uff0c\u4e8b\u52a1\u7684\u539f\u5b50\u6027\u80fd\u5f97\u5230\u4fdd\u8bc1\u3002 \u5047\u8bbe\u4e8b\u52a1\u6267\u884c\u5b8c\u6210\u540e\uff0cRDB \u5feb\u7167\u5df2\u7ecf\u751f\u6210\u4e86\uff0c\u5982\u679c\u5b9e\u4f8b\u53d1\u751f\u4e86\u6545\u969c\uff0c\u4e8b\u52a1\u4fee\u6539\u7684\u6570\u636e\u53ef\u4ee5\u4ece RDB \u4e2d\u6062\u590d\uff0c\u4e8b\u52a1\u7684\u539f\u5b50\u6027\u4e5f\u5c31\u5f97\u5230\u4e86\u4fdd\u8bc1\u3002 \u5047\u8bbe\u4e8b\u52a1\u6267\u884c\u5df2\u7ecf\u5b8c\u6210\uff0c\u4f46\u662f RDB \u5feb\u7167\u8fd8\u6ca1\u6709\u751f\u6210\uff0c\u5982\u679c\u5b9e\u4f8b\u53d1\u751f\u4e86\u6545\u969c\uff0c\u90a3\u4e48\uff0c\u4e8b\u52a1\u4fee\u6539\u7684\u6570\u636e\u5c31\u4f1a\u5168\u90e8\u4e22\u5931\uff0c\u4e5f\u5c31\u8c08\u4e0d\u4e0a\u539f\u5b50\u6027\u4e86\u3002","title":"3\u3001\u672c\u7ae0\u95ee\u9898"},{"location":"chap7/1Redis_master_slave/","text":"\u7b2c\u4e00\u8282 Redis\u4e3b\u4ece\u540c\u6b65\u4e0e\u6545\u969c\u5207\u6362\u7684\u4e09\u4e2a\u5751 Redis \u7684\u4e3b\u4ece\u540c\u6b65\u673a\u5236\u4e0d\u4ec5\u53ef\u4ee5\u8ba9\u4ece\u5e93\u670d\u52a1\u66f4\u591a\u7684\u8bfb\u8bf7\u6c42\uff0c\u5206\u62c5\u4e3b\u5e93\u7684\u538b\u529b\uff0c\u800c\u4e14\u8fd8\u80fd\u5728\u4e3b\u5e93\u53d1\u751f\u6545\u969c\u65f6\uff0c\u8fdb\u884c\u4e3b\u4ece\u5e93\u5207\u6362\uff0c\u63d0\u4f9b\u9ad8\u53ef\u9760\u670d\u52a1\u3002 \u4ecb\u7ecd 3 \u4e2a\u5751\uff0c\u5206\u522b\u662f\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\u3001\u8bfb\u5230\u8fc7\u671f\u6570\u636e\uff0c\u4ee5\u53ca\u914d\u7f6e\u9879\u8bbe\u7f6e\u5f97\u4e0d\u5408\u7406\u4ece\u800c\u5bfc\u81f4\u670d\u52a1\u6302\u6389\u3002 1\u3001\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4 1-1 \u9020\u6210\u56e0\u7d20 \u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u5c31\u662f\u6307\u5ba2\u6237\u7aef\u4ece\u4ece\u5e93\u4e2d\u8bfb\u53d6\u5230\u7684\u503c\u548c\u4e3b\u5e93\u4e2d\u7684\u6700\u65b0\u503c\u5e76\u4e0d\u4e00\u81f4\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4e3b\u4ece\u5e93\u4e4b\u524d\u4fdd\u5b58\u7684\u7528\u6237\u5e74\u9f84\u503c\u662f 19\uff0c\u4f46\u662f\u4e3b\u5e93\u63a5\u6536\u5230\u4e86\u4fee\u6539\u547d\u4ee4\uff0c\u5df2\u7ecf\u628a\u8fd9\u4e2a\u6570\u636e\u66f4\u65b0\u4e3a 20 \u4e86\uff0c\u4f46\u662f\uff0c\u4ece\u5e93\u4e2d\u7684\u503c\u4ecd\u7136\u662f 19\u3002\u90a3\u4e48\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u4ece\u4ece\u5e93\u4e2d\u8bfb\u53d6\u7528\u6237\u5e74\u9f84\u503c\uff0c\u5c31\u4f1a\u8bfb\u5230\u65e7\u503c\u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u5728\u4e3b\u4ece\u5e93\u547d\u4ee4\u4f20\u64ad\u9636\u6bb5\uff0c\u4e3b\u5e93\u6536\u5230\u65b0\u7684\u5199\u547d\u4ee4\u540e\uff0c\u4f1a\u53d1\u9001\u7ed9\u4ece\u5e93\u3002 \u4f46\u662f\uff0c\u4e3b\u5e93\u5e76\u4e0d\u4f1a\u7b49\u5230\u4ece\u5e93\u5b9e\u9645\u6267\u884c\u5b8c\u547d\u4ee4\u540e\uff0c\u518d\u628a\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u800c\u662f\u4e3b\u5e93\u81ea\u5df1\u5728\u672c\u5730\u6267\u884c\u5b8c\u547d\u4ee4\u540e\uff0c\u5c31\u4f1a\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u7ed3\u679c\u4e86\u3002 \u5982\u679c\u4ece\u5e93\u8fd8\u6ca1\u6709\u6267\u884c\u4e3b\u5e93\u540c\u6b65\u8fc7\u6765\u7684\u547d\u4ee4\uff0c\u4e3b\u4ece\u5e93\u95f4\u7684\u6570\u636e\u5c31\u4e0d\u4e00\u81f4\u4e86\u3002 \u4ece\u5e93\u4f1a\u6ede\u540e\u6267\u884c\u540c\u6b65\u547d\u4ee4\u5462\uff1f\u5176\u5b9e\uff0c\u8fd9\u91cc\u4e3b\u8981\u6709\u4e24\u4e2a\u539f\u56e0\u3002 \u4e3b\u4ece\u5e93\u95f4\u7684\u7f51\u7edc\u53ef\u80fd\u4f1a\u6709\u4f20\u8f93\u5ef6\u8fdf \uff0c\u6240\u4ee5\u4ece\u5e93\u4e0d\u80fd\u53ca\u65f6\u5730\u6536\u5230\u4e3b\u5e93\u53d1\u9001\u7684\u547d\u4ee4\uff0c\u4ece\u5e93\u4e0a\u6267\u884c\u540c\u6b65\u547d\u4ee4\u7684\u65f6\u95f4\u5c31\u4f1a\u88ab\u5ef6\u540e\u3002 \u5373\u4f7f\u4ece\u5e93\u53ca\u65f6\u6536\u5230\u4e86\u4e3b\u5e93\u7684\u547d\u4ee4\uff0c\u4f46\u662f\uff0c\u4e5f\u53ef\u80fd\u4f1a\u56e0\u4e3a\u6b63\u5728\u5904\u7406\u5176\u5b83\u590d\u6742\u5ea6\u9ad8\u7684\u547d\u4ee4\uff08\u4f8b\u5982\u96c6\u5408\u64cd\u4f5c\u547d\u4ee4\uff09\u800c\u963b\u585e\u3002\u6b64\u65f6\uff0c \u4ece\u5e93\u9700\u8981\u5904\u7406\u5b8c\u5f53\u524d\u7684\u547d\u4ee4\uff0c\u624d\u80fd\u6267\u884c\u4e3b\u5e93\u53d1\u9001\u7684\u547d\u4ee4\u64cd\u4f5c\uff0c\u8fd9\u5c31\u4f1a\u9020\u6210\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4 \u3002\u800c\u5728\u4e3b\u5e93\u547d\u4ee4\u88ab\u6ede\u540e\u5904\u7406\u7684\u8fd9\u6bb5\u65f6\u95f4\u5185\uff0c\u4e3b\u5e93\u672c\u8eab\u53ef\u80fd\u53c8\u6267\u884c\u4e86\u65b0\u7684\u5199\u64cd\u4f5c\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4e3b\u4ece\u5e93\u95f4\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u7a0b\u5ea6\u5c31\u4f1a\u8fdb\u4e00\u6b65\u52a0\u5267 1-2 \u9020\u6210\u56e0\u7d20 \u9996\u5148\uff0c\u5728\u786c\u4ef6\u73af\u5883\u914d\u7f6e\u65b9\u9762\uff0c \u8981\u5c3d\u91cf\u4fdd\u8bc1\u4e3b\u4ece\u5e93\u95f4\u7684\u7f51\u7edc\u8fde\u63a5\u72b6\u51b5\u826f\u597d \u3002\u4f8b\u5982\uff0c\u6211\u4eec\u8981\u907f\u514d\u628a\u4e3b\u4ece\u5e93\u90e8\u7f72\u5728\u4e0d\u540c\u7684\u673a\u623f\uff0c\u6216\u8005\u662f\u907f\u514d\u628a\u7f51\u7edc\u901a\u4fe1\u5bc6\u96c6\u7684\u5e94\u7528\uff08\u4f8b\u5982\u6570\u636e\u5206\u6790\u5e94\u7528\uff09\u548c Redis \u4e3b\u4ece\u5e93\u90e8\u7f72\u5728\u4e00\u8d77\u3002 \u8fd8\u53ef\u4ee5\u5f00\u53d1\u4e00\u4e2a\u5916\u90e8\u7a0b\u5e8f\u6765\u76d1\u63a7\u4e3b\u4ece\u5e93\u95f4\u7684\u590d\u5236\u8fdb\u5ea6\u3002 \u56e0\u4e3a Redis \u7684 INFO replication \u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u4e3b\u5e93\u63a5\u6536\u5199\u547d\u4ee4\u7684\u8fdb\u5ea6\u4fe1\u606f\uff08 master_repl_offset \uff09\u548c\u4ece\u5e93\u590d\u5236\u5199\u547d\u4ee4\u7684\u8fdb\u5ea6\u4fe1\u606f\uff08 slave_repl_offset \uff09 \u6240\u4ee5\u5c31\u53ef\u4ee5\u5f00\u53d1\u4e00\u4e2a\u76d1\u63a7\u7a0b\u5e8f\uff0c\u5148\u7528 INFO replication \u547d\u4ee4\u67e5\u5230\u4e3b\u3001\u4ece\u5e93\u7684\u8fdb\u5ea6\uff0c \u7136\u540e\uff0c\u6211\u4eec\u7528 master_repl_offset \u51cf\u53bb slave_repl_offset \uff0c\u8fd9\u6837\u5c31\u80fd\u5f97\u5230\u4ece\u5e93\u548c\u4e3b\u5e93\u95f4\u7684\u590d\u5236\u8fdb\u5ea6\u5dee\u503c\u4e86\u3002 \u67d0\u4e2a\u4ece\u5e93\u7684\u8fdb\u5ea6\u5dee\u503c\u5927\u4e8e\u6211\u4eec\u9884\u8bbe\u7684\u9608\u503c\uff0c\u53ef\u4ee5\u8ba9\u5ba2\u6237\u7aef\u4e0d\u518d\u548c\u8fd9\u4e2a\u4ece\u5e93\u8fde\u63a5\u8fdb\u884c\u6570\u636e\u8bfb\u53d6\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u51cf\u5c11\u8bfb\u5230\u4e0d\u4e00\u81f4\u6570\u636e\u7684\u60c5\u51b5\u3002 \u4e0d\u8fc7\uff0c\u4e3a\u4e86\u907f\u514d\u51fa\u73b0\u5ba2\u6237\u7aef\u548c\u6240\u6709\u4ece\u5e93\u90fd\u4e0d\u80fd\u8fde\u63a5\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u9700\u8981\u628a\u590d\u5236\u8fdb\u5ea6\u5dee\u503c\u7684\u9608\u503c\u8bbe\u7f6e\u5f97\u5927\u4e00\u4e9b\u3002 \u5728\u5e94\u7528 Redis \u65f6\uff0c\u53ef\u4ee5\u5468\u671f\u6027\u5730\u8fd0\u884c\u8fd9\u4e2a\u6d41\u7a0b\u6765\u76d1\u6d4b\u4e3b\u4ece\u5e93\u95f4\u7684\u4e0d\u4e00\u81f4\u60c5\u51b5\u3002 \u5f53\u7136\uff0c\u76d1\u63a7\u7a0b\u5e8f\u53ef\u4ee5\u4e00\u76f4\u76d1\u63a7\u7740\u4ece\u5e93\u7684\u590d\u5236\u8fdb\u5ea6\uff0c\u5f53\u4ece\u5e93\u7684\u590d\u5236\u8fdb\u5ea6\u53c8\u8d76\u4e0a\u4e3b\u5e93\u65f6\uff0c\u5c31\u5141\u8bb8\u5ba2\u6237\u7aef\u518d\u6b21\u8ddf\u8fd9\u4e9b\u4ece\u5e93\u8fde\u63a5\u3002 2\u3001\u8bfb\u53d6\u8fc7\u671f\u6570\u636e \u5728\u4f7f\u7528 Redis \u4e3b\u4ece\u96c6\u7fa4\u65f6\uff0c\u6709\u65f6\u4f1a\u8bfb\u5230\u8fc7\u671f\u6570\u636e\u3002\u4f8b\u5982\uff0c\u6570\u636e X \u7684\u8fc7\u671f\u65f6\u95f4\u662f 202010240900\uff0c\u4f46\u662f\u5ba2\u6237\u7aef\u5728 202010240910 \u65f6\uff0c\u4ecd\u7136\u53ef\u4ee5\u4ece\u4ece\u5e93\u4e2d\u8bfb\u5230\u6570\u636e X\u3002 \u4e00\u4e2a\u6570\u636e\u8fc7\u671f\u540e\uff0c\u5e94\u8be5\u662f\u88ab\u5220\u9664\u7684\uff0c\u5ba2\u6237\u7aef\u4e0d\u80fd\u518d\u8bfb\u53d6\u5230\u8be5\u6570\u636e\uff0c\u4f46\u662f\uff0cRedis \u4e3a\u4ec0\u4e48\u8fd8\u80fd\u5728\u4ece\u5e93\u4e2d\u8bfb\u5230\u8fc7\u671f\u7684\u6570\u636e\u5462\uff1f \u8fd9\u662f\u7531 Redis \u7684\u8fc7\u671f\u6570\u636e\u5220\u9664\u7b56\u7565\u5f15\u8d77\u7684\u3002 Redis \u540c\u65f6\u4f7f\u7528\u4e86\u4e24\u79cd\u7b56\u7565\u6765\u5220\u9664\u8fc7\u671f\u7684\u6570\u636e\uff0c\u5206\u522b\u662f\u60f0\u6027\u5220\u9664\u7b56\u7565\u548c\u5b9a\u671f\u5220\u9664\u7b56\u7565\u3002 2-1 \u60f0\u6027\u5220\u9664\u7b56\u7565 \u5f53\u4e00\u4e2a\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u5230\u4e86\u4ee5\u540e\uff0c\u5e76\u4e0d\u4f1a\u7acb\u5373\u5220\u9664\u6570\u636e\uff0c\u800c\u662f\u7b49\u5230\u518d\u6709\u8bf7\u6c42\u6765\u8bfb\u5199\u8fd9\u4e2a\u6570\u636e\u65f6\uff0c \u5bf9\u6570\u636e\u8fdb\u884c\u68c0\u67e5\uff0c\u5982\u679c\u53d1\u73b0\u6570\u636e\u5df2\u7ecf\u8fc7\u671f\u4e86\uff0c\u518d\u5220\u9664\u8fd9\u4e2a\u6570\u636e \u8fd9\u4e2a\u7b56\u7565\u7684\u597d\u5904\u662f\u5c3d\u91cf\u51cf\u5c11\u5220\u9664\u64cd\u4f5c\u5bf9 CPU \u8d44\u6e90\u7684\u4f7f\u7528\uff0c\u5bf9\u4e8e\u7528\u4e0d\u5230\u7684\u6570\u636e\uff0c\u5c31\u4e0d\u518d\u6d6a\u8d39\u65f6\u95f4\u8fdb\u884c\u68c0\u67e5\u548c\u5220\u9664\u4e86\u3002\u4f46\u662f\uff0c\u8fd9\u4e2a\u7b56\u7565\u4f1a\u5bfc\u81f4\u5927\u91cf\u5df2\u7ecf\u8fc7\u671f\u7684\u6570\u636e\u7559\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u5360\u7528\u8f83\u591a\u7684\u5185\u5b58\u8d44\u6e90\u3002\u6240\u4ee5\uff0cRedis \u5728\u4f7f\u7528\u8fd9\u4e2a\u7b56\u7565\u7684\u540c\u65f6\uff0c\u8fd8\u4f7f\u7528\u4e86\u7b2c\u4e8c\u79cd\u7b56\u7565\uff1a\u5b9a\u671f\u5220\u9664\u7b56\u7565\u3002 2-2 \u5b9a\u671f\u5220\u9664\u7b56\u7565 Redis \u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\uff08\u9ed8\u8ba4 100ms\uff09\uff0c\u5c31\u4f1a\u968f\u673a\u9009\u51fa\u4e00\u5b9a\u6570\u91cf\u7684\u6570\u636e\uff0c\u68c0\u67e5\u5b83\u4eec\u662f\u5426\u8fc7\u671f\uff0c\u5e76\u628a\u5176\u4e2d\u8fc7\u671f\u7684\u6570\u636e\u5220\u9664\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u53ca\u65f6\u91ca\u653e\u4e00\u4e9b\u5185\u5b58\u3002 2-3 \u5b83\u4eec\u4e3a\u4ec0\u4e48\u4f1a\u5bfc\u81f4\u8bfb\u53d6\u5230\u8fc7\u671f\u6570\u636e \u9996\u5148\uff0c\u867d\u7136\u5b9a\u671f\u5220\u9664\u7b56\u7565\u53ef\u4ee5\u91ca\u653e\u4e00\u4e9b\u5185\u5b58\uff0c\u4f46\u662f\uff0cRedis \u4e3a\u4e86\u907f\u514d\u8fc7\u591a\u5220\u9664\u64cd\u4f5c\u5bf9\u6027\u80fd\u4ea7\u751f\u5f71\u54cd\uff0c\u6bcf\u6b21\u968f\u673a\u68c0\u67e5\u6570\u636e\u7684\u6570\u91cf\u5e76\u4e0d\u591a\u3002\u5982\u679c\u8fc7\u671f\u6570\u636e\u5f88\u591a\uff0c\u5e76\u4e14\u4e00\u76f4\u6ca1\u6709\u518d\u88ab\u8bbf\u95ee\u7684\u8bdd\uff0c\u8fd9\u4e9b\u6570\u636e\u5c31\u4f1a\u7559\u5b58\u5728 Redis \u5b9e\u4f8b\u4e2d\u3002\u4e1a\u52a1\u5e94\u7528\u4e4b\u6240\u4ee5\u4f1a\u8bfb\u5230\u8fc7\u671f\u6570\u636e\uff0c\u8fd9\u4e9b\u7559\u5b58\u6570\u636e\u5c31\u662f\u4e00\u4e2a\u91cd\u8981\u56e0\u7d20\u3002 \u5176\u6b21\uff0c\u60f0\u6027\u5220\u9664\u7b56\u7565\u5b9e\u73b0\u540e\uff0c\u6570\u636e\u53ea\u6709\u88ab\u518d\u6b21\u8bbf\u95ee\u65f6\uff0c\u624d\u4f1a\u88ab\u5b9e\u9645\u5220\u9664\u3002\u5982\u679c\u5ba2\u6237\u7aef\u4ece\u4e3b\u5e93\u4e0a\u8bfb\u53d6\u7559\u5b58\u7684\u8fc7\u671f\u6570\u636e\uff0c\u4e3b\u5e93\u4f1a\u89e6\u53d1\u5220\u9664\u64cd\u4f5c\uff0c \u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u5e76\u4e0d\u4f1a\u8bfb\u5230\u8fc7\u671f\u6570\u636e\u3002\u4f46\u662f\uff0c\u4ece\u5e93\u672c\u8eab\u4e0d\u4f1a\u6267\u884c\u5220\u9664\u64cd\u4f5c\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u5728\u4ece\u5e93\u4e2d\u8bbf\u95ee\u7559\u5b58\u7684\u8fc7\u671f\u6570\u636e\uff0c\u4ece\u5e93\u5e76\u4e0d\u4f1a\u89e6\u53d1\u6570\u636e\u5220\u9664 \u3002\u90a3\u4e48\uff0c\u4ece\u5e93\u4f1a\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u8fc7\u671f\u6570\u636e\u5417\uff1f \u548c\u4f7f\u7528\u7684 Redis \u7248\u672c\u6709\u5173\u4e86\u3002\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f Redis 3.2 \u4e4b\u524d\u7684\u7248\u672c\uff0c\u90a3\u4e48\uff0c\u4ece\u5e93\u5728\u670d\u52a1\u8bfb\u8bf7\u6c42\u65f6\uff0c\u5e76\u4e0d\u4f1a\u5224\u65ad\u6570\u636e\u662f\u5426\u8fc7\u671f\uff0c\u800c\u662f\u4f1a\u8fd4\u56de\u8fc7\u671f\u6570\u636e\u3002 \u5728 3.2 \u7248\u672c\u540e\uff0cRedis \u505a\u4e86\u6539\u8fdb\uff0c\u5982\u679c\u8bfb\u53d6\u7684\u6570\u636e\u5df2\u7ecf\u8fc7\u671f\u4e86\uff0c\u4ece\u5e93\u867d\u7136\u4e0d\u4f1a\u5220\u9664\uff0c\u4f46\u662f\u4f1a\u8fd4\u56de\u7a7a\u503c\uff0c\u8fd9\u5c31\u907f\u514d\u4e86\u5ba2\u6237\u7aef\u8bfb\u5230\u8fc7\u671f\u6570\u636e \u3002\u6240\u4ee5\uff0c\u5728\u5e94\u7528\u4e3b\u4ece\u96c6\u7fa4\u65f6\uff0c\u5c3d\u91cf\u4f7f\u7528 Redis 3.2 \u53ca\u4ee5\u4e0a\u7248\u672c\u3002 \u6709\u4e9b\u547d\u4ee4\u7ed9\u6570\u636e\u8bbe\u7f6e\u7684\u8fc7\u671f\u65f6\u95f4\u5728\u4ece\u5e93\u4e0a\u53ef\u80fd\u4f1a\u88ab\u5ef6\u540e\uff0c\u5bfc\u81f4\u5e94\u8be5\u8fc7\u671f\u7684\u6570\u636e\u53c8\u5728\u4ece\u5e93\u4e0a\u88ab\u8bfb\u53d6\u5230\u4e86 \u8bbe\u7f6e\u6570\u636e\u8fc7\u671f\u65f6\u95f4\u7684\u547d\u4ee4\u4e00\u5171\u6709 4 \u4e2a\uff0c\u53ef\u4ee5\u628a\u5b83\u4eec\u5206\u6210\u4e24\u7c7b\uff1a EXPIRE \u548c PEXPIRE\uff1a\u5b83\u4eec\u7ed9\u6570\u636e\u8bbe\u7f6e\u7684\u662f \u4ece\u547d\u4ee4\u6267\u884c\u65f6\u5f00\u59cb\u8ba1\u7b97\u7684\u5b58\u6d3b\u65f6\u95f4 \uff1b EXPIREAT \u548c PEXPIREAT\uff1a \u5b83\u4eec\u4f1a\u76f4\u63a5\u628a\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u5177\u4f53\u7684\u4e00\u4e2a\u65f6\u95f4\u70b9\u3002 \u8fd9 4 \u4e2a\u547d\u4ee4\u7684\u53c2\u6570\u548c\u542b\u4e49\u5982\u4e0b\u8868\u6240\u793a\uff1a \u7b2c\u4e00\u4e2a\u4f8b\u5b50\u662f\u4f7f\u7528 EXPIRE \u547d\u4ee4\uff0c\u5f53\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0c \u6211\u4eec\u5c31\u628a testkey \u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a 60s \u540e\u3002 EXPIRE testkey 60 \u7b2c\u4e8c\u4e2a\u4f8b\u5b50\u662f\u4f7f\u7528 EXPIREAT \u547d\u4ee4\uff0c\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c \u5c31\u53ef\u4ee5\u8ba9 testkey \u5728 2020 \u5e74 10 \u6708 24 \u65e5\u4e0a\u5348 9 \u70b9\u8fc7\u671f\uff0c\u547d\u4ee4\u4e2d\u7684 1603501200 \u5c31\u662f\u4ee5\u79d2\u6570\u65f6\u95f4\u6233\u8868\u793a\u7684 10 \u6708 24 \u65e5\u4e0a\u5348 9 \u70b9 EXPIREAT testkey 1603501200 \u5f53\u4e3b\u4ece\u5e93\u5168\u91cf\u540c\u6b65\u65f6\uff0c\u5982\u679c\u4e3b\u5e93\u63a5\u6536\u5230\u4e86\u4e00\u6761 EXPIRE \u547d\u4ee4\uff0c\u90a3\u4e48\uff0c\u4e3b\u5e93\u4f1a\u76f4\u63a5\u6267\u884c\u8fd9\u6761\u547d\u4ee4\u3002\u8fd9\u6761\u547d\u4ee4\u4f1a\u5728\u5168\u91cf\u540c\u6b65\u5b8c\u6210\u540e\uff0c \u53d1\u7ed9\u4ece\u5e93\u6267\u884c\u3002\u800c\u4ece\u5e93\u5728\u6267\u884c\u65f6\uff0c\u5c31\u4f1a\u5728\u5f53\u524d\u65f6\u95f4\u7684\u57fa\u7840\u4e0a\u52a0\u4e0a\u6570\u636e\u7684\u5b58\u6d3b\u65f6\u95f4\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u4ece\u5e93\u4e0a\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u5c31\u4f1a\u6bd4\u4e3b\u5e93\u4e0a\u5ef6\u540e\u4e86 \u3002 \u5047\u8bbe\u5f53\u524d\u65f6\u95f4\u662f 2020 \u5e74 10 \u6708 24 \u65e5\u4e0a\u5348 9 \u70b9\uff0c\u4e3b\u4ece\u5e93\u6b63\u5728\u540c\u6b65\uff0c\u4e3b\u5e93\u6536\u5230\u4e86\u4e00\u6761\u547d\u4ee4\uff1a EXPIRE testkey 60\uff0c\u8fd9\u5c31\u8868\u793a\uff0ctestkey \u7684\u8fc7\u671f\u65f6\u95f4\u5c31\u662f 24 \u65e5\u4e0a\u5348 9 \u70b9 1 \u5206\uff0c\u4e3b\u5e93\u76f4\u63a5\u6267\u884c\u4e86\u8fd9\u6761\u547d\u4ee4\u3002 \u4f46\u662f\uff0c\u4e3b\u4ece\u5e93\u5168\u91cf\u540c\u6b65\u82b1\u8d39\u4e86 2 \u5206\u949f\u624d\u5b8c\u6210\u3002\u7b49\u4ece\u5e93\u5f00\u59cb\u6267\u884c\u8fd9\u6761\u547d\u4ee4\u65f6\uff0c\u65f6\u95f4\u5df2\u7ecf\u662f 9 \u70b9 2 \u5206\u4e86\u3002 \u800c EXPIRE \u547d\u4ee4\u662f\u628a testkey \u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u5f53\u524d\u65f6\u95f4\u7684 60s \u540e\uff0c\u4e5f\u5c31\u662f 9 \u70b9 3 \u5206\u3002 \u5982\u679c\u5ba2\u6237\u7aef\u5728 9 \u70b9 2 \u5206 30 \u79d2\u65f6\u5728\u4ece\u5e93\u4e0a\u8bfb\u53d6 testkey\uff0c\u4ecd\u7136\u53ef\u4ee5\u8bfb\u5230 testkey \u7684\u503c\u3002\u4f46\u662f\uff0ctestkey \u5b9e\u9645\u4e0a\u5df2\u7ecf\u8fc7\u671f\u4e86\u3002 \u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c \u5efa\u8bae\u662f\uff0c\u5728\u4e1a\u52a1\u5e94\u7528\u4e2d\u4f7f\u7528 EXPIREAT/PEXPIREAT \u547d\u4ee4\uff0c\u628a\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u5177\u4f53\u7684\u65f6\u95f4\u70b9\uff0c\u907f\u514d\u8bfb\u5230\u8fc7\u671f\u6570\u636e\u3002 \u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\u3002Redis \u91c7\u7528\u7684\u662f\u5f02\u6b65\u590d\u5236\uff0c\u6240\u4ee5\u65e0\u6cd5\u5b9e\u73b0\u5f3a\u4e00\u81f4\u6027\u4fdd\u8bc1\uff08\u4e3b\u4ece\u6570\u636e\u65f6\u65f6\u523b\u523b\u4fdd\u6301\u4e00\u81f4\uff09\uff0c\u6570\u636e\u4e0d\u4e00\u81f4\u662f\u96be\u4ee5\u907f\u514d\u7684 \u3002\u6211\u7ed9\u4f60\u63d0\u4f9b\u4e86\u5e94\u5bf9\u65b9\u6cd5\uff1a\u4fdd\u8bc1\u826f\u597d\u7f51\u7edc\u73af\u5883\uff0c\u4ee5\u53ca\u4f7f\u7528\u7a0b\u5e8f\u76d1\u63a7\u4ece\u5e93\u590d\u5236\u8fdb\u5ea6\uff0c\u4e00\u65e6\u4ece\u5e93\u590d\u5236\u8fdb\u5ea6\u8d85\u8fc7\u9608\u503c\uff0c\u4e0d\u8ba9\u5ba2\u6237\u7aef\u8fde\u63a5\u4ece\u5e93\u3002 \u5bf9\u4e8e\u8bfb\u5230\u8fc7\u671f\u6570\u636e\uff0c\u8fd9\u662f\u53ef\u4ee5\u63d0\u524d\u89c4\u907f\u7684 \uff0c \u4e00\u4e2a\u65b9\u6cd5\u662f\uff0c\u4f7f\u7528 Redis 3.2 \u53ca\u4ee5\u4e0a\u7248\u672c\uff1b\u53e6\u5916\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 EXPIREAT/PEXPIREAT \u547d\u4ee4\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u907f\u514d\u4ece\u5e93\u4e0a\u7684\u6570\u636e\u8fc7\u671f\u65f6\u95f4\u6ede\u540e \u3002\u4e0d\u8fc7\uff0c\u8fd9\u91cc\u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\u4e0b\uff0c \u56e0\u4e3a EXPIREAT/PEXPIREAT \u8bbe\u7f6e\u7684\u662f\u65f6\u95f4\u70b9\uff0c\u6240\u4ee5\uff0c\u4e3b\u4ece\u8282\u70b9\u4e0a\u7684\u65f6\u949f\u8981\u4fdd\u6301\u4e00\u81f4\uff0c\u5177\u4f53\u7684\u505a\u6cd5\u662f\uff0c\u8ba9\u4e3b\u4ece\u8282\u70b9\u548c\u76f8\u540c\u7684 NTP \u670d\u52a1\u5668\uff08\u65f6\u95f4\u670d\u52a1\u5668\uff09\u8fdb\u884c\u65f6\u949f\u540c\u6b65\u3002 3\u3001\u4e0d\u5408\u7406\u914d\u7f6e\u9879\u5bfc\u81f4\u7684\u670d\u52a1\u6302\u6389 \u8fd9\u91cc\u6d89\u53ca\u5230\u7684\u914d\u7f6e\u9879\u6709\u4e24\u4e2a\uff0c\u5206\u522b\u662f protected-mode \u548c cluster-node-timeout \u3002 3-1 protected-mode \u914d\u7f6e\u9879 \u8fd9\u4e2a\u914d\u7f6e\u9879\u7684\u4f5c\u7528\u662f\u9650\u5b9a\u54e8\u5175\u5b9e\u4f8b\u80fd\u5426\u88ab\u5176\u4ed6\u670d\u52a1\u5668\u8bbf\u95ee\u3002 \u5f53\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a yes \u65f6\uff0c\u54e8\u5175\u5b9e\u4f8b\u53ea\u80fd\u5728\u90e8\u7f72\u7684\u670d\u52a1\u5668\u672c\u5730\u8fdb\u884c\u8bbf\u95ee\u3002\u5f53\u8bbe\u7f6e\u4e3a no \u65f6\uff0c\u5176\u4ed6\u670d\u52a1\u5668\u4e5f\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e2a\u54e8\u5175\u5b9e\u4f8b\u3002 \u6b63\u56e0\u4e3a\u8fd9\u6837\uff0c \u5982\u679c protected-mode \u88ab\u8bbe\u7f6e\u4e3a yes\uff0c\u800c\u5176\u4f59\u54e8\u5175\u5b9e\u4f8b\u90e8\u7f72\u5728\u5176\u5b83\u670d\u52a1\u5668\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e9b\u54e8\u5175\u5b9e\u4f8b\u95f4\u5c31\u65e0\u6cd5\u901a\u4fe1 \u3002 \u5f53\u4e3b\u5e93\u6545\u969c\u65f6\uff0c\u54e8\u5175\u65e0\u6cd5\u5224\u65ad\u4e3b\u5e93\u4e0b\u7ebf\uff0c\u4e5f\u65e0\u6cd5\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u6700\u7ec8 Redis \u670d\u52a1\u4e0d\u53ef\u7528\u3002 \u5728\u5e94\u7528\u4e3b\u4ece\u96c6\u7fa4\u65f6\uff0c\u8981\u6ce8\u610f\u5c06 protected-mode \u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a no\uff0c\u5e76\u4e14\u5c06 bind \u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a\u5176\u5b83\u54e8\u5175\u5b9e\u4f8b\u7684 IP \u5730\u5740\u3002 \u53ea\u6709\u5728 bind \u4e2d\u8bbe\u7f6e\u4e86 IP \u5730\u5740\u7684\u54e8\u5175\uff0c\u624d\u53ef\u4ee5\u8bbf\u95ee\u5f53\u524d\u5b9e\u4f8b\uff0c\u65e2\u4fdd\u8bc1\u4e86\u5b9e\u4f8b\u95f4\u80fd\u591f\u901a\u4fe1\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u4e5f\u4fdd\u8bc1\u4e86\u54e8\u5175\u7684\u5b89\u5168\u6027\u3002 \u5982\u679c\u8bbe\u7f6e\u4e86\u4e0b\u9762\u7684\u914d\u7f6e\u9879\uff0c\u90a3\u4e48\uff0c\u90e8\u7f72\u5728 192.168.10.3/4/5 \u8fd9\u4e09\u53f0\u670d\u52a1\u5668\u4e0a\u7684\u54e8\u5175\u5b9e\u4f8b\u5c31\u53ef\u4ee5\u76f8\u4e92\u901a\u4fe1\uff0c\u6267\u884c\u4e3b\u4ece\u5207\u6362\u3002 protected-mode no bind 192.168.10.3 192.168.10.4 192.168.10.5 3-2 cluster-node-timeout \u914d\u7f6e\u9879 \u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e86 Redis Cluster \u4e2d\u5b9e\u4f8b\u54cd\u5e94\u5fc3\u8df3\u6d88\u606f\u7684\u8d85\u65f6\u65f6\u95f4\u3002 Redis Cluster \u96c6\u7fa4\u4e2d\u4e3a\u6bcf\u4e2a\u5b9e\u4f8b\u914d\u7f6e\u4e86\u201c\u4e00\u4e3b\u4e00\u4ece\u201d\u6a21\u5f0f\u65f6\uff0c\u5982\u679c\u4e3b\u5b9e\u4f8b\u53d1\u751f\u6545\u969c\uff0c\u4ece\u5b9e\u4f8b\u4f1a\u5207\u6362\u4e3a\u4e3b\u5b9e\u4f8b\uff0c\u53d7\u7f51\u7edc\u5ef6\u8fdf\u548c\u5207\u6362\u64cd\u4f5c\u6267\u884c\u7684\u5f71\u54cd\uff0c\u5207\u6362\u65f6\u95f4\u53ef\u80fd\u8f83\u957f\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5b9e\u4f8b\u7684\u5fc3\u8df3\u8d85\u65f6\uff08\u8d85\u51fa cluster-node-timeout\uff09\u3002 \u5b9e\u4f8b\u8d85\u65f6\u540e\uff0c\u5c31\u4f1a\u88ab Redis Cluster \u5224\u65ad\u4e3a\u5f02\u5e38\u3002\u800c Redis Cluster \u6b63\u5e38\u8fd0\u884c\u7684\u6761\u4ef6\u5c31\u662f\uff0c\u6709\u534a\u6570\u4ee5\u4e0a\u7684\u5b9e\u4f8b\u90fd\u80fd\u6b63\u5e38\u8fd0\u884c\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u6267\u884c\u4e3b\u4ece\u5207\u6362\u7684\u5b9e\u4f8b\u8d85\u8fc7\u534a\u6570\uff0c\u800c\u4e3b\u4ece\u5207\u6362\u65f6\u95f4\u53c8\u8fc7\u957f\u7684\u8bdd\uff0c\u5c31\u53ef\u80fd\u6709\u534a\u6570\u4ee5\u4e0a\u7684\u5b9e\u4f8b\u5fc3\u8df3\u8d85\u65f6\uff0c\u4ece\u800c\u53ef\u80fd\u5bfc\u81f4\u6574\u4e2a\u96c6\u7fa4\u6302\u6389\u3002\u6240\u4ee5\uff0c\u5efa\u8bae\u4f60\u5c06 cluster-node-timeout \u8c03\u5927\u4e9b\uff08\u4f8b\u5982 10 \u5230 20 \u79d2\uff09\u3002 4\u3001\u672c\u8282\u5c0f\u7ed3 Redis \u4e3b\u4ece\u5e93\u540c\u6b65\u65f6\u53ef\u80fd\u51fa\u73b0\u7684 3 \u4e2a\u5751\uff0c\u5206\u522b\u662f\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\u3001\u8bfb\u53d6\u5230\u8fc7\u671f\u6570\u636e\u548c\u4e0d\u5408\u7406\u914d\u7f6e\u9879\u5bfc\u81f4\u670d\u52a1\u6302\u6389\u3002 \u5173\u4e8e\u4e3b\u4ece\u5e93\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\uff1a Redis \u4e2d\u7684 slave-serve-stale-data \u914d\u7f6e\u9879\u8bbe\u7f6e\u4e86\u4ece\u5e93\u80fd\u5426\u5904\u7406\u6570\u636e\u8bfb\u5199\u547d\u4ee4\uff0c\u4f60\u53ef\u4ee5\u628a\u5b83\u8bbe\u7f6e\u4e3a no \u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4ece\u5e93\u53ea\u80fd\u670d\u52a1 INFO\u3001SLAVEOF \u547d\u4ee4\uff0c\u8fd9\u5c31\u53ef\u4ee5\u907f\u514d\u5728\u4ece\u5e93\u4e2d\u8bfb\u5230\u4e0d\u4e00\u81f4\u7684\u6570\u636e\u4e86\u3002 \u8fd9\u4e2a\u914d\u7f6e\u9879\u548c slave-read-only \u7684\u533a\u522b\uff0c slave-read-only \u662f\u8bbe\u7f6e\u4ece\u5e93\u80fd\u5426\u5904\u7406\u5199\u547d\u4ee4\uff0c slave-read-only \u8bbe\u7f6e\u4e3a yes \u65f6\uff0c\u4ece\u5e93\u53ea\u80fd\u5904\u7406\u8bfb\u8bf7\u6c42\uff0c\u65e0\u6cd5\u5904\u7406\u5199\u8bf7\u6c42\uff0c\u4f60\u53ef\u4e0d\u8981\u641e\u6df7\u4e86\u3002","title":"\u7b2c\u4e00\u8282 Redis\u4e3b\u4ece\u540c\u6b65\u4e0e\u6545\u969c\u5207\u6362\u7684\u4e09\u4e2a\u5751"},{"location":"chap7/1Redis_master_slave/#redis","text":"Redis \u7684\u4e3b\u4ece\u540c\u6b65\u673a\u5236\u4e0d\u4ec5\u53ef\u4ee5\u8ba9\u4ece\u5e93\u670d\u52a1\u66f4\u591a\u7684\u8bfb\u8bf7\u6c42\uff0c\u5206\u62c5\u4e3b\u5e93\u7684\u538b\u529b\uff0c\u800c\u4e14\u8fd8\u80fd\u5728\u4e3b\u5e93\u53d1\u751f\u6545\u969c\u65f6\uff0c\u8fdb\u884c\u4e3b\u4ece\u5e93\u5207\u6362\uff0c\u63d0\u4f9b\u9ad8\u53ef\u9760\u670d\u52a1\u3002 \u4ecb\u7ecd 3 \u4e2a\u5751\uff0c\u5206\u522b\u662f\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\u3001\u8bfb\u5230\u8fc7\u671f\u6570\u636e\uff0c\u4ee5\u53ca\u914d\u7f6e\u9879\u8bbe\u7f6e\u5f97\u4e0d\u5408\u7406\u4ece\u800c\u5bfc\u81f4\u670d\u52a1\u6302\u6389\u3002","title":"\u7b2c\u4e00\u8282 Redis\u4e3b\u4ece\u540c\u6b65\u4e0e\u6545\u969c\u5207\u6362\u7684\u4e09\u4e2a\u5751"},{"location":"chap7/1Redis_master_slave/#1","text":"","title":"1\u3001\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4"},{"location":"chap7/1Redis_master_slave/#1-1","text":"\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u5c31\u662f\u6307\u5ba2\u6237\u7aef\u4ece\u4ece\u5e93\u4e2d\u8bfb\u53d6\u5230\u7684\u503c\u548c\u4e3b\u5e93\u4e2d\u7684\u6700\u65b0\u503c\u5e76\u4e0d\u4e00\u81f4\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4e3b\u4ece\u5e93\u4e4b\u524d\u4fdd\u5b58\u7684\u7528\u6237\u5e74\u9f84\u503c\u662f 19\uff0c\u4f46\u662f\u4e3b\u5e93\u63a5\u6536\u5230\u4e86\u4fee\u6539\u547d\u4ee4\uff0c\u5df2\u7ecf\u628a\u8fd9\u4e2a\u6570\u636e\u66f4\u65b0\u4e3a 20 \u4e86\uff0c\u4f46\u662f\uff0c\u4ece\u5e93\u4e2d\u7684\u503c\u4ecd\u7136\u662f 19\u3002\u90a3\u4e48\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u4ece\u4ece\u5e93\u4e2d\u8bfb\u53d6\u7528\u6237\u5e74\u9f84\u503c\uff0c\u5c31\u4f1a\u8bfb\u5230\u65e7\u503c\u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u5728\u4e3b\u4ece\u5e93\u547d\u4ee4\u4f20\u64ad\u9636\u6bb5\uff0c\u4e3b\u5e93\u6536\u5230\u65b0\u7684\u5199\u547d\u4ee4\u540e\uff0c\u4f1a\u53d1\u9001\u7ed9\u4ece\u5e93\u3002 \u4f46\u662f\uff0c\u4e3b\u5e93\u5e76\u4e0d\u4f1a\u7b49\u5230\u4ece\u5e93\u5b9e\u9645\u6267\u884c\u5b8c\u547d\u4ee4\u540e\uff0c\u518d\u628a\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u800c\u662f\u4e3b\u5e93\u81ea\u5df1\u5728\u672c\u5730\u6267\u884c\u5b8c\u547d\u4ee4\u540e\uff0c\u5c31\u4f1a\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u7ed3\u679c\u4e86\u3002 \u5982\u679c\u4ece\u5e93\u8fd8\u6ca1\u6709\u6267\u884c\u4e3b\u5e93\u540c\u6b65\u8fc7\u6765\u7684\u547d\u4ee4\uff0c\u4e3b\u4ece\u5e93\u95f4\u7684\u6570\u636e\u5c31\u4e0d\u4e00\u81f4\u4e86\u3002 \u4ece\u5e93\u4f1a\u6ede\u540e\u6267\u884c\u540c\u6b65\u547d\u4ee4\u5462\uff1f\u5176\u5b9e\uff0c\u8fd9\u91cc\u4e3b\u8981\u6709\u4e24\u4e2a\u539f\u56e0\u3002 \u4e3b\u4ece\u5e93\u95f4\u7684\u7f51\u7edc\u53ef\u80fd\u4f1a\u6709\u4f20\u8f93\u5ef6\u8fdf \uff0c\u6240\u4ee5\u4ece\u5e93\u4e0d\u80fd\u53ca\u65f6\u5730\u6536\u5230\u4e3b\u5e93\u53d1\u9001\u7684\u547d\u4ee4\uff0c\u4ece\u5e93\u4e0a\u6267\u884c\u540c\u6b65\u547d\u4ee4\u7684\u65f6\u95f4\u5c31\u4f1a\u88ab\u5ef6\u540e\u3002 \u5373\u4f7f\u4ece\u5e93\u53ca\u65f6\u6536\u5230\u4e86\u4e3b\u5e93\u7684\u547d\u4ee4\uff0c\u4f46\u662f\uff0c\u4e5f\u53ef\u80fd\u4f1a\u56e0\u4e3a\u6b63\u5728\u5904\u7406\u5176\u5b83\u590d\u6742\u5ea6\u9ad8\u7684\u547d\u4ee4\uff08\u4f8b\u5982\u96c6\u5408\u64cd\u4f5c\u547d\u4ee4\uff09\u800c\u963b\u585e\u3002\u6b64\u65f6\uff0c \u4ece\u5e93\u9700\u8981\u5904\u7406\u5b8c\u5f53\u524d\u7684\u547d\u4ee4\uff0c\u624d\u80fd\u6267\u884c\u4e3b\u5e93\u53d1\u9001\u7684\u547d\u4ee4\u64cd\u4f5c\uff0c\u8fd9\u5c31\u4f1a\u9020\u6210\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4 \u3002\u800c\u5728\u4e3b\u5e93\u547d\u4ee4\u88ab\u6ede\u540e\u5904\u7406\u7684\u8fd9\u6bb5\u65f6\u95f4\u5185\uff0c\u4e3b\u5e93\u672c\u8eab\u53ef\u80fd\u53c8\u6267\u884c\u4e86\u65b0\u7684\u5199\u64cd\u4f5c\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4e3b\u4ece\u5e93\u95f4\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u7a0b\u5ea6\u5c31\u4f1a\u8fdb\u4e00\u6b65\u52a0\u5267","title":"1-1 \u9020\u6210\u56e0\u7d20"},{"location":"chap7/1Redis_master_slave/#1-2","text":"\u9996\u5148\uff0c\u5728\u786c\u4ef6\u73af\u5883\u914d\u7f6e\u65b9\u9762\uff0c \u8981\u5c3d\u91cf\u4fdd\u8bc1\u4e3b\u4ece\u5e93\u95f4\u7684\u7f51\u7edc\u8fde\u63a5\u72b6\u51b5\u826f\u597d \u3002\u4f8b\u5982\uff0c\u6211\u4eec\u8981\u907f\u514d\u628a\u4e3b\u4ece\u5e93\u90e8\u7f72\u5728\u4e0d\u540c\u7684\u673a\u623f\uff0c\u6216\u8005\u662f\u907f\u514d\u628a\u7f51\u7edc\u901a\u4fe1\u5bc6\u96c6\u7684\u5e94\u7528\uff08\u4f8b\u5982\u6570\u636e\u5206\u6790\u5e94\u7528\uff09\u548c Redis \u4e3b\u4ece\u5e93\u90e8\u7f72\u5728\u4e00\u8d77\u3002 \u8fd8\u53ef\u4ee5\u5f00\u53d1\u4e00\u4e2a\u5916\u90e8\u7a0b\u5e8f\u6765\u76d1\u63a7\u4e3b\u4ece\u5e93\u95f4\u7684\u590d\u5236\u8fdb\u5ea6\u3002 \u56e0\u4e3a Redis \u7684 INFO replication \u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u4e3b\u5e93\u63a5\u6536\u5199\u547d\u4ee4\u7684\u8fdb\u5ea6\u4fe1\u606f\uff08 master_repl_offset \uff09\u548c\u4ece\u5e93\u590d\u5236\u5199\u547d\u4ee4\u7684\u8fdb\u5ea6\u4fe1\u606f\uff08 slave_repl_offset \uff09 \u6240\u4ee5\u5c31\u53ef\u4ee5\u5f00\u53d1\u4e00\u4e2a\u76d1\u63a7\u7a0b\u5e8f\uff0c\u5148\u7528 INFO replication \u547d\u4ee4\u67e5\u5230\u4e3b\u3001\u4ece\u5e93\u7684\u8fdb\u5ea6\uff0c \u7136\u540e\uff0c\u6211\u4eec\u7528 master_repl_offset \u51cf\u53bb slave_repl_offset \uff0c\u8fd9\u6837\u5c31\u80fd\u5f97\u5230\u4ece\u5e93\u548c\u4e3b\u5e93\u95f4\u7684\u590d\u5236\u8fdb\u5ea6\u5dee\u503c\u4e86\u3002 \u67d0\u4e2a\u4ece\u5e93\u7684\u8fdb\u5ea6\u5dee\u503c\u5927\u4e8e\u6211\u4eec\u9884\u8bbe\u7684\u9608\u503c\uff0c\u53ef\u4ee5\u8ba9\u5ba2\u6237\u7aef\u4e0d\u518d\u548c\u8fd9\u4e2a\u4ece\u5e93\u8fde\u63a5\u8fdb\u884c\u6570\u636e\u8bfb\u53d6\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u51cf\u5c11\u8bfb\u5230\u4e0d\u4e00\u81f4\u6570\u636e\u7684\u60c5\u51b5\u3002 \u4e0d\u8fc7\uff0c\u4e3a\u4e86\u907f\u514d\u51fa\u73b0\u5ba2\u6237\u7aef\u548c\u6240\u6709\u4ece\u5e93\u90fd\u4e0d\u80fd\u8fde\u63a5\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u9700\u8981\u628a\u590d\u5236\u8fdb\u5ea6\u5dee\u503c\u7684\u9608\u503c\u8bbe\u7f6e\u5f97\u5927\u4e00\u4e9b\u3002 \u5728\u5e94\u7528 Redis \u65f6\uff0c\u53ef\u4ee5\u5468\u671f\u6027\u5730\u8fd0\u884c\u8fd9\u4e2a\u6d41\u7a0b\u6765\u76d1\u6d4b\u4e3b\u4ece\u5e93\u95f4\u7684\u4e0d\u4e00\u81f4\u60c5\u51b5\u3002 \u5f53\u7136\uff0c\u76d1\u63a7\u7a0b\u5e8f\u53ef\u4ee5\u4e00\u76f4\u76d1\u63a7\u7740\u4ece\u5e93\u7684\u590d\u5236\u8fdb\u5ea6\uff0c\u5f53\u4ece\u5e93\u7684\u590d\u5236\u8fdb\u5ea6\u53c8\u8d76\u4e0a\u4e3b\u5e93\u65f6\uff0c\u5c31\u5141\u8bb8\u5ba2\u6237\u7aef\u518d\u6b21\u8ddf\u8fd9\u4e9b\u4ece\u5e93\u8fde\u63a5\u3002","title":"1-2 \u9020\u6210\u56e0\u7d20"},{"location":"chap7/1Redis_master_slave/#2","text":"\u5728\u4f7f\u7528 Redis \u4e3b\u4ece\u96c6\u7fa4\u65f6\uff0c\u6709\u65f6\u4f1a\u8bfb\u5230\u8fc7\u671f\u6570\u636e\u3002\u4f8b\u5982\uff0c\u6570\u636e X \u7684\u8fc7\u671f\u65f6\u95f4\u662f 202010240900\uff0c\u4f46\u662f\u5ba2\u6237\u7aef\u5728 202010240910 \u65f6\uff0c\u4ecd\u7136\u53ef\u4ee5\u4ece\u4ece\u5e93\u4e2d\u8bfb\u5230\u6570\u636e X\u3002 \u4e00\u4e2a\u6570\u636e\u8fc7\u671f\u540e\uff0c\u5e94\u8be5\u662f\u88ab\u5220\u9664\u7684\uff0c\u5ba2\u6237\u7aef\u4e0d\u80fd\u518d\u8bfb\u53d6\u5230\u8be5\u6570\u636e\uff0c\u4f46\u662f\uff0cRedis \u4e3a\u4ec0\u4e48\u8fd8\u80fd\u5728\u4ece\u5e93\u4e2d\u8bfb\u5230\u8fc7\u671f\u7684\u6570\u636e\u5462\uff1f \u8fd9\u662f\u7531 Redis \u7684\u8fc7\u671f\u6570\u636e\u5220\u9664\u7b56\u7565\u5f15\u8d77\u7684\u3002 Redis \u540c\u65f6\u4f7f\u7528\u4e86\u4e24\u79cd\u7b56\u7565\u6765\u5220\u9664\u8fc7\u671f\u7684\u6570\u636e\uff0c\u5206\u522b\u662f\u60f0\u6027\u5220\u9664\u7b56\u7565\u548c\u5b9a\u671f\u5220\u9664\u7b56\u7565\u3002","title":"2\u3001\u8bfb\u53d6\u8fc7\u671f\u6570\u636e"},{"location":"chap7/1Redis_master_slave/#2-1","text":"\u5f53\u4e00\u4e2a\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u5230\u4e86\u4ee5\u540e\uff0c\u5e76\u4e0d\u4f1a\u7acb\u5373\u5220\u9664\u6570\u636e\uff0c\u800c\u662f\u7b49\u5230\u518d\u6709\u8bf7\u6c42\u6765\u8bfb\u5199\u8fd9\u4e2a\u6570\u636e\u65f6\uff0c \u5bf9\u6570\u636e\u8fdb\u884c\u68c0\u67e5\uff0c\u5982\u679c\u53d1\u73b0\u6570\u636e\u5df2\u7ecf\u8fc7\u671f\u4e86\uff0c\u518d\u5220\u9664\u8fd9\u4e2a\u6570\u636e \u8fd9\u4e2a\u7b56\u7565\u7684\u597d\u5904\u662f\u5c3d\u91cf\u51cf\u5c11\u5220\u9664\u64cd\u4f5c\u5bf9 CPU \u8d44\u6e90\u7684\u4f7f\u7528\uff0c\u5bf9\u4e8e\u7528\u4e0d\u5230\u7684\u6570\u636e\uff0c\u5c31\u4e0d\u518d\u6d6a\u8d39\u65f6\u95f4\u8fdb\u884c\u68c0\u67e5\u548c\u5220\u9664\u4e86\u3002\u4f46\u662f\uff0c\u8fd9\u4e2a\u7b56\u7565\u4f1a\u5bfc\u81f4\u5927\u91cf\u5df2\u7ecf\u8fc7\u671f\u7684\u6570\u636e\u7559\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u5360\u7528\u8f83\u591a\u7684\u5185\u5b58\u8d44\u6e90\u3002\u6240\u4ee5\uff0cRedis \u5728\u4f7f\u7528\u8fd9\u4e2a\u7b56\u7565\u7684\u540c\u65f6\uff0c\u8fd8\u4f7f\u7528\u4e86\u7b2c\u4e8c\u79cd\u7b56\u7565\uff1a\u5b9a\u671f\u5220\u9664\u7b56\u7565\u3002","title":"2-1 \u60f0\u6027\u5220\u9664\u7b56\u7565"},{"location":"chap7/1Redis_master_slave/#2-2","text":"Redis \u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\uff08\u9ed8\u8ba4 100ms\uff09\uff0c\u5c31\u4f1a\u968f\u673a\u9009\u51fa\u4e00\u5b9a\u6570\u91cf\u7684\u6570\u636e\uff0c\u68c0\u67e5\u5b83\u4eec\u662f\u5426\u8fc7\u671f\uff0c\u5e76\u628a\u5176\u4e2d\u8fc7\u671f\u7684\u6570\u636e\u5220\u9664\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u53ca\u65f6\u91ca\u653e\u4e00\u4e9b\u5185\u5b58\u3002","title":"2-2 \u5b9a\u671f\u5220\u9664\u7b56\u7565"},{"location":"chap7/1Redis_master_slave/#2-3","text":"\u9996\u5148\uff0c\u867d\u7136\u5b9a\u671f\u5220\u9664\u7b56\u7565\u53ef\u4ee5\u91ca\u653e\u4e00\u4e9b\u5185\u5b58\uff0c\u4f46\u662f\uff0cRedis \u4e3a\u4e86\u907f\u514d\u8fc7\u591a\u5220\u9664\u64cd\u4f5c\u5bf9\u6027\u80fd\u4ea7\u751f\u5f71\u54cd\uff0c\u6bcf\u6b21\u968f\u673a\u68c0\u67e5\u6570\u636e\u7684\u6570\u91cf\u5e76\u4e0d\u591a\u3002\u5982\u679c\u8fc7\u671f\u6570\u636e\u5f88\u591a\uff0c\u5e76\u4e14\u4e00\u76f4\u6ca1\u6709\u518d\u88ab\u8bbf\u95ee\u7684\u8bdd\uff0c\u8fd9\u4e9b\u6570\u636e\u5c31\u4f1a\u7559\u5b58\u5728 Redis \u5b9e\u4f8b\u4e2d\u3002\u4e1a\u52a1\u5e94\u7528\u4e4b\u6240\u4ee5\u4f1a\u8bfb\u5230\u8fc7\u671f\u6570\u636e\uff0c\u8fd9\u4e9b\u7559\u5b58\u6570\u636e\u5c31\u662f\u4e00\u4e2a\u91cd\u8981\u56e0\u7d20\u3002 \u5176\u6b21\uff0c\u60f0\u6027\u5220\u9664\u7b56\u7565\u5b9e\u73b0\u540e\uff0c\u6570\u636e\u53ea\u6709\u88ab\u518d\u6b21\u8bbf\u95ee\u65f6\uff0c\u624d\u4f1a\u88ab\u5b9e\u9645\u5220\u9664\u3002\u5982\u679c\u5ba2\u6237\u7aef\u4ece\u4e3b\u5e93\u4e0a\u8bfb\u53d6\u7559\u5b58\u7684\u8fc7\u671f\u6570\u636e\uff0c\u4e3b\u5e93\u4f1a\u89e6\u53d1\u5220\u9664\u64cd\u4f5c\uff0c \u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u5e76\u4e0d\u4f1a\u8bfb\u5230\u8fc7\u671f\u6570\u636e\u3002\u4f46\u662f\uff0c\u4ece\u5e93\u672c\u8eab\u4e0d\u4f1a\u6267\u884c\u5220\u9664\u64cd\u4f5c\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u5728\u4ece\u5e93\u4e2d\u8bbf\u95ee\u7559\u5b58\u7684\u8fc7\u671f\u6570\u636e\uff0c\u4ece\u5e93\u5e76\u4e0d\u4f1a\u89e6\u53d1\u6570\u636e\u5220\u9664 \u3002\u90a3\u4e48\uff0c\u4ece\u5e93\u4f1a\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u8fc7\u671f\u6570\u636e\u5417\uff1f \u548c\u4f7f\u7528\u7684 Redis \u7248\u672c\u6709\u5173\u4e86\u3002\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f Redis 3.2 \u4e4b\u524d\u7684\u7248\u672c\uff0c\u90a3\u4e48\uff0c\u4ece\u5e93\u5728\u670d\u52a1\u8bfb\u8bf7\u6c42\u65f6\uff0c\u5e76\u4e0d\u4f1a\u5224\u65ad\u6570\u636e\u662f\u5426\u8fc7\u671f\uff0c\u800c\u662f\u4f1a\u8fd4\u56de\u8fc7\u671f\u6570\u636e\u3002 \u5728 3.2 \u7248\u672c\u540e\uff0cRedis \u505a\u4e86\u6539\u8fdb\uff0c\u5982\u679c\u8bfb\u53d6\u7684\u6570\u636e\u5df2\u7ecf\u8fc7\u671f\u4e86\uff0c\u4ece\u5e93\u867d\u7136\u4e0d\u4f1a\u5220\u9664\uff0c\u4f46\u662f\u4f1a\u8fd4\u56de\u7a7a\u503c\uff0c\u8fd9\u5c31\u907f\u514d\u4e86\u5ba2\u6237\u7aef\u8bfb\u5230\u8fc7\u671f\u6570\u636e \u3002\u6240\u4ee5\uff0c\u5728\u5e94\u7528\u4e3b\u4ece\u96c6\u7fa4\u65f6\uff0c\u5c3d\u91cf\u4f7f\u7528 Redis 3.2 \u53ca\u4ee5\u4e0a\u7248\u672c\u3002 \u6709\u4e9b\u547d\u4ee4\u7ed9\u6570\u636e\u8bbe\u7f6e\u7684\u8fc7\u671f\u65f6\u95f4\u5728\u4ece\u5e93\u4e0a\u53ef\u80fd\u4f1a\u88ab\u5ef6\u540e\uff0c\u5bfc\u81f4\u5e94\u8be5\u8fc7\u671f\u7684\u6570\u636e\u53c8\u5728\u4ece\u5e93\u4e0a\u88ab\u8bfb\u53d6\u5230\u4e86 \u8bbe\u7f6e\u6570\u636e\u8fc7\u671f\u65f6\u95f4\u7684\u547d\u4ee4\u4e00\u5171\u6709 4 \u4e2a\uff0c\u53ef\u4ee5\u628a\u5b83\u4eec\u5206\u6210\u4e24\u7c7b\uff1a EXPIRE \u548c PEXPIRE\uff1a\u5b83\u4eec\u7ed9\u6570\u636e\u8bbe\u7f6e\u7684\u662f \u4ece\u547d\u4ee4\u6267\u884c\u65f6\u5f00\u59cb\u8ba1\u7b97\u7684\u5b58\u6d3b\u65f6\u95f4 \uff1b EXPIREAT \u548c PEXPIREAT\uff1a \u5b83\u4eec\u4f1a\u76f4\u63a5\u628a\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u5177\u4f53\u7684\u4e00\u4e2a\u65f6\u95f4\u70b9\u3002 \u8fd9 4 \u4e2a\u547d\u4ee4\u7684\u53c2\u6570\u548c\u542b\u4e49\u5982\u4e0b\u8868\u6240\u793a\uff1a \u7b2c\u4e00\u4e2a\u4f8b\u5b50\u662f\u4f7f\u7528 EXPIRE \u547d\u4ee4\uff0c\u5f53\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0c \u6211\u4eec\u5c31\u628a testkey \u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a 60s \u540e\u3002 EXPIRE testkey 60 \u7b2c\u4e8c\u4e2a\u4f8b\u5b50\u662f\u4f7f\u7528 EXPIREAT \u547d\u4ee4\uff0c\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c \u5c31\u53ef\u4ee5\u8ba9 testkey \u5728 2020 \u5e74 10 \u6708 24 \u65e5\u4e0a\u5348 9 \u70b9\u8fc7\u671f\uff0c\u547d\u4ee4\u4e2d\u7684 1603501200 \u5c31\u662f\u4ee5\u79d2\u6570\u65f6\u95f4\u6233\u8868\u793a\u7684 10 \u6708 24 \u65e5\u4e0a\u5348 9 \u70b9 EXPIREAT testkey 1603501200 \u5f53\u4e3b\u4ece\u5e93\u5168\u91cf\u540c\u6b65\u65f6\uff0c\u5982\u679c\u4e3b\u5e93\u63a5\u6536\u5230\u4e86\u4e00\u6761 EXPIRE \u547d\u4ee4\uff0c\u90a3\u4e48\uff0c\u4e3b\u5e93\u4f1a\u76f4\u63a5\u6267\u884c\u8fd9\u6761\u547d\u4ee4\u3002\u8fd9\u6761\u547d\u4ee4\u4f1a\u5728\u5168\u91cf\u540c\u6b65\u5b8c\u6210\u540e\uff0c \u53d1\u7ed9\u4ece\u5e93\u6267\u884c\u3002\u800c\u4ece\u5e93\u5728\u6267\u884c\u65f6\uff0c\u5c31\u4f1a\u5728\u5f53\u524d\u65f6\u95f4\u7684\u57fa\u7840\u4e0a\u52a0\u4e0a\u6570\u636e\u7684\u5b58\u6d3b\u65f6\u95f4\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u4ece\u5e93\u4e0a\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u5c31\u4f1a\u6bd4\u4e3b\u5e93\u4e0a\u5ef6\u540e\u4e86 \u3002 \u5047\u8bbe\u5f53\u524d\u65f6\u95f4\u662f 2020 \u5e74 10 \u6708 24 \u65e5\u4e0a\u5348 9 \u70b9\uff0c\u4e3b\u4ece\u5e93\u6b63\u5728\u540c\u6b65\uff0c\u4e3b\u5e93\u6536\u5230\u4e86\u4e00\u6761\u547d\u4ee4\uff1a EXPIRE testkey 60\uff0c\u8fd9\u5c31\u8868\u793a\uff0ctestkey \u7684\u8fc7\u671f\u65f6\u95f4\u5c31\u662f 24 \u65e5\u4e0a\u5348 9 \u70b9 1 \u5206\uff0c\u4e3b\u5e93\u76f4\u63a5\u6267\u884c\u4e86\u8fd9\u6761\u547d\u4ee4\u3002 \u4f46\u662f\uff0c\u4e3b\u4ece\u5e93\u5168\u91cf\u540c\u6b65\u82b1\u8d39\u4e86 2 \u5206\u949f\u624d\u5b8c\u6210\u3002\u7b49\u4ece\u5e93\u5f00\u59cb\u6267\u884c\u8fd9\u6761\u547d\u4ee4\u65f6\uff0c\u65f6\u95f4\u5df2\u7ecf\u662f 9 \u70b9 2 \u5206\u4e86\u3002 \u800c EXPIRE \u547d\u4ee4\u662f\u628a testkey \u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u5f53\u524d\u65f6\u95f4\u7684 60s \u540e\uff0c\u4e5f\u5c31\u662f 9 \u70b9 3 \u5206\u3002 \u5982\u679c\u5ba2\u6237\u7aef\u5728 9 \u70b9 2 \u5206 30 \u79d2\u65f6\u5728\u4ece\u5e93\u4e0a\u8bfb\u53d6 testkey\uff0c\u4ecd\u7136\u53ef\u4ee5\u8bfb\u5230 testkey \u7684\u503c\u3002\u4f46\u662f\uff0ctestkey \u5b9e\u9645\u4e0a\u5df2\u7ecf\u8fc7\u671f\u4e86\u3002 \u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c \u5efa\u8bae\u662f\uff0c\u5728\u4e1a\u52a1\u5e94\u7528\u4e2d\u4f7f\u7528 EXPIREAT/PEXPIREAT \u547d\u4ee4\uff0c\u628a\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u5177\u4f53\u7684\u65f6\u95f4\u70b9\uff0c\u907f\u514d\u8bfb\u5230\u8fc7\u671f\u6570\u636e\u3002 \u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\u3002Redis \u91c7\u7528\u7684\u662f\u5f02\u6b65\u590d\u5236\uff0c\u6240\u4ee5\u65e0\u6cd5\u5b9e\u73b0\u5f3a\u4e00\u81f4\u6027\u4fdd\u8bc1\uff08\u4e3b\u4ece\u6570\u636e\u65f6\u65f6\u523b\u523b\u4fdd\u6301\u4e00\u81f4\uff09\uff0c\u6570\u636e\u4e0d\u4e00\u81f4\u662f\u96be\u4ee5\u907f\u514d\u7684 \u3002\u6211\u7ed9\u4f60\u63d0\u4f9b\u4e86\u5e94\u5bf9\u65b9\u6cd5\uff1a\u4fdd\u8bc1\u826f\u597d\u7f51\u7edc\u73af\u5883\uff0c\u4ee5\u53ca\u4f7f\u7528\u7a0b\u5e8f\u76d1\u63a7\u4ece\u5e93\u590d\u5236\u8fdb\u5ea6\uff0c\u4e00\u65e6\u4ece\u5e93\u590d\u5236\u8fdb\u5ea6\u8d85\u8fc7\u9608\u503c\uff0c\u4e0d\u8ba9\u5ba2\u6237\u7aef\u8fde\u63a5\u4ece\u5e93\u3002 \u5bf9\u4e8e\u8bfb\u5230\u8fc7\u671f\u6570\u636e\uff0c\u8fd9\u662f\u53ef\u4ee5\u63d0\u524d\u89c4\u907f\u7684 \uff0c \u4e00\u4e2a\u65b9\u6cd5\u662f\uff0c\u4f7f\u7528 Redis 3.2 \u53ca\u4ee5\u4e0a\u7248\u672c\uff1b\u53e6\u5916\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 EXPIREAT/PEXPIREAT \u547d\u4ee4\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u907f\u514d\u4ece\u5e93\u4e0a\u7684\u6570\u636e\u8fc7\u671f\u65f6\u95f4\u6ede\u540e \u3002\u4e0d\u8fc7\uff0c\u8fd9\u91cc\u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\u4e0b\uff0c \u56e0\u4e3a EXPIREAT/PEXPIREAT \u8bbe\u7f6e\u7684\u662f\u65f6\u95f4\u70b9\uff0c\u6240\u4ee5\uff0c\u4e3b\u4ece\u8282\u70b9\u4e0a\u7684\u65f6\u949f\u8981\u4fdd\u6301\u4e00\u81f4\uff0c\u5177\u4f53\u7684\u505a\u6cd5\u662f\uff0c\u8ba9\u4e3b\u4ece\u8282\u70b9\u548c\u76f8\u540c\u7684 NTP \u670d\u52a1\u5668\uff08\u65f6\u95f4\u670d\u52a1\u5668\uff09\u8fdb\u884c\u65f6\u949f\u540c\u6b65\u3002","title":"2-3 \u5b83\u4eec\u4e3a\u4ec0\u4e48\u4f1a\u5bfc\u81f4\u8bfb\u53d6\u5230\u8fc7\u671f\u6570\u636e"},{"location":"chap7/1Redis_master_slave/#3","text":"\u8fd9\u91cc\u6d89\u53ca\u5230\u7684\u914d\u7f6e\u9879\u6709\u4e24\u4e2a\uff0c\u5206\u522b\u662f protected-mode \u548c cluster-node-timeout \u3002","title":"3\u3001\u4e0d\u5408\u7406\u914d\u7f6e\u9879\u5bfc\u81f4\u7684\u670d\u52a1\u6302\u6389"},{"location":"chap7/1Redis_master_slave/#3-1-protected-mode","text":"\u8fd9\u4e2a\u914d\u7f6e\u9879\u7684\u4f5c\u7528\u662f\u9650\u5b9a\u54e8\u5175\u5b9e\u4f8b\u80fd\u5426\u88ab\u5176\u4ed6\u670d\u52a1\u5668\u8bbf\u95ee\u3002 \u5f53\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a yes \u65f6\uff0c\u54e8\u5175\u5b9e\u4f8b\u53ea\u80fd\u5728\u90e8\u7f72\u7684\u670d\u52a1\u5668\u672c\u5730\u8fdb\u884c\u8bbf\u95ee\u3002\u5f53\u8bbe\u7f6e\u4e3a no \u65f6\uff0c\u5176\u4ed6\u670d\u52a1\u5668\u4e5f\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e2a\u54e8\u5175\u5b9e\u4f8b\u3002 \u6b63\u56e0\u4e3a\u8fd9\u6837\uff0c \u5982\u679c protected-mode \u88ab\u8bbe\u7f6e\u4e3a yes\uff0c\u800c\u5176\u4f59\u54e8\u5175\u5b9e\u4f8b\u90e8\u7f72\u5728\u5176\u5b83\u670d\u52a1\u5668\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e9b\u54e8\u5175\u5b9e\u4f8b\u95f4\u5c31\u65e0\u6cd5\u901a\u4fe1 \u3002 \u5f53\u4e3b\u5e93\u6545\u969c\u65f6\uff0c\u54e8\u5175\u65e0\u6cd5\u5224\u65ad\u4e3b\u5e93\u4e0b\u7ebf\uff0c\u4e5f\u65e0\u6cd5\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u6700\u7ec8 Redis \u670d\u52a1\u4e0d\u53ef\u7528\u3002 \u5728\u5e94\u7528\u4e3b\u4ece\u96c6\u7fa4\u65f6\uff0c\u8981\u6ce8\u610f\u5c06 protected-mode \u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a no\uff0c\u5e76\u4e14\u5c06 bind \u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a\u5176\u5b83\u54e8\u5175\u5b9e\u4f8b\u7684 IP \u5730\u5740\u3002 \u53ea\u6709\u5728 bind \u4e2d\u8bbe\u7f6e\u4e86 IP \u5730\u5740\u7684\u54e8\u5175\uff0c\u624d\u53ef\u4ee5\u8bbf\u95ee\u5f53\u524d\u5b9e\u4f8b\uff0c\u65e2\u4fdd\u8bc1\u4e86\u5b9e\u4f8b\u95f4\u80fd\u591f\u901a\u4fe1\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u4e5f\u4fdd\u8bc1\u4e86\u54e8\u5175\u7684\u5b89\u5168\u6027\u3002 \u5982\u679c\u8bbe\u7f6e\u4e86\u4e0b\u9762\u7684\u914d\u7f6e\u9879\uff0c\u90a3\u4e48\uff0c\u90e8\u7f72\u5728 192.168.10.3/4/5 \u8fd9\u4e09\u53f0\u670d\u52a1\u5668\u4e0a\u7684\u54e8\u5175\u5b9e\u4f8b\u5c31\u53ef\u4ee5\u76f8\u4e92\u901a\u4fe1\uff0c\u6267\u884c\u4e3b\u4ece\u5207\u6362\u3002 protected-mode no bind 192.168.10.3 192.168.10.4 192.168.10.5","title":"3-1 protected-mode \u914d\u7f6e\u9879"},{"location":"chap7/1Redis_master_slave/#3-2-cluster-node-timeout","text":"\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e86 Redis Cluster \u4e2d\u5b9e\u4f8b\u54cd\u5e94\u5fc3\u8df3\u6d88\u606f\u7684\u8d85\u65f6\u65f6\u95f4\u3002 Redis Cluster \u96c6\u7fa4\u4e2d\u4e3a\u6bcf\u4e2a\u5b9e\u4f8b\u914d\u7f6e\u4e86\u201c\u4e00\u4e3b\u4e00\u4ece\u201d\u6a21\u5f0f\u65f6\uff0c\u5982\u679c\u4e3b\u5b9e\u4f8b\u53d1\u751f\u6545\u969c\uff0c\u4ece\u5b9e\u4f8b\u4f1a\u5207\u6362\u4e3a\u4e3b\u5b9e\u4f8b\uff0c\u53d7\u7f51\u7edc\u5ef6\u8fdf\u548c\u5207\u6362\u64cd\u4f5c\u6267\u884c\u7684\u5f71\u54cd\uff0c\u5207\u6362\u65f6\u95f4\u53ef\u80fd\u8f83\u957f\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5b9e\u4f8b\u7684\u5fc3\u8df3\u8d85\u65f6\uff08\u8d85\u51fa cluster-node-timeout\uff09\u3002 \u5b9e\u4f8b\u8d85\u65f6\u540e\uff0c\u5c31\u4f1a\u88ab Redis Cluster \u5224\u65ad\u4e3a\u5f02\u5e38\u3002\u800c Redis Cluster \u6b63\u5e38\u8fd0\u884c\u7684\u6761\u4ef6\u5c31\u662f\uff0c\u6709\u534a\u6570\u4ee5\u4e0a\u7684\u5b9e\u4f8b\u90fd\u80fd\u6b63\u5e38\u8fd0\u884c\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u6267\u884c\u4e3b\u4ece\u5207\u6362\u7684\u5b9e\u4f8b\u8d85\u8fc7\u534a\u6570\uff0c\u800c\u4e3b\u4ece\u5207\u6362\u65f6\u95f4\u53c8\u8fc7\u957f\u7684\u8bdd\uff0c\u5c31\u53ef\u80fd\u6709\u534a\u6570\u4ee5\u4e0a\u7684\u5b9e\u4f8b\u5fc3\u8df3\u8d85\u65f6\uff0c\u4ece\u800c\u53ef\u80fd\u5bfc\u81f4\u6574\u4e2a\u96c6\u7fa4\u6302\u6389\u3002\u6240\u4ee5\uff0c\u5efa\u8bae\u4f60\u5c06 cluster-node-timeout \u8c03\u5927\u4e9b\uff08\u4f8b\u5982 10 \u5230 20 \u79d2\uff09\u3002","title":"3-2 cluster-node-timeout \u914d\u7f6e\u9879"},{"location":"chap7/1Redis_master_slave/#4","text":"Redis \u4e3b\u4ece\u5e93\u540c\u6b65\u65f6\u53ef\u80fd\u51fa\u73b0\u7684 3 \u4e2a\u5751\uff0c\u5206\u522b\u662f\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\u3001\u8bfb\u53d6\u5230\u8fc7\u671f\u6570\u636e\u548c\u4e0d\u5408\u7406\u914d\u7f6e\u9879\u5bfc\u81f4\u670d\u52a1\u6302\u6389\u3002 \u5173\u4e8e\u4e3b\u4ece\u5e93\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\uff1a Redis \u4e2d\u7684 slave-serve-stale-data \u914d\u7f6e\u9879\u8bbe\u7f6e\u4e86\u4ece\u5e93\u80fd\u5426\u5904\u7406\u6570\u636e\u8bfb\u5199\u547d\u4ee4\uff0c\u4f60\u53ef\u4ee5\u628a\u5b83\u8bbe\u7f6e\u4e3a no \u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4ece\u5e93\u53ea\u80fd\u670d\u52a1 INFO\u3001SLAVEOF \u547d\u4ee4\uff0c\u8fd9\u5c31\u53ef\u4ee5\u907f\u514d\u5728\u4ece\u5e93\u4e2d\u8bfb\u5230\u4e0d\u4e00\u81f4\u7684\u6570\u636e\u4e86\u3002 \u8fd9\u4e2a\u914d\u7f6e\u9879\u548c slave-read-only \u7684\u533a\u522b\uff0c slave-read-only \u662f\u8bbe\u7f6e\u4ece\u5e93\u80fd\u5426\u5904\u7406\u5199\u547d\u4ee4\uff0c slave-read-only \u8bbe\u7f6e\u4e3a yes \u65f6\uff0c\u4ece\u5e93\u53ea\u80fd\u5904\u7406\u8bfb\u8bf7\u6c42\uff0c\u65e0\u6cd5\u5904\u7406\u5199\u8bf7\u6c42\uff0c\u4f60\u53ef\u4e0d\u8981\u641e\u6df7\u4e86\u3002","title":"4\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap7/2redis_brain_split/","text":"\u7b2c\u4e8c\u8282 \u8111\u88c2\u5bfc\u81f4\u6570\u636e\u4e22\u5931 \u4e00\u4e2a\u95ee\u9898\uff1a\u6211\u4eec\u7684\u4e3b\u4ece\u96c6\u7fa4\u6709 1 \u4e2a\u4e3b\u5e93\u30015 \u4e2a\u4ece\u5e93\u548c 3 \u4e2a\u54e8\u5175\u5b9e\u4f8b\uff0c\u5728\u4f7f\u7528\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53d1\u73b0\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u4e00\u4e9b\u6570\u636e\u4e22\u5931\u4e86\uff0c\u8fd9\u76f4\u63a5\u5f71\u54cd\u5230\u4e86\u4e1a\u52a1\u5c42\u7684\u6570\u636e\u53ef\u9760\u6027\u3002 \u6240\u8c13\u7684\u8111\u88c2\uff0c\u5c31\u662f\u6307\u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c\u540c\u65f6\u6709\u4e24\u4e2a\u4e3b\u8282\u70b9\uff0c\u5b83\u4eec\u90fd\u80fd\u63a5\u6536\u5199\u8bf7\u6c42 \u3002 \u800c\u8111\u88c2\u6700\u76f4\u63a5\u7684\u5f71\u54cd\uff0c\u5c31\u662f\u5ba2\u6237\u7aef\u4e0d\u77e5\u9053\u5e94\u8be5\u5f80\u54ea\u4e2a\u4e3b\u8282\u70b9\u5199\u5165\u6570\u636e\uff0c\u7ed3\u679c\u5c31\u662f\u4e0d\u540c\u7684\u5ba2\u6237\u7aef\u4f1a\u5f80\u4e0d\u540c\u7684\u4e3b\u8282\u70b9\u4e0a\u5199\u5165\u6570\u636e\u3002\u800c\u4e14\uff0c\u4e25\u91cd\u7684\u8bdd\uff0c\u8111\u88c2\u4f1a\u8fdb\u4e00\u6b65\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u3002 1\u3001\u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u8111\u88c2\uff1f 1-1 \u786e\u8ba4\u662f\u4e0d\u662f\u6570\u636e\u540c\u6b65\u51fa\u73b0\u4e86\u95ee\u9898 \u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\u53d1\u751f\u6570\u636e\u4e22\u5931\uff0c \u6700\u5e38\u89c1\u7684\u539f\u56e0\u5c31\u662f\u4e3b\u5e93\u7684\u6570\u636e\u8fd8\u6ca1\u6709\u540c\u6b65\u5230\u4ece\u5e93\uff0c\u7ed3\u679c\u4e3b\u5e93\u53d1\u751f\u4e86\u6545\u969c\uff0c\u7b49\u4ece\u5e93\u5347\u7ea7\u4e3a\u4e3b\u5e93\u540e\uff0c\u672a\u540c\u6b65\u7684\u6570\u636e\u5c31\u4e22\u5931\u4e86 \u3002 \u65b0\u5199\u5165\u4e3b\u5e93\u7684\u6570\u636e a:1\u3001b:3 \uff0c\u5c31\u56e0\u4e3a\u5728\u4e3b\u5e93\u6545\u969c\u524d\u672a\u540c\u6b65\u5230\u4ece\u5e93\u800c\u4e22\u5931\u4e86\u3002 \u5982\u679c\u662f\u8fd9\u79cd\u60c5\u51b5\u7684\u6570\u636e\u4e22\u5931\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6bd4\u5bf9\u4e3b\u4ece\u5e93\u4e0a\u7684\u590d\u5236\u8fdb\u5ea6\u5dee\u503c\u6765\u8fdb\u884c\u5224\u65ad\uff0c\u4e5f\u5c31\u662f\u8ba1\u7b97 master_repl_offset \u548c slave_repl_offset \u7684\u5dee\u503c\u3002 \u5982\u679c\u4ece\u5e93\u4e0a\u7684 slave_repl_offset \u5c0f\u4e8e\u539f\u4e3b\u5e93\u7684 master_repl_offset \uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba4\u5b9a\u6570\u636e\u4e22\u5931\u662f\u7531\u6570\u636e\u540c\u6b65\u672a\u5b8c\u6210\u5bfc\u81f4\u7684\u3002 \u90e8\u7f72\u4e3b\u4ece\u96c6\u7fa4\u65f6\uff0c\u4e5f\u76d1\u6d4b\u4e86\u4e3b\u5e93\u4e0a\u7684 master_repl_offset \uff0c\u4ee5\u53ca\u4ece\u5e93\u4e0a\u7684 slave_repl_offset \u3002 \u4f46\u662f\uff0c\u53d1\u73b0\u6570\u636e\u4e22\u5931\u540e\uff0c\u6211\u4eec\u68c0\u67e5\u4e86\u65b0\u4e3b\u5e93\u5347\u7ea7\u524d\u7684 slave_repl_offset \uff0c\u4ee5\u53ca\u539f\u4e3b\u5e93\u7684 master_repl_offset \uff0c\u5b83\u4eec\u662f\u4e00\u81f4\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u4e2a\u5347\u7ea7\u4e3a\u65b0\u4e3b\u5e93\u7684\u4ece\u5e93\uff0c\u5728\u5347\u7ea7\u65f6\u5df2\u7ecf\u548c\u539f\u4e3b\u5e93\u7684\u6570\u636e\u4fdd\u6301\u4e00\u81f4\u4e86\u3002\u90a3\u4e48\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u4f1a\u51fa\u73b0\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u6570\u636e\u4e22\u5931\u5462\uff1f 1-2 \u6392\u67e5\u5ba2\u6237\u7aef\u7684\u64cd\u4f5c\u65e5\u5fd7\uff0c\u53d1\u73b0\u8111\u88c2\u73b0\u8c61 \u5728\u6392\u67e5\u5ba2\u6237\u7aef\u7684\u64cd\u4f5c\u65e5\u5fd7\u65f6\uff0c \u5728\u4e3b\u4ece\u5207\u6362\u540e\u7684\u4e00\u6bb5\u65f6\u95f4\u5185\uff0c\u6709\u4e00\u4e2a\u5ba2\u6237\u7aef\u4ecd\u7136\u5728\u548c\u539f\u4e3b\u5e93\u901a\u4fe1\uff0c\u5e76\u6ca1\u6709\u548c\u5347\u7ea7\u7684\u65b0\u4e3b\u5e93\u8fdb\u884c\u4ea4\u4e92 \u3002 \u8fd9\u5c31\u76f8\u5f53\u4e8e\u4e3b\u4ece\u96c6\u7fa4\u4e2d\u540c\u65f6\u6709\u4e86\u4e24\u4e2a\u4e3b\u5e93\u3002\u6839\u636e\u8fd9\u4e2a\u8ff9\u8c61\uff0c\u5728\u5206\u5e03\u5f0f\u4e3b\u4ece\u96c6\u7fa4\u53d1\u751f\u6545\u969c\u65f6\u4f1a\u51fa\u73b0\u7684\u4e00\u4e2a\u95ee\u9898\uff1a\u8111\u88c2\u3002 \u4f46\u662f\uff0c\u4e0d\u540c\u5ba2\u6237\u7aef\u7ed9\u4e24\u4e2a\u4e3b\u5e93\u53d1\u9001\u6570\u636e\u5199\u64cd\u4f5c\uff0c\u53ea\u4f1a\u5bfc\u81f4\u65b0\u6570\u636e\u4f1a\u5206\u5e03\u5728\u4e0d\u540c\u7684\u4e3b\u5e93\u4e0a\uff0c\u5e76\u4e0d\u4f1a\u9020\u6210\u6570\u636e\u4e22\u5931\u3002 1-3 \u53d1\u73b0\u662f\u539f\u4e3b\u5e93\u5047\u6545\u969c\u5bfc\u81f4\u7684\u8111\u88c2 \u91c7\u7528\u54e8\u5175\u673a\u5236\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\u7684\uff0c \u5f53\u4e3b\u4ece\u5207\u6362\u53d1\u751f\u65f6\uff0c\u4e00\u5b9a\u662f\u6709\u8d85\u8fc7\u9884\u8bbe\u6570\u91cf\uff08quorum \u914d\u7f6e\u9879\uff09\u7684\u54e8\u5175\u5b9e\u4f8b\u548c\u4e3b\u5e93\u7684\u5fc3\u8df3\u90fd\u8d85\u65f6\u4e86\uff0c\u624d\u4f1a\u628a\u4e3b\u5e93\u5224\u65ad\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\uff0c\u7136\u540e\uff0c\u54e8\u5175\u5f00\u59cb\u6267\u884c\u5207\u6362\u64cd\u4f5c \u3002\u54e8\u5175\u5207\u6362\u5b8c\u6210\u540e\uff0c\u5ba2\u6237\u7aef\u4f1a\u548c\u65b0\u4e3b\u5e93\u8fdb\u884c\u901a\u4fe1\uff0c\u53d1\u9001\u8bf7\u6c42\u64cd\u4f5c\u3002 \u4f46\u662f\uff0c\u5728\u5207\u6362\u8fc7\u7a0b\u4e2d\uff0c\u65e2\u7136\u5ba2\u6237\u7aef\u4ecd\u7136\u548c\u539f\u4e3b\u5e93\u901a\u4fe1\uff0c\u8fd9\u5c31\u8868\u660e\uff0c\u539f\u4e3b\u5e93\u5e76\u6ca1\u6709\u771f\u7684\u53d1\u751f\u6545\u969c\uff08\u4f8b\u5982\u4e3b\u5e93\u8fdb\u7a0b\u6302\u6389\uff09\u3002 \u4e3b\u5e93\u662f\u7531\u4e8e\u67d0\u4e9b\u539f\u56e0\u65e0\u6cd5\u5904\u7406\u8bf7\u6c42\uff0c\u4e5f\u6ca1\u6709\u54cd\u5e94\u54e8\u5175\u7684\u5fc3\u8df3\uff0c\u624d\u88ab\u54e8\u5175\u9519\u8bef\u5730\u5224\u65ad\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\u7684\u3002\u7ed3\u679c\uff0c\u5728\u88ab\u5224\u65ad\u4e0b\u7ebf\u4e4b\u540e\uff0c\u539f\u4e3b\u5e93\u53c8\u91cd\u65b0\u5f00\u59cb\u5904\u7406\u8bf7\u6c42\u4e86\uff0c\u800c\u6b64\u65f6\uff0c\u54e8\u5175\u8fd8\u6ca1\u6709\u5b8c\u6210\u4e3b\u4ece\u5207\u6362\uff0c\u5ba2\u6237\u7aef\u4ecd\u7136\u53ef\u4ee5\u548c\u539f\u4e3b\u5e93\u901a\u4fe1\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u5199\u64cd\u4f5c\u5c31\u4f1a\u5728\u539f\u4e3b\u5e93\u4e0a\u5199\u5165\u6570\u636e\u4e86\u3002 \u201c\u5047\u6545\u969c\u201d\uff0c\u67e5\u770b\u539f\u4e3b\u5e93\u6240\u5728\u670d\u52a1\u5668\u7684\u8d44\u6e90\u4f7f\u7528\u76d1\u63a7\u8bb0\u5f55 \u539f\u4e3b\u5e93\u6240\u5728\u7684\u673a\u5668\u6709\u4e00\u6bb5\u65f6\u95f4\u7684 CPU \u5229\u7528\u7387\u7a81\u7136\u7279\u522b\u9ad8\uff0c\u8fd9\u662f\u6211\u4eec\u5728\u673a\u5668\u4e0a\u90e8\u7f72\u7684\u4e00\u4e2a\u6570\u636e\u91c7\u96c6\u7a0b\u5e8f\u5bfc\u81f4\u7684\u3002 \u56e0\u4e3a\u8fd9\u4e2a\u7a0b\u5e8f\u57fa\u672c\u628a\u673a\u5668\u7684 CPU \u90fd\u7528\u6ee1\u4e86\uff0c\u5bfc\u81f4 Redis \u4e3b\u5e93\u65e0\u6cd5\u54cd\u5e94\u5fc3\u8df3\u4e86\uff0c\u5728\u8fd9\u4e2a\u671f\u95f4\u5185\uff0c\u54e8\u5175\u5c31\u628a\u4e3b\u5e93\u5224\u65ad\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\uff0c\u5f00\u59cb\u4e3b\u4ece\u5207\u6362\u4e86\u3002 \u4e0d\u8fc7\uff0c\u8fd9\u4e2a\u6570\u636e\u91c7\u96c6\u7a0b\u5e8f\u5f88\u5feb\u6062\u590d\u6b63\u5e38\uff0cCPU \u7684\u4f7f\u7528\u7387\u4e5f\u964d\u4e0b\u6765\u4e86\u3002\u6b64\u65f6\uff0c\u539f\u4e3b\u5e93\u53c8\u5f00\u59cb\u6b63\u5e38\u670d\u52a1\u8bf7\u6c42\u4e86\u3002 \u6b63\u56e0\u4e3a\u539f\u4e3b\u5e93\u5e76\u6ca1\u6709\u771f\u7684\u53d1\u751f\u6545\u969c\uff0c\u6211\u4eec\u5728\u5ba2\u6237\u7aef\u64cd\u4f5c\u65e5\u5fd7\u4e2d\u5c31\u770b\u5230\u4e86\u548c\u539f\u4e3b\u5e93\u7684\u901a\u4fe1\u8bb0\u5f55\u3002 \u7b49\u5230\u4ece\u5e93\u88ab\u5347\u7ea7\u4e3a\u65b0\u4e3b\u5e93\u540e\uff0c\u4e3b\u4ece\u96c6\u7fa4\u91cc\u5c31\u6709\u4e24\u4e2a\u4e3b\u5e93\u4e86\uff0c\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u5c31\u628a\u8111\u88c2\u53d1\u751f\u7684\u539f\u56e0\u6478\u6e05\u695a\u4e86 \u3002 2\u3001\u4e3a\u4ec0\u4e48\u8111\u88c2\u4f1a\u5bfc\u81f4\u6570\u636e\u4e22\u5931\uff1f \u4e3b\u4ece\u5207\u6362\u540e\uff0c\u4ece\u5e93\u4e00\u65e6\u5347\u7ea7\u4e3a\u65b0\u4e3b\u5e93\uff0c\u54e8\u5175\u5c31\u4f1a\u8ba9\u539f\u4e3b\u5e93\u6267\u884c slave of \u547d\u4ee4\uff0c\u548c\u65b0\u4e3b\u5e93\u91cd\u65b0\u8fdb\u884c\u5168\u91cf\u540c\u6b65\u3002 \u800c\u5728\u5168\u91cf\u540c\u6b65\u6267\u884c\u7684\u6700\u540e\u9636\u6bb5\uff0c\u539f\u4e3b\u5e93\u9700\u8981\u6e05\u7a7a\u672c\u5730\u7684\u6570\u636e\uff0c\u52a0\u8f7d\u65b0\u4e3b\u5e93\u53d1\u9001\u7684 RDB \u6587\u4ef6\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u539f\u4e3b\u5e93\u5728\u4e3b\u4ece\u5207\u6362\u671f\u95f4\u4fdd\u5b58\u7684\u65b0\u5199\u6570\u636e\u5c31\u4e22\u5931\u4e86 \u3002 \u5728\u4e3b\u4ece\u5207\u6362\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u539f\u4e3b\u5e93\u53ea\u662f\u201c\u5047\u6545\u969c\u201d\uff0c\u5b83\u4f1a\u89e6\u53d1\u54e8\u5175\u542f\u52a8\u4e3b\u4ece\u5207\u6362\uff0c\u4e00\u65e6\u7b49\u5b83\u4ece\u5047\u6545\u969c\u4e2d\u6062\u590d\u540e\uff0c\u53c8\u5f00\u59cb\u5904\u7406\u8bf7\u6c42\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5c31\u4f1a\u548c\u65b0\u4e3b\u5e93\u540c\u65f6\u5b58\u5728\uff0c\u5f62\u6210\u8111\u88c2\u3002\u7b49\u5230\u54e8\u5175\u8ba9\u539f\u4e3b\u5e93\u548c\u65b0\u4e3b\u5e93\u505a\u5168\u91cf\u540c\u6b65\u540e\uff0c\u539f\u4e3b\u5e93\u5728\u5207\u6362\u671f\u95f4\u4fdd\u5b58\u7684\u6570\u636e\u5c31\u4e22\u5931\u4e86\u3002 3\u3001\u5982\u4f55\u5e94\u5bf9\u8111\u88c2\u95ee\u9898\uff1f \u4e3b\u4ece\u96c6\u7fa4\u673a\u5236\u7684\u914d\u7f6e\u9879\u4e2d\u67e5\u627e\u662f\u5426\u6709\u9650\u5236\u4e3b\u5e93\u63a5\u6536\u8bf7\u6c42\u7684\u8bbe\u7f6e\u3002 \u901a\u8fc7\u67e5\u627e\uff0c Redis \u5df2\u7ecf\u63d0\u4f9b\u4e86\u4e24\u4e2a\u914d\u7f6e\u9879\u6765\u9650\u5236\u4e3b\u5e93\u7684\u8bf7\u6c42\u5904\u7406\uff0c\u5206\u522b\u662f min-slaves-to-write \u548c min-slaves-max-lag \u3002 min-slaves-to-write \uff1a\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e86 \u4e3b\u5e93\u80fd\u8fdb\u884c\u6570\u636e\u540c\u6b65\u7684\u6700\u5c11\u4ece\u5e93\u6570\u91cf \uff1b min-slaves-max-lag \uff1a\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e86 \u4e3b\u4ece\u5e93\u95f4\u8fdb\u884c\u6570\u636e\u590d\u5236\u65f6\uff0c\u4ece\u5e93\u7ed9\u4e3b\u5e93\u53d1\u9001 ACK \u6d88\u606f\u7684\u6700\u5927\u5ef6\u8fdf\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09 \u3002 \u53ef\u4ee5\u628a min-slaves-to-write \u548c min-slaves-max-lag \u8fd9\u4e24\u4e2a\u914d\u7f6e\u9879\u642d\u914d\u8d77\u6765\u4f7f\u7528\uff0c\u5206\u522b\u7ed9\u5b83\u4eec\u8bbe\u7f6e\u4e00\u5b9a\u7684\u9608\u503c\uff0c\u5047\u8bbe\u4e3a N \u548c T \u3002 \u8fd9\u4e24\u4e2a\u914d\u7f6e\u9879\u7ec4\u5408\u540e\u7684\u8981\u6c42\u662f\uff0c \u4e3b\u5e93\u8fde\u63a5\u7684\u4ece\u5e93\u4e2d\u81f3\u5c11\u6709 N \u4e2a\u4ece\u5e93\uff0c\u548c\u4e3b\u5e93\u8fdb\u884c\u6570\u636e\u590d\u5236\u65f6\u7684 ACK \u6d88\u606f\u5ef6\u8fdf\u4e0d\u80fd\u8d85\u8fc7 T \u79d2\uff0c\u5426\u5219\uff0c\u4e3b\u5e93\u5c31\u4e0d\u4f1a\u518d\u63a5\u6536\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42 \u4e86\u3002 \u5373\u4f7f\u539f\u4e3b\u5e93\u662f\u5047\u6545\u969c\uff0c\u5b83\u5728\u5047\u6545\u969c\u671f\u95f4\u4e5f\u65e0\u6cd5\u54cd\u5e94\u54e8\u5175\u5fc3\u8df3\uff0c\u4e5f\u4e0d\u80fd\u548c\u4ece\u5e93\u8fdb\u884c\u540c\u6b65\uff0c\u81ea\u7136\u4e5f\u5c31\u65e0\u6cd5\u548c\u4ece\u5e93\u8fdb\u884c ACK \u786e\u8ba4\u4e86 \u3002 \u8fd9\u6837\u4e00\u6765\uff0c min-slaves-to-write \u548c min-slaves-max-lag \u7684\u7ec4\u5408\u8981\u6c42\u5c31\u65e0\u6cd5\u5f97\u5230\u6ee1\u8db3\uff0c \u539f\u4e3b\u5e93\u5c31\u4f1a\u88ab\u9650\u5236\u63a5\u6536\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u5ba2\u6237\u7aef\u4e5f\u5c31\u4e0d\u80fd\u5728\u539f\u4e3b\u5e93\u4e2d\u5199\u5165\u65b0\u6570\u636e\u4e86\u3002 \u7b49\u5230\u65b0\u4e3b\u5e93\u4e0a\u7ebf\u65f6\uff0c\u5c31\u53ea\u6709\u65b0\u4e3b\u5e93\u80fd\u63a5\u6536\u548c\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u6b64\u65f6\uff0c\u65b0\u5199\u7684\u6570\u636e\u4f1a\u88ab\u76f4\u63a5\u5199\u5230\u65b0\u4e3b\u5e93\u4e2d\u3002\u800c\u539f\u4e3b\u5e93\u4f1a\u88ab\u54e8\u5175\u964d\u4e3a\u4ece\u5e93\uff0c\u5373\u4f7f\u5b83\u7684\u6570\u636e\u88ab\u6e05\u7a7a\u4e86\uff0c\u4e5f\u4e0d\u4f1a\u6709\u65b0\u6570\u636e\u4e22\u5931\u3002 \u5047\u8bbe\u6211\u4eec\u5c06 min-slaves-to-write \u8bbe\u7f6e\u4e3a 1 \u628a min-slaves-max-lag \u8bbe\u7f6e\u4e3a 12s \u628a\u54e8\u5175\u7684 down-after-milliseconds \u8bbe\u7f6e\u4e3a 10s down-after-milliseconds \u662f\u6211\u4eec\u8ba4\u5b9a\u4e3b\u4ece\u5e93\u65ad\u8fde\u7684\u6700\u5927\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\u3002\u5982\u679c\u5728 down-after-milliseconds \u6beb\u79d2\u5185\uff0c\u4e3b\u4ece\u8282\u70b9\u90fd\u6ca1\u6709\u901a\u8fc7\u7f51\u7edc\u8054\u7cfb\u4e0a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba4\u4e3a\u4e3b\u4ece\u8282\u70b9\u65ad\u8fde\u4e86\u3002 \u5982\u4f55\u9009\u5b9a\u65b0\u4e3b\u5e93\uff1f \u4e3b\u5e93\u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0\u5361\u4f4f\u4e86 15s\uff0c\u5bfc\u81f4\u54e8\u5175\u5224\u65ad\u4e3b\u5e93\u5ba2\u89c2\u4e0b\u7ebf\uff0c\u5f00\u59cb\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\u3002 \u540c\u65f6\uff0c\u56e0\u4e3a\u539f\u4e3b\u5e93\u5361\u4f4f\u4e86 15s\uff0c\u6ca1\u6709\u4e00\u4e2a\u4ece\u5e93\u80fd\u548c\u539f\u4e3b\u5e93\u5728 12s \u5185\u8fdb\u884c\u6570\u636e\u590d\u5236\uff0c\u539f\u4e3b\u5e93\u4e5f\u65e0\u6cd5\u63a5\u6536\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e86\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4e3b\u4ece\u5207\u6362\u5b8c\u6210\u540e\uff0c\u4e5f\u53ea\u6709\u65b0\u4e3b\u5e93\u80fd\u63a5\u6536\u8bf7\u6c42\uff0c\u4e0d\u4f1a\u53d1\u751f\u8111\u88c2\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u53d1\u751f\u6570\u636e\u4e22\u5931\u7684\u95ee\u9898\u4e86\u3002 4\u3001\u672c\u8282\u5c0f\u7ed3 \u8111\u88c2\u662f\u6307\u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c\u540c\u65f6\u6709\u4e24\u4e2a\u4e3b\u5e93\u90fd\u80fd\u63a5\u6536\u5199\u8bf7\u6c42\u3002\u5728 Redis \u7684\u4e3b\u4ece\u5207\u6362\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u53d1\u751f\u4e86\u8111\u88c2\uff0c\u5ba2\u6237\u7aef\u6570\u636e\u5c31\u4f1a\u5199\u5165\u5230\u539f\u4e3b\u5e93\uff0c\u5982\u679c\u539f\u4e3b\u5e93\u88ab\u964d\u4e3a\u4ece\u5e93\uff0c\u8fd9\u4e9b\u65b0\u5199\u5165\u7684\u6570\u636e\u5c31\u4e22\u5931\u4e86\u3002 \u8111\u88c2\u53d1\u751f\u7684\u539f\u56e0\u4e3b\u8981\u662f\u539f\u4e3b\u5e93\u53d1\u751f\u4e86\u5047\u6545\u969c\uff0c\u603b\u7ed3\u4e0b\u5047\u6545\u969c\u7684\u4e24\u4e2a\u539f\u56e0\u3002 \u548c\u4e3b\u5e93\u90e8\u7f72\u5728\u540c\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u7684\u5176\u4ed6\u7a0b\u5e8f\u4e34\u65f6\u5360\u7528\u4e86\u5927\u91cf\u8d44\u6e90\uff08\u4f8b\u5982 CPU \u8d44\u6e90\uff09\uff0c\u5bfc\u81f4\u4e3b\u5e93\u8d44\u6e90\u4f7f\u7528\u53d7\u9650\uff0c\u77ed\u65f6\u95f4\u5185\u65e0\u6cd5\u54cd\u5e94\u5fc3\u8df3 \u3002\u5176\u5b83\u7a0b\u5e8f\u4e0d\u518d\u4f7f\u7528\u8d44\u6e90\u65f6\uff0c\u4e3b\u5e93\u53c8\u6062\u590d\u6b63\u5e38\u3002 \u4e3b\u5e93\u81ea\u8eab\u9047\u5230\u4e86\u963b\u585e\u7684\u60c5\u51b5\uff0c\u4f8b\u5982\uff0c\u5904\u7406 bigkey \u6216\u662f\u53d1\u751f\u5185\u5b58 swap\uff0c\u77ed\u65f6\u95f4\u5185\u65e0\u6cd5\u54cd\u5e94\u5fc3\u8df3\uff0c\u7b49\u4e3b\u5e93\u963b\u585e\u89e3\u9664\u540e\uff0c\u53c8\u6062\u590d\u6b63\u5e38\u7684\u8bf7\u6c42\u5904\u7406\u4e86\u3002 \u4e3a\u4e86\u5e94\u5bf9\u8111\u88c2\uff0c\u53ef\u4ee5\u5728\u4e3b\u4ece\u96c6\u7fa4\u90e8\u7f72\u65f6\uff0c\u901a\u8fc7\u5408\u7406\u5730\u914d\u7f6e\u53c2\u6570 min-slaves-to-write \u548c min-slaves-max-lag \uff0c\u6765\u9884\u9632\u8111\u88c2\u7684\u53d1\u751f\u3002 \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u53ef\u80fd\u4f1a\u56e0\u4e3a\u7f51\u7edc\u6682\u65f6\u62e5\u585e\u5bfc\u81f4\u4ece\u5e93\u6682\u65f6\u548c\u4e3b\u5e93\u7684 ACK \u6d88\u606f\u8d85\u65f6\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5e76\u4e0d\u662f\u4e3b\u5e93\u5047\u6545\u969c\uff0c\u6211\u4eec\u4e5f\u4e0d\u7528\u7981\u6b62\u4e3b\u5e93\u63a5\u6536\u8bf7\u6c42\u3002 \u5efa\u8bae\u662f\uff0c\u5047\u8bbe\u4ece\u5e93\u6709 K \u4e2a\uff0c\u53ef\u4ee5\u5c06 min-slaves-to-write \u8bbe\u7f6e\u4e3a K/2+1 \uff08\u5982\u679c K \u7b49\u4e8e 1\uff0c\u5c31\u8bbe\u4e3a 1\uff09\uff0c\u5c06 min-slaves-max-lag \u8bbe\u7f6e\u4e3a\u5341\u51e0\u79d2\uff08\u4f8b\u5982 10\uff5e20s\uff09\uff0c\u5728\u8fd9\u4e2a\u914d\u7f6e\u4e0b\uff0c\u5982\u679c\u6709\u4e00\u534a\u4ee5\u4e0a\u7684\u4ece\u5e93\u548c\u4e3b\u5e93\u8fdb\u884c\u7684 ACK \u6d88\u606f\u5ef6\u8fdf\u8d85\u8fc7\u5341\u51e0\u79d2\uff0c\u6211\u4eec\u5c31\u7981\u6b62\u4e3b\u5e93\u63a5\u6536\u5ba2\u6237\u7aef\u5199\u8bf7\u6c42 \u3002 \u907f\u514d\u8111\u88c2\u5e26\u6765\u6570\u636e\u4e22\u5931\u7684\u60c5\u51b5\uff0c\u800c\u4e14\uff0c\u4e5f\u4e0d\u4f1a\u56e0\u4e3a\u53ea\u6709\u5c11\u6570\u51e0\u4e2a\u4ece\u5e93\u56e0\u4e3a\u7f51\u7edc\u963b\u585e\u8fde\u4e0d\u4e0a\u4e3b\u5e93\uff0c\u5c31\u7981\u6b62\u4e3b\u5e93\u63a5\u6536\u8bf7\u6c42\uff0c\u589e\u52a0\u4e86\u7cfb\u7edf\u7684\u9c81\u68d2\u6027\u3002","title":"\u7b2c\u4e8c\u8282 \u8111\u88c2\u5bfc\u81f4\u6570\u636e\u4e22\u5931"},{"location":"chap7/2redis_brain_split/#_1","text":"\u4e00\u4e2a\u95ee\u9898\uff1a\u6211\u4eec\u7684\u4e3b\u4ece\u96c6\u7fa4\u6709 1 \u4e2a\u4e3b\u5e93\u30015 \u4e2a\u4ece\u5e93\u548c 3 \u4e2a\u54e8\u5175\u5b9e\u4f8b\uff0c\u5728\u4f7f\u7528\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53d1\u73b0\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u4e00\u4e9b\u6570\u636e\u4e22\u5931\u4e86\uff0c\u8fd9\u76f4\u63a5\u5f71\u54cd\u5230\u4e86\u4e1a\u52a1\u5c42\u7684\u6570\u636e\u53ef\u9760\u6027\u3002 \u6240\u8c13\u7684\u8111\u88c2\uff0c\u5c31\u662f\u6307\u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c\u540c\u65f6\u6709\u4e24\u4e2a\u4e3b\u8282\u70b9\uff0c\u5b83\u4eec\u90fd\u80fd\u63a5\u6536\u5199\u8bf7\u6c42 \u3002 \u800c\u8111\u88c2\u6700\u76f4\u63a5\u7684\u5f71\u54cd\uff0c\u5c31\u662f\u5ba2\u6237\u7aef\u4e0d\u77e5\u9053\u5e94\u8be5\u5f80\u54ea\u4e2a\u4e3b\u8282\u70b9\u5199\u5165\u6570\u636e\uff0c\u7ed3\u679c\u5c31\u662f\u4e0d\u540c\u7684\u5ba2\u6237\u7aef\u4f1a\u5f80\u4e0d\u540c\u7684\u4e3b\u8282\u70b9\u4e0a\u5199\u5165\u6570\u636e\u3002\u800c\u4e14\uff0c\u4e25\u91cd\u7684\u8bdd\uff0c\u8111\u88c2\u4f1a\u8fdb\u4e00\u6b65\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u3002","title":"\u7b2c\u4e8c\u8282 \u8111\u88c2\u5bfc\u81f4\u6570\u636e\u4e22\u5931"},{"location":"chap7/2redis_brain_split/#1","text":"","title":"1\u3001\u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u8111\u88c2\uff1f"},{"location":"chap7/2redis_brain_split/#1-1","text":"\u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\u53d1\u751f\u6570\u636e\u4e22\u5931\uff0c \u6700\u5e38\u89c1\u7684\u539f\u56e0\u5c31\u662f\u4e3b\u5e93\u7684\u6570\u636e\u8fd8\u6ca1\u6709\u540c\u6b65\u5230\u4ece\u5e93\uff0c\u7ed3\u679c\u4e3b\u5e93\u53d1\u751f\u4e86\u6545\u969c\uff0c\u7b49\u4ece\u5e93\u5347\u7ea7\u4e3a\u4e3b\u5e93\u540e\uff0c\u672a\u540c\u6b65\u7684\u6570\u636e\u5c31\u4e22\u5931\u4e86 \u3002 \u65b0\u5199\u5165\u4e3b\u5e93\u7684\u6570\u636e a:1\u3001b:3 \uff0c\u5c31\u56e0\u4e3a\u5728\u4e3b\u5e93\u6545\u969c\u524d\u672a\u540c\u6b65\u5230\u4ece\u5e93\u800c\u4e22\u5931\u4e86\u3002 \u5982\u679c\u662f\u8fd9\u79cd\u60c5\u51b5\u7684\u6570\u636e\u4e22\u5931\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6bd4\u5bf9\u4e3b\u4ece\u5e93\u4e0a\u7684\u590d\u5236\u8fdb\u5ea6\u5dee\u503c\u6765\u8fdb\u884c\u5224\u65ad\uff0c\u4e5f\u5c31\u662f\u8ba1\u7b97 master_repl_offset \u548c slave_repl_offset \u7684\u5dee\u503c\u3002 \u5982\u679c\u4ece\u5e93\u4e0a\u7684 slave_repl_offset \u5c0f\u4e8e\u539f\u4e3b\u5e93\u7684 master_repl_offset \uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba4\u5b9a\u6570\u636e\u4e22\u5931\u662f\u7531\u6570\u636e\u540c\u6b65\u672a\u5b8c\u6210\u5bfc\u81f4\u7684\u3002 \u90e8\u7f72\u4e3b\u4ece\u96c6\u7fa4\u65f6\uff0c\u4e5f\u76d1\u6d4b\u4e86\u4e3b\u5e93\u4e0a\u7684 master_repl_offset \uff0c\u4ee5\u53ca\u4ece\u5e93\u4e0a\u7684 slave_repl_offset \u3002 \u4f46\u662f\uff0c\u53d1\u73b0\u6570\u636e\u4e22\u5931\u540e\uff0c\u6211\u4eec\u68c0\u67e5\u4e86\u65b0\u4e3b\u5e93\u5347\u7ea7\u524d\u7684 slave_repl_offset \uff0c\u4ee5\u53ca\u539f\u4e3b\u5e93\u7684 master_repl_offset \uff0c\u5b83\u4eec\u662f\u4e00\u81f4\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u4e2a\u5347\u7ea7\u4e3a\u65b0\u4e3b\u5e93\u7684\u4ece\u5e93\uff0c\u5728\u5347\u7ea7\u65f6\u5df2\u7ecf\u548c\u539f\u4e3b\u5e93\u7684\u6570\u636e\u4fdd\u6301\u4e00\u81f4\u4e86\u3002\u90a3\u4e48\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u4f1a\u51fa\u73b0\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u6570\u636e\u4e22\u5931\u5462\uff1f","title":"1-1 \u786e\u8ba4\u662f\u4e0d\u662f\u6570\u636e\u540c\u6b65\u51fa\u73b0\u4e86\u95ee\u9898"},{"location":"chap7/2redis_brain_split/#1-2","text":"\u5728\u6392\u67e5\u5ba2\u6237\u7aef\u7684\u64cd\u4f5c\u65e5\u5fd7\u65f6\uff0c \u5728\u4e3b\u4ece\u5207\u6362\u540e\u7684\u4e00\u6bb5\u65f6\u95f4\u5185\uff0c\u6709\u4e00\u4e2a\u5ba2\u6237\u7aef\u4ecd\u7136\u5728\u548c\u539f\u4e3b\u5e93\u901a\u4fe1\uff0c\u5e76\u6ca1\u6709\u548c\u5347\u7ea7\u7684\u65b0\u4e3b\u5e93\u8fdb\u884c\u4ea4\u4e92 \u3002 \u8fd9\u5c31\u76f8\u5f53\u4e8e\u4e3b\u4ece\u96c6\u7fa4\u4e2d\u540c\u65f6\u6709\u4e86\u4e24\u4e2a\u4e3b\u5e93\u3002\u6839\u636e\u8fd9\u4e2a\u8ff9\u8c61\uff0c\u5728\u5206\u5e03\u5f0f\u4e3b\u4ece\u96c6\u7fa4\u53d1\u751f\u6545\u969c\u65f6\u4f1a\u51fa\u73b0\u7684\u4e00\u4e2a\u95ee\u9898\uff1a\u8111\u88c2\u3002 \u4f46\u662f\uff0c\u4e0d\u540c\u5ba2\u6237\u7aef\u7ed9\u4e24\u4e2a\u4e3b\u5e93\u53d1\u9001\u6570\u636e\u5199\u64cd\u4f5c\uff0c\u53ea\u4f1a\u5bfc\u81f4\u65b0\u6570\u636e\u4f1a\u5206\u5e03\u5728\u4e0d\u540c\u7684\u4e3b\u5e93\u4e0a\uff0c\u5e76\u4e0d\u4f1a\u9020\u6210\u6570\u636e\u4e22\u5931\u3002","title":"1-2 \u6392\u67e5\u5ba2\u6237\u7aef\u7684\u64cd\u4f5c\u65e5\u5fd7\uff0c\u53d1\u73b0\u8111\u88c2\u73b0\u8c61"},{"location":"chap7/2redis_brain_split/#1-3","text":"\u91c7\u7528\u54e8\u5175\u673a\u5236\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\u7684\uff0c \u5f53\u4e3b\u4ece\u5207\u6362\u53d1\u751f\u65f6\uff0c\u4e00\u5b9a\u662f\u6709\u8d85\u8fc7\u9884\u8bbe\u6570\u91cf\uff08quorum \u914d\u7f6e\u9879\uff09\u7684\u54e8\u5175\u5b9e\u4f8b\u548c\u4e3b\u5e93\u7684\u5fc3\u8df3\u90fd\u8d85\u65f6\u4e86\uff0c\u624d\u4f1a\u628a\u4e3b\u5e93\u5224\u65ad\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\uff0c\u7136\u540e\uff0c\u54e8\u5175\u5f00\u59cb\u6267\u884c\u5207\u6362\u64cd\u4f5c \u3002\u54e8\u5175\u5207\u6362\u5b8c\u6210\u540e\uff0c\u5ba2\u6237\u7aef\u4f1a\u548c\u65b0\u4e3b\u5e93\u8fdb\u884c\u901a\u4fe1\uff0c\u53d1\u9001\u8bf7\u6c42\u64cd\u4f5c\u3002 \u4f46\u662f\uff0c\u5728\u5207\u6362\u8fc7\u7a0b\u4e2d\uff0c\u65e2\u7136\u5ba2\u6237\u7aef\u4ecd\u7136\u548c\u539f\u4e3b\u5e93\u901a\u4fe1\uff0c\u8fd9\u5c31\u8868\u660e\uff0c\u539f\u4e3b\u5e93\u5e76\u6ca1\u6709\u771f\u7684\u53d1\u751f\u6545\u969c\uff08\u4f8b\u5982\u4e3b\u5e93\u8fdb\u7a0b\u6302\u6389\uff09\u3002 \u4e3b\u5e93\u662f\u7531\u4e8e\u67d0\u4e9b\u539f\u56e0\u65e0\u6cd5\u5904\u7406\u8bf7\u6c42\uff0c\u4e5f\u6ca1\u6709\u54cd\u5e94\u54e8\u5175\u7684\u5fc3\u8df3\uff0c\u624d\u88ab\u54e8\u5175\u9519\u8bef\u5730\u5224\u65ad\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\u7684\u3002\u7ed3\u679c\uff0c\u5728\u88ab\u5224\u65ad\u4e0b\u7ebf\u4e4b\u540e\uff0c\u539f\u4e3b\u5e93\u53c8\u91cd\u65b0\u5f00\u59cb\u5904\u7406\u8bf7\u6c42\u4e86\uff0c\u800c\u6b64\u65f6\uff0c\u54e8\u5175\u8fd8\u6ca1\u6709\u5b8c\u6210\u4e3b\u4ece\u5207\u6362\uff0c\u5ba2\u6237\u7aef\u4ecd\u7136\u53ef\u4ee5\u548c\u539f\u4e3b\u5e93\u901a\u4fe1\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u5199\u64cd\u4f5c\u5c31\u4f1a\u5728\u539f\u4e3b\u5e93\u4e0a\u5199\u5165\u6570\u636e\u4e86\u3002 \u201c\u5047\u6545\u969c\u201d\uff0c\u67e5\u770b\u539f\u4e3b\u5e93\u6240\u5728\u670d\u52a1\u5668\u7684\u8d44\u6e90\u4f7f\u7528\u76d1\u63a7\u8bb0\u5f55 \u539f\u4e3b\u5e93\u6240\u5728\u7684\u673a\u5668\u6709\u4e00\u6bb5\u65f6\u95f4\u7684 CPU \u5229\u7528\u7387\u7a81\u7136\u7279\u522b\u9ad8\uff0c\u8fd9\u662f\u6211\u4eec\u5728\u673a\u5668\u4e0a\u90e8\u7f72\u7684\u4e00\u4e2a\u6570\u636e\u91c7\u96c6\u7a0b\u5e8f\u5bfc\u81f4\u7684\u3002 \u56e0\u4e3a\u8fd9\u4e2a\u7a0b\u5e8f\u57fa\u672c\u628a\u673a\u5668\u7684 CPU \u90fd\u7528\u6ee1\u4e86\uff0c\u5bfc\u81f4 Redis \u4e3b\u5e93\u65e0\u6cd5\u54cd\u5e94\u5fc3\u8df3\u4e86\uff0c\u5728\u8fd9\u4e2a\u671f\u95f4\u5185\uff0c\u54e8\u5175\u5c31\u628a\u4e3b\u5e93\u5224\u65ad\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\uff0c\u5f00\u59cb\u4e3b\u4ece\u5207\u6362\u4e86\u3002 \u4e0d\u8fc7\uff0c\u8fd9\u4e2a\u6570\u636e\u91c7\u96c6\u7a0b\u5e8f\u5f88\u5feb\u6062\u590d\u6b63\u5e38\uff0cCPU \u7684\u4f7f\u7528\u7387\u4e5f\u964d\u4e0b\u6765\u4e86\u3002\u6b64\u65f6\uff0c\u539f\u4e3b\u5e93\u53c8\u5f00\u59cb\u6b63\u5e38\u670d\u52a1\u8bf7\u6c42\u4e86\u3002 \u6b63\u56e0\u4e3a\u539f\u4e3b\u5e93\u5e76\u6ca1\u6709\u771f\u7684\u53d1\u751f\u6545\u969c\uff0c\u6211\u4eec\u5728\u5ba2\u6237\u7aef\u64cd\u4f5c\u65e5\u5fd7\u4e2d\u5c31\u770b\u5230\u4e86\u548c\u539f\u4e3b\u5e93\u7684\u901a\u4fe1\u8bb0\u5f55\u3002 \u7b49\u5230\u4ece\u5e93\u88ab\u5347\u7ea7\u4e3a\u65b0\u4e3b\u5e93\u540e\uff0c\u4e3b\u4ece\u96c6\u7fa4\u91cc\u5c31\u6709\u4e24\u4e2a\u4e3b\u5e93\u4e86\uff0c\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u5c31\u628a\u8111\u88c2\u53d1\u751f\u7684\u539f\u56e0\u6478\u6e05\u695a\u4e86 \u3002","title":"1-3 \u53d1\u73b0\u662f\u539f\u4e3b\u5e93\u5047\u6545\u969c\u5bfc\u81f4\u7684\u8111\u88c2"},{"location":"chap7/2redis_brain_split/#2","text":"\u4e3b\u4ece\u5207\u6362\u540e\uff0c\u4ece\u5e93\u4e00\u65e6\u5347\u7ea7\u4e3a\u65b0\u4e3b\u5e93\uff0c\u54e8\u5175\u5c31\u4f1a\u8ba9\u539f\u4e3b\u5e93\u6267\u884c slave of \u547d\u4ee4\uff0c\u548c\u65b0\u4e3b\u5e93\u91cd\u65b0\u8fdb\u884c\u5168\u91cf\u540c\u6b65\u3002 \u800c\u5728\u5168\u91cf\u540c\u6b65\u6267\u884c\u7684\u6700\u540e\u9636\u6bb5\uff0c\u539f\u4e3b\u5e93\u9700\u8981\u6e05\u7a7a\u672c\u5730\u7684\u6570\u636e\uff0c\u52a0\u8f7d\u65b0\u4e3b\u5e93\u53d1\u9001\u7684 RDB \u6587\u4ef6\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u539f\u4e3b\u5e93\u5728\u4e3b\u4ece\u5207\u6362\u671f\u95f4\u4fdd\u5b58\u7684\u65b0\u5199\u6570\u636e\u5c31\u4e22\u5931\u4e86 \u3002 \u5728\u4e3b\u4ece\u5207\u6362\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u539f\u4e3b\u5e93\u53ea\u662f\u201c\u5047\u6545\u969c\u201d\uff0c\u5b83\u4f1a\u89e6\u53d1\u54e8\u5175\u542f\u52a8\u4e3b\u4ece\u5207\u6362\uff0c\u4e00\u65e6\u7b49\u5b83\u4ece\u5047\u6545\u969c\u4e2d\u6062\u590d\u540e\uff0c\u53c8\u5f00\u59cb\u5904\u7406\u8bf7\u6c42\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5c31\u4f1a\u548c\u65b0\u4e3b\u5e93\u540c\u65f6\u5b58\u5728\uff0c\u5f62\u6210\u8111\u88c2\u3002\u7b49\u5230\u54e8\u5175\u8ba9\u539f\u4e3b\u5e93\u548c\u65b0\u4e3b\u5e93\u505a\u5168\u91cf\u540c\u6b65\u540e\uff0c\u539f\u4e3b\u5e93\u5728\u5207\u6362\u671f\u95f4\u4fdd\u5b58\u7684\u6570\u636e\u5c31\u4e22\u5931\u4e86\u3002","title":"2\u3001\u4e3a\u4ec0\u4e48\u8111\u88c2\u4f1a\u5bfc\u81f4\u6570\u636e\u4e22\u5931\uff1f"},{"location":"chap7/2redis_brain_split/#3","text":"\u4e3b\u4ece\u96c6\u7fa4\u673a\u5236\u7684\u914d\u7f6e\u9879\u4e2d\u67e5\u627e\u662f\u5426\u6709\u9650\u5236\u4e3b\u5e93\u63a5\u6536\u8bf7\u6c42\u7684\u8bbe\u7f6e\u3002 \u901a\u8fc7\u67e5\u627e\uff0c Redis \u5df2\u7ecf\u63d0\u4f9b\u4e86\u4e24\u4e2a\u914d\u7f6e\u9879\u6765\u9650\u5236\u4e3b\u5e93\u7684\u8bf7\u6c42\u5904\u7406\uff0c\u5206\u522b\u662f min-slaves-to-write \u548c min-slaves-max-lag \u3002 min-slaves-to-write \uff1a\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e86 \u4e3b\u5e93\u80fd\u8fdb\u884c\u6570\u636e\u540c\u6b65\u7684\u6700\u5c11\u4ece\u5e93\u6570\u91cf \uff1b min-slaves-max-lag \uff1a\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e86 \u4e3b\u4ece\u5e93\u95f4\u8fdb\u884c\u6570\u636e\u590d\u5236\u65f6\uff0c\u4ece\u5e93\u7ed9\u4e3b\u5e93\u53d1\u9001 ACK \u6d88\u606f\u7684\u6700\u5927\u5ef6\u8fdf\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09 \u3002 \u53ef\u4ee5\u628a min-slaves-to-write \u548c min-slaves-max-lag \u8fd9\u4e24\u4e2a\u914d\u7f6e\u9879\u642d\u914d\u8d77\u6765\u4f7f\u7528\uff0c\u5206\u522b\u7ed9\u5b83\u4eec\u8bbe\u7f6e\u4e00\u5b9a\u7684\u9608\u503c\uff0c\u5047\u8bbe\u4e3a N \u548c T \u3002 \u8fd9\u4e24\u4e2a\u914d\u7f6e\u9879\u7ec4\u5408\u540e\u7684\u8981\u6c42\u662f\uff0c \u4e3b\u5e93\u8fde\u63a5\u7684\u4ece\u5e93\u4e2d\u81f3\u5c11\u6709 N \u4e2a\u4ece\u5e93\uff0c\u548c\u4e3b\u5e93\u8fdb\u884c\u6570\u636e\u590d\u5236\u65f6\u7684 ACK \u6d88\u606f\u5ef6\u8fdf\u4e0d\u80fd\u8d85\u8fc7 T \u79d2\uff0c\u5426\u5219\uff0c\u4e3b\u5e93\u5c31\u4e0d\u4f1a\u518d\u63a5\u6536\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42 \u4e86\u3002 \u5373\u4f7f\u539f\u4e3b\u5e93\u662f\u5047\u6545\u969c\uff0c\u5b83\u5728\u5047\u6545\u969c\u671f\u95f4\u4e5f\u65e0\u6cd5\u54cd\u5e94\u54e8\u5175\u5fc3\u8df3\uff0c\u4e5f\u4e0d\u80fd\u548c\u4ece\u5e93\u8fdb\u884c\u540c\u6b65\uff0c\u81ea\u7136\u4e5f\u5c31\u65e0\u6cd5\u548c\u4ece\u5e93\u8fdb\u884c ACK \u786e\u8ba4\u4e86 \u3002 \u8fd9\u6837\u4e00\u6765\uff0c min-slaves-to-write \u548c min-slaves-max-lag \u7684\u7ec4\u5408\u8981\u6c42\u5c31\u65e0\u6cd5\u5f97\u5230\u6ee1\u8db3\uff0c \u539f\u4e3b\u5e93\u5c31\u4f1a\u88ab\u9650\u5236\u63a5\u6536\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u5ba2\u6237\u7aef\u4e5f\u5c31\u4e0d\u80fd\u5728\u539f\u4e3b\u5e93\u4e2d\u5199\u5165\u65b0\u6570\u636e\u4e86\u3002 \u7b49\u5230\u65b0\u4e3b\u5e93\u4e0a\u7ebf\u65f6\uff0c\u5c31\u53ea\u6709\u65b0\u4e3b\u5e93\u80fd\u63a5\u6536\u548c\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u6b64\u65f6\uff0c\u65b0\u5199\u7684\u6570\u636e\u4f1a\u88ab\u76f4\u63a5\u5199\u5230\u65b0\u4e3b\u5e93\u4e2d\u3002\u800c\u539f\u4e3b\u5e93\u4f1a\u88ab\u54e8\u5175\u964d\u4e3a\u4ece\u5e93\uff0c\u5373\u4f7f\u5b83\u7684\u6570\u636e\u88ab\u6e05\u7a7a\u4e86\uff0c\u4e5f\u4e0d\u4f1a\u6709\u65b0\u6570\u636e\u4e22\u5931\u3002 \u5047\u8bbe\u6211\u4eec\u5c06 min-slaves-to-write \u8bbe\u7f6e\u4e3a 1 \u628a min-slaves-max-lag \u8bbe\u7f6e\u4e3a 12s \u628a\u54e8\u5175\u7684 down-after-milliseconds \u8bbe\u7f6e\u4e3a 10s down-after-milliseconds \u662f\u6211\u4eec\u8ba4\u5b9a\u4e3b\u4ece\u5e93\u65ad\u8fde\u7684\u6700\u5927\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\u3002\u5982\u679c\u5728 down-after-milliseconds \u6beb\u79d2\u5185\uff0c\u4e3b\u4ece\u8282\u70b9\u90fd\u6ca1\u6709\u901a\u8fc7\u7f51\u7edc\u8054\u7cfb\u4e0a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba4\u4e3a\u4e3b\u4ece\u8282\u70b9\u65ad\u8fde\u4e86\u3002 \u5982\u4f55\u9009\u5b9a\u65b0\u4e3b\u5e93\uff1f \u4e3b\u5e93\u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0\u5361\u4f4f\u4e86 15s\uff0c\u5bfc\u81f4\u54e8\u5175\u5224\u65ad\u4e3b\u5e93\u5ba2\u89c2\u4e0b\u7ebf\uff0c\u5f00\u59cb\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\u3002 \u540c\u65f6\uff0c\u56e0\u4e3a\u539f\u4e3b\u5e93\u5361\u4f4f\u4e86 15s\uff0c\u6ca1\u6709\u4e00\u4e2a\u4ece\u5e93\u80fd\u548c\u539f\u4e3b\u5e93\u5728 12s \u5185\u8fdb\u884c\u6570\u636e\u590d\u5236\uff0c\u539f\u4e3b\u5e93\u4e5f\u65e0\u6cd5\u63a5\u6536\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e86\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4e3b\u4ece\u5207\u6362\u5b8c\u6210\u540e\uff0c\u4e5f\u53ea\u6709\u65b0\u4e3b\u5e93\u80fd\u63a5\u6536\u8bf7\u6c42\uff0c\u4e0d\u4f1a\u53d1\u751f\u8111\u88c2\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u53d1\u751f\u6570\u636e\u4e22\u5931\u7684\u95ee\u9898\u4e86\u3002","title":"3\u3001\u5982\u4f55\u5e94\u5bf9\u8111\u88c2\u95ee\u9898\uff1f"},{"location":"chap7/2redis_brain_split/#4","text":"\u8111\u88c2\u662f\u6307\u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c\u540c\u65f6\u6709\u4e24\u4e2a\u4e3b\u5e93\u90fd\u80fd\u63a5\u6536\u5199\u8bf7\u6c42\u3002\u5728 Redis \u7684\u4e3b\u4ece\u5207\u6362\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u53d1\u751f\u4e86\u8111\u88c2\uff0c\u5ba2\u6237\u7aef\u6570\u636e\u5c31\u4f1a\u5199\u5165\u5230\u539f\u4e3b\u5e93\uff0c\u5982\u679c\u539f\u4e3b\u5e93\u88ab\u964d\u4e3a\u4ece\u5e93\uff0c\u8fd9\u4e9b\u65b0\u5199\u5165\u7684\u6570\u636e\u5c31\u4e22\u5931\u4e86\u3002 \u8111\u88c2\u53d1\u751f\u7684\u539f\u56e0\u4e3b\u8981\u662f\u539f\u4e3b\u5e93\u53d1\u751f\u4e86\u5047\u6545\u969c\uff0c\u603b\u7ed3\u4e0b\u5047\u6545\u969c\u7684\u4e24\u4e2a\u539f\u56e0\u3002 \u548c\u4e3b\u5e93\u90e8\u7f72\u5728\u540c\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u7684\u5176\u4ed6\u7a0b\u5e8f\u4e34\u65f6\u5360\u7528\u4e86\u5927\u91cf\u8d44\u6e90\uff08\u4f8b\u5982 CPU \u8d44\u6e90\uff09\uff0c\u5bfc\u81f4\u4e3b\u5e93\u8d44\u6e90\u4f7f\u7528\u53d7\u9650\uff0c\u77ed\u65f6\u95f4\u5185\u65e0\u6cd5\u54cd\u5e94\u5fc3\u8df3 \u3002\u5176\u5b83\u7a0b\u5e8f\u4e0d\u518d\u4f7f\u7528\u8d44\u6e90\u65f6\uff0c\u4e3b\u5e93\u53c8\u6062\u590d\u6b63\u5e38\u3002 \u4e3b\u5e93\u81ea\u8eab\u9047\u5230\u4e86\u963b\u585e\u7684\u60c5\u51b5\uff0c\u4f8b\u5982\uff0c\u5904\u7406 bigkey \u6216\u662f\u53d1\u751f\u5185\u5b58 swap\uff0c\u77ed\u65f6\u95f4\u5185\u65e0\u6cd5\u54cd\u5e94\u5fc3\u8df3\uff0c\u7b49\u4e3b\u5e93\u963b\u585e\u89e3\u9664\u540e\uff0c\u53c8\u6062\u590d\u6b63\u5e38\u7684\u8bf7\u6c42\u5904\u7406\u4e86\u3002 \u4e3a\u4e86\u5e94\u5bf9\u8111\u88c2\uff0c\u53ef\u4ee5\u5728\u4e3b\u4ece\u96c6\u7fa4\u90e8\u7f72\u65f6\uff0c\u901a\u8fc7\u5408\u7406\u5730\u914d\u7f6e\u53c2\u6570 min-slaves-to-write \u548c min-slaves-max-lag \uff0c\u6765\u9884\u9632\u8111\u88c2\u7684\u53d1\u751f\u3002 \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u53ef\u80fd\u4f1a\u56e0\u4e3a\u7f51\u7edc\u6682\u65f6\u62e5\u585e\u5bfc\u81f4\u4ece\u5e93\u6682\u65f6\u548c\u4e3b\u5e93\u7684 ACK \u6d88\u606f\u8d85\u65f6\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5e76\u4e0d\u662f\u4e3b\u5e93\u5047\u6545\u969c\uff0c\u6211\u4eec\u4e5f\u4e0d\u7528\u7981\u6b62\u4e3b\u5e93\u63a5\u6536\u8bf7\u6c42\u3002 \u5efa\u8bae\u662f\uff0c\u5047\u8bbe\u4ece\u5e93\u6709 K \u4e2a\uff0c\u53ef\u4ee5\u5c06 min-slaves-to-write \u8bbe\u7f6e\u4e3a K/2+1 \uff08\u5982\u679c K \u7b49\u4e8e 1\uff0c\u5c31\u8bbe\u4e3a 1\uff09\uff0c\u5c06 min-slaves-max-lag \u8bbe\u7f6e\u4e3a\u5341\u51e0\u79d2\uff08\u4f8b\u5982 10\uff5e20s\uff09\uff0c\u5728\u8fd9\u4e2a\u914d\u7f6e\u4e0b\uff0c\u5982\u679c\u6709\u4e00\u534a\u4ee5\u4e0a\u7684\u4ece\u5e93\u548c\u4e3b\u5e93\u8fdb\u884c\u7684 ACK \u6d88\u606f\u5ef6\u8fdf\u8d85\u8fc7\u5341\u51e0\u79d2\uff0c\u6211\u4eec\u5c31\u7981\u6b62\u4e3b\u5e93\u63a5\u6536\u5ba2\u6237\u7aef\u5199\u8bf7\u6c42 \u3002 \u907f\u514d\u8111\u88c2\u5e26\u6765\u6570\u636e\u4e22\u5931\u7684\u60c5\u51b5\uff0c\u800c\u4e14\uff0c\u4e5f\u4e0d\u4f1a\u56e0\u4e3a\u53ea\u6709\u5c11\u6570\u51e0\u4e2a\u4ece\u5e93\u56e0\u4e3a\u7f51\u7edc\u963b\u585e\u8fde\u4e0d\u4e0a\u4e3b\u5e93\uff0c\u5c31\u7981\u6b62\u4e3b\u5e93\u63a5\u6536\u8bf7\u6c42\uff0c\u589e\u52a0\u4e86\u7cfb\u7edf\u7684\u9c81\u68d2\u6027\u3002","title":"4\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap7/3redis_codis_cluster/","text":"\u7b2c\u4e09\u8282 Redis Codis \u96c6\u7fa4\u65b9\u6848 Redis Cluster \u65b9\u6848\u6b63\u5f0f\u53d1\u5e03\u524d\uff0c\u4e1a\u754c\u5df2\u7ecf\u5e7f\u6cdb\u4f7f\u7528\u7684 Codis\u3002 1\u3001Codis \u7684\u6574\u4f53\u67b6\u6784\u548c\u57fa\u672c\u6d41\u7a0b Codis \u96c6\u7fa4\u4e2d\u5305\u542b\u4e86 4 \u7c7b\u5173\u952e\u7ec4\u4ef6\u3002 codis server\uff1a\u8fd9\u662f\u8fdb\u884c\u4e86\u4e8c\u6b21\u5f00\u53d1\u7684 Redis \u5b9e\u4f8b\uff0c\u5176\u4e2d\u589e\u52a0\u4e86\u989d\u5916\u7684\u6570\u636e\u7ed3\u6784\uff0c\u652f\u6301\u6570\u636e\u8fc1\u79fb\u64cd\u4f5c\uff0c\u4e3b\u8981\u8d1f\u8d23\u5904\u7406\u5177\u4f53\u7684\u6570\u636e\u8bfb\u5199\u8bf7\u6c42\u3002 codis proxy\uff1a\u63a5\u6536\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u5e76\u628a\u8bf7\u6c42\u8f6c\u53d1\u7ed9 codis server\u3002 Zookeeper \u96c6\u7fa4\uff1a\u4fdd\u5b58\u96c6\u7fa4\u5143\u6570\u636e\uff0c\u4f8b\u5982\u6570\u636e\u4f4d\u7f6e\u4fe1\u606f\u548c codis proxy \u4fe1\u606f\u3002 codis dashboard \u548c codis fe\uff1a\u5171\u540c\u7ec4\u6210\u4e86\u96c6\u7fa4\u7ba1\u7406\u5de5\u5177\u3002 \u5176\u4e2d\uff0ccodis dashboard \u8d1f\u8d23\u6267\u884c\u96c6\u7fa4\u7ba1\u7406\u5de5\u4f5c\uff0c\u5305\u62ec\u589e\u5220 codis server\u3001codis proxy \u548c\u8fdb\u884c\u6570\u636e\u8fc1\u79fb\u3002 \u800c codis fe \u8d1f\u8d23\u63d0\u4f9b dashboard \u7684 Web \u64cd\u4f5c\u754c\u9762\uff0c\u4fbf\u4e8e\u6211\u4eec\u76f4\u63a5\u5728 Web \u754c\u9762\u4e0a\u8fdb\u884c\u96c6\u7fa4\u7ba1\u7406\u3002 Codis \u96c6\u7fa4\u7684\u67b6\u6784\u548c\u5173\u952e\u7ec4\u4ef6\u3002 \u9996\u5148\uff0c\u4e3a\u4e86\u8ba9\u96c6\u7fa4\u80fd\u63a5\u6536\u5e76\u5904\u7406\u8bf7\u6c42\uff0c\u6211\u4eec\u8981\u5148\u4f7f\u7528 codis dashboard \u8bbe\u7f6e codis server \u548c codis proxy \u7684\u8bbf\u95ee\u5730\u5740\uff0c\u5b8c\u6210\u8bbe\u7f6e\u540e\uff0ccodis server \u548c codis proxy \u624d\u4f1a\u5f00\u59cb\u63a5\u6536\u8fde\u63a5\u3002 \u7136\u540e\uff0c\u5f53\u5ba2\u6237\u7aef\u8981\u8bfb\u5199\u6570\u636e\u65f6\uff0c\u5ba2\u6237\u7aef\u76f4\u63a5\u548c codis proxy \u5efa\u7acb\u8fde\u63a5\u3002 \u4f60\u53ef\u80fd\u4f1a\u62c5\u5fc3\uff0c\u65e2\u7136\u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u662f proxy\uff0c\u662f\u4e0d\u662f\u9700\u8981\u4fee\u6539\u5ba2\u6237\u7aef\uff0c\u624d\u80fd\u8bbf\u95ee proxy\uff1f \u5176\u5b9e\uff0c\u4f60\u4e0d\u7528\u62c5\u5fc3\uff0ccodis proxy \u672c\u8eab\u652f\u6301 Redis \u7684 RESP \u4ea4\u4e92\u534f\u8bae\uff0c\u6240\u4ee5\uff0c\u5ba2\u6237\u7aef\u8bbf\u95ee codis proxy \u65f6\uff0c\u548c\u8bbf\u95ee\u539f\u751f\u7684 Redis \u5b9e\u4f8b\u6ca1\u6709\u4ec0\u4e48\u533a\u522b\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u539f\u672c\u8fde\u63a5\u5355\u5b9e\u4f8b\u7684\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u8f7b\u677e\u5730\u548c Codis \u96c6\u7fa4\u5efa\u7acb\u8d77\u8fde\u63a5\u4e86\u3002 \u6700\u540e\uff0ccodis proxy \u63a5\u6536\u5230\u8bf7\u6c42\uff0c\u5c31\u4f1a\u67e5\u8be2\u8bf7\u6c42\u6570\u636e\u548c codis server \u7684\u6620\u5c04\u5173\u7cfb\uff0c\u5e76\u628a\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u76f8\u5e94\u7684 codis server \u8fdb\u884c\u5904\u7406\u3002\u5f53 codis server \u5904\u7406\u5b8c\u8bf7\u6c42\u540e\uff0c\u4f1a\u628a\u7ed3\u679c\u8fd4\u56de\u7ed9 codis proxy\uff0cproxy \u518d\u628a\u6570\u636e\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002 Codis \u96c6\u7fa4\u67b6\u6784 4 \u65b9\u9762\u6280\u672f\u56e0\u7d20\uff1a\u6570\u636e\u5206\u5e03\u3001\u96c6\u7fa4\u6269\u5bb9\u548c\u6570\u636e\u8fc1\u79fb\u3001\u5ba2\u6237\u7aef\u517c\u5bb9\u6027\u3001\u53ef\u9760\u6027\u4fdd\u8bc1\uff0c 2\u3001Codis \u7684\u5173\u952e\u6280\u672f\u539f\u7406 \u7b2c\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\uff0c \u6570\u636e\u662f\u600e\u4e48\u5728\u591a\u4e2a\u5b9e\u4f8b\u4e0a\u5206\u5e03\u7684 2-1 \u6570\u636e\u5982\u4f55\u5728\u96c6\u7fa4\u91cc\u5206\u5e03\uff1f \u5728 Codis \u96c6\u7fa4\u4e2d\uff0c\u4e00\u4e2a\u6570\u636e\u5e94\u8be5\u4fdd\u5b58\u5728\u54ea\u4e2a codis server \u4e0a\uff0c\u8fd9\u662f\u901a\u8fc7\u903b\u8f91\u69fd\uff08Slot\uff09\u6620\u5c04\u6765\u5b8c\u6210\u7684\uff0c\u5177\u4f53\u6765\u8bf4\uff0c\u603b\u5171\u5206\u6210\u4e24\u6b65\u3002 \u7b2c\u4e00\u6b65\uff0cCodis \u96c6\u7fa4\u4e00\u5171\u6709 1024 \u4e2a Slot\uff0c\u7f16\u53f7\u4f9d\u6b21\u662f 0 \u5230 1023\u3002\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e9b Slot \u624b\u52a8\u5206\u914d\u7ed9 codis server\uff0c\u6bcf\u4e2a server \u4e0a\u5305\u542b\u4e00\u90e8\u5206 Slot\u3002\u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u8ba9 codis dashboard \u8fdb\u884c\u81ea\u52a8\u5206\u914d\uff0c\u4f8b\u5982\uff0cdashboard \u628a 1024 \u4e2a Slot \u5728\u6240\u6709 server \u4e0a\u5747\u5206\u3002 \u7b2c\u4e8c\u6b65\uff0c\u5f53\u5ba2\u6237\u7aef\u8981\u8bfb\u5199\u6570\u636e\u65f6\uff0c\u4f1a\u4f7f\u7528 CRC32 \u7b97\u6cd5\u8ba1\u7b97\u6570\u636e key \u7684\u54c8\u5e0c\u503c\uff0c\u5e76\u628a\u8fd9\u4e2a\u54c8\u5e0c\u503c\u5bf9 1024 \u53d6\u6a21\u3002\u800c\u53d6\u6a21\u540e\u7684\u503c\uff0c\u5219\u5bf9\u5e94 Slot \u7684\u7f16\u53f7\u3002\u6b64\u65f6\uff0c\u6839\u636e\u7b2c\u4e00\u6b65\u5206\u914d\u7684 Slot \u548c server \u5bf9\u5e94\u5173\u7cfb\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u77e5\u9053\u6570\u636e\u4fdd\u5b58\u5728\u54ea\u4e2a server \u4e0a\u4e86\u3002 \u6211\u6765\u4e3e\u4e2a\u4f8b\u5b50\u3002 \u4e0b\u56fe\u663e\u793a\u7684\u5c31\u662f\u6570\u636e\u3001Slot \u548c codis server \u7684\u6620\u5c04\u4fdd\u5b58\u5173\u7cfb\u3002 \u5176\u4e2d\uff0cSlot 0 \u548c 1 \u88ab\u5206\u914d\u5230\u4e86 server1\uff0c Slot 2 \u5206\u914d\u5230 server2\uff0c Slot 1022 \u548c 1023 \u88ab\u5206\u914d\u5230 server8\u3002 \u5f53\u5ba2\u6237\u7aef\u8bbf\u95ee key 1 \u548c key 2 \u65f6\uff0c\u8fd9\u4e24\u4e2a\u6570\u636e\u7684 CRC32 \u503c\u5bf9 1024 \u53d6\u6a21\u540e\uff0c\u5206\u522b\u662f 1 \u548c 1022\u3002\u56e0\u6b64\uff0c\u5b83\u4eec\u4f1a\u88ab\u4fdd\u5b58\u5728 Slot 1 \u548c Slot 1022 \u4e0a\uff0c\u800c Slot 1 \u548c Slot 1022 \u5df2\u7ecf\u88ab\u5206\u914d\u5230 codis server 1 \u548c 8 \u4e0a\u4e86\u3002\u8fd9\u6837\u4e00\u6765\uff0ckey 1 \u548c key 2 \u7684\u4fdd\u5b58\u4f4d\u7f6e\u5c31\u5f88\u6e05\u695a\u4e86\u3002 \u5728\u6570\u636e\u5206\u5e03\u7684\u5b9e\u73b0\u65b9\u6cd5\u4e0a\uff0cCodis \u548c Redis Cluster \u5f88\u76f8\u4f3c\uff0c\u90fd\u91c7\u7528\u4e86 key \u6620\u5c04\u5230 Slot\u3001Slot \u518d\u5206\u914d\u5230\u5b9e\u4f8b\u4e0a\u7684\u673a\u5236 2-2 Codis \u548c Redis Cluster \u660e\u663e\u7684\u533a\u522b Codis \u4e2d\u7684\u8def\u7531\u8868\u662f\u6211\u4eec\u901a\u8fc7 codis dashboard \u5206\u914d\u548c\u4fee\u6539\u7684\uff0c\u5e76\u88ab\u4fdd\u5b58\u5728 Zookeeper \u96c6\u7fa4\u4e2d\u3002 \u4e00\u65e6\u6570\u636e\u4f4d\u7f6e\u53d1\u751f\u53d8\u5316\uff08\u4f8b\u5982\u6709\u5b9e\u4f8b\u589e\u51cf\uff09\uff0c\u8def\u7531\u8868\u88ab\u4fee\u6539\u4e86\uff0ccodis dashbaord \u5c31\u4f1a\u628a\u4fee\u6539\u540e\u7684\u8def\u7531\u8868\u53d1\u9001\u7ed9 codis proxy\uff0cproxy \u5c31\u53ef\u4ee5\u6839\u636e\u6700\u65b0\u7684\u8def\u7531\u4fe1\u606f\u8f6c\u53d1\u8bf7\u6c42\u4e86\u3002 \u5728 Redis Cluster \u4e2d\uff0c\u6570\u636e\u8def\u7531\u8868\u662f\u901a\u8fc7\u6bcf\u4e2a\u5b9e\u4f8b\u76f8\u4e92\u95f4\u7684\u901a\u4fe1\u4f20\u9012\u7684\uff0c\u6700\u540e\u4f1a\u5728\u6bcf\u4e2a\u5b9e\u4f8b\u4e0a\u4fdd\u5b58\u4e00\u4efd\u3002 \u5f53\u6570\u636e\u8def\u7531\u4fe1\u606f\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u5c31\u9700\u8981\u5728\u6240\u6709\u5b9e\u4f8b\u95f4\u901a\u8fc7\u7f51\u7edc\u6d88\u606f\u8fdb\u884c\u4f20\u9012\u3002\u6240\u4ee5\uff0c\u5982\u679c\u5b9e\u4f8b\u6570\u91cf\u8f83\u591a\u7684\u8bdd\uff0c\u5c31\u4f1a\u6d88\u8017\u8f83\u591a\u7684\u96c6\u7fa4\u7f51\u7edc\u8d44\u6e90\u3002 \u6570\u636e\u5206\u5e03\u89e3\u51b3\u4e86\u65b0\u6570\u636e\u5199\u5165\u65f6\u8be5\u4fdd\u5b58\u5728\u54ea\u4e2a server \u7684\u95ee\u9898\uff0c\u4f46\u662f\uff0c\u5f53\u4e1a\u52a1\u6570\u636e\u589e\u52a0\u540e\uff0c\u5982\u679c\u96c6\u7fa4\u4e2d\u7684\u73b0\u6709\u5b9e\u4f8b\u4e0d\u8db3\u4ee5\u4fdd\u5b58\u6240\u6709\u6570\u636e\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5bf9\u96c6\u7fa4\u8fdb\u884c\u6269\u5bb9\u3002 3\u3001\u96c6\u7fa4\u6269\u5bb9\u548c\u6570\u636e\u8fc1\u79fb\u5982\u4f55\u8fdb\u884c? 3-1 Codis \u96c6\u7fa4\u6269\u5bb9 Codis \u96c6\u7fa4\u6269\u5bb9\u5305\u62ec\u4e86\u4e24\u65b9\u9762\uff1a\u589e\u52a0 codis server \u548c\u589e\u52a0 codis proxy\u3002 3-2 \u589e\u52a0 codis server \u8fd9\u4e2a\u8fc7\u7a0b\u4e3b\u8981\u6d89\u53ca\u5230\u4e24\u6b65\u64cd\u4f5c\uff1a \u542f\u52a8\u65b0\u7684 codis server\uff0c\u5c06\u5b83\u52a0\u5165\u96c6\u7fa4\uff1b \u628a\u90e8\u5206\u6570\u636e\u8fc1\u79fb\u5230\u65b0\u7684 server\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u91cc\u7684\u6570\u636e\u8fc1\u79fb\u662f\u4e00\u4e2a\u91cd\u8981\u7684\u673a\u5236 Codis \u96c6\u7fa4\u6309\u7167 Slot \u7684\u7c92\u5ea6\u8fdb\u884c\u6570\u636e\u8fc1\u79fb\u3002 \u5728\u6e90 server \u4e0a\uff0cCodis \u4ece\u8981\u8fc1\u79fb\u7684 Slot \u4e2d\u968f\u673a\u9009\u62e9\u4e00\u4e2a\u6570\u636e\uff0c\u53d1\u9001\u7ed9\u76ee\u7684 server\u3002 \u76ee\u7684 server \u786e\u8ba4\u6536\u5230\u6570\u636e\u540e\uff0c\u4f1a\u7ed9\u6e90 server \u8fd4\u56de\u786e\u8ba4\u6d88\u606f\u3002\u8fd9\u65f6\uff0c \u6e90 server \u4f1a\u5728\u672c\u5730\u5c06\u521a\u624d\u8fc1\u79fb\u7684\u6570\u636e\u5220\u9664\u3002 \u7b2c\u4e00\u6b65\u548c\u7b2c\u4e8c\u6b65\u5c31\u662f\u5355\u4e2a\u6570\u636e\u7684\u8fc1\u79fb\u8fc7\u7a0b\u3002Codis \u4f1a\u4e0d\u65ad\u91cd\u590d\u8fd9\u4e2a\u8fc1\u79fb\u8fc7\u7a0b\uff0c\u76f4\u5230\u8981\u8fc1\u79fb\u7684 Slot \u4e2d\u7684\u6570\u636e\u5168\u90e8\u8fc1\u79fb\u5b8c\u6210\u3002 \u5355\u4e2a\u6570\u636e\u7684\u8fc1\u79fb\u8fc7\u7a0b\uff0cCodis \u5b9e\u73b0\u4e86\u4e24\u79cd\u8fc1\u79fb\u6a21\u5f0f\uff0c\u5206\u522b\u662f\u540c\u6b65\u8fc1\u79fb\u548c\u5f02\u6b65\u8fc1\u79fb\u3002 3-2-1 \u540c\u6b65\u8fc1\u79fb \u540c\u6b65\u8fc1\u79fb\u662f\u6307\uff0c\u5728\u6570\u636e\u4ece\u6e90 server \u53d1\u9001\u7ed9\u76ee\u7684 server \u7684\u8fc7\u7a0b\u4e2d\uff0c\u6e90 server \u662f\u963b\u585e\u7684\uff0c\u65e0\u6cd5\u5904\u7406\u65b0\u7684\u8bf7\u6c42\u64cd\u4f5c\u3002 \u8fd9\u79cd\u6a21\u5f0f\u5f88\u5bb9\u6613\u5b9e\u73b0\uff0c\u4f46\u662f\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\u4f1a\u6d89\u53ca\u591a\u4e2a\u64cd\u4f5c\uff08\u5305\u62ec\u6570\u636e\u5728\u6e90 server \u5e8f\u5217\u5316\u3001\u7f51\u7edc\u4f20\u8f93\u3001\u5728\u76ee\u7684 server \u53cd\u5e8f\u5217\u5316\uff0c\u4ee5\u53ca\u5728\u6e90 server \u5220\u9664\uff09\uff0c\u5982\u679c\u8fc1\u79fb\u7684\u6570\u636e\u662f\u4e00\u4e2a bigkey\uff0c\u6e90 server \u5c31\u4f1a\u963b\u585e\u8f83\u957f\u65f6\u95f4\uff0c\u65e0\u6cd5\u53ca\u65f6\u5904\u7406\u7528\u6237\u8bf7\u6c42\u3002 3-2-2 \u5f02\u6b65\u8fc1\u79fb \u4e3a\u4e86\u907f\u514d\u6570\u636e\u8fc1\u79fb\u963b\u585e\u6e90 server\uff0cCodis \u5b9e\u73b0\u7684\u7b2c\u4e8c\u79cd\u8fc1\u79fb\u6a21\u5f0f\u5c31\u662f\u5f02\u6b65\u8fc1\u79fb\u3002\u5f02\u6b65\u8fc1\u79fb\u7684\u5173\u952e\u7279\u70b9\u6709\u4e24\u4e2a\u3002 \u7b2c\u4e00\u4e2a\u7279\u70b9\u662f\uff0c\u5f53\u6e90 server \u628a\u6570\u636e\u53d1\u9001\u7ed9\u76ee\u7684 server \u540e\uff0c\u5c31\u53ef\u4ee5\u5904\u7406\u5176\u4ed6\u8bf7\u6c42\u64cd\u4f5c\u4e86\uff0c\u4e0d\u7528\u7b49\u5230\u76ee\u7684 server \u7684\u547d\u4ee4\u6267\u884c\u5b8c \u3002\u800c\u76ee\u7684 server \u4f1a\u5728\u6536\u5230\u6570\u636e\u5e76\u53cd\u5e8f\u5217\u5316\u4fdd\u5b58\u5230\u672c\u5730\u540e\uff0c\u7ed9\u6e90 server \u53d1\u9001\u4e00\u4e2a ACK \u6d88\u606f\uff0c\u8868\u660e\u8fc1\u79fb\u5b8c\u6210\u3002\u6b64\u65f6\uff0c\u6e90 server \u5728\u672c\u5730\u628a\u521a\u624d\u8fc1\u79fb\u7684\u6570\u636e\u5220\u9664\u3002 \u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u8fc1\u79fb\u7684\u6570\u636e\u4f1a\u88ab\u8bbe\u7f6e\u4e3a\u53ea\u8bfb\uff0c\u6240\u4ee5\uff0c\u6e90 server \u4e0a\u7684\u6570\u636e\u4e0d\u4f1a\u88ab\u4fee\u6539 \uff0c\u81ea\u7136\u4e5f\u5c31\u4e0d\u4f1a\u51fa\u73b0\u201c\u548c\u76ee\u7684 server \u4e0a\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u201d\u7684\u95ee\u9898\u4e86\u3002 \u7b2c\u4e8c\u4e2a\u7279\u70b9\u662f\uff0c\u5bf9\u4e8e bigkey\uff0c\u5f02\u6b65\u8fc1\u79fb\u91c7\u7528\u4e86\u62c6\u5206\u6307\u4ee4\u7684\u65b9\u5f0f\u8fdb\u884c\u8fc1\u79fb\u3002 \u5177\u4f53\u6765\u8bf4\u5c31\u662f\uff0c\u5bf9 bigkey \u4e2d\u6bcf\u4e2a\u5143\u7d20\uff0c\u7528\u4e00\u6761\u6307\u4ee4\u8fdb\u884c\u8fc1\u79fb\uff0c\u800c\u4e0d\u662f\u628a\u6574\u4e2a bigkey \u8fdb\u884c\u5e8f\u5217\u5316\u540e\u518d\u6574\u4f53\u4f20\u8f93\u3002 \u8fd9\u79cd\u5316\u6574\u4e3a\u96f6\u7684\u65b9\u5f0f\uff0c\u5c31\u907f\u514d\u4e86 bigkey \u8fc1\u79fb\u65f6\uff0c\u56e0\u4e3a\u8981\u5e8f\u5217\u5316\u5927\u91cf\u6570\u636e\u800c\u963b\u585e\u6e90 server \u7684\u95ee\u9898\u3002 \u6b64\u5916\uff0c\u5f53 bigkey \u8fc1\u79fb\u4e86\u4e00\u90e8\u5206\u6570\u636e\u540e\uff0c \u5982\u679c Codis \u53d1\u751f\u6545\u969c\uff0c\u5c31\u4f1a\u5bfc\u81f4 bigkey \u7684\u4e00\u90e8\u5206\u5143\u7d20\u5728\u6e90 server\uff0c\u800c\u53e6\u4e00\u90e8\u5206\u5143\u7d20\u5728\u76ee\u7684 server\uff0c\u8fd9\u5c31\u7834\u574f\u4e86\u8fc1\u79fb\u7684\u539f\u5b50\u6027\u3002 \u6240\u4ee5\uff0cCodis \u4f1a\u5728\u76ee\u6807 server \u4e0a\uff0c\u7ed9 bigkey \u7684\u5143\u7d20\u8bbe\u7f6e\u4e00\u4e2a\u4e34\u65f6\u8fc7\u671f\u65f6\u95f4\u3002 \u5982\u679c\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\u53d1\u751f\u6545\u969c\uff0c\u90a3\u4e48\uff0c\u76ee\u6807 server \u4e0a\u7684 key \u4f1a\u5728\u8fc7\u671f\u540e\u88ab\u5220\u9664\uff0c\u4e0d\u4f1a\u5f71\u54cd\u8fc1\u79fb\u7684\u539f\u5b50\u6027\u3002\u5f53\u6b63\u5e38\u5b8c\u6210\u8fc1\u79fb\u540e\uff0cbigkey \u5143\u7d20\u7684\u4e34\u65f6\u8fc7\u671f\u65f6\u95f4\u4f1a\u88ab\u5220\u9664\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u5982\u6211\u4eec\u8981\u8fc1\u79fb\u4e00\u4e2a\u6709 1 \u4e07\u4e2a\u5143\u7d20\u7684 List \u7c7b\u578b\u6570\u636e\uff0c\u5f53\u4f7f\u7528\u5f02\u6b65\u8fc1\u79fb\u65f6\uff0c\u6e90 server \u5c31\u4f1a\u7ed9\u76ee\u7684 server \u4f20\u8f93 1 \u4e07\u6761 RPUSH \u547d\u4ee4\uff0c\u6bcf\u6761\u547d\u4ee4\u5bf9\u5e94\u4e86 List \u4e2d\u4e00\u4e2a\u5143\u7d20\u7684\u63d2\u5165\u3002\u5728\u76ee\u7684 server \u4e0a\uff0c\u8fd9 1 \u4e07\u6761\u547d\u4ee4\u518d\u88ab\u4f9d\u6b21\u6267\u884c\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u6570\u636e\u8fc1\u79fb\u3002 \u4e3a\u4e86\u63d0\u5347\u8fc1\u79fb\u7684\u6548\u7387\uff0c Codis \u5728\u5f02\u6b65\u8fc1\u79fb Slot \u65f6\uff0c\u5141\u8bb8\u6bcf\u6b21\u8fc1\u79fb\u591a\u4e2a key\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u5f02\u6b65\u8fc1\u79fb\u547d\u4ee4 SLOTSMGRTTAGSLOT-ASYNC \u7684\u53c2\u6570 numkeys \u8bbe\u7f6e\u6bcf\u6b21\u8fc1\u79fb\u7684 key \u6570\u91cf\u3002 3-3 \u589e\u52a0 codis proxy \u56e0\u4e3a\u5728 Codis \u96c6\u7fa4\u4e2d\uff0c\u5ba2\u6237\u7aef\u662f\u548c codis proxy \u76f4\u63a5\u8fde\u63a5\u7684\uff0c\u6240\u4ee5\uff0c\u5f53\u5ba2\u6237\u7aef\u589e\u52a0\u65f6\uff0c\u4e00\u4e2a proxy \u65e0\u6cd5\u652f\u6491\u5927\u91cf\u7684\u8bf7\u6c42\u64cd\u4f5c\uff0c\u6b64\u65f6\uff0c\u6211\u4eec\u5c31\u9700\u8981\u589e\u52a0 proxy\u3002 \u589e\u52a0 proxy \u6bd4\u8f83\u5bb9\u6613\uff0c\u76f4\u63a5\u542f\u52a8 proxy\uff0c\u518d\u901a\u8fc7 codis dashboard \u628a proxy \u52a0\u5165\u96c6\u7fa4\u5c31\u884c\u3002 \u6b64\u65f6\uff0ccodis proxy \u7684\u8bbf\u95ee\u8fde\u63a5\u4fe1\u606f\u90fd\u4f1a\u4fdd\u5b58\u5728 Zookeeper \u4e0a\u3002\u6240\u4ee5\uff0c\u5f53\u65b0\u589e\u4e86 proxy \u540e\uff0cZookeeper \u4e0a\u4f1a\u6709\u6700\u65b0\u7684\u8bbf\u95ee\u5217\u8868\uff0c\u5ba2\u6237\u7aef\u4e5f\u5c31\u53ef\u4ee5\u4ece Zookeeper \u4e0a\u8bfb\u53d6 proxy \u8bbf\u95ee\u5217\u8868\uff0c\u628a\u8bf7\u6c42\u53d1\u9001\u7ed9\u65b0\u589e\u7684 proxy\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5ba2\u6237\u7aef\u7684\u8bbf\u95ee\u538b\u529b\u5c31\u53ef\u4ee5\u5728\u591a\u4e2a proxy \u4e0a\u5206\u62c5\u5904\u7406\u4e86\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a 4\u3001\u96c6\u7fa4\u5ba2\u6237\u7aef\u9700\u8981\u91cd\u65b0\u5f00\u53d1\u5417? \u4f7f\u7528 Redis \u5355\u5b9e\u4f8b\u65f6\uff0c\u5ba2\u6237\u7aef\u53ea\u8981\u7b26\u5408 RESP \u534f\u8bae\uff0c\u5c31\u53ef\u4ee5\u548c\u5b9e\u4f8b\u8fdb\u884c\u4ea4\u4e92\u548c\u8bfb\u5199\u6570\u636e\u3002\u4f46\u662f\uff0c\u5728\u4f7f\u7528\u5207\u7247\u96c6\u7fa4\u65f6\uff0c\u6709\u4e9b\u529f\u80fd\u662f\u548c\u5355\u5b9e\u4f8b\u4e0d\u4e00\u6837\u7684\uff0c\u6bd4\u5982\u96c6\u7fa4\u4e2d\u7684\u6570\u636e\u8fc1\u79fb\u64cd\u4f5c\uff0c\u5728\u5355\u5b9e\u4f8b\u4e0a\u662f\u6ca1\u6709\u7684\uff0c\u800c\u4e14\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\uff0c\u6570\u636e\u8bbf\u95ee\u8bf7\u6c42\u53ef\u80fd\u8981\u88ab\u91cd\u5b9a\u5411\uff08\u4f8b\u5982 Redis Cluster \u4e2d\u7684 MOVE \u547d\u4ee4\uff09\u3002 \u6240\u4ee5\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u589e\u52a0\u548c\u96c6\u7fa4\u529f\u80fd\u76f8\u5173\u7684\u547d\u4ee4\u64cd\u4f5c\u7684\u652f\u6301\u3002\u5982\u679c\u539f\u6765\u4f7f\u7528\u5355\u5b9e\u4f8b\u5ba2\u6237\u7aef\uff0c\u60f3\u8981\u6269\u5bb9\u4f7f\u7528\u96c6\u7fa4\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u65b0\u5ba2\u6237\u7aef\uff0c\u8fd9\u5bf9\u4e8e\u4e1a\u52a1\u5e94\u7528\u7684\u517c\u5bb9\u6027\u6765\u8bf4\uff0c\u5e76\u4e0d\u662f\u7279\u522b\u53cb\u597d\u3002 Codis \u96c6\u7fa4\u5728\u8bbe\u8ba1\u65f6\uff0c\u5c31\u5145\u5206\u8003\u8651\u4e86\u5bf9\u73b0\u6709\u5355\u5b9e\u4f8b\u5ba2\u6237\u7aef\u7684\u517c\u5bb9\u6027\u3002 Codis \u4f7f\u7528 codis proxy \u76f4\u63a5\u548c\u5ba2\u6237\u7aef\u8fde\u63a5\uff0ccodis proxy \u662f\u548c\u5355\u5b9e\u4f8b\u5ba2\u6237\u7aef\u517c\u5bb9\u7684\u3002\u800c\u548c\u96c6\u7fa4\u76f8\u5173\u7684\u7ba1\u7406\u5de5\u4f5c\uff08\u4f8b\u5982\u8bf7\u6c42\u8f6c\u53d1\u3001\u6570\u636e\u8fc1\u79fb\u7b49\uff09\uff0c\u90fd\u7531 codis proxy\u3001codis dashboard \u8fd9\u4e9b\u7ec4\u4ef6\u6765\u5b8c\u6210\uff0c\u4e0d\u9700\u8981\u5ba2\u6237\u7aef\u53c2\u4e0e\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u4e1a\u52a1\u5e94\u7528\u4f7f\u7528 Codis \u96c6\u7fa4\u65f6\uff0c\u5c31\u4e0d\u7528\u4fee\u6539\u5ba2\u6237\u7aef\u4e86\uff0c\u53ef\u4ee5\u590d\u7528\u548c\u5355\u5b9e\u4f8b\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\uff0c\u65e2\u80fd\u5229\u7528\u96c6\u7fa4\u8bfb\u5199\u5927\u5bb9\u91cf\u6570\u636e\uff0c\u53c8\u907f\u514d\u4e86\u4fee\u6539\u5ba2\u6237\u7aef\u589e\u52a0\u590d\u6742\u7684\u64cd\u4f5c\u903b\u8f91\uff0c\u4fdd\u8bc1\u4e86\u4e1a\u52a1\u4ee3\u7801\u7684\u7a33\u5b9a\u6027\u548c\u517c\u5bb9\u6027\u3002 \u6700\u540e\uff0c\u6211\u4eec\u518d\u6765\u770b\u4e0b\u96c6\u7fa4\u53ef\u9760\u6027\u7684\u95ee\u9898\u3002\u53ef\u9760\u6027\u662f\u5b9e\u9645\u4e1a\u52a1\u5e94\u7528\u7684\u4e00\u4e2a\u6838\u5fc3\u8981\u6c42\u3002 \u5bf9\u4e8e\u4e00\u4e2a\u5206\u5e03\u5f0f\u7cfb\u7edf\u6765\u8bf4\uff0c\u5b83\u7684\u53ef\u9760\u6027\u548c\u7cfb\u7edf\u4e2d\u7684\u7ec4\u4ef6\u4e2a\u6570\u6709\u5173\uff1a\u7ec4\u4ef6\u8d8a\u591a\uff0c\u6f5c\u5728\u7684\u98ce\u9669\u70b9\u4e5f\u5c31\u8d8a\u591a\u3002 5\u3001\u600e\u4e48\u4fdd\u8bc1\u96c6\u7fa4\u53ef\u9760\u6027\uff1f Codis \u4e0d\u540c\u7ec4\u4ef6\u7684\u53ef\u9760\u6027\u4fdd\u8bc1\u65b9\u6cd5\u3002 5-1 \u9996\u5148\u662f codis server codis server \u5176\u5b9e\u5c31\u662f Redis \u5b9e\u4f8b\uff0c\u53ea\u4e0d\u8fc7\u589e\u52a0\u4e86\u548c\u96c6\u7fa4\u64cd\u4f5c\u76f8\u5173\u7684\u547d\u4ee4\u3002Redis \u7684\u4e3b\u4ece\u590d\u5236\u673a\u5236\u548c\u54e8\u5175\u673a\u5236\u5728 codis server \u4e0a\u90fd\u662f\u53ef\u4ee5\u4f7f\u7528\u7684\uff0c\u6240\u4ee5\uff0cCodis \u5c31\u4f7f\u7528\u4e3b\u4ece\u96c6\u7fa4\u6765\u4fdd\u8bc1 codis server \u7684\u53ef\u9760\u6027\u3002 \u7b80\u5355\u6765\u8bf4\u5c31\u662f\uff0cCodis \u7ed9\u6bcf\u4e2a server \u914d\u7f6e\u4ece\u5e93\uff0c\u5e76\u4f7f\u7528\u54e8\u5175\u673a\u5236\u8fdb\u884c\u76d1\u63a7\uff0c\u5f53\u53d1\u751f\u6545\u969c\u65f6\uff0c\u4e3b\u4ece\u5e93\u53ef\u4ee5\u8fdb\u884c\u5207\u6362\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86 server \u7684\u53ef\u9760\u6027\u3002 \u5728\u8fd9\u79cd\u914d\u7f6e\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a server \u5c31\u6210\u4e3a\u4e86\u4e00\u4e2a server group\uff0c\u6bcf\u4e2a group \u4e2d\u662f\u4e00\u4e3b\u591a\u4ece\u7684 server\u3002\u6570\u636e\u5206\u5e03\u4f7f\u7528\u7684 Slot\uff0c\u4e5f\u662f\u6309\u7167 group \u7684\u7c92\u5ea6\u8fdb\u884c\u5206\u914d\u7684\u3002 \u540c\u65f6\uff0ccodis proxy \u5728\u8f6c\u53d1\u8bf7\u6c42\u65f6\uff0c\u4e5f\u662f\u6309\u7167\u6570\u636e\u6240\u5728\u7684 Slot \u548c group \u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u628a\u5199\u8bf7\u6c42\u53d1\u5230\u76f8\u5e94 group \u7684\u4e3b\u5e93\uff0c\u8bfb\u8bf7\u6c42\u53d1\u5230 group \u4e2d\u7684\u4e3b\u5e93\u6216\u4ece\u5e93\u4e0a\u3002 \u914d\u7f6e\u4e86 server group \u7684 Codis \u96c6\u7fa4\u67b6\u6784\u3002 \u5728 Codis \u96c6\u7fa4\u4e2d\uff0c\u6211\u4eec\u901a\u8fc7\u90e8\u7f72 server group \u548c\u54e8\u5175\u96c6\u7fa4\uff0c\u5b9e\u73b0 codis server \u7684\u4e3b\u4ece\u5207\u6362\uff0c\u63d0\u5347\u96c6\u7fa4\u53ef\u9760\u6027\u3002 \u56e0\u4e3a codis proxy \u548c Zookeeper \u8fd9\u4e24\u4e2a\u7ec4\u4ef6\u662f\u642d\u914d\u5728\u4e00\u8d77\u4f7f\u7528\u7684\uff0c 5-2 codis proxy \u548c Zookeeper \u5728 Codis \u96c6\u7fa4\u8bbe\u8ba1\u65f6\uff0cproxy \u4e0a\u7684\u4fe1\u606f\u6e90\u5934\u90fd\u662f\u6765\u81ea Zookeeper\uff08\u4f8b\u5982\u8def\u7531\u8868\uff09\u3002\u800c Zookeeper \u96c6\u7fa4\u4f7f\u7528\u591a\u4e2a\u5b9e\u4f8b\u6765\u4fdd\u5b58\u6570\u636e\uff0c\u53ea\u8981\u6709\u8d85\u8fc7\u534a\u6570\u7684 Zookeeper \u5b9e\u4f8b\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\uff0c Zookeeper \u96c6\u7fa4\u5c31\u53ef\u4ee5\u63d0\u4f9b\u670d\u52a1\uff0c\u4e5f\u53ef\u4ee5\u4fdd\u8bc1\u8fd9\u4e9b\u6570\u636e\u7684\u53ef\u9760\u6027\u3002 \u6240\u4ee5\uff0ccodis proxy \u4f7f\u7528 Zookeeper \u96c6\u7fa4\u4fdd\u5b58\u8def\u7531\u8868\uff0c\u53ef\u4ee5\u5145\u5206\u5229\u7528 Zookeeper \u7684\u9ad8\u53ef\u9760\u6027\u4fdd\u8bc1\u6765\u786e\u4fdd codis proxy \u7684\u53ef\u9760\u6027\uff0c\u4e0d\u7528\u518d\u505a\u989d\u5916\u7684\u5de5\u4f5c\u4e86\u3002\u5f53 codis proxy \u53d1\u751f\u6545\u969c\u540e\uff0c\u76f4\u63a5\u91cd\u542f proxy \u5c31\u884c\u3002 \u91cd\u542f\u540e\u7684 proxy\uff0c\u53ef\u4ee5\u901a\u8fc7 codis dashboard \u4ece Zookeeper \u96c6\u7fa4\u4e0a\u83b7\u53d6\u8def\u7531\u8868\uff0c\u7136\u540e\uff0c\u5c31\u53ef\u4ee5\u63a5\u6536\u5ba2\u6237\u7aef\u8bf7\u6c42\u8fdb\u884c\u8f6c\u53d1\u4e86\u3002\u8fd9\u6837\u7684\u8bbe\u8ba1\uff0c\u4e5f\u964d\u4f4e\u4e86 Codis \u96c6\u7fa4\u672c\u8eab\u7684\u5f00\u53d1\u590d\u6742\u5ea6\u3002 \u5bf9\u4e8e codis dashboard \u548c codis fe \u6765\u8bf4\uff0c\u5b83\u4eec\u4e3b\u8981\u63d0\u4f9b\u914d\u7f6e\u7ba1\u7406\u548c\u7ba1\u7406\u5458\u624b\u5de5\u64cd\u4f5c\uff0c\u8d1f\u8f7d\u538b\u529b\u4e0d\u5927\uff0c\u6240\u4ee5\uff0c\u5b83\u4eec\u7684\u53ef\u9760\u6027\u53ef\u4ee5\u4e0d\u7528\u989d\u5916\u8fdb\u884c\u4fdd\u8bc1\u4e86 6\u3001\u5207\u7247\u96c6\u7fa4\u65b9\u6848\u9009\u62e9\u5efa\u8bae \u6700\u540e\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u7684\u65f6\u5019\uff0c\u5bf9\u4e8e\u8fd9\u4e24\u79cd\u65b9\u6848\uff0c\u7ed9\u4f60\u63d0 4 \u6761\u5efa\u8bae\u3002 \u4ece\u7a33\u5b9a\u6027\u548c\u6210\u719f\u5ea6\u6765\u770b\uff0cCodis \u5e94\u7528\u5f97\u6bd4\u8f83\u65e9\uff0c\u5728\u4e1a\u754c\u5df2\u7ecf\u6709\u4e86\u6210\u719f\u7684\u751f\u4ea7\u90e8\u7f72\u3002\u867d\u7136 Codis \u5f15\u5165\u4e86 proxy \u548c Zookeeper\uff0c\u589e\u52a0\u4e86\u96c6\u7fa4\u590d\u6742\u5ea6\uff0c\u4f46\u662f\uff0cproxy \u7684\u65e0\u72b6\u6001\u8bbe\u8ba1\u548c Zookeeper \u81ea\u8eab\u7684\u7a33\u5b9a\u6027\uff0c\u4e5f\u7ed9 Codis \u7684\u7a33\u5b9a\u4f7f\u7528\u63d0\u4f9b\u4e86\u4fdd\u8bc1\u3002 \u800c Redis Cluster \u7684\u63a8\u51fa\u65f6\u95f4\u665a\u4e8e Codis\uff0c\u76f8\u5bf9\u6765\u8bf4\uff0c\u6210\u719f\u5ea6\u8981\u5f31\u4e8e Codis\uff0c\u5982\u679c\u4f60\u60f3\u9009\u62e9\u4e00\u4e2a\u6210\u719f\u7a33\u5b9a\u7684\u65b9\u6848\uff0cCodis \u66f4\u52a0\u5408\u9002\u4e9b\u3002 \u4ece\u4e1a\u52a1\u5e94\u7528\u5ba2\u6237\u7aef\u517c\u5bb9\u6027\u6765\u770b\uff0c\u8fde\u63a5\u5355\u5b9e\u4f8b\u7684\u5ba2\u6237\u7aef\u53ef\u4ee5\u76f4\u63a5\u8fde\u63a5 codis proxy\uff0c\u800c\u539f\u672c\u8fde\u63a5\u5355\u5b9e\u4f8b\u7684\u5ba2\u6237\u7aef\u8981\u60f3\u8fde\u63a5 Redis Cluster \u7684\u8bdd\uff0c\u5c31\u9700\u8981\u5f00\u53d1\u65b0\u529f \u80fd\u3002\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u7684\u4e1a\u52a1\u5e94\u7528\u4e2d\u5927\u91cf\u4f7f\u7528\u4e86\u5355\u5b9e\u4f8b\u7684\u5ba2\u6237\u7aef\uff0c\u800c\u73b0\u5728\u60f3\u5e94\u7528\u5207\u7247\u96c6\u7fa4\u7684\u8bdd\uff0c\u5efa\u8bae\u4f60\u9009\u62e9 Codis\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u4fee\u6539\u4e1a\u52a1\u5e94\u7528\u4e2d\u7684\u5ba2\u6237\u7aef \u4ece\u4f7f\u7528 Redis \u65b0\u547d\u4ee4\u548c\u65b0\u7279\u6027\u6765\u770b\uff0cCodis server \u662f\u57fa\u4e8e\u5f00\u6e90\u7684 Redis 3.2.8 \u5f00\u53d1\u7684\uff0c\u6240\u4ee5\uff0cCodis \u5e76\u4e0d\u652f\u6301 Redis \u540e\u7eed\u7684\u5f00\u6e90\u7248\u672c\u4e2d\u7684\u65b0\u589e\u547d\u4ee4\u548c\u6570\u636e\u7c7b\u578b\u3002\u53e6\u5916\uff0cCodis \u5e76\u6ca1\u6709\u5b9e\u73b0\u5f00\u6e90 Redis \u7248\u672c\u7684\u6240\u6709\u547d\u4ee4\uff0c\u6bd4\u5982 BITOP \u3001 BLPOP \u3001 BRPOP \uff0c\u4ee5\u53ca\u548c\u4e0e\u4e8b\u52a1\u76f8\u5173\u7684 MUTLI \u3001 EXEC \u7b49\u547d\u4ee4\u3002 Codis \u5b98\u7f51\u4e0a\u5217\u51fa\u4e86\u4e0d\u88ab\u652f\u6301\u7684\u547d\u4ee4\u5217\u8868 \uff0c\u4f60\u5728\u4f7f\u7528\u65f6\u8bb0\u5f97\u53bb\u6838\u67e5\u4e00\u4e0b\u3002\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u60f3\u4f7f\u7528\u5f00\u6e90 Redis \u7248\u672c\u7684\u65b0\u7279\u6027\uff0cRedis Cluster \u662f\u4e00\u4e2a\u5408\u9002\u7684\u9009\u62e9\u3002 \u4ece\u6570\u636e\u8fc1\u79fb\u6027\u80fd\u7ef4\u5ea6\u6765\u770b\uff0cCodis \u80fd\u652f\u6301\u5f02\u6b65\u8fc1\u79fb\uff0c\u5f02\u6b65\u8fc1\u79fb\u5bf9\u96c6\u7fa4\u5904\u7406\u6b63\u5e38\u8bf7\u6c42\u7684\u6027\u80fd\u5f71\u54cd\u8981\u6bd4\u4f7f\u7528\u540c\u6b65\u8fc1\u79fb\u7684\u5c0f\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u4f60\u5728\u5e94\u7528\u96c6\u7fa4\u65f6\uff0c\u6570\u636e\u8fc1\u79fb\u6bd4\u8f83\u9891\u7e41\u7684\u8bdd\uff0cCodis \u662f\u4e2a\u66f4\u5408\u9002\u7684\u9009\u62e9\u3002 7\u3001\u672c\u8282\u5c0f\u7ed3 Codis \u96c6\u7fa4\u5305\u542b codis server\u3001codis proxy\u3001Zookeeper\u3001codis dashboard \u548c codis fe \u8fd9\u56db\u5927\u7c7b\u7ec4\u4ef6\u3002 codis proxy \u548c codis server \u8d1f\u8d23\u5904\u7406\u6570\u636e\u8bfb\u5199\u8bf7\u6c42\uff0c\u5176\u4e2d\uff0ccodis proxy \u548c\u5ba2\u6237\u7aef\u8fde\u63a5\uff0c\u63a5\u6536\u8bf7\u6c42\uff0c\u5e76\u8f6c\u53d1\u8bf7\u6c42\u7ed9 codis server\uff0c\u800c codis server \u8d1f\u8d23\u5177\u4f53\u5904\u7406\u8bf7\u6c42\u3002 codis dashboard \u548c codis fe \u8d1f\u8d23\u96c6\u7fa4\u7ba1\u7406\uff0c\u5176\u4e2d\uff0ccodis dashboard \u6267\u884c\u7ba1\u7406\u64cd\u4f5c\uff0c\u800c codis fe \u63d0\u4f9b Web \u7ba1\u7406\u754c\u9762\u3002 Zookeeper \u96c6\u7fa4\u8d1f\u8d23\u4fdd\u5b58\u96c6\u7fa4\u7684\u6240\u6709\u5143\u6570\u636e\u4fe1\u606f\uff0c\u5305\u62ec\u8def\u7531\u8868\u3001proxy \u5b9e\u4f8b\u4fe1\u606f\u7b49\u3002\u8fd9\u91cc\uff0c\u6709\u4e2a\u5730\u65b9\u9700\u8981\u4f60\u6ce8\u610f\uff0c\u9664\u4e86\u4f7f\u7528 Zookeeper\uff0cCodis \u8fd8\u53ef\u4ee5\u4f7f\u7528 etcd \u6216\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u4fdd\u5b58\u5143\u6570\u636e\u4fe1\u606f\u3002 \u5173\u4e8e Codis \u548c Redis Cluster \u7684\u9009\u578b\u8003\u8651\uff0c\u4ece\u7a33\u5b9a\u6027\u6210\u719f\u5ea6\u3001\u5ba2\u6237\u7aef\u517c\u5bb9\u6027\u3001Redis \u65b0\u7279\u6027\u4f7f\u7528\u4ee5\u53ca\u6570\u636e\u8fc1\u79fb\u6027\u80fd\u56db\u4e2a\u65b9\u9762\u7ed9\u4f60\u63d0\u4f9b\u4e86\u5efa\u8bae\u3002 \u6211\u518d\u7ed9\u4f60\u63d0\u4f9b\u4e00\u4e2a Codis \u4f7f\u7528\u4e0a\u7684\u5c0f\u5efa\u8bae\uff1a \u5f53\u4f60\u6709\u591a\u6761\u4e1a\u52a1\u7ebf\u8981\u4f7f\u7528 Codis \u65f6\uff0c\u53ef\u4ee5\u542f\u52a8\u591a\u4e2a codis dashboard\uff0c\u6bcf\u4e2a dashboard \u7ba1\u7406\u4e00\u90e8\u5206 codis server\uff0c\u540c\u65f6\uff0c\u518d\u7528\u4e00\u4e2a dashboard \u5bf9\u5e94\u8d1f\u8d23\u4e00\u4e2a\u4e1a\u52a1\u7ebf\u7684\u96c6\u7fa4\u7ba1\u7406\uff0c\u8fd9\u6837\uff0c\u5c31\u53ef\u4ee5\u505a\u5230\u7528\u4e00\u4e2a Codis \u96c6\u7fa4\u5b9e\u73b0\u591a\u6761\u4e1a\u52a1\u7ebf\u7684\u9694\u79bb\u7ba1\u7406\u4e86 \u3002","title":"\u7b2c\u4e09\u8282 Redis Codis \u96c6\u7fa4\u65b9\u6848"},{"location":"chap7/3redis_codis_cluster/#redis-codis","text":"Redis Cluster \u65b9\u6848\u6b63\u5f0f\u53d1\u5e03\u524d\uff0c\u4e1a\u754c\u5df2\u7ecf\u5e7f\u6cdb\u4f7f\u7528\u7684 Codis\u3002","title":"\u7b2c\u4e09\u8282 Redis Codis \u96c6\u7fa4\u65b9\u6848"},{"location":"chap7/3redis_codis_cluster/#1codis","text":"Codis \u96c6\u7fa4\u4e2d\u5305\u542b\u4e86 4 \u7c7b\u5173\u952e\u7ec4\u4ef6\u3002 codis server\uff1a\u8fd9\u662f\u8fdb\u884c\u4e86\u4e8c\u6b21\u5f00\u53d1\u7684 Redis \u5b9e\u4f8b\uff0c\u5176\u4e2d\u589e\u52a0\u4e86\u989d\u5916\u7684\u6570\u636e\u7ed3\u6784\uff0c\u652f\u6301\u6570\u636e\u8fc1\u79fb\u64cd\u4f5c\uff0c\u4e3b\u8981\u8d1f\u8d23\u5904\u7406\u5177\u4f53\u7684\u6570\u636e\u8bfb\u5199\u8bf7\u6c42\u3002 codis proxy\uff1a\u63a5\u6536\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u5e76\u628a\u8bf7\u6c42\u8f6c\u53d1\u7ed9 codis server\u3002 Zookeeper \u96c6\u7fa4\uff1a\u4fdd\u5b58\u96c6\u7fa4\u5143\u6570\u636e\uff0c\u4f8b\u5982\u6570\u636e\u4f4d\u7f6e\u4fe1\u606f\u548c codis proxy \u4fe1\u606f\u3002 codis dashboard \u548c codis fe\uff1a\u5171\u540c\u7ec4\u6210\u4e86\u96c6\u7fa4\u7ba1\u7406\u5de5\u5177\u3002 \u5176\u4e2d\uff0ccodis dashboard \u8d1f\u8d23\u6267\u884c\u96c6\u7fa4\u7ba1\u7406\u5de5\u4f5c\uff0c\u5305\u62ec\u589e\u5220 codis server\u3001codis proxy \u548c\u8fdb\u884c\u6570\u636e\u8fc1\u79fb\u3002 \u800c codis fe \u8d1f\u8d23\u63d0\u4f9b dashboard \u7684 Web \u64cd\u4f5c\u754c\u9762\uff0c\u4fbf\u4e8e\u6211\u4eec\u76f4\u63a5\u5728 Web \u754c\u9762\u4e0a\u8fdb\u884c\u96c6\u7fa4\u7ba1\u7406\u3002 Codis \u96c6\u7fa4\u7684\u67b6\u6784\u548c\u5173\u952e\u7ec4\u4ef6\u3002 \u9996\u5148\uff0c\u4e3a\u4e86\u8ba9\u96c6\u7fa4\u80fd\u63a5\u6536\u5e76\u5904\u7406\u8bf7\u6c42\uff0c\u6211\u4eec\u8981\u5148\u4f7f\u7528 codis dashboard \u8bbe\u7f6e codis server \u548c codis proxy \u7684\u8bbf\u95ee\u5730\u5740\uff0c\u5b8c\u6210\u8bbe\u7f6e\u540e\uff0ccodis server \u548c codis proxy \u624d\u4f1a\u5f00\u59cb\u63a5\u6536\u8fde\u63a5\u3002 \u7136\u540e\uff0c\u5f53\u5ba2\u6237\u7aef\u8981\u8bfb\u5199\u6570\u636e\u65f6\uff0c\u5ba2\u6237\u7aef\u76f4\u63a5\u548c codis proxy \u5efa\u7acb\u8fde\u63a5\u3002 \u4f60\u53ef\u80fd\u4f1a\u62c5\u5fc3\uff0c\u65e2\u7136\u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u662f proxy\uff0c\u662f\u4e0d\u662f\u9700\u8981\u4fee\u6539\u5ba2\u6237\u7aef\uff0c\u624d\u80fd\u8bbf\u95ee proxy\uff1f \u5176\u5b9e\uff0c\u4f60\u4e0d\u7528\u62c5\u5fc3\uff0ccodis proxy \u672c\u8eab\u652f\u6301 Redis \u7684 RESP \u4ea4\u4e92\u534f\u8bae\uff0c\u6240\u4ee5\uff0c\u5ba2\u6237\u7aef\u8bbf\u95ee codis proxy \u65f6\uff0c\u548c\u8bbf\u95ee\u539f\u751f\u7684 Redis \u5b9e\u4f8b\u6ca1\u6709\u4ec0\u4e48\u533a\u522b\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u539f\u672c\u8fde\u63a5\u5355\u5b9e\u4f8b\u7684\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u8f7b\u677e\u5730\u548c Codis \u96c6\u7fa4\u5efa\u7acb\u8d77\u8fde\u63a5\u4e86\u3002 \u6700\u540e\uff0ccodis proxy \u63a5\u6536\u5230\u8bf7\u6c42\uff0c\u5c31\u4f1a\u67e5\u8be2\u8bf7\u6c42\u6570\u636e\u548c codis server \u7684\u6620\u5c04\u5173\u7cfb\uff0c\u5e76\u628a\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u76f8\u5e94\u7684 codis server \u8fdb\u884c\u5904\u7406\u3002\u5f53 codis server \u5904\u7406\u5b8c\u8bf7\u6c42\u540e\uff0c\u4f1a\u628a\u7ed3\u679c\u8fd4\u56de\u7ed9 codis proxy\uff0cproxy \u518d\u628a\u6570\u636e\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002 Codis \u96c6\u7fa4\u67b6\u6784 4 \u65b9\u9762\u6280\u672f\u56e0\u7d20\uff1a\u6570\u636e\u5206\u5e03\u3001\u96c6\u7fa4\u6269\u5bb9\u548c\u6570\u636e\u8fc1\u79fb\u3001\u5ba2\u6237\u7aef\u517c\u5bb9\u6027\u3001\u53ef\u9760\u6027\u4fdd\u8bc1\uff0c","title":"1\u3001Codis \u7684\u6574\u4f53\u67b6\u6784\u548c\u57fa\u672c\u6d41\u7a0b"},{"location":"chap7/3redis_codis_cluster/#2codis","text":"\u7b2c\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\uff0c \u6570\u636e\u662f\u600e\u4e48\u5728\u591a\u4e2a\u5b9e\u4f8b\u4e0a\u5206\u5e03\u7684","title":"2\u3001Codis \u7684\u5173\u952e\u6280\u672f\u539f\u7406"},{"location":"chap7/3redis_codis_cluster/#2-1","text":"\u5728 Codis \u96c6\u7fa4\u4e2d\uff0c\u4e00\u4e2a\u6570\u636e\u5e94\u8be5\u4fdd\u5b58\u5728\u54ea\u4e2a codis server \u4e0a\uff0c\u8fd9\u662f\u901a\u8fc7\u903b\u8f91\u69fd\uff08Slot\uff09\u6620\u5c04\u6765\u5b8c\u6210\u7684\uff0c\u5177\u4f53\u6765\u8bf4\uff0c\u603b\u5171\u5206\u6210\u4e24\u6b65\u3002 \u7b2c\u4e00\u6b65\uff0cCodis \u96c6\u7fa4\u4e00\u5171\u6709 1024 \u4e2a Slot\uff0c\u7f16\u53f7\u4f9d\u6b21\u662f 0 \u5230 1023\u3002\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e9b Slot \u624b\u52a8\u5206\u914d\u7ed9 codis server\uff0c\u6bcf\u4e2a server \u4e0a\u5305\u542b\u4e00\u90e8\u5206 Slot\u3002\u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u8ba9 codis dashboard \u8fdb\u884c\u81ea\u52a8\u5206\u914d\uff0c\u4f8b\u5982\uff0cdashboard \u628a 1024 \u4e2a Slot \u5728\u6240\u6709 server \u4e0a\u5747\u5206\u3002 \u7b2c\u4e8c\u6b65\uff0c\u5f53\u5ba2\u6237\u7aef\u8981\u8bfb\u5199\u6570\u636e\u65f6\uff0c\u4f1a\u4f7f\u7528 CRC32 \u7b97\u6cd5\u8ba1\u7b97\u6570\u636e key \u7684\u54c8\u5e0c\u503c\uff0c\u5e76\u628a\u8fd9\u4e2a\u54c8\u5e0c\u503c\u5bf9 1024 \u53d6\u6a21\u3002\u800c\u53d6\u6a21\u540e\u7684\u503c\uff0c\u5219\u5bf9\u5e94 Slot \u7684\u7f16\u53f7\u3002\u6b64\u65f6\uff0c\u6839\u636e\u7b2c\u4e00\u6b65\u5206\u914d\u7684 Slot \u548c server \u5bf9\u5e94\u5173\u7cfb\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u77e5\u9053\u6570\u636e\u4fdd\u5b58\u5728\u54ea\u4e2a server \u4e0a\u4e86\u3002 \u6211\u6765\u4e3e\u4e2a\u4f8b\u5b50\u3002 \u4e0b\u56fe\u663e\u793a\u7684\u5c31\u662f\u6570\u636e\u3001Slot \u548c codis server \u7684\u6620\u5c04\u4fdd\u5b58\u5173\u7cfb\u3002 \u5176\u4e2d\uff0cSlot 0 \u548c 1 \u88ab\u5206\u914d\u5230\u4e86 server1\uff0c Slot 2 \u5206\u914d\u5230 server2\uff0c Slot 1022 \u548c 1023 \u88ab\u5206\u914d\u5230 server8\u3002 \u5f53\u5ba2\u6237\u7aef\u8bbf\u95ee key 1 \u548c key 2 \u65f6\uff0c\u8fd9\u4e24\u4e2a\u6570\u636e\u7684 CRC32 \u503c\u5bf9 1024 \u53d6\u6a21\u540e\uff0c\u5206\u522b\u662f 1 \u548c 1022\u3002\u56e0\u6b64\uff0c\u5b83\u4eec\u4f1a\u88ab\u4fdd\u5b58\u5728 Slot 1 \u548c Slot 1022 \u4e0a\uff0c\u800c Slot 1 \u548c Slot 1022 \u5df2\u7ecf\u88ab\u5206\u914d\u5230 codis server 1 \u548c 8 \u4e0a\u4e86\u3002\u8fd9\u6837\u4e00\u6765\uff0ckey 1 \u548c key 2 \u7684\u4fdd\u5b58\u4f4d\u7f6e\u5c31\u5f88\u6e05\u695a\u4e86\u3002 \u5728\u6570\u636e\u5206\u5e03\u7684\u5b9e\u73b0\u65b9\u6cd5\u4e0a\uff0cCodis \u548c Redis Cluster \u5f88\u76f8\u4f3c\uff0c\u90fd\u91c7\u7528\u4e86 key \u6620\u5c04\u5230 Slot\u3001Slot \u518d\u5206\u914d\u5230\u5b9e\u4f8b\u4e0a\u7684\u673a\u5236","title":"2-1 \u6570\u636e\u5982\u4f55\u5728\u96c6\u7fa4\u91cc\u5206\u5e03\uff1f"},{"location":"chap7/3redis_codis_cluster/#2-2-codis-redis-cluster","text":"Codis \u4e2d\u7684\u8def\u7531\u8868\u662f\u6211\u4eec\u901a\u8fc7 codis dashboard \u5206\u914d\u548c\u4fee\u6539\u7684\uff0c\u5e76\u88ab\u4fdd\u5b58\u5728 Zookeeper \u96c6\u7fa4\u4e2d\u3002 \u4e00\u65e6\u6570\u636e\u4f4d\u7f6e\u53d1\u751f\u53d8\u5316\uff08\u4f8b\u5982\u6709\u5b9e\u4f8b\u589e\u51cf\uff09\uff0c\u8def\u7531\u8868\u88ab\u4fee\u6539\u4e86\uff0ccodis dashbaord \u5c31\u4f1a\u628a\u4fee\u6539\u540e\u7684\u8def\u7531\u8868\u53d1\u9001\u7ed9 codis proxy\uff0cproxy \u5c31\u53ef\u4ee5\u6839\u636e\u6700\u65b0\u7684\u8def\u7531\u4fe1\u606f\u8f6c\u53d1\u8bf7\u6c42\u4e86\u3002 \u5728 Redis Cluster \u4e2d\uff0c\u6570\u636e\u8def\u7531\u8868\u662f\u901a\u8fc7\u6bcf\u4e2a\u5b9e\u4f8b\u76f8\u4e92\u95f4\u7684\u901a\u4fe1\u4f20\u9012\u7684\uff0c\u6700\u540e\u4f1a\u5728\u6bcf\u4e2a\u5b9e\u4f8b\u4e0a\u4fdd\u5b58\u4e00\u4efd\u3002 \u5f53\u6570\u636e\u8def\u7531\u4fe1\u606f\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u5c31\u9700\u8981\u5728\u6240\u6709\u5b9e\u4f8b\u95f4\u901a\u8fc7\u7f51\u7edc\u6d88\u606f\u8fdb\u884c\u4f20\u9012\u3002\u6240\u4ee5\uff0c\u5982\u679c\u5b9e\u4f8b\u6570\u91cf\u8f83\u591a\u7684\u8bdd\uff0c\u5c31\u4f1a\u6d88\u8017\u8f83\u591a\u7684\u96c6\u7fa4\u7f51\u7edc\u8d44\u6e90\u3002 \u6570\u636e\u5206\u5e03\u89e3\u51b3\u4e86\u65b0\u6570\u636e\u5199\u5165\u65f6\u8be5\u4fdd\u5b58\u5728\u54ea\u4e2a server \u7684\u95ee\u9898\uff0c\u4f46\u662f\uff0c\u5f53\u4e1a\u52a1\u6570\u636e\u589e\u52a0\u540e\uff0c\u5982\u679c\u96c6\u7fa4\u4e2d\u7684\u73b0\u6709\u5b9e\u4f8b\u4e0d\u8db3\u4ee5\u4fdd\u5b58\u6240\u6709\u6570\u636e\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5bf9\u96c6\u7fa4\u8fdb\u884c\u6269\u5bb9\u3002","title":"2-2 Codis \u548c Redis Cluster  \u660e\u663e\u7684\u533a\u522b"},{"location":"chap7/3redis_codis_cluster/#3","text":"","title":"3\u3001\u96c6\u7fa4\u6269\u5bb9\u548c\u6570\u636e\u8fc1\u79fb\u5982\u4f55\u8fdb\u884c?"},{"location":"chap7/3redis_codis_cluster/#3-1-codis","text":"Codis \u96c6\u7fa4\u6269\u5bb9\u5305\u62ec\u4e86\u4e24\u65b9\u9762\uff1a\u589e\u52a0 codis server \u548c\u589e\u52a0 codis proxy\u3002","title":"3-1 Codis \u96c6\u7fa4\u6269\u5bb9"},{"location":"chap7/3redis_codis_cluster/#3-2-codis-server","text":"\u8fd9\u4e2a\u8fc7\u7a0b\u4e3b\u8981\u6d89\u53ca\u5230\u4e24\u6b65\u64cd\u4f5c\uff1a \u542f\u52a8\u65b0\u7684 codis server\uff0c\u5c06\u5b83\u52a0\u5165\u96c6\u7fa4\uff1b \u628a\u90e8\u5206\u6570\u636e\u8fc1\u79fb\u5230\u65b0\u7684 server\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u91cc\u7684\u6570\u636e\u8fc1\u79fb\u662f\u4e00\u4e2a\u91cd\u8981\u7684\u673a\u5236 Codis \u96c6\u7fa4\u6309\u7167 Slot \u7684\u7c92\u5ea6\u8fdb\u884c\u6570\u636e\u8fc1\u79fb\u3002 \u5728\u6e90 server \u4e0a\uff0cCodis \u4ece\u8981\u8fc1\u79fb\u7684 Slot \u4e2d\u968f\u673a\u9009\u62e9\u4e00\u4e2a\u6570\u636e\uff0c\u53d1\u9001\u7ed9\u76ee\u7684 server\u3002 \u76ee\u7684 server \u786e\u8ba4\u6536\u5230\u6570\u636e\u540e\uff0c\u4f1a\u7ed9\u6e90 server \u8fd4\u56de\u786e\u8ba4\u6d88\u606f\u3002\u8fd9\u65f6\uff0c \u6e90 server \u4f1a\u5728\u672c\u5730\u5c06\u521a\u624d\u8fc1\u79fb\u7684\u6570\u636e\u5220\u9664\u3002 \u7b2c\u4e00\u6b65\u548c\u7b2c\u4e8c\u6b65\u5c31\u662f\u5355\u4e2a\u6570\u636e\u7684\u8fc1\u79fb\u8fc7\u7a0b\u3002Codis \u4f1a\u4e0d\u65ad\u91cd\u590d\u8fd9\u4e2a\u8fc1\u79fb\u8fc7\u7a0b\uff0c\u76f4\u5230\u8981\u8fc1\u79fb\u7684 Slot \u4e2d\u7684\u6570\u636e\u5168\u90e8\u8fc1\u79fb\u5b8c\u6210\u3002 \u5355\u4e2a\u6570\u636e\u7684\u8fc1\u79fb\u8fc7\u7a0b\uff0cCodis \u5b9e\u73b0\u4e86\u4e24\u79cd\u8fc1\u79fb\u6a21\u5f0f\uff0c\u5206\u522b\u662f\u540c\u6b65\u8fc1\u79fb\u548c\u5f02\u6b65\u8fc1\u79fb\u3002","title":"3-2 \u589e\u52a0 codis server"},{"location":"chap7/3redis_codis_cluster/#3-2-1","text":"\u540c\u6b65\u8fc1\u79fb\u662f\u6307\uff0c\u5728\u6570\u636e\u4ece\u6e90 server \u53d1\u9001\u7ed9\u76ee\u7684 server \u7684\u8fc7\u7a0b\u4e2d\uff0c\u6e90 server \u662f\u963b\u585e\u7684\uff0c\u65e0\u6cd5\u5904\u7406\u65b0\u7684\u8bf7\u6c42\u64cd\u4f5c\u3002 \u8fd9\u79cd\u6a21\u5f0f\u5f88\u5bb9\u6613\u5b9e\u73b0\uff0c\u4f46\u662f\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\u4f1a\u6d89\u53ca\u591a\u4e2a\u64cd\u4f5c\uff08\u5305\u62ec\u6570\u636e\u5728\u6e90 server \u5e8f\u5217\u5316\u3001\u7f51\u7edc\u4f20\u8f93\u3001\u5728\u76ee\u7684 server \u53cd\u5e8f\u5217\u5316\uff0c\u4ee5\u53ca\u5728\u6e90 server \u5220\u9664\uff09\uff0c\u5982\u679c\u8fc1\u79fb\u7684\u6570\u636e\u662f\u4e00\u4e2a bigkey\uff0c\u6e90 server \u5c31\u4f1a\u963b\u585e\u8f83\u957f\u65f6\u95f4\uff0c\u65e0\u6cd5\u53ca\u65f6\u5904\u7406\u7528\u6237\u8bf7\u6c42\u3002","title":"3-2-1 \u540c\u6b65\u8fc1\u79fb"},{"location":"chap7/3redis_codis_cluster/#3-2-2","text":"\u4e3a\u4e86\u907f\u514d\u6570\u636e\u8fc1\u79fb\u963b\u585e\u6e90 server\uff0cCodis \u5b9e\u73b0\u7684\u7b2c\u4e8c\u79cd\u8fc1\u79fb\u6a21\u5f0f\u5c31\u662f\u5f02\u6b65\u8fc1\u79fb\u3002\u5f02\u6b65\u8fc1\u79fb\u7684\u5173\u952e\u7279\u70b9\u6709\u4e24\u4e2a\u3002 \u7b2c\u4e00\u4e2a\u7279\u70b9\u662f\uff0c\u5f53\u6e90 server \u628a\u6570\u636e\u53d1\u9001\u7ed9\u76ee\u7684 server \u540e\uff0c\u5c31\u53ef\u4ee5\u5904\u7406\u5176\u4ed6\u8bf7\u6c42\u64cd\u4f5c\u4e86\uff0c\u4e0d\u7528\u7b49\u5230\u76ee\u7684 server \u7684\u547d\u4ee4\u6267\u884c\u5b8c \u3002\u800c\u76ee\u7684 server \u4f1a\u5728\u6536\u5230\u6570\u636e\u5e76\u53cd\u5e8f\u5217\u5316\u4fdd\u5b58\u5230\u672c\u5730\u540e\uff0c\u7ed9\u6e90 server \u53d1\u9001\u4e00\u4e2a ACK \u6d88\u606f\uff0c\u8868\u660e\u8fc1\u79fb\u5b8c\u6210\u3002\u6b64\u65f6\uff0c\u6e90 server \u5728\u672c\u5730\u628a\u521a\u624d\u8fc1\u79fb\u7684\u6570\u636e\u5220\u9664\u3002 \u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u8fc1\u79fb\u7684\u6570\u636e\u4f1a\u88ab\u8bbe\u7f6e\u4e3a\u53ea\u8bfb\uff0c\u6240\u4ee5\uff0c\u6e90 server \u4e0a\u7684\u6570\u636e\u4e0d\u4f1a\u88ab\u4fee\u6539 \uff0c\u81ea\u7136\u4e5f\u5c31\u4e0d\u4f1a\u51fa\u73b0\u201c\u548c\u76ee\u7684 server \u4e0a\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u201d\u7684\u95ee\u9898\u4e86\u3002 \u7b2c\u4e8c\u4e2a\u7279\u70b9\u662f\uff0c\u5bf9\u4e8e bigkey\uff0c\u5f02\u6b65\u8fc1\u79fb\u91c7\u7528\u4e86\u62c6\u5206\u6307\u4ee4\u7684\u65b9\u5f0f\u8fdb\u884c\u8fc1\u79fb\u3002 \u5177\u4f53\u6765\u8bf4\u5c31\u662f\uff0c\u5bf9 bigkey \u4e2d\u6bcf\u4e2a\u5143\u7d20\uff0c\u7528\u4e00\u6761\u6307\u4ee4\u8fdb\u884c\u8fc1\u79fb\uff0c\u800c\u4e0d\u662f\u628a\u6574\u4e2a bigkey \u8fdb\u884c\u5e8f\u5217\u5316\u540e\u518d\u6574\u4f53\u4f20\u8f93\u3002 \u8fd9\u79cd\u5316\u6574\u4e3a\u96f6\u7684\u65b9\u5f0f\uff0c\u5c31\u907f\u514d\u4e86 bigkey \u8fc1\u79fb\u65f6\uff0c\u56e0\u4e3a\u8981\u5e8f\u5217\u5316\u5927\u91cf\u6570\u636e\u800c\u963b\u585e\u6e90 server \u7684\u95ee\u9898\u3002 \u6b64\u5916\uff0c\u5f53 bigkey \u8fc1\u79fb\u4e86\u4e00\u90e8\u5206\u6570\u636e\u540e\uff0c \u5982\u679c Codis \u53d1\u751f\u6545\u969c\uff0c\u5c31\u4f1a\u5bfc\u81f4 bigkey \u7684\u4e00\u90e8\u5206\u5143\u7d20\u5728\u6e90 server\uff0c\u800c\u53e6\u4e00\u90e8\u5206\u5143\u7d20\u5728\u76ee\u7684 server\uff0c\u8fd9\u5c31\u7834\u574f\u4e86\u8fc1\u79fb\u7684\u539f\u5b50\u6027\u3002 \u6240\u4ee5\uff0cCodis \u4f1a\u5728\u76ee\u6807 server \u4e0a\uff0c\u7ed9 bigkey \u7684\u5143\u7d20\u8bbe\u7f6e\u4e00\u4e2a\u4e34\u65f6\u8fc7\u671f\u65f6\u95f4\u3002 \u5982\u679c\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\u53d1\u751f\u6545\u969c\uff0c\u90a3\u4e48\uff0c\u76ee\u6807 server \u4e0a\u7684 key \u4f1a\u5728\u8fc7\u671f\u540e\u88ab\u5220\u9664\uff0c\u4e0d\u4f1a\u5f71\u54cd\u8fc1\u79fb\u7684\u539f\u5b50\u6027\u3002\u5f53\u6b63\u5e38\u5b8c\u6210\u8fc1\u79fb\u540e\uff0cbigkey \u5143\u7d20\u7684\u4e34\u65f6\u8fc7\u671f\u65f6\u95f4\u4f1a\u88ab\u5220\u9664\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u5982\u6211\u4eec\u8981\u8fc1\u79fb\u4e00\u4e2a\u6709 1 \u4e07\u4e2a\u5143\u7d20\u7684 List \u7c7b\u578b\u6570\u636e\uff0c\u5f53\u4f7f\u7528\u5f02\u6b65\u8fc1\u79fb\u65f6\uff0c\u6e90 server \u5c31\u4f1a\u7ed9\u76ee\u7684 server \u4f20\u8f93 1 \u4e07\u6761 RPUSH \u547d\u4ee4\uff0c\u6bcf\u6761\u547d\u4ee4\u5bf9\u5e94\u4e86 List \u4e2d\u4e00\u4e2a\u5143\u7d20\u7684\u63d2\u5165\u3002\u5728\u76ee\u7684 server \u4e0a\uff0c\u8fd9 1 \u4e07\u6761\u547d\u4ee4\u518d\u88ab\u4f9d\u6b21\u6267\u884c\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u6570\u636e\u8fc1\u79fb\u3002 \u4e3a\u4e86\u63d0\u5347\u8fc1\u79fb\u7684\u6548\u7387\uff0c Codis \u5728\u5f02\u6b65\u8fc1\u79fb Slot \u65f6\uff0c\u5141\u8bb8\u6bcf\u6b21\u8fc1\u79fb\u591a\u4e2a key\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u5f02\u6b65\u8fc1\u79fb\u547d\u4ee4 SLOTSMGRTTAGSLOT-ASYNC \u7684\u53c2\u6570 numkeys \u8bbe\u7f6e\u6bcf\u6b21\u8fc1\u79fb\u7684 key \u6570\u91cf\u3002","title":"3-2-2 \u5f02\u6b65\u8fc1\u79fb"},{"location":"chap7/3redis_codis_cluster/#3-3-codis-proxy","text":"\u56e0\u4e3a\u5728 Codis \u96c6\u7fa4\u4e2d\uff0c\u5ba2\u6237\u7aef\u662f\u548c codis proxy \u76f4\u63a5\u8fde\u63a5\u7684\uff0c\u6240\u4ee5\uff0c\u5f53\u5ba2\u6237\u7aef\u589e\u52a0\u65f6\uff0c\u4e00\u4e2a proxy \u65e0\u6cd5\u652f\u6491\u5927\u91cf\u7684\u8bf7\u6c42\u64cd\u4f5c\uff0c\u6b64\u65f6\uff0c\u6211\u4eec\u5c31\u9700\u8981\u589e\u52a0 proxy\u3002 \u589e\u52a0 proxy \u6bd4\u8f83\u5bb9\u6613\uff0c\u76f4\u63a5\u542f\u52a8 proxy\uff0c\u518d\u901a\u8fc7 codis dashboard \u628a proxy \u52a0\u5165\u96c6\u7fa4\u5c31\u884c\u3002 \u6b64\u65f6\uff0ccodis proxy \u7684\u8bbf\u95ee\u8fde\u63a5\u4fe1\u606f\u90fd\u4f1a\u4fdd\u5b58\u5728 Zookeeper \u4e0a\u3002\u6240\u4ee5\uff0c\u5f53\u65b0\u589e\u4e86 proxy \u540e\uff0cZookeeper \u4e0a\u4f1a\u6709\u6700\u65b0\u7684\u8bbf\u95ee\u5217\u8868\uff0c\u5ba2\u6237\u7aef\u4e5f\u5c31\u53ef\u4ee5\u4ece Zookeeper \u4e0a\u8bfb\u53d6 proxy \u8bbf\u95ee\u5217\u8868\uff0c\u628a\u8bf7\u6c42\u53d1\u9001\u7ed9\u65b0\u589e\u7684 proxy\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5ba2\u6237\u7aef\u7684\u8bbf\u95ee\u538b\u529b\u5c31\u53ef\u4ee5\u5728\u591a\u4e2a proxy \u4e0a\u5206\u62c5\u5904\u7406\u4e86\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a","title":"3-3 \u589e\u52a0 codis proxy"},{"location":"chap7/3redis_codis_cluster/#4","text":"\u4f7f\u7528 Redis \u5355\u5b9e\u4f8b\u65f6\uff0c\u5ba2\u6237\u7aef\u53ea\u8981\u7b26\u5408 RESP \u534f\u8bae\uff0c\u5c31\u53ef\u4ee5\u548c\u5b9e\u4f8b\u8fdb\u884c\u4ea4\u4e92\u548c\u8bfb\u5199\u6570\u636e\u3002\u4f46\u662f\uff0c\u5728\u4f7f\u7528\u5207\u7247\u96c6\u7fa4\u65f6\uff0c\u6709\u4e9b\u529f\u80fd\u662f\u548c\u5355\u5b9e\u4f8b\u4e0d\u4e00\u6837\u7684\uff0c\u6bd4\u5982\u96c6\u7fa4\u4e2d\u7684\u6570\u636e\u8fc1\u79fb\u64cd\u4f5c\uff0c\u5728\u5355\u5b9e\u4f8b\u4e0a\u662f\u6ca1\u6709\u7684\uff0c\u800c\u4e14\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\uff0c\u6570\u636e\u8bbf\u95ee\u8bf7\u6c42\u53ef\u80fd\u8981\u88ab\u91cd\u5b9a\u5411\uff08\u4f8b\u5982 Redis Cluster \u4e2d\u7684 MOVE \u547d\u4ee4\uff09\u3002 \u6240\u4ee5\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u589e\u52a0\u548c\u96c6\u7fa4\u529f\u80fd\u76f8\u5173\u7684\u547d\u4ee4\u64cd\u4f5c\u7684\u652f\u6301\u3002\u5982\u679c\u539f\u6765\u4f7f\u7528\u5355\u5b9e\u4f8b\u5ba2\u6237\u7aef\uff0c\u60f3\u8981\u6269\u5bb9\u4f7f\u7528\u96c6\u7fa4\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u65b0\u5ba2\u6237\u7aef\uff0c\u8fd9\u5bf9\u4e8e\u4e1a\u52a1\u5e94\u7528\u7684\u517c\u5bb9\u6027\u6765\u8bf4\uff0c\u5e76\u4e0d\u662f\u7279\u522b\u53cb\u597d\u3002 Codis \u96c6\u7fa4\u5728\u8bbe\u8ba1\u65f6\uff0c\u5c31\u5145\u5206\u8003\u8651\u4e86\u5bf9\u73b0\u6709\u5355\u5b9e\u4f8b\u5ba2\u6237\u7aef\u7684\u517c\u5bb9\u6027\u3002 Codis \u4f7f\u7528 codis proxy \u76f4\u63a5\u548c\u5ba2\u6237\u7aef\u8fde\u63a5\uff0ccodis proxy \u662f\u548c\u5355\u5b9e\u4f8b\u5ba2\u6237\u7aef\u517c\u5bb9\u7684\u3002\u800c\u548c\u96c6\u7fa4\u76f8\u5173\u7684\u7ba1\u7406\u5de5\u4f5c\uff08\u4f8b\u5982\u8bf7\u6c42\u8f6c\u53d1\u3001\u6570\u636e\u8fc1\u79fb\u7b49\uff09\uff0c\u90fd\u7531 codis proxy\u3001codis dashboard \u8fd9\u4e9b\u7ec4\u4ef6\u6765\u5b8c\u6210\uff0c\u4e0d\u9700\u8981\u5ba2\u6237\u7aef\u53c2\u4e0e\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u4e1a\u52a1\u5e94\u7528\u4f7f\u7528 Codis \u96c6\u7fa4\u65f6\uff0c\u5c31\u4e0d\u7528\u4fee\u6539\u5ba2\u6237\u7aef\u4e86\uff0c\u53ef\u4ee5\u590d\u7528\u548c\u5355\u5b9e\u4f8b\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\uff0c\u65e2\u80fd\u5229\u7528\u96c6\u7fa4\u8bfb\u5199\u5927\u5bb9\u91cf\u6570\u636e\uff0c\u53c8\u907f\u514d\u4e86\u4fee\u6539\u5ba2\u6237\u7aef\u589e\u52a0\u590d\u6742\u7684\u64cd\u4f5c\u903b\u8f91\uff0c\u4fdd\u8bc1\u4e86\u4e1a\u52a1\u4ee3\u7801\u7684\u7a33\u5b9a\u6027\u548c\u517c\u5bb9\u6027\u3002 \u6700\u540e\uff0c\u6211\u4eec\u518d\u6765\u770b\u4e0b\u96c6\u7fa4\u53ef\u9760\u6027\u7684\u95ee\u9898\u3002\u53ef\u9760\u6027\u662f\u5b9e\u9645\u4e1a\u52a1\u5e94\u7528\u7684\u4e00\u4e2a\u6838\u5fc3\u8981\u6c42\u3002 \u5bf9\u4e8e\u4e00\u4e2a\u5206\u5e03\u5f0f\u7cfb\u7edf\u6765\u8bf4\uff0c\u5b83\u7684\u53ef\u9760\u6027\u548c\u7cfb\u7edf\u4e2d\u7684\u7ec4\u4ef6\u4e2a\u6570\u6709\u5173\uff1a\u7ec4\u4ef6\u8d8a\u591a\uff0c\u6f5c\u5728\u7684\u98ce\u9669\u70b9\u4e5f\u5c31\u8d8a\u591a\u3002","title":"4\u3001\u96c6\u7fa4\u5ba2\u6237\u7aef\u9700\u8981\u91cd\u65b0\u5f00\u53d1\u5417?"},{"location":"chap7/3redis_codis_cluster/#5","text":"Codis \u4e0d\u540c\u7ec4\u4ef6\u7684\u53ef\u9760\u6027\u4fdd\u8bc1\u65b9\u6cd5\u3002","title":"5\u3001\u600e\u4e48\u4fdd\u8bc1\u96c6\u7fa4\u53ef\u9760\u6027\uff1f"},{"location":"chap7/3redis_codis_cluster/#5-1-codis-server","text":"codis server \u5176\u5b9e\u5c31\u662f Redis \u5b9e\u4f8b\uff0c\u53ea\u4e0d\u8fc7\u589e\u52a0\u4e86\u548c\u96c6\u7fa4\u64cd\u4f5c\u76f8\u5173\u7684\u547d\u4ee4\u3002Redis \u7684\u4e3b\u4ece\u590d\u5236\u673a\u5236\u548c\u54e8\u5175\u673a\u5236\u5728 codis server \u4e0a\u90fd\u662f\u53ef\u4ee5\u4f7f\u7528\u7684\uff0c\u6240\u4ee5\uff0cCodis \u5c31\u4f7f\u7528\u4e3b\u4ece\u96c6\u7fa4\u6765\u4fdd\u8bc1 codis server \u7684\u53ef\u9760\u6027\u3002 \u7b80\u5355\u6765\u8bf4\u5c31\u662f\uff0cCodis \u7ed9\u6bcf\u4e2a server \u914d\u7f6e\u4ece\u5e93\uff0c\u5e76\u4f7f\u7528\u54e8\u5175\u673a\u5236\u8fdb\u884c\u76d1\u63a7\uff0c\u5f53\u53d1\u751f\u6545\u969c\u65f6\uff0c\u4e3b\u4ece\u5e93\u53ef\u4ee5\u8fdb\u884c\u5207\u6362\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86 server \u7684\u53ef\u9760\u6027\u3002 \u5728\u8fd9\u79cd\u914d\u7f6e\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a server \u5c31\u6210\u4e3a\u4e86\u4e00\u4e2a server group\uff0c\u6bcf\u4e2a group \u4e2d\u662f\u4e00\u4e3b\u591a\u4ece\u7684 server\u3002\u6570\u636e\u5206\u5e03\u4f7f\u7528\u7684 Slot\uff0c\u4e5f\u662f\u6309\u7167 group \u7684\u7c92\u5ea6\u8fdb\u884c\u5206\u914d\u7684\u3002 \u540c\u65f6\uff0ccodis proxy \u5728\u8f6c\u53d1\u8bf7\u6c42\u65f6\uff0c\u4e5f\u662f\u6309\u7167\u6570\u636e\u6240\u5728\u7684 Slot \u548c group \u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u628a\u5199\u8bf7\u6c42\u53d1\u5230\u76f8\u5e94 group \u7684\u4e3b\u5e93\uff0c\u8bfb\u8bf7\u6c42\u53d1\u5230 group \u4e2d\u7684\u4e3b\u5e93\u6216\u4ece\u5e93\u4e0a\u3002 \u914d\u7f6e\u4e86 server group \u7684 Codis \u96c6\u7fa4\u67b6\u6784\u3002 \u5728 Codis \u96c6\u7fa4\u4e2d\uff0c\u6211\u4eec\u901a\u8fc7\u90e8\u7f72 server group \u548c\u54e8\u5175\u96c6\u7fa4\uff0c\u5b9e\u73b0 codis server \u7684\u4e3b\u4ece\u5207\u6362\uff0c\u63d0\u5347\u96c6\u7fa4\u53ef\u9760\u6027\u3002 \u56e0\u4e3a codis proxy \u548c Zookeeper \u8fd9\u4e24\u4e2a\u7ec4\u4ef6\u662f\u642d\u914d\u5728\u4e00\u8d77\u4f7f\u7528\u7684\uff0c","title":"5-1 \u9996\u5148\u662f codis server"},{"location":"chap7/3redis_codis_cluster/#5-2-codis-proxy-zookeeper","text":"\u5728 Codis \u96c6\u7fa4\u8bbe\u8ba1\u65f6\uff0cproxy \u4e0a\u7684\u4fe1\u606f\u6e90\u5934\u90fd\u662f\u6765\u81ea Zookeeper\uff08\u4f8b\u5982\u8def\u7531\u8868\uff09\u3002\u800c Zookeeper \u96c6\u7fa4\u4f7f\u7528\u591a\u4e2a\u5b9e\u4f8b\u6765\u4fdd\u5b58\u6570\u636e\uff0c\u53ea\u8981\u6709\u8d85\u8fc7\u534a\u6570\u7684 Zookeeper \u5b9e\u4f8b\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\uff0c Zookeeper \u96c6\u7fa4\u5c31\u53ef\u4ee5\u63d0\u4f9b\u670d\u52a1\uff0c\u4e5f\u53ef\u4ee5\u4fdd\u8bc1\u8fd9\u4e9b\u6570\u636e\u7684\u53ef\u9760\u6027\u3002 \u6240\u4ee5\uff0ccodis proxy \u4f7f\u7528 Zookeeper \u96c6\u7fa4\u4fdd\u5b58\u8def\u7531\u8868\uff0c\u53ef\u4ee5\u5145\u5206\u5229\u7528 Zookeeper \u7684\u9ad8\u53ef\u9760\u6027\u4fdd\u8bc1\u6765\u786e\u4fdd codis proxy \u7684\u53ef\u9760\u6027\uff0c\u4e0d\u7528\u518d\u505a\u989d\u5916\u7684\u5de5\u4f5c\u4e86\u3002\u5f53 codis proxy \u53d1\u751f\u6545\u969c\u540e\uff0c\u76f4\u63a5\u91cd\u542f proxy \u5c31\u884c\u3002 \u91cd\u542f\u540e\u7684 proxy\uff0c\u53ef\u4ee5\u901a\u8fc7 codis dashboard \u4ece Zookeeper \u96c6\u7fa4\u4e0a\u83b7\u53d6\u8def\u7531\u8868\uff0c\u7136\u540e\uff0c\u5c31\u53ef\u4ee5\u63a5\u6536\u5ba2\u6237\u7aef\u8bf7\u6c42\u8fdb\u884c\u8f6c\u53d1\u4e86\u3002\u8fd9\u6837\u7684\u8bbe\u8ba1\uff0c\u4e5f\u964d\u4f4e\u4e86 Codis \u96c6\u7fa4\u672c\u8eab\u7684\u5f00\u53d1\u590d\u6742\u5ea6\u3002 \u5bf9\u4e8e codis dashboard \u548c codis fe \u6765\u8bf4\uff0c\u5b83\u4eec\u4e3b\u8981\u63d0\u4f9b\u914d\u7f6e\u7ba1\u7406\u548c\u7ba1\u7406\u5458\u624b\u5de5\u64cd\u4f5c\uff0c\u8d1f\u8f7d\u538b\u529b\u4e0d\u5927\uff0c\u6240\u4ee5\uff0c\u5b83\u4eec\u7684\u53ef\u9760\u6027\u53ef\u4ee5\u4e0d\u7528\u989d\u5916\u8fdb\u884c\u4fdd\u8bc1\u4e86","title":"5-2 codis proxy \u548c Zookeeper"},{"location":"chap7/3redis_codis_cluster/#6","text":"\u6700\u540e\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u7684\u65f6\u5019\uff0c\u5bf9\u4e8e\u8fd9\u4e24\u79cd\u65b9\u6848\uff0c\u7ed9\u4f60\u63d0 4 \u6761\u5efa\u8bae\u3002 \u4ece\u7a33\u5b9a\u6027\u548c\u6210\u719f\u5ea6\u6765\u770b\uff0cCodis \u5e94\u7528\u5f97\u6bd4\u8f83\u65e9\uff0c\u5728\u4e1a\u754c\u5df2\u7ecf\u6709\u4e86\u6210\u719f\u7684\u751f\u4ea7\u90e8\u7f72\u3002\u867d\u7136 Codis \u5f15\u5165\u4e86 proxy \u548c Zookeeper\uff0c\u589e\u52a0\u4e86\u96c6\u7fa4\u590d\u6742\u5ea6\uff0c\u4f46\u662f\uff0cproxy \u7684\u65e0\u72b6\u6001\u8bbe\u8ba1\u548c Zookeeper \u81ea\u8eab\u7684\u7a33\u5b9a\u6027\uff0c\u4e5f\u7ed9 Codis \u7684\u7a33\u5b9a\u4f7f\u7528\u63d0\u4f9b\u4e86\u4fdd\u8bc1\u3002 \u800c Redis Cluster \u7684\u63a8\u51fa\u65f6\u95f4\u665a\u4e8e Codis\uff0c\u76f8\u5bf9\u6765\u8bf4\uff0c\u6210\u719f\u5ea6\u8981\u5f31\u4e8e Codis\uff0c\u5982\u679c\u4f60\u60f3\u9009\u62e9\u4e00\u4e2a\u6210\u719f\u7a33\u5b9a\u7684\u65b9\u6848\uff0cCodis \u66f4\u52a0\u5408\u9002\u4e9b\u3002 \u4ece\u4e1a\u52a1\u5e94\u7528\u5ba2\u6237\u7aef\u517c\u5bb9\u6027\u6765\u770b\uff0c\u8fde\u63a5\u5355\u5b9e\u4f8b\u7684\u5ba2\u6237\u7aef\u53ef\u4ee5\u76f4\u63a5\u8fde\u63a5 codis proxy\uff0c\u800c\u539f\u672c\u8fde\u63a5\u5355\u5b9e\u4f8b\u7684\u5ba2\u6237\u7aef\u8981\u60f3\u8fde\u63a5 Redis Cluster \u7684\u8bdd\uff0c\u5c31\u9700\u8981\u5f00\u53d1\u65b0\u529f \u80fd\u3002\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u7684\u4e1a\u52a1\u5e94\u7528\u4e2d\u5927\u91cf\u4f7f\u7528\u4e86\u5355\u5b9e\u4f8b\u7684\u5ba2\u6237\u7aef\uff0c\u800c\u73b0\u5728\u60f3\u5e94\u7528\u5207\u7247\u96c6\u7fa4\u7684\u8bdd\uff0c\u5efa\u8bae\u4f60\u9009\u62e9 Codis\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u4fee\u6539\u4e1a\u52a1\u5e94\u7528\u4e2d\u7684\u5ba2\u6237\u7aef \u4ece\u4f7f\u7528 Redis \u65b0\u547d\u4ee4\u548c\u65b0\u7279\u6027\u6765\u770b\uff0cCodis server \u662f\u57fa\u4e8e\u5f00\u6e90\u7684 Redis 3.2.8 \u5f00\u53d1\u7684\uff0c\u6240\u4ee5\uff0cCodis \u5e76\u4e0d\u652f\u6301 Redis \u540e\u7eed\u7684\u5f00\u6e90\u7248\u672c\u4e2d\u7684\u65b0\u589e\u547d\u4ee4\u548c\u6570\u636e\u7c7b\u578b\u3002\u53e6\u5916\uff0cCodis \u5e76\u6ca1\u6709\u5b9e\u73b0\u5f00\u6e90 Redis \u7248\u672c\u7684\u6240\u6709\u547d\u4ee4\uff0c\u6bd4\u5982 BITOP \u3001 BLPOP \u3001 BRPOP \uff0c\u4ee5\u53ca\u548c\u4e0e\u4e8b\u52a1\u76f8\u5173\u7684 MUTLI \u3001 EXEC \u7b49\u547d\u4ee4\u3002 Codis \u5b98\u7f51\u4e0a\u5217\u51fa\u4e86\u4e0d\u88ab\u652f\u6301\u7684\u547d\u4ee4\u5217\u8868 \uff0c\u4f60\u5728\u4f7f\u7528\u65f6\u8bb0\u5f97\u53bb\u6838\u67e5\u4e00\u4e0b\u3002\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u60f3\u4f7f\u7528\u5f00\u6e90 Redis \u7248\u672c\u7684\u65b0\u7279\u6027\uff0cRedis Cluster \u662f\u4e00\u4e2a\u5408\u9002\u7684\u9009\u62e9\u3002 \u4ece\u6570\u636e\u8fc1\u79fb\u6027\u80fd\u7ef4\u5ea6\u6765\u770b\uff0cCodis \u80fd\u652f\u6301\u5f02\u6b65\u8fc1\u79fb\uff0c\u5f02\u6b65\u8fc1\u79fb\u5bf9\u96c6\u7fa4\u5904\u7406\u6b63\u5e38\u8bf7\u6c42\u7684\u6027\u80fd\u5f71\u54cd\u8981\u6bd4\u4f7f\u7528\u540c\u6b65\u8fc1\u79fb\u7684\u5c0f\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u4f60\u5728\u5e94\u7528\u96c6\u7fa4\u65f6\uff0c\u6570\u636e\u8fc1\u79fb\u6bd4\u8f83\u9891\u7e41\u7684\u8bdd\uff0cCodis \u662f\u4e2a\u66f4\u5408\u9002\u7684\u9009\u62e9\u3002","title":"6\u3001\u5207\u7247\u96c6\u7fa4\u65b9\u6848\u9009\u62e9\u5efa\u8bae"},{"location":"chap7/3redis_codis_cluster/#7","text":"Codis \u96c6\u7fa4\u5305\u542b codis server\u3001codis proxy\u3001Zookeeper\u3001codis dashboard \u548c codis fe \u8fd9\u56db\u5927\u7c7b\u7ec4\u4ef6\u3002 codis proxy \u548c codis server \u8d1f\u8d23\u5904\u7406\u6570\u636e\u8bfb\u5199\u8bf7\u6c42\uff0c\u5176\u4e2d\uff0ccodis proxy \u548c\u5ba2\u6237\u7aef\u8fde\u63a5\uff0c\u63a5\u6536\u8bf7\u6c42\uff0c\u5e76\u8f6c\u53d1\u8bf7\u6c42\u7ed9 codis server\uff0c\u800c codis server \u8d1f\u8d23\u5177\u4f53\u5904\u7406\u8bf7\u6c42\u3002 codis dashboard \u548c codis fe \u8d1f\u8d23\u96c6\u7fa4\u7ba1\u7406\uff0c\u5176\u4e2d\uff0ccodis dashboard \u6267\u884c\u7ba1\u7406\u64cd\u4f5c\uff0c\u800c codis fe \u63d0\u4f9b Web \u7ba1\u7406\u754c\u9762\u3002 Zookeeper \u96c6\u7fa4\u8d1f\u8d23\u4fdd\u5b58\u96c6\u7fa4\u7684\u6240\u6709\u5143\u6570\u636e\u4fe1\u606f\uff0c\u5305\u62ec\u8def\u7531\u8868\u3001proxy \u5b9e\u4f8b\u4fe1\u606f\u7b49\u3002\u8fd9\u91cc\uff0c\u6709\u4e2a\u5730\u65b9\u9700\u8981\u4f60\u6ce8\u610f\uff0c\u9664\u4e86\u4f7f\u7528 Zookeeper\uff0cCodis \u8fd8\u53ef\u4ee5\u4f7f\u7528 etcd \u6216\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u4fdd\u5b58\u5143\u6570\u636e\u4fe1\u606f\u3002 \u5173\u4e8e Codis \u548c Redis Cluster \u7684\u9009\u578b\u8003\u8651\uff0c\u4ece\u7a33\u5b9a\u6027\u6210\u719f\u5ea6\u3001\u5ba2\u6237\u7aef\u517c\u5bb9\u6027\u3001Redis \u65b0\u7279\u6027\u4f7f\u7528\u4ee5\u53ca\u6570\u636e\u8fc1\u79fb\u6027\u80fd\u56db\u4e2a\u65b9\u9762\u7ed9\u4f60\u63d0\u4f9b\u4e86\u5efa\u8bae\u3002 \u6211\u518d\u7ed9\u4f60\u63d0\u4f9b\u4e00\u4e2a Codis \u4f7f\u7528\u4e0a\u7684\u5c0f\u5efa\u8bae\uff1a \u5f53\u4f60\u6709\u591a\u6761\u4e1a\u52a1\u7ebf\u8981\u4f7f\u7528 Codis \u65f6\uff0c\u53ef\u4ee5\u542f\u52a8\u591a\u4e2a codis dashboard\uff0c\u6bcf\u4e2a dashboard \u7ba1\u7406\u4e00\u90e8\u5206 codis server\uff0c\u540c\u65f6\uff0c\u518d\u7528\u4e00\u4e2a dashboard \u5bf9\u5e94\u8d1f\u8d23\u4e00\u4e2a\u4e1a\u52a1\u7ebf\u7684\u96c6\u7fa4\u7ba1\u7406\uff0c\u8fd9\u6837\uff0c\u5c31\u53ef\u4ee5\u505a\u5230\u7528\u4e00\u4e2a Codis \u96c6\u7fa4\u5b9e\u73b0\u591a\u6761\u4e1a\u52a1\u7ebf\u7684\u9694\u79bb\u7ba1\u7406\u4e86 \u3002","title":"7\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap7/4redis_spike_sys/","text":"\u7b2c\u56db\u8282 Redis\u652f\u6491\u79d2\u6740\u573a\u666f\u7684\u5173\u952e\u6280\u672f\u548c\u5b9e\u8df5 \u79d2\u6740\u573a\u666f\u7684\u4e1a\u52a1\u7279\u70b9\u662f \u9650\u65f6\u9650\u91cf \uff0c\u4e1a\u52a1\u7cfb\u7edf\u8981\u5904\u7406\u77ac\u65f6\u7684\u5927\u91cf\u9ad8\u5e76\u53d1\u8bf7\u6c42\uff0c\u800c Redis \u5c31\u7ecf\u5e38\u88ab\u7528\u6765\u652f\u6491\u79d2\u6740\u6d3b\u52a8\u3002 \u4e0d\u8fc7\uff0c\u79d2\u6740\u573a\u666f\u5305\u542b\u4e86\u591a\u4e2a\u73af\u8282\uff0c\u53ef\u4ee5\u5206\u6210\u79d2\u6740\u524d\u3001\u79d2\u6740\u4e2d\u548c\u79d2\u6740\u540e\u4e09\u4e2a\u9636\u6bb5\uff0c\u6bcf\u4e2a\u9636\u6bb5\u7684\u8bf7\u6c42\u5904\u7406\u9700\u6c42\u5e76\u4e0d\u76f8\u540c\uff0cRedis \u5e76\u4e0d\u80fd\u652f\u6491\u79d2\u6740\u573a\u666f\u7684\u6bcf\u4e00\u4e2a\u73af\u8282\u3002 1\u3001\u79d2\u6740\u573a\u666f\u7684\u8d1f\u8f7d\u7279\u5f81\u5bf9\u652f\u6491\u7cfb\u7edf\u7684\u8981\u6c42 \u79d2\u6740\u6d3b\u52a8\u552e\u5356\u7684\u5546\u54c1\u901a\u5e38\u4ef7\u683c\u975e\u5e38\u4f18\u60e0\uff0c\u4f1a\u5438\u5f15\u5927\u91cf\u7528\u6237\u8fdb\u884c\u62a2\u8d2d\u3002\u4f46\u662f\uff0c\u5546\u54c1\u5e93\u5b58\u91cf\u5374\u8fdc\u8fdc\u5c0f\u4e8e\u8d2d\u4e70\u8be5\u5546\u54c1\u7684\u7528\u6237\u6570\uff0c\u800c\u4e14\u4f1a\u9650\u5b9a\u7528\u6237\u53ea\u80fd\u5728\u4e00\u5b9a\u7684\u65f6\u95f4\u6bb5\u5185\u8d2d\u4e70 1-1 \u7b2c\u4e00\u4e2a\u7279\u5f81\u662f\u77ac\u65f6\u5e76\u53d1\u8bbf\u95ee\u91cf\u975e\u5e38\u9ad8 \u4e00\u822c\u6570\u636e\u5e93\u6bcf\u79d2\u53ea\u80fd\u652f\u6491\u5343\u7ea7\u522b\u7684\u5e76\u53d1\u8bf7\u6c42\uff0c\u800c Redis \u7684\u5e76\u53d1\u5904\u7406\u80fd\u529b\uff08\u6bcf\u79d2\u5904\u7406\u8bf7\u6c42\u6570\uff09\u80fd\u8fbe\u5230\u4e07\u7ea7\u522b\uff0c\u751a\u81f3\u66f4\u9ad8\u3002 \u5f53\u6709\u5927\u91cf\u5e76\u53d1\u8bf7\u6c42\u6d8c\u5165\u79d2\u6740\u7cfb\u7edf\u65f6\uff0c\u6211\u4eec\u5c31\u9700\u8981\u4f7f\u7528 Redis \u5148\u62e6\u622a\u5927\u90e8\u5206\u8bf7\u6c42\uff0c\u907f\u514d\u5927\u91cf\u8bf7\u6c42\u76f4\u63a5\u53d1\u9001\u7ed9\u6570\u636e\u5e93\uff0c\u628a\u6570\u636e\u5e93\u538b\u57ae\u3002 1-2 \u7b2c\u4e8c\u4e2a\u7279\u5f81\u662f\u8bfb\u591a\u5199\u5c11\uff0c\u800c\u4e14\u8bfb\u64cd\u4f5c\u662f\u7b80\u5355\u7684\u67e5\u8be2\u64cd\u4f5c \u5728\u79d2\u6740\u573a\u666f\u4e0b\uff0c\u7528\u6237\u9700\u8981\u5148\u67e5\u9a8c\u5546\u54c1\u662f\u5426\u8fd8\u6709\u5e93\u5b58\uff08\u4e5f\u5c31\u662f\u6839\u636e\u5546\u54c1 ID \u67e5\u8be2\u8be5\u5546\u54c1\u7684\u5e93\u5b58\u8fd8\u6709\u591a\u5c11\uff09\uff0c\u53ea\u6709\u5e93\u5b58\u6709\u4f59\u91cf\u65f6\uff0c\u79d2\u6740\u7cfb\u7edf\u624d\u80fd\u8fdb\u884c\u5e93\u5b58\u6263\u51cf\u548c\u4e0b\u5355\u64cd\u4f5c\u3002 \u5e93\u5b58\u67e5\u9a8c\u64cd\u4f5c\u662f\u5178\u578b\u7684\u952e\u503c\u5bf9\u67e5\u8be2\uff0c\u800c Redis \u5bf9\u952e\u503c\u5bf9\u67e5\u8be2\u7684\u9ad8\u6548\u652f\u6301\uff0c\u6b63\u597d\u548c\u8fd9\u4e2a\u64cd\u4f5c\u7684\u8981\u6c42\u76f8\u5339\u914d\u3002 \u4e0d\u8fc7\uff0c\u79d2\u6740\u6d3b\u52a8\u4e2d\u53ea\u6709\u5c11\u90e8\u5206\u7528\u6237\u80fd\u6210\u529f\u4e0b\u5355\uff0c\u6240\u4ee5\uff0c\u5546\u54c1\u5e93\u5b58\u67e5\u8be2\u64cd\u4f5c\uff08\u8bfb\u64cd\u4f5c\uff09\u8981\u8fdc\u591a\u4e8e\u5e93\u5b58\u6263\u51cf\u548c\u4e0b\u5355\u64cd\u4f5c\uff08\u5199\u64cd\u4f5c\uff09\u3002 2\u3001Redis \u53ef\u4ee5\u5728\u79d2\u6740\u573a\u666f\u7684\u54ea\u4e9b\u73af\u8282\u53d1\u6325\u4f5c\u7528\uff1f 2-1 \u7b2c\u4e00\u9636\u6bb5\uff1a\u79d2\u6740\u6d3b\u52a8\u524d \u5728\u8fd9\u4e2a\u9636\u6bb5\uff0c\u7528\u6237\u4f1a\u4e0d\u65ad\u5237\u65b0\u5546\u54c1\u8be6\u60c5\u9875\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u8be6\u60c5\u9875\u7684\u77ac\u65f6\u8bf7\u6c42\u91cf\u5267\u589e\u3002 \u8fd9\u4e2a\u9636\u6bb5\u7684\u5e94\u5bf9\u65b9\u6848\uff0c\u4e00\u822c\u662f\u5c3d\u91cf\u628a\u5546\u54c1\u8be6\u60c5\u9875\u7684\u9875\u9762\u5143\u7d20\u9759\u6001\u5316\uff0c \u7136\u540e\u4f7f\u7528 CDN \u6216\u662f\u6d4f\u89c8\u5668\u628a\u8fd9\u4e9b\u9759\u6001\u5316\u7684\u5143\u7d20\u7f13\u5b58\u8d77\u6765\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u79d2\u6740\u524d\u7684\u5927\u91cf\u8bf7\u6c42\u53ef\u4ee5 \u76f4\u63a5\u7531 CDN \u6216\u662f\u6d4f\u89c8\u5668\u7f13\u5b58\u670d\u52a1\uff0c\u4e0d\u4f1a\u5230\u8fbe\u670d\u52a1\u5668\u7aef\u4e86\uff0c\u8fd9\u5c31\u51cf\u8f7b\u4e86\u670d\u52a1\u5668\u7aef\u7684\u538b\u529b \u3002 \u5728\u8fd9\u4e2a\u9636\u6bb5\uff0c\u6709 CDN \u548c\u6d4f\u89c8\u5668\u7f13\u5b58\u670d\u52a1\u8bf7\u6c42\u5c31\u8db3\u591f\u4e86\uff0c\u8fd8\u4e0d\u9700\u8981\u4f7f\u7528 Redis 2-2 \u7b2c\u4e8c\u9636\u6bb5\uff1a\u79d2\u6740\u6d3b\u52a8\u5f00\u59cb \u6b64\u65f6\uff0c\u5927\u91cf\u7528\u6237\u70b9\u51fb\u5546\u54c1\u8be6\u60c5\u9875\u4e0a\u7684\u79d2\u6740\u6309\u94ae\uff0c\u4f1a\u4ea7\u751f\u5927\u91cf\u7684\u5e76\u53d1\u8bf7\u6c42\u67e5\u8be2\u5e93\u5b58\u3002 \u4e00\u65e6\u67d0\u4e2a\u8bf7\u6c42\u67e5\u8be2\u5230\u6709\u5e93\u5b58\uff0c\u7d27\u63a5\u7740\u7cfb\u7edf\u5c31\u4f1a\u8fdb\u884c\u5e93\u5b58\u6263\u51cf\u3002\u7136\u540e\uff0c\u7cfb\u7edf\u4f1a\u751f\u6210\u5b9e\u9645\u8ba2\u5355\uff0c\u5e76\u8fdb\u884c\u540e\u7eed\u5904\u7406\uff0c\u4f8b\u5982\u8ba2\u5355\u652f\u4ed8\u548c\u7269\u6d41\u670d\u52a1\u3002\u5982\u679c\u8bf7\u6c42\u67e5\u4e0d\u5230\u5e93\u5b58\uff0c\u5c31\u4f1a\u8fd4\u56de\u3002\u7528\u6237\u901a\u5e38\u4f1a\u7ee7\u7eed\u70b9\u51fb\u79d2\u6740\u6309\u94ae\uff0c\u7ee7\u7eed\u67e5\u8be2\u5e93\u5b58\u3002 \u8fd9\u4e2a\u9636\u6bb5\u7684\u64cd\u4f5c\u5c31\u662f\u4e09\u4e2a\uff1a\u5e93\u5b58\u67e5\u9a8c\u3001\u5e93\u5b58\u6263\u51cf\u548c\u8ba2\u5355\u5904\u7406 \u3002\u56e0\u4e3a\u6bcf\u4e2a\u79d2\u6740\u8bf7\u6c42\u90fd\u4f1a\u67e5\u8be2\u5e93\u5b58\uff0c\u800c\u8bf7\u6c42\u53ea\u6709\u67e5\u5230\u6709\u5e93\u5b58\u4f59\u91cf\u540e\uff0c\u540e\u7eed\u7684\u5e93\u5b58\u6263\u51cf\u548c\u8ba2\u5355\u5904\u7406\u624d\u4f1a\u88ab\u6267\u884c\u3002 \u6240\u4ee5\uff0c\u8fd9\u4e2a\u9636\u6bb5\u4e2d\u6700\u5927\u7684\u5e76\u53d1\u538b\u529b\u90fd\u5728\u5e93\u5b58\u67e5\u9a8c\u64cd\u4f5c\u4e0a\u3002 \u90a3\u4e48\uff0c\u5e93\u5b58\u6263\u51cf\u548c\u8ba2\u5355\u5904\u7406\u662f\u5426\u90fd\u53ef\u4ee5\u4ea4\u7ed9\u540e\u7aef\u7684\u6570\u636e\u5e93\u6765\u6267\u884c\u5462? \u5176\u5b9e\uff0c\u8ba2\u5355\u5904\u7406\u53ef\u4ee5\u5728\u6570\u636e\u5e93\u4e2d\u6267\u884c\uff0c\u4f46\u5e93\u5b58\u6263\u51cf\u64cd\u4f5c\uff0c\u4e0d\u80fd\u4ea4\u7ed9\u540e\u7aef\u6570\u636e\u5e93\u5904\u7406\u3002 \u5728\u6570\u636e\u5e93\u4e2d\u5904\u7406\u8ba2\u5355\u7684\u539f\u56e0\u6bd4\u8f83\u7b80\u5355 \u8ba2\u5355\u5904\u7406\u4f1a\u6d89\u53ca\u652f\u4ed8\u3001\u5546\u54c1\u51fa\u5e93\u3001\u7269\u6d41\u7b49\u591a\u4e2a\u5173\u8054\u64cd\u4f5c\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u672c\u8eab\u6d89\u53ca\u6570\u636e\u5e93\u4e2d\u7684\u591a\u5f20\u6570\u636e\u8868\uff0c\u8981\u4fdd\u8bc1\u5904\u7406\u7684\u4e8b\u52a1\u6027\uff0c\u9700\u8981\u5728\u6570\u636e\u5e93\u4e2d\u5b8c\u6210\u3002 \u800c\u4e14\uff0c\u8ba2\u5355\u5904\u7406\u65f6\u7684\u8bf7\u6c42\u538b\u529b\u5df2\u7ecf\u4e0d\u5927\u4e86\uff0c\u6570\u636e\u5e93\u53ef\u4ee5\u652f\u6491\u8fd9\u4e9b\u8ba2\u5355\u5904\u7406\u8bf7\u6c42\u3002 \u90a3\u4e3a\u5565\u5e93\u5b58\u6263\u51cf\u64cd\u4f5c\u4e0d\u80fd\u5728\u6570\u636e\u5e93\u6267\u884c\u5462\uff1f\u8fd9\u662f\u56e0\u4e3a\uff0c \u4e00\u65e6\u8bf7\u6c42\u67e5\u5230\u6709\u5e93\u5b58\uff0c\u5c31\u610f\u5473\u7740\u53d1\u9001\u8be5\u8bf7\u6c42\u7684\u7528\u6237\u83b7\u5f97\u4e86\u5546\u54c1\u7684\u8d2d\u4e70\u8d44\u683c\uff0c\u7528\u6237\u5c31\u4f1a\u4e0b\u5355\u4e86 \u3002\u540c\u65f6\uff0c\u5546\u54c1\u7684\u5e93\u5b58\u4f59\u91cf\u4e5f\u9700\u8981\u51cf\u5c11\u4e00\u4e2a\u3002\u5982\u679c\u6211\u4eec\u628a\u5e93\u5b58\u6263\u51cf\u7684\u64cd\u4f5c\u653e\u5230\u6570\u636e\u5e93\u6267\u884c\uff0c\u4f1a\u5e26\u6765\u4e24\u4e2a\u95ee\u9898\u3002 \u989d\u5916\u7684\u5f00\u9500 \u3002Redis \u4e2d\u4fdd\u5b58\u4e86\u5e93\u5b58\u91cf\uff0c\u800c\u5e93\u5b58\u91cf\u7684\u6700\u65b0\u503c\u53c8\u662f\u6570\u636e\u5e93\u5728\u7ef4\u62a4\uff0c \u6240\u4ee5\u6570\u636e\u5e93\u66f4\u65b0\u540e\uff0c\u8fd8\u9700\u8981\u548c Redis \u8fdb\u884c\u540c\u6b65\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u589e\u52a0\u4e86\u989d\u5916\u7684\u64cd\u4f5c\u903b\u8f91\uff0c\u4e5f\u5e26\u6765\u4e86\u989d\u5916\u7684\u5f00\u9500 \u3002 \u4e0b\u5355\u91cf\u8d85\u8fc7\u5b9e\u9645\u5e93\u5b58\u91cf\uff0c\u51fa\u73b0\u8d85\u552e \u3002 \u7531\u4e8e\u6570\u636e\u5e93\u7684\u5904\u7406\u901f\u5ea6\u8f83\u6162\uff0c\u4e0d\u80fd\u53ca\u65f6\u66f4\u65b0\u5e93\u5b58\u4f59\u91cf \uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u5927\u91cf\u5e93\u5b58\u67e5\u9a8c\u7684\u8bf7\u6c42\u8bfb\u53d6\u5230\u65e7\u7684\u5e93\u5b58\u503c\uff0c\u5e76\u8fdb\u884c\u4e0b\u5355\u3002\u6b64\u65f6\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e0b\u5355\u6570\u91cf\u5927\u4e8e\u5b9e\u9645\u7684\u5e93\u5b58\u91cf\uff0c\u5bfc\u81f4\u51fa\u73b0\u8d85\u552e\uff0c\u8fd9\u5c31\u4e0d\u7b26\u5408\u4e1a\u52a1\u5c42\u7684\u8981\u6c42\u4e86\u3002 \u6240\u4ee5\uff0c\u5c31\u9700\u8981\u76f4\u63a5\u5728 Redis \u4e2d\u8fdb\u884c\u5e93\u5b58\u6263\u51cf\u3002 \u5177\u4f53\u7684\u64cd\u4f5c\u662f\uff0c\u5f53\u5e93\u5b58\u67e5\u9a8c\u5b8c\u6210\u540e\uff0c\u4e00\u65e6\u5e93\u5b58\u6709\u4f59\u91cf\uff0c\u6211\u4eec\u5c31\u7acb\u5373\u5728 Redis \u4e2d\u6263\u51cf\u5e93\u5b58\u3002 \u800c\u4e14\uff0c\u4e3a\u4e86\u907f\u514d\u8bf7\u6c42\u67e5\u8be2\u5230\u65e7\u7684\u5e93\u5b58\u503c\uff0c\u5e93\u5b58\u67e5\u9a8c\u548c\u5e93\u5b58\u6263\u51cf\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u9700\u8981\u4fdd\u8bc1\u539f\u5b50\u6027\u3002 2-3 \u7b2c\u4e09\u9636\u6bb5:\u79d2\u6740\u6d3b\u52a8\u7ed3\u675f\u540e \u5728\u8fd9\u4e2a\u9636\u6bb5\uff0c\u53ef\u80fd\u8fd8\u4f1a\u6709\u90e8\u5206\u7528\u6237\u5237\u65b0\u5546\u54c1\u8be6\u60c5\u9875\uff0c\u5c1d\u8bd5\u7b49\u5f85\u6709\u5176\u4ed6\u7528\u6237\u9000\u5355\u3002\u800c\u5df2\u7ecf\u6210\u529f\u4e0b\u5355\u7684\u7528\u6237\u4f1a\u5237\u65b0\u8ba2\u5355\u8be6\u60c5\uff0c\u8ddf\u8e2a\u8ba2\u5355\u7684\u8fdb\u5c55\u3002\u4e0d\u8fc7\uff0c\u8fd9\u4e2a\u9636\u6bb5\u4e2d\u7684\u7528\u6237\u8bf7\u6c42\u91cf\u5df2\u7ecf\u4e0b\u964d\u5f88\u591a\u4e86\uff0c\u670d\u52a1\u5668\u7aef\u4e00\u822c\u90fd\u80fd\u652f\u6491\u3002 2-4 \u79d2\u6740\u573a\u666f\u5bf9 Redis \u7684\u9700\u6c42 \u79d2\u6740\u573a\u666f\u5206\u6210\u79d2\u6740\u524d\u3001\u79d2\u6740\u4e2d\u548c\u79d2\u6740\u540e\u4e09\u4e2a\u9636\u6bb5\u3002 \u79d2\u6740\u5f00\u59cb\u524d\u540e\uff0c\u9ad8\u5e76\u53d1\u538b\u529b\u6ca1\u6709\u90a3\u4e48\u5927\uff0c\u4e0d\u9700\u8981\u4f7f\u7528 Redis\uff0c \u4f46\u5728\u79d2\u6740\u8fdb\u884c\u4e2d\uff0c\u9700\u8981\u67e5\u9a8c\u548c\u6263\u51cf\u5546\u54c1\u5e93\u5b58\uff0c\u5e93\u5b58\u67e5\u9a8c\u9762\u4e34\u5927\u91cf\u7684\u9ad8\u5e76\u53d1\u8bf7\u6c42\uff0c\u800c\u5e93\u5b58\u6263\u51cf\u53c8\u9700\u8981\u548c\u5e93\u5b58\u67e5\u9a8c\u4e00\u8d77\u6267\u884c\uff0c\u4ee5\u4fdd\u8bc1\u539f\u5b50\u6027\u3002\u8fd9\u5c31\u662f\u79d2\u6740\u5bf9 Redis \u7684\u9700\u6c42\u3002 3\u3001Redis \u7684\u54ea\u4e9b\u65b9\u6cd5\u53ef\u4ee5\u652f\u6491\u79d2\u6740\u573a\u666f\uff1f 3-1 \u79d2\u6740\u573a\u666f\u5bf9 Redis \u64cd\u4f5c\u7684\u6839\u672c\u8981\u6c42 \u652f\u6301\u9ad8\u5e76\u53d1 \u3002\u8fd9\u4e2a\u5f88\u7b80\u5355\uff0cRedis \u672c\u8eab\u9ad8\u901f\u5904\u7406\u8bf7\u6c42\u7684\u7279\u6027\u5c31\u53ef\u4ee5\u652f\u6301\u9ad8\u5e76\u53d1\u3002\u800c\u4e14\uff0c\u5982\u679c\u6709\u591a\u4e2a\u79d2\u6740\u5546\u54c1\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5207\u7247\u96c6\u7fa4\uff0c\u7528\u4e0d\u540c\u7684\u5b9e\u4f8b\u4fdd\u5b58\u4e0d\u540c\u5546\u54c1\u7684\u5e93\u5b58\uff0c\u8fd9\u6837\u5c31\u907f\u514d\uff0c\u4f7f\u7528\u5355\u4e2a\u5b9e\u4f8b\u5bfc\u81f4\u6240\u6709\u7684\u79d2\u6740\u8bf7\u6c42\u90fd\u96c6\u4e2d\u5728\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u95ee\u9898\u4e86\u3002\u4e0d\u8fc7\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5f53\u4f7f\u7528\u5207\u7247\u96c6\u7fa4\u65f6\uff0c\u6211\u4eec\u8981\u5148\u7528 CRC \u7b97\u6cd5\u8ba1\u7b97\u4e0d\u540c\u79d2\u6740\u5546\u54c1 key \u5bf9\u5e94\u7684 Slot\uff0c\u7136\u540e\uff0c\u6211\u4eec\u5728\u5206\u914d Slot \u548c\u5b9e\u4f8b\u5bf9\u5e94\u5173\u7cfb\u65f6\uff0c\u624d\u80fd\u628a\u4e0d\u540c\u79d2\u6740\u5546\u54c1\u5bf9\u5e94\u7684 Slot \u5206\u914d\u5230\u4e0d\u540c\u5b9e\u4f8b\u4e0a\u4fdd\u5b58\u3002 \u4fdd\u8bc1\u5e93\u5b58\u67e5\u9a8c\u548c\u5e93\u5b58\u6263\u51cf\u539f\u5b50\u6027\u6267\u884c \u3002\u9488\u5bf9\u8fd9\u6761\u8981\u6c42\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528 Redis \u7684\u539f\u5b50\u64cd\u4f5c\u6216\u662f\u5206\u5e03\u5f0f\u9501\u8fd9\u4e24\u4e2a\u529f\u80fd\u7279\u6027\u6765\u652f\u6491\u4e86\u3002 Redis \u662f\u5982\u4f55\u57fa\u4e8e\u539f\u5b50\u64cd\u4f5c\u6765\u652f\u6491\u79d2\u6740\u573a\u666f\u7684\u3002 3-2 \u57fa\u4e8e\u539f\u5b50\u64cd\u4f5c\u652f\u6491\u79d2\u6740\u573a\u666f \u5728\u79d2\u6740\u573a\u666f\u4e2d\uff0c\u4e00\u4e2a\u5546\u54c1\u7684\u5e93\u5b58\u5bf9\u5e94\u4e86\u4e24\u4e2a\u4fe1\u606f\uff0c \u5206\u522b\u662f\u603b\u5e93\u5b58\u91cf\u548c\u5df2\u79d2\u6740\u91cf \u3002\u8fd9\u79cd\u6570\u636e\u6a21\u578b\u6b63\u597d\u662f\u4e00\u4e2a key\uff08\u5546\u54c1 ID\uff09\u5bf9\u5e94\u4e86\u4e24\u4e2a\u5c5e\u6027\uff08\u603b\u5e93\u5b58\u91cf\u548c\u5df2\u79d2\u6740\u91cf\uff09\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a Hash \u7c7b\u578b\u7684\u952e\u503c\u5bf9\u6765\u4fdd\u5b58\u5e93\u5b58\u7684\u8fd9\u4e24\u4e2a\u4fe1\u606f\uff0c\u5982\u4e0b\u6240\u793a\uff1a key: itemID value: {total: N, ordered: M} \u5176\u4e2d\uff0citemID \u662f\u5546\u54c1\u7684\u7f16\u53f7\uff0ctotal \u662f\u603b\u5e93\u5b58\u91cf\uff0cordered \u662f\u5df2\u79d2\u6740\u91cf\u3002 \u56e0\u4e3a\u5e93\u5b58\u67e5\u9a8c\u548c\u5e93\u5b58\u6263\u51cf\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u8981\u4fdd\u8bc1\u4e00\u8d77\u6267\u884c\uff0c\u4e00\u4e2a\u76f4\u63a5\u7684\u65b9\u6cd5\u5c31\u662f\u4f7f\u7528 Redis \u7684\u539f\u5b50\u64cd\u4f5c\u3002 \u56e0\u4e3a\u5e93\u5b58\u67e5\u9a8c\u548c\u5e93\u5b58\u6263\u51cf\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u8981\u4fdd\u8bc1\u4e00\u8d77\u6267\u884c\uff0c\u4e00\u4e2a\u76f4\u63a5\u7684\u65b9\u6cd5\u5c31\u662f\u4f7f\u7528 Redis \u7684\u539f\u5b50\u64cd\u4f5c\u3002 Redis\u5e94\u5bf9\u5e76\u53d1\u8bbf\u95ee\uff1a\u65e0\u9501\u7684\u539f\u5b50\u64cd\u4f5c \u5b66\u4e60\u8fc7\uff0c \u539f\u5b50\u64cd\u4f5c\u53ef\u4ee5\u662f Redis \u81ea\u8eab\u63d0\u4f9b\u7684\u539f\u5b50\u547d\u4ee4\uff0c\u4e5f\u53ef\u4ee5\u662f Lua \u811a\u672c\u3002\u56e0\u4e3a\u5e93\u5b58\u67e5\u9a8c\u548c\u5e93\u5b58\u6263\u51cf\u662f\u4e24\u4e2a\u64cd\u4f5c\uff0c\u65e0\u6cd5\u7528\u4e00\u6761\u547d\u4ee4\u6765\u5b8c\u6210 \uff0c\u6240\u4ee5\uff0c\u5c31\u9700\u8981\u4f7f\u7528 Lua \u811a\u672c\u539f\u5b50\u6027\u5730\u6267\u884c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u3002 Lua \u811a\u672c\u5199\u7684\u4f2a\u4ee3\u7801\uff0c\u5b83\u663e\u793a\u4e86\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7684\u5b9e\u73b0\u3002 #\u83b7\u53d6\u5546\u54c1\u5e93\u5b58\u4fe1\u606f local counts = redis.call(\"HMGET\", KEYS[1], \"total\", \"ordered\"); #\u5c06\u603b\u5e93\u5b58\u8f6c\u6362\u4e3a\u6570\u503c local total = tonumber(counts[1]) #\u5c06\u5df2\u88ab\u79d2\u6740\u7684\u5e93\u5b58\u8f6c\u6362\u4e3a\u6570\u503c local ordered = tonumber(counts[2]) #\u5982\u679c\u5f53\u524d\u8bf7\u6c42\u7684\u5e93\u5b58\u91cf\u52a0\u4e0a\u5df2\u88ab\u79d2\u6740\u7684\u5e93\u5b58\u91cf\u4ecd\u7136\u5c0f\u4e8e\u603b\u5e93\u5b58\u91cf\uff0c\u5c31\u53ef\u4ee5\u66f4\u65b0\u5e93\u5b58 if ordered + k <= total then #\u66f4\u65b0\u5df2\u79d2\u6740\u7684\u5e93\u5b58\u91cf redis.call(\"HINCRBY\",KEYS[1],\"ordered\",k) return k; end return 0 \u6709\u4e86 Lua \u811a\u672c\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728 Redis \u5ba2\u6237\u7aef\uff0c\u4f7f\u7528 EVAL \u547d\u4ee4\u6765\u6267\u884c\u8fd9\u4e2a\u811a\u672c\u4e86\u3002 \u6700\u540e\uff0c\u5ba2\u6237\u7aef\u4f1a\u6839\u636e\u811a\u672c\u7684\u8fd4\u56de\u503c\uff0c\u6765\u786e\u5b9a\u79d2\u6740\u662f\u6210\u529f\u8fd8\u662f\u5931\u8d25\u4e86\u3002\u5982\u679c\u8fd4\u56de\u503c\u662f k\uff0c\u5c31\u662f\u6210\u529f\u4e86\uff1b\u5982\u679c\u662f 0\uff0c\u5c31\u662f\u5931\u8d25\u3002 \u5176\u5b9e\uff0c\u8981\u60f3\u4fdd\u8bc1\u5e93\u5b58\u67e5\u9a8c\u548c\u6263\u51cf\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7684\u539f\u5b50\u6027\uff0c \u8fd8\u6709\u53e6\u4e00\u79cd\u65b9\u6cd5\uff0c\u5c31\u662f\u4f7f\u7528\u5206\u5e03\u5f0f\u9501\u6765\u4fdd\u8bc1\u591a\u4e2a\u5ba2\u6237\u7aef\u80fd\u4e92\u65a5\u6267\u884c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u3002 3-3 \u57fa\u4e8e\u5206\u5e03\u5f0f\u9501\u6765\u652f\u6491\u79d2\u6740\u573a\u666f \u4f7f\u7528\u5206\u5e03\u5f0f\u9501\u6765\u652f\u6491\u79d2\u6740\u573a\u666f\u7684\u5177\u4f53\u505a\u6cd5\u662f\uff0c\u5148\u8ba9\u5ba2\u6237\u7aef\u5411 Redis \u7533\u8bf7\u5206\u5e03\u5f0f\u9501\uff0c\u53ea\u6709\u62ff\u5230\u9501\u7684\u5ba2\u6237\u7aef\u624d\u80fd\u6267\u884c\u5e93\u5b58\u67e5\u9a8c\u548c\u5e93\u5b58\u6263\u51cf\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5927\u91cf\u7684\u79d2\u6740\u8bf7\u6c42\u5c31\u4f1a\u5728\u4e89\u593a\u5206\u5e03\u5f0f\u9501\u65f6\u88ab\u8fc7\u6ee4\u6389\u3002\u800c\u4e14\uff0c \u5e93\u5b58\u67e5\u9a8c\u548c\u6263\u51cf\u4e5f\u4e0d\u7528\u4f7f\u7528\u539f\u5b50\u64cd\u4f5c\u4e86\uff0c\u56e0\u4e3a\u591a\u4e2a\u5e76\u53d1\u5ba2\u6237\u7aef\u53ea\u6709\u4e00\u4e2a\u5ba2\u6237\u7aef\u80fd\u591f\u62ff\u5230\u9501\uff0c\u5df2\u7ecf\u4fdd\u8bc1\u4e86\u5ba2\u6237\u7aef\u5e76\u53d1\u8bbf\u95ee\u7684\u4e92\u65a5\u6027 \u3002 \u4f2a\u4ee3\u7801\uff0c\u5b83\u663e\u793a\u4e86\u4f7f\u7528\u5206\u5e03\u5f0f\u9501\u6765\u6267\u884c\u5e93\u5b58\u67e5\u9a8c\u548c\u6263\u51cf\u7684\u8fc7\u7a0b //\u4f7f\u7528\u5546\u54c1ID\u4f5c\u4e3akey key = itemID //\u4f7f\u7528\u5ba2\u6237\u7aef\u552f\u4e00\u6807\u8bc6\u4f5c\u4e3avalue val = clientUniqueID //\u7533\u8bf7\u5206\u5e03\u5f0f\u9501\uff0cTimeout\u662f\u8d85\u65f6\u65f6\u95f4 lock =acquireLock(key, val, Timeout) //\u5f53\u62ff\u5230\u9501\u540e\uff0c\u624d\u80fd\u8fdb\u884c\u5e93\u5b58\u67e5\u9a8c\u548c\u6263\u51cf if(lock == True) { //\u5e93\u5b58\u67e5\u9a8c\u548c\u6263\u51cf availStock = DECR(key, k) //\u5e93\u5b58\u5df2\u7ecf\u6263\u51cf\u5b8c\u4e86\uff0c\u91ca\u653e\u9501\uff0c\u8fd4\u56de\u79d2\u6740\u5931\u8d25 if (availStock < 0) { releaseLock(key, val) return error } //\u5e93\u5b58\u6263\u51cf\u6210\u529f\uff0c\u91ca\u653e\u9501 else{ releaseLock(key, val) //\u8ba2\u5355\u5904\u7406 } } //\u6ca1\u6709\u62ff\u5230\u9501\uff0c\u76f4\u63a5\u8fd4\u56de else return \u5728\u4f7f\u7528\u5206\u5e03\u5f0f\u9501\u65f6\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u5148\u5411 Redis \u8bf7\u6c42\u9501\uff0c\u53ea\u6709\u8bf7\u6c42\u5230\u4e86\u9501\uff0c\u624d\u80fd\u8fdb\u884c\u5e93\u5b58\u67e5\u9a8c\u7b49\u64cd\u4f5c\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5ba2\u6237\u7aef\u5728\u4e89\u62a2\u5206\u5e03\u5f0f\u9501\u65f6\uff0c\u5927\u90e8\u5206\u79d2\u6740\u8bf7\u6c42\u672c\u8eab\u5c31\u4f1a\u56e0\u4e3a\u62a2\u4e0d\u5230\u9501\u800c\u88ab\u62e6\u622a\u3002 \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5207\u7247\u96c6\u7fa4\u4e2d\u7684\u4e0d\u540c\u5b9e\u4f8b\u6765\u5206\u522b\u4fdd\u5b58\u5206\u5e03\u5f0f\u9501\u548c\u5546\u54c1\u5e93\u5b58\u4fe1\u606f \u3002 \u4f7f\u7528\u8fd9\u79cd\u4fdd\u5b58\u65b9\u5f0f\u540e\uff0c\u79d2\u6740\u8bf7\u6c42\u4f1a\u9996\u5148\u8bbf\u95ee\u4fdd\u5b58\u5206\u5e03\u5f0f\u9501\u7684\u5b9e\u4f8b\u3002\u5982\u679c\u5ba2\u6237\u7aef\u6ca1\u6709\u62ff\u5230\u9501\uff0c\u8fd9\u4e9b\u5ba2\u6237\u7aef\u5c31\u4e0d\u4f1a\u67e5\u8be2\u5546\u54c1\u5e93\u5b58\uff0c\u8fd9\u5c31\u53ef\u4ee5\u51cf\u8f7b\u4fdd\u5b58\u5e93\u5b58\u4fe1\u606f\u7684\u5b9e\u4f8b\u7684\u538b\u529b\u4e86\u3002 4\u3001\u672c\u8282\u5c0f\u7ed3 \u79d2\u6740\u573a\u666f\u6709 2 \u4e2a\u8d1f\u8f7d\u7279\u5f81\uff0c\u5206\u522b\u662f\u77ac\u65f6 \u9ad8\u5e76\u53d1\u8bf7\u6c42\u548c\u8bfb\u591a\u5199\u5c11 \u3002Redis \u826f\u597d\u7684\u9ad8\u5e76\u53d1\u5904\u7406\u80fd\u529b\uff0c\u4ee5\u53ca\u9ad8\u6548\u7684\u952e\u503c\u5bf9\u8bfb\u5199\u7279\u6027\uff0c\u6b63\u597d\u53ef\u4ee5\u6ee1\u8db3\u79d2\u6740\u573a\u666f\u7684\u9700\u6c42\u3002 \u5728\u79d2\u6740\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u524d\u7aef CDN \u548c\u6d4f\u89c8\u5668\u7f13\u5b58\u62e6\u622a\u5927\u91cf\u79d2\u6740\u524d\u7684\u8bf7\u6c42\u3002\u5728\u5b9e\u9645\u79d2\u6740\u6d3b\u52a8\u8fdb\u884c\u65f6\uff0c\u5e93\u5b58\u67e5\u9a8c\u548c\u5e93\u5b58\u6263\u51cf\u662f\u627f\u53d7\u5de8\u5927\u5e76\u53d1\u8bf7\u6c42\u538b\u529b\u7684\u4e24\u4e2a\u64cd\u4f5c\uff0c\u540c\u65f6\uff0c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7684\u6267\u884c\u9700\u8981\u4fdd\u8bc1\u539f\u5b50\u6027\u3002Redis \u7684\u539f\u5b50\u64cd\u4f5c\u3001\u5206\u5e03\u5f0f\u9501\u8fd9\u4e24\u4e2a\u529f\u80fd\u7279\u6027\u53ef\u4ee5\u6709\u6548\u5730\u6765\u652f\u6491\u79d2\u6740\u573a\u666f\u7684\u9700\u6c42\u3002 \u5f53\u7136\uff0c\u5bf9\u4e8e\u79d2\u6740\u573a\u666f\u6765\u8bf4\uff0c\u53ea\u7528 Redis \u662f\u4e0d\u591f\u7684\u3002\u79d2\u6740\u7cfb\u7edf\u662f\u4e00\u4e2a\u7cfb\u7edf\u6027\u5de5\u7a0b\uff0cRedis \u5b9e\u73b0\u4e86\u5bf9\u5e93\u5b58\u67e5\u9a8c\u548c\u6263\u51cf\u8fd9\u4e2a\u73af\u8282\u7684\u652f\u6491\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u6709 4 \u4e2a\u73af\u8282\u9700\u8981\u6211\u4eec\u5904\u7406\u597d\u3002 \u524d\u7aef\u9759\u6001\u9875\u9762\u7684\u8bbe\u8ba1 \u3002\u79d2\u6740\u9875\u9762\u4e0a\u80fd\u9759\u6001\u5316\u5904\u7406\u7684\u9875\u9762\u5143\u7d20\uff0c\u6211\u4eec\u90fd\u8981\u5c3d\u91cf\u9759\u6001\u5316\uff0c\u8fd9\u6837\u53ef\u4ee5\u5145\u5206\u5229\u7528 CDN \u6216\u6d4f\u89c8\u5668\u7f13\u5b58\u670d\u52a1\u79d2\u6740\u5f00\u59cb\u524d\u7684\u8bf7\u6c42\u3002 \u8bf7\u6c42\u62e6\u622a\u548c\u6d41\u63a7 \u3002\u5728\u79d2\u6740\u7cfb\u7edf\u7684\u63a5\u5165\u5c42\uff0c\u5bf9\u6076\u610f\u8bf7\u6c42\u8fdb\u884c\u62e6\u622a\uff0c\u907f\u514d\u5bf9\u7cfb\u7edf\u7684\u6076\u610f\u653b\u51fb\uff0c\u4f8b\u5982\u4f7f\u7528\u9ed1\u540d\u5355\u7981\u6b62\u6076\u610f IP \u8fdb\u884c\u8bbf\u95ee\u3002\u5982\u679c Redis \u5b9e\u4f8b\u7684\u8bbf\u95ee\u538b\u529b\u8fc7\u5927\uff0c\u4e3a\u4e86\u907f\u514d\u5b9e\u4f8b\u5d29\u6e83\uff0c\u6211\u4eec\u4e5f\u9700\u8981\u5728\u63a5\u5165\u5c42\u8fdb\u884c\u9650\u6d41\uff0c\u63a7\u5236\u8fdb\u5165\u79d2\u6740\u7cfb\u7edf\u7684\u8bf7\u6c42\u6570\u91cf\u3002 \u5e93\u5b58\u4fe1\u606f\u8fc7\u671f\u65f6\u95f4\u5904\u7406 \u3002Redis \u4e2d\u4fdd\u5b58\u7684\u5e93\u5b58\u4fe1\u606f\u5176\u5b9e\u662f\u6570\u636e\u5e93\u7684\u7f13\u5b58\uff0c\u4e3a\u4e86\u907f\u514d\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898\uff0c\u6211\u4eec\u4e0d\u8981\u7ed9\u5e93\u5b58\u4fe1\u606f\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002 \u6570\u636e\u5e93\u8ba2\u5355\u5f02\u5e38\u5904\u7406 \u3002\u5982\u679c\u6570\u636e\u5e93\u6ca1\u80fd\u6210\u529f\u5904\u7406\u8ba2\u5355\uff0c\u53ef\u4ee5\u589e\u52a0\u8ba2\u5355\u91cd\u8bd5\u529f\u80fd\uff0c\u4fdd\u8bc1\u8ba2\u5355\u6700\u7ec8\u80fd\u88ab\u6210\u529f\u5904\u7406\u3002 \u5efa\u8bae\uff1a \u79d2\u6740\u6d3b\u52a8\u5e26\u6765\u7684\u8bf7\u6c42\u6d41\u91cf\u5de8\u5927\uff0c\u6211\u4eec\u9700\u8981\u628a\u79d2\u6740\u5546\u54c1\u7684\u5e93\u5b58\u4fe1\u606f\u7528\u5355\u72ec\u7684\u5b9e\u4f8b\u4fdd\u5b58\uff0c\u800c\u4e0d\u8981\u548c\u65e5\u5e38\u4e1a\u52a1\u7cfb\u7edf\u7684\u6570\u636e\u4fdd\u5b58\u5728\u540c\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u5e72\u6270\u4e1a\u52a1\u7cfb\u7edf\u7684\u6b63\u5e38\u8fd0\u884c\u3002","title":"\u7b2c\u56db\u8282 Redis\u652f\u6491\u79d2\u6740\u573a\u666f\u7684\u5173\u952e\u6280\u672f\u548c\u5b9e\u8df5"},{"location":"chap7/4redis_spike_sys/#redis","text":"\u79d2\u6740\u573a\u666f\u7684\u4e1a\u52a1\u7279\u70b9\u662f \u9650\u65f6\u9650\u91cf \uff0c\u4e1a\u52a1\u7cfb\u7edf\u8981\u5904\u7406\u77ac\u65f6\u7684\u5927\u91cf\u9ad8\u5e76\u53d1\u8bf7\u6c42\uff0c\u800c Redis \u5c31\u7ecf\u5e38\u88ab\u7528\u6765\u652f\u6491\u79d2\u6740\u6d3b\u52a8\u3002 \u4e0d\u8fc7\uff0c\u79d2\u6740\u573a\u666f\u5305\u542b\u4e86\u591a\u4e2a\u73af\u8282\uff0c\u53ef\u4ee5\u5206\u6210\u79d2\u6740\u524d\u3001\u79d2\u6740\u4e2d\u548c\u79d2\u6740\u540e\u4e09\u4e2a\u9636\u6bb5\uff0c\u6bcf\u4e2a\u9636\u6bb5\u7684\u8bf7\u6c42\u5904\u7406\u9700\u6c42\u5e76\u4e0d\u76f8\u540c\uff0cRedis \u5e76\u4e0d\u80fd\u652f\u6491\u79d2\u6740\u573a\u666f\u7684\u6bcf\u4e00\u4e2a\u73af\u8282\u3002","title":"\u7b2c\u56db\u8282 Redis\u652f\u6491\u79d2\u6740\u573a\u666f\u7684\u5173\u952e\u6280\u672f\u548c\u5b9e\u8df5"},{"location":"chap7/4redis_spike_sys/#1","text":"\u79d2\u6740\u6d3b\u52a8\u552e\u5356\u7684\u5546\u54c1\u901a\u5e38\u4ef7\u683c\u975e\u5e38\u4f18\u60e0\uff0c\u4f1a\u5438\u5f15\u5927\u91cf\u7528\u6237\u8fdb\u884c\u62a2\u8d2d\u3002\u4f46\u662f\uff0c\u5546\u54c1\u5e93\u5b58\u91cf\u5374\u8fdc\u8fdc\u5c0f\u4e8e\u8d2d\u4e70\u8be5\u5546\u54c1\u7684\u7528\u6237\u6570\uff0c\u800c\u4e14\u4f1a\u9650\u5b9a\u7528\u6237\u53ea\u80fd\u5728\u4e00\u5b9a\u7684\u65f6\u95f4\u6bb5\u5185\u8d2d\u4e70","title":"1\u3001\u79d2\u6740\u573a\u666f\u7684\u8d1f\u8f7d\u7279\u5f81\u5bf9\u652f\u6491\u7cfb\u7edf\u7684\u8981\u6c42"},{"location":"chap7/4redis_spike_sys/#1-1","text":"\u4e00\u822c\u6570\u636e\u5e93\u6bcf\u79d2\u53ea\u80fd\u652f\u6491\u5343\u7ea7\u522b\u7684\u5e76\u53d1\u8bf7\u6c42\uff0c\u800c Redis \u7684\u5e76\u53d1\u5904\u7406\u80fd\u529b\uff08\u6bcf\u79d2\u5904\u7406\u8bf7\u6c42\u6570\uff09\u80fd\u8fbe\u5230\u4e07\u7ea7\u522b\uff0c\u751a\u81f3\u66f4\u9ad8\u3002 \u5f53\u6709\u5927\u91cf\u5e76\u53d1\u8bf7\u6c42\u6d8c\u5165\u79d2\u6740\u7cfb\u7edf\u65f6\uff0c\u6211\u4eec\u5c31\u9700\u8981\u4f7f\u7528 Redis \u5148\u62e6\u622a\u5927\u90e8\u5206\u8bf7\u6c42\uff0c\u907f\u514d\u5927\u91cf\u8bf7\u6c42\u76f4\u63a5\u53d1\u9001\u7ed9\u6570\u636e\u5e93\uff0c\u628a\u6570\u636e\u5e93\u538b\u57ae\u3002","title":"1-1 \u7b2c\u4e00\u4e2a\u7279\u5f81\u662f\u77ac\u65f6\u5e76\u53d1\u8bbf\u95ee\u91cf\u975e\u5e38\u9ad8"},{"location":"chap7/4redis_spike_sys/#1-2","text":"\u5728\u79d2\u6740\u573a\u666f\u4e0b\uff0c\u7528\u6237\u9700\u8981\u5148\u67e5\u9a8c\u5546\u54c1\u662f\u5426\u8fd8\u6709\u5e93\u5b58\uff08\u4e5f\u5c31\u662f\u6839\u636e\u5546\u54c1 ID \u67e5\u8be2\u8be5\u5546\u54c1\u7684\u5e93\u5b58\u8fd8\u6709\u591a\u5c11\uff09\uff0c\u53ea\u6709\u5e93\u5b58\u6709\u4f59\u91cf\u65f6\uff0c\u79d2\u6740\u7cfb\u7edf\u624d\u80fd\u8fdb\u884c\u5e93\u5b58\u6263\u51cf\u548c\u4e0b\u5355\u64cd\u4f5c\u3002 \u5e93\u5b58\u67e5\u9a8c\u64cd\u4f5c\u662f\u5178\u578b\u7684\u952e\u503c\u5bf9\u67e5\u8be2\uff0c\u800c Redis \u5bf9\u952e\u503c\u5bf9\u67e5\u8be2\u7684\u9ad8\u6548\u652f\u6301\uff0c\u6b63\u597d\u548c\u8fd9\u4e2a\u64cd\u4f5c\u7684\u8981\u6c42\u76f8\u5339\u914d\u3002 \u4e0d\u8fc7\uff0c\u79d2\u6740\u6d3b\u52a8\u4e2d\u53ea\u6709\u5c11\u90e8\u5206\u7528\u6237\u80fd\u6210\u529f\u4e0b\u5355\uff0c\u6240\u4ee5\uff0c\u5546\u54c1\u5e93\u5b58\u67e5\u8be2\u64cd\u4f5c\uff08\u8bfb\u64cd\u4f5c\uff09\u8981\u8fdc\u591a\u4e8e\u5e93\u5b58\u6263\u51cf\u548c\u4e0b\u5355\u64cd\u4f5c\uff08\u5199\u64cd\u4f5c\uff09\u3002","title":"1-2 \u7b2c\u4e8c\u4e2a\u7279\u5f81\u662f\u8bfb\u591a\u5199\u5c11\uff0c\u800c\u4e14\u8bfb\u64cd\u4f5c\u662f\u7b80\u5355\u7684\u67e5\u8be2\u64cd\u4f5c"},{"location":"chap7/4redis_spike_sys/#2redis","text":"","title":"2\u3001Redis \u53ef\u4ee5\u5728\u79d2\u6740\u573a\u666f\u7684\u54ea\u4e9b\u73af\u8282\u53d1\u6325\u4f5c\u7528\uff1f"},{"location":"chap7/4redis_spike_sys/#2-1","text":"\u5728\u8fd9\u4e2a\u9636\u6bb5\uff0c\u7528\u6237\u4f1a\u4e0d\u65ad\u5237\u65b0\u5546\u54c1\u8be6\u60c5\u9875\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u8be6\u60c5\u9875\u7684\u77ac\u65f6\u8bf7\u6c42\u91cf\u5267\u589e\u3002 \u8fd9\u4e2a\u9636\u6bb5\u7684\u5e94\u5bf9\u65b9\u6848\uff0c\u4e00\u822c\u662f\u5c3d\u91cf\u628a\u5546\u54c1\u8be6\u60c5\u9875\u7684\u9875\u9762\u5143\u7d20\u9759\u6001\u5316\uff0c \u7136\u540e\u4f7f\u7528 CDN \u6216\u662f\u6d4f\u89c8\u5668\u628a\u8fd9\u4e9b\u9759\u6001\u5316\u7684\u5143\u7d20\u7f13\u5b58\u8d77\u6765\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u79d2\u6740\u524d\u7684\u5927\u91cf\u8bf7\u6c42\u53ef\u4ee5 \u76f4\u63a5\u7531 CDN \u6216\u662f\u6d4f\u89c8\u5668\u7f13\u5b58\u670d\u52a1\uff0c\u4e0d\u4f1a\u5230\u8fbe\u670d\u52a1\u5668\u7aef\u4e86\uff0c\u8fd9\u5c31\u51cf\u8f7b\u4e86\u670d\u52a1\u5668\u7aef\u7684\u538b\u529b \u3002 \u5728\u8fd9\u4e2a\u9636\u6bb5\uff0c\u6709 CDN \u548c\u6d4f\u89c8\u5668\u7f13\u5b58\u670d\u52a1\u8bf7\u6c42\u5c31\u8db3\u591f\u4e86\uff0c\u8fd8\u4e0d\u9700\u8981\u4f7f\u7528 Redis","title":"2-1 \u7b2c\u4e00\u9636\u6bb5\uff1a\u79d2\u6740\u6d3b\u52a8\u524d"},{"location":"chap7/4redis_spike_sys/#2-2","text":"\u6b64\u65f6\uff0c\u5927\u91cf\u7528\u6237\u70b9\u51fb\u5546\u54c1\u8be6\u60c5\u9875\u4e0a\u7684\u79d2\u6740\u6309\u94ae\uff0c\u4f1a\u4ea7\u751f\u5927\u91cf\u7684\u5e76\u53d1\u8bf7\u6c42\u67e5\u8be2\u5e93\u5b58\u3002 \u4e00\u65e6\u67d0\u4e2a\u8bf7\u6c42\u67e5\u8be2\u5230\u6709\u5e93\u5b58\uff0c\u7d27\u63a5\u7740\u7cfb\u7edf\u5c31\u4f1a\u8fdb\u884c\u5e93\u5b58\u6263\u51cf\u3002\u7136\u540e\uff0c\u7cfb\u7edf\u4f1a\u751f\u6210\u5b9e\u9645\u8ba2\u5355\uff0c\u5e76\u8fdb\u884c\u540e\u7eed\u5904\u7406\uff0c\u4f8b\u5982\u8ba2\u5355\u652f\u4ed8\u548c\u7269\u6d41\u670d\u52a1\u3002\u5982\u679c\u8bf7\u6c42\u67e5\u4e0d\u5230\u5e93\u5b58\uff0c\u5c31\u4f1a\u8fd4\u56de\u3002\u7528\u6237\u901a\u5e38\u4f1a\u7ee7\u7eed\u70b9\u51fb\u79d2\u6740\u6309\u94ae\uff0c\u7ee7\u7eed\u67e5\u8be2\u5e93\u5b58\u3002 \u8fd9\u4e2a\u9636\u6bb5\u7684\u64cd\u4f5c\u5c31\u662f\u4e09\u4e2a\uff1a\u5e93\u5b58\u67e5\u9a8c\u3001\u5e93\u5b58\u6263\u51cf\u548c\u8ba2\u5355\u5904\u7406 \u3002\u56e0\u4e3a\u6bcf\u4e2a\u79d2\u6740\u8bf7\u6c42\u90fd\u4f1a\u67e5\u8be2\u5e93\u5b58\uff0c\u800c\u8bf7\u6c42\u53ea\u6709\u67e5\u5230\u6709\u5e93\u5b58\u4f59\u91cf\u540e\uff0c\u540e\u7eed\u7684\u5e93\u5b58\u6263\u51cf\u548c\u8ba2\u5355\u5904\u7406\u624d\u4f1a\u88ab\u6267\u884c\u3002 \u6240\u4ee5\uff0c\u8fd9\u4e2a\u9636\u6bb5\u4e2d\u6700\u5927\u7684\u5e76\u53d1\u538b\u529b\u90fd\u5728\u5e93\u5b58\u67e5\u9a8c\u64cd\u4f5c\u4e0a\u3002 \u90a3\u4e48\uff0c\u5e93\u5b58\u6263\u51cf\u548c\u8ba2\u5355\u5904\u7406\u662f\u5426\u90fd\u53ef\u4ee5\u4ea4\u7ed9\u540e\u7aef\u7684\u6570\u636e\u5e93\u6765\u6267\u884c\u5462? \u5176\u5b9e\uff0c\u8ba2\u5355\u5904\u7406\u53ef\u4ee5\u5728\u6570\u636e\u5e93\u4e2d\u6267\u884c\uff0c\u4f46\u5e93\u5b58\u6263\u51cf\u64cd\u4f5c\uff0c\u4e0d\u80fd\u4ea4\u7ed9\u540e\u7aef\u6570\u636e\u5e93\u5904\u7406\u3002 \u5728\u6570\u636e\u5e93\u4e2d\u5904\u7406\u8ba2\u5355\u7684\u539f\u56e0\u6bd4\u8f83\u7b80\u5355 \u8ba2\u5355\u5904\u7406\u4f1a\u6d89\u53ca\u652f\u4ed8\u3001\u5546\u54c1\u51fa\u5e93\u3001\u7269\u6d41\u7b49\u591a\u4e2a\u5173\u8054\u64cd\u4f5c\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u672c\u8eab\u6d89\u53ca\u6570\u636e\u5e93\u4e2d\u7684\u591a\u5f20\u6570\u636e\u8868\uff0c\u8981\u4fdd\u8bc1\u5904\u7406\u7684\u4e8b\u52a1\u6027\uff0c\u9700\u8981\u5728\u6570\u636e\u5e93\u4e2d\u5b8c\u6210\u3002 \u800c\u4e14\uff0c\u8ba2\u5355\u5904\u7406\u65f6\u7684\u8bf7\u6c42\u538b\u529b\u5df2\u7ecf\u4e0d\u5927\u4e86\uff0c\u6570\u636e\u5e93\u53ef\u4ee5\u652f\u6491\u8fd9\u4e9b\u8ba2\u5355\u5904\u7406\u8bf7\u6c42\u3002 \u90a3\u4e3a\u5565\u5e93\u5b58\u6263\u51cf\u64cd\u4f5c\u4e0d\u80fd\u5728\u6570\u636e\u5e93\u6267\u884c\u5462\uff1f\u8fd9\u662f\u56e0\u4e3a\uff0c \u4e00\u65e6\u8bf7\u6c42\u67e5\u5230\u6709\u5e93\u5b58\uff0c\u5c31\u610f\u5473\u7740\u53d1\u9001\u8be5\u8bf7\u6c42\u7684\u7528\u6237\u83b7\u5f97\u4e86\u5546\u54c1\u7684\u8d2d\u4e70\u8d44\u683c\uff0c\u7528\u6237\u5c31\u4f1a\u4e0b\u5355\u4e86 \u3002\u540c\u65f6\uff0c\u5546\u54c1\u7684\u5e93\u5b58\u4f59\u91cf\u4e5f\u9700\u8981\u51cf\u5c11\u4e00\u4e2a\u3002\u5982\u679c\u6211\u4eec\u628a\u5e93\u5b58\u6263\u51cf\u7684\u64cd\u4f5c\u653e\u5230\u6570\u636e\u5e93\u6267\u884c\uff0c\u4f1a\u5e26\u6765\u4e24\u4e2a\u95ee\u9898\u3002 \u989d\u5916\u7684\u5f00\u9500 \u3002Redis \u4e2d\u4fdd\u5b58\u4e86\u5e93\u5b58\u91cf\uff0c\u800c\u5e93\u5b58\u91cf\u7684\u6700\u65b0\u503c\u53c8\u662f\u6570\u636e\u5e93\u5728\u7ef4\u62a4\uff0c \u6240\u4ee5\u6570\u636e\u5e93\u66f4\u65b0\u540e\uff0c\u8fd8\u9700\u8981\u548c Redis \u8fdb\u884c\u540c\u6b65\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u589e\u52a0\u4e86\u989d\u5916\u7684\u64cd\u4f5c\u903b\u8f91\uff0c\u4e5f\u5e26\u6765\u4e86\u989d\u5916\u7684\u5f00\u9500 \u3002 \u4e0b\u5355\u91cf\u8d85\u8fc7\u5b9e\u9645\u5e93\u5b58\u91cf\uff0c\u51fa\u73b0\u8d85\u552e \u3002 \u7531\u4e8e\u6570\u636e\u5e93\u7684\u5904\u7406\u901f\u5ea6\u8f83\u6162\uff0c\u4e0d\u80fd\u53ca\u65f6\u66f4\u65b0\u5e93\u5b58\u4f59\u91cf \uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u5927\u91cf\u5e93\u5b58\u67e5\u9a8c\u7684\u8bf7\u6c42\u8bfb\u53d6\u5230\u65e7\u7684\u5e93\u5b58\u503c\uff0c\u5e76\u8fdb\u884c\u4e0b\u5355\u3002\u6b64\u65f6\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e0b\u5355\u6570\u91cf\u5927\u4e8e\u5b9e\u9645\u7684\u5e93\u5b58\u91cf\uff0c\u5bfc\u81f4\u51fa\u73b0\u8d85\u552e\uff0c\u8fd9\u5c31\u4e0d\u7b26\u5408\u4e1a\u52a1\u5c42\u7684\u8981\u6c42\u4e86\u3002 \u6240\u4ee5\uff0c\u5c31\u9700\u8981\u76f4\u63a5\u5728 Redis \u4e2d\u8fdb\u884c\u5e93\u5b58\u6263\u51cf\u3002 \u5177\u4f53\u7684\u64cd\u4f5c\u662f\uff0c\u5f53\u5e93\u5b58\u67e5\u9a8c\u5b8c\u6210\u540e\uff0c\u4e00\u65e6\u5e93\u5b58\u6709\u4f59\u91cf\uff0c\u6211\u4eec\u5c31\u7acb\u5373\u5728 Redis \u4e2d\u6263\u51cf\u5e93\u5b58\u3002 \u800c\u4e14\uff0c\u4e3a\u4e86\u907f\u514d\u8bf7\u6c42\u67e5\u8be2\u5230\u65e7\u7684\u5e93\u5b58\u503c\uff0c\u5e93\u5b58\u67e5\u9a8c\u548c\u5e93\u5b58\u6263\u51cf\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u9700\u8981\u4fdd\u8bc1\u539f\u5b50\u6027\u3002","title":"2-2 \u7b2c\u4e8c\u9636\u6bb5\uff1a\u79d2\u6740\u6d3b\u52a8\u5f00\u59cb"},{"location":"chap7/4redis_spike_sys/#2-3","text":"\u5728\u8fd9\u4e2a\u9636\u6bb5\uff0c\u53ef\u80fd\u8fd8\u4f1a\u6709\u90e8\u5206\u7528\u6237\u5237\u65b0\u5546\u54c1\u8be6\u60c5\u9875\uff0c\u5c1d\u8bd5\u7b49\u5f85\u6709\u5176\u4ed6\u7528\u6237\u9000\u5355\u3002\u800c\u5df2\u7ecf\u6210\u529f\u4e0b\u5355\u7684\u7528\u6237\u4f1a\u5237\u65b0\u8ba2\u5355\u8be6\u60c5\uff0c\u8ddf\u8e2a\u8ba2\u5355\u7684\u8fdb\u5c55\u3002\u4e0d\u8fc7\uff0c\u8fd9\u4e2a\u9636\u6bb5\u4e2d\u7684\u7528\u6237\u8bf7\u6c42\u91cf\u5df2\u7ecf\u4e0b\u964d\u5f88\u591a\u4e86\uff0c\u670d\u52a1\u5668\u7aef\u4e00\u822c\u90fd\u80fd\u652f\u6491\u3002","title":"2-3 \u7b2c\u4e09\u9636\u6bb5:\u79d2\u6740\u6d3b\u52a8\u7ed3\u675f\u540e"},{"location":"chap7/4redis_spike_sys/#2-4-redis","text":"\u79d2\u6740\u573a\u666f\u5206\u6210\u79d2\u6740\u524d\u3001\u79d2\u6740\u4e2d\u548c\u79d2\u6740\u540e\u4e09\u4e2a\u9636\u6bb5\u3002 \u79d2\u6740\u5f00\u59cb\u524d\u540e\uff0c\u9ad8\u5e76\u53d1\u538b\u529b\u6ca1\u6709\u90a3\u4e48\u5927\uff0c\u4e0d\u9700\u8981\u4f7f\u7528 Redis\uff0c \u4f46\u5728\u79d2\u6740\u8fdb\u884c\u4e2d\uff0c\u9700\u8981\u67e5\u9a8c\u548c\u6263\u51cf\u5546\u54c1\u5e93\u5b58\uff0c\u5e93\u5b58\u67e5\u9a8c\u9762\u4e34\u5927\u91cf\u7684\u9ad8\u5e76\u53d1\u8bf7\u6c42\uff0c\u800c\u5e93\u5b58\u6263\u51cf\u53c8\u9700\u8981\u548c\u5e93\u5b58\u67e5\u9a8c\u4e00\u8d77\u6267\u884c\uff0c\u4ee5\u4fdd\u8bc1\u539f\u5b50\u6027\u3002\u8fd9\u5c31\u662f\u79d2\u6740\u5bf9 Redis \u7684\u9700\u6c42\u3002","title":"2-4 \u79d2\u6740\u573a\u666f\u5bf9 Redis \u7684\u9700\u6c42"},{"location":"chap7/4redis_spike_sys/#3redis","text":"","title":"3\u3001Redis \u7684\u54ea\u4e9b\u65b9\u6cd5\u53ef\u4ee5\u652f\u6491\u79d2\u6740\u573a\u666f\uff1f"},{"location":"chap7/4redis_spike_sys/#3-1-redis","text":"\u652f\u6301\u9ad8\u5e76\u53d1 \u3002\u8fd9\u4e2a\u5f88\u7b80\u5355\uff0cRedis \u672c\u8eab\u9ad8\u901f\u5904\u7406\u8bf7\u6c42\u7684\u7279\u6027\u5c31\u53ef\u4ee5\u652f\u6301\u9ad8\u5e76\u53d1\u3002\u800c\u4e14\uff0c\u5982\u679c\u6709\u591a\u4e2a\u79d2\u6740\u5546\u54c1\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5207\u7247\u96c6\u7fa4\uff0c\u7528\u4e0d\u540c\u7684\u5b9e\u4f8b\u4fdd\u5b58\u4e0d\u540c\u5546\u54c1\u7684\u5e93\u5b58\uff0c\u8fd9\u6837\u5c31\u907f\u514d\uff0c\u4f7f\u7528\u5355\u4e2a\u5b9e\u4f8b\u5bfc\u81f4\u6240\u6709\u7684\u79d2\u6740\u8bf7\u6c42\u90fd\u96c6\u4e2d\u5728\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u95ee\u9898\u4e86\u3002\u4e0d\u8fc7\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5f53\u4f7f\u7528\u5207\u7247\u96c6\u7fa4\u65f6\uff0c\u6211\u4eec\u8981\u5148\u7528 CRC \u7b97\u6cd5\u8ba1\u7b97\u4e0d\u540c\u79d2\u6740\u5546\u54c1 key \u5bf9\u5e94\u7684 Slot\uff0c\u7136\u540e\uff0c\u6211\u4eec\u5728\u5206\u914d Slot \u548c\u5b9e\u4f8b\u5bf9\u5e94\u5173\u7cfb\u65f6\uff0c\u624d\u80fd\u628a\u4e0d\u540c\u79d2\u6740\u5546\u54c1\u5bf9\u5e94\u7684 Slot \u5206\u914d\u5230\u4e0d\u540c\u5b9e\u4f8b\u4e0a\u4fdd\u5b58\u3002 \u4fdd\u8bc1\u5e93\u5b58\u67e5\u9a8c\u548c\u5e93\u5b58\u6263\u51cf\u539f\u5b50\u6027\u6267\u884c \u3002\u9488\u5bf9\u8fd9\u6761\u8981\u6c42\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528 Redis \u7684\u539f\u5b50\u64cd\u4f5c\u6216\u662f\u5206\u5e03\u5f0f\u9501\u8fd9\u4e24\u4e2a\u529f\u80fd\u7279\u6027\u6765\u652f\u6491\u4e86\u3002 Redis \u662f\u5982\u4f55\u57fa\u4e8e\u539f\u5b50\u64cd\u4f5c\u6765\u652f\u6491\u79d2\u6740\u573a\u666f\u7684\u3002","title":"3-1 \u79d2\u6740\u573a\u666f\u5bf9 Redis \u64cd\u4f5c\u7684\u6839\u672c\u8981\u6c42"},{"location":"chap7/4redis_spike_sys/#3-2","text":"\u5728\u79d2\u6740\u573a\u666f\u4e2d\uff0c\u4e00\u4e2a\u5546\u54c1\u7684\u5e93\u5b58\u5bf9\u5e94\u4e86\u4e24\u4e2a\u4fe1\u606f\uff0c \u5206\u522b\u662f\u603b\u5e93\u5b58\u91cf\u548c\u5df2\u79d2\u6740\u91cf \u3002\u8fd9\u79cd\u6570\u636e\u6a21\u578b\u6b63\u597d\u662f\u4e00\u4e2a key\uff08\u5546\u54c1 ID\uff09\u5bf9\u5e94\u4e86\u4e24\u4e2a\u5c5e\u6027\uff08\u603b\u5e93\u5b58\u91cf\u548c\u5df2\u79d2\u6740\u91cf\uff09\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a Hash \u7c7b\u578b\u7684\u952e\u503c\u5bf9\u6765\u4fdd\u5b58\u5e93\u5b58\u7684\u8fd9\u4e24\u4e2a\u4fe1\u606f\uff0c\u5982\u4e0b\u6240\u793a\uff1a key: itemID value: {total: N, ordered: M} \u5176\u4e2d\uff0citemID \u662f\u5546\u54c1\u7684\u7f16\u53f7\uff0ctotal \u662f\u603b\u5e93\u5b58\u91cf\uff0cordered \u662f\u5df2\u79d2\u6740\u91cf\u3002 \u56e0\u4e3a\u5e93\u5b58\u67e5\u9a8c\u548c\u5e93\u5b58\u6263\u51cf\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u8981\u4fdd\u8bc1\u4e00\u8d77\u6267\u884c\uff0c\u4e00\u4e2a\u76f4\u63a5\u7684\u65b9\u6cd5\u5c31\u662f\u4f7f\u7528 Redis \u7684\u539f\u5b50\u64cd\u4f5c\u3002 \u56e0\u4e3a\u5e93\u5b58\u67e5\u9a8c\u548c\u5e93\u5b58\u6263\u51cf\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u8981\u4fdd\u8bc1\u4e00\u8d77\u6267\u884c\uff0c\u4e00\u4e2a\u76f4\u63a5\u7684\u65b9\u6cd5\u5c31\u662f\u4f7f\u7528 Redis \u7684\u539f\u5b50\u64cd\u4f5c\u3002 Redis\u5e94\u5bf9\u5e76\u53d1\u8bbf\u95ee\uff1a\u65e0\u9501\u7684\u539f\u5b50\u64cd\u4f5c \u5b66\u4e60\u8fc7\uff0c \u539f\u5b50\u64cd\u4f5c\u53ef\u4ee5\u662f Redis \u81ea\u8eab\u63d0\u4f9b\u7684\u539f\u5b50\u547d\u4ee4\uff0c\u4e5f\u53ef\u4ee5\u662f Lua \u811a\u672c\u3002\u56e0\u4e3a\u5e93\u5b58\u67e5\u9a8c\u548c\u5e93\u5b58\u6263\u51cf\u662f\u4e24\u4e2a\u64cd\u4f5c\uff0c\u65e0\u6cd5\u7528\u4e00\u6761\u547d\u4ee4\u6765\u5b8c\u6210 \uff0c\u6240\u4ee5\uff0c\u5c31\u9700\u8981\u4f7f\u7528 Lua \u811a\u672c\u539f\u5b50\u6027\u5730\u6267\u884c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u3002 Lua \u811a\u672c\u5199\u7684\u4f2a\u4ee3\u7801\uff0c\u5b83\u663e\u793a\u4e86\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7684\u5b9e\u73b0\u3002 #\u83b7\u53d6\u5546\u54c1\u5e93\u5b58\u4fe1\u606f local counts = redis.call(\"HMGET\", KEYS[1], \"total\", \"ordered\"); #\u5c06\u603b\u5e93\u5b58\u8f6c\u6362\u4e3a\u6570\u503c local total = tonumber(counts[1]) #\u5c06\u5df2\u88ab\u79d2\u6740\u7684\u5e93\u5b58\u8f6c\u6362\u4e3a\u6570\u503c local ordered = tonumber(counts[2]) #\u5982\u679c\u5f53\u524d\u8bf7\u6c42\u7684\u5e93\u5b58\u91cf\u52a0\u4e0a\u5df2\u88ab\u79d2\u6740\u7684\u5e93\u5b58\u91cf\u4ecd\u7136\u5c0f\u4e8e\u603b\u5e93\u5b58\u91cf\uff0c\u5c31\u53ef\u4ee5\u66f4\u65b0\u5e93\u5b58 if ordered + k <= total then #\u66f4\u65b0\u5df2\u79d2\u6740\u7684\u5e93\u5b58\u91cf redis.call(\"HINCRBY\",KEYS[1],\"ordered\",k) return k; end return 0 \u6709\u4e86 Lua \u811a\u672c\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728 Redis \u5ba2\u6237\u7aef\uff0c\u4f7f\u7528 EVAL \u547d\u4ee4\u6765\u6267\u884c\u8fd9\u4e2a\u811a\u672c\u4e86\u3002 \u6700\u540e\uff0c\u5ba2\u6237\u7aef\u4f1a\u6839\u636e\u811a\u672c\u7684\u8fd4\u56de\u503c\uff0c\u6765\u786e\u5b9a\u79d2\u6740\u662f\u6210\u529f\u8fd8\u662f\u5931\u8d25\u4e86\u3002\u5982\u679c\u8fd4\u56de\u503c\u662f k\uff0c\u5c31\u662f\u6210\u529f\u4e86\uff1b\u5982\u679c\u662f 0\uff0c\u5c31\u662f\u5931\u8d25\u3002 \u5176\u5b9e\uff0c\u8981\u60f3\u4fdd\u8bc1\u5e93\u5b58\u67e5\u9a8c\u548c\u6263\u51cf\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7684\u539f\u5b50\u6027\uff0c \u8fd8\u6709\u53e6\u4e00\u79cd\u65b9\u6cd5\uff0c\u5c31\u662f\u4f7f\u7528\u5206\u5e03\u5f0f\u9501\u6765\u4fdd\u8bc1\u591a\u4e2a\u5ba2\u6237\u7aef\u80fd\u4e92\u65a5\u6267\u884c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u3002","title":"3-2 \u57fa\u4e8e\u539f\u5b50\u64cd\u4f5c\u652f\u6491\u79d2\u6740\u573a\u666f"},{"location":"chap7/4redis_spike_sys/#3-3","text":"\u4f7f\u7528\u5206\u5e03\u5f0f\u9501\u6765\u652f\u6491\u79d2\u6740\u573a\u666f\u7684\u5177\u4f53\u505a\u6cd5\u662f\uff0c\u5148\u8ba9\u5ba2\u6237\u7aef\u5411 Redis \u7533\u8bf7\u5206\u5e03\u5f0f\u9501\uff0c\u53ea\u6709\u62ff\u5230\u9501\u7684\u5ba2\u6237\u7aef\u624d\u80fd\u6267\u884c\u5e93\u5b58\u67e5\u9a8c\u548c\u5e93\u5b58\u6263\u51cf\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5927\u91cf\u7684\u79d2\u6740\u8bf7\u6c42\u5c31\u4f1a\u5728\u4e89\u593a\u5206\u5e03\u5f0f\u9501\u65f6\u88ab\u8fc7\u6ee4\u6389\u3002\u800c\u4e14\uff0c \u5e93\u5b58\u67e5\u9a8c\u548c\u6263\u51cf\u4e5f\u4e0d\u7528\u4f7f\u7528\u539f\u5b50\u64cd\u4f5c\u4e86\uff0c\u56e0\u4e3a\u591a\u4e2a\u5e76\u53d1\u5ba2\u6237\u7aef\u53ea\u6709\u4e00\u4e2a\u5ba2\u6237\u7aef\u80fd\u591f\u62ff\u5230\u9501\uff0c\u5df2\u7ecf\u4fdd\u8bc1\u4e86\u5ba2\u6237\u7aef\u5e76\u53d1\u8bbf\u95ee\u7684\u4e92\u65a5\u6027 \u3002 \u4f2a\u4ee3\u7801\uff0c\u5b83\u663e\u793a\u4e86\u4f7f\u7528\u5206\u5e03\u5f0f\u9501\u6765\u6267\u884c\u5e93\u5b58\u67e5\u9a8c\u548c\u6263\u51cf\u7684\u8fc7\u7a0b //\u4f7f\u7528\u5546\u54c1ID\u4f5c\u4e3akey key = itemID //\u4f7f\u7528\u5ba2\u6237\u7aef\u552f\u4e00\u6807\u8bc6\u4f5c\u4e3avalue val = clientUniqueID //\u7533\u8bf7\u5206\u5e03\u5f0f\u9501\uff0cTimeout\u662f\u8d85\u65f6\u65f6\u95f4 lock =acquireLock(key, val, Timeout) //\u5f53\u62ff\u5230\u9501\u540e\uff0c\u624d\u80fd\u8fdb\u884c\u5e93\u5b58\u67e5\u9a8c\u548c\u6263\u51cf if(lock == True) { //\u5e93\u5b58\u67e5\u9a8c\u548c\u6263\u51cf availStock = DECR(key, k) //\u5e93\u5b58\u5df2\u7ecf\u6263\u51cf\u5b8c\u4e86\uff0c\u91ca\u653e\u9501\uff0c\u8fd4\u56de\u79d2\u6740\u5931\u8d25 if (availStock < 0) { releaseLock(key, val) return error } //\u5e93\u5b58\u6263\u51cf\u6210\u529f\uff0c\u91ca\u653e\u9501 else{ releaseLock(key, val) //\u8ba2\u5355\u5904\u7406 } } //\u6ca1\u6709\u62ff\u5230\u9501\uff0c\u76f4\u63a5\u8fd4\u56de else return \u5728\u4f7f\u7528\u5206\u5e03\u5f0f\u9501\u65f6\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u5148\u5411 Redis \u8bf7\u6c42\u9501\uff0c\u53ea\u6709\u8bf7\u6c42\u5230\u4e86\u9501\uff0c\u624d\u80fd\u8fdb\u884c\u5e93\u5b58\u67e5\u9a8c\u7b49\u64cd\u4f5c\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5ba2\u6237\u7aef\u5728\u4e89\u62a2\u5206\u5e03\u5f0f\u9501\u65f6\uff0c\u5927\u90e8\u5206\u79d2\u6740\u8bf7\u6c42\u672c\u8eab\u5c31\u4f1a\u56e0\u4e3a\u62a2\u4e0d\u5230\u9501\u800c\u88ab\u62e6\u622a\u3002 \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5207\u7247\u96c6\u7fa4\u4e2d\u7684\u4e0d\u540c\u5b9e\u4f8b\u6765\u5206\u522b\u4fdd\u5b58\u5206\u5e03\u5f0f\u9501\u548c\u5546\u54c1\u5e93\u5b58\u4fe1\u606f \u3002 \u4f7f\u7528\u8fd9\u79cd\u4fdd\u5b58\u65b9\u5f0f\u540e\uff0c\u79d2\u6740\u8bf7\u6c42\u4f1a\u9996\u5148\u8bbf\u95ee\u4fdd\u5b58\u5206\u5e03\u5f0f\u9501\u7684\u5b9e\u4f8b\u3002\u5982\u679c\u5ba2\u6237\u7aef\u6ca1\u6709\u62ff\u5230\u9501\uff0c\u8fd9\u4e9b\u5ba2\u6237\u7aef\u5c31\u4e0d\u4f1a\u67e5\u8be2\u5546\u54c1\u5e93\u5b58\uff0c\u8fd9\u5c31\u53ef\u4ee5\u51cf\u8f7b\u4fdd\u5b58\u5e93\u5b58\u4fe1\u606f\u7684\u5b9e\u4f8b\u7684\u538b\u529b\u4e86\u3002","title":"3-3 \u57fa\u4e8e\u5206\u5e03\u5f0f\u9501\u6765\u652f\u6491\u79d2\u6740\u573a\u666f"},{"location":"chap7/4redis_spike_sys/#4","text":"\u79d2\u6740\u573a\u666f\u6709 2 \u4e2a\u8d1f\u8f7d\u7279\u5f81\uff0c\u5206\u522b\u662f\u77ac\u65f6 \u9ad8\u5e76\u53d1\u8bf7\u6c42\u548c\u8bfb\u591a\u5199\u5c11 \u3002Redis \u826f\u597d\u7684\u9ad8\u5e76\u53d1\u5904\u7406\u80fd\u529b\uff0c\u4ee5\u53ca\u9ad8\u6548\u7684\u952e\u503c\u5bf9\u8bfb\u5199\u7279\u6027\uff0c\u6b63\u597d\u53ef\u4ee5\u6ee1\u8db3\u79d2\u6740\u573a\u666f\u7684\u9700\u6c42\u3002 \u5728\u79d2\u6740\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u524d\u7aef CDN \u548c\u6d4f\u89c8\u5668\u7f13\u5b58\u62e6\u622a\u5927\u91cf\u79d2\u6740\u524d\u7684\u8bf7\u6c42\u3002\u5728\u5b9e\u9645\u79d2\u6740\u6d3b\u52a8\u8fdb\u884c\u65f6\uff0c\u5e93\u5b58\u67e5\u9a8c\u548c\u5e93\u5b58\u6263\u51cf\u662f\u627f\u53d7\u5de8\u5927\u5e76\u53d1\u8bf7\u6c42\u538b\u529b\u7684\u4e24\u4e2a\u64cd\u4f5c\uff0c\u540c\u65f6\uff0c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7684\u6267\u884c\u9700\u8981\u4fdd\u8bc1\u539f\u5b50\u6027\u3002Redis \u7684\u539f\u5b50\u64cd\u4f5c\u3001\u5206\u5e03\u5f0f\u9501\u8fd9\u4e24\u4e2a\u529f\u80fd\u7279\u6027\u53ef\u4ee5\u6709\u6548\u5730\u6765\u652f\u6491\u79d2\u6740\u573a\u666f\u7684\u9700\u6c42\u3002 \u5f53\u7136\uff0c\u5bf9\u4e8e\u79d2\u6740\u573a\u666f\u6765\u8bf4\uff0c\u53ea\u7528 Redis \u662f\u4e0d\u591f\u7684\u3002\u79d2\u6740\u7cfb\u7edf\u662f\u4e00\u4e2a\u7cfb\u7edf\u6027\u5de5\u7a0b\uff0cRedis \u5b9e\u73b0\u4e86\u5bf9\u5e93\u5b58\u67e5\u9a8c\u548c\u6263\u51cf\u8fd9\u4e2a\u73af\u8282\u7684\u652f\u6491\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u6709 4 \u4e2a\u73af\u8282\u9700\u8981\u6211\u4eec\u5904\u7406\u597d\u3002 \u524d\u7aef\u9759\u6001\u9875\u9762\u7684\u8bbe\u8ba1 \u3002\u79d2\u6740\u9875\u9762\u4e0a\u80fd\u9759\u6001\u5316\u5904\u7406\u7684\u9875\u9762\u5143\u7d20\uff0c\u6211\u4eec\u90fd\u8981\u5c3d\u91cf\u9759\u6001\u5316\uff0c\u8fd9\u6837\u53ef\u4ee5\u5145\u5206\u5229\u7528 CDN \u6216\u6d4f\u89c8\u5668\u7f13\u5b58\u670d\u52a1\u79d2\u6740\u5f00\u59cb\u524d\u7684\u8bf7\u6c42\u3002 \u8bf7\u6c42\u62e6\u622a\u548c\u6d41\u63a7 \u3002\u5728\u79d2\u6740\u7cfb\u7edf\u7684\u63a5\u5165\u5c42\uff0c\u5bf9\u6076\u610f\u8bf7\u6c42\u8fdb\u884c\u62e6\u622a\uff0c\u907f\u514d\u5bf9\u7cfb\u7edf\u7684\u6076\u610f\u653b\u51fb\uff0c\u4f8b\u5982\u4f7f\u7528\u9ed1\u540d\u5355\u7981\u6b62\u6076\u610f IP \u8fdb\u884c\u8bbf\u95ee\u3002\u5982\u679c Redis \u5b9e\u4f8b\u7684\u8bbf\u95ee\u538b\u529b\u8fc7\u5927\uff0c\u4e3a\u4e86\u907f\u514d\u5b9e\u4f8b\u5d29\u6e83\uff0c\u6211\u4eec\u4e5f\u9700\u8981\u5728\u63a5\u5165\u5c42\u8fdb\u884c\u9650\u6d41\uff0c\u63a7\u5236\u8fdb\u5165\u79d2\u6740\u7cfb\u7edf\u7684\u8bf7\u6c42\u6570\u91cf\u3002 \u5e93\u5b58\u4fe1\u606f\u8fc7\u671f\u65f6\u95f4\u5904\u7406 \u3002Redis \u4e2d\u4fdd\u5b58\u7684\u5e93\u5b58\u4fe1\u606f\u5176\u5b9e\u662f\u6570\u636e\u5e93\u7684\u7f13\u5b58\uff0c\u4e3a\u4e86\u907f\u514d\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898\uff0c\u6211\u4eec\u4e0d\u8981\u7ed9\u5e93\u5b58\u4fe1\u606f\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002 \u6570\u636e\u5e93\u8ba2\u5355\u5f02\u5e38\u5904\u7406 \u3002\u5982\u679c\u6570\u636e\u5e93\u6ca1\u80fd\u6210\u529f\u5904\u7406\u8ba2\u5355\uff0c\u53ef\u4ee5\u589e\u52a0\u8ba2\u5355\u91cd\u8bd5\u529f\u80fd\uff0c\u4fdd\u8bc1\u8ba2\u5355\u6700\u7ec8\u80fd\u88ab\u6210\u529f\u5904\u7406\u3002 \u5efa\u8bae\uff1a \u79d2\u6740\u6d3b\u52a8\u5e26\u6765\u7684\u8bf7\u6c42\u6d41\u91cf\u5de8\u5927\uff0c\u6211\u4eec\u9700\u8981\u628a\u79d2\u6740\u5546\u54c1\u7684\u5e93\u5b58\u4fe1\u606f\u7528\u5355\u72ec\u7684\u5b9e\u4f8b\u4fdd\u5b58\uff0c\u800c\u4e0d\u8981\u548c\u65e5\u5e38\u4e1a\u52a1\u7cfb\u7edf\u7684\u6570\u636e\u4fdd\u5b58\u5728\u540c\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u5e72\u6270\u4e1a\u52a1\u7cfb\u7edf\u7684\u6b63\u5e38\u8fd0\u884c\u3002","title":"4\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap7/5redis_data_incline/","text":"\u7b2c\u4e94\u8282 \u6570\u636e\u5206\u5e03\u4f18\u5316\u5e94\u5bf9\u6570\u636e\u503e\u659c \u5728\u5207\u7247\u96c6\u7fa4\u4e2d\uff0c\u6570\u636e\u4f1a\u6309\u7167\u4e00\u5b9a\u7684\u5206\u5e03\u89c4\u5219\u5206\u6563\u5230\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\u4fdd\u5b58\u3002\u6bd4\u5982\uff0c\u5728\u4f7f\u7528 Redis Cluster \u6216 Codis \u65f6\uff0c \u6570\u636e\u90fd\u4f1a\u5148\u6309\u7167 CRC \u7b97\u6cd5\u7684\u8ba1\u7b97\u503c\u5bf9 Slot\uff08\u903b\u8f91\u69fd\uff09\u53d6\u6a21\uff0c\u540c\u65f6\uff0c\u6240\u6709\u7684 Slot \u53c8\u4f1a\u7531\u8fd0\u7ef4\u7ba1\u7406\u5458\u5206\u914d\u5230\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\u3002 \u5bb9\u6613\u5bfc\u81f4\u4e00\u4e2a\u95ee\u9898\uff1a\u6570\u636e\u503e\u659c \u6570\u636e\u503e\u659c\u6709\u4e24\u7c7b\u3002 \u6570\u636e\u91cf\u503e\u659c \uff1a\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5b9e\u4f8b\u4e0a\u7684\u6570\u636e\u5206\u5e03\u4e0d\u5747\u8861\uff0c \u67d0\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u6570\u636e\u7279\u522b\u591a \u3002 \u6570\u636e\u8bbf\u95ee\u503e\u659c \uff1a\u867d\u7136\u6bcf\u4e2a\u96c6\u7fa4\u5b9e\u4f8b\u4e0a\u7684\u6570\u636e\u91cf\u76f8\u5dee\u4e0d\u5927\uff0c \u4f46\u662f\u67d0\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u6570\u636e\u662f\u70ed\u70b9\u6570\u636e\uff0c\u88ab\u8bbf\u95ee\u5f97\u975e\u5e38\u9891\u7e41\u3002 \u5982\u679c\u53d1\u751f\u4e86\u6570\u636e\u503e\u659c\uff0c\u90a3\u4e48\u4fdd\u5b58\u4e86\u5927\u91cf\u6570\u636e\uff0c\u6216\u8005\u662f\u4fdd\u5b58\u4e86\u70ed\u70b9\u6570\u636e\u7684\u5b9e\u4f8b\u7684\u5904\u7406\u538b\u529b\u5c31\u4f1a\u589e\u5927\uff0c \u901f\u5ea6\u53d8\u6162\uff0c\u751a\u81f3\u8fd8\u53ef\u80fd\u4f1a\u5f15\u8d77\u8fd9\u4e2a\u5b9e\u4f8b\u7684\u5185\u5b58\u8d44\u6e90\u8017\u5c3d \uff0c\u4ece\u800c\u5d29\u6e83\u3002\u8fd9\u662f\u6211\u4eec\u5728\u5e94\u7528\u5207\u7247\u96c6\u7fa4\u65f6\u8981\u907f\u514d\u7684\u3002 1\u3001\u6570\u636e\u91cf\u503e\u659c\u7684\u6210\u56e0\u548c\u5e94\u5bf9\u65b9\u6cd5 \u5f53\u6570\u636e\u91cf\u503e\u659c\u53d1\u751f\u65f6\uff0c\u6570\u636e\u5728\u5207\u7247\u96c6\u7fa4\u7684\u591a\u4e2a\u5b9e\u4f8b\u4e0a\u5206\u5e03\u4e0d\u5747\u8861\uff0c\u5927\u91cf\u6570\u636e\u96c6\u4e2d\u5230\u4e86\u4e00\u4e2a\u6216\u51e0\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u90a3\u4e48\uff0c\u6570\u636e\u91cf\u503e\u659c\u662f\u600e\u4e48\u4ea7\u751f\u7684\u5462\uff1f\u8fd9\u4e3b\u8981\u6709\u4e09\u4e2a\u539f\u56e0\uff0c \u5206\u522b\u662f\u67d0\u4e2a\u5b9e\u4f8b\u4e0a\u4fdd\u5b58\u4e86 bigkey\u3001Slot \u5206\u914d\u4e0d\u5747\u8861\u4ee5\u53ca Hash Tag\u3002 1-1 bigkey \u5bfc\u81f4\u503e\u659c \u7b2c\u4e00\u4e2a\u539f\u56e0\u662f\uff0c\u67d0\u4e2a\u5b9e\u4f8b\u4e0a\u6b63\u597d\u4fdd\u5b58\u4e86 bigkey\u3002 bigkey \u7684 value \u503c\u5f88\u5927\uff08String \u7c7b\u578b\uff09\uff0c\u6216\u8005\u662f bigkey \u4fdd\u5b58\u4e86\u5927\u91cf\u96c6\u5408\u5143\u7d20\uff08\u96c6\u5408\u7c7b\u578b\uff09\uff0c\u4f1a\u5bfc\u81f4\u8fd9\u4e2a\u5b9e\u4f8b\u7684\u6570\u636e\u91cf\u589e\u52a0\uff0c\u5185\u5b58\u8d44\u6e90\u6d88\u8017\u4e5f\u76f8\u5e94\u589e\u52a0\u3002 bigkey \u7684\u64cd\u4f5c\u4e00\u822c\u90fd\u4f1a\u9020\u6210\u5b9e\u4f8b IO \u7ebf\u7a0b\u963b\u585e\uff0c\u5982\u679c bigkey \u7684\u8bbf\u95ee\u91cf\u6bd4\u8f83\u5927\uff0c\u5c31\u4f1a\u5f71\u54cd\u5230\u8fd9\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u5176\u5b83\u8bf7\u6c42\u88ab\u5904\u7406\u7684\u901f\u5ea6\u3002 \u4e3a\u4e86\u907f\u514d bigkey \u9020\u6210\u7684\u6570\u636e\u503e\u659c\uff0c\u4e00\u4e2a\u6839\u672c\u7684\u5e94\u5bf9\u65b9\u6cd5\u662f\uff0c \u5728\u4e1a\u52a1\u5c42\u751f\u6210\u6570\u636e\u65f6\uff0c\u8981\u5c3d\u91cf\u907f\u514d\u628a\u8fc7\u591a\u7684\u6570\u636e\u4fdd\u5b58\u5728\u540c\u4e00\u4e2a\u952e\u503c\u5bf9\u4e2d\u3002 \u5982\u679c bigkey \u6b63\u597d\u662f\u96c6\u5408\u7c7b\u578b\uff0c\u8fd8\u6709\u4e00\u4e2a\u65b9\u6cd5\uff0c\u5c31\u662f\u628a bigkey \u62c6\u5206\u6210\u5f88\u591a\u4e2a\u5c0f\u7684\u96c6\u5408\u7c7b\u578b\u6570\u636e\uff0c\u5206\u6563\u4fdd\u5b58\u5728\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\u3002 \u4e3e\u4e2a\u4f8b\u5b50\u3002 \u5047\u8bbe Hash \u7c7b\u578b\u96c6\u5408 user:info \u4fdd\u5b58\u4e86 100 \u4e07\u4e2a\u7528\u6237\u7684\u4fe1\u606f\uff0c\u662f\u4e00\u4e2a bigkey\u3002 \u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6309\u7167\u7528\u6237 ID \u7684\u8303\u56f4\uff0c\u628a\u8fd9\u4e2a\u96c6\u5408\u62c6\u5206\u6210 10 \u4e2a\u5c0f\u96c6\u5408\uff0c\u6bcf\u4e2a\u5c0f\u96c6\u5408\u53ea\u4fdd\u5b58 10 \u4e07\u4e2a\u7528\u6237\u7684\u4fe1\u606f\uff08\u4f8b\u5982\u5c0f\u96c6\u5408 1 \u4fdd\u5b58\u7684\u662f ID \u4ece 1 \u5230 10 \u4e07\u7684\u7528\u6237\u4fe1\u606f\uff0c\u5c0f\u96c6\u5408 2 \u4fdd\u5b58\u7684\u662f ID \u4ece 10 \u4e07\u96f6 1 \u5230 20 \u4e07\u7684\u7528\u6237\uff09\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u4e00\u4e2a bigkey \u5316\u6574\u4e3a\u96f6\u3001\u5206\u6563\u4fdd\u5b58\u4e86\uff0c\u907f\u514d\u4e86 bigkey \u7ed9\u5355\u4e2a\u5207\u7247\u5b9e\u4f8b\u5e26\u6765\u7684\u8bbf\u95ee\u538b\u529b\u3002 1-2 Slot \u5206\u914d\u4e0d\u5747\u8861\u5bfc\u81f4\u503e\u659c \u5982\u679c\u96c6\u7fa4\u8fd0\u7ef4\u4eba\u5458\u6ca1\u6709\u5747\u8861\u5730\u5206\u914d Slot\uff0c\u5c31\u4f1a\u6709\u5927\u91cf\u7684\u6570\u636e\u88ab\u5206\u914d\u5230\u540c\u4e00\u4e2a Slot \u4e2d\uff0c\u800c\u540c\u4e00\u4e2a Slot \u53ea\u4f1a\u5728\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\u5206\u5e03\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\uff0c \u5927\u91cf\u6570\u636e\u88ab\u96c6\u4e2d\u5230\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u9020\u6210\u6570\u636e\u503e\u659c \u3002 \u4ee5 Redis Cluster \u4e3a\u4f8b\uff0c\u6765\u4ecb\u7ecd\u4e0b Slot \u5206\u914d\u4e0d\u5747\u8861\u7684\u60c5\u51b5\u3002 \u4f46\u662f\u5176\u5b9e\u5e76\u4e0d\u77e5\u9053\u6570\u636e\u548c Slot \u7684\u5bf9\u5e94\u5173\u7cfb\uff0c \u8fd9\u79cd\u505a\u6cd5\u5c31\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5927\u91cf\u6570\u636e\u6b63\u597d\u88ab\u6620\u5c04\u5230\u5b9e\u4f8b 1 \u4e0a\u7684 Slot\uff0c\u9020\u6210\u6570\u636e\u503e\u659c\uff0c\u7ed9\u5b9e\u4f8b 1 \u5e26\u6765\u8bbf\u95ee\u538b\u529b \u3002 \u4e3a\u4e86\u5e94\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd0\u7ef4\u89c4\u8303\uff0c\u5728\u5206\u914d\u4e4b\u524d\uff0c \u6211\u4eec\u5c31\u8981\u907f\u514d\u628a\u8fc7\u591a\u7684 Slot \u5206\u914d\u5230\u540c\u4e00\u4e2a\u5b9e\u4f8b \u3002 \u5982\u679c\u662f\u5df2\u7ecf\u5206\u914d\u597d Slot \u7684\u96c6\u7fa4\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u67e5\u770b Slot \u548c\u5b9e\u4f8b\u7684\u5177\u4f53\u5206\u914d\u5173\u7cfb \uff0c\u4ece\u800c\u5224\u65ad\u662f\u5426\u6709\u8fc7\u591a\u7684 Slot \u96c6\u4e2d\u5230\u4e86\u540c\u4e00\u4e2a\u5b9e\u4f8b\u3002\u5982\u679c\u6709\u7684\u8bdd\uff0c\u5c31\u5c06\u90e8\u5206 Slot \u8fc1\u79fb\u5230\u5176\u5b83\u5b9e\u4f8b\uff0c\u4ece\u800c\u907f\u514d\u6570\u636e\u503e\u659c\u3002 1-3 Slot \u8fc1\u79fb \u4e0d\u540c\u96c6\u7fa4\u4e0a\u67e5\u770b Slot \u5206\u914d\u60c5\u51b5\u7684\u65b9\u5f0f\u4e0d\u540c\uff1a \u5982\u679c\u662f Redis Cluster\uff0c\u5c31\u7528 CLUSTER SLOTS \u547d\u4ee4\uff1b\u5982\u679c\u662f Codis\uff0c\u5c31\u53ef\u4ee5\u5728 codis dashboard \u4e0a\u67e5\u770b \u3002 \u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u6267\u884c CLUSTER SLOTS \u547d\u4ee4\u67e5\u770b Slot \u5206\u914d\u60c5\u51b5\u3002 \u547d\u4ee4\u8fd4\u56de\u7ed3\u679c\u663e\u793a\uff0c Slot 0 \u5230 Slot 4095 \u88ab\u5206\u914d\u5230\u4e86\u5b9e\u4f8b 192.168.10.3 \u4e0a\uff0c\u800c Slot 12288 \u5230 Slot 16383 \u88ab\u5206\u914d\u5230\u4e86\u5b9e\u4f8b 192.168.10.5 \u4e0a\u3002 127.0.0.1:6379> cluster slots 1) 1) (integer) 0 2) (integer) 4095 3) 1) \"192.168.10.3\" 2) (integer) 6379 2) 1) (integer) 12288 2) (integer) 16383 3) 1) \"192.168.10.5\" 2) (integer) 6379 \u5982\u679c\u67d0\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\u6709\u592a\u591a\u7684 Slot\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u8fc1\u79fb\u547d\u4ee4\u628a\u8fd9\u4e9b Slot \u8fc1\u79fb\u5230\u5176\u5b83\u5b9e\u4f8b\u4e0a\u3002 \u5728 Redis Cluster \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 3 \u4e2a\u547d\u4ee4\u5b8c\u6210 Slot \u8fc1\u79fb\u3002 CLUSTER SETSLOT \uff1a\u4f7f\u7528\u4e0d\u540c\u7684\u9009\u9879\u8fdb\u884c\u4e09\u79cd\u8bbe\u7f6e\uff0c\u5206\u522b\u662f\u8bbe\u7f6e Slot \u8981\u8fc1\u5165\u7684\u76ee\u6807\u5b9e\u4f8b\uff0cSlot \u8981\u8fc1\u51fa\u7684\u6e90\u5b9e\u4f8b\uff0c\u4ee5\u53ca Slot \u6240\u5c5e\u7684\u5b9e\u4f8b\u3002 CLUSTER GETKEYSINSLOT \uff1a \u83b7\u53d6\u67d0\u4e2a Slot \u4e2d\u4e00\u5b9a\u6570\u91cf\u7684 key \u3002 MIGRATE \uff1a\u628a\u4e00\u4e2a key \u4ece\u6e90\u5b9e\u4f8b\u5b9e\u9645\u8fc1\u79fb\u5230\u76ee\u6807\u5b9e\u4f8b\u3002 \u5047\u8bbe\u6211\u4eec\u8981\u628a Slot 300 \u4ece\u6e90\u5b9e\u4f8b\uff08ID \u4e3a 3\uff09\u8fc1\u79fb\u5230\u76ee\u6807\u5b9e\u4f8b\uff08ID \u4e3a 5\uff09\uff0c\u90a3\u8981\u600e\u4e48\u505a\u5462\uff1f \u5b9e\u9645\u4e0a\uff0c\u53ef\u4ee5\u5206\u6210 5 \u6b65\u3002 \u7b2c 1 \u6b65\uff0c\u5148 \u5728\u76ee\u6807\u5b9e\u4f8b 5 \u4e0a\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4 \uff0c \u5c06 Slot 300 \u7684\u6e90\u5b9e\u4f8b\u8bbe\u7f6e\u4e3a\u5b9e\u4f8b 3\uff0c\u8868\u793a\u8981\u4ece\u5b9e\u4f8b 3 \u4e0a\u8fc1\u5165 Slot 300\u3002 CLUSTER SETSLOT 300 IMPORTING 3 \u7b2c 2 \u6b65\uff0c \u5728\u6e90\u5b9e\u4f8b 3 \u4e0a\uff0c\u6211\u4eec\u628a Slot 300 \u7684\u76ee\u6807\u5b9e\u4f8b\u8bbe\u7f6e\u4e3a 5\uff0c\u8fd9\u8868\u793a\uff0cSlot 300 \u8981\u8fc1\u51fa\u5230\u5b9e\u4f8b 5 \u4e0a \uff0c\u5982\u4e0b\u6240\u793a\uff1a CLUSTER SETSLOT 300 MIGRATING 5 \u7b2c 3 \u6b65\uff0c \u4ece Slot 300 \u4e2d\u83b7\u53d6 100 \u4e2a key\u3002\u56e0\u4e3a Slot \u4e2d\u7684 key \u6570\u91cf\u53ef\u80fd\u5f88\u591a\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5728\u5ba2\u6237\u7aef\u4e0a\u591a\u6b21\u6267\u884c\u4e0b\u9762\u7684\u8fd9\u6761\u547d\u4ee4\uff0c\u5206\u6279\u6b21\u83b7\u5f97\u5e76\u8fc1\u79fb key \u3002 CLUSTER GETKEYSINSLOT 300 100 \u7b2c 4 \u6b65\uff0c\u6211\u4eec\u628a\u521a\u624d\u83b7\u53d6\u7684 100 \u4e2a key \u4e2d\u7684 key1 \u8fc1\u79fb\u5230\u76ee\u6807\u5b9e\u4f8b 5 \u4e0a\uff08IP \u4e3a 192.168.10.5\uff09\uff0c \u540c\u65f6\u628a\u8981\u8fc1\u5165\u7684\u6570\u636e\u5e93\u8bbe\u7f6e\u4e3a 0 \u53f7\u6570\u636e\u5e93 \uff0c \u628a\u8fc1\u79fb\u7684\u8d85\u65f6\u65f6\u95f4\u8bbe\u7f6e\u4e3a timeout\u3002\u6211\u4eec\u91cd\u590d\u6267\u884c MIGRATE \u547d\u4ee4\uff0c\u628a 100 \u4e2a key \u90fd\u8fc1\u79fb\u5b8c \u3002 MIGRATE 192.168.10.5 6379 key1 0 timeout \u6700\u540e\uff0c\u6211\u4eec\u91cd\u590d\u6267\u884c\u7b2c 3 \u548c\u7b2c 4 \u6b65\uff0c\u76f4\u5230 Slot \u4e2d\u7684\u6240\u6709 key \u90fd\u8fc1\u79fb\u5b8c\u6210\u3002 \u4ece Redis 3.0.6 \u5f00\u59cb\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 KEYS \u9009\u9879\uff0c\u4e00\u6b21\u8fc1\u79fb\u591a\u4e2a key\uff08key1\u30012\u30013\uff09\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u5347\u8fc1\u79fb\u6548\u7387\u3002 MIGRATE 192.168.10.5 6379 \"\" 0 timeout KEYS key1 key2 key3 \u5bf9\u4e8e Codis \u6765\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u8fdb\u884c\u6570\u636e\u8fc1\u79fb\u3002\u5176\u4e2d\uff0c\u6211\u4eec\u628a dashboard \u7ec4\u4ef6\u7684\u8fde\u63a5\u5730\u5740\u8bbe\u7f6e\u4e3a ADDR\uff0c\u5e76\u4e14\u628a Slot 300 \u8fc1\u79fb\u5230\u7f16\u53f7\u4e3a 6 \u7684 codis server group \u4e0a\u3002 codis-admin --dashboard=ADDR -slot-action --create --sid=300 --gid=6 \u9664\u4e86 bigkey \u548c Slot \u5206\u914d\u4e0d\u5747\u8861\u4f1a\u5bfc\u81f4\u6570\u636e\u91cf\u503e\u659c\uff0c\u8fd8\u6709\u4e00\u4e2a\u5bfc\u81f4\u503e\u659c\u7684\u539f\u56e0\uff0c\u5c31\u662f\u4f7f\u7528\u4e86 Hash Tag \u8fdb\u884c\u6570\u636e\u5207\u7247\u3002 2\u3001Hash Tag \u5bfc\u81f4\u503e\u659c 2-1 Hash Tag Hash Tag \u662f\u6307\u52a0\u5728\u952e\u503c\u5bf9 key \u4e2d\u7684\u4e00\u5bf9\u82b1\u62ec\u53f7 {} \u3002\u8fd9\u5bf9\u62ec\u53f7\u4f1a\u628a key \u7684\u4e00\u90e8\u5206\u62ec\u8d77\u6765\uff0c\u5ba2\u6237\u7aef\u5728\u8ba1\u7b97 key \u7684 CRC16 \u503c\u65f6\uff0c\u53ea\u5bf9 Hash Tag \u82b1\u62ec\u53f7\u4e2d\u7684 key \u5185\u5bb9\u8fdb\u884c\u8ba1\u7b97\u3002 \u5982\u679c\u6ca1\u7528 Hash Tag \u7684\u8bdd\uff0c\u5ba2\u6237\u7aef\u8ba1\u7b97\u6574\u4e2a key \u7684 CRC16 \u7684\u503c\u3002 Hash Tag \u662f\u6307\u52a0\u5728\u952e\u503c\u5bf9 key \u4e2d\u7684\u4e00\u5bf9\u82b1\u62ec\u53f7 {} \u3002\u8fd9\u5bf9\u62ec\u53f7\u4f1a\u628a key \u7684\u4e00\u90e8\u5206\u62ec\u8d77\u6765\uff0c\u5ba2\u6237\u7aef\u5728\u8ba1\u7b97 key \u7684 CRC16 \u503c\u65f6\uff0c\u53ea\u5bf9 Hash Tag \u82b1\u62ec\u53f7\u4e2d\u7684 key \u5185\u5bb9\u8fdb\u884c\u8ba1\u7b97\u3002\u5982\u679c\u6ca1\u7528 Hash Tag \u7684\u8bdd\uff0c\u5ba2\u6237\u7aef\u8ba1\u7b97\u6574\u4e2a key \u7684 CRC16 \u7684\u503c\u3002 \u4f7f\u7528 Hash Tag \u7684\u597d\u5904\u662f\uff0c\u5982\u679c\u4e0d\u540c key \u7684 Hash Tag \u5185\u5bb9\u90fd\u662f\u4e00\u6837\u7684\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e9b key \u5bf9\u5e94\u7684\u6570\u636e\u4f1a\u88ab\u6620\u5c04\u5230\u540c\u4e00\u4e2a Slot \u4e2d\uff0c\u540c\u65f6\u4f1a\u88ab\u5206\u914d\u5230\u540c\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\u3002 \u4f7f\u7528 Hash Tag \u540e\uff0c\u6570\u636e\u88ab\u6620\u5c04\u5230\u76f8\u540c Slot \u7684\u60c5\u51b5 \u5176\u4e2d\uff0c user:profile:{3231} \u548c user:order:{3231} \u7684 Hash Tag \u4e00\u6837\uff0c\u90fd\u662f 323 \uff0c\u5b83\u4eec\u7684 CRC16 \u8ba1\u7b97\u503c\u5bf9 16384 \u53d6\u6a21\u540e\u7684\u503c\u4e5f\u662f\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u5c31\u5bf9\u5e94\u6620\u5c04\u5230\u4e86\u76f8\u540c\u7684 Slot 1024 \u4e2d\u3002 user:profile:{5328} \u548c user:order:{5328} \u4e5f\u662f\u76f8\u540c\u7684\u6620\u5c04\u7ed3\u679c\u3002 2-2 Hash Tag \u4e00\u822c\u7528\u5728\u4ec0\u4e48\u573a\u666f\u5462\uff1f \u5176\u5b9e\uff0c\u5b83\u4e3b\u8981\u662f\u7528\u5728 Redis Cluster \u548c Codis \u4e2d\uff0c \u652f\u6301\u4e8b\u52a1\u64cd\u4f5c\u548c\u8303\u56f4\u67e5\u8be2 \u3002\u56e0\u4e3a Redis Cluster \u548c Codis \u672c\u8eab\u5e76\u4e0d\u652f\u6301\u8de8\u5b9e\u4f8b\u7684\u4e8b\u52a1\u64cd\u4f5c\u548c\u8303\u56f4\u67e5\u8be2\uff0c \u5f53\u4e1a\u52a1\u5e94\u7528\u6709\u8fd9\u4e9b\u9700\u6c42\u65f6\uff0c\u5c31\u53ea\u80fd\u5148\u628a\u8fd9\u4e9b\u6570\u636e\u8bfb\u53d6\u5230\u4e1a\u52a1\u5c42\u8fdb\u884c\u4e8b\u52a1\u5904\u7406\uff0c\u6216\u8005\u662f\u9010\u4e2a\u67e5\u8be2\u6bcf\u4e2a\u5b9e\u4f8b\uff0c\u5f97\u5230\u8303\u56f4\u67e5\u8be2\u7684\u7ed3\u679c\u3002 \u8fd9\u6837\u64cd\u4f5c\u8d77\u6765\u975e\u5e38\u9ebb\u70e6\uff0c\u6240\u4ee5\uff0c \u53ef\u4ee5\u4f7f\u7528 Hash Tag \u628a\u8981\u6267\u884c\u4e8b\u52a1\u64cd\u4f5c\u6216\u662f\u8303\u56f4\u67e5\u8be2\u7684\u6570\u636e\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u8fd9\u6837\u5c31\u80fd\u5f88\u8f7b\u677e\u5730\u5b9e\u73b0\u4e8b\u52a1\u6216\u8303\u56f4\u67e5\u8be2\u4e86\u3002 2-3 Hash Tag \u5bfc\u81f4\u6570\u636e\u503e\u659c \u4f46\u662f\uff0c\u4f7f\u7528 Hash Tag \u7684\u6f5c\u5728\u95ee\u9898\uff0c\u5c31\u662f\u5927\u91cf\u7684\u6570\u636e\u53ef\u80fd\u88ab\u96c6\u4e2d\u5230\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u5bfc\u81f4\u6570\u636e\u503e\u659c\uff0c\u96c6\u7fa4\u4e2d\u7684\u8d1f\u8f7d\u4e0d\u5747\u8861\u3002\u90a3\u4e48\uff0c\u8be5\u600e\u4e48\u5e94\u5bf9\u8fd9\u79cd\u95ee\u9898\u5462\uff1f \u9700\u8981\u5728\u8303\u56f4\u67e5\u8be2\u3001\u4e8b\u52a1\u6267\u884c\u7684\u9700\u6c42\u548c\u6570\u636e\u503e\u659c\u5e26\u6765\u7684\u8bbf\u95ee\u538b\u529b\u4e4b\u95f4\uff0c\u8fdb\u884c\u53d6\u820d\u4e86\u3002 \u5982\u679c\u4f7f\u7528 Hash Tag \u8fdb\u884c\u5207\u7247\u7684\u6570\u636e\u4f1a\u5e26\u6765\u8f83\u5927\u7684\u8bbf\u95ee\u538b\u529b\uff0c\u5c31\u4f18\u5148\u8003\u8651\u907f\u514d\u6570\u636e\u503e\u659c\uff0c \u6700\u597d\u4e0d\u8981\u4f7f\u7528 Hash Tag \u8fdb\u884c\u6570\u636e\u5207\u7247\u3002\u56e0\u4e3a\u4e8b\u52a1\u548c\u8303\u56f4\u67e5\u8be2\u90fd\u8fd8\u53ef\u4ee5\u653e\u5728\u5ba2\u6237\u7aef\u6765\u6267\u884c\uff0c\u800c\u6570\u636e\u503e\u659c\u4f1a\u5bfc\u81f4\u5b9e\u4f8b\u4e0d\u7a33\u5b9a\uff0c\u9020\u6210\u670d\u52a1\u4e0d\u53ef\u7528\u3002 3\u3001\u6570\u636e\u8bbf\u95ee\u503e\u659c\u7684\u6210\u56e0\u548c\u5e94\u5bf9\u65b9\u6cd5 \u53d1\u751f\u6570\u636e\u8bbf\u95ee\u503e\u659c\u7684\u6839\u672c\u539f\u56e0\uff0c\u5c31\u662f\u5b9e\u4f8b\u4e0a\u5b58\u5728\u70ed\u70b9\u6570\u636e\uff08\u6bd4\u5982\u65b0\u95fb\u5e94\u7528\u4e2d\u7684\u70ed\u70b9\u65b0\u95fb\u5185\u5bb9\u3001\u7535\u5546\u4fc3\u9500\u6d3b\u52a8\u4e2d\u7684\u70ed\u95e8\u5546\u54c1\u4fe1\u606f\uff0c\u7b49\u7b49\uff09\u3002 \u4e00\u65e6\u70ed\u70b9\u6570\u636e\u88ab\u5b58\u5728\u4e86\u67d0\u4e2a\u5b9e\u4f8b\u4e2d\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e2a\u5b9e\u4f8b\u7684\u8bf7\u6c42\u8bbf\u95ee\u91cf\u5c31\u4f1a\u8fdc\u9ad8\u4e8e\u5176\u5b83\u5b9e\u4f8b\uff0c\u9762\u4e34\u5de8\u5927\u7684\u8bbf\u95ee\u538b\u529b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u8be5\u5982\u4f55\u5e94\u5bf9\u5462\uff1f \u548c\u6570\u636e\u91cf\u503e\u659c\u4e0d\u540c\uff0c\u70ed\u70b9\u6570\u636e\u901a\u5e38\u662f\u4e00\u4e2a\u6216\u51e0\u4e2a\u6570\u636e\uff0c\u6240\u4ee5\uff0c\u76f4\u63a5\u91cd\u65b0\u5206\u914d Slot \u5e76\u4e0d\u80fd\u89e3\u51b3\u70ed\u70b9\u6570\u636e\u7684\u95ee\u9898\u3002 \u901a\u5e38\u6765\u8bf4\uff0c\u70ed\u70b9\u6570\u636e\u4ee5\u670d\u52a1\u8bfb\u64cd\u4f5c\u4e3a\u4e3b\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c \u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u70ed\u70b9\u6570\u636e\u591a\u526f\u672c\u7684\u65b9\u6cd5\u6765\u5e94\u5bf9 \u3002 \u5177\u4f53\u505a\u6cd5\u662f\uff0c \u6211\u4eec\u628a\u70ed\u70b9\u6570\u636e\u590d\u5236\u591a\u4efd\uff0c\u5728\u6bcf\u4e00\u4e2a\u6570\u636e\u526f\u672c\u7684 key \u4e2d\u589e\u52a0\u4e00\u4e2a\u968f\u673a\u524d\u7f00\uff0c\u8ba9\u5b83\u548c\u5176\u5b83\u526f\u672c\u6570\u636e\u4e0d\u4f1a\u88ab\u6620\u5c04\u5230\u540c\u4e00\u4e2a Slot \u4e2d\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u70ed\u70b9\u6570\u636e\u65e2\u6709\u591a\u4e2a\u526f\u672c\u53ef\u4ee5\u540c\u65f6\u670d\u52a1\u8bf7\u6c42\uff0c\u540c\u65f6\uff0c\u8fd9\u4e9b\u526f\u672c\u6570\u636e\u7684 key \u53c8\u4e0d\u4e00\u6837\uff0c\u4f1a\u88ab\u6620\u5c04\u5230\u4e0d\u540c\u7684 Slot \u4e2d\u3002\u5728\u7ed9\u8fd9\u4e9b Slot \u5206\u914d\u5b9e\u4f8b\u65f6\uff0c\u6211\u4eec\u4e5f\u8981\u6ce8\u610f\u628a\u5b83\u4eec\u5206\u914d\u5230\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\uff0c\u90a3\u4e48\uff0c\u70ed\u70b9\u6570\u636e\u7684\u8bbf\u95ee\u538b\u529b\u5c31\u88ab\u5206\u6563\u5230\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\u4e86\u3002 \u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\u4e0b\uff0c \u70ed\u70b9\u6570\u636e\u591a\u526f\u672c\u65b9\u6cd5\u53ea\u80fd\u9488\u5bf9\u53ea\u8bfb\u7684\u70ed\u70b9\u6570\u636e\u3002\u5982\u679c\u70ed\u70b9\u6570\u636e\u662f\u6709\u8bfb\u6709\u5199\u7684\u8bdd\uff0c\u5c31\u4e0d\u9002\u5408\u91c7\u7528\u591a\u526f\u672c\u65b9\u6cd5\u4e86\uff0c\u56e0\u4e3a\u8981\u4fdd\u8bc1\u591a\u526f\u672c\u95f4\u7684\u6570\u636e\u4e00\u81f4\u6027\uff0c\u4f1a\u5e26\u6765\u989d\u5916\u7684\u5f00\u9500\u3002 \u5bf9\u4e8e\u6709\u8bfb\u6709\u5199\u7684\u70ed\u70b9\u6570\u636e\uff0c\u6211\u4eec\u5c31\u8981\u7ed9\u5b9e\u4f8b\u672c\u8eab\u589e\u52a0\u8d44\u6e90\u4e86\uff0c\u4f8b\u5982\u4f7f\u7528\u914d\u7f6e\u66f4\u9ad8\u7684\u673a\u5668\uff0c\u6765\u5e94\u5bf9\u5927\u91cf\u7684\u8bbf\u95ee\u538b\u529b\u3002 4\u3001\u672c\u8282\u5c0f\u7ed3 \u6570\u636e\u503e\u659c\u7684\u4e24\u79cd\u60c5\u51b5\uff1a\u6570\u636e\u91cf\u503e\u659c\u548c\u6570\u636e\u8bbf\u95ee\u503e\u659c\u3002 \u9020\u6210\u6570\u636e\u91cf\u503e\u659c\u7684\u539f\u56e0\u4e3b\u8981\u6709\u4e09\u4e2a\uff1a \u6570\u636e\u4e2d\u6709 bigkey\uff0c\u5bfc\u81f4\u67d0\u4e2a\u5b9e\u4f8b\u7684\u6570\u636e\u91cf\u589e\u52a0\uff1b Slot \u624b\u5de5\u5206\u914d\u4e0d\u5747\uff0c\u5bfc\u81f4\u67d0\u4e2a\u6216\u67d0\u4e9b\u5b9e\u4f8b\u4e0a\u6709\u5927\u91cf\u6570\u636e\uff1b \u4f7f\u7528\u4e86 Hash Tag\uff0c\u5bfc\u81f4\u6570\u636e\u96c6\u4e2d\u5230\u67d0\u4e9b\u5b9e\u4f8b\u4e0a\u3002 \u800c\u6570\u636e\u8bbf\u95ee\u503e\u659c\u7684\u4e3b\u8981\u539f\u56e0\u5c31\u662f \u6709\u70ed\u70b9\u6570\u636e\u5b58\u5728\uff0c\u5bfc\u81f4\u5927\u91cf\u8bbf\u95ee\u8bf7\u6c42\u96c6\u4e2d\u5230\u4e86\u70ed\u70b9\u6570\u636e\u6240\u5728\u7684\u5b9e\u4f8b\u4e0a\u3002 \u4e3a\u4e86\u5e94\u5bf9\u6570\u636e\u503e\u659c\u95ee\u9898\uff0c\u56db\u4e2a\u65b9\u6cd5\uff0c \u5982\u679c\u5df2\u7ecf\u53d1\u751f\u4e86\u6570\u636e\u503e\u659c\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6570\u636e\u8fc1\u79fb\u6765\u7f13\u89e3\u6570\u636e\u503e\u659c\u7684\u5f71\u54cd\u3002Redis Cluster \u548c Codis \u96c6\u7fa4\u90fd\u63d0\u4f9b\u4e86\u67e5\u770b Slot \u5206\u914d\u548c\u624b\u5de5\u8fc1\u79fb Slot \u7684\u547d\u4ee4\uff0c\u4f60\u53ef\u4ee5\u628a\u5b83\u4eec\u5e94\u7528\u8d77\u6765\u3002 \u5173\u4e8e\u96c6\u7fa4\u7684\u5b9e\u4f8b\u8d44\u6e90\u914d\u7f6e\uff0c\u4e00\u4e2a\u5c0f\u5efa\u8bae\uff1a \u5728\u6784\u5efa\u5207\u7247\u96c6\u7fa4\u65f6\uff0c\u5c3d\u91cf\u4f7f\u7528\u5927\u5c0f\u914d\u7f6e\u76f8\u540c\u7684\u5b9e\u4f8b\uff08\u4f8b\u5982\u5b9e\u4f8b\u5185\u5b58\u914d\u7f6e\u4fdd\u6301\u76f8\u540c\uff09\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u56e0\u5b9e\u4f8b\u8d44\u6e90\u4e0d\u5747\u8861\u800c\u5728\u4e0d\u540c\u5b9e\u4f8b\u4e0a\u5206\u914d\u4e0d\u540c\u6570\u91cf\u7684 Slot\u3002","title":"\u7b2c\u4e94\u8282 \u6570\u636e\u5206\u5e03\u4f18\u5316\u5e94\u5bf9\u6570\u636e\u503e\u659c"},{"location":"chap7/5redis_data_incline/#_1","text":"\u5728\u5207\u7247\u96c6\u7fa4\u4e2d\uff0c\u6570\u636e\u4f1a\u6309\u7167\u4e00\u5b9a\u7684\u5206\u5e03\u89c4\u5219\u5206\u6563\u5230\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\u4fdd\u5b58\u3002\u6bd4\u5982\uff0c\u5728\u4f7f\u7528 Redis Cluster \u6216 Codis \u65f6\uff0c \u6570\u636e\u90fd\u4f1a\u5148\u6309\u7167 CRC \u7b97\u6cd5\u7684\u8ba1\u7b97\u503c\u5bf9 Slot\uff08\u903b\u8f91\u69fd\uff09\u53d6\u6a21\uff0c\u540c\u65f6\uff0c\u6240\u6709\u7684 Slot \u53c8\u4f1a\u7531\u8fd0\u7ef4\u7ba1\u7406\u5458\u5206\u914d\u5230\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\u3002 \u5bb9\u6613\u5bfc\u81f4\u4e00\u4e2a\u95ee\u9898\uff1a\u6570\u636e\u503e\u659c \u6570\u636e\u503e\u659c\u6709\u4e24\u7c7b\u3002 \u6570\u636e\u91cf\u503e\u659c \uff1a\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5b9e\u4f8b\u4e0a\u7684\u6570\u636e\u5206\u5e03\u4e0d\u5747\u8861\uff0c \u67d0\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u6570\u636e\u7279\u522b\u591a \u3002 \u6570\u636e\u8bbf\u95ee\u503e\u659c \uff1a\u867d\u7136\u6bcf\u4e2a\u96c6\u7fa4\u5b9e\u4f8b\u4e0a\u7684\u6570\u636e\u91cf\u76f8\u5dee\u4e0d\u5927\uff0c \u4f46\u662f\u67d0\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u6570\u636e\u662f\u70ed\u70b9\u6570\u636e\uff0c\u88ab\u8bbf\u95ee\u5f97\u975e\u5e38\u9891\u7e41\u3002 \u5982\u679c\u53d1\u751f\u4e86\u6570\u636e\u503e\u659c\uff0c\u90a3\u4e48\u4fdd\u5b58\u4e86\u5927\u91cf\u6570\u636e\uff0c\u6216\u8005\u662f\u4fdd\u5b58\u4e86\u70ed\u70b9\u6570\u636e\u7684\u5b9e\u4f8b\u7684\u5904\u7406\u538b\u529b\u5c31\u4f1a\u589e\u5927\uff0c \u901f\u5ea6\u53d8\u6162\uff0c\u751a\u81f3\u8fd8\u53ef\u80fd\u4f1a\u5f15\u8d77\u8fd9\u4e2a\u5b9e\u4f8b\u7684\u5185\u5b58\u8d44\u6e90\u8017\u5c3d \uff0c\u4ece\u800c\u5d29\u6e83\u3002\u8fd9\u662f\u6211\u4eec\u5728\u5e94\u7528\u5207\u7247\u96c6\u7fa4\u65f6\u8981\u907f\u514d\u7684\u3002","title":"\u7b2c\u4e94\u8282 \u6570\u636e\u5206\u5e03\u4f18\u5316\u5e94\u5bf9\u6570\u636e\u503e\u659c"},{"location":"chap7/5redis_data_incline/#1","text":"\u5f53\u6570\u636e\u91cf\u503e\u659c\u53d1\u751f\u65f6\uff0c\u6570\u636e\u5728\u5207\u7247\u96c6\u7fa4\u7684\u591a\u4e2a\u5b9e\u4f8b\u4e0a\u5206\u5e03\u4e0d\u5747\u8861\uff0c\u5927\u91cf\u6570\u636e\u96c6\u4e2d\u5230\u4e86\u4e00\u4e2a\u6216\u51e0\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u90a3\u4e48\uff0c\u6570\u636e\u91cf\u503e\u659c\u662f\u600e\u4e48\u4ea7\u751f\u7684\u5462\uff1f\u8fd9\u4e3b\u8981\u6709\u4e09\u4e2a\u539f\u56e0\uff0c \u5206\u522b\u662f\u67d0\u4e2a\u5b9e\u4f8b\u4e0a\u4fdd\u5b58\u4e86 bigkey\u3001Slot \u5206\u914d\u4e0d\u5747\u8861\u4ee5\u53ca Hash Tag\u3002","title":"1\u3001\u6570\u636e\u91cf\u503e\u659c\u7684\u6210\u56e0\u548c\u5e94\u5bf9\u65b9\u6cd5"},{"location":"chap7/5redis_data_incline/#1-1-bigkey","text":"\u7b2c\u4e00\u4e2a\u539f\u56e0\u662f\uff0c\u67d0\u4e2a\u5b9e\u4f8b\u4e0a\u6b63\u597d\u4fdd\u5b58\u4e86 bigkey\u3002 bigkey \u7684 value \u503c\u5f88\u5927\uff08String \u7c7b\u578b\uff09\uff0c\u6216\u8005\u662f bigkey \u4fdd\u5b58\u4e86\u5927\u91cf\u96c6\u5408\u5143\u7d20\uff08\u96c6\u5408\u7c7b\u578b\uff09\uff0c\u4f1a\u5bfc\u81f4\u8fd9\u4e2a\u5b9e\u4f8b\u7684\u6570\u636e\u91cf\u589e\u52a0\uff0c\u5185\u5b58\u8d44\u6e90\u6d88\u8017\u4e5f\u76f8\u5e94\u589e\u52a0\u3002 bigkey \u7684\u64cd\u4f5c\u4e00\u822c\u90fd\u4f1a\u9020\u6210\u5b9e\u4f8b IO \u7ebf\u7a0b\u963b\u585e\uff0c\u5982\u679c bigkey \u7684\u8bbf\u95ee\u91cf\u6bd4\u8f83\u5927\uff0c\u5c31\u4f1a\u5f71\u54cd\u5230\u8fd9\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u5176\u5b83\u8bf7\u6c42\u88ab\u5904\u7406\u7684\u901f\u5ea6\u3002 \u4e3a\u4e86\u907f\u514d bigkey \u9020\u6210\u7684\u6570\u636e\u503e\u659c\uff0c\u4e00\u4e2a\u6839\u672c\u7684\u5e94\u5bf9\u65b9\u6cd5\u662f\uff0c \u5728\u4e1a\u52a1\u5c42\u751f\u6210\u6570\u636e\u65f6\uff0c\u8981\u5c3d\u91cf\u907f\u514d\u628a\u8fc7\u591a\u7684\u6570\u636e\u4fdd\u5b58\u5728\u540c\u4e00\u4e2a\u952e\u503c\u5bf9\u4e2d\u3002 \u5982\u679c bigkey \u6b63\u597d\u662f\u96c6\u5408\u7c7b\u578b\uff0c\u8fd8\u6709\u4e00\u4e2a\u65b9\u6cd5\uff0c\u5c31\u662f\u628a bigkey \u62c6\u5206\u6210\u5f88\u591a\u4e2a\u5c0f\u7684\u96c6\u5408\u7c7b\u578b\u6570\u636e\uff0c\u5206\u6563\u4fdd\u5b58\u5728\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\u3002 \u4e3e\u4e2a\u4f8b\u5b50\u3002 \u5047\u8bbe Hash \u7c7b\u578b\u96c6\u5408 user:info \u4fdd\u5b58\u4e86 100 \u4e07\u4e2a\u7528\u6237\u7684\u4fe1\u606f\uff0c\u662f\u4e00\u4e2a bigkey\u3002 \u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6309\u7167\u7528\u6237 ID \u7684\u8303\u56f4\uff0c\u628a\u8fd9\u4e2a\u96c6\u5408\u62c6\u5206\u6210 10 \u4e2a\u5c0f\u96c6\u5408\uff0c\u6bcf\u4e2a\u5c0f\u96c6\u5408\u53ea\u4fdd\u5b58 10 \u4e07\u4e2a\u7528\u6237\u7684\u4fe1\u606f\uff08\u4f8b\u5982\u5c0f\u96c6\u5408 1 \u4fdd\u5b58\u7684\u662f ID \u4ece 1 \u5230 10 \u4e07\u7684\u7528\u6237\u4fe1\u606f\uff0c\u5c0f\u96c6\u5408 2 \u4fdd\u5b58\u7684\u662f ID \u4ece 10 \u4e07\u96f6 1 \u5230 20 \u4e07\u7684\u7528\u6237\uff09\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u4e00\u4e2a bigkey \u5316\u6574\u4e3a\u96f6\u3001\u5206\u6563\u4fdd\u5b58\u4e86\uff0c\u907f\u514d\u4e86 bigkey \u7ed9\u5355\u4e2a\u5207\u7247\u5b9e\u4f8b\u5e26\u6765\u7684\u8bbf\u95ee\u538b\u529b\u3002","title":"1-1 bigkey \u5bfc\u81f4\u503e\u659c"},{"location":"chap7/5redis_data_incline/#1-2-slot","text":"\u5982\u679c\u96c6\u7fa4\u8fd0\u7ef4\u4eba\u5458\u6ca1\u6709\u5747\u8861\u5730\u5206\u914d Slot\uff0c\u5c31\u4f1a\u6709\u5927\u91cf\u7684\u6570\u636e\u88ab\u5206\u914d\u5230\u540c\u4e00\u4e2a Slot \u4e2d\uff0c\u800c\u540c\u4e00\u4e2a Slot \u53ea\u4f1a\u5728\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\u5206\u5e03\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\uff0c \u5927\u91cf\u6570\u636e\u88ab\u96c6\u4e2d\u5230\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u9020\u6210\u6570\u636e\u503e\u659c \u3002 \u4ee5 Redis Cluster \u4e3a\u4f8b\uff0c\u6765\u4ecb\u7ecd\u4e0b Slot \u5206\u914d\u4e0d\u5747\u8861\u7684\u60c5\u51b5\u3002 \u4f46\u662f\u5176\u5b9e\u5e76\u4e0d\u77e5\u9053\u6570\u636e\u548c Slot \u7684\u5bf9\u5e94\u5173\u7cfb\uff0c \u8fd9\u79cd\u505a\u6cd5\u5c31\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5927\u91cf\u6570\u636e\u6b63\u597d\u88ab\u6620\u5c04\u5230\u5b9e\u4f8b 1 \u4e0a\u7684 Slot\uff0c\u9020\u6210\u6570\u636e\u503e\u659c\uff0c\u7ed9\u5b9e\u4f8b 1 \u5e26\u6765\u8bbf\u95ee\u538b\u529b \u3002 \u4e3a\u4e86\u5e94\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd0\u7ef4\u89c4\u8303\uff0c\u5728\u5206\u914d\u4e4b\u524d\uff0c \u6211\u4eec\u5c31\u8981\u907f\u514d\u628a\u8fc7\u591a\u7684 Slot \u5206\u914d\u5230\u540c\u4e00\u4e2a\u5b9e\u4f8b \u3002 \u5982\u679c\u662f\u5df2\u7ecf\u5206\u914d\u597d Slot \u7684\u96c6\u7fa4\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u67e5\u770b Slot \u548c\u5b9e\u4f8b\u7684\u5177\u4f53\u5206\u914d\u5173\u7cfb \uff0c\u4ece\u800c\u5224\u65ad\u662f\u5426\u6709\u8fc7\u591a\u7684 Slot \u96c6\u4e2d\u5230\u4e86\u540c\u4e00\u4e2a\u5b9e\u4f8b\u3002\u5982\u679c\u6709\u7684\u8bdd\uff0c\u5c31\u5c06\u90e8\u5206 Slot \u8fc1\u79fb\u5230\u5176\u5b83\u5b9e\u4f8b\uff0c\u4ece\u800c\u907f\u514d\u6570\u636e\u503e\u659c\u3002","title":"1-2 Slot \u5206\u914d\u4e0d\u5747\u8861\u5bfc\u81f4\u503e\u659c"},{"location":"chap7/5redis_data_incline/#1-3-slot","text":"\u4e0d\u540c\u96c6\u7fa4\u4e0a\u67e5\u770b Slot \u5206\u914d\u60c5\u51b5\u7684\u65b9\u5f0f\u4e0d\u540c\uff1a \u5982\u679c\u662f Redis Cluster\uff0c\u5c31\u7528 CLUSTER SLOTS \u547d\u4ee4\uff1b\u5982\u679c\u662f Codis\uff0c\u5c31\u53ef\u4ee5\u5728 codis dashboard \u4e0a\u67e5\u770b \u3002 \u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u6267\u884c CLUSTER SLOTS \u547d\u4ee4\u67e5\u770b Slot \u5206\u914d\u60c5\u51b5\u3002 \u547d\u4ee4\u8fd4\u56de\u7ed3\u679c\u663e\u793a\uff0c Slot 0 \u5230 Slot 4095 \u88ab\u5206\u914d\u5230\u4e86\u5b9e\u4f8b 192.168.10.3 \u4e0a\uff0c\u800c Slot 12288 \u5230 Slot 16383 \u88ab\u5206\u914d\u5230\u4e86\u5b9e\u4f8b 192.168.10.5 \u4e0a\u3002 127.0.0.1:6379> cluster slots 1) 1) (integer) 0 2) (integer) 4095 3) 1) \"192.168.10.3\" 2) (integer) 6379 2) 1) (integer) 12288 2) (integer) 16383 3) 1) \"192.168.10.5\" 2) (integer) 6379 \u5982\u679c\u67d0\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\u6709\u592a\u591a\u7684 Slot\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u8fc1\u79fb\u547d\u4ee4\u628a\u8fd9\u4e9b Slot \u8fc1\u79fb\u5230\u5176\u5b83\u5b9e\u4f8b\u4e0a\u3002 \u5728 Redis Cluster \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 3 \u4e2a\u547d\u4ee4\u5b8c\u6210 Slot \u8fc1\u79fb\u3002 CLUSTER SETSLOT \uff1a\u4f7f\u7528\u4e0d\u540c\u7684\u9009\u9879\u8fdb\u884c\u4e09\u79cd\u8bbe\u7f6e\uff0c\u5206\u522b\u662f\u8bbe\u7f6e Slot \u8981\u8fc1\u5165\u7684\u76ee\u6807\u5b9e\u4f8b\uff0cSlot \u8981\u8fc1\u51fa\u7684\u6e90\u5b9e\u4f8b\uff0c\u4ee5\u53ca Slot \u6240\u5c5e\u7684\u5b9e\u4f8b\u3002 CLUSTER GETKEYSINSLOT \uff1a \u83b7\u53d6\u67d0\u4e2a Slot \u4e2d\u4e00\u5b9a\u6570\u91cf\u7684 key \u3002 MIGRATE \uff1a\u628a\u4e00\u4e2a key \u4ece\u6e90\u5b9e\u4f8b\u5b9e\u9645\u8fc1\u79fb\u5230\u76ee\u6807\u5b9e\u4f8b\u3002 \u5047\u8bbe\u6211\u4eec\u8981\u628a Slot 300 \u4ece\u6e90\u5b9e\u4f8b\uff08ID \u4e3a 3\uff09\u8fc1\u79fb\u5230\u76ee\u6807\u5b9e\u4f8b\uff08ID \u4e3a 5\uff09\uff0c\u90a3\u8981\u600e\u4e48\u505a\u5462\uff1f \u5b9e\u9645\u4e0a\uff0c\u53ef\u4ee5\u5206\u6210 5 \u6b65\u3002 \u7b2c 1 \u6b65\uff0c\u5148 \u5728\u76ee\u6807\u5b9e\u4f8b 5 \u4e0a\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4 \uff0c \u5c06 Slot 300 \u7684\u6e90\u5b9e\u4f8b\u8bbe\u7f6e\u4e3a\u5b9e\u4f8b 3\uff0c\u8868\u793a\u8981\u4ece\u5b9e\u4f8b 3 \u4e0a\u8fc1\u5165 Slot 300\u3002 CLUSTER SETSLOT 300 IMPORTING 3 \u7b2c 2 \u6b65\uff0c \u5728\u6e90\u5b9e\u4f8b 3 \u4e0a\uff0c\u6211\u4eec\u628a Slot 300 \u7684\u76ee\u6807\u5b9e\u4f8b\u8bbe\u7f6e\u4e3a 5\uff0c\u8fd9\u8868\u793a\uff0cSlot 300 \u8981\u8fc1\u51fa\u5230\u5b9e\u4f8b 5 \u4e0a \uff0c\u5982\u4e0b\u6240\u793a\uff1a CLUSTER SETSLOT 300 MIGRATING 5 \u7b2c 3 \u6b65\uff0c \u4ece Slot 300 \u4e2d\u83b7\u53d6 100 \u4e2a key\u3002\u56e0\u4e3a Slot \u4e2d\u7684 key \u6570\u91cf\u53ef\u80fd\u5f88\u591a\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5728\u5ba2\u6237\u7aef\u4e0a\u591a\u6b21\u6267\u884c\u4e0b\u9762\u7684\u8fd9\u6761\u547d\u4ee4\uff0c\u5206\u6279\u6b21\u83b7\u5f97\u5e76\u8fc1\u79fb key \u3002 CLUSTER GETKEYSINSLOT 300 100 \u7b2c 4 \u6b65\uff0c\u6211\u4eec\u628a\u521a\u624d\u83b7\u53d6\u7684 100 \u4e2a key \u4e2d\u7684 key1 \u8fc1\u79fb\u5230\u76ee\u6807\u5b9e\u4f8b 5 \u4e0a\uff08IP \u4e3a 192.168.10.5\uff09\uff0c \u540c\u65f6\u628a\u8981\u8fc1\u5165\u7684\u6570\u636e\u5e93\u8bbe\u7f6e\u4e3a 0 \u53f7\u6570\u636e\u5e93 \uff0c \u628a\u8fc1\u79fb\u7684\u8d85\u65f6\u65f6\u95f4\u8bbe\u7f6e\u4e3a timeout\u3002\u6211\u4eec\u91cd\u590d\u6267\u884c MIGRATE \u547d\u4ee4\uff0c\u628a 100 \u4e2a key \u90fd\u8fc1\u79fb\u5b8c \u3002 MIGRATE 192.168.10.5 6379 key1 0 timeout \u6700\u540e\uff0c\u6211\u4eec\u91cd\u590d\u6267\u884c\u7b2c 3 \u548c\u7b2c 4 \u6b65\uff0c\u76f4\u5230 Slot \u4e2d\u7684\u6240\u6709 key \u90fd\u8fc1\u79fb\u5b8c\u6210\u3002 \u4ece Redis 3.0.6 \u5f00\u59cb\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 KEYS \u9009\u9879\uff0c\u4e00\u6b21\u8fc1\u79fb\u591a\u4e2a key\uff08key1\u30012\u30013\uff09\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u5347\u8fc1\u79fb\u6548\u7387\u3002 MIGRATE 192.168.10.5 6379 \"\" 0 timeout KEYS key1 key2 key3 \u5bf9\u4e8e Codis \u6765\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u8fdb\u884c\u6570\u636e\u8fc1\u79fb\u3002\u5176\u4e2d\uff0c\u6211\u4eec\u628a dashboard \u7ec4\u4ef6\u7684\u8fde\u63a5\u5730\u5740\u8bbe\u7f6e\u4e3a ADDR\uff0c\u5e76\u4e14\u628a Slot 300 \u8fc1\u79fb\u5230\u7f16\u53f7\u4e3a 6 \u7684 codis server group \u4e0a\u3002 codis-admin --dashboard=ADDR -slot-action --create --sid=300 --gid=6 \u9664\u4e86 bigkey \u548c Slot \u5206\u914d\u4e0d\u5747\u8861\u4f1a\u5bfc\u81f4\u6570\u636e\u91cf\u503e\u659c\uff0c\u8fd8\u6709\u4e00\u4e2a\u5bfc\u81f4\u503e\u659c\u7684\u539f\u56e0\uff0c\u5c31\u662f\u4f7f\u7528\u4e86 Hash Tag \u8fdb\u884c\u6570\u636e\u5207\u7247\u3002","title":"1-3 Slot \u8fc1\u79fb"},{"location":"chap7/5redis_data_incline/#2hash-tag","text":"","title":"2\u3001Hash Tag \u5bfc\u81f4\u503e\u659c"},{"location":"chap7/5redis_data_incline/#2-1-hash-tag","text":"Hash Tag \u662f\u6307\u52a0\u5728\u952e\u503c\u5bf9 key \u4e2d\u7684\u4e00\u5bf9\u82b1\u62ec\u53f7 {} \u3002\u8fd9\u5bf9\u62ec\u53f7\u4f1a\u628a key \u7684\u4e00\u90e8\u5206\u62ec\u8d77\u6765\uff0c\u5ba2\u6237\u7aef\u5728\u8ba1\u7b97 key \u7684 CRC16 \u503c\u65f6\uff0c\u53ea\u5bf9 Hash Tag \u82b1\u62ec\u53f7\u4e2d\u7684 key \u5185\u5bb9\u8fdb\u884c\u8ba1\u7b97\u3002 \u5982\u679c\u6ca1\u7528 Hash Tag \u7684\u8bdd\uff0c\u5ba2\u6237\u7aef\u8ba1\u7b97\u6574\u4e2a key \u7684 CRC16 \u7684\u503c\u3002 Hash Tag \u662f\u6307\u52a0\u5728\u952e\u503c\u5bf9 key \u4e2d\u7684\u4e00\u5bf9\u82b1\u62ec\u53f7 {} \u3002\u8fd9\u5bf9\u62ec\u53f7\u4f1a\u628a key \u7684\u4e00\u90e8\u5206\u62ec\u8d77\u6765\uff0c\u5ba2\u6237\u7aef\u5728\u8ba1\u7b97 key \u7684 CRC16 \u503c\u65f6\uff0c\u53ea\u5bf9 Hash Tag \u82b1\u62ec\u53f7\u4e2d\u7684 key \u5185\u5bb9\u8fdb\u884c\u8ba1\u7b97\u3002\u5982\u679c\u6ca1\u7528 Hash Tag \u7684\u8bdd\uff0c\u5ba2\u6237\u7aef\u8ba1\u7b97\u6574\u4e2a key \u7684 CRC16 \u7684\u503c\u3002 \u4f7f\u7528 Hash Tag \u7684\u597d\u5904\u662f\uff0c\u5982\u679c\u4e0d\u540c key \u7684 Hash Tag \u5185\u5bb9\u90fd\u662f\u4e00\u6837\u7684\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e9b key \u5bf9\u5e94\u7684\u6570\u636e\u4f1a\u88ab\u6620\u5c04\u5230\u540c\u4e00\u4e2a Slot \u4e2d\uff0c\u540c\u65f6\u4f1a\u88ab\u5206\u914d\u5230\u540c\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\u3002 \u4f7f\u7528 Hash Tag \u540e\uff0c\u6570\u636e\u88ab\u6620\u5c04\u5230\u76f8\u540c Slot \u7684\u60c5\u51b5 \u5176\u4e2d\uff0c user:profile:{3231} \u548c user:order:{3231} \u7684 Hash Tag \u4e00\u6837\uff0c\u90fd\u662f 323 \uff0c\u5b83\u4eec\u7684 CRC16 \u8ba1\u7b97\u503c\u5bf9 16384 \u53d6\u6a21\u540e\u7684\u503c\u4e5f\u662f\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u5c31\u5bf9\u5e94\u6620\u5c04\u5230\u4e86\u76f8\u540c\u7684 Slot 1024 \u4e2d\u3002 user:profile:{5328} \u548c user:order:{5328} \u4e5f\u662f\u76f8\u540c\u7684\u6620\u5c04\u7ed3\u679c\u3002","title":"2-1 Hash Tag"},{"location":"chap7/5redis_data_incline/#2-2-hash-tag","text":"\u5176\u5b9e\uff0c\u5b83\u4e3b\u8981\u662f\u7528\u5728 Redis Cluster \u548c Codis \u4e2d\uff0c \u652f\u6301\u4e8b\u52a1\u64cd\u4f5c\u548c\u8303\u56f4\u67e5\u8be2 \u3002\u56e0\u4e3a Redis Cluster \u548c Codis \u672c\u8eab\u5e76\u4e0d\u652f\u6301\u8de8\u5b9e\u4f8b\u7684\u4e8b\u52a1\u64cd\u4f5c\u548c\u8303\u56f4\u67e5\u8be2\uff0c \u5f53\u4e1a\u52a1\u5e94\u7528\u6709\u8fd9\u4e9b\u9700\u6c42\u65f6\uff0c\u5c31\u53ea\u80fd\u5148\u628a\u8fd9\u4e9b\u6570\u636e\u8bfb\u53d6\u5230\u4e1a\u52a1\u5c42\u8fdb\u884c\u4e8b\u52a1\u5904\u7406\uff0c\u6216\u8005\u662f\u9010\u4e2a\u67e5\u8be2\u6bcf\u4e2a\u5b9e\u4f8b\uff0c\u5f97\u5230\u8303\u56f4\u67e5\u8be2\u7684\u7ed3\u679c\u3002 \u8fd9\u6837\u64cd\u4f5c\u8d77\u6765\u975e\u5e38\u9ebb\u70e6\uff0c\u6240\u4ee5\uff0c \u53ef\u4ee5\u4f7f\u7528 Hash Tag \u628a\u8981\u6267\u884c\u4e8b\u52a1\u64cd\u4f5c\u6216\u662f\u8303\u56f4\u67e5\u8be2\u7684\u6570\u636e\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u8fd9\u6837\u5c31\u80fd\u5f88\u8f7b\u677e\u5730\u5b9e\u73b0\u4e8b\u52a1\u6216\u8303\u56f4\u67e5\u8be2\u4e86\u3002","title":"2-2 Hash Tag \u4e00\u822c\u7528\u5728\u4ec0\u4e48\u573a\u666f\u5462\uff1f"},{"location":"chap7/5redis_data_incline/#2-3-hash-tag","text":"\u4f46\u662f\uff0c\u4f7f\u7528 Hash Tag \u7684\u6f5c\u5728\u95ee\u9898\uff0c\u5c31\u662f\u5927\u91cf\u7684\u6570\u636e\u53ef\u80fd\u88ab\u96c6\u4e2d\u5230\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u5bfc\u81f4\u6570\u636e\u503e\u659c\uff0c\u96c6\u7fa4\u4e2d\u7684\u8d1f\u8f7d\u4e0d\u5747\u8861\u3002\u90a3\u4e48\uff0c\u8be5\u600e\u4e48\u5e94\u5bf9\u8fd9\u79cd\u95ee\u9898\u5462\uff1f \u9700\u8981\u5728\u8303\u56f4\u67e5\u8be2\u3001\u4e8b\u52a1\u6267\u884c\u7684\u9700\u6c42\u548c\u6570\u636e\u503e\u659c\u5e26\u6765\u7684\u8bbf\u95ee\u538b\u529b\u4e4b\u95f4\uff0c\u8fdb\u884c\u53d6\u820d\u4e86\u3002 \u5982\u679c\u4f7f\u7528 Hash Tag \u8fdb\u884c\u5207\u7247\u7684\u6570\u636e\u4f1a\u5e26\u6765\u8f83\u5927\u7684\u8bbf\u95ee\u538b\u529b\uff0c\u5c31\u4f18\u5148\u8003\u8651\u907f\u514d\u6570\u636e\u503e\u659c\uff0c \u6700\u597d\u4e0d\u8981\u4f7f\u7528 Hash Tag \u8fdb\u884c\u6570\u636e\u5207\u7247\u3002\u56e0\u4e3a\u4e8b\u52a1\u548c\u8303\u56f4\u67e5\u8be2\u90fd\u8fd8\u53ef\u4ee5\u653e\u5728\u5ba2\u6237\u7aef\u6765\u6267\u884c\uff0c\u800c\u6570\u636e\u503e\u659c\u4f1a\u5bfc\u81f4\u5b9e\u4f8b\u4e0d\u7a33\u5b9a\uff0c\u9020\u6210\u670d\u52a1\u4e0d\u53ef\u7528\u3002","title":"2-3 Hash Tag \u5bfc\u81f4\u6570\u636e\u503e\u659c"},{"location":"chap7/5redis_data_incline/#3","text":"\u53d1\u751f\u6570\u636e\u8bbf\u95ee\u503e\u659c\u7684\u6839\u672c\u539f\u56e0\uff0c\u5c31\u662f\u5b9e\u4f8b\u4e0a\u5b58\u5728\u70ed\u70b9\u6570\u636e\uff08\u6bd4\u5982\u65b0\u95fb\u5e94\u7528\u4e2d\u7684\u70ed\u70b9\u65b0\u95fb\u5185\u5bb9\u3001\u7535\u5546\u4fc3\u9500\u6d3b\u52a8\u4e2d\u7684\u70ed\u95e8\u5546\u54c1\u4fe1\u606f\uff0c\u7b49\u7b49\uff09\u3002 \u4e00\u65e6\u70ed\u70b9\u6570\u636e\u88ab\u5b58\u5728\u4e86\u67d0\u4e2a\u5b9e\u4f8b\u4e2d\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e2a\u5b9e\u4f8b\u7684\u8bf7\u6c42\u8bbf\u95ee\u91cf\u5c31\u4f1a\u8fdc\u9ad8\u4e8e\u5176\u5b83\u5b9e\u4f8b\uff0c\u9762\u4e34\u5de8\u5927\u7684\u8bbf\u95ee\u538b\u529b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u8be5\u5982\u4f55\u5e94\u5bf9\u5462\uff1f \u548c\u6570\u636e\u91cf\u503e\u659c\u4e0d\u540c\uff0c\u70ed\u70b9\u6570\u636e\u901a\u5e38\u662f\u4e00\u4e2a\u6216\u51e0\u4e2a\u6570\u636e\uff0c\u6240\u4ee5\uff0c\u76f4\u63a5\u91cd\u65b0\u5206\u914d Slot \u5e76\u4e0d\u80fd\u89e3\u51b3\u70ed\u70b9\u6570\u636e\u7684\u95ee\u9898\u3002 \u901a\u5e38\u6765\u8bf4\uff0c\u70ed\u70b9\u6570\u636e\u4ee5\u670d\u52a1\u8bfb\u64cd\u4f5c\u4e3a\u4e3b\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c \u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u70ed\u70b9\u6570\u636e\u591a\u526f\u672c\u7684\u65b9\u6cd5\u6765\u5e94\u5bf9 \u3002 \u5177\u4f53\u505a\u6cd5\u662f\uff0c \u6211\u4eec\u628a\u70ed\u70b9\u6570\u636e\u590d\u5236\u591a\u4efd\uff0c\u5728\u6bcf\u4e00\u4e2a\u6570\u636e\u526f\u672c\u7684 key \u4e2d\u589e\u52a0\u4e00\u4e2a\u968f\u673a\u524d\u7f00\uff0c\u8ba9\u5b83\u548c\u5176\u5b83\u526f\u672c\u6570\u636e\u4e0d\u4f1a\u88ab\u6620\u5c04\u5230\u540c\u4e00\u4e2a Slot \u4e2d\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u70ed\u70b9\u6570\u636e\u65e2\u6709\u591a\u4e2a\u526f\u672c\u53ef\u4ee5\u540c\u65f6\u670d\u52a1\u8bf7\u6c42\uff0c\u540c\u65f6\uff0c\u8fd9\u4e9b\u526f\u672c\u6570\u636e\u7684 key \u53c8\u4e0d\u4e00\u6837\uff0c\u4f1a\u88ab\u6620\u5c04\u5230\u4e0d\u540c\u7684 Slot \u4e2d\u3002\u5728\u7ed9\u8fd9\u4e9b Slot \u5206\u914d\u5b9e\u4f8b\u65f6\uff0c\u6211\u4eec\u4e5f\u8981\u6ce8\u610f\u628a\u5b83\u4eec\u5206\u914d\u5230\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\uff0c\u90a3\u4e48\uff0c\u70ed\u70b9\u6570\u636e\u7684\u8bbf\u95ee\u538b\u529b\u5c31\u88ab\u5206\u6563\u5230\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\u4e86\u3002 \u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\u4e0b\uff0c \u70ed\u70b9\u6570\u636e\u591a\u526f\u672c\u65b9\u6cd5\u53ea\u80fd\u9488\u5bf9\u53ea\u8bfb\u7684\u70ed\u70b9\u6570\u636e\u3002\u5982\u679c\u70ed\u70b9\u6570\u636e\u662f\u6709\u8bfb\u6709\u5199\u7684\u8bdd\uff0c\u5c31\u4e0d\u9002\u5408\u91c7\u7528\u591a\u526f\u672c\u65b9\u6cd5\u4e86\uff0c\u56e0\u4e3a\u8981\u4fdd\u8bc1\u591a\u526f\u672c\u95f4\u7684\u6570\u636e\u4e00\u81f4\u6027\uff0c\u4f1a\u5e26\u6765\u989d\u5916\u7684\u5f00\u9500\u3002 \u5bf9\u4e8e\u6709\u8bfb\u6709\u5199\u7684\u70ed\u70b9\u6570\u636e\uff0c\u6211\u4eec\u5c31\u8981\u7ed9\u5b9e\u4f8b\u672c\u8eab\u589e\u52a0\u8d44\u6e90\u4e86\uff0c\u4f8b\u5982\u4f7f\u7528\u914d\u7f6e\u66f4\u9ad8\u7684\u673a\u5668\uff0c\u6765\u5e94\u5bf9\u5927\u91cf\u7684\u8bbf\u95ee\u538b\u529b\u3002","title":"3\u3001\u6570\u636e\u8bbf\u95ee\u503e\u659c\u7684\u6210\u56e0\u548c\u5e94\u5bf9\u65b9\u6cd5"},{"location":"chap7/5redis_data_incline/#4","text":"\u6570\u636e\u503e\u659c\u7684\u4e24\u79cd\u60c5\u51b5\uff1a\u6570\u636e\u91cf\u503e\u659c\u548c\u6570\u636e\u8bbf\u95ee\u503e\u659c\u3002 \u9020\u6210\u6570\u636e\u91cf\u503e\u659c\u7684\u539f\u56e0\u4e3b\u8981\u6709\u4e09\u4e2a\uff1a \u6570\u636e\u4e2d\u6709 bigkey\uff0c\u5bfc\u81f4\u67d0\u4e2a\u5b9e\u4f8b\u7684\u6570\u636e\u91cf\u589e\u52a0\uff1b Slot \u624b\u5de5\u5206\u914d\u4e0d\u5747\uff0c\u5bfc\u81f4\u67d0\u4e2a\u6216\u67d0\u4e9b\u5b9e\u4f8b\u4e0a\u6709\u5927\u91cf\u6570\u636e\uff1b \u4f7f\u7528\u4e86 Hash Tag\uff0c\u5bfc\u81f4\u6570\u636e\u96c6\u4e2d\u5230\u67d0\u4e9b\u5b9e\u4f8b\u4e0a\u3002 \u800c\u6570\u636e\u8bbf\u95ee\u503e\u659c\u7684\u4e3b\u8981\u539f\u56e0\u5c31\u662f \u6709\u70ed\u70b9\u6570\u636e\u5b58\u5728\uff0c\u5bfc\u81f4\u5927\u91cf\u8bbf\u95ee\u8bf7\u6c42\u96c6\u4e2d\u5230\u4e86\u70ed\u70b9\u6570\u636e\u6240\u5728\u7684\u5b9e\u4f8b\u4e0a\u3002 \u4e3a\u4e86\u5e94\u5bf9\u6570\u636e\u503e\u659c\u95ee\u9898\uff0c\u56db\u4e2a\u65b9\u6cd5\uff0c \u5982\u679c\u5df2\u7ecf\u53d1\u751f\u4e86\u6570\u636e\u503e\u659c\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6570\u636e\u8fc1\u79fb\u6765\u7f13\u89e3\u6570\u636e\u503e\u659c\u7684\u5f71\u54cd\u3002Redis Cluster \u548c Codis \u96c6\u7fa4\u90fd\u63d0\u4f9b\u4e86\u67e5\u770b Slot \u5206\u914d\u548c\u624b\u5de5\u8fc1\u79fb Slot \u7684\u547d\u4ee4\uff0c\u4f60\u53ef\u4ee5\u628a\u5b83\u4eec\u5e94\u7528\u8d77\u6765\u3002 \u5173\u4e8e\u96c6\u7fa4\u7684\u5b9e\u4f8b\u8d44\u6e90\u914d\u7f6e\uff0c\u4e00\u4e2a\u5c0f\u5efa\u8bae\uff1a \u5728\u6784\u5efa\u5207\u7247\u96c6\u7fa4\u65f6\uff0c\u5c3d\u91cf\u4f7f\u7528\u5927\u5c0f\u914d\u7f6e\u76f8\u540c\u7684\u5b9e\u4f8b\uff08\u4f8b\u5982\u5b9e\u4f8b\u5185\u5b58\u914d\u7f6e\u4fdd\u6301\u76f8\u540c\uff09\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u56e0\u5b9e\u4f8b\u8d44\u6e90\u4e0d\u5747\u8861\u800c\u5728\u4e0d\u540c\u5b9e\u4f8b\u4e0a\u5206\u914d\u4e0d\u540c\u6570\u91cf\u7684 Slot\u3002","title":"4\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap7/6redis_cluster_gossip/","text":"\u7b2c\u516d\u8282 \u9650\u5236Redis Cluster\u89c4\u6a21\u7684\u5173\u952e\u56e0\u7d20\uff1a\u901a\u4fe1\u5f00\u9500 Redis Cluster \u80fd\u4fdd\u5b58\u7684\u6570\u636e\u91cf\u4ee5\u53ca\u652f\u6491\u7684\u541e\u5410\u91cf\uff0c\u8ddf\u96c6\u7fa4\u7684\u5b9e\u4f8b\u89c4\u6a21\u5bc6\u5207\u76f8\u5173\u3002Redis \u5b98\u65b9\u7ed9\u51fa\u4e86 Redis Cluster \u7684\u89c4\u6a21\u4e0a\u9650\uff0c\u5c31\u662f\u4e00\u4e2a\u96c6\u7fa4\u8fd0\u884c 1000 \u4e2a\u5b9e\u4f8b\u3002 \u5176\u5b9e\uff0c\u8fd9\u91cc\u7684\u4e00\u4e2a\u5173\u952e\u56e0\u7d20\u5c31\u662f\uff0c\u5b9e\u4f8b\u95f4\u7684\u901a\u4fe1\u5f00\u9500\u4f1a\u968f\u7740\u5b9e\u4f8b\u89c4\u6a21\u589e\u52a0\u800c\u589e\u5927\uff0c \u5728\u96c6\u7fa4\u8d85\u8fc7\u4e00\u5b9a\u89c4\u6a21\u65f6\uff08\u6bd4\u5982 800 \u8282\u70b9\uff09\uff0c\u96c6\u7fa4\u541e\u5410\u91cf\u53cd\u800c\u4f1a\u4e0b\u964d \u3002\u6240\u4ee5\uff0c\u96c6\u7fa4\u7684\u5b9e\u9645\u89c4\u6a21\u4f1a\u53d7\u5230\u9650\u5236\u3002 \u901a\u8fc7\u5408\u7406\u7684\u914d\u7f6e\u6765\u6269\u5927 Redis Cluster \u7684\u89c4\u6a21\uff0c\u540c\u65f6\u4fdd\u6301\u9ad8\u541e\u5410\u91cf\u3002 1\u3001\u5b9e\u4f8b\u901a\u4fe1\u65b9\u6cd5\u548c\u5bf9\u96c6\u7fa4\u89c4\u6a21\u7684\u5f71\u54cd Redis Cluster \u5728\u8fd0\u884c\u65f6\uff0c \u6bcf\u4e2a\u5b9e\u4f8b\u4e0a\u90fd\u4f1a\u4fdd\u5b58 Slot \u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff08\u4e5f\u5c31\u662f Slot \u6620\u5c04\u8868 \uff09\uff0c\u4ee5\u53ca\u81ea\u8eab\u7684\u72b6\u6001\u4fe1\u606f\u3002 \u4e3a\u4e86\u8ba9\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e2a\u5b9e\u4f8b\u90fd\u77e5\u9053\u5176\u5b83\u6240\u6709\u5b9e\u4f8b\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u5b9e\u4f8b\u4e4b\u95f4\u4f1a\u6309\u7167\u4e00\u5b9a\u7684\u89c4\u5219\u8fdb\u884c\u901a\u4fe1\u3002\u8fd9\u4e2a\u89c4\u5219\u5c31\u662f Gossip \u534f\u8bae\u3002 1-1 Gossip \u534f\u8bae Gossip \u534f\u8bae\u7684\u5de5\u4f5c\u539f\u7406\u53ef\u4ee5\u6982\u62ec\u6210\u4e24\u70b9\u3002 \u4e00\u662f\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u4e4b\u95f4\u4f1a\u6309\u7167\u4e00\u5b9a\u7684\u9891\u7387\uff0c \u4ece\u96c6\u7fa4\u4e2d\u968f\u673a\u6311\u9009\u4e00\u4e9b\u5b9e\u4f8b\uff0c\u628a PING \u6d88\u606f\u53d1\u9001\u7ed9\u6311\u9009\u51fa\u6765\u7684\u5b9e\u4f8b\uff0c\u7528\u6765\u68c0\u6d4b\u8fd9\u4e9b\u5b9e\u4f8b\u662f\u5426\u5728\u7ebf\uff0c\u5e76\u4ea4\u6362\u5f7c\u6b64\u7684\u72b6\u6001\u4fe1\u606f \u3002 PING \u6d88\u606f\u4e2d\u5c01\u88c5\u4e86\u53d1\u9001\u6d88\u606f\u7684\u5b9e\u4f8b\u81ea\u8eab\u7684\u72b6\u6001\u4fe1\u606f\u3001\u90e8\u5206\u5176\u5b83\u5b9e\u4f8b\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u4ee5\u53ca Slot \u6620\u5c04\u8868 \u3002 \u4e8c\u662f\uff0c\u4e00\u4e2a\u5b9e\u4f8b\u5728\u63a5\u6536\u5230 PING \u6d88\u606f\u540e\uff0c\u4f1a\u7ed9\u53d1\u9001 PING \u6d88\u606f\u7684\u5b9e\u4f8b\uff0c\u53d1\u9001\u4e00\u4e2a PONG \u6d88\u606f\u3002PONG \u6d88\u606f\u5305\u542b\u7684\u5185\u5bb9\u548c PING \u6d88\u606f\u4e00\u6837\u3002 \u4e0b\u56fe\u663e\u793a\u4e86\u4e24\u4e2a\u5b9e\u4f8b\u95f4\u8fdb\u884c PING\u3001PONG \u6d88\u606f\u4f20\u9012\u7684\u60c5\u51b5\u3002 Gossip \u534f\u8bae\u53ef\u4ee5\u4fdd\u8bc1\u5728\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5b9e\u4f8b\u90fd\u80fd\u83b7\u5f97\u5176\u5b83\u6240\u6709\u5b9e\u4f8b\u7684\u72b6\u6001\u4fe1\u606f\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u6709\u65b0\u8282\u70b9\u52a0\u5165\u3001\u8282\u70b9\u6545\u969c\u3001Slot \u53d8\u66f4\u7b49\u4e8b\u4ef6\u53d1\u751f\uff0c\u5b9e\u4f8b\u95f4\u4e5f\u53ef\u4ee5\u901a\u8fc7 PING\u3001PONG \u6d88\u606f\u7684\u4f20\u9012\uff0c\u5b8c\u6210\u96c6\u7fa4\u72b6\u6001\u5728\u6bcf\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u540c\u6b65\u3002 \u5b9e\u4f8b\u95f4\u4f7f\u7528 Gossip \u534f\u8bae\u8fdb\u884c\u901a\u4fe1\u65f6\uff0c \u901a\u4fe1\u5f00\u9500\u53d7\u5230\u901a\u4fe1\u6d88\u606f\u5927\u5c0f\u548c\u901a\u4fe1\u9891\u7387\u8fd9\u4e24\u65b9\u9762\u7684\u5f71\u54cd \u6d88\u606f\u8d8a\u5927\u3001\u9891\u7387\u8d8a\u9ad8\uff0c\u76f8\u5e94\u7684\u901a\u4fe1\u5f00\u9500\u4e5f\u5c31\u8d8a\u5927\u3002\u5982\u679c\u60f3\u8981\u5b9e\u73b0\u9ad8\u6548\u7684\u901a\u4fe1\uff0c\u53ef\u4ee5\u4ece\u8fd9\u4e24\u65b9\u9762\u5165\u624b\u53bb\u8c03\u4f18\u3002 2\u3001Gossip \u6d88\u606f\u5927\u5c0f Redis \u5b9e\u4f8b\u53d1\u9001\u7684 PING \u6d88\u606f\u7684\u6d88\u606f\u4f53\u662f\u7531 clusterMsgDataGossip \u7ed3\u6784\u4f53\u7ec4\u6210\u7684\uff0c\u8fd9\u4e2a\u7ed3\u6784\u4f53\u7684\u5b9a\u4e49\u5982\u4e0b\u6240\u793a\uff1a typedef struct { char nodename[CLUSTER_NAMELEN]; //40\u5b57\u8282 uint32_t ping_sent; //4\u5b57\u8282 uint32_t pong_received; //4\u5b57\u8282 char ip[NET_IP_STR_LEN]; //46\u5b57\u8282 uint16_t port; //2\u5b57\u8282 uint16_t cport; //2\u5b57\u8282 uint16_t flags; //2\u5b57\u8282 uint32_t notused1; //4\u5b57\u8282 } clusterMsgDataGossip; \u5176\u4e2d\uff0c CLUSTER_NAMELEN \u548c NET_IP_STR_LEN \u7684\u503c\u5206\u522b\u662f 40 \u548c 46\uff0c\u5206\u522b\u8868\u793a\uff0c nodename \u548c ip \u8fd9\u4e24\u4e2a\u5b57\u8282\u6570\u7ec4\u7684\u957f\u5ea6\u662f 40 \u5b57\u8282\u548c 46 \u5b57\u8282\uff0c\u6211\u4eec\u518d\u628a\u7ed3\u6784\u4f53\u4e2d\u5176\u5b83\u4fe1\u606f\u7684\u5927\u5c0f\u52a0\u8d77\u6765\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a Gossip \u6d88\u606f\u7684\u5927\u5c0f\u4e86\uff0c\u5373 104 \u5b57\u8282\u3002 \u6bcf\u4e2a\u5b9e\u4f8b\u5728\u53d1\u9001\u4e00\u4e2a Gossip \u6d88\u606f\u65f6\uff0c\u9664\u4e86\u4f1a\u4f20\u9012\u81ea\u8eab\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u9ed8\u8ba4\u8fd8\u4f1a\u4f20\u9012\u96c6\u7fa4\u5341\u5206\u4e4b\u4e00\u5b9e\u4f8b\u7684\u72b6\u6001\u4fe1\u606f\u3002 \u6240\u4ee5\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5305\u542b\u4e86 1000 \u4e2a\u5b9e\u4f8b\u7684\u96c6\u7fa4\u6765\u8bf4\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u53d1\u9001\u4e00\u4e2a PING \u6d88\u606f\u65f6\uff0c\u4f1a\u5305\u542b 100 \u4e2a\u5b9e\u4f8b\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u603b\u7684\u6570\u636e\u91cf\u662f 10400 \u5b57\u8282\uff0c\u518d\u52a0\u4e0a\u53d1\u9001\u5b9e\u4f8b\u81ea\u8eab\u7684\u4fe1\u606f\uff0c\u4e00\u4e2a Gossip \u6d88\u606f\u5927\u7ea6\u662f 10KB\u3002 \u6b64\u5916\uff0c\u4e3a\u4e86\u8ba9 Slot \u6620\u5c04\u8868\u80fd\u591f\u5728\u4e0d\u540c\u5b9e\u4f8b\u95f4\u4f20\u64ad\uff0cPING \u6d88\u606f\u4e2d\u8fd8\u5e26\u6709\u4e00\u4e2a\u957f\u5ea6\u4e3a 16,384 bit \u7684 Bitmap\uff0c\u8fd9\u4e2a Bitmap \u7684\u6bcf\u4e00\u4f4d\u5bf9\u5e94\u4e86\u4e00\u4e2a Slot\uff0c\u5982\u679c\u67d0\u4e00\u4f4d\u4e3a 1\uff0c\u5c31\u8868\u793a\u8fd9\u4e2a Slot \u5c5e\u4e8e\u5f53\u524d\u5b9e\u4f8b\u3002\u8fd9\u4e2a Bitmap \u5927\u5c0f\u6362\u7b97\u6210\u5b57\u8282\u540e\uff0c\u662f 2KB\u3002 \u6211\u4eec\u628a\u5b9e\u4f8b\u72b6\u6001\u4fe1\u606f\u548c Slot \u5206\u914d\u4fe1\u606f\u76f8\u52a0\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a PING \u6d88\u606f\u7684\u5927\u5c0f\u4e86\uff0c\u5927\u7ea6\u662f 12KB\u3002 PONG \u6d88\u606f\u548c PING \u6d88\u606f\u7684\u5185\u5bb9\u4e00\u6837\uff0c\u6240\u4ee5\uff0c\u5b83\u7684\u5927\u5c0f\u5927\u7ea6\u662f 12KB\u3002\u6bcf\u4e2a\u5b9e\u4f8b\u53d1\u9001\u4e86 PING \u6d88\u606f\u540e\uff0c\u8fd8\u4f1a\u6536\u5230\u8fd4\u56de\u7684 PONG \u6d88\u606f\uff0c\u4e24\u4e2a\u6d88\u606f\u52a0\u8d77\u6765\u6709 24KB\u3002 \u867d\u7136\u4ece\u7edd\u5bf9\u503c\u4e0a\u6765\u770b\uff0c24KB \u5e76\u4e0d\u7b97\u5f88\u5927\uff0c\u4f46\u662f\uff0c\u5982\u679c\u5b9e\u4f8b\u6b63\u5e38\u5904\u7406\u7684\u5355\u4e2a\u8bf7\u6c42\u53ea\u6709\u51e0 KB \u7684\u8bdd\uff0c\u90a3\u4e48\uff0c\u5b9e\u4f8b\u4e3a\u4e86\u7ef4\u62a4\u96c6\u7fa4\u72b6\u6001\u4e00\u81f4\u4f20\u8f93\u7684 PING/PONG \u6d88\u606f\uff0c\u5c31\u8981\u6bd4\u5355\u4e2a\u4e1a\u52a1\u8bf7\u6c42\u5927\u4e86\u3002 \u800c\u4e14\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u90fd\u4f1a\u7ed9\u5176\u5b83\u5b9e\u4f8b\u53d1\u9001 PING/PONG \u6d88\u606f\u3002\u968f\u7740\u96c6\u7fa4\u89c4\u6a21\u589e\u52a0\uff0c\u8fd9\u4e9b\u5fc3\u8df3\u6d88\u606f\u7684\u6570\u91cf\u4e5f\u4f1a\u8d8a\u591a\uff0c\u4f1a\u5360\u636e\u4e00\u90e8\u5206\u96c6\u7fa4\u7684\u7f51\u7edc\u901a\u4fe1\u5e26\u5bbd\uff0c\u8fdb\u800c\u4f1a\u964d\u4f4e\u96c6\u7fa4\u670d\u52a1\u6b63\u5e38\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u541e\u5410\u91cf\u3002 \u9664\u4e86\u5fc3\u8df3\u6d88\u606f\u5927\u5c0f\u4f1a\u5f71\u54cd\u5230\u901a\u4fe1\u5f00\u9500\uff0c\u5982\u679c\u5b9e\u4f8b\u95f4\u901a\u4fe1\u975e\u5e38\u9891\u7e41\uff0c\u4e5f\u4f1a\u5bfc\u81f4\u96c6\u7fa4\u7f51\u7edc\u5e26\u5bbd\u88ab\u9891\u7e41\u5360\u7528 3\u3001\u5b9e\u4f8b\u95f4\u901a\u4fe1\u9891\u7387 Redis Cluster \u7684\u5b9e\u4f8b\u542f\u52a8\u540e\uff0c\u9ed8\u8ba4\u4f1a\u6bcf\u79d2\u4ece\u672c\u5730\u7684\u5b9e\u4f8b\u5217\u8868\u4e2d\u968f\u673a\u9009\u51fa 5 \u4e2a\u5b9e\u4f8b\uff0c\u518d\u4ece\u8fd9 5 \u4e2a\u5b9e\u4f8b\u4e2d\u627e\u51fa\u4e00\u4e2a\u6700\u4e45\u6ca1\u6709\u901a\u4fe1\u7684\u5b9e\u4f8b\uff0c\u628a PING \u6d88\u606f\u53d1\u9001\u7ed9\u8be5\u5b9e\u4f8b \u3002\u8fd9\u662f\u5b9e\u4f8b\u5468\u671f\u6027\u53d1\u9001 PING \u6d88\u606f\u7684\u57fa\u672c\u505a\u6cd5\u3002 \u6709\u4e00\u4e2a\u95ee\u9898\uff1a\u5b9e\u4f8b\u9009\u51fa\u6765\u7684\u8fd9\u4e2a\u6700\u4e45\u6ca1\u6709\u901a\u4fe1\u7684\u5b9e\u4f8b\uff0c\u6bd5\u7adf\u662f\u4ece\u968f\u673a\u9009\u51fa\u7684 5 \u4e2a\u5b9e\u4f8b\u4e2d\u6311\u9009\u7684\uff0c\u8fd9\u5e76\u4e0d\u80fd\u4fdd\u8bc1\u8fd9\u4e2a\u5b9e\u4f8b\u5c31\u4e00\u5b9a\u662f\u6574\u4e2a\u96c6\u7fa4\u4e2d\u6700\u4e45\u6ca1\u6709\u901a\u4fe1\u7684\u5b9e\u4f8b\u3002 \u8fd9\u6709\u53ef\u80fd\u4f1a\u51fa\u73b0\uff0c \u6709\u4e9b\u5b9e\u4f8b\u4e00\u76f4\u6ca1\u6709\u88ab\u53d1\u9001 PING \u6d88\u606f\uff0c\u5bfc\u81f4\u5b83\u4eec\u7ef4\u62a4\u7684\u96c6\u7fa4\u72b6\u6001\u5df2\u7ecf\u8fc7\u671f\u4e86\u3002 \u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c Redis Cluster \u7684\u5b9e\u4f8b\u4f1a\u6309\u7167\u6bcf 100ms \u4e00\u6b21\u7684\u9891\u7387\uff0c\u626b\u63cf\u672c\u5730\u7684\u5b9e\u4f8b\u5217\u8868\uff0c\u5982\u679c\u53d1\u73b0\u6709\u5b9e\u4f8b\u6700\u8fd1\u4e00\u6b21\u63a5\u6536 PONG \u6d88\u606f\u7684\u65f6\u95f4\uff0c\u5df2\u7ecf\u5927\u4e8e\u914d\u7f6e\u9879 cluster-node-timeout \u7684\u4e00\u534a\u4e86\uff08 cluster-node-timeout/2 \uff09\uff0c\u5c31\u4f1a\u7acb\u523b\u7ed9\u8be5\u5b9e\u4f8b\u53d1\u9001 PING \u6d88\u606f\uff0c\u66f4\u65b0\u8fd9\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u96c6\u7fa4\u72b6\u6001\u4fe1\u606f\u3002 \u5f53\u96c6\u7fa4\u89c4\u6a21\u6269\u5927\u4e4b\u540e\uff0c\u56e0\u4e3a\u7f51\u7edc\u62e5\u585e\u6216\u662f\u4e0d\u540c\u670d\u52a1\u5668\u95f4\u7684\u6d41\u91cf\u7ade\u4e89\uff0c\u4f1a\u5bfc\u81f4\u5b9e\u4f8b\u95f4\u7684\u7f51\u7edc\u901a\u4fe1\u5ef6\u8fdf\u589e\u52a0\u3002\u5982\u679c\u6709\u90e8\u5206\u5b9e\u4f8b\u65e0\u6cd5\u6536\u5230\u5176\u5b83\u5b9e\u4f8b\u53d1\u9001\u7684 PONG \u6d88\u606f\uff0c\u5c31\u4f1a\u5f15\u8d77\u5b9e\u4f8b\u4e4b\u95f4\u9891\u7e41\u5730\u53d1\u9001 PING \u6d88\u606f\uff0c\u8fd9\u53c8\u4f1a\u5bf9\u96c6\u7fa4\u7f51\u7edc\u901a\u4fe1\u5e26\u6765\u989d\u5916\u7684\u5f00\u9500\u4e86\u3002 \u603b\u7ed3\u4e0b\u5355\u5b9e\u4f8b\u6bcf\u79d2\u4f1a\u53d1\u9001\u7684 PING \u6d88\u606f\u6570\u91cf\uff0c\u5982\u4e0b\u6240\u793a\uff1a PING \u6d88\u606f\u53d1\u9001\u6570\u91cf = 1 + 10 * \u5b9e\u4f8b\u6570\uff08\u6700\u8fd1\u4e00\u6b21\u63a5\u6536 PONG \u6d88\u606f\u7684\u65f6\u95f4\u8d85\u51fa cluster-node-timeout/2\uff09 \u5176\u4e2d\uff0c 1 \u662f\u6307\u5355\u5b9e\u4f8b\u5e38\u89c4\u6309\u7167\u6bcf 1 \u79d2\u53d1\u9001\u4e00\u4e2a PING \u6d88\u606f\uff0c10 \u662f\u6307\u6bcf 1 \u79d2\u5185\u5b9e\u4f8b\u4f1a\u6267\u884c 10 \u6b21\u68c0\u67e5\uff0c\u6bcf\u6b21\u68c0\u67e5\u540e\u4f1a\u7ed9 PONG \u6d88\u606f\u8d85\u65f6\u7684\u5b9e\u4f8b\u53d1\u9001\u6d88\u606f \u3002 \u5206\u6790\u4e00\u4e0b\u5728\u8fd9\u79cd\u901a\u4fe1\u9891\u7387\u4e0b\uff0cPING \u6d88\u606f\u5360\u7528\u96c6\u7fa4\u5e26\u5bbd\u7684\u60c5\u51b5\u3002 \u5047\u8bbe\u5355\u4e2a\u5b9e\u4f8b\u68c0\u6d4b\u53d1\u73b0\uff0c\uff0c \u6bcf 100 \u6beb\u79d2\u6709 10 \u4e2a\u5b9e\u4f8b\u7684 PONG \u6d88\u606f\u63a5\u6536\u8d85\u65f6\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e2a\u5b9e\u4f8b\u6bcf\u79d2\u5c31\u4f1a\u53d1\u9001 101 \u4e2a PING \u6d88\u606f\uff0c\u7ea6\u5360 1.2MB/s \u5e26\u5bbd\u3002\u5982\u679c\u96c6\u7fa4\u4e2d\u6709 30 \u4e2a\u5b9e\u4f8b\u6309\u7167\u8fd9\u79cd\u9891\u7387\u53d1\u9001\u6d88\u606f\uff0c\u5c31\u4f1a\u5360\u7528 36MB/s \u5e26\u5bbd\uff0c\u8fd9\u5c31\u4f1a\u6324\u5360\u96c6\u7fa4\u4e2d\u7528\u4e8e\u670d\u52a1\u6b63\u5e38\u8bf7\u6c42\u7684\u5e26\u5bbd\u3002 4\u3001\u5982\u4f55\u964d\u4f4e\u5b9e\u4f8b\u95f4\u7684\u901a\u4fe1\u5f00\u9500\uff1f \u4e3a\u4e86\u964d\u4f4e\u5b9e\u4f8b\u95f4\u7684\u901a\u4fe1\u5f00\u9500 \uff0c \u4ece\u539f\u7406\u4e0a\u8bf4\uff0c\u53ef\u4ee5\u51cf\u5c0f\u5b9e\u4f8b\u4f20\u8f93\u7684\u6d88\u606f\u5927\u5c0f\uff08PING/PONG \u6d88\u606f\u3001Slot \u5206\u914d\u4fe1\u606f\uff09 \uff0c\u4f46\u662f\uff0c\u56e0\u4e3a\u96c6\u7fa4\u5b9e\u4f8b\u4f9d\u8d56 PING\u3001PONG \u6d88\u606f\u548c Slot \u5206\u914d\u4fe1\u606f\uff0c\u6765\u7ef4\u6301\u96c6\u7fa4\u72b6\u6001\u7684\u7edf\u4e00\uff0c\u4e00\u65e6\u51cf\u5c0f\u4e86\u4f20\u9012\u7684\u6d88\u606f\u5927\u5c0f\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5b9e\u4f8b\u95f4\u7684\u901a\u4fe1\u4fe1\u606f\u51cf\u5c11\uff0c \u4e0d\u5229\u4e8e\u96c6\u7fa4\u7ef4\u62a4\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u4e0d\u80fd\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f \u3002 \u6211\u4eec\u80fd\u4e0d\u80fd\u964d\u4f4e\u5b9e\u4f8b\u95f4\u53d1\u9001\u6d88\u606f\u7684\u9891\u7387\u5462\uff1f \u5b9e\u4f8b\u95f4\u53d1\u9001\u6d88\u606f\u7684\u9891\u7387\u6709\u4e24\u4e2a \u6bcf\u4e2a\u5b9e\u4f8b\u6bcf 1 \u79d2\u53d1\u9001\u4e00\u6761 PING \u6d88\u606f\u3002\u8fd9\u4e2a\u9891\u7387\u4e0d\u7b97\u9ad8\uff0c\u5982\u679c\u518d\u964d\u4f4e\u8be5\u9891\u7387\u7684\u8bdd\uff0c\u96c6\u7fa4\u4e2d\u5404\u5b9e\u4f8b\u7684\u72b6\u6001\u53ef\u80fd\u5c31\u6ca1\u529e\u6cd5\u53ca\u65f6\u4f20\u64ad\u4e86\u3002 \u6bcf\u4e2a\u5b9e\u4f8b\u6bcf 100 \u6beb\u79d2\u4f1a\u505a\u4e00\u6b21\u68c0\u6d4b\uff0c\u7ed9 PONG \u6d88\u606f\u63a5\u6536\u8d85\u8fc7 cluster-node-timeout/2 \u7684\u8282\u70b9\u53d1\u9001 PING \u6d88\u606f\u3002\u5b9e\u4f8b\u6309\u7167\u6bcf 100 \u6beb\u79d2\u8fdb\u884c\u68c0\u6d4b\u7684\u9891\u7387\uff0c\u662f Redis \u5b9e\u4f8b\u9ed8\u8ba4\u7684\u5468\u671f\u6027\u68c0\u67e5\u4efb\u52a1\u7684\u7edf\u4e00\u9891\u7387\uff0c\u6211\u4eec\u4e00\u822c\u4e0d\u9700\u8981\u4fee\u6539\u5b83\u3002 \u90a3\u4e48\uff0c\u5c31\u53ea\u6709 cluster-node-timeout \u8fd9\u4e2a\u914d\u7f6e\u9879\u53ef\u4ee5\u4fee\u6539\u4e86\u3002 4-1 \u4fee\u6539 cluster-node-timeout \u914d\u7f6e\u9879 cluster-node-timeout \u5b9a\u4e49\u4e86 \u96c6\u7fa4\u5b9e\u4f8b\u88ab\u5224\u65ad\u4e3a\u6545\u969c\u7684\u5fc3\u8df3\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u662f 15 \u79d2\u3002 \u5982\u679c cluster-node-timeout \u503c\u6bd4\u8f83\u5c0f\uff0c\u90a3\u4e48\uff0c\u5728\u5927\u89c4\u6a21\u96c6\u7fa4\u4e2d\uff0c\u5c31\u4f1a\u6bd4\u8f83\u9891\u7e41\u5730\u51fa\u73b0 PONG \u6d88\u606f\u63a5\u6536\u8d85\u65f6\u7684\u60c5\u51b5\uff0c\u4ece\u800c\u5bfc\u81f4\u5b9e\u4f8b\u6bcf\u79d2\u8981\u6267\u884c 10 \u6b21\u201c\u7ed9 PONG \u6d88\u606f\u8d85\u65f6\u7684\u5b9e\u4f8b\u53d1\u9001 PING \u6d88\u606f\u201d\u8fd9\u4e2a\u64cd\u4f5c\u3002 \u6240\u4ee5\uff0c \u4e3a\u4e86\u907f\u514d\u8fc7\u591a\u7684\u5fc3\u8df3\u6d88\u606f\u6324\u5360\u96c6\u7fa4\u5e26\u5bbd\uff0c\u6211\u4eec\u53ef\u4ee5\u8c03\u5927 cluster-node-timeout \u503c\uff0c\u6bd4\u5982\u8bf4\u8c03\u5927\u5230 20 \u79d2\u6216 25 \u79d2\u3002 \u8fd9\u6837\u4e00\u6765\uff0c PONG \u6d88\u606f\u63a5\u6536\u8d85\u65f6\u7684\u60c5\u51b5\u5c31\u4f1a\u6709\u6240\u7f13\u89e3\uff0c\u5355\u5b9e\u4f8b\u4e5f\u4e0d\u7528\u9891\u7e41\u5730\u6bcf\u79d2\u6267\u884c 10 \u6b21\u5fc3\u8df3\u53d1\u9001\u64cd\u4f5c\u4e86\u3002 \u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u4e0d\u8981\u628a cluster-node-timeout \u8c03\u5f97\u592a\u5927\uff0c\u5426\u5219\uff0c\u5982\u679c\u5b9e\u4f8b\u771f\u7684\u53d1\u751f\u4e86\u6545\u969c\uff0c\u6211\u4eec\u5c31\u9700\u8981\u7b49\u5f85 cluster-node-timeout \u65f6\u957f\u540e\uff0c\u624d\u80fd\u68c0\u6d4b\u51fa\u8fd9\u4e2a\u6545\u969c\uff0c\u8fd9\u53c8\u4f1a\u5bfc\u81f4\u5b9e\u9645\u7684\u6545\u969c\u6062\u590d\u65f6\u95f4\u88ab\u5ef6\u957f\uff0c\u4f1a\u5f71\u54cd\u5230\u96c6\u7fa4\u670d\u52a1\u7684\u6b63\u5e38\u4f7f\u7528\u3002 \u4e3a\u4e86\u9a8c\u8bc1\u8c03\u6574 cluster-node-timeout \u503c\u540e\uff0c\u662f\u5426\u80fd\u51cf\u5c11\u5fc3\u8df3\u6d88\u606f\u5360\u7528\u7684\u96c6\u7fa4\u7f51\u7edc\u5e26\u5bbd\uff0c\u6211\u7ed9\u4f60\u63d0\u4e2a\u5c0f\u5efa\u8bae\uff1a \u4f60\u53ef\u4ee5\u5728\u8c03\u6574 cluster-node-timeout \u503c\u7684\u524d\u540e\uff0c\u4f7f\u7528 tcpdump \u547d\u4ee4\u6293\u53d6\u5b9e\u4f8b\u53d1\u9001\u5fc3\u8df3\u4fe1\u606f\u7f51\u7edc\u5305\u7684\u60c5\u51b5\u3002 \u4f8b\u5982\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u6293\u53d6\u5230 192.168.10.3 \u673a\u5668\u4e0a\u7684\u5b9e\u4f8b\u4ece 16379 \u7aef\u53e3\u53d1\u9001\u7684\u5fc3\u8df3\u7f51\u7edc\u5305\uff0c\u5e76\u628a\u7f51\u7edc\u5305\u7684\u5185\u5bb9\u4fdd\u5b58\u5230 r1.cap \u6587\u4ef6\u4e2d tcpdump host 192.168.10.3 port 16379 -i \u7f51\u5361\u540d -w /tmp/r1.cap \u901a\u8fc7\u5206\u6790\u7f51\u7edc\u5305\u7684\u6570\u91cf\u548c\u5927\u5c0f\uff0c\u5c31\u53ef\u4ee5\u5224\u65ad\u8c03\u6574 cluster-node-timeout \u503c\u524d\u540e\uff0c\u5fc3\u8df3\u6d88\u606f\u5360\u7528\u7684\u5e26\u5bbd\u60c5\u51b5\u4e86\u3002 5\u3001\u672c\u8282\u5c0f\u7ed3 Redis Cluster \u5b9e\u4f8b\u95f4\u4ee5 Gossip \u534f\u8bae\u8fdb\u884c\u901a\u4fe1\u7684\u673a\u5236\u3002Redis Cluster \u8fd0\u884c\u65f6\uff0c\u5404\u5b9e\u4f8b\u95f4\u9700\u8981\u901a\u8fc7 PING\u3001PONG \u6d88\u606f\u8fdb\u884c\u4fe1\u606f\u4ea4\u6362\uff0c\u8fd9\u4e9b\u5fc3\u8df3\u6d88\u606f\u5305\u542b\u4e86\u5f53\u524d\u5b9e\u4f8b\u548c\u90e8\u5206\u5176\u5b83\u5b9e\u4f8b\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u4ee5\u53ca Slot \u5206\u914d\u4fe1\u606f\u3002\u8fd9\u79cd\u901a\u4fe1\u673a\u5236\u6709\u52a9\u4e8e Redis Cluster \u4e2d\u7684\u6240\u6709\u5b9e\u4f8b\u90fd\u62e5\u6709\u5b8c\u6574\u7684\u96c6\u7fa4\u72b6\u6001\u4fe1\u606f\u3002 \u4f46\u662f\uff0c\u968f\u7740\u96c6\u7fa4\u89c4\u6a21\u7684\u589e\u52a0\uff0c\u5b9e\u4f8b\u95f4\u7684\u901a\u4fe1\u91cf\u4e5f\u4f1a\u589e\u52a0\u3002 \u5982\u679c\u6211\u4eec\u76f2\u76ee\u5730\u5bf9 Redis Cluster \u8fdb\u884c\u6269\u5bb9\uff0c\u5c31\u53ef\u80fd\u4f1a\u9047\u5230\u96c6\u7fa4\u6027\u80fd\u53d8\u6162\u7684\u60c5\u51b5\u3002\u8fd9\u662f\u56e0\u4e3a\uff0c\u96c6\u7fa4\u4e2d\u5927\u89c4\u6a21\u7684\u5b9e\u4f8b\u95f4\u5fc3\u8df3\u6d88\u606f\u4f1a\u6324\u5360\u96c6\u7fa4\u5904\u7406\u6b63\u5e38\u8bf7\u6c42\u7684\u5e26\u5bbd\u3002\u800c\u4e14\uff0c\u6709\u4e9b\u5b9e\u4f8b\u53ef\u80fd\u56e0\u4e3a\u7f51\u7edc\u62e5\u585e\u5bfc\u81f4\u65e0\u6cd5\u53ca\u65f6\u6536\u5230 PONG \u6d88\u606f\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u5728\u8fd0\u884c\u65f6\u4f1a\u5468\u671f\u6027\u5730\uff08\u6bcf\u79d2 10 \u6b21\uff09\u68c0\u6d4b\u662f\u5426\u6709\u8fd9\u79cd\u60c5\u51b5\u53d1\u751f\uff0c\u4e00\u65e6\u53d1\u751f\uff0c\u5c31\u4f1a\u7acb\u5373\u7ed9\u8fd9\u4e9b PONG \u6d88\u606f\u8d85\u65f6\u7684\u5b9e\u4f8b\u53d1\u9001\u5fc3\u8df3\u6d88\u606f \u3002 \u96c6\u7fa4\u89c4\u6a21\u8d8a\u5927\uff0c\u7f51\u7edc\u62e5\u585e\u7684\u6982\u7387\u5c31\u8d8a\u9ad8\uff0c\u76f8\u5e94\u7684\uff0cPONG \u6d88\u606f\u8d85\u65f6\u7684\u53d1\u751f\u6982\u7387\u5c31\u8d8a\u9ad8\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u96c6\u7fa4\u4e2d\u6709\u5927\u91cf\u7684\u5fc3\u8df3\u6d88\u606f\uff0c\u5f71\u54cd\u96c6\u7fa4\u670d\u52a1\u6b63\u5e38\u8bf7\u6c42\u3002 \u5efa\u8bae\uff0c\u867d\u7136\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574 cluster-node-timeout \u914d\u7f6e\u9879\u51cf\u5c11\u5fc3\u8df3\u6d88\u606f\u7684\u5360\u7528\u5e26\u5bbd\u60c5\u51b5\uff0c\u4f46\u662f\uff0c \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u5982\u679c\u4e0d\u662f\u7279\u522b\u9700\u8981\u5927\u5bb9\u91cf\u96c6\u7fa4\uff0c\u6211\u5efa\u8bae\u4f60\u628a Redis Cluster \u7684\u89c4\u6a21\u63a7\u5236\u5728 400~500 \u4e2a\u5b9e\u4f8b\u3002 \u5047\u8bbe\u5355\u4e2a\u5b9e\u4f8b\u6bcf\u79d2\u80fd\u652f\u6491 8 \u4e07\u8bf7\u6c42\u64cd\u4f5c\uff088 \u4e07 QPS\uff09\uff0c\u6bcf\u4e2a\u4e3b\u5b9e\u4f8b\u914d\u7f6e 1 \u4e2a\u4ece\u5b9e\u4f8b\uff0c\u90a3\u4e48\uff0c 400~ 500 \u4e2a\u5b9e\u4f8b\u53ef\u652f\u6301 1600 \u4e07~2000 \u4e07 QPS\uff08 200/250 \u4e2a\u4e3b\u5b9e\u4f8b *8 \u4e07 QPS=1600/2000 \u4e07 QPS \uff09\uff0c\u8fd9\u4e2a\u541e\u5410\u91cf\u6027\u80fd\u53ef\u4ee5\u6ee1\u8db3\u4e0d\u5c11\u4e1a\u52a1\u5e94\u7528\u7684\u9700\u6c42\u3002","title":"\u7b2c\u516d\u8282 \u9650\u5236Redis Cluster\u89c4\u6a21\u7684\u5173\u952e\u56e0\u7d20:\u901a\u4fe1\u5f00\u9500"},{"location":"chap7/6redis_cluster_gossip/#redis-cluster","text":"Redis Cluster \u80fd\u4fdd\u5b58\u7684\u6570\u636e\u91cf\u4ee5\u53ca\u652f\u6491\u7684\u541e\u5410\u91cf\uff0c\u8ddf\u96c6\u7fa4\u7684\u5b9e\u4f8b\u89c4\u6a21\u5bc6\u5207\u76f8\u5173\u3002Redis \u5b98\u65b9\u7ed9\u51fa\u4e86 Redis Cluster \u7684\u89c4\u6a21\u4e0a\u9650\uff0c\u5c31\u662f\u4e00\u4e2a\u96c6\u7fa4\u8fd0\u884c 1000 \u4e2a\u5b9e\u4f8b\u3002 \u5176\u5b9e\uff0c\u8fd9\u91cc\u7684\u4e00\u4e2a\u5173\u952e\u56e0\u7d20\u5c31\u662f\uff0c\u5b9e\u4f8b\u95f4\u7684\u901a\u4fe1\u5f00\u9500\u4f1a\u968f\u7740\u5b9e\u4f8b\u89c4\u6a21\u589e\u52a0\u800c\u589e\u5927\uff0c \u5728\u96c6\u7fa4\u8d85\u8fc7\u4e00\u5b9a\u89c4\u6a21\u65f6\uff08\u6bd4\u5982 800 \u8282\u70b9\uff09\uff0c\u96c6\u7fa4\u541e\u5410\u91cf\u53cd\u800c\u4f1a\u4e0b\u964d \u3002\u6240\u4ee5\uff0c\u96c6\u7fa4\u7684\u5b9e\u9645\u89c4\u6a21\u4f1a\u53d7\u5230\u9650\u5236\u3002 \u901a\u8fc7\u5408\u7406\u7684\u914d\u7f6e\u6765\u6269\u5927 Redis Cluster \u7684\u89c4\u6a21\uff0c\u540c\u65f6\u4fdd\u6301\u9ad8\u541e\u5410\u91cf\u3002","title":"\u7b2c\u516d\u8282 \u9650\u5236Redis Cluster\u89c4\u6a21\u7684\u5173\u952e\u56e0\u7d20\uff1a\u901a\u4fe1\u5f00\u9500"},{"location":"chap7/6redis_cluster_gossip/#1","text":"Redis Cluster \u5728\u8fd0\u884c\u65f6\uff0c \u6bcf\u4e2a\u5b9e\u4f8b\u4e0a\u90fd\u4f1a\u4fdd\u5b58 Slot \u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u5173\u7cfb\uff08\u4e5f\u5c31\u662f Slot \u6620\u5c04\u8868 \uff09\uff0c\u4ee5\u53ca\u81ea\u8eab\u7684\u72b6\u6001\u4fe1\u606f\u3002 \u4e3a\u4e86\u8ba9\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e2a\u5b9e\u4f8b\u90fd\u77e5\u9053\u5176\u5b83\u6240\u6709\u5b9e\u4f8b\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u5b9e\u4f8b\u4e4b\u95f4\u4f1a\u6309\u7167\u4e00\u5b9a\u7684\u89c4\u5219\u8fdb\u884c\u901a\u4fe1\u3002\u8fd9\u4e2a\u89c4\u5219\u5c31\u662f Gossip \u534f\u8bae\u3002","title":"1\u3001\u5b9e\u4f8b\u901a\u4fe1\u65b9\u6cd5\u548c\u5bf9\u96c6\u7fa4\u89c4\u6a21\u7684\u5f71\u54cd"},{"location":"chap7/6redis_cluster_gossip/#1-1-gossip","text":"Gossip \u534f\u8bae\u7684\u5de5\u4f5c\u539f\u7406\u53ef\u4ee5\u6982\u62ec\u6210\u4e24\u70b9\u3002 \u4e00\u662f\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u4e4b\u95f4\u4f1a\u6309\u7167\u4e00\u5b9a\u7684\u9891\u7387\uff0c \u4ece\u96c6\u7fa4\u4e2d\u968f\u673a\u6311\u9009\u4e00\u4e9b\u5b9e\u4f8b\uff0c\u628a PING \u6d88\u606f\u53d1\u9001\u7ed9\u6311\u9009\u51fa\u6765\u7684\u5b9e\u4f8b\uff0c\u7528\u6765\u68c0\u6d4b\u8fd9\u4e9b\u5b9e\u4f8b\u662f\u5426\u5728\u7ebf\uff0c\u5e76\u4ea4\u6362\u5f7c\u6b64\u7684\u72b6\u6001\u4fe1\u606f \u3002 PING \u6d88\u606f\u4e2d\u5c01\u88c5\u4e86\u53d1\u9001\u6d88\u606f\u7684\u5b9e\u4f8b\u81ea\u8eab\u7684\u72b6\u6001\u4fe1\u606f\u3001\u90e8\u5206\u5176\u5b83\u5b9e\u4f8b\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u4ee5\u53ca Slot \u6620\u5c04\u8868 \u3002 \u4e8c\u662f\uff0c\u4e00\u4e2a\u5b9e\u4f8b\u5728\u63a5\u6536\u5230 PING \u6d88\u606f\u540e\uff0c\u4f1a\u7ed9\u53d1\u9001 PING \u6d88\u606f\u7684\u5b9e\u4f8b\uff0c\u53d1\u9001\u4e00\u4e2a PONG \u6d88\u606f\u3002PONG \u6d88\u606f\u5305\u542b\u7684\u5185\u5bb9\u548c PING \u6d88\u606f\u4e00\u6837\u3002 \u4e0b\u56fe\u663e\u793a\u4e86\u4e24\u4e2a\u5b9e\u4f8b\u95f4\u8fdb\u884c PING\u3001PONG \u6d88\u606f\u4f20\u9012\u7684\u60c5\u51b5\u3002 Gossip \u534f\u8bae\u53ef\u4ee5\u4fdd\u8bc1\u5728\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5b9e\u4f8b\u90fd\u80fd\u83b7\u5f97\u5176\u5b83\u6240\u6709\u5b9e\u4f8b\u7684\u72b6\u6001\u4fe1\u606f\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u6709\u65b0\u8282\u70b9\u52a0\u5165\u3001\u8282\u70b9\u6545\u969c\u3001Slot \u53d8\u66f4\u7b49\u4e8b\u4ef6\u53d1\u751f\uff0c\u5b9e\u4f8b\u95f4\u4e5f\u53ef\u4ee5\u901a\u8fc7 PING\u3001PONG \u6d88\u606f\u7684\u4f20\u9012\uff0c\u5b8c\u6210\u96c6\u7fa4\u72b6\u6001\u5728\u6bcf\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u540c\u6b65\u3002 \u5b9e\u4f8b\u95f4\u4f7f\u7528 Gossip \u534f\u8bae\u8fdb\u884c\u901a\u4fe1\u65f6\uff0c \u901a\u4fe1\u5f00\u9500\u53d7\u5230\u901a\u4fe1\u6d88\u606f\u5927\u5c0f\u548c\u901a\u4fe1\u9891\u7387\u8fd9\u4e24\u65b9\u9762\u7684\u5f71\u54cd \u6d88\u606f\u8d8a\u5927\u3001\u9891\u7387\u8d8a\u9ad8\uff0c\u76f8\u5e94\u7684\u901a\u4fe1\u5f00\u9500\u4e5f\u5c31\u8d8a\u5927\u3002\u5982\u679c\u60f3\u8981\u5b9e\u73b0\u9ad8\u6548\u7684\u901a\u4fe1\uff0c\u53ef\u4ee5\u4ece\u8fd9\u4e24\u65b9\u9762\u5165\u624b\u53bb\u8c03\u4f18\u3002","title":"1-1 Gossip \u534f\u8bae"},{"location":"chap7/6redis_cluster_gossip/#2gossip","text":"Redis \u5b9e\u4f8b\u53d1\u9001\u7684 PING \u6d88\u606f\u7684\u6d88\u606f\u4f53\u662f\u7531 clusterMsgDataGossip \u7ed3\u6784\u4f53\u7ec4\u6210\u7684\uff0c\u8fd9\u4e2a\u7ed3\u6784\u4f53\u7684\u5b9a\u4e49\u5982\u4e0b\u6240\u793a\uff1a typedef struct { char nodename[CLUSTER_NAMELEN]; //40\u5b57\u8282 uint32_t ping_sent; //4\u5b57\u8282 uint32_t pong_received; //4\u5b57\u8282 char ip[NET_IP_STR_LEN]; //46\u5b57\u8282 uint16_t port; //2\u5b57\u8282 uint16_t cport; //2\u5b57\u8282 uint16_t flags; //2\u5b57\u8282 uint32_t notused1; //4\u5b57\u8282 } clusterMsgDataGossip; \u5176\u4e2d\uff0c CLUSTER_NAMELEN \u548c NET_IP_STR_LEN \u7684\u503c\u5206\u522b\u662f 40 \u548c 46\uff0c\u5206\u522b\u8868\u793a\uff0c nodename \u548c ip \u8fd9\u4e24\u4e2a\u5b57\u8282\u6570\u7ec4\u7684\u957f\u5ea6\u662f 40 \u5b57\u8282\u548c 46 \u5b57\u8282\uff0c\u6211\u4eec\u518d\u628a\u7ed3\u6784\u4f53\u4e2d\u5176\u5b83\u4fe1\u606f\u7684\u5927\u5c0f\u52a0\u8d77\u6765\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a Gossip \u6d88\u606f\u7684\u5927\u5c0f\u4e86\uff0c\u5373 104 \u5b57\u8282\u3002 \u6bcf\u4e2a\u5b9e\u4f8b\u5728\u53d1\u9001\u4e00\u4e2a Gossip \u6d88\u606f\u65f6\uff0c\u9664\u4e86\u4f1a\u4f20\u9012\u81ea\u8eab\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u9ed8\u8ba4\u8fd8\u4f1a\u4f20\u9012\u96c6\u7fa4\u5341\u5206\u4e4b\u4e00\u5b9e\u4f8b\u7684\u72b6\u6001\u4fe1\u606f\u3002 \u6240\u4ee5\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5305\u542b\u4e86 1000 \u4e2a\u5b9e\u4f8b\u7684\u96c6\u7fa4\u6765\u8bf4\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u53d1\u9001\u4e00\u4e2a PING \u6d88\u606f\u65f6\uff0c\u4f1a\u5305\u542b 100 \u4e2a\u5b9e\u4f8b\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u603b\u7684\u6570\u636e\u91cf\u662f 10400 \u5b57\u8282\uff0c\u518d\u52a0\u4e0a\u53d1\u9001\u5b9e\u4f8b\u81ea\u8eab\u7684\u4fe1\u606f\uff0c\u4e00\u4e2a Gossip \u6d88\u606f\u5927\u7ea6\u662f 10KB\u3002 \u6b64\u5916\uff0c\u4e3a\u4e86\u8ba9 Slot \u6620\u5c04\u8868\u80fd\u591f\u5728\u4e0d\u540c\u5b9e\u4f8b\u95f4\u4f20\u64ad\uff0cPING \u6d88\u606f\u4e2d\u8fd8\u5e26\u6709\u4e00\u4e2a\u957f\u5ea6\u4e3a 16,384 bit \u7684 Bitmap\uff0c\u8fd9\u4e2a Bitmap \u7684\u6bcf\u4e00\u4f4d\u5bf9\u5e94\u4e86\u4e00\u4e2a Slot\uff0c\u5982\u679c\u67d0\u4e00\u4f4d\u4e3a 1\uff0c\u5c31\u8868\u793a\u8fd9\u4e2a Slot \u5c5e\u4e8e\u5f53\u524d\u5b9e\u4f8b\u3002\u8fd9\u4e2a Bitmap \u5927\u5c0f\u6362\u7b97\u6210\u5b57\u8282\u540e\uff0c\u662f 2KB\u3002 \u6211\u4eec\u628a\u5b9e\u4f8b\u72b6\u6001\u4fe1\u606f\u548c Slot \u5206\u914d\u4fe1\u606f\u76f8\u52a0\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a PING \u6d88\u606f\u7684\u5927\u5c0f\u4e86\uff0c\u5927\u7ea6\u662f 12KB\u3002 PONG \u6d88\u606f\u548c PING \u6d88\u606f\u7684\u5185\u5bb9\u4e00\u6837\uff0c\u6240\u4ee5\uff0c\u5b83\u7684\u5927\u5c0f\u5927\u7ea6\u662f 12KB\u3002\u6bcf\u4e2a\u5b9e\u4f8b\u53d1\u9001\u4e86 PING \u6d88\u606f\u540e\uff0c\u8fd8\u4f1a\u6536\u5230\u8fd4\u56de\u7684 PONG \u6d88\u606f\uff0c\u4e24\u4e2a\u6d88\u606f\u52a0\u8d77\u6765\u6709 24KB\u3002 \u867d\u7136\u4ece\u7edd\u5bf9\u503c\u4e0a\u6765\u770b\uff0c24KB \u5e76\u4e0d\u7b97\u5f88\u5927\uff0c\u4f46\u662f\uff0c\u5982\u679c\u5b9e\u4f8b\u6b63\u5e38\u5904\u7406\u7684\u5355\u4e2a\u8bf7\u6c42\u53ea\u6709\u51e0 KB \u7684\u8bdd\uff0c\u90a3\u4e48\uff0c\u5b9e\u4f8b\u4e3a\u4e86\u7ef4\u62a4\u96c6\u7fa4\u72b6\u6001\u4e00\u81f4\u4f20\u8f93\u7684 PING/PONG \u6d88\u606f\uff0c\u5c31\u8981\u6bd4\u5355\u4e2a\u4e1a\u52a1\u8bf7\u6c42\u5927\u4e86\u3002 \u800c\u4e14\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u90fd\u4f1a\u7ed9\u5176\u5b83\u5b9e\u4f8b\u53d1\u9001 PING/PONG \u6d88\u606f\u3002\u968f\u7740\u96c6\u7fa4\u89c4\u6a21\u589e\u52a0\uff0c\u8fd9\u4e9b\u5fc3\u8df3\u6d88\u606f\u7684\u6570\u91cf\u4e5f\u4f1a\u8d8a\u591a\uff0c\u4f1a\u5360\u636e\u4e00\u90e8\u5206\u96c6\u7fa4\u7684\u7f51\u7edc\u901a\u4fe1\u5e26\u5bbd\uff0c\u8fdb\u800c\u4f1a\u964d\u4f4e\u96c6\u7fa4\u670d\u52a1\u6b63\u5e38\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u541e\u5410\u91cf\u3002 \u9664\u4e86\u5fc3\u8df3\u6d88\u606f\u5927\u5c0f\u4f1a\u5f71\u54cd\u5230\u901a\u4fe1\u5f00\u9500\uff0c\u5982\u679c\u5b9e\u4f8b\u95f4\u901a\u4fe1\u975e\u5e38\u9891\u7e41\uff0c\u4e5f\u4f1a\u5bfc\u81f4\u96c6\u7fa4\u7f51\u7edc\u5e26\u5bbd\u88ab\u9891\u7e41\u5360\u7528","title":"2\u3001Gossip \u6d88\u606f\u5927\u5c0f"},{"location":"chap7/6redis_cluster_gossip/#3","text":"Redis Cluster \u7684\u5b9e\u4f8b\u542f\u52a8\u540e\uff0c\u9ed8\u8ba4\u4f1a\u6bcf\u79d2\u4ece\u672c\u5730\u7684\u5b9e\u4f8b\u5217\u8868\u4e2d\u968f\u673a\u9009\u51fa 5 \u4e2a\u5b9e\u4f8b\uff0c\u518d\u4ece\u8fd9 5 \u4e2a\u5b9e\u4f8b\u4e2d\u627e\u51fa\u4e00\u4e2a\u6700\u4e45\u6ca1\u6709\u901a\u4fe1\u7684\u5b9e\u4f8b\uff0c\u628a PING \u6d88\u606f\u53d1\u9001\u7ed9\u8be5\u5b9e\u4f8b \u3002\u8fd9\u662f\u5b9e\u4f8b\u5468\u671f\u6027\u53d1\u9001 PING \u6d88\u606f\u7684\u57fa\u672c\u505a\u6cd5\u3002 \u6709\u4e00\u4e2a\u95ee\u9898\uff1a\u5b9e\u4f8b\u9009\u51fa\u6765\u7684\u8fd9\u4e2a\u6700\u4e45\u6ca1\u6709\u901a\u4fe1\u7684\u5b9e\u4f8b\uff0c\u6bd5\u7adf\u662f\u4ece\u968f\u673a\u9009\u51fa\u7684 5 \u4e2a\u5b9e\u4f8b\u4e2d\u6311\u9009\u7684\uff0c\u8fd9\u5e76\u4e0d\u80fd\u4fdd\u8bc1\u8fd9\u4e2a\u5b9e\u4f8b\u5c31\u4e00\u5b9a\u662f\u6574\u4e2a\u96c6\u7fa4\u4e2d\u6700\u4e45\u6ca1\u6709\u901a\u4fe1\u7684\u5b9e\u4f8b\u3002 \u8fd9\u6709\u53ef\u80fd\u4f1a\u51fa\u73b0\uff0c \u6709\u4e9b\u5b9e\u4f8b\u4e00\u76f4\u6ca1\u6709\u88ab\u53d1\u9001 PING \u6d88\u606f\uff0c\u5bfc\u81f4\u5b83\u4eec\u7ef4\u62a4\u7684\u96c6\u7fa4\u72b6\u6001\u5df2\u7ecf\u8fc7\u671f\u4e86\u3002 \u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c Redis Cluster \u7684\u5b9e\u4f8b\u4f1a\u6309\u7167\u6bcf 100ms \u4e00\u6b21\u7684\u9891\u7387\uff0c\u626b\u63cf\u672c\u5730\u7684\u5b9e\u4f8b\u5217\u8868\uff0c\u5982\u679c\u53d1\u73b0\u6709\u5b9e\u4f8b\u6700\u8fd1\u4e00\u6b21\u63a5\u6536 PONG \u6d88\u606f\u7684\u65f6\u95f4\uff0c\u5df2\u7ecf\u5927\u4e8e\u914d\u7f6e\u9879 cluster-node-timeout \u7684\u4e00\u534a\u4e86\uff08 cluster-node-timeout/2 \uff09\uff0c\u5c31\u4f1a\u7acb\u523b\u7ed9\u8be5\u5b9e\u4f8b\u53d1\u9001 PING \u6d88\u606f\uff0c\u66f4\u65b0\u8fd9\u4e2a\u5b9e\u4f8b\u4e0a\u7684\u96c6\u7fa4\u72b6\u6001\u4fe1\u606f\u3002 \u5f53\u96c6\u7fa4\u89c4\u6a21\u6269\u5927\u4e4b\u540e\uff0c\u56e0\u4e3a\u7f51\u7edc\u62e5\u585e\u6216\u662f\u4e0d\u540c\u670d\u52a1\u5668\u95f4\u7684\u6d41\u91cf\u7ade\u4e89\uff0c\u4f1a\u5bfc\u81f4\u5b9e\u4f8b\u95f4\u7684\u7f51\u7edc\u901a\u4fe1\u5ef6\u8fdf\u589e\u52a0\u3002\u5982\u679c\u6709\u90e8\u5206\u5b9e\u4f8b\u65e0\u6cd5\u6536\u5230\u5176\u5b83\u5b9e\u4f8b\u53d1\u9001\u7684 PONG \u6d88\u606f\uff0c\u5c31\u4f1a\u5f15\u8d77\u5b9e\u4f8b\u4e4b\u95f4\u9891\u7e41\u5730\u53d1\u9001 PING \u6d88\u606f\uff0c\u8fd9\u53c8\u4f1a\u5bf9\u96c6\u7fa4\u7f51\u7edc\u901a\u4fe1\u5e26\u6765\u989d\u5916\u7684\u5f00\u9500\u4e86\u3002 \u603b\u7ed3\u4e0b\u5355\u5b9e\u4f8b\u6bcf\u79d2\u4f1a\u53d1\u9001\u7684 PING \u6d88\u606f\u6570\u91cf\uff0c\u5982\u4e0b\u6240\u793a\uff1a PING \u6d88\u606f\u53d1\u9001\u6570\u91cf = 1 + 10 * \u5b9e\u4f8b\u6570\uff08\u6700\u8fd1\u4e00\u6b21\u63a5\u6536 PONG \u6d88\u606f\u7684\u65f6\u95f4\u8d85\u51fa cluster-node-timeout/2\uff09 \u5176\u4e2d\uff0c 1 \u662f\u6307\u5355\u5b9e\u4f8b\u5e38\u89c4\u6309\u7167\u6bcf 1 \u79d2\u53d1\u9001\u4e00\u4e2a PING \u6d88\u606f\uff0c10 \u662f\u6307\u6bcf 1 \u79d2\u5185\u5b9e\u4f8b\u4f1a\u6267\u884c 10 \u6b21\u68c0\u67e5\uff0c\u6bcf\u6b21\u68c0\u67e5\u540e\u4f1a\u7ed9 PONG \u6d88\u606f\u8d85\u65f6\u7684\u5b9e\u4f8b\u53d1\u9001\u6d88\u606f \u3002 \u5206\u6790\u4e00\u4e0b\u5728\u8fd9\u79cd\u901a\u4fe1\u9891\u7387\u4e0b\uff0cPING \u6d88\u606f\u5360\u7528\u96c6\u7fa4\u5e26\u5bbd\u7684\u60c5\u51b5\u3002 \u5047\u8bbe\u5355\u4e2a\u5b9e\u4f8b\u68c0\u6d4b\u53d1\u73b0\uff0c\uff0c \u6bcf 100 \u6beb\u79d2\u6709 10 \u4e2a\u5b9e\u4f8b\u7684 PONG \u6d88\u606f\u63a5\u6536\u8d85\u65f6\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e2a\u5b9e\u4f8b\u6bcf\u79d2\u5c31\u4f1a\u53d1\u9001 101 \u4e2a PING \u6d88\u606f\uff0c\u7ea6\u5360 1.2MB/s \u5e26\u5bbd\u3002\u5982\u679c\u96c6\u7fa4\u4e2d\u6709 30 \u4e2a\u5b9e\u4f8b\u6309\u7167\u8fd9\u79cd\u9891\u7387\u53d1\u9001\u6d88\u606f\uff0c\u5c31\u4f1a\u5360\u7528 36MB/s \u5e26\u5bbd\uff0c\u8fd9\u5c31\u4f1a\u6324\u5360\u96c6\u7fa4\u4e2d\u7528\u4e8e\u670d\u52a1\u6b63\u5e38\u8bf7\u6c42\u7684\u5e26\u5bbd\u3002","title":"3\u3001\u5b9e\u4f8b\u95f4\u901a\u4fe1\u9891\u7387"},{"location":"chap7/6redis_cluster_gossip/#4","text":"\u4e3a\u4e86\u964d\u4f4e\u5b9e\u4f8b\u95f4\u7684\u901a\u4fe1\u5f00\u9500 \uff0c \u4ece\u539f\u7406\u4e0a\u8bf4\uff0c\u53ef\u4ee5\u51cf\u5c0f\u5b9e\u4f8b\u4f20\u8f93\u7684\u6d88\u606f\u5927\u5c0f\uff08PING/PONG \u6d88\u606f\u3001Slot \u5206\u914d\u4fe1\u606f\uff09 \uff0c\u4f46\u662f\uff0c\u56e0\u4e3a\u96c6\u7fa4\u5b9e\u4f8b\u4f9d\u8d56 PING\u3001PONG \u6d88\u606f\u548c Slot \u5206\u914d\u4fe1\u606f\uff0c\u6765\u7ef4\u6301\u96c6\u7fa4\u72b6\u6001\u7684\u7edf\u4e00\uff0c\u4e00\u65e6\u51cf\u5c0f\u4e86\u4f20\u9012\u7684\u6d88\u606f\u5927\u5c0f\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5b9e\u4f8b\u95f4\u7684\u901a\u4fe1\u4fe1\u606f\u51cf\u5c11\uff0c \u4e0d\u5229\u4e8e\u96c6\u7fa4\u7ef4\u62a4\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u4e0d\u80fd\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f \u3002 \u6211\u4eec\u80fd\u4e0d\u80fd\u964d\u4f4e\u5b9e\u4f8b\u95f4\u53d1\u9001\u6d88\u606f\u7684\u9891\u7387\u5462\uff1f \u5b9e\u4f8b\u95f4\u53d1\u9001\u6d88\u606f\u7684\u9891\u7387\u6709\u4e24\u4e2a \u6bcf\u4e2a\u5b9e\u4f8b\u6bcf 1 \u79d2\u53d1\u9001\u4e00\u6761 PING \u6d88\u606f\u3002\u8fd9\u4e2a\u9891\u7387\u4e0d\u7b97\u9ad8\uff0c\u5982\u679c\u518d\u964d\u4f4e\u8be5\u9891\u7387\u7684\u8bdd\uff0c\u96c6\u7fa4\u4e2d\u5404\u5b9e\u4f8b\u7684\u72b6\u6001\u53ef\u80fd\u5c31\u6ca1\u529e\u6cd5\u53ca\u65f6\u4f20\u64ad\u4e86\u3002 \u6bcf\u4e2a\u5b9e\u4f8b\u6bcf 100 \u6beb\u79d2\u4f1a\u505a\u4e00\u6b21\u68c0\u6d4b\uff0c\u7ed9 PONG \u6d88\u606f\u63a5\u6536\u8d85\u8fc7 cluster-node-timeout/2 \u7684\u8282\u70b9\u53d1\u9001 PING \u6d88\u606f\u3002\u5b9e\u4f8b\u6309\u7167\u6bcf 100 \u6beb\u79d2\u8fdb\u884c\u68c0\u6d4b\u7684\u9891\u7387\uff0c\u662f Redis \u5b9e\u4f8b\u9ed8\u8ba4\u7684\u5468\u671f\u6027\u68c0\u67e5\u4efb\u52a1\u7684\u7edf\u4e00\u9891\u7387\uff0c\u6211\u4eec\u4e00\u822c\u4e0d\u9700\u8981\u4fee\u6539\u5b83\u3002 \u90a3\u4e48\uff0c\u5c31\u53ea\u6709 cluster-node-timeout \u8fd9\u4e2a\u914d\u7f6e\u9879\u53ef\u4ee5\u4fee\u6539\u4e86\u3002","title":"4\u3001\u5982\u4f55\u964d\u4f4e\u5b9e\u4f8b\u95f4\u7684\u901a\u4fe1\u5f00\u9500\uff1f"},{"location":"chap7/6redis_cluster_gossip/#4-1-cluster-node-timeout","text":"\u914d\u7f6e\u9879 cluster-node-timeout \u5b9a\u4e49\u4e86 \u96c6\u7fa4\u5b9e\u4f8b\u88ab\u5224\u65ad\u4e3a\u6545\u969c\u7684\u5fc3\u8df3\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u662f 15 \u79d2\u3002 \u5982\u679c cluster-node-timeout \u503c\u6bd4\u8f83\u5c0f\uff0c\u90a3\u4e48\uff0c\u5728\u5927\u89c4\u6a21\u96c6\u7fa4\u4e2d\uff0c\u5c31\u4f1a\u6bd4\u8f83\u9891\u7e41\u5730\u51fa\u73b0 PONG \u6d88\u606f\u63a5\u6536\u8d85\u65f6\u7684\u60c5\u51b5\uff0c\u4ece\u800c\u5bfc\u81f4\u5b9e\u4f8b\u6bcf\u79d2\u8981\u6267\u884c 10 \u6b21\u201c\u7ed9 PONG \u6d88\u606f\u8d85\u65f6\u7684\u5b9e\u4f8b\u53d1\u9001 PING \u6d88\u606f\u201d\u8fd9\u4e2a\u64cd\u4f5c\u3002 \u6240\u4ee5\uff0c \u4e3a\u4e86\u907f\u514d\u8fc7\u591a\u7684\u5fc3\u8df3\u6d88\u606f\u6324\u5360\u96c6\u7fa4\u5e26\u5bbd\uff0c\u6211\u4eec\u53ef\u4ee5\u8c03\u5927 cluster-node-timeout \u503c\uff0c\u6bd4\u5982\u8bf4\u8c03\u5927\u5230 20 \u79d2\u6216 25 \u79d2\u3002 \u8fd9\u6837\u4e00\u6765\uff0c PONG \u6d88\u606f\u63a5\u6536\u8d85\u65f6\u7684\u60c5\u51b5\u5c31\u4f1a\u6709\u6240\u7f13\u89e3\uff0c\u5355\u5b9e\u4f8b\u4e5f\u4e0d\u7528\u9891\u7e41\u5730\u6bcf\u79d2\u6267\u884c 10 \u6b21\u5fc3\u8df3\u53d1\u9001\u64cd\u4f5c\u4e86\u3002 \u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u4e0d\u8981\u628a cluster-node-timeout \u8c03\u5f97\u592a\u5927\uff0c\u5426\u5219\uff0c\u5982\u679c\u5b9e\u4f8b\u771f\u7684\u53d1\u751f\u4e86\u6545\u969c\uff0c\u6211\u4eec\u5c31\u9700\u8981\u7b49\u5f85 cluster-node-timeout \u65f6\u957f\u540e\uff0c\u624d\u80fd\u68c0\u6d4b\u51fa\u8fd9\u4e2a\u6545\u969c\uff0c\u8fd9\u53c8\u4f1a\u5bfc\u81f4\u5b9e\u9645\u7684\u6545\u969c\u6062\u590d\u65f6\u95f4\u88ab\u5ef6\u957f\uff0c\u4f1a\u5f71\u54cd\u5230\u96c6\u7fa4\u670d\u52a1\u7684\u6b63\u5e38\u4f7f\u7528\u3002 \u4e3a\u4e86\u9a8c\u8bc1\u8c03\u6574 cluster-node-timeout \u503c\u540e\uff0c\u662f\u5426\u80fd\u51cf\u5c11\u5fc3\u8df3\u6d88\u606f\u5360\u7528\u7684\u96c6\u7fa4\u7f51\u7edc\u5e26\u5bbd\uff0c\u6211\u7ed9\u4f60\u63d0\u4e2a\u5c0f\u5efa\u8bae\uff1a \u4f60\u53ef\u4ee5\u5728\u8c03\u6574 cluster-node-timeout \u503c\u7684\u524d\u540e\uff0c\u4f7f\u7528 tcpdump \u547d\u4ee4\u6293\u53d6\u5b9e\u4f8b\u53d1\u9001\u5fc3\u8df3\u4fe1\u606f\u7f51\u7edc\u5305\u7684\u60c5\u51b5\u3002 \u4f8b\u5982\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u6293\u53d6\u5230 192.168.10.3 \u673a\u5668\u4e0a\u7684\u5b9e\u4f8b\u4ece 16379 \u7aef\u53e3\u53d1\u9001\u7684\u5fc3\u8df3\u7f51\u7edc\u5305\uff0c\u5e76\u628a\u7f51\u7edc\u5305\u7684\u5185\u5bb9\u4fdd\u5b58\u5230 r1.cap \u6587\u4ef6\u4e2d tcpdump host 192.168.10.3 port 16379 -i \u7f51\u5361\u540d -w /tmp/r1.cap \u901a\u8fc7\u5206\u6790\u7f51\u7edc\u5305\u7684\u6570\u91cf\u548c\u5927\u5c0f\uff0c\u5c31\u53ef\u4ee5\u5224\u65ad\u8c03\u6574 cluster-node-timeout \u503c\u524d\u540e\uff0c\u5fc3\u8df3\u6d88\u606f\u5360\u7528\u7684\u5e26\u5bbd\u60c5\u51b5\u4e86\u3002","title":"4-1 \u4fee\u6539cluster-node-timeout"},{"location":"chap7/6redis_cluster_gossip/#5","text":"Redis Cluster \u5b9e\u4f8b\u95f4\u4ee5 Gossip \u534f\u8bae\u8fdb\u884c\u901a\u4fe1\u7684\u673a\u5236\u3002Redis Cluster \u8fd0\u884c\u65f6\uff0c\u5404\u5b9e\u4f8b\u95f4\u9700\u8981\u901a\u8fc7 PING\u3001PONG \u6d88\u606f\u8fdb\u884c\u4fe1\u606f\u4ea4\u6362\uff0c\u8fd9\u4e9b\u5fc3\u8df3\u6d88\u606f\u5305\u542b\u4e86\u5f53\u524d\u5b9e\u4f8b\u548c\u90e8\u5206\u5176\u5b83\u5b9e\u4f8b\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u4ee5\u53ca Slot \u5206\u914d\u4fe1\u606f\u3002\u8fd9\u79cd\u901a\u4fe1\u673a\u5236\u6709\u52a9\u4e8e Redis Cluster \u4e2d\u7684\u6240\u6709\u5b9e\u4f8b\u90fd\u62e5\u6709\u5b8c\u6574\u7684\u96c6\u7fa4\u72b6\u6001\u4fe1\u606f\u3002 \u4f46\u662f\uff0c\u968f\u7740\u96c6\u7fa4\u89c4\u6a21\u7684\u589e\u52a0\uff0c\u5b9e\u4f8b\u95f4\u7684\u901a\u4fe1\u91cf\u4e5f\u4f1a\u589e\u52a0\u3002 \u5982\u679c\u6211\u4eec\u76f2\u76ee\u5730\u5bf9 Redis Cluster \u8fdb\u884c\u6269\u5bb9\uff0c\u5c31\u53ef\u80fd\u4f1a\u9047\u5230\u96c6\u7fa4\u6027\u80fd\u53d8\u6162\u7684\u60c5\u51b5\u3002\u8fd9\u662f\u56e0\u4e3a\uff0c\u96c6\u7fa4\u4e2d\u5927\u89c4\u6a21\u7684\u5b9e\u4f8b\u95f4\u5fc3\u8df3\u6d88\u606f\u4f1a\u6324\u5360\u96c6\u7fa4\u5904\u7406\u6b63\u5e38\u8bf7\u6c42\u7684\u5e26\u5bbd\u3002\u800c\u4e14\uff0c\u6709\u4e9b\u5b9e\u4f8b\u53ef\u80fd\u56e0\u4e3a\u7f51\u7edc\u62e5\u585e\u5bfc\u81f4\u65e0\u6cd5\u53ca\u65f6\u6536\u5230 PONG \u6d88\u606f\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u5728\u8fd0\u884c\u65f6\u4f1a\u5468\u671f\u6027\u5730\uff08\u6bcf\u79d2 10 \u6b21\uff09\u68c0\u6d4b\u662f\u5426\u6709\u8fd9\u79cd\u60c5\u51b5\u53d1\u751f\uff0c\u4e00\u65e6\u53d1\u751f\uff0c\u5c31\u4f1a\u7acb\u5373\u7ed9\u8fd9\u4e9b PONG \u6d88\u606f\u8d85\u65f6\u7684\u5b9e\u4f8b\u53d1\u9001\u5fc3\u8df3\u6d88\u606f \u3002 \u96c6\u7fa4\u89c4\u6a21\u8d8a\u5927\uff0c\u7f51\u7edc\u62e5\u585e\u7684\u6982\u7387\u5c31\u8d8a\u9ad8\uff0c\u76f8\u5e94\u7684\uff0cPONG \u6d88\u606f\u8d85\u65f6\u7684\u53d1\u751f\u6982\u7387\u5c31\u8d8a\u9ad8\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u96c6\u7fa4\u4e2d\u6709\u5927\u91cf\u7684\u5fc3\u8df3\u6d88\u606f\uff0c\u5f71\u54cd\u96c6\u7fa4\u670d\u52a1\u6b63\u5e38\u8bf7\u6c42\u3002 \u5efa\u8bae\uff0c\u867d\u7136\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574 cluster-node-timeout \u914d\u7f6e\u9879\u51cf\u5c11\u5fc3\u8df3\u6d88\u606f\u7684\u5360\u7528\u5e26\u5bbd\u60c5\u51b5\uff0c\u4f46\u662f\uff0c \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u5982\u679c\u4e0d\u662f\u7279\u522b\u9700\u8981\u5927\u5bb9\u91cf\u96c6\u7fa4\uff0c\u6211\u5efa\u8bae\u4f60\u628a Redis Cluster \u7684\u89c4\u6a21\u63a7\u5236\u5728 400~500 \u4e2a\u5b9e\u4f8b\u3002 \u5047\u8bbe\u5355\u4e2a\u5b9e\u4f8b\u6bcf\u79d2\u80fd\u652f\u6491 8 \u4e07\u8bf7\u6c42\u64cd\u4f5c\uff088 \u4e07 QPS\uff09\uff0c\u6bcf\u4e2a\u4e3b\u5b9e\u4f8b\u914d\u7f6e 1 \u4e2a\u4ece\u5b9e\u4f8b\uff0c\u90a3\u4e48\uff0c 400~ 500 \u4e2a\u5b9e\u4f8b\u53ef\u652f\u6301 1600 \u4e07~2000 \u4e07 QPS\uff08 200/250 \u4e2a\u4e3b\u5b9e\u4f8b *8 \u4e07 QPS=1600/2000 \u4e07 QPS \uff09\uff0c\u8fd9\u4e2a\u541e\u5410\u91cf\u6027\u80fd\u53ef\u4ee5\u6ee1\u8db3\u4e0d\u5c11\u4e1a\u52a1\u5e94\u7528\u7684\u9700\u6c42\u3002","title":"5\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap7/7Redis_cluster_summary/","text":"\u7b2c\u4e03\u7ae0 Redis Cluster\u96c6\u7fa4\u4ecb\u7ecd\u53ca\u7ba1\u7406 1\u3001\u672c\u7ae0\u5c0f\u7ed3 1-1 Redis\u4e3b\u4ece\u540c\u6b65\u4e0e\u6545\u969c\u5207\u6362\u7684\u4e09\u4e2a\u5751 Redis \u4e3b\u4ece\u5e93\u540c\u6b65\u65f6\u53ef\u80fd\u51fa\u73b0\u7684 3 \u4e2a\u5751\uff0c\u5206\u522b\u662f\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\u3001\u8bfb\u53d6\u5230\u8fc7\u671f\u6570\u636e\u548c\u4e0d\u5408\u7406\u914d\u7f6e\u9879\u5bfc\u81f4\u670d\u52a1\u6302\u6389\u3002 \u5173\u4e8e\u4e3b\u4ece\u5e93\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\uff1a Redis \u4e2d\u7684 slave-serve-stale-data \u914d\u7f6e\u9879\u8bbe\u7f6e\u4e86\u4ece\u5e93\u80fd\u5426\u5904\u7406\u6570\u636e\u8bfb\u5199\u547d\u4ee4\uff0c\u4f60\u53ef\u4ee5\u628a\u5b83\u8bbe\u7f6e\u4e3a no \u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4ece\u5e93\u53ea\u80fd\u670d\u52a1 INFO\u3001SLAVEOF \u547d\u4ee4\uff0c\u8fd9\u5c31\u53ef\u4ee5\u907f\u514d\u5728\u4ece\u5e93\u4e2d\u8bfb\u5230\u4e0d\u4e00\u81f4\u7684\u6570\u636e\u4e86\u3002 \u8fd9\u4e2a\u914d\u7f6e\u9879\u548c slave-read-only \u7684\u533a\u522b\uff0c slave-read-only \u662f\u8bbe\u7f6e\u4ece\u5e93\u80fd\u5426\u5904\u7406\u5199\u547d\u4ee4\uff0c slave-read-only \u8bbe\u7f6e\u4e3a yes \u65f6\uff0c\u4ece\u5e93\u53ea\u80fd\u5904\u7406\u8bfb\u8bf7\u6c42\uff0c\u65e0\u6cd5\u5904\u7406\u5199\u8bf7\u6c42\uff0c\u4f60\u53ef\u4e0d\u8981\u641e\u6df7\u4e86\u3002 1-2 \u8111\u88c2\u5bfc\u81f4\u6570\u636e\u4e22\u5931 \u8111\u88c2\u662f\u6307\u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c\u540c\u65f6\u6709\u4e24\u4e2a\u4e3b\u5e93\u90fd\u80fd\u63a5\u6536\u5199\u8bf7\u6c42\u3002\u5728 Redis \u7684\u4e3b\u4ece\u5207\u6362\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u53d1\u751f\u4e86\u8111\u88c2\uff0c\u5ba2\u6237\u7aef\u6570\u636e\u5c31\u4f1a\u5199\u5165\u5230\u539f\u4e3b\u5e93\uff0c\u5982\u679c\u539f\u4e3b\u5e93\u88ab\u964d\u4e3a\u4ece\u5e93\uff0c\u8fd9\u4e9b\u65b0\u5199\u5165\u7684\u6570\u636e\u5c31\u4e22\u5931\u4e86\u3002 \u8111\u88c2\u53d1\u751f\u7684\u539f\u56e0\u4e3b\u8981\u662f\u539f\u4e3b\u5e93\u53d1\u751f\u4e86\u5047\u6545\u969c\uff0c\u603b\u7ed3\u4e0b\u5047\u6545\u969c\u7684\u4e24\u4e2a\u539f\u56e0\u3002 \u548c\u4e3b\u5e93\u90e8\u7f72\u5728\u540c\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u7684\u5176\u4ed6\u7a0b\u5e8f\u4e34\u65f6\u5360\u7528\u4e86\u5927\u91cf\u8d44\u6e90\uff08\u4f8b\u5982 CPU \u8d44\u6e90\uff09\uff0c\u5bfc\u81f4\u4e3b\u5e93\u8d44\u6e90\u4f7f\u7528\u53d7\u9650\uff0c\u77ed\u65f6\u95f4\u5185\u65e0\u6cd5\u54cd\u5e94\u5fc3\u8df3 \u3002\u5176\u5b83\u7a0b\u5e8f\u4e0d\u518d\u4f7f\u7528\u8d44\u6e90\u65f6\uff0c\u4e3b\u5e93\u53c8\u6062\u590d\u6b63\u5e38\u3002 \u4e3b\u5e93\u81ea\u8eab\u9047\u5230\u4e86\u963b\u585e\u7684\u60c5\u51b5\uff0c\u4f8b\u5982\uff0c\u5904\u7406 bigkey \u6216\u662f\u53d1\u751f\u5185\u5b58 swap\uff0c\u77ed\u65f6\u95f4\u5185\u65e0\u6cd5\u54cd\u5e94\u5fc3\u8df3\uff0c\u7b49\u4e3b\u5e93\u963b\u585e\u89e3\u9664\u540e\uff0c\u53c8\u6062\u590d\u6b63\u5e38\u7684\u8bf7\u6c42\u5904\u7406\u4e86\u3002 \u4e3a\u4e86\u5e94\u5bf9\u8111\u88c2\uff0c\u53ef\u4ee5\u5728\u4e3b\u4ece\u96c6\u7fa4\u90e8\u7f72\u65f6\uff0c\u901a\u8fc7\u5408\u7406\u5730\u914d\u7f6e\u53c2\u6570 min-slaves-to-write \u548c min-slaves-max-lag \uff0c\u6765\u9884\u9632\u8111\u88c2\u7684\u53d1\u751f\u3002 \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u53ef\u80fd\u4f1a\u56e0\u4e3a\u7f51\u7edc\u6682\u65f6\u62e5\u585e\u5bfc\u81f4\u4ece\u5e93\u6682\u65f6\u548c\u4e3b\u5e93\u7684 ACK \u6d88\u606f\u8d85\u65f6\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5e76\u4e0d\u662f\u4e3b\u5e93\u5047\u6545\u969c\uff0c\u6211\u4eec\u4e5f\u4e0d\u7528\u7981\u6b62\u4e3b\u5e93\u63a5\u6536\u8bf7\u6c42\u3002 \u5efa\u8bae\u662f\uff0c\u5047\u8bbe\u4ece\u5e93\u6709 K \u4e2a\uff0c\u53ef\u4ee5\u5c06 min-slaves-to-write \u8bbe\u7f6e\u4e3a K/2+1 \uff08\u5982\u679c K \u7b49\u4e8e 1\uff0c\u5c31\u8bbe\u4e3a 1\uff09\uff0c\u5c06 min-slaves-max-lag \u8bbe\u7f6e\u4e3a\u5341\u51e0\u79d2\uff08\u4f8b\u5982 10\uff5e20s\uff09\uff0c\u5728\u8fd9\u4e2a\u914d\u7f6e\u4e0b\uff0c\u5982\u679c\u6709\u4e00\u534a\u4ee5\u4e0a\u7684\u4ece\u5e93\u548c\u4e3b\u5e93\u8fdb\u884c\u7684 ACK \u6d88\u606f\u5ef6\u8fdf\u8d85\u8fc7\u5341\u51e0\u79d2\uff0c\u6211\u4eec\u5c31\u7981\u6b62\u4e3b\u5e93\u63a5\u6536\u5ba2\u6237\u7aef\u5199\u8bf7\u6c42 \u3002 \u907f\u514d\u8111\u88c2\u5e26\u6765\u6570\u636e\u4e22\u5931\u7684\u60c5\u51b5\uff0c\u800c\u4e14\uff0c\u4e5f\u4e0d\u4f1a\u56e0\u4e3a\u53ea\u6709\u5c11\u6570\u51e0\u4e2a\u4ece\u5e93\u56e0\u4e3a\u7f51\u7edc\u963b\u585e\u8fde\u4e0d\u4e0a\u4e3b\u5e93\uff0c\u5c31\u7981\u6b62\u4e3b\u5e93\u63a5\u6536\u8bf7\u6c42\uff0c\u589e\u52a0\u4e86\u7cfb\u7edf\u7684\u9c81\u68d2\u6027\u3002 1-3 Redis Codis \u96c6\u7fa4\u65b9\u6848 Codis \u96c6\u7fa4\u5305\u542b codis server\u3001codis proxy\u3001Zookeeper\u3001codis dashboard \u548c codis fe \u8fd9\u56db\u5927\u7c7b\u7ec4\u4ef6\u3002 codis proxy \u548c codis server \u8d1f\u8d23\u5904\u7406\u6570\u636e\u8bfb\u5199\u8bf7\u6c42\uff0c\u5176\u4e2d\uff0ccodis proxy \u548c\u5ba2\u6237\u7aef\u8fde\u63a5\uff0c\u63a5\u6536\u8bf7\u6c42\uff0c\u5e76\u8f6c\u53d1\u8bf7\u6c42\u7ed9 codis server\uff0c\u800c codis server \u8d1f\u8d23\u5177\u4f53\u5904\u7406\u8bf7\u6c42\u3002 codis dashboard \u548c codis fe \u8d1f\u8d23\u96c6\u7fa4\u7ba1\u7406\uff0c\u5176\u4e2d\uff0ccodis dashboard \u6267\u884c\u7ba1\u7406\u64cd\u4f5c\uff0c\u800c codis fe \u63d0\u4f9b Web \u7ba1\u7406\u754c\u9762\u3002 Zookeeper \u96c6\u7fa4\u8d1f\u8d23\u4fdd\u5b58\u96c6\u7fa4\u7684\u6240\u6709\u5143\u6570\u636e\u4fe1\u606f\uff0c\u5305\u62ec\u8def\u7531\u8868\u3001proxy \u5b9e\u4f8b\u4fe1\u606f\u7b49\u3002\u8fd9\u91cc\uff0c\u6709\u4e2a\u5730\u65b9\u9700\u8981\u4f60\u6ce8\u610f\uff0c\u9664\u4e86\u4f7f\u7528 Zookeeper\uff0cCodis \u8fd8\u53ef\u4ee5\u4f7f\u7528 etcd \u6216\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u4fdd\u5b58\u5143\u6570\u636e\u4fe1\u606f\u3002 \u5173\u4e8e Codis \u548c Redis Cluster \u7684\u9009\u578b\u8003\u8651\uff0c\u4ece\u7a33\u5b9a\u6027\u6210\u719f\u5ea6\u3001\u5ba2\u6237\u7aef\u517c\u5bb9\u6027\u3001Redis \u65b0\u7279\u6027\u4f7f\u7528\u4ee5\u53ca\u6570\u636e\u8fc1\u79fb\u6027\u80fd\u56db\u4e2a\u65b9\u9762\u7ed9\u4f60\u63d0\u4f9b\u4e86\u5efa\u8bae\u3002 \u6211\u518d\u7ed9\u4f60\u63d0\u4f9b\u4e00\u4e2a Codis \u4f7f\u7528\u4e0a\u7684\u5c0f\u5efa\u8bae\uff1a \u5f53\u4f60\u6709\u591a\u6761\u4e1a\u52a1\u7ebf\u8981\u4f7f\u7528 Codis \u65f6\uff0c\u53ef\u4ee5\u542f\u52a8\u591a\u4e2a codis dashboard\uff0c\u6bcf\u4e2a dashboard \u7ba1\u7406\u4e00\u90e8\u5206 codis server\uff0c\u540c\u65f6\uff0c\u518d\u7528\u4e00\u4e2a dashboard \u5bf9\u5e94\u8d1f\u8d23\u4e00\u4e2a\u4e1a\u52a1\u7ebf\u7684\u96c6\u7fa4\u7ba1\u7406\uff0c\u8fd9\u6837\uff0c\u5c31\u53ef\u4ee5\u505a\u5230\u7528\u4e00\u4e2a Codis \u96c6\u7fa4\u5b9e\u73b0\u591a\u6761\u4e1a\u52a1\u7ebf\u7684\u9694\u79bb\u7ba1\u7406\u4e86 \u3002 1-4 Redis\u652f\u6491\u79d2\u6740\u573a\u666f\u7684\u5173\u952e\u6280\u672f\u548c\u5b9e\u8df5 \u79d2\u6740\u573a\u666f\u6709 2 \u4e2a\u8d1f\u8f7d\u7279\u5f81\uff0c\u5206\u522b\u662f\u77ac\u65f6 \u9ad8\u5e76\u53d1\u8bf7\u6c42\u548c\u8bfb\u591a\u5199\u5c11 \u3002Redis \u826f\u597d\u7684\u9ad8\u5e76\u53d1\u5904\u7406\u80fd\u529b\uff0c\u4ee5\u53ca\u9ad8\u6548\u7684\u952e\u503c\u5bf9\u8bfb\u5199\u7279\u6027\uff0c\u6b63\u597d\u53ef\u4ee5\u6ee1\u8db3\u79d2\u6740\u573a\u666f\u7684\u9700\u6c42\u3002 \u5728\u79d2\u6740\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u524d\u7aef CDN \u548c\u6d4f\u89c8\u5668\u7f13\u5b58\u62e6\u622a\u5927\u91cf\u79d2\u6740\u524d\u7684\u8bf7\u6c42\u3002\u5728\u5b9e\u9645\u79d2\u6740\u6d3b\u52a8\u8fdb\u884c\u65f6\uff0c\u5e93\u5b58\u67e5\u9a8c\u548c\u5e93\u5b58\u6263\u51cf\u662f\u627f\u53d7\u5de8\u5927\u5e76\u53d1\u8bf7\u6c42\u538b\u529b\u7684\u4e24\u4e2a\u64cd\u4f5c\uff0c\u540c\u65f6\uff0c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7684\u6267\u884c\u9700\u8981\u4fdd\u8bc1\u539f\u5b50\u6027\u3002Redis \u7684\u539f\u5b50\u64cd\u4f5c\u3001\u5206\u5e03\u5f0f\u9501\u8fd9\u4e24\u4e2a\u529f\u80fd\u7279\u6027\u53ef\u4ee5\u6709\u6548\u5730\u6765\u652f\u6491\u79d2\u6740\u573a\u666f\u7684\u9700\u6c42\u3002 \u5f53\u7136\uff0c\u5bf9\u4e8e\u79d2\u6740\u573a\u666f\u6765\u8bf4\uff0c\u53ea\u7528 Redis \u662f\u4e0d\u591f\u7684\u3002\u79d2\u6740\u7cfb\u7edf\u662f\u4e00\u4e2a\u7cfb\u7edf\u6027\u5de5\u7a0b\uff0cRedis \u5b9e\u73b0\u4e86\u5bf9\u5e93\u5b58\u67e5\u9a8c\u548c\u6263\u51cf\u8fd9\u4e2a\u73af\u8282\u7684\u652f\u6491\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u6709 4 \u4e2a\u73af\u8282\u9700\u8981\u6211\u4eec\u5904\u7406\u597d\u3002 \u524d\u7aef\u9759\u6001\u9875\u9762\u7684\u8bbe\u8ba1 \u3002\u79d2\u6740\u9875\u9762\u4e0a\u80fd\u9759\u6001\u5316\u5904\u7406\u7684\u9875\u9762\u5143\u7d20\uff0c\u6211\u4eec\u90fd\u8981\u5c3d\u91cf\u9759\u6001\u5316\uff0c\u8fd9\u6837\u53ef\u4ee5\u5145\u5206\u5229\u7528 CDN \u6216\u6d4f\u89c8\u5668\u7f13\u5b58\u670d\u52a1\u79d2\u6740\u5f00\u59cb\u524d\u7684\u8bf7\u6c42\u3002 \u8bf7\u6c42\u62e6\u622a\u548c\u6d41\u63a7 \u3002\u5728\u79d2\u6740\u7cfb\u7edf\u7684\u63a5\u5165\u5c42\uff0c\u5bf9\u6076\u610f\u8bf7\u6c42\u8fdb\u884c\u62e6\u622a\uff0c\u907f\u514d\u5bf9\u7cfb\u7edf\u7684\u6076\u610f\u653b\u51fb\uff0c\u4f8b\u5982\u4f7f\u7528\u9ed1\u540d\u5355\u7981\u6b62\u6076\u610f IP \u8fdb\u884c\u8bbf\u95ee\u3002\u5982\u679c Redis \u5b9e\u4f8b\u7684\u8bbf\u95ee\u538b\u529b\u8fc7\u5927\uff0c\u4e3a\u4e86\u907f\u514d\u5b9e\u4f8b\u5d29\u6e83\uff0c\u6211\u4eec\u4e5f\u9700\u8981\u5728\u63a5\u5165\u5c42\u8fdb\u884c\u9650\u6d41\uff0c\u63a7\u5236\u8fdb\u5165\u79d2\u6740\u7cfb\u7edf\u7684\u8bf7\u6c42\u6570\u91cf\u3002 \u5e93\u5b58\u4fe1\u606f\u8fc7\u671f\u65f6\u95f4\u5904\u7406 \u3002Redis \u4e2d\u4fdd\u5b58\u7684\u5e93\u5b58\u4fe1\u606f\u5176\u5b9e\u662f\u6570\u636e\u5e93\u7684\u7f13\u5b58\uff0c\u4e3a\u4e86\u907f\u514d\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898\uff0c\u6211\u4eec\u4e0d\u8981\u7ed9\u5e93\u5b58\u4fe1\u606f\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002 \u6570\u636e\u5e93\u8ba2\u5355\u5f02\u5e38\u5904\u7406 \u3002\u5982\u679c\u6570\u636e\u5e93\u6ca1\u80fd\u6210\u529f\u5904\u7406\u8ba2\u5355\uff0c\u53ef\u4ee5\u589e\u52a0\u8ba2\u5355\u91cd\u8bd5\u529f\u80fd\uff0c\u4fdd\u8bc1\u8ba2\u5355\u6700\u7ec8\u80fd\u88ab\u6210\u529f\u5904\u7406\u3002 \u5efa\u8bae\uff1a \u79d2\u6740\u6d3b\u52a8\u5e26\u6765\u7684\u8bf7\u6c42\u6d41\u91cf\u5de8\u5927\uff0c\u6211\u4eec\u9700\u8981\u628a\u79d2\u6740\u5546\u54c1\u7684\u5e93\u5b58\u4fe1\u606f\u7528\u5355\u72ec\u7684\u5b9e\u4f8b\u4fdd\u5b58\uff0c\u800c\u4e0d\u8981\u548c\u65e5\u5e38\u4e1a\u52a1\u7cfb\u7edf\u7684\u6570\u636e\u4fdd\u5b58\u5728\u540c\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u5e72\u6270\u4e1a\u52a1\u7cfb\u7edf\u7684\u6b63\u5e38\u8fd0\u884c\u3002 1-5 \u6570\u636e\u5206\u5e03\u4f18\u5316\u5e94\u5bf9\u6570\u636e\u503e\u659c \u6570\u636e\u503e\u659c\u7684\u4e24\u79cd\u60c5\u51b5\uff1a\u6570\u636e\u91cf\u503e\u659c\u548c\u6570\u636e\u8bbf\u95ee\u503e\u659c\u3002 \u9020\u6210\u6570\u636e\u91cf\u503e\u659c\u7684\u539f\u56e0\u4e3b\u8981\u6709\u4e09\u4e2a\uff1a \u6570\u636e\u4e2d\u6709 bigkey\uff0c\u5bfc\u81f4\u67d0\u4e2a\u5b9e\u4f8b\u7684\u6570\u636e\u91cf\u589e\u52a0\uff1b Slot \u624b\u5de5\u5206\u914d\u4e0d\u5747\uff0c\u5bfc\u81f4\u67d0\u4e2a\u6216\u67d0\u4e9b\u5b9e\u4f8b\u4e0a\u6709\u5927\u91cf\u6570\u636e\uff1b \u4f7f\u7528\u4e86 Hash Tag\uff0c\u5bfc\u81f4\u6570\u636e\u96c6\u4e2d\u5230\u67d0\u4e9b\u5b9e\u4f8b\u4e0a\u3002 \u800c\u6570\u636e\u8bbf\u95ee\u503e\u659c\u7684\u4e3b\u8981\u539f\u56e0\u5c31\u662f \u6709\u70ed\u70b9\u6570\u636e\u5b58\u5728\uff0c\u5bfc\u81f4\u5927\u91cf\u8bbf\u95ee\u8bf7\u6c42\u96c6\u4e2d\u5230\u4e86\u70ed\u70b9\u6570\u636e\u6240\u5728\u7684\u5b9e\u4f8b\u4e0a\u3002 \u4e3a\u4e86\u5e94\u5bf9\u6570\u636e\u503e\u659c\u95ee\u9898\uff0c\u56db\u4e2a\u65b9\u6cd5\uff0c \u5982\u679c\u5df2\u7ecf\u53d1\u751f\u4e86\u6570\u636e\u503e\u659c\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6570\u636e\u8fc1\u79fb\u6765\u7f13\u89e3\u6570\u636e\u503e\u659c\u7684\u5f71\u54cd\u3002Redis Cluster \u548c Codis \u96c6\u7fa4\u90fd\u63d0\u4f9b\u4e86\u67e5\u770b Slot \u5206\u914d\u548c\u624b\u5de5\u8fc1\u79fb Slot \u7684\u547d\u4ee4\uff0c\u4f60\u53ef\u4ee5\u628a\u5b83\u4eec\u5e94\u7528\u8d77\u6765\u3002 \u5173\u4e8e\u96c6\u7fa4\u7684\u5b9e\u4f8b\u8d44\u6e90\u914d\u7f6e\uff0c\u4e00\u4e2a\u5c0f\u5efa\u8bae\uff1a \u5728\u6784\u5efa\u5207\u7247\u96c6\u7fa4\u65f6\uff0c\u5c3d\u91cf\u4f7f\u7528\u5927\u5c0f\u914d\u7f6e\u76f8\u540c\u7684\u5b9e\u4f8b\uff08\u4f8b\u5982\u5b9e\u4f8b\u5185\u5b58\u914d\u7f6e\u4fdd\u6301\u76f8\u540c\uff09\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u56e0\u5b9e\u4f8b\u8d44\u6e90\u4e0d\u5747\u8861\u800c\u5728\u4e0d\u540c\u5b9e\u4f8b\u4e0a\u5206\u914d\u4e0d\u540c\u6570\u91cf\u7684 Slot\u3002 1-6 \u9650\u5236Redis Cluster\u89c4\u6a21\u7684\u5173\u952e\u56e0\u7d20\uff1a\u901a\u4fe1\u5f00\u9500 Redis Cluster \u5b9e\u4f8b\u95f4\u4ee5 Gossip \u534f\u8bae\u8fdb\u884c\u901a\u4fe1\u7684\u673a\u5236\u3002Redis Cluster \u8fd0\u884c\u65f6\uff0c\u5404\u5b9e\u4f8b\u95f4\u9700\u8981\u901a\u8fc7 PING\u3001PONG \u6d88\u606f\u8fdb\u884c\u4fe1\u606f\u4ea4\u6362\uff0c\u8fd9\u4e9b\u5fc3\u8df3\u6d88\u606f\u5305\u542b\u4e86\u5f53\u524d\u5b9e\u4f8b\u548c\u90e8\u5206\u5176\u5b83\u5b9e\u4f8b\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u4ee5\u53ca Slot \u5206\u914d\u4fe1\u606f\u3002\u8fd9\u79cd\u901a\u4fe1\u673a\u5236\u6709\u52a9\u4e8e Redis Cluster \u4e2d\u7684\u6240\u6709\u5b9e\u4f8b\u90fd\u62e5\u6709\u5b8c\u6574\u7684\u96c6\u7fa4\u72b6\u6001\u4fe1\u606f\u3002 \u4f46\u662f\uff0c\u968f\u7740\u96c6\u7fa4\u89c4\u6a21\u7684\u589e\u52a0\uff0c\u5b9e\u4f8b\u95f4\u7684\u901a\u4fe1\u91cf\u4e5f\u4f1a\u589e\u52a0\u3002 \u5982\u679c\u6211\u4eec\u76f2\u76ee\u5730\u5bf9 Redis Cluster \u8fdb\u884c\u6269\u5bb9\uff0c\u5c31\u53ef\u80fd\u4f1a\u9047\u5230\u96c6\u7fa4\u6027\u80fd\u53d8\u6162\u7684\u60c5\u51b5\u3002\u8fd9\u662f\u56e0\u4e3a\uff0c\u96c6\u7fa4\u4e2d\u5927\u89c4\u6a21\u7684\u5b9e\u4f8b\u95f4\u5fc3\u8df3\u6d88\u606f\u4f1a\u6324\u5360\u96c6\u7fa4\u5904\u7406\u6b63\u5e38\u8bf7\u6c42\u7684\u5e26\u5bbd\u3002\u800c\u4e14\uff0c\u6709\u4e9b\u5b9e\u4f8b\u53ef\u80fd\u56e0\u4e3a\u7f51\u7edc\u62e5\u585e\u5bfc\u81f4\u65e0\u6cd5\u53ca\u65f6\u6536\u5230 PONG \u6d88\u606f\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u5728\u8fd0\u884c\u65f6\u4f1a\u5468\u671f\u6027\u5730\uff08\u6bcf\u79d2 10 \u6b21\uff09\u68c0\u6d4b\u662f\u5426\u6709\u8fd9\u79cd\u60c5\u51b5\u53d1\u751f\uff0c\u4e00\u65e6\u53d1\u751f\uff0c\u5c31\u4f1a\u7acb\u5373\u7ed9\u8fd9\u4e9b PONG \u6d88\u606f\u8d85\u65f6\u7684\u5b9e\u4f8b\u53d1\u9001\u5fc3\u8df3\u6d88\u606f \u3002 \u96c6\u7fa4\u89c4\u6a21\u8d8a\u5927\uff0c\u7f51\u7edc\u62e5\u585e\u7684\u6982\u7387\u5c31\u8d8a\u9ad8\uff0c\u76f8\u5e94\u7684\uff0cPONG \u6d88\u606f\u8d85\u65f6\u7684\u53d1\u751f\u6982\u7387\u5c31\u8d8a\u9ad8\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u96c6\u7fa4\u4e2d\u6709\u5927\u91cf\u7684\u5fc3\u8df3\u6d88\u606f\uff0c\u5f71\u54cd\u96c6\u7fa4\u670d\u52a1\u6b63\u5e38\u8bf7\u6c42\u3002 \u5efa\u8bae\uff0c\u867d\u7136\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574 cluster-node-timeout \u914d\u7f6e\u9879\u51cf\u5c11\u5fc3\u8df3\u6d88\u606f\u7684\u5360\u7528\u5e26\u5bbd\u60c5\u51b5\uff0c\u4f46\u662f\uff0c \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u5982\u679c\u4e0d\u662f\u7279\u522b\u9700\u8981\u5927\u5bb9\u91cf\u96c6\u7fa4\uff0c\u6211\u5efa\u8bae\u4f60\u628a Redis Cluster \u7684\u89c4\u6a21\u63a7\u5236\u5728 400~500 \u4e2a\u5b9e\u4f8b\u3002 \u5047\u8bbe\u5355\u4e2a\u5b9e\u4f8b\u6bcf\u79d2\u80fd\u652f\u6491 8 \u4e07\u8bf7\u6c42\u64cd\u4f5c\uff088 \u4e07 QPS\uff09\uff0c\u6bcf\u4e2a\u4e3b\u5b9e\u4f8b\u914d\u7f6e 1 \u4e2a\u4ece\u5b9e\u4f8b\uff0c\u90a3\u4e48\uff0c 400~ 500 \u4e2a\u5b9e\u4f8b\u53ef\u652f\u6301 1600 \u4e07~2000 \u4e07 QPS\uff08 200/250 \u4e2a\u4e3b\u5b9e\u4f8b *8 \u4e07 QPS=1600/2000 \u4e07 QPS \uff09\uff0c\u8fd9\u4e2a\u541e\u5410\u91cf\u6027\u80fd\u53ef\u4ee5\u6ee1\u8db3\u4e0d\u5c11\u4e1a\u52a1\u5e94\u7528\u7684\u9700\u6c42\u3002 2\u3001\u672c\u7ae0\u64cd\u4f5c\u603b\u7ed3 2-1 Redis\u4e3b\u4ece\u540c\u6b65\u4e0e\u6545\u969c\u5207\u6362\u7684\u4e09\u4e2a\u5751 \u7b2c\u4e00\u4e2a\u4f8b\u5b50\u662f\u4f7f\u7528 EXPIRE \u547d\u4ee4\uff0c\u5f53\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0c \u6211\u4eec\u5c31\u628a testkey \u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a 60s \u540e\u3002 EXPIRE testkey 60 \u7b2c\u4e8c\u4e2a\u4f8b\u5b50\u662f\u4f7f\u7528 EXPIREAT \u547d\u4ee4\uff0c\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c \u5c31\u53ef\u4ee5\u8ba9 testkey \u5728 2020 \u5e74 10 \u6708 24 \u65e5\u4e0a\u5348 9 \u70b9\u8fc7\u671f\uff0c\u547d\u4ee4\u4e2d\u7684 1603501200 \u5c31\u662f\u4ee5\u79d2\u6570\u65f6\u95f4\u6233\u8868\u793a\u7684 10 \u6708 24 \u65e5\u4e0a\u5348 9 \u70b9 EXPIREAT testkey 1603501200 protected-mode \u914d\u7f6e\u9879 \u5728\u5e94\u7528\u4e3b\u4ece\u96c6\u7fa4\u65f6\uff0c\u8981\u6ce8\u610f\u5c06 protected-mode \u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a no\uff0c\u5e76\u4e14\u5c06 bind \u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a\u5176\u5b83\u54e8\u5175\u5b9e\u4f8b\u7684 IP \u5730\u5740\u3002 \u53ea\u6709\u5728 bind \u4e2d\u8bbe\u7f6e\u4e86 IP \u5730\u5740\u7684\u54e8\u5175\uff0c\u624d\u53ef\u4ee5\u8bbf\u95ee\u5f53\u524d\u5b9e\u4f8b\uff0c\u65e2\u4fdd\u8bc1\u4e86\u5b9e\u4f8b\u95f4\u80fd\u591f\u901a\u4fe1\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u4e5f\u4fdd\u8bc1\u4e86\u54e8\u5175\u7684\u5b89\u5168\u6027\u3002 \u5982\u679c\u8bbe\u7f6e\u4e86\u4e0b\u9762\u7684\u914d\u7f6e\u9879\uff0c\u90a3\u4e48\uff0c\u90e8\u7f72\u5728 192.168.10.3/4/5 \u8fd9\u4e09\u53f0\u670d\u52a1\u5668\u4e0a\u7684\u54e8\u5175\u5b9e\u4f8b\u5c31\u53ef\u4ee5\u76f8\u4e92\u901a\u4fe1\uff0c\u6267\u884c\u4e3b\u4ece\u5207\u6362\u3002 protected-mode no bind 192.168.10.3 192.168.10.4 192.168.10.5 2-2 \u8111\u88c2\u5bfc\u81f4\u6570\u636e\u4e22\u5931 Redis \u5df2\u7ecf\u63d0\u4f9b\u4e86\u4e24\u4e2a\u914d\u7f6e\u9879\u6765\u9650\u5236\u4e3b\u5e93\u7684\u8bf7\u6c42\u5904\u7406\uff0c\u5206\u522b\u662f min-slaves-to-write \u548c min-slaves-max-lag \u3002 min-slaves-to-write \uff1a\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e86 \u4e3b\u5e93\u80fd\u8fdb\u884c\u6570\u636e\u540c\u6b65\u7684\u6700\u5c11\u4ece\u5e93\u6570\u91cf \uff1b min-slaves-max-lag \uff1a\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e86 \u4e3b\u4ece\u5e93\u95f4\u8fdb\u884c\u6570\u636e\u590d\u5236\u65f6\uff0c\u4ece\u5e93\u7ed9\u4e3b\u5e93\u53d1\u9001 ACK \u6d88\u606f\u7684\u6700\u5927\u5ef6\u8fdf\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09 \u3002 \u53ef\u4ee5\u628a min-slaves-to-write \u548c min-slaves-max-lag \u8fd9\u4e24\u4e2a\u914d\u7f6e\u9879\u642d\u914d\u8d77\u6765\u4f7f\u7528\uff0c\u5206\u522b\u7ed9\u5b83\u4eec\u8bbe\u7f6e\u4e00\u5b9a\u7684\u9608\u503c\uff0c\u5047\u8bbe\u4e3a N \u548c T \u3002 \u5047\u8bbe\u6211\u4eec\u5c06 min-slaves-to-write \u8bbe\u7f6e\u4e3a 1 \u628a min-slaves-max-lag \u8bbe\u7f6e\u4e3a 12s \u628a\u54e8\u5175\u7684 down-after-milliseconds \u8bbe\u7f6e\u4e3a 10s 2-5 \u6570\u636e\u5206\u5e03\u4f18\u5316\u5e94\u5bf9\u6570\u636e\u503e\u659c \u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u6267\u884c CLUSTER SLOTS \u547d\u4ee4\u67e5\u770b Slot \u5206\u914d\u60c5\u51b5\u3002 \u547d\u4ee4\u8fd4\u56de\u7ed3\u679c\u663e\u793a\uff0c Slot 0 \u5230 Slot 4095 \u88ab\u5206\u914d\u5230\u4e86\u5b9e\u4f8b 192.168.10.3 \u4e0a\uff0c\u800c Slot 12288 \u5230 Slot 16383 \u88ab\u5206\u914d\u5230\u4e86\u5b9e\u4f8b 192.168.10.5 \u4e0a\u3002 127.0.0.1:6379> cluster slots 1) 1) (integer) 0 2) (integer) 4095 3) 1) \"192.168.10.3\" 2) (integer) 6379 2) 1) (integer) 12288 2) (integer) 16383 3) 1) \"192.168.10.5\" 2) (integer) 6379 \u5982\u679c\u67d0\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\u6709\u592a\u591a\u7684 Slot\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u8fc1\u79fb\u547d\u4ee4\u628a\u8fd9\u4e9b Slot \u8fc1\u79fb\u5230\u5176\u5b83\u5b9e\u4f8b\u4e0a\u3002 \u5728 Redis Cluster \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 3 \u4e2a\u547d\u4ee4\u5b8c\u6210 Slot \u8fc1\u79fb\u3002 CLUSTER SETSLOT \uff1a\u4f7f\u7528\u4e0d\u540c\u7684\u9009\u9879\u8fdb\u884c\u4e09\u79cd\u8bbe\u7f6e\uff0c\u5206\u522b\u662f\u8bbe\u7f6e Slot \u8981\u8fc1\u5165\u7684\u76ee\u6807\u5b9e\u4f8b\uff0cSlot \u8981\u8fc1\u51fa\u7684\u6e90\u5b9e\u4f8b\uff0c\u4ee5\u53ca Slot \u6240\u5c5e\u7684\u5b9e\u4f8b\u3002 CLUSTER GETKEYSINSLOT \uff1a \u83b7\u53d6\u67d0\u4e2a Slot \u4e2d\u4e00\u5b9a\u6570\u91cf\u7684 key \u3002 MIGRATE \uff1a\u628a\u4e00\u4e2a key \u4ece\u6e90\u5b9e\u4f8b\u5b9e\u9645\u8fc1\u79fb\u5230\u76ee\u6807\u5b9e\u4f8b\u3002 4 \u5047\u8bbe\u6211\u4eec\u8981\u628a Slot 300 \u4ece\u6e90\u5b9e\u4f8b\uff08ID \u4e3a 3\uff09\u8fc1\u79fb\u5230\u76ee\u6807\u5b9e\u4f8b\uff08ID \u4e3a 5\uff09\uff0c\u90a3\u8981\u600e\u4e48\u505a\u5462\uff1f \u5b9e\u9645\u4e0a\uff0c\u53ef\u4ee5\u5206\u6210 5 \u6b65\u3002 \u7b2c 1 \u6b65\uff0c\u5148 \u5728\u76ee\u6807\u5b9e\u4f8b 5 \u4e0a\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4 \uff0c \u5c06 Slot 300 \u7684\u6e90\u5b9e\u4f8b\u8bbe\u7f6e\u4e3a\u5b9e\u4f8b 3\uff0c\u8868\u793a\u8981\u4ece\u5b9e\u4f8b 3 \u4e0a\u8fc1\u5165 Slot 300\u3002 CLUSTER SETSLOT 300 IMPORTING 3 \u7b2c 2 \u6b65\uff0c \u5728\u6e90\u5b9e\u4f8b 3 \u4e0a\uff0c\u6211\u4eec\u628a Slot 300 \u7684\u76ee\u6807\u5b9e\u4f8b\u8bbe\u7f6e\u4e3a 5\uff0c\u8fd9\u8868\u793a\uff0cSlot 300 \u8981\u8fc1\u51fa\u5230\u5b9e\u4f8b 5 \u4e0a \uff0c\u5982\u4e0b\u6240\u793a\uff1a CLUSTER SETSLOT 300 MIGRATING 5 \u7b2c 3 \u6b65\uff0c \u4ece Slot 300 \u4e2d\u83b7\u53d6 100 \u4e2a key\u3002\u56e0\u4e3a Slot \u4e2d\u7684 key \u6570\u91cf\u53ef\u80fd\u5f88\u591a\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5728\u5ba2\u6237\u7aef\u4e0a\u591a\u6b21\u6267\u884c\u4e0b\u9762\u7684\u8fd9\u6761\u547d\u4ee4\uff0c\u5206\u6279\u6b21\u83b7\u5f97\u5e76\u8fc1\u79fb key \u3002 CLUSTER GETKEYSINSLOT 300 100 \u7b2c 4 \u6b65\uff0c\u6211\u4eec\u628a\u521a\u624d\u83b7\u53d6\u7684 100 \u4e2a key \u4e2d\u7684 key1 \u8fc1\u79fb\u5230\u76ee\u6807\u5b9e\u4f8b 5 \u4e0a\uff08IP \u4e3a 192.168.10.5\uff09\uff0c \u540c\u65f6\u628a\u8981\u8fc1\u5165\u7684\u6570\u636e\u5e93\u8bbe\u7f6e\u4e3a 0 \u53f7\u6570\u636e\u5e93 \uff0c \u628a\u8fc1\u79fb\u7684\u8d85\u65f6\u65f6\u95f4\u8bbe\u7f6e\u4e3a timeout\u3002\u6211\u4eec\u91cd\u590d\u6267\u884c MIGRATE \u547d\u4ee4\uff0c\u628a 100 \u4e2a key \u90fd\u8fc1\u79fb\u5b8c \u3002 MIGRATE 192.168.10.5 6379 key1 0 timeout \u6700\u540e\uff0c\u6211\u4eec\u91cd\u590d\u6267\u884c\u7b2c 3 \u548c\u7b2c 4 \u6b65\uff0c\u76f4\u5230 Slot \u4e2d\u7684\u6240\u6709 key \u90fd\u8fc1\u79fb\u5b8c\u6210\u3002 \u4ece Redis 3.0.6 \u5f00\u59cb\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 KEYS \u9009\u9879\uff0c\u4e00\u6b21\u8fc1\u79fb\u591a\u4e2a key\uff08key1\u30012\u30013\uff09\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u5347\u8fc1\u79fb\u6548\u7387\u3002 MIGRATE 192.168.10.5 6379 \"\" 0 timeout KEYS key1 key2 key3 \u5bf9\u4e8e Codis \u6765\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u8fdb\u884c\u6570\u636e\u8fc1\u79fb\u3002\u5176\u4e2d\uff0c\u6211\u4eec\u628a dashboard \u7ec4\u4ef6\u7684\u8fde\u63a5\u5730\u5740\u8bbe\u7f6e\u4e3a ADDR\uff0c\u5e76\u4e14\u628a Slot 300 \u8fc1\u79fb\u5230\u7f16\u53f7\u4e3a 6 \u7684 codis server group \u4e0a\u3002 codis-admin --dashboard=ADDR -slot-action --create --sid=300 --gid=6 3\u3001\u672c\u7ae0\u95ee\u9898 3-1 \u95ee\u9898\uff1a \u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c\u6211\u4eec\u628a slave-read-only \u8bbe\u7f6e\u4e3a no\uff0c\u8ba9\u4ece\u5e93\u4e5f\u80fd\u76f4\u63a5\u5220\u9664\u6570\u636e\uff0c\u4ee5\u6b64\u6765\u907f\u514d\u8bfb\u5230\u8fc7\u671f\u6570\u636e\u3002\u4f60\u89c9\u5f97\uff0c\u8fd9\u662f\u4e00\u4e2a\u597d\u65b9\u6cd5\u5417\uff1f \u5047\u8bbe\u4ece\u5e93\u4e5f\u80fd\u76f4\u63a5\u5220\u9664\u8fc7\u671f\u6570\u636e\u7684\u8bdd\uff08\u4e5f\u5c31\u662f\u6267\u884c\u5199\u64cd\u4f5c\uff09\uff0c\u662f\u4e0d\u662f\u4e00\u4e2a\u597d\u65b9\u6cd5\uff1f\u5176\u5b9e\uff0c\u6211\u662f\u60f3\u501f\u52a9\u8fd9\u9053\u9898\u76ee\u63d0\u9192\u4f60\uff0c \u4e3b\u4ece\u590d\u5236\u4e2d\u7684\u589e\u5220\u6539\u64cd\u4f5c\u90fd\u9700\u8981\u5728\u4e3b\u5e93\u6267\u884c\uff0c\u5373\u4f7f\u4ece\u5e93\u80fd\u505a\u5220\u9664\uff0c\u4e5f\u4e0d\u8981\u5728\u4ece\u5e93\u5220\u9664\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u6570\u636e\u4e0d\u4e00\u81f4\u3002 \u4f8b\u5982\uff0c\u4e3b\u4ece\u5e93\u4e0a\u90fd\u6709 a:stock \u7684\u952e\uff0c\u5ba2\u6237\u7aef A \u7ed9\u4e3b\u5e93\u53d1\u9001\u4e00\u4e2a SET \u547d\u4ee4\uff0c\u4fee\u6539 a:stock \u7684\u503c\uff0c\u5ba2\u6237\u7aef B \u7ed9\u4ece\u5e93\u53d1\u9001\u4e86\u4e00\u4e2a SET \u547d\u4ee4\uff0c\u4e5f\u4fee\u6539 a:stock \u7684\u503c\uff0c\u6b64\u65f6\uff0c\u76f8\u540c\u952e\u7684\u503c\u5c31\u4e0d\u4e00\u6837\u4e86\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u4ece\u5e93\u5177\u5907\u6267\u884c\u5199\u64cd\u4f5c\u7684\u529f\u80fd\uff0c\u5c31\u4f1a\u5bfc\u81f4\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\u3002 \u5373\u4f7f\u4ece\u5e93\u53ef\u4ee5\u5220\u9664\u8fc7\u671f\u6570\u636e\uff0c\u4e5f\u8fd8\u4f1a\u6709\u4e0d\u4e00\u81f4\u7684\u98ce\u9669\uff0c\u6709\u4e24\u79cd\u60c5\u51b5\u3002 \u7b2c\u4e00\u79cd\u60c5\u51b5\u662f\uff0c\u5bf9\u4e8e\u5df2\u7ecf\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684 key\uff0c\u4e3b\u5e93\u5728 key \u5feb\u8981\u8fc7\u671f\u65f6\uff0c\u4f7f\u7528 expire \u547d\u4ee4\u91cd\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\uff0c\u4f8b\u5982\uff0c\u4e00\u4e2a key \u539f\u672c\u8bbe\u7f6e\u4e3a 10s \u540e\u8fc7\u671f\uff0c\u5728\u8fd8\u5269 1s \u5c31\u8981\u8fc7\u671f\u65f6\uff0c\u4e3b\u5e93\u53c8\u7528 expire \u547d\u4ee4\u5c06 key \u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a 60s \u540e\u3002\u4f46\u662f\uff0cexpire \u547d\u4ee4\u4ece\u4e3b\u5e93\u4f20\u8f93\u5230\u4ece\u5e93\u65f6\uff0c\u7531\u4e8e\u7f51\u7edc\u5ef6\u8fdf\u5bfc\u81f4\u4ece\u5e93\u6ca1\u6709\u53ca\u65f6\u6536\u5230 expire \u547d\u4ee4\uff08\u6bd4\u5982\u5ef6\u540e\u4e86 3s \u4ece\u5e93\u624d\u6536\u5230 expire \u547d\u4ee4\uff09\uff0c\u6240\u4ee5\uff0c\u4ece\u5e93\u6309\u7167\u539f\u5b9a\u7684\u8fc7\u671f\u65f6\u95f4\u5220\u9664\u4e86\u8fc7\u671f key\uff0c\u8fd9\u5c31\u5bfc\u81f4\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\u4e86\u3002 \u7b2c\u4e8c\u79cd\u60c5\u51b5\u662f\uff0c\u4e3b\u4ece\u5e93\u7684\u65f6\u949f\u4e0d\u540c\u6b65\uff0c\u5bfc\u81f4\u4e3b\u4ece\u5e93\u5220\u9664\u65f6\u95f4\u4e0d\u4e00\u81f4\u3002 \u53e6\u5916\uff0c\u5f53 slave-read-only \u8bbe\u7f6e\u4e3a no \u65f6\uff0c\u5982\u679c\u5728\u4ece\u5e93\u4e0a\u5199\u5165\u7684\u6570\u636e\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\uff0cRedis 4.0 \u524d\u7684\u7248\u672c\u4e0d\u4f1a\u5220\u9664\u8fc7\u671f\u6570\u636e\uff0c\u800c Redis 4.0 \u53ca\u4ee5\u4e0a\u7248\u672c\u4f1a\u5728\u6570\u636e\u8fc7\u671f\u540e\u5220\u9664\u3002 \u4f46\u662f\uff0c\u5bf9\u4e8e\u4e3b\u5e93\u540c\u6b65\u8fc7\u6765\u7684\u5e26\u6709\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\uff0c\u4ece\u5e93\u4ecd\u7136\u4e0d\u4f1a\u4e3b\u52a8\u8fdb\u884c\u5220\u9664\u3002 3-2 \u95ee\u9898\uff1a \u5047\u8bbe\u6211\u4eec\u5c06 min-slaves-to-write \u8bbe\u7f6e\u4e3a 1\uff0c min-slaves-max-lag \u8bbe\u7f6e\u4e3a 15s\uff0c\u54e8\u5175\u7684 down-after-milliseconds \u8bbe\u7f6e\u4e3a 10s\uff0c\u54e8\u5175\u4e3b\u4ece\u5207\u6362\u9700\u8981 5s\uff0c\u800c\u4e3b\u5e93\u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0\u5361\u4f4f\u4e86 12s\u3002\u6b64\u65f6\uff0c\u8fd8\u4f1a\u53d1\u751f\u8111\u88c2\u5417\uff1f\u4e3b\u4ece\u5207\u6362\u5b8c\u6210\u540e\uff0c\u6570\u636e\u4f1a\u4e22\u5931\u5417\uff1f \u4e3b\u5e93\u5361\u4f4f\u4e86 12s\uff0c\u8d85\u8fc7\u4e86\u54e8\u5175\u7684 down-after-milliseconds 10s \u9608\u503c\uff0c\u6240\u4ee5\uff0c \u54e8\u5175\u4f1a\u628a\u4e3b\u5e93\u5224\u65ad\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\uff0c\u5f00\u59cb\u8fdb\u884c\u4e3b\u4ece\u5207\u6362 \u3002 \u56e0\u4e3a\u4e3b\u4ece\u5207\u6362\u9700\u8981 5s\uff0c\u5728\u4e3b\u4ece\u5207\u6362\u8fc7\u7a0b\u4e2d\uff0c\u539f\u4e3b\u5e93\u6062\u590d\u6b63\u5e38\u3002 min-slaves-max-lag \u8bbe\u7f6e\u7684\u662f 15s\uff0c\u800c\u539f\u4e3b\u5e93\u5728\u5361\u4f4f 12s \u540e\u5c31\u6062\u590d\u6b63\u5e38\u4e86 \uff0c\u6240\u4ee5\u6ca1\u6709\u88ab\u7981\u6b62\u63a5\u6536\u8bf7\u6c42\uff0c\u5ba2\u6237\u7aef\u5728\u539f\u4e3b\u5e93\u6062\u590d\u540e\uff0c\u53c8\u53ef\u4ee5\u53d1\u9001\u8bf7\u6c42\u7ed9\u539f\u4e3b\u5e93 \u3002 \u4e00\u65e6\u5728\u4e3b\u4ece\u5207\u6362\u4e4b\u540e\u6709\u65b0\u4e3b\u5e93\u4e0a\u7ebf\uff0c\u5c31\u4f1a\u51fa\u73b0\u8111\u88c2 \u3002\u5982\u679c\u539f\u4e3b\u5e93\u5728\u6062\u590d\u6b63\u5e38\u540e\u5230\u964d\u7ea7\u4e3a\u4ece\u5e93\u524d\u7684\u8fd9\u6bb5\u65f6\u95f4\u5185\uff0c \u63a5\u6536\u4e86\u5199\u64cd\u4f5c\u8bf7\u6c42\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e9b\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u4e86 \u3002 3-3 \u95ee\u9898 \uff1a\u5047\u8bbe Codis \u96c6\u7fa4\u4e2d\u4fdd\u5b58\u7684 80% \u7684\u952e\u503c\u5bf9\u90fd\u662f Hash \u7c7b\u578b\uff0c\u6bcf\u4e2a Hash \u96c6\u5408\u7684\u5143\u7d20\u6570\u91cf\u5728 10 \u4e07~20 \u4e07\u4e2a\uff0c\u6bcf\u4e2a\u96c6\u5408\u5143\u7d20\u7684\u5927\u5c0f\u662f 2KB\u3002\u4f60\u89c9\u5f97\uff0c\u8fc1\u79fb\u8fd9\u6837\u7684 Hash \u96c6\u5408\u6570\u636e\uff0c\u4f1a\u5bf9 Codis \u7684\u6027\u80fd\u9020\u6210\u5f71\u54cd\u5417\uff1f \u7b54\u6848\uff1a\u5176\u5b9e\u5f71\u54cd\u4e0d\u5927\u3002\u867d\u7136\u4e00\u4e2a Hash \u96c6\u5408\u6570\u636e\u7684\u603b\u6570\u636e\u91cf\u6709 200MB ~ 400MB\uff082KB * 0.1M \u2248 200MB \u5230 2KB * 0.2M \u2248 400MB\uff09 \uff0c\u4f46\u662f Codis \u652f\u6301\u5f02\u6b65\u3001\u5206\u6279\u8fc1\u79fb\u6570\u636e\uff0c\u6240\u4ee5\uff0cCodis \u53ef\u4ee5\u628a\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u5206\u591a\u4e2a\u6279\u6b21\u8fdb\u884c\u8fc1\u79fb\uff0c\u6bcf\u6279\u6b21\u8fc1\u79fb\u7684\u6570\u636e\u91cf\u4e0d\u5927\uff0c\u6240\u4ee5\uff0c\u4e0d\u4f1a\u7ed9\u6e90\u5b9e\u4f8b\u9020\u6210\u592a\u5927\u5f71\u54cd\u3002 3-4 \u95ee\u9898 \uff1a\u5047\u8bbe\u4e00\u4e2a\u5546\u54c1\u7684\u5e93\u5b58\u91cf\u662f 800\uff0c\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u5305\u542b\u4e86 4 \u4e2a\u5b9e\u4f8b\u7684\u5207\u7247\u96c6\u7fa4\u6765\u670d\u52a1\u79d2\u6740\u8bf7\u6c42\uff0c\u6211\u4eec\u8ba9\u6bcf\u4e2a\u5b9e\u4f8b\u5404\u81ea\u7ef4\u62a4\u5e93\u5b58\u91cf 200\uff0c\u628a\u5ba2\u6237\u7aef\u7684\u79d2\u6740\u8bf7\u6c42\u5206\u53d1\u5230\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\u8fdb\u884c\u5904\u7406\uff0c\u4f60\u89c9\u5f97\u8fd9\u662f\u4e00\u4e2a\u597d\u65b9\u6cd5\u5417\uff1f \u7b54\u6848\uff1a\u8fd9\u4e2a\u65b9\u6cd5\u662f\u4e0d\u662f\u80fd\u8fbe\u5230\u4e00\u4e2a\u597d\u7684\u6548\u679c\uff0c\u4e3b\u8981\u53d6\u51b3\u4e8e\uff0c \u5ba2\u6237\u7aef\u8bf7\u6c42\u80fd\u4e0d\u80fd\u5747\u5300\u5730\u5206\u53d1\u5230\u6bcf\u4e2a\u5b9e\u4f8b\u4e0a \u3002\u5982\u679c\u53ef\u4ee5\u7684\u8bdd\uff0c\u90a3\u4e48\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u90fd\u53ef\u4ee5\u5e2e\u7740\u5206\u62c5\u4e00\u90e8\u5206\u538b\u529b\uff0c\u907f\u514d\u538b\u57ae\u5355\u4e2a\u5b9e\u4f8b\u3002 \u5728\u4fdd\u5b58\u5546\u54c1\u5e93\u5b58\u65f6\uff0ckey \u4e00\u822c\u5c31\u662f\u5546\u54c1\u7684 ID\uff0c\u6240\u4ee5\uff0c\u5ba2\u6237\u7aef\u5728\u79d2\u6740\u573a\u666f\u4e2d\u67e5\u8be2\u540c\u4e00\u4e2a\u5546\u54c1\u7684\u5e93\u5b58\u65f6\uff0c\u4f1a\u5411\u96c6\u7fa4\u8bf7\u6c42\u76f8\u540c\u7684 key\uff0c\u96c6\u7fa4\u5c31\u9700\u8981\u628a\u5ba2\u6237\u7aef\u5bf9\u540c\u4e00\u4e2a key \u7684\u8bf7\u6c42\u5747\u5300\u5730\u5206\u53d1\u5230\u591a\u4e2a\u5b9e\u4f8b\u4e0a\u3002 \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5ba2\u6237\u7aef\u548c\u5b9e\u4f8b\u95f4\u5c31\u9700\u8981\u6709\u4ee3\u7406\u5c42\u6765\u5b8c\u6210\u8bf7\u6c42\u7684\u8f6c\u53d1\u3002 \u4f8b\u5982\uff0c\u5728 Codis \u4e2d\uff0ccodis proxy \u8d1f\u8d23\u8f6c\u53d1\u8bf7\u6c42\uff0c\u90a3\u4e48\uff0c\u5982 \u679c\u6211\u4eec\u8ba9 codis proxy \u6536\u5230\u8bf7\u6c42\u540e\uff0c\u6309\u8f6e\u8be2\u7684\u65b9\u5f0f\u628a\u8bf7\u6c42\u5206\u53d1\u5230\u4e0d\u540c\u5b9e\u4f8b\u4e0a\uff08\u53ef\u4ee5\u5bf9 Codis \u8fdb\u884c\u4fee\u6539\uff0c\u589e\u52a0\u8f6c\u53d1\u89c4\u5219\uff09\uff0c\u5c31\u53ef\u4ee5\u5229\u7528\u591a\u5b9e\u4f8b\u6765\u5206\u62c5\u8bf7\u6c42\u538b\u529b\u4e86 \u3002 \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5ba2\u6237\u7aef\u548c\u5b9e\u4f8b\u95f4\u5c31\u9700\u8981\u6709\u4ee3\u7406\u5c42\u6765\u5b8c\u6210\u8bf7\u6c42\u7684\u8f6c\u53d1\u3002 \u4f8b\u5982\uff0c\u5728 Codis \u4e2d\uff0ccodis proxy \u8d1f\u8d23\u8f6c\u53d1\u8bf7\u6c42\uff0c\u90a3\u4e48\uff0c\u5982\u679c\u6211\u4eec\u8ba9 codis proxy \u6536\u5230\u8bf7\u6c42\u540e \uff0c\u6309\u8f6e\u8be2\u7684\u65b9\u5f0f\u628a\u8bf7\u6c42\u5206\u53d1\u5230\u4e0d\u540c\u5b9e\u4f8b\u4e0a\uff08\u53ef\u4ee5\u5bf9 Codis \u8fdb\u884c\u4fee\u6539\uff0c\u589e\u52a0\u8f6c\u53d1\u89c4\u5219\uff09\uff0c\u5c31\u53ef\u4ee5\u5229\u7528\u591a\u5b9e\u4f8b\u6765\u5206\u62c5\u8bf7\u6c42\u538b\u529b\u4e86\u3002 3-5 \u95ee\u9898\uff1a \u5f53\u6709\u6570\u636e\u8bbf\u95ee\u503e\u659c\u65f6\uff0c\u5982\u679c\u70ed\u70b9\u6570\u636e\u7a81\u7136\u8fc7\u671f\u4e86\uff0c\u5047\u8bbe Redis \u4e2d\u7684\u6570\u636e\u662f\u7f13\u5b58\uff0c\u6570\u636e\u7684\u6700\u7ec8\u503c\u662f\u4fdd\u5b58\u5728\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u7684\uff0c\u8fd9\u6837\u4f1a\u53d1\u751f\u4ec0\u4e48\u95ee\u9898\u5417? \u7b54\u6848\uff1a\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c \u4f1a\u53d1\u751f\u7f13\u5b58\u51fb\u7a7f\u7684\u95ee\u9898\uff0c\u4e5f\u5c31\u662f\u70ed\u70b9\u6570\u636e\u7a81\u7136\u5931\u6548\uff0c\u5bfc\u81f4\u5927\u91cf\u8bbf\u95ee\u8bf7\u6c42\u88ab\u53d1\u9001\u5230\u6570\u636e\u5e93\uff0c\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u5de8\u5927\u538b\u529b \u3002 \u6211\u4eec\u53ef\u4ee5\u91c7\u7528 \u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u7f13\u5b58\u5f02\u5e38 \u4ecb\u7ecd\u7684\u65b9\u6cd5\uff0c \u4e0d\u7ed9\u70ed\u70b9\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u8fc7\u671f\u5e26\u6765\u7684\u51fb\u7a7f\u95ee\u9898\u3002 \u9664\u6b64\u4e4b\u5916\uff0c \u6211\u4eec\u6700\u597d\u5728\u6570\u636e\u5e93\u7684\u63a5\u5165\u5c42\u589e\u52a0\u6d41\u63a7\u673a\u5236\uff0c\u4e00\u65e6\u76d1\u6d4b\u5230\u6709\u5927\u6d41\u91cf\u8bf7\u6c42\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u7acb\u523b\u5f00\u542f\u9650\u6d41\uff0c\u8fd9\u6837\u505a\u4e5f\u662f\u4e3a\u4e86\u907f\u514d\u6570\u636e\u5e93\u88ab\u5927\u6d41\u91cf\u538b\u529b\u538b\u57ae \u3002\u56e0\u4e3a\u6570\u636e\u5e93\u4e00\u65e6\u5b95\u673a\uff0c\u5c31\u4f1a\u5bf9\u6574\u4e2a\u4e1a\u52a1\u5e94\u7528\u5e26\u6765\u4e25\u91cd\u5f71\u54cd\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u5b81\u53ef\u5728\u8bf7\u6c42\u63a5\u5165\u6570\u636e\u5e93\u65f6\uff0c\u5c31\u76f4\u63a5\u62d2\u63a5\u8bf7\u6c42\u8bbf\u95ee\u3002 3-6 \u95ee\u9898\uff1a \u5982\u679c\u6211\u4eec\u91c7\u7528\u8ddf Codis \u4fdd\u5b58 Slot \u5206\u914d\u4fe1\u606f\u76f8\u7c7b\u4f3c\u7684\u65b9\u6cd5\uff0c\u628a\u96c6\u7fa4\u5b9e\u4f8b\u72b6\u6001\u4fe1\u606f\u548c Slot \u5206\u914d\u4fe1\u606f\u4fdd\u5b58\u5728\u7b2c\u4e09\u65b9\u7684\u5b58\u50a8\u7cfb\u7edf\u4e0a\uff08\u4f8b\u5982 Zookeeper\uff09\uff0c\u8fd9\u79cd\u65b9\u6cd5\u4f1a\u5bf9\u96c6\u7fa4\u89c4\u6a21\u4ea7\u751f\u4ec0\u4e48\u5f71\u54cd\u5417\uff1f \u7b54\u6848\uff1a\u5047\u8bbe\u6211\u4eec\u5c06 Zookeeper \u4f5c\u4e3a\u7b2c\u4e09\u65b9\u5b58\u50a8\u7cfb\u7edf\uff0c\u4fdd\u5b58\u96c6\u7fa4\u5b9e\u4f8b\u72b6\u6001\u4fe1\u606f\u548c Slot \u5206\u914d\u4fe1\u606f\uff0c\u90a3\u4e48\uff0c\u5b9e\u4f8b\u53ea\u9700\u8981\u548c Zookeeper \u901a\u4fe1\u4ea4\u4e92\u4fe1\u606f\uff0c\u5b9e\u4f8b\u4e4b\u95f4\u5c31\u4e0d\u9700\u8981\u53d1\u9001\u5927\u91cf\u7684\u5fc3\u8df3\u6d88\u606f\u6765\u540c\u6b65\u96c6\u7fa4\u72b6\u6001\u4e86\u3002\u8fd9\u79cd\u505a\u6cd5\u53ef\u4ee5\u51cf\u5c11\u5b9e\u4f8b\u4e4b\u95f4\u7528\u4e8e\u5fc3\u8df3\u7684\u7f51\u7edc\u901a\u4fe1\u91cf\uff0c\u6709\u52a9\u4e8e\u5b9e\u73b0\u5927\u89c4\u6a21\u96c6\u7fa4\u3002\u800c\u4e14\uff0c\u7f51\u7edc\u5e26\u5bbd\u53ef\u4ee5\u96c6\u4e2d\u7528\u5728\u670d\u52a1\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e0a\u3002 \u4e0d\u8fc7\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b9e\u4f8b\u83b7\u53d6\u6216\u66f4\u65b0\u96c6\u7fa4\u72b6\u6001\u4fe1\u606f\u65f6\uff0c\u90fd\u9700\u8981\u548c Zookeeper \u4ea4\u4e92\uff0cZookeeper \u7684\u7f51\u7edc\u901a\u4fe1\u5e26\u5bbd\u9700\u6c42\u4f1a\u589e\u52a0\u3002\u6240\u4ee5\uff0c\u91c7\u7528\u8fd9\u79cd\u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u9700\u8981\u7ed9 Zookeeper \u4fdd\u8bc1\u4e00\u5b9a\u7684\u7f51\u7edc\u5e26\u5bbd\uff0c\u907f\u514d Zookeeper \u53d7\u9650\u4e8e\u5e26\u5bbd\u800c\u65e0\u6cd5\u548c\u5b9e\u4f8b\u5feb\u901f\u901a\u4fe1\u3002 4\u3001\u5e38\u89c1\u95ee\u9898\u7b54\u7591 4-1 Redis \u548c Memcached\u3001RocksDB \u7684\u5bf9\u6bd4 Memcached \u548c RocksDB \u5206\u522b\u662f\u5178\u578b\u7684\u5185\u5b58\u952e\u503c\u6570\u636e\u5e93\u548c\u786c\u76d8\u952e\u503c\u6570\u636e\u5e93 \uff0c\u5e94\u7528\u5f97\u4e5f\u975e\u5e38\u5e7f\u6cdb\u3002\u548c Redis \u76f8\u6bd4\uff0c\u5b83\u4eec\u6709\u4ec0\u4e48\u4f18\u52bf\u548c\u4e0d\u8db3\u5462\uff1f\u662f\u5426\u53ef\u4ee5\u66ff\u4ee3 Redis \u5462\uff1f\u6211\u4eec\u6765\u804a\u4e00\u804a\u8fd9\u4e2a\u95ee\u9898\u3002 Redis \u548c Memcached \u7684\u6bd4\u8f83 \u548c Redis \u76f8\u4f3c\uff0cMemcached \u4e5f\u7ecf\u5e38\u88ab\u5f53\u505a\u7f13\u5b58\u6765\u4f7f\u7528\u3002 \u4e0d\u8fc7\uff0cMemcached \u6709\u4e00\u4e2a\u660e\u663e\u7684\u4f18\u52bf\uff0c\u5c31\u662f\u5b83\u7684\u96c6\u7fa4\u89c4\u6a21\u53ef\u4ee5\u5f88\u5927\u3002 Memcached \u96c6\u7fa4\u5e76\u4e0d\u662f\u50cf Redis Cluster \u6216 Codis \u90a3\u6837\uff0c\u4f7f\u7528 Slot \u6620\u5c04\u6765\u5206\u914d\u6570\u636e\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u4fdd\u5b58\u5173\u7cfb\uff0c \u800c\u662f\u4f7f\u7528\u4e00\u81f4\u6027\u54c8\u5e0c\u7b97\u6cd5\u628a\u6570\u636e\u5206\u6563\u4fdd\u5b58\u5230\u591a\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u800c\u4e00\u81f4\u6027\u54c8\u5e0c\u7684\u4f18\u52bf\u5c31\u662f\u53ef\u4ee5\u652f\u6301\u5927\u89c4\u6a21\u7684\u96c6\u7fa4 \u3002\u6240\u4ee5\uff0c\u5982\u679c\u6211\u4eec\u9700\u8981\u90e8\u7f72\u5927\u89c4\u6a21\u7f13\u5b58\u96c6\u7fa4\uff0cMemcached \u4f1a\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002 \u4e0d\u8fc7\uff0c\u5728\u4f7f\u7528 Memcached \u65f6\uff0c\u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\uff0cMemcached \u652f\u6301\u7684\u6570\u636e\u7c7b\u578b\u6bd4 Redis \u5c11\u5f88\u591a\u3002 Memcached \u53ea\u652f\u6301 String \u7c7b\u578b\u7684\u952e\u503c\u5bf9\uff0c\u800c Redis \u53ef\u4ee5\u652f\u6301\u5305\u62ec String \u5728\u5185\u7684\u591a\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u5f53\u4e1a\u52a1\u5e94\u7528\u6709\u4e30\u5bcc\u7684\u6570\u636e\u7c7b\u578b\u8981\u4fdd\u5b58\u7684\u8bdd\uff0c\u4f7f\u7528 Memcached \u4f5c\u4e3a\u66ff\u6362\u65b9\u6848\u7684\u4f18\u52bf\u5c31\u6ca1\u6709\u4e86\u3002 \u5982\u679c\u4f60\u65e2\u9700\u8981\u4fdd\u5b58\u591a\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u53c8\u5e0c\u671b\u6709\u4e00\u5b9a\u7684\u96c6\u7fa4\u89c4\u6a21\u4fdd\u5b58\u5927\u91cf\u6570\u636e\uff0c\u90a3\u4e48\uff0cRedis \u4ecd\u7136\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u65b9\u6848\u3002 4-2 Redis \u548c RocksDB \u7684\u6bd4\u8f83 \u548c Redis \u4e0d\u540c\uff0c RocksDB \u53ef\u4ee5\u628a\u6570\u636e\u76f4\u63a5\u4fdd\u5b58\u5230\u786c\u76d8\u4e0a\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5355\u4e2a RocksDB \u53ef\u4ee5\u4fdd\u5b58\u7684\u6570\u636e\u91cf\u8981\u6bd4 Redis \u591a\u5f88\u591a\uff0c\u800c\u4e14\u6570\u636e\u90fd\u80fd\u6301\u4e45\u5316\u4fdd\u5b58\u4e0b\u6765 \u3002 \u9664\u6b64\u4e4b\u5916\uff0c RocksDB \u8fd8\u80fd\u652f\u6301\u8868\u7ed3\u6784\uff08\u5373\u5217\u65cf\u7ed3\u6784\uff09\uff0c\u800c Redis \u7684\u57fa\u672c\u6570\u636e\u6a21\u578b\u5c31\u662f\u952e\u503c\u5bf9 \u3002\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u9700\u8981\u4e00\u4e2a\u5927\u5bb9\u91cf\u7684\u6301\u4e45\u5316\u952e\u503c\u6570\u636e\u5e93\uff0c\u5e76\u4e14\u80fd\u6309\u7167\u4e00\u5b9a\u8868\u7ed3\u6784\u4fdd\u5b58\u6570\u636e\uff0cRocksDB \u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u66ff\u4ee3\u65b9\u6848\u3002 \u4e0d\u8fc7\uff0cRocksDB \u6bd5\u7adf\u662f\u8981\u628a\u6570\u636e\u5199\u5165\u5e95\u5c42\u786c\u76d8\u8fdb\u884c\u4fdd\u5b58\u7684\uff0c\u800c\u4e14\u5728\u8fdb\u884c\u6570\u636e\u67e5\u8be2\u65f6\uff0c\u5982\u679c RocksDB \u8981\u8bfb\u53d6\u7684\u6570\u636e\u6ca1\u6709\u5728\u5185\u5b58\u4e2d\u7f13\u5b58\uff0c\u90a3\u4e48\uff0cRocksDB \u5c31\u9700\u8981\u5230\u786c\u76d8\u4e0a\u7684\u6587\u4ef6\u4e2d\u8fdb\u884c\u67e5\u627e\uff0c\u8fd9\u4f1a\u62d6\u6162 RocksDB \u7684\u8bfb\u5199\u5ef6\u8fdf\uff0c\u964d\u4f4e\u5e26\u5bbd\u3002 \u5728\u6027\u80fd\u65b9\u9762\uff0cRocksDB \u662f\u6bd4\u4e0d\u4e0a Redis \u7684\u3002 \u800c\u4e14\uff0cRocksDB \u53ea\u662f\u4e00\u4e2a\u52a8\u6001\u94fe\u63a5\u5e93\uff0c\u5e76\u6ca1\u6709\u50cf Redis \u90a3\u6837\u63d0\u4f9b\u4e86\u5ba2\u6237\u7aef - \u670d\u52a1\u5668\u7aef\u8bbf\u95ee\u6a21\u5f0f\uff0c\u4ee5\u53ca\u4e3b\u4ece\u96c6\u7fa4\u548c\u5207\u7247\u96c6\u7fa4\u7684\u529f\u80fd\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u5728\u4f7f\u7528 RocksDB \u66ff\u4ee3 Redis \u65f6\uff0c\u9700\u8981\u7ed3\u5408\u4e1a\u52a1\u9700\u6c42\u91cd\u70b9\u8003\u8651\u66ff\u6362\u7684\u53ef\u884c\u6027\u3002 \u96c6\u7fa4\u90e8\u7f72\u548c\u8fd0\u7ef4\u6d89\u53ca\u7684\u5de5\u4f5c\u91cf\u975e\u5e38\u5927\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u4e00\u5b9a\u8981\u91cd\u89c6\u96c6\u7fa4\u65b9\u6848\u7684\u9009\u62e9\u3002 \u96c6\u7fa4\u7684\u53ef\u6269\u5c55\u6027\u662f\u6211\u4eec\u8bc4\u4f30\u96c6\u7fa4\u65b9\u6848\u7684\u4e00\u4e2a\u91cd\u8981\u7ef4\u5ea6 \uff0c\u96c6\u7fa4\u4e2d\u5143\u6570\u636e\u662f\u7528 Slot \u6620\u5c04\u8868\uff0c\u8fd8\u662f\u4e00\u81f4\u6027\u54c8\u5e0c\u7ef4\u62a4\u7684\u3002\u5982\u679c\u662f Slot \u6620\u5c04\u8868\uff0c\u90a3\u4e48\uff0c\u662f\u7528\u4e2d\u5fc3\u5316\u7684\u7b2c\u4e09\u65b9\u5b58\u50a8\u7cfb\u7edf\u6765\u4fdd\u5b58\uff0c\u8fd8\u662f\u7531\u5404\u4e2a\u5b9e\u4f8b\u6765\u6269\u6563\u4fdd\u5b58\uff0c\u8fd9\u4e5f\u662f\u9700\u8981\u8003\u8651\u6e05\u695a\u7684\u3002Redis Cluster\u3001Codis \u548c Memcached \u91c7\u7528\u7684\u65b9\u5f0f\u5404\u4e0d\u76f8\u540c\u3002 Redis Cluster\uff1a\u4f7f\u7528 Slot \u6620\u5c04\u8868\u5e76\u7531\u5b9e\u4f8b\u6269\u6563\u4fdd\u5b58 \u3002 Codis\uff1a\u4f7f\u7528 Slot \u6620\u5c04\u8868\u5e76\u7531\u7b2c\u4e09\u65b9\u5b58\u50a8\u7cfb\u7edf\u4fdd\u5b58\u3002 Memcached\uff1a\u4f7f\u7528\u4e00\u81f4\u6027\u54c8\u5e0c\u3002","title":"\u7b2c\u4e03\u7ae0 Redis Cluster\u96c6\u7fa4\u4ecb\u7ecd\u53ca\u7ba1\u7406"},{"location":"chap7/7Redis_cluster_summary/#redis-cluster","text":"","title":"\u7b2c\u4e03\u7ae0 Redis Cluster\u96c6\u7fa4\u4ecb\u7ecd\u53ca\u7ba1\u7406"},{"location":"chap7/7Redis_cluster_summary/#1","text":"","title":"1\u3001\u672c\u7ae0\u5c0f\u7ed3"},{"location":"chap7/7Redis_cluster_summary/#1-1-redis","text":"Redis \u4e3b\u4ece\u5e93\u540c\u6b65\u65f6\u53ef\u80fd\u51fa\u73b0\u7684 3 \u4e2a\u5751\uff0c\u5206\u522b\u662f\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\u3001\u8bfb\u53d6\u5230\u8fc7\u671f\u6570\u636e\u548c\u4e0d\u5408\u7406\u914d\u7f6e\u9879\u5bfc\u81f4\u670d\u52a1\u6302\u6389\u3002 \u5173\u4e8e\u4e3b\u4ece\u5e93\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\uff1a Redis \u4e2d\u7684 slave-serve-stale-data \u914d\u7f6e\u9879\u8bbe\u7f6e\u4e86\u4ece\u5e93\u80fd\u5426\u5904\u7406\u6570\u636e\u8bfb\u5199\u547d\u4ee4\uff0c\u4f60\u53ef\u4ee5\u628a\u5b83\u8bbe\u7f6e\u4e3a no \u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4ece\u5e93\u53ea\u80fd\u670d\u52a1 INFO\u3001SLAVEOF \u547d\u4ee4\uff0c\u8fd9\u5c31\u53ef\u4ee5\u907f\u514d\u5728\u4ece\u5e93\u4e2d\u8bfb\u5230\u4e0d\u4e00\u81f4\u7684\u6570\u636e\u4e86\u3002 \u8fd9\u4e2a\u914d\u7f6e\u9879\u548c slave-read-only \u7684\u533a\u522b\uff0c slave-read-only \u662f\u8bbe\u7f6e\u4ece\u5e93\u80fd\u5426\u5904\u7406\u5199\u547d\u4ee4\uff0c slave-read-only \u8bbe\u7f6e\u4e3a yes \u65f6\uff0c\u4ece\u5e93\u53ea\u80fd\u5904\u7406\u8bfb\u8bf7\u6c42\uff0c\u65e0\u6cd5\u5904\u7406\u5199\u8bf7\u6c42\uff0c\u4f60\u53ef\u4e0d\u8981\u641e\u6df7\u4e86\u3002","title":"1-1 Redis\u4e3b\u4ece\u540c\u6b65\u4e0e\u6545\u969c\u5207\u6362\u7684\u4e09\u4e2a\u5751"},{"location":"chap7/7Redis_cluster_summary/#1-2","text":"\u8111\u88c2\u662f\u6307\u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c\u540c\u65f6\u6709\u4e24\u4e2a\u4e3b\u5e93\u90fd\u80fd\u63a5\u6536\u5199\u8bf7\u6c42\u3002\u5728 Redis \u7684\u4e3b\u4ece\u5207\u6362\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u53d1\u751f\u4e86\u8111\u88c2\uff0c\u5ba2\u6237\u7aef\u6570\u636e\u5c31\u4f1a\u5199\u5165\u5230\u539f\u4e3b\u5e93\uff0c\u5982\u679c\u539f\u4e3b\u5e93\u88ab\u964d\u4e3a\u4ece\u5e93\uff0c\u8fd9\u4e9b\u65b0\u5199\u5165\u7684\u6570\u636e\u5c31\u4e22\u5931\u4e86\u3002 \u8111\u88c2\u53d1\u751f\u7684\u539f\u56e0\u4e3b\u8981\u662f\u539f\u4e3b\u5e93\u53d1\u751f\u4e86\u5047\u6545\u969c\uff0c\u603b\u7ed3\u4e0b\u5047\u6545\u969c\u7684\u4e24\u4e2a\u539f\u56e0\u3002 \u548c\u4e3b\u5e93\u90e8\u7f72\u5728\u540c\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u7684\u5176\u4ed6\u7a0b\u5e8f\u4e34\u65f6\u5360\u7528\u4e86\u5927\u91cf\u8d44\u6e90\uff08\u4f8b\u5982 CPU \u8d44\u6e90\uff09\uff0c\u5bfc\u81f4\u4e3b\u5e93\u8d44\u6e90\u4f7f\u7528\u53d7\u9650\uff0c\u77ed\u65f6\u95f4\u5185\u65e0\u6cd5\u54cd\u5e94\u5fc3\u8df3 \u3002\u5176\u5b83\u7a0b\u5e8f\u4e0d\u518d\u4f7f\u7528\u8d44\u6e90\u65f6\uff0c\u4e3b\u5e93\u53c8\u6062\u590d\u6b63\u5e38\u3002 \u4e3b\u5e93\u81ea\u8eab\u9047\u5230\u4e86\u963b\u585e\u7684\u60c5\u51b5\uff0c\u4f8b\u5982\uff0c\u5904\u7406 bigkey \u6216\u662f\u53d1\u751f\u5185\u5b58 swap\uff0c\u77ed\u65f6\u95f4\u5185\u65e0\u6cd5\u54cd\u5e94\u5fc3\u8df3\uff0c\u7b49\u4e3b\u5e93\u963b\u585e\u89e3\u9664\u540e\uff0c\u53c8\u6062\u590d\u6b63\u5e38\u7684\u8bf7\u6c42\u5904\u7406\u4e86\u3002 \u4e3a\u4e86\u5e94\u5bf9\u8111\u88c2\uff0c\u53ef\u4ee5\u5728\u4e3b\u4ece\u96c6\u7fa4\u90e8\u7f72\u65f6\uff0c\u901a\u8fc7\u5408\u7406\u5730\u914d\u7f6e\u53c2\u6570 min-slaves-to-write \u548c min-slaves-max-lag \uff0c\u6765\u9884\u9632\u8111\u88c2\u7684\u53d1\u751f\u3002 \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u53ef\u80fd\u4f1a\u56e0\u4e3a\u7f51\u7edc\u6682\u65f6\u62e5\u585e\u5bfc\u81f4\u4ece\u5e93\u6682\u65f6\u548c\u4e3b\u5e93\u7684 ACK \u6d88\u606f\u8d85\u65f6\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5e76\u4e0d\u662f\u4e3b\u5e93\u5047\u6545\u969c\uff0c\u6211\u4eec\u4e5f\u4e0d\u7528\u7981\u6b62\u4e3b\u5e93\u63a5\u6536\u8bf7\u6c42\u3002 \u5efa\u8bae\u662f\uff0c\u5047\u8bbe\u4ece\u5e93\u6709 K \u4e2a\uff0c\u53ef\u4ee5\u5c06 min-slaves-to-write \u8bbe\u7f6e\u4e3a K/2+1 \uff08\u5982\u679c K \u7b49\u4e8e 1\uff0c\u5c31\u8bbe\u4e3a 1\uff09\uff0c\u5c06 min-slaves-max-lag \u8bbe\u7f6e\u4e3a\u5341\u51e0\u79d2\uff08\u4f8b\u5982 10\uff5e20s\uff09\uff0c\u5728\u8fd9\u4e2a\u914d\u7f6e\u4e0b\uff0c\u5982\u679c\u6709\u4e00\u534a\u4ee5\u4e0a\u7684\u4ece\u5e93\u548c\u4e3b\u5e93\u8fdb\u884c\u7684 ACK \u6d88\u606f\u5ef6\u8fdf\u8d85\u8fc7\u5341\u51e0\u79d2\uff0c\u6211\u4eec\u5c31\u7981\u6b62\u4e3b\u5e93\u63a5\u6536\u5ba2\u6237\u7aef\u5199\u8bf7\u6c42 \u3002 \u907f\u514d\u8111\u88c2\u5e26\u6765\u6570\u636e\u4e22\u5931\u7684\u60c5\u51b5\uff0c\u800c\u4e14\uff0c\u4e5f\u4e0d\u4f1a\u56e0\u4e3a\u53ea\u6709\u5c11\u6570\u51e0\u4e2a\u4ece\u5e93\u56e0\u4e3a\u7f51\u7edc\u963b\u585e\u8fde\u4e0d\u4e0a\u4e3b\u5e93\uff0c\u5c31\u7981\u6b62\u4e3b\u5e93\u63a5\u6536\u8bf7\u6c42\uff0c\u589e\u52a0\u4e86\u7cfb\u7edf\u7684\u9c81\u68d2\u6027\u3002","title":"1-2 \u8111\u88c2\u5bfc\u81f4\u6570\u636e\u4e22\u5931"},{"location":"chap7/7Redis_cluster_summary/#1-3-redis-codis","text":"Codis \u96c6\u7fa4\u5305\u542b codis server\u3001codis proxy\u3001Zookeeper\u3001codis dashboard \u548c codis fe \u8fd9\u56db\u5927\u7c7b\u7ec4\u4ef6\u3002 codis proxy \u548c codis server \u8d1f\u8d23\u5904\u7406\u6570\u636e\u8bfb\u5199\u8bf7\u6c42\uff0c\u5176\u4e2d\uff0ccodis proxy \u548c\u5ba2\u6237\u7aef\u8fde\u63a5\uff0c\u63a5\u6536\u8bf7\u6c42\uff0c\u5e76\u8f6c\u53d1\u8bf7\u6c42\u7ed9 codis server\uff0c\u800c codis server \u8d1f\u8d23\u5177\u4f53\u5904\u7406\u8bf7\u6c42\u3002 codis dashboard \u548c codis fe \u8d1f\u8d23\u96c6\u7fa4\u7ba1\u7406\uff0c\u5176\u4e2d\uff0ccodis dashboard \u6267\u884c\u7ba1\u7406\u64cd\u4f5c\uff0c\u800c codis fe \u63d0\u4f9b Web \u7ba1\u7406\u754c\u9762\u3002 Zookeeper \u96c6\u7fa4\u8d1f\u8d23\u4fdd\u5b58\u96c6\u7fa4\u7684\u6240\u6709\u5143\u6570\u636e\u4fe1\u606f\uff0c\u5305\u62ec\u8def\u7531\u8868\u3001proxy \u5b9e\u4f8b\u4fe1\u606f\u7b49\u3002\u8fd9\u91cc\uff0c\u6709\u4e2a\u5730\u65b9\u9700\u8981\u4f60\u6ce8\u610f\uff0c\u9664\u4e86\u4f7f\u7528 Zookeeper\uff0cCodis \u8fd8\u53ef\u4ee5\u4f7f\u7528 etcd \u6216\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u4fdd\u5b58\u5143\u6570\u636e\u4fe1\u606f\u3002 \u5173\u4e8e Codis \u548c Redis Cluster \u7684\u9009\u578b\u8003\u8651\uff0c\u4ece\u7a33\u5b9a\u6027\u6210\u719f\u5ea6\u3001\u5ba2\u6237\u7aef\u517c\u5bb9\u6027\u3001Redis \u65b0\u7279\u6027\u4f7f\u7528\u4ee5\u53ca\u6570\u636e\u8fc1\u79fb\u6027\u80fd\u56db\u4e2a\u65b9\u9762\u7ed9\u4f60\u63d0\u4f9b\u4e86\u5efa\u8bae\u3002 \u6211\u518d\u7ed9\u4f60\u63d0\u4f9b\u4e00\u4e2a Codis \u4f7f\u7528\u4e0a\u7684\u5c0f\u5efa\u8bae\uff1a \u5f53\u4f60\u6709\u591a\u6761\u4e1a\u52a1\u7ebf\u8981\u4f7f\u7528 Codis \u65f6\uff0c\u53ef\u4ee5\u542f\u52a8\u591a\u4e2a codis dashboard\uff0c\u6bcf\u4e2a dashboard \u7ba1\u7406\u4e00\u90e8\u5206 codis server\uff0c\u540c\u65f6\uff0c\u518d\u7528\u4e00\u4e2a dashboard \u5bf9\u5e94\u8d1f\u8d23\u4e00\u4e2a\u4e1a\u52a1\u7ebf\u7684\u96c6\u7fa4\u7ba1\u7406\uff0c\u8fd9\u6837\uff0c\u5c31\u53ef\u4ee5\u505a\u5230\u7528\u4e00\u4e2a Codis \u96c6\u7fa4\u5b9e\u73b0\u591a\u6761\u4e1a\u52a1\u7ebf\u7684\u9694\u79bb\u7ba1\u7406\u4e86 \u3002","title":"1-3 Redis Codis \u96c6\u7fa4\u65b9\u6848"},{"location":"chap7/7Redis_cluster_summary/#1-4-redis","text":"\u79d2\u6740\u573a\u666f\u6709 2 \u4e2a\u8d1f\u8f7d\u7279\u5f81\uff0c\u5206\u522b\u662f\u77ac\u65f6 \u9ad8\u5e76\u53d1\u8bf7\u6c42\u548c\u8bfb\u591a\u5199\u5c11 \u3002Redis \u826f\u597d\u7684\u9ad8\u5e76\u53d1\u5904\u7406\u80fd\u529b\uff0c\u4ee5\u53ca\u9ad8\u6548\u7684\u952e\u503c\u5bf9\u8bfb\u5199\u7279\u6027\uff0c\u6b63\u597d\u53ef\u4ee5\u6ee1\u8db3\u79d2\u6740\u573a\u666f\u7684\u9700\u6c42\u3002 \u5728\u79d2\u6740\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u524d\u7aef CDN \u548c\u6d4f\u89c8\u5668\u7f13\u5b58\u62e6\u622a\u5927\u91cf\u79d2\u6740\u524d\u7684\u8bf7\u6c42\u3002\u5728\u5b9e\u9645\u79d2\u6740\u6d3b\u52a8\u8fdb\u884c\u65f6\uff0c\u5e93\u5b58\u67e5\u9a8c\u548c\u5e93\u5b58\u6263\u51cf\u662f\u627f\u53d7\u5de8\u5927\u5e76\u53d1\u8bf7\u6c42\u538b\u529b\u7684\u4e24\u4e2a\u64cd\u4f5c\uff0c\u540c\u65f6\uff0c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7684\u6267\u884c\u9700\u8981\u4fdd\u8bc1\u539f\u5b50\u6027\u3002Redis \u7684\u539f\u5b50\u64cd\u4f5c\u3001\u5206\u5e03\u5f0f\u9501\u8fd9\u4e24\u4e2a\u529f\u80fd\u7279\u6027\u53ef\u4ee5\u6709\u6548\u5730\u6765\u652f\u6491\u79d2\u6740\u573a\u666f\u7684\u9700\u6c42\u3002 \u5f53\u7136\uff0c\u5bf9\u4e8e\u79d2\u6740\u573a\u666f\u6765\u8bf4\uff0c\u53ea\u7528 Redis \u662f\u4e0d\u591f\u7684\u3002\u79d2\u6740\u7cfb\u7edf\u662f\u4e00\u4e2a\u7cfb\u7edf\u6027\u5de5\u7a0b\uff0cRedis \u5b9e\u73b0\u4e86\u5bf9\u5e93\u5b58\u67e5\u9a8c\u548c\u6263\u51cf\u8fd9\u4e2a\u73af\u8282\u7684\u652f\u6491\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u6709 4 \u4e2a\u73af\u8282\u9700\u8981\u6211\u4eec\u5904\u7406\u597d\u3002 \u524d\u7aef\u9759\u6001\u9875\u9762\u7684\u8bbe\u8ba1 \u3002\u79d2\u6740\u9875\u9762\u4e0a\u80fd\u9759\u6001\u5316\u5904\u7406\u7684\u9875\u9762\u5143\u7d20\uff0c\u6211\u4eec\u90fd\u8981\u5c3d\u91cf\u9759\u6001\u5316\uff0c\u8fd9\u6837\u53ef\u4ee5\u5145\u5206\u5229\u7528 CDN \u6216\u6d4f\u89c8\u5668\u7f13\u5b58\u670d\u52a1\u79d2\u6740\u5f00\u59cb\u524d\u7684\u8bf7\u6c42\u3002 \u8bf7\u6c42\u62e6\u622a\u548c\u6d41\u63a7 \u3002\u5728\u79d2\u6740\u7cfb\u7edf\u7684\u63a5\u5165\u5c42\uff0c\u5bf9\u6076\u610f\u8bf7\u6c42\u8fdb\u884c\u62e6\u622a\uff0c\u907f\u514d\u5bf9\u7cfb\u7edf\u7684\u6076\u610f\u653b\u51fb\uff0c\u4f8b\u5982\u4f7f\u7528\u9ed1\u540d\u5355\u7981\u6b62\u6076\u610f IP \u8fdb\u884c\u8bbf\u95ee\u3002\u5982\u679c Redis \u5b9e\u4f8b\u7684\u8bbf\u95ee\u538b\u529b\u8fc7\u5927\uff0c\u4e3a\u4e86\u907f\u514d\u5b9e\u4f8b\u5d29\u6e83\uff0c\u6211\u4eec\u4e5f\u9700\u8981\u5728\u63a5\u5165\u5c42\u8fdb\u884c\u9650\u6d41\uff0c\u63a7\u5236\u8fdb\u5165\u79d2\u6740\u7cfb\u7edf\u7684\u8bf7\u6c42\u6570\u91cf\u3002 \u5e93\u5b58\u4fe1\u606f\u8fc7\u671f\u65f6\u95f4\u5904\u7406 \u3002Redis \u4e2d\u4fdd\u5b58\u7684\u5e93\u5b58\u4fe1\u606f\u5176\u5b9e\u662f\u6570\u636e\u5e93\u7684\u7f13\u5b58\uff0c\u4e3a\u4e86\u907f\u514d\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898\uff0c\u6211\u4eec\u4e0d\u8981\u7ed9\u5e93\u5b58\u4fe1\u606f\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002 \u6570\u636e\u5e93\u8ba2\u5355\u5f02\u5e38\u5904\u7406 \u3002\u5982\u679c\u6570\u636e\u5e93\u6ca1\u80fd\u6210\u529f\u5904\u7406\u8ba2\u5355\uff0c\u53ef\u4ee5\u589e\u52a0\u8ba2\u5355\u91cd\u8bd5\u529f\u80fd\uff0c\u4fdd\u8bc1\u8ba2\u5355\u6700\u7ec8\u80fd\u88ab\u6210\u529f\u5904\u7406\u3002 \u5efa\u8bae\uff1a \u79d2\u6740\u6d3b\u52a8\u5e26\u6765\u7684\u8bf7\u6c42\u6d41\u91cf\u5de8\u5927\uff0c\u6211\u4eec\u9700\u8981\u628a\u79d2\u6740\u5546\u54c1\u7684\u5e93\u5b58\u4fe1\u606f\u7528\u5355\u72ec\u7684\u5b9e\u4f8b\u4fdd\u5b58\uff0c\u800c\u4e0d\u8981\u548c\u65e5\u5e38\u4e1a\u52a1\u7cfb\u7edf\u7684\u6570\u636e\u4fdd\u5b58\u5728\u540c\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u5e72\u6270\u4e1a\u52a1\u7cfb\u7edf\u7684\u6b63\u5e38\u8fd0\u884c\u3002","title":"1-4  Redis\u652f\u6491\u79d2\u6740\u573a\u666f\u7684\u5173\u952e\u6280\u672f\u548c\u5b9e\u8df5"},{"location":"chap7/7Redis_cluster_summary/#1-5","text":"\u6570\u636e\u503e\u659c\u7684\u4e24\u79cd\u60c5\u51b5\uff1a\u6570\u636e\u91cf\u503e\u659c\u548c\u6570\u636e\u8bbf\u95ee\u503e\u659c\u3002 \u9020\u6210\u6570\u636e\u91cf\u503e\u659c\u7684\u539f\u56e0\u4e3b\u8981\u6709\u4e09\u4e2a\uff1a \u6570\u636e\u4e2d\u6709 bigkey\uff0c\u5bfc\u81f4\u67d0\u4e2a\u5b9e\u4f8b\u7684\u6570\u636e\u91cf\u589e\u52a0\uff1b Slot \u624b\u5de5\u5206\u914d\u4e0d\u5747\uff0c\u5bfc\u81f4\u67d0\u4e2a\u6216\u67d0\u4e9b\u5b9e\u4f8b\u4e0a\u6709\u5927\u91cf\u6570\u636e\uff1b \u4f7f\u7528\u4e86 Hash Tag\uff0c\u5bfc\u81f4\u6570\u636e\u96c6\u4e2d\u5230\u67d0\u4e9b\u5b9e\u4f8b\u4e0a\u3002 \u800c\u6570\u636e\u8bbf\u95ee\u503e\u659c\u7684\u4e3b\u8981\u539f\u56e0\u5c31\u662f \u6709\u70ed\u70b9\u6570\u636e\u5b58\u5728\uff0c\u5bfc\u81f4\u5927\u91cf\u8bbf\u95ee\u8bf7\u6c42\u96c6\u4e2d\u5230\u4e86\u70ed\u70b9\u6570\u636e\u6240\u5728\u7684\u5b9e\u4f8b\u4e0a\u3002 \u4e3a\u4e86\u5e94\u5bf9\u6570\u636e\u503e\u659c\u95ee\u9898\uff0c\u56db\u4e2a\u65b9\u6cd5\uff0c \u5982\u679c\u5df2\u7ecf\u53d1\u751f\u4e86\u6570\u636e\u503e\u659c\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6570\u636e\u8fc1\u79fb\u6765\u7f13\u89e3\u6570\u636e\u503e\u659c\u7684\u5f71\u54cd\u3002Redis Cluster \u548c Codis \u96c6\u7fa4\u90fd\u63d0\u4f9b\u4e86\u67e5\u770b Slot \u5206\u914d\u548c\u624b\u5de5\u8fc1\u79fb Slot \u7684\u547d\u4ee4\uff0c\u4f60\u53ef\u4ee5\u628a\u5b83\u4eec\u5e94\u7528\u8d77\u6765\u3002 \u5173\u4e8e\u96c6\u7fa4\u7684\u5b9e\u4f8b\u8d44\u6e90\u914d\u7f6e\uff0c\u4e00\u4e2a\u5c0f\u5efa\u8bae\uff1a \u5728\u6784\u5efa\u5207\u7247\u96c6\u7fa4\u65f6\uff0c\u5c3d\u91cf\u4f7f\u7528\u5927\u5c0f\u914d\u7f6e\u76f8\u540c\u7684\u5b9e\u4f8b\uff08\u4f8b\u5982\u5b9e\u4f8b\u5185\u5b58\u914d\u7f6e\u4fdd\u6301\u76f8\u540c\uff09\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u56e0\u5b9e\u4f8b\u8d44\u6e90\u4e0d\u5747\u8861\u800c\u5728\u4e0d\u540c\u5b9e\u4f8b\u4e0a\u5206\u914d\u4e0d\u540c\u6570\u91cf\u7684 Slot\u3002","title":"1-5 \u6570\u636e\u5206\u5e03\u4f18\u5316\u5e94\u5bf9\u6570\u636e\u503e\u659c"},{"location":"chap7/7Redis_cluster_summary/#1-6-redis-cluster","text":"Redis Cluster \u5b9e\u4f8b\u95f4\u4ee5 Gossip \u534f\u8bae\u8fdb\u884c\u901a\u4fe1\u7684\u673a\u5236\u3002Redis Cluster \u8fd0\u884c\u65f6\uff0c\u5404\u5b9e\u4f8b\u95f4\u9700\u8981\u901a\u8fc7 PING\u3001PONG \u6d88\u606f\u8fdb\u884c\u4fe1\u606f\u4ea4\u6362\uff0c\u8fd9\u4e9b\u5fc3\u8df3\u6d88\u606f\u5305\u542b\u4e86\u5f53\u524d\u5b9e\u4f8b\u548c\u90e8\u5206\u5176\u5b83\u5b9e\u4f8b\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u4ee5\u53ca Slot \u5206\u914d\u4fe1\u606f\u3002\u8fd9\u79cd\u901a\u4fe1\u673a\u5236\u6709\u52a9\u4e8e Redis Cluster \u4e2d\u7684\u6240\u6709\u5b9e\u4f8b\u90fd\u62e5\u6709\u5b8c\u6574\u7684\u96c6\u7fa4\u72b6\u6001\u4fe1\u606f\u3002 \u4f46\u662f\uff0c\u968f\u7740\u96c6\u7fa4\u89c4\u6a21\u7684\u589e\u52a0\uff0c\u5b9e\u4f8b\u95f4\u7684\u901a\u4fe1\u91cf\u4e5f\u4f1a\u589e\u52a0\u3002 \u5982\u679c\u6211\u4eec\u76f2\u76ee\u5730\u5bf9 Redis Cluster \u8fdb\u884c\u6269\u5bb9\uff0c\u5c31\u53ef\u80fd\u4f1a\u9047\u5230\u96c6\u7fa4\u6027\u80fd\u53d8\u6162\u7684\u60c5\u51b5\u3002\u8fd9\u662f\u56e0\u4e3a\uff0c\u96c6\u7fa4\u4e2d\u5927\u89c4\u6a21\u7684\u5b9e\u4f8b\u95f4\u5fc3\u8df3\u6d88\u606f\u4f1a\u6324\u5360\u96c6\u7fa4\u5904\u7406\u6b63\u5e38\u8bf7\u6c42\u7684\u5e26\u5bbd\u3002\u800c\u4e14\uff0c\u6709\u4e9b\u5b9e\u4f8b\u53ef\u80fd\u56e0\u4e3a\u7f51\u7edc\u62e5\u585e\u5bfc\u81f4\u65e0\u6cd5\u53ca\u65f6\u6536\u5230 PONG \u6d88\u606f\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u5728\u8fd0\u884c\u65f6\u4f1a\u5468\u671f\u6027\u5730\uff08\u6bcf\u79d2 10 \u6b21\uff09\u68c0\u6d4b\u662f\u5426\u6709\u8fd9\u79cd\u60c5\u51b5\u53d1\u751f\uff0c\u4e00\u65e6\u53d1\u751f\uff0c\u5c31\u4f1a\u7acb\u5373\u7ed9\u8fd9\u4e9b PONG \u6d88\u606f\u8d85\u65f6\u7684\u5b9e\u4f8b\u53d1\u9001\u5fc3\u8df3\u6d88\u606f \u3002 \u96c6\u7fa4\u89c4\u6a21\u8d8a\u5927\uff0c\u7f51\u7edc\u62e5\u585e\u7684\u6982\u7387\u5c31\u8d8a\u9ad8\uff0c\u76f8\u5e94\u7684\uff0cPONG \u6d88\u606f\u8d85\u65f6\u7684\u53d1\u751f\u6982\u7387\u5c31\u8d8a\u9ad8\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u96c6\u7fa4\u4e2d\u6709\u5927\u91cf\u7684\u5fc3\u8df3\u6d88\u606f\uff0c\u5f71\u54cd\u96c6\u7fa4\u670d\u52a1\u6b63\u5e38\u8bf7\u6c42\u3002 \u5efa\u8bae\uff0c\u867d\u7136\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574 cluster-node-timeout \u914d\u7f6e\u9879\u51cf\u5c11\u5fc3\u8df3\u6d88\u606f\u7684\u5360\u7528\u5e26\u5bbd\u60c5\u51b5\uff0c\u4f46\u662f\uff0c \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u5982\u679c\u4e0d\u662f\u7279\u522b\u9700\u8981\u5927\u5bb9\u91cf\u96c6\u7fa4\uff0c\u6211\u5efa\u8bae\u4f60\u628a Redis Cluster \u7684\u89c4\u6a21\u63a7\u5236\u5728 400~500 \u4e2a\u5b9e\u4f8b\u3002 \u5047\u8bbe\u5355\u4e2a\u5b9e\u4f8b\u6bcf\u79d2\u80fd\u652f\u6491 8 \u4e07\u8bf7\u6c42\u64cd\u4f5c\uff088 \u4e07 QPS\uff09\uff0c\u6bcf\u4e2a\u4e3b\u5b9e\u4f8b\u914d\u7f6e 1 \u4e2a\u4ece\u5b9e\u4f8b\uff0c\u90a3\u4e48\uff0c 400~ 500 \u4e2a\u5b9e\u4f8b\u53ef\u652f\u6301 1600 \u4e07~2000 \u4e07 QPS\uff08 200/250 \u4e2a\u4e3b\u5b9e\u4f8b *8 \u4e07 QPS=1600/2000 \u4e07 QPS \uff09\uff0c\u8fd9\u4e2a\u541e\u5410\u91cf\u6027\u80fd\u53ef\u4ee5\u6ee1\u8db3\u4e0d\u5c11\u4e1a\u52a1\u5e94\u7528\u7684\u9700\u6c42\u3002","title":"1-6 \u9650\u5236Redis Cluster\u89c4\u6a21\u7684\u5173\u952e\u56e0\u7d20\uff1a\u901a\u4fe1\u5f00\u9500"},{"location":"chap7/7Redis_cluster_summary/#2","text":"","title":"2\u3001\u672c\u7ae0\u64cd\u4f5c\u603b\u7ed3"},{"location":"chap7/7Redis_cluster_summary/#2-1-redis","text":"\u7b2c\u4e00\u4e2a\u4f8b\u5b50\u662f\u4f7f\u7528 EXPIRE \u547d\u4ee4\uff0c\u5f53\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0c \u6211\u4eec\u5c31\u628a testkey \u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a 60s \u540e\u3002 EXPIRE testkey 60 \u7b2c\u4e8c\u4e2a\u4f8b\u5b50\u662f\u4f7f\u7528 EXPIREAT \u547d\u4ee4\uff0c\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c \u5c31\u53ef\u4ee5\u8ba9 testkey \u5728 2020 \u5e74 10 \u6708 24 \u65e5\u4e0a\u5348 9 \u70b9\u8fc7\u671f\uff0c\u547d\u4ee4\u4e2d\u7684 1603501200 \u5c31\u662f\u4ee5\u79d2\u6570\u65f6\u95f4\u6233\u8868\u793a\u7684 10 \u6708 24 \u65e5\u4e0a\u5348 9 \u70b9 EXPIREAT testkey 1603501200 protected-mode \u914d\u7f6e\u9879 \u5728\u5e94\u7528\u4e3b\u4ece\u96c6\u7fa4\u65f6\uff0c\u8981\u6ce8\u610f\u5c06 protected-mode \u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a no\uff0c\u5e76\u4e14\u5c06 bind \u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a\u5176\u5b83\u54e8\u5175\u5b9e\u4f8b\u7684 IP \u5730\u5740\u3002 \u53ea\u6709\u5728 bind \u4e2d\u8bbe\u7f6e\u4e86 IP \u5730\u5740\u7684\u54e8\u5175\uff0c\u624d\u53ef\u4ee5\u8bbf\u95ee\u5f53\u524d\u5b9e\u4f8b\uff0c\u65e2\u4fdd\u8bc1\u4e86\u5b9e\u4f8b\u95f4\u80fd\u591f\u901a\u4fe1\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u4e5f\u4fdd\u8bc1\u4e86\u54e8\u5175\u7684\u5b89\u5168\u6027\u3002 \u5982\u679c\u8bbe\u7f6e\u4e86\u4e0b\u9762\u7684\u914d\u7f6e\u9879\uff0c\u90a3\u4e48\uff0c\u90e8\u7f72\u5728 192.168.10.3/4/5 \u8fd9\u4e09\u53f0\u670d\u52a1\u5668\u4e0a\u7684\u54e8\u5175\u5b9e\u4f8b\u5c31\u53ef\u4ee5\u76f8\u4e92\u901a\u4fe1\uff0c\u6267\u884c\u4e3b\u4ece\u5207\u6362\u3002 protected-mode no bind 192.168.10.3 192.168.10.4 192.168.10.5","title":"2-1 Redis\u4e3b\u4ece\u540c\u6b65\u4e0e\u6545\u969c\u5207\u6362\u7684\u4e09\u4e2a\u5751"},{"location":"chap7/7Redis_cluster_summary/#2-2","text":"Redis \u5df2\u7ecf\u63d0\u4f9b\u4e86\u4e24\u4e2a\u914d\u7f6e\u9879\u6765\u9650\u5236\u4e3b\u5e93\u7684\u8bf7\u6c42\u5904\u7406\uff0c\u5206\u522b\u662f min-slaves-to-write \u548c min-slaves-max-lag \u3002 min-slaves-to-write \uff1a\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e86 \u4e3b\u5e93\u80fd\u8fdb\u884c\u6570\u636e\u540c\u6b65\u7684\u6700\u5c11\u4ece\u5e93\u6570\u91cf \uff1b min-slaves-max-lag \uff1a\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e86 \u4e3b\u4ece\u5e93\u95f4\u8fdb\u884c\u6570\u636e\u590d\u5236\u65f6\uff0c\u4ece\u5e93\u7ed9\u4e3b\u5e93\u53d1\u9001 ACK \u6d88\u606f\u7684\u6700\u5927\u5ef6\u8fdf\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09 \u3002 \u53ef\u4ee5\u628a min-slaves-to-write \u548c min-slaves-max-lag \u8fd9\u4e24\u4e2a\u914d\u7f6e\u9879\u642d\u914d\u8d77\u6765\u4f7f\u7528\uff0c\u5206\u522b\u7ed9\u5b83\u4eec\u8bbe\u7f6e\u4e00\u5b9a\u7684\u9608\u503c\uff0c\u5047\u8bbe\u4e3a N \u548c T \u3002 \u5047\u8bbe\u6211\u4eec\u5c06 min-slaves-to-write \u8bbe\u7f6e\u4e3a 1 \u628a min-slaves-max-lag \u8bbe\u7f6e\u4e3a 12s \u628a\u54e8\u5175\u7684 down-after-milliseconds \u8bbe\u7f6e\u4e3a 10s","title":"2-2 \u8111\u88c2\u5bfc\u81f4\u6570\u636e\u4e22\u5931"},{"location":"chap7/7Redis_cluster_summary/#2-5","text":"\u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u6267\u884c CLUSTER SLOTS \u547d\u4ee4\u67e5\u770b Slot \u5206\u914d\u60c5\u51b5\u3002 \u547d\u4ee4\u8fd4\u56de\u7ed3\u679c\u663e\u793a\uff0c Slot 0 \u5230 Slot 4095 \u88ab\u5206\u914d\u5230\u4e86\u5b9e\u4f8b 192.168.10.3 \u4e0a\uff0c\u800c Slot 12288 \u5230 Slot 16383 \u88ab\u5206\u914d\u5230\u4e86\u5b9e\u4f8b 192.168.10.5 \u4e0a\u3002 127.0.0.1:6379> cluster slots 1) 1) (integer) 0 2) (integer) 4095 3) 1) \"192.168.10.3\" 2) (integer) 6379 2) 1) (integer) 12288 2) (integer) 16383 3) 1) \"192.168.10.5\" 2) (integer) 6379 \u5982\u679c\u67d0\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\u6709\u592a\u591a\u7684 Slot\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u8fc1\u79fb\u547d\u4ee4\u628a\u8fd9\u4e9b Slot \u8fc1\u79fb\u5230\u5176\u5b83\u5b9e\u4f8b\u4e0a\u3002 \u5728 Redis Cluster \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 3 \u4e2a\u547d\u4ee4\u5b8c\u6210 Slot \u8fc1\u79fb\u3002 CLUSTER SETSLOT \uff1a\u4f7f\u7528\u4e0d\u540c\u7684\u9009\u9879\u8fdb\u884c\u4e09\u79cd\u8bbe\u7f6e\uff0c\u5206\u522b\u662f\u8bbe\u7f6e Slot \u8981\u8fc1\u5165\u7684\u76ee\u6807\u5b9e\u4f8b\uff0cSlot \u8981\u8fc1\u51fa\u7684\u6e90\u5b9e\u4f8b\uff0c\u4ee5\u53ca Slot \u6240\u5c5e\u7684\u5b9e\u4f8b\u3002 CLUSTER GETKEYSINSLOT \uff1a \u83b7\u53d6\u67d0\u4e2a Slot \u4e2d\u4e00\u5b9a\u6570\u91cf\u7684 key \u3002 MIGRATE \uff1a\u628a\u4e00\u4e2a key \u4ece\u6e90\u5b9e\u4f8b\u5b9e\u9645\u8fc1\u79fb\u5230\u76ee\u6807\u5b9e\u4f8b\u3002 4 \u5047\u8bbe\u6211\u4eec\u8981\u628a Slot 300 \u4ece\u6e90\u5b9e\u4f8b\uff08ID \u4e3a 3\uff09\u8fc1\u79fb\u5230\u76ee\u6807\u5b9e\u4f8b\uff08ID \u4e3a 5\uff09\uff0c\u90a3\u8981\u600e\u4e48\u505a\u5462\uff1f \u5b9e\u9645\u4e0a\uff0c\u53ef\u4ee5\u5206\u6210 5 \u6b65\u3002 \u7b2c 1 \u6b65\uff0c\u5148 \u5728\u76ee\u6807\u5b9e\u4f8b 5 \u4e0a\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4 \uff0c \u5c06 Slot 300 \u7684\u6e90\u5b9e\u4f8b\u8bbe\u7f6e\u4e3a\u5b9e\u4f8b 3\uff0c\u8868\u793a\u8981\u4ece\u5b9e\u4f8b 3 \u4e0a\u8fc1\u5165 Slot 300\u3002 CLUSTER SETSLOT 300 IMPORTING 3 \u7b2c 2 \u6b65\uff0c \u5728\u6e90\u5b9e\u4f8b 3 \u4e0a\uff0c\u6211\u4eec\u628a Slot 300 \u7684\u76ee\u6807\u5b9e\u4f8b\u8bbe\u7f6e\u4e3a 5\uff0c\u8fd9\u8868\u793a\uff0cSlot 300 \u8981\u8fc1\u51fa\u5230\u5b9e\u4f8b 5 \u4e0a \uff0c\u5982\u4e0b\u6240\u793a\uff1a CLUSTER SETSLOT 300 MIGRATING 5 \u7b2c 3 \u6b65\uff0c \u4ece Slot 300 \u4e2d\u83b7\u53d6 100 \u4e2a key\u3002\u56e0\u4e3a Slot \u4e2d\u7684 key \u6570\u91cf\u53ef\u80fd\u5f88\u591a\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5728\u5ba2\u6237\u7aef\u4e0a\u591a\u6b21\u6267\u884c\u4e0b\u9762\u7684\u8fd9\u6761\u547d\u4ee4\uff0c\u5206\u6279\u6b21\u83b7\u5f97\u5e76\u8fc1\u79fb key \u3002 CLUSTER GETKEYSINSLOT 300 100 \u7b2c 4 \u6b65\uff0c\u6211\u4eec\u628a\u521a\u624d\u83b7\u53d6\u7684 100 \u4e2a key \u4e2d\u7684 key1 \u8fc1\u79fb\u5230\u76ee\u6807\u5b9e\u4f8b 5 \u4e0a\uff08IP \u4e3a 192.168.10.5\uff09\uff0c \u540c\u65f6\u628a\u8981\u8fc1\u5165\u7684\u6570\u636e\u5e93\u8bbe\u7f6e\u4e3a 0 \u53f7\u6570\u636e\u5e93 \uff0c \u628a\u8fc1\u79fb\u7684\u8d85\u65f6\u65f6\u95f4\u8bbe\u7f6e\u4e3a timeout\u3002\u6211\u4eec\u91cd\u590d\u6267\u884c MIGRATE \u547d\u4ee4\uff0c\u628a 100 \u4e2a key \u90fd\u8fc1\u79fb\u5b8c \u3002 MIGRATE 192.168.10.5 6379 key1 0 timeout \u6700\u540e\uff0c\u6211\u4eec\u91cd\u590d\u6267\u884c\u7b2c 3 \u548c\u7b2c 4 \u6b65\uff0c\u76f4\u5230 Slot \u4e2d\u7684\u6240\u6709 key \u90fd\u8fc1\u79fb\u5b8c\u6210\u3002 \u4ece Redis 3.0.6 \u5f00\u59cb\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 KEYS \u9009\u9879\uff0c\u4e00\u6b21\u8fc1\u79fb\u591a\u4e2a key\uff08key1\u30012\u30013\uff09\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u5347\u8fc1\u79fb\u6548\u7387\u3002 MIGRATE 192.168.10.5 6379 \"\" 0 timeout KEYS key1 key2 key3 \u5bf9\u4e8e Codis \u6765\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u8fdb\u884c\u6570\u636e\u8fc1\u79fb\u3002\u5176\u4e2d\uff0c\u6211\u4eec\u628a dashboard \u7ec4\u4ef6\u7684\u8fde\u63a5\u5730\u5740\u8bbe\u7f6e\u4e3a ADDR\uff0c\u5e76\u4e14\u628a Slot 300 \u8fc1\u79fb\u5230\u7f16\u53f7\u4e3a 6 \u7684 codis server group \u4e0a\u3002 codis-admin --dashboard=ADDR -slot-action --create --sid=300 --gid=6","title":"2-5 \u6570\u636e\u5206\u5e03\u4f18\u5316\u5e94\u5bf9\u6570\u636e\u503e\u659c"},{"location":"chap7/7Redis_cluster_summary/#3","text":"3-1 \u95ee\u9898\uff1a \u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c\u6211\u4eec\u628a slave-read-only \u8bbe\u7f6e\u4e3a no\uff0c\u8ba9\u4ece\u5e93\u4e5f\u80fd\u76f4\u63a5\u5220\u9664\u6570\u636e\uff0c\u4ee5\u6b64\u6765\u907f\u514d\u8bfb\u5230\u8fc7\u671f\u6570\u636e\u3002\u4f60\u89c9\u5f97\uff0c\u8fd9\u662f\u4e00\u4e2a\u597d\u65b9\u6cd5\u5417\uff1f \u5047\u8bbe\u4ece\u5e93\u4e5f\u80fd\u76f4\u63a5\u5220\u9664\u8fc7\u671f\u6570\u636e\u7684\u8bdd\uff08\u4e5f\u5c31\u662f\u6267\u884c\u5199\u64cd\u4f5c\uff09\uff0c\u662f\u4e0d\u662f\u4e00\u4e2a\u597d\u65b9\u6cd5\uff1f\u5176\u5b9e\uff0c\u6211\u662f\u60f3\u501f\u52a9\u8fd9\u9053\u9898\u76ee\u63d0\u9192\u4f60\uff0c \u4e3b\u4ece\u590d\u5236\u4e2d\u7684\u589e\u5220\u6539\u64cd\u4f5c\u90fd\u9700\u8981\u5728\u4e3b\u5e93\u6267\u884c\uff0c\u5373\u4f7f\u4ece\u5e93\u80fd\u505a\u5220\u9664\uff0c\u4e5f\u4e0d\u8981\u5728\u4ece\u5e93\u5220\u9664\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u6570\u636e\u4e0d\u4e00\u81f4\u3002 \u4f8b\u5982\uff0c\u4e3b\u4ece\u5e93\u4e0a\u90fd\u6709 a:stock \u7684\u952e\uff0c\u5ba2\u6237\u7aef A \u7ed9\u4e3b\u5e93\u53d1\u9001\u4e00\u4e2a SET \u547d\u4ee4\uff0c\u4fee\u6539 a:stock \u7684\u503c\uff0c\u5ba2\u6237\u7aef B \u7ed9\u4ece\u5e93\u53d1\u9001\u4e86\u4e00\u4e2a SET \u547d\u4ee4\uff0c\u4e5f\u4fee\u6539 a:stock \u7684\u503c\uff0c\u6b64\u65f6\uff0c\u76f8\u540c\u952e\u7684\u503c\u5c31\u4e0d\u4e00\u6837\u4e86\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u4ece\u5e93\u5177\u5907\u6267\u884c\u5199\u64cd\u4f5c\u7684\u529f\u80fd\uff0c\u5c31\u4f1a\u5bfc\u81f4\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\u3002 \u5373\u4f7f\u4ece\u5e93\u53ef\u4ee5\u5220\u9664\u8fc7\u671f\u6570\u636e\uff0c\u4e5f\u8fd8\u4f1a\u6709\u4e0d\u4e00\u81f4\u7684\u98ce\u9669\uff0c\u6709\u4e24\u79cd\u60c5\u51b5\u3002 \u7b2c\u4e00\u79cd\u60c5\u51b5\u662f\uff0c\u5bf9\u4e8e\u5df2\u7ecf\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684 key\uff0c\u4e3b\u5e93\u5728 key \u5feb\u8981\u8fc7\u671f\u65f6\uff0c\u4f7f\u7528 expire \u547d\u4ee4\u91cd\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\uff0c\u4f8b\u5982\uff0c\u4e00\u4e2a key \u539f\u672c\u8bbe\u7f6e\u4e3a 10s \u540e\u8fc7\u671f\uff0c\u5728\u8fd8\u5269 1s \u5c31\u8981\u8fc7\u671f\u65f6\uff0c\u4e3b\u5e93\u53c8\u7528 expire \u547d\u4ee4\u5c06 key \u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a 60s \u540e\u3002\u4f46\u662f\uff0cexpire \u547d\u4ee4\u4ece\u4e3b\u5e93\u4f20\u8f93\u5230\u4ece\u5e93\u65f6\uff0c\u7531\u4e8e\u7f51\u7edc\u5ef6\u8fdf\u5bfc\u81f4\u4ece\u5e93\u6ca1\u6709\u53ca\u65f6\u6536\u5230 expire \u547d\u4ee4\uff08\u6bd4\u5982\u5ef6\u540e\u4e86 3s \u4ece\u5e93\u624d\u6536\u5230 expire \u547d\u4ee4\uff09\uff0c\u6240\u4ee5\uff0c\u4ece\u5e93\u6309\u7167\u539f\u5b9a\u7684\u8fc7\u671f\u65f6\u95f4\u5220\u9664\u4e86\u8fc7\u671f key\uff0c\u8fd9\u5c31\u5bfc\u81f4\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\u4e86\u3002 \u7b2c\u4e8c\u79cd\u60c5\u51b5\u662f\uff0c\u4e3b\u4ece\u5e93\u7684\u65f6\u949f\u4e0d\u540c\u6b65\uff0c\u5bfc\u81f4\u4e3b\u4ece\u5e93\u5220\u9664\u65f6\u95f4\u4e0d\u4e00\u81f4\u3002 \u53e6\u5916\uff0c\u5f53 slave-read-only \u8bbe\u7f6e\u4e3a no \u65f6\uff0c\u5982\u679c\u5728\u4ece\u5e93\u4e0a\u5199\u5165\u7684\u6570\u636e\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\uff0cRedis 4.0 \u524d\u7684\u7248\u672c\u4e0d\u4f1a\u5220\u9664\u8fc7\u671f\u6570\u636e\uff0c\u800c Redis 4.0 \u53ca\u4ee5\u4e0a\u7248\u672c\u4f1a\u5728\u6570\u636e\u8fc7\u671f\u540e\u5220\u9664\u3002 \u4f46\u662f\uff0c\u5bf9\u4e8e\u4e3b\u5e93\u540c\u6b65\u8fc7\u6765\u7684\u5e26\u6709\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\uff0c\u4ece\u5e93\u4ecd\u7136\u4e0d\u4f1a\u4e3b\u52a8\u8fdb\u884c\u5220\u9664\u3002 3-2 \u95ee\u9898\uff1a \u5047\u8bbe\u6211\u4eec\u5c06 min-slaves-to-write \u8bbe\u7f6e\u4e3a 1\uff0c min-slaves-max-lag \u8bbe\u7f6e\u4e3a 15s\uff0c\u54e8\u5175\u7684 down-after-milliseconds \u8bbe\u7f6e\u4e3a 10s\uff0c\u54e8\u5175\u4e3b\u4ece\u5207\u6362\u9700\u8981 5s\uff0c\u800c\u4e3b\u5e93\u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0\u5361\u4f4f\u4e86 12s\u3002\u6b64\u65f6\uff0c\u8fd8\u4f1a\u53d1\u751f\u8111\u88c2\u5417\uff1f\u4e3b\u4ece\u5207\u6362\u5b8c\u6210\u540e\uff0c\u6570\u636e\u4f1a\u4e22\u5931\u5417\uff1f \u4e3b\u5e93\u5361\u4f4f\u4e86 12s\uff0c\u8d85\u8fc7\u4e86\u54e8\u5175\u7684 down-after-milliseconds 10s \u9608\u503c\uff0c\u6240\u4ee5\uff0c \u54e8\u5175\u4f1a\u628a\u4e3b\u5e93\u5224\u65ad\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\uff0c\u5f00\u59cb\u8fdb\u884c\u4e3b\u4ece\u5207\u6362 \u3002 \u56e0\u4e3a\u4e3b\u4ece\u5207\u6362\u9700\u8981 5s\uff0c\u5728\u4e3b\u4ece\u5207\u6362\u8fc7\u7a0b\u4e2d\uff0c\u539f\u4e3b\u5e93\u6062\u590d\u6b63\u5e38\u3002 min-slaves-max-lag \u8bbe\u7f6e\u7684\u662f 15s\uff0c\u800c\u539f\u4e3b\u5e93\u5728\u5361\u4f4f 12s \u540e\u5c31\u6062\u590d\u6b63\u5e38\u4e86 \uff0c\u6240\u4ee5\u6ca1\u6709\u88ab\u7981\u6b62\u63a5\u6536\u8bf7\u6c42\uff0c\u5ba2\u6237\u7aef\u5728\u539f\u4e3b\u5e93\u6062\u590d\u540e\uff0c\u53c8\u53ef\u4ee5\u53d1\u9001\u8bf7\u6c42\u7ed9\u539f\u4e3b\u5e93 \u3002 \u4e00\u65e6\u5728\u4e3b\u4ece\u5207\u6362\u4e4b\u540e\u6709\u65b0\u4e3b\u5e93\u4e0a\u7ebf\uff0c\u5c31\u4f1a\u51fa\u73b0\u8111\u88c2 \u3002\u5982\u679c\u539f\u4e3b\u5e93\u5728\u6062\u590d\u6b63\u5e38\u540e\u5230\u964d\u7ea7\u4e3a\u4ece\u5e93\u524d\u7684\u8fd9\u6bb5\u65f6\u95f4\u5185\uff0c \u63a5\u6536\u4e86\u5199\u64cd\u4f5c\u8bf7\u6c42\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e9b\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u4e86 \u3002 3-3 \u95ee\u9898 \uff1a\u5047\u8bbe Codis \u96c6\u7fa4\u4e2d\u4fdd\u5b58\u7684 80% \u7684\u952e\u503c\u5bf9\u90fd\u662f Hash \u7c7b\u578b\uff0c\u6bcf\u4e2a Hash \u96c6\u5408\u7684\u5143\u7d20\u6570\u91cf\u5728 10 \u4e07~20 \u4e07\u4e2a\uff0c\u6bcf\u4e2a\u96c6\u5408\u5143\u7d20\u7684\u5927\u5c0f\u662f 2KB\u3002\u4f60\u89c9\u5f97\uff0c\u8fc1\u79fb\u8fd9\u6837\u7684 Hash \u96c6\u5408\u6570\u636e\uff0c\u4f1a\u5bf9 Codis \u7684\u6027\u80fd\u9020\u6210\u5f71\u54cd\u5417\uff1f \u7b54\u6848\uff1a\u5176\u5b9e\u5f71\u54cd\u4e0d\u5927\u3002\u867d\u7136\u4e00\u4e2a Hash \u96c6\u5408\u6570\u636e\u7684\u603b\u6570\u636e\u91cf\u6709 200MB ~ 400MB\uff082KB * 0.1M \u2248 200MB \u5230 2KB * 0.2M \u2248 400MB\uff09 \uff0c\u4f46\u662f Codis \u652f\u6301\u5f02\u6b65\u3001\u5206\u6279\u8fc1\u79fb\u6570\u636e\uff0c\u6240\u4ee5\uff0cCodis \u53ef\u4ee5\u628a\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u5206\u591a\u4e2a\u6279\u6b21\u8fdb\u884c\u8fc1\u79fb\uff0c\u6bcf\u6279\u6b21\u8fc1\u79fb\u7684\u6570\u636e\u91cf\u4e0d\u5927\uff0c\u6240\u4ee5\uff0c\u4e0d\u4f1a\u7ed9\u6e90\u5b9e\u4f8b\u9020\u6210\u592a\u5927\u5f71\u54cd\u3002 3-4 \u95ee\u9898 \uff1a\u5047\u8bbe\u4e00\u4e2a\u5546\u54c1\u7684\u5e93\u5b58\u91cf\u662f 800\uff0c\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u5305\u542b\u4e86 4 \u4e2a\u5b9e\u4f8b\u7684\u5207\u7247\u96c6\u7fa4\u6765\u670d\u52a1\u79d2\u6740\u8bf7\u6c42\uff0c\u6211\u4eec\u8ba9\u6bcf\u4e2a\u5b9e\u4f8b\u5404\u81ea\u7ef4\u62a4\u5e93\u5b58\u91cf 200\uff0c\u628a\u5ba2\u6237\u7aef\u7684\u79d2\u6740\u8bf7\u6c42\u5206\u53d1\u5230\u4e0d\u540c\u7684\u5b9e\u4f8b\u4e0a\u8fdb\u884c\u5904\u7406\uff0c\u4f60\u89c9\u5f97\u8fd9\u662f\u4e00\u4e2a\u597d\u65b9\u6cd5\u5417\uff1f \u7b54\u6848\uff1a\u8fd9\u4e2a\u65b9\u6cd5\u662f\u4e0d\u662f\u80fd\u8fbe\u5230\u4e00\u4e2a\u597d\u7684\u6548\u679c\uff0c\u4e3b\u8981\u53d6\u51b3\u4e8e\uff0c \u5ba2\u6237\u7aef\u8bf7\u6c42\u80fd\u4e0d\u80fd\u5747\u5300\u5730\u5206\u53d1\u5230\u6bcf\u4e2a\u5b9e\u4f8b\u4e0a \u3002\u5982\u679c\u53ef\u4ee5\u7684\u8bdd\uff0c\u90a3\u4e48\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u90fd\u53ef\u4ee5\u5e2e\u7740\u5206\u62c5\u4e00\u90e8\u5206\u538b\u529b\uff0c\u907f\u514d\u538b\u57ae\u5355\u4e2a\u5b9e\u4f8b\u3002 \u5728\u4fdd\u5b58\u5546\u54c1\u5e93\u5b58\u65f6\uff0ckey \u4e00\u822c\u5c31\u662f\u5546\u54c1\u7684 ID\uff0c\u6240\u4ee5\uff0c\u5ba2\u6237\u7aef\u5728\u79d2\u6740\u573a\u666f\u4e2d\u67e5\u8be2\u540c\u4e00\u4e2a\u5546\u54c1\u7684\u5e93\u5b58\u65f6\uff0c\u4f1a\u5411\u96c6\u7fa4\u8bf7\u6c42\u76f8\u540c\u7684 key\uff0c\u96c6\u7fa4\u5c31\u9700\u8981\u628a\u5ba2\u6237\u7aef\u5bf9\u540c\u4e00\u4e2a key \u7684\u8bf7\u6c42\u5747\u5300\u5730\u5206\u53d1\u5230\u591a\u4e2a\u5b9e\u4f8b\u4e0a\u3002 \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5ba2\u6237\u7aef\u548c\u5b9e\u4f8b\u95f4\u5c31\u9700\u8981\u6709\u4ee3\u7406\u5c42\u6765\u5b8c\u6210\u8bf7\u6c42\u7684\u8f6c\u53d1\u3002 \u4f8b\u5982\uff0c\u5728 Codis \u4e2d\uff0ccodis proxy \u8d1f\u8d23\u8f6c\u53d1\u8bf7\u6c42\uff0c\u90a3\u4e48\uff0c\u5982 \u679c\u6211\u4eec\u8ba9 codis proxy \u6536\u5230\u8bf7\u6c42\u540e\uff0c\u6309\u8f6e\u8be2\u7684\u65b9\u5f0f\u628a\u8bf7\u6c42\u5206\u53d1\u5230\u4e0d\u540c\u5b9e\u4f8b\u4e0a\uff08\u53ef\u4ee5\u5bf9 Codis \u8fdb\u884c\u4fee\u6539\uff0c\u589e\u52a0\u8f6c\u53d1\u89c4\u5219\uff09\uff0c\u5c31\u53ef\u4ee5\u5229\u7528\u591a\u5b9e\u4f8b\u6765\u5206\u62c5\u8bf7\u6c42\u538b\u529b\u4e86 \u3002 \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5ba2\u6237\u7aef\u548c\u5b9e\u4f8b\u95f4\u5c31\u9700\u8981\u6709\u4ee3\u7406\u5c42\u6765\u5b8c\u6210\u8bf7\u6c42\u7684\u8f6c\u53d1\u3002 \u4f8b\u5982\uff0c\u5728 Codis \u4e2d\uff0ccodis proxy \u8d1f\u8d23\u8f6c\u53d1\u8bf7\u6c42\uff0c\u90a3\u4e48\uff0c\u5982\u679c\u6211\u4eec\u8ba9 codis proxy \u6536\u5230\u8bf7\u6c42\u540e \uff0c\u6309\u8f6e\u8be2\u7684\u65b9\u5f0f\u628a\u8bf7\u6c42\u5206\u53d1\u5230\u4e0d\u540c\u5b9e\u4f8b\u4e0a\uff08\u53ef\u4ee5\u5bf9 Codis \u8fdb\u884c\u4fee\u6539\uff0c\u589e\u52a0\u8f6c\u53d1\u89c4\u5219\uff09\uff0c\u5c31\u53ef\u4ee5\u5229\u7528\u591a\u5b9e\u4f8b\u6765\u5206\u62c5\u8bf7\u6c42\u538b\u529b\u4e86\u3002 3-5 \u95ee\u9898\uff1a \u5f53\u6709\u6570\u636e\u8bbf\u95ee\u503e\u659c\u65f6\uff0c\u5982\u679c\u70ed\u70b9\u6570\u636e\u7a81\u7136\u8fc7\u671f\u4e86\uff0c\u5047\u8bbe Redis \u4e2d\u7684\u6570\u636e\u662f\u7f13\u5b58\uff0c\u6570\u636e\u7684\u6700\u7ec8\u503c\u662f\u4fdd\u5b58\u5728\u540e\u7aef\u6570\u636e\u5e93\u4e2d\u7684\uff0c\u8fd9\u6837\u4f1a\u53d1\u751f\u4ec0\u4e48\u95ee\u9898\u5417? \u7b54\u6848\uff1a\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c \u4f1a\u53d1\u751f\u7f13\u5b58\u51fb\u7a7f\u7684\u95ee\u9898\uff0c\u4e5f\u5c31\u662f\u70ed\u70b9\u6570\u636e\u7a81\u7136\u5931\u6548\uff0c\u5bfc\u81f4\u5927\u91cf\u8bbf\u95ee\u8bf7\u6c42\u88ab\u53d1\u9001\u5230\u6570\u636e\u5e93\uff0c\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u5de8\u5927\u538b\u529b \u3002 \u6211\u4eec\u53ef\u4ee5\u91c7\u7528 \u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u7f13\u5b58\u5f02\u5e38 \u4ecb\u7ecd\u7684\u65b9\u6cd5\uff0c \u4e0d\u7ed9\u70ed\u70b9\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u8fc7\u671f\u5e26\u6765\u7684\u51fb\u7a7f\u95ee\u9898\u3002 \u9664\u6b64\u4e4b\u5916\uff0c \u6211\u4eec\u6700\u597d\u5728\u6570\u636e\u5e93\u7684\u63a5\u5165\u5c42\u589e\u52a0\u6d41\u63a7\u673a\u5236\uff0c\u4e00\u65e6\u76d1\u6d4b\u5230\u6709\u5927\u6d41\u91cf\u8bf7\u6c42\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u7acb\u523b\u5f00\u542f\u9650\u6d41\uff0c\u8fd9\u6837\u505a\u4e5f\u662f\u4e3a\u4e86\u907f\u514d\u6570\u636e\u5e93\u88ab\u5927\u6d41\u91cf\u538b\u529b\u538b\u57ae \u3002\u56e0\u4e3a\u6570\u636e\u5e93\u4e00\u65e6\u5b95\u673a\uff0c\u5c31\u4f1a\u5bf9\u6574\u4e2a\u4e1a\u52a1\u5e94\u7528\u5e26\u6765\u4e25\u91cd\u5f71\u54cd\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u5b81\u53ef\u5728\u8bf7\u6c42\u63a5\u5165\u6570\u636e\u5e93\u65f6\uff0c\u5c31\u76f4\u63a5\u62d2\u63a5\u8bf7\u6c42\u8bbf\u95ee\u3002 3-6 \u95ee\u9898\uff1a \u5982\u679c\u6211\u4eec\u91c7\u7528\u8ddf Codis \u4fdd\u5b58 Slot \u5206\u914d\u4fe1\u606f\u76f8\u7c7b\u4f3c\u7684\u65b9\u6cd5\uff0c\u628a\u96c6\u7fa4\u5b9e\u4f8b\u72b6\u6001\u4fe1\u606f\u548c Slot \u5206\u914d\u4fe1\u606f\u4fdd\u5b58\u5728\u7b2c\u4e09\u65b9\u7684\u5b58\u50a8\u7cfb\u7edf\u4e0a\uff08\u4f8b\u5982 Zookeeper\uff09\uff0c\u8fd9\u79cd\u65b9\u6cd5\u4f1a\u5bf9\u96c6\u7fa4\u89c4\u6a21\u4ea7\u751f\u4ec0\u4e48\u5f71\u54cd\u5417\uff1f \u7b54\u6848\uff1a\u5047\u8bbe\u6211\u4eec\u5c06 Zookeeper \u4f5c\u4e3a\u7b2c\u4e09\u65b9\u5b58\u50a8\u7cfb\u7edf\uff0c\u4fdd\u5b58\u96c6\u7fa4\u5b9e\u4f8b\u72b6\u6001\u4fe1\u606f\u548c Slot \u5206\u914d\u4fe1\u606f\uff0c\u90a3\u4e48\uff0c\u5b9e\u4f8b\u53ea\u9700\u8981\u548c Zookeeper \u901a\u4fe1\u4ea4\u4e92\u4fe1\u606f\uff0c\u5b9e\u4f8b\u4e4b\u95f4\u5c31\u4e0d\u9700\u8981\u53d1\u9001\u5927\u91cf\u7684\u5fc3\u8df3\u6d88\u606f\u6765\u540c\u6b65\u96c6\u7fa4\u72b6\u6001\u4e86\u3002\u8fd9\u79cd\u505a\u6cd5\u53ef\u4ee5\u51cf\u5c11\u5b9e\u4f8b\u4e4b\u95f4\u7528\u4e8e\u5fc3\u8df3\u7684\u7f51\u7edc\u901a\u4fe1\u91cf\uff0c\u6709\u52a9\u4e8e\u5b9e\u73b0\u5927\u89c4\u6a21\u96c6\u7fa4\u3002\u800c\u4e14\uff0c\u7f51\u7edc\u5e26\u5bbd\u53ef\u4ee5\u96c6\u4e2d\u7528\u5728\u670d\u52a1\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e0a\u3002 \u4e0d\u8fc7\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b9e\u4f8b\u83b7\u53d6\u6216\u66f4\u65b0\u96c6\u7fa4\u72b6\u6001\u4fe1\u606f\u65f6\uff0c\u90fd\u9700\u8981\u548c Zookeeper \u4ea4\u4e92\uff0cZookeeper \u7684\u7f51\u7edc\u901a\u4fe1\u5e26\u5bbd\u9700\u6c42\u4f1a\u589e\u52a0\u3002\u6240\u4ee5\uff0c\u91c7\u7528\u8fd9\u79cd\u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u9700\u8981\u7ed9 Zookeeper \u4fdd\u8bc1\u4e00\u5b9a\u7684\u7f51\u7edc\u5e26\u5bbd\uff0c\u907f\u514d Zookeeper \u53d7\u9650\u4e8e\u5e26\u5bbd\u800c\u65e0\u6cd5\u548c\u5b9e\u4f8b\u5feb\u901f\u901a\u4fe1\u3002","title":"3\u3001\u672c\u7ae0\u95ee\u9898"},{"location":"chap7/7Redis_cluster_summary/#4","text":"","title":"4\u3001\u5e38\u89c1\u95ee\u9898\u7b54\u7591"},{"location":"chap7/7Redis_cluster_summary/#4-1-redis-memcachedrocksdb","text":"Memcached \u548c RocksDB \u5206\u522b\u662f\u5178\u578b\u7684\u5185\u5b58\u952e\u503c\u6570\u636e\u5e93\u548c\u786c\u76d8\u952e\u503c\u6570\u636e\u5e93 \uff0c\u5e94\u7528\u5f97\u4e5f\u975e\u5e38\u5e7f\u6cdb\u3002\u548c Redis \u76f8\u6bd4\uff0c\u5b83\u4eec\u6709\u4ec0\u4e48\u4f18\u52bf\u548c\u4e0d\u8db3\u5462\uff1f\u662f\u5426\u53ef\u4ee5\u66ff\u4ee3 Redis \u5462\uff1f\u6211\u4eec\u6765\u804a\u4e00\u804a\u8fd9\u4e2a\u95ee\u9898\u3002 Redis \u548c Memcached \u7684\u6bd4\u8f83 \u548c Redis \u76f8\u4f3c\uff0cMemcached \u4e5f\u7ecf\u5e38\u88ab\u5f53\u505a\u7f13\u5b58\u6765\u4f7f\u7528\u3002 \u4e0d\u8fc7\uff0cMemcached \u6709\u4e00\u4e2a\u660e\u663e\u7684\u4f18\u52bf\uff0c\u5c31\u662f\u5b83\u7684\u96c6\u7fa4\u89c4\u6a21\u53ef\u4ee5\u5f88\u5927\u3002 Memcached \u96c6\u7fa4\u5e76\u4e0d\u662f\u50cf Redis Cluster \u6216 Codis \u90a3\u6837\uff0c\u4f7f\u7528 Slot \u6620\u5c04\u6765\u5206\u914d\u6570\u636e\u548c\u5b9e\u4f8b\u7684\u5bf9\u5e94\u4fdd\u5b58\u5173\u7cfb\uff0c \u800c\u662f\u4f7f\u7528\u4e00\u81f4\u6027\u54c8\u5e0c\u7b97\u6cd5\u628a\u6570\u636e\u5206\u6563\u4fdd\u5b58\u5230\u591a\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u800c\u4e00\u81f4\u6027\u54c8\u5e0c\u7684\u4f18\u52bf\u5c31\u662f\u53ef\u4ee5\u652f\u6301\u5927\u89c4\u6a21\u7684\u96c6\u7fa4 \u3002\u6240\u4ee5\uff0c\u5982\u679c\u6211\u4eec\u9700\u8981\u90e8\u7f72\u5927\u89c4\u6a21\u7f13\u5b58\u96c6\u7fa4\uff0cMemcached \u4f1a\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002 \u4e0d\u8fc7\uff0c\u5728\u4f7f\u7528 Memcached \u65f6\uff0c\u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\uff0cMemcached \u652f\u6301\u7684\u6570\u636e\u7c7b\u578b\u6bd4 Redis \u5c11\u5f88\u591a\u3002 Memcached \u53ea\u652f\u6301 String \u7c7b\u578b\u7684\u952e\u503c\u5bf9\uff0c\u800c Redis \u53ef\u4ee5\u652f\u6301\u5305\u62ec String \u5728\u5185\u7684\u591a\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u5f53\u4e1a\u52a1\u5e94\u7528\u6709\u4e30\u5bcc\u7684\u6570\u636e\u7c7b\u578b\u8981\u4fdd\u5b58\u7684\u8bdd\uff0c\u4f7f\u7528 Memcached \u4f5c\u4e3a\u66ff\u6362\u65b9\u6848\u7684\u4f18\u52bf\u5c31\u6ca1\u6709\u4e86\u3002 \u5982\u679c\u4f60\u65e2\u9700\u8981\u4fdd\u5b58\u591a\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u53c8\u5e0c\u671b\u6709\u4e00\u5b9a\u7684\u96c6\u7fa4\u89c4\u6a21\u4fdd\u5b58\u5927\u91cf\u6570\u636e\uff0c\u90a3\u4e48\uff0cRedis \u4ecd\u7136\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u65b9\u6848\u3002","title":"4-1 Redis \u548c Memcached\u3001RocksDB \u7684\u5bf9\u6bd4"},{"location":"chap7/7Redis_cluster_summary/#4-2-redis-rocksdb","text":"\u548c Redis \u4e0d\u540c\uff0c RocksDB \u53ef\u4ee5\u628a\u6570\u636e\u76f4\u63a5\u4fdd\u5b58\u5230\u786c\u76d8\u4e0a\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5355\u4e2a RocksDB \u53ef\u4ee5\u4fdd\u5b58\u7684\u6570\u636e\u91cf\u8981\u6bd4 Redis \u591a\u5f88\u591a\uff0c\u800c\u4e14\u6570\u636e\u90fd\u80fd\u6301\u4e45\u5316\u4fdd\u5b58\u4e0b\u6765 \u3002 \u9664\u6b64\u4e4b\u5916\uff0c RocksDB \u8fd8\u80fd\u652f\u6301\u8868\u7ed3\u6784\uff08\u5373\u5217\u65cf\u7ed3\u6784\uff09\uff0c\u800c Redis \u7684\u57fa\u672c\u6570\u636e\u6a21\u578b\u5c31\u662f\u952e\u503c\u5bf9 \u3002\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u9700\u8981\u4e00\u4e2a\u5927\u5bb9\u91cf\u7684\u6301\u4e45\u5316\u952e\u503c\u6570\u636e\u5e93\uff0c\u5e76\u4e14\u80fd\u6309\u7167\u4e00\u5b9a\u8868\u7ed3\u6784\u4fdd\u5b58\u6570\u636e\uff0cRocksDB \u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u66ff\u4ee3\u65b9\u6848\u3002 \u4e0d\u8fc7\uff0cRocksDB \u6bd5\u7adf\u662f\u8981\u628a\u6570\u636e\u5199\u5165\u5e95\u5c42\u786c\u76d8\u8fdb\u884c\u4fdd\u5b58\u7684\uff0c\u800c\u4e14\u5728\u8fdb\u884c\u6570\u636e\u67e5\u8be2\u65f6\uff0c\u5982\u679c RocksDB \u8981\u8bfb\u53d6\u7684\u6570\u636e\u6ca1\u6709\u5728\u5185\u5b58\u4e2d\u7f13\u5b58\uff0c\u90a3\u4e48\uff0cRocksDB \u5c31\u9700\u8981\u5230\u786c\u76d8\u4e0a\u7684\u6587\u4ef6\u4e2d\u8fdb\u884c\u67e5\u627e\uff0c\u8fd9\u4f1a\u62d6\u6162 RocksDB \u7684\u8bfb\u5199\u5ef6\u8fdf\uff0c\u964d\u4f4e\u5e26\u5bbd\u3002 \u5728\u6027\u80fd\u65b9\u9762\uff0cRocksDB \u662f\u6bd4\u4e0d\u4e0a Redis \u7684\u3002 \u800c\u4e14\uff0cRocksDB \u53ea\u662f\u4e00\u4e2a\u52a8\u6001\u94fe\u63a5\u5e93\uff0c\u5e76\u6ca1\u6709\u50cf Redis \u90a3\u6837\u63d0\u4f9b\u4e86\u5ba2\u6237\u7aef - \u670d\u52a1\u5668\u7aef\u8bbf\u95ee\u6a21\u5f0f\uff0c\u4ee5\u53ca\u4e3b\u4ece\u96c6\u7fa4\u548c\u5207\u7247\u96c6\u7fa4\u7684\u529f\u80fd\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u5728\u4f7f\u7528 RocksDB \u66ff\u4ee3 Redis \u65f6\uff0c\u9700\u8981\u7ed3\u5408\u4e1a\u52a1\u9700\u6c42\u91cd\u70b9\u8003\u8651\u66ff\u6362\u7684\u53ef\u884c\u6027\u3002 \u96c6\u7fa4\u90e8\u7f72\u548c\u8fd0\u7ef4\u6d89\u53ca\u7684\u5de5\u4f5c\u91cf\u975e\u5e38\u5927\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u4e00\u5b9a\u8981\u91cd\u89c6\u96c6\u7fa4\u65b9\u6848\u7684\u9009\u62e9\u3002 \u96c6\u7fa4\u7684\u53ef\u6269\u5c55\u6027\u662f\u6211\u4eec\u8bc4\u4f30\u96c6\u7fa4\u65b9\u6848\u7684\u4e00\u4e2a\u91cd\u8981\u7ef4\u5ea6 \uff0c\u96c6\u7fa4\u4e2d\u5143\u6570\u636e\u662f\u7528 Slot \u6620\u5c04\u8868\uff0c\u8fd8\u662f\u4e00\u81f4\u6027\u54c8\u5e0c\u7ef4\u62a4\u7684\u3002\u5982\u679c\u662f Slot \u6620\u5c04\u8868\uff0c\u90a3\u4e48\uff0c\u662f\u7528\u4e2d\u5fc3\u5316\u7684\u7b2c\u4e09\u65b9\u5b58\u50a8\u7cfb\u7edf\u6765\u4fdd\u5b58\uff0c\u8fd8\u662f\u7531\u5404\u4e2a\u5b9e\u4f8b\u6765\u6269\u6563\u4fdd\u5b58\uff0c\u8fd9\u4e5f\u662f\u9700\u8981\u8003\u8651\u6e05\u695a\u7684\u3002Redis Cluster\u3001Codis \u548c Memcached \u91c7\u7528\u7684\u65b9\u5f0f\u5404\u4e0d\u76f8\u540c\u3002 Redis Cluster\uff1a\u4f7f\u7528 Slot \u6620\u5c04\u8868\u5e76\u7531\u5b9e\u4f8b\u6269\u6563\u4fdd\u5b58 \u3002 Codis\uff1a\u4f7f\u7528 Slot \u6620\u5c04\u8868\u5e76\u7531\u7b2c\u4e09\u65b9\u5b58\u50a8\u7cfb\u7edf\u4fdd\u5b58\u3002 Memcached\uff1a\u4f7f\u7528\u4e00\u81f4\u6027\u54c8\u5e0c\u3002","title":"4-2 Redis \u548c RocksDB \u7684\u6bd4\u8f83"},{"location":"chap7/8Redis_HA/","text":"\u7b2c\u4e03\u8282 Redis \u9ad8\u53ef\u7528\u6027\u89e3\u51b3\u65b9\u6848 1\u3001Redis \u4e3b\u4ece\u590d\u5236\u7684\u95ee\u9898 Redis \u4e3b\u4ece\u590d\u5236\u53ef\u5c06\u4e3b\u8282\u70b9\u6570\u636e\u540c\u6b65\u7ed9\u4ece\u8282\u70b9\uff0c\u4ece\u8282\u70b9\u6b64\u65f6\u6709\u4e24\u4e2a\u4f5c\u7528\uff1a \u4e00\u65e6\u4e3b\u8282\u70b9\u5b95\u673a\uff0c\u4ece\u8282\u70b9\u4f5c\u4e3a\u4e3b\u8282\u70b9\u7684\u5907\u4efd\u53ef\u4ee5\u968f\u65f6\u9876\u4e0a\u6765\u3002 \u6269\u5c55\u4e3b\u8282\u70b9\u7684\u8bfb\u80fd\u529b\uff0c\u5206\u62c5\u4e3b\u8282\u70b9\u8bfb\u538b\u529b\u3002 \u4e3b\u4ece\u590d\u5236\u540c\u65f6\u5b58\u5728\u4ee5\u4e0b\u51e0\u4e2a\u95ee\u9898\uff1a \u4e00\u65e6\u4e3b\u8282\u70b9\u5b95\u673a\uff0c\u4ece\u8282\u70b9\u664b\u5347\u6210\u4e3b\u8282\u70b9\uff0c\u540c\u65f6\u9700\u8981\u4fee\u6539\u5e94\u7528\u65b9\u7684\u4e3b\u8282\u70b9\u5730\u5740\uff0c\u8fd8\u9700\u8981\u547d\u4ee4\u6240\u6709\u4ece\u8282\u70b9\u53bb\u590d\u5236\u65b0\u7684\u4e3b\u8282\u70b9\uff0c\u6574\u4e2a\u8fc7\u7a0b\u9700\u8981\u4eba\u5de5\u5e72\u9884\u3002 \u4e3b\u8282\u70b9\u7684\u5199\u80fd\u529b\u53d7\u5230\u5355\u673a\u7684\u9650\u5236\u3002 \u4e3b\u8282\u70b9\u7684\u5199\u80fd\u529b\u53d7\u5230\u5355\u673a\u7684\u9650\u5236\u3002 \u539f\u751f\u590d\u5236\u7684\u5f0a\u7aef\u5728\u65e9\u671f\u7684\u7248\u672c\u4e2d\u4e5f\u4f1a\u6bd4\u8f83\u7a81\u51fa\uff0c \u6bd4\u5982\uff1aRedis \u590d\u5236\u4e2d\u65ad\u540e\uff0c\u4ece\u8282\u70b9\u4f1a\u53d1\u8d77 psync\u3002\u6b64\u65f6\u5982\u679c\u540c\u6b65\u4e0d\u6210\u529f\uff0c\u5219\u4f1a\u8fdb\u884c\u5168\u91cf\u540c\u6b65\uff0c\u4e3b\u5e93 \u6267\u884c \u5168\u91cf\u5907\u4efd \u7684\u540c\u65f6\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u6beb\u79d2\u6216\u79d2\u7ea7\u7684\u5361\u987f\u3002 2\u3001 Redis \u7684\u54e8\u5175\uff08Sentinel\uff09\u6df1\u5165\u63a2\u7a76 Redis Sentinel \u7684\u67b6\u6784\uff1a Redis\u7684\u54e8\u5175\u673a\u5236\u5c31\u662f\u89e3\u51b3\u6211\u4eec\u4ee5\u4e0a\u4e3b\u4ece\u590d\u5236\u5b58\u5728\u7f3a\u9677\uff08\u9009\u4e3e\u95ee\u9898\uff09\uff0c\u4fdd\u8bc1\u6211\u4eec\u7684Redis\u9ad8\u53ef\u7528\uff0c\u5b9e\u73b0\u81ea\u52a8\u5316\u6545\u969c\u53d1\u73b0\u4e0e\u6545\u969c\u8f6c\u79fb\u3002 \u8be5\u7cfb\u7edf\u6267\u884c\u4ee5\u4e0b\u4e09\u4e2a\u4efb\u52a1\uff1a \u76d1\u63a7\uff1a\u54e8\u5175\u4f1a\u4e0d\u65ad\u68c0\u67e5\u4f60\u7684\u4e3b\u670d\u52a1\u5668\u548c\u4ece\u670d\u52a1\u5668\u662f\u5426\u8fd0\u4f5c\u6b63\u5e38\u3002 \u63d0\u9192\uff1a\u5f53\u88ab\u76d1\u63a7\u7684\u67d0\u4e2aRedis\u670d\u52a1\u5668\u51fa\u73b0\u95ee\u9898\u65f6\uff0c\u54e8\u5175\u53ef\u4ee5\u901a\u8fc7API\u7ed9\u7a0b\u5e8f\u5458\u53d1\u9001\u901a\u77e5\u81ea\u52a8\u6545\u969c \u8f6c\u79fb\uff1a\u4e3b\u670d\u52a1\u5668\u5b95\u673a\uff0c\u54e8\u5175\u4f1a\u5f00\u59cb\u4e00\u6b21\u81ea\u52a8\u6545\u969c\u8f6c\u79fb\u64cd\u4f5c\uff0c\u5347\u7ea7\u4e00\u4e2a\u4ece\u670d\u52a1\u5668\u4e3a\u4e3b\u670d\u52a1\u5668\uff0c\u5e76\u8ba9\u5176\u4ed6\u4ece\u670d\u52a1\u5668\u6539\u4e3a\u590d\u5236\u65b0\u7684\u4e3b\u670d\u52a1\u5668\u3002 3\u3001\u914d\u7f6e Sentinel Redis \u6e90\u7801\u4e2d\u5305\u542b\u4e86\u4e00\u4e2a\u540d\u4e3a sentinel.conf \u7684\u6587\u4ef6\uff0c \u8fd9\u4e2a\u6587\u4ef6\u662f\u4e00\u4e2a\u5e26\u6709\u8be6\u7ec6\u6ce8\u91ca\u7684 Sentinel \u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\u3002 sentinel monitor mymaster 192.168.10.202 6379 2 Sentine\u76d1\u542c\u7684maste\u5730\u5740\uff0c \u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u7ed9master\u8d77\u7684\u540d\u5b57\uff0c \u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3amaster IP\uff0c \u7b2c\u4e09\u4e2a\u4e3amaster\u7aef\u53e3\uff0c \u7b2c\u56db\u4e2a\u4e3a\u5f53\u8be5master\u6302\u4e86\u7684\u65f6\u5019\uff0c \u82e5\u60f3\u5c06\u8be5master\u5224\u4e3a\u5931\u6548\uff0c\u5728Sentine\u96c6\u7fa4\u4e2d\u5fc5\u987b\u81f3\u5c112\u4e2aSentine\u540c\u610f\u624d\u884c\uff0c\u53ea\u8981\u8be5\u6570\u91cf\u4e0d\u8fbe\u6807\uff0c\u5219\u5c31\u4e0d\u4f1a\u53d1\u751f\u6545\u969c\u8fc1\u79fb\u3002 2\uff09sentinel down-after-milliseconds mymaster 30000 \u8868\u793amaster\u88ab\u5f53\u524dsentinel\u5b9e\u4f8b\u8ba4\u5b9a\u4e3a\u5931\u6548\u7684\u95f4\u9694\u65f6\u95f4\uff0c\u5728\u8fd9\u6bb5\u65f6\u95f4\u5185\u4e00\u76f4\u6ca1\u6709\u7ed9Sentine\u8fd4\u56de\u6709\u6548\u4fe1\u606f\uff0c\u5219\u8ba4\u5b9a\u8be5master\u4e3b\u89c2\u4e0b\u7ebf\u3002 \u53ea\u6709\u5728\u8db3\u591f\u6570\u91cf\u7684 Sentinel \u90fd\u5c06\u4e00\u4e2a\u670d\u52a1\u5668\u6807\u8bb0\u4e3a\u4e3b\u89c2\u4e0b\u7ebf\u4e4b\u540e\uff0c \u670d\u52a1\u5668\u624d\u4f1a\u88ab\u6807\u8bb0\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\uff0c``\u5c06\u670d\u52a1\u5668\u6807\u8bb0\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\u6240\u9700\u7684 Sentinel \u6570\u91cf\u7531\u5bf9\u4e3b\u670d\u52a1\u5668\u7684\u914d\u7f6e\u51b3\u5b9a\u3002 3\uff09sentinel parallel-syncs mymaster 2 \u5f53\u5728\u6267\u884c\u6545\u969c\u8f6c\u79fb\u65f6\uff0c\u8bbe\u7f6e\u51e0\u4e2aslave\u540c\u65f6\u8fdb\u884c\u5207\u6362master\uff0c \u8be5\u503c\u8d8a\u5927\uff0c\u5219\u53ef\u80fd\u5c31\u6709\u8d8a\u591a\u7684slave\u5728\u5207\u6362master\u65f6\u4e0d\u53ef\u7528\uff0c\u53ef\u4ee5\u5c06\u8be5\u503c\u8bbe\u7f6e\u4e3a1 \uff0c\u5373\u4e00\u4e2a\u4e00\u4e2a\u6765\uff0c\u8fd9\u6837\u5728\u67d0\u4e2a slave\u8fdb\u884c\u5207\u6362master\u540c\u6b65\u6570\u636e\u65f6\uff0c\u5176\u4f59\u7684slave\u8fd8\u80fd\u6b63\u5e38\u5de5\u4f5c\uff0c\u4ee5\u6b64\u4fdd\u8bc1\u6bcf\u6b21\u53ea\u6709\u4e00\u4e2a\u4ece\u670d\u52a1\u5668\u5904\u4e8e\u4e0d\u80fd\u5904\u7406\u547d\u4ee4\u8bf7\u6c42\u7684\u72b6\u6001\u3002 4\uff09sentinel can-failover mymaster ``yes \u5728sentinel\u68c0\u6d4b\u5230 O_DOWN \u540e\uff0c\u662f\u5426\u5bf9\u8fd9\u53f0redis\u542f\u52a8failover\u673a\u5236 5\uff09sentinel auth-pass mymaster 20180408 \u8bbe\u7f6e sentinel \u8fde\u63a5\u7684 master \u548c slave \u7684\u5bc6\u7801\uff0c\u8fd9\u4e2a\u9700\u8981\u548c redis.conf \u6587\u4ef6\u4e2d\u8bbe\u7f6e\u7684\u5bc6\u7801\u4e00\u6837 6\uff09sentinel failover-timeout mymaster 180000 failover\u8fc7\u671f\u65f6\u95f4\uff0c\u5f53failover\u5f00\u59cb\u540e\uff0c\u5728\u6b64\u65f6\u95f4\u5185\u4ecd\u7136\u6ca1\u6709\u89e6\u53d1\u4efb\u4f55failover\u64cd\u4f5c\uff0c\u5f53\u524dsentinel\u5c06\u4f1a\u8ba4\u4e3a\u6b64\u6b21failoer\u5931\u8d25\u3002 \u6267\u884c\u6545\u969c\u8fc1\u79fb\u8d85\u65f6\u65f6\u95f4\uff0c\u5373\u5728\u6307\u5b9a\u65f6\u95f4\u5185\u6ca1\u6709\u5927\u591a\u6570\u7684sentinel \u53cd\u9988master\u4e0b\u7ebf\uff0c\u8be5\u6545\u969c\u8fc1\u79fb\u8ba1\u5212\u5219\u5931\u6548 7\uff09sentinel config-epoch mymaster 0 \u9009\u9879\u6307\u5b9a\u4e86\u5728\u6267\u884c\u6545\u969c\u8f6c\u79fb\u65f6\uff0c \u6700\u591a\u53ef\u4ee5\u6709\u591a\u5c11\u4e2a\u4ece\u670d\u52a1\u5668\u540c\u65f6\u5bf9\u65b0\u7684\u4e3b\u670d\u52a1\u5668\u8fdb\u884c\u540c\u6b65 \u3002\u8fd9\u4e2a\u6570\u5b57\u8d8a\u5c0f\uff0c \u5b8c\u6210\u6545\u969c\u8f6c\u79fb\u6240\u9700\u7684\u65f6\u95f4\u5c31\u8d8a\u957f\u3002 8\uff09sentinel notification-script mymaster ``/var/redis/notify``.sh \u5f53failover\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a \"\u901a\u77e5\" \u811a\u672c\u7528\u6765\u544a\u77e5\u5f53\u524d\u96c6\u7fa4\u7684\u60c5\u51b5\u3002 \u811a\u672c\u88ab\u5141\u8bb8\u6267\u884c\u7684\u6700\u5927\u65f6\u95f4\u4e3a60\u79d2\uff0c\u5982\u679c\u8d85\u65f6\uff0c\u811a\u672c\u5c06\u4f1a\u88ab\u7ec8\u6b62(KILL) 9\uff09sentinel leader-epoch mymaster 0 \u540c\u65f6\u4e00\u65f6\u95f4\u6700\u591a0\u4e2aslave\u53ef\u540c\u65f6\u66f4\u65b0\u914d\u7f6e,\u5efa\u8bae\u6570\u5b57\u4e0d\u8981\u592a\u5927,\u4ee5\u514d\u5f71\u54cd\u6b63\u5e38\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002 \u4e3b\u89c2\u4e0b\u7ebf\u548c\u5ba2\u89c2\u4e0b\u7ebf \u4e3b\u89c2\u4e0b\u7ebf\uff1a\u6307\u7684\u662f\u5355\u4e2a Sentinel \u5b9e\u4f8b\u5bf9\u670d\u52a1\u5668\u505a\u51fa\u7684\u4e0b\u7ebf\u5224\u65ad\u3002 \u5ba2\u89c2\u4e0b\u7ebf\uff1a\u6307\u7684\u662f\u591a\u4e2a Sentinel \u5b9e\u4f8b\u5728\u5bf9\u540c\u4e00\u4e2a\u670d\u52a1\u5668\u505a\u51fa SDOWN\u4e3b\u89c2\u4e0b\u7ebf \u5224\u65ad\u3002 4\u3001Redis Sentinel \u7684\u5de5\u4f5c\u539f\u7406 1.\u6bcf\u4e2a Sentinel \u4ee5\u6bcf\u79d2\u4e00\u6b21\u7684\u9891\u7387\u5411\u5b83\u6240\u77e5\u7684\u4e3b\u670d\u52a1\u5668\u3001\u4ece\u670d\u52a1\u5668\u4ee5\u53ca\u5176\u4ed6 Sentinel \u5b9e\u4f8b\u53d1\u9001\u4e00\u4e2a PING \u547d\u4ee4\u3002 2.\u5982\u679c\u4e00\u4e2a\u5b9e\u4f8b\u8ddd\u79bb\u6700\u540e\u4e00\u6b21\u6709\u6548\u56de\u590d PING \u547d\u4ee4\u7684\u65f6\u95f4\u8d85\u8fc7\u6307\u5b9a\u7684\u503c\uff0c \u90a3\u4e48\u8fd9\u4e2a\u5b9e\u4f8b\u4f1a\u88ab Sentinel \u6807\u8bb0\u4e3a\u4e3b\u89c2\u4e0b\u7ebf\u3002 3.\u6b63\u5728\u76d1\u89c6\u8fd9\u4e2a\u4e3b\u670d\u52a1\u5668\u7684\u6240\u6709 Sentinel \u8981\u4ee5\u6bcf\u79d2\u4e00\u6b21\u7684\u9891\u7387\u786e\u8ba4\u4e3b\u670d\u52a1\u5668\u7684\u786e\u8fdb\u5165\u4e86\u4e3b\u89c2\u4e0b\u7ebf\u72b6\u6001\u3002 4. \u6709\u8db3\u591f\u6570\u91cf\u7684 Sentinel \u5728\u6307\u5b9a\u7684\u65f6\u95f4\u8303\u56f4\u5185\u540c\u610f\u8fd9\u4e00\u5224\u65ad \uff0c \u90a3\u4e48\u8fd9\u4e2a\u4e3b\u670d\u52a1\u5668\u88ab\u6807\u8bb0\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\u3002 5. \u6bcf\u4e2a Sentinel \u4f1a\u4ee5\u6bcf 10 \u79d2\u4e00\u6b21\u7684\u9891\u7387\u5411\u5b83\u5df2\u77e5\u7684\u6240\u6709\u4e3b\u670d\u52a1\u5668\u548c\u4ece\u670d\u52a1\u5668\u53d1\u9001 INFO \u547d\u4ee4 \u3002 \u5f53\u4e00\u4e2a\u4e3b\u670d\u52a1\u5668\u88ab Sentinel \u6807\u8bb0\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\u65f6\uff0c Sentinel \u5411\u4e0b\u7ebf\u4e3b\u670d\u52a1\u5668\u7684\u6240\u6709\u4ece\u670d\u52a1\u5668\u53d1\u9001 INFO \u547d\u4ee4\u7684\u9891\u7387\u4f1a\u4ece 10 \u79d2\u4e00\u6b21\u6539\u4e3a\u6bcf\u79d2\u4e00\u6b21\u3002 6. Sentinel \u548c\u5176\u4ed6 Sentinel \u534f\u5546 \u4e3b\u8282\u70b9 \u7684\u72b6\u6001\uff0c\u5982\u679c \u4e3b\u8282\u70b9 \u5904\u4e8e SDOWN \u72b6\u6001\uff0c\u5219\u6295\u7968\u81ea\u52a8\u9009\u51fa\u65b0\u7684 \u4e3b\u8282\u70b9\u3002\u5c06\u5269\u4f59\u7684 \u4ece\u8282\u70b9 \u6307\u5411 \u65b0\u7684\u4e3b\u8282\u70b9 \u8fdb\u884c \u6570\u636e\u590d\u5236 \u3002 7.\u5f53\u6ca1\u6709\u8db3\u591f\u6570\u91cf\u7684 Sentinel \u540c\u610f \u4e3b\u670d\u52a1\u5668 \u4e0b\u7ebf\u65f6\uff0c \u4e3b\u670d\u52a1\u5668 \u7684 \u5ba2\u89c2\u4e0b\u7ebf\u72b6\u6001 \u5c31\u4f1a\u88ab\u79fb\u9664\u3002 \u5f53 \u4e3b\u670d\u52a1\u5668 \u91cd\u65b0\u5411 Sentinel \u7684 PING \u547d\u4ee4\u8fd4\u56de \u6709\u6548\u56de\u590d \u65f6\uff0c\u4e3b\u670d\u52a1\u5668 \u7684 \u4e3b\u89c2\u4e0b\u7ebf\u72b6\u6001 \u5c31\u4f1a\u88ab\u79fb\u9664\u3002 5\u3001\u81ea\u52a8\u53d1\u73b0 Sentinel \u548c\u4ece\u670d\u52a1\u5668 \u4e00\u4e2a Sentinel \u53ef\u4ee5\u4e0e\u5176\u4ed6\u591a\u4e2a Sentinel \u8fdb\u884c\u8fde\u63a5\uff0c \u5404\u4e2a Sentinel \u4e4b\u95f4\u53ef\u4ee5\u4e92\u76f8\u68c0\u67e5\u5bf9\u65b9\u7684\u53ef\u7528\u6027\uff0c \u5e76\u8fdb\u884c\u4fe1\u606f\u4ea4\u6362\u3002 \u4f60\u65e0\u987b\u4e3a\u8fd0\u884c\u7684\u6bcf\u4e2a Sentinel \u5206\u522b\u8bbe\u7f6e\u5176\u4ed6 Sentinel \u7684\u5730\u5740\uff0c \u56e0\u4e3a Sentinel \u53ef\u4ee5\u901a\u8fc7\u53d1\u5e03\u4e0e\u8ba2\u9605\u529f\u80fd\u6765\u81ea\u52a8\u53d1\u73b0\u6b63\u5728\u76d1\u89c6\u76f8\u540c\u4e3b\u670d\u52a1\u5668\u7684\u5176\u4ed6 Sentinel \u3002 \u6bcf\u4e2a Sentinel \u4f1a\u4ee5\u6bcf\u4e24\u79d2\u4e00\u6b21\u7684\u9891\u7387\uff0c \u901a\u8fc7\u53d1\u5e03\u4e0e\u8ba2\u9605\u529f\u80fd\uff0c \u5411\u88ab\u5b83\u76d1\u89c6\u7684\u6240\u6709\u4e3b\u670d\u52a1\u5668\u548c\u4ece\u670d\u52a1\u5668\u7684\u9891\u9053\u53d1\u9001\u4e00\u6761\u4fe1\u606f\uff0c \u4fe1\u606f\u4e2d\u5305\u542b\u4e86 Sentinel \u7684 IP \u5730\u5740\u3001\u7aef\u53e3\u53f7\u548c\u8fd0\u884c ID \uff08runid\uff09\u3002 \u6bcf\u4e2a Sentinel \u90fd\u8ba2\u9605\u4e86\u88ab\u5b83\u76d1\u89c6\u7684\u6240\u6709\u4e3b\u670d\u52a1\u5668\u548c\u4ece\u670d\u52a1\u5668\u7684\u9891\u9053\uff0c \u67e5\u627e\u4e4b\u524d\u672a\u51fa\u73b0\u8fc7\u7684 sentinel \u3002\u5f53\u4e00\u4e2a Sentinel \u53d1\u73b0\u4e00\u4e2a\u65b0\u7684 Sentinel \u65f6\uff0c \u5b83\u4f1a\u5c06\u65b0\u7684 Sentinel \u6dfb\u52a0\u5230\u4e00\u4e2a\u5217\u8868\u4e2d\u3002 Sentinel \u53d1\u9001\u7684\u4fe1\u606f\u4e2d\u8fd8\u5305\u62ec\u5b8c\u6574\u7684\u4e3b\u670d\u52a1\u5668\u5f53\u524d\u914d\u7f6e\u3002\u5982\u679c\u4e00\u4e2a Sentinel \u5305\u542b\u7684\u4e3b\u670d\u52a1\u5668\u914d\u7f6e\u6bd4\u53e6\u4e00\u4e2a Sentinel \u53d1\u9001\u7684\u914d\u7f6e\u8981\u65e7\uff0c \u90a3\u4e48\u8fd9\u4e2a Sentinel \u4f1a\u7acb\u5373\u5347\u7ea7\u5230\u65b0\u914d\u7f6e\u4e0a\u3002 \u5728\u5c06\u4e00\u4e2a\u65b0 Sentinel \u6dfb\u52a0\u5230\u76d1\u89c6\u4e3b\u670d\u52a1\u5668\u7684\u5217\u8868\u4e0a\u9762\u4e4b\u524d\uff0c Sentinel \u4f1a\u5148\u68c0\u67e5\u5217\u8868\u4e2d\u662f\u5426\u5df2\u7ecf\u5305\u542b\u4e86\u548c\u8981\u6dfb\u52a0\u7684 Sentinel \u62e5\u6709\u76f8\u540c\u8fd0\u884c ID \u6216\u8005\u76f8\u540c\u5730\u5740\uff08\u5305\u62ec IP \u5730\u5740\u548c\u7aef\u53e3\u53f7\uff09\u7684 Sentinel \uff0c \u5982\u679c\u662f\u7684\u8bdd\uff0c Sentinel \u4f1a\u5148\u79fb\u9664\u5217\u8868\u4e2d\u5df2\u6709\u7684\u90a3\u4e9b\u62e5\u6709\u76f8\u540c\u8fd0\u884c ID \u6216\u8005\u76f8\u540c\u5730\u5740\u7684 Sentinel \uff0c \u7136\u540e\u518d\u6dfb\u52a0\u65b0 Sentinel\u3002 6\u3001\u6545\u969c\u8f6c\u79fb \u4e00\u6b21\u6545\u969c\u8f6c\u79fb\u64cd\u4f5c\u7531\u4ee5\u4e0b\u6b65\u9aa4\u7ec4\u6210\uff1a \u53d1\u73b0\u4e3b\u670d\u52a1\u5668\u5df2\u7ecf\u8fdb\u5165\u5ba2\u89c2\u4e0b\u7ebf\u72b6\u6001\u3002 \u5bf9\u6211\u4eec\u7684\u5f53\u524d\u7eaa\u5143\u8fdb\u884c\u81ea\u589e\uff0c \u5e76\u5c1d\u8bd5\u5728\u8fd9\u4e2a\u7eaa\u5143\u4e2d\u5f53\u9009\u3002 \u5982\u679c\u5f53\u9009\u5931\u8d25\uff0c \u90a3\u4e48\u5728\u8bbe\u5b9a\u7684\u6545\u969c\u8fc1\u79fb\u8d85\u65f6\u65f6\u95f4\u7684\u4e24\u500d\u4e4b\u540e\uff0c \u91cd\u65b0\u5c1d\u8bd5\u5f53\u9009\u3002\u5982\u679c\u5f53\u9009\u6210\u529f\uff0c \u90a3\u4e48\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4\u3002 \u9009\u51fa\u4e00\u4e2a\u4ece\u670d\u52a1\u5668\uff0c\u5e76\u5c06\u5b83\u5347\u7ea7\u4e3a\u4e3b\u670d\u52a1\u5668\u3002 \u5411\u88ab\u9009\u4e2d\u7684\u4ece\u670d\u52a1\u5668\u53d1\u9001 SLAVEOF NO ONE \u547d\u4ee4\uff0c\u8ba9\u5b83\u8f6c\u53d8\u4e3a\u4e3b\u670d\u52a1\u5668\u3002 \u901a\u8fc7\u53d1\u5e03\u4e0e\u8ba2\u9605\u529f\u80fd\uff0c \u5c06\u66f4\u65b0\u540e\u7684\u914d\u7f6e\u4f20\u64ad\u7ed9\u6240\u6709\u5176\u4ed6 Sentinel \uff0c \u5176\u4ed6 Sentinel \u5bf9\u5b83\u4eec\u81ea\u5df1\u7684\u914d\u7f6e\u8fdb\u884c\u66f4\u65b0\u3002 \u5411\u5df2\u4e0b\u7ebf\u4e3b\u670d\u52a1\u5668\u7684\u4ece\u670d\u52a1\u5668\u53d1\u9001 SLAVEOF \u547d\u4ee4\uff0c \u8ba9\u5b83\u4eec\u53bb\u590d\u5236\u65b0\u7684\u4e3b\u670d\u52a1\u5668\u3002 \u5f53\u6240\u6709\u4ece\u670d\u52a1\u5668\u90fd\u5df2\u7ecf\u5f00\u59cb\u590d\u5236\u65b0\u7684\u4e3b\u670d\u52a1\u5668\u65f6\uff0c \u9886\u5934 Sentinel \u7ec8\u6b62\u8fd9\u6b21\u6545\u969c\u8fc1\u79fb\u64cd\u4f5c\u3002","title":"\u7b2c\u4e03\u8282 Redis \u9ad8\u53ef\u7528\u6027\u89e3\u51b3\u65b9\u6848"},{"location":"chap7/8Redis_HA/#redis","text":"","title":"\u7b2c\u4e03\u8282 Redis \u9ad8\u53ef\u7528\u6027\u89e3\u51b3\u65b9\u6848"},{"location":"chap7/8Redis_HA/#1redis","text":"Redis \u4e3b\u4ece\u590d\u5236\u53ef\u5c06\u4e3b\u8282\u70b9\u6570\u636e\u540c\u6b65\u7ed9\u4ece\u8282\u70b9\uff0c\u4ece\u8282\u70b9\u6b64\u65f6\u6709\u4e24\u4e2a\u4f5c\u7528\uff1a \u4e00\u65e6\u4e3b\u8282\u70b9\u5b95\u673a\uff0c\u4ece\u8282\u70b9\u4f5c\u4e3a\u4e3b\u8282\u70b9\u7684\u5907\u4efd\u53ef\u4ee5\u968f\u65f6\u9876\u4e0a\u6765\u3002 \u6269\u5c55\u4e3b\u8282\u70b9\u7684\u8bfb\u80fd\u529b\uff0c\u5206\u62c5\u4e3b\u8282\u70b9\u8bfb\u538b\u529b\u3002 \u4e3b\u4ece\u590d\u5236\u540c\u65f6\u5b58\u5728\u4ee5\u4e0b\u51e0\u4e2a\u95ee\u9898\uff1a \u4e00\u65e6\u4e3b\u8282\u70b9\u5b95\u673a\uff0c\u4ece\u8282\u70b9\u664b\u5347\u6210\u4e3b\u8282\u70b9\uff0c\u540c\u65f6\u9700\u8981\u4fee\u6539\u5e94\u7528\u65b9\u7684\u4e3b\u8282\u70b9\u5730\u5740\uff0c\u8fd8\u9700\u8981\u547d\u4ee4\u6240\u6709\u4ece\u8282\u70b9\u53bb\u590d\u5236\u65b0\u7684\u4e3b\u8282\u70b9\uff0c\u6574\u4e2a\u8fc7\u7a0b\u9700\u8981\u4eba\u5de5\u5e72\u9884\u3002 \u4e3b\u8282\u70b9\u7684\u5199\u80fd\u529b\u53d7\u5230\u5355\u673a\u7684\u9650\u5236\u3002 \u4e3b\u8282\u70b9\u7684\u5199\u80fd\u529b\u53d7\u5230\u5355\u673a\u7684\u9650\u5236\u3002 \u539f\u751f\u590d\u5236\u7684\u5f0a\u7aef\u5728\u65e9\u671f\u7684\u7248\u672c\u4e2d\u4e5f\u4f1a\u6bd4\u8f83\u7a81\u51fa\uff0c \u6bd4\u5982\uff1aRedis \u590d\u5236\u4e2d\u65ad\u540e\uff0c\u4ece\u8282\u70b9\u4f1a\u53d1\u8d77 psync\u3002\u6b64\u65f6\u5982\u679c\u540c\u6b65\u4e0d\u6210\u529f\uff0c\u5219\u4f1a\u8fdb\u884c\u5168\u91cf\u540c\u6b65\uff0c\u4e3b\u5e93 \u6267\u884c \u5168\u91cf\u5907\u4efd \u7684\u540c\u65f6\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u6beb\u79d2\u6216\u79d2\u7ea7\u7684\u5361\u987f\u3002","title":"1\u3001Redis \u4e3b\u4ece\u590d\u5236\u7684\u95ee\u9898"},{"location":"chap7/8Redis_HA/#2-redis-sentinel","text":"Redis Sentinel \u7684\u67b6\u6784\uff1a Redis\u7684\u54e8\u5175\u673a\u5236\u5c31\u662f\u89e3\u51b3\u6211\u4eec\u4ee5\u4e0a\u4e3b\u4ece\u590d\u5236\u5b58\u5728\u7f3a\u9677\uff08\u9009\u4e3e\u95ee\u9898\uff09\uff0c\u4fdd\u8bc1\u6211\u4eec\u7684Redis\u9ad8\u53ef\u7528\uff0c\u5b9e\u73b0\u81ea\u52a8\u5316\u6545\u969c\u53d1\u73b0\u4e0e\u6545\u969c\u8f6c\u79fb\u3002 \u8be5\u7cfb\u7edf\u6267\u884c\u4ee5\u4e0b\u4e09\u4e2a\u4efb\u52a1\uff1a \u76d1\u63a7\uff1a\u54e8\u5175\u4f1a\u4e0d\u65ad\u68c0\u67e5\u4f60\u7684\u4e3b\u670d\u52a1\u5668\u548c\u4ece\u670d\u52a1\u5668\u662f\u5426\u8fd0\u4f5c\u6b63\u5e38\u3002 \u63d0\u9192\uff1a\u5f53\u88ab\u76d1\u63a7\u7684\u67d0\u4e2aRedis\u670d\u52a1\u5668\u51fa\u73b0\u95ee\u9898\u65f6\uff0c\u54e8\u5175\u53ef\u4ee5\u901a\u8fc7API\u7ed9\u7a0b\u5e8f\u5458\u53d1\u9001\u901a\u77e5\u81ea\u52a8\u6545\u969c \u8f6c\u79fb\uff1a\u4e3b\u670d\u52a1\u5668\u5b95\u673a\uff0c\u54e8\u5175\u4f1a\u5f00\u59cb\u4e00\u6b21\u81ea\u52a8\u6545\u969c\u8f6c\u79fb\u64cd\u4f5c\uff0c\u5347\u7ea7\u4e00\u4e2a\u4ece\u670d\u52a1\u5668\u4e3a\u4e3b\u670d\u52a1\u5668\uff0c\u5e76\u8ba9\u5176\u4ed6\u4ece\u670d\u52a1\u5668\u6539\u4e3a\u590d\u5236\u65b0\u7684\u4e3b\u670d\u52a1\u5668\u3002","title":"2\u3001 Redis \u7684\u54e8\u5175\uff08Sentinel\uff09\u6df1\u5165\u63a2\u7a76"},{"location":"chap7/8Redis_HA/#3-sentinel","text":"Redis \u6e90\u7801\u4e2d\u5305\u542b\u4e86\u4e00\u4e2a\u540d\u4e3a sentinel.conf \u7684\u6587\u4ef6\uff0c \u8fd9\u4e2a\u6587\u4ef6\u662f\u4e00\u4e2a\u5e26\u6709\u8be6\u7ec6\u6ce8\u91ca\u7684 Sentinel \u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\u3002 sentinel monitor mymaster 192.168.10.202 6379 2 Sentine\u76d1\u542c\u7684maste\u5730\u5740\uff0c \u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u7ed9master\u8d77\u7684\u540d\u5b57\uff0c \u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3amaster IP\uff0c \u7b2c\u4e09\u4e2a\u4e3amaster\u7aef\u53e3\uff0c \u7b2c\u56db\u4e2a\u4e3a\u5f53\u8be5master\u6302\u4e86\u7684\u65f6\u5019\uff0c \u82e5\u60f3\u5c06\u8be5master\u5224\u4e3a\u5931\u6548\uff0c\u5728Sentine\u96c6\u7fa4\u4e2d\u5fc5\u987b\u81f3\u5c112\u4e2aSentine\u540c\u610f\u624d\u884c\uff0c\u53ea\u8981\u8be5\u6570\u91cf\u4e0d\u8fbe\u6807\uff0c\u5219\u5c31\u4e0d\u4f1a\u53d1\u751f\u6545\u969c\u8fc1\u79fb\u3002 2\uff09sentinel down-after-milliseconds mymaster 30000 \u8868\u793amaster\u88ab\u5f53\u524dsentinel\u5b9e\u4f8b\u8ba4\u5b9a\u4e3a\u5931\u6548\u7684\u95f4\u9694\u65f6\u95f4\uff0c\u5728\u8fd9\u6bb5\u65f6\u95f4\u5185\u4e00\u76f4\u6ca1\u6709\u7ed9Sentine\u8fd4\u56de\u6709\u6548\u4fe1\u606f\uff0c\u5219\u8ba4\u5b9a\u8be5master\u4e3b\u89c2\u4e0b\u7ebf\u3002 \u53ea\u6709\u5728\u8db3\u591f\u6570\u91cf\u7684 Sentinel \u90fd\u5c06\u4e00\u4e2a\u670d\u52a1\u5668\u6807\u8bb0\u4e3a\u4e3b\u89c2\u4e0b\u7ebf\u4e4b\u540e\uff0c \u670d\u52a1\u5668\u624d\u4f1a\u88ab\u6807\u8bb0\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\uff0c``\u5c06\u670d\u52a1\u5668\u6807\u8bb0\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\u6240\u9700\u7684 Sentinel \u6570\u91cf\u7531\u5bf9\u4e3b\u670d\u52a1\u5668\u7684\u914d\u7f6e\u51b3\u5b9a\u3002 3\uff09sentinel parallel-syncs mymaster 2 \u5f53\u5728\u6267\u884c\u6545\u969c\u8f6c\u79fb\u65f6\uff0c\u8bbe\u7f6e\u51e0\u4e2aslave\u540c\u65f6\u8fdb\u884c\u5207\u6362master\uff0c \u8be5\u503c\u8d8a\u5927\uff0c\u5219\u53ef\u80fd\u5c31\u6709\u8d8a\u591a\u7684slave\u5728\u5207\u6362master\u65f6\u4e0d\u53ef\u7528\uff0c\u53ef\u4ee5\u5c06\u8be5\u503c\u8bbe\u7f6e\u4e3a1 \uff0c\u5373\u4e00\u4e2a\u4e00\u4e2a\u6765\uff0c\u8fd9\u6837\u5728\u67d0\u4e2a slave\u8fdb\u884c\u5207\u6362master\u540c\u6b65\u6570\u636e\u65f6\uff0c\u5176\u4f59\u7684slave\u8fd8\u80fd\u6b63\u5e38\u5de5\u4f5c\uff0c\u4ee5\u6b64\u4fdd\u8bc1\u6bcf\u6b21\u53ea\u6709\u4e00\u4e2a\u4ece\u670d\u52a1\u5668\u5904\u4e8e\u4e0d\u80fd\u5904\u7406\u547d\u4ee4\u8bf7\u6c42\u7684\u72b6\u6001\u3002 4\uff09sentinel can-failover mymaster ``yes \u5728sentinel\u68c0\u6d4b\u5230 O_DOWN \u540e\uff0c\u662f\u5426\u5bf9\u8fd9\u53f0redis\u542f\u52a8failover\u673a\u5236 5\uff09sentinel auth-pass mymaster 20180408 \u8bbe\u7f6e sentinel \u8fde\u63a5\u7684 master \u548c slave \u7684\u5bc6\u7801\uff0c\u8fd9\u4e2a\u9700\u8981\u548c redis.conf \u6587\u4ef6\u4e2d\u8bbe\u7f6e\u7684\u5bc6\u7801\u4e00\u6837 6\uff09sentinel failover-timeout mymaster 180000 failover\u8fc7\u671f\u65f6\u95f4\uff0c\u5f53failover\u5f00\u59cb\u540e\uff0c\u5728\u6b64\u65f6\u95f4\u5185\u4ecd\u7136\u6ca1\u6709\u89e6\u53d1\u4efb\u4f55failover\u64cd\u4f5c\uff0c\u5f53\u524dsentinel\u5c06\u4f1a\u8ba4\u4e3a\u6b64\u6b21failoer\u5931\u8d25\u3002 \u6267\u884c\u6545\u969c\u8fc1\u79fb\u8d85\u65f6\u65f6\u95f4\uff0c\u5373\u5728\u6307\u5b9a\u65f6\u95f4\u5185\u6ca1\u6709\u5927\u591a\u6570\u7684sentinel \u53cd\u9988master\u4e0b\u7ebf\uff0c\u8be5\u6545\u969c\u8fc1\u79fb\u8ba1\u5212\u5219\u5931\u6548 7\uff09sentinel config-epoch mymaster 0 \u9009\u9879\u6307\u5b9a\u4e86\u5728\u6267\u884c\u6545\u969c\u8f6c\u79fb\u65f6\uff0c \u6700\u591a\u53ef\u4ee5\u6709\u591a\u5c11\u4e2a\u4ece\u670d\u52a1\u5668\u540c\u65f6\u5bf9\u65b0\u7684\u4e3b\u670d\u52a1\u5668\u8fdb\u884c\u540c\u6b65 \u3002\u8fd9\u4e2a\u6570\u5b57\u8d8a\u5c0f\uff0c \u5b8c\u6210\u6545\u969c\u8f6c\u79fb\u6240\u9700\u7684\u65f6\u95f4\u5c31\u8d8a\u957f\u3002 8\uff09sentinel notification-script mymaster ``/var/redis/notify``.sh \u5f53failover\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a \"\u901a\u77e5\" \u811a\u672c\u7528\u6765\u544a\u77e5\u5f53\u524d\u96c6\u7fa4\u7684\u60c5\u51b5\u3002 \u811a\u672c\u88ab\u5141\u8bb8\u6267\u884c\u7684\u6700\u5927\u65f6\u95f4\u4e3a60\u79d2\uff0c\u5982\u679c\u8d85\u65f6\uff0c\u811a\u672c\u5c06\u4f1a\u88ab\u7ec8\u6b62(KILL) 9\uff09sentinel leader-epoch mymaster 0 \u540c\u65f6\u4e00\u65f6\u95f4\u6700\u591a0\u4e2aslave\u53ef\u540c\u65f6\u66f4\u65b0\u914d\u7f6e,\u5efa\u8bae\u6570\u5b57\u4e0d\u8981\u592a\u5927,\u4ee5\u514d\u5f71\u54cd\u6b63\u5e38\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002 \u4e3b\u89c2\u4e0b\u7ebf\u548c\u5ba2\u89c2\u4e0b\u7ebf \u4e3b\u89c2\u4e0b\u7ebf\uff1a\u6307\u7684\u662f\u5355\u4e2a Sentinel \u5b9e\u4f8b\u5bf9\u670d\u52a1\u5668\u505a\u51fa\u7684\u4e0b\u7ebf\u5224\u65ad\u3002 \u5ba2\u89c2\u4e0b\u7ebf\uff1a\u6307\u7684\u662f\u591a\u4e2a Sentinel \u5b9e\u4f8b\u5728\u5bf9\u540c\u4e00\u4e2a\u670d\u52a1\u5668\u505a\u51fa SDOWN\u4e3b\u89c2\u4e0b\u7ebf \u5224\u65ad\u3002","title":"3\u3001\u914d\u7f6e Sentinel"},{"location":"chap7/8Redis_HA/#4redis-sentinel","text":"1.\u6bcf\u4e2a Sentinel \u4ee5\u6bcf\u79d2\u4e00\u6b21\u7684\u9891\u7387\u5411\u5b83\u6240\u77e5\u7684\u4e3b\u670d\u52a1\u5668\u3001\u4ece\u670d\u52a1\u5668\u4ee5\u53ca\u5176\u4ed6 Sentinel \u5b9e\u4f8b\u53d1\u9001\u4e00\u4e2a PING \u547d\u4ee4\u3002 2.\u5982\u679c\u4e00\u4e2a\u5b9e\u4f8b\u8ddd\u79bb\u6700\u540e\u4e00\u6b21\u6709\u6548\u56de\u590d PING \u547d\u4ee4\u7684\u65f6\u95f4\u8d85\u8fc7\u6307\u5b9a\u7684\u503c\uff0c \u90a3\u4e48\u8fd9\u4e2a\u5b9e\u4f8b\u4f1a\u88ab Sentinel \u6807\u8bb0\u4e3a\u4e3b\u89c2\u4e0b\u7ebf\u3002 3.\u6b63\u5728\u76d1\u89c6\u8fd9\u4e2a\u4e3b\u670d\u52a1\u5668\u7684\u6240\u6709 Sentinel \u8981\u4ee5\u6bcf\u79d2\u4e00\u6b21\u7684\u9891\u7387\u786e\u8ba4\u4e3b\u670d\u52a1\u5668\u7684\u786e\u8fdb\u5165\u4e86\u4e3b\u89c2\u4e0b\u7ebf\u72b6\u6001\u3002 4. \u6709\u8db3\u591f\u6570\u91cf\u7684 Sentinel \u5728\u6307\u5b9a\u7684\u65f6\u95f4\u8303\u56f4\u5185\u540c\u610f\u8fd9\u4e00\u5224\u65ad \uff0c \u90a3\u4e48\u8fd9\u4e2a\u4e3b\u670d\u52a1\u5668\u88ab\u6807\u8bb0\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\u3002 5. \u6bcf\u4e2a Sentinel \u4f1a\u4ee5\u6bcf 10 \u79d2\u4e00\u6b21\u7684\u9891\u7387\u5411\u5b83\u5df2\u77e5\u7684\u6240\u6709\u4e3b\u670d\u52a1\u5668\u548c\u4ece\u670d\u52a1\u5668\u53d1\u9001 INFO \u547d\u4ee4 \u3002 \u5f53\u4e00\u4e2a\u4e3b\u670d\u52a1\u5668\u88ab Sentinel \u6807\u8bb0\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\u65f6\uff0c Sentinel \u5411\u4e0b\u7ebf\u4e3b\u670d\u52a1\u5668\u7684\u6240\u6709\u4ece\u670d\u52a1\u5668\u53d1\u9001 INFO \u547d\u4ee4\u7684\u9891\u7387\u4f1a\u4ece 10 \u79d2\u4e00\u6b21\u6539\u4e3a\u6bcf\u79d2\u4e00\u6b21\u3002 6. Sentinel \u548c\u5176\u4ed6 Sentinel \u534f\u5546 \u4e3b\u8282\u70b9 \u7684\u72b6\u6001\uff0c\u5982\u679c \u4e3b\u8282\u70b9 \u5904\u4e8e SDOWN \u72b6\u6001\uff0c\u5219\u6295\u7968\u81ea\u52a8\u9009\u51fa\u65b0\u7684 \u4e3b\u8282\u70b9\u3002\u5c06\u5269\u4f59\u7684 \u4ece\u8282\u70b9 \u6307\u5411 \u65b0\u7684\u4e3b\u8282\u70b9 \u8fdb\u884c \u6570\u636e\u590d\u5236 \u3002 7.\u5f53\u6ca1\u6709\u8db3\u591f\u6570\u91cf\u7684 Sentinel \u540c\u610f \u4e3b\u670d\u52a1\u5668 \u4e0b\u7ebf\u65f6\uff0c \u4e3b\u670d\u52a1\u5668 \u7684 \u5ba2\u89c2\u4e0b\u7ebf\u72b6\u6001 \u5c31\u4f1a\u88ab\u79fb\u9664\u3002 \u5f53 \u4e3b\u670d\u52a1\u5668 \u91cd\u65b0\u5411 Sentinel \u7684 PING \u547d\u4ee4\u8fd4\u56de \u6709\u6548\u56de\u590d \u65f6\uff0c\u4e3b\u670d\u52a1\u5668 \u7684 \u4e3b\u89c2\u4e0b\u7ebf\u72b6\u6001 \u5c31\u4f1a\u88ab\u79fb\u9664\u3002","title":"4\u3001Redis Sentinel \u7684\u5de5\u4f5c\u539f\u7406"},{"location":"chap7/8Redis_HA/#5-sentinel","text":"\u4e00\u4e2a Sentinel \u53ef\u4ee5\u4e0e\u5176\u4ed6\u591a\u4e2a Sentinel \u8fdb\u884c\u8fde\u63a5\uff0c \u5404\u4e2a Sentinel \u4e4b\u95f4\u53ef\u4ee5\u4e92\u76f8\u68c0\u67e5\u5bf9\u65b9\u7684\u53ef\u7528\u6027\uff0c \u5e76\u8fdb\u884c\u4fe1\u606f\u4ea4\u6362\u3002 \u4f60\u65e0\u987b\u4e3a\u8fd0\u884c\u7684\u6bcf\u4e2a Sentinel \u5206\u522b\u8bbe\u7f6e\u5176\u4ed6 Sentinel \u7684\u5730\u5740\uff0c \u56e0\u4e3a Sentinel \u53ef\u4ee5\u901a\u8fc7\u53d1\u5e03\u4e0e\u8ba2\u9605\u529f\u80fd\u6765\u81ea\u52a8\u53d1\u73b0\u6b63\u5728\u76d1\u89c6\u76f8\u540c\u4e3b\u670d\u52a1\u5668\u7684\u5176\u4ed6 Sentinel \u3002 \u6bcf\u4e2a Sentinel \u4f1a\u4ee5\u6bcf\u4e24\u79d2\u4e00\u6b21\u7684\u9891\u7387\uff0c \u901a\u8fc7\u53d1\u5e03\u4e0e\u8ba2\u9605\u529f\u80fd\uff0c \u5411\u88ab\u5b83\u76d1\u89c6\u7684\u6240\u6709\u4e3b\u670d\u52a1\u5668\u548c\u4ece\u670d\u52a1\u5668\u7684\u9891\u9053\u53d1\u9001\u4e00\u6761\u4fe1\u606f\uff0c \u4fe1\u606f\u4e2d\u5305\u542b\u4e86 Sentinel \u7684 IP \u5730\u5740\u3001\u7aef\u53e3\u53f7\u548c\u8fd0\u884c ID \uff08runid\uff09\u3002 \u6bcf\u4e2a Sentinel \u90fd\u8ba2\u9605\u4e86\u88ab\u5b83\u76d1\u89c6\u7684\u6240\u6709\u4e3b\u670d\u52a1\u5668\u548c\u4ece\u670d\u52a1\u5668\u7684\u9891\u9053\uff0c \u67e5\u627e\u4e4b\u524d\u672a\u51fa\u73b0\u8fc7\u7684 sentinel \u3002\u5f53\u4e00\u4e2a Sentinel \u53d1\u73b0\u4e00\u4e2a\u65b0\u7684 Sentinel \u65f6\uff0c \u5b83\u4f1a\u5c06\u65b0\u7684 Sentinel \u6dfb\u52a0\u5230\u4e00\u4e2a\u5217\u8868\u4e2d\u3002 Sentinel \u53d1\u9001\u7684\u4fe1\u606f\u4e2d\u8fd8\u5305\u62ec\u5b8c\u6574\u7684\u4e3b\u670d\u52a1\u5668\u5f53\u524d\u914d\u7f6e\u3002\u5982\u679c\u4e00\u4e2a Sentinel \u5305\u542b\u7684\u4e3b\u670d\u52a1\u5668\u914d\u7f6e\u6bd4\u53e6\u4e00\u4e2a Sentinel \u53d1\u9001\u7684\u914d\u7f6e\u8981\u65e7\uff0c \u90a3\u4e48\u8fd9\u4e2a Sentinel \u4f1a\u7acb\u5373\u5347\u7ea7\u5230\u65b0\u914d\u7f6e\u4e0a\u3002 \u5728\u5c06\u4e00\u4e2a\u65b0 Sentinel \u6dfb\u52a0\u5230\u76d1\u89c6\u4e3b\u670d\u52a1\u5668\u7684\u5217\u8868\u4e0a\u9762\u4e4b\u524d\uff0c Sentinel \u4f1a\u5148\u68c0\u67e5\u5217\u8868\u4e2d\u662f\u5426\u5df2\u7ecf\u5305\u542b\u4e86\u548c\u8981\u6dfb\u52a0\u7684 Sentinel \u62e5\u6709\u76f8\u540c\u8fd0\u884c ID \u6216\u8005\u76f8\u540c\u5730\u5740\uff08\u5305\u62ec IP \u5730\u5740\u548c\u7aef\u53e3\u53f7\uff09\u7684 Sentinel \uff0c \u5982\u679c\u662f\u7684\u8bdd\uff0c Sentinel \u4f1a\u5148\u79fb\u9664\u5217\u8868\u4e2d\u5df2\u6709\u7684\u90a3\u4e9b\u62e5\u6709\u76f8\u540c\u8fd0\u884c ID \u6216\u8005\u76f8\u540c\u5730\u5740\u7684 Sentinel \uff0c \u7136\u540e\u518d\u6dfb\u52a0\u65b0 Sentinel\u3002","title":"5\u3001\u81ea\u52a8\u53d1\u73b0 Sentinel \u548c\u4ece\u670d\u52a1\u5668"},{"location":"chap7/8Redis_HA/#6","text":"\u4e00\u6b21\u6545\u969c\u8f6c\u79fb\u64cd\u4f5c\u7531\u4ee5\u4e0b\u6b65\u9aa4\u7ec4\u6210\uff1a \u53d1\u73b0\u4e3b\u670d\u52a1\u5668\u5df2\u7ecf\u8fdb\u5165\u5ba2\u89c2\u4e0b\u7ebf\u72b6\u6001\u3002 \u5bf9\u6211\u4eec\u7684\u5f53\u524d\u7eaa\u5143\u8fdb\u884c\u81ea\u589e\uff0c \u5e76\u5c1d\u8bd5\u5728\u8fd9\u4e2a\u7eaa\u5143\u4e2d\u5f53\u9009\u3002 \u5982\u679c\u5f53\u9009\u5931\u8d25\uff0c \u90a3\u4e48\u5728\u8bbe\u5b9a\u7684\u6545\u969c\u8fc1\u79fb\u8d85\u65f6\u65f6\u95f4\u7684\u4e24\u500d\u4e4b\u540e\uff0c \u91cd\u65b0\u5c1d\u8bd5\u5f53\u9009\u3002\u5982\u679c\u5f53\u9009\u6210\u529f\uff0c \u90a3\u4e48\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4\u3002 \u9009\u51fa\u4e00\u4e2a\u4ece\u670d\u52a1\u5668\uff0c\u5e76\u5c06\u5b83\u5347\u7ea7\u4e3a\u4e3b\u670d\u52a1\u5668\u3002 \u5411\u88ab\u9009\u4e2d\u7684\u4ece\u670d\u52a1\u5668\u53d1\u9001 SLAVEOF NO ONE \u547d\u4ee4\uff0c\u8ba9\u5b83\u8f6c\u53d8\u4e3a\u4e3b\u670d\u52a1\u5668\u3002 \u901a\u8fc7\u53d1\u5e03\u4e0e\u8ba2\u9605\u529f\u80fd\uff0c \u5c06\u66f4\u65b0\u540e\u7684\u914d\u7f6e\u4f20\u64ad\u7ed9\u6240\u6709\u5176\u4ed6 Sentinel \uff0c \u5176\u4ed6 Sentinel \u5bf9\u5b83\u4eec\u81ea\u5df1\u7684\u914d\u7f6e\u8fdb\u884c\u66f4\u65b0\u3002 \u5411\u5df2\u4e0b\u7ebf\u4e3b\u670d\u52a1\u5668\u7684\u4ece\u670d\u52a1\u5668\u53d1\u9001 SLAVEOF \u547d\u4ee4\uff0c \u8ba9\u5b83\u4eec\u53bb\u590d\u5236\u65b0\u7684\u4e3b\u670d\u52a1\u5668\u3002 \u5f53\u6240\u6709\u4ece\u670d\u52a1\u5668\u90fd\u5df2\u7ecf\u5f00\u59cb\u590d\u5236\u65b0\u7684\u4e3b\u670d\u52a1\u5668\u65f6\uff0c \u9886\u5934 Sentinel \u7ec8\u6b62\u8fd9\u6b21\u6545\u969c\u8fc1\u79fb\u64cd\u4f5c\u3002","title":"6\u3001\u6545\u969c\u8f6c\u79fb"},{"location":"chap8/1redis_6.0_fea/","text":"\u7b2c\u4e00\u8282 Redis 6.0\u7684\u65b0\u7279\u6027\uff1a\u591a\u7ebf\u7a0b\u3001\u5ba2\u6237\u7aef\u7f13\u5b58\u4e0e\u5b89\u5168 Redis \u5b98\u65b9\u5728\u4eca\u5e74 5 \u6708\u4efd\u6b63\u5f0f\u63a8\u51fa\u4e86 6.0 \u7248\u672c\uff0c\u8fd9\u4e2a\u7248\u672c\u4e2d\u6709\u5f88\u591a\u7684\u65b0\u7279\u6027\u3002\u6240\u4ee5\uff0c6.0 \u521a\u521a\u63a8\u51fa\uff0c\u5c31\u53d7\u5230\u4e86\u4e1a\u754c\u7684\u5e7f\u6cdb\u5173\u6ce8\u3002 \u804a Redis 6.0 \u4e2d\u7684\u51e0\u4e2a\u5173\u952e\u65b0\u7279\u6027\uff0c \u5206\u522b\u662f\u9762\u5411\u7f51\u7edc\u5904\u7406\u7684\u591a IO \u7ebf\u7a0b\u3001\u5ba2\u6237\u7aef\u7f13\u5b58\u3001\u7ec6\u7c92\u5ea6\u7684\u6743\u9650\u63a7\u5236\uff0c\u4ee5\u53ca RESP 3 \u534f\u8bae\u7684\u4f7f\u7528\u3002 \u9762\u5411\u7f51\u7edc\u5904\u7406\u7684\u591a IO \u7ebf\u7a0b\u53ef\u4ee5\u63d0\u9ad8\u7f51\u7edc\u8bf7\u6c42\u5904\u7406\u7684\u901f\u5ea6 \u800c\u5ba2\u6237\u7aef\u7f13\u5b58\u53ef\u4ee5\u8ba9\u5e94\u7528\u76f4\u63a5\u5728\u5ba2\u6237\u7aef\u672c\u5730\u8bfb\u53d6\u6570\u636e\uff0c\u8fd9\u4e24\u4e2a\u7279\u6027\u53ef\u4ee5\u63d0\u5347 Redis \u7684\u6027\u80fd \u3002 \u7ec6\u7c92\u5ea6\u6743\u9650\u63a7\u5236\u8ba9 Redis \u53ef\u4ee5\u6309\u7167\u547d\u4ee4\u7c92\u5ea6\u63a7\u5236\u4e0d\u540c\u7528\u6237\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u52a0\u5f3a\u4e86 Redis \u7684\u5b89\u5168\u4fdd\u62a4\u3002 RESP 3 \u534f\u8bae\u5219\u589e\u5f3a\u5ba2\u6237\u7aef\u7684\u529f\u80fd\uff0c\u53ef\u4ee5\u8ba9\u5e94\u7528\u66f4\u52a0\u65b9\u4fbf\u5730\u4f7f\u7528 Redis \u7684\u4e0d\u540c\u6570\u636e\u7c7b\u578b\u3002 1\u3001\u4ece\u5355\u7ebf\u7a0b\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\u5230\u591a\u7ebf\u7a0b\u5904\u7406 \u5728 Redis 6.0 \u4e2d\uff0c\u975e\u5e38\u53d7\u5173\u6ce8\u7684\u7b2c\u4e00\u4e2a\u65b0\u7279\u6027\u5c31\u662f\u591a\u7ebf\u7a0b\u3002 \uff0cRedis \u4e00\u76f4\u88ab\u5927\u5bb6\u719f\u77e5\u7684\u5c31\u662f\u5b83\u7684\u5355\u7ebf\u7a0b\u67b6\u6784\uff0c\u867d\u7136\u6709\u4e9b\u547d\u4ee4\u64cd\u4f5c\u53ef\u4ee5\u7528\u540e\u53f0\u7ebf\u7a0b\u6216\u5b50\u8fdb\u7a0b\u6267\u884c\uff08\u6bd4\u5982\u6570\u636e\u5220\u9664\u3001\u5feb\u7167\u751f\u6210\u3001AOF \u91cd\u5199\uff09\uff0c\u4f46\u662f\uff0c \u4ece\u7f51\u7edc IO \u5904\u7406\u5230\u5b9e\u9645\u7684\u8bfb\u5199\u547d\u4ee4\u5904\u7406\uff0c\u90fd\u662f\u7531\u5355\u4e2a\u7ebf\u7a0b\u5b8c\u6210\u7684 \u3002 \u968f\u7740\u7f51\u7edc\u786c\u4ef6\u7684\u6027\u80fd\u63d0\u5347\uff0cRedis \u7684\u6027\u80fd\u74f6\u9888\u6709\u65f6\u4f1a\u51fa\u73b0\u5728\u7f51\u7edc IO \u7684\u5904\u7406\u4e0a\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c \u5355\u4e2a\u4e3b\u7ebf\u7a0b\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\u7684\u901f\u5ea6\u8ddf\u4e0d\u4e0a\u5e95\u5c42\u7f51\u7edc\u786c\u4ef6\u7684\u901f\u5ea6\u3002 \u4e3a\u4e86\u5e94\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u4e00\u822c\u6709\u4e24\u79cd\u65b9\u6cd5\u3002 \u7b2c\u4e00\u79cd\u65b9\u6cd5\u662f\uff0c \u7528\u7528\u6237\u6001\u7f51\u7edc\u534f\u8bae\u6808\uff08\u4f8b\u5982 DPDK\uff09\u53d6\u4ee3\u5185\u6838\u7f51\u7edc\u534f\u8bae\u6808 \uff0c\u8ba9\u7f51\u7edc\u8bf7\u6c42\u7684\u5904\u7406\u4e0d\u7528\u5728\u5185\u6838\u91cc\u6267\u884c\uff0c\u76f4\u63a5\u5728\u7528\u6237\u6001\u5b8c\u6210\u5904\u7406\u5c31\u884c\u3002 DPDK\u5168\u79f0Intel Data Plane Development Kit\uff0c\u662fintel\u63d0\u4f9b\u7684\u6570\u636e\u5e73\u9762\u5f00\u53d1\u5de5\u5177\u96c6\uff0c\u4e3aIntel architecture\uff08IA\uff09\u5904\u7406\u5668\u67b6\u6784\u4e0b\u7528\u6237\u7a7a\u95f4\u9ad8\u6548\u7684\u6570\u636e\u5305\u5904\u7406\u63d0\u4f9b\u5e93\u51fd\u6570\u548c\u9a71\u52a8\u7684\u652f\u6301\u3002\u901a\u4fd7\u5730\u8bf4\uff0c\u5c31\u662f\u4e00\u4e2a\u7528\u6765\u8fdb\u884c\u5305\u6570\u636e\u5904\u7406\u52a0\u901f\u7684\u8f6f\u4ef6\u5e93\u3002 \u5bf9\u4e8e\u9ad8\u6027\u80fd\u7684 Redis \u6765\u8bf4\uff0c\u907f\u514d\u9891\u7e41\u8ba9\u5185\u6838\u8fdb\u884c\u7f51\u7edc\u8bf7\u6c42\u5904\u7406\uff0c\u53ef\u4ee5\u5f88\u597d\u5730\u63d0\u5347\u8bf7\u6c42\u5904\u7406\u6548\u7387\u3002 \u4f46\u662f\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u8981\u6c42\u5728 Redis \u7684\u6574\u4f53\u67b6\u6784\u4e2d\uff0c\u6dfb\u52a0\u5bf9\u7528\u6237\u6001\u7f51\u7edc\u534f\u8bae\u6808\u7684\u652f\u6301\uff0c\u9700\u8981\u4fee\u6539 Redis \u6e90\u7801\u4e2d\u548c\u7f51\u7edc\u76f8\u5173\u7684\u90e8\u5206\uff08\u4f8b\u5982\u4fee\u6539\u6240\u6709\u7684\u7f51\u7edc\u6536\u53d1\u8bf7\u6c42\u51fd\u6570\uff09\uff0c\u8fd9\u4f1a\u5e26\u6765\u5f88\u591a\u5f00\u53d1\u5de5\u4f5c\u91cf\u3002\u800c\u4e14\u65b0\u589e\u4ee3\u7801\u8fd8\u53ef\u80fd\u5f15\u5165\u65b0 Bug\uff0c\u5bfc\u81f4\u7cfb\u7edf\u4e0d\u7a33\u5b9a\u3002\u6240\u4ee5\uff0cRedis 6.0 \u4e2d\u5e76\u6ca1\u6709\u91c7\u7528\u8fd9\u4e2a\u65b9\u6cd5\u3002 1-1 Redis \u7684\u591a IO \u7ebf\u7a0b\u53ea\u662f\u7528\u6765\u5904\u7406\u7f51\u7edc\u8bf7\u6c42 \u7b2c\u4e8c\u79cd\u65b9\u6cd5\u5c31\u662f\u91c7\u7528\u591a\u4e2a IO \u7ebf\u7a0b\u6765\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\uff0c\u63d0\u9ad8\u7f51\u7edc\u8bf7\u6c42\u5904\u7406\u7684\u5e76\u884c\u5ea6\u3002Redis 6.0 \u5c31\u662f\u91c7\u7528\u7684\u8fd9\u79cd\u65b9\u6cd5\u3002 \u4f46\u662f\uff0c Redis \u7684\u591a IO \u7ebf\u7a0b\u53ea\u662f\u7528\u6765\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\u7684\uff0c\u5bf9\u4e8e\u8bfb\u5199\u547d\u4ee4\uff0cRedis \u4ecd\u7136\u4f7f\u7528\u5355\u7ebf\u7a0b\u6765\u5904\u7406 \u3002 \u8fd9\u662f\u56e0\u4e3a\uff0cRedis \u5904\u7406\u8bf7\u6c42\u65f6\uff0c\u7f51\u7edc\u5904\u7406\u7ecf\u5e38\u662f\u74f6\u9888\uff0c\u901a\u8fc7\u591a\u4e2a IO \u7ebf\u7a0b\u5e76\u884c\u5904\u7406\u7f51\u7edc\u64cd\u4f5c\uff0c\u53ef\u4ee5\u63d0\u5347\u5b9e\u4f8b\u7684\u6574\u4f53\u5904\u7406\u6027\u80fd \u3002 \u800c\u7ee7\u7eed\u4f7f\u7528\u5355\u7ebf\u7a0b\u6267\u884c\u547d\u4ee4\u64cd\u4f5c\uff0c\u5c31\u4e0d\u7528\u4e3a\u4e86\u4fdd\u8bc1 Lua \u811a\u672c\u3001\u4e8b\u52a1\u7684\u539f\u5b50\u6027\uff0c\u989d\u5916\u5f00\u53d1\u591a\u7ebf\u7a0b\u4e92\u65a5\u673a\u5236\u4e86\u3002\u8fd9\u6837\u4e00\u6765\uff0cRedis \u7ebf\u7a0b\u6a21\u578b\u5b9e\u73b0\u5c31\u7b80\u5355\u4e86 1-2 \u9636\u6bb5\u4e00\uff1a\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u5efa\u7acb Socket \u8fde\u63a5\uff0c\u5e76\u5206\u914d\u5904\u7406\u7ebf\u7a0b \u9996\u5148\uff0c\u4e3b\u7ebf\u7a0b\u8d1f\u8d23\u63a5\u6536\u5efa\u7acb\u8fde\u63a5\u8bf7\u6c42\u3002 \u5f53\u6709\u5ba2\u6237\u7aef\u8bf7\u6c42\u548c\u5b9e\u4f8b\u5efa\u7acb Socket \u8fde\u63a5\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u521b\u5efa\u548c\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\uff0c\u5e76\u628a Socket \u653e\u5165\u5168\u5c40\u7b49\u5f85\u961f\u5217\u4e2d\u3002 \u7d27\u63a5\u7740\uff0c\u4e3b\u7ebf\u7a0b\u901a\u8fc7\u8f6e\u8be2\u65b9\u6cd5\u628a Socket \u8fde\u63a5\u5206\u914d\u7ed9 IO \u7ebf\u7a0b \u3002 1-3 \u9636\u6bb5\u4e8c\uff1aIO \u7ebf\u7a0b\u8bfb\u53d6\u5e76\u89e3\u6790\u8bf7\u6c42 \u4e3b\u7ebf\u7a0b\u4e00\u65e6\u628a Socket \u5206\u914d\u7ed9 IO \u7ebf\u7a0b\uff0c\u5c31\u4f1a\u8fdb\u5165\u963b\u585e\u72b6\u6001\uff0c\u7b49\u5f85 IO \u7ebf\u7a0b\u5b8c\u6210\u5ba2\u6237\u7aef\u8bf7\u6c42\u8bfb\u53d6\u548c\u89e3\u6790\u3002\u56e0\u4e3a\u6709\u591a\u4e2a IO \u7ebf\u7a0b\u5728\u5e76\u884c\u5904\u7406\uff0c\u6240\u4ee5\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5f88\u5feb\u5c31\u53ef\u4ee5\u5b8c\u6210\u3002 1-4 \u9636\u6bb5\u4e09\uff1a\u4e3b\u7ebf\u7a0b\u6267\u884c\u8bf7\u6c42\u64cd\u4f5c \u7b49\u5230 IO \u7ebf\u7a0b\u89e3\u6790\u5b8c\u8bf7\u6c42\uff0c\u4e3b\u7ebf\u7a0b\u8fd8\u662f\u4f1a\u4ee5\u5355\u7ebf\u7a0b\u7684\u65b9\u5f0f\u6267\u884c\u8fd9\u4e9b\u547d\u4ee4\u64cd\u4f5c\u3002\u4e0b\u9762\u8fd9\u5f20\u56fe\u663e\u793a\u4e86\u521a\u624d\u4ecb\u7ecd\u7684\u8fd9\u4e09\u4e2a\u9636\u6bb5\u3002 1-5 \u9636\u6bb5\u56db\uff1aIO \u7ebf\u7a0b\u56de\u5199 Socket \u548c\u4e3b\u7ebf\u7a0b\u6e05\u7a7a\u5168\u5c40\u961f\u5217 \u5f53\u4e3b\u7ebf\u7a0b\u6267\u884c\u5b8c\u8bf7\u6c42\u64cd\u4f5c\u540e\uff0c \u4f1a\u628a\u9700\u8981\u8fd4\u56de\u7684\u7ed3\u679c\u5199\u5165\u7f13\u51b2\u533a\uff0c\u7136\u540e\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u963b\u585e\u7b49\u5f85 IO \u7ebf\u7a0b\u628a\u8fd9\u4e9b\u7ed3\u679c\u56de\u5199\u5230 Socket \u4e2d\uff0c\u5e76\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef \u3002 \u548c IO \u7ebf\u7a0b\u8bfb\u53d6\u548c\u89e3\u6790\u8bf7\u6c42\u4e00\u6837\uff0cIO \u7ebf\u7a0b\u56de\u5199 Socket \u65f6\uff0c\u4e5f\u662f\u6709\u591a\u4e2a\u7ebf\u7a0b\u5728\u5e76\u53d1\u6267\u884c\uff0c\u6240\u4ee5\u56de\u5199 Socket \u7684\u901f\u5ea6\u4e5f\u5f88\u5feb\u3002 \u7b49\u5230 IO \u7ebf\u7a0b\u56de\u5199 Socket \u5b8c\u6bd5\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u6e05\u7a7a\u5168\u5c40\u961f\u5217\uff0c\u7b49\u5f85\u5ba2\u6237\u7aef\u7684\u540e\u7eed\u8bf7\u6c42\u3002 \u4e86\u89e3\u4e86 Redis \u4e3b\u7ebf\u7a0b\u548c\u591a\u7ebf\u7a0b\u7684\u534f\u4f5c\u65b9\u5f0f\uff0c\u6211\u4eec\u8be5\u600e\u4e48\u542f\u7528\u591a\u7ebf\u7a0b\u5462\uff1f \u5728 Redis 6.0 \u4e2d\uff0c\u591a\u7ebf\u7a0b\u673a\u5236\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\uff0c\u5982\u679c\u9700\u8981\u4f7f\u7528\u591a\u7ebf\u7a0b\u529f\u80fd\uff0c\u9700\u8981\u5728 redis.conf \u4e2d\u5b8c\u6210\u4e24\u4e2a\u8bbe\u7f6e \u3002 1. \u8bbe\u7f6e io-thread-do-reads \u914d\u7f6e\u9879\u4e3a yes\uff0c\u8868\u793a\u542f\u7528\u591a\u7ebf\u7a0b\u3002 io-threads-do-reads yes 2. \u8bbe\u7f6e\u7ebf\u7a0b\u4e2a\u6570\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u7ebf\u7a0b\u4e2a\u6570\u8981\u5c0f\u4e8e Redis \u5b9e\u4f8b\u6240\u5728\u673a\u5668\u7684 CPU \u6838\u4e2a\u6570\uff0c\u4f8b\u5982\uff0c\u5bf9\u4e8e\u4e00\u4e2a 8 \u6838\u7684\u673a\u5668\u6765\u8bf4\uff0cRedis \u5b98\u65b9\u5efa\u8bae\u914d\u7f6e 6 \u4e2a IO \u7ebf\u7a0b\u3002 io-threads 6 \u5982\u679c\u4f60\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u53d1\u73b0 Redis \u5b9e\u4f8b\u7684 CPU \u5f00\u9500\u4e0d\u5927\uff0c\u541e\u5410\u91cf\u5374\u6ca1\u6709\u63d0\u5347\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 Redis 6.0 \u7684\u591a\u7ebf\u7a0b\u673a\u5236\uff0c\u52a0\u901f\u7f51\u7edc\u5904\u7406\uff0c\u8fdb\u800c\u63d0\u5347\u5b9e\u4f8b\u7684\u541e\u5410\u91cf\u3002 2\u3001\u5b9e\u73b0\u670d\u52a1\u7aef\u534f\u52a9\u7684\u5ba2\u6237\u7aef\u7f13\u5b58 2-1 \u5ba2\u6237\u7aef\u7f13\u5b58\u529f\u80fd \u548c\u4e4b\u524d\u7684\u7248\u672c\u76f8\u6bd4\uff0cRedis 6.0 \u65b0\u589e\u4e86\u4e00\u4e2a\u91cd\u8981\u7684\u7279\u6027\uff0c\u5c31\u662f\u5b9e\u73b0\u4e86\u670d\u52a1\u7aef\u534f\u52a9\u7684\u5ba2\u6237\u7aef\u7f13\u5b58\u529f\u80fd\uff0c\u4e5f\u79f0\u4e3a\u8ddf\u8e2a\uff08Tracking\uff09\u529f\u80fd\u3002 \u6709\u4e86\u8fd9\u4e2a\u529f\u80fd\uff0c \u4e1a\u52a1\u5e94\u7528\u4e2d\u7684 Redis \u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u628a\u8bfb\u53d6\u7684\u6570\u636e\u7f13\u5b58\u5728\u4e1a\u52a1\u5e94\u7528\u672c\u5730 \u4e86\uff0c\u5e94\u7528\u5c31\u53ef\u4ee5\u76f4\u63a5\u5728\u672c\u5730\u5feb\u901f\u8bfb\u53d6\u6570\u636e\u4e86\u3002 \u4e0d\u8fc7\uff0c\u5f53\u628a\u6570\u636e\u7f13\u5b58\u5728\u5ba2\u6237\u7aef\u672c\u5730\u65f6\uff0c\u6211\u4eec\u4f1a\u9762\u4e34\u4e00\u4e2a\u95ee\u9898\uff1a \u5982\u679c\u6570\u636e\u88ab\u4fee\u6539\u4e86\u6216\u662f\u5931\u6548\u4e86\uff0c\u5982\u4f55\u901a\u77e5\u5ba2\u6237\u7aef\u5bf9\u7f13\u5b58\u7684\u6570\u636e\u505a\u5931\u6548\u5904\u7406\uff1f 6.0 \u5b9e\u73b0\u7684 Tracking \u529f\u80fd\u5b9e\u73b0\u4e86\u4e24\u79cd\u6a21\u5f0f\uff0c\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002 2-2 \u666e\u901a\u6a21\u5f0f \u7b2c\u4e00\u79cd\u6a21\u5f0f\u662f\u666e\u901a\u6a21\u5f0f\u3002 \u5728\u8fd9\u4e2a\u6a21\u5f0f\u4e0b\uff0c \u5b9e\u4f8b\u4f1a\u5728\u670d\u52a1\u7aef\u8bb0\u5f55\u5ba2\u6237\u7aef\u8bfb\u53d6\u8fc7\u7684 key\uff0c\u5e76\u76d1\u6d4b key \u662f\u5426\u6709\u4fee\u6539 \u3002\u4e00\u65e6 key \u7684\u503c\u53d1\u751f\u53d8\u5316\uff0c \u670d\u52a1\u7aef\u4f1a\u7ed9\u5ba2\u6237\u7aef\u53d1\u9001 invalidate \u6d88\u606f\uff0c\u901a\u77e5\u5ba2\u6237\u7aef\u7f13\u5b58\u5931\u6548\u4e86\u3002 \u5728\u4f7f\u7528\u666e\u901a\u6a21\u5f0f\u65f6\uff0c\u6709\u4e00\u70b9\u4f60\u9700\u8981\u6ce8\u610f\u4e00\u4e0b\uff0c\u670d\u52a1\u7aef\u5bf9\u4e8e\u8bb0\u5f55\u7684 key \u53ea\u4f1a\u62a5\u544a\u4e00\u6b21 invalidate \u6d88\u606f\uff0c \u4e5f\u5c31\u662f\u8bf4\uff0c\u670d\u52a1\u7aef\u5728\u7ed9\u5ba2\u6237\u7aef\u53d1\u9001\u8fc7\u4e00\u6b21 invalidate \u6d88\u606f\u540e\uff0c\u5982\u679c key \u518d\u88ab\u4fee\u6539\uff0c\u6b64\u65f6\uff0c\u670d\u52a1\u7aef\u5c31\u4e0d\u4f1a\u518d\u6b21\u7ed9\u5ba2\u6237\u7aef\u53d1\u9001 invalidate \u6d88\u606f \u3002 \u53ea\u6709\u5f53\u5ba2\u6237\u7aef\u518d\u6b21\u6267\u884c\u8bfb\u547d\u4ee4\u65f6\uff0c\u670d\u52a1\u7aef\u624d\u4f1a\u518d\u6b21\u76d1\u6d4b\u88ab\u8bfb\u53d6\u7684 key\uff0c\u5e76\u5728 key \u4fee\u6539\u65f6\u53d1\u9001 invalidate \u6d88 \u606f\u3002\u8fd9\u6837\u8bbe\u8ba1\u7684\u8003\u8651\u662f\u8282\u7701\u6709\u9650\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u6bd5\u7adf\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u4e0d\u518d\u8bbf\u95ee\u8fd9\u4e2a key \u4e86\uff0c\u800c\u670d\u52a1\u7aef\u4ecd\u7136\u8bb0\u5f55 key \u7684\u4fee\u6539\u60c5\u51b5\uff0c\u5c31\u4f1a\u6d6a\u8d39\u5185\u5b58\u8d44\u6e90\u3002 \u6253\u5f00\u6216\u5173\u95ed\u666e\u901a\u6a21\u5f0f\u4e0b\u7684 Tracking \u529f\u80fd CLIENT TRACKING ON|OFF 2-3 \u5e7f\u64ad\u6a21\u5f0f \u7b2c\u4e8c\u79cd\u6a21\u5f0f\u662f\u5e7f\u64ad\u6a21\u5f0f\u3002\u5728\u8fd9\u4e2a\u6a21\u5f0f\u4e0b\uff0c \u670d\u52a1\u7aef\u4f1a\u7ed9\u5ba2\u6237\u7aef\u5e7f\u64ad\u6240\u6709 key \u7684\u5931\u6548\u60c5\u51b5\uff0c\u4e0d\u8fc7\uff0c\u8fd9\u6837\u505a\u4e86\u4e4b\u540e\uff0c\u5982\u679c key \u88ab\u9891\u7e41\u4fee\u6539\uff0c\u670d\u52a1\u7aef\u4f1a\u53d1\u9001\u5927\u91cf\u7684\u5931\u6548\u5e7f\u64ad\u6d88\u606f\uff0c\u8fd9\u5c31\u4f1a\u6d88\u8017\u5927\u91cf\u7684\u7f51\u7edc\u5e26\u5bbd\u8d44\u6e90\u3002 \u6240\u4ee5\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u65f6\uff0c \u4f1a\u8ba9\u5ba2\u6237\u7aef\u6ce8\u518c\u5e0c\u671b\u8ddf\u8e2a\u7684 key \u7684\u524d\u7f00 \uff0c\u5f53\u5e26\u6709\u6ce8\u518c\u524d\u7f00\u7684 key \u88ab\u4fee\u6539\u65f6\uff0c\u670d\u52a1\u7aef\u4f1a\u628a\u5931\u6548\u6d88\u606f\u5e7f\u64ad\u7ed9\u6240\u6709\u6ce8\u518c\u7684\u5ba2\u6237\u7aef\u3002 \u548c\u666e\u901a\u6a21\u5f0f\u4e0d\u540c\uff0c\u5728\u5e7f\u64ad\u6a21\u5f0f\u4e0b\uff0c\u5373\u4f7f\u5ba2\u6237\u7aef\u8fd8\u6ca1\u6709\u8bfb\u53d6\u8fc7 key\uff0c\u4f46\u53ea\u8981\u5b83\u6ce8\u518c\u4e86\u8981\u8ddf\u8e2a\u7684 key\uff0c\u670d\u52a1\u7aef\u90fd\u4f1a\u628a key \u5931\u6548\u6d88\u606f\u901a\u77e5\u7ed9\u8fd9\u4e2a\u5ba2\u6237\u7aef\u3002 \u5ba2\u6237\u7aef\u5982\u4f55\u4f7f\u7528\u5e7f\u64ad\u6a21\u5f0f\u63a5\u6536 key \u5931\u6548\u6d88\u606f\u3002 \u5f53\u6211\u4eec\u5728\u5ba2\u6237\u7aef\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u540e\uff0c\u5982\u679c\u670d\u52a1\u7aef\u66f4\u65b0\u4e86 user:id:1003 \u8fd9\u4e2a key\uff0c\u90a3\u4e48\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u6536\u5230 invalidate \u6d88\u606f\u3002 CLIENT TRACKING ON BCAST PREFIX user \u8fd9\u79cd\u76d1\u6d4b\u5e26\u6709\u524d\u7f00\u7684 key \u7684\u5e7f\u64ad\u6a21\u5f0f\uff0c\u548c\u6211\u4eec\u5bf9 key \u7684\u547d\u540d\u89c4\u8303\u975e\u5e38\u5339\u914d\u3002 \u6211\u4eec\u5728\u5b9e\u9645\u5e94\u7528\u65f6\uff0c\u4f1a\u7ed9\u540c\u4e00\u4e1a\u52a1\u4e0b\u7684 key \u8bbe\u7f6e\u76f8\u540c\u7684\u4e1a\u52a1\u540d\u524d\u7f00\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u4f7f\u7528\u5e7f\u64ad\u6a21\u5f0f\u3002 2-4 RESP 3 & RESP 2 \u534f\u8bae \u4e0d\u8fc7\uff0c\u521a\u624d\u4ecb\u7ecd\u7684\u666e\u901a\u6a21\u5f0f\u548c\u5e7f\u64ad\u6a21\u5f0f\uff0c\u9700\u8981\u5ba2\u6237\u7aef\u4f7f\u7528 RESP 3 \u534f\u8bae\uff0cRESP 3 \u534f\u8bae\u662f 6.0 \u65b0\u542f\u7528\u7684\u901a\u4fe1\u534f\u8bae \u5bf9\u4e8e\u4f7f\u7528 RESP 2 \u534f\u8bae\u7684\u5ba2\u6237\u7aef\u6765\u8bf4\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u53e6\u4e00\u79cd\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f\u91cd\u5b9a\u5411\u6a21\u5f0f\uff08redirect\uff09 \u3002 \u5728\u91cd\u5b9a\u5411\u6a21\u5f0f\u4e0b\uff0c\u60f3\u8981\u83b7\u5f97\u5931\u6548\u6d88\u606f\u901a\u77e5\u7684\u5ba2\u6237\u7aef\uff0c\u5c31\u9700\u8981\u6267\u884c\u8ba2\u9605\u547d\u4ee4 SUBSCRIBE \uff0c\u4e13\u95e8\u8ba2\u9605\u7528\u4e8e\u53d1\u9001\u5931\u6548\u6d88\u606f\u7684\u9891\u9053 _redis_:invalidate \u3002 \u540c\u65f6\uff0c\u518d\u4f7f\u7528\u53e6\u5916\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u6267\u884c CLIENT TRACKING \u547d\u4ee4\uff0c\u8bbe\u7f6e\u670d\u52a1\u7aef\u5c06\u5931\u6548\u6d88\u606f\u8f6c\u53d1\u7ed9\u4f7f\u7528 RESP 2 \u534f\u8bae\u7684\u5ba2\u6237\u7aef\u3002 \u5e26\u4f60\u4e86\u89e3\u4e0b\u5982\u4f55\u8ba9\u4f7f\u7528 RESP 2 \u534f\u8bae\u7684\u5ba2\u6237\u7aef\u4e5f\u80fd\u63a5\u53d7\u5931\u6548\u6d88\u606f\u3002\u5047\u8bbe\u5ba2\u6237\u7aef B \u60f3\u8981\u83b7\u53d6\u5931\u6548\u6d88\u606f\uff0c\u4f46\u662f\u5ba2\u6237\u7aef B \u53ea\u652f\u6301 RESP 2 \u534f\u8bae\uff0c\u5ba2\u6237\u7aef A \u652f\u6301 RESP 3 \u534f\u8bae\u3002 \u6211\u4eec\u53ef\u4ee5\u5206\u522b\u5728\u5ba2\u6237\u7aef B \u548c A \u4e0a\u6267\u884c SUBSCRIBE \u548c CLIENT TRACKING \uff0c\u5982\u4e0b\u6240\u793a\uff1a //\u5ba2\u6237\u7aefB\u6267\u884c\uff0c\u5ba2\u6237\u7aefB\u7684ID\u53f7\u662f303 SUBSCRIBE _redis_:invalidate //\u5ba2\u6237\u7aefA\u6267\u884c CLIENT TRACKING ON BCAST REDIRECT 303 \u8fd9\u6837\u8bbe\u7f6e\u4ee5\u540e\uff0c\u5982\u679c\u6709\u952e\u503c\u5bf9\u88ab\u4fee\u6539\u4e86\uff0c\u5ba2\u6237\u7aef B \u5c31\u53ef\u4ee5\u901a\u8fc7 _redis_:invalidate \u9891\u9053\uff0c\u83b7\u5f97\u5931\u6548\u6d88\u606f\u4e86\u3002 3\u3001\u4ece\u7b80\u5355\u7684\u57fa\u4e8e\u5bc6\u7801\u8bbf\u95ee\u5230\u7ec6\u7c92\u5ea6\u7684\u6743\u9650\u63a7\u5236 \u5728 Redis 6.0 \u7248\u672c\u4e4b\u524d\uff0c\u8981\u60f3\u5b9e\u73b0\u5b9e\u4f8b\u7684\u5b89\u5168\u8bbf\u95ee\uff0c\u53ea\u80fd\u901a\u8fc7\u8bbe\u7f6e\u5bc6\u7801\u6765\u63a7\u5236\uff0c\u4f8b\u5982\uff0c\u5ba2\u6237\u7aef\u8fde\u63a5\u5b9e\u4f8b\u524d\u9700\u8981\u8f93\u5165\u5bc6\u7801\u3002 \u6b64\u5916\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u9ad8\u98ce\u9669\u7684\u547d\u4ee4\uff08\u4f8b\u5982 KEYS\u3001FLUSHDB\u3001FLUSHALL \u7b49\uff09\uff0c\u5728 Redis 6.0 \u4e4b\u524d\uff0c\u6211\u4eec\u4e5f\u53ea\u80fd\u901a\u8fc7 rename-command \u6765\u91cd\u65b0\u547d\u540d\u8fd9\u4e9b\u547d\u4ee4\uff0c\u907f\u514d\u5ba2\u6237\u7aef\u76f4\u63a5\u8c03\u7528\u3002 Redis 6.0 \u63d0\u4f9b\u4e86\u66f4\u52a0\u7ec6\u7c92\u5ea6\u7684\u8bbf\u95ee\u6743\u9650\u63a7\u5236\uff0c\u8fd9\u4e3b\u8981\u6709\u4e24\u65b9\u9762\u7684\u4f53\u73b0\u3002 3-1 6.0 \u7248\u672c\u652f\u6301\u521b\u5efa\u4e0d\u540c\u7528\u6237\u6765\u4f7f\u7528 Redis\u3002 \u5728 6.0 \u7248\u672c\u524d\uff0c\u6240\u6709\u5ba2\u6237\u7aef\u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u4e2a\u5bc6\u7801\u8fdb\u884c\u767b\u5f55\u4f7f\u7528\uff0c\u4f46\u662f\u6ca1\u6709\u7528\u6237\u7684\u6982\u5ff5\uff0c\u800c\u5728 6.0 \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ACL SETUSER \u547d\u4ee4\u521b\u5efa\u7528\u6237\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u521b\u5efa\u5e76\u542f\u7528\u4e00\u4e2a\u7528\u6237 normaluser\uff0c\u628a\u5b83\u7684\u5bc6\u7801\u8bbe\u7f6e\u4e3a\u201cabc\u201d\uff1a ACL SETUSER normaluser on > abc \u53e6\u5916\uff0c6.0 \u7248\u672c\u8fd8\u652f\u6301\u4ee5\u7528\u6237\u4e3a\u7c92\u5ea6\u8bbe\u7f6e\u547d\u4ee4\u64cd\u4f5c\u7684\u8bbf\u95ee\u6743\u9650\u3002\u5177\u4f53\u64cd\u4f5c\u5217\u5728\u4e86\u4e0b\u8868\u4e2d\uff0c\u4f60\u53ef\u4ee5\u770b\u4e0b\uff0c\u5176\u4e2d\uff0c\u52a0\u53f7\uff08+\uff09\u548c\u51cf\u53f7\uff08-\uff09\u5c31\u5206\u522b\u8868\u793a\u7ed9\u7528\u6237\u8d4b\u4e88\u6216\u64a4\u9500\u547d\u4ee4\u7684\u8c03\u7528\u6743\u9650\u3002 \u5047\u8bbe\u6211\u4eec\u8981\u8bbe\u7f6e\u7528\u6237 normaluser \u53ea\u80fd\u8c03\u7528 Hash \u7c7b\u578b\u7684\u547d\u4ee4\u64cd\u4f5c\uff0c\u800c\u4e0d\u80fd\u8c03\u7528 String \u7c7b\u578b\u7684\u547d\u4ee4\u64cd\u4f5c\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a ACL SETUSER normaluser +@hash -@string \u9664\u4e86\u8bbe\u7f6e\u67d0\u4e2a\u547d\u4ee4\u6216\u67d0\u7c7b\u547d\u4ee4\u7684\u8bbf\u95ee\u63a7\u5236\u6743\u9650\uff0c6.0 \u7248\u672c\u8fd8\u652f\u6301\u4ee5 key \u4e3a\u7c92\u5ea6\u8bbe\u7f6e\u8bbf\u95ee\u6743\u9650\u3002 \u5177\u4f53\u7684\u505a\u6cd5\u662f\u4f7f\u7528\u6ce2\u6d6a\u53f7 \u201c~\u201d \u548c key \u7684\u524d\u7f00\u6765\u8868\u793a\u63a7\u5236\u8bbf\u95ee\u7684 key\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u8bbe\u7f6e\u7528\u6237 normaluser \u53ea\u80fd\u5bf9\u4ee5 \u201cuser:\u201d \u4e3a\u524d\u7f00\u7684 key \u8fdb\u884c\u547d\u4ee4\u64cd\u4f5c\uff1a ACL SETUSER normaluser ~user:* +@all Redis 6.0 \u53ef\u4ee5\u8bbe\u7f6e\u4e0d\u540c\u7528\u6237\u6765\u8bbf\u95ee\u5b9e\u4f8b\uff0c\u800c\u4e14\u53ef\u4ee5\u57fa\u4e8e\u7528\u6237\u548c key \u7684\u7c92\u5ea6\uff0c\u8bbe\u7f6e\u67d0\u4e2a\u7528\u6237\u5bf9\u67d0\u4e9b key \u5141\u8bb8\u6216\u7981\u6b62\u6267\u884c\u7684\u547d\u4ee4\u64cd\u4f5c\u3002 4\u3001\u542f\u7528 RESP 3 \u534f\u8bae Redis 6.0 \u5b9e\u73b0\u4e86 RESP 3 \u901a\u4fe1\u534f\u8bae\uff0c\u800c\u4e4b\u524d\u90fd\u662f\u4f7f\u7528\u7684 RESP 2\u3002\u5728 RESP 2 \u4e2d\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u7684\u901a\u4fe1\u5185\u5bb9\u90fd\u662f\u4ee5\u5b57\u8282\u6570\u7ec4\u5f62\u5f0f\u8fdb\u884c\u7f16\u7801\u7684\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u6839\u636e\u64cd\u4f5c\u7684\u547d\u4ee4\u6216\u662f\u6570\u636e\u7c7b\u578b\u81ea\u884c\u5bf9\u4f20\u8f93\u7684\u6570\u636e\u8fdb\u884c\u89e3\u7801\uff0c\u589e\u52a0\u4e86\u5ba2\u6237\u7aef\u5f00\u53d1\u590d\u6742\u5ea6\u3002 \u800c RESP 3 \u76f4\u63a5\u652f\u6301\u591a\u79cd\u6570\u636e\u7c7b\u578b\u7684\u533a\u5206\u7f16\u7801\uff0c\u5305\u62ec\u7a7a\u503c\u3001\u6d6e\u70b9\u6570\u3001\u5e03\u5c14\u503c\u3001\u6709\u5e8f\u7684\u5b57\u5178\u96c6\u5408\u3001\u65e0\u5e8f\u7684\u96c6\u5408\u7b49\u3002 \u6240\u8c13\u533a\u5206\u7f16\u7801\uff0c\u5c31\u662f\u6307\u76f4\u63a5\u901a\u8fc7\u4e0d\u540c\u7684\u5f00\u5934\u5b57\u7b26\uff0c\u533a\u5206\u4e0d\u540c\u7684\u6570\u636e\u7c7b\u578b\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u5224\u65ad\u4f20\u9012\u6d88\u606f\u7684\u5f00\u5934\u5b57\u7b26\uff0c\u6765\u5b9e\u73b0\u6570\u636e\u8f6c\u6362\u64cd\u4f5c\u4e86\uff0c\u63d0\u5347\u4e86\u5ba2\u6237\u7aef\u7684\u6548\u7387\u3002\u9664\u6b64\u4e4b\u5916\uff0cRESP 3 \u534f\u8bae\u8fd8\u53ef\u4ee5\u652f\u6301\u5ba2\u6237\u7aef\u4ee5\u666e\u901a\u6a21\u5f0f\u548c\u5e7f\u64ad\u6a21\u5f0f\u5b9e\u73b0\u5ba2\u6237\u7aef\u7f13\u5b58\u3002 5\u3001\u672c\u8282\u5c0f\u7ed3 Redis 6.0 \u7684\u65b0\u7279\u6027 \u4e3a Redis 6.0 \u662f\u521a\u521a\u63a8\u51fa\u7684\uff0c\u65b0\u7684\u529f\u80fd\u7279\u6027\u8fd8\u9700\u8981\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\u8fdb\u884c\u90e8\u7f72\u548c\u9a8c\u8bc1\uff0c\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u60f3\u8bd5\u7528 Redis 6.0\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u5148\u5728\u975e\u6838\u5fc3\u4e1a\u52a1\u4e0a\u4f7f\u7528 Redis 6.0\uff0c\u4e00\u65b9\u9762\u53ef\u4ee5\u9a8c\u8bc1\u65b0\u7279\u6027\u5e26\u6765\u7684\u6027\u80fd\u6216\u529f\u80fd\u4f18\u52bf\uff0c\u53e6\u4e00\u65b9\u9762\uff0c\u4e5f\u53ef\u4ee5\u907f\u514d\u56e0\u4e3a\u65b0\u7279\u6027\u4e0d\u7a33\u5b9a\u800c\u5bfc\u81f4\u6838\u5fc3\u4e1a\u52a1\u53d7\u5230\u5f71\u54cd\u3002 Redis 6.0\u4e2d\u7684\u591a\u7ebf\u7a0b\u53ea\u662f\u6307\uff0c\u5728\u5ba2\u6237\u7aef\u8bf7\u6c42\u63a5\u6536\u548c\u89e3\u6790\uff0c\u4ee5\u53ca\u8bf7\u6c42\u540e\u7684\u6570\u636e\u901a\u8fc7\u7f51\u7edc\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u65f6\uff0c\u4f7f\u7528\u4e86\u591a\u7ebf\u7a0b\u3002\u800c\u547d\u4ee4\u8bf7\u6c42\u672c\u8eab\u7684\u6570\u636e\u8bfb\u5199\u64cd\u4f5c\u8fd8\u662f\u7531\u5355\u7ebf\u7a0b\u6765\u5b8c\u6210\u7684\uff0c\u6240\u4ee5\u4ecd\u7136\u53ef\u4ee5\u4fdd\u8bc1\u5355\u547d\u4ee4\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002","title":"\u7b2c\u4e00\u8282 Redis 6.0\u7684\u65b0\u7279\u6027\uff1a\u591a\u7ebf\u7a0b\u3001\u5ba2\u6237\u7aef\u7f13\u5b58\u4e0e\u5b89\u5168"},{"location":"chap8/1redis_6.0_fea/#redis-60","text":"Redis \u5b98\u65b9\u5728\u4eca\u5e74 5 \u6708\u4efd\u6b63\u5f0f\u63a8\u51fa\u4e86 6.0 \u7248\u672c\uff0c\u8fd9\u4e2a\u7248\u672c\u4e2d\u6709\u5f88\u591a\u7684\u65b0\u7279\u6027\u3002\u6240\u4ee5\uff0c6.0 \u521a\u521a\u63a8\u51fa\uff0c\u5c31\u53d7\u5230\u4e86\u4e1a\u754c\u7684\u5e7f\u6cdb\u5173\u6ce8\u3002 \u804a Redis 6.0 \u4e2d\u7684\u51e0\u4e2a\u5173\u952e\u65b0\u7279\u6027\uff0c \u5206\u522b\u662f\u9762\u5411\u7f51\u7edc\u5904\u7406\u7684\u591a IO \u7ebf\u7a0b\u3001\u5ba2\u6237\u7aef\u7f13\u5b58\u3001\u7ec6\u7c92\u5ea6\u7684\u6743\u9650\u63a7\u5236\uff0c\u4ee5\u53ca RESP 3 \u534f\u8bae\u7684\u4f7f\u7528\u3002 \u9762\u5411\u7f51\u7edc\u5904\u7406\u7684\u591a IO \u7ebf\u7a0b\u53ef\u4ee5\u63d0\u9ad8\u7f51\u7edc\u8bf7\u6c42\u5904\u7406\u7684\u901f\u5ea6 \u800c\u5ba2\u6237\u7aef\u7f13\u5b58\u53ef\u4ee5\u8ba9\u5e94\u7528\u76f4\u63a5\u5728\u5ba2\u6237\u7aef\u672c\u5730\u8bfb\u53d6\u6570\u636e\uff0c\u8fd9\u4e24\u4e2a\u7279\u6027\u53ef\u4ee5\u63d0\u5347 Redis \u7684\u6027\u80fd \u3002 \u7ec6\u7c92\u5ea6\u6743\u9650\u63a7\u5236\u8ba9 Redis \u53ef\u4ee5\u6309\u7167\u547d\u4ee4\u7c92\u5ea6\u63a7\u5236\u4e0d\u540c\u7528\u6237\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u52a0\u5f3a\u4e86 Redis \u7684\u5b89\u5168\u4fdd\u62a4\u3002 RESP 3 \u534f\u8bae\u5219\u589e\u5f3a\u5ba2\u6237\u7aef\u7684\u529f\u80fd\uff0c\u53ef\u4ee5\u8ba9\u5e94\u7528\u66f4\u52a0\u65b9\u4fbf\u5730\u4f7f\u7528 Redis \u7684\u4e0d\u540c\u6570\u636e\u7c7b\u578b\u3002","title":"\u7b2c\u4e00\u8282 Redis 6.0\u7684\u65b0\u7279\u6027\uff1a\u591a\u7ebf\u7a0b\u3001\u5ba2\u6237\u7aef\u7f13\u5b58\u4e0e\u5b89\u5168"},{"location":"chap8/1redis_6.0_fea/#1","text":"\u5728 Redis 6.0 \u4e2d\uff0c\u975e\u5e38\u53d7\u5173\u6ce8\u7684\u7b2c\u4e00\u4e2a\u65b0\u7279\u6027\u5c31\u662f\u591a\u7ebf\u7a0b\u3002 \uff0cRedis \u4e00\u76f4\u88ab\u5927\u5bb6\u719f\u77e5\u7684\u5c31\u662f\u5b83\u7684\u5355\u7ebf\u7a0b\u67b6\u6784\uff0c\u867d\u7136\u6709\u4e9b\u547d\u4ee4\u64cd\u4f5c\u53ef\u4ee5\u7528\u540e\u53f0\u7ebf\u7a0b\u6216\u5b50\u8fdb\u7a0b\u6267\u884c\uff08\u6bd4\u5982\u6570\u636e\u5220\u9664\u3001\u5feb\u7167\u751f\u6210\u3001AOF \u91cd\u5199\uff09\uff0c\u4f46\u662f\uff0c \u4ece\u7f51\u7edc IO \u5904\u7406\u5230\u5b9e\u9645\u7684\u8bfb\u5199\u547d\u4ee4\u5904\u7406\uff0c\u90fd\u662f\u7531\u5355\u4e2a\u7ebf\u7a0b\u5b8c\u6210\u7684 \u3002 \u968f\u7740\u7f51\u7edc\u786c\u4ef6\u7684\u6027\u80fd\u63d0\u5347\uff0cRedis \u7684\u6027\u80fd\u74f6\u9888\u6709\u65f6\u4f1a\u51fa\u73b0\u5728\u7f51\u7edc IO \u7684\u5904\u7406\u4e0a\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c \u5355\u4e2a\u4e3b\u7ebf\u7a0b\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\u7684\u901f\u5ea6\u8ddf\u4e0d\u4e0a\u5e95\u5c42\u7f51\u7edc\u786c\u4ef6\u7684\u901f\u5ea6\u3002 \u4e3a\u4e86\u5e94\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u4e00\u822c\u6709\u4e24\u79cd\u65b9\u6cd5\u3002 \u7b2c\u4e00\u79cd\u65b9\u6cd5\u662f\uff0c \u7528\u7528\u6237\u6001\u7f51\u7edc\u534f\u8bae\u6808\uff08\u4f8b\u5982 DPDK\uff09\u53d6\u4ee3\u5185\u6838\u7f51\u7edc\u534f\u8bae\u6808 \uff0c\u8ba9\u7f51\u7edc\u8bf7\u6c42\u7684\u5904\u7406\u4e0d\u7528\u5728\u5185\u6838\u91cc\u6267\u884c\uff0c\u76f4\u63a5\u5728\u7528\u6237\u6001\u5b8c\u6210\u5904\u7406\u5c31\u884c\u3002 DPDK\u5168\u79f0Intel Data Plane Development Kit\uff0c\u662fintel\u63d0\u4f9b\u7684\u6570\u636e\u5e73\u9762\u5f00\u53d1\u5de5\u5177\u96c6\uff0c\u4e3aIntel architecture\uff08IA\uff09\u5904\u7406\u5668\u67b6\u6784\u4e0b\u7528\u6237\u7a7a\u95f4\u9ad8\u6548\u7684\u6570\u636e\u5305\u5904\u7406\u63d0\u4f9b\u5e93\u51fd\u6570\u548c\u9a71\u52a8\u7684\u652f\u6301\u3002\u901a\u4fd7\u5730\u8bf4\uff0c\u5c31\u662f\u4e00\u4e2a\u7528\u6765\u8fdb\u884c\u5305\u6570\u636e\u5904\u7406\u52a0\u901f\u7684\u8f6f\u4ef6\u5e93\u3002 \u5bf9\u4e8e\u9ad8\u6027\u80fd\u7684 Redis \u6765\u8bf4\uff0c\u907f\u514d\u9891\u7e41\u8ba9\u5185\u6838\u8fdb\u884c\u7f51\u7edc\u8bf7\u6c42\u5904\u7406\uff0c\u53ef\u4ee5\u5f88\u597d\u5730\u63d0\u5347\u8bf7\u6c42\u5904\u7406\u6548\u7387\u3002 \u4f46\u662f\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u8981\u6c42\u5728 Redis \u7684\u6574\u4f53\u67b6\u6784\u4e2d\uff0c\u6dfb\u52a0\u5bf9\u7528\u6237\u6001\u7f51\u7edc\u534f\u8bae\u6808\u7684\u652f\u6301\uff0c\u9700\u8981\u4fee\u6539 Redis \u6e90\u7801\u4e2d\u548c\u7f51\u7edc\u76f8\u5173\u7684\u90e8\u5206\uff08\u4f8b\u5982\u4fee\u6539\u6240\u6709\u7684\u7f51\u7edc\u6536\u53d1\u8bf7\u6c42\u51fd\u6570\uff09\uff0c\u8fd9\u4f1a\u5e26\u6765\u5f88\u591a\u5f00\u53d1\u5de5\u4f5c\u91cf\u3002\u800c\u4e14\u65b0\u589e\u4ee3\u7801\u8fd8\u53ef\u80fd\u5f15\u5165\u65b0 Bug\uff0c\u5bfc\u81f4\u7cfb\u7edf\u4e0d\u7a33\u5b9a\u3002\u6240\u4ee5\uff0cRedis 6.0 \u4e2d\u5e76\u6ca1\u6709\u91c7\u7528\u8fd9\u4e2a\u65b9\u6cd5\u3002","title":"1\u3001\u4ece\u5355\u7ebf\u7a0b\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\u5230\u591a\u7ebf\u7a0b\u5904\u7406"},{"location":"chap8/1redis_6.0_fea/#1-1-redis-io","text":"\u7b2c\u4e8c\u79cd\u65b9\u6cd5\u5c31\u662f\u91c7\u7528\u591a\u4e2a IO \u7ebf\u7a0b\u6765\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\uff0c\u63d0\u9ad8\u7f51\u7edc\u8bf7\u6c42\u5904\u7406\u7684\u5e76\u884c\u5ea6\u3002Redis 6.0 \u5c31\u662f\u91c7\u7528\u7684\u8fd9\u79cd\u65b9\u6cd5\u3002 \u4f46\u662f\uff0c Redis \u7684\u591a IO \u7ebf\u7a0b\u53ea\u662f\u7528\u6765\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\u7684\uff0c\u5bf9\u4e8e\u8bfb\u5199\u547d\u4ee4\uff0cRedis \u4ecd\u7136\u4f7f\u7528\u5355\u7ebf\u7a0b\u6765\u5904\u7406 \u3002 \u8fd9\u662f\u56e0\u4e3a\uff0cRedis \u5904\u7406\u8bf7\u6c42\u65f6\uff0c\u7f51\u7edc\u5904\u7406\u7ecf\u5e38\u662f\u74f6\u9888\uff0c\u901a\u8fc7\u591a\u4e2a IO \u7ebf\u7a0b\u5e76\u884c\u5904\u7406\u7f51\u7edc\u64cd\u4f5c\uff0c\u53ef\u4ee5\u63d0\u5347\u5b9e\u4f8b\u7684\u6574\u4f53\u5904\u7406\u6027\u80fd \u3002 \u800c\u7ee7\u7eed\u4f7f\u7528\u5355\u7ebf\u7a0b\u6267\u884c\u547d\u4ee4\u64cd\u4f5c\uff0c\u5c31\u4e0d\u7528\u4e3a\u4e86\u4fdd\u8bc1 Lua \u811a\u672c\u3001\u4e8b\u52a1\u7684\u539f\u5b50\u6027\uff0c\u989d\u5916\u5f00\u53d1\u591a\u7ebf\u7a0b\u4e92\u65a5\u673a\u5236\u4e86\u3002\u8fd9\u6837\u4e00\u6765\uff0cRedis \u7ebf\u7a0b\u6a21\u578b\u5b9e\u73b0\u5c31\u7b80\u5355\u4e86","title":"1-1 Redis \u7684\u591a IO \u7ebf\u7a0b\u53ea\u662f\u7528\u6765\u5904\u7406\u7f51\u7edc\u8bf7\u6c42"},{"location":"chap8/1redis_6.0_fea/#1-2-socket","text":"\u9996\u5148\uff0c\u4e3b\u7ebf\u7a0b\u8d1f\u8d23\u63a5\u6536\u5efa\u7acb\u8fde\u63a5\u8bf7\u6c42\u3002 \u5f53\u6709\u5ba2\u6237\u7aef\u8bf7\u6c42\u548c\u5b9e\u4f8b\u5efa\u7acb Socket \u8fde\u63a5\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u521b\u5efa\u548c\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\uff0c\u5e76\u628a Socket \u653e\u5165\u5168\u5c40\u7b49\u5f85\u961f\u5217\u4e2d\u3002 \u7d27\u63a5\u7740\uff0c\u4e3b\u7ebf\u7a0b\u901a\u8fc7\u8f6e\u8be2\u65b9\u6cd5\u628a Socket \u8fde\u63a5\u5206\u914d\u7ed9 IO \u7ebf\u7a0b \u3002","title":"1-2 \u9636\u6bb5\u4e00\uff1a\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u5efa\u7acb Socket \u8fde\u63a5\uff0c\u5e76\u5206\u914d\u5904\u7406\u7ebf\u7a0b"},{"location":"chap8/1redis_6.0_fea/#1-3-io","text":"\u4e3b\u7ebf\u7a0b\u4e00\u65e6\u628a Socket \u5206\u914d\u7ed9 IO \u7ebf\u7a0b\uff0c\u5c31\u4f1a\u8fdb\u5165\u963b\u585e\u72b6\u6001\uff0c\u7b49\u5f85 IO \u7ebf\u7a0b\u5b8c\u6210\u5ba2\u6237\u7aef\u8bf7\u6c42\u8bfb\u53d6\u548c\u89e3\u6790\u3002\u56e0\u4e3a\u6709\u591a\u4e2a IO \u7ebf\u7a0b\u5728\u5e76\u884c\u5904\u7406\uff0c\u6240\u4ee5\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5f88\u5feb\u5c31\u53ef\u4ee5\u5b8c\u6210\u3002","title":"1-3 \u9636\u6bb5\u4e8c\uff1aIO \u7ebf\u7a0b\u8bfb\u53d6\u5e76\u89e3\u6790\u8bf7\u6c42"},{"location":"chap8/1redis_6.0_fea/#1-4","text":"\u7b49\u5230 IO \u7ebf\u7a0b\u89e3\u6790\u5b8c\u8bf7\u6c42\uff0c\u4e3b\u7ebf\u7a0b\u8fd8\u662f\u4f1a\u4ee5\u5355\u7ebf\u7a0b\u7684\u65b9\u5f0f\u6267\u884c\u8fd9\u4e9b\u547d\u4ee4\u64cd\u4f5c\u3002\u4e0b\u9762\u8fd9\u5f20\u56fe\u663e\u793a\u4e86\u521a\u624d\u4ecb\u7ecd\u7684\u8fd9\u4e09\u4e2a\u9636\u6bb5\u3002","title":"1-4 \u9636\u6bb5\u4e09\uff1a\u4e3b\u7ebf\u7a0b\u6267\u884c\u8bf7\u6c42\u64cd\u4f5c"},{"location":"chap8/1redis_6.0_fea/#1-5-io-socket","text":"\u5f53\u4e3b\u7ebf\u7a0b\u6267\u884c\u5b8c\u8bf7\u6c42\u64cd\u4f5c\u540e\uff0c \u4f1a\u628a\u9700\u8981\u8fd4\u56de\u7684\u7ed3\u679c\u5199\u5165\u7f13\u51b2\u533a\uff0c\u7136\u540e\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u963b\u585e\u7b49\u5f85 IO \u7ebf\u7a0b\u628a\u8fd9\u4e9b\u7ed3\u679c\u56de\u5199\u5230 Socket \u4e2d\uff0c\u5e76\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef \u3002 \u548c IO \u7ebf\u7a0b\u8bfb\u53d6\u548c\u89e3\u6790\u8bf7\u6c42\u4e00\u6837\uff0cIO \u7ebf\u7a0b\u56de\u5199 Socket \u65f6\uff0c\u4e5f\u662f\u6709\u591a\u4e2a\u7ebf\u7a0b\u5728\u5e76\u53d1\u6267\u884c\uff0c\u6240\u4ee5\u56de\u5199 Socket \u7684\u901f\u5ea6\u4e5f\u5f88\u5feb\u3002 \u7b49\u5230 IO \u7ebf\u7a0b\u56de\u5199 Socket \u5b8c\u6bd5\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u6e05\u7a7a\u5168\u5c40\u961f\u5217\uff0c\u7b49\u5f85\u5ba2\u6237\u7aef\u7684\u540e\u7eed\u8bf7\u6c42\u3002 \u4e86\u89e3\u4e86 Redis \u4e3b\u7ebf\u7a0b\u548c\u591a\u7ebf\u7a0b\u7684\u534f\u4f5c\u65b9\u5f0f\uff0c\u6211\u4eec\u8be5\u600e\u4e48\u542f\u7528\u591a\u7ebf\u7a0b\u5462\uff1f \u5728 Redis 6.0 \u4e2d\uff0c\u591a\u7ebf\u7a0b\u673a\u5236\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\uff0c\u5982\u679c\u9700\u8981\u4f7f\u7528\u591a\u7ebf\u7a0b\u529f\u80fd\uff0c\u9700\u8981\u5728 redis.conf \u4e2d\u5b8c\u6210\u4e24\u4e2a\u8bbe\u7f6e \u3002 1. \u8bbe\u7f6e io-thread-do-reads \u914d\u7f6e\u9879\u4e3a yes\uff0c\u8868\u793a\u542f\u7528\u591a\u7ebf\u7a0b\u3002 io-threads-do-reads yes 2. \u8bbe\u7f6e\u7ebf\u7a0b\u4e2a\u6570\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u7ebf\u7a0b\u4e2a\u6570\u8981\u5c0f\u4e8e Redis \u5b9e\u4f8b\u6240\u5728\u673a\u5668\u7684 CPU \u6838\u4e2a\u6570\uff0c\u4f8b\u5982\uff0c\u5bf9\u4e8e\u4e00\u4e2a 8 \u6838\u7684\u673a\u5668\u6765\u8bf4\uff0cRedis \u5b98\u65b9\u5efa\u8bae\u914d\u7f6e 6 \u4e2a IO \u7ebf\u7a0b\u3002 io-threads 6 \u5982\u679c\u4f60\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u53d1\u73b0 Redis \u5b9e\u4f8b\u7684 CPU \u5f00\u9500\u4e0d\u5927\uff0c\u541e\u5410\u91cf\u5374\u6ca1\u6709\u63d0\u5347\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 Redis 6.0 \u7684\u591a\u7ebf\u7a0b\u673a\u5236\uff0c\u52a0\u901f\u7f51\u7edc\u5904\u7406\uff0c\u8fdb\u800c\u63d0\u5347\u5b9e\u4f8b\u7684\u541e\u5410\u91cf\u3002","title":"1-5 \u9636\u6bb5\u56db\uff1aIO \u7ebf\u7a0b\u56de\u5199 Socket \u548c\u4e3b\u7ebf\u7a0b\u6e05\u7a7a\u5168\u5c40\u961f\u5217"},{"location":"chap8/1redis_6.0_fea/#2","text":"","title":"2\u3001\u5b9e\u73b0\u670d\u52a1\u7aef\u534f\u52a9\u7684\u5ba2\u6237\u7aef\u7f13\u5b58"},{"location":"chap8/1redis_6.0_fea/#2-1","text":"\u548c\u4e4b\u524d\u7684\u7248\u672c\u76f8\u6bd4\uff0cRedis 6.0 \u65b0\u589e\u4e86\u4e00\u4e2a\u91cd\u8981\u7684\u7279\u6027\uff0c\u5c31\u662f\u5b9e\u73b0\u4e86\u670d\u52a1\u7aef\u534f\u52a9\u7684\u5ba2\u6237\u7aef\u7f13\u5b58\u529f\u80fd\uff0c\u4e5f\u79f0\u4e3a\u8ddf\u8e2a\uff08Tracking\uff09\u529f\u80fd\u3002 \u6709\u4e86\u8fd9\u4e2a\u529f\u80fd\uff0c \u4e1a\u52a1\u5e94\u7528\u4e2d\u7684 Redis \u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u628a\u8bfb\u53d6\u7684\u6570\u636e\u7f13\u5b58\u5728\u4e1a\u52a1\u5e94\u7528\u672c\u5730 \u4e86\uff0c\u5e94\u7528\u5c31\u53ef\u4ee5\u76f4\u63a5\u5728\u672c\u5730\u5feb\u901f\u8bfb\u53d6\u6570\u636e\u4e86\u3002 \u4e0d\u8fc7\uff0c\u5f53\u628a\u6570\u636e\u7f13\u5b58\u5728\u5ba2\u6237\u7aef\u672c\u5730\u65f6\uff0c\u6211\u4eec\u4f1a\u9762\u4e34\u4e00\u4e2a\u95ee\u9898\uff1a \u5982\u679c\u6570\u636e\u88ab\u4fee\u6539\u4e86\u6216\u662f\u5931\u6548\u4e86\uff0c\u5982\u4f55\u901a\u77e5\u5ba2\u6237\u7aef\u5bf9\u7f13\u5b58\u7684\u6570\u636e\u505a\u5931\u6548\u5904\u7406\uff1f 6.0 \u5b9e\u73b0\u7684 Tracking \u529f\u80fd\u5b9e\u73b0\u4e86\u4e24\u79cd\u6a21\u5f0f\uff0c\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002","title":"2-1 \u5ba2\u6237\u7aef\u7f13\u5b58\u529f\u80fd"},{"location":"chap8/1redis_6.0_fea/#2-2","text":"\u7b2c\u4e00\u79cd\u6a21\u5f0f\u662f\u666e\u901a\u6a21\u5f0f\u3002 \u5728\u8fd9\u4e2a\u6a21\u5f0f\u4e0b\uff0c \u5b9e\u4f8b\u4f1a\u5728\u670d\u52a1\u7aef\u8bb0\u5f55\u5ba2\u6237\u7aef\u8bfb\u53d6\u8fc7\u7684 key\uff0c\u5e76\u76d1\u6d4b key \u662f\u5426\u6709\u4fee\u6539 \u3002\u4e00\u65e6 key \u7684\u503c\u53d1\u751f\u53d8\u5316\uff0c \u670d\u52a1\u7aef\u4f1a\u7ed9\u5ba2\u6237\u7aef\u53d1\u9001 invalidate \u6d88\u606f\uff0c\u901a\u77e5\u5ba2\u6237\u7aef\u7f13\u5b58\u5931\u6548\u4e86\u3002 \u5728\u4f7f\u7528\u666e\u901a\u6a21\u5f0f\u65f6\uff0c\u6709\u4e00\u70b9\u4f60\u9700\u8981\u6ce8\u610f\u4e00\u4e0b\uff0c\u670d\u52a1\u7aef\u5bf9\u4e8e\u8bb0\u5f55\u7684 key \u53ea\u4f1a\u62a5\u544a\u4e00\u6b21 invalidate \u6d88\u606f\uff0c \u4e5f\u5c31\u662f\u8bf4\uff0c\u670d\u52a1\u7aef\u5728\u7ed9\u5ba2\u6237\u7aef\u53d1\u9001\u8fc7\u4e00\u6b21 invalidate \u6d88\u606f\u540e\uff0c\u5982\u679c key \u518d\u88ab\u4fee\u6539\uff0c\u6b64\u65f6\uff0c\u670d\u52a1\u7aef\u5c31\u4e0d\u4f1a\u518d\u6b21\u7ed9\u5ba2\u6237\u7aef\u53d1\u9001 invalidate \u6d88\u606f \u3002 \u53ea\u6709\u5f53\u5ba2\u6237\u7aef\u518d\u6b21\u6267\u884c\u8bfb\u547d\u4ee4\u65f6\uff0c\u670d\u52a1\u7aef\u624d\u4f1a\u518d\u6b21\u76d1\u6d4b\u88ab\u8bfb\u53d6\u7684 key\uff0c\u5e76\u5728 key \u4fee\u6539\u65f6\u53d1\u9001 invalidate \u6d88 \u606f\u3002\u8fd9\u6837\u8bbe\u8ba1\u7684\u8003\u8651\u662f\u8282\u7701\u6709\u9650\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u6bd5\u7adf\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u4e0d\u518d\u8bbf\u95ee\u8fd9\u4e2a key \u4e86\uff0c\u800c\u670d\u52a1\u7aef\u4ecd\u7136\u8bb0\u5f55 key \u7684\u4fee\u6539\u60c5\u51b5\uff0c\u5c31\u4f1a\u6d6a\u8d39\u5185\u5b58\u8d44\u6e90\u3002 \u6253\u5f00\u6216\u5173\u95ed\u666e\u901a\u6a21\u5f0f\u4e0b\u7684 Tracking \u529f\u80fd CLIENT TRACKING ON|OFF","title":"2-2 \u666e\u901a\u6a21\u5f0f"},{"location":"chap8/1redis_6.0_fea/#2-3","text":"\u7b2c\u4e8c\u79cd\u6a21\u5f0f\u662f\u5e7f\u64ad\u6a21\u5f0f\u3002\u5728\u8fd9\u4e2a\u6a21\u5f0f\u4e0b\uff0c \u670d\u52a1\u7aef\u4f1a\u7ed9\u5ba2\u6237\u7aef\u5e7f\u64ad\u6240\u6709 key \u7684\u5931\u6548\u60c5\u51b5\uff0c\u4e0d\u8fc7\uff0c\u8fd9\u6837\u505a\u4e86\u4e4b\u540e\uff0c\u5982\u679c key \u88ab\u9891\u7e41\u4fee\u6539\uff0c\u670d\u52a1\u7aef\u4f1a\u53d1\u9001\u5927\u91cf\u7684\u5931\u6548\u5e7f\u64ad\u6d88\u606f\uff0c\u8fd9\u5c31\u4f1a\u6d88\u8017\u5927\u91cf\u7684\u7f51\u7edc\u5e26\u5bbd\u8d44\u6e90\u3002 \u6240\u4ee5\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u65f6\uff0c \u4f1a\u8ba9\u5ba2\u6237\u7aef\u6ce8\u518c\u5e0c\u671b\u8ddf\u8e2a\u7684 key \u7684\u524d\u7f00 \uff0c\u5f53\u5e26\u6709\u6ce8\u518c\u524d\u7f00\u7684 key \u88ab\u4fee\u6539\u65f6\uff0c\u670d\u52a1\u7aef\u4f1a\u628a\u5931\u6548\u6d88\u606f\u5e7f\u64ad\u7ed9\u6240\u6709\u6ce8\u518c\u7684\u5ba2\u6237\u7aef\u3002 \u548c\u666e\u901a\u6a21\u5f0f\u4e0d\u540c\uff0c\u5728\u5e7f\u64ad\u6a21\u5f0f\u4e0b\uff0c\u5373\u4f7f\u5ba2\u6237\u7aef\u8fd8\u6ca1\u6709\u8bfb\u53d6\u8fc7 key\uff0c\u4f46\u53ea\u8981\u5b83\u6ce8\u518c\u4e86\u8981\u8ddf\u8e2a\u7684 key\uff0c\u670d\u52a1\u7aef\u90fd\u4f1a\u628a key \u5931\u6548\u6d88\u606f\u901a\u77e5\u7ed9\u8fd9\u4e2a\u5ba2\u6237\u7aef\u3002 \u5ba2\u6237\u7aef\u5982\u4f55\u4f7f\u7528\u5e7f\u64ad\u6a21\u5f0f\u63a5\u6536 key \u5931\u6548\u6d88\u606f\u3002 \u5f53\u6211\u4eec\u5728\u5ba2\u6237\u7aef\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u540e\uff0c\u5982\u679c\u670d\u52a1\u7aef\u66f4\u65b0\u4e86 user:id:1003 \u8fd9\u4e2a key\uff0c\u90a3\u4e48\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u6536\u5230 invalidate \u6d88\u606f\u3002 CLIENT TRACKING ON BCAST PREFIX user \u8fd9\u79cd\u76d1\u6d4b\u5e26\u6709\u524d\u7f00\u7684 key \u7684\u5e7f\u64ad\u6a21\u5f0f\uff0c\u548c\u6211\u4eec\u5bf9 key \u7684\u547d\u540d\u89c4\u8303\u975e\u5e38\u5339\u914d\u3002 \u6211\u4eec\u5728\u5b9e\u9645\u5e94\u7528\u65f6\uff0c\u4f1a\u7ed9\u540c\u4e00\u4e1a\u52a1\u4e0b\u7684 key \u8bbe\u7f6e\u76f8\u540c\u7684\u4e1a\u52a1\u540d\u524d\u7f00\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u4f7f\u7528\u5e7f\u64ad\u6a21\u5f0f\u3002","title":"2-3 \u5e7f\u64ad\u6a21\u5f0f"},{"location":"chap8/1redis_6.0_fea/#2-4-resp-3-resp-2","text":"\u4e0d\u8fc7\uff0c\u521a\u624d\u4ecb\u7ecd\u7684\u666e\u901a\u6a21\u5f0f\u548c\u5e7f\u64ad\u6a21\u5f0f\uff0c\u9700\u8981\u5ba2\u6237\u7aef\u4f7f\u7528 RESP 3 \u534f\u8bae\uff0cRESP 3 \u534f\u8bae\u662f 6.0 \u65b0\u542f\u7528\u7684\u901a\u4fe1\u534f\u8bae \u5bf9\u4e8e\u4f7f\u7528 RESP 2 \u534f\u8bae\u7684\u5ba2\u6237\u7aef\u6765\u8bf4\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u53e6\u4e00\u79cd\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f\u91cd\u5b9a\u5411\u6a21\u5f0f\uff08redirect\uff09 \u3002 \u5728\u91cd\u5b9a\u5411\u6a21\u5f0f\u4e0b\uff0c\u60f3\u8981\u83b7\u5f97\u5931\u6548\u6d88\u606f\u901a\u77e5\u7684\u5ba2\u6237\u7aef\uff0c\u5c31\u9700\u8981\u6267\u884c\u8ba2\u9605\u547d\u4ee4 SUBSCRIBE \uff0c\u4e13\u95e8\u8ba2\u9605\u7528\u4e8e\u53d1\u9001\u5931\u6548\u6d88\u606f\u7684\u9891\u9053 _redis_:invalidate \u3002 \u540c\u65f6\uff0c\u518d\u4f7f\u7528\u53e6\u5916\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u6267\u884c CLIENT TRACKING \u547d\u4ee4\uff0c\u8bbe\u7f6e\u670d\u52a1\u7aef\u5c06\u5931\u6548\u6d88\u606f\u8f6c\u53d1\u7ed9\u4f7f\u7528 RESP 2 \u534f\u8bae\u7684\u5ba2\u6237\u7aef\u3002 \u5e26\u4f60\u4e86\u89e3\u4e0b\u5982\u4f55\u8ba9\u4f7f\u7528 RESP 2 \u534f\u8bae\u7684\u5ba2\u6237\u7aef\u4e5f\u80fd\u63a5\u53d7\u5931\u6548\u6d88\u606f\u3002\u5047\u8bbe\u5ba2\u6237\u7aef B \u60f3\u8981\u83b7\u53d6\u5931\u6548\u6d88\u606f\uff0c\u4f46\u662f\u5ba2\u6237\u7aef B \u53ea\u652f\u6301 RESP 2 \u534f\u8bae\uff0c\u5ba2\u6237\u7aef A \u652f\u6301 RESP 3 \u534f\u8bae\u3002 \u6211\u4eec\u53ef\u4ee5\u5206\u522b\u5728\u5ba2\u6237\u7aef B \u548c A \u4e0a\u6267\u884c SUBSCRIBE \u548c CLIENT TRACKING \uff0c\u5982\u4e0b\u6240\u793a\uff1a //\u5ba2\u6237\u7aefB\u6267\u884c\uff0c\u5ba2\u6237\u7aefB\u7684ID\u53f7\u662f303 SUBSCRIBE _redis_:invalidate //\u5ba2\u6237\u7aefA\u6267\u884c CLIENT TRACKING ON BCAST REDIRECT 303 \u8fd9\u6837\u8bbe\u7f6e\u4ee5\u540e\uff0c\u5982\u679c\u6709\u952e\u503c\u5bf9\u88ab\u4fee\u6539\u4e86\uff0c\u5ba2\u6237\u7aef B \u5c31\u53ef\u4ee5\u901a\u8fc7 _redis_:invalidate \u9891\u9053\uff0c\u83b7\u5f97\u5931\u6548\u6d88\u606f\u4e86\u3002","title":"2-4 RESP 3 &amp;  RESP 2 \u534f\u8bae"},{"location":"chap8/1redis_6.0_fea/#3","text":"\u5728 Redis 6.0 \u7248\u672c\u4e4b\u524d\uff0c\u8981\u60f3\u5b9e\u73b0\u5b9e\u4f8b\u7684\u5b89\u5168\u8bbf\u95ee\uff0c\u53ea\u80fd\u901a\u8fc7\u8bbe\u7f6e\u5bc6\u7801\u6765\u63a7\u5236\uff0c\u4f8b\u5982\uff0c\u5ba2\u6237\u7aef\u8fde\u63a5\u5b9e\u4f8b\u524d\u9700\u8981\u8f93\u5165\u5bc6\u7801\u3002 \u6b64\u5916\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u9ad8\u98ce\u9669\u7684\u547d\u4ee4\uff08\u4f8b\u5982 KEYS\u3001FLUSHDB\u3001FLUSHALL \u7b49\uff09\uff0c\u5728 Redis 6.0 \u4e4b\u524d\uff0c\u6211\u4eec\u4e5f\u53ea\u80fd\u901a\u8fc7 rename-command \u6765\u91cd\u65b0\u547d\u540d\u8fd9\u4e9b\u547d\u4ee4\uff0c\u907f\u514d\u5ba2\u6237\u7aef\u76f4\u63a5\u8c03\u7528\u3002 Redis 6.0 \u63d0\u4f9b\u4e86\u66f4\u52a0\u7ec6\u7c92\u5ea6\u7684\u8bbf\u95ee\u6743\u9650\u63a7\u5236\uff0c\u8fd9\u4e3b\u8981\u6709\u4e24\u65b9\u9762\u7684\u4f53\u73b0\u3002","title":"3\u3001\u4ece\u7b80\u5355\u7684\u57fa\u4e8e\u5bc6\u7801\u8bbf\u95ee\u5230\u7ec6\u7c92\u5ea6\u7684\u6743\u9650\u63a7\u5236"},{"location":"chap8/1redis_6.0_fea/#3-1-60-redis","text":"\u5728 6.0 \u7248\u672c\u524d\uff0c\u6240\u6709\u5ba2\u6237\u7aef\u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u4e2a\u5bc6\u7801\u8fdb\u884c\u767b\u5f55\u4f7f\u7528\uff0c\u4f46\u662f\u6ca1\u6709\u7528\u6237\u7684\u6982\u5ff5\uff0c\u800c\u5728 6.0 \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ACL SETUSER \u547d\u4ee4\u521b\u5efa\u7528\u6237\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u521b\u5efa\u5e76\u542f\u7528\u4e00\u4e2a\u7528\u6237 normaluser\uff0c\u628a\u5b83\u7684\u5bc6\u7801\u8bbe\u7f6e\u4e3a\u201cabc\u201d\uff1a ACL SETUSER normaluser on > abc \u53e6\u5916\uff0c6.0 \u7248\u672c\u8fd8\u652f\u6301\u4ee5\u7528\u6237\u4e3a\u7c92\u5ea6\u8bbe\u7f6e\u547d\u4ee4\u64cd\u4f5c\u7684\u8bbf\u95ee\u6743\u9650\u3002\u5177\u4f53\u64cd\u4f5c\u5217\u5728\u4e86\u4e0b\u8868\u4e2d\uff0c\u4f60\u53ef\u4ee5\u770b\u4e0b\uff0c\u5176\u4e2d\uff0c\u52a0\u53f7\uff08+\uff09\u548c\u51cf\u53f7\uff08-\uff09\u5c31\u5206\u522b\u8868\u793a\u7ed9\u7528\u6237\u8d4b\u4e88\u6216\u64a4\u9500\u547d\u4ee4\u7684\u8c03\u7528\u6743\u9650\u3002 \u5047\u8bbe\u6211\u4eec\u8981\u8bbe\u7f6e\u7528\u6237 normaluser \u53ea\u80fd\u8c03\u7528 Hash \u7c7b\u578b\u7684\u547d\u4ee4\u64cd\u4f5c\uff0c\u800c\u4e0d\u80fd\u8c03\u7528 String \u7c7b\u578b\u7684\u547d\u4ee4\u64cd\u4f5c\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a ACL SETUSER normaluser +@hash -@string \u9664\u4e86\u8bbe\u7f6e\u67d0\u4e2a\u547d\u4ee4\u6216\u67d0\u7c7b\u547d\u4ee4\u7684\u8bbf\u95ee\u63a7\u5236\u6743\u9650\uff0c6.0 \u7248\u672c\u8fd8\u652f\u6301\u4ee5 key \u4e3a\u7c92\u5ea6\u8bbe\u7f6e\u8bbf\u95ee\u6743\u9650\u3002 \u5177\u4f53\u7684\u505a\u6cd5\u662f\u4f7f\u7528\u6ce2\u6d6a\u53f7 \u201c~\u201d \u548c key \u7684\u524d\u7f00\u6765\u8868\u793a\u63a7\u5236\u8bbf\u95ee\u7684 key\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u8bbe\u7f6e\u7528\u6237 normaluser \u53ea\u80fd\u5bf9\u4ee5 \u201cuser:\u201d \u4e3a\u524d\u7f00\u7684 key \u8fdb\u884c\u547d\u4ee4\u64cd\u4f5c\uff1a ACL SETUSER normaluser ~user:* +@all Redis 6.0 \u53ef\u4ee5\u8bbe\u7f6e\u4e0d\u540c\u7528\u6237\u6765\u8bbf\u95ee\u5b9e\u4f8b\uff0c\u800c\u4e14\u53ef\u4ee5\u57fa\u4e8e\u7528\u6237\u548c key \u7684\u7c92\u5ea6\uff0c\u8bbe\u7f6e\u67d0\u4e2a\u7528\u6237\u5bf9\u67d0\u4e9b key \u5141\u8bb8\u6216\u7981\u6b62\u6267\u884c\u7684\u547d\u4ee4\u64cd\u4f5c\u3002","title":"3-1 6.0 \u7248\u672c\u652f\u6301\u521b\u5efa\u4e0d\u540c\u7528\u6237\u6765\u4f7f\u7528 Redis\u3002"},{"location":"chap8/1redis_6.0_fea/#4-resp-3","text":"Redis 6.0 \u5b9e\u73b0\u4e86 RESP 3 \u901a\u4fe1\u534f\u8bae\uff0c\u800c\u4e4b\u524d\u90fd\u662f\u4f7f\u7528\u7684 RESP 2\u3002\u5728 RESP 2 \u4e2d\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u7684\u901a\u4fe1\u5185\u5bb9\u90fd\u662f\u4ee5\u5b57\u8282\u6570\u7ec4\u5f62\u5f0f\u8fdb\u884c\u7f16\u7801\u7684\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u6839\u636e\u64cd\u4f5c\u7684\u547d\u4ee4\u6216\u662f\u6570\u636e\u7c7b\u578b\u81ea\u884c\u5bf9\u4f20\u8f93\u7684\u6570\u636e\u8fdb\u884c\u89e3\u7801\uff0c\u589e\u52a0\u4e86\u5ba2\u6237\u7aef\u5f00\u53d1\u590d\u6742\u5ea6\u3002 \u800c RESP 3 \u76f4\u63a5\u652f\u6301\u591a\u79cd\u6570\u636e\u7c7b\u578b\u7684\u533a\u5206\u7f16\u7801\uff0c\u5305\u62ec\u7a7a\u503c\u3001\u6d6e\u70b9\u6570\u3001\u5e03\u5c14\u503c\u3001\u6709\u5e8f\u7684\u5b57\u5178\u96c6\u5408\u3001\u65e0\u5e8f\u7684\u96c6\u5408\u7b49\u3002 \u6240\u8c13\u533a\u5206\u7f16\u7801\uff0c\u5c31\u662f\u6307\u76f4\u63a5\u901a\u8fc7\u4e0d\u540c\u7684\u5f00\u5934\u5b57\u7b26\uff0c\u533a\u5206\u4e0d\u540c\u7684\u6570\u636e\u7c7b\u578b\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u5224\u65ad\u4f20\u9012\u6d88\u606f\u7684\u5f00\u5934\u5b57\u7b26\uff0c\u6765\u5b9e\u73b0\u6570\u636e\u8f6c\u6362\u64cd\u4f5c\u4e86\uff0c\u63d0\u5347\u4e86\u5ba2\u6237\u7aef\u7684\u6548\u7387\u3002\u9664\u6b64\u4e4b\u5916\uff0cRESP 3 \u534f\u8bae\u8fd8\u53ef\u4ee5\u652f\u6301\u5ba2\u6237\u7aef\u4ee5\u666e\u901a\u6a21\u5f0f\u548c\u5e7f\u64ad\u6a21\u5f0f\u5b9e\u73b0\u5ba2\u6237\u7aef\u7f13\u5b58\u3002","title":"4\u3001\u542f\u7528 RESP 3 \u534f\u8bae"},{"location":"chap8/1redis_6.0_fea/#5","text":"Redis 6.0 \u7684\u65b0\u7279\u6027 \u4e3a Redis 6.0 \u662f\u521a\u521a\u63a8\u51fa\u7684\uff0c\u65b0\u7684\u529f\u80fd\u7279\u6027\u8fd8\u9700\u8981\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\u8fdb\u884c\u90e8\u7f72\u548c\u9a8c\u8bc1\uff0c\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u60f3\u8bd5\u7528 Redis 6.0\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u5148\u5728\u975e\u6838\u5fc3\u4e1a\u52a1\u4e0a\u4f7f\u7528 Redis 6.0\uff0c\u4e00\u65b9\u9762\u53ef\u4ee5\u9a8c\u8bc1\u65b0\u7279\u6027\u5e26\u6765\u7684\u6027\u80fd\u6216\u529f\u80fd\u4f18\u52bf\uff0c\u53e6\u4e00\u65b9\u9762\uff0c\u4e5f\u53ef\u4ee5\u907f\u514d\u56e0\u4e3a\u65b0\u7279\u6027\u4e0d\u7a33\u5b9a\u800c\u5bfc\u81f4\u6838\u5fc3\u4e1a\u52a1\u53d7\u5230\u5f71\u54cd\u3002 Redis 6.0\u4e2d\u7684\u591a\u7ebf\u7a0b\u53ea\u662f\u6307\uff0c\u5728\u5ba2\u6237\u7aef\u8bf7\u6c42\u63a5\u6536\u548c\u89e3\u6790\uff0c\u4ee5\u53ca\u8bf7\u6c42\u540e\u7684\u6570\u636e\u901a\u8fc7\u7f51\u7edc\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u65f6\uff0c\u4f7f\u7528\u4e86\u591a\u7ebf\u7a0b\u3002\u800c\u547d\u4ee4\u8bf7\u6c42\u672c\u8eab\u7684\u6570\u636e\u8bfb\u5199\u64cd\u4f5c\u8fd8\u662f\u7531\u5355\u7ebf\u7a0b\u6765\u5b8c\u6210\u7684\uff0c\u6240\u4ee5\u4ecd\u7136\u53ef\u4ee5\u4fdd\u8bc1\u5355\u547d\u4ee4\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002","title":"5\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap8/2redis_nvm_mem/","text":"\u7b2c\u4e8c\u8282 Redis \u57fa\u4e8eNVM\u5185\u5b58\u7684\u5b9e\u8df5 \u8fd9\u51e0\u5e74\u5462\uff0c\u65b0\u578b\u975e\u6613\u5931\u5b58\u50a8\uff08Non-Volatile Memory\uff0cNVM\uff09\u5668\u4ef6\u53d1\u5c55\u5f97\u975e\u5e38\u5feb\u3002 NVM \u5668\u4ef6\u5177\u6709\u5bb9\u91cf\u5927\u3001\u6027\u80fd\u5feb\u3001\u80fd\u6301\u4e45\u5316\u4fdd\u5b58\u6570\u636e\u7684\u7279\u6027\uff0c\u8fd9\u4e9b\u521a\u597d\u5c31\u662f Redis \u8ffd\u6c42\u7684\u76ee\u6807\u3002\u540c\u65f6\uff0cNVM \u5668\u4ef6\u50cf DRAM \u4e00\u6837\uff0c\u53ef\u4ee5\u8ba9\u8f6f\u4ef6\u4ee5\u5b57\u8282\u7c92\u5ea6\u8fdb\u884c\u5bfb\u5740\u8bbf\u95ee\uff0c\u6240\u4ee5\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0cNVM \u53ef\u4ee5\u4f5c\u4e3a\u5185\u5b58\u6765\u4f7f\u7528\uff0c\u6211\u4eec\u79f0\u4e3a NVM \u5185\u5b58\u3002 Redis \u4f5c\u4e3a\u5185\u5b58\u952e\u503c\u6570\u636e\u5e93\uff0c\u5982\u679c\u80fd\u548c NVM \u5185\u5b58\u7ed3\u5408\u8d77\u6765\u4f7f\u7528\uff0c\u5c31\u53ef\u4ee5\u5145\u5206\u4eab\u53d7\u5230\u8fd9\u4e9b\u7279\u6027 1\u3001NVM \u5185\u5b58\u7684\u7279\u6027\u4e0e\u4f7f\u7528\u6a21\u5f0f 1-1 NVM \u6709\u4e09\u4e2a\u7279\u70b9 Redis \u662f\u57fa\u4e8e DRAM \u5185\u5b58\u7684\u952e\u503c\u6570\u636e\u5e93\uff0c\u800c\u8ddf\u4f20\u7edf\u7684 DRAM \u5185\u5b58\u76f8\u6bd4\uff0cNVM \u6709\u4e09\u4e2a\u663e\u8457\u7684\u7279\u70b9\u3002 \u9996\u5148\uff0c NVM \u5185\u5b58\u6700\u5927\u7684\u4f18\u52bf\u662f\u53ef\u4ee5\u76f4\u63a5\u6301\u4e45\u5316\u4fdd\u5b58\u6570\u636e \u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6570\u636e\u4fdd\u5b58\u5728 NVM \u5185\u5b58\u4e0a\u540e\uff0c\u5373\u4f7f\u53d1\u751f\u4e86\u5b95\u673a\u6216\u662f\u6389\u7535\uff0c\u6570\u636e\u4ecd\u7136\u5b58\u5728 NVM \u5185\u5b58\u4e0a\u3002\u4f46\u5982\u679c\u6570\u636e\u662f\u4fdd\u5b58\u5728 DRAM \u4e0a\uff0c\u90a3\u4e48\uff0c\u6389\u7535\u540e\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u3002 \u5176\u6b21\uff0c NVM \u5185\u5b58\u7684\u8bbf\u95ee\u901f\u5ea6\u63a5\u8fd1 DRAM \u7684\u901f\u5ea6 \u3002\u5b9e\u9645\u6d4b\u8bd5\u8fc7 NVM \u5185\u5b58\u7684\u8bbf\u95ee\u901f\u5ea6\uff0c\u7ed3\u679c\u663e\u793a\uff0c\u5b83\u7684\u8bfb\u5ef6\u8fdf\u5927\u7ea6\u662f 200~300ns\uff0c\u800c\u5199\u5ef6\u8fdf\u5927\u7ea6\u662f 100ns\u3002\u5728\u8bfb\u5199\u5e26\u5bbd\u65b9\u9762\uff0c\u5355\u6839 NVM \u5185\u5b58\u6761\u7684\u5199\u5e26\u5bbd\u5927\u7ea6\u662f 1~2GB/s\uff0c\u800c\u8bfb\u5e26\u5bbd\u7ea6\u662f 5~6GB/s\u3002\u5f53\u8f6f\u4ef6\u7cfb\u7edf\u628a\u6570\u636e\u4fdd\u5b58\u5728 NVM \u5185\u5b58\u4e0a\u65f6\uff0c\u7cfb\u7edf\u4ecd\u7136\u53ef\u4ee5\u5feb\u901f\u5730\u5b58\u53d6\u6570\u636e \u6700\u540e\uff0c NVM \u5185\u5b58\u7684\u5bb9\u91cf\u5f88\u5927\u3002 \u8fd9\u662f\u56e0\u4e3a\uff0cNVM \u5668\u4ef6\u7684\u5bc6\u5ea6\u5927\uff0c\u5355\u4e2a NVM \u7684\u5b58\u50a8\u5355\u5143\u53ef\u4ee5\u4fdd\u5b58\u66f4\u591a\u6570\u636e\u3002\u4f8b\u5982\uff0c\u5355\u6839 NVM \u5185\u5b58\u6761\u5c31\u80fd\u8fbe\u5230 128GB \u7684\u5bb9\u91cf\uff0c\u6700\u5927\u53ef\u4ee5\u8fbe\u5230 512GB\uff0c\u800c\u5355\u6839 DRAM \u5185\u5b58\u6761\u901a\u5e38\u662f 16GB \u6216 32GB\u3002\u6240\u4ee5\uff0c\u53ef\u4ee5\u5f88\u8f7b\u677e\u5730\u7528 NVM \u5185\u5b58\u6784\u5efa TB \u7ea7\u522b\u7684\u5185\u5b58\u3002 \u603b\u7ed3\u6765\u8bf4\uff0cNVM \u5185\u5b58\u7684\u7279\u70b9\u53ef\u4ee5\u7528\u4e09\u53e5\u8bdd\u6982\u62ec\uff1a \u80fd\u6301\u4e45\u5316\u4fdd\u5b58\u6570\u636e\uff1b \u8bfb\u5199\u901f\u5ea6\u548c DRAM \u63a5\u8fd1\uff1b \u5bb9\u91cf\u5927\u3002 \u73b0\u5728\uff0c\u4e1a\u754c\u5df2\u7ecf\u6709\u4e86\u5b9e\u9645\u7684 NVM \u5185\u5b58\u4ea7\u54c1\uff0c\u5c31\u662f Intel \u5728 2019 \u5e74 4 \u6708\u4efd\u65f6\u63a8\u51fa\u7684 Optane AEP \u5185\u5b58\u6761\uff08\u7b80\u79f0 AEP \u5185\u5b58\uff09\u3002\u6211\u4eec\u5728\u5e94\u7528 AEP \u5185\u5b58\u65f6\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cAEP \u5185\u5b58\u7ed9\u8f6f\u4ef6\u63d0\u4f9b\u4e86\u4e24\u79cd\u4f7f\u7528\u6a21\u5f0f\uff0c\u5206\u522b\u5bf9\u5e94\u7740\u4f7f\u7528\u4e86 NVM \u7684\u5bb9\u91cf\u5927\u548c\u6301\u4e45\u5316\u4fdd\u5b58\u6570\u636e\u4e24\u4e2a\u7279\u6027\uff0c\u6211\u4eec\u6765\u5b66\u4e60\u4e0b\u8fd9\u4e24\u79cd\u6a21\u5f0f\u3002 1-2 NVM \u4e24\u79cd\u6a21\u5f0f \u7b2c\u4e00\u79cd\u662f Memory \u6a21\u5f0f\u3002 \u8fd9\u79cd\u6a21\u5f0f\u662f\u628a NVM \u5185\u5b58\u4f5c\u4e3a\u5927\u5bb9\u91cf\u5185\u5b58\u6765\u4f7f\u7528\u7684 \uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u4f7f\u7528 NVM \u5bb9\u91cf\u5927\u548c\u6027\u80fd\u9ad8\u7684\u7279\u6027\uff0c \u6ca1\u6709\u542f\u7528\u6570\u636e\u6301\u4e45\u5316\u7684\u529f\u80fd \u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u5b89\u88c5 6 \u6839 NVM \u5185\u5b58\u6761\uff0c\u6bcf\u6839 512GB\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u5355\u53f0\u670d\u52a1\u5668\u4e0a\u83b7\u5f97 3TB \u7684\u5185\u5b58\u5bb9\u91cf\u4e86\u3002 \u5728 Memory \u6a21\u5f0f\u4e0b\uff0c\u670d\u52a1\u5668\u4e0a\u4ecd\u7136\u9700\u8981\u914d\u7f6e DRAM \u5185\u5b58\uff0c\u4f46\u662f\uff0cDRAM \u5185\u5b58\u662f\u88ab CPU \u7528\u4f5c AEP \u5185\u5b58\u7684\u7f13\u5b58\uff0cDRAM \u7684\u7a7a\u95f4\u5bf9\u5e94\u7528\u8f6f\u4ef6\u4e0d\u53ef\u89c1\u3002 \u6362\u53e5\u8bdd\u8bf4\uff0c\u8f6f\u4ef6\u7cfb\u7edf\u80fd\u4f7f\u7528\u5230\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5c31\u662f AEP \u5185\u5b58\u6761\u7684\u7a7a\u95f4\u5bb9\u91cf\u3002 \u7b2c\u4e8c\u79cd\u662f App Direct \u6a21\u5f0f\u3002 \u8fd9\u79cd\u6a21\u5f0f\u542f\u7528\u4e86 NVM \u6301\u4e45\u5316\u6570\u636e\u7684\u529f\u80fd\u3002\u5728\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c\u5e94\u7528\u8f6f\u4ef6\u628a\u6570\u636e\u5199\u5230 AEP \u5185\u5b58\u4e0a\u65f6\uff0c\u6570\u636e\u5c31\u76f4\u63a5\u6301\u4e45\u5316\u4fdd\u5b58\u4e0b\u6765\u4e86\u3002\u6240\u4ee5\uff0c \u4f7f\u7528\u4e86 App Direct \u6a21\u5f0f\u7684 AEP \u5185\u5b58\uff0c\u4e5f\u53eb\u505a\u6301\u4e45\u5316\u5185\u5b58\uff08Persistent Memory\uff0cPM\uff09\u3002 2\u3001\u57fa\u4e8e NVM \u5185\u5b58\u7684 Redis \u5b9e\u8df5 2-1 AEP \u5185\u5b58\u4f7f\u7528 Memory \u6a21\u5f0f\u65f6 \u5f53 AEP \u5185\u5b58\u4f7f\u7528 Memory \u6a21\u5f0f\u65f6\uff0c\u5e94\u7528\u8f6f\u4ef6\u5c31\u53ef\u4ee5\u5229\u7528\u5b83\u7684\u5927\u5bb9\u91cf\u7279\u6027\u6765\u4fdd\u5b58\u5927\u91cf\u6570\u636e\uff0cRedis \u4e5f\u5c31\u53ef\u4ee5\u7ed9\u4e0a\u5c42\u4e1a\u52a1\u5e94\u7528\u63d0\u4f9b\u5927\u5bb9\u91cf\u7684\u5b9e\u4f8b\u4e86\u3002\u800c\u4e14\uff0c\u5728 Memory \u6a21\u5f0f\u4e0b\uff0cRedis \u53ef\u4ee5\u50cf\u5728 DRAM \u5185\u5b58\u4e0a\u8fd0\u884c\u4e00\u6837\uff0c\u76f4\u63a5\u5728 AEP \u5185\u5b58\u4e0a\u8fd0\u884c\uff0c\u4e0d\u7528\u4fee\u6539\u4ee3\u7801\u3002 \u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\u4e0b\uff1a\u5728 Memory \u6a21\u5f0f\u4e0b\uff0cAEP \u5185\u5b58\u7684\u8bbf\u95ee\u5ef6\u8fdf\u4f1a\u6bd4 DRAM \u9ad8\u4e00\u70b9\u3002\u6211\u521a\u521a\u63d0\u5230\u8fc7\uff0cNVM \u7684\u8bfb\u5ef6\u8fdf\u5927\u7ea6\u662f 200~300ns\uff0c\u800c\u5199\u5ef6\u8fdf\u5927\u7ea6\u662f 100ns\u3002 \u6240\u4ee5\uff0c\u5728 Memory \u6a21\u5f0f\u4e0b\u8fd0\u884c Redis \u5b9e\u4f8b\uff0c\u5b9e\u4f8b\u8bfb\u6027\u80fd\u4f1a\u6709\u6240\u964d\u4f4e\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5728\u4fdd\u5b58\u5927\u91cf\u6570\u636e\u548c\u8bfb\u6027\u80fd\u8f83\u6162\u4e24\u8005\u4e4b\u95f4\u505a\u4e2a\u53d6\u820d \u3002 2-1 AEP \u5185\u5b58\u4f7f\u7528 App Direct \u6a21\u5f0f \u5f53\u6211\u4eec\u4f7f\u7528 App Direct \u6a21\u5f0f\uff0c\u628a AEP \u5185\u5b58\u7528\u4f5c PM \u65f6\uff0cRedis \u53c8\u8be5\u5982\u4f55\u5229\u7528 PM \u5feb\u901f\u6301\u4e45\u5316\u6570\u636e\u7684\u7279\u6027\u5462\uff1f\u8fd9\u5c31\u548c Redis \u7684\u6570\u636e\u53ef\u9760\u6027\u4fdd\u8bc1\u9700\u6c42\u548c\u73b0\u6709\u673a\u5236\u6709\u5173\u4e86\uff0c\u6211\u4eec\u6765\u5177\u4f53\u5206\u6790\u4e0b\u3002 Redis \u8bbe\u8ba1\u4e86 RDB \u548c AOF \u4e24\u79cd\u673a\u5236\uff0c\u628a\u6570\u636e\u6301\u4e45\u5316\u4fdd\u5b58\u5230\u786c\u76d8\u4e0a\u3002 \u4f46\u662f\uff0c\u65e0\u8bba\u662f RDB \u8fd8\u662f AOF\uff0c \u90fd\u9700\u8981\u628a\u6570\u636e\u6216\u547d\u4ee4\u64cd\u4f5c\u4ee5\u6587\u4ef6\u7684\u5f62\u5f0f\u5199\u5230\u786c\u76d8\u4e0a \u3002 \u5bf9\u4e8e RDB \u6765\u8bf4\uff0c\u867d\u7136 Redis \u5b9e\u4f8b\u53ef\u4ee5\u901a\u8fc7\u5b50\u8fdb\u7a0b\u751f\u6210 RDB \u6587\u4ef6\uff0c\u4f46\u662f\uff0c\u5b9e\u4f8b\u4e3b\u7ebf\u7a0b fork \u5b50\u8fdb\u7a0b\u65f6\uff0c\u4ecd\u7136\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b \u3002\u800c\u4e14\uff0cRDB \u6587\u4ef6\u7684\u751f\u6210\u9700\u8981\u7ecf\u8fc7\u6587\u4ef6\u7cfb\u7edf\uff0c\u6587\u4ef6\u672c\u8eab\u4f1a\u6709\u4e00\u5b9a\u7684\u64cd\u4f5c\u5f00\u9500\u3002 \u5bf9\u4e8e AOF \u65e5\u5fd7\u6765\u8bf4\uff0c\u867d\u7136 Redis \u63d0\u4f9b\u4e86 always\u3001everysec \u548c no \u4e09\u4e2a\u9009\u9879\uff0c\u5176\u4e2d\uff0calways \u9009\u9879\u4ee5 fsync \u7684\u65b9\u5f0f\u843d\u76d8\u4fdd\u5b58\u6570\u636e\uff0c\u867d\u7136\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u53ef\u9760\u6027\uff0c\u4f46\u662f\u9762\u4e34\u6027\u80fd\u635f\u5931\u7684\u98ce\u9669\u3002 everysec \u9009\u9879\u907f\u514d\u4e86\u6bcf\u4e2a\u64cd\u4f5c\u90fd\u8981\u5b9e\u65f6\u843d\u76d8\uff0c\u6539\u4e3a\u540e\u53f0\u6bcf\u79d2\u5b9a\u671f\u843d\u76d8\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cRedis \u7684\u5199\u6027\u80fd\u5f97\u5230\u4e86\u6539\u5584\uff0c\u4f46\u662f\uff0c\u5e94\u7528\u4f1a\u9762\u4e34\u79d2\u7ea7\u6570\u636e\u4e22\u5931\u7684\u98ce\u9669\u3002 \u6b64\u5916\uff0c\u5f53\u6211\u4eec\u4f7f\u7528 RDB \u6587\u4ef6\u6216 AOF \u6587\u4ef6\u5bf9 Redis \u8fdb\u884c\u6062\u590d\u65f6\uff0c\u9700\u8981\u628a RDB \u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u6216\u8005\u662f\u56de\u653e AOF \u4e2d\u7684\u65e5\u5fd7\u64cd\u4f5c\u3002\u8fd9\u4e2a\u6062\u590d\u8fc7\u7a0b\u7684\u6548\u7387\u53d7\u5230 RDB \u6587\u4ef6\u5927\u5c0f\u548c AOF \u6587\u4ef6\u4e2d\u7684\u65e5\u5fd7\u64cd\u4f5c\u591a\u5c11\u7684\u5f71\u54cd\u3002 \u6240\u4ee5\uff0c\u4e0d\u8981\u8ba9\u5355\u4e2a Redis \u5b9e\u4f8b\u8fc7\u5927\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4 RDB \u6587\u4ef6\u8fc7\u5927\u3002\u5728\u4e3b\u4ece\u96c6\u7fa4\u5e94\u7528\u4e2d\uff0c\u8fc7\u5927\u7684 RDB \u6587\u4ef6\u5c31\u4f1a\u5bfc\u81f4\u4f4e\u6548\u7684\u4e3b\u4ece\u540c\u6b65\u3002 Redis \u5728\u6d89\u53ca\u6301\u4e45\u5316\u64cd\u4f5c\u65f6\u7684\u95ee\u9898\uff1a RDB \u6587\u4ef6\u521b\u5efa\u65f6\u7684 fork \u64cd\u4f5c\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\uff1b AOF \u6587\u4ef6\u8bb0\u5f55\u65e5\u5fd7\u65f6\uff0c\u9700\u8981\u5728\u6570\u636e\u53ef\u9760\u6027\u548c\u5199\u6027\u80fd\u4e4b\u95f4\u53d6\u5f97\u5e73\u8861 \uff1b \u4f7f\u7528 RDB \u6216 AOF \u6062\u590d\u6570\u636e\u65f6\uff0c\u6062\u590d\u6548\u7387\u53d7 RDB \u548c AOF \u5927\u5c0f\u7684\u9650\u5236\u3002 \u5982\u679c\u6211\u4eec\u4f7f\u7528\u6301\u4e45\u5316\u5185\u5b58\uff0c\u5c31\u53ef\u4ee5\u5145\u5206\u5229\u7528 PM \u5feb\u901f\u6301\u4e45\u5316\u7684\u7279\u70b9\uff0c\u6765\u907f\u514d RDB \u548c AOF \u7684\u64cd\u4f5c\u3002 \u56e0\u4e3a PM \u652f\u6301\u5185\u5b58\u8bbf\u95ee\uff0c\u800c Redis \u7684\u64cd\u4f5c\u90fd\u662f\u5185\u5b58\u64cd\u4f5c\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a Redis \u76f4\u63a5\u8fd0\u884c\u5728 PM \u4e0a\u3002\u540c\u65f6\uff0c\u6570\u636e\u672c\u8eab\u5c31\u53ef\u4ee5\u5728 PM \u4e0a\u6301\u4e45\u5316\u4fdd\u5b58\u4e86\uff0c\u6211\u4eec\u5c31\u4e0d\u518d\u9700\u8981\u989d\u5916\u7684 RDB \u6216 AOF \u65e5\u5fd7\u673a\u5236\u6765\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\u4e86\u3002 \u90a3\u4e48\uff0c\u5f53\u4f7f\u7528 PM \u6765\u652f\u6301 Redis \u7684\u6301\u4e45\u5316\u64cd\u4f5c\u65f6\uff0c\u6211\u4eec\u5177\u4f53\u8be5\u5982\u4f55\u5b9e\u73b0\u5462\uff1f 2-2 PM \u7684\u4f7f\u7528\u65b9\u6cd5 \u5f53\u670d\u52a1\u5668\u4e2d\u90e8\u7f72\u4e86 PM \u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u64cd\u4f5c\u7cfb\u7edf\u7684 /dev \u76ee\u5f55\u4e0b\u770b\u5230\u4e00\u4e2a PM \u8bbe\u5907\uff0c\u5982\u4e0b\u6240\u793a\uff1a /dev/pmem0 \u7136\u540e\uff0c\u9700\u8981\u4f7f\u7528 ext4-dax \u6587\u4ef6\u7cfb\u7edf\u6765\u683c\u5f0f\u5316\u8fd9\u4e2a\u8bbe\u5907\uff1a mkfs.ext4 /dev/pmem0 \u8fd9\u4e2a\u683c\u5f0f\u5316\u597d\u7684\u8bbe\u5907\uff0c\u6302\u8f7d\u5230\u670d\u52a1\u5668\u4e0a\u7684\u4e00\u4e2a\u76ee\u5f55\u4e0b mount -o dax /dev/pmem0 /mnt/pmem0 \u6b64\u65f6\uff0c\u53ef\u4ee5\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u521b\u5efa\u6587\u4ef6\u4e86\u3002 \u521b\u5efa\u597d\u4e86\u4ee5\u540e\uff0c\u518d\u628a\u8fd9\u4e9b\u6587\u4ef6\u901a\u8fc7\u5185\u5b58\u6620\u5c04\uff08mmap\uff09\u7684\u65b9\u5f0f\u6620\u5c04\u5230 Redis \u7684\u8fdb\u7a0b\u7a7a\u95f4 \u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a Redis \u63a5\u6536\u5230\u7684\u6570\u636e\u76f4\u63a5\u4fdd\u5b58\u5230\u6620\u5c04\u7684\u5185\u5b58\u7a7a\u95f4\u4e0a\u4e86\uff0c\u800c\u8fd9\u5757\u5185\u5b58\u7a7a\u95f4\u662f\u7531 PM \u63d0\u4f9b\u7684\u3002\u6240\u4ee5\uff0c\u6570\u636e\u5199\u5165\u8fd9\u5757\u7a7a\u95f4\u65f6\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u88ab\u6301\u4e45\u5316\u4fdd\u5b58\u4e86\u3002 \u800c\u4e14\uff0c\u5982\u679c\u8981\u4fee\u6539\u6216\u5220\u9664\u6570\u636e\uff0cPM \u672c\u8eab\u4e5f\u652f\u6301\u4ee5\u5b57\u8282\u7c92\u5ea6\u8fdb\u884c\u6570\u636e\u8bbf\u95ee\uff0c\u6240\u4ee5\uff0cRedis \u53ef\u4ee5\u76f4\u63a5\u5728 PM \u4e0a\u4fee\u6539\u6216\u5220\u9664\u6570\u636e\u3002 \u5982\u679c\u53d1\u751f\u4e86\u5b9e\u4f8b\u6545\u969c\uff0cRedis \u5b95\u673a\u4e86\uff0c\u56e0\u4e3a\u6570\u636e\u672c\u8eab\u5df2\u7ecf\u6301\u4e45\u5316\u4fdd\u5b58\u5728 PM \u4e0a\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 PM \u4e0a\u7684\u6570\u636e\u8fdb\u884c\u5b9e\u4f8b\u6062\u590d\uff0c\u800c\u4e0d\u7528\u518d\u50cf\u73b0\u5728\u7684 Redis \u90a3\u6837\uff0c\u901a\u8fc7\u52a0\u8f7d RDB \u6587\u4ef6\u6216\u662f\u91cd\u653e AOF \u65e5\u5fd7\u64cd\u4f5c\u6765\u6062\u590d\u4e86\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5feb\u901f\u7684\u6545\u969c\u6062\u590d\u3002 \u5f53\u7136\uff0c\u56e0\u4e3a PM \u7684\u8bfb\u5199\u901f\u5ea6\u6bd4 DRAM \u6162\uff0c\u6240\u4ee5\uff0c \u5982\u679c\u4f7f\u7528 PM \u6765\u8fd0\u884c Redis\uff0c\u9700\u8981\u8bc4\u4f30\u4e0b PM \u63d0\u4f9b\u7684\u8bbf\u95ee\u5ef6\u8fdf\u548c\u8bbf\u95ee\u5e26\u5bbd\uff0c\u662f\u5426\u80fd\u6ee1\u8db3\u4e1a\u52a1\u5c42\u7684\u9700\u6c42 \u3002 \u8bc4\u4f30 PM \u5e26\u5bbd\u5bf9 Redis \u4e1a\u52a1\u7684\u652f\u6491\u3002 \u5047\u8bbe\u4e1a\u52a1\u5c42\u9700\u8981\u652f\u6301 1 \u767e\u4e07 QPS\uff0c\u5e73\u5747\u6bcf\u4e2a\u8bf7\u6c42\u7684\u5927\u5c0f\u662f 2KB\uff0c\u90a3\u4e48\uff0c\u5c31\u9700\u8981\u673a\u5668\u80fd\u652f\u6301 2GB/s \u7684\u5e26\u5bbd\uff081 \u767e\u4e07\u8bf7\u6c42\u64cd\u4f5c\u6bcf\u79d2 * 2KB \u6bcf\u8bf7\u6c42 = 2GB/s\uff09\u3002\u5982\u679c\u8fd9\u4e9b\u8bf7\u6c42\u6b63\u597d\u662f\u5199\u64cd\u4f5c\u7684\u8bdd\uff0c\u90a3\u4e48\uff0c\u5355\u6839 PM \u7684\u5199\u5e26\u5bbd\u53ef\u80fd\u4e0d\u592a\u591f\u7528\u4e86\u3002 \u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u4f7f\u7528\u591a\u6839 PM \u5185\u5b58\u6761\uff0c\u6765\u652f\u6491\u9ad8\u5e26\u5bbd\u7684\u9700\u6c42\u3002\u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5207\u7247\u96c6\u7fa4\uff0c\u628a\u6570\u636e\u5206\u6563\u4fdd\u5b58\u5230\u591a\u4e2a\u5b9e\u4f8b\uff0c\u5206\u62c5\u8bbf\u95ee\u538b\u529b\u3002 \u638c\u63e1\u4e86\u7528 PM \u5c06 Redis \u6570\u636e\u76f4\u63a5\u6301\u4e45\u5316\u4fdd\u5b58\u5728\u5185\u5b58\u4e0a\u7684\u65b9\u6cd5\u3002 \u73b0\u5728\uff0c\u6211\u4eec\u65e2\u53ef\u4ee5\u5728\u5355\u4e2a\u5b9e\u4f8b\u4e0a\u4f7f\u7528\u5927\u5bb9\u91cf\u7684 PM \u4fdd\u5b58\u66f4\u591a\u7684\u4e1a\u52a1\u6570\u636e\u4e86\uff0c\u540c\u65f6\uff0c\u4e5f\u53ef\u4ee5\u5728\u5b9e\u4f8b\u6545\u969c\u540e\uff0c\u76f4\u63a5\u4f7f\u7528 PM \u4e0a\u4fdd\u5b58\u7684\u6570\u636e\u8fdb\u884c\u6545\u969c\u6062\u590d \u3002 3\u3001\u672c\u8282\u5c0f\u7ed3 NVM \u7684\u4e09\u5927\u7279\u70b9\uff1a\u6027\u80fd\u9ad8\u3001\u5bb9\u91cf\u5927\u3001\u6570\u636e\u53ef\u4ee5\u6301\u4e45\u5316\u4fdd\u5b58\u3002\u8f6f\u4ef6\u7cfb\u7edf\u53ef\u4ee5\u50cf\u8bbf\u95ee\u4f20\u7edf DRAM \u5185\u5b58\u4e00\u6837\uff0c\u8bbf\u95ee NVM \u5185\u5b58\u3002\u76ee\u524d\uff0cIntel \u5df2\u7ecf\u63a8\u51fa\u4e86 NVM \u5185\u5b58\u4ea7\u54c1 Optane AEP\u3002 \u8fd9\u6b3e NVM \u5185\u5b58\u4ea7\u54c1\u7ed9\u8f6f\u4ef6\u63d0\u4f9b\u4e86\u4e24\u79cd\u4f7f\u7528\u6a21\u5f0f\uff0c \u5206\u522b\u662f Memory \u6a21\u5f0f\u548c App Direct \u6a21\u5f0f \u3002\u5728 Memory \u6a21\u5f0f\u65f6\uff0cRedis \u53ef\u4ee5\u5229\u7528 NVM \u5bb9\u91cf\u5927\u7684\u7279\u70b9\uff0c\u5b9e\u73b0\u5927\u5bb9\u91cf\u5b9e\u4f8b\uff0c\u4fdd\u5b58\u66f4\u591a\u6570\u636e\u3002\u5728\u4f7f\u7528 App Direct \u6a21\u5f0f\u65f6\uff0cRedis \u53ef\u4ee5\u76f4\u63a5\u5728\u6301\u4e45\u5316\u5185\u5b58\u4e0a\u8fdb\u884c\u6570\u636e\u8bfb\u5199\uff0c \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cRedis \u4e0d\u7528\u518d\u4f7f\u7528 RDB \u6216 AOF \u6587\u4ef6\u4e86\uff0c\u6570\u636e\u5728\u673a\u5668\u6389\u7535\u540e\u4e5f\u4e0d\u4f1a\u4e22\u5931\u3002\u800c\u4e14\uff0c\u5b9e\u4f8b\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u6301\u4e45\u5316\u5185\u5b58\u4e0a\u7684\u6570\u636e\u8fdb\u884c\u6062\u590d\uff0c\u6062\u590d\u901f\u5ea6\u7279\u522b\u5feb\u3002 NVM \u5185\u5b58\u662f\u8fd1\u5e74\u6765\u5b58\u50a8\u8bbe\u5907\u9886\u57df\u4e2d\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u53d8\u5316\uff0c\u5b83\u65e2\u80fd\u6301\u4e45\u5316\u4fdd\u5b58\u6570\u636e\uff0c\u8fd8\u80fd\u50cf\u5185\u5b58\u4e00\u6837\u5feb\u901f\u8bbf\u95ee\uff0c\u8fd9\u5fc5\u7136\u4f1a\u7ed9\u5f53\u524d\u57fa\u4e8e DRAM \u548c\u786c\u76d8\u7684\u7cfb\u7edf\u8f6f\u4ef6\u4f18\u5316\u5e26\u6765\u65b0\u7684\u673a\u9047\u3002","title":"\u7b2c\u4e8c\u8282 Redis \u57fa\u4e8eNVM\u5185\u5b58\u7684\u5b9e\u8df5"},{"location":"chap8/2redis_nvm_mem/#redis-nvm","text":"\u8fd9\u51e0\u5e74\u5462\uff0c\u65b0\u578b\u975e\u6613\u5931\u5b58\u50a8\uff08Non-Volatile Memory\uff0cNVM\uff09\u5668\u4ef6\u53d1\u5c55\u5f97\u975e\u5e38\u5feb\u3002 NVM \u5668\u4ef6\u5177\u6709\u5bb9\u91cf\u5927\u3001\u6027\u80fd\u5feb\u3001\u80fd\u6301\u4e45\u5316\u4fdd\u5b58\u6570\u636e\u7684\u7279\u6027\uff0c\u8fd9\u4e9b\u521a\u597d\u5c31\u662f Redis \u8ffd\u6c42\u7684\u76ee\u6807\u3002\u540c\u65f6\uff0cNVM \u5668\u4ef6\u50cf DRAM \u4e00\u6837\uff0c\u53ef\u4ee5\u8ba9\u8f6f\u4ef6\u4ee5\u5b57\u8282\u7c92\u5ea6\u8fdb\u884c\u5bfb\u5740\u8bbf\u95ee\uff0c\u6240\u4ee5\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0cNVM \u53ef\u4ee5\u4f5c\u4e3a\u5185\u5b58\u6765\u4f7f\u7528\uff0c\u6211\u4eec\u79f0\u4e3a NVM \u5185\u5b58\u3002 Redis \u4f5c\u4e3a\u5185\u5b58\u952e\u503c\u6570\u636e\u5e93\uff0c\u5982\u679c\u80fd\u548c NVM \u5185\u5b58\u7ed3\u5408\u8d77\u6765\u4f7f\u7528\uff0c\u5c31\u53ef\u4ee5\u5145\u5206\u4eab\u53d7\u5230\u8fd9\u4e9b\u7279\u6027","title":"\u7b2c\u4e8c\u8282 Redis \u57fa\u4e8eNVM\u5185\u5b58\u7684\u5b9e\u8df5"},{"location":"chap8/2redis_nvm_mem/#1nvm","text":"","title":"1\u3001NVM \u5185\u5b58\u7684\u7279\u6027\u4e0e\u4f7f\u7528\u6a21\u5f0f"},{"location":"chap8/2redis_nvm_mem/#1-1-nvm","text":"Redis \u662f\u57fa\u4e8e DRAM \u5185\u5b58\u7684\u952e\u503c\u6570\u636e\u5e93\uff0c\u800c\u8ddf\u4f20\u7edf\u7684 DRAM \u5185\u5b58\u76f8\u6bd4\uff0cNVM \u6709\u4e09\u4e2a\u663e\u8457\u7684\u7279\u70b9\u3002 \u9996\u5148\uff0c NVM \u5185\u5b58\u6700\u5927\u7684\u4f18\u52bf\u662f\u53ef\u4ee5\u76f4\u63a5\u6301\u4e45\u5316\u4fdd\u5b58\u6570\u636e \u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6570\u636e\u4fdd\u5b58\u5728 NVM \u5185\u5b58\u4e0a\u540e\uff0c\u5373\u4f7f\u53d1\u751f\u4e86\u5b95\u673a\u6216\u662f\u6389\u7535\uff0c\u6570\u636e\u4ecd\u7136\u5b58\u5728 NVM \u5185\u5b58\u4e0a\u3002\u4f46\u5982\u679c\u6570\u636e\u662f\u4fdd\u5b58\u5728 DRAM \u4e0a\uff0c\u90a3\u4e48\uff0c\u6389\u7535\u540e\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u3002 \u5176\u6b21\uff0c NVM \u5185\u5b58\u7684\u8bbf\u95ee\u901f\u5ea6\u63a5\u8fd1 DRAM \u7684\u901f\u5ea6 \u3002\u5b9e\u9645\u6d4b\u8bd5\u8fc7 NVM \u5185\u5b58\u7684\u8bbf\u95ee\u901f\u5ea6\uff0c\u7ed3\u679c\u663e\u793a\uff0c\u5b83\u7684\u8bfb\u5ef6\u8fdf\u5927\u7ea6\u662f 200~300ns\uff0c\u800c\u5199\u5ef6\u8fdf\u5927\u7ea6\u662f 100ns\u3002\u5728\u8bfb\u5199\u5e26\u5bbd\u65b9\u9762\uff0c\u5355\u6839 NVM \u5185\u5b58\u6761\u7684\u5199\u5e26\u5bbd\u5927\u7ea6\u662f 1~2GB/s\uff0c\u800c\u8bfb\u5e26\u5bbd\u7ea6\u662f 5~6GB/s\u3002\u5f53\u8f6f\u4ef6\u7cfb\u7edf\u628a\u6570\u636e\u4fdd\u5b58\u5728 NVM \u5185\u5b58\u4e0a\u65f6\uff0c\u7cfb\u7edf\u4ecd\u7136\u53ef\u4ee5\u5feb\u901f\u5730\u5b58\u53d6\u6570\u636e \u6700\u540e\uff0c NVM \u5185\u5b58\u7684\u5bb9\u91cf\u5f88\u5927\u3002 \u8fd9\u662f\u56e0\u4e3a\uff0cNVM \u5668\u4ef6\u7684\u5bc6\u5ea6\u5927\uff0c\u5355\u4e2a NVM \u7684\u5b58\u50a8\u5355\u5143\u53ef\u4ee5\u4fdd\u5b58\u66f4\u591a\u6570\u636e\u3002\u4f8b\u5982\uff0c\u5355\u6839 NVM \u5185\u5b58\u6761\u5c31\u80fd\u8fbe\u5230 128GB \u7684\u5bb9\u91cf\uff0c\u6700\u5927\u53ef\u4ee5\u8fbe\u5230 512GB\uff0c\u800c\u5355\u6839 DRAM \u5185\u5b58\u6761\u901a\u5e38\u662f 16GB \u6216 32GB\u3002\u6240\u4ee5\uff0c\u53ef\u4ee5\u5f88\u8f7b\u677e\u5730\u7528 NVM \u5185\u5b58\u6784\u5efa TB \u7ea7\u522b\u7684\u5185\u5b58\u3002 \u603b\u7ed3\u6765\u8bf4\uff0cNVM \u5185\u5b58\u7684\u7279\u70b9\u53ef\u4ee5\u7528\u4e09\u53e5\u8bdd\u6982\u62ec\uff1a \u80fd\u6301\u4e45\u5316\u4fdd\u5b58\u6570\u636e\uff1b \u8bfb\u5199\u901f\u5ea6\u548c DRAM \u63a5\u8fd1\uff1b \u5bb9\u91cf\u5927\u3002 \u73b0\u5728\uff0c\u4e1a\u754c\u5df2\u7ecf\u6709\u4e86\u5b9e\u9645\u7684 NVM \u5185\u5b58\u4ea7\u54c1\uff0c\u5c31\u662f Intel \u5728 2019 \u5e74 4 \u6708\u4efd\u65f6\u63a8\u51fa\u7684 Optane AEP \u5185\u5b58\u6761\uff08\u7b80\u79f0 AEP \u5185\u5b58\uff09\u3002\u6211\u4eec\u5728\u5e94\u7528 AEP \u5185\u5b58\u65f6\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cAEP \u5185\u5b58\u7ed9\u8f6f\u4ef6\u63d0\u4f9b\u4e86\u4e24\u79cd\u4f7f\u7528\u6a21\u5f0f\uff0c\u5206\u522b\u5bf9\u5e94\u7740\u4f7f\u7528\u4e86 NVM \u7684\u5bb9\u91cf\u5927\u548c\u6301\u4e45\u5316\u4fdd\u5b58\u6570\u636e\u4e24\u4e2a\u7279\u6027\uff0c\u6211\u4eec\u6765\u5b66\u4e60\u4e0b\u8fd9\u4e24\u79cd\u6a21\u5f0f\u3002","title":"1-1 NVM \u6709\u4e09\u4e2a\u7279\u70b9"},{"location":"chap8/2redis_nvm_mem/#1-2-nvm","text":"\u7b2c\u4e00\u79cd\u662f Memory \u6a21\u5f0f\u3002 \u8fd9\u79cd\u6a21\u5f0f\u662f\u628a NVM \u5185\u5b58\u4f5c\u4e3a\u5927\u5bb9\u91cf\u5185\u5b58\u6765\u4f7f\u7528\u7684 \uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u4f7f\u7528 NVM \u5bb9\u91cf\u5927\u548c\u6027\u80fd\u9ad8\u7684\u7279\u6027\uff0c \u6ca1\u6709\u542f\u7528\u6570\u636e\u6301\u4e45\u5316\u7684\u529f\u80fd \u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u5b89\u88c5 6 \u6839 NVM \u5185\u5b58\u6761\uff0c\u6bcf\u6839 512GB\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u5355\u53f0\u670d\u52a1\u5668\u4e0a\u83b7\u5f97 3TB \u7684\u5185\u5b58\u5bb9\u91cf\u4e86\u3002 \u5728 Memory \u6a21\u5f0f\u4e0b\uff0c\u670d\u52a1\u5668\u4e0a\u4ecd\u7136\u9700\u8981\u914d\u7f6e DRAM \u5185\u5b58\uff0c\u4f46\u662f\uff0cDRAM \u5185\u5b58\u662f\u88ab CPU \u7528\u4f5c AEP \u5185\u5b58\u7684\u7f13\u5b58\uff0cDRAM \u7684\u7a7a\u95f4\u5bf9\u5e94\u7528\u8f6f\u4ef6\u4e0d\u53ef\u89c1\u3002 \u6362\u53e5\u8bdd\u8bf4\uff0c\u8f6f\u4ef6\u7cfb\u7edf\u80fd\u4f7f\u7528\u5230\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5c31\u662f AEP \u5185\u5b58\u6761\u7684\u7a7a\u95f4\u5bb9\u91cf\u3002 \u7b2c\u4e8c\u79cd\u662f App Direct \u6a21\u5f0f\u3002 \u8fd9\u79cd\u6a21\u5f0f\u542f\u7528\u4e86 NVM \u6301\u4e45\u5316\u6570\u636e\u7684\u529f\u80fd\u3002\u5728\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c\u5e94\u7528\u8f6f\u4ef6\u628a\u6570\u636e\u5199\u5230 AEP \u5185\u5b58\u4e0a\u65f6\uff0c\u6570\u636e\u5c31\u76f4\u63a5\u6301\u4e45\u5316\u4fdd\u5b58\u4e0b\u6765\u4e86\u3002\u6240\u4ee5\uff0c \u4f7f\u7528\u4e86 App Direct \u6a21\u5f0f\u7684 AEP \u5185\u5b58\uff0c\u4e5f\u53eb\u505a\u6301\u4e45\u5316\u5185\u5b58\uff08Persistent Memory\uff0cPM\uff09\u3002","title":"1-2 NVM \u4e24\u79cd\u6a21\u5f0f"},{"location":"chap8/2redis_nvm_mem/#2-nvm-redis","text":"","title":"2\u3001\u57fa\u4e8e NVM \u5185\u5b58\u7684 Redis \u5b9e\u8df5"},{"location":"chap8/2redis_nvm_mem/#2-1-aep-memory","text":"\u5f53 AEP \u5185\u5b58\u4f7f\u7528 Memory \u6a21\u5f0f\u65f6\uff0c\u5e94\u7528\u8f6f\u4ef6\u5c31\u53ef\u4ee5\u5229\u7528\u5b83\u7684\u5927\u5bb9\u91cf\u7279\u6027\u6765\u4fdd\u5b58\u5927\u91cf\u6570\u636e\uff0cRedis \u4e5f\u5c31\u53ef\u4ee5\u7ed9\u4e0a\u5c42\u4e1a\u52a1\u5e94\u7528\u63d0\u4f9b\u5927\u5bb9\u91cf\u7684\u5b9e\u4f8b\u4e86\u3002\u800c\u4e14\uff0c\u5728 Memory \u6a21\u5f0f\u4e0b\uff0cRedis \u53ef\u4ee5\u50cf\u5728 DRAM \u5185\u5b58\u4e0a\u8fd0\u884c\u4e00\u6837\uff0c\u76f4\u63a5\u5728 AEP \u5185\u5b58\u4e0a\u8fd0\u884c\uff0c\u4e0d\u7528\u4fee\u6539\u4ee3\u7801\u3002 \u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\u4e0b\uff1a\u5728 Memory \u6a21\u5f0f\u4e0b\uff0cAEP \u5185\u5b58\u7684\u8bbf\u95ee\u5ef6\u8fdf\u4f1a\u6bd4 DRAM \u9ad8\u4e00\u70b9\u3002\u6211\u521a\u521a\u63d0\u5230\u8fc7\uff0cNVM \u7684\u8bfb\u5ef6\u8fdf\u5927\u7ea6\u662f 200~300ns\uff0c\u800c\u5199\u5ef6\u8fdf\u5927\u7ea6\u662f 100ns\u3002 \u6240\u4ee5\uff0c\u5728 Memory \u6a21\u5f0f\u4e0b\u8fd0\u884c Redis \u5b9e\u4f8b\uff0c\u5b9e\u4f8b\u8bfb\u6027\u80fd\u4f1a\u6709\u6240\u964d\u4f4e\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5728\u4fdd\u5b58\u5927\u91cf\u6570\u636e\u548c\u8bfb\u6027\u80fd\u8f83\u6162\u4e24\u8005\u4e4b\u95f4\u505a\u4e2a\u53d6\u820d \u3002","title":"2-1  AEP \u5185\u5b58\u4f7f\u7528 Memory \u6a21\u5f0f\u65f6"},{"location":"chap8/2redis_nvm_mem/#2-1-aep-app-direct","text":"\u5f53\u6211\u4eec\u4f7f\u7528 App Direct \u6a21\u5f0f\uff0c\u628a AEP \u5185\u5b58\u7528\u4f5c PM \u65f6\uff0cRedis \u53c8\u8be5\u5982\u4f55\u5229\u7528 PM \u5feb\u901f\u6301\u4e45\u5316\u6570\u636e\u7684\u7279\u6027\u5462\uff1f\u8fd9\u5c31\u548c Redis \u7684\u6570\u636e\u53ef\u9760\u6027\u4fdd\u8bc1\u9700\u6c42\u548c\u73b0\u6709\u673a\u5236\u6709\u5173\u4e86\uff0c\u6211\u4eec\u6765\u5177\u4f53\u5206\u6790\u4e0b\u3002 Redis \u8bbe\u8ba1\u4e86 RDB \u548c AOF \u4e24\u79cd\u673a\u5236\uff0c\u628a\u6570\u636e\u6301\u4e45\u5316\u4fdd\u5b58\u5230\u786c\u76d8\u4e0a\u3002 \u4f46\u662f\uff0c\u65e0\u8bba\u662f RDB \u8fd8\u662f AOF\uff0c \u90fd\u9700\u8981\u628a\u6570\u636e\u6216\u547d\u4ee4\u64cd\u4f5c\u4ee5\u6587\u4ef6\u7684\u5f62\u5f0f\u5199\u5230\u786c\u76d8\u4e0a \u3002 \u5bf9\u4e8e RDB \u6765\u8bf4\uff0c\u867d\u7136 Redis \u5b9e\u4f8b\u53ef\u4ee5\u901a\u8fc7\u5b50\u8fdb\u7a0b\u751f\u6210 RDB \u6587\u4ef6\uff0c\u4f46\u662f\uff0c\u5b9e\u4f8b\u4e3b\u7ebf\u7a0b fork \u5b50\u8fdb\u7a0b\u65f6\uff0c\u4ecd\u7136\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b \u3002\u800c\u4e14\uff0cRDB \u6587\u4ef6\u7684\u751f\u6210\u9700\u8981\u7ecf\u8fc7\u6587\u4ef6\u7cfb\u7edf\uff0c\u6587\u4ef6\u672c\u8eab\u4f1a\u6709\u4e00\u5b9a\u7684\u64cd\u4f5c\u5f00\u9500\u3002 \u5bf9\u4e8e AOF \u65e5\u5fd7\u6765\u8bf4\uff0c\u867d\u7136 Redis \u63d0\u4f9b\u4e86 always\u3001everysec \u548c no \u4e09\u4e2a\u9009\u9879\uff0c\u5176\u4e2d\uff0calways \u9009\u9879\u4ee5 fsync \u7684\u65b9\u5f0f\u843d\u76d8\u4fdd\u5b58\u6570\u636e\uff0c\u867d\u7136\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u53ef\u9760\u6027\uff0c\u4f46\u662f\u9762\u4e34\u6027\u80fd\u635f\u5931\u7684\u98ce\u9669\u3002 everysec \u9009\u9879\u907f\u514d\u4e86\u6bcf\u4e2a\u64cd\u4f5c\u90fd\u8981\u5b9e\u65f6\u843d\u76d8\uff0c\u6539\u4e3a\u540e\u53f0\u6bcf\u79d2\u5b9a\u671f\u843d\u76d8\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cRedis \u7684\u5199\u6027\u80fd\u5f97\u5230\u4e86\u6539\u5584\uff0c\u4f46\u662f\uff0c\u5e94\u7528\u4f1a\u9762\u4e34\u79d2\u7ea7\u6570\u636e\u4e22\u5931\u7684\u98ce\u9669\u3002 \u6b64\u5916\uff0c\u5f53\u6211\u4eec\u4f7f\u7528 RDB \u6587\u4ef6\u6216 AOF \u6587\u4ef6\u5bf9 Redis \u8fdb\u884c\u6062\u590d\u65f6\uff0c\u9700\u8981\u628a RDB \u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u6216\u8005\u662f\u56de\u653e AOF \u4e2d\u7684\u65e5\u5fd7\u64cd\u4f5c\u3002\u8fd9\u4e2a\u6062\u590d\u8fc7\u7a0b\u7684\u6548\u7387\u53d7\u5230 RDB \u6587\u4ef6\u5927\u5c0f\u548c AOF \u6587\u4ef6\u4e2d\u7684\u65e5\u5fd7\u64cd\u4f5c\u591a\u5c11\u7684\u5f71\u54cd\u3002 \u6240\u4ee5\uff0c\u4e0d\u8981\u8ba9\u5355\u4e2a Redis \u5b9e\u4f8b\u8fc7\u5927\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4 RDB \u6587\u4ef6\u8fc7\u5927\u3002\u5728\u4e3b\u4ece\u96c6\u7fa4\u5e94\u7528\u4e2d\uff0c\u8fc7\u5927\u7684 RDB \u6587\u4ef6\u5c31\u4f1a\u5bfc\u81f4\u4f4e\u6548\u7684\u4e3b\u4ece\u540c\u6b65\u3002 Redis \u5728\u6d89\u53ca\u6301\u4e45\u5316\u64cd\u4f5c\u65f6\u7684\u95ee\u9898\uff1a RDB \u6587\u4ef6\u521b\u5efa\u65f6\u7684 fork \u64cd\u4f5c\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\uff1b AOF \u6587\u4ef6\u8bb0\u5f55\u65e5\u5fd7\u65f6\uff0c\u9700\u8981\u5728\u6570\u636e\u53ef\u9760\u6027\u548c\u5199\u6027\u80fd\u4e4b\u95f4\u53d6\u5f97\u5e73\u8861 \uff1b \u4f7f\u7528 RDB \u6216 AOF \u6062\u590d\u6570\u636e\u65f6\uff0c\u6062\u590d\u6548\u7387\u53d7 RDB \u548c AOF \u5927\u5c0f\u7684\u9650\u5236\u3002 \u5982\u679c\u6211\u4eec\u4f7f\u7528\u6301\u4e45\u5316\u5185\u5b58\uff0c\u5c31\u53ef\u4ee5\u5145\u5206\u5229\u7528 PM \u5feb\u901f\u6301\u4e45\u5316\u7684\u7279\u70b9\uff0c\u6765\u907f\u514d RDB \u548c AOF \u7684\u64cd\u4f5c\u3002 \u56e0\u4e3a PM \u652f\u6301\u5185\u5b58\u8bbf\u95ee\uff0c\u800c Redis \u7684\u64cd\u4f5c\u90fd\u662f\u5185\u5b58\u64cd\u4f5c\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a Redis \u76f4\u63a5\u8fd0\u884c\u5728 PM \u4e0a\u3002\u540c\u65f6\uff0c\u6570\u636e\u672c\u8eab\u5c31\u53ef\u4ee5\u5728 PM \u4e0a\u6301\u4e45\u5316\u4fdd\u5b58\u4e86\uff0c\u6211\u4eec\u5c31\u4e0d\u518d\u9700\u8981\u989d\u5916\u7684 RDB \u6216 AOF \u65e5\u5fd7\u673a\u5236\u6765\u4fdd\u8bc1\u6570\u636e\u53ef\u9760\u6027\u4e86\u3002 \u90a3\u4e48\uff0c\u5f53\u4f7f\u7528 PM \u6765\u652f\u6301 Redis \u7684\u6301\u4e45\u5316\u64cd\u4f5c\u65f6\uff0c\u6211\u4eec\u5177\u4f53\u8be5\u5982\u4f55\u5b9e\u73b0\u5462\uff1f","title":"2-1  AEP \u5185\u5b58\u4f7f\u7528 App Direct \u6a21\u5f0f"},{"location":"chap8/2redis_nvm_mem/#2-2-pm","text":"\u5f53\u670d\u52a1\u5668\u4e2d\u90e8\u7f72\u4e86 PM \u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u64cd\u4f5c\u7cfb\u7edf\u7684 /dev \u76ee\u5f55\u4e0b\u770b\u5230\u4e00\u4e2a PM \u8bbe\u5907\uff0c\u5982\u4e0b\u6240\u793a\uff1a /dev/pmem0 \u7136\u540e\uff0c\u9700\u8981\u4f7f\u7528 ext4-dax \u6587\u4ef6\u7cfb\u7edf\u6765\u683c\u5f0f\u5316\u8fd9\u4e2a\u8bbe\u5907\uff1a mkfs.ext4 /dev/pmem0 \u8fd9\u4e2a\u683c\u5f0f\u5316\u597d\u7684\u8bbe\u5907\uff0c\u6302\u8f7d\u5230\u670d\u52a1\u5668\u4e0a\u7684\u4e00\u4e2a\u76ee\u5f55\u4e0b mount -o dax /dev/pmem0 /mnt/pmem0 \u6b64\u65f6\uff0c\u53ef\u4ee5\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u521b\u5efa\u6587\u4ef6\u4e86\u3002 \u521b\u5efa\u597d\u4e86\u4ee5\u540e\uff0c\u518d\u628a\u8fd9\u4e9b\u6587\u4ef6\u901a\u8fc7\u5185\u5b58\u6620\u5c04\uff08mmap\uff09\u7684\u65b9\u5f0f\u6620\u5c04\u5230 Redis \u7684\u8fdb\u7a0b\u7a7a\u95f4 \u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a Redis \u63a5\u6536\u5230\u7684\u6570\u636e\u76f4\u63a5\u4fdd\u5b58\u5230\u6620\u5c04\u7684\u5185\u5b58\u7a7a\u95f4\u4e0a\u4e86\uff0c\u800c\u8fd9\u5757\u5185\u5b58\u7a7a\u95f4\u662f\u7531 PM \u63d0\u4f9b\u7684\u3002\u6240\u4ee5\uff0c\u6570\u636e\u5199\u5165\u8fd9\u5757\u7a7a\u95f4\u65f6\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u88ab\u6301\u4e45\u5316\u4fdd\u5b58\u4e86\u3002 \u800c\u4e14\uff0c\u5982\u679c\u8981\u4fee\u6539\u6216\u5220\u9664\u6570\u636e\uff0cPM \u672c\u8eab\u4e5f\u652f\u6301\u4ee5\u5b57\u8282\u7c92\u5ea6\u8fdb\u884c\u6570\u636e\u8bbf\u95ee\uff0c\u6240\u4ee5\uff0cRedis \u53ef\u4ee5\u76f4\u63a5\u5728 PM \u4e0a\u4fee\u6539\u6216\u5220\u9664\u6570\u636e\u3002 \u5982\u679c\u53d1\u751f\u4e86\u5b9e\u4f8b\u6545\u969c\uff0cRedis \u5b95\u673a\u4e86\uff0c\u56e0\u4e3a\u6570\u636e\u672c\u8eab\u5df2\u7ecf\u6301\u4e45\u5316\u4fdd\u5b58\u5728 PM \u4e0a\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 PM \u4e0a\u7684\u6570\u636e\u8fdb\u884c\u5b9e\u4f8b\u6062\u590d\uff0c\u800c\u4e0d\u7528\u518d\u50cf\u73b0\u5728\u7684 Redis \u90a3\u6837\uff0c\u901a\u8fc7\u52a0\u8f7d RDB \u6587\u4ef6\u6216\u662f\u91cd\u653e AOF \u65e5\u5fd7\u64cd\u4f5c\u6765\u6062\u590d\u4e86\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5feb\u901f\u7684\u6545\u969c\u6062\u590d\u3002 \u5f53\u7136\uff0c\u56e0\u4e3a PM \u7684\u8bfb\u5199\u901f\u5ea6\u6bd4 DRAM \u6162\uff0c\u6240\u4ee5\uff0c \u5982\u679c\u4f7f\u7528 PM \u6765\u8fd0\u884c Redis\uff0c\u9700\u8981\u8bc4\u4f30\u4e0b PM \u63d0\u4f9b\u7684\u8bbf\u95ee\u5ef6\u8fdf\u548c\u8bbf\u95ee\u5e26\u5bbd\uff0c\u662f\u5426\u80fd\u6ee1\u8db3\u4e1a\u52a1\u5c42\u7684\u9700\u6c42 \u3002 \u8bc4\u4f30 PM \u5e26\u5bbd\u5bf9 Redis \u4e1a\u52a1\u7684\u652f\u6491\u3002 \u5047\u8bbe\u4e1a\u52a1\u5c42\u9700\u8981\u652f\u6301 1 \u767e\u4e07 QPS\uff0c\u5e73\u5747\u6bcf\u4e2a\u8bf7\u6c42\u7684\u5927\u5c0f\u662f 2KB\uff0c\u90a3\u4e48\uff0c\u5c31\u9700\u8981\u673a\u5668\u80fd\u652f\u6301 2GB/s \u7684\u5e26\u5bbd\uff081 \u767e\u4e07\u8bf7\u6c42\u64cd\u4f5c\u6bcf\u79d2 * 2KB \u6bcf\u8bf7\u6c42 = 2GB/s\uff09\u3002\u5982\u679c\u8fd9\u4e9b\u8bf7\u6c42\u6b63\u597d\u662f\u5199\u64cd\u4f5c\u7684\u8bdd\uff0c\u90a3\u4e48\uff0c\u5355\u6839 PM \u7684\u5199\u5e26\u5bbd\u53ef\u80fd\u4e0d\u592a\u591f\u7528\u4e86\u3002 \u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u4f7f\u7528\u591a\u6839 PM \u5185\u5b58\u6761\uff0c\u6765\u652f\u6491\u9ad8\u5e26\u5bbd\u7684\u9700\u6c42\u3002\u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5207\u7247\u96c6\u7fa4\uff0c\u628a\u6570\u636e\u5206\u6563\u4fdd\u5b58\u5230\u591a\u4e2a\u5b9e\u4f8b\uff0c\u5206\u62c5\u8bbf\u95ee\u538b\u529b\u3002 \u638c\u63e1\u4e86\u7528 PM \u5c06 Redis \u6570\u636e\u76f4\u63a5\u6301\u4e45\u5316\u4fdd\u5b58\u5728\u5185\u5b58\u4e0a\u7684\u65b9\u6cd5\u3002 \u73b0\u5728\uff0c\u6211\u4eec\u65e2\u53ef\u4ee5\u5728\u5355\u4e2a\u5b9e\u4f8b\u4e0a\u4f7f\u7528\u5927\u5bb9\u91cf\u7684 PM \u4fdd\u5b58\u66f4\u591a\u7684\u4e1a\u52a1\u6570\u636e\u4e86\uff0c\u540c\u65f6\uff0c\u4e5f\u53ef\u4ee5\u5728\u5b9e\u4f8b\u6545\u969c\u540e\uff0c\u76f4\u63a5\u4f7f\u7528 PM \u4e0a\u4fdd\u5b58\u7684\u6570\u636e\u8fdb\u884c\u6545\u969c\u6062\u590d \u3002","title":"2-2 PM \u7684\u4f7f\u7528\u65b9\u6cd5"},{"location":"chap8/2redis_nvm_mem/#3","text":"NVM \u7684\u4e09\u5927\u7279\u70b9\uff1a\u6027\u80fd\u9ad8\u3001\u5bb9\u91cf\u5927\u3001\u6570\u636e\u53ef\u4ee5\u6301\u4e45\u5316\u4fdd\u5b58\u3002\u8f6f\u4ef6\u7cfb\u7edf\u53ef\u4ee5\u50cf\u8bbf\u95ee\u4f20\u7edf DRAM \u5185\u5b58\u4e00\u6837\uff0c\u8bbf\u95ee NVM \u5185\u5b58\u3002\u76ee\u524d\uff0cIntel \u5df2\u7ecf\u63a8\u51fa\u4e86 NVM \u5185\u5b58\u4ea7\u54c1 Optane AEP\u3002 \u8fd9\u6b3e NVM \u5185\u5b58\u4ea7\u54c1\u7ed9\u8f6f\u4ef6\u63d0\u4f9b\u4e86\u4e24\u79cd\u4f7f\u7528\u6a21\u5f0f\uff0c \u5206\u522b\u662f Memory \u6a21\u5f0f\u548c App Direct \u6a21\u5f0f \u3002\u5728 Memory \u6a21\u5f0f\u65f6\uff0cRedis \u53ef\u4ee5\u5229\u7528 NVM \u5bb9\u91cf\u5927\u7684\u7279\u70b9\uff0c\u5b9e\u73b0\u5927\u5bb9\u91cf\u5b9e\u4f8b\uff0c\u4fdd\u5b58\u66f4\u591a\u6570\u636e\u3002\u5728\u4f7f\u7528 App Direct \u6a21\u5f0f\u65f6\uff0cRedis \u53ef\u4ee5\u76f4\u63a5\u5728\u6301\u4e45\u5316\u5185\u5b58\u4e0a\u8fdb\u884c\u6570\u636e\u8bfb\u5199\uff0c \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cRedis \u4e0d\u7528\u518d\u4f7f\u7528 RDB \u6216 AOF \u6587\u4ef6\u4e86\uff0c\u6570\u636e\u5728\u673a\u5668\u6389\u7535\u540e\u4e5f\u4e0d\u4f1a\u4e22\u5931\u3002\u800c\u4e14\uff0c\u5b9e\u4f8b\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u6301\u4e45\u5316\u5185\u5b58\u4e0a\u7684\u6570\u636e\u8fdb\u884c\u6062\u590d\uff0c\u6062\u590d\u901f\u5ea6\u7279\u522b\u5feb\u3002 NVM \u5185\u5b58\u662f\u8fd1\u5e74\u6765\u5b58\u50a8\u8bbe\u5907\u9886\u57df\u4e2d\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u53d8\u5316\uff0c\u5b83\u65e2\u80fd\u6301\u4e45\u5316\u4fdd\u5b58\u6570\u636e\uff0c\u8fd8\u80fd\u50cf\u5185\u5b58\u4e00\u6837\u5feb\u901f\u8bbf\u95ee\uff0c\u8fd9\u5fc5\u7136\u4f1a\u7ed9\u5f53\u524d\u57fa\u4e8e DRAM \u548c\u786c\u76d8\u7684\u7cfb\u7edf\u8f6f\u4ef6\u4f18\u5316\u5e26\u6765\u65b0\u7684\u673a\u9047\u3002","title":"3\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap8/3redis_RESP/","text":"\u7b2c\u4e09\u8282 Redis\u5ba2\u6237\u7aef\u5982\u4f55\u4e0e\u670d\u52a1\u5668\u7aef\u4ea4\u6362\u547d\u4ee4\u548c\u6570\u636e RESP Redis \u670d\u52a1\u5668\u7aef\u7684\u673a\u5236\u548c\u5173\u952e\u6280\u672f\uff0c\u5f88\u5c11\u6d89\u53ca\u5230\u5ba2\u6237\u7aef\u7684\u95ee\u9898\u3002\u4f46\u662f\uff0cRedis \u91c7\u7528\u7684\u662f\u5178\u578b\u7684 client-server \uff08\u670d\u52a1\u5668\u7aef - \u5ba2\u6237\u7aef\uff09\u67b6\u6784\uff0c\u5ba2\u6237\u7aef\u4f1a\u53d1\u9001\u8bf7\u6c42\u7ed9\u670d\u52a1\u5668\u7aef\uff0c\u670d\u52a1\u5668\u7aef\u4f1a\u8fd4\u56de\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\u3002 \u5982\u679c\u8981\u5bf9 Redis \u5ba2\u6237\u7aef\u8fdb\u884c\u4e8c\u6b21\u5f00\u53d1\uff08\u6bd4\u5982\u589e\u52a0\u65b0\u7684\u547d\u4ee4\uff09\uff0c\u9700\u8981\u4e86\u89e3\u8bf7\u6c42\u548c\u54cd\u5e94\u6d89\u53ca\u7684\u547d\u4ee4\u3001\u6570\u636e\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u4f20\u8f93\u65f6\uff0c\u662f\u5982\u4f55\u7f16\u7801\u7684\u3002 Redis \u4f7f\u7528 RESP\uff08REdis Serialization Protocol\uff09\u534f\u8bae\u5b9a\u4e49\u4e86\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u4ea4\u4e92\u7684\u547d\u4ee4\u3001\u6570\u636e\u7684\u7f16\u7801\u683c\u5f0f\u3002 \u5728 Redis 2.0 \u7248\u672c\u4e2d\uff0cRESP \u534f\u8bae\u6b63\u5f0f\u6210\u4e3a\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u7684\u6807\u51c6\u901a\u4fe1\u534f\u8bae\u3002\u4ece Redis 2.0 \u5230 Redis 5.0\uff0cRESP \u534f\u8bae\u90fd\u79f0\u4e3a RESP 2 \u534f\u8bae\uff0c\u4ece Redis 6.0 \u5f00\u59cb\uff0cRedis \u5c31\u91c7\u7528 RESP 3 \u534f\u8bae\u4e86\u3002\u4e0d\u8fc7\uff0c6.0 \u7248\u672c\u662f\u5728\u4eca\u5e74 5 \u6708\u521a\u63a8\u51fa\u7684\uff0c\u6240\u4ee5\uff0c\u76ee\u524d\u6211\u4eec\u5e7f\u6cdb\u4f7f\u7528\u7684\u8fd8\u662f RESP 2 \u534f\u8bae\u3002 1\u3001\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u4ea4\u4e92\u7684\u5185\u5bb9\u6709\u54ea\u4e9b\uff1f RESP 2 \u534f\u8bae\u662f\u5982\u4f55\u5bf9\u547d\u4ee4\u548c\u6570\u636e\u8fdb\u884c\u683c\u5f0f\u7f16\u7801\u7684\uff0c\u4ee5\u628a\u4ea4\u4e92\u5185\u5bb9\uff0c\u5206\u6210\u5ba2\u6237\u7aef\u8bf7\u6c42\u548c\u670d\u52a1\u5668\u7aef\u54cd\u5e94\u4e24\u7c7b\uff1a \u5728\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e2d\uff0c\u5ba2\u6237\u7aef\u4f1a\u7ed9 Redis \u53d1\u9001\u547d\u4ee4\uff0c\u4ee5\u53ca\u8981\u5199\u5165\u7684\u952e\u548c\u503c\uff1b \u800c\u5728\u670d\u52a1\u5668\u7aef\u54cd\u5e94\u4e2d\uff0cRedis \u5b9e\u4f8b\u4f1a\u8fd4\u56de\u8bfb\u53d6\u7684\u503c\u3001OK \u6807\u8bc6\u3001\u6210\u529f\u5199\u5165\u7684\u5143\u7d20\u4e2a\u6570\u3001\u9519\u8bef\u4fe1\u606f\uff0c\u4ee5\u53ca\u547d\u4ee4\uff08\u4f8b\u5982 Redis Cluster \u4e2d\u7684 MOVE \u547d\u4ee4\uff09\u3002 \u5176\u5b9e\uff0c\u8fd9\u4e9b\u4ea4\u4e92\u5185\u5bb9\u8fd8\u53ef\u4ee5\u518d\u8fdb\u4e00\u6b65\u7ec6\u5206\u6210\u4e03\u7c7b\u3002 \u547d\u4ee4 \uff1a\u8fd9\u5c31\u662f\u9488\u5bf9\u4e0d\u540c\u6570\u636e\u7c7b\u578b\u7684\u64cd\u4f5c\u547d\u4ee4\u3002\u4f8b\u5982\u5bf9 String \u7c7b\u578b\u7684 SET\u3001GET \u64cd\u4f5c\uff0c\u5bf9 Hash \u7c7b\u578b\u7684 HSET\u3001HGET \u7b49\uff0c\u8fd9\u4e9b\u547d\u4ee4\u5c31\u662f\u4ee3\u8868\u64cd\u4f5c\u8bed\u4e49\u7684\u5b57\u7b26\u4e32\u3002 \u952e \uff1a\u952e\u503c\u5bf9\u4e2d\u7684\u952e\uff0c\u53ef\u4ee5\u76f4\u63a5\u7528\u5b57\u7b26\u4e32\u8868\u793a\u3002 \u5355\u4e2a\u503c \uff1a\u5bf9\u5e94 String \u7c7b\u578b\u7684\u6570\u636e\uff0c\u6570\u636e\u672c\u8eab\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u3001\u6570\u503c\uff08\u6574\u6570\u6216\u6d6e\u70b9\u6570\uff09\uff0c\u5e03\u5c14\u503c\uff08True \u6216\u662f False\uff09\u7b49\u3002 \u96c6\u5408\u503c \uff1a\u5bf9\u5e94 List\u3001Hash\u3001Set\u3001Sorted Set \u7c7b\u578b\u7684\u6570\u636e\uff0c\u4e0d\u4ec5\u5305\u542b\u591a\u4e2a\u503c\uff0c\u800c\u4e14\u6bcf\u4e2a\u503c\u4e5f\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u3001\u6570\u503c\u6216\u5e03\u5c14\u503c\u7b49\u3002 OK \u56de\u590d \uff1a\u5bf9\u5e94\u547d\u4ee4\u64cd\u4f5c\u6210\u529f\u7684\u7ed3\u679c\uff0c\u5c31\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u201cOK\u201d\u3002 \u6574\u6570\u56de\u590d \uff1a\u8fd9\u91cc\u6709\u4e24\u79cd\u60c5\u51b5\u3002 \u4e00\u79cd\u662f\uff0c\u547d\u4ee4\u64cd\u4f5c\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u6574\u6570\uff0c\u4f8b\u5982 LLEN \u547d\u4ee4\u8fd4\u56de\u5217\u8868\u7684\u957f\u5ea6\uff1b \u53e6\u4e00\u79cd\u662f\uff0c\u96c6\u5408\u547d\u4ee4\u6210\u529f\u64cd\u4f5c\u65f6\uff0c\u5b9e\u9645\u64cd\u4f5c\u7684\u5143\u7d20\u4e2a\u6570\uff0c\u4f8b\u5982 SADD \u547d\u4ee4\u8fd4\u56de\u6210\u529f\u6dfb\u52a0\u7684\u5143\u7d20\u4e2a\u6570\u3002 \u9519\u8bef\u4fe1\u606f \uff1a\u547d\u4ee4\u64cd\u4f5c\u51fa\u9519\u65f6\u7684\u8fd4\u56de\u7ed3\u679c\uff0c\u5305\u62ec\u201cerror\u201d\u6807\u8bc6\uff0c\u4ee5\u53ca\u5177\u4f53\u7684\u9519\u8bef\u4fe1\u606f\u3002 \u5148\u770b\u7b2c\u4e00\u4e2a\u4f8b\u5b50\uff0c\u6765\u770b\u770b\u4e0b\u9762\u7684\u547d\u4ee4\uff1a #\u6210\u529f\u5199\u5165String\u7c7b\u578b\u6570\u636e\uff0c\u8fd4\u56deOK 127.0.0.1:6379> SET testkey testvalue OK \u8fd9\u91cc\u7684\u4ea4\u4e92\u5185\u5bb9\u5c31\u5305\u62ec\u4e86 \u547d\u4ee4\uff08SET \u547d\u4ee4\uff09\u3001\u952e\uff08String \u7c7b\u578b\u7684\u952e testkey\uff09\u548c\u5355\u4e2a\u503c\uff08String \u7c7b\u578b\u7684\u503c testvalue\uff09\uff0c\u800c\u670d\u52a1\u5668\u7aef\u5219\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a OK \u56de\u590d \u3002 \u7b2c\u4e8c\u4e2a\u4f8b\u5b50\u662f\u6267\u884c HSET \u547d\u4ee4\uff1a #\u6210\u529f\u5199\u5165Hash\u7c7b\u578b\u6570\u636e\uff0c\u8fd4\u56de\u5b9e\u9645\u5199\u5165\u7684\u96c6\u5408\u5143\u7d20\u4e2a\u6570 127.0.0.1:6379>HSET testhash a 1 b 2 c 3 (integer) 3 \u8fd9\u91cc\u7684\u4ea4\u4e92\u5185\u5bb9\u5305\u62ec\u4e09\u4e2a key-value \u7684 Hash\u96c6\u5408\u503c\uff08a 1 b 2 c 3\uff09 \uff0c\u800c\u670d\u52a1\u5668\u7aef\u8fd4\u56de \u6574\u6570\u56de\u590d\uff083\uff09 \uff0c\u8868\u793a\u64cd\u4f5c\u6210\u529f\u5199\u5165\u7684\u5143\u7d20\u4e2a\u6570\u3002 \u6700\u540e\u4e00\u4e2a\u4f8b\u5b50\u662f\u6267\u884c PUT \u547d\u4ee4\uff0c\u5982\u4e0b\u6240\u793a\uff1a #\u53d1\u9001\u7684\u547d\u4ee4\u4e0d\u5bf9\uff0c\u62a5\u9519\uff0c\u5e76\u8fd4\u56de\u9519\u8bef\u4fe1\u606f 127.0.0.1:6379>PUT testkey2 testvalue (error) ERR unknown command 'PUT', with args beginning with: 'testkey', 'testvalue' \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u7684\u4ea4\u4e92\u5185\u5bb9\u5305\u62ec\u9519\u8bef\u4fe1\u606f\uff0c\u8fd9\u662f\u56e0\u4e3a\uff0c Redis \u5b9e\u4f8b\u672c\u8eab\u4e0d\u652f\u6301 PUT \u547d\u4ee4\uff0c\u6240\u4ee5\u670d\u52a1\u5668\u7aef\u62a5\u9519\u201cerror\u201d\uff0c\u5e76\u8fd4\u56de\u5177\u4f53\u7684\u9519\u8bef\u4fe1\u606f\uff0c\u4e5f\u5c31\u662f\u672a\u77e5\u7684\u547d\u4ee4\u201cput\u201d\u3002 2\u3001RESP 2 \u7684\u7f16\u7801\u683c\u5f0f\u89c4\u8303 RESP 2 \u534f\u8bae\u7684\u8bbe\u8ba1\u76ee\u6807\u662f\uff0c\u5e0c\u671b Redis \u5f00\u53d1\u4eba\u5458\u5b9e\u73b0\u5ba2\u6237\u7aef\u65f6\u7b80\u5355\u65b9\u4fbf\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u51cf\u5c11\u5ba2\u6237\u7aef\u5f00\u53d1\u65f6\u51fa\u73b0\u7684 Bug\u3002\u800c\u4e14\uff0c\u5f53\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u4ea4\u4e92\u51fa\u73b0\u95ee\u9898\u65f6\uff0c\u5e0c\u671b\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b\u534f\u8bae\u4ea4\u4e92\u8fc7\u7a0b\uff0c\u80fd\u5feb\u901f\u5b9a\u4f4d\u95ee\u9898\uff0c\u65b9\u4fbf\u8c03\u8bd5\u3002\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e00\u76ee\u6807\uff0cRESP 2 \u534f\u8bae\u91c7\u7528\u4e86\u53ef\u8bfb\u6027\u5f88\u597d\u7684\u6587\u672c\u5f62\u5f0f\u8fdb\u884c\u7f16\u7801\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u4e00\u7cfb\u5217\u7684\u5b57\u7b26\u4e32\uff0c\u6765\u8868\u793a\u5404\u79cd\u547d\u4ee4\u548c\u6570\u636e\u3002 \u4e0d\u8fc7\uff0c\u4ea4\u4e92\u5185\u5bb9\u6709\u591a\u79cd\uff0c\u800c\u4e14\uff0c\u5b9e\u9645\u4f20\u8f93\u7684\u547d\u4ee4\u6216\u6570\u636e\u4e5f\u4f1a\u6709\u5f88\u591a\u4e2a\u3002 \u9488\u5bf9\u8fd9\u4e24\u79cd\u60c5\u51b5\uff0cRESP 2 \u534f\u8bae\u5728\u7f16\u7801\u65f6\u8bbe\u8ba1\u4e86\u4e24\u4e2a\u57fa\u672c\u89c4\u8303\u3002 \u4e3a\u4e86\u5bf9\u4e0d\u540c\u7c7b\u578b\u7684\u4ea4\u4e92\u5185\u5bb9\u8fdb\u884c\u7f16\u7801\uff0cRESP 2 \u534f\u8bae\u5b9e\u73b0\u4e86 5 \u79cd\u7f16\u7801\u683c\u5f0f\u7c7b\u578b\u3002\u540c\u65f6\uff0c\u4e3a\u4e86\u533a\u5206\u8fd9 5 \u79cd\u7f16\u7801\u7c7b\u578b\uff0cRESP 2 \u4f7f\u7528\u4e00\u4e2a\u4e13\u95e8\u7684\u5b57\u7b26\uff0c\u4f5c\u4e3a\u6bcf\u79cd\u7f16\u7801\u7c7b\u578b\u7684\u5f00\u5934\u5b57\u7b26\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5ba2\u6237\u7aef\u6216\u670d\u52a1\u5668\u7aef\u5728\u5bf9\u7f16\u7801\u540e\u7684\u6570\u636e\u8fdb\u884c\u89e3\u6790\u65f6\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u5f00\u5934\u5b57\u7b26\u77e5\u9053\u5f53\u524d\u89e3\u6790\u7684\u7f16\u7801\u7c7b\u578b\u3002 RESP 2 \u8fdb\u884c\u7f16\u7801\u65f6\uff0c\u4f1a\u6309\u7167\u5355\u4e2a\u547d\u4ee4\u6216\u5355\u4e2a\u6570\u636e\u7684\u7c92\u5ea6\u8fdb\u884c\u7f16\u7801\uff0c\u5e76\u5728\u6bcf\u4e2a\u7f16\u7801\u7ed3\u679c\u540e\u9762\u589e\u52a0\u4e00\u4e2a\u6362\u884c\u7b26 \u201c\\r\\n\u201d \uff08\u6709\u65f6\u4e5f\u8868\u793a\u6210 CRLF\uff09\uff0c\u8868\u793a\u4e00\u6b21\u7f16\u7801\u7ed3\u675f\u3002 \u4ecb\u7ecd\u4e0b\u8fd9 5 \u79cd\u7f16\u7801\u7c7b\u578b 2-1 \u7b80\u5355\u5b57\u7b26\u4e32\u7c7b\u578b\uff08RESP Simple Strings\uff09 \u8fd9\u79cd\u7c7b\u578b\u5c31\u662f\u7528\u4e00\u4e2a\u5b57\u7b26\u4e32\u6765\u8fdb\u884c\u7f16\u7801\uff0c\u6bd4\u5982\uff0c\u8bf7\u6c42\u64cd\u4f5c\u5728\u670d\u52a1\u5668\u7aef\u6210\u529f\u6267\u884c\u540e\u7684 OK \u6807\u8bc6\u56de\u590d\uff0c\u5c31\u662f\u7528\u8fd9\u79cd\u7c7b\u578b\u8fdb\u884c\u7f16\u7801\u7684\u3002 \u5f53\u670d\u52a1\u5668\u7aef\u6210\u529f\u6267\u884c\u4e00\u4e2a\u64cd\u4f5c\u540e\uff0c\u8fd4\u56de\u7684 OK \u6807\u8bc6\u5c31\u53ef\u4ee5\u7f16\u7801\u5982\u4e0b\uff1a +OK\\r\\n 2-2 \u957f\u5b57\u7b26\u4e32\u7c7b\u578b\uff08RESP Bulk String) \u8fd9\u79cd\u7c7b\u578b\u662f\u7528\u4e00\u4e2a\u4e8c\u8fdb\u5236\u5b89\u5168\u7684\u5b57\u7b26\u4e32\u6765\u8fdb\u884c\u7f16\u7801\u3002\u8fd9\u91cc\u7684\u4e8c\u8fdb\u5236\u5b89\u5168\uff0c\u5176\u5b9e\u662f\u76f8\u5bf9\u4e8e C \u8bed\u8a00\u4e2d\u5bf9\u5b57\u7b26\u4e32\u7684\u5904\u7406\u65b9\u5f0f\u6765\u8bf4\u7684\u3002 Redis \u5728\u89e3\u6790\u5b57\u7b26\u4e32\u65f6\uff0c\u4e0d\u4f1a\u50cf C \u8bed\u8a00\u90a3\u6837\uff0c\u4f7f\u7528 \u201c\\0\u201d \u5224\u5b9a\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u7ed3\u5c3e\uff0cRedis \u4f1a\u628a \u201c\\0\u201d \u89e3\u6790\u6210\u6b63\u5e38\u7684 0 \u5b57\u7b26\uff0c\u5e76\u4f7f\u7528\u989d\u5916\u7684\u5c5e\u6027\u503c\u8868\u793a\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5bf9\u4e8e \u201cRedis\\0Cluster\\0\u201d \u8fd9\u4e2a\u5b57\u7b26\u4e32\u6765\u8bf4\uff0cC \u8bed\u8a00\u4f1a\u89e3\u6790\u4e3a\u201cRedis\u201d\uff0c\u800c Redis \u4f1a\u89e3\u6790\u4e3a\u201cRedis Cluster\u201d\uff0c\u5e76\u7528 len \u5c5e\u6027\u8868\u793a\u5b57\u7b26\u4e32\u7684\u771f\u5b9e\u957f\u5ea6\u662f 14 \u5b57\u8282\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u8fd9\u6837\u4e00\u6765\uff0c\u5b57\u7b26\u4e32\u4e2d\u5373\u4f7f\u5b58\u50a8\u4e86\u201c\\0\u201d\u5b57\u7b26\uff0c\u4e5f\u4e0d\u4f1a\u5bfc\u81f4 Redis \u89e3\u6790\u5230\u201c\\0\u201d\u65f6\uff0c\u5c31\u8ba4\u4e3a\u5b57\u7b26\u4e32\u7ed3\u675f\u4e86\u4ece\u800c\u505c\u6b62\u89e3\u6790\uff0c\u8fd9\u5c31\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u5b89\u5168\u6027\u3002\u548c\u957f\u5b57\u7b26\u4e32\u7c7b\u578b\u76f8\u6bd4\uff0c\u7b80\u5355\u5b57\u7b26\u4e32\u5c31\u662f\u975e\u4e8c\u8fdb\u5236\u5b89\u5168\u7684\u3002 \u957f\u5b57\u7b26\u4e32\u7c7b\u578b\u6700\u5927\u53ef\u4ee5\u8fbe\u5230 512MB\uff0c\u6240\u4ee5\u53ef\u4ee5\u5bf9\u5f88\u5927\u7684\u6570\u636e\u91cf\u8fdb\u884c\u7f16\u7801\uff0c\u6b63\u597d\u53ef\u4ee5\u6ee1\u8db3\u952e\u503c\u5bf9\u672c\u8eab\u7684\u6570\u636e\u91cf\u9700\u6c42\uff0c\u6240\u4ee5\uff0cRESP 2 \u5c31\u7528\u8fd9\u79cd\u7c7b\u578b\u5bf9\u4ea4\u4e92\u5185\u5bb9\u4e2d\u7684\u952e\u6216\u503c\u8fdb\u884c\u7f16\u7801\uff0c\u5e76\u4e14\u4f7f\u7528 \u201c$\u201d \u5b57\u7b26\u4f5c\u4e3a\u5f00\u5934\u5b57\u7b26\uff0c $ \u5b57\u7b26\u540e\u9762\u4f1a\u7d27\u8ddf\u7740\u4e00\u4e2a\u6570\u5b57\uff0c\u8fd9\u4e2a\u6570\u5b57\u8868\u793a\u5b57\u7b26\u4e32\u7684\u5b9e\u9645\u957f\u5ea6\u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u4f7f\u7528 GET \u547d\u4ee4\u8bfb\u53d6\u4e00\u4e2a\u952e\uff08\u5047\u8bbe\u952e\u4e3a testkey \uff09\u7684\u503c\uff08\u5047\u8bbe\u503c\u4e3a testvalue \uff09\u65f6\uff0c\u670d\u52a1\u7aef\u8fd4\u56de\u7684 String \u503c\u7f16\u7801\u7ed3\u679c\u5982\u4e0b\uff0c\u5176\u4e2d \uff0c $ \u5b57\u7b26\u540e\u7684 9\uff0c\u8868\u793a\u6570\u636e\u957f\u5ea6\u4e3a 9 \u4e2a\u5b57\u7b26\u3002 $9 testvalue\\r\\n 2-3 \u6574\u6570\u7c7b\u578b\uff08RESP Integer\uff09 \u8fd9\u79cd\u7c7b\u578b\u4e5f\u8fd8\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u4f46\u662f\u8868\u793a\u7684\u662f\u4e00\u4e2a\u6709\u7b26\u53f7 64 \u4f4d\u6574\u6570\u3002\u4e3a\u4e86\u548c\u5305\u542b\u6570\u5b57\u7684\u7b80\u5355\u5b57\u7b26\u4e32\u7c7b\u578b\u533a\u5206\u5f00\uff0c\u6574\u6570\u7c7b\u578b\u4f7f\u7528 \u201c:\u201d \u5b57\u7b26\u4f5c\u4e3a\u5f00\u5934\u5b57\u7b26\uff0c\u53ef\u4ee5\u7528\u4e8e\u5bf9\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u7684\u6574\u6570\u56de\u590d\u8fdb\u884c\u7f16\u7801\u3002 \u4f8b\u5982\uff0c\u5728\u521a\u624d\u4ecb\u7ecd\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528 HSET \u547d\u4ee4\u8bbe\u7f6e\u4e86 testhash \u7684\u4e09\u4e2a\u5143\u7d20\uff0c\u670d\u52a1\u5668\u7aef\u5b9e\u9645\u8fd4\u56de\u7684\u7f16\u7801\u7ed3\u679c\u5982\u4e0b\uff1a :3\\r\\n 2-4 \u9519\u8bef\u7c7b\u578b\uff08RESP Errors\uff09 \u5b83\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5305\u62ec\u4e86\u9519\u8bef\u7c7b\u578b\u548c\u5177\u4f53\u7684\u9519\u8bef\u4fe1\u606f\u3002Redis \u670d\u52a1\u5668\u7aef\u62a5\u9519\u54cd\u5e94\u5c31\u662f\u7528\u8fd9\u79cd\u7c7b\u578b\u8fdb\u884c\u7f16\u7801\u7684\u3002RESP 2 \u4f7f\u7528 \u201c-\u201d \u5b57\u7b26\u4f5c\u4e3a\u5b83\u7684\u5f00\u5934\u5b57\u7b26\u3002 \u4f8b\u5982\uff0c\u5728\u521a\u624d\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u5728 redis-cli \u6267\u884c PUT testkey2 testvalue \u547d\u4ee4\u62a5\u9519\uff0c\u670d\u52a1\u5668\u7aef\u5b9e\u9645\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u62a5\u9519\u7f16\u7801\u7ed3\u679c\u5982\u4e0b\uff1a -ERR unknown command `PUT`, with args beginning with: `testkey`, `testvalue` \u5176\u4e2d\uff0cERR \u5c31\u662f\u62a5\u9519\u7c7b\u578b\uff0c\u8868\u793a\u662f\u4e00\u4e2a\u901a\u7528\u9519\u8bef\uff0cERR \u540e\u9762\u7684\u6587\u5b57\u5185\u5bb9\u5c31\u662f\u5177\u4f53\u7684\u62a5\u9519\u4fe1\u606f\u3002 2-5 \u6570\u7ec4\u7f16\u7801\u7c7b\u578b\uff08RESP Arrays\uff09 \u8fd9\u662f\u4e00\u4e2a\u5305\u542b\u591a\u4e2a\u5143\u7d20\u7684\u6570\u7ec4\uff0c\u5176\u4e2d\uff0c\u5143\u7d20\u7684\u7c7b\u578b\u53ef\u4ee5\u662f\u521a\u624d\u4ecb\u7ecd\u7684\u8fd9 4 \u79cd\u7f16\u7801\u7c7b\u578b\u3002 \u5728\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u548c\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u7ed3\u679c\u65f6\uff0c\u6570\u7ec4\u7f16\u7801\u7c7b\u578b\u90fd\u80fd\u7528\u5f97\u4e0a\u3002\u5ba2\u6237\u7aef\u5728\u53d1\u9001\u8bf7\u6c42\u64cd\u4f5c\u65f6\uff0c\u4e00\u822c\u4f1a\u540c\u65f6\u5305\u62ec\u547d\u4ee4\u548c\u8981\u64cd\u4f5c\u7684\u6570\u636e\u3002\u800c\u6570\u7ec4\u7c7b\u578b\u5305\u542b\u4e86\u591a\u4e2a\u5143\u7d20\uff0c\u6240\u4ee5\uff0c\u5c31\u9002\u5408\u7528\u6765\u5bf9\u53d1\u9001\u7684\u547d\u4ee4\u548c\u6570\u636e\u8fdb\u884c\u7f16\u7801\u3002 \u4e3a\u4e86\u548c\u5176\u4ed6\u7c7b\u578b\u533a\u5206\uff0cRESP 2 \u4f7f\u7528 \u201c*\u201d \u5b57\u7b26\u4f5c\u4e3a\u5f00\u5934\u5b57\u7b26\u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u547d\u4ee4 GET testkey\uff0c\u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7aef\u7684\u547d\u4ee4\u7684\u7f16\u7801\u7ed3\u679c\u5c31\u662f\u4f7f\u7528\u6570\u7ec4\u7c7b\u578b\u7f16\u7801\u7684\uff0c\u5982\u4e0b\u6240\u793a\uff1a *2\\r\\n$3\\r\\nGET\\r\\n$7\\r\\ntestkey\\r\\n \u5176\u4e2d\uff0c\u7b2c\u4e00\u4e2a * \u5b57\u7b26\u6807\u8bc6\u5f53\u524d\u662f\u6570\u7ec4\u7c7b\u578b\u7684\u7f16\u7801\u7ed3\u679c\uff0c2 \u8868\u793a\u8be5\u6570\u7ec4\u6709 2 \u4e2a\u5143\u7d20\uff0c\u5206\u522b\u5bf9\u5e94\u547d\u4ee4 GET \u548c\u952e testkey \u3002\u547d\u4ee4 GET \u548c\u952e testkey\uff0c\u90fd\u662f\u4f7f\u7528\u957f\u5b57\u7b26\u4e32\u7c7b\u578b\u7f16\u7801\u7684\uff0c\u6240\u4ee5\u7528 $ \u5b57\u7b26\u52a0\u5b57\u7b26\u4e32\u957f\u5ea6\u6765\u8868\u793a\u3002 \u7c7b\u4f3c\u5730\uff0c\u5f53\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u5305\u542b\u591a\u4e2a\u5143\u7d20\u7684\u96c6\u5408\u7c7b\u578b\u6570\u636e\u65f6\uff0c\u4e5f\u4f1a\u7528 * \u5b57\u7b26\u548c\u5143\u7d20\u4e2a\u6570\u4f5c\u4e3a\u6807\u8bc6\uff0c\u5e76\u7528\u957f\u5b57\u7b26\u4e32\u7c7b\u578b\u5bf9\u8fd4\u56de\u7684\u96c6\u5408\u5143\u7d20\u8fdb\u884c\u7f16\u7801\u3002 \u597d\u4e86\uff0c\u5230\u8fd9\u91cc\uff0c\u4f60\u4e86\u89e3\u4e86 RESP 2 \u534f\u8bae\u7684 5 \u79cd\u7f16\u7801\u7c7b\u578b\u548c\u76f8\u5e94\u7684\u5f00\u5934\u5b57\u7b26 Redis 6.0 \u4e2d\u4f7f\u7528\u4e86 RESP 3 \u534f\u8bae\uff0c\u5bf9 RESP 2.0 \u505a\u4e86\u6539\u8fdb 3\u3001RESP 2 \u7684\u4e0d\u8db3\u548c RESP 3 \u7684\u6539\u8fdb \u867d\u7136\u6211\u4eec\u521a\u521a\u8bf4 RESP 2 \u534f\u8bae\u63d0\u4f9b\u4e86 5 \u79cd\u7f16\u7801\u7c7b\u578b\uff0c\u770b\u8d77\u6765\u5f88\u4e30\u5bcc\uff0c\u5176\u5b9e\u662f\u4e0d\u591f\u7684\u3002 \u6bd5\u7adf\uff0c\u57fa\u672c\u6570\u636e\u7c7b\u578b\u8fd8\u5305\u62ec\u5f88\u591a\u79cd\uff0c\u4f8b\u5982\u6d6e\u70b9\u6570\u3001\u5e03\u5c14\u503c\u7b49\u3002\u7f16\u7801\u7c7b\u578b\u504f\u5c11\uff0c\u4f1a\u5e26\u6765\u4e24\u4e2a\u95ee\u9898\u3002 \u4e00\u65b9\u9762\uff0c\u5728\u503c\u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b\u65b9\u9762\uff0c RESP 2 \u53ea\u80fd\u533a\u5206\u5b57\u7b26\u4e32\u548c\u6574\u6570\uff0c\u5bf9\u4e8e\u5176\u4ed6\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5ba2\u6237\u7aef\u4f7f\u7528 RESP 2 \u534f\u8bae\u65f6\uff0c\u5c31\u9700\u8981\u8fdb\u884c\u989d\u5916\u7684\u8f6c\u6362\u64cd\u4f5c \u3002\u4f8b\u5982\uff0c\u5f53\u4e00\u4e2a\u6d6e\u70b9\u6570\u7528\u5b57\u7b26\u4e32\u8868\u793a\u65f6\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u5c06\u5b57\u7b26\u4e32\u4e2d\u7684\u503c\u548c\u5b9e\u9645\u6570\u5b57\u503c\u6bd4\u8f83\uff0c\u5224\u65ad\u662f\u5426\u4e3a\u6570\u5b57\u503c\uff0c\u7136\u540e\u518d\u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u6210\u5b9e\u9645\u7684\u6d6e\u70b9\u6570\u3002 \u53e6\u4e00\u65b9\u9762\uff0c RESP 2 \u7528\u6570\u7ec4\u7c7b\u522b\u7f16\u7801\u8868\u793a\u6240\u6709\u7684\u96c6\u5408\u7c7b\u578b\uff0c\u4f46\u662f\uff0cRedis \u7684\u96c6\u5408\u7c7b\u578b\u5305\u62ec\u4e86 List\u3001Hash\u3001Set \u548c Sorted Set\u3002 \u5f53\u5ba2\u6237\u7aef\u63a5\u6536\u5230\u6570\u7ec4\u7c7b\u578b\u7f16\u7801\u7684\u7ed3\u679c\u65f6\uff0c\u8fd8\u9700\u8981\u6839\u636e\u8c03\u7528\u7684\u547d\u4ee4\u64cd\u4f5c\u63a5\u53e3\uff0c\u6765\u5224\u65ad\u8fd4\u56de\u7684\u6570\u7ec4\u7a76\u7adf\u662f\u54ea\u4e00\u79cd\u96c6\u5408\u7c7b\u578b\u3002 \u5047\u8bbe\u6709\u4e00\u4e2a Hash \u7c7b\u578b\u7684\u952e\u662f testhash\uff0c\u96c6\u5408\u5143\u7d20\u5206\u522b\u4e3a a:1\u3001b:2\u3001c:3\u3002\u540c\u65f6\uff0c\u6709\u4e00\u4e2a Sorted Set \u7c7b\u578b\u7684\u952e\u662f testzset\uff0c\u96c6\u5408\u5143\u7d20\u5206\u522b\u662f a\u3001b\u3001c\uff0c\u5b83\u4eec\u7684\u5206\u6570\u5206\u522b\u662f 1\u30012\u30013\u3002\u6211\u4eec\u5728 redis-cli \u5ba2\u6237\u7aef\u4e2d\u8bfb\u53d6\u5b83\u4eec\u7684\u7ed3\u679c\u65f6\uff0c\u8fd4\u56de\u7684\u5f62\u5f0f\u90fd\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u5982\u4e0b\u6240\u793a\uff1a 127.0.0.1:6379>HGETALL testhash 1) \"a\" 2) \"1\" 3) \"b\" 4) \"2\" 5) \"c\" 6) \"3\" 127.0.0.1:6379>ZRANGE testzset 0 3 withscores 1) \"a\" 2) \"1\" 3) \"b\" 4) \"2\" 5) \"c\" 6) \"3\" \u4e3a\u4e86\u5728\u5ba2\u6237\u7aef\u6309\u7167 Hash \u548c Sorted Set \u4e24\u79cd\u7c7b\u578b\u5904\u7406\u4ee3\u7801\u4e2d\u8fd4\u56de\u7684\u6570\u636e\uff0c\u5ba2\u6237\u7aef\u8fd8\u9700\u8981\u6839\u636e\u53d1\u9001\u7684\u547d\u4ee4\u64cd\u4f5c HGETALL \u548c ZRANGE\uff0c\u6765\u628a\u8fd9\u4e24\u4e2a\u7f16\u7801\u7684\u6570\u7ec4\u7ed3\u679c\u8f6c\u6362\u6210\u76f8\u5e94\u7684 Hash \u96c6\u5408\u548c\u6709\u5e8f\u96c6\u5408\uff0c\u589e\u52a0\u4e86\u5ba2\u6237\u7aef\u989d\u5916\u7684\u5f00\u9500\u3002 4\u3001\u672c\u7ae0\u5c0f\u7ed3 RESP 2 \u534f\u8bae\u5b9a\u4e49\u4e86 Redis \u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u8fdb\u884c\u547d\u4ee4\u548c\u6570\u636e\u4ea4\u4e92\u65f6\u7684\u7f16\u7801\u683c\u5f0f\u3002RESP 2 \u63d0\u4f9b\u4e86 5 \u79cd\u7c7b\u578b\u7684\u7f16\u7801\u683c\u5f0f\uff0c\u5305\u62ec\u7b80\u5355\u5b57\u7b26\u4e32\u7c7b\u578b\u3001\u957f\u5b57\u7b26\u4e32\u7c7b\u578b\u3001\u6574\u6570\u7c7b\u578b\u3001\u9519\u8bef\u7c7b\u578b\u548c\u6570\u7ec4\u7c7b\u578b\u3002\u4e3a\u4e86\u533a\u5206\u8fd9 5 \u79cd\u7c7b\u578b\uff0cRESP 2 \u534f\u8bae\u4f7f\u7528\u4e86 5 \u79cd\u4e0d\u540c\u7684\u5b57\u7b26\u4f5c\u4e3a\u8fd9 5 \u79cd\u7c7b\u578b\u7f16\u7801\u7ed3\u679c\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\uff0c\u5206\u522b\u662f +\u3001 $\u3001:\u3001- \u548c * \u3002 RESP 2 \u534f\u8bae\u662f\u6587\u672c\u5f62\u5f0f\u7684\u534f\u8bae\uff0c\u5b9e\u73b0\u7b80\u5355\uff0c\u53ef\u4ee5\u51cf\u5c11\u5ba2\u6237\u7aef\u5f00\u53d1\u51fa\u73b0\u7684 Bug\uff0c\u800c\u4e14\u53ef\u8bfb\u6027\u5f3a\uff0c\u4fbf\u4e8e\u5f00\u53d1\u8c03\u8bd5\u3002\u5f53\u4f60\u9700\u8981\u5f00\u53d1\u5b9a\u5236\u5316\u7684 Redis \u5ba2\u6237\u7aef\u65f6\uff0c\u5c31\u9700\u8981\u4e86\u89e3\u548c\u638c\u63e1 RESP 2 \u534f\u8bae\u3002 RESP 2 \u534f\u8bae\u7684\u4e00\u4e2a\u4e0d\u8db3\u5c31\u662f\u652f\u6301\u7684\u7c7b\u578b\u504f\u5c11\uff0c\u6240\u4ee5\uff0cRedis 6.0 \u7248\u672c\u4f7f\u7528\u4e86 RESP 3 \u534f\u8bae\u3002\u548c RESP 2 \u534f\u8bae\u76f8\u6bd4\uff0c RESP 3 \u534f\u8bae\u589e\u52a0\u4e86\u5bf9\u6d6e\u70b9\u6570\u3001\u5e03\u5c14\u7c7b\u578b\u3001\u6709\u5e8f\u5b57\u5178\u96c6\u5408\u3001\u65e0\u5e8f\u96c6\u5408\u7b49\u591a\u79cd\u7c7b\u578b\u6570\u636e\u7684\u652f\u6301 \u3002\u4e0d\u8fc7\uff0c\u8fd9\u91cc\uff0c\u6709\u4e2a\u5730\u65b9\u9700\u8981\u4f60\u6ce8\u610f\uff0cRedis 6.0 \u53ea\u652f\u6301 RESP 3\uff0c\u5bf9 RESP 2 \u534f\u8bae\u4e0d\u517c\u5bb9\uff0c\u6240\u4ee5\uff0c \u5982\u679c\u4f60\u4f7f\u7528 Redis 6.0 \u7248\u672c\uff0c\u9700\u8981\u786e\u8ba4\u5ba2\u6237\u7aef\u5df2\u7ecf\u652f\u6301\u4e86 RESP 3 \u534f\u8bae\uff0c\u5426\u5219\uff0c\u5c06\u65e0\u6cd5\u4f7f\u7528 Redis 6.0\u3002 \u6700\u540e\uff0c\u6211\u4e5f\u7ed9\u4f60\u63d0\u4f9b\u4e00\u4e2a\u5c0f\u5de5\u5177\u3002\u5982\u679c\u4f60\u60f3\u67e5\u770b\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u6570\u636e\u7684 RESP 2 \u7f16\u7801\u7ed3\u679c\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 telnet \u547d\u4ee4\u548c redis \u5b9e\u4f8b\u8fde\u63a5\uff0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5c31\u884c\uff1a telnet \u5b9e\u4f8bIP \u5b9e\u4f8b\u7aef\u53e3 \u53ef\u4ee5\u7ed9\u5b9e\u4f8b\u53d1\u9001\u547d\u4ee4\uff0c\u8fd9\u6837\u5c31\u80fd\u770b\u5230\u7528 RESP 2 \u534f\u8bae\u7f16\u7801\u540e\u7684\u8fd4\u56de\u7ed3\u679c\u4e86\u3002\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u5728 telnet \u4e2d\uff0c\u5411 Redis \u5b9e\u4f8b\u53d1\u9001\u7528 RESP 2 \u534f\u8bae\u7f16\u5199\u7684\u547d\u4ee4\u64cd\u4f5c\u3002","title":"\u7b2c\u4e09\u8282 Redis\u5ba2\u6237\u7aef\u5982\u4f55\u4e0e\u670d\u52a1\u5668\u7aef\u4ea4\u6362\u547d\u4ee4\u548c\u6570\u636e RESP"},{"location":"chap8/3redis_RESP/#redis-resp","text":"Redis \u670d\u52a1\u5668\u7aef\u7684\u673a\u5236\u548c\u5173\u952e\u6280\u672f\uff0c\u5f88\u5c11\u6d89\u53ca\u5230\u5ba2\u6237\u7aef\u7684\u95ee\u9898\u3002\u4f46\u662f\uff0cRedis \u91c7\u7528\u7684\u662f\u5178\u578b\u7684 client-server \uff08\u670d\u52a1\u5668\u7aef - \u5ba2\u6237\u7aef\uff09\u67b6\u6784\uff0c\u5ba2\u6237\u7aef\u4f1a\u53d1\u9001\u8bf7\u6c42\u7ed9\u670d\u52a1\u5668\u7aef\uff0c\u670d\u52a1\u5668\u7aef\u4f1a\u8fd4\u56de\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\u3002 \u5982\u679c\u8981\u5bf9 Redis \u5ba2\u6237\u7aef\u8fdb\u884c\u4e8c\u6b21\u5f00\u53d1\uff08\u6bd4\u5982\u589e\u52a0\u65b0\u7684\u547d\u4ee4\uff09\uff0c\u9700\u8981\u4e86\u89e3\u8bf7\u6c42\u548c\u54cd\u5e94\u6d89\u53ca\u7684\u547d\u4ee4\u3001\u6570\u636e\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u4f20\u8f93\u65f6\uff0c\u662f\u5982\u4f55\u7f16\u7801\u7684\u3002 Redis \u4f7f\u7528 RESP\uff08REdis Serialization Protocol\uff09\u534f\u8bae\u5b9a\u4e49\u4e86\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u4ea4\u4e92\u7684\u547d\u4ee4\u3001\u6570\u636e\u7684\u7f16\u7801\u683c\u5f0f\u3002 \u5728 Redis 2.0 \u7248\u672c\u4e2d\uff0cRESP \u534f\u8bae\u6b63\u5f0f\u6210\u4e3a\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u7684\u6807\u51c6\u901a\u4fe1\u534f\u8bae\u3002\u4ece Redis 2.0 \u5230 Redis 5.0\uff0cRESP \u534f\u8bae\u90fd\u79f0\u4e3a RESP 2 \u534f\u8bae\uff0c\u4ece Redis 6.0 \u5f00\u59cb\uff0cRedis \u5c31\u91c7\u7528 RESP 3 \u534f\u8bae\u4e86\u3002\u4e0d\u8fc7\uff0c6.0 \u7248\u672c\u662f\u5728\u4eca\u5e74 5 \u6708\u521a\u63a8\u51fa\u7684\uff0c\u6240\u4ee5\uff0c\u76ee\u524d\u6211\u4eec\u5e7f\u6cdb\u4f7f\u7528\u7684\u8fd8\u662f RESP 2 \u534f\u8bae\u3002","title":"\u7b2c\u4e09\u8282 Redis\u5ba2\u6237\u7aef\u5982\u4f55\u4e0e\u670d\u52a1\u5668\u7aef\u4ea4\u6362\u547d\u4ee4\u548c\u6570\u636e RESP"},{"location":"chap8/3redis_RESP/#1","text":"RESP 2 \u534f\u8bae\u662f\u5982\u4f55\u5bf9\u547d\u4ee4\u548c\u6570\u636e\u8fdb\u884c\u683c\u5f0f\u7f16\u7801\u7684\uff0c\u4ee5\u628a\u4ea4\u4e92\u5185\u5bb9\uff0c\u5206\u6210\u5ba2\u6237\u7aef\u8bf7\u6c42\u548c\u670d\u52a1\u5668\u7aef\u54cd\u5e94\u4e24\u7c7b\uff1a \u5728\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e2d\uff0c\u5ba2\u6237\u7aef\u4f1a\u7ed9 Redis \u53d1\u9001\u547d\u4ee4\uff0c\u4ee5\u53ca\u8981\u5199\u5165\u7684\u952e\u548c\u503c\uff1b \u800c\u5728\u670d\u52a1\u5668\u7aef\u54cd\u5e94\u4e2d\uff0cRedis \u5b9e\u4f8b\u4f1a\u8fd4\u56de\u8bfb\u53d6\u7684\u503c\u3001OK \u6807\u8bc6\u3001\u6210\u529f\u5199\u5165\u7684\u5143\u7d20\u4e2a\u6570\u3001\u9519\u8bef\u4fe1\u606f\uff0c\u4ee5\u53ca\u547d\u4ee4\uff08\u4f8b\u5982 Redis Cluster \u4e2d\u7684 MOVE \u547d\u4ee4\uff09\u3002 \u5176\u5b9e\uff0c\u8fd9\u4e9b\u4ea4\u4e92\u5185\u5bb9\u8fd8\u53ef\u4ee5\u518d\u8fdb\u4e00\u6b65\u7ec6\u5206\u6210\u4e03\u7c7b\u3002 \u547d\u4ee4 \uff1a\u8fd9\u5c31\u662f\u9488\u5bf9\u4e0d\u540c\u6570\u636e\u7c7b\u578b\u7684\u64cd\u4f5c\u547d\u4ee4\u3002\u4f8b\u5982\u5bf9 String \u7c7b\u578b\u7684 SET\u3001GET \u64cd\u4f5c\uff0c\u5bf9 Hash \u7c7b\u578b\u7684 HSET\u3001HGET \u7b49\uff0c\u8fd9\u4e9b\u547d\u4ee4\u5c31\u662f\u4ee3\u8868\u64cd\u4f5c\u8bed\u4e49\u7684\u5b57\u7b26\u4e32\u3002 \u952e \uff1a\u952e\u503c\u5bf9\u4e2d\u7684\u952e\uff0c\u53ef\u4ee5\u76f4\u63a5\u7528\u5b57\u7b26\u4e32\u8868\u793a\u3002 \u5355\u4e2a\u503c \uff1a\u5bf9\u5e94 String \u7c7b\u578b\u7684\u6570\u636e\uff0c\u6570\u636e\u672c\u8eab\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u3001\u6570\u503c\uff08\u6574\u6570\u6216\u6d6e\u70b9\u6570\uff09\uff0c\u5e03\u5c14\u503c\uff08True \u6216\u662f False\uff09\u7b49\u3002 \u96c6\u5408\u503c \uff1a\u5bf9\u5e94 List\u3001Hash\u3001Set\u3001Sorted Set \u7c7b\u578b\u7684\u6570\u636e\uff0c\u4e0d\u4ec5\u5305\u542b\u591a\u4e2a\u503c\uff0c\u800c\u4e14\u6bcf\u4e2a\u503c\u4e5f\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u3001\u6570\u503c\u6216\u5e03\u5c14\u503c\u7b49\u3002 OK \u56de\u590d \uff1a\u5bf9\u5e94\u547d\u4ee4\u64cd\u4f5c\u6210\u529f\u7684\u7ed3\u679c\uff0c\u5c31\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u201cOK\u201d\u3002 \u6574\u6570\u56de\u590d \uff1a\u8fd9\u91cc\u6709\u4e24\u79cd\u60c5\u51b5\u3002 \u4e00\u79cd\u662f\uff0c\u547d\u4ee4\u64cd\u4f5c\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u6574\u6570\uff0c\u4f8b\u5982 LLEN \u547d\u4ee4\u8fd4\u56de\u5217\u8868\u7684\u957f\u5ea6\uff1b \u53e6\u4e00\u79cd\u662f\uff0c\u96c6\u5408\u547d\u4ee4\u6210\u529f\u64cd\u4f5c\u65f6\uff0c\u5b9e\u9645\u64cd\u4f5c\u7684\u5143\u7d20\u4e2a\u6570\uff0c\u4f8b\u5982 SADD \u547d\u4ee4\u8fd4\u56de\u6210\u529f\u6dfb\u52a0\u7684\u5143\u7d20\u4e2a\u6570\u3002 \u9519\u8bef\u4fe1\u606f \uff1a\u547d\u4ee4\u64cd\u4f5c\u51fa\u9519\u65f6\u7684\u8fd4\u56de\u7ed3\u679c\uff0c\u5305\u62ec\u201cerror\u201d\u6807\u8bc6\uff0c\u4ee5\u53ca\u5177\u4f53\u7684\u9519\u8bef\u4fe1\u606f\u3002 \u5148\u770b\u7b2c\u4e00\u4e2a\u4f8b\u5b50\uff0c\u6765\u770b\u770b\u4e0b\u9762\u7684\u547d\u4ee4\uff1a #\u6210\u529f\u5199\u5165String\u7c7b\u578b\u6570\u636e\uff0c\u8fd4\u56deOK 127.0.0.1:6379> SET testkey testvalue OK \u8fd9\u91cc\u7684\u4ea4\u4e92\u5185\u5bb9\u5c31\u5305\u62ec\u4e86 \u547d\u4ee4\uff08SET \u547d\u4ee4\uff09\u3001\u952e\uff08String \u7c7b\u578b\u7684\u952e testkey\uff09\u548c\u5355\u4e2a\u503c\uff08String \u7c7b\u578b\u7684\u503c testvalue\uff09\uff0c\u800c\u670d\u52a1\u5668\u7aef\u5219\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a OK \u56de\u590d \u3002 \u7b2c\u4e8c\u4e2a\u4f8b\u5b50\u662f\u6267\u884c HSET \u547d\u4ee4\uff1a #\u6210\u529f\u5199\u5165Hash\u7c7b\u578b\u6570\u636e\uff0c\u8fd4\u56de\u5b9e\u9645\u5199\u5165\u7684\u96c6\u5408\u5143\u7d20\u4e2a\u6570 127.0.0.1:6379>HSET testhash a 1 b 2 c 3 (integer) 3 \u8fd9\u91cc\u7684\u4ea4\u4e92\u5185\u5bb9\u5305\u62ec\u4e09\u4e2a key-value \u7684 Hash\u96c6\u5408\u503c\uff08a 1 b 2 c 3\uff09 \uff0c\u800c\u670d\u52a1\u5668\u7aef\u8fd4\u56de \u6574\u6570\u56de\u590d\uff083\uff09 \uff0c\u8868\u793a\u64cd\u4f5c\u6210\u529f\u5199\u5165\u7684\u5143\u7d20\u4e2a\u6570\u3002 \u6700\u540e\u4e00\u4e2a\u4f8b\u5b50\u662f\u6267\u884c PUT \u547d\u4ee4\uff0c\u5982\u4e0b\u6240\u793a\uff1a #\u53d1\u9001\u7684\u547d\u4ee4\u4e0d\u5bf9\uff0c\u62a5\u9519\uff0c\u5e76\u8fd4\u56de\u9519\u8bef\u4fe1\u606f 127.0.0.1:6379>PUT testkey2 testvalue (error) ERR unknown command 'PUT', with args beginning with: 'testkey', 'testvalue' \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u7684\u4ea4\u4e92\u5185\u5bb9\u5305\u62ec\u9519\u8bef\u4fe1\u606f\uff0c\u8fd9\u662f\u56e0\u4e3a\uff0c Redis \u5b9e\u4f8b\u672c\u8eab\u4e0d\u652f\u6301 PUT \u547d\u4ee4\uff0c\u6240\u4ee5\u670d\u52a1\u5668\u7aef\u62a5\u9519\u201cerror\u201d\uff0c\u5e76\u8fd4\u56de\u5177\u4f53\u7684\u9519\u8bef\u4fe1\u606f\uff0c\u4e5f\u5c31\u662f\u672a\u77e5\u7684\u547d\u4ee4\u201cput\u201d\u3002","title":"1\u3001\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u4ea4\u4e92\u7684\u5185\u5bb9\u6709\u54ea\u4e9b\uff1f"},{"location":"chap8/3redis_RESP/#2resp-2","text":"RESP 2 \u534f\u8bae\u7684\u8bbe\u8ba1\u76ee\u6807\u662f\uff0c\u5e0c\u671b Redis \u5f00\u53d1\u4eba\u5458\u5b9e\u73b0\u5ba2\u6237\u7aef\u65f6\u7b80\u5355\u65b9\u4fbf\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u51cf\u5c11\u5ba2\u6237\u7aef\u5f00\u53d1\u65f6\u51fa\u73b0\u7684 Bug\u3002\u800c\u4e14\uff0c\u5f53\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u4ea4\u4e92\u51fa\u73b0\u95ee\u9898\u65f6\uff0c\u5e0c\u671b\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b\u534f\u8bae\u4ea4\u4e92\u8fc7\u7a0b\uff0c\u80fd\u5feb\u901f\u5b9a\u4f4d\u95ee\u9898\uff0c\u65b9\u4fbf\u8c03\u8bd5\u3002\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e00\u76ee\u6807\uff0cRESP 2 \u534f\u8bae\u91c7\u7528\u4e86\u53ef\u8bfb\u6027\u5f88\u597d\u7684\u6587\u672c\u5f62\u5f0f\u8fdb\u884c\u7f16\u7801\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u4e00\u7cfb\u5217\u7684\u5b57\u7b26\u4e32\uff0c\u6765\u8868\u793a\u5404\u79cd\u547d\u4ee4\u548c\u6570\u636e\u3002 \u4e0d\u8fc7\uff0c\u4ea4\u4e92\u5185\u5bb9\u6709\u591a\u79cd\uff0c\u800c\u4e14\uff0c\u5b9e\u9645\u4f20\u8f93\u7684\u547d\u4ee4\u6216\u6570\u636e\u4e5f\u4f1a\u6709\u5f88\u591a\u4e2a\u3002 \u9488\u5bf9\u8fd9\u4e24\u79cd\u60c5\u51b5\uff0cRESP 2 \u534f\u8bae\u5728\u7f16\u7801\u65f6\u8bbe\u8ba1\u4e86\u4e24\u4e2a\u57fa\u672c\u89c4\u8303\u3002 \u4e3a\u4e86\u5bf9\u4e0d\u540c\u7c7b\u578b\u7684\u4ea4\u4e92\u5185\u5bb9\u8fdb\u884c\u7f16\u7801\uff0cRESP 2 \u534f\u8bae\u5b9e\u73b0\u4e86 5 \u79cd\u7f16\u7801\u683c\u5f0f\u7c7b\u578b\u3002\u540c\u65f6\uff0c\u4e3a\u4e86\u533a\u5206\u8fd9 5 \u79cd\u7f16\u7801\u7c7b\u578b\uff0cRESP 2 \u4f7f\u7528\u4e00\u4e2a\u4e13\u95e8\u7684\u5b57\u7b26\uff0c\u4f5c\u4e3a\u6bcf\u79cd\u7f16\u7801\u7c7b\u578b\u7684\u5f00\u5934\u5b57\u7b26\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5ba2\u6237\u7aef\u6216\u670d\u52a1\u5668\u7aef\u5728\u5bf9\u7f16\u7801\u540e\u7684\u6570\u636e\u8fdb\u884c\u89e3\u6790\u65f6\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u5f00\u5934\u5b57\u7b26\u77e5\u9053\u5f53\u524d\u89e3\u6790\u7684\u7f16\u7801\u7c7b\u578b\u3002 RESP 2 \u8fdb\u884c\u7f16\u7801\u65f6\uff0c\u4f1a\u6309\u7167\u5355\u4e2a\u547d\u4ee4\u6216\u5355\u4e2a\u6570\u636e\u7684\u7c92\u5ea6\u8fdb\u884c\u7f16\u7801\uff0c\u5e76\u5728\u6bcf\u4e2a\u7f16\u7801\u7ed3\u679c\u540e\u9762\u589e\u52a0\u4e00\u4e2a\u6362\u884c\u7b26 \u201c\\r\\n\u201d \uff08\u6709\u65f6\u4e5f\u8868\u793a\u6210 CRLF\uff09\uff0c\u8868\u793a\u4e00\u6b21\u7f16\u7801\u7ed3\u675f\u3002 \u4ecb\u7ecd\u4e0b\u8fd9 5 \u79cd\u7f16\u7801\u7c7b\u578b","title":"2\u3001RESP 2 \u7684\u7f16\u7801\u683c\u5f0f\u89c4\u8303"},{"location":"chap8/3redis_RESP/#2-1-resp-simple-strings","text":"\u8fd9\u79cd\u7c7b\u578b\u5c31\u662f\u7528\u4e00\u4e2a\u5b57\u7b26\u4e32\u6765\u8fdb\u884c\u7f16\u7801\uff0c\u6bd4\u5982\uff0c\u8bf7\u6c42\u64cd\u4f5c\u5728\u670d\u52a1\u5668\u7aef\u6210\u529f\u6267\u884c\u540e\u7684 OK \u6807\u8bc6\u56de\u590d\uff0c\u5c31\u662f\u7528\u8fd9\u79cd\u7c7b\u578b\u8fdb\u884c\u7f16\u7801\u7684\u3002 \u5f53\u670d\u52a1\u5668\u7aef\u6210\u529f\u6267\u884c\u4e00\u4e2a\u64cd\u4f5c\u540e\uff0c\u8fd4\u56de\u7684 OK \u6807\u8bc6\u5c31\u53ef\u4ee5\u7f16\u7801\u5982\u4e0b\uff1a +OK\\r\\n","title":"2-1 \u7b80\u5355\u5b57\u7b26\u4e32\u7c7b\u578b\uff08RESP Simple Strings\uff09"},{"location":"chap8/3redis_RESP/#2-2-resp-bulk-string","text":"\u8fd9\u79cd\u7c7b\u578b\u662f\u7528\u4e00\u4e2a\u4e8c\u8fdb\u5236\u5b89\u5168\u7684\u5b57\u7b26\u4e32\u6765\u8fdb\u884c\u7f16\u7801\u3002\u8fd9\u91cc\u7684\u4e8c\u8fdb\u5236\u5b89\u5168\uff0c\u5176\u5b9e\u662f\u76f8\u5bf9\u4e8e C \u8bed\u8a00\u4e2d\u5bf9\u5b57\u7b26\u4e32\u7684\u5904\u7406\u65b9\u5f0f\u6765\u8bf4\u7684\u3002 Redis \u5728\u89e3\u6790\u5b57\u7b26\u4e32\u65f6\uff0c\u4e0d\u4f1a\u50cf C \u8bed\u8a00\u90a3\u6837\uff0c\u4f7f\u7528 \u201c\\0\u201d \u5224\u5b9a\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u7ed3\u5c3e\uff0cRedis \u4f1a\u628a \u201c\\0\u201d \u89e3\u6790\u6210\u6b63\u5e38\u7684 0 \u5b57\u7b26\uff0c\u5e76\u4f7f\u7528\u989d\u5916\u7684\u5c5e\u6027\u503c\u8868\u793a\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5bf9\u4e8e \u201cRedis\\0Cluster\\0\u201d \u8fd9\u4e2a\u5b57\u7b26\u4e32\u6765\u8bf4\uff0cC \u8bed\u8a00\u4f1a\u89e3\u6790\u4e3a\u201cRedis\u201d\uff0c\u800c Redis \u4f1a\u89e3\u6790\u4e3a\u201cRedis Cluster\u201d\uff0c\u5e76\u7528 len \u5c5e\u6027\u8868\u793a\u5b57\u7b26\u4e32\u7684\u771f\u5b9e\u957f\u5ea6\u662f 14 \u5b57\u8282\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u8fd9\u6837\u4e00\u6765\uff0c\u5b57\u7b26\u4e32\u4e2d\u5373\u4f7f\u5b58\u50a8\u4e86\u201c\\0\u201d\u5b57\u7b26\uff0c\u4e5f\u4e0d\u4f1a\u5bfc\u81f4 Redis \u89e3\u6790\u5230\u201c\\0\u201d\u65f6\uff0c\u5c31\u8ba4\u4e3a\u5b57\u7b26\u4e32\u7ed3\u675f\u4e86\u4ece\u800c\u505c\u6b62\u89e3\u6790\uff0c\u8fd9\u5c31\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u5b89\u5168\u6027\u3002\u548c\u957f\u5b57\u7b26\u4e32\u7c7b\u578b\u76f8\u6bd4\uff0c\u7b80\u5355\u5b57\u7b26\u4e32\u5c31\u662f\u975e\u4e8c\u8fdb\u5236\u5b89\u5168\u7684\u3002 \u957f\u5b57\u7b26\u4e32\u7c7b\u578b\u6700\u5927\u53ef\u4ee5\u8fbe\u5230 512MB\uff0c\u6240\u4ee5\u53ef\u4ee5\u5bf9\u5f88\u5927\u7684\u6570\u636e\u91cf\u8fdb\u884c\u7f16\u7801\uff0c\u6b63\u597d\u53ef\u4ee5\u6ee1\u8db3\u952e\u503c\u5bf9\u672c\u8eab\u7684\u6570\u636e\u91cf\u9700\u6c42\uff0c\u6240\u4ee5\uff0cRESP 2 \u5c31\u7528\u8fd9\u79cd\u7c7b\u578b\u5bf9\u4ea4\u4e92\u5185\u5bb9\u4e2d\u7684\u952e\u6216\u503c\u8fdb\u884c\u7f16\u7801\uff0c\u5e76\u4e14\u4f7f\u7528 \u201c$\u201d \u5b57\u7b26\u4f5c\u4e3a\u5f00\u5934\u5b57\u7b26\uff0c $ \u5b57\u7b26\u540e\u9762\u4f1a\u7d27\u8ddf\u7740\u4e00\u4e2a\u6570\u5b57\uff0c\u8fd9\u4e2a\u6570\u5b57\u8868\u793a\u5b57\u7b26\u4e32\u7684\u5b9e\u9645\u957f\u5ea6\u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u4f7f\u7528 GET \u547d\u4ee4\u8bfb\u53d6\u4e00\u4e2a\u952e\uff08\u5047\u8bbe\u952e\u4e3a testkey \uff09\u7684\u503c\uff08\u5047\u8bbe\u503c\u4e3a testvalue \uff09\u65f6\uff0c\u670d\u52a1\u7aef\u8fd4\u56de\u7684 String \u503c\u7f16\u7801\u7ed3\u679c\u5982\u4e0b\uff0c\u5176\u4e2d \uff0c $ \u5b57\u7b26\u540e\u7684 9\uff0c\u8868\u793a\u6570\u636e\u957f\u5ea6\u4e3a 9 \u4e2a\u5b57\u7b26\u3002 $9 testvalue\\r\\n","title":"2-2 \u957f\u5b57\u7b26\u4e32\u7c7b\u578b\uff08RESP Bulk String)"},{"location":"chap8/3redis_RESP/#2-3-resp-integer","text":"\u8fd9\u79cd\u7c7b\u578b\u4e5f\u8fd8\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u4f46\u662f\u8868\u793a\u7684\u662f\u4e00\u4e2a\u6709\u7b26\u53f7 64 \u4f4d\u6574\u6570\u3002\u4e3a\u4e86\u548c\u5305\u542b\u6570\u5b57\u7684\u7b80\u5355\u5b57\u7b26\u4e32\u7c7b\u578b\u533a\u5206\u5f00\uff0c\u6574\u6570\u7c7b\u578b\u4f7f\u7528 \u201c:\u201d \u5b57\u7b26\u4f5c\u4e3a\u5f00\u5934\u5b57\u7b26\uff0c\u53ef\u4ee5\u7528\u4e8e\u5bf9\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u7684\u6574\u6570\u56de\u590d\u8fdb\u884c\u7f16\u7801\u3002 \u4f8b\u5982\uff0c\u5728\u521a\u624d\u4ecb\u7ecd\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528 HSET \u547d\u4ee4\u8bbe\u7f6e\u4e86 testhash \u7684\u4e09\u4e2a\u5143\u7d20\uff0c\u670d\u52a1\u5668\u7aef\u5b9e\u9645\u8fd4\u56de\u7684\u7f16\u7801\u7ed3\u679c\u5982\u4e0b\uff1a :3\\r\\n","title":"2-3 \u6574\u6570\u7c7b\u578b\uff08RESP Integer\uff09"},{"location":"chap8/3redis_RESP/#2-4-resp-errors","text":"\u5b83\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5305\u62ec\u4e86\u9519\u8bef\u7c7b\u578b\u548c\u5177\u4f53\u7684\u9519\u8bef\u4fe1\u606f\u3002Redis \u670d\u52a1\u5668\u7aef\u62a5\u9519\u54cd\u5e94\u5c31\u662f\u7528\u8fd9\u79cd\u7c7b\u578b\u8fdb\u884c\u7f16\u7801\u7684\u3002RESP 2 \u4f7f\u7528 \u201c-\u201d \u5b57\u7b26\u4f5c\u4e3a\u5b83\u7684\u5f00\u5934\u5b57\u7b26\u3002 \u4f8b\u5982\uff0c\u5728\u521a\u624d\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u5728 redis-cli \u6267\u884c PUT testkey2 testvalue \u547d\u4ee4\u62a5\u9519\uff0c\u670d\u52a1\u5668\u7aef\u5b9e\u9645\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u62a5\u9519\u7f16\u7801\u7ed3\u679c\u5982\u4e0b\uff1a -ERR unknown command `PUT`, with args beginning with: `testkey`, `testvalue` \u5176\u4e2d\uff0cERR \u5c31\u662f\u62a5\u9519\u7c7b\u578b\uff0c\u8868\u793a\u662f\u4e00\u4e2a\u901a\u7528\u9519\u8bef\uff0cERR \u540e\u9762\u7684\u6587\u5b57\u5185\u5bb9\u5c31\u662f\u5177\u4f53\u7684\u62a5\u9519\u4fe1\u606f\u3002","title":"2-4 \u9519\u8bef\u7c7b\u578b\uff08RESP Errors\uff09"},{"location":"chap8/3redis_RESP/#2-5-resp-arrays","text":"\u8fd9\u662f\u4e00\u4e2a\u5305\u542b\u591a\u4e2a\u5143\u7d20\u7684\u6570\u7ec4\uff0c\u5176\u4e2d\uff0c\u5143\u7d20\u7684\u7c7b\u578b\u53ef\u4ee5\u662f\u521a\u624d\u4ecb\u7ecd\u7684\u8fd9 4 \u79cd\u7f16\u7801\u7c7b\u578b\u3002 \u5728\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u548c\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u7ed3\u679c\u65f6\uff0c\u6570\u7ec4\u7f16\u7801\u7c7b\u578b\u90fd\u80fd\u7528\u5f97\u4e0a\u3002\u5ba2\u6237\u7aef\u5728\u53d1\u9001\u8bf7\u6c42\u64cd\u4f5c\u65f6\uff0c\u4e00\u822c\u4f1a\u540c\u65f6\u5305\u62ec\u547d\u4ee4\u548c\u8981\u64cd\u4f5c\u7684\u6570\u636e\u3002\u800c\u6570\u7ec4\u7c7b\u578b\u5305\u542b\u4e86\u591a\u4e2a\u5143\u7d20\uff0c\u6240\u4ee5\uff0c\u5c31\u9002\u5408\u7528\u6765\u5bf9\u53d1\u9001\u7684\u547d\u4ee4\u548c\u6570\u636e\u8fdb\u884c\u7f16\u7801\u3002 \u4e3a\u4e86\u548c\u5176\u4ed6\u7c7b\u578b\u533a\u5206\uff0cRESP 2 \u4f7f\u7528 \u201c*\u201d \u5b57\u7b26\u4f5c\u4e3a\u5f00\u5934\u5b57\u7b26\u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u547d\u4ee4 GET testkey\uff0c\u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7aef\u7684\u547d\u4ee4\u7684\u7f16\u7801\u7ed3\u679c\u5c31\u662f\u4f7f\u7528\u6570\u7ec4\u7c7b\u578b\u7f16\u7801\u7684\uff0c\u5982\u4e0b\u6240\u793a\uff1a *2\\r\\n$3\\r\\nGET\\r\\n$7\\r\\ntestkey\\r\\n \u5176\u4e2d\uff0c\u7b2c\u4e00\u4e2a * \u5b57\u7b26\u6807\u8bc6\u5f53\u524d\u662f\u6570\u7ec4\u7c7b\u578b\u7684\u7f16\u7801\u7ed3\u679c\uff0c2 \u8868\u793a\u8be5\u6570\u7ec4\u6709 2 \u4e2a\u5143\u7d20\uff0c\u5206\u522b\u5bf9\u5e94\u547d\u4ee4 GET \u548c\u952e testkey \u3002\u547d\u4ee4 GET \u548c\u952e testkey\uff0c\u90fd\u662f\u4f7f\u7528\u957f\u5b57\u7b26\u4e32\u7c7b\u578b\u7f16\u7801\u7684\uff0c\u6240\u4ee5\u7528 $ \u5b57\u7b26\u52a0\u5b57\u7b26\u4e32\u957f\u5ea6\u6765\u8868\u793a\u3002 \u7c7b\u4f3c\u5730\uff0c\u5f53\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u5305\u542b\u591a\u4e2a\u5143\u7d20\u7684\u96c6\u5408\u7c7b\u578b\u6570\u636e\u65f6\uff0c\u4e5f\u4f1a\u7528 * \u5b57\u7b26\u548c\u5143\u7d20\u4e2a\u6570\u4f5c\u4e3a\u6807\u8bc6\uff0c\u5e76\u7528\u957f\u5b57\u7b26\u4e32\u7c7b\u578b\u5bf9\u8fd4\u56de\u7684\u96c6\u5408\u5143\u7d20\u8fdb\u884c\u7f16\u7801\u3002 \u597d\u4e86\uff0c\u5230\u8fd9\u91cc\uff0c\u4f60\u4e86\u89e3\u4e86 RESP 2 \u534f\u8bae\u7684 5 \u79cd\u7f16\u7801\u7c7b\u578b\u548c\u76f8\u5e94\u7684\u5f00\u5934\u5b57\u7b26 Redis 6.0 \u4e2d\u4f7f\u7528\u4e86 RESP 3 \u534f\u8bae\uff0c\u5bf9 RESP 2.0 \u505a\u4e86\u6539\u8fdb","title":"2-5 \u6570\u7ec4\u7f16\u7801\u7c7b\u578b\uff08RESP Arrays\uff09"},{"location":"chap8/3redis_RESP/#3resp-2-resp-3","text":"\u867d\u7136\u6211\u4eec\u521a\u521a\u8bf4 RESP 2 \u534f\u8bae\u63d0\u4f9b\u4e86 5 \u79cd\u7f16\u7801\u7c7b\u578b\uff0c\u770b\u8d77\u6765\u5f88\u4e30\u5bcc\uff0c\u5176\u5b9e\u662f\u4e0d\u591f\u7684\u3002 \u6bd5\u7adf\uff0c\u57fa\u672c\u6570\u636e\u7c7b\u578b\u8fd8\u5305\u62ec\u5f88\u591a\u79cd\uff0c\u4f8b\u5982\u6d6e\u70b9\u6570\u3001\u5e03\u5c14\u503c\u7b49\u3002\u7f16\u7801\u7c7b\u578b\u504f\u5c11\uff0c\u4f1a\u5e26\u6765\u4e24\u4e2a\u95ee\u9898\u3002 \u4e00\u65b9\u9762\uff0c\u5728\u503c\u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b\u65b9\u9762\uff0c RESP 2 \u53ea\u80fd\u533a\u5206\u5b57\u7b26\u4e32\u548c\u6574\u6570\uff0c\u5bf9\u4e8e\u5176\u4ed6\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5ba2\u6237\u7aef\u4f7f\u7528 RESP 2 \u534f\u8bae\u65f6\uff0c\u5c31\u9700\u8981\u8fdb\u884c\u989d\u5916\u7684\u8f6c\u6362\u64cd\u4f5c \u3002\u4f8b\u5982\uff0c\u5f53\u4e00\u4e2a\u6d6e\u70b9\u6570\u7528\u5b57\u7b26\u4e32\u8868\u793a\u65f6\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u5c06\u5b57\u7b26\u4e32\u4e2d\u7684\u503c\u548c\u5b9e\u9645\u6570\u5b57\u503c\u6bd4\u8f83\uff0c\u5224\u65ad\u662f\u5426\u4e3a\u6570\u5b57\u503c\uff0c\u7136\u540e\u518d\u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u6210\u5b9e\u9645\u7684\u6d6e\u70b9\u6570\u3002 \u53e6\u4e00\u65b9\u9762\uff0c RESP 2 \u7528\u6570\u7ec4\u7c7b\u522b\u7f16\u7801\u8868\u793a\u6240\u6709\u7684\u96c6\u5408\u7c7b\u578b\uff0c\u4f46\u662f\uff0cRedis \u7684\u96c6\u5408\u7c7b\u578b\u5305\u62ec\u4e86 List\u3001Hash\u3001Set \u548c Sorted Set\u3002 \u5f53\u5ba2\u6237\u7aef\u63a5\u6536\u5230\u6570\u7ec4\u7c7b\u578b\u7f16\u7801\u7684\u7ed3\u679c\u65f6\uff0c\u8fd8\u9700\u8981\u6839\u636e\u8c03\u7528\u7684\u547d\u4ee4\u64cd\u4f5c\u63a5\u53e3\uff0c\u6765\u5224\u65ad\u8fd4\u56de\u7684\u6570\u7ec4\u7a76\u7adf\u662f\u54ea\u4e00\u79cd\u96c6\u5408\u7c7b\u578b\u3002 \u5047\u8bbe\u6709\u4e00\u4e2a Hash \u7c7b\u578b\u7684\u952e\u662f testhash\uff0c\u96c6\u5408\u5143\u7d20\u5206\u522b\u4e3a a:1\u3001b:2\u3001c:3\u3002\u540c\u65f6\uff0c\u6709\u4e00\u4e2a Sorted Set \u7c7b\u578b\u7684\u952e\u662f testzset\uff0c\u96c6\u5408\u5143\u7d20\u5206\u522b\u662f a\u3001b\u3001c\uff0c\u5b83\u4eec\u7684\u5206\u6570\u5206\u522b\u662f 1\u30012\u30013\u3002\u6211\u4eec\u5728 redis-cli \u5ba2\u6237\u7aef\u4e2d\u8bfb\u53d6\u5b83\u4eec\u7684\u7ed3\u679c\u65f6\uff0c\u8fd4\u56de\u7684\u5f62\u5f0f\u90fd\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u5982\u4e0b\u6240\u793a\uff1a 127.0.0.1:6379>HGETALL testhash 1) \"a\" 2) \"1\" 3) \"b\" 4) \"2\" 5) \"c\" 6) \"3\" 127.0.0.1:6379>ZRANGE testzset 0 3 withscores 1) \"a\" 2) \"1\" 3) \"b\" 4) \"2\" 5) \"c\" 6) \"3\" \u4e3a\u4e86\u5728\u5ba2\u6237\u7aef\u6309\u7167 Hash \u548c Sorted Set \u4e24\u79cd\u7c7b\u578b\u5904\u7406\u4ee3\u7801\u4e2d\u8fd4\u56de\u7684\u6570\u636e\uff0c\u5ba2\u6237\u7aef\u8fd8\u9700\u8981\u6839\u636e\u53d1\u9001\u7684\u547d\u4ee4\u64cd\u4f5c HGETALL \u548c ZRANGE\uff0c\u6765\u628a\u8fd9\u4e24\u4e2a\u7f16\u7801\u7684\u6570\u7ec4\u7ed3\u679c\u8f6c\u6362\u6210\u76f8\u5e94\u7684 Hash \u96c6\u5408\u548c\u6709\u5e8f\u96c6\u5408\uff0c\u589e\u52a0\u4e86\u5ba2\u6237\u7aef\u989d\u5916\u7684\u5f00\u9500\u3002","title":"3\u3001RESP 2 \u7684\u4e0d\u8db3\u548c RESP 3 \u7684\u6539\u8fdb"},{"location":"chap8/3redis_RESP/#4","text":"RESP 2 \u534f\u8bae\u5b9a\u4e49\u4e86 Redis \u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u8fdb\u884c\u547d\u4ee4\u548c\u6570\u636e\u4ea4\u4e92\u65f6\u7684\u7f16\u7801\u683c\u5f0f\u3002RESP 2 \u63d0\u4f9b\u4e86 5 \u79cd\u7c7b\u578b\u7684\u7f16\u7801\u683c\u5f0f\uff0c\u5305\u62ec\u7b80\u5355\u5b57\u7b26\u4e32\u7c7b\u578b\u3001\u957f\u5b57\u7b26\u4e32\u7c7b\u578b\u3001\u6574\u6570\u7c7b\u578b\u3001\u9519\u8bef\u7c7b\u578b\u548c\u6570\u7ec4\u7c7b\u578b\u3002\u4e3a\u4e86\u533a\u5206\u8fd9 5 \u79cd\u7c7b\u578b\uff0cRESP 2 \u534f\u8bae\u4f7f\u7528\u4e86 5 \u79cd\u4e0d\u540c\u7684\u5b57\u7b26\u4f5c\u4e3a\u8fd9 5 \u79cd\u7c7b\u578b\u7f16\u7801\u7ed3\u679c\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\uff0c\u5206\u522b\u662f +\u3001 $\u3001:\u3001- \u548c * \u3002 RESP 2 \u534f\u8bae\u662f\u6587\u672c\u5f62\u5f0f\u7684\u534f\u8bae\uff0c\u5b9e\u73b0\u7b80\u5355\uff0c\u53ef\u4ee5\u51cf\u5c11\u5ba2\u6237\u7aef\u5f00\u53d1\u51fa\u73b0\u7684 Bug\uff0c\u800c\u4e14\u53ef\u8bfb\u6027\u5f3a\uff0c\u4fbf\u4e8e\u5f00\u53d1\u8c03\u8bd5\u3002\u5f53\u4f60\u9700\u8981\u5f00\u53d1\u5b9a\u5236\u5316\u7684 Redis \u5ba2\u6237\u7aef\u65f6\uff0c\u5c31\u9700\u8981\u4e86\u89e3\u548c\u638c\u63e1 RESP 2 \u534f\u8bae\u3002 RESP 2 \u534f\u8bae\u7684\u4e00\u4e2a\u4e0d\u8db3\u5c31\u662f\u652f\u6301\u7684\u7c7b\u578b\u504f\u5c11\uff0c\u6240\u4ee5\uff0cRedis 6.0 \u7248\u672c\u4f7f\u7528\u4e86 RESP 3 \u534f\u8bae\u3002\u548c RESP 2 \u534f\u8bae\u76f8\u6bd4\uff0c RESP 3 \u534f\u8bae\u589e\u52a0\u4e86\u5bf9\u6d6e\u70b9\u6570\u3001\u5e03\u5c14\u7c7b\u578b\u3001\u6709\u5e8f\u5b57\u5178\u96c6\u5408\u3001\u65e0\u5e8f\u96c6\u5408\u7b49\u591a\u79cd\u7c7b\u578b\u6570\u636e\u7684\u652f\u6301 \u3002\u4e0d\u8fc7\uff0c\u8fd9\u91cc\uff0c\u6709\u4e2a\u5730\u65b9\u9700\u8981\u4f60\u6ce8\u610f\uff0cRedis 6.0 \u53ea\u652f\u6301 RESP 3\uff0c\u5bf9 RESP 2 \u534f\u8bae\u4e0d\u517c\u5bb9\uff0c\u6240\u4ee5\uff0c \u5982\u679c\u4f60\u4f7f\u7528 Redis 6.0 \u7248\u672c\uff0c\u9700\u8981\u786e\u8ba4\u5ba2\u6237\u7aef\u5df2\u7ecf\u652f\u6301\u4e86 RESP 3 \u534f\u8bae\uff0c\u5426\u5219\uff0c\u5c06\u65e0\u6cd5\u4f7f\u7528 Redis 6.0\u3002 \u6700\u540e\uff0c\u6211\u4e5f\u7ed9\u4f60\u63d0\u4f9b\u4e00\u4e2a\u5c0f\u5de5\u5177\u3002\u5982\u679c\u4f60\u60f3\u67e5\u770b\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u6570\u636e\u7684 RESP 2 \u7f16\u7801\u7ed3\u679c\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 telnet \u547d\u4ee4\u548c redis \u5b9e\u4f8b\u8fde\u63a5\uff0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5c31\u884c\uff1a telnet \u5b9e\u4f8bIP \u5b9e\u4f8b\u7aef\u53e3 \u53ef\u4ee5\u7ed9\u5b9e\u4f8b\u53d1\u9001\u547d\u4ee4\uff0c\u8fd9\u6837\u5c31\u80fd\u770b\u5230\u7528 RESP 2 \u534f\u8bae\u7f16\u7801\u540e\u7684\u8fd4\u56de\u7ed3\u679c\u4e86\u3002\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u5728 telnet \u4e2d\uff0c\u5411 Redis \u5b9e\u4f8b\u53d1\u9001\u7528 RESP 2 \u534f\u8bae\u7f16\u5199\u7684\u547d\u4ee4\u64cd\u4f5c\u3002","title":"4\u3001\u672c\u7ae0\u5c0f\u7ed3"},{"location":"chap8/4redis_opt_tools/","text":"\u7b2c\u56db\u8282 Redis\u8fd0\u7ef4\u5de5\u5177 1\u3001\u6700\u57fa\u672c\u7684\u76d1\u63a7\u547d\u4ee4\uff1aINFO \u547d\u4ee4 Redis \u672c\u8eab\u63d0\u4f9b\u7684 INFO \u547d\u4ee4\u4f1a\u8fd4\u56de\u4e30\u5bcc\u7684\u5b9e\u4f8b\u8fd0\u884c\u76d1\u63a7\u4fe1\u606f\uff0c\u8fd9\u4e2a\u547d\u4ee4\u662f Redis \u76d1\u63a7\u5de5\u5177\u7684\u57fa\u7840\u3002 Redis\u6700\u57fa\u672c\u7684\u76d1\u63a7\u547d\u4ee4\uff1aINFO\u547d\u4ee4 \u5bf9\u5e94INFO\u547d\u4ee4\u7684section\u53c2\u6570\u6709\uff1a cpu\u3001memory\u3001stat\u3001commandstat\u3001server\u3001client\u3001repliation\u3001cluster\u3001modules\u7b49\u7b49 INFO \u547d\u4ee4\u5728\u4f7f\u7528\u65f6\uff0c\u53ef\u4ee5\u5e26\u4e00\u4e2a\u53c2\u6570 section\uff0c\u8fd9\u4e2a\u53c2\u6570\u7684\u53d6\u503c\u6709\u597d\u51e0\u79cd\uff0c\u76f8\u5e94\u7684\uff0cINFO \u547d\u4ee4\u4e5f\u4f1a\u8fd4\u56de\u4e0d\u540c\u7c7b\u578b\u7684\u76d1\u63a7\u4fe1\u606f\u3002 \u628a INFO \u547d\u4ee4\u7684\u8fd4\u56de\u4fe1\u606f\u5206\u6210 5 \u5927\u7c7b\uff0c\u5176\u4e2d\uff0c\u6709\u7684\u7c7b\u522b\u5f53\u4e2d\u53c8\u5305\u542b\u4e86\u4e0d\u540c\u7684\u76d1\u63a7\u5185\u5bb9\uff0c\u5982\u4e0b\u8868\u6240\u793a\uff1a \u5728\u76d1\u63a7 Redis \u8fd0\u884c\u72b6\u6001\u65f6\uff0cINFO \u547d\u4ee4\u8fd4\u56de\u7684\u7ed3\u679c\u975e\u5e38\u6709\u7528\u3002 \u5982\u679c\u4f60\u60f3\u4e86\u89e3 INFO \u547d\u4ee4\u7684\u6240\u6709\u53c2\u6570\u8fd4\u56de\u7ed3\u679c\u7684\u8be6\u7ec6\u542b\u4e49\uff0c\u53ef\u4ee5\u67e5\u770b Redis\u5b98\u7f51\u7684\u4ecb\u7ecd \u3002 \u51e0\u4e2a\u8fd0\u7ef4\u65f6\u9700\u8981\u91cd\u70b9\u5173\u6ce8\u7684\u53c2\u6570\u4ee5\u53ca\u5b83\u4eec\u7684\u91cd\u8981\u8fd4\u56de\u7ed3\u679c\u3002 \u9996\u5148\uff0c \u65e0\u8bba\u4f60\u662f\u8fd0\u884c\u5355\u5b9e\u4f8b\u6216\u662f\u96c6\u7fa4\uff0c\u6211\u5efa\u8bae\u4f60\u91cd\u70b9\u5173\u6ce8\u4e00\u4e0b stat\u3001commandstat\u3001cpu \u548c memory \u8fd9\u56db\u4e2a\u53c2\u6570\u7684\u8fd4\u56de\u7ed3\u679c \u8fd9\u91cc\u9762\u5305\u542b\u4e86\u547d\u4ee4\u7684\u6267\u884c\u60c5\u51b5\uff08\u6bd4\u5982\u547d\u4ee4\u7684\u6267\u884c\u6b21\u6570\u548c\u6267\u884c\u65f6\u95f4\u3001\u547d\u4ee4\u4f7f\u7528\u7684 CPU \u8d44\u6e90\uff09 \u5185\u5b58\u8d44\u6e90\u7684\u4f7f\u7528\u60c5\u51b5\uff08\u6bd4\u5982\u5185\u5b58\u5df2\u4f7f\u7528\u91cf\u3001\u5185\u5b58\u788e\u7247\u7387\uff09 CPU \u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u7b49 \u5f53\u4f60\u542f\u7528 RDB \u6216 AOF \u529f\u80fd\u65f6\uff0c\u4f60\u5c31\u9700\u8981\u91cd\u70b9\u5173\u6ce8\u4e0b persistence \u53c2\u6570\u7684\u8fd4\u56de\u7ed3\u679c\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u5b83\u67e5\u770b\u5230 RDB \u6216\u8005 AOF \u7684\u6267\u884c\u60c5\u51b5\u3002 \u5982\u679c\u4f60\u5728\u4f7f\u7528\u4e3b\u4ece\u96c6\u7fa4\uff0c\u5c31\u8981\u91cd\u70b9\u5173\u6ce8\u4e0b replication \u53c2\u6570\u7684\u8fd4\u56de\u7ed3\u679c\uff0c\u8fd9\u91cc\u9762\u5305\u542b\u4e86\u4e3b\u4ece\u540c\u6b65\u7684\u5b9e\u65f6\u72b6\u6001\u3002 \u4e0d\u8fc7\uff0cINFO \u547d\u4ee4\u53ea\u662f\u63d0\u4f9b\u4e86\u6587\u672c\u5f62\u5f0f\u7684\u76d1\u63a7\u7ed3\u679c\uff0c\u5e76\u6ca1\u6709\u53ef\u89c6\u5316\uff0c\u6240\u4ee5\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e9b\u7b2c\u4e09\u65b9\u5f00\u6e90\u5de5\u5177\uff0c\u5c06 INFO \u547d\u4ee4\u7684\u8fd4\u56de\u7ed3\u679c\u53ef\u89c6\u5316\u3002 2\u3001\u9762\u5411 Prometheus \u7684 Redis-exporter \u76d1\u63a7 Prometheus\u662f\u4e00\u5957\u5f00\u6e90\u7684\u7cfb\u7edf\u76d1\u63a7\u62a5\u8b66\u6846\u67b6\u3002\u5b83\u7684\u6838\u5fc3\u529f\u80fd\u662f\u4ece\u88ab\u76d1\u63a7\u7cfb\u7edf\u4e2d\u62c9\u53d6\u76d1\u63a7\u6570\u636e\uff0c\u7ed3\u5408Grafana\u5de5\u5177\uff0c\u8fdb\u884c\u53ef\u89c6\u5316\u5c55\u793a\u3002\u800c\u4e14\uff0c\u76d1\u63a7\u6570\u636e\u53ef\u4ee5\u4fdd\u5b58\u5230\u65f6\u5e8f\u6570\u636e\u5e93\u4e2d\uff0c\u4ee5\u4fbf\u8fd0\u7ef4\u4eba\u5458\u8fdb\u884c\u5386\u53f2\u67e5\u8be2\u3002\u540c\u65f6\uff0cPrometheus \u4f1a\u68c0\u6d4b\u7cfb\u7edf\u7684\u76d1\u63a7\u6307\u6807\u662f\u5426\u8d85\u8fc7\u4e86\u9884\u8bbe\u7684\u9608\u503c\uff0c\u4e00\u65e6\u8d85\u8fc7\u9608\u503c\uff0cPrometheus \u5c31\u4f1a\u89e6\u53d1\u62a5\u8b66\u3002 \u5bf9\u4e8e\u7cfb\u7edf\u7684\u65e5\u5e38\u8fd0\u7ef4\u7ba1\u7406\u6765\u8bf4\uff0c\u8fd9\u4e9b\u529f\u80fd\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002\u800c Prometheus \u5df2\u7ecf\u5b9e\u73b0\u4e86\u4f7f\u7528\u8fd9\u4e9b\u529f\u80fd\u7684\u5de5\u5177\u6846\u67b6\u3002\u6211\u4eec\u53ea\u8981\u80fd\u4ece\u88ab\u76d1\u63a7\u7cfb\u7edf\u4e2d\u83b7\u53d6\u5230\u76d1\u63a7\u6570\u636e\uff0c\u5c31\u53ef\u4ee5\u7528 Prometheus \u6765\u5b9e\u73b0\u8fd0\u7ef4\u76d1\u63a7\u3002 Prometheus \u6b63\u597d\u63d0\u4f9b\u4e86\u63d2\u4ef6\u529f\u80fd\u6765\u5b9e\u73b0\u5bf9\u4e00\u4e2a\u7cfb\u7edf\u7684\u76d1\u63a7\uff0c\u6211\u4eec\u628a\u63d2\u4ef6\u79f0\u4e3a exporter\uff0c\u6bcf\u4e00\u4e2a exporter \u5b9e\u9645\u662f\u4e00\u4e2a\u91c7\u96c6\u76d1\u63a7\u6570\u636e\u7684\u7ec4\u4ef6\u3002exporter \u91c7\u96c6\u7684\u6570\u636e\u683c\u5f0f\u7b26\u5408 Prometheus \u7684\u8981\u6c42\uff0cPrometheus \u83b7\u53d6\u8fd9\u4e9b\u6570\u636e\u540e\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u5c55\u793a\u548c\u4fdd\u5b58\u4e86\u3002 Redis-exporter \u5c31\u662f\u7528\u6765\u76d1\u63a7 Redis \u7684\uff0c\u5b83\u5c06 INFO \u547d\u4ee4\u76d1\u63a7\u5230\u7684\u8fd0\u884c\u72b6\u6001\u548c\u5404\u79cd\u7edf\u8ba1\u4fe1\u606f\u63d0\u4f9b\u7ed9 Prometheus\uff0c \u4ece\u800c\u8fdb\u884c\u53ef\u89c6\u5316\u5c55\u793a\u548c\u62a5\u8b66\u8bbe\u7f6e\u3002\u76ee\u524d\uff0cRedis-exporter \u53ef\u4ee5\u652f\u6301 Redis 2.0 \u81f3 6.0 \u7248\u672c\uff0c\u9002\u7528\u8303\u56f4\u6bd4\u8f83\u5e7f\u3002 \u9664\u4e86\u83b7\u53d6 Redis \u5b9e\u4f8b\u7684\u8fd0\u884c\u72b6\u6001\uff0c Redis-exporter \u8fd8\u53ef\u4ee5\u76d1\u63a7\u952e\u503c\u5bf9\u7684\u5927\u5c0f\u548c\u96c6\u5408\u7c7b\u578b\u6570\u636e\u7684\u5143\u7d20\u4e2a\u6570\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u5728\u8fd0\u884c Redis-exporter \u65f6\uff0c\u4f7f\u7528 check-keys \u7684\u547d\u4ee4\u884c\u9009\u9879\u6765\u5b9e\u73b0\u3002 \u6211\u4eec\u53ef\u4ee5\u5f00\u53d1\u4e00\u4e2a Lua \u811a\u672c\uff0c\u5b9a\u5236\u5316\u91c7\u96c6\u6240\u9700\u76d1\u63a7\u7684\u6570\u636e\u3002\u7136\u540e\uff0c\u6211\u4eec\u4f7f\u7528 scripts \u547d\u4ee4\u884c\u9009\u9879\uff0c\u8ba9 Redis-exporter \u8fd0\u884c\u8fd9\u4e2a\u7279\u5b9a\u7684\u811a\u672c\uff0c\u4ece\u800c\u53ef\u4ee5\u6ee1\u8db3\u4e1a\u52a1\u5c42\u7684\u591a\u6837\u5316\u76d1\u63a7\u9700\u6c42\u3002 Redis alerts Redis down Missing backup Out of memory Replication broken Too many connections Not enough connections Not enough connections \u6700\u540e\uff0c\u6211\u8fd8\u60f3\u518d\u7ed9\u4f60\u5206\u4eab\u4e24\u4e2a\u5c0f\u5de5\u5177\uff1a redis-stat \u548c Redis Live \u3002\u8ddf Redis-exporter \u76f8\u6bd4\uff0c\u8fd9\u4e24\u4e2a\u90fd\u662f\u8f7b\u91cf\u7ea7\u7684\u76d1\u63a7\u5de5\u5177\u3002\u5b83\u4eec\u5206\u522b\u662f\u7528 Ruby \u548c Python \u5f00\u53d1\u7684\uff0c\u4e5f\u662f\u5c06 INFO \u547d\u4ee4\u63d0\u4f9b\u7684\u5b9e\u4f8b\u8fd0\u884c\u72b6\u6001\u4fe1\u606f\u53ef\u89c6\u5316\u5c55\u793a\u3002\u867d\u7136\u8fd9\u4e24\u4e2a\u5de5\u5177\u76ee\u524d\u5df2\u7ecf\u5f88\u5c11\u66f4\u65b0\u4e86. 3\u3001\u6570\u636e\u8fc1\u79fb\u5de5\u5177 Redis-shake \u6709\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u5728\u4e0d\u540c\u7684\u5b9e\u4f8b\u95f4\u8fc1\u79fb\u6570\u636e\u3002\u76ee\u524d\uff0c\u6bd4\u8f83\u5e38\u7528\u7684\u4e00\u4e2a\u6570\u636e\u8fc1\u79fb\u5de5\u5177\u662f Redis-shake \uff0c\u8fd9\u662f\u963f\u91cc\u4e91 Redis \u548c MongoDB \u56e2\u961f\u5f00\u53d1\u7684\u4e00\u4e2a\u7528\u4e8e Redis \u6570\u636e\u540c\u6b65\u7684\u5de5\u5177\u3002 Redis-shake \u7684\u57fa\u672c\u8fd0\u884c\u539f\u7406\uff0c\u662f\u5148\u542f\u52a8 Redis-shake \u8fdb\u7a0b\uff0c\u8fd9\u4e2a\u8fdb\u7a0b\u6a21\u62df\u4e86\u4e00\u4e2a Redis \u5b9e\u4f8b\u3002\u7136\u540e\uff0cRedis-shake \u8fdb\u7a0b\u548c\u6570\u636e\u8fc1\u51fa\u7684\u6e90\u5b9e\u4f8b\u8fdb\u884c\u6570\u636e\u7684\u5168\u91cf\u540c\u6b65\u3002 \u6e90\u5b9e\u4f8b\u76f8\u5f53\u4e8e\u4e3b\u5e93\uff0cRedis-shake \u76f8\u5f53\u4e8e\u4ece\u5e93\uff0c\u6e90\u5b9e\u4f8b\u5148\u628a RDB \u6587\u4ef6\u4f20\u8f93\u7ed9 Redis-shake Redis-shake \u4f1a\u628a RDB \u6587\u4ef6\u53d1\u9001\u7ed9\u76ee\u7684\u5b9e\u4f8b\u3002 \u63a5\u7740\uff0c\u6e90\u5b9e\u4f8b\u4f1a\u518d\u628a\u589e\u91cf\u547d\u4ee4\u53d1\u9001\u7ed9 Redis-shake\uff0cRedis-shake \u8d1f\u8d23\u628a\u8fd9\u4e9b\u589e\u91cf\u547d\u4ee4\u518d\u540c\u6b65\u7ed9\u76ee\u7684\u5b9e\u4f8b\u3002 Redis-shake \u8fdb\u884c\u6570\u636e\u8fc1\u79fb\u7684\u8fc7\u7a0b\uff1a Redis-shake \u7684\u4e00\u5927\u4f18\u52bf\uff0c\u5c31\u662f\u652f\u6301\u591a\u79cd\u7c7b\u578b\u7684\u8fc1\u79fb\u3002 \u9996\u5148\uff0c\u5b83\u65e2\u652f\u6301\u5355\u4e2a\u5b9e\u4f8b\u95f4\u7684\u6570\u636e\u8fc1\u79fb\uff0c\u4e5f\u652f\u6301\u96c6\u7fa4\u5230\u96c6\u7fa4\u95f4\u7684\u6570\u636e\u8fc1\u79fb\u3002 \u5176\u6b21\uff0c\u6709\u7684 Redis \u5207\u7247\u96c6\u7fa4\uff08\u4f8b\u5982 Codis\uff09\u4f1a\u4f7f\u7528 proxy \u63a5\u6536\u8bf7\u6c42\u64cd\u4f5c\uff0cRedis-shake \u4e5f\u540c\u6837\u652f\u6301\u548c proxy \u8fdb\u884c\u6570\u636e\u8fc1\u79fb\u3002 \u53e6\u5916\uff0c\u56e0\u4e3a Redis-shake \u662f\u963f\u91cc\u4e91\u56e2\u961f\u5f00\u53d1\u7684\uff0c\u6240\u4ee5\uff0c\u9664\u4e86\u652f\u6301\u5f00\u6e90\u7684 Redis \u7248\u672c\u4ee5\u5916\uff0cRedis-shake \u8fd8\u652f\u6301\u4e91\u4e0b\u7684 Redis \u5b9e\u4f8b\u548c\u4e91\u4e0a\u7684 Redis \u5b9e\u4f8b\u8fdb\u884c\u8fc1\u79fb\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5b9e\u73b0 Redis \u670d\u52a1\u4e0a\u4e91\u7684\u76ee\u6807\u3002 \u5728\u6570\u636e\u8fc1\u79fb\u540e\uff0c\u6211\u4eec\u901a\u5e38\u9700\u8981\u5bf9\u6bd4\u6e90\u5b9e\u4f8b\u548c\u76ee\u7684\u5b9e\u4f8b\u4e2d\u7684\u6570\u636e\u662f\u5426\u4e00\u81f4\u3002 \u5982\u679c\u6709\u4e0d\u4e00\u81f4\u7684\u6570\u636e\uff0c\u6211\u4eec\u9700\u8981\u628a\u5b83\u4eec\u627e\u51fa\u6765\uff0c\u4ece\u76ee\u7684\u5b9e\u4f8b\u4e2d\u5254\u9664\uff0c\u6216\u8005\u662f\u518d\u6b21\u8fc1\u79fb\u8fd9\u4e9b\u4e0d\u4e00\u81f4\u7684\u6570\u636e\u3002 \u8fd9\u91cc\uff0c\u6211\u5c31\u8981\u518d\u7ed9\u4f60\u4ecb\u7ecd\u4e00\u4e2a\u6570\u636e\u4e00\u81f4\u6027\u6bd4\u5bf9\u7684\u5de5\u5177\u4e86\uff0c\u5c31\u662f\u963f\u91cc\u4e91\u56e2\u961f\u5f00\u53d1\u7684 Redis-full-check \u3002 Redis-full-check \u7684\u5de5\u4f5c\u539f\u7406\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u5bf9\u6e90\u5b9e\u4f8b\u548c\u76ee\u7684\u5b9e\u4f8b\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u5168\u91cf\u6bd4\u5bf9\uff0c\u4ece\u800c\u5b8c\u6210\u6570\u636e\u6821\u9a8c\u3002\u4e0d\u8fc7\uff0c\u4e3a\u4e86\u964d\u4f4e\u6570\u636e\u6821\u9a8c\u7684\u6bd4\u5bf9\u5f00\u9500\uff0c Redis-full-check \u91c7\u7528\u4e86\u591a\u8f6e\u6bd4\u8f83\u7684\u65b9\u6cd5\u3002 \u5728\u7b2c\u4e00\u8f6e\u6821\u9a8c\u65f6\uff0c Redis-full-check \u4f1a\u627e\u51fa\u5728\u6e90\u5b9e\u4f8b\u4e0a\u7684\u6240\u6709 key \uff0c\u7136\u540e\u4ece\u6e90\u5b9e\u4f8b\u548c\u76ee\u7684\u5b9e\u4f8b\u4e2d\u628a\u76f8\u5e94\u7684\u503c\u4e5f\u90fd\u67e5\u627e\u51fa\u6765\uff0c\u8fdb\u884c\u6bd4\u5bf9\u3002 \u7b2c\u4e00\u6b21\u6bd4\u5bf9\u540e\uff0c redis-full-check \u4f1a\u628a\u76ee\u7684\u5b9e\u4f8b\u4e2d\u548c\u6e90\u5b9e\u4f8b\u4e0d\u4e00\u81f4\u7684\u6570\u636e\uff0c\u8bb0\u5f55\u5230 sqlite \u6570\u636e\u5e93\u4e2d\u3002 \u4ece\u7b2c\u4e8c\u8f6e\u6821\u9a8c\u5f00\u59cb\uff0c Redis-full-check \u53ea\u6bd4\u8f83\u4e0a\u4e00\u8f6e\u7ed3\u675f\u540e\u8bb0\u5f55\u5728\u6570\u636e\u5e93\u4e2d\u7684\u4e0d\u4e00\u81f4\u7684\u6570\u636e\u3002 \u4e3a\u4e86\u907f\u514d\u5bf9\u5b9e\u4f8b\u7684\u6b63\u5e38\u8bf7\u6c42\u5904\u7406\u9020\u6210\u5f71\u54cd\uff0cRedis-full-check \u5728\u6bcf\u4e00\u8f6e\u6bd4\u5bf9\u7ed3\u675f\u540e\uff0c\u4f1a\u6682\u505c\u4e00\u6bb5\u65f6\u95f4\u3002\u968f\u7740 Redis-shake \u589e\u91cf\u540c\u6b65\u7684\u8fdb\u884c\uff0c\u6e90\u5b9e\u4f8b\u548c\u76ee\u7684\u5b9e\u4f8b\u4e2d\u7684\u4e0d\u4e00\u81f4\u6570\u636e\u4e5f\u4f1a\u9010\u6b65\u51cf\u5c11\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u6821\u9a8c\u6bd4\u5bf9\u7684\u8f6e\u6570\u4e0d\u7528\u5f88\u591a\u3002 \u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u8bbe\u7f6e\u6bd4\u5bf9\u7684\u8f6e\u6570\u3002\u5177\u4f53\u7684\u65b9\u6cd5\u662f\uff0c\u5728\u8fd0\u884c redis-full-check \u547d\u4ee4\u65f6\uff0c\u628a\u53c2\u6570 comparetimes \u7684\u503c\u8bbe\u7f6e\u4e3a\u6211\u4eec\u60f3\u8981\u6bd4\u5bf9\u7684\u8f6e\u6570\u3002 \u7b49\u5230\u6240\u6709\u8f6e\u6570\u90fd\u6bd4\u5bf9\u5b8c\u6210\u540e\uff0c\u6570\u636e\u5e93\u4e2d\u8bb0\u5f55\u7684\u6570\u636e\u5c31\u662f\u6e90\u5b9e\u4f8b\u548c\u76ee\u7684\u5b9e\u4f8b\u6700\u7ec8\u7684\u5dee\u5f02\u7ed3\u679c\u4e86\u3002 \u8fd9\u91cc\u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\u4e0b\uff0cRedis-full-check \u63d0\u4f9b\u4e86\u4e09\u79cd\u6bd4\u5bf9\u6a21\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 comparemode \u53c2\u6570\u8fdb\u884c\u8bbe\u7f6e\u3002comparemode \u53c2\u6570\u6709\u4e09\u79cd\u53d6\u503c\uff0c\u542b\u4e49\u5982\u4e0b\uff1a KeyOutline\uff0c\u53ea\u5bf9\u6bd4 key \u503c\u662f\u5426\u76f8\u7b49\uff1b ValueOutline\uff0c\u53ea\u5bf9\u6bd4 value \u503c\u7684\u957f\u5ea6\u662f\u5426\u76f8\u7b49\uff1b FullValue\uff0c\u5bf9\u6bd4 key \u503c\u3001value \u957f\u5ea6\u3001value \u503c\u662f\u5426\u76f8\u7b49\u3002 \u6211\u4eec\u5728\u5e94\u7528 Redis-full-check \u65f6\uff0c\u53ef\u4ee5\u6839\u636e\u4e1a\u52a1\u5bf9\u6570\u636e\u4e00\u81f4\u6027\u7a0b\u5ea6\u7684\u8981\u6c42\uff0c\u9009\u62e9\u76f8\u5e94\u7684\u6bd4\u5bf9\u6a21\u5f0f\u3002\u5982\u679c\u4e00\u81f4\u6027\u8981\u6c42\u9ad8\uff0c\u5c31\u628a comparemode \u53c2\u6570\u8bbe\u7f6e\u4e3a FullValue\u3002 4\u3001\u96c6\u7fa4\u7ba1\u7406\u5de5\u5177 CacheCloud CacheCloud \u662f\u641c\u72d0\u5f00\u53d1\u7684\u4e00\u4e2a\u9762\u5411 Redis \u8fd0\u7ef4\u7ba1\u7406\u7684\u4e91\u5e73\u53f0\uff0c \u5b83\u5b9e\u73b0\u4e86\u4e3b\u4ece\u96c6\u7fa4\u3001\u54e8\u5175\u96c6\u7fa4\u548c Redis Cluster \u7684\u81ea\u52a8\u90e8\u7f72\u548c\u7ba1\u7406\uff0c\u7528\u6237\u53ef\u4ee5\u76f4\u63a5\u5728\u5e73\u53f0\u7684\u7ba1\u7406\u754c\u9762\u4e0a\u8fdb\u884c\u64cd\u4f5c\u3002 \u9488\u5bf9\u5e38\u89c1\u7684\u96c6\u7fa4\u8fd0\u7ef4\u9700\u6c42\uff0cCacheCloud \u63d0\u4f9b\u4e86 5 \u4e2a\u8fd0\u7ef4\u64cd\u4f5c\u3002 \u4e0b\u7ebf\u5b9e\u4f8b\uff1a\u5173\u95ed\u5b9e\u4f8b\u4ee5\u53ca\u5b9e\u4f8b\u76f8\u5173\u7684\u76d1\u63a7\u4efb\u52a1\u3002 \u4e0a\u7ebf\u5b9e\u4f8b\uff1a\u91cd\u65b0\u542f\u52a8\u5df2\u4e0b\u7ebf\u7684\u5b9e\u4f8b\uff0c\u5e76\u8fdb\u884c\u76d1\u63a7\u3002 \u6dfb\u52a0\u4ece\u8282\u70b9\uff1a\u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\u7ed9\u4e3b\u8282\u70b9\u6dfb\u52a0\u4e00\u4e2a\u4ece\u8282\u70b9\u3002 \u6545\u969c\u5207\u6362\uff1a\u624b\u52a8\u5b8c\u6210 Redis Cluster \u4e3b\u4ece\u8282\u70b9\u7684\u6545\u969c\u8f6c\u79fb\u3002 \u914d\u7f6e\u7ba1\u7406\uff1a\u7528\u6237\u63d0\u4ea4\u914d\u7f6e\u4fee\u6539\u7684\u5de5\u5355\u540e\uff0c\u7ba1\u7406\u5458\u8fdb\u884c\u5ba1\u6838\uff0c\u5e76\u5b8c\u6210\u914d\u7f6e\u4fee\u6539\u3002 \u5f53\u7136\uff0c\u4f5c\u4e3a\u8fd0\u7ef4\u7ba1\u7406\u5e73\u53f0\uff0cCacheCloud \u9664\u4e86\u63d0\u4f9b\u8fd0\u7ef4\u64cd\u4f5c\u4ee5\u5916\uff0c\u8fd8\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u76d1\u63a7\u4fe1\u606f\u3002 CacheCloud \u4e0d\u4ec5\u4f1a\u6536\u96c6 INFO \u547d\u4ee4\u63d0\u4f9b\u7684\u5b9e\u4f8b\u5b9e\u65f6\u8fd0\u884c\u72b6\u6001\u4fe1\u606f\uff0c\u8fdb\u884c\u53ef\u89c6\u5316\u5c55\u793a\uff0c\u800c\u4e14\u8fd8\u4f1a\u628a\u5b9e\u4f8b\u8fd0\u884c\u72b6\u6001\u4fe1\u606f\u4fdd\u5b58\u4e0b\u6765\uff0c\u4f8b\u5982\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u3001\u5ba2\u6237\u7aef\u8fde\u63a5\u6570\u3001\u952e\u503c\u5bf9\u6570\u636e\u91cf\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5f53 Redis \u8fd0\u884c\u53d1\u751f\u95ee\u9898\u65f6\uff0c\u8fd0\u7ef4\u4eba\u5458\u53ef\u4ee5\u67e5\u8be2\u4fdd\u5b58\u7684\u5386\u53f2\u8bb0\u5f55\uff0c\u5e76\u7ed3\u5408\u5f53\u65f6\u7684\u8fd0\u884c\u72b6\u6001\u4fe1\u606f\u8fdb\u884c\u5206\u6790\u3002 5\u3001\u672c\u8282\u5c0f\u7ed3 Redis \u7684 INFO \u547d\u4ee4\uff0c\u8fd9\u4e2a\u547d\u4ee4\u662f\u76d1\u63a7\u5de5\u5177\u7684\u57fa\u7840\uff0c\u76d1\u63a7\u5de5\u5177\u90fd\u4f1a\u57fa\u4e8e INFO \u547d\u4ee4\u63d0\u4f9b\u7684\u4fe1\u606f\u8fdb\u884c\u4e8c\u6b21\u52a0\u5de5\u3002\u6211\u4eec\u8fd8\u5b66\u4e60\u4e86 3 \u79cd\u7528\u6765\u76d1\u63a7 Redis \u5b9e\u65f6\u8fd0\u884c\u72b6\u6001\u7684\u8fd0\u7ef4\u5de5\u5177\uff0c\u5206\u522b\u662f Redis-exporter \u3001 redis-stat \u548c Redis Live \u3002 \u5173\u4e8e\u6570\u636e\u8fc1\u79fb\uff0c\u6211\u4eec\u65e2\u53ef\u4ee5\u4f7f\u7528 Redis-shake \u5de5\u5177\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 RDB \u6587\u4ef6\u6216\u662f AOF \u6587\u4ef6\u8fdb\u884c\u8fc1\u79fb\u3002 Redis INFO \u4fe1\u606f\u770b\u4f3c\u7b80\u5355\uff0c\u4f46\u662f\u8fd9\u4e9b\u4fe1\u606f\u8bb0\u5f55\u7740 Redis \u8fd0\u884c\u65f6\u7684\u5404\u79cd\u72b6\u6001\u6570\u636e\uff0c\u5982\u679c\u6211\u4eec\u628a\u8fd9\u4e9b\u6570\u636e\u91c7\u96c6\u5230\u5e76\u76d1\u63a7\u5230\u4f4d\uff0c80% \u7684\u5f02\u5e38\u60c5\u51b5\u80fd\u5728\u7b2c\u4e00\u65f6\u95f4\u53d1\u73b0\u3002 \u673a\u5668\u7684 CPU\u3001\u5185\u5b58\u3001\u7f51\u7edc\u3001\u78c1\u76d8\uff0c\u90fd\u5f71\u54cd\u7740 Redis \u7684\u6027\u80fd\u3002 \u76d1\u63a7\u65f6\u6211\u4eec\u6700\u597d\u91cd\u70b9\u5173\u6ce8\u4ee5\u4e0b\u6307\u6807\uff1a \u5ba2\u6237\u7aef\u76f8\u5173\uff1a\u5f53\u524d\u8fde\u63a5\u6570\u3001\u603b\u8fde\u63a5\u6570\u3001\u8f93\u5165\u7f13\u51b2\u5927\u5c0f\u3001OPS CPU\u76f8\u5173\uff1a\u4e3b\u8fdb\u7a0b CPU \u4f7f\u7528\u7387\u3001\u5b50\u8fdb\u7a0b CPU \u4f7f\u7528\u7387 \u5185\u5b58\u76f8\u5173\uff1a\u5f53\u524d\u5185\u5b58\u3001\u5cf0\u503c\u5185\u5b58\u3001\u5185\u5b58\u788e\u7247\u7387 \u7f51\u7edc\u76f8\u5173\uff1a\u8f93\u5165\u3001\u8f93\u51fa\u7f51\u7edc\u6d41\u91cf \u6301\u4e45\u5316\u76f8\u5173\uff1a\u6700\u540e\u4e00\u6b21 RDB \u65f6\u95f4\u3001RDB fork \u8017\u65f6\u3001\u6700\u540e\u4e00\u6b21 AOF rewrite \u65f6\u95f4\u3001AOF rewrite \u8017\u65f6 key \u76f8\u5173\uff1a\u8fc7\u671f key \u6570\u91cf\u3001\u6dd8\u6c70 key \u6570\u91cf\u3001key \u547d\u4e2d\u7387 \u590d\u5236\u76f8\u5173\uff1a\u4e3b\u4ece\u8282\u70b9\u590d\u5236\u504f\u79fb\u91cf\u3001\u4e3b\u5e93\u590d\u5236\u7f13\u51b2\u533a","title":"\u7b2c\u56db\u8282 Redis\u8fd0\u7ef4\u5de5\u5177"},{"location":"chap8/4redis_opt_tools/#redis","text":"","title":"\u7b2c\u56db\u8282 Redis\u8fd0\u7ef4\u5de5\u5177"},{"location":"chap8/4redis_opt_tools/#1info","text":"Redis \u672c\u8eab\u63d0\u4f9b\u7684 INFO \u547d\u4ee4\u4f1a\u8fd4\u56de\u4e30\u5bcc\u7684\u5b9e\u4f8b\u8fd0\u884c\u76d1\u63a7\u4fe1\u606f\uff0c\u8fd9\u4e2a\u547d\u4ee4\u662f Redis \u76d1\u63a7\u5de5\u5177\u7684\u57fa\u7840\u3002 Redis\u6700\u57fa\u672c\u7684\u76d1\u63a7\u547d\u4ee4\uff1aINFO\u547d\u4ee4 \u5bf9\u5e94INFO\u547d\u4ee4\u7684section\u53c2\u6570\u6709\uff1a cpu\u3001memory\u3001stat\u3001commandstat\u3001server\u3001client\u3001repliation\u3001cluster\u3001modules\u7b49\u7b49 INFO \u547d\u4ee4\u5728\u4f7f\u7528\u65f6\uff0c\u53ef\u4ee5\u5e26\u4e00\u4e2a\u53c2\u6570 section\uff0c\u8fd9\u4e2a\u53c2\u6570\u7684\u53d6\u503c\u6709\u597d\u51e0\u79cd\uff0c\u76f8\u5e94\u7684\uff0cINFO \u547d\u4ee4\u4e5f\u4f1a\u8fd4\u56de\u4e0d\u540c\u7c7b\u578b\u7684\u76d1\u63a7\u4fe1\u606f\u3002 \u628a INFO \u547d\u4ee4\u7684\u8fd4\u56de\u4fe1\u606f\u5206\u6210 5 \u5927\u7c7b\uff0c\u5176\u4e2d\uff0c\u6709\u7684\u7c7b\u522b\u5f53\u4e2d\u53c8\u5305\u542b\u4e86\u4e0d\u540c\u7684\u76d1\u63a7\u5185\u5bb9\uff0c\u5982\u4e0b\u8868\u6240\u793a\uff1a \u5728\u76d1\u63a7 Redis \u8fd0\u884c\u72b6\u6001\u65f6\uff0cINFO \u547d\u4ee4\u8fd4\u56de\u7684\u7ed3\u679c\u975e\u5e38\u6709\u7528\u3002 \u5982\u679c\u4f60\u60f3\u4e86\u89e3 INFO \u547d\u4ee4\u7684\u6240\u6709\u53c2\u6570\u8fd4\u56de\u7ed3\u679c\u7684\u8be6\u7ec6\u542b\u4e49\uff0c\u53ef\u4ee5\u67e5\u770b Redis\u5b98\u7f51\u7684\u4ecb\u7ecd \u3002 \u51e0\u4e2a\u8fd0\u7ef4\u65f6\u9700\u8981\u91cd\u70b9\u5173\u6ce8\u7684\u53c2\u6570\u4ee5\u53ca\u5b83\u4eec\u7684\u91cd\u8981\u8fd4\u56de\u7ed3\u679c\u3002 \u9996\u5148\uff0c \u65e0\u8bba\u4f60\u662f\u8fd0\u884c\u5355\u5b9e\u4f8b\u6216\u662f\u96c6\u7fa4\uff0c\u6211\u5efa\u8bae\u4f60\u91cd\u70b9\u5173\u6ce8\u4e00\u4e0b stat\u3001commandstat\u3001cpu \u548c memory \u8fd9\u56db\u4e2a\u53c2\u6570\u7684\u8fd4\u56de\u7ed3\u679c \u8fd9\u91cc\u9762\u5305\u542b\u4e86\u547d\u4ee4\u7684\u6267\u884c\u60c5\u51b5\uff08\u6bd4\u5982\u547d\u4ee4\u7684\u6267\u884c\u6b21\u6570\u548c\u6267\u884c\u65f6\u95f4\u3001\u547d\u4ee4\u4f7f\u7528\u7684 CPU \u8d44\u6e90\uff09 \u5185\u5b58\u8d44\u6e90\u7684\u4f7f\u7528\u60c5\u51b5\uff08\u6bd4\u5982\u5185\u5b58\u5df2\u4f7f\u7528\u91cf\u3001\u5185\u5b58\u788e\u7247\u7387\uff09 CPU \u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u7b49 \u5f53\u4f60\u542f\u7528 RDB \u6216 AOF \u529f\u80fd\u65f6\uff0c\u4f60\u5c31\u9700\u8981\u91cd\u70b9\u5173\u6ce8\u4e0b persistence \u53c2\u6570\u7684\u8fd4\u56de\u7ed3\u679c\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u5b83\u67e5\u770b\u5230 RDB \u6216\u8005 AOF \u7684\u6267\u884c\u60c5\u51b5\u3002 \u5982\u679c\u4f60\u5728\u4f7f\u7528\u4e3b\u4ece\u96c6\u7fa4\uff0c\u5c31\u8981\u91cd\u70b9\u5173\u6ce8\u4e0b replication \u53c2\u6570\u7684\u8fd4\u56de\u7ed3\u679c\uff0c\u8fd9\u91cc\u9762\u5305\u542b\u4e86\u4e3b\u4ece\u540c\u6b65\u7684\u5b9e\u65f6\u72b6\u6001\u3002 \u4e0d\u8fc7\uff0cINFO \u547d\u4ee4\u53ea\u662f\u63d0\u4f9b\u4e86\u6587\u672c\u5f62\u5f0f\u7684\u76d1\u63a7\u7ed3\u679c\uff0c\u5e76\u6ca1\u6709\u53ef\u89c6\u5316\uff0c\u6240\u4ee5\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e9b\u7b2c\u4e09\u65b9\u5f00\u6e90\u5de5\u5177\uff0c\u5c06 INFO \u547d\u4ee4\u7684\u8fd4\u56de\u7ed3\u679c\u53ef\u89c6\u5316\u3002","title":"1\u3001\u6700\u57fa\u672c\u7684\u76d1\u63a7\u547d\u4ee4\uff1aINFO \u547d\u4ee4"},{"location":"chap8/4redis_opt_tools/#2-prometheus-redis-exporter","text":"Prometheus\u662f\u4e00\u5957\u5f00\u6e90\u7684\u7cfb\u7edf\u76d1\u63a7\u62a5\u8b66\u6846\u67b6\u3002\u5b83\u7684\u6838\u5fc3\u529f\u80fd\u662f\u4ece\u88ab\u76d1\u63a7\u7cfb\u7edf\u4e2d\u62c9\u53d6\u76d1\u63a7\u6570\u636e\uff0c\u7ed3\u5408Grafana\u5de5\u5177\uff0c\u8fdb\u884c\u53ef\u89c6\u5316\u5c55\u793a\u3002\u800c\u4e14\uff0c\u76d1\u63a7\u6570\u636e\u53ef\u4ee5\u4fdd\u5b58\u5230\u65f6\u5e8f\u6570\u636e\u5e93\u4e2d\uff0c\u4ee5\u4fbf\u8fd0\u7ef4\u4eba\u5458\u8fdb\u884c\u5386\u53f2\u67e5\u8be2\u3002\u540c\u65f6\uff0cPrometheus \u4f1a\u68c0\u6d4b\u7cfb\u7edf\u7684\u76d1\u63a7\u6307\u6807\u662f\u5426\u8d85\u8fc7\u4e86\u9884\u8bbe\u7684\u9608\u503c\uff0c\u4e00\u65e6\u8d85\u8fc7\u9608\u503c\uff0cPrometheus \u5c31\u4f1a\u89e6\u53d1\u62a5\u8b66\u3002 \u5bf9\u4e8e\u7cfb\u7edf\u7684\u65e5\u5e38\u8fd0\u7ef4\u7ba1\u7406\u6765\u8bf4\uff0c\u8fd9\u4e9b\u529f\u80fd\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002\u800c Prometheus \u5df2\u7ecf\u5b9e\u73b0\u4e86\u4f7f\u7528\u8fd9\u4e9b\u529f\u80fd\u7684\u5de5\u5177\u6846\u67b6\u3002\u6211\u4eec\u53ea\u8981\u80fd\u4ece\u88ab\u76d1\u63a7\u7cfb\u7edf\u4e2d\u83b7\u53d6\u5230\u76d1\u63a7\u6570\u636e\uff0c\u5c31\u53ef\u4ee5\u7528 Prometheus \u6765\u5b9e\u73b0\u8fd0\u7ef4\u76d1\u63a7\u3002 Prometheus \u6b63\u597d\u63d0\u4f9b\u4e86\u63d2\u4ef6\u529f\u80fd\u6765\u5b9e\u73b0\u5bf9\u4e00\u4e2a\u7cfb\u7edf\u7684\u76d1\u63a7\uff0c\u6211\u4eec\u628a\u63d2\u4ef6\u79f0\u4e3a exporter\uff0c\u6bcf\u4e00\u4e2a exporter \u5b9e\u9645\u662f\u4e00\u4e2a\u91c7\u96c6\u76d1\u63a7\u6570\u636e\u7684\u7ec4\u4ef6\u3002exporter \u91c7\u96c6\u7684\u6570\u636e\u683c\u5f0f\u7b26\u5408 Prometheus \u7684\u8981\u6c42\uff0cPrometheus \u83b7\u53d6\u8fd9\u4e9b\u6570\u636e\u540e\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u5c55\u793a\u548c\u4fdd\u5b58\u4e86\u3002 Redis-exporter \u5c31\u662f\u7528\u6765\u76d1\u63a7 Redis \u7684\uff0c\u5b83\u5c06 INFO \u547d\u4ee4\u76d1\u63a7\u5230\u7684\u8fd0\u884c\u72b6\u6001\u548c\u5404\u79cd\u7edf\u8ba1\u4fe1\u606f\u63d0\u4f9b\u7ed9 Prometheus\uff0c \u4ece\u800c\u8fdb\u884c\u53ef\u89c6\u5316\u5c55\u793a\u548c\u62a5\u8b66\u8bbe\u7f6e\u3002\u76ee\u524d\uff0cRedis-exporter \u53ef\u4ee5\u652f\u6301 Redis 2.0 \u81f3 6.0 \u7248\u672c\uff0c\u9002\u7528\u8303\u56f4\u6bd4\u8f83\u5e7f\u3002 \u9664\u4e86\u83b7\u53d6 Redis \u5b9e\u4f8b\u7684\u8fd0\u884c\u72b6\u6001\uff0c Redis-exporter \u8fd8\u53ef\u4ee5\u76d1\u63a7\u952e\u503c\u5bf9\u7684\u5927\u5c0f\u548c\u96c6\u5408\u7c7b\u578b\u6570\u636e\u7684\u5143\u7d20\u4e2a\u6570\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u5728\u8fd0\u884c Redis-exporter \u65f6\uff0c\u4f7f\u7528 check-keys \u7684\u547d\u4ee4\u884c\u9009\u9879\u6765\u5b9e\u73b0\u3002 \u6211\u4eec\u53ef\u4ee5\u5f00\u53d1\u4e00\u4e2a Lua \u811a\u672c\uff0c\u5b9a\u5236\u5316\u91c7\u96c6\u6240\u9700\u76d1\u63a7\u7684\u6570\u636e\u3002\u7136\u540e\uff0c\u6211\u4eec\u4f7f\u7528 scripts \u547d\u4ee4\u884c\u9009\u9879\uff0c\u8ba9 Redis-exporter \u8fd0\u884c\u8fd9\u4e2a\u7279\u5b9a\u7684\u811a\u672c\uff0c\u4ece\u800c\u53ef\u4ee5\u6ee1\u8db3\u4e1a\u52a1\u5c42\u7684\u591a\u6837\u5316\u76d1\u63a7\u9700\u6c42\u3002 Redis alerts Redis down Missing backup Out of memory Replication broken Too many connections Not enough connections Not enough connections \u6700\u540e\uff0c\u6211\u8fd8\u60f3\u518d\u7ed9\u4f60\u5206\u4eab\u4e24\u4e2a\u5c0f\u5de5\u5177\uff1a redis-stat \u548c Redis Live \u3002\u8ddf Redis-exporter \u76f8\u6bd4\uff0c\u8fd9\u4e24\u4e2a\u90fd\u662f\u8f7b\u91cf\u7ea7\u7684\u76d1\u63a7\u5de5\u5177\u3002\u5b83\u4eec\u5206\u522b\u662f\u7528 Ruby \u548c Python \u5f00\u53d1\u7684\uff0c\u4e5f\u662f\u5c06 INFO \u547d\u4ee4\u63d0\u4f9b\u7684\u5b9e\u4f8b\u8fd0\u884c\u72b6\u6001\u4fe1\u606f\u53ef\u89c6\u5316\u5c55\u793a\u3002\u867d\u7136\u8fd9\u4e24\u4e2a\u5de5\u5177\u76ee\u524d\u5df2\u7ecf\u5f88\u5c11\u66f4\u65b0\u4e86.","title":"2\u3001\u9762\u5411 Prometheus \u7684 Redis-exporter \u76d1\u63a7"},{"location":"chap8/4redis_opt_tools/#3-redis-shake","text":"\u6709\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u5728\u4e0d\u540c\u7684\u5b9e\u4f8b\u95f4\u8fc1\u79fb\u6570\u636e\u3002\u76ee\u524d\uff0c\u6bd4\u8f83\u5e38\u7528\u7684\u4e00\u4e2a\u6570\u636e\u8fc1\u79fb\u5de5\u5177\u662f Redis-shake \uff0c\u8fd9\u662f\u963f\u91cc\u4e91 Redis \u548c MongoDB \u56e2\u961f\u5f00\u53d1\u7684\u4e00\u4e2a\u7528\u4e8e Redis \u6570\u636e\u540c\u6b65\u7684\u5de5\u5177\u3002 Redis-shake \u7684\u57fa\u672c\u8fd0\u884c\u539f\u7406\uff0c\u662f\u5148\u542f\u52a8 Redis-shake \u8fdb\u7a0b\uff0c\u8fd9\u4e2a\u8fdb\u7a0b\u6a21\u62df\u4e86\u4e00\u4e2a Redis \u5b9e\u4f8b\u3002\u7136\u540e\uff0cRedis-shake \u8fdb\u7a0b\u548c\u6570\u636e\u8fc1\u51fa\u7684\u6e90\u5b9e\u4f8b\u8fdb\u884c\u6570\u636e\u7684\u5168\u91cf\u540c\u6b65\u3002 \u6e90\u5b9e\u4f8b\u76f8\u5f53\u4e8e\u4e3b\u5e93\uff0cRedis-shake \u76f8\u5f53\u4e8e\u4ece\u5e93\uff0c\u6e90\u5b9e\u4f8b\u5148\u628a RDB \u6587\u4ef6\u4f20\u8f93\u7ed9 Redis-shake Redis-shake \u4f1a\u628a RDB \u6587\u4ef6\u53d1\u9001\u7ed9\u76ee\u7684\u5b9e\u4f8b\u3002 \u63a5\u7740\uff0c\u6e90\u5b9e\u4f8b\u4f1a\u518d\u628a\u589e\u91cf\u547d\u4ee4\u53d1\u9001\u7ed9 Redis-shake\uff0cRedis-shake \u8d1f\u8d23\u628a\u8fd9\u4e9b\u589e\u91cf\u547d\u4ee4\u518d\u540c\u6b65\u7ed9\u76ee\u7684\u5b9e\u4f8b\u3002 Redis-shake \u8fdb\u884c\u6570\u636e\u8fc1\u79fb\u7684\u8fc7\u7a0b\uff1a Redis-shake \u7684\u4e00\u5927\u4f18\u52bf\uff0c\u5c31\u662f\u652f\u6301\u591a\u79cd\u7c7b\u578b\u7684\u8fc1\u79fb\u3002 \u9996\u5148\uff0c\u5b83\u65e2\u652f\u6301\u5355\u4e2a\u5b9e\u4f8b\u95f4\u7684\u6570\u636e\u8fc1\u79fb\uff0c\u4e5f\u652f\u6301\u96c6\u7fa4\u5230\u96c6\u7fa4\u95f4\u7684\u6570\u636e\u8fc1\u79fb\u3002 \u5176\u6b21\uff0c\u6709\u7684 Redis \u5207\u7247\u96c6\u7fa4\uff08\u4f8b\u5982 Codis\uff09\u4f1a\u4f7f\u7528 proxy \u63a5\u6536\u8bf7\u6c42\u64cd\u4f5c\uff0cRedis-shake \u4e5f\u540c\u6837\u652f\u6301\u548c proxy \u8fdb\u884c\u6570\u636e\u8fc1\u79fb\u3002 \u53e6\u5916\uff0c\u56e0\u4e3a Redis-shake \u662f\u963f\u91cc\u4e91\u56e2\u961f\u5f00\u53d1\u7684\uff0c\u6240\u4ee5\uff0c\u9664\u4e86\u652f\u6301\u5f00\u6e90\u7684 Redis \u7248\u672c\u4ee5\u5916\uff0cRedis-shake \u8fd8\u652f\u6301\u4e91\u4e0b\u7684 Redis \u5b9e\u4f8b\u548c\u4e91\u4e0a\u7684 Redis \u5b9e\u4f8b\u8fdb\u884c\u8fc1\u79fb\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5b9e\u73b0 Redis \u670d\u52a1\u4e0a\u4e91\u7684\u76ee\u6807\u3002 \u5728\u6570\u636e\u8fc1\u79fb\u540e\uff0c\u6211\u4eec\u901a\u5e38\u9700\u8981\u5bf9\u6bd4\u6e90\u5b9e\u4f8b\u548c\u76ee\u7684\u5b9e\u4f8b\u4e2d\u7684\u6570\u636e\u662f\u5426\u4e00\u81f4\u3002 \u5982\u679c\u6709\u4e0d\u4e00\u81f4\u7684\u6570\u636e\uff0c\u6211\u4eec\u9700\u8981\u628a\u5b83\u4eec\u627e\u51fa\u6765\uff0c\u4ece\u76ee\u7684\u5b9e\u4f8b\u4e2d\u5254\u9664\uff0c\u6216\u8005\u662f\u518d\u6b21\u8fc1\u79fb\u8fd9\u4e9b\u4e0d\u4e00\u81f4\u7684\u6570\u636e\u3002 \u8fd9\u91cc\uff0c\u6211\u5c31\u8981\u518d\u7ed9\u4f60\u4ecb\u7ecd\u4e00\u4e2a\u6570\u636e\u4e00\u81f4\u6027\u6bd4\u5bf9\u7684\u5de5\u5177\u4e86\uff0c\u5c31\u662f\u963f\u91cc\u4e91\u56e2\u961f\u5f00\u53d1\u7684 Redis-full-check \u3002 Redis-full-check \u7684\u5de5\u4f5c\u539f\u7406\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u5bf9\u6e90\u5b9e\u4f8b\u548c\u76ee\u7684\u5b9e\u4f8b\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u5168\u91cf\u6bd4\u5bf9\uff0c\u4ece\u800c\u5b8c\u6210\u6570\u636e\u6821\u9a8c\u3002\u4e0d\u8fc7\uff0c\u4e3a\u4e86\u964d\u4f4e\u6570\u636e\u6821\u9a8c\u7684\u6bd4\u5bf9\u5f00\u9500\uff0c Redis-full-check \u91c7\u7528\u4e86\u591a\u8f6e\u6bd4\u8f83\u7684\u65b9\u6cd5\u3002 \u5728\u7b2c\u4e00\u8f6e\u6821\u9a8c\u65f6\uff0c Redis-full-check \u4f1a\u627e\u51fa\u5728\u6e90\u5b9e\u4f8b\u4e0a\u7684\u6240\u6709 key \uff0c\u7136\u540e\u4ece\u6e90\u5b9e\u4f8b\u548c\u76ee\u7684\u5b9e\u4f8b\u4e2d\u628a\u76f8\u5e94\u7684\u503c\u4e5f\u90fd\u67e5\u627e\u51fa\u6765\uff0c\u8fdb\u884c\u6bd4\u5bf9\u3002 \u7b2c\u4e00\u6b21\u6bd4\u5bf9\u540e\uff0c redis-full-check \u4f1a\u628a\u76ee\u7684\u5b9e\u4f8b\u4e2d\u548c\u6e90\u5b9e\u4f8b\u4e0d\u4e00\u81f4\u7684\u6570\u636e\uff0c\u8bb0\u5f55\u5230 sqlite \u6570\u636e\u5e93\u4e2d\u3002 \u4ece\u7b2c\u4e8c\u8f6e\u6821\u9a8c\u5f00\u59cb\uff0c Redis-full-check \u53ea\u6bd4\u8f83\u4e0a\u4e00\u8f6e\u7ed3\u675f\u540e\u8bb0\u5f55\u5728\u6570\u636e\u5e93\u4e2d\u7684\u4e0d\u4e00\u81f4\u7684\u6570\u636e\u3002 \u4e3a\u4e86\u907f\u514d\u5bf9\u5b9e\u4f8b\u7684\u6b63\u5e38\u8bf7\u6c42\u5904\u7406\u9020\u6210\u5f71\u54cd\uff0cRedis-full-check \u5728\u6bcf\u4e00\u8f6e\u6bd4\u5bf9\u7ed3\u675f\u540e\uff0c\u4f1a\u6682\u505c\u4e00\u6bb5\u65f6\u95f4\u3002\u968f\u7740 Redis-shake \u589e\u91cf\u540c\u6b65\u7684\u8fdb\u884c\uff0c\u6e90\u5b9e\u4f8b\u548c\u76ee\u7684\u5b9e\u4f8b\u4e2d\u7684\u4e0d\u4e00\u81f4\u6570\u636e\u4e5f\u4f1a\u9010\u6b65\u51cf\u5c11\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u6821\u9a8c\u6bd4\u5bf9\u7684\u8f6e\u6570\u4e0d\u7528\u5f88\u591a\u3002 \u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u8bbe\u7f6e\u6bd4\u5bf9\u7684\u8f6e\u6570\u3002\u5177\u4f53\u7684\u65b9\u6cd5\u662f\uff0c\u5728\u8fd0\u884c redis-full-check \u547d\u4ee4\u65f6\uff0c\u628a\u53c2\u6570 comparetimes \u7684\u503c\u8bbe\u7f6e\u4e3a\u6211\u4eec\u60f3\u8981\u6bd4\u5bf9\u7684\u8f6e\u6570\u3002 \u7b49\u5230\u6240\u6709\u8f6e\u6570\u90fd\u6bd4\u5bf9\u5b8c\u6210\u540e\uff0c\u6570\u636e\u5e93\u4e2d\u8bb0\u5f55\u7684\u6570\u636e\u5c31\u662f\u6e90\u5b9e\u4f8b\u548c\u76ee\u7684\u5b9e\u4f8b\u6700\u7ec8\u7684\u5dee\u5f02\u7ed3\u679c\u4e86\u3002 \u8fd9\u91cc\u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\u4e0b\uff0cRedis-full-check \u63d0\u4f9b\u4e86\u4e09\u79cd\u6bd4\u5bf9\u6a21\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 comparemode \u53c2\u6570\u8fdb\u884c\u8bbe\u7f6e\u3002comparemode \u53c2\u6570\u6709\u4e09\u79cd\u53d6\u503c\uff0c\u542b\u4e49\u5982\u4e0b\uff1a KeyOutline\uff0c\u53ea\u5bf9\u6bd4 key \u503c\u662f\u5426\u76f8\u7b49\uff1b ValueOutline\uff0c\u53ea\u5bf9\u6bd4 value \u503c\u7684\u957f\u5ea6\u662f\u5426\u76f8\u7b49\uff1b FullValue\uff0c\u5bf9\u6bd4 key \u503c\u3001value \u957f\u5ea6\u3001value \u503c\u662f\u5426\u76f8\u7b49\u3002 \u6211\u4eec\u5728\u5e94\u7528 Redis-full-check \u65f6\uff0c\u53ef\u4ee5\u6839\u636e\u4e1a\u52a1\u5bf9\u6570\u636e\u4e00\u81f4\u6027\u7a0b\u5ea6\u7684\u8981\u6c42\uff0c\u9009\u62e9\u76f8\u5e94\u7684\u6bd4\u5bf9\u6a21\u5f0f\u3002\u5982\u679c\u4e00\u81f4\u6027\u8981\u6c42\u9ad8\uff0c\u5c31\u628a comparemode \u53c2\u6570\u8bbe\u7f6e\u4e3a FullValue\u3002","title":"3\u3001\u6570\u636e\u8fc1\u79fb\u5de5\u5177 Redis-shake"},{"location":"chap8/4redis_opt_tools/#4-cachecloud","text":"CacheCloud \u662f\u641c\u72d0\u5f00\u53d1\u7684\u4e00\u4e2a\u9762\u5411 Redis \u8fd0\u7ef4\u7ba1\u7406\u7684\u4e91\u5e73\u53f0\uff0c \u5b83\u5b9e\u73b0\u4e86\u4e3b\u4ece\u96c6\u7fa4\u3001\u54e8\u5175\u96c6\u7fa4\u548c Redis Cluster \u7684\u81ea\u52a8\u90e8\u7f72\u548c\u7ba1\u7406\uff0c\u7528\u6237\u53ef\u4ee5\u76f4\u63a5\u5728\u5e73\u53f0\u7684\u7ba1\u7406\u754c\u9762\u4e0a\u8fdb\u884c\u64cd\u4f5c\u3002 \u9488\u5bf9\u5e38\u89c1\u7684\u96c6\u7fa4\u8fd0\u7ef4\u9700\u6c42\uff0cCacheCloud \u63d0\u4f9b\u4e86 5 \u4e2a\u8fd0\u7ef4\u64cd\u4f5c\u3002 \u4e0b\u7ebf\u5b9e\u4f8b\uff1a\u5173\u95ed\u5b9e\u4f8b\u4ee5\u53ca\u5b9e\u4f8b\u76f8\u5173\u7684\u76d1\u63a7\u4efb\u52a1\u3002 \u4e0a\u7ebf\u5b9e\u4f8b\uff1a\u91cd\u65b0\u542f\u52a8\u5df2\u4e0b\u7ebf\u7684\u5b9e\u4f8b\uff0c\u5e76\u8fdb\u884c\u76d1\u63a7\u3002 \u6dfb\u52a0\u4ece\u8282\u70b9\uff1a\u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\u7ed9\u4e3b\u8282\u70b9\u6dfb\u52a0\u4e00\u4e2a\u4ece\u8282\u70b9\u3002 \u6545\u969c\u5207\u6362\uff1a\u624b\u52a8\u5b8c\u6210 Redis Cluster \u4e3b\u4ece\u8282\u70b9\u7684\u6545\u969c\u8f6c\u79fb\u3002 \u914d\u7f6e\u7ba1\u7406\uff1a\u7528\u6237\u63d0\u4ea4\u914d\u7f6e\u4fee\u6539\u7684\u5de5\u5355\u540e\uff0c\u7ba1\u7406\u5458\u8fdb\u884c\u5ba1\u6838\uff0c\u5e76\u5b8c\u6210\u914d\u7f6e\u4fee\u6539\u3002 \u5f53\u7136\uff0c\u4f5c\u4e3a\u8fd0\u7ef4\u7ba1\u7406\u5e73\u53f0\uff0cCacheCloud \u9664\u4e86\u63d0\u4f9b\u8fd0\u7ef4\u64cd\u4f5c\u4ee5\u5916\uff0c\u8fd8\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u76d1\u63a7\u4fe1\u606f\u3002 CacheCloud \u4e0d\u4ec5\u4f1a\u6536\u96c6 INFO \u547d\u4ee4\u63d0\u4f9b\u7684\u5b9e\u4f8b\u5b9e\u65f6\u8fd0\u884c\u72b6\u6001\u4fe1\u606f\uff0c\u8fdb\u884c\u53ef\u89c6\u5316\u5c55\u793a\uff0c\u800c\u4e14\u8fd8\u4f1a\u628a\u5b9e\u4f8b\u8fd0\u884c\u72b6\u6001\u4fe1\u606f\u4fdd\u5b58\u4e0b\u6765\uff0c\u4f8b\u5982\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u3001\u5ba2\u6237\u7aef\u8fde\u63a5\u6570\u3001\u952e\u503c\u5bf9\u6570\u636e\u91cf\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5f53 Redis \u8fd0\u884c\u53d1\u751f\u95ee\u9898\u65f6\uff0c\u8fd0\u7ef4\u4eba\u5458\u53ef\u4ee5\u67e5\u8be2\u4fdd\u5b58\u7684\u5386\u53f2\u8bb0\u5f55\uff0c\u5e76\u7ed3\u5408\u5f53\u65f6\u7684\u8fd0\u884c\u72b6\u6001\u4fe1\u606f\u8fdb\u884c\u5206\u6790\u3002","title":"4\u3001\u96c6\u7fa4\u7ba1\u7406\u5de5\u5177 CacheCloud"},{"location":"chap8/4redis_opt_tools/#5","text":"Redis \u7684 INFO \u547d\u4ee4\uff0c\u8fd9\u4e2a\u547d\u4ee4\u662f\u76d1\u63a7\u5de5\u5177\u7684\u57fa\u7840\uff0c\u76d1\u63a7\u5de5\u5177\u90fd\u4f1a\u57fa\u4e8e INFO \u547d\u4ee4\u63d0\u4f9b\u7684\u4fe1\u606f\u8fdb\u884c\u4e8c\u6b21\u52a0\u5de5\u3002\u6211\u4eec\u8fd8\u5b66\u4e60\u4e86 3 \u79cd\u7528\u6765\u76d1\u63a7 Redis \u5b9e\u65f6\u8fd0\u884c\u72b6\u6001\u7684\u8fd0\u7ef4\u5de5\u5177\uff0c\u5206\u522b\u662f Redis-exporter \u3001 redis-stat \u548c Redis Live \u3002 \u5173\u4e8e\u6570\u636e\u8fc1\u79fb\uff0c\u6211\u4eec\u65e2\u53ef\u4ee5\u4f7f\u7528 Redis-shake \u5de5\u5177\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 RDB \u6587\u4ef6\u6216\u662f AOF \u6587\u4ef6\u8fdb\u884c\u8fc1\u79fb\u3002 Redis INFO \u4fe1\u606f\u770b\u4f3c\u7b80\u5355\uff0c\u4f46\u662f\u8fd9\u4e9b\u4fe1\u606f\u8bb0\u5f55\u7740 Redis \u8fd0\u884c\u65f6\u7684\u5404\u79cd\u72b6\u6001\u6570\u636e\uff0c\u5982\u679c\u6211\u4eec\u628a\u8fd9\u4e9b\u6570\u636e\u91c7\u96c6\u5230\u5e76\u76d1\u63a7\u5230\u4f4d\uff0c80% \u7684\u5f02\u5e38\u60c5\u51b5\u80fd\u5728\u7b2c\u4e00\u65f6\u95f4\u53d1\u73b0\u3002 \u673a\u5668\u7684 CPU\u3001\u5185\u5b58\u3001\u7f51\u7edc\u3001\u78c1\u76d8\uff0c\u90fd\u5f71\u54cd\u7740 Redis \u7684\u6027\u80fd\u3002 \u76d1\u63a7\u65f6\u6211\u4eec\u6700\u597d\u91cd\u70b9\u5173\u6ce8\u4ee5\u4e0b\u6307\u6807\uff1a \u5ba2\u6237\u7aef\u76f8\u5173\uff1a\u5f53\u524d\u8fde\u63a5\u6570\u3001\u603b\u8fde\u63a5\u6570\u3001\u8f93\u5165\u7f13\u51b2\u5927\u5c0f\u3001OPS CPU\u76f8\u5173\uff1a\u4e3b\u8fdb\u7a0b CPU \u4f7f\u7528\u7387\u3001\u5b50\u8fdb\u7a0b CPU \u4f7f\u7528\u7387 \u5185\u5b58\u76f8\u5173\uff1a\u5f53\u524d\u5185\u5b58\u3001\u5cf0\u503c\u5185\u5b58\u3001\u5185\u5b58\u788e\u7247\u7387 \u7f51\u7edc\u76f8\u5173\uff1a\u8f93\u5165\u3001\u8f93\u51fa\u7f51\u7edc\u6d41\u91cf \u6301\u4e45\u5316\u76f8\u5173\uff1a\u6700\u540e\u4e00\u6b21 RDB \u65f6\u95f4\u3001RDB fork \u8017\u65f6\u3001\u6700\u540e\u4e00\u6b21 AOF rewrite \u65f6\u95f4\u3001AOF rewrite \u8017\u65f6 key \u76f8\u5173\uff1a\u8fc7\u671f key \u6570\u91cf\u3001\u6dd8\u6c70 key \u6570\u91cf\u3001key \u547d\u4e2d\u7387 \u590d\u5236\u76f8\u5173\uff1a\u4e3b\u4ece\u8282\u70b9\u590d\u5236\u504f\u79fb\u91cf\u3001\u4e3b\u5e93\u590d\u5236\u7f13\u51b2\u533a","title":"5\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap8/5redis_protocol/","text":"\u7b2c\u4e94\u8282 Redis\u7684\u4f7f\u7528\u89c4\u8303 1\u3001\u952e\u503c\u5bf9\u4f7f\u7528\u89c4\u8303 key \u7684\u547d\u540d\u89c4\u8303\uff0c\u53ea\u6709\u547d\u540d\u89c4\u8303 \uff0c\u624d\u80fd\u63d0\u4f9b\u53ef\u8bfb\u6027\u5f3a\u3001\u53ef\u7ef4\u62a4\u6027\u597d\u7684 key\uff0c\u65b9\u4fbf\u65e5\u5e38\u7ba1\u7406\uff1b value \u7684\u8bbe\u8ba1\u89c4\u8303\uff0c\u5305\u62ec\u907f\u514d bigkey\u3001\u9009\u62e9\u9ad8\u6548\u5e8f\u5217\u5316\u65b9\u6cd5\u548c\u538b\u7f29\u65b9\u6cd5 \u3001\u4f7f\u7528\u6574\u6570\u5bf9\u8c61\u5171\u4eab\u6c60\u3001\u6570\u636e\u7c7b\u578b\u9009\u62e9\u3002 1-1 \u89c4\u8303\u4e00\uff1akey \u7684\u547d\u540d\u89c4\u8303 \u4e00\u4e2a Redis \u5b9e\u4f8b\u9ed8\u8ba4\u53ef\u4ee5\u652f\u6301 16 \u4e2a\u6570\u636e\u5e93\uff0c\u53ef\u4ee5\u628a\u4e0d\u540c\u7684\u4e1a\u52a1\u6570\u636e\u5206\u6563\u4fdd\u5b58\u5230\u4e0d\u540c\u7684\u6570\u636e\u5e93\u4e2d\u3002 \u4f46\u662f\uff0c\u5728\u4f7f\u7528\u4e0d\u540c\u6570\u636e\u5e93\u65f6\uff0c \u5ba2\u6237\u7aef\u9700\u8981\u4f7f\u7528 SELECT \u547d\u4ee4\u8fdb\u884c\u6570\u636e\u5e93\u5207\u6362\uff0c\u76f8\u5f53\u4e8e\u589e\u52a0\u4e86\u4e00\u4e2a\u989d\u5916\u7684\u64cd\u4f5c\u3002 \u5176\u5b9e\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5408\u7406\u547d\u540d key\uff0c\u51cf\u5c11\u8fd9\u4e2a\u64cd\u4f5c\u3002\u5177\u4f53\u7684\u505a\u6cd5\u662f\uff0c \u628a\u4e1a\u52a1\u540d\u4f5c\u4e3a\u524d\u7f00\uff0c\u7136\u540e\u7528\u5192\u53f7\u5206\u9694\uff0c\u518d\u52a0\u4e0a\u5177\u4f53\u7684\u4e1a\u52a1\u6570\u636e\u540d \u3002\u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 key \u7684\u524d\u7f00\u533a\u5206\u4e0d\u540c\u7684\u4e1a\u52a1\u6570\u636e\uff0c\u5c31\u4e0d\u7528\u5728\u591a\u4e2a\u6570\u636e\u5e93\u95f4\u6765\u56de\u5207\u6362\u4e86\u3002 \u6bd4\u5982\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u8981\u7edf\u8ba1\u7f51\u9875\u7684\u72ec\u7acb\u8bbf\u5ba2\u91cf\uff0c\u5c31\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u4ee3\u7801\u8bbe\u7f6e key\uff0c\u8fd9\u5c31\u8868\u793a\uff0c\u8fd9\u4e2a\u6570\u636e\u5bf9\u5e94\u7684\u4e1a\u52a1\u662f\u7edf\u8ba1 unique visitor \uff08\u72ec\u7acb\u8bbf\u5ba2\u91cf\uff09\uff0c\u800c\u4e14\u5bf9\u5e94\u7684\u9875\u9762\u7f16\u53f7\u662f 1024 \u3002 uv:page:1024 \u8fd9\u91cc\u6709\u4e00\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\u4e00\u4e0b\u3002key \u672c\u8eab\u662f\u5b57\u7b26\u4e32\uff0c\u5e95\u5c42\u7684\u6570\u636e\u7ed3\u6784\u662f SDS\u3002SDS \u7ed3\u6784\u4e2d\u4f1a\u5305\u542b\u5b57\u7b26\u4e32\u957f\u5ea6\u3001\u5206\u914d\u7a7a\u95f4\u5927\u5c0f\u7b49\u5143\u6570\u636e\u4fe1\u606f\u3002\u4ece Redis 3.2 \u7248\u672c\u5f00\u59cb\uff0c \u5f53 key \u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u589e\u52a0\u65f6\uff0cSDS \u4e2d\u7684\u5143\u6570\u636e\u4e5f\u4f1a\u5360\u7528\u66f4\u591a\u5185\u5b58\u7a7a\u95f4\u3002 SDS \u7ed3\u6784\u4e2d\u7684\u5b57\u7b26\u4e32\u957f\u5ea6\u548c\u5143\u6570\u636e\u5927\u5c0f\u7684\u5bf9\u5e94\u5173\u7cfb\u5982\u4e0b\u8868\u6240\u793a\uff1a \u4e86\u51cf\u5c11 key \u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5c0f\u5efa\u8bae\uff1a \u5bf9\u4e8e\u4e1a\u52a1\u540d\u6216\u4e1a\u52a1\u6570\u636e\u540d\uff0c\u53ef\u4ee5\u4f7f\u7528\u76f8\u5e94\u7684\u82f1\u6587\u5355\u8bcd\u7684\u9996\u5b57\u6bcd\u8868\u793a\uff0c\uff08\u6bd4\u5982 user \u7528 u \u8868\u793a\uff0cmessage \u7528 m\uff09\uff0c\u6216\u8005\u662f\u7528\u7f29\u5199\u8868\u793a\uff08\u4f8b\u5982 unique visitor \u4f7f\u7528 uv\uff09\u3002 1-2 \u89c4\u8303\u4e8c\uff1a\u907f\u514d\u4f7f\u7528 bigkey Redis \u662f\u4f7f\u7528\u5355\u7ebf\u7a0b\u8bfb\u5199\u6570\u636e\uff0c bigkey \u7684\u8bfb\u5199\u64cd\u4f5c\u4f1a\u963b\u585e\u7ebf\u7a0b\uff0c\u964d\u4f4e Redis \u7684\u5904\u7406\u6548\u7387 \u3002\u6240\u4ee5\uff0c\u5728\u5e94\u7528 Redis \u65f6\uff0c\u5173\u4e8e value \u7684\u8bbe\u8ba1\u89c4\u8303\uff0c\u975e\u5e38\u91cd\u8981\u7684\u4e00\u70b9\u5c31\u662f\u907f\u514d bigkey\u3002 bigkey \u901a\u5e38\u6709\u4e24\u79cd\u60c5\u51b5\u3002 \u60c5\u51b5\u4e00\uff1a\u952e\u503c\u5bf9\u7684\u503c\u5927\u5c0f\u672c\u8eab\u5c31\u5f88\u5927\uff0c \u4f8b\u5982 value \u4e3a 1MB \u7684 String \u7c7b\u578b\u6570\u636e \u3002\u4e3a\u4e86\u907f\u514d String \u7c7b\u578b\u7684 bigkey\uff0c\u5728\u4e1a\u52a1\u5c42\uff0c\u6211\u4eec\u8981\u5c3d\u91cf\u628a String \u7c7b\u578b\u7684\u6570\u636e\u5927\u5c0f\u63a7\u5236\u5728 10KB \u4ee5\u4e0b\u3002 \u60c5\u51b5\u4e8c\uff1a \u952e\u503c\u5bf9\u7684\u503c\u662f\u96c6\u5408\u7c7b\u578b\uff0c\u96c6\u5408\u5143\u7d20\u4e2a\u6570\u975e\u5e38\u591a\uff0c\u4f8b\u5982\u5305\u542b 100 \u4e07\u4e2a\u5143\u7d20\u7684 Hash \u96c6\u5408\u7c7b\u578b\u6570\u636e \u3002\u4e3a\u4e86\u907f\u514d\u96c6\u5408\u7c7b\u578b\u7684 bigkey\uff0c\u8bbe\u8ba1\u89c4\u8303\u5efa\u8bae\u662f\uff0c \u5c3d\u91cf\u628a\u96c6\u5408\u7c7b\u578b\u7684\u5143\u7d20\u4e2a\u6570\u63a7\u5236\u5728 1 \u4e07\u4ee5\u4e0b\u3002 \u5efa\u8bae\u53ea\u662f\u4e3a\u4e86\u5c3d\u91cf\u907f\u514d bigkey\uff0c\u5982\u679c\u4e1a\u52a1\u5c42\u7684 String \u7c7b\u578b\u6570\u636e\u786e\u5b9e\u5f88\u5927\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u6570\u636e\u538b\u7f29\u6765\u51cf\u5c0f\u6570\u636e\u5927\u5c0f\uff1b\u5982\u679c\u96c6\u5408\u7c7b\u578b\u7684\u5143\u7d20\u7684\u786e\u5f88\u591a\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u4e00\u4e2a\u5927\u96c6\u5408\u62c6\u5206\u6210\u591a\u4e2a\u5c0f\u96c6\u5408\u6765\u4fdd\u5b58\u3002 \u8fd9\u91cc\uff0c\u8fd8\u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\u4e0b\uff0c Redis \u7684 4 \u79cd\u96c6\u5408\u7c7b\u578b List\u3001Hash\u3001Set \u548c Sorted Set\uff0c\u5728\u96c6\u5408\u5143\u7d20\u4e2a\u6570\u5c0f\u4e8e\u4e00\u5b9a\u7684\u9608\u503c\u65f6\uff0c\u4f1a\u4f7f\u7528\u5185\u5b58\u7d27\u51d1\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u8fdb\u884c\u4fdd\u5b58\uff0c\u4ece\u800c\u8282\u7701\u5185\u5b58 \u3002 \u4f8b\u5982\uff0c\u5047\u8bbe Hash \u96c6\u5408\u7684 hash-max-ziplist-entries \u914d\u7f6e\u9879\u662f 1000 \uff0c\u5982\u679c Hash \u96c6\u5408\u5143\u7d20\u4e2a\u6570\u4e0d\u8d85\u8fc7 1000 \uff0c\u5c31\u4f1a\u4f7f\u7528 ziplist \u4fdd\u5b58\u6570\u636e\u3002 \u7d27\u51d1\u578b\u6570\u636e\u7ed3\u6784\u867d\u7136\u53ef\u4ee5\u8282\u7701\u5185\u5b58\uff0c\u4f46\u662f\u4f1a\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u5bfc\u81f4\u6570\u636e\u7684\u8bfb\u5199\u6027\u80fd\u4e0b\u964d\u3002\u6240\u4ee5\uff0c\u5982\u679c\u4e1a\u52a1\u5e94\u7528\u66f4\u52a0\u9700\u8981\u4fdd\u6301\u9ad8\u6027\u80fd\u8bbf\u95ee\uff0c\u800c\u4e0d\u662f\u8282\u7701\u5185\u5b58\u7684\u8bdd\uff0c\u5728\u4e0d\u4f1a\u5bfc\u81f4 bigkey \u7684\u524d\u63d0\u4e0b\uff0c\u4f60\u5c31\u4e0d\u7528\u523b\u610f\u63a7\u5236\u96c6\u5408\u5143\u7d20\u4e2a\u6570\u4e86\u3002 1-3 \u89c4\u8303\u4e09\uff1a\u4f7f\u7528\u9ad8\u6548\u5e8f\u5217\u5316\u65b9\u6cd5\u548c\u538b\u7f29\u65b9\u6cd5 \u4e3a\u4e86\u8282\u7701\u5185\u5b58\uff0c\u9664\u4e86\u91c7\u7528\u7d27\u51d1\u578b\u6570\u636e\u7ed3\u6784\u4ee5\u5916\uff0c\u8fd8\u53ef\u4ee5\u9075\u5faa\u4e24\u4e2a\u4f7f\u7528\u89c4\u8303\uff0c \u5206\u522b\u662f\u4f7f\u7528\u9ad8\u6548\u7684\u5e8f\u5217\u5316\u65b9\u6cd5\u548c\u538b\u7f29\u65b9\u6cd5\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11 value \u7684\u5927\u5c0f\u3002 Redis \u4e2d\u7684\u5b57\u7b26\u4e32\u90fd\u662f\u4f7f\u7528\u4e8c\u8fdb\u5236\u5b89\u5168\u7684\u5b57\u8282\u6570\u7ec4\u6765\u4fdd\u5b58\u7684\uff0c\u6240\u4ee5\uff0c\u53ef\u4ee5\u628a\u4e1a\u52a1\u6570\u636e\u5e8f\u5217\u5316\u6210\u4e8c\u8fdb\u5236\u6570\u636e\u5199\u5165\u5230 Redis \u4e2d\u3002 \u4e0d\u540c\u7684\u5e8f\u5217\u5316\u65b9\u6cd5\uff0c\u5728\u5e8f\u5217\u5316\u901f\u5ea6\u548c\u6570\u636e\u5e8f\u5217\u5316\u540e\u7684\u5360\u7528\u5185\u5b58\u7a7a\u95f4\u8fd9\u4e24\u4e2a\u65b9\u9762\uff0c\u6548\u679c\u662f\u4e0d\u4e00\u6837\u7684\u3002 \u6bd4\u5982\u8bf4\uff0cprotostuff \u548c kryo \u8fd9\u4e24\u79cd\u5e8f\u5217\u5316\u65b9\u6cd5\uff0c\u5c31\u8981\u6bd4 Java \u5185\u7f6e\u7684\u5e8f\u5217\u5316\u65b9\u6cd5\uff08 java-build-in-serializer \uff09\u6548\u7387\u66f4\u9ad8\u3002 \u4e1a\u52a1\u5e94\u7528\u6709\u65f6\u4f1a\u4f7f\u7528\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684 XML \u548c JSON \u683c\u5f0f\u4fdd\u5b58\u6570\u636e\u3002 \u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u8fd9\u4e24\u79cd\u683c\u5f0f\u7684\u53ef\u8bfb\u6027\u597d\uff0c\u4fbf\u4e8e\u8c03\u8bd5\uff0c\u4e0d\u540c\u7684\u5f00\u53d1\u8bed\u8a00\u90fd\u652f\u6301\u8fd9\u4e24\u79cd\u683c\u5f0f\u7684\u89e3\u6790\u3002 \u7f3a\u70b9\u5728\u4e8e\uff0cXML \u548c JSON \u683c\u5f0f\u7684\u6570\u636e\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u6bd4\u8f83\u5927\u3002\u4e3a\u4e86\u907f\u514d\u6570\u636e\u5360\u7528\u8fc7\u5927\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u6211\u5efa\u8bae\u4f7f\u7528\u538b\u7f29\u5de5\u5177\uff08\u4f8b\u5982 snappy \u6216 gzip\uff09\uff0c\u628a\u6570\u636e\u538b\u7f29\u540e\u518d\u5199\u5165 Redis\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u4e86\u3002 1-4 \u89c4\u8303\u56db\uff1a\u4f7f\u7528\u6574\u6570\u5bf9\u8c61\u5171\u4eab\u6c60 \u6574\u6570\u662f\u5e38\u7528\u7684\u6570\u636e\u7c7b\u578b\uff0cRedis \u5185\u90e8\u7ef4\u62a4\u4e86 0 \u5230 9999 \u8fd9 1 \u4e07\u4e2a\u6574\u6570\u5bf9\u8c61\uff0c\u5e76\u628a\u8fd9\u4e9b\u6574\u6570\u4f5c\u4e3a\u4e00\u4e2a\u5171\u4eab\u6c60\u4f7f\u7528\u3002 \u6362\u53e5\u8bdd\u8bf4\uff0c\u5982\u679c\u4e00\u4e2a\u952e\u503c\u5bf9\u4e2d\u6709 0 \u5230 9999 \u8303\u56f4\u7684\u6574\u6570\uff0cRedis \u5c31\u4e0d\u4f1a\u4e3a\u8fd9\u4e2a\u952e\u503c\u5bf9\u4e13\u95e8\u521b\u5efa\u6574\u6570\u5bf9\u8c61\u4e86\uff0c\u800c\u662f\u4f1a\u590d\u7528\u5171\u4eab\u6c60\u4e2d\u7684\u6574\u6570\u5bf9\u8c61\u3002 \u90a3\u4ec0\u4e48\u65f6\u5019\u4e0d\u80fd\u7528\u6574\u6570\u5bf9\u8c61\u5171\u4eab\u6c60\u5462\uff1f\u4e3b\u8981\u6709\u4e24\u79cd\u60c5\u51b5\u3002 \u7b2c\u4e00\u79cd\u60c5\u51b5\u662f\uff0c \u5982\u679c Redis \u4e2d\u8bbe\u7f6e\u4e86 maxmemory\uff0c\u800c\u4e14\u542f\u7528\u4e86 LRU \u7b56\u7565\uff08allkeys-lru \u6216 volatile-lru \u7b56\u7565\uff09\uff0c\u90a3\u4e48\uff0c\u6574\u6570\u5bf9\u8c61\u5171\u4eab\u6c60\u5c31\u65e0\u6cd5\u4f7f\u7528\u4e86 \u3002\u8fd9\u662f\u56e0\u4e3a\uff0cLRU \u7b56\u7565\u9700\u8981\u7edf\u8ba1\u6bcf\u4e2a\u952e\u503c\u5bf9\u7684\u4f7f\u7528\u65f6\u95f4\uff0c\u5982\u679c\u4e0d\u540c\u7684\u952e\u503c\u5bf9\u90fd\u5171\u4eab\u4f7f\u7528\u4e00\u4e2a\u6574\u6570\u5bf9\u8c61\uff0cLRU \u7b56\u7565\u5c31\u65e0\u6cd5\u8fdb\u884c\u7edf\u8ba1\u4e86\u3002 \u7b2c\u4e8c\u79cd\u60c5\u51b5\u662f\uff0c\u5982\u679c\u96c6\u5408\u7c7b\u578b\u6570\u636e\u91c7\u7528 ziplist \u7f16\u7801\uff0c\u800c\u96c6\u5408\u5143\u7d20\u662f\u6574\u6570\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u4e5f\u4e0d\u80fd\u4f7f\u7528\u5171\u4eab\u6c60\u3002\u56e0\u4e3a ziplist \u4f7f\u7528\u4e86\u7d27\u51d1\u578b\u5185\u5b58\u7ed3\u6784\uff0c\u5224\u65ad\u6574\u6570\u5bf9\u8c61\u7684\u5171\u4eab\u60c5\u51b5\u6548\u7387\u4f4e\u3002 2\u3001\u6570\u636e\u4fdd\u5b58\u89c4\u8303 2-1 \u89c4\u8303\u4e00\uff1a\u4f7f\u7528 Redis \u4fdd\u5b58\u70ed\u6570\u636e \u4e3a\u4e86\u63d0\u4f9b\u9ad8\u6027\u80fd\u8bbf\u95ee\uff0cRedis \u662f\u628a\u6240\u6709\u6570\u636e\u4fdd\u5b58\u5230\u5185\u5b58\u4e2d\u7684\u3002 \u867d\u7136 Redis \u652f\u6301\u4f7f\u7528 RDB \u5feb\u7167\u548c AOF \u65e5\u5fd7\u6301\u4e45\u5316\u4fdd\u5b58\u6570\u636e\uff0c\u4f46\u662f\uff0c\u8fd9\u4e24\u4e2a\u673a\u5236\u90fd\u662f\u7528\u6765\u63d0\u4f9b\u6570\u636e\u53ef\u9760\u6027\u4fdd\u8bc1\u7684\uff0c\u5e76\u4e0d\u662f\u7528\u6765\u6269\u5145\u6570\u636e\u5bb9\u91cf\u7684\u3002\u800c\u4e14\uff0c\u5185\u5b58\u6210\u672c\u672c\u8eab\u5c31\u6bd4\u8f83\u9ad8\uff0c\u5982\u679c\u628a\u4e1a\u52a1\u6570\u636e\u90fd\u4fdd\u5b58\u5728 Redis \u4e2d\uff0c\u4f1a\u5e26\u6765\u8f83\u5927\u7684\u5185\u5b58\u6210\u672c\u538b\u529b\u3002 \u6240\u4ee5\uff0c\u4e00\u822c\u6765\u8bf4\uff0c\u5728\u5b9e\u9645\u5e94\u7528 Redis \u65f6\uff0c\u6211\u4eec\u4f1a\u66f4\u591a\u5730\u628a\u5b83\u4f5c\u4e3a\u7f13\u5b58\u4fdd\u5b58\u70ed\u6570\u636e\uff0c\u8fd9\u6837\u65e2\u53ef\u4ee5\u5145\u5206\u5229\u7528 Redis \u7684\u9ad8\u6027\u80fd\u7279\u6027\u3002 2-2 \u89c4\u8303\u4e8c\uff1a\u4e0d\u540c\u7684\u4e1a\u52a1\u6570\u636e\u5206\u5b9e\u4f8b\u5b58\u50a8 \u867d\u7136\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 key \u7684\u524d\u7f00\u628a\u4e0d\u540c\u4e1a\u52a1\u7684\u6570\u636e\u533a\u5206\u5f00\uff0c\u4f46\u662f\uff0c\u5982\u679c\u6240\u6709\u4e1a\u52a1\u7684\u6570\u636e\u91cf\u90fd\u5f88\u5927\uff0c\u800c\u4e14\u8bbf\u95ee\u7279\u5f81\u4e5f\u4e0d\u4e00\u6837\uff0c\u6211\u4eec\u628a\u8fd9\u4e9b\u6570\u636e\u4fdd\u5b58\u5728\u540c\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\u65f6\uff0c\u8fd9\u4e9b\u6570\u636e\u7684\u64cd\u4f5c\u5c31\u4f1a\u76f8\u4e92\u5e72\u6270\u3002 \u4e00\u4e2a\u573a\u666f\uff1a\u5047\u5982\u6570\u636e\u91c7\u96c6\u4e1a\u52a1\u4f7f\u7528 Redis \u4fdd\u5b58\u6570\u636e\u65f6\uff0c\u4ee5\u5199\u64cd\u4f5c\u4e3a\u4e3b\uff0c\u800c\u7528\u6237\u7edf\u8ba1\u4e1a\u52a1\u4f7f\u7528 Redis \u65f6\uff0c\u662f\u4ee5\u8bfb\u67e5\u8be2\u4e3a\u4e3b\uff0c \u5982\u679c\u8fd9\u4e24\u4e2a\u4e1a\u52a1\u6570\u636e\u6df7\u5728\u4e00\u8d77\u4fdd\u5b58\uff0c\u8bfb\u5199\u64cd\u4f5c\u76f8\u4e92\u5e72\u6270\uff0c\u80af\u5b9a\u4f1a\u5bfc\u81f4\u4e1a\u52a1\u54cd\u5e94\u53d8\u6162\u3002 \u5efa\u8bae\u4f60\u628a\u4e0d\u540c\u7684\u4e1a\u52a1\u6570\u636e\u653e\u5230\u4e0d\u540c\u7684 Redis \u5b9e\u4f8b\u4e2d \u3002\u8fd9\u6837\u4e00\u6765\uff0c\u65e2\u53ef\u4ee5\u907f\u514d\u5355\u5b9e\u4f8b\u7684\u5185\u5b58\u4f7f\u7528\u91cf\u8fc7\u5927\uff0c\u4e5f\u53ef\u4ee5\u907f\u514d\u4e0d\u540c\u4e1a\u52a1\u7684\u64cd\u4f5c\u76f8\u4e92\u5e72\u6270\u3002 2-3 \u89c4\u8303\u4e09\uff1a\u5728\u6570\u636e\u4fdd\u5b58\u65f6\uff0c\u8981\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4 \u5bf9\u4e8e Redis \u6765\u8bf4\uff0c\u5185\u5b58\u662f\u975e\u5e38\u5b9d\u8d35\u7684\u8d44\u6e90\uff0c\u800c\u4e14\uff0cRedis \u901a\u5e38\u7528\u4e8e\u4fdd\u5b58\u70ed\u6570\u636e\u3002\u70ed\u6570\u636e\u4e00\u822c\u90fd\u6709\u4f7f\u7528\u7684\u65f6\u6548\u6027\u3002 \u6839\u636e\u4e1a\u52a1\u4f7f\u7528\u6570\u636e\u7684\u65f6\u957f\uff0c\u8bbe\u7f6e\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4 \u3002\u4e0d\u7136\u7684\u8bdd\uff0c\u5199\u5165 Redis \u7684\u6570\u636e\u4f1a\u4e00\u76f4\u5360\u7528\u5185\u5b58\uff0c\u5982\u679c\u6570\u636e\u6301\u7eed\u589e\u591a\uff0c\u5c31\u53ef\u80fd\u8fbe\u5230\u673a\u5668\u7684\u5185\u5b58\u4e0a\u9650\uff0c\u9020\u6210\u5185\u5b58\u6ea2\u51fa\uff0c\u5bfc\u81f4\u670d\u52a1\u5d29\u6e83\u3002 2-4 \u89c4\u8303\u56db\uff1a\u63a7\u5236 Redis \u5b9e\u4f8b\u7684\u5bb9\u91cf Redis \u5355\u5b9e\u4f8b\u7684\u5185\u5b58\u5927\u5c0f\u90fd\u4e0d\u8981\u592a\u5927\uff0c \u6839\u636e\u81ea\u5df1\u7684\u7ecf\u9a8c\u503c\uff0c\u5efa\u8bae\u4f60\u8bbe\u7f6e\u5728 2~6GB \u3002\u8fd9\u6837\u4e00\u6765\uff0c\u65e0\u8bba\u662f RDB \u5feb\u7167\uff0c\u8fd8\u662f\u4e3b\u4ece\u96c6\u7fa4\u8fdb\u884c\u6570\u636e\u540c\u6b65\uff0c\u90fd\u80fd\u5f88\u5feb\u5b8c\u6210\uff0c\u4e0d\u4f1a\u963b\u585e\u6b63\u5e38\u8bf7\u6c42\u7684\u5904\u7406\u3002 3\u3001\u547d\u4ee4\u4f7f\u7528\u89c4\u8303 3-1 \u89c4\u8303\u4e00\uff1a\u7ebf\u4e0a\u7981\u7528\u90e8\u5206\u547d\u4ee4 Redis \u662f\u5355\u7ebf\u7a0b\u5904\u7406\u8bf7\u6c42\u64cd\u4f5c\uff0c \u5982\u679c\u6267\u884c\u4e00\u4e9b\u6d89\u53ca\u5927\u91cf\u64cd\u4f5c\u3001\u8017\u65f6\u957f\u7684\u547d\u4ee4\uff0c\u5c31\u4f1a\u4e25\u91cd\u963b\u585e\u4e3b\u7ebf\u7a0b \uff0c\u5bfc\u81f4\u5176\u5b83\u8bf7\u6c42\u65e0\u6cd5\u5f97\u5230\u6b63\u5e38\u5904\u7406\uff0c\u8fd9\u7c7b\u547d\u4ee4\u4e3b\u8981\u6709 3 \u79cd\u3002 KEYS \uff0c \u6309\u7167\u952e\u503c\u5bf9\u7684 key \u5185\u5bb9\u8fdb\u884c\u5339\u914d\uff0c\u8fd4\u56de\u7b26\u5408\u5339\u914d\u6761\u4ef6\u7684\u952e\u503c\u5bf9 \uff0c\u8be5\u547d\u4ee4\u9700\u8981\u5bf9 Redis \u7684\u5168\u5c40\u54c8\u5e0c\u8868\u8fdb\u884c\u5168\u8868\u626b\u63cf\uff0c\u4e25\u91cd\u963b\u585e Redis \u4e3b\u7ebf\u7a0b\uff1b FLUSHALL\uff0c\u5220\u9664 Redis \u5b9e\u4f8b\u4e0a\u7684\u6240\u6709\u6570\u636e \uff0c\u5982\u679c\u6570\u636e\u91cf\u5f88\u5927\uff0c\u4f1a\u4e25\u91cd\u963b\u585e Redis \u4e3b\u7ebf\u7a0b\uff1b FLUSHDB\uff0c\u5220\u9664\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e \uff0c\u5982\u679c\u6570\u636e\u91cf\u5f88\u5927\uff0c\u540c\u6837\u4f1a\u963b\u585e Redis \u4e3b\u7ebf\u7a0b\u3002\uff1b \u5177\u4f53\u7684\u505a\u6cd5\u662f\uff0c\u7ba1\u7406\u5458\u7528 rename-command \u547d\u4ee4\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u5bf9\u8fd9\u4e9b\u547d\u4ee4\u8fdb\u884c\u91cd\u547d\u540d\uff0c\u8ba9\u5ba2\u6237\u7aef\u65e0\u6cd5\u4f7f\u7528\u8fd9\u4e9b\u547d\u4ee4\u3002 \u5f53\u7136\uff0c\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528\u5176\u5b83\u547d\u4ee4\u66ff\u4ee3\u8fd9 3 \u4e2a\u547d\u4ee4\u3002 \u5bf9\u4e8e KEYS \u547d\u4ee4\u6765\u8bf4\uff0c \u4f60\u53ef\u4ee5\u7528 SCAN \u547d\u4ee4\u4ee3\u66ff KEYS \u547d\u4ee4 \uff0c\u5206\u6279\u8fd4\u56de\u7b26\u5408\u6761\u4ef6\u7684\u952e\u503c\u5bf9\uff0c\u907f\u514d\u9020\u6210\u4e3b\u7ebf\u7a0b\u963b\u585e\uff1b \u5bf9\u4e8e FLUSHALL\u3001FLUSHDB \u547d\u4ee4\u6765\u8bf4\uff0c\u4f60\u53ef\u4ee5\u52a0\u4e0a ASYNC \u9009\u9879 \uff0c\u8ba9\u8fd9\u4e24\u4e2a\u547d\u4ee4\u4f7f\u7528\u540e\u53f0\u7ebf\u7a0b\u5f02\u6b65\u5220\u9664\u6570\u636e\uff0c\u53ef\u4ee5\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002 3-2 \u89c4\u8303\u4e8c\uff1a\u614e\u7528 MONITOR \u547d\u4ee4 Redis \u7684 MONITOR \u547d\u4ee4\u5728\u6267\u884c\u540e\uff0c\u4f1a\u6301\u7eed\u8f93\u51fa\u76d1\u6d4b\u5230\u7684\u5404\u4e2a\u547d\u4ee4\u64cd\u4f5c \uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u7528 MONITOR \u547d\u4ee4\u8fd4\u56de\u7684\u7ed3\u679c\uff0c\u68c0\u67e5\u547d\u4ee4\u7684\u6267\u884c\u60c5\u51b5\u3002 \u4f46\u662f\uff0cMONITOR \u547d\u4ee4\u4f1a\u628a\u76d1\u63a7\u5230\u7684\u5185\u5bb9\u6301\u7eed\u5199\u5165\u8f93\u51fa\u7f13\u51b2\u533a\u3002\u5982\u679c\u7ebf\u4e0a\u547d\u4ee4\u7684\u64cd\u4f5c\u5f88\u591a\uff0c\u8f93\u51fa\u7f13\u51b2\u533a\u5f88\u5feb\u5c31\u4f1a\u6ea2\u51fa\u4e86\uff0c\u8fd9\u5c31\u4f1a\u5bf9 Redis \u6027\u80fd\u9020\u6210\u5f71\u54cd\uff0c\u751a\u81f3\u5f15\u8d77\u670d\u52a1\u5d29\u6e83\u3002 \u6240\u4ee5\uff0c\u9664\u975e\u5341\u5206\u9700\u8981\u76d1\u6d4b\u67d0\u4e9b\u547d\u4ee4\u7684\u6267\u884c\uff08\u4f8b\u5982\uff0cRedis \u6027\u80fd\u7a81\u7136\u53d8\u6162\uff0c\u6211\u4eec\u60f3\u67e5\u770b\u4e0b\u5ba2\u6237\u7aef\u6267\u884c\u4e86\u54ea\u4e9b\u547d\u4ee4\uff09\uff0c \u53ef\u4ee5\u5076\u5c14\u5728\u77ed\u65f6\u95f4\u5185\u4f7f\u7528\u4e0b MONITOR \u547d\u4ee4\uff0c\u5426\u5219\uff0c\u5efa\u8bae\u4f60\u4e0d\u8981\u4f7f\u7528 MONITOR \u547d\u4ee4\u3002 3-3 \u89c4\u8303\u4e09\uff1a\u614e\u7528\u5168\u91cf\u64cd\u4f5c\u547d\u4ee4 \u5bf9\u4e8e\u96c6\u5408\u7c7b\u578b\u7684\u6570\u636e\u6765\u8bf4\uff0c\u5982\u679c\u60f3\u8981\u83b7\u5f97\u96c6\u5408\u4e2d\u7684\u6240\u6709\u5143\u7d20\uff0c\u4e00\u822c\u4e0d\u5efa\u8bae\u4f7f\u7528\u5168\u91cf\u64cd\u4f5c\u7684\u547d\u4ee4\uff08\u4f8b\u5982 Hash \u7c7b\u578b\u7684 HGETALL \u3001 Set \u7c7b\u578b\u7684 SMEMBER S\uff09\u3002\u8fd9\u4e9b\u64cd\u4f5c\u4f1a\u5bf9 Hash \u548c Set \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u8fdb\u884c\u5168\u91cf\u626b\u63cf\uff0c\u5982\u679c\u96c6\u5408\u7c7b\u578b\u6570\u636e\u8f83\u591a\u7684\u8bdd\uff0c\u5c31\u4f1a\u963b\u585e Redis \u4e3b\u7ebf\u7a0b\u3002 \u5982\u679c\u60f3\u8981\u83b7\u5f97\u96c6\u5408\u7c7b\u578b\u7684\u5168\u91cf\u6570\u636e\uff0c\u6211\u7ed9\u4f60\u4e09\u4e2a\u5c0f\u5efa\u8bae\u3002 \u7b2c\u4e00\u4e2a\u5efa\u8bae\u662f\uff0c \u4f60\u53ef\u4ee5\u4f7f\u7528 SSCAN\u3001HSCAN \u547d\u4ee4\u5206\u6279\u8fd4\u56de\u96c6\u5408\u4e2d\u7684\u6570\u636e\uff0c\u51cf\u5c11\u5bf9\u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\u3002 \u7b2c\u4e8c\u4e2a\u5efa\u8bae\u662f\uff0c \u4f60\u53ef\u4ee5\u5316\u6574\u4e3a\u96f6\uff0c\u628a\u4e00\u4e2a\u5927\u7684 Hash \u96c6\u5408\u62c6\u5206\u6210\u591a\u4e2a\u5c0f\u7684 Hash \u96c6\u5408 \u3002\u8fd9\u4e2a\u64cd\u4f5c\u5bf9\u5e94\u5230\u4e1a\u52a1\u5c42\uff0c\u5c31\u662f\u5bf9\u4e1a\u52a1\u6570\u636e\u8fdb\u884c\u62c6\u5206\uff0c\u6309\u7167\u65f6\u95f4\u3001\u5730\u57df\u3001\u7528\u6237 ID \u7b49\u5c5e\u6027\u628a\u4e00\u4e2a\u5927\u96c6\u5408\u7684\u4e1a\u52a1\u6570\u636e\u62c6\u5206\u6210\u591a\u4e2a\u5c0f\u96c6\u5408\u6570\u636e\u3002\u4f8b\u5982\uff0c\u5f53\u4f60\u7edf\u8ba1\u7528\u6237\u7684\u8bbf\u95ee\u60c5\u51b5\u65f6\uff0c\u5c31\u53ef\u4ee5\u6309\u7167\u5929\u7684\u7c92\u5ea6\uff0c\u628a\u6bcf\u5929\u7684\u6570\u636e\u4f5c\u4e3a\u4e00\u4e2a Hash \u96c6\u5408\u3002 \u6700\u540e\u4e00\u4e2a\u5efa\u8bae\u662f\uff0c\u5982\u679c\u96c6\u5408\u7c7b\u578b\u4fdd\u5b58\u7684\u662f\u4e1a\u52a1\u6570\u636e\u7684\u591a\u4e2a\u5c5e\u6027\uff0c\u800c\u6bcf\u6b21\u67e5\u8be2\u65f6\uff0c\u4e5f\u9700\u8981\u8fd4\u56de\u8fd9\u4e9b\u5c5e\u6027\uff0c\u90a3\u4e48\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 String \u7c7b\u578b\uff0c\u5c06\u8fd9\u4e9b\u5c5e\u6027\u5e8f\u5217\u5316\u540e\u4fdd\u5b58\uff0c\u6bcf\u6b21\u76f4\u63a5\u8fd4\u56de String \u6570\u636e\u5c31\u884c\uff0c\u4e0d\u7528\u518d\u5bf9\u96c6\u5408\u7c7b\u578b\u505a\u5168\u91cf\u626b\u63cf\u4e86\u3002 4\u3001\u672c\u8282\u5c0f\u7ed3 4-1 \u89c4\u8303\u5206\u7c7b \u5f3a\u5236\u7c7b\u522b\u7684\u89c4\u8303\uff1a\u8fd9\u8868\u793a\uff0c\u5982\u679c\u4e0d\u6309\u7167\u89c4\u8303\u5185\u5bb9\u6765\u6267\u884c\uff0c\u5c31\u4f1a\u7ed9 Redis \u7684\u5e94\u7528\u5e26\u6765\u6781\u5927\u7684\u8d1f\u9762\u5f71\u54cd\uff0c\u4f8b\u5982\u6027\u80fd\u53d7\u635f\u3002 \u63a8\u8350\u7c7b\u522b\u7684\u89c4\u8303\uff1a\u8fd9\u4e2a\u89c4\u8303\u7684\u5185\u5bb9\u80fd\u6709\u6548\u63d0\u5347\u6027\u80fd\u3001\u8282\u7701\u5185\u5b58\u7a7a\u95f4\uff0c\u6216\u8005\u662f\u589e\u52a0\u5f00\u53d1\u548c\u8fd0\u7ef4\u7684\u4fbf\u6377\u6027\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u5e94\u7528\u5230\u5b9e\u8df5\u4e2d\u3002 \u5efa\u8bae\u7c7b\u522b\u7684\u89c4\u8303\uff1a\u8fd9\u7c7b\u89c4\u8303\u5185\u5bb9\u548c\u5b9e\u9645\u4e1a\u52a1\u5e94\u7528\u76f8\u5173\uff0c\u53ea\u662f\u4ece\u7ecf\u5386\u6216\u7ecf\u9a8c\u7ed9\u4f60\u4e00\u4e2a\u5efa\u8bae\uff0c\u4f60\u9700\u8981\u7ed3\u5408\u81ea\u5df1\u7684\u4e1a\u52a1\u573a\u666f\u53c2\u8003\u4f7f\u7528\u3002 4-1 \u4e1a\u52a1\u5c42\u9762\u4e3b\u8981\u9762\u5411\u7684\u4e1a\u52a1\u5f00\u53d1\u4eba\u5458 key \u7684\u957f\u5ea6\u5c3d\u91cf\u77ed\uff0c\u8282\u7701\u5185\u5b58\u7a7a\u95f4 \u907f\u514d bigkey\uff0c\u9632\u6b62\u963b\u585e\u4e3b\u7ebf\u7a0b 4.0+\u7248\u672c\u5efa\u8bae\u5f00\u542f lazy-free \u628a Redis \u5f53\u4f5c\u7f13\u5b58\u4f7f\u7528\uff0c\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4 \u4e0d\u4f7f\u7528\u590d\u6742\u5ea6\u8fc7\u9ad8\u7684\u547d\u4ee4\uff0c\u4f8b\u5982SORT\u3001SINTER\u3001SINTERSTORE\u3001ZUNIONSTORE\u3001ZINTERSTORE \u67e5\u8be2\u6570\u636e\u5c3d\u91cf\u4e0d\u4e00\u6b21\u6027\u67e5\u8be2\u5168\u91cf\uff0c\u5199\u5165\u5927\u91cf\u6570\u636e\u5efa\u8bae\u5206\u591a\u6279\u5199\u5165 \u6279\u91cf\u64cd\u4f5c\u5efa\u8bae MGET/MSET \u66ff\u4ee3 GET/SET\uff0cHMGET/HMSET \u66ff\u4ee3 HGET/HSET \u7981\u6b62\u4f7f\u7528 KEYS/FLUSHALL/FLUSHDB \u547d\u4ee4 \u907f\u514d\u96c6\u4e2d\u8fc7\u671f key \u6839\u636e\u4e1a\u52a1\u573a\u666f\u9009\u62e9\u5408\u9002\u7684\u6dd8\u6c70\u7b56\u7565 1\u4f7f\u7528\u8fde\u63a5\u6c60\u64cd\u4f5c Redis\uff0c\u5e76\u8bbe\u7f6e\u5408\u7406\u7684\u53c2\u6570\uff0c\u907f\u514d\u77ed\u8fde\u63a5 \u53ea\u4f7f\u7528 db0\uff0c\u51cf\u5c11 SELECT \u547d\u4ee4\u7684\u6d88\u8017 \u8bfb\u8bf7\u6c42\u91cf\u5f88\u5927\u65f6\uff0c\u5efa\u8bae\u8bfb\u5199\u5206\u79bb\uff0c\u5199\u8bf7\u6c42\u91cf\u5f88\u5927\uff0c\u5efa\u8bae\u4f7f\u7528\u5207\u7247\u96c6\u7fa4 4-2 \u8fd0\u7ef4\u5c42\u9762\u4e3b\u8981\u9762\u5411\u7684\u662f DBA \u8fd0\u7ef4\u4eba\u5458 \u6309\u4e1a\u52a1\u7ebf\u90e8\u7f72\u5b9e\u4f8b\uff0c\u907f\u514d\u591a\u4e2a\u4e1a\u52a1\u7ebf\u6df7\u5408\u90e8\u7f72\uff0c\u51fa\u95ee\u9898\u5f71\u54cd\u5176\u4ed6\u4e1a\u52a1 \u4fdd\u8bc1\u673a\u5668\u6709\u8db3\u591f\u7684 CPU\u3001\u5185\u5b58\u3001\u5e26\u5bbd\u3001\u78c1\u76d8\u8d44\u6e90 \u5efa\u8bae\u90e8\u7f72\u4e3b\u4ece\u96c6\u7fa4\uff0c\u5e76\u5206\u5e03\u5728\u4e0d\u540c\u673a\u5668\u4e0a\uff0cslave \u8bbe\u7f6e\u4e3a readonly \u4e3b\u4ece\u8282\u70b9\u6240\u90e8\u7f72\u7684\u673a\u5668\u5404\u81ea\u72ec\u7acb\uff0c\u5c3d\u91cf\u907f\u514d\u4ea4\u53c9\u90e8\u7f72\uff0c\u5bf9\u4ece\u8282\u70b9\u505a\u7ef4\u62a4\u65f6\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5230\u4e3b\u8282\u70b9 \u63a8\u8350\u90e8\u7f72\u54e8\u5175\u96c6\u7fa4\u5b9e\u73b0\u6545\u969c\u81ea\u52a8\u5207\u6362\uff0c\u54e8\u5175\u8282\u70b9\u5206\u5e03\u5728\u4e0d\u540c\u673a\u5668\u4e0a \u63d0\u524d\u505a\u597d\u5bb9\u91cf\u89c4\u5212\uff0c\u9632\u6b62\u4e3b\u4ece\u5168\u91cf\u540c\u6b65\u65f6\uff0c\u5b9e\u4f8b\u4f7f\u7528\u5185\u5b58\u7a81\u589e\u5bfc\u81f4\u5185\u5b58\u4e0d\u8db3 \u505a\u597d\u673a\u5668 CPU\u3001\u5185\u5b58\u3001\u5e26\u5bbd\u3001\u78c1\u76d8\u76d1\u63a7\uff0c\u8d44\u6e90\u4e0d\u8db3\u65f6\u53ca\u65f6\u62a5\u8b66\uff0c\u4efb\u610f\u8d44\u6e90\u4e0d\u8db3\u90fd\u4f1a\u5f71\u54cd Redis \u6027\u80fd \u5b9e\u4f8b\u8bbe\u7f6e\u6700\u5927\u8fde\u63a5\u6570\uff0c\u9632\u6b62\u8fc7\u591a\u5ba2\u6237\u7aef\u8fde\u63a5\u5bfc\u81f4\u5b9e\u4f8b\u8d1f\u8f7d\u8fc7\u9ad8\uff0c\u5f71\u54cd\u6027\u80fd \u5355\u4e2a\u5b9e\u4f8b\u5185\u5b58\u5efa\u8bae\u63a7\u5236\u5728 10G \u4ee5\u4e0b\uff0c\u5927\u5b9e\u4f8b\u5728\u4e3b\u4ece\u5168\u91cf\u540c\u6b65\u3001\u5907\u4efd\u65f6\u6709\u963b\u585e\u98ce\u9669 \u8bbe\u7f6e\u5408\u7406\u7684 slowlog \u9608\u503c\uff0c\u5e76\u5bf9\u5176\u8fdb\u884c\u76d1\u63a7\uff0cslowlog \u8fc7\u591a\u9700\u53ca\u65f6\u62a5\u8b66 \u8bbe\u7f6e\u5408\u7406\u7684 repl-backlog\uff0c\u964d\u4f4e\u4e3b\u4ece\u5168\u91cf\u540c\u6b65\u7684\u6982\u7387 \u8bbe\u7f6e\u5408\u7406\u7684 slave client-output-buffer-limit \uff0c\u907f\u514d\u4e3b\u4ece\u590d\u5236\u4e2d\u65ad\u60c5\u51b5\u53d1\u751f \u63a8\u8350\u5728\u4ece\u8282\u70b9\u4e0a\u5907\u4efd\uff0c\u4e0d\u5f71\u54cd\u4e3b\u8282\u70b9\u6027\u80fd \u4e0d\u5f00\u542f AOF \u6216\u5f00\u542f AOF \u914d\u7f6e\u4e3a\u6bcf\u79d2\u5237\u76d8\uff0c\u907f\u514d\u78c1\u76d8 IO \u62d6\u6162 Redis \u6027\u80fd \u8c03\u6574 maxmemory \u65f6\uff0c\u6ce8\u610f\u4e3b\u4ece\u8282\u70b9\u7684\u8c03\u6574\u987a\u5e8f\uff0c\u987a\u5e8f\u9519\u8bef\u4f1a\u5bfc\u81f4\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4 \u5bf9\u5b9e\u4f8b\u90e8\u7f72\u76d1\u63a7\uff0c\u91c7\u96c6 INFO \u4fe1\u606f\u65f6\u91c7\u7528\u957f\u8fde\u63a5\uff0c\u907f\u514d\u9891\u7e41\u7684\u77ed\u8fde\u63a5 \u505a\u597d\u5b9e\u4f8b\u8fd0\u884c\u65f6\u76d1\u63a7\uff0c\u91cd\u70b9\u5173\u6ce8 expired_keys \u3001 evicted_keys \u3001 latest_fork_usec \uff0c\u8fd9\u4e9b\u6307\u6807\u77ed\u65f6\u7a81\u589e\u53ef\u80fd\u4f1a\u6709\u963b\u585e\u98ce\u9669 \u626b\u63cf\u7ebf\u4e0a\u5b9e\u4f8b\u65f6\uff0c\u8bb0\u5f97\u8bbe\u7f6e\u4f11\u7720\u65f6\u95f4\uff0c\u907f\u514d\u8fc7\u9ad8 OPS \u4ea7\u751f\u6027\u80fd\u6296\u52a8","title":"\u7b2c\u4e94\u8282 Redis\u7684\u4f7f\u7528\u89c4\u8303"},{"location":"chap8/5redis_protocol/#redis","text":"","title":"\u7b2c\u4e94\u8282 Redis\u7684\u4f7f\u7528\u89c4\u8303"},{"location":"chap8/5redis_protocol/#1","text":"key \u7684\u547d\u540d\u89c4\u8303\uff0c\u53ea\u6709\u547d\u540d\u89c4\u8303 \uff0c\u624d\u80fd\u63d0\u4f9b\u53ef\u8bfb\u6027\u5f3a\u3001\u53ef\u7ef4\u62a4\u6027\u597d\u7684 key\uff0c\u65b9\u4fbf\u65e5\u5e38\u7ba1\u7406\uff1b value \u7684\u8bbe\u8ba1\u89c4\u8303\uff0c\u5305\u62ec\u907f\u514d bigkey\u3001\u9009\u62e9\u9ad8\u6548\u5e8f\u5217\u5316\u65b9\u6cd5\u548c\u538b\u7f29\u65b9\u6cd5 \u3001\u4f7f\u7528\u6574\u6570\u5bf9\u8c61\u5171\u4eab\u6c60\u3001\u6570\u636e\u7c7b\u578b\u9009\u62e9\u3002","title":"1\u3001\u952e\u503c\u5bf9\u4f7f\u7528\u89c4\u8303"},{"location":"chap8/5redis_protocol/#1-1-key","text":"\u4e00\u4e2a Redis \u5b9e\u4f8b\u9ed8\u8ba4\u53ef\u4ee5\u652f\u6301 16 \u4e2a\u6570\u636e\u5e93\uff0c\u53ef\u4ee5\u628a\u4e0d\u540c\u7684\u4e1a\u52a1\u6570\u636e\u5206\u6563\u4fdd\u5b58\u5230\u4e0d\u540c\u7684\u6570\u636e\u5e93\u4e2d\u3002 \u4f46\u662f\uff0c\u5728\u4f7f\u7528\u4e0d\u540c\u6570\u636e\u5e93\u65f6\uff0c \u5ba2\u6237\u7aef\u9700\u8981\u4f7f\u7528 SELECT \u547d\u4ee4\u8fdb\u884c\u6570\u636e\u5e93\u5207\u6362\uff0c\u76f8\u5f53\u4e8e\u589e\u52a0\u4e86\u4e00\u4e2a\u989d\u5916\u7684\u64cd\u4f5c\u3002 \u5176\u5b9e\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5408\u7406\u547d\u540d key\uff0c\u51cf\u5c11\u8fd9\u4e2a\u64cd\u4f5c\u3002\u5177\u4f53\u7684\u505a\u6cd5\u662f\uff0c \u628a\u4e1a\u52a1\u540d\u4f5c\u4e3a\u524d\u7f00\uff0c\u7136\u540e\u7528\u5192\u53f7\u5206\u9694\uff0c\u518d\u52a0\u4e0a\u5177\u4f53\u7684\u4e1a\u52a1\u6570\u636e\u540d \u3002\u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 key \u7684\u524d\u7f00\u533a\u5206\u4e0d\u540c\u7684\u4e1a\u52a1\u6570\u636e\uff0c\u5c31\u4e0d\u7528\u5728\u591a\u4e2a\u6570\u636e\u5e93\u95f4\u6765\u56de\u5207\u6362\u4e86\u3002 \u6bd4\u5982\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u8981\u7edf\u8ba1\u7f51\u9875\u7684\u72ec\u7acb\u8bbf\u5ba2\u91cf\uff0c\u5c31\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u4ee3\u7801\u8bbe\u7f6e key\uff0c\u8fd9\u5c31\u8868\u793a\uff0c\u8fd9\u4e2a\u6570\u636e\u5bf9\u5e94\u7684\u4e1a\u52a1\u662f\u7edf\u8ba1 unique visitor \uff08\u72ec\u7acb\u8bbf\u5ba2\u91cf\uff09\uff0c\u800c\u4e14\u5bf9\u5e94\u7684\u9875\u9762\u7f16\u53f7\u662f 1024 \u3002 uv:page:1024 \u8fd9\u91cc\u6709\u4e00\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\u4e00\u4e0b\u3002key \u672c\u8eab\u662f\u5b57\u7b26\u4e32\uff0c\u5e95\u5c42\u7684\u6570\u636e\u7ed3\u6784\u662f SDS\u3002SDS \u7ed3\u6784\u4e2d\u4f1a\u5305\u542b\u5b57\u7b26\u4e32\u957f\u5ea6\u3001\u5206\u914d\u7a7a\u95f4\u5927\u5c0f\u7b49\u5143\u6570\u636e\u4fe1\u606f\u3002\u4ece Redis 3.2 \u7248\u672c\u5f00\u59cb\uff0c \u5f53 key \u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u589e\u52a0\u65f6\uff0cSDS \u4e2d\u7684\u5143\u6570\u636e\u4e5f\u4f1a\u5360\u7528\u66f4\u591a\u5185\u5b58\u7a7a\u95f4\u3002 SDS \u7ed3\u6784\u4e2d\u7684\u5b57\u7b26\u4e32\u957f\u5ea6\u548c\u5143\u6570\u636e\u5927\u5c0f\u7684\u5bf9\u5e94\u5173\u7cfb\u5982\u4e0b\u8868\u6240\u793a\uff1a \u4e86\u51cf\u5c11 key \u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5c0f\u5efa\u8bae\uff1a \u5bf9\u4e8e\u4e1a\u52a1\u540d\u6216\u4e1a\u52a1\u6570\u636e\u540d\uff0c\u53ef\u4ee5\u4f7f\u7528\u76f8\u5e94\u7684\u82f1\u6587\u5355\u8bcd\u7684\u9996\u5b57\u6bcd\u8868\u793a\uff0c\uff08\u6bd4\u5982 user \u7528 u \u8868\u793a\uff0cmessage \u7528 m\uff09\uff0c\u6216\u8005\u662f\u7528\u7f29\u5199\u8868\u793a\uff08\u4f8b\u5982 unique visitor \u4f7f\u7528 uv\uff09\u3002","title":"1-1 \u89c4\u8303\u4e00\uff1akey \u7684\u547d\u540d\u89c4\u8303"},{"location":"chap8/5redis_protocol/#1-2-bigkey","text":"Redis \u662f\u4f7f\u7528\u5355\u7ebf\u7a0b\u8bfb\u5199\u6570\u636e\uff0c bigkey \u7684\u8bfb\u5199\u64cd\u4f5c\u4f1a\u963b\u585e\u7ebf\u7a0b\uff0c\u964d\u4f4e Redis \u7684\u5904\u7406\u6548\u7387 \u3002\u6240\u4ee5\uff0c\u5728\u5e94\u7528 Redis \u65f6\uff0c\u5173\u4e8e value \u7684\u8bbe\u8ba1\u89c4\u8303\uff0c\u975e\u5e38\u91cd\u8981\u7684\u4e00\u70b9\u5c31\u662f\u907f\u514d bigkey\u3002 bigkey \u901a\u5e38\u6709\u4e24\u79cd\u60c5\u51b5\u3002 \u60c5\u51b5\u4e00\uff1a\u952e\u503c\u5bf9\u7684\u503c\u5927\u5c0f\u672c\u8eab\u5c31\u5f88\u5927\uff0c \u4f8b\u5982 value \u4e3a 1MB \u7684 String \u7c7b\u578b\u6570\u636e \u3002\u4e3a\u4e86\u907f\u514d String \u7c7b\u578b\u7684 bigkey\uff0c\u5728\u4e1a\u52a1\u5c42\uff0c\u6211\u4eec\u8981\u5c3d\u91cf\u628a String \u7c7b\u578b\u7684\u6570\u636e\u5927\u5c0f\u63a7\u5236\u5728 10KB \u4ee5\u4e0b\u3002 \u60c5\u51b5\u4e8c\uff1a \u952e\u503c\u5bf9\u7684\u503c\u662f\u96c6\u5408\u7c7b\u578b\uff0c\u96c6\u5408\u5143\u7d20\u4e2a\u6570\u975e\u5e38\u591a\uff0c\u4f8b\u5982\u5305\u542b 100 \u4e07\u4e2a\u5143\u7d20\u7684 Hash \u96c6\u5408\u7c7b\u578b\u6570\u636e \u3002\u4e3a\u4e86\u907f\u514d\u96c6\u5408\u7c7b\u578b\u7684 bigkey\uff0c\u8bbe\u8ba1\u89c4\u8303\u5efa\u8bae\u662f\uff0c \u5c3d\u91cf\u628a\u96c6\u5408\u7c7b\u578b\u7684\u5143\u7d20\u4e2a\u6570\u63a7\u5236\u5728 1 \u4e07\u4ee5\u4e0b\u3002 \u5efa\u8bae\u53ea\u662f\u4e3a\u4e86\u5c3d\u91cf\u907f\u514d bigkey\uff0c\u5982\u679c\u4e1a\u52a1\u5c42\u7684 String \u7c7b\u578b\u6570\u636e\u786e\u5b9e\u5f88\u5927\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u6570\u636e\u538b\u7f29\u6765\u51cf\u5c0f\u6570\u636e\u5927\u5c0f\uff1b\u5982\u679c\u96c6\u5408\u7c7b\u578b\u7684\u5143\u7d20\u7684\u786e\u5f88\u591a\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u4e00\u4e2a\u5927\u96c6\u5408\u62c6\u5206\u6210\u591a\u4e2a\u5c0f\u96c6\u5408\u6765\u4fdd\u5b58\u3002 \u8fd9\u91cc\uff0c\u8fd8\u6709\u4e2a\u5730\u65b9\u9700\u8981\u6ce8\u610f\u4e0b\uff0c Redis \u7684 4 \u79cd\u96c6\u5408\u7c7b\u578b List\u3001Hash\u3001Set \u548c Sorted Set\uff0c\u5728\u96c6\u5408\u5143\u7d20\u4e2a\u6570\u5c0f\u4e8e\u4e00\u5b9a\u7684\u9608\u503c\u65f6\uff0c\u4f1a\u4f7f\u7528\u5185\u5b58\u7d27\u51d1\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u8fdb\u884c\u4fdd\u5b58\uff0c\u4ece\u800c\u8282\u7701\u5185\u5b58 \u3002 \u4f8b\u5982\uff0c\u5047\u8bbe Hash \u96c6\u5408\u7684 hash-max-ziplist-entries \u914d\u7f6e\u9879\u662f 1000 \uff0c\u5982\u679c Hash \u96c6\u5408\u5143\u7d20\u4e2a\u6570\u4e0d\u8d85\u8fc7 1000 \uff0c\u5c31\u4f1a\u4f7f\u7528 ziplist \u4fdd\u5b58\u6570\u636e\u3002 \u7d27\u51d1\u578b\u6570\u636e\u7ed3\u6784\u867d\u7136\u53ef\u4ee5\u8282\u7701\u5185\u5b58\uff0c\u4f46\u662f\u4f1a\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u5bfc\u81f4\u6570\u636e\u7684\u8bfb\u5199\u6027\u80fd\u4e0b\u964d\u3002\u6240\u4ee5\uff0c\u5982\u679c\u4e1a\u52a1\u5e94\u7528\u66f4\u52a0\u9700\u8981\u4fdd\u6301\u9ad8\u6027\u80fd\u8bbf\u95ee\uff0c\u800c\u4e0d\u662f\u8282\u7701\u5185\u5b58\u7684\u8bdd\uff0c\u5728\u4e0d\u4f1a\u5bfc\u81f4 bigkey \u7684\u524d\u63d0\u4e0b\uff0c\u4f60\u5c31\u4e0d\u7528\u523b\u610f\u63a7\u5236\u96c6\u5408\u5143\u7d20\u4e2a\u6570\u4e86\u3002","title":"1-2 \u89c4\u8303\u4e8c\uff1a\u907f\u514d\u4f7f\u7528 bigkey"},{"location":"chap8/5redis_protocol/#1-3","text":"\u4e3a\u4e86\u8282\u7701\u5185\u5b58\uff0c\u9664\u4e86\u91c7\u7528\u7d27\u51d1\u578b\u6570\u636e\u7ed3\u6784\u4ee5\u5916\uff0c\u8fd8\u53ef\u4ee5\u9075\u5faa\u4e24\u4e2a\u4f7f\u7528\u89c4\u8303\uff0c \u5206\u522b\u662f\u4f7f\u7528\u9ad8\u6548\u7684\u5e8f\u5217\u5316\u65b9\u6cd5\u548c\u538b\u7f29\u65b9\u6cd5\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11 value \u7684\u5927\u5c0f\u3002 Redis \u4e2d\u7684\u5b57\u7b26\u4e32\u90fd\u662f\u4f7f\u7528\u4e8c\u8fdb\u5236\u5b89\u5168\u7684\u5b57\u8282\u6570\u7ec4\u6765\u4fdd\u5b58\u7684\uff0c\u6240\u4ee5\uff0c\u53ef\u4ee5\u628a\u4e1a\u52a1\u6570\u636e\u5e8f\u5217\u5316\u6210\u4e8c\u8fdb\u5236\u6570\u636e\u5199\u5165\u5230 Redis \u4e2d\u3002 \u4e0d\u540c\u7684\u5e8f\u5217\u5316\u65b9\u6cd5\uff0c\u5728\u5e8f\u5217\u5316\u901f\u5ea6\u548c\u6570\u636e\u5e8f\u5217\u5316\u540e\u7684\u5360\u7528\u5185\u5b58\u7a7a\u95f4\u8fd9\u4e24\u4e2a\u65b9\u9762\uff0c\u6548\u679c\u662f\u4e0d\u4e00\u6837\u7684\u3002 \u6bd4\u5982\u8bf4\uff0cprotostuff \u548c kryo \u8fd9\u4e24\u79cd\u5e8f\u5217\u5316\u65b9\u6cd5\uff0c\u5c31\u8981\u6bd4 Java \u5185\u7f6e\u7684\u5e8f\u5217\u5316\u65b9\u6cd5\uff08 java-build-in-serializer \uff09\u6548\u7387\u66f4\u9ad8\u3002 \u4e1a\u52a1\u5e94\u7528\u6709\u65f6\u4f1a\u4f7f\u7528\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684 XML \u548c JSON \u683c\u5f0f\u4fdd\u5b58\u6570\u636e\u3002 \u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u8fd9\u4e24\u79cd\u683c\u5f0f\u7684\u53ef\u8bfb\u6027\u597d\uff0c\u4fbf\u4e8e\u8c03\u8bd5\uff0c\u4e0d\u540c\u7684\u5f00\u53d1\u8bed\u8a00\u90fd\u652f\u6301\u8fd9\u4e24\u79cd\u683c\u5f0f\u7684\u89e3\u6790\u3002 \u7f3a\u70b9\u5728\u4e8e\uff0cXML \u548c JSON \u683c\u5f0f\u7684\u6570\u636e\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u6bd4\u8f83\u5927\u3002\u4e3a\u4e86\u907f\u514d\u6570\u636e\u5360\u7528\u8fc7\u5927\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u6211\u5efa\u8bae\u4f7f\u7528\u538b\u7f29\u5de5\u5177\uff08\u4f8b\u5982 snappy \u6216 gzip\uff09\uff0c\u628a\u6570\u636e\u538b\u7f29\u540e\u518d\u5199\u5165 Redis\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u4e86\u3002","title":"1-3 \u89c4\u8303\u4e09\uff1a\u4f7f\u7528\u9ad8\u6548\u5e8f\u5217\u5316\u65b9\u6cd5\u548c\u538b\u7f29\u65b9\u6cd5"},{"location":"chap8/5redis_protocol/#1-4","text":"\u6574\u6570\u662f\u5e38\u7528\u7684\u6570\u636e\u7c7b\u578b\uff0cRedis \u5185\u90e8\u7ef4\u62a4\u4e86 0 \u5230 9999 \u8fd9 1 \u4e07\u4e2a\u6574\u6570\u5bf9\u8c61\uff0c\u5e76\u628a\u8fd9\u4e9b\u6574\u6570\u4f5c\u4e3a\u4e00\u4e2a\u5171\u4eab\u6c60\u4f7f\u7528\u3002 \u6362\u53e5\u8bdd\u8bf4\uff0c\u5982\u679c\u4e00\u4e2a\u952e\u503c\u5bf9\u4e2d\u6709 0 \u5230 9999 \u8303\u56f4\u7684\u6574\u6570\uff0cRedis \u5c31\u4e0d\u4f1a\u4e3a\u8fd9\u4e2a\u952e\u503c\u5bf9\u4e13\u95e8\u521b\u5efa\u6574\u6570\u5bf9\u8c61\u4e86\uff0c\u800c\u662f\u4f1a\u590d\u7528\u5171\u4eab\u6c60\u4e2d\u7684\u6574\u6570\u5bf9\u8c61\u3002 \u90a3\u4ec0\u4e48\u65f6\u5019\u4e0d\u80fd\u7528\u6574\u6570\u5bf9\u8c61\u5171\u4eab\u6c60\u5462\uff1f\u4e3b\u8981\u6709\u4e24\u79cd\u60c5\u51b5\u3002 \u7b2c\u4e00\u79cd\u60c5\u51b5\u662f\uff0c \u5982\u679c Redis \u4e2d\u8bbe\u7f6e\u4e86 maxmemory\uff0c\u800c\u4e14\u542f\u7528\u4e86 LRU \u7b56\u7565\uff08allkeys-lru \u6216 volatile-lru \u7b56\u7565\uff09\uff0c\u90a3\u4e48\uff0c\u6574\u6570\u5bf9\u8c61\u5171\u4eab\u6c60\u5c31\u65e0\u6cd5\u4f7f\u7528\u4e86 \u3002\u8fd9\u662f\u56e0\u4e3a\uff0cLRU \u7b56\u7565\u9700\u8981\u7edf\u8ba1\u6bcf\u4e2a\u952e\u503c\u5bf9\u7684\u4f7f\u7528\u65f6\u95f4\uff0c\u5982\u679c\u4e0d\u540c\u7684\u952e\u503c\u5bf9\u90fd\u5171\u4eab\u4f7f\u7528\u4e00\u4e2a\u6574\u6570\u5bf9\u8c61\uff0cLRU \u7b56\u7565\u5c31\u65e0\u6cd5\u8fdb\u884c\u7edf\u8ba1\u4e86\u3002 \u7b2c\u4e8c\u79cd\u60c5\u51b5\u662f\uff0c\u5982\u679c\u96c6\u5408\u7c7b\u578b\u6570\u636e\u91c7\u7528 ziplist \u7f16\u7801\uff0c\u800c\u96c6\u5408\u5143\u7d20\u662f\u6574\u6570\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u4e5f\u4e0d\u80fd\u4f7f\u7528\u5171\u4eab\u6c60\u3002\u56e0\u4e3a ziplist \u4f7f\u7528\u4e86\u7d27\u51d1\u578b\u5185\u5b58\u7ed3\u6784\uff0c\u5224\u65ad\u6574\u6570\u5bf9\u8c61\u7684\u5171\u4eab\u60c5\u51b5\u6548\u7387\u4f4e\u3002","title":"1-4 \u89c4\u8303\u56db\uff1a\u4f7f\u7528\u6574\u6570\u5bf9\u8c61\u5171\u4eab\u6c60"},{"location":"chap8/5redis_protocol/#2","text":"","title":"2\u3001\u6570\u636e\u4fdd\u5b58\u89c4\u8303"},{"location":"chap8/5redis_protocol/#2-1-redis","text":"\u4e3a\u4e86\u63d0\u4f9b\u9ad8\u6027\u80fd\u8bbf\u95ee\uff0cRedis \u662f\u628a\u6240\u6709\u6570\u636e\u4fdd\u5b58\u5230\u5185\u5b58\u4e2d\u7684\u3002 \u867d\u7136 Redis \u652f\u6301\u4f7f\u7528 RDB \u5feb\u7167\u548c AOF \u65e5\u5fd7\u6301\u4e45\u5316\u4fdd\u5b58\u6570\u636e\uff0c\u4f46\u662f\uff0c\u8fd9\u4e24\u4e2a\u673a\u5236\u90fd\u662f\u7528\u6765\u63d0\u4f9b\u6570\u636e\u53ef\u9760\u6027\u4fdd\u8bc1\u7684\uff0c\u5e76\u4e0d\u662f\u7528\u6765\u6269\u5145\u6570\u636e\u5bb9\u91cf\u7684\u3002\u800c\u4e14\uff0c\u5185\u5b58\u6210\u672c\u672c\u8eab\u5c31\u6bd4\u8f83\u9ad8\uff0c\u5982\u679c\u628a\u4e1a\u52a1\u6570\u636e\u90fd\u4fdd\u5b58\u5728 Redis \u4e2d\uff0c\u4f1a\u5e26\u6765\u8f83\u5927\u7684\u5185\u5b58\u6210\u672c\u538b\u529b\u3002 \u6240\u4ee5\uff0c\u4e00\u822c\u6765\u8bf4\uff0c\u5728\u5b9e\u9645\u5e94\u7528 Redis \u65f6\uff0c\u6211\u4eec\u4f1a\u66f4\u591a\u5730\u628a\u5b83\u4f5c\u4e3a\u7f13\u5b58\u4fdd\u5b58\u70ed\u6570\u636e\uff0c\u8fd9\u6837\u65e2\u53ef\u4ee5\u5145\u5206\u5229\u7528 Redis \u7684\u9ad8\u6027\u80fd\u7279\u6027\u3002","title":"2-1 \u89c4\u8303\u4e00\uff1a\u4f7f\u7528 Redis \u4fdd\u5b58\u70ed\u6570\u636e"},{"location":"chap8/5redis_protocol/#2-2","text":"\u867d\u7136\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 key \u7684\u524d\u7f00\u628a\u4e0d\u540c\u4e1a\u52a1\u7684\u6570\u636e\u533a\u5206\u5f00\uff0c\u4f46\u662f\uff0c\u5982\u679c\u6240\u6709\u4e1a\u52a1\u7684\u6570\u636e\u91cf\u90fd\u5f88\u5927\uff0c\u800c\u4e14\u8bbf\u95ee\u7279\u5f81\u4e5f\u4e0d\u4e00\u6837\uff0c\u6211\u4eec\u628a\u8fd9\u4e9b\u6570\u636e\u4fdd\u5b58\u5728\u540c\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\u65f6\uff0c\u8fd9\u4e9b\u6570\u636e\u7684\u64cd\u4f5c\u5c31\u4f1a\u76f8\u4e92\u5e72\u6270\u3002 \u4e00\u4e2a\u573a\u666f\uff1a\u5047\u5982\u6570\u636e\u91c7\u96c6\u4e1a\u52a1\u4f7f\u7528 Redis \u4fdd\u5b58\u6570\u636e\u65f6\uff0c\u4ee5\u5199\u64cd\u4f5c\u4e3a\u4e3b\uff0c\u800c\u7528\u6237\u7edf\u8ba1\u4e1a\u52a1\u4f7f\u7528 Redis \u65f6\uff0c\u662f\u4ee5\u8bfb\u67e5\u8be2\u4e3a\u4e3b\uff0c \u5982\u679c\u8fd9\u4e24\u4e2a\u4e1a\u52a1\u6570\u636e\u6df7\u5728\u4e00\u8d77\u4fdd\u5b58\uff0c\u8bfb\u5199\u64cd\u4f5c\u76f8\u4e92\u5e72\u6270\uff0c\u80af\u5b9a\u4f1a\u5bfc\u81f4\u4e1a\u52a1\u54cd\u5e94\u53d8\u6162\u3002 \u5efa\u8bae\u4f60\u628a\u4e0d\u540c\u7684\u4e1a\u52a1\u6570\u636e\u653e\u5230\u4e0d\u540c\u7684 Redis \u5b9e\u4f8b\u4e2d \u3002\u8fd9\u6837\u4e00\u6765\uff0c\u65e2\u53ef\u4ee5\u907f\u514d\u5355\u5b9e\u4f8b\u7684\u5185\u5b58\u4f7f\u7528\u91cf\u8fc7\u5927\uff0c\u4e5f\u53ef\u4ee5\u907f\u514d\u4e0d\u540c\u4e1a\u52a1\u7684\u64cd\u4f5c\u76f8\u4e92\u5e72\u6270\u3002","title":"2-2 \u89c4\u8303\u4e8c\uff1a\u4e0d\u540c\u7684\u4e1a\u52a1\u6570\u636e\u5206\u5b9e\u4f8b\u5b58\u50a8"},{"location":"chap8/5redis_protocol/#2-3","text":"\u5bf9\u4e8e Redis \u6765\u8bf4\uff0c\u5185\u5b58\u662f\u975e\u5e38\u5b9d\u8d35\u7684\u8d44\u6e90\uff0c\u800c\u4e14\uff0cRedis \u901a\u5e38\u7528\u4e8e\u4fdd\u5b58\u70ed\u6570\u636e\u3002\u70ed\u6570\u636e\u4e00\u822c\u90fd\u6709\u4f7f\u7528\u7684\u65f6\u6548\u6027\u3002 \u6839\u636e\u4e1a\u52a1\u4f7f\u7528\u6570\u636e\u7684\u65f6\u957f\uff0c\u8bbe\u7f6e\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4 \u3002\u4e0d\u7136\u7684\u8bdd\uff0c\u5199\u5165 Redis \u7684\u6570\u636e\u4f1a\u4e00\u76f4\u5360\u7528\u5185\u5b58\uff0c\u5982\u679c\u6570\u636e\u6301\u7eed\u589e\u591a\uff0c\u5c31\u53ef\u80fd\u8fbe\u5230\u673a\u5668\u7684\u5185\u5b58\u4e0a\u9650\uff0c\u9020\u6210\u5185\u5b58\u6ea2\u51fa\uff0c\u5bfc\u81f4\u670d\u52a1\u5d29\u6e83\u3002","title":"2-3 \u89c4\u8303\u4e09\uff1a\u5728\u6570\u636e\u4fdd\u5b58\u65f6\uff0c\u8981\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4"},{"location":"chap8/5redis_protocol/#2-4-redis","text":"Redis \u5355\u5b9e\u4f8b\u7684\u5185\u5b58\u5927\u5c0f\u90fd\u4e0d\u8981\u592a\u5927\uff0c \u6839\u636e\u81ea\u5df1\u7684\u7ecf\u9a8c\u503c\uff0c\u5efa\u8bae\u4f60\u8bbe\u7f6e\u5728 2~6GB \u3002\u8fd9\u6837\u4e00\u6765\uff0c\u65e0\u8bba\u662f RDB \u5feb\u7167\uff0c\u8fd8\u662f\u4e3b\u4ece\u96c6\u7fa4\u8fdb\u884c\u6570\u636e\u540c\u6b65\uff0c\u90fd\u80fd\u5f88\u5feb\u5b8c\u6210\uff0c\u4e0d\u4f1a\u963b\u585e\u6b63\u5e38\u8bf7\u6c42\u7684\u5904\u7406\u3002","title":"2-4 \u89c4\u8303\u56db\uff1a\u63a7\u5236 Redis \u5b9e\u4f8b\u7684\u5bb9\u91cf"},{"location":"chap8/5redis_protocol/#3","text":"","title":"3\u3001\u547d\u4ee4\u4f7f\u7528\u89c4\u8303"},{"location":"chap8/5redis_protocol/#3-1","text":"Redis \u662f\u5355\u7ebf\u7a0b\u5904\u7406\u8bf7\u6c42\u64cd\u4f5c\uff0c \u5982\u679c\u6267\u884c\u4e00\u4e9b\u6d89\u53ca\u5927\u91cf\u64cd\u4f5c\u3001\u8017\u65f6\u957f\u7684\u547d\u4ee4\uff0c\u5c31\u4f1a\u4e25\u91cd\u963b\u585e\u4e3b\u7ebf\u7a0b \uff0c\u5bfc\u81f4\u5176\u5b83\u8bf7\u6c42\u65e0\u6cd5\u5f97\u5230\u6b63\u5e38\u5904\u7406\uff0c\u8fd9\u7c7b\u547d\u4ee4\u4e3b\u8981\u6709 3 \u79cd\u3002 KEYS \uff0c \u6309\u7167\u952e\u503c\u5bf9\u7684 key \u5185\u5bb9\u8fdb\u884c\u5339\u914d\uff0c\u8fd4\u56de\u7b26\u5408\u5339\u914d\u6761\u4ef6\u7684\u952e\u503c\u5bf9 \uff0c\u8be5\u547d\u4ee4\u9700\u8981\u5bf9 Redis \u7684\u5168\u5c40\u54c8\u5e0c\u8868\u8fdb\u884c\u5168\u8868\u626b\u63cf\uff0c\u4e25\u91cd\u963b\u585e Redis \u4e3b\u7ebf\u7a0b\uff1b FLUSHALL\uff0c\u5220\u9664 Redis \u5b9e\u4f8b\u4e0a\u7684\u6240\u6709\u6570\u636e \uff0c\u5982\u679c\u6570\u636e\u91cf\u5f88\u5927\uff0c\u4f1a\u4e25\u91cd\u963b\u585e Redis \u4e3b\u7ebf\u7a0b\uff1b FLUSHDB\uff0c\u5220\u9664\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e \uff0c\u5982\u679c\u6570\u636e\u91cf\u5f88\u5927\uff0c\u540c\u6837\u4f1a\u963b\u585e Redis \u4e3b\u7ebf\u7a0b\u3002\uff1b \u5177\u4f53\u7684\u505a\u6cd5\u662f\uff0c\u7ba1\u7406\u5458\u7528 rename-command \u547d\u4ee4\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u5bf9\u8fd9\u4e9b\u547d\u4ee4\u8fdb\u884c\u91cd\u547d\u540d\uff0c\u8ba9\u5ba2\u6237\u7aef\u65e0\u6cd5\u4f7f\u7528\u8fd9\u4e9b\u547d\u4ee4\u3002 \u5f53\u7136\uff0c\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528\u5176\u5b83\u547d\u4ee4\u66ff\u4ee3\u8fd9 3 \u4e2a\u547d\u4ee4\u3002 \u5bf9\u4e8e KEYS \u547d\u4ee4\u6765\u8bf4\uff0c \u4f60\u53ef\u4ee5\u7528 SCAN \u547d\u4ee4\u4ee3\u66ff KEYS \u547d\u4ee4 \uff0c\u5206\u6279\u8fd4\u56de\u7b26\u5408\u6761\u4ef6\u7684\u952e\u503c\u5bf9\uff0c\u907f\u514d\u9020\u6210\u4e3b\u7ebf\u7a0b\u963b\u585e\uff1b \u5bf9\u4e8e FLUSHALL\u3001FLUSHDB \u547d\u4ee4\u6765\u8bf4\uff0c\u4f60\u53ef\u4ee5\u52a0\u4e0a ASYNC \u9009\u9879 \uff0c\u8ba9\u8fd9\u4e24\u4e2a\u547d\u4ee4\u4f7f\u7528\u540e\u53f0\u7ebf\u7a0b\u5f02\u6b65\u5220\u9664\u6570\u636e\uff0c\u53ef\u4ee5\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002","title":"3-1 \u89c4\u8303\u4e00\uff1a\u7ebf\u4e0a\u7981\u7528\u90e8\u5206\u547d\u4ee4"},{"location":"chap8/5redis_protocol/#3-2-monitor","text":"Redis \u7684 MONITOR \u547d\u4ee4\u5728\u6267\u884c\u540e\uff0c\u4f1a\u6301\u7eed\u8f93\u51fa\u76d1\u6d4b\u5230\u7684\u5404\u4e2a\u547d\u4ee4\u64cd\u4f5c \uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u7528 MONITOR \u547d\u4ee4\u8fd4\u56de\u7684\u7ed3\u679c\uff0c\u68c0\u67e5\u547d\u4ee4\u7684\u6267\u884c\u60c5\u51b5\u3002 \u4f46\u662f\uff0cMONITOR \u547d\u4ee4\u4f1a\u628a\u76d1\u63a7\u5230\u7684\u5185\u5bb9\u6301\u7eed\u5199\u5165\u8f93\u51fa\u7f13\u51b2\u533a\u3002\u5982\u679c\u7ebf\u4e0a\u547d\u4ee4\u7684\u64cd\u4f5c\u5f88\u591a\uff0c\u8f93\u51fa\u7f13\u51b2\u533a\u5f88\u5feb\u5c31\u4f1a\u6ea2\u51fa\u4e86\uff0c\u8fd9\u5c31\u4f1a\u5bf9 Redis \u6027\u80fd\u9020\u6210\u5f71\u54cd\uff0c\u751a\u81f3\u5f15\u8d77\u670d\u52a1\u5d29\u6e83\u3002 \u6240\u4ee5\uff0c\u9664\u975e\u5341\u5206\u9700\u8981\u76d1\u6d4b\u67d0\u4e9b\u547d\u4ee4\u7684\u6267\u884c\uff08\u4f8b\u5982\uff0cRedis \u6027\u80fd\u7a81\u7136\u53d8\u6162\uff0c\u6211\u4eec\u60f3\u67e5\u770b\u4e0b\u5ba2\u6237\u7aef\u6267\u884c\u4e86\u54ea\u4e9b\u547d\u4ee4\uff09\uff0c \u53ef\u4ee5\u5076\u5c14\u5728\u77ed\u65f6\u95f4\u5185\u4f7f\u7528\u4e0b MONITOR \u547d\u4ee4\uff0c\u5426\u5219\uff0c\u5efa\u8bae\u4f60\u4e0d\u8981\u4f7f\u7528 MONITOR \u547d\u4ee4\u3002","title":"3-2 \u89c4\u8303\u4e8c\uff1a\u614e\u7528 MONITOR \u547d\u4ee4"},{"location":"chap8/5redis_protocol/#3-3","text":"\u5bf9\u4e8e\u96c6\u5408\u7c7b\u578b\u7684\u6570\u636e\u6765\u8bf4\uff0c\u5982\u679c\u60f3\u8981\u83b7\u5f97\u96c6\u5408\u4e2d\u7684\u6240\u6709\u5143\u7d20\uff0c\u4e00\u822c\u4e0d\u5efa\u8bae\u4f7f\u7528\u5168\u91cf\u64cd\u4f5c\u7684\u547d\u4ee4\uff08\u4f8b\u5982 Hash \u7c7b\u578b\u7684 HGETALL \u3001 Set \u7c7b\u578b\u7684 SMEMBER S\uff09\u3002\u8fd9\u4e9b\u64cd\u4f5c\u4f1a\u5bf9 Hash \u548c Set \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u8fdb\u884c\u5168\u91cf\u626b\u63cf\uff0c\u5982\u679c\u96c6\u5408\u7c7b\u578b\u6570\u636e\u8f83\u591a\u7684\u8bdd\uff0c\u5c31\u4f1a\u963b\u585e Redis \u4e3b\u7ebf\u7a0b\u3002 \u5982\u679c\u60f3\u8981\u83b7\u5f97\u96c6\u5408\u7c7b\u578b\u7684\u5168\u91cf\u6570\u636e\uff0c\u6211\u7ed9\u4f60\u4e09\u4e2a\u5c0f\u5efa\u8bae\u3002 \u7b2c\u4e00\u4e2a\u5efa\u8bae\u662f\uff0c \u4f60\u53ef\u4ee5\u4f7f\u7528 SSCAN\u3001HSCAN \u547d\u4ee4\u5206\u6279\u8fd4\u56de\u96c6\u5408\u4e2d\u7684\u6570\u636e\uff0c\u51cf\u5c11\u5bf9\u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\u3002 \u7b2c\u4e8c\u4e2a\u5efa\u8bae\u662f\uff0c \u4f60\u53ef\u4ee5\u5316\u6574\u4e3a\u96f6\uff0c\u628a\u4e00\u4e2a\u5927\u7684 Hash \u96c6\u5408\u62c6\u5206\u6210\u591a\u4e2a\u5c0f\u7684 Hash \u96c6\u5408 \u3002\u8fd9\u4e2a\u64cd\u4f5c\u5bf9\u5e94\u5230\u4e1a\u52a1\u5c42\uff0c\u5c31\u662f\u5bf9\u4e1a\u52a1\u6570\u636e\u8fdb\u884c\u62c6\u5206\uff0c\u6309\u7167\u65f6\u95f4\u3001\u5730\u57df\u3001\u7528\u6237 ID \u7b49\u5c5e\u6027\u628a\u4e00\u4e2a\u5927\u96c6\u5408\u7684\u4e1a\u52a1\u6570\u636e\u62c6\u5206\u6210\u591a\u4e2a\u5c0f\u96c6\u5408\u6570\u636e\u3002\u4f8b\u5982\uff0c\u5f53\u4f60\u7edf\u8ba1\u7528\u6237\u7684\u8bbf\u95ee\u60c5\u51b5\u65f6\uff0c\u5c31\u53ef\u4ee5\u6309\u7167\u5929\u7684\u7c92\u5ea6\uff0c\u628a\u6bcf\u5929\u7684\u6570\u636e\u4f5c\u4e3a\u4e00\u4e2a Hash \u96c6\u5408\u3002 \u6700\u540e\u4e00\u4e2a\u5efa\u8bae\u662f\uff0c\u5982\u679c\u96c6\u5408\u7c7b\u578b\u4fdd\u5b58\u7684\u662f\u4e1a\u52a1\u6570\u636e\u7684\u591a\u4e2a\u5c5e\u6027\uff0c\u800c\u6bcf\u6b21\u67e5\u8be2\u65f6\uff0c\u4e5f\u9700\u8981\u8fd4\u56de\u8fd9\u4e9b\u5c5e\u6027\uff0c\u90a3\u4e48\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 String \u7c7b\u578b\uff0c\u5c06\u8fd9\u4e9b\u5c5e\u6027\u5e8f\u5217\u5316\u540e\u4fdd\u5b58\uff0c\u6bcf\u6b21\u76f4\u63a5\u8fd4\u56de String \u6570\u636e\u5c31\u884c\uff0c\u4e0d\u7528\u518d\u5bf9\u96c6\u5408\u7c7b\u578b\u505a\u5168\u91cf\u626b\u63cf\u4e86\u3002","title":"3-3 \u89c4\u8303\u4e09\uff1a\u614e\u7528\u5168\u91cf\u64cd\u4f5c\u547d\u4ee4"},{"location":"chap8/5redis_protocol/#4","text":"","title":"4\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap8/5redis_protocol/#4-1","text":"\u5f3a\u5236\u7c7b\u522b\u7684\u89c4\u8303\uff1a\u8fd9\u8868\u793a\uff0c\u5982\u679c\u4e0d\u6309\u7167\u89c4\u8303\u5185\u5bb9\u6765\u6267\u884c\uff0c\u5c31\u4f1a\u7ed9 Redis \u7684\u5e94\u7528\u5e26\u6765\u6781\u5927\u7684\u8d1f\u9762\u5f71\u54cd\uff0c\u4f8b\u5982\u6027\u80fd\u53d7\u635f\u3002 \u63a8\u8350\u7c7b\u522b\u7684\u89c4\u8303\uff1a\u8fd9\u4e2a\u89c4\u8303\u7684\u5185\u5bb9\u80fd\u6709\u6548\u63d0\u5347\u6027\u80fd\u3001\u8282\u7701\u5185\u5b58\u7a7a\u95f4\uff0c\u6216\u8005\u662f\u589e\u52a0\u5f00\u53d1\u548c\u8fd0\u7ef4\u7684\u4fbf\u6377\u6027\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u5e94\u7528\u5230\u5b9e\u8df5\u4e2d\u3002 \u5efa\u8bae\u7c7b\u522b\u7684\u89c4\u8303\uff1a\u8fd9\u7c7b\u89c4\u8303\u5185\u5bb9\u548c\u5b9e\u9645\u4e1a\u52a1\u5e94\u7528\u76f8\u5173\uff0c\u53ea\u662f\u4ece\u7ecf\u5386\u6216\u7ecf\u9a8c\u7ed9\u4f60\u4e00\u4e2a\u5efa\u8bae\uff0c\u4f60\u9700\u8981\u7ed3\u5408\u81ea\u5df1\u7684\u4e1a\u52a1\u573a\u666f\u53c2\u8003\u4f7f\u7528\u3002","title":"4-1 \u89c4\u8303\u5206\u7c7b"},{"location":"chap8/5redis_protocol/#4-1_1","text":"key \u7684\u957f\u5ea6\u5c3d\u91cf\u77ed\uff0c\u8282\u7701\u5185\u5b58\u7a7a\u95f4 \u907f\u514d bigkey\uff0c\u9632\u6b62\u963b\u585e\u4e3b\u7ebf\u7a0b 4.0+\u7248\u672c\u5efa\u8bae\u5f00\u542f lazy-free \u628a Redis \u5f53\u4f5c\u7f13\u5b58\u4f7f\u7528\uff0c\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4 \u4e0d\u4f7f\u7528\u590d\u6742\u5ea6\u8fc7\u9ad8\u7684\u547d\u4ee4\uff0c\u4f8b\u5982SORT\u3001SINTER\u3001SINTERSTORE\u3001ZUNIONSTORE\u3001ZINTERSTORE \u67e5\u8be2\u6570\u636e\u5c3d\u91cf\u4e0d\u4e00\u6b21\u6027\u67e5\u8be2\u5168\u91cf\uff0c\u5199\u5165\u5927\u91cf\u6570\u636e\u5efa\u8bae\u5206\u591a\u6279\u5199\u5165 \u6279\u91cf\u64cd\u4f5c\u5efa\u8bae MGET/MSET \u66ff\u4ee3 GET/SET\uff0cHMGET/HMSET \u66ff\u4ee3 HGET/HSET \u7981\u6b62\u4f7f\u7528 KEYS/FLUSHALL/FLUSHDB \u547d\u4ee4 \u907f\u514d\u96c6\u4e2d\u8fc7\u671f key \u6839\u636e\u4e1a\u52a1\u573a\u666f\u9009\u62e9\u5408\u9002\u7684\u6dd8\u6c70\u7b56\u7565 1\u4f7f\u7528\u8fde\u63a5\u6c60\u64cd\u4f5c Redis\uff0c\u5e76\u8bbe\u7f6e\u5408\u7406\u7684\u53c2\u6570\uff0c\u907f\u514d\u77ed\u8fde\u63a5 \u53ea\u4f7f\u7528 db0\uff0c\u51cf\u5c11 SELECT \u547d\u4ee4\u7684\u6d88\u8017 \u8bfb\u8bf7\u6c42\u91cf\u5f88\u5927\u65f6\uff0c\u5efa\u8bae\u8bfb\u5199\u5206\u79bb\uff0c\u5199\u8bf7\u6c42\u91cf\u5f88\u5927\uff0c\u5efa\u8bae\u4f7f\u7528\u5207\u7247\u96c6\u7fa4","title":"4-1 \u4e1a\u52a1\u5c42\u9762\u4e3b\u8981\u9762\u5411\u7684\u4e1a\u52a1\u5f00\u53d1\u4eba\u5458"},{"location":"chap8/5redis_protocol/#4-2-dba","text":"\u6309\u4e1a\u52a1\u7ebf\u90e8\u7f72\u5b9e\u4f8b\uff0c\u907f\u514d\u591a\u4e2a\u4e1a\u52a1\u7ebf\u6df7\u5408\u90e8\u7f72\uff0c\u51fa\u95ee\u9898\u5f71\u54cd\u5176\u4ed6\u4e1a\u52a1 \u4fdd\u8bc1\u673a\u5668\u6709\u8db3\u591f\u7684 CPU\u3001\u5185\u5b58\u3001\u5e26\u5bbd\u3001\u78c1\u76d8\u8d44\u6e90 \u5efa\u8bae\u90e8\u7f72\u4e3b\u4ece\u96c6\u7fa4\uff0c\u5e76\u5206\u5e03\u5728\u4e0d\u540c\u673a\u5668\u4e0a\uff0cslave \u8bbe\u7f6e\u4e3a readonly \u4e3b\u4ece\u8282\u70b9\u6240\u90e8\u7f72\u7684\u673a\u5668\u5404\u81ea\u72ec\u7acb\uff0c\u5c3d\u91cf\u907f\u514d\u4ea4\u53c9\u90e8\u7f72\uff0c\u5bf9\u4ece\u8282\u70b9\u505a\u7ef4\u62a4\u65f6\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5230\u4e3b\u8282\u70b9 \u63a8\u8350\u90e8\u7f72\u54e8\u5175\u96c6\u7fa4\u5b9e\u73b0\u6545\u969c\u81ea\u52a8\u5207\u6362\uff0c\u54e8\u5175\u8282\u70b9\u5206\u5e03\u5728\u4e0d\u540c\u673a\u5668\u4e0a \u63d0\u524d\u505a\u597d\u5bb9\u91cf\u89c4\u5212\uff0c\u9632\u6b62\u4e3b\u4ece\u5168\u91cf\u540c\u6b65\u65f6\uff0c\u5b9e\u4f8b\u4f7f\u7528\u5185\u5b58\u7a81\u589e\u5bfc\u81f4\u5185\u5b58\u4e0d\u8db3 \u505a\u597d\u673a\u5668 CPU\u3001\u5185\u5b58\u3001\u5e26\u5bbd\u3001\u78c1\u76d8\u76d1\u63a7\uff0c\u8d44\u6e90\u4e0d\u8db3\u65f6\u53ca\u65f6\u62a5\u8b66\uff0c\u4efb\u610f\u8d44\u6e90\u4e0d\u8db3\u90fd\u4f1a\u5f71\u54cd Redis \u6027\u80fd \u5b9e\u4f8b\u8bbe\u7f6e\u6700\u5927\u8fde\u63a5\u6570\uff0c\u9632\u6b62\u8fc7\u591a\u5ba2\u6237\u7aef\u8fde\u63a5\u5bfc\u81f4\u5b9e\u4f8b\u8d1f\u8f7d\u8fc7\u9ad8\uff0c\u5f71\u54cd\u6027\u80fd \u5355\u4e2a\u5b9e\u4f8b\u5185\u5b58\u5efa\u8bae\u63a7\u5236\u5728 10G \u4ee5\u4e0b\uff0c\u5927\u5b9e\u4f8b\u5728\u4e3b\u4ece\u5168\u91cf\u540c\u6b65\u3001\u5907\u4efd\u65f6\u6709\u963b\u585e\u98ce\u9669 \u8bbe\u7f6e\u5408\u7406\u7684 slowlog \u9608\u503c\uff0c\u5e76\u5bf9\u5176\u8fdb\u884c\u76d1\u63a7\uff0cslowlog \u8fc7\u591a\u9700\u53ca\u65f6\u62a5\u8b66 \u8bbe\u7f6e\u5408\u7406\u7684 repl-backlog\uff0c\u964d\u4f4e\u4e3b\u4ece\u5168\u91cf\u540c\u6b65\u7684\u6982\u7387 \u8bbe\u7f6e\u5408\u7406\u7684 slave client-output-buffer-limit \uff0c\u907f\u514d\u4e3b\u4ece\u590d\u5236\u4e2d\u65ad\u60c5\u51b5\u53d1\u751f \u63a8\u8350\u5728\u4ece\u8282\u70b9\u4e0a\u5907\u4efd\uff0c\u4e0d\u5f71\u54cd\u4e3b\u8282\u70b9\u6027\u80fd \u4e0d\u5f00\u542f AOF \u6216\u5f00\u542f AOF \u914d\u7f6e\u4e3a\u6bcf\u79d2\u5237\u76d8\uff0c\u907f\u514d\u78c1\u76d8 IO \u62d6\u6162 Redis \u6027\u80fd \u8c03\u6574 maxmemory \u65f6\uff0c\u6ce8\u610f\u4e3b\u4ece\u8282\u70b9\u7684\u8c03\u6574\u987a\u5e8f\uff0c\u987a\u5e8f\u9519\u8bef\u4f1a\u5bfc\u81f4\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4 \u5bf9\u5b9e\u4f8b\u90e8\u7f72\u76d1\u63a7\uff0c\u91c7\u96c6 INFO \u4fe1\u606f\u65f6\u91c7\u7528\u957f\u8fde\u63a5\uff0c\u907f\u514d\u9891\u7e41\u7684\u77ed\u8fde\u63a5 \u505a\u597d\u5b9e\u4f8b\u8fd0\u884c\u65f6\u76d1\u63a7\uff0c\u91cd\u70b9\u5173\u6ce8 expired_keys \u3001 evicted_keys \u3001 latest_fork_usec \uff0c\u8fd9\u4e9b\u6307\u6807\u77ed\u65f6\u7a81\u589e\u53ef\u80fd\u4f1a\u6709\u963b\u585e\u98ce\u9669 \u626b\u63cf\u7ebf\u4e0a\u5b9e\u4f8b\u65f6\uff0c\u8bb0\u5f97\u8bbe\u7f6e\u4f11\u7720\u65f6\u95f4\uff0c\u907f\u514d\u8fc7\u9ad8 OPS \u4ea7\u751f\u6027\u80fd\u6296\u52a8","title":"4-2 \u8fd0\u7ef4\u5c42\u9762\u4e3b\u8981\u9762\u5411\u7684\u662f DBA \u8fd0\u7ef4\u4eba\u5458"},{"location":"chap8/6redis_opt_summary/","text":"\u7b2c\u516b\u7ae0 Redis\u5b66\u4e60\u4e0e\u64cd\u4f5c\u603b\u7ed3 \u539f\u7406\u4e66\uff1a\u300aRedis \u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u300b \u5b9e\u6218\u4e66\uff1a\u300aRedis \u5f00\u53d1\u4e0e\u8fd0\u7ef4\u300b \u5de5\u5177\u4e66\uff1a\u300aRedis \u4f7f\u7528\u624b\u518c\u300b \u65e5\u5e38\u4f7f\u7528\u64cd\u4f5c\uff1a\u6bd4\u5982\u5e38\u89c1\u547d\u4ee4\u548c\u914d\u7f6e\uff0c\u96c6\u7fa4\u642d\u5efa\u7b49\uff1b \u5173\u952e\u6280\u672f\u539f\u7406\uff1a\u6bd4\u5982\u6211\u4eec\u4ecb\u7ecd\u8fc7\u7684 IO \u6a21\u578b\u3001AOF \u548c RDB \u673a\u5236\u7b49\uff1b \u5728\u5b9e\u9645\u4f7f\u7528\u65f6\u7684\u7ecf\u9a8c\u6559\u8bad\uff0c\u6bd4\u5982\uff0cRedis \u54cd\u5e94\u53d8\u6162\u4e86\u600e\u4e48\u529e\uff1fRedis \u4e3b\u4ece\u5e93\u6570\u636e\u4e0d\u4e00\u81f4\u600e\u4e48\u529e\uff1f Redis \u7684\u5f88\u591a\u5173\u952e\u529f\u80fd\uff0c\u5176\u5b9e\u548c\u64cd\u4f5c\u7cfb\u7edf\u5e95\u5c42\u7684\u5b9e\u73b0\u673a\u5236\u662f\u76f8\u5173\u7684\uff0c\u6bd4\u5982\u8bf4\uff0c\u975e\u963b\u585e\u7684\u7f51\u7edc\u6846\u67b6\u3001RDB \u751f\u6210\u548c AOF \u91cd\u5199\u65f6\u6d89\u53ca\u5230\u7684 fork \u548c\u5199\u65f6\u590d\u5236\u673a\u5236\uff0c\u7b49\u7b49\u3002\u53e6\u5916\uff0cRedis \u4e3b\u4ece\u96c6\u7fa4\u4e2d\u7684\u54e8\u5175\u673a\u5236\uff0c\u4ee5\u53ca\u5207\u7247\u96c6\u7fa4\u7684\u6570\u636e\u5206\u5e03\u8fd8\u6d89\u53ca\u5230\u4e00\u4e9b\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u5185\u5bb9\u3002 AOF \u65e5\u5fd7\u7684\u5237\u76d8\u65f6\u673a\u548c\u64cd\u4f5c\u7cfb\u7edf\u7684 fsync \u673a\u5236\u3001\u9ad8\u901f\u9875\u7f13\u5b58\u7684\u5237\u56de\u6709\u5173\uff0c\u800c\u7f51\u7edc\u6846\u67b6\u8ddf epoll \u6709\u5173\uff0cRDB \u751f\u6210\u548c AOF \u91cd\u5199\u4e0e fork\u3001\u5199\u65f6\u590d\u5236\u6709\u5173\u3002 1\u3001\u672c\u7ae0\u5c0f\u7ed3 1-1 Redis 6.0\u7684\u65b0\u7279\u6027\uff1a\u591a\u7ebf\u7a0b\u3001\u5ba2\u6237\u7aef\u7f13\u5b58\u4e0e\u5b89\u5168 Redis 6.0 \u7684\u65b0\u7279\u6027 \u4e3a Redis 6.0 \u662f\u521a\u521a\u63a8\u51fa\u7684\uff0c\u65b0\u7684\u529f\u80fd\u7279\u6027\u8fd8\u9700\u8981\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\u8fdb\u884c\u90e8\u7f72\u548c\u9a8c\u8bc1\uff0c\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u60f3\u8bd5\u7528 Redis 6.0\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u5148\u5728\u975e\u6838\u5fc3\u4e1a\u52a1\u4e0a\u4f7f\u7528 Redis 6.0\uff0c\u4e00\u65b9\u9762\u53ef\u4ee5\u9a8c\u8bc1\u65b0\u7279\u6027\u5e26\u6765\u7684\u6027\u80fd\u6216\u529f\u80fd\u4f18\u52bf\uff0c\u53e6\u4e00\u65b9\u9762\uff0c\u4e5f\u53ef\u4ee5\u907f\u514d\u56e0\u4e3a\u65b0\u7279\u6027\u4e0d\u7a33\u5b9a\u800c\u5bfc\u81f4\u6838\u5fc3\u4e1a\u52a1\u53d7\u5230\u5f71\u54cd\u3002 Redis 6.0\u4e2d\u7684\u591a\u7ebf\u7a0b\u53ea\u662f\u6307\uff0c\u5728\u5ba2\u6237\u7aef\u8bf7\u6c42\u63a5\u6536\u548c\u89e3\u6790\uff0c\u4ee5\u53ca\u8bf7\u6c42\u540e\u7684\u6570\u636e\u901a\u8fc7\u7f51\u7edc\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u65f6\uff0c\u4f7f\u7528\u4e86\u591a\u7ebf\u7a0b\u3002\u800c\u547d\u4ee4\u8bf7\u6c42\u672c\u8eab\u7684\u6570\u636e\u8bfb\u5199\u64cd\u4f5c\u8fd8\u662f\u7531\u5355\u7ebf\u7a0b\u6765\u5b8c\u6210\u7684\uff0c\u6240\u4ee5\u4ecd\u7136\u53ef\u4ee5\u4fdd\u8bc1\u5355\u547d\u4ee4\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002 1-2 Redis \u57fa\u4e8eNVM\u5185\u5b58\u7684\u5b9e\u8df5 NVM \u7684\u4e09\u5927\u7279\u70b9\uff1a\u6027\u80fd\u9ad8\u3001\u5bb9\u91cf\u5927\u3001\u6570\u636e\u53ef\u4ee5\u6301\u4e45\u5316\u4fdd\u5b58\u3002\u8f6f\u4ef6\u7cfb\u7edf\u53ef\u4ee5\u50cf\u8bbf\u95ee\u4f20\u7edf DRAM \u5185\u5b58\u4e00\u6837\uff0c\u8bbf\u95ee NVM \u5185\u5b58\u3002\u76ee\u524d\uff0cIntel \u5df2\u7ecf\u63a8\u51fa\u4e86 NVM \u5185\u5b58\u4ea7\u54c1 Optane AEP\u3002 \u8fd9\u6b3e NVM \u5185\u5b58\u4ea7\u54c1\u7ed9\u8f6f\u4ef6\u63d0\u4f9b\u4e86\u4e24\u79cd\u4f7f\u7528\u6a21\u5f0f\uff0c \u5206\u522b\u662f Memory \u6a21\u5f0f\u548c App Direct \u6a21\u5f0f \u3002\u5728 Memory \u6a21\u5f0f\u65f6\uff0cRedis \u53ef\u4ee5\u5229\u7528 NVM \u5bb9\u91cf\u5927\u7684\u7279\u70b9\uff0c\u5b9e\u73b0\u5927\u5bb9\u91cf\u5b9e\u4f8b\uff0c\u4fdd\u5b58\u66f4\u591a\u6570\u636e\u3002\u5728\u4f7f\u7528 App Direct \u6a21\u5f0f\u65f6\uff0cRedis \u53ef\u4ee5\u76f4\u63a5\u5728\u6301\u4e45\u5316\u5185\u5b58\u4e0a\u8fdb\u884c\u6570\u636e\u8bfb\u5199\uff0c \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cRedis \u4e0d\u7528\u518d\u4f7f\u7528 RDB \u6216 AOF \u6587\u4ef6\u4e86\uff0c\u6570\u636e\u5728\u673a\u5668\u6389\u7535\u540e\u4e5f\u4e0d\u4f1a\u4e22\u5931\u3002\u800c\u4e14\uff0c\u5b9e\u4f8b\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u6301\u4e45\u5316\u5185\u5b58\u4e0a\u7684\u6570\u636e\u8fdb\u884c\u6062\u590d\uff0c\u6062\u590d\u901f\u5ea6\u7279\u522b\u5feb\u3002 NVM \u5185\u5b58\u662f\u8fd1\u5e74\u6765\u5b58\u50a8\u8bbe\u5907\u9886\u57df\u4e2d\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u53d8\u5316\uff0c\u5b83\u65e2\u80fd\u6301\u4e45\u5316\u4fdd\u5b58\u6570\u636e\uff0c\u8fd8\u80fd\u50cf\u5185\u5b58\u4e00\u6837\u5feb\u901f\u8bbf\u95ee\uff0c\u8fd9\u5fc5\u7136\u4f1a\u7ed9\u5f53\u524d\u57fa\u4e8e DRAM \u548c\u786c\u76d8\u7684\u7cfb\u7edf\u8f6f\u4ef6\u4f18\u5316\u5e26\u6765\u65b0\u7684\u673a\u9047\u3002 1-3 Redis\u5ba2\u6237\u7aef\u5982\u4f55\u4e0e\u670d\u52a1\u5668\u7aef\u4ea4\u6362\u547d\u4ee4\u548c\u6570\u636e RESP RESP 2 \u534f\u8bae\u5b9a\u4e49\u4e86 Redis \u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u8fdb\u884c\u547d\u4ee4\u548c\u6570\u636e\u4ea4\u4e92\u65f6\u7684\u7f16\u7801\u683c\u5f0f\u3002RESP 2 \u63d0\u4f9b\u4e86 5 \u79cd\u7c7b\u578b\u7684\u7f16\u7801\u683c\u5f0f\uff0c\u5305\u62ec\u7b80\u5355\u5b57\u7b26\u4e32\u7c7b\u578b\u3001\u957f\u5b57\u7b26\u4e32\u7c7b\u578b\u3001\u6574\u6570\u7c7b\u578b\u3001\u9519\u8bef\u7c7b\u578b\u548c\u6570\u7ec4\u7c7b\u578b\u3002\u4e3a\u4e86\u533a\u5206\u8fd9 5 \u79cd\u7c7b\u578b\uff0cRESP 2 \u534f\u8bae\u4f7f\u7528\u4e86 5 \u79cd\u4e0d\u540c\u7684\u5b57\u7b26\u4f5c\u4e3a\u8fd9 5 \u79cd\u7c7b\u578b\u7f16\u7801\u7ed3\u679c\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\uff0c\u5206\u522b\u662f +\u3001 $\u3001:\u3001- \u548c * \u3002 RESP 2 \u534f\u8bae\u662f\u6587\u672c\u5f62\u5f0f\u7684\u534f\u8bae\uff0c\u5b9e\u73b0\u7b80\u5355\uff0c\u53ef\u4ee5\u51cf\u5c11\u5ba2\u6237\u7aef\u5f00\u53d1\u51fa\u73b0\u7684 Bug\uff0c\u800c\u4e14\u53ef\u8bfb\u6027\u5f3a\uff0c\u4fbf\u4e8e\u5f00\u53d1\u8c03\u8bd5\u3002\u5f53\u4f60\u9700\u8981\u5f00\u53d1\u5b9a\u5236\u5316\u7684 Redis \u5ba2\u6237\u7aef\u65f6\uff0c\u5c31\u9700\u8981\u4e86\u89e3\u548c\u638c\u63e1 RESP 2 \u534f\u8bae\u3002 RESP 2 \u534f\u8bae\u7684\u4e00\u4e2a\u4e0d\u8db3\u5c31\u662f\u652f\u6301\u7684\u7c7b\u578b\u504f\u5c11\uff0c\u6240\u4ee5\uff0cRedis 6.0 \u7248\u672c\u4f7f\u7528\u4e86 RESP 3 \u534f\u8bae\u3002\u548c RESP 2 \u534f\u8bae\u76f8\u6bd4\uff0c RESP 3 \u534f\u8bae\u589e\u52a0\u4e86\u5bf9\u6d6e\u70b9\u6570\u3001\u5e03\u5c14\u7c7b\u578b\u3001\u6709\u5e8f\u5b57\u5178\u96c6\u5408\u3001\u65e0\u5e8f\u96c6\u5408\u7b49\u591a\u79cd\u7c7b\u578b\u6570\u636e\u7684\u652f\u6301 \u3002\u4e0d\u8fc7\uff0c\u8fd9\u91cc\uff0c\u6709\u4e2a\u5730\u65b9\u9700\u8981\u4f60\u6ce8\u610f\uff0cRedis 6.0 \u53ea\u652f\u6301 RESP 3\uff0c\u5bf9 RESP 2 \u534f\u8bae\u4e0d\u517c\u5bb9\uff0c\u6240\u4ee5\uff0c \u5982\u679c\u4f60\u4f7f\u7528 Redis 6.0 \u7248\u672c\uff0c\u9700\u8981\u786e\u8ba4\u5ba2\u6237\u7aef\u5df2\u7ecf\u652f\u6301\u4e86 RESP 3 \u534f\u8bae\uff0c\u5426\u5219\uff0c\u5c06\u65e0\u6cd5\u4f7f\u7528 Redis 6.0\u3002 \u6700\u540e\uff0c\u6211\u4e5f\u7ed9\u4f60\u63d0\u4f9b\u4e00\u4e2a\u5c0f\u5de5\u5177\u3002\u5982\u679c\u4f60\u60f3\u67e5\u770b\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u6570\u636e\u7684 RESP 2 \u7f16\u7801\u7ed3\u679c\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 telnet \u547d\u4ee4\u548c redis \u5b9e\u4f8b\u8fde\u63a5\uff0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5c31\u884c\uff1a telnet \u5b9e\u4f8bIP \u5b9e\u4f8b\u7aef\u53e3 \u53ef\u4ee5\u7ed9\u5b9e\u4f8b\u53d1\u9001\u547d\u4ee4\uff0c\u8fd9\u6837\u5c31\u80fd\u770b\u5230\u7528 RESP 2 \u534f\u8bae\u7f16\u7801\u540e\u7684\u8fd4\u56de\u7ed3\u679c\u4e86\u3002\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u5728 telnet \u4e2d\uff0c\u5411 Redis \u5b9e\u4f8b\u53d1\u9001\u7528 RESP 2 \u534f\u8bae\u7f16\u5199\u7684\u547d\u4ee4\u64cd\u4f5c\u3002 1-4 Redis\u8fd0\u7ef4\u5de5\u5177 Redis \u7684 INFO \u547d\u4ee4\uff0c\u8fd9\u4e2a\u547d\u4ee4\u662f\u76d1\u63a7\u5de5\u5177\u7684\u57fa\u7840\uff0c\u76d1\u63a7\u5de5\u5177\u90fd\u4f1a\u57fa\u4e8e INFO \u547d\u4ee4\u63d0\u4f9b\u7684\u4fe1\u606f\u8fdb\u884c\u4e8c\u6b21\u52a0\u5de5\u3002\u6211\u4eec\u8fd8\u5b66\u4e60\u4e86 3 \u79cd\u7528\u6765\u76d1\u63a7 Redis \u5b9e\u65f6\u8fd0\u884c\u72b6\u6001\u7684\u8fd0\u7ef4\u5de5\u5177\uff0c\u5206\u522b\u662f Redis-exporter \u3001 redis-stat \u548c Redis Live \u3002 \u5173\u4e8e\u6570\u636e\u8fc1\u79fb\uff0c\u6211\u4eec\u65e2\u53ef\u4ee5\u4f7f\u7528 Redis-shake \u5de5\u5177\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 RDB \u6587\u4ef6\u6216\u662f AOF \u6587\u4ef6\u8fdb\u884c\u8fc1\u79fb\u3002 Redis INFO \u4fe1\u606f\u770b\u4f3c\u7b80\u5355\uff0c\u4f46\u662f\u8fd9\u4e9b\u4fe1\u606f\u8bb0\u5f55\u7740 Redis \u8fd0\u884c\u65f6\u7684\u5404\u79cd\u72b6\u6001\u6570\u636e\uff0c\u5982\u679c\u6211\u4eec\u628a\u8fd9\u4e9b\u6570\u636e\u91c7\u96c6\u5230\u5e76\u76d1\u63a7\u5230\u4f4d\uff0c80% \u7684\u5f02\u5e38\u60c5\u51b5\u80fd\u5728\u7b2c\u4e00\u65f6\u95f4\u53d1\u73b0\u3002 \u673a\u5668\u7684 CPU\u3001\u5185\u5b58\u3001\u7f51\u7edc\u3001\u78c1\u76d8\uff0c\u90fd\u5f71\u54cd\u7740 Redis \u7684\u6027\u80fd\u3002 \u76d1\u63a7\u65f6\u6211\u4eec\u6700\u597d\u91cd\u70b9\u5173\u6ce8\u4ee5\u4e0b\u6307\u6807\uff1a \u5ba2\u6237\u7aef\u76f8\u5173\uff1a\u5f53\u524d\u8fde\u63a5\u6570\u3001\u603b\u8fde\u63a5\u6570\u3001\u8f93\u5165\u7f13\u51b2\u5927\u5c0f\u3001OPS CPU\u76f8\u5173\uff1a\u4e3b\u8fdb\u7a0b CPU \u4f7f\u7528\u7387\u3001\u5b50\u8fdb\u7a0b CPU \u4f7f\u7528\u7387 \u5185\u5b58\u76f8\u5173\uff1a\u5f53\u524d\u5185\u5b58\u3001\u5cf0\u503c\u5185\u5b58\u3001\u5185\u5b58\u788e\u7247\u7387 \u7f51\u7edc\u76f8\u5173\uff1a\u8f93\u5165\u3001\u8f93\u51fa\u7f51\u7edc\u6d41\u91cf \u6301\u4e45\u5316\u76f8\u5173\uff1a\u6700\u540e\u4e00\u6b21 RDB \u65f6\u95f4\u3001RDB fork \u8017\u65f6\u3001\u6700\u540e\u4e00\u6b21 AOF rewrite \u65f6\u95f4\u3001AOF rewrite \u8017\u65f6 key \u76f8\u5173\uff1a\u8fc7\u671f key \u6570\u91cf\u3001\u6dd8\u6c70 key \u6570\u91cf\u3001key \u547d\u4e2d\u7387 \u590d\u5236\u76f8\u5173\uff1a\u4e3b\u4ece\u8282\u70b9\u590d\u5236\u504f\u79fb\u91cf\u3001\u4e3b\u5e93\u590d\u5236\u7f13\u51b2\u533a 1-5 Redis\u7684\u4f7f\u7528\u89c4\u8303 \u89c4\u8303\u5206\u7c7b \u5f3a\u5236\u7c7b\u522b\u7684\u89c4\u8303\uff1a\u8fd9\u8868\u793a\uff0c\u5982\u679c\u4e0d\u6309\u7167\u89c4\u8303\u5185\u5bb9\u6765\u6267\u884c\uff0c\u5c31\u4f1a\u7ed9 Redis \u7684\u5e94\u7528\u5e26\u6765\u6781\u5927\u7684\u8d1f\u9762\u5f71\u54cd\uff0c\u4f8b\u5982\u6027\u80fd\u53d7\u635f\u3002 \u63a8\u8350\u7c7b\u522b\u7684\u89c4\u8303\uff1a\u8fd9\u4e2a\u89c4\u8303\u7684\u5185\u5bb9\u80fd\u6709\u6548\u63d0\u5347\u6027\u80fd\u3001\u8282\u7701\u5185\u5b58\u7a7a\u95f4\uff0c\u6216\u8005\u662f\u589e\u52a0\u5f00\u53d1\u548c\u8fd0\u7ef4\u7684\u4fbf\u6377\u6027\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u5e94\u7528\u5230\u5b9e\u8df5\u4e2d\u3002 \u5efa\u8bae\u7c7b\u522b\u7684\u89c4\u8303\uff1a\u8fd9\u7c7b\u89c4\u8303\u5185\u5bb9\u548c\u5b9e\u9645\u4e1a\u52a1\u5e94\u7528\u76f8\u5173\uff0c\u53ea\u662f\u4ece\u7ecf\u5386\u6216\u7ecf\u9a8c\u7ed9\u4f60\u4e00\u4e2a\u5efa\u8bae\uff0c\u4f60\u9700\u8981\u7ed3\u5408\u81ea\u5df1\u7684\u4e1a\u52a1\u573a\u666f\u53c2\u8003\u4f7f\u7528\u3002 \u4e1a\u52a1\u5c42\u9762\u4e3b\u8981\u9762\u5411\u7684\u4e1a\u52a1\u5f00\u53d1\u4eba\u5458 key \u7684\u957f\u5ea6\u5c3d\u91cf\u77ed\uff0c\u8282\u7701\u5185\u5b58\u7a7a\u95f4 \u907f\u514d bigkey\uff0c\u9632\u6b62\u963b\u585e\u4e3b\u7ebf\u7a0b 4.0+\u7248\u672c\u5efa\u8bae\u5f00\u542f lazy-free \u628a Redis \u5f53\u4f5c\u7f13\u5b58\u4f7f\u7528\uff0c\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4 \u4e0d\u4f7f\u7528\u590d\u6742\u5ea6\u8fc7\u9ad8\u7684\u547d\u4ee4\uff0c\u4f8b\u5982SORT\u3001SINTER\u3001SINTERSTORE\u3001ZUNIONSTORE\u3001ZINTERSTORE \u67e5\u8be2\u6570\u636e\u5c3d\u91cf\u4e0d\u4e00\u6b21\u6027\u67e5\u8be2\u5168\u91cf\uff0c\u5199\u5165\u5927\u91cf\u6570\u636e\u5efa\u8bae\u5206\u591a\u6279\u5199\u5165 \u6279\u91cf\u64cd\u4f5c\u5efa\u8bae MGET/MSET \u66ff\u4ee3 GET/SET\uff0cHMGET/HMSET \u66ff\u4ee3 HGET/HSET \u7981\u6b62\u4f7f\u7528 KEYS/FLUSHALL/FLUSHDB \u547d\u4ee4 \u907f\u514d\u96c6\u4e2d\u8fc7\u671f key \u6839\u636e\u4e1a\u52a1\u573a\u666f\u9009\u62e9\u5408\u9002\u7684\u6dd8\u6c70\u7b56\u7565 1\u4f7f\u7528\u8fde\u63a5\u6c60\u64cd\u4f5c Redis\uff0c\u5e76\u8bbe\u7f6e\u5408\u7406\u7684\u53c2\u6570\uff0c\u907f\u514d\u77ed\u8fde\u63a5 \u53ea\u4f7f\u7528 db0\uff0c\u51cf\u5c11 SELECT \u547d\u4ee4\u7684\u6d88\u8017 \u8bfb\u8bf7\u6c42\u91cf\u5f88\u5927\u65f6\uff0c\u5efa\u8bae\u8bfb\u5199\u5206\u79bb\uff0c\u5199\u8bf7\u6c42\u91cf\u5f88\u5927\uff0c\u5efa\u8bae\u4f7f\u7528\u5207\u7247\u96c6\u7fa4 \u8fd0\u7ef4\u5c42\u9762\u4e3b\u8981\u9762\u5411\u7684\u662f DBA \u8fd0\u7ef4\u4eba\u5458 \u6309\u4e1a\u52a1\u7ebf\u90e8\u7f72\u5b9e\u4f8b\uff0c\u907f\u514d\u591a\u4e2a\u4e1a\u52a1\u7ebf\u6df7\u5408\u90e8\u7f72\uff0c\u51fa\u95ee\u9898\u5f71\u54cd\u5176\u4ed6\u4e1a\u52a1 \u4fdd\u8bc1\u673a\u5668\u6709\u8db3\u591f\u7684 CPU\u3001\u5185\u5b58\u3001\u5e26\u5bbd\u3001\u78c1\u76d8\u8d44\u6e90 \u5efa\u8bae\u90e8\u7f72\u4e3b\u4ece\u96c6\u7fa4\uff0c\u5e76\u5206\u5e03\u5728\u4e0d\u540c\u673a\u5668\u4e0a\uff0cslave \u8bbe\u7f6e\u4e3a readonly \u4e3b\u4ece\u8282\u70b9\u6240\u90e8\u7f72\u7684\u673a\u5668\u5404\u81ea\u72ec\u7acb\uff0c\u5c3d\u91cf\u907f\u514d\u4ea4\u53c9\u90e8\u7f72\uff0c\u5bf9\u4ece\u8282\u70b9\u505a\u7ef4\u62a4\u65f6\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5230\u4e3b\u8282\u70b9 \u63a8\u8350\u90e8\u7f72\u54e8\u5175\u96c6\u7fa4\u5b9e\u73b0\u6545\u969c\u81ea\u52a8\u5207\u6362\uff0c\u54e8\u5175\u8282\u70b9\u5206\u5e03\u5728\u4e0d\u540c\u673a\u5668\u4e0a \u63d0\u524d\u505a\u597d\u5bb9\u91cf\u89c4\u5212\uff0c\u9632\u6b62\u4e3b\u4ece\u5168\u91cf\u540c\u6b65\u65f6\uff0c\u5b9e\u4f8b\u4f7f\u7528\u5185\u5b58\u7a81\u589e\u5bfc\u81f4\u5185\u5b58\u4e0d\u8db3 \u505a\u597d\u673a\u5668 CPU\u3001\u5185\u5b58\u3001\u5e26\u5bbd\u3001\u78c1\u76d8\u76d1\u63a7\uff0c\u8d44\u6e90\u4e0d\u8db3\u65f6\u53ca\u65f6\u62a5\u8b66\uff0c\u4efb\u610f\u8d44\u6e90\u4e0d\u8db3\u90fd\u4f1a\u5f71\u54cd Redis \u6027\u80fd \u5b9e\u4f8b\u8bbe\u7f6e\u6700\u5927\u8fde\u63a5\u6570\uff0c\u9632\u6b62\u8fc7\u591a\u5ba2\u6237\u7aef\u8fde\u63a5\u5bfc\u81f4\u5b9e\u4f8b\u8d1f\u8f7d\u8fc7\u9ad8\uff0c\u5f71\u54cd\u6027\u80fd \u5355\u4e2a\u5b9e\u4f8b\u5185\u5b58\u5efa\u8bae\u63a7\u5236\u5728 10G \u4ee5\u4e0b\uff0c\u5927\u5b9e\u4f8b\u5728\u4e3b\u4ece\u5168\u91cf\u540c\u6b65\u3001\u5907\u4efd\u65f6\u6709\u963b\u585e\u98ce\u9669 \u8bbe\u7f6e\u5408\u7406\u7684 slowlog \u9608\u503c\uff0c\u5e76\u5bf9\u5176\u8fdb\u884c\u76d1\u63a7\uff0cslowlog \u8fc7\u591a\u9700\u53ca\u65f6\u62a5\u8b66 \u8bbe\u7f6e\u5408\u7406\u7684 repl-backlog\uff0c\u964d\u4f4e\u4e3b\u4ece\u5168\u91cf\u540c\u6b65\u7684\u6982\u7387 \u8bbe\u7f6e\u5408\u7406\u7684 slave client-output-buffer-limit \uff0c\u907f\u514d\u4e3b\u4ece\u590d\u5236\u4e2d\u65ad\u60c5\u51b5\u53d1\u751f \u63a8\u8350\u5728\u4ece\u8282\u70b9\u4e0a\u5907\u4efd\uff0c\u4e0d\u5f71\u54cd\u4e3b\u8282\u70b9\u6027\u80fd \u4e0d\u5f00\u542f AOF \u6216\u5f00\u542f AOF \u914d\u7f6e\u4e3a\u6bcf\u79d2\u5237\u76d8\uff0c\u907f\u514d\u78c1\u76d8 IO \u62d6\u6162 Redis \u6027\u80fd \u8c03\u6574 maxmemory \u65f6\uff0c\u6ce8\u610f\u4e3b\u4ece\u8282\u70b9\u7684\u8c03\u6574\u987a\u5e8f\uff0c\u987a\u5e8f\u9519\u8bef\u4f1a\u5bfc\u81f4\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4 \u5bf9\u5b9e\u4f8b\u90e8\u7f72\u76d1\u63a7\uff0c\u91c7\u96c6 INFO \u4fe1\u606f\u65f6\u91c7\u7528\u957f\u8fde\u63a5\uff0c\u907f\u514d\u9891\u7e41\u7684\u77ed\u8fde\u63a5 \u505a\u597d\u5b9e\u4f8b\u8fd0\u884c\u65f6\u76d1\u63a7\uff0c\u91cd\u70b9\u5173\u6ce8 expired_keys \u3001 evicted_keys \u3001 latest_fork_usec \uff0c\u8fd9\u4e9b\u6307\u6807\u77ed\u65f6\u7a81\u589e\u53ef\u80fd\u4f1a\u6709\u963b\u585e\u98ce\u9669 \u626b\u63cf\u7ebf\u4e0a\u5b9e\u4f8b\u65f6\uff0c\u8bb0\u5f97\u8bbe\u7f6e\u4f11\u7720\u65f6\u95f4\uff0c\u907f\u514d\u8fc7\u9ad8 OPS \u4ea7\u751f\u6027\u80fd\u6296\u52a8 2\u3001\u672c\u7ae0\u64cd\u4f5c\u603b\u7ed3 2-1 Redis 6.0\u7684\u65b0\u7279\u6027\uff1a\u591a\u7ebf\u7a0b\u3001\u5ba2\u6237\u7aef\u7f13\u5b58\u4e0e\u5b89\u5168 \u5728 Redis 6.0 \u4e2d\uff0c\u591a\u7ebf\u7a0b\u673a\u5236\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\uff0c\u5982\u679c\u9700\u8981\u4f7f\u7528\u591a\u7ebf\u7a0b\u529f\u80fd\uff0c\u9700\u8981\u5728 redis.conf \u4e2d\u5b8c\u6210\u4e24\u4e2a\u8bbe\u7f6e \u3002 1. \u8bbe\u7f6e io-thread-do-reads \u914d\u7f6e\u9879\u4e3a yes\uff0c\u8868\u793a\u542f\u7528\u591a\u7ebf\u7a0b\u3002 io-threads-do-reads yes 2. \u8bbe\u7f6e\u7ebf\u7a0b\u4e2a\u6570\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u7ebf\u7a0b\u4e2a\u6570\u8981\u5c0f\u4e8e Redis \u5b9e\u4f8b\u6240\u5728\u673a\u5668\u7684 CPU \u6838\u4e2a\u6570\uff0c\u4f8b\u5982\uff0c\u5bf9\u4e8e\u4e00\u4e2a 8 \u6838\u7684\u673a\u5668\u6765\u8bf4\uff0cRedis \u5b98\u65b9\u5efa\u8bae\u914d\u7f6e 6 \u4e2a IO \u7ebf\u7a0b\u3002 io-threads 6 \u5982\u679c\u4f60\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u53d1\u73b0 Redis \u5b9e\u4f8b\u7684 CPU \u5f00\u9500\u4e0d\u5927\uff0c\u541e\u5410\u91cf\u5374\u6ca1\u6709\u63d0\u5347\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 Redis 6.0 \u7684\u591a\u7ebf\u7a0b\u673a\u5236\uff0c\u52a0\u901f\u7f51\u7edc\u5904\u7406\uff0c\u8fdb\u800c\u63d0\u5347\u5b9e\u4f8b\u7684\u541e\u5410\u91cf\u3002 \u6253\u5f00\u6216\u5173\u95ed\u666e\u901a\u6a21\u5f0f\u4e0b\u7684 Tracking \u529f\u80fd CLIENT TRACKING ON|OFF \u5ba2\u6237\u7aef\u5982\u4f55\u4f7f\u7528\u5e7f\u64ad\u6a21\u5f0f\u63a5\u6536 key \u5931\u6548\u6d88\u606f\u3002 \u5f53\u6211\u4eec\u5728\u5ba2\u6237\u7aef\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u540e\uff0c\u5982\u679c\u670d\u52a1\u7aef\u66f4\u65b0\u4e86 user:id:1003 \u8fd9\u4e2a key\uff0c\u90a3\u4e48\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u6536\u5230 invalidate \u6d88\u606f\u3002 CLIENT TRACKING ON BCAST PREFIX user \u5728 6.0 \u7248\u672c\u524d\uff0c\u6240\u6709\u5ba2\u6237\u7aef\u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u4e2a\u5bc6\u7801\u8fdb\u884c\u767b\u5f55\u4f7f\u7528\uff0c\u4f46\u662f\u6ca1\u6709\u7528\u6237\u7684\u6982\u5ff5\uff0c\u800c\u5728 6.0 \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ACL SETUSER \u547d\u4ee4\u521b\u5efa\u7528\u6237\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u521b\u5efa\u5e76\u542f\u7528\u4e00\u4e2a\u7528\u6237 normaluser\uff0c\u628a\u5b83\u7684\u5bc6\u7801\u8bbe\u7f6e\u4e3a\u201cabc\u201d\uff1a ACL SETUSER normaluser on > abc \u53e6\u5916\uff0c6.0 \u7248\u672c\u8fd8\u652f\u6301\u4ee5\u7528\u6237\u4e3a\u7c92\u5ea6\u8bbe\u7f6e\u547d\u4ee4\u64cd\u4f5c\u7684\u8bbf\u95ee\u6743\u9650\u3002\u5177\u4f53\u64cd\u4f5c\u5217\u5728\u4e86\u4e0b\u8868\u4e2d\uff0c\u4f60\u53ef\u4ee5\u770b\u4e0b\uff0c\u5176\u4e2d\uff0c\u52a0\u53f7\uff08+\uff09\u548c\u51cf\u53f7\uff08-\uff09\u5c31\u5206\u522b\u8868\u793a\u7ed9\u7528\u6237\u8d4b\u4e88\u6216\u64a4\u9500\u547d\u4ee4\u7684\u8c03\u7528\u6743\u9650\u3002 \u5047\u8bbe\u6211\u4eec\u8981\u8bbe\u7f6e\u7528\u6237 normaluser \u53ea\u80fd\u8c03\u7528 Hash \u7c7b\u578b\u7684\u547d\u4ee4\u64cd\u4f5c\uff0c\u800c\u4e0d\u80fd\u8c03\u7528 String \u7c7b\u578b\u7684\u547d\u4ee4\u64cd\u4f5c\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a ACL SETUSER normaluser +@hash -@string \u9664\u4e86\u8bbe\u7f6e\u67d0\u4e2a\u547d\u4ee4\u6216\u67d0\u7c7b\u547d\u4ee4\u7684\u8bbf\u95ee\u63a7\u5236\u6743\u9650\uff0c6.0 \u7248\u672c\u8fd8\u652f\u6301\u4ee5 key \u4e3a\u7c92\u5ea6\u8bbe\u7f6e\u8bbf\u95ee\u6743\u9650\u3002 \u5177\u4f53\u7684\u505a\u6cd5\u662f\u4f7f\u7528\u6ce2\u6d6a\u53f7 \u201c~\u201d \u548c key \u7684\u524d\u7f00\u6765\u8868\u793a\u63a7\u5236\u8bbf\u95ee\u7684 key\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u8bbe\u7f6e\u7528\u6237 normaluser \u53ea\u80fd\u5bf9\u4ee5 \u201cuser:\u201d \u4e3a\u524d\u7f00\u7684 key \u8fdb\u884c\u547d\u4ee4\u64cd\u4f5c\uff1a ACL SETUSER normaluser ~user:* +@all 1-2 Redis \u57fa\u4e8eNVM\u5185\u5b58\u7684\u5b9e\u8df5 #\u6210\u529f\u5199\u5165String\u7c7b\u578b\u6570\u636e\uff0c\u8fd4\u56deOK 127.0.0.1:6379> SET testkey testvalue OK \u8fd9\u91cc\u7684\u4ea4\u4e92\u5185\u5bb9\u5c31\u5305\u62ec\u4e86 \u547d\u4ee4\uff08SET \u547d\u4ee4\uff09\u3001\u952e\uff08String \u7c7b\u578b\u7684\u952e testkey\uff09\u548c\u5355\u4e2a\u503c\uff08String \u7c7b\u578b\u7684\u503c testvalue\uff09\uff0c\u800c\u670d\u52a1\u5668\u7aef\u5219\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a OK \u56de\u590d \u3002 \u7b2c\u4e8c\u4e2a\u4f8b\u5b50\u662f\u6267\u884c HSET \u547d\u4ee4\uff1a #\u6210\u529f\u5199\u5165Hash\u7c7b\u578b\u6570\u636e\uff0c\u8fd4\u56de\u5b9e\u9645\u5199\u5165\u7684\u96c6\u5408\u5143\u7d20\u4e2a\u6570 127.0.0.1:6379>HSET testhash a 1 b 2 c 3 (integer) 3 \u8fd9\u91cc\u7684\u4ea4\u4e92\u5185\u5bb9\u5305\u62ec\u4e09\u4e2a key-value \u7684 Hash\u96c6\u5408\u503c\uff08a 1 b 2 c 3\uff09 \uff0c\u800c\u670d\u52a1\u5668\u7aef\u8fd4\u56de \u6574\u6570\u56de\u590d\uff083\uff09 \uff0c\u8868\u793a\u64cd\u4f5c\u6210\u529f\u5199\u5165\u7684\u5143\u7d20\u4e2a\u6570\u3002 \u6700\u540e\u4e00\u4e2a\u4f8b\u5b50\u662f\u6267\u884c PUT \u547d\u4ee4\uff0c\u5982\u4e0b\u6240\u793a\uff1a #\u53d1\u9001\u7684\u547d\u4ee4\u4e0d\u5bf9\uff0c\u62a5\u9519\uff0c\u5e76\u8fd4\u56de\u9519\u8bef\u4fe1\u606f 127.0.0.1:6379>PUT testkey2 testvalue (error) ERR unknown command 'PUT', with args beginning with: 'testkey', 'testvalue' \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u7684\u4ea4\u4e92\u5185\u5bb9\u5305\u62ec\u9519\u8bef\u4fe1\u606f\uff0c\u8fd9\u662f\u56e0\u4e3a\uff0c Redis \u5b9e\u4f8b\u672c\u8eab\u4e0d\u652f\u6301 PUT \u547d\u4ee4\uff0c\u6240\u4ee5\u670d\u52a1\u5668\u7aef\u62a5\u9519\u201cerror\u201d\uff0c\u5e76\u8fd4\u56de\u5177\u4f53\u7684\u9519\u8bef\u4fe1\u606f\uff0c\u4e5f\u5c31\u662f\u672a\u77e5\u7684\u547d\u4ee4\u201cput\u201d\u3002 \u5047\u8bbe\u6709\u4e00\u4e2a Hash \u7c7b\u578b\u7684\u952e\u662f testhash\uff0c\u96c6\u5408\u5143\u7d20\u5206\u522b\u4e3a a:1\u3001b:2\u3001c:3\u3002\u540c\u65f6\uff0c\u6709\u4e00\u4e2a Sorted Set \u7c7b\u578b\u7684\u952e\u662f testzset\uff0c\u96c6\u5408\u5143\u7d20\u5206\u522b\u662f a\u3001b\u3001c\uff0c\u5b83\u4eec\u7684\u5206\u6570\u5206\u522b\u662f 1\u30012\u30013\u3002\u6211\u4eec\u5728 redis-cli \u5ba2\u6237\u7aef\u4e2d\u8bfb\u53d6\u5b83\u4eec\u7684\u7ed3\u679c\u65f6\uff0c\u8fd4\u56de\u7684\u5f62\u5f0f\u90fd\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u5982\u4e0b\u6240\u793a\uff1a 127.0.0.1:6379>HGETALL testhash 1) \"a\" 2) \"1\" 3) \"b\" 4) \"2\" 5) \"c\" 6) \"3\" 127.0.0.1:6379>ZRANGE testzset 0 3 withscores 1) \"a\" 2) \"1\" 3) \"b\" 4) \"2\" 5) \"c\" 6) \"3\" 3\u3001\u672c\u7ae0\u95ee\u9898 3-1 \u95ee\u9898 \uff1a\u4f60\u89c9\u5f97\uff0cRedis 6.0 \u7684\u54ea\u4e2a\u6216\u54ea\u4e9b\u65b0\u7279\u6027\u4f1a\u5bf9\u4f60\u6709\u5e2e\u52a9\u5462\uff1f \u7b54\u6848\uff1a\u8fd9\u4e2a\u8981\u6839\u636e\u4f60\u4eec\u7684\u5177\u4f53\u9700\u6c42\u6765\u5b9a\u3002\u4ece\u63d0\u5347\u6027\u80fd\u7684\u89d2\u5ea6\u4e0a\u6765\u8bf4\uff0cRedis 6.0 \u4e2d\u7684\u591a IO \u7ebf\u7a0b\u7279\u6027\u53ef\u4ee5\u7f13\u89e3 Redis \u7684\u7f51\u7edc\u8bf7\u6c42\u5904\u7406\u538b\u529b\u3002\u901a\u8fc7\u591a\u7ebf\u7a0b\u589e\u52a0\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\u7684\u80fd\u529b\uff0c\u53ef\u4ee5\u8fdb\u4e00\u6b65\u63d0\u5347\u5b9e\u4f8b\u7684\u6574\u4f53\u6027\u80fd\u3002\u4e1a\u754c\u5df2\u7ecf\u6709\u4eba\u8bc4\u6d4b\u8fc7\uff0c\u8ddf 6.0 \u4e4b\u524d\u7684\u5355\u7ebf\u7a0b Redis \u76f8\u6bd4\uff0c6.0 \u7684\u591a\u7ebf\u7a0b\u6027\u80fd\u7684\u786e\u6709\u63d0\u5347\u3002\u6240\u4ee5\uff0c\u8fd9\u4e2a\u7279\u6027\u5bf9\u4e1a\u52a1\u5e94\u7528\u4f1a\u6709\u6bd4\u8f83\u5927\u7684\u5e2e\u52a9\u3002 \u53e6\u5916\uff0c\u57fa\u4e8e\u7528\u6237\u7684\u547d\u4ee4\u7c92\u5ea6 ACL \u63a7\u5236\u673a\u5236\u4e5f\u975e\u5e38\u6709\u7528\u3002\u5f53 Redis \u4ee5\u4e91\u5316\u7684\u65b9\u5f0f\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u65f6\uff0c\u5c31\u4f1a\u9762\u4e34\u591a\u79df\u6237\uff08\u6bd4\u5982\u591a\u7528\u6237\u6216\u591a\u4e2a\u5fae\u670d\u52a1\uff09\u7684\u5e94\u7528\u573a\u666f\u3002\u6709\u4e86 ACL \u65b0\u7279\u6027\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5b89\u5168\u5730\u652f\u6301\u591a\u79df\u6237\u5171\u4eab\u8bbf\u95ee Redis \u670d\u52a1\u4e86\u3002 3-2 \u95ee\u9898 \uff1a\u4f60\u89c9\u5f97\uff0c\u6709\u4e86\u6301\u4e45\u5316\u5185\u5b58\u540e\uff0c\u8fd8\u9700\u8981 Redis \u4e3b\u4ece\u96c6\u7fa4\u5417\uff1f \u7b54\u6848\uff1a\u6301\u4e45\u5316\u5185\u5b58\u867d\u7136\u53ef\u4ee5\u5feb\u901f\u6062\u590d\u6570\u636e\uff0c\u4f46\u662f\uff0c \u9664\u4e86\u63d0\u4f9b\u4e3b\u4ece\u6545\u969c\u5207\u6362\u4ee5\u5916\uff0c\u4e3b\u4ece\u96c6\u7fa4\u8fd8\u53ef\u4ee5\u5b9e\u73b0\u8bfb\u5199\u5206\u79bb \u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0\u4ece\u5b9e\u4f8b\uff0c\u8ba9\u591a\u4e2a\u4ece\u5b9e\u4f8b\u5171\u540c\u5206\u62c5\u5927\u91cf\u7684\u8bfb\u8bf7\u6c42\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u5347 Redis \u7684\u8bfb\u6027\u80fd \u3002\u800c\u63d0\u5347\u8bfb\u6027\u80fd\u5e76\u4e0d\u662f\u6301\u4e45\u5316\u5185\u5b58\u80fd\u63d0\u4f9b\u7684\uff0c\u6240\u4ee5\uff0c\u5982\u679c\u4e1a\u52a1\u5c42\u5bf9\u8bfb\u6027\u80fd\u6709\u9ad8\u8981\u6c42\u65f6\uff0c\u6211\u4eec\u8fd8\u662f\u9700\u8981\u4e3b\u4ece\u96c6\u7fa4\u7684\u3002","title":"\u7b2c\u516b\u7ae0 Redis\u5b66\u4e60\u4e0e\u64cd\u4f5c\u603b\u7ed3"},{"location":"chap8/6redis_opt_summary/#redis","text":"\u539f\u7406\u4e66\uff1a\u300aRedis \u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u300b \u5b9e\u6218\u4e66\uff1a\u300aRedis \u5f00\u53d1\u4e0e\u8fd0\u7ef4\u300b \u5de5\u5177\u4e66\uff1a\u300aRedis \u4f7f\u7528\u624b\u518c\u300b \u65e5\u5e38\u4f7f\u7528\u64cd\u4f5c\uff1a\u6bd4\u5982\u5e38\u89c1\u547d\u4ee4\u548c\u914d\u7f6e\uff0c\u96c6\u7fa4\u642d\u5efa\u7b49\uff1b \u5173\u952e\u6280\u672f\u539f\u7406\uff1a\u6bd4\u5982\u6211\u4eec\u4ecb\u7ecd\u8fc7\u7684 IO \u6a21\u578b\u3001AOF \u548c RDB \u673a\u5236\u7b49\uff1b \u5728\u5b9e\u9645\u4f7f\u7528\u65f6\u7684\u7ecf\u9a8c\u6559\u8bad\uff0c\u6bd4\u5982\uff0cRedis \u54cd\u5e94\u53d8\u6162\u4e86\u600e\u4e48\u529e\uff1fRedis \u4e3b\u4ece\u5e93\u6570\u636e\u4e0d\u4e00\u81f4\u600e\u4e48\u529e\uff1f Redis \u7684\u5f88\u591a\u5173\u952e\u529f\u80fd\uff0c\u5176\u5b9e\u548c\u64cd\u4f5c\u7cfb\u7edf\u5e95\u5c42\u7684\u5b9e\u73b0\u673a\u5236\u662f\u76f8\u5173\u7684\uff0c\u6bd4\u5982\u8bf4\uff0c\u975e\u963b\u585e\u7684\u7f51\u7edc\u6846\u67b6\u3001RDB \u751f\u6210\u548c AOF \u91cd\u5199\u65f6\u6d89\u53ca\u5230\u7684 fork \u548c\u5199\u65f6\u590d\u5236\u673a\u5236\uff0c\u7b49\u7b49\u3002\u53e6\u5916\uff0cRedis \u4e3b\u4ece\u96c6\u7fa4\u4e2d\u7684\u54e8\u5175\u673a\u5236\uff0c\u4ee5\u53ca\u5207\u7247\u96c6\u7fa4\u7684\u6570\u636e\u5206\u5e03\u8fd8\u6d89\u53ca\u5230\u4e00\u4e9b\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u5185\u5bb9\u3002 AOF \u65e5\u5fd7\u7684\u5237\u76d8\u65f6\u673a\u548c\u64cd\u4f5c\u7cfb\u7edf\u7684 fsync \u673a\u5236\u3001\u9ad8\u901f\u9875\u7f13\u5b58\u7684\u5237\u56de\u6709\u5173\uff0c\u800c\u7f51\u7edc\u6846\u67b6\u8ddf epoll \u6709\u5173\uff0cRDB \u751f\u6210\u548c AOF \u91cd\u5199\u4e0e fork\u3001\u5199\u65f6\u590d\u5236\u6709\u5173\u3002","title":"\u7b2c\u516b\u7ae0 Redis\u5b66\u4e60\u4e0e\u64cd\u4f5c\u603b\u7ed3"},{"location":"chap8/6redis_opt_summary/#1","text":"","title":"1\u3001\u672c\u7ae0\u5c0f\u7ed3"},{"location":"chap8/6redis_opt_summary/#1-1-redis-60","text":"Redis 6.0 \u7684\u65b0\u7279\u6027 \u4e3a Redis 6.0 \u662f\u521a\u521a\u63a8\u51fa\u7684\uff0c\u65b0\u7684\u529f\u80fd\u7279\u6027\u8fd8\u9700\u8981\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\u8fdb\u884c\u90e8\u7f72\u548c\u9a8c\u8bc1\uff0c\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u60f3\u8bd5\u7528 Redis 6.0\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u5148\u5728\u975e\u6838\u5fc3\u4e1a\u52a1\u4e0a\u4f7f\u7528 Redis 6.0\uff0c\u4e00\u65b9\u9762\u53ef\u4ee5\u9a8c\u8bc1\u65b0\u7279\u6027\u5e26\u6765\u7684\u6027\u80fd\u6216\u529f\u80fd\u4f18\u52bf\uff0c\u53e6\u4e00\u65b9\u9762\uff0c\u4e5f\u53ef\u4ee5\u907f\u514d\u56e0\u4e3a\u65b0\u7279\u6027\u4e0d\u7a33\u5b9a\u800c\u5bfc\u81f4\u6838\u5fc3\u4e1a\u52a1\u53d7\u5230\u5f71\u54cd\u3002 Redis 6.0\u4e2d\u7684\u591a\u7ebf\u7a0b\u53ea\u662f\u6307\uff0c\u5728\u5ba2\u6237\u7aef\u8bf7\u6c42\u63a5\u6536\u548c\u89e3\u6790\uff0c\u4ee5\u53ca\u8bf7\u6c42\u540e\u7684\u6570\u636e\u901a\u8fc7\u7f51\u7edc\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u65f6\uff0c\u4f7f\u7528\u4e86\u591a\u7ebf\u7a0b\u3002\u800c\u547d\u4ee4\u8bf7\u6c42\u672c\u8eab\u7684\u6570\u636e\u8bfb\u5199\u64cd\u4f5c\u8fd8\u662f\u7531\u5355\u7ebf\u7a0b\u6765\u5b8c\u6210\u7684\uff0c\u6240\u4ee5\u4ecd\u7136\u53ef\u4ee5\u4fdd\u8bc1\u5355\u547d\u4ee4\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002","title":"1-1 Redis 6.0\u7684\u65b0\u7279\u6027\uff1a\u591a\u7ebf\u7a0b\u3001\u5ba2\u6237\u7aef\u7f13\u5b58\u4e0e\u5b89\u5168"},{"location":"chap8/6redis_opt_summary/#1-2-redis-nvm","text":"NVM \u7684\u4e09\u5927\u7279\u70b9\uff1a\u6027\u80fd\u9ad8\u3001\u5bb9\u91cf\u5927\u3001\u6570\u636e\u53ef\u4ee5\u6301\u4e45\u5316\u4fdd\u5b58\u3002\u8f6f\u4ef6\u7cfb\u7edf\u53ef\u4ee5\u50cf\u8bbf\u95ee\u4f20\u7edf DRAM \u5185\u5b58\u4e00\u6837\uff0c\u8bbf\u95ee NVM \u5185\u5b58\u3002\u76ee\u524d\uff0cIntel \u5df2\u7ecf\u63a8\u51fa\u4e86 NVM \u5185\u5b58\u4ea7\u54c1 Optane AEP\u3002 \u8fd9\u6b3e NVM \u5185\u5b58\u4ea7\u54c1\u7ed9\u8f6f\u4ef6\u63d0\u4f9b\u4e86\u4e24\u79cd\u4f7f\u7528\u6a21\u5f0f\uff0c \u5206\u522b\u662f Memory \u6a21\u5f0f\u548c App Direct \u6a21\u5f0f \u3002\u5728 Memory \u6a21\u5f0f\u65f6\uff0cRedis \u53ef\u4ee5\u5229\u7528 NVM \u5bb9\u91cf\u5927\u7684\u7279\u70b9\uff0c\u5b9e\u73b0\u5927\u5bb9\u91cf\u5b9e\u4f8b\uff0c\u4fdd\u5b58\u66f4\u591a\u6570\u636e\u3002\u5728\u4f7f\u7528 App Direct \u6a21\u5f0f\u65f6\uff0cRedis \u53ef\u4ee5\u76f4\u63a5\u5728\u6301\u4e45\u5316\u5185\u5b58\u4e0a\u8fdb\u884c\u6570\u636e\u8bfb\u5199\uff0c \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cRedis \u4e0d\u7528\u518d\u4f7f\u7528 RDB \u6216 AOF \u6587\u4ef6\u4e86\uff0c\u6570\u636e\u5728\u673a\u5668\u6389\u7535\u540e\u4e5f\u4e0d\u4f1a\u4e22\u5931\u3002\u800c\u4e14\uff0c\u5b9e\u4f8b\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u6301\u4e45\u5316\u5185\u5b58\u4e0a\u7684\u6570\u636e\u8fdb\u884c\u6062\u590d\uff0c\u6062\u590d\u901f\u5ea6\u7279\u522b\u5feb\u3002 NVM \u5185\u5b58\u662f\u8fd1\u5e74\u6765\u5b58\u50a8\u8bbe\u5907\u9886\u57df\u4e2d\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u53d8\u5316\uff0c\u5b83\u65e2\u80fd\u6301\u4e45\u5316\u4fdd\u5b58\u6570\u636e\uff0c\u8fd8\u80fd\u50cf\u5185\u5b58\u4e00\u6837\u5feb\u901f\u8bbf\u95ee\uff0c\u8fd9\u5fc5\u7136\u4f1a\u7ed9\u5f53\u524d\u57fa\u4e8e DRAM \u548c\u786c\u76d8\u7684\u7cfb\u7edf\u8f6f\u4ef6\u4f18\u5316\u5e26\u6765\u65b0\u7684\u673a\u9047\u3002","title":"1-2 Redis \u57fa\u4e8eNVM\u5185\u5b58\u7684\u5b9e\u8df5"},{"location":"chap8/6redis_opt_summary/#1-3-redis-resp","text":"RESP 2 \u534f\u8bae\u5b9a\u4e49\u4e86 Redis \u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u8fdb\u884c\u547d\u4ee4\u548c\u6570\u636e\u4ea4\u4e92\u65f6\u7684\u7f16\u7801\u683c\u5f0f\u3002RESP 2 \u63d0\u4f9b\u4e86 5 \u79cd\u7c7b\u578b\u7684\u7f16\u7801\u683c\u5f0f\uff0c\u5305\u62ec\u7b80\u5355\u5b57\u7b26\u4e32\u7c7b\u578b\u3001\u957f\u5b57\u7b26\u4e32\u7c7b\u578b\u3001\u6574\u6570\u7c7b\u578b\u3001\u9519\u8bef\u7c7b\u578b\u548c\u6570\u7ec4\u7c7b\u578b\u3002\u4e3a\u4e86\u533a\u5206\u8fd9 5 \u79cd\u7c7b\u578b\uff0cRESP 2 \u534f\u8bae\u4f7f\u7528\u4e86 5 \u79cd\u4e0d\u540c\u7684\u5b57\u7b26\u4f5c\u4e3a\u8fd9 5 \u79cd\u7c7b\u578b\u7f16\u7801\u7ed3\u679c\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\uff0c\u5206\u522b\u662f +\u3001 $\u3001:\u3001- \u548c * \u3002 RESP 2 \u534f\u8bae\u662f\u6587\u672c\u5f62\u5f0f\u7684\u534f\u8bae\uff0c\u5b9e\u73b0\u7b80\u5355\uff0c\u53ef\u4ee5\u51cf\u5c11\u5ba2\u6237\u7aef\u5f00\u53d1\u51fa\u73b0\u7684 Bug\uff0c\u800c\u4e14\u53ef\u8bfb\u6027\u5f3a\uff0c\u4fbf\u4e8e\u5f00\u53d1\u8c03\u8bd5\u3002\u5f53\u4f60\u9700\u8981\u5f00\u53d1\u5b9a\u5236\u5316\u7684 Redis \u5ba2\u6237\u7aef\u65f6\uff0c\u5c31\u9700\u8981\u4e86\u89e3\u548c\u638c\u63e1 RESP 2 \u534f\u8bae\u3002 RESP 2 \u534f\u8bae\u7684\u4e00\u4e2a\u4e0d\u8db3\u5c31\u662f\u652f\u6301\u7684\u7c7b\u578b\u504f\u5c11\uff0c\u6240\u4ee5\uff0cRedis 6.0 \u7248\u672c\u4f7f\u7528\u4e86 RESP 3 \u534f\u8bae\u3002\u548c RESP 2 \u534f\u8bae\u76f8\u6bd4\uff0c RESP 3 \u534f\u8bae\u589e\u52a0\u4e86\u5bf9\u6d6e\u70b9\u6570\u3001\u5e03\u5c14\u7c7b\u578b\u3001\u6709\u5e8f\u5b57\u5178\u96c6\u5408\u3001\u65e0\u5e8f\u96c6\u5408\u7b49\u591a\u79cd\u7c7b\u578b\u6570\u636e\u7684\u652f\u6301 \u3002\u4e0d\u8fc7\uff0c\u8fd9\u91cc\uff0c\u6709\u4e2a\u5730\u65b9\u9700\u8981\u4f60\u6ce8\u610f\uff0cRedis 6.0 \u53ea\u652f\u6301 RESP 3\uff0c\u5bf9 RESP 2 \u534f\u8bae\u4e0d\u517c\u5bb9\uff0c\u6240\u4ee5\uff0c \u5982\u679c\u4f60\u4f7f\u7528 Redis 6.0 \u7248\u672c\uff0c\u9700\u8981\u786e\u8ba4\u5ba2\u6237\u7aef\u5df2\u7ecf\u652f\u6301\u4e86 RESP 3 \u534f\u8bae\uff0c\u5426\u5219\uff0c\u5c06\u65e0\u6cd5\u4f7f\u7528 Redis 6.0\u3002 \u6700\u540e\uff0c\u6211\u4e5f\u7ed9\u4f60\u63d0\u4f9b\u4e00\u4e2a\u5c0f\u5de5\u5177\u3002\u5982\u679c\u4f60\u60f3\u67e5\u770b\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u6570\u636e\u7684 RESP 2 \u7f16\u7801\u7ed3\u679c\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 telnet \u547d\u4ee4\u548c redis \u5b9e\u4f8b\u8fde\u63a5\uff0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5c31\u884c\uff1a telnet \u5b9e\u4f8bIP \u5b9e\u4f8b\u7aef\u53e3 \u53ef\u4ee5\u7ed9\u5b9e\u4f8b\u53d1\u9001\u547d\u4ee4\uff0c\u8fd9\u6837\u5c31\u80fd\u770b\u5230\u7528 RESP 2 \u534f\u8bae\u7f16\u7801\u540e\u7684\u8fd4\u56de\u7ed3\u679c\u4e86\u3002\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u5728 telnet \u4e2d\uff0c\u5411 Redis \u5b9e\u4f8b\u53d1\u9001\u7528 RESP 2 \u534f\u8bae\u7f16\u5199\u7684\u547d\u4ee4\u64cd\u4f5c\u3002","title":"1-3 Redis\u5ba2\u6237\u7aef\u5982\u4f55\u4e0e\u670d\u52a1\u5668\u7aef\u4ea4\u6362\u547d\u4ee4\u548c\u6570\u636e RESP"},{"location":"chap8/6redis_opt_summary/#1-4-redis","text":"Redis \u7684 INFO \u547d\u4ee4\uff0c\u8fd9\u4e2a\u547d\u4ee4\u662f\u76d1\u63a7\u5de5\u5177\u7684\u57fa\u7840\uff0c\u76d1\u63a7\u5de5\u5177\u90fd\u4f1a\u57fa\u4e8e INFO \u547d\u4ee4\u63d0\u4f9b\u7684\u4fe1\u606f\u8fdb\u884c\u4e8c\u6b21\u52a0\u5de5\u3002\u6211\u4eec\u8fd8\u5b66\u4e60\u4e86 3 \u79cd\u7528\u6765\u76d1\u63a7 Redis \u5b9e\u65f6\u8fd0\u884c\u72b6\u6001\u7684\u8fd0\u7ef4\u5de5\u5177\uff0c\u5206\u522b\u662f Redis-exporter \u3001 redis-stat \u548c Redis Live \u3002 \u5173\u4e8e\u6570\u636e\u8fc1\u79fb\uff0c\u6211\u4eec\u65e2\u53ef\u4ee5\u4f7f\u7528 Redis-shake \u5de5\u5177\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 RDB \u6587\u4ef6\u6216\u662f AOF \u6587\u4ef6\u8fdb\u884c\u8fc1\u79fb\u3002 Redis INFO \u4fe1\u606f\u770b\u4f3c\u7b80\u5355\uff0c\u4f46\u662f\u8fd9\u4e9b\u4fe1\u606f\u8bb0\u5f55\u7740 Redis \u8fd0\u884c\u65f6\u7684\u5404\u79cd\u72b6\u6001\u6570\u636e\uff0c\u5982\u679c\u6211\u4eec\u628a\u8fd9\u4e9b\u6570\u636e\u91c7\u96c6\u5230\u5e76\u76d1\u63a7\u5230\u4f4d\uff0c80% \u7684\u5f02\u5e38\u60c5\u51b5\u80fd\u5728\u7b2c\u4e00\u65f6\u95f4\u53d1\u73b0\u3002 \u673a\u5668\u7684 CPU\u3001\u5185\u5b58\u3001\u7f51\u7edc\u3001\u78c1\u76d8\uff0c\u90fd\u5f71\u54cd\u7740 Redis \u7684\u6027\u80fd\u3002 \u76d1\u63a7\u65f6\u6211\u4eec\u6700\u597d\u91cd\u70b9\u5173\u6ce8\u4ee5\u4e0b\u6307\u6807\uff1a \u5ba2\u6237\u7aef\u76f8\u5173\uff1a\u5f53\u524d\u8fde\u63a5\u6570\u3001\u603b\u8fde\u63a5\u6570\u3001\u8f93\u5165\u7f13\u51b2\u5927\u5c0f\u3001OPS CPU\u76f8\u5173\uff1a\u4e3b\u8fdb\u7a0b CPU \u4f7f\u7528\u7387\u3001\u5b50\u8fdb\u7a0b CPU \u4f7f\u7528\u7387 \u5185\u5b58\u76f8\u5173\uff1a\u5f53\u524d\u5185\u5b58\u3001\u5cf0\u503c\u5185\u5b58\u3001\u5185\u5b58\u788e\u7247\u7387 \u7f51\u7edc\u76f8\u5173\uff1a\u8f93\u5165\u3001\u8f93\u51fa\u7f51\u7edc\u6d41\u91cf \u6301\u4e45\u5316\u76f8\u5173\uff1a\u6700\u540e\u4e00\u6b21 RDB \u65f6\u95f4\u3001RDB fork \u8017\u65f6\u3001\u6700\u540e\u4e00\u6b21 AOF rewrite \u65f6\u95f4\u3001AOF rewrite \u8017\u65f6 key \u76f8\u5173\uff1a\u8fc7\u671f key \u6570\u91cf\u3001\u6dd8\u6c70 key \u6570\u91cf\u3001key \u547d\u4e2d\u7387 \u590d\u5236\u76f8\u5173\uff1a\u4e3b\u4ece\u8282\u70b9\u590d\u5236\u504f\u79fb\u91cf\u3001\u4e3b\u5e93\u590d\u5236\u7f13\u51b2\u533a","title":"1-4 Redis\u8fd0\u7ef4\u5de5\u5177"},{"location":"chap8/6redis_opt_summary/#1-5-redis","text":"\u89c4\u8303\u5206\u7c7b \u5f3a\u5236\u7c7b\u522b\u7684\u89c4\u8303\uff1a\u8fd9\u8868\u793a\uff0c\u5982\u679c\u4e0d\u6309\u7167\u89c4\u8303\u5185\u5bb9\u6765\u6267\u884c\uff0c\u5c31\u4f1a\u7ed9 Redis \u7684\u5e94\u7528\u5e26\u6765\u6781\u5927\u7684\u8d1f\u9762\u5f71\u54cd\uff0c\u4f8b\u5982\u6027\u80fd\u53d7\u635f\u3002 \u63a8\u8350\u7c7b\u522b\u7684\u89c4\u8303\uff1a\u8fd9\u4e2a\u89c4\u8303\u7684\u5185\u5bb9\u80fd\u6709\u6548\u63d0\u5347\u6027\u80fd\u3001\u8282\u7701\u5185\u5b58\u7a7a\u95f4\uff0c\u6216\u8005\u662f\u589e\u52a0\u5f00\u53d1\u548c\u8fd0\u7ef4\u7684\u4fbf\u6377\u6027\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u5e94\u7528\u5230\u5b9e\u8df5\u4e2d\u3002 \u5efa\u8bae\u7c7b\u522b\u7684\u89c4\u8303\uff1a\u8fd9\u7c7b\u89c4\u8303\u5185\u5bb9\u548c\u5b9e\u9645\u4e1a\u52a1\u5e94\u7528\u76f8\u5173\uff0c\u53ea\u662f\u4ece\u7ecf\u5386\u6216\u7ecf\u9a8c\u7ed9\u4f60\u4e00\u4e2a\u5efa\u8bae\uff0c\u4f60\u9700\u8981\u7ed3\u5408\u81ea\u5df1\u7684\u4e1a\u52a1\u573a\u666f\u53c2\u8003\u4f7f\u7528\u3002 \u4e1a\u52a1\u5c42\u9762\u4e3b\u8981\u9762\u5411\u7684\u4e1a\u52a1\u5f00\u53d1\u4eba\u5458 key \u7684\u957f\u5ea6\u5c3d\u91cf\u77ed\uff0c\u8282\u7701\u5185\u5b58\u7a7a\u95f4 \u907f\u514d bigkey\uff0c\u9632\u6b62\u963b\u585e\u4e3b\u7ebf\u7a0b 4.0+\u7248\u672c\u5efa\u8bae\u5f00\u542f lazy-free \u628a Redis \u5f53\u4f5c\u7f13\u5b58\u4f7f\u7528\uff0c\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4 \u4e0d\u4f7f\u7528\u590d\u6742\u5ea6\u8fc7\u9ad8\u7684\u547d\u4ee4\uff0c\u4f8b\u5982SORT\u3001SINTER\u3001SINTERSTORE\u3001ZUNIONSTORE\u3001ZINTERSTORE \u67e5\u8be2\u6570\u636e\u5c3d\u91cf\u4e0d\u4e00\u6b21\u6027\u67e5\u8be2\u5168\u91cf\uff0c\u5199\u5165\u5927\u91cf\u6570\u636e\u5efa\u8bae\u5206\u591a\u6279\u5199\u5165 \u6279\u91cf\u64cd\u4f5c\u5efa\u8bae MGET/MSET \u66ff\u4ee3 GET/SET\uff0cHMGET/HMSET \u66ff\u4ee3 HGET/HSET \u7981\u6b62\u4f7f\u7528 KEYS/FLUSHALL/FLUSHDB \u547d\u4ee4 \u907f\u514d\u96c6\u4e2d\u8fc7\u671f key \u6839\u636e\u4e1a\u52a1\u573a\u666f\u9009\u62e9\u5408\u9002\u7684\u6dd8\u6c70\u7b56\u7565 1\u4f7f\u7528\u8fde\u63a5\u6c60\u64cd\u4f5c Redis\uff0c\u5e76\u8bbe\u7f6e\u5408\u7406\u7684\u53c2\u6570\uff0c\u907f\u514d\u77ed\u8fde\u63a5 \u53ea\u4f7f\u7528 db0\uff0c\u51cf\u5c11 SELECT \u547d\u4ee4\u7684\u6d88\u8017 \u8bfb\u8bf7\u6c42\u91cf\u5f88\u5927\u65f6\uff0c\u5efa\u8bae\u8bfb\u5199\u5206\u79bb\uff0c\u5199\u8bf7\u6c42\u91cf\u5f88\u5927\uff0c\u5efa\u8bae\u4f7f\u7528\u5207\u7247\u96c6\u7fa4 \u8fd0\u7ef4\u5c42\u9762\u4e3b\u8981\u9762\u5411\u7684\u662f DBA \u8fd0\u7ef4\u4eba\u5458 \u6309\u4e1a\u52a1\u7ebf\u90e8\u7f72\u5b9e\u4f8b\uff0c\u907f\u514d\u591a\u4e2a\u4e1a\u52a1\u7ebf\u6df7\u5408\u90e8\u7f72\uff0c\u51fa\u95ee\u9898\u5f71\u54cd\u5176\u4ed6\u4e1a\u52a1 \u4fdd\u8bc1\u673a\u5668\u6709\u8db3\u591f\u7684 CPU\u3001\u5185\u5b58\u3001\u5e26\u5bbd\u3001\u78c1\u76d8\u8d44\u6e90 \u5efa\u8bae\u90e8\u7f72\u4e3b\u4ece\u96c6\u7fa4\uff0c\u5e76\u5206\u5e03\u5728\u4e0d\u540c\u673a\u5668\u4e0a\uff0cslave \u8bbe\u7f6e\u4e3a readonly \u4e3b\u4ece\u8282\u70b9\u6240\u90e8\u7f72\u7684\u673a\u5668\u5404\u81ea\u72ec\u7acb\uff0c\u5c3d\u91cf\u907f\u514d\u4ea4\u53c9\u90e8\u7f72\uff0c\u5bf9\u4ece\u8282\u70b9\u505a\u7ef4\u62a4\u65f6\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5230\u4e3b\u8282\u70b9 \u63a8\u8350\u90e8\u7f72\u54e8\u5175\u96c6\u7fa4\u5b9e\u73b0\u6545\u969c\u81ea\u52a8\u5207\u6362\uff0c\u54e8\u5175\u8282\u70b9\u5206\u5e03\u5728\u4e0d\u540c\u673a\u5668\u4e0a \u63d0\u524d\u505a\u597d\u5bb9\u91cf\u89c4\u5212\uff0c\u9632\u6b62\u4e3b\u4ece\u5168\u91cf\u540c\u6b65\u65f6\uff0c\u5b9e\u4f8b\u4f7f\u7528\u5185\u5b58\u7a81\u589e\u5bfc\u81f4\u5185\u5b58\u4e0d\u8db3 \u505a\u597d\u673a\u5668 CPU\u3001\u5185\u5b58\u3001\u5e26\u5bbd\u3001\u78c1\u76d8\u76d1\u63a7\uff0c\u8d44\u6e90\u4e0d\u8db3\u65f6\u53ca\u65f6\u62a5\u8b66\uff0c\u4efb\u610f\u8d44\u6e90\u4e0d\u8db3\u90fd\u4f1a\u5f71\u54cd Redis \u6027\u80fd \u5b9e\u4f8b\u8bbe\u7f6e\u6700\u5927\u8fde\u63a5\u6570\uff0c\u9632\u6b62\u8fc7\u591a\u5ba2\u6237\u7aef\u8fde\u63a5\u5bfc\u81f4\u5b9e\u4f8b\u8d1f\u8f7d\u8fc7\u9ad8\uff0c\u5f71\u54cd\u6027\u80fd \u5355\u4e2a\u5b9e\u4f8b\u5185\u5b58\u5efa\u8bae\u63a7\u5236\u5728 10G \u4ee5\u4e0b\uff0c\u5927\u5b9e\u4f8b\u5728\u4e3b\u4ece\u5168\u91cf\u540c\u6b65\u3001\u5907\u4efd\u65f6\u6709\u963b\u585e\u98ce\u9669 \u8bbe\u7f6e\u5408\u7406\u7684 slowlog \u9608\u503c\uff0c\u5e76\u5bf9\u5176\u8fdb\u884c\u76d1\u63a7\uff0cslowlog \u8fc7\u591a\u9700\u53ca\u65f6\u62a5\u8b66 \u8bbe\u7f6e\u5408\u7406\u7684 repl-backlog\uff0c\u964d\u4f4e\u4e3b\u4ece\u5168\u91cf\u540c\u6b65\u7684\u6982\u7387 \u8bbe\u7f6e\u5408\u7406\u7684 slave client-output-buffer-limit \uff0c\u907f\u514d\u4e3b\u4ece\u590d\u5236\u4e2d\u65ad\u60c5\u51b5\u53d1\u751f \u63a8\u8350\u5728\u4ece\u8282\u70b9\u4e0a\u5907\u4efd\uff0c\u4e0d\u5f71\u54cd\u4e3b\u8282\u70b9\u6027\u80fd \u4e0d\u5f00\u542f AOF \u6216\u5f00\u542f AOF \u914d\u7f6e\u4e3a\u6bcf\u79d2\u5237\u76d8\uff0c\u907f\u514d\u78c1\u76d8 IO \u62d6\u6162 Redis \u6027\u80fd \u8c03\u6574 maxmemory \u65f6\uff0c\u6ce8\u610f\u4e3b\u4ece\u8282\u70b9\u7684\u8c03\u6574\u987a\u5e8f\uff0c\u987a\u5e8f\u9519\u8bef\u4f1a\u5bfc\u81f4\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4 \u5bf9\u5b9e\u4f8b\u90e8\u7f72\u76d1\u63a7\uff0c\u91c7\u96c6 INFO \u4fe1\u606f\u65f6\u91c7\u7528\u957f\u8fde\u63a5\uff0c\u907f\u514d\u9891\u7e41\u7684\u77ed\u8fde\u63a5 \u505a\u597d\u5b9e\u4f8b\u8fd0\u884c\u65f6\u76d1\u63a7\uff0c\u91cd\u70b9\u5173\u6ce8 expired_keys \u3001 evicted_keys \u3001 latest_fork_usec \uff0c\u8fd9\u4e9b\u6307\u6807\u77ed\u65f6\u7a81\u589e\u53ef\u80fd\u4f1a\u6709\u963b\u585e\u98ce\u9669 \u626b\u63cf\u7ebf\u4e0a\u5b9e\u4f8b\u65f6\uff0c\u8bb0\u5f97\u8bbe\u7f6e\u4f11\u7720\u65f6\u95f4\uff0c\u907f\u514d\u8fc7\u9ad8 OPS \u4ea7\u751f\u6027\u80fd\u6296\u52a8","title":"1-5 Redis\u7684\u4f7f\u7528\u89c4\u8303"},{"location":"chap8/6redis_opt_summary/#2","text":"","title":"2\u3001\u672c\u7ae0\u64cd\u4f5c\u603b\u7ed3"},{"location":"chap8/6redis_opt_summary/#2-1-redis-60","text":"\u5728 Redis 6.0 \u4e2d\uff0c\u591a\u7ebf\u7a0b\u673a\u5236\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\uff0c\u5982\u679c\u9700\u8981\u4f7f\u7528\u591a\u7ebf\u7a0b\u529f\u80fd\uff0c\u9700\u8981\u5728 redis.conf \u4e2d\u5b8c\u6210\u4e24\u4e2a\u8bbe\u7f6e \u3002 1. \u8bbe\u7f6e io-thread-do-reads \u914d\u7f6e\u9879\u4e3a yes\uff0c\u8868\u793a\u542f\u7528\u591a\u7ebf\u7a0b\u3002 io-threads-do-reads yes 2. \u8bbe\u7f6e\u7ebf\u7a0b\u4e2a\u6570\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u7ebf\u7a0b\u4e2a\u6570\u8981\u5c0f\u4e8e Redis \u5b9e\u4f8b\u6240\u5728\u673a\u5668\u7684 CPU \u6838\u4e2a\u6570\uff0c\u4f8b\u5982\uff0c\u5bf9\u4e8e\u4e00\u4e2a 8 \u6838\u7684\u673a\u5668\u6765\u8bf4\uff0cRedis \u5b98\u65b9\u5efa\u8bae\u914d\u7f6e 6 \u4e2a IO \u7ebf\u7a0b\u3002 io-threads 6 \u5982\u679c\u4f60\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u53d1\u73b0 Redis \u5b9e\u4f8b\u7684 CPU \u5f00\u9500\u4e0d\u5927\uff0c\u541e\u5410\u91cf\u5374\u6ca1\u6709\u63d0\u5347\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 Redis 6.0 \u7684\u591a\u7ebf\u7a0b\u673a\u5236\uff0c\u52a0\u901f\u7f51\u7edc\u5904\u7406\uff0c\u8fdb\u800c\u63d0\u5347\u5b9e\u4f8b\u7684\u541e\u5410\u91cf\u3002 \u6253\u5f00\u6216\u5173\u95ed\u666e\u901a\u6a21\u5f0f\u4e0b\u7684 Tracking \u529f\u80fd CLIENT TRACKING ON|OFF \u5ba2\u6237\u7aef\u5982\u4f55\u4f7f\u7528\u5e7f\u64ad\u6a21\u5f0f\u63a5\u6536 key \u5931\u6548\u6d88\u606f\u3002 \u5f53\u6211\u4eec\u5728\u5ba2\u6237\u7aef\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u540e\uff0c\u5982\u679c\u670d\u52a1\u7aef\u66f4\u65b0\u4e86 user:id:1003 \u8fd9\u4e2a key\uff0c\u90a3\u4e48\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u6536\u5230 invalidate \u6d88\u606f\u3002 CLIENT TRACKING ON BCAST PREFIX user \u5728 6.0 \u7248\u672c\u524d\uff0c\u6240\u6709\u5ba2\u6237\u7aef\u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u4e2a\u5bc6\u7801\u8fdb\u884c\u767b\u5f55\u4f7f\u7528\uff0c\u4f46\u662f\u6ca1\u6709\u7528\u6237\u7684\u6982\u5ff5\uff0c\u800c\u5728 6.0 \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ACL SETUSER \u547d\u4ee4\u521b\u5efa\u7528\u6237\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u521b\u5efa\u5e76\u542f\u7528\u4e00\u4e2a\u7528\u6237 normaluser\uff0c\u628a\u5b83\u7684\u5bc6\u7801\u8bbe\u7f6e\u4e3a\u201cabc\u201d\uff1a ACL SETUSER normaluser on > abc \u53e6\u5916\uff0c6.0 \u7248\u672c\u8fd8\u652f\u6301\u4ee5\u7528\u6237\u4e3a\u7c92\u5ea6\u8bbe\u7f6e\u547d\u4ee4\u64cd\u4f5c\u7684\u8bbf\u95ee\u6743\u9650\u3002\u5177\u4f53\u64cd\u4f5c\u5217\u5728\u4e86\u4e0b\u8868\u4e2d\uff0c\u4f60\u53ef\u4ee5\u770b\u4e0b\uff0c\u5176\u4e2d\uff0c\u52a0\u53f7\uff08+\uff09\u548c\u51cf\u53f7\uff08-\uff09\u5c31\u5206\u522b\u8868\u793a\u7ed9\u7528\u6237\u8d4b\u4e88\u6216\u64a4\u9500\u547d\u4ee4\u7684\u8c03\u7528\u6743\u9650\u3002 \u5047\u8bbe\u6211\u4eec\u8981\u8bbe\u7f6e\u7528\u6237 normaluser \u53ea\u80fd\u8c03\u7528 Hash \u7c7b\u578b\u7684\u547d\u4ee4\u64cd\u4f5c\uff0c\u800c\u4e0d\u80fd\u8c03\u7528 String \u7c7b\u578b\u7684\u547d\u4ee4\u64cd\u4f5c\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a ACL SETUSER normaluser +@hash -@string \u9664\u4e86\u8bbe\u7f6e\u67d0\u4e2a\u547d\u4ee4\u6216\u67d0\u7c7b\u547d\u4ee4\u7684\u8bbf\u95ee\u63a7\u5236\u6743\u9650\uff0c6.0 \u7248\u672c\u8fd8\u652f\u6301\u4ee5 key \u4e3a\u7c92\u5ea6\u8bbe\u7f6e\u8bbf\u95ee\u6743\u9650\u3002 \u5177\u4f53\u7684\u505a\u6cd5\u662f\u4f7f\u7528\u6ce2\u6d6a\u53f7 \u201c~\u201d \u548c key \u7684\u524d\u7f00\u6765\u8868\u793a\u63a7\u5236\u8bbf\u95ee\u7684 key\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u9762\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u8bbe\u7f6e\u7528\u6237 normaluser \u53ea\u80fd\u5bf9\u4ee5 \u201cuser:\u201d \u4e3a\u524d\u7f00\u7684 key \u8fdb\u884c\u547d\u4ee4\u64cd\u4f5c\uff1a ACL SETUSER normaluser ~user:* +@all","title":"2-1 Redis 6.0\u7684\u65b0\u7279\u6027\uff1a\u591a\u7ebf\u7a0b\u3001\u5ba2\u6237\u7aef\u7f13\u5b58\u4e0e\u5b89\u5168"},{"location":"chap8/6redis_opt_summary/#1-2-redis-nvm_1","text":"#\u6210\u529f\u5199\u5165String\u7c7b\u578b\u6570\u636e\uff0c\u8fd4\u56deOK 127.0.0.1:6379> SET testkey testvalue OK \u8fd9\u91cc\u7684\u4ea4\u4e92\u5185\u5bb9\u5c31\u5305\u62ec\u4e86 \u547d\u4ee4\uff08SET \u547d\u4ee4\uff09\u3001\u952e\uff08String \u7c7b\u578b\u7684\u952e testkey\uff09\u548c\u5355\u4e2a\u503c\uff08String \u7c7b\u578b\u7684\u503c testvalue\uff09\uff0c\u800c\u670d\u52a1\u5668\u7aef\u5219\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a OK \u56de\u590d \u3002 \u7b2c\u4e8c\u4e2a\u4f8b\u5b50\u662f\u6267\u884c HSET \u547d\u4ee4\uff1a #\u6210\u529f\u5199\u5165Hash\u7c7b\u578b\u6570\u636e\uff0c\u8fd4\u56de\u5b9e\u9645\u5199\u5165\u7684\u96c6\u5408\u5143\u7d20\u4e2a\u6570 127.0.0.1:6379>HSET testhash a 1 b 2 c 3 (integer) 3 \u8fd9\u91cc\u7684\u4ea4\u4e92\u5185\u5bb9\u5305\u62ec\u4e09\u4e2a key-value \u7684 Hash\u96c6\u5408\u503c\uff08a 1 b 2 c 3\uff09 \uff0c\u800c\u670d\u52a1\u5668\u7aef\u8fd4\u56de \u6574\u6570\u56de\u590d\uff083\uff09 \uff0c\u8868\u793a\u64cd\u4f5c\u6210\u529f\u5199\u5165\u7684\u5143\u7d20\u4e2a\u6570\u3002 \u6700\u540e\u4e00\u4e2a\u4f8b\u5b50\u662f\u6267\u884c PUT \u547d\u4ee4\uff0c\u5982\u4e0b\u6240\u793a\uff1a #\u53d1\u9001\u7684\u547d\u4ee4\u4e0d\u5bf9\uff0c\u62a5\u9519\uff0c\u5e76\u8fd4\u56de\u9519\u8bef\u4fe1\u606f 127.0.0.1:6379>PUT testkey2 testvalue (error) ERR unknown command 'PUT', with args beginning with: 'testkey', 'testvalue' \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u7684\u4ea4\u4e92\u5185\u5bb9\u5305\u62ec\u9519\u8bef\u4fe1\u606f\uff0c\u8fd9\u662f\u56e0\u4e3a\uff0c Redis \u5b9e\u4f8b\u672c\u8eab\u4e0d\u652f\u6301 PUT \u547d\u4ee4\uff0c\u6240\u4ee5\u670d\u52a1\u5668\u7aef\u62a5\u9519\u201cerror\u201d\uff0c\u5e76\u8fd4\u56de\u5177\u4f53\u7684\u9519\u8bef\u4fe1\u606f\uff0c\u4e5f\u5c31\u662f\u672a\u77e5\u7684\u547d\u4ee4\u201cput\u201d\u3002 \u5047\u8bbe\u6709\u4e00\u4e2a Hash \u7c7b\u578b\u7684\u952e\u662f testhash\uff0c\u96c6\u5408\u5143\u7d20\u5206\u522b\u4e3a a:1\u3001b:2\u3001c:3\u3002\u540c\u65f6\uff0c\u6709\u4e00\u4e2a Sorted Set \u7c7b\u578b\u7684\u952e\u662f testzset\uff0c\u96c6\u5408\u5143\u7d20\u5206\u522b\u662f a\u3001b\u3001c\uff0c\u5b83\u4eec\u7684\u5206\u6570\u5206\u522b\u662f 1\u30012\u30013\u3002\u6211\u4eec\u5728 redis-cli \u5ba2\u6237\u7aef\u4e2d\u8bfb\u53d6\u5b83\u4eec\u7684\u7ed3\u679c\u65f6\uff0c\u8fd4\u56de\u7684\u5f62\u5f0f\u90fd\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u5982\u4e0b\u6240\u793a\uff1a 127.0.0.1:6379>HGETALL testhash 1) \"a\" 2) \"1\" 3) \"b\" 4) \"2\" 5) \"c\" 6) \"3\" 127.0.0.1:6379>ZRANGE testzset 0 3 withscores 1) \"a\" 2) \"1\" 3) \"b\" 4) \"2\" 5) \"c\" 6) \"3\"","title":"1-2 Redis \u57fa\u4e8eNVM\u5185\u5b58\u7684\u5b9e\u8df5"},{"location":"chap8/6redis_opt_summary/#3","text":"3-1 \u95ee\u9898 \uff1a\u4f60\u89c9\u5f97\uff0cRedis 6.0 \u7684\u54ea\u4e2a\u6216\u54ea\u4e9b\u65b0\u7279\u6027\u4f1a\u5bf9\u4f60\u6709\u5e2e\u52a9\u5462\uff1f \u7b54\u6848\uff1a\u8fd9\u4e2a\u8981\u6839\u636e\u4f60\u4eec\u7684\u5177\u4f53\u9700\u6c42\u6765\u5b9a\u3002\u4ece\u63d0\u5347\u6027\u80fd\u7684\u89d2\u5ea6\u4e0a\u6765\u8bf4\uff0cRedis 6.0 \u4e2d\u7684\u591a IO \u7ebf\u7a0b\u7279\u6027\u53ef\u4ee5\u7f13\u89e3 Redis \u7684\u7f51\u7edc\u8bf7\u6c42\u5904\u7406\u538b\u529b\u3002\u901a\u8fc7\u591a\u7ebf\u7a0b\u589e\u52a0\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\u7684\u80fd\u529b\uff0c\u53ef\u4ee5\u8fdb\u4e00\u6b65\u63d0\u5347\u5b9e\u4f8b\u7684\u6574\u4f53\u6027\u80fd\u3002\u4e1a\u754c\u5df2\u7ecf\u6709\u4eba\u8bc4\u6d4b\u8fc7\uff0c\u8ddf 6.0 \u4e4b\u524d\u7684\u5355\u7ebf\u7a0b Redis \u76f8\u6bd4\uff0c6.0 \u7684\u591a\u7ebf\u7a0b\u6027\u80fd\u7684\u786e\u6709\u63d0\u5347\u3002\u6240\u4ee5\uff0c\u8fd9\u4e2a\u7279\u6027\u5bf9\u4e1a\u52a1\u5e94\u7528\u4f1a\u6709\u6bd4\u8f83\u5927\u7684\u5e2e\u52a9\u3002 \u53e6\u5916\uff0c\u57fa\u4e8e\u7528\u6237\u7684\u547d\u4ee4\u7c92\u5ea6 ACL \u63a7\u5236\u673a\u5236\u4e5f\u975e\u5e38\u6709\u7528\u3002\u5f53 Redis \u4ee5\u4e91\u5316\u7684\u65b9\u5f0f\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u65f6\uff0c\u5c31\u4f1a\u9762\u4e34\u591a\u79df\u6237\uff08\u6bd4\u5982\u591a\u7528\u6237\u6216\u591a\u4e2a\u5fae\u670d\u52a1\uff09\u7684\u5e94\u7528\u573a\u666f\u3002\u6709\u4e86 ACL \u65b0\u7279\u6027\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5b89\u5168\u5730\u652f\u6301\u591a\u79df\u6237\u5171\u4eab\u8bbf\u95ee Redis \u670d\u52a1\u4e86\u3002 3-2 \u95ee\u9898 \uff1a\u4f60\u89c9\u5f97\uff0c\u6709\u4e86\u6301\u4e45\u5316\u5185\u5b58\u540e\uff0c\u8fd8\u9700\u8981 Redis \u4e3b\u4ece\u96c6\u7fa4\u5417\uff1f \u7b54\u6848\uff1a\u6301\u4e45\u5316\u5185\u5b58\u867d\u7136\u53ef\u4ee5\u5feb\u901f\u6062\u590d\u6570\u636e\uff0c\u4f46\u662f\uff0c \u9664\u4e86\u63d0\u4f9b\u4e3b\u4ece\u6545\u969c\u5207\u6362\u4ee5\u5916\uff0c\u4e3b\u4ece\u96c6\u7fa4\u8fd8\u53ef\u4ee5\u5b9e\u73b0\u8bfb\u5199\u5206\u79bb \u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0\u4ece\u5b9e\u4f8b\uff0c\u8ba9\u591a\u4e2a\u4ece\u5b9e\u4f8b\u5171\u540c\u5206\u62c5\u5927\u91cf\u7684\u8bfb\u8bf7\u6c42\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u5347 Redis \u7684\u8bfb\u6027\u80fd \u3002\u800c\u63d0\u5347\u8bfb\u6027\u80fd\u5e76\u4e0d\u662f\u6301\u4e45\u5316\u5185\u5b58\u80fd\u63d0\u4f9b\u7684\uff0c\u6240\u4ee5\uff0c\u5982\u679c\u4e1a\u52a1\u5c42\u5bf9\u8bfb\u6027\u80fd\u6709\u9ad8\u8981\u6c42\u65f6\uff0c\u6211\u4eec\u8fd8\u662f\u9700\u8981\u4e3b\u4ece\u96c6\u7fa4\u7684\u3002","title":"3\u3001\u672c\u7ae0\u95ee\u9898"},{"location":"chap8/7redis_shake/","text":"\u5de5\u5177\u8865\u51451\uff1aredis-shake\u6570\u636e\u540c\u6b65\u548c\u6570\u636e\u8fc1\u79fb 1\u3001\u524d\u8a00 \u4e00\u4e2a Redis \u9700\u8981\u4ece\u53e6\u4e00\u4e2a Redis \u6570\u636e\u540c\u6b65 \u6216\u8005 \u6570\u636e\u8fc1\u79fb\uff0c\u8fd9\u79cd\u4e00\u822c\u600e\u4e48\u505a\uff1f \u6570\u636e\u8fc1\u79fb \u8fd9\u79cd\u4e00\u822c\u6bd4\u8f83\u597d\u505a\uff0c \u53ef\u4ee5\u76f4\u63a5\u4ece\u6e90redis\u5bfc\u51fardb\uff0c\u518d\u628ardb\u6587\u4ef6\u5bfc\u5165\u76ee\u6807redis\u3002 \u4f46\u662f\u5982\u679c\u9700\u8981\u5b9e\u65f6\u589e\u91cf\u540c\u6b65\u5c31\u6bd4\u8f83\u56f0\u96be\uff0c\u6709\u4ec0\u4e48\u597d\u7684\u65b9\u6cd5\u89e3\u51b3\u8fd9\u79cd\u9700\u6c42\uff0c\u8fd9\u91cc\u4ecb\u7ecd\u4e0b\u963f\u91cc\u4e91\u5f00\u6e90 redis-shake \u5de5\u5177\u3002 redis-shake \u9879\u76ee\u5730\u5740\uff1a https://github.com/alibaba/RedisShake 2\u3001\u57fa\u672c\u529f\u80fd redis-shake \uff1a\u662f\u6211\u4eec\u57fa\u4e8eredis-port\u57fa\u7840\u4e0a\u8fdb\u884c\u6539\u8fdb\u7684\u4e00\u6b3e\u4ea7\u54c1\u3002\u5b83\u652f\u6301 \u89e3\u6790\u3001\u6062\u590d\u3001\u5907\u4efd\u3001\u540c\u6b65 \u56db\u4e2a\u529f\u80fd\u3002\u4ee5\u4e0b\u4e3b\u8981\u4ecb\u7ecd\u540c\u6b65sync\u3002 \u6062\u590d restore \uff1a \u5c06RDB\u6587\u4ef6\u6062\u590d\u5230\u76ee\u7684redis\u6570\u636e\u5e93\u3002 \u5907\u4efd dump \uff1a\u5c06\u6e90redis\u7684\u5168\u91cf\u6570\u636e\u901a\u8fc7RDB\u6587\u4ef6\u5907\u4efd\u8d77\u6765\u3002 \u89e3\u6790 decode \uff1a \u5bf9RDB\u6587\u4ef6\u8fdb\u884c\u8bfb\u53d6\uff0c\u5e76\u4ee5json\u683c\u5f0f\u89e3\u6790\u5b58\u50a8\u3002 \u540c\u6b65 sync \uff1a\u652f\u6301\u6e90redis\u548c\u76ee\u7684redis\u7684\u6570\u636e\u540c\u6b65\uff0c\u652f\u6301\u5168\u91cf\u548c\u589e\u91cf\u6570\u636e\u7684\u8fc1\u79fb\uff0c\u652f\u6301\u4ece\u4e91\u4e0b\u5230\u963f\u91cc\u4e91\u4e91- \u4e0a\u7684\u540c\u6b65\uff0c\u4e5f\u652f\u6301\u4e91\u4e0b\u5230\u4e91\u4e0b\u4e0d\u540c\u73af\u5883\u7684\u540c\u6b65\uff0c\u652f\u6301\u5355\u8282\u70b9\u3001\u4e3b\u4ece\u7248\u3001\u96c6\u7fa4\u7248\u4e4b\u95f4\u7684\u4e92\u76f8\u540c\u6b65\u3002\u9700\u8981\u6ce8\u610f- \u7684\u662f\uff0c\u5982\u679c\u6e90\u7aef\u662f\u96c6\u7fa4\u7248\uff0c\u53ef\u4ee5\u542f\u52a8\u4e00\u4e2aRedisShake\uff0c\u4ece\u4e0d\u540c\u7684db\u7ed3\u70b9\u8fdb\u884c\u62c9\u53d6\uff0c\u540c\u65f6\u6e90\u7aef\u4e0d\u80fd\u5f00\u542f- move slot\u529f\u80fd\uff1b\u5bf9\u4e8e\u76ee\u7684\u7aef\uff0c\u5982\u679c\u662f\u96c6\u7fa4\u7248\uff0c\u5199\u5165\u53ef\u4ee5\u662f1\u4e2a\u6216\u8005\u591a\u4e2adb\u7ed3\u70b9\u3002 \u540c\u6b65 rump \uff1a\u652f\u6301\u6e90redis\u548c\u76ee\u7684redis\u7684\u6570\u636e\u540c\u6b65\uff0c\u4ec5\u652f\u6301\u5168\u91cf\u7684\u8fc1\u79fb \u3002\u91c7\u7528scan\u548crestore\u547d\u4ee4\u8fdb\u884c\u8fc1\u79fb\uff0c\u652f\u6301\u4e0d\u540c\u4e91\u5382\u5546\u4e0d\u540credis\u7248\u672c\u7684\u8fc1\u79fb\u3002 3\u3001\u57fa\u672c\u539f\u7406 redis-shake \u7684\u57fa\u672c\u539f\u7406\u5c31\u662f\u6a21\u62df \u4e00\u4e2a\u4ece\u8282\u70b9\u52a0\u5165\u6e90redis\u96c6\u7fa4\uff0c\u9996\u5148\u8fdb\u884c\u5168\u91cf\u62c9\u53d6\u5e76\u56de\u653e\uff0c\u7136\u540e\u8fdb\u884c\u589e\u91cf\u7684\u62c9\u53d6\uff08\u901a\u8fc7psync\u547d\u4ee4\uff09 \u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u5982\u679c\u6e90\u7aef\u662f\u96c6\u7fa4\u6a21\u5f0f\uff0c\u53ea\u9700\u8981\u542f\u52a8\u4e00\u4e2aredis-shake\u8fdb\u884c\u62c9\u53d6\uff0c\u540c\u65f6\u4e0d\u80fd\u5f00\u542f\u6e90\u7aef\u7684move slot\u64cd\u4f5c\u3002\u5982\u679c\u76ee\u7684\u7aef\u662f\u96c6\u7fa4\u6a21\u5f0f\uff0c\u53ef\u4ee5\u5199\u5165\u5230\u4e00\u4e2a\u7ed3\u70b9\uff0c\u7136\u540e\u518d\u8fdb\u884cslot\u7684\u8fc1\u79fb\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u591a\u5bf9\u591a\u5199\u5165\u3002 \u76ee\u524d\uff0c redis-shake \u5230\u76ee\u7684\u7aef\u91c7\u7528\u5355\u94fe\u8def\u5b9e\u73b0\uff0c\u5bf9\u4e8e\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e0d\u4f1a\u6210\u4e3a\u74f6\u9888\uff0c\u4f46\u5bf9\u4e8e\u6781\u7aef\u60c5\u51b5\uff0c qps \u6bd4\u8f83\u5927\u7684\u65f6\u5019\uff0c\u6b64\u90e8\u5206\u6027\u80fd\u53ef\u80fd\u6210\u4e3a\u74f6\u9888\uff0c\u540e\u7eed\u6211\u4eec\u53ef\u80fd\u4f1a\u8ba1\u5212\u5bf9\u6b64\u8fdb\u884c\u4f18\u5316\u3002\u53e6\u5916\uff0c redis-shake \u5230\u76ee\u7684\u7aef\u7684\u6570\u636e\u540c\u6b65\u91c7\u7528\u5f02\u6b65\u7684\u65b9\u5f0f\uff0c\u8bfb\u5199\u5206\u79bb\u57282\u4e2a\u7ebf\u7a0b\u64cd\u4f5c\uff0c\u964d\u4f4e\u56e0\u4e3a\u7f51\u7edc\u65f6\u5ef6\u5e26\u6765\u7684\u540c\u6b65\u6027\u80fd\u4e0b\u964d\u3002 3-1 \u9ad8\u6548\u6027 \u5168\u91cf\u540c\u6b65 \u9636\u6bb5 \u5e76\u53d1\u6267\u884c \uff0c \u589e\u91cf\u540c\u6b65 \u9636\u6bb5 \u5f02\u6b65\u6267\u884c \uff0c\u80fd\u591f\u8fbe\u5230\u6beb\u79d2\u7ea7\u522b\u5ef6\u8fdf\uff08\u53d6\u51b3\u4e8e\u7f51\u7edc\u5ef6\u8fdf\uff09\u3002\u540c\u65f6\uff0c\u6211\u4eec\u8fd8\u5bf9\u5927key\u540c\u6b65\u8fdb\u884c\u5206\u6279\u62c9\u53d6\uff0c\u4f18\u5316\u540c\u6b65\u6027\u80fd\u3002 3-2 \u76d1\u63a7 \u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u6211\u4eec\u63d0\u4f9b\u7684 restful \u62c9\u53d6 metric \u6765\u5bf9 redis-shake \u8fdb\u884c\u5b9e\u65f6\u76d1\u63a7\uff1a curl 127.0.0.1:9320/metric \u3002 3-3 \u6821\u9a8c \u5982\u4f55\u6821\u9a8c\u540c\u6b65\u7684\u6b63\u786e\u6027\uff1f\u53ef\u4ee5\u91c7\u7528\u6211\u4eec\u5f00\u6e90\u7684 redis-full-check \uff1a https://github.com/aliyun/redis-full-check?spm=a2c6h.12873639.0.0.4b8974955p9YxV \u3002 3-4 \u652f\u6301\u7248\u672c \u652f\u63012.8-5.0\u7248\u672c\u7684\u540c\u6b65\u3002 \u652f\u6301codis\u3002 \u652f\u6301\u4e91\u4e0b\u5230\u4e91\u4e0a\uff0c\u4e91\u4e0a\u5230\u4e91\u4e0a\uff0c\u4e91\u4e0a\u5230\u4e91\u4e0b\uff08\u963f\u91cc\u4e91\u76ee\u524d\u652f\u6301\u4e3b\u4ece\u7248\uff09\uff0c\u5176\u4ed6\u4e91\u5230\u963f\u91cc\u4e91\u7b49\u94fe\u8def\uff0c\u5e2e\u52a9\u7528\u6237\u7075\u6d3b\u6784\u5efa\u6df7\u5408\u4e91\u573a\u666f\u3002 3-5 \u6ce8\u610f\u4e8b\u9879 \u5982\u679c\u76ee\u6807\u5e93\u7684\u6570\u636e\u9010\u51fa\u7b56\u7565\uff08maxmemory-policy\uff09\u914d\u7f6e\u4e3anoeviction\u4ee5\u5916\u7684\u503c\uff0c\u53ef\u80fd\u5bfc\u81f4\u76ee\u6807\u5e93\u7684\u6570\u636e\u4e0e\u6e90\u5e93\u4e0d\u4e00\u81f4\u3002\u5173\u4e8e\u6570\u636e\u9010\u51fa\u7b56\u7565\u8be6\u60c5\uff0c\u8bf7\u53c2\u89c1Redis\u6570\u636e\u9010\u51fa\u7b56\u7565\u4ecb\u7ecd\u3002 \u5982\u679c\u6e90\u5e93\u4e2d\u7684\u67d0\u4e9bKey\u4f7f\u7528\u4e86\u8fc7\u671f\uff08expire\uff09\u673a\u5236\uff0c\u7531\u4e8e\u53ef\u80fd\u5b58\u5728Key\u5df2\u8fc7\u671f\u4f46\u672a\u88ab\u53ca\u65f6\u5220\u9664\u7684\u60c5\u5f62\uff0c\u6240\u4ee5\u5728\u76ee\u6807\u5e93\u4e2d\u67e5\u770b\uff08\u5982\u901a\u8fc7info\u547d\u4ee4\uff09\u5230\u7684Key\u6570\u91cf\u4f1a\u6bd4\u6e90\u5e93\u7684Key\u6570\u91cf\u5c11\u3002 \u8bf4\u660e\uff1a\u6e90\u548c\u76ee\u6807\u5e93\u4e2d\uff0c\u672a\u8bbe\u7f6e\u8fc7\u671f\u673a\u5236\u6216\u672a\u8fc7\u671f\u7684Key\u6570\u91cf\u662f\u4e00\u81f4\u7684\u3002 4\u3001\u5b89\u88c5 Redis-shake # \u4e0b\u8f7d Redis-shake \u5b89\u88c5\u5305 $ wget 'http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/attach/120287/cn_zh/1608173646665/redis-shake-v2.0.3.tar.gz' # \u89e3\u538bRedis-shake \u5b89\u88c5\u5305 $ tar xzf redis-shake-v2.0.3.tar.gz # \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 $ cd redis-shake-v2.0.3/ $ vim redis-shake.conf # \u542f\u52a8Redis-shake\uff0c\u5f00\u59cb\u6267\u884c\u6570\u636e\u8fc1\u79fb $ ./redis-shake.linux -type=sync -conf=redis-shake.conf","title":"\u5de5\u5177\u8865\u51451\uff1aredis-shake\u6570\u636e\u540c\u6b65\u548c\u6570\u636e\u8fc1\u79fb"},{"location":"chap8/7redis_shake/#1redis-shake","text":"","title":"\u5de5\u5177\u8865\u51451\uff1aredis-shake\u6570\u636e\u540c\u6b65\u548c\u6570\u636e\u8fc1\u79fb"},{"location":"chap8/7redis_shake/#1","text":"\u4e00\u4e2a Redis \u9700\u8981\u4ece\u53e6\u4e00\u4e2a Redis \u6570\u636e\u540c\u6b65 \u6216\u8005 \u6570\u636e\u8fc1\u79fb\uff0c\u8fd9\u79cd\u4e00\u822c\u600e\u4e48\u505a\uff1f \u6570\u636e\u8fc1\u79fb \u8fd9\u79cd\u4e00\u822c\u6bd4\u8f83\u597d\u505a\uff0c \u53ef\u4ee5\u76f4\u63a5\u4ece\u6e90redis\u5bfc\u51fardb\uff0c\u518d\u628ardb\u6587\u4ef6\u5bfc\u5165\u76ee\u6807redis\u3002 \u4f46\u662f\u5982\u679c\u9700\u8981\u5b9e\u65f6\u589e\u91cf\u540c\u6b65\u5c31\u6bd4\u8f83\u56f0\u96be\uff0c\u6709\u4ec0\u4e48\u597d\u7684\u65b9\u6cd5\u89e3\u51b3\u8fd9\u79cd\u9700\u6c42\uff0c\u8fd9\u91cc\u4ecb\u7ecd\u4e0b\u963f\u91cc\u4e91\u5f00\u6e90 redis-shake \u5de5\u5177\u3002 redis-shake \u9879\u76ee\u5730\u5740\uff1a https://github.com/alibaba/RedisShake","title":"1\u3001\u524d\u8a00"},{"location":"chap8/7redis_shake/#2","text":"redis-shake \uff1a\u662f\u6211\u4eec\u57fa\u4e8eredis-port\u57fa\u7840\u4e0a\u8fdb\u884c\u6539\u8fdb\u7684\u4e00\u6b3e\u4ea7\u54c1\u3002\u5b83\u652f\u6301 \u89e3\u6790\u3001\u6062\u590d\u3001\u5907\u4efd\u3001\u540c\u6b65 \u56db\u4e2a\u529f\u80fd\u3002\u4ee5\u4e0b\u4e3b\u8981\u4ecb\u7ecd\u540c\u6b65sync\u3002 \u6062\u590d restore \uff1a \u5c06RDB\u6587\u4ef6\u6062\u590d\u5230\u76ee\u7684redis\u6570\u636e\u5e93\u3002 \u5907\u4efd dump \uff1a\u5c06\u6e90redis\u7684\u5168\u91cf\u6570\u636e\u901a\u8fc7RDB\u6587\u4ef6\u5907\u4efd\u8d77\u6765\u3002 \u89e3\u6790 decode \uff1a \u5bf9RDB\u6587\u4ef6\u8fdb\u884c\u8bfb\u53d6\uff0c\u5e76\u4ee5json\u683c\u5f0f\u89e3\u6790\u5b58\u50a8\u3002 \u540c\u6b65 sync \uff1a\u652f\u6301\u6e90redis\u548c\u76ee\u7684redis\u7684\u6570\u636e\u540c\u6b65\uff0c\u652f\u6301\u5168\u91cf\u548c\u589e\u91cf\u6570\u636e\u7684\u8fc1\u79fb\uff0c\u652f\u6301\u4ece\u4e91\u4e0b\u5230\u963f\u91cc\u4e91\u4e91- \u4e0a\u7684\u540c\u6b65\uff0c\u4e5f\u652f\u6301\u4e91\u4e0b\u5230\u4e91\u4e0b\u4e0d\u540c\u73af\u5883\u7684\u540c\u6b65\uff0c\u652f\u6301\u5355\u8282\u70b9\u3001\u4e3b\u4ece\u7248\u3001\u96c6\u7fa4\u7248\u4e4b\u95f4\u7684\u4e92\u76f8\u540c\u6b65\u3002\u9700\u8981\u6ce8\u610f- \u7684\u662f\uff0c\u5982\u679c\u6e90\u7aef\u662f\u96c6\u7fa4\u7248\uff0c\u53ef\u4ee5\u542f\u52a8\u4e00\u4e2aRedisShake\uff0c\u4ece\u4e0d\u540c\u7684db\u7ed3\u70b9\u8fdb\u884c\u62c9\u53d6\uff0c\u540c\u65f6\u6e90\u7aef\u4e0d\u80fd\u5f00\u542f- move slot\u529f\u80fd\uff1b\u5bf9\u4e8e\u76ee\u7684\u7aef\uff0c\u5982\u679c\u662f\u96c6\u7fa4\u7248\uff0c\u5199\u5165\u53ef\u4ee5\u662f1\u4e2a\u6216\u8005\u591a\u4e2adb\u7ed3\u70b9\u3002 \u540c\u6b65 rump \uff1a\u652f\u6301\u6e90redis\u548c\u76ee\u7684redis\u7684\u6570\u636e\u540c\u6b65\uff0c\u4ec5\u652f\u6301\u5168\u91cf\u7684\u8fc1\u79fb \u3002\u91c7\u7528scan\u548crestore\u547d\u4ee4\u8fdb\u884c\u8fc1\u79fb\uff0c\u652f\u6301\u4e0d\u540c\u4e91\u5382\u5546\u4e0d\u540credis\u7248\u672c\u7684\u8fc1\u79fb\u3002","title":"2\u3001\u57fa\u672c\u529f\u80fd"},{"location":"chap8/7redis_shake/#3","text":"redis-shake \u7684\u57fa\u672c\u539f\u7406\u5c31\u662f\u6a21\u62df \u4e00\u4e2a\u4ece\u8282\u70b9\u52a0\u5165\u6e90redis\u96c6\u7fa4\uff0c\u9996\u5148\u8fdb\u884c\u5168\u91cf\u62c9\u53d6\u5e76\u56de\u653e\uff0c\u7136\u540e\u8fdb\u884c\u589e\u91cf\u7684\u62c9\u53d6\uff08\u901a\u8fc7psync\u547d\u4ee4\uff09 \u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u5982\u679c\u6e90\u7aef\u662f\u96c6\u7fa4\u6a21\u5f0f\uff0c\u53ea\u9700\u8981\u542f\u52a8\u4e00\u4e2aredis-shake\u8fdb\u884c\u62c9\u53d6\uff0c\u540c\u65f6\u4e0d\u80fd\u5f00\u542f\u6e90\u7aef\u7684move slot\u64cd\u4f5c\u3002\u5982\u679c\u76ee\u7684\u7aef\u662f\u96c6\u7fa4\u6a21\u5f0f\uff0c\u53ef\u4ee5\u5199\u5165\u5230\u4e00\u4e2a\u7ed3\u70b9\uff0c\u7136\u540e\u518d\u8fdb\u884cslot\u7684\u8fc1\u79fb\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u591a\u5bf9\u591a\u5199\u5165\u3002 \u76ee\u524d\uff0c redis-shake \u5230\u76ee\u7684\u7aef\u91c7\u7528\u5355\u94fe\u8def\u5b9e\u73b0\uff0c\u5bf9\u4e8e\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e0d\u4f1a\u6210\u4e3a\u74f6\u9888\uff0c\u4f46\u5bf9\u4e8e\u6781\u7aef\u60c5\u51b5\uff0c qps \u6bd4\u8f83\u5927\u7684\u65f6\u5019\uff0c\u6b64\u90e8\u5206\u6027\u80fd\u53ef\u80fd\u6210\u4e3a\u74f6\u9888\uff0c\u540e\u7eed\u6211\u4eec\u53ef\u80fd\u4f1a\u8ba1\u5212\u5bf9\u6b64\u8fdb\u884c\u4f18\u5316\u3002\u53e6\u5916\uff0c redis-shake \u5230\u76ee\u7684\u7aef\u7684\u6570\u636e\u540c\u6b65\u91c7\u7528\u5f02\u6b65\u7684\u65b9\u5f0f\uff0c\u8bfb\u5199\u5206\u79bb\u57282\u4e2a\u7ebf\u7a0b\u64cd\u4f5c\uff0c\u964d\u4f4e\u56e0\u4e3a\u7f51\u7edc\u65f6\u5ef6\u5e26\u6765\u7684\u540c\u6b65\u6027\u80fd\u4e0b\u964d\u3002","title":"3\u3001\u57fa\u672c\u539f\u7406"},{"location":"chap8/7redis_shake/#3-1","text":"\u5168\u91cf\u540c\u6b65 \u9636\u6bb5 \u5e76\u53d1\u6267\u884c \uff0c \u589e\u91cf\u540c\u6b65 \u9636\u6bb5 \u5f02\u6b65\u6267\u884c \uff0c\u80fd\u591f\u8fbe\u5230\u6beb\u79d2\u7ea7\u522b\u5ef6\u8fdf\uff08\u53d6\u51b3\u4e8e\u7f51\u7edc\u5ef6\u8fdf\uff09\u3002\u540c\u65f6\uff0c\u6211\u4eec\u8fd8\u5bf9\u5927key\u540c\u6b65\u8fdb\u884c\u5206\u6279\u62c9\u53d6\uff0c\u4f18\u5316\u540c\u6b65\u6027\u80fd\u3002","title":"3-1 \u9ad8\u6548\u6027"},{"location":"chap8/7redis_shake/#3-2","text":"\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u6211\u4eec\u63d0\u4f9b\u7684 restful \u62c9\u53d6 metric \u6765\u5bf9 redis-shake \u8fdb\u884c\u5b9e\u65f6\u76d1\u63a7\uff1a curl 127.0.0.1:9320/metric \u3002","title":"3-2 \u76d1\u63a7"},{"location":"chap8/7redis_shake/#3-3","text":"\u5982\u4f55\u6821\u9a8c\u540c\u6b65\u7684\u6b63\u786e\u6027\uff1f\u53ef\u4ee5\u91c7\u7528\u6211\u4eec\u5f00\u6e90\u7684 redis-full-check \uff1a https://github.com/aliyun/redis-full-check?spm=a2c6h.12873639.0.0.4b8974955p9YxV \u3002","title":"3-3 \u6821\u9a8c"},{"location":"chap8/7redis_shake/#3-4","text":"\u652f\u63012.8-5.0\u7248\u672c\u7684\u540c\u6b65\u3002 \u652f\u6301codis\u3002 \u652f\u6301\u4e91\u4e0b\u5230\u4e91\u4e0a\uff0c\u4e91\u4e0a\u5230\u4e91\u4e0a\uff0c\u4e91\u4e0a\u5230\u4e91\u4e0b\uff08\u963f\u91cc\u4e91\u76ee\u524d\u652f\u6301\u4e3b\u4ece\u7248\uff09\uff0c\u5176\u4ed6\u4e91\u5230\u963f\u91cc\u4e91\u7b49\u94fe\u8def\uff0c\u5e2e\u52a9\u7528\u6237\u7075\u6d3b\u6784\u5efa\u6df7\u5408\u4e91\u573a\u666f\u3002","title":"3-4 \u652f\u6301\u7248\u672c"},{"location":"chap8/7redis_shake/#3-5","text":"\u5982\u679c\u76ee\u6807\u5e93\u7684\u6570\u636e\u9010\u51fa\u7b56\u7565\uff08maxmemory-policy\uff09\u914d\u7f6e\u4e3anoeviction\u4ee5\u5916\u7684\u503c\uff0c\u53ef\u80fd\u5bfc\u81f4\u76ee\u6807\u5e93\u7684\u6570\u636e\u4e0e\u6e90\u5e93\u4e0d\u4e00\u81f4\u3002\u5173\u4e8e\u6570\u636e\u9010\u51fa\u7b56\u7565\u8be6\u60c5\uff0c\u8bf7\u53c2\u89c1Redis\u6570\u636e\u9010\u51fa\u7b56\u7565\u4ecb\u7ecd\u3002 \u5982\u679c\u6e90\u5e93\u4e2d\u7684\u67d0\u4e9bKey\u4f7f\u7528\u4e86\u8fc7\u671f\uff08expire\uff09\u673a\u5236\uff0c\u7531\u4e8e\u53ef\u80fd\u5b58\u5728Key\u5df2\u8fc7\u671f\u4f46\u672a\u88ab\u53ca\u65f6\u5220\u9664\u7684\u60c5\u5f62\uff0c\u6240\u4ee5\u5728\u76ee\u6807\u5e93\u4e2d\u67e5\u770b\uff08\u5982\u901a\u8fc7info\u547d\u4ee4\uff09\u5230\u7684Key\u6570\u91cf\u4f1a\u6bd4\u6e90\u5e93\u7684Key\u6570\u91cf\u5c11\u3002 \u8bf4\u660e\uff1a\u6e90\u548c\u76ee\u6807\u5e93\u4e2d\uff0c\u672a\u8bbe\u7f6e\u8fc7\u671f\u673a\u5236\u6216\u672a\u8fc7\u671f\u7684Key\u6570\u91cf\u662f\u4e00\u81f4\u7684\u3002","title":"3-5 \u6ce8\u610f\u4e8b\u9879"},{"location":"chap8/7redis_shake/#4-redis-shake","text":"# \u4e0b\u8f7d Redis-shake \u5b89\u88c5\u5305 $ wget 'http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/attach/120287/cn_zh/1608173646665/redis-shake-v2.0.3.tar.gz' # \u89e3\u538bRedis-shake \u5b89\u88c5\u5305 $ tar xzf redis-shake-v2.0.3.tar.gz # \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 $ cd redis-shake-v2.0.3/ $ vim redis-shake.conf # \u542f\u52a8Redis-shake\uff0c\u5f00\u59cb\u6267\u884c\u6570\u636e\u8fc1\u79fb $ ./redis-shake.linux -type=sync -conf=redis-shake.conf","title":"4\u3001\u5b89\u88c5 Redis-shake"},{"location":"chap8/8redis_keys/","text":"\u7b2c\u516d\u8282 Redis\u5982\u4f55\u5220\u9664\u6570\u91cf\u8fc7\u4e07\u4ee5\u4e0aKey\u800c\u4e0d\u5f71\u54cd\u4e1a\u52a1 1\u3001\u9700\u6c42 \u6709\u65f6\u5019\u56e0\u4e3a Redis Key \u6ca1\u6709\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u6216\u8005\u56e0\u4e3a\u4e1a\u52a1\u9700\u6c42\u6216\u8005Redis\u5185\u5b58\u4e0d\u8db3\u6216\u8005\u4fee\u6539Redis Key\u503c\u7b49\u9700\u6c42\uff0c\u5e76\u4e14\u8fd9\u4e9bKey\u662f\u6709\u89c4\u5f8b\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7\u6b63\u5219\u8868\u8fbe\u5f0f\u6765\u5339\u914d\u3002 2\u3001\u89e3\u51b3\u65b9\u6cd5\u4e00 \u4e00\u822c\u901a\u8fc7\u7f51\u4e0a\u641c\u7d22\uff0c\u4f1a\u544a\u8bc9\u4f60\u4f7f\u7528\u4e0b\u9762\u65b9\u6cd5\uff0cRedis \u63d0\u4f9b\u4e86\u4e00\u4e2a\u7b80\u5355\u66b4\u529b\u7684\u6307\u4ee4 keys \u7528\u6765\u5217\u51fa\u6240\u6709\u6ee1\u8db3\u7279\u5b9a\u6b63\u5219\u5b57\u7b26\u4e32\u89c4\u5219\u7684 key\u3002 $ redis-cli --raw keys \"testkey-*\" | xargs redis-cli del \u901a\u8fc7 Redis keys \u6765\u5339\u914d\u4f60\u9700\u8981\u5220\u9664\u7684key\uff0c\u518d\u4f7f\u7528 xargs \u628a\u7ed3\u679c\u4f20\u7ed9 redis-cli del \uff0c\u8fd9\u6837\u770b\u4f3c\u5b8c\u7f8e\uff0c\u5b9e\u5219\u6709\u5f88\u5927\u98ce\u9669\u3002 \u4e0a\u9762\u547d\u4ee4\u4f7f\u7528\u975e\u5e38\u7b80\u5355\uff0c\u63d0\u4f9b\u4e00\u4e2a\u7b80\u5355\u7684\u6b63\u5219\u5b57\u7b26\u4e32\u5373\u53ef\uff0c\u4f46\u662f\u6709\u5f88\u660e\u663e\u7684\u4e24\u4e2a\u7f3a\u70b9\u3002 \u6ca1\u6709 offset\u3001limit \u53c2\u6570\uff0c\u4e00\u6b21\u6027\u5410\u51fa\u6240\u6709\u6ee1\u8db3\u6761\u4ef6\u7684 key\uff0c\u4e07\u4e00\u5b9e\u4f8b\u4e2d\u6709\u51e0\u767e w \u4e2a key \u6ee1\u8db3\u6761\u4ef6\uff0c\u5f53\u4f60\u770b\u5230\u6ee1\u5c4f\u7684\u5b57\u7b26\u4e32\u5237\u7684\u6ca1\u6709\u5c3d\u5934\u65f6\uff0c\u4f60\u5c31\u77e5\u9053\u96be\u53d7\u4e86\u3002 keys \u7b97\u6cd5\u662f\u904d\u5386\u7b97\u6cd5\uff0c\u590d\u6742\u5ea6\u662f O(n) \uff0c\u5982\u679c\u5b9e\u4f8b\u4e2d\u6709\u5343\u4e07\u7ea7\u4ee5\u4e0a\u7684 key\uff0c\u8fd9\u4e2a\u6307\u4ee4\u5c31\u4f1a\u5bfc\u81f4 Redis \u670d\u52a1\u5361\u987f\uff0c\u6240\u6709\u8bfb\u5199 Redis \u7684\u5176\u5b83\u7684\u6307\u4ee4\u90fd\u4f1a\u88ab\u5ef6\u540e\u751a\u81f3\u4f1a\u8d85\u65f6\u62a5\u9519\uff0c \u56e0\u4e3a Redis 6 \u7248\u672c\u4ee5\u4e0b\u90fd\u662f\u5355\u7ebf\u7a0b\u7a0b\u5e8f \uff0c\u987a\u5e8f\u6267\u884c\u6240\u6709\u6307\u4ee4\uff0c\u5176\u5b83\u6307\u4ee4\u5fc5\u987b\u7b49\u5230\u5f53\u524d\u7684 keys \u6307\u4ee4\u6267\u884c\u5b8c\u4e86\u624d\u53ef\u4ee5\u7ee7\u7eed\uff0c\u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\u4e1a\u52a1\u4e0d\u53ef\u7528\uff0c\u751a\u81f3\u9020\u6210 redis \u5b95\u673a\u7684\u98ce\u9669\u3002 \u6ce8\u610f\uff1a\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u63a8\u8350\uff0c\u5efa\u8bae\u751f\u4ea7\u73af\u5883\u5c4f\u853dkeys\u547d\u4ee4\u3002\u90a3\u5927\u5bb6\u4f1a\u95ee\uff0c\u6709\u6ca1\u6709\u66f4\u597d\u7684\u65b9\u6cd5\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff1f\u7b54\u6848\u662f\u5f53\u7136\u7528\uff0c\u8bf7\u63a5\u7740\u770b\u4e0b\u6587\u3002 3\u3001\u89e3\u51b3\u65b9\u6cd5\u4e8c Redis\u4ece2.8\u7248\u672c\u5f00\u59cb\u652f\u6301 scan \u547d\u4ee4\uff0cSCAN\u547d\u4ee4\u7684\u57fa\u672c\u7528\u6cd5\u5982\u4e0b\uff1a SCAN cursor [MATCH pattern] [COUNT count] cursor \uff1a\u6e38\u6807\uff0cSCAN\u547d\u4ee4\u662f\u4e00\u4e2a\u57fa\u4e8e\u6e38\u6807\u7684\u8fed\u4ee3\u5668\uff0cSCAN\u547d\u4ee4\u6bcf\u6b21\u88ab\u8c03\u7528\u4e4b\u540e\uff0c\u90fd\u4f1a\u5411\u7528\u6237\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u6e38\u6807\uff0c\u7528\u6237\u5728\u4e0b\u6b21\u8fed\u4ee3\u65f6\u9700\u8981\u4f7f\u7528\u8fd9\u4e2a\u65b0\u6e38\u6807\u4f5c\u4e3aSCAN\u547d\u4ee4\u7684\u6e38\u6807\u53c2\u6570\uff0c\u4ee5\u6b64\u6765\u5ef6\u7eed\u4e4b\u524d\u7684\u8fed\u4ee3\u8fc7\u7a0b\uff0c\u76f4\u5230\u670d\u52a1\u5668\u5411\u7528\u6237\u8fd4\u56de\u503c\u4e3a0\u7684\u6e38\u6807\u65f6\uff0c\u4e00\u6b21\u5b8c\u6574\u7684\u904d\u5386\u8fc7\u7a0b\u5c31\u7ed3\u675f\u4e86\u3002 MATCH \uff1a\u5339\u914d\u89c4\u5219\uff0c\u4f8b\u5982\u904d\u5386\u4ee5 testkey- \u5f00\u5934\u7684\u6240\u6709key\u53ef\u4ee5\u5199\u6210 testkey-* \u3002 COUNT \uff1a COUNT \u9009\u9879\u7684\u4f5c\u7528\u5c31\u662f\u8ba9\u7528\u6237\u544a\u77e5\u8fed\u4ee3\u547d\u4ee4\uff0c\u5728\u6bcf\u6b21\u8fed\u4ee3\u4e2d\u5e94\u8be5\u4ece\u6570\u636e\u96c6\u91cc\u8fd4\u56de\u591a\u5c11\u5143\u7d20\uff0cCOUNT\u53ea\u662f\u5bf9\u589e\u91cf\u5f0f\u8fed\u4ee3\u547d\u4ee4\u7684\u4e00\u79cd\u63d0\u793a\uff0c\u5e76\u4e0d\u4ee3\u8868\u771f\u6b63\u8fd4\u56de\u7684\u6570\u91cf\uff0c\u4f8b\u5982\u4f60COUNT\u8bbe\u7f6e\u4e3a2\u6709\u53ef\u80fd\u4f1a\u8fd4\u56de3\u4e2a\u5143\u7d20\uff0c\u4f46\u8fd4\u56de\u7684\u5143\u7d20\u6570\u636e\u4f1a\u4e0eCOUNT\u8bbe\u7f6e\u7684\u6b63\u76f8\u5173\uff0c COUNT \u7684\u9ed8\u8ba4\u503c\u662f 10 \u3002 \u4f8b\u5b50 $ scan 0 MATCH testkey-* 1) \"34\" 2) 1) \"testkey-2\" 2) \"testkey-49\" 3) \"testkey-20\" 4) \"testkey-19\" 5) \"testkey-93\" 6) \"testkey-8\" 7) \"testkey-34\" 8) \"testkey-76\" 9) \"testkey-13\" 10) \"testkey-18\" 11) \"testkey-10\" $ scan 34 MATCH testkey-* COUNT 1000 1) \"0\" 2) 1) \"ops-coffee-16\" 2) \"ops-coffee-19\" 3) \"ops-coffee-23\" 4) \"ops-coffee-21\" 5) \"ops-coffee-40\" 6) \"ops-coffee-22\" 7) \"ops-coffee-1\" 8) \"ops-coffee-11\" 9) \"ops-coffee-28\" 10) \"ops-coffee-3\" 11) \"ops-coffee-26\" 12) \"ops-coffee-4\" 13) \"ops-coffee-31\" ... scan \u547d\u4ee4\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u5305\u542b\u4e24\u4e2a\u5143\u7d20\u7684\u6570\u7ec4\uff0c\u7b2c\u4e00\u4e2a\u6570\u7ec4\u5143\u7d20\u662f\u7528\u4e8e\u8fdb\u884c\u4e0b\u4e00\u6b21\u8fed\u4ee3\u7684\u65b0\u6e38\u6807\uff0c\u800c\u7b2c\u4e8c\u4e2a\u6570\u7ec4\u5143\u7d20\u5219\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u8fd9\u4e2a\u6570\u7ec4\u4e2d\u5305\u542b\u4e86\u6240\u6709\u88ab\u8fed\u4ee3\u7684\u5143\u7d20\u3002 \u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u7684\u610f\u601d\u662f\u626b\u63cf\u6240\u6709\u524d\u7f00\u4e3a testkey- \u7684key\u3002 \u7b2c\u4e00\u6b21\u8fed\u4ee3\u4f7f\u75280\u4f5c\u4e3a\u6e38\u6807\uff0c\u8868\u793a\u5f00\u59cb\u4e00\u6b21\u65b0\u7684\u8fed\u4ee3\uff0c\u540c\u65f6\u4f7f\u7528\u4e86MATCH\u5339\u914d\u524d\u7f00\u4e3atestkey-\u7684key\uff0c\u8fd4\u56de\u4e86\u6e38\u6807\u503c34\u4ee5\u53ca\u904d\u5386\u5230\u7684\u6570\u636e\u3002 \u7b2c\u4e8c\u6b21\u8fed\u4ee3\u4f7f\u7528\u7684\u662f\u7b2c\u4e00\u6b21\u8fed\u4ee3\u65f6\u8fd4\u56de\u7684\u6e38\u6807\uff0c\u4e5f\u5373\u662f\u547d\u4ee4\u56de\u590d\u7b2c\u4e00\u4e2a\u5143\u7d20\u7684\u503c34\uff0c\u540c\u65f6\u901a\u8fc7\u5c06COUNT\u9009\u9879\u7684\u53c2\u6570\u8bbe\u7f6e\u4e3a1000\uff0c\u5f3a\u5236\u547d\u4ee4\u4e3a\u672c\u6b21\u8fed\u4ee3\u626b\u63cf\u66f4\u591a\u5143\u7d20\u3002\u5728\u7b2c\u4e8c\u6b21\u8c03\u7528SCAN\u547d\u4ee4\u65f6\uff0c\u547d\u4ee4\u8fd4\u56de\u4e86\u6e38\u68070\uff0c\u8fd9\u8868\u793a\u8fed\u4ee3\u5df2\u7ecf\u7ed3\u675f\uff0c\u6574\u4e2a\u6570\u636e\u96c6\u5df2\u7ecf\u88ab\u5b8c\u6574\u904d\u5386\u8fc7\u4e86\u3002 Redis scan \u547d\u4ee4\u5c31\u662f\u57fa\u4e8e\u6e38\u6807\u7684\u8fed\u4ee3\u5668\uff0c\u610f\u5473\u7740\u547d\u4ee4\u6bcf\u6b21\u88ab\u8c03\u7528\u90fd\u9700\u8981\u4f7f\u7528\u4e0a\u4e00\u6b21\u8fd9\u4e2a\u8c03\u7528\u8fd4\u56de\u7684\u6e38\u6807\u4f5c\u4e3a\u8be5\u6b21\u8c03\u7528\u7684\u6e38\u6807\u53c2\u6570\uff0c\u4ee5\u6b64\u6765\u5ef6\u7eed\u4e4b\u524d\u7684\u8fed\u4ee3\u8fc7\u7a0b\u3002\u5f53SCAN\u547d\u4ee4\u7684\u6e38\u6807\u53c2\u6570\u88ab\u8bbe\u7f6e\u4e3a0\u65f6\uff0c\u670d\u52a1\u5668\u5c06\u5f00\u59cb\u4e00\u6b21\u65b0\u7684\u8fed\u4ee3\uff0c\u800c\u5f53redis\u670d\u52a1\u5668\u5411\u7528\u6237\u8fd4\u56de\u503c\u4e3a0\u7684\u6e38\u6807\u65f6\uff0c\u8868\u793a\u8fed\u4ee3\u5df2\u7ed3\u675f\uff0c\u8fd9\u662f\u552f\u4e00\u8fed\u4ee3\u7ed3\u675f\u7684\u5224\u5b9a\u65b9\u5f0f\uff0c\u800c\u4e0d\u80fd\u901a\u8fc7\u8fd4\u56de\u7ed3\u679c\u96c6\u662f\u5426\u4e3a\u7a7a\u5224\u65ad\u8fed\u4ee3\u7ed3\u675f\u3002 \u4e0a\u9762\u7684\u9700\u6c42\uff0c\u6700\u7ec8\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\u6765\u89e3\u51b3\uff1a $ redis-cli --scan --pattern \"testkey-*\" | xargs -L 1000 redis-cli del xargs -L \u6307\u4ee4\u8868\u793axargs\u4e00\u6b21\u8bfb\u53d6\u7684\u884c\u6570\uff0c\u4e5f\u5c31\u662f\u6bcf\u6b21\u5220\u9664key\u7684\u6570\u91cf\uff0c\u4e0d\u8981\u4e00\u6b21\u884c\u8bfb\u53d6\u592a\u591a\u6570\u91cfkey\u3002 4\u3001scan \u4e0e keys \u6bd4\u8f83 scan \u76f8\u6bd4 keys \u5177\u5907\u6709\u4ee5\u4e0b\u7279\u70b9: \u590d\u6742\u5ea6\u867d\u7136\u4e5f\u662f O(n) \uff0c\u4f46\u662f\u5b83\u662f\u901a\u8fc7\u6e38\u6807\u5206\u6b65\u8fdb\u884c\u7684\uff0c\u4e0d\u4f1a\u963b\u585e\u7ebf\u7a0b\u3002 \u63d0\u4f9b limit \u53c2\u6570\uff0c\u53ef\u4ee5\u63a7\u5236\u6bcf\u6b21\u8fd4\u56de\u7ed3\u679c\u7684\u6700\u5927\u6761\u6570\uff0c limit \u53ea\u662f\u5bf9\u589e\u91cf\u5f0f\u8fed\u4ee3\u547d\u4ee4\u7684\u4e00\u79cd\u63d0\u793a(hint)\uff0c\u8fd4\u56de\u7684\u7ed3\u679c\u53ef\u591a\u53ef\u5c11\u3002 \u540c keys \u4e00\u6837\uff0c\u5b83\u4e5f\u63d0\u4f9b\u6a21\u5f0f\u5339\u914d\u529f\u80fd\u3002 \u670d\u52a1\u5668\u4e0d\u9700\u8981\u4e3a\u6e38\u6807\u4fdd\u5b58\u72b6\u6001\uff0c\u6e38\u6807\u7684\u552f\u4e00\u72b6\u6001\u5c31\u662f scan \u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u6e38\u6807\u6574\u6570\u3002 \u8fd4\u56de\u7684\u7ed3\u679c\u53ef\u80fd\u4f1a\u6709\u91cd\u590d\uff0c\u9700\u8981\u5ba2\u6237\u7aef\u53bb\u91cd\u590d\uff0c\u8fd9\u70b9\u975e\u5e38\u91cd\u8981\u3002 \u904d\u5386\u7684\u8fc7\u7a0b\u4e2d\u5982\u679c\u6709\u6570\u636e\u4fee\u6539\uff0c\u6539\u52a8\u540e\u7684\u6570\u636e\u80fd\u4e0d\u80fd\u904d\u5386\u5230\u662f\u4e0d\u786e\u5b9a\u7684\u3002 \u5355\u6b21\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u7a7a\u7684\u5e76\u4e0d\u610f\u5473\u7740\u904d\u5386\u7ed3\u675f\uff0c\u800c\u8981\u770b\u8fd4\u56de\u7684\u6e38\u6807\u503c\u662f\u5426\u4e3a\u96f6\u3002 5\u3001\u672c\u8282\u5c0f\u7ed3 Redis \u7c7b\u4f3c scan \u547d\u4ee4\u8fd8\u6709\u5f88\u591a\uff0c\u6bd4\u5982\uff1a scan \u6307\u4ee4\u662f\u4e00\u7cfb\u5217\u6307\u4ee4\uff0c\u9664\u4e86\u53ef\u4ee5\u904d\u5386\u6240\u6709\u7684 key \u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u5bf9\u6307\u5b9a\u7684\u5bb9\u5668\u96c6\u5408\u8fdb\u884c\u904d\u5386 zscan \u904d\u5386 zset \u96c6\u5408\u5143\u7d20 hscan \u904d\u5386 hash \u5b57\u5178\u7684\u5143\u7d20 sscan \u904d\u5386 set \u96c6\u5408\u7684 \u6ce8\u610f\uff1aSSCAN \u547d\u4ee4\u3001 HSCAN \u547d\u4ee4\u548c ZSCAN \u547d\u4ee4\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u603b\u662f\u4e00\u4e2a\u6570\u636e\u5e93\u952e\u3002\u800c SCAN \u547d\u4ee4\u5219\u4e0d\u9700\u8981\u5728\u7b2c\u4e00\u4e2a\u53c2\u6570\u63d0\u4f9b\u4efb\u4f55\u6570\u636e\u5e93\u952e\uff0c\u56e0\u4e3a\u5b83\u8fed\u4ee3\u7684\u662f\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u6570\u636e\u5e93\u952e\u3002","title":"\u7b2c\u516d\u8282 Redis\u5982\u4f55\u5220\u9664\u6570\u91cf\u8fc7\u4e07\u4ee5\u4e0aKey\u800c\u4e0d\u5f71\u54cd\u4e1a\u52a1"},{"location":"chap8/8redis_keys/#rediskey","text":"","title":"\u7b2c\u516d\u8282 Redis\u5982\u4f55\u5220\u9664\u6570\u91cf\u8fc7\u4e07\u4ee5\u4e0aKey\u800c\u4e0d\u5f71\u54cd\u4e1a\u52a1"},{"location":"chap8/8redis_keys/#1","text":"\u6709\u65f6\u5019\u56e0\u4e3a Redis Key \u6ca1\u6709\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u6216\u8005\u56e0\u4e3a\u4e1a\u52a1\u9700\u6c42\u6216\u8005Redis\u5185\u5b58\u4e0d\u8db3\u6216\u8005\u4fee\u6539Redis Key\u503c\u7b49\u9700\u6c42\uff0c\u5e76\u4e14\u8fd9\u4e9bKey\u662f\u6709\u89c4\u5f8b\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7\u6b63\u5219\u8868\u8fbe\u5f0f\u6765\u5339\u914d\u3002","title":"1\u3001\u9700\u6c42"},{"location":"chap8/8redis_keys/#2","text":"\u4e00\u822c\u901a\u8fc7\u7f51\u4e0a\u641c\u7d22\uff0c\u4f1a\u544a\u8bc9\u4f60\u4f7f\u7528\u4e0b\u9762\u65b9\u6cd5\uff0cRedis \u63d0\u4f9b\u4e86\u4e00\u4e2a\u7b80\u5355\u66b4\u529b\u7684\u6307\u4ee4 keys \u7528\u6765\u5217\u51fa\u6240\u6709\u6ee1\u8db3\u7279\u5b9a\u6b63\u5219\u5b57\u7b26\u4e32\u89c4\u5219\u7684 key\u3002 $ redis-cli --raw keys \"testkey-*\" | xargs redis-cli del \u901a\u8fc7 Redis keys \u6765\u5339\u914d\u4f60\u9700\u8981\u5220\u9664\u7684key\uff0c\u518d\u4f7f\u7528 xargs \u628a\u7ed3\u679c\u4f20\u7ed9 redis-cli del \uff0c\u8fd9\u6837\u770b\u4f3c\u5b8c\u7f8e\uff0c\u5b9e\u5219\u6709\u5f88\u5927\u98ce\u9669\u3002 \u4e0a\u9762\u547d\u4ee4\u4f7f\u7528\u975e\u5e38\u7b80\u5355\uff0c\u63d0\u4f9b\u4e00\u4e2a\u7b80\u5355\u7684\u6b63\u5219\u5b57\u7b26\u4e32\u5373\u53ef\uff0c\u4f46\u662f\u6709\u5f88\u660e\u663e\u7684\u4e24\u4e2a\u7f3a\u70b9\u3002 \u6ca1\u6709 offset\u3001limit \u53c2\u6570\uff0c\u4e00\u6b21\u6027\u5410\u51fa\u6240\u6709\u6ee1\u8db3\u6761\u4ef6\u7684 key\uff0c\u4e07\u4e00\u5b9e\u4f8b\u4e2d\u6709\u51e0\u767e w \u4e2a key \u6ee1\u8db3\u6761\u4ef6\uff0c\u5f53\u4f60\u770b\u5230\u6ee1\u5c4f\u7684\u5b57\u7b26\u4e32\u5237\u7684\u6ca1\u6709\u5c3d\u5934\u65f6\uff0c\u4f60\u5c31\u77e5\u9053\u96be\u53d7\u4e86\u3002 keys \u7b97\u6cd5\u662f\u904d\u5386\u7b97\u6cd5\uff0c\u590d\u6742\u5ea6\u662f O(n) \uff0c\u5982\u679c\u5b9e\u4f8b\u4e2d\u6709\u5343\u4e07\u7ea7\u4ee5\u4e0a\u7684 key\uff0c\u8fd9\u4e2a\u6307\u4ee4\u5c31\u4f1a\u5bfc\u81f4 Redis \u670d\u52a1\u5361\u987f\uff0c\u6240\u6709\u8bfb\u5199 Redis \u7684\u5176\u5b83\u7684\u6307\u4ee4\u90fd\u4f1a\u88ab\u5ef6\u540e\u751a\u81f3\u4f1a\u8d85\u65f6\u62a5\u9519\uff0c \u56e0\u4e3a Redis 6 \u7248\u672c\u4ee5\u4e0b\u90fd\u662f\u5355\u7ebf\u7a0b\u7a0b\u5e8f \uff0c\u987a\u5e8f\u6267\u884c\u6240\u6709\u6307\u4ee4\uff0c\u5176\u5b83\u6307\u4ee4\u5fc5\u987b\u7b49\u5230\u5f53\u524d\u7684 keys \u6307\u4ee4\u6267\u884c\u5b8c\u4e86\u624d\u53ef\u4ee5\u7ee7\u7eed\uff0c\u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\u4e1a\u52a1\u4e0d\u53ef\u7528\uff0c\u751a\u81f3\u9020\u6210 redis \u5b95\u673a\u7684\u98ce\u9669\u3002 \u6ce8\u610f\uff1a\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u63a8\u8350\uff0c\u5efa\u8bae\u751f\u4ea7\u73af\u5883\u5c4f\u853dkeys\u547d\u4ee4\u3002\u90a3\u5927\u5bb6\u4f1a\u95ee\uff0c\u6709\u6ca1\u6709\u66f4\u597d\u7684\u65b9\u6cd5\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff1f\u7b54\u6848\u662f\u5f53\u7136\u7528\uff0c\u8bf7\u63a5\u7740\u770b\u4e0b\u6587\u3002","title":"2\u3001\u89e3\u51b3\u65b9\u6cd5\u4e00"},{"location":"chap8/8redis_keys/#3","text":"Redis\u4ece2.8\u7248\u672c\u5f00\u59cb\u652f\u6301 scan \u547d\u4ee4\uff0cSCAN\u547d\u4ee4\u7684\u57fa\u672c\u7528\u6cd5\u5982\u4e0b\uff1a SCAN cursor [MATCH pattern] [COUNT count] cursor \uff1a\u6e38\u6807\uff0cSCAN\u547d\u4ee4\u662f\u4e00\u4e2a\u57fa\u4e8e\u6e38\u6807\u7684\u8fed\u4ee3\u5668\uff0cSCAN\u547d\u4ee4\u6bcf\u6b21\u88ab\u8c03\u7528\u4e4b\u540e\uff0c\u90fd\u4f1a\u5411\u7528\u6237\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u6e38\u6807\uff0c\u7528\u6237\u5728\u4e0b\u6b21\u8fed\u4ee3\u65f6\u9700\u8981\u4f7f\u7528\u8fd9\u4e2a\u65b0\u6e38\u6807\u4f5c\u4e3aSCAN\u547d\u4ee4\u7684\u6e38\u6807\u53c2\u6570\uff0c\u4ee5\u6b64\u6765\u5ef6\u7eed\u4e4b\u524d\u7684\u8fed\u4ee3\u8fc7\u7a0b\uff0c\u76f4\u5230\u670d\u52a1\u5668\u5411\u7528\u6237\u8fd4\u56de\u503c\u4e3a0\u7684\u6e38\u6807\u65f6\uff0c\u4e00\u6b21\u5b8c\u6574\u7684\u904d\u5386\u8fc7\u7a0b\u5c31\u7ed3\u675f\u4e86\u3002 MATCH \uff1a\u5339\u914d\u89c4\u5219\uff0c\u4f8b\u5982\u904d\u5386\u4ee5 testkey- \u5f00\u5934\u7684\u6240\u6709key\u53ef\u4ee5\u5199\u6210 testkey-* \u3002 COUNT \uff1a COUNT \u9009\u9879\u7684\u4f5c\u7528\u5c31\u662f\u8ba9\u7528\u6237\u544a\u77e5\u8fed\u4ee3\u547d\u4ee4\uff0c\u5728\u6bcf\u6b21\u8fed\u4ee3\u4e2d\u5e94\u8be5\u4ece\u6570\u636e\u96c6\u91cc\u8fd4\u56de\u591a\u5c11\u5143\u7d20\uff0cCOUNT\u53ea\u662f\u5bf9\u589e\u91cf\u5f0f\u8fed\u4ee3\u547d\u4ee4\u7684\u4e00\u79cd\u63d0\u793a\uff0c\u5e76\u4e0d\u4ee3\u8868\u771f\u6b63\u8fd4\u56de\u7684\u6570\u91cf\uff0c\u4f8b\u5982\u4f60COUNT\u8bbe\u7f6e\u4e3a2\u6709\u53ef\u80fd\u4f1a\u8fd4\u56de3\u4e2a\u5143\u7d20\uff0c\u4f46\u8fd4\u56de\u7684\u5143\u7d20\u6570\u636e\u4f1a\u4e0eCOUNT\u8bbe\u7f6e\u7684\u6b63\u76f8\u5173\uff0c COUNT \u7684\u9ed8\u8ba4\u503c\u662f 10 \u3002 \u4f8b\u5b50 $ scan 0 MATCH testkey-* 1) \"34\" 2) 1) \"testkey-2\" 2) \"testkey-49\" 3) \"testkey-20\" 4) \"testkey-19\" 5) \"testkey-93\" 6) \"testkey-8\" 7) \"testkey-34\" 8) \"testkey-76\" 9) \"testkey-13\" 10) \"testkey-18\" 11) \"testkey-10\" $ scan 34 MATCH testkey-* COUNT 1000 1) \"0\" 2) 1) \"ops-coffee-16\" 2) \"ops-coffee-19\" 3) \"ops-coffee-23\" 4) \"ops-coffee-21\" 5) \"ops-coffee-40\" 6) \"ops-coffee-22\" 7) \"ops-coffee-1\" 8) \"ops-coffee-11\" 9) \"ops-coffee-28\" 10) \"ops-coffee-3\" 11) \"ops-coffee-26\" 12) \"ops-coffee-4\" 13) \"ops-coffee-31\" ... scan \u547d\u4ee4\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u5305\u542b\u4e24\u4e2a\u5143\u7d20\u7684\u6570\u7ec4\uff0c\u7b2c\u4e00\u4e2a\u6570\u7ec4\u5143\u7d20\u662f\u7528\u4e8e\u8fdb\u884c\u4e0b\u4e00\u6b21\u8fed\u4ee3\u7684\u65b0\u6e38\u6807\uff0c\u800c\u7b2c\u4e8c\u4e2a\u6570\u7ec4\u5143\u7d20\u5219\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u8fd9\u4e2a\u6570\u7ec4\u4e2d\u5305\u542b\u4e86\u6240\u6709\u88ab\u8fed\u4ee3\u7684\u5143\u7d20\u3002 \u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u7684\u610f\u601d\u662f\u626b\u63cf\u6240\u6709\u524d\u7f00\u4e3a testkey- \u7684key\u3002 \u7b2c\u4e00\u6b21\u8fed\u4ee3\u4f7f\u75280\u4f5c\u4e3a\u6e38\u6807\uff0c\u8868\u793a\u5f00\u59cb\u4e00\u6b21\u65b0\u7684\u8fed\u4ee3\uff0c\u540c\u65f6\u4f7f\u7528\u4e86MATCH\u5339\u914d\u524d\u7f00\u4e3atestkey-\u7684key\uff0c\u8fd4\u56de\u4e86\u6e38\u6807\u503c34\u4ee5\u53ca\u904d\u5386\u5230\u7684\u6570\u636e\u3002 \u7b2c\u4e8c\u6b21\u8fed\u4ee3\u4f7f\u7528\u7684\u662f\u7b2c\u4e00\u6b21\u8fed\u4ee3\u65f6\u8fd4\u56de\u7684\u6e38\u6807\uff0c\u4e5f\u5373\u662f\u547d\u4ee4\u56de\u590d\u7b2c\u4e00\u4e2a\u5143\u7d20\u7684\u503c34\uff0c\u540c\u65f6\u901a\u8fc7\u5c06COUNT\u9009\u9879\u7684\u53c2\u6570\u8bbe\u7f6e\u4e3a1000\uff0c\u5f3a\u5236\u547d\u4ee4\u4e3a\u672c\u6b21\u8fed\u4ee3\u626b\u63cf\u66f4\u591a\u5143\u7d20\u3002\u5728\u7b2c\u4e8c\u6b21\u8c03\u7528SCAN\u547d\u4ee4\u65f6\uff0c\u547d\u4ee4\u8fd4\u56de\u4e86\u6e38\u68070\uff0c\u8fd9\u8868\u793a\u8fed\u4ee3\u5df2\u7ecf\u7ed3\u675f\uff0c\u6574\u4e2a\u6570\u636e\u96c6\u5df2\u7ecf\u88ab\u5b8c\u6574\u904d\u5386\u8fc7\u4e86\u3002 Redis scan \u547d\u4ee4\u5c31\u662f\u57fa\u4e8e\u6e38\u6807\u7684\u8fed\u4ee3\u5668\uff0c\u610f\u5473\u7740\u547d\u4ee4\u6bcf\u6b21\u88ab\u8c03\u7528\u90fd\u9700\u8981\u4f7f\u7528\u4e0a\u4e00\u6b21\u8fd9\u4e2a\u8c03\u7528\u8fd4\u56de\u7684\u6e38\u6807\u4f5c\u4e3a\u8be5\u6b21\u8c03\u7528\u7684\u6e38\u6807\u53c2\u6570\uff0c\u4ee5\u6b64\u6765\u5ef6\u7eed\u4e4b\u524d\u7684\u8fed\u4ee3\u8fc7\u7a0b\u3002\u5f53SCAN\u547d\u4ee4\u7684\u6e38\u6807\u53c2\u6570\u88ab\u8bbe\u7f6e\u4e3a0\u65f6\uff0c\u670d\u52a1\u5668\u5c06\u5f00\u59cb\u4e00\u6b21\u65b0\u7684\u8fed\u4ee3\uff0c\u800c\u5f53redis\u670d\u52a1\u5668\u5411\u7528\u6237\u8fd4\u56de\u503c\u4e3a0\u7684\u6e38\u6807\u65f6\uff0c\u8868\u793a\u8fed\u4ee3\u5df2\u7ed3\u675f\uff0c\u8fd9\u662f\u552f\u4e00\u8fed\u4ee3\u7ed3\u675f\u7684\u5224\u5b9a\u65b9\u5f0f\uff0c\u800c\u4e0d\u80fd\u901a\u8fc7\u8fd4\u56de\u7ed3\u679c\u96c6\u662f\u5426\u4e3a\u7a7a\u5224\u65ad\u8fed\u4ee3\u7ed3\u675f\u3002 \u4e0a\u9762\u7684\u9700\u6c42\uff0c\u6700\u7ec8\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\u6765\u89e3\u51b3\uff1a $ redis-cli --scan --pattern \"testkey-*\" | xargs -L 1000 redis-cli del xargs -L \u6307\u4ee4\u8868\u793axargs\u4e00\u6b21\u8bfb\u53d6\u7684\u884c\u6570\uff0c\u4e5f\u5c31\u662f\u6bcf\u6b21\u5220\u9664key\u7684\u6570\u91cf\uff0c\u4e0d\u8981\u4e00\u6b21\u884c\u8bfb\u53d6\u592a\u591a\u6570\u91cfkey\u3002","title":"3\u3001\u89e3\u51b3\u65b9\u6cd5\u4e8c"},{"location":"chap8/8redis_keys/#4scan-keys","text":"scan \u76f8\u6bd4 keys \u5177\u5907\u6709\u4ee5\u4e0b\u7279\u70b9: \u590d\u6742\u5ea6\u867d\u7136\u4e5f\u662f O(n) \uff0c\u4f46\u662f\u5b83\u662f\u901a\u8fc7\u6e38\u6807\u5206\u6b65\u8fdb\u884c\u7684\uff0c\u4e0d\u4f1a\u963b\u585e\u7ebf\u7a0b\u3002 \u63d0\u4f9b limit \u53c2\u6570\uff0c\u53ef\u4ee5\u63a7\u5236\u6bcf\u6b21\u8fd4\u56de\u7ed3\u679c\u7684\u6700\u5927\u6761\u6570\uff0c limit \u53ea\u662f\u5bf9\u589e\u91cf\u5f0f\u8fed\u4ee3\u547d\u4ee4\u7684\u4e00\u79cd\u63d0\u793a(hint)\uff0c\u8fd4\u56de\u7684\u7ed3\u679c\u53ef\u591a\u53ef\u5c11\u3002 \u540c keys \u4e00\u6837\uff0c\u5b83\u4e5f\u63d0\u4f9b\u6a21\u5f0f\u5339\u914d\u529f\u80fd\u3002 \u670d\u52a1\u5668\u4e0d\u9700\u8981\u4e3a\u6e38\u6807\u4fdd\u5b58\u72b6\u6001\uff0c\u6e38\u6807\u7684\u552f\u4e00\u72b6\u6001\u5c31\u662f scan \u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u6e38\u6807\u6574\u6570\u3002 \u8fd4\u56de\u7684\u7ed3\u679c\u53ef\u80fd\u4f1a\u6709\u91cd\u590d\uff0c\u9700\u8981\u5ba2\u6237\u7aef\u53bb\u91cd\u590d\uff0c\u8fd9\u70b9\u975e\u5e38\u91cd\u8981\u3002 \u904d\u5386\u7684\u8fc7\u7a0b\u4e2d\u5982\u679c\u6709\u6570\u636e\u4fee\u6539\uff0c\u6539\u52a8\u540e\u7684\u6570\u636e\u80fd\u4e0d\u80fd\u904d\u5386\u5230\u662f\u4e0d\u786e\u5b9a\u7684\u3002 \u5355\u6b21\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u7a7a\u7684\u5e76\u4e0d\u610f\u5473\u7740\u904d\u5386\u7ed3\u675f\uff0c\u800c\u8981\u770b\u8fd4\u56de\u7684\u6e38\u6807\u503c\u662f\u5426\u4e3a\u96f6\u3002","title":"4\u3001scan \u4e0e keys \u6bd4\u8f83"},{"location":"chap8/8redis_keys/#5","text":"Redis \u7c7b\u4f3c scan \u547d\u4ee4\u8fd8\u6709\u5f88\u591a\uff0c\u6bd4\u5982\uff1a scan \u6307\u4ee4\u662f\u4e00\u7cfb\u5217\u6307\u4ee4\uff0c\u9664\u4e86\u53ef\u4ee5\u904d\u5386\u6240\u6709\u7684 key \u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u5bf9\u6307\u5b9a\u7684\u5bb9\u5668\u96c6\u5408\u8fdb\u884c\u904d\u5386 zscan \u904d\u5386 zset \u96c6\u5408\u5143\u7d20 hscan \u904d\u5386 hash \u5b57\u5178\u7684\u5143\u7d20 sscan \u904d\u5386 set \u96c6\u5408\u7684 \u6ce8\u610f\uff1aSSCAN \u547d\u4ee4\u3001 HSCAN \u547d\u4ee4\u548c ZSCAN \u547d\u4ee4\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u603b\u662f\u4e00\u4e2a\u6570\u636e\u5e93\u952e\u3002\u800c SCAN \u547d\u4ee4\u5219\u4e0d\u9700\u8981\u5728\u7b2c\u4e00\u4e2a\u53c2\u6570\u63d0\u4f9b\u4efb\u4f55\u6570\u636e\u5e93\u952e\uff0c\u56e0\u4e3a\u5b83\u8fed\u4ee3\u7684\u662f\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u6570\u636e\u5e93\u952e\u3002","title":"5\u3001\u672c\u8282\u5c0f\u7ed3"},{"location":"chap9/1redis_k8s_sts/","text":"\u7b2c\u4e00\u8282 Kubernetes\u4e0a\u901a\u8fc7sts\u6d4b\u8bd5Redis Cluster\u96c6\u7fa4 1\u3001Redis\u4ecb\u7ecd Redis\u4ee3\u8868 Remote Dictionary Server \u662f\u4e00\u79cd\u5f00\u6e90\u7684\u5185\u5b58\u4e2d\u6570\u636e\u5b58\u50a8\uff0c\u901a\u5e38\u7528\u4f5c\u6570\u636e\u5e93\uff0c\u7f13\u5b58\u6216\u6d88\u606f\u4ee3\u7406\u3002\u5b83\u53ef\u4ee5\u5b58\u50a8\u548c\u64cd\u4f5c\u9ad8\u7ea7\u6570\u636e\u7c7b\u578b\uff0c\u4f8b\u5982\u5217\u8868\uff0c\u5730\u56fe\uff0c\u96c6\u5408\u548c\u6392\u5e8f\u96c6\u5408\u3002\u7531\u4e8eRedis\u63a5\u53d7\u591a\u79cd\u683c\u5f0f\u7684\u5bc6\u94a5\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728\u670d\u52a1\u5668\u4e0a\u6267\u884c\u64cd\u4f5c\uff0c\u4ece\u800c\u51cf\u5c11\u4e86\u5ba2\u6237\u7aef\u7684\u5de5\u4f5c\u91cf\u3002\u5b83\u4ec5\u5c06\u78c1\u76d8\u7528\u4e8e\u6301\u4e45\u6027\uff0c\u800c\u5c06\u6570\u636e\u5e93\u5b8c\u5168\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u3002Redis\u662f\u4e00\u79cd\u6d41\u884c\u7684\u6570\u636e\u5b58\u50a8\u89e3\u51b3\u65b9\u6848\uff0c\u5e76\u88ab GitHub\uff0cPinterest\uff0cSnapchat\uff0cTwitter\uff0cStackOverflow\uff0cFlickr \u7b49\u6280\u672f\u5de8\u5934\u6240\u4f7f\u7528\u3002 2\u3001\u4e3a\u4ec0\u4e48\u4f7f\u7528Redis \u5b83\u7684\u901f\u5ea6\u975e\u5e38\u5feb\u3002\u5b83\u662f\u7528ANSI C\u7f16\u5199\u7684\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728POSIX\u7cfb\u7edf\u4e0a\u8fd0\u884c\uff0c\u4f8b\u5982Linux\uff0cMac OS X\u548cSolaris\u3002 Redis\u901a\u5e38\u88ab\u6392\u540d\u4e3a\u6700\u6d41\u884c\u7684\u952e/\u503c\u6570\u636e\u5e93\u548c\u6700\u6d41\u884c\u7684\u4e0e\u5bb9\u5668\u4e00\u8d77\u4f7f\u7528\u7684NoSQL\u6570\u636e\u5e93\u3002 \u5176\u7f13\u5b58\u89e3\u51b3\u65b9\u6848\u51cf\u5c11\u4e86\u5bf9\u4e91\u6570\u636e\u5e93\u540e\u7aef\u7684\u8c03\u7528\u6b21\u6570\u3002 \u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u901a\u8fc7\u5176\u5ba2\u6237\u7aefAPI\u5e93\u5bf9\u5176\u8fdb\u884c\u8bbf\u95ee\u3002 \u6240\u6709\u6d41\u884c\u7684\u7f16\u7a0b\u8bed\u8a00\u90fd\u652f\u6301Redis\u3002 \u5b83\u662f\u5f00\u6e90\u4e14\u7a33\u5b9a\u7684\u3002 3\u3001\u4ec0\u4e48\u662fRedis\u96c6\u7fa4 Redis Cluster \u662f\u4e00\u7ec4Redis\u5b9e\u4f8b\uff0c\u65e8\u5728\u901a\u8fc7\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u5206\u533a\u6765\u6269\u5c55\u6570\u636e\u5e93\uff0c\u4ece\u800c\u4f7f\u5176\u66f4\u5177\u5f39\u6027\u3002 \u7fa4\u96c6\u4e2d\u7684\u6bcf\u4e2a\u6210\u5458\uff08\u65e0\u8bba\u662f\u4e3b\u526f\u672c\u8fd8\u662f\u8f85\u52a9\u526f\u672c\uff09\u90fd\u7ba1\u7406\u54c8\u5e0c\u69fd\u7684\u5b50\u96c6\u3002\u5982\u679c\u4e3b\u673a\u65e0\u6cd5\u8bbf\u95ee\uff0c\u5219\u5176\u4ece\u673a\u5c06\u5347\u7ea7\u4e3a\u4e3b\u673a\u3002 \u5728\u7531\u4e09\u4e2a\u4e3b\u8282\u70b9\u7ec4\u6210\u7684\u6700\u5c0fRedis\u7fa4\u96c6\u4e2d\uff0c\u6bcf\u4e2a\u4e3b\u8282\u70b9\u90fd\u6709\u4e00\u4e2a\u4ece\u8282\u70b9\uff08\u4ee5\u5b9e\u73b0\u6700\u5c0f\u7684\u6545\u969c\u8f6c\u79fb\uff09\uff0c\u6bcf\u4e2a\u4e3b\u8282\u70b9\u90fd\u5206\u914d\u6709\u4e00\u4e2a\u4ecb\u4e8e0\u523016,383\u4e4b\u95f4\u7684\u54c8\u5e0c\u69fd\u8303\u56f4\u3002 \u8282\u70b9A\u5305\u542b\u4ece0\u52305000\u7684\u54c8\u5e0c\u69fd\uff0c\u8282\u70b9B\u4ece5001\u523010000\uff0c\u8282\u70b9C\u4ece10001\u523016383\u3002 \u7fa4\u96c6\u5185\u90e8\u7684\u901a\u4fe1\u662f\u901a\u8fc7\u5185\u90e8\u603b\u7ebf\u8fdb\u884c\u7684\uff0c\u4f7f\u7528\u534f\u8bae\u4f20\u64ad\u6709\u5173\u7fa4\u96c6\u7684\u4fe1\u606f\u6216\u53d1\u73b0\u65b0\u8282\u70b9\u3002 4\u3001\u5728kubernetes\u4e2d\u90e8\u7f72redis\u96c6\u7fa4 \u5728Kubernetes\u4e2d\u90e8\u7f72Redis\u96c6\u7fa4\u9762\u4e34\u6311\u6218\uff0c\u56e0\u4e3a\u6bcf\u4e2aRedis\u5b9e\u4f8b\u90fd\u4f9d\u8d56\u4e8e\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u53ef\u4ee5\u8ddf\u8e2a\u5176\u4ed6\u96c6\u7fa4\u5b9e\u4f8b\u53ca\u5176\u89d2\u8272\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u9700\u8981\u7ed3\u5408\u4f7f\u7528 Kubernetes StatefulSets \u548c PersistentVolumes \u3002 4-1 \u90e8\u7f72Redis\u96c6\u7fa4 \u90e8\u7f72\u53ca\u6d4b\u8bd5\u4ee3\u7801\u6587\u4ef6 \u521b\u5efastatefulset\u7c7b\u578b\u8d44\u6e90 redis-sts.yml --- apiVersion: v1 kind: ConfigMap metadata: name: redis-cluster data: update-node.sh: | #!/bin/sh REDIS_NODES=\"/data/nodes.conf\" sed -i -e \"/myself/ s/[0-9]\\{1,3\\}\\.[0-9]\\{1,3\\}\\.[0-9]\\{1,3\\}\\.[0-9]\\{1,3\\}/${POD_IP}/\" ${REDIS_NODES} exec \"$@\" redis.conf: |+ cluster-enabled yes cluster-require-full-coverage no cluster-node-timeout 15000 cluster-config-file /data/nodes.conf cluster-migration-barrier 1 appendonly yes protected-mode no --- apiVersion: apps/v1 kind: StatefulSet metadata: name: redis-cluster spec: serviceName: redis-cluster replicas: 6 selector: matchLabels: app: redis-cluster template: metadata: labels: app: redis-cluster spec: containers: - name: redis image: redis:5.0.5-alpine ports: - containerPort: 6379 name: client - containerPort: 16379 name: gossip command: [\"/conf/update-node.sh\", \"redis-server\", \"/conf/redis.conf\"] env: - name: POD_IP valueFrom: fieldRef: fieldPath: status.podIP volumeMounts: - name: conf mountPath: /conf readOnly: false - name: data mountPath: /data readOnly: false volumes: - name: conf configMap: name: redis-cluster defaultMode: 0755 volumeClaimTemplates: - metadata: name: data spec: accessModes: [ \"ReadWriteOnce\" ] resources: requests: storage: 5Gi # storageClassName: redis-cluster storageClassName: hostpath cluster-node-timeout 15000 : \u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e86 Redis Cluster \u4e2d\u5b9e\u4f8b\u54cd\u5e94\u5fc3\u8df3\u6d88\u606f\u7684\u8d85\u65f6\u65f6\u95f4\u3002 protected-mode no : \u5f53\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a yes \u65f6\uff0c\u54e8\u5175\u5b9e\u4f8b\u53ea\u80fd\u5728\u90e8\u7f72\u7684\u670d\u52a1\u5668\u672c\u5730\u8fdb\u884c\u8bbf\u95ee\u3002\u5f53\u8bbe\u7f6e\u4e3a no \u65f6\uff0c\u5176\u4ed6\u670d\u52a1\u5668\u4e5f\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e2a\u54e8\u5175\u5b9e\u4f8b\u3002 $ kubectl apply -f redis-sts.yml configmap/redis-cluster created statefulset.apps/redis-cluster created $ kubectl get pods -l app=redis-cluster NAME READY STATUS RESTARTS AGE redis-cluster-0 1/1 Running 0 88m redis-cluster-1 1/1 Running 0 88m redis-cluster-2 1/1 Running 0 174m redis-cluster-3 1/1 Running 0 174m redis-cluster-4 1/1 Running 0 174m redis-cluster-5 1/1 Running 0 174m \u521b\u5efaservice redis-svc.yml --- apiVersion: v1 kind: Service metadata: name: redis-cluster spec: type: ClusterIP clusterIP: 10.96.0.106 ports: - port: 6379 targetPort: 6379 name: client - port: 16379 targetPort: 16379 name: gossip selector: app: redis-cluster $ kubectl apply -f redis-svc.yml service/redis-cluster created $ kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.96.0.1 <none> 443/TCP 7d22h redis-cluster ClusterIP 10.96.0.106 <none> 6379/TCP,16379/TCP 6m9s 4-2 \u521d\u59cb\u5316redis cluster \u4e0b\u4e00\u6b65\u662f\u5f62\u6210Redis\u96c6\u7fa4\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u5e76\u952e\u5165yes\u4ee5\u63a5\u53d7\u914d\u7f6e\u3002\u524d\u4e09\u4e2a\u8282\u70b9\u6210\u4e3a\u4e3b\u8282\u70b9\uff0c\u540e\u4e09\u4e2a\u8282\u70b9\u6210\u4e3a\u4ece\u8282\u70b9\u3002 $ kubectl exec -it redis-cluster-0 -- redis-cli --cluster create --cluster-replicas 1 $(kubectl get pods -l app=redis-cluster -o jsonpath='{range.items[*]}{.status.podIP}:6379 ') >>> Performing hash slots allocation on 6 nodes... Master[0] -> Slots 0 - 5460 Master[1] -> Slots 5461 - 10922 Master[2] -> Slots 10923 - 16383 Adding replica 10.1.0.18:6379 to 10.1.0.14:6379 Adding replica 10.1.0.19:6379 to 10.1.0.15:6379 Adding replica 10.1.0.17:6379 to 10.1.0.16:6379 M: 61d39f27b3e2c7a11f54aed28e5c8096c6a63f02 10.1.0.14:6379 slots:[0-5460] (5461 slots) master M: 5fdd35b61af412cf8c8067764715acbd7c5adef1 10.1.0.15:6379 slots:[5461-10922] (5462 slots) master M: 6430f0c0de9f187ea0542ca84ac4ec2b9f920a2f 10.1.0.16:6379 slots:[10923-16383] (5461 slots) master S: fcf9deff9937b661135cedaa02f5cbb777fdd84e 10.1.0.17:6379 replicates 6430f0c0de9f187ea0542ca84ac4ec2b9f920a2f S: 06eaaac0487e4c2d3bed80782f6da5cf294b7381 10.1.0.18:6379 replicates 61d39f27b3e2c7a11f54aed28e5c8096c6a63f02 S: 446198ba4c2a7a79cd37253a8fea076ddfa31f61 10.1.0.19:6379 replicates 5fdd35b61af412cf8c8067764715acbd7c5adef1 Can I set the above configuration? (type 'yes' to accept): yes >>> Nodes configuration updated >>> Assign a different config epoch to each node >>> Sending CLUSTER MEET messages to join the cluster Waiting for the cluster to join ..... >>> Performing Cluster Check (using node 10.1.0.14:6379) M: 61d39f27b3e2c7a11f54aed28e5c8096c6a63f02 10.1.0.14:6379 slots:[0-5460] (5461 slots) master 1 additional replica(s) S: 06eaaac0487e4c2d3bed80782f6da5cf294b7381 10.1.0.18:6379 slots: (0 slots) slave replicates 61d39f27b3e2c7a11f54aed28e5c8096c6a63f02 M: 6430f0c0de9f187ea0542ca84ac4ec2b9f920a2f 10.1.0.16:6379 slots:[10923-16383] (5461 slots) master 1 additional replica(s) S: 446198ba4c2a7a79cd37253a8fea076ddfa31f61 10.1.0.19:6379 slots: (0 slots) slave replicates 5fdd35b61af412cf8c8067764715acbd7c5adef1 M: 5fdd35b61af412cf8c8067764715acbd7c5adef1 10.1.0.15:6379 slots:[5461-10922] (5462 slots) master 1 additional replica(s) S: fcf9deff9937b661135cedaa02f5cbb777fdd84e 10.1.0.17:6379 slots: (0 slots) slave replicates 6430f0c0de9f187ea0542ca84ac4ec2b9f920a2f [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered. 4-3 \u9a8c\u8bc1\u96c6\u7fa4 $ kubectl exec -it redis-cluster-0 -- redis-cli cluster info cluster_state:ok cluster_slots_assigned:16384 cluster_slots_ok:16384 cluster_slots_pfail:0 cluster_slots_fail:0 cluster_known_nodes:6 cluster_size:3 cluster_current_epoch:6 cluster_my_epoch:1 cluster_stats_messages_ping_sent:67 cluster_stats_messages_pong_sent:64 cluster_stats_messages_sent:131 cluster_stats_messages_ping_received:59 cluster_stats_messages_pong_received:67 cluster_stats_messages_meet_received:5 cluster_stats_messages_received:131 $ for x in $(seq 0 5); do echo \"redis-cluster-$x\"; kubectl exec redis-cluster-$x -- redis-cli role; echo; done redis-cluster-0 master 126 10.1.0.18 6379 126 redis-cluster-1 master 126 10.1.0.19 6379 126 redis-cluster-2 master 126 10.1.0.17 6379 126 redis-cluster-3 slave 10.1.0.16 6379 connected 126 redis-cluster-4 slave 10.1.0.14 6379 connected 126 redis-cluster-5 slave 10.1.0.15 6379 connected 126 5\u3001\u6d4b\u8bd5\u96c6\u7fa4 \u6211\u4eec\u60f3\u4f7f\u7528\u96c6\u7fa4\uff0c\u7136\u540e\u6a21\u62df\u8282\u70b9\u7684\u6545\u969c\u3002\u5bf9\u4e8e\u524d\u4e00\u9879\u4efb\u52a1\uff0c\u6211\u4eec\u5c06\u90e8\u7f72\u4e00\u4e2a\u7b80\u5355\u7684Python\u5e94\u7528\u7a0b\u5e8f\uff0c\u800c\u5bf9\u4e8e\u540e\u8005\uff0c\u6211\u4eec\u5c06\u5220\u9664\u4e00\u4e2a\u8282\u70b9\u5e76\u89c2\u5bdf\u96c6\u7fa4\u884c\u4e3a\u3002 $ kubectl exec -it redis-cluster-0 -- redis-cli 127.0.0.1:6379> info # Server redis_version:5.0.5 redis_git_sha1:00000000 redis_git_dirty:0 redis_build_id:4d072dc1c62d5672 redis_mode:cluster os:Linux 4.19.121-linuxkit x86_64 arch_bits:64 multiplexing_api:epoll atomicvar_api:atomic-builtin gcc_version:8.3.0 process_id:1 run_id:5f57ff91b68a733e0e195a9ddd0ec79e31f80da9 tcp_port:6379 uptime_in_seconds:45890 uptime_in_days:0 hz:10 configured_hz:10 lru_clock:3175299 executable:/data/redis-server config_file:/conf/redis.conf # Clients connected_clients:2 client_recent_max_input_buffer:2 client_recent_max_output_buffer:0 blocked_clients:0 # Memory used_memory:2676408 used_memory_human:2.55M used_memory_rss:5947392 used_memory_rss_human:5.67M used_memory_peak:2676408 used_memory_peak_human:2.55M used_memory_peak_perc:100.04% used_memory_overhead:2595306 used_memory_startup:1463008 used_memory_dataset:81102 used_memory_dataset_perc:6.68% allocator_allocated:3130336 allocator_active:3457024 allocator_resident:17768448 total_system_memory:8351621120 total_system_memory_human:7.78G used_memory_lua:37888 used_memory_lua_human:37.00K used_memory_scripts:0 used_memory_scripts_human:0B number_of_cached_scripts:0 maxmemory:0 maxmemory_human:0B maxmemory_policy:noeviction allocator_frag_ratio:1.10 allocator_frag_bytes:326688 allocator_rss_ratio:5.14 allocator_rss_bytes:14311424 rss_overhead_ratio:0.33 rss_overhead_bytes:-11821056 mem_fragmentation_ratio:2.26 mem_fragmentation_bytes:3312984 mem_not_counted_for_evict:112 mem_replication_backlog:1048576 mem_clients_slaves:16922 mem_clients_normal:66616 mem_aof_buffer:112 mem_allocator:jemalloc-5.1.0 active_defrag_running:0 lazyfree_pending_objects:0 # Persistence loading:0 rdb_changes_since_last_save:1 rdb_bgsave_in_progress:0 rdb_last_save_time:1613742145 rdb_last_bgsave_status:ok rdb_last_bgsave_time_sec:0 rdb_current_bgsave_time_sec:-1 rdb_last_cow_size:217088 aof_enabled:1 aof_rewrite_in_progress:0 aof_rewrite_scheduled:0 aof_last_rewrite_time_sec:-1 aof_current_rewrite_time_sec:-1 aof_last_bgrewrite_status:ok aof_last_write_status:ok aof_last_cow_size:0 aof_current_size:244 aof_base_size:188 aof_pending_rewrite:0 aof_buffer_length:0 aof_rewrite_buffer_length:0 aof_pending_bio_fsync:0 aof_delayed_fsync:0 # Stats total_connections_received:8 total_commands_processed:11979 instantaneous_ops_per_sec:1 total_net_input_bytes:447569 total_net_output_bytes:51635 instantaneous_input_kbps:0.03 instantaneous_output_kbps:7.01 rejected_connections:0 sync_full:1 sync_partial_ok:3 sync_partial_err:1 expired_keys:0 expired_stale_perc:0.00 expired_time_cap_reached_count:0 evicted_keys:0 keyspace_hits:0 keyspace_misses:0 pubsub_channels:0 pubsub_patterns:0 latest_fork_usec:179 migrate_cached_sockets:0 slave_expires_tracked_keys:0 active_defrag_hits:0 active_defrag_misses:0 active_defrag_key_hits:0 active_defrag_key_misses:0 # Replication role:master connected_slaves:1 slave0:ip=10.1.0.18,port=6379,state=online,offset=16800,lag=1 master_replid:b7f58952b5529206bd0f637014de5ed204d6a22e master_replid2:0000000000000000000000000000000000000000 master_repl_offset:16800 second_repl_offset:-1 repl_backlog_active:1 repl_backlog_size:1048576 repl_backlog_first_byte_offset:1 repl_backlog_histlen:16800 # CPU used_cpu_sys:24.062666 used_cpu_user:8.067974 used_cpu_sys_children:0.001834 used_cpu_user_children:0.000000 # Cluster cluster_enabled:1 # Keyspace db0:keys=1,expires=0,avg_ttl=0 5-1 \u90e8\u7f72\u70b9\u51fb\u8ba1\u6570\u5668\u5e94\u7528 \u6211\u4eec\u5c06\u4e00\u4e2a\u7b80\u5355\u7684\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u5230\u96c6\u7fa4\u4e2d\uff0c\u5e76\u5728\u5176\u524d\u9762\u653e\u7f6e\u4e00\u4e2a\u8d1f\u8f7d\u5e73\u8861\u5668\u3002\u6b64\u5e94\u7528\u7a0b\u5e8f\u7684\u76ee\u7684\u662f\u5728\u5c06\u8ba1\u6570\u5668\u503c\u4f5c\u4e3aHTTP\u54cd\u5e94\u8fd4\u56de\u4e4b\u524d\uff0c\u589e\u52a0\u8ba1\u6570\u5668\u5e76\u5c06\u5176\u5b58\u50a8\u5728Redis\u96c6\u7fa4\u4e2d\u3002 app-deployment-service.yml --- apiVersion: v1 kind: Service metadata: name: hit-counter-lb spec: type: ClusterIP ports: - port: 80 protocol: TCP targetPort: 5000 selector: app: myapp --- apiVersion: apps/v1 kind: Deployment metadata: name: hit-counter-app spec: replicas: 1 selector: matchLabels: app: myapp template: metadata: labels: app: myapp spec: containers: - name: myapp image: calinrus/api-redis-ha:1.0 ports: - containerPort: 5000 $ kubectl apply -f app-deployment-service.yml service/hit-counter-lb created deployment.apps/hit-counter-app created $ kubectl get svc hit-counter-lb NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE hit-counter-lb ClusterIP 10.106.231.89 <none> 80/TCP 53m \u5728\u6b64\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u6211\u4eec\u7ee7\u7eed\u52a0\u8f7d\u9875\u9762\uff0c\u8ba1\u6570\u5668\u5c06\u7ee7\u7eed\u589e\u52a0\uff0c\u5e76\u4e14\u5728\u5220\u9664Pod\u4e4b\u540e\uff0c\u6211\u4eec\u770b\u5230\u6ca1\u6709\u6570\u636e\u4e22\u5931\u3002 5-2 \u542f\u52a8Netbox\u68c0\u67e5\u7f51\u7edc \u5728\u4e00\u4e2a\u955c\u50cf\u4e2d\u5185\u7f6e\u4e00\u4e9b\u7f51\u7edc\u5de5\u5177\u5305\uff0c\u5bf9\u6211\u4eec\u6392\u67e5\u5de5\u4f5c\u4f1a\u975e\u5e38\u6709\u5e2e\u52a9\uff0c\u6bd4\u5982\u5728\u4e0b\u9762\u7684\u7b80\u5355\u670d\u52a1\u4e2d\u6211\u4eec\u6dfb\u52a0\u4e00\u4e9b\u5e38\u7528\u7684\u7f51\u7edc\u5de5\u5177\u5305\uff1a iproute2 net-tools ethtool netbox-deployment.yaml apiVersion: apps/v1beta1 kind: Deployment metadata: labels: run: netbox name: netbox spec: replicas: 2 selector: matchLabels: run: netbox template: metadata: labels: run: netbox spec: nodeSelector: type: other containers: - image: quay.io/gravitational/netbox:latest imagePullPolicy: Always name: netbox securityContext: runAsUser: 0 terminationGracePeriodSeconds: 30 $ kubectl get pods NAME READY STATUS RESTARTS AGE hit-counter-app-6987969599-64ndt 1/1 Running 0 13h netbox-6b9767f659-9kbc6 1/1 Running 0 12h kubectl exec -it netbox-6b9767f659-9kbc6 bash root@netbox-6b9767f659-9kbc6:/# curl 10.106.231.89 I have been hit 1 times since deployment. root@netbox-6b9767f659-9kbc6:/# curl 10.106.231.89 I have been hit 2 times since deployment. root@netbox-6b9767f659-9kbc6:/# curl 10.106.231.89 I have been hit 3 times since deployment. root@netbox-6b9767f659-9kbc6:/# curl 10.106.231.89 I have been hit 4 times since deployment. root@netbox-6b9767f659-9kbc6:/# curl 10.106.231.89 I have been hit 5 times since deployment. root@netbox-6b9767f659-9kbc6:/# kubectl delete pods redis-cluster-0 pod \"redis-cluster-0\" deleted $ kubectl delete pods redis-cluster-1 pod \"redis-cluster-1\" deleted $ kubectl exec -it netbox-6b9767f659-9kbc6 bash root@netbox-6b9767f659-9kbc6:/# curl 10.106.231.89 I have been hit 6 times since deployment.","title":"\u7b2c\u4e00\u8282 Kubernetes\u4e0a\u901a\u8fc7sts\u6d4b\u8bd5Redis Cluster"},{"location":"chap9/1redis_k8s_sts/#kubernetesstsredis-cluster","text":"","title":"\u7b2c\u4e00\u8282 Kubernetes\u4e0a\u901a\u8fc7sts\u6d4b\u8bd5Redis Cluster\u96c6\u7fa4"},{"location":"chap9/1redis_k8s_sts/#1redis","text":"Redis\u4ee3\u8868 Remote Dictionary Server \u662f\u4e00\u79cd\u5f00\u6e90\u7684\u5185\u5b58\u4e2d\u6570\u636e\u5b58\u50a8\uff0c\u901a\u5e38\u7528\u4f5c\u6570\u636e\u5e93\uff0c\u7f13\u5b58\u6216\u6d88\u606f\u4ee3\u7406\u3002\u5b83\u53ef\u4ee5\u5b58\u50a8\u548c\u64cd\u4f5c\u9ad8\u7ea7\u6570\u636e\u7c7b\u578b\uff0c\u4f8b\u5982\u5217\u8868\uff0c\u5730\u56fe\uff0c\u96c6\u5408\u548c\u6392\u5e8f\u96c6\u5408\u3002\u7531\u4e8eRedis\u63a5\u53d7\u591a\u79cd\u683c\u5f0f\u7684\u5bc6\u94a5\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728\u670d\u52a1\u5668\u4e0a\u6267\u884c\u64cd\u4f5c\uff0c\u4ece\u800c\u51cf\u5c11\u4e86\u5ba2\u6237\u7aef\u7684\u5de5\u4f5c\u91cf\u3002\u5b83\u4ec5\u5c06\u78c1\u76d8\u7528\u4e8e\u6301\u4e45\u6027\uff0c\u800c\u5c06\u6570\u636e\u5e93\u5b8c\u5168\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u3002Redis\u662f\u4e00\u79cd\u6d41\u884c\u7684\u6570\u636e\u5b58\u50a8\u89e3\u51b3\u65b9\u6848\uff0c\u5e76\u88ab GitHub\uff0cPinterest\uff0cSnapchat\uff0cTwitter\uff0cStackOverflow\uff0cFlickr \u7b49\u6280\u672f\u5de8\u5934\u6240\u4f7f\u7528\u3002","title":"1\u3001Redis\u4ecb\u7ecd"},{"location":"chap9/1redis_k8s_sts/#2redis","text":"\u5b83\u7684\u901f\u5ea6\u975e\u5e38\u5feb\u3002\u5b83\u662f\u7528ANSI C\u7f16\u5199\u7684\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728POSIX\u7cfb\u7edf\u4e0a\u8fd0\u884c\uff0c\u4f8b\u5982Linux\uff0cMac OS X\u548cSolaris\u3002 Redis\u901a\u5e38\u88ab\u6392\u540d\u4e3a\u6700\u6d41\u884c\u7684\u952e/\u503c\u6570\u636e\u5e93\u548c\u6700\u6d41\u884c\u7684\u4e0e\u5bb9\u5668\u4e00\u8d77\u4f7f\u7528\u7684NoSQL\u6570\u636e\u5e93\u3002 \u5176\u7f13\u5b58\u89e3\u51b3\u65b9\u6848\u51cf\u5c11\u4e86\u5bf9\u4e91\u6570\u636e\u5e93\u540e\u7aef\u7684\u8c03\u7528\u6b21\u6570\u3002 \u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u901a\u8fc7\u5176\u5ba2\u6237\u7aefAPI\u5e93\u5bf9\u5176\u8fdb\u884c\u8bbf\u95ee\u3002 \u6240\u6709\u6d41\u884c\u7684\u7f16\u7a0b\u8bed\u8a00\u90fd\u652f\u6301Redis\u3002 \u5b83\u662f\u5f00\u6e90\u4e14\u7a33\u5b9a\u7684\u3002","title":"2\u3001\u4e3a\u4ec0\u4e48\u4f7f\u7528Redis"},{"location":"chap9/1redis_k8s_sts/#3redis","text":"Redis Cluster \u662f\u4e00\u7ec4Redis\u5b9e\u4f8b\uff0c\u65e8\u5728\u901a\u8fc7\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u5206\u533a\u6765\u6269\u5c55\u6570\u636e\u5e93\uff0c\u4ece\u800c\u4f7f\u5176\u66f4\u5177\u5f39\u6027\u3002 \u7fa4\u96c6\u4e2d\u7684\u6bcf\u4e2a\u6210\u5458\uff08\u65e0\u8bba\u662f\u4e3b\u526f\u672c\u8fd8\u662f\u8f85\u52a9\u526f\u672c\uff09\u90fd\u7ba1\u7406\u54c8\u5e0c\u69fd\u7684\u5b50\u96c6\u3002\u5982\u679c\u4e3b\u673a\u65e0\u6cd5\u8bbf\u95ee\uff0c\u5219\u5176\u4ece\u673a\u5c06\u5347\u7ea7\u4e3a\u4e3b\u673a\u3002 \u5728\u7531\u4e09\u4e2a\u4e3b\u8282\u70b9\u7ec4\u6210\u7684\u6700\u5c0fRedis\u7fa4\u96c6\u4e2d\uff0c\u6bcf\u4e2a\u4e3b\u8282\u70b9\u90fd\u6709\u4e00\u4e2a\u4ece\u8282\u70b9\uff08\u4ee5\u5b9e\u73b0\u6700\u5c0f\u7684\u6545\u969c\u8f6c\u79fb\uff09\uff0c\u6bcf\u4e2a\u4e3b\u8282\u70b9\u90fd\u5206\u914d\u6709\u4e00\u4e2a\u4ecb\u4e8e0\u523016,383\u4e4b\u95f4\u7684\u54c8\u5e0c\u69fd\u8303\u56f4\u3002 \u8282\u70b9A\u5305\u542b\u4ece0\u52305000\u7684\u54c8\u5e0c\u69fd\uff0c\u8282\u70b9B\u4ece5001\u523010000\uff0c\u8282\u70b9C\u4ece10001\u523016383\u3002 \u7fa4\u96c6\u5185\u90e8\u7684\u901a\u4fe1\u662f\u901a\u8fc7\u5185\u90e8\u603b\u7ebf\u8fdb\u884c\u7684\uff0c\u4f7f\u7528\u534f\u8bae\u4f20\u64ad\u6709\u5173\u7fa4\u96c6\u7684\u4fe1\u606f\u6216\u53d1\u73b0\u65b0\u8282\u70b9\u3002","title":"3\u3001\u4ec0\u4e48\u662fRedis\u96c6\u7fa4"},{"location":"chap9/1redis_k8s_sts/#4kubernetesredis","text":"\u5728Kubernetes\u4e2d\u90e8\u7f72Redis\u96c6\u7fa4\u9762\u4e34\u6311\u6218\uff0c\u56e0\u4e3a\u6bcf\u4e2aRedis\u5b9e\u4f8b\u90fd\u4f9d\u8d56\u4e8e\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u53ef\u4ee5\u8ddf\u8e2a\u5176\u4ed6\u96c6\u7fa4\u5b9e\u4f8b\u53ca\u5176\u89d2\u8272\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u9700\u8981\u7ed3\u5408\u4f7f\u7528 Kubernetes StatefulSets \u548c PersistentVolumes \u3002","title":"4\u3001\u5728kubernetes\u4e2d\u90e8\u7f72redis\u96c6\u7fa4"},{"location":"chap9/1redis_k8s_sts/#4-1-redis","text":"\u90e8\u7f72\u53ca\u6d4b\u8bd5\u4ee3\u7801\u6587\u4ef6 \u521b\u5efastatefulset\u7c7b\u578b\u8d44\u6e90 redis-sts.yml --- apiVersion: v1 kind: ConfigMap metadata: name: redis-cluster data: update-node.sh: | #!/bin/sh REDIS_NODES=\"/data/nodes.conf\" sed -i -e \"/myself/ s/[0-9]\\{1,3\\}\\.[0-9]\\{1,3\\}\\.[0-9]\\{1,3\\}\\.[0-9]\\{1,3\\}/${POD_IP}/\" ${REDIS_NODES} exec \"$@\" redis.conf: |+ cluster-enabled yes cluster-require-full-coverage no cluster-node-timeout 15000 cluster-config-file /data/nodes.conf cluster-migration-barrier 1 appendonly yes protected-mode no --- apiVersion: apps/v1 kind: StatefulSet metadata: name: redis-cluster spec: serviceName: redis-cluster replicas: 6 selector: matchLabels: app: redis-cluster template: metadata: labels: app: redis-cluster spec: containers: - name: redis image: redis:5.0.5-alpine ports: - containerPort: 6379 name: client - containerPort: 16379 name: gossip command: [\"/conf/update-node.sh\", \"redis-server\", \"/conf/redis.conf\"] env: - name: POD_IP valueFrom: fieldRef: fieldPath: status.podIP volumeMounts: - name: conf mountPath: /conf readOnly: false - name: data mountPath: /data readOnly: false volumes: - name: conf configMap: name: redis-cluster defaultMode: 0755 volumeClaimTemplates: - metadata: name: data spec: accessModes: [ \"ReadWriteOnce\" ] resources: requests: storage: 5Gi # storageClassName: redis-cluster storageClassName: hostpath cluster-node-timeout 15000 : \u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e86 Redis Cluster \u4e2d\u5b9e\u4f8b\u54cd\u5e94\u5fc3\u8df3\u6d88\u606f\u7684\u8d85\u65f6\u65f6\u95f4\u3002 protected-mode no : \u5f53\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u4e3a yes \u65f6\uff0c\u54e8\u5175\u5b9e\u4f8b\u53ea\u80fd\u5728\u90e8\u7f72\u7684\u670d\u52a1\u5668\u672c\u5730\u8fdb\u884c\u8bbf\u95ee\u3002\u5f53\u8bbe\u7f6e\u4e3a no \u65f6\uff0c\u5176\u4ed6\u670d\u52a1\u5668\u4e5f\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e2a\u54e8\u5175\u5b9e\u4f8b\u3002 $ kubectl apply -f redis-sts.yml configmap/redis-cluster created statefulset.apps/redis-cluster created $ kubectl get pods -l app=redis-cluster NAME READY STATUS RESTARTS AGE redis-cluster-0 1/1 Running 0 88m redis-cluster-1 1/1 Running 0 88m redis-cluster-2 1/1 Running 0 174m redis-cluster-3 1/1 Running 0 174m redis-cluster-4 1/1 Running 0 174m redis-cluster-5 1/1 Running 0 174m \u521b\u5efaservice redis-svc.yml --- apiVersion: v1 kind: Service metadata: name: redis-cluster spec: type: ClusterIP clusterIP: 10.96.0.106 ports: - port: 6379 targetPort: 6379 name: client - port: 16379 targetPort: 16379 name: gossip selector: app: redis-cluster $ kubectl apply -f redis-svc.yml service/redis-cluster created $ kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.96.0.1 <none> 443/TCP 7d22h redis-cluster ClusterIP 10.96.0.106 <none> 6379/TCP,16379/TCP 6m9s","title":"4-1 \u90e8\u7f72Redis\u96c6\u7fa4"},{"location":"chap9/1redis_k8s_sts/#4-2-redis-cluster","text":"\u4e0b\u4e00\u6b65\u662f\u5f62\u6210Redis\u96c6\u7fa4\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u5e76\u952e\u5165yes\u4ee5\u63a5\u53d7\u914d\u7f6e\u3002\u524d\u4e09\u4e2a\u8282\u70b9\u6210\u4e3a\u4e3b\u8282\u70b9\uff0c\u540e\u4e09\u4e2a\u8282\u70b9\u6210\u4e3a\u4ece\u8282\u70b9\u3002 $ kubectl exec -it redis-cluster-0 -- redis-cli --cluster create --cluster-replicas 1 $(kubectl get pods -l app=redis-cluster -o jsonpath='{range.items[*]}{.status.podIP}:6379 ') >>> Performing hash slots allocation on 6 nodes... Master[0] -> Slots 0 - 5460 Master[1] -> Slots 5461 - 10922 Master[2] -> Slots 10923 - 16383 Adding replica 10.1.0.18:6379 to 10.1.0.14:6379 Adding replica 10.1.0.19:6379 to 10.1.0.15:6379 Adding replica 10.1.0.17:6379 to 10.1.0.16:6379 M: 61d39f27b3e2c7a11f54aed28e5c8096c6a63f02 10.1.0.14:6379 slots:[0-5460] (5461 slots) master M: 5fdd35b61af412cf8c8067764715acbd7c5adef1 10.1.0.15:6379 slots:[5461-10922] (5462 slots) master M: 6430f0c0de9f187ea0542ca84ac4ec2b9f920a2f 10.1.0.16:6379 slots:[10923-16383] (5461 slots) master S: fcf9deff9937b661135cedaa02f5cbb777fdd84e 10.1.0.17:6379 replicates 6430f0c0de9f187ea0542ca84ac4ec2b9f920a2f S: 06eaaac0487e4c2d3bed80782f6da5cf294b7381 10.1.0.18:6379 replicates 61d39f27b3e2c7a11f54aed28e5c8096c6a63f02 S: 446198ba4c2a7a79cd37253a8fea076ddfa31f61 10.1.0.19:6379 replicates 5fdd35b61af412cf8c8067764715acbd7c5adef1 Can I set the above configuration? (type 'yes' to accept): yes >>> Nodes configuration updated >>> Assign a different config epoch to each node >>> Sending CLUSTER MEET messages to join the cluster Waiting for the cluster to join ..... >>> Performing Cluster Check (using node 10.1.0.14:6379) M: 61d39f27b3e2c7a11f54aed28e5c8096c6a63f02 10.1.0.14:6379 slots:[0-5460] (5461 slots) master 1 additional replica(s) S: 06eaaac0487e4c2d3bed80782f6da5cf294b7381 10.1.0.18:6379 slots: (0 slots) slave replicates 61d39f27b3e2c7a11f54aed28e5c8096c6a63f02 M: 6430f0c0de9f187ea0542ca84ac4ec2b9f920a2f 10.1.0.16:6379 slots:[10923-16383] (5461 slots) master 1 additional replica(s) S: 446198ba4c2a7a79cd37253a8fea076ddfa31f61 10.1.0.19:6379 slots: (0 slots) slave replicates 5fdd35b61af412cf8c8067764715acbd7c5adef1 M: 5fdd35b61af412cf8c8067764715acbd7c5adef1 10.1.0.15:6379 slots:[5461-10922] (5462 slots) master 1 additional replica(s) S: fcf9deff9937b661135cedaa02f5cbb777fdd84e 10.1.0.17:6379 slots: (0 slots) slave replicates 6430f0c0de9f187ea0542ca84ac4ec2b9f920a2f [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered.","title":"4-2 \u521d\u59cb\u5316redis cluster"},{"location":"chap9/1redis_k8s_sts/#4-3","text":"$ kubectl exec -it redis-cluster-0 -- redis-cli cluster info cluster_state:ok cluster_slots_assigned:16384 cluster_slots_ok:16384 cluster_slots_pfail:0 cluster_slots_fail:0 cluster_known_nodes:6 cluster_size:3 cluster_current_epoch:6 cluster_my_epoch:1 cluster_stats_messages_ping_sent:67 cluster_stats_messages_pong_sent:64 cluster_stats_messages_sent:131 cluster_stats_messages_ping_received:59 cluster_stats_messages_pong_received:67 cluster_stats_messages_meet_received:5 cluster_stats_messages_received:131 $ for x in $(seq 0 5); do echo \"redis-cluster-$x\"; kubectl exec redis-cluster-$x -- redis-cli role; echo; done redis-cluster-0 master 126 10.1.0.18 6379 126 redis-cluster-1 master 126 10.1.0.19 6379 126 redis-cluster-2 master 126 10.1.0.17 6379 126 redis-cluster-3 slave 10.1.0.16 6379 connected 126 redis-cluster-4 slave 10.1.0.14 6379 connected 126 redis-cluster-5 slave 10.1.0.15 6379 connected 126","title":"4-3 \u9a8c\u8bc1\u96c6\u7fa4"},{"location":"chap9/1redis_k8s_sts/#5","text":"\u6211\u4eec\u60f3\u4f7f\u7528\u96c6\u7fa4\uff0c\u7136\u540e\u6a21\u62df\u8282\u70b9\u7684\u6545\u969c\u3002\u5bf9\u4e8e\u524d\u4e00\u9879\u4efb\u52a1\uff0c\u6211\u4eec\u5c06\u90e8\u7f72\u4e00\u4e2a\u7b80\u5355\u7684Python\u5e94\u7528\u7a0b\u5e8f\uff0c\u800c\u5bf9\u4e8e\u540e\u8005\uff0c\u6211\u4eec\u5c06\u5220\u9664\u4e00\u4e2a\u8282\u70b9\u5e76\u89c2\u5bdf\u96c6\u7fa4\u884c\u4e3a\u3002 $ kubectl exec -it redis-cluster-0 -- redis-cli 127.0.0.1:6379> info # Server redis_version:5.0.5 redis_git_sha1:00000000 redis_git_dirty:0 redis_build_id:4d072dc1c62d5672 redis_mode:cluster os:Linux 4.19.121-linuxkit x86_64 arch_bits:64 multiplexing_api:epoll atomicvar_api:atomic-builtin gcc_version:8.3.0 process_id:1 run_id:5f57ff91b68a733e0e195a9ddd0ec79e31f80da9 tcp_port:6379 uptime_in_seconds:45890 uptime_in_days:0 hz:10 configured_hz:10 lru_clock:3175299 executable:/data/redis-server config_file:/conf/redis.conf # Clients connected_clients:2 client_recent_max_input_buffer:2 client_recent_max_output_buffer:0 blocked_clients:0 # Memory used_memory:2676408 used_memory_human:2.55M used_memory_rss:5947392 used_memory_rss_human:5.67M used_memory_peak:2676408 used_memory_peak_human:2.55M used_memory_peak_perc:100.04% used_memory_overhead:2595306 used_memory_startup:1463008 used_memory_dataset:81102 used_memory_dataset_perc:6.68% allocator_allocated:3130336 allocator_active:3457024 allocator_resident:17768448 total_system_memory:8351621120 total_system_memory_human:7.78G used_memory_lua:37888 used_memory_lua_human:37.00K used_memory_scripts:0 used_memory_scripts_human:0B number_of_cached_scripts:0 maxmemory:0 maxmemory_human:0B maxmemory_policy:noeviction allocator_frag_ratio:1.10 allocator_frag_bytes:326688 allocator_rss_ratio:5.14 allocator_rss_bytes:14311424 rss_overhead_ratio:0.33 rss_overhead_bytes:-11821056 mem_fragmentation_ratio:2.26 mem_fragmentation_bytes:3312984 mem_not_counted_for_evict:112 mem_replication_backlog:1048576 mem_clients_slaves:16922 mem_clients_normal:66616 mem_aof_buffer:112 mem_allocator:jemalloc-5.1.0 active_defrag_running:0 lazyfree_pending_objects:0 # Persistence loading:0 rdb_changes_since_last_save:1 rdb_bgsave_in_progress:0 rdb_last_save_time:1613742145 rdb_last_bgsave_status:ok rdb_last_bgsave_time_sec:0 rdb_current_bgsave_time_sec:-1 rdb_last_cow_size:217088 aof_enabled:1 aof_rewrite_in_progress:0 aof_rewrite_scheduled:0 aof_last_rewrite_time_sec:-1 aof_current_rewrite_time_sec:-1 aof_last_bgrewrite_status:ok aof_last_write_status:ok aof_last_cow_size:0 aof_current_size:244 aof_base_size:188 aof_pending_rewrite:0 aof_buffer_length:0 aof_rewrite_buffer_length:0 aof_pending_bio_fsync:0 aof_delayed_fsync:0 # Stats total_connections_received:8 total_commands_processed:11979 instantaneous_ops_per_sec:1 total_net_input_bytes:447569 total_net_output_bytes:51635 instantaneous_input_kbps:0.03 instantaneous_output_kbps:7.01 rejected_connections:0 sync_full:1 sync_partial_ok:3 sync_partial_err:1 expired_keys:0 expired_stale_perc:0.00 expired_time_cap_reached_count:0 evicted_keys:0 keyspace_hits:0 keyspace_misses:0 pubsub_channels:0 pubsub_patterns:0 latest_fork_usec:179 migrate_cached_sockets:0 slave_expires_tracked_keys:0 active_defrag_hits:0 active_defrag_misses:0 active_defrag_key_hits:0 active_defrag_key_misses:0 # Replication role:master connected_slaves:1 slave0:ip=10.1.0.18,port=6379,state=online,offset=16800,lag=1 master_replid:b7f58952b5529206bd0f637014de5ed204d6a22e master_replid2:0000000000000000000000000000000000000000 master_repl_offset:16800 second_repl_offset:-1 repl_backlog_active:1 repl_backlog_size:1048576 repl_backlog_first_byte_offset:1 repl_backlog_histlen:16800 # CPU used_cpu_sys:24.062666 used_cpu_user:8.067974 used_cpu_sys_children:0.001834 used_cpu_user_children:0.000000 # Cluster cluster_enabled:1 # Keyspace db0:keys=1,expires=0,avg_ttl=0","title":"5\u3001\u6d4b\u8bd5\u96c6\u7fa4"},{"location":"chap9/1redis_k8s_sts/#5-1","text":"\u6211\u4eec\u5c06\u4e00\u4e2a\u7b80\u5355\u7684\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u5230\u96c6\u7fa4\u4e2d\uff0c\u5e76\u5728\u5176\u524d\u9762\u653e\u7f6e\u4e00\u4e2a\u8d1f\u8f7d\u5e73\u8861\u5668\u3002\u6b64\u5e94\u7528\u7a0b\u5e8f\u7684\u76ee\u7684\u662f\u5728\u5c06\u8ba1\u6570\u5668\u503c\u4f5c\u4e3aHTTP\u54cd\u5e94\u8fd4\u56de\u4e4b\u524d\uff0c\u589e\u52a0\u8ba1\u6570\u5668\u5e76\u5c06\u5176\u5b58\u50a8\u5728Redis\u96c6\u7fa4\u4e2d\u3002 app-deployment-service.yml --- apiVersion: v1 kind: Service metadata: name: hit-counter-lb spec: type: ClusterIP ports: - port: 80 protocol: TCP targetPort: 5000 selector: app: myapp --- apiVersion: apps/v1 kind: Deployment metadata: name: hit-counter-app spec: replicas: 1 selector: matchLabels: app: myapp template: metadata: labels: app: myapp spec: containers: - name: myapp image: calinrus/api-redis-ha:1.0 ports: - containerPort: 5000 $ kubectl apply -f app-deployment-service.yml service/hit-counter-lb created deployment.apps/hit-counter-app created $ kubectl get svc hit-counter-lb NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE hit-counter-lb ClusterIP 10.106.231.89 <none> 80/TCP 53m \u5728\u6b64\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u6211\u4eec\u7ee7\u7eed\u52a0\u8f7d\u9875\u9762\uff0c\u8ba1\u6570\u5668\u5c06\u7ee7\u7eed\u589e\u52a0\uff0c\u5e76\u4e14\u5728\u5220\u9664Pod\u4e4b\u540e\uff0c\u6211\u4eec\u770b\u5230\u6ca1\u6709\u6570\u636e\u4e22\u5931\u3002","title":"5-1 \u90e8\u7f72\u70b9\u51fb\u8ba1\u6570\u5668\u5e94\u7528"},{"location":"chap9/1redis_k8s_sts/#5-2-netbox","text":"\u5728\u4e00\u4e2a\u955c\u50cf\u4e2d\u5185\u7f6e\u4e00\u4e9b\u7f51\u7edc\u5de5\u5177\u5305\uff0c\u5bf9\u6211\u4eec\u6392\u67e5\u5de5\u4f5c\u4f1a\u975e\u5e38\u6709\u5e2e\u52a9\uff0c\u6bd4\u5982\u5728\u4e0b\u9762\u7684\u7b80\u5355\u670d\u52a1\u4e2d\u6211\u4eec\u6dfb\u52a0\u4e00\u4e9b\u5e38\u7528\u7684\u7f51\u7edc\u5de5\u5177\u5305\uff1a iproute2 net-tools ethtool netbox-deployment.yaml apiVersion: apps/v1beta1 kind: Deployment metadata: labels: run: netbox name: netbox spec: replicas: 2 selector: matchLabels: run: netbox template: metadata: labels: run: netbox spec: nodeSelector: type: other containers: - image: quay.io/gravitational/netbox:latest imagePullPolicy: Always name: netbox securityContext: runAsUser: 0 terminationGracePeriodSeconds: 30 $ kubectl get pods NAME READY STATUS RESTARTS AGE hit-counter-app-6987969599-64ndt 1/1 Running 0 13h netbox-6b9767f659-9kbc6 1/1 Running 0 12h kubectl exec -it netbox-6b9767f659-9kbc6 bash root@netbox-6b9767f659-9kbc6:/# curl 10.106.231.89 I have been hit 1 times since deployment. root@netbox-6b9767f659-9kbc6:/# curl 10.106.231.89 I have been hit 2 times since deployment. root@netbox-6b9767f659-9kbc6:/# curl 10.106.231.89 I have been hit 3 times since deployment. root@netbox-6b9767f659-9kbc6:/# curl 10.106.231.89 I have been hit 4 times since deployment. root@netbox-6b9767f659-9kbc6:/# curl 10.106.231.89 I have been hit 5 times since deployment. root@netbox-6b9767f659-9kbc6:/# kubectl delete pods redis-cluster-0 pod \"redis-cluster-0\" deleted $ kubectl delete pods redis-cluster-1 pod \"redis-cluster-1\" deleted $ kubectl exec -it netbox-6b9767f659-9kbc6 bash root@netbox-6b9767f659-9kbc6:/# curl 10.106.231.89 I have been hit 6 times since deployment.","title":"5-2 \u542f\u52a8Netbox\u68c0\u67e5\u7f51\u7edc"},{"location":"chap9/2redis_k8s_config/","text":"\u7b2c\u4e8c\u8282 \u5229\u7528ConfigMap\u8bbe\u7f6e\u5b89\u88c5 Redis 1\u3001Configuring Redis using a ConfigMap \u90e8\u7f72\u53ca\u6d4b\u8bd5\u4ee3\u7801\u6587\u4ef6 First create a kustomization.yaml containing a ConfigMap from the redis-config file: redis-config maxmemory 2mb maxmemory-policy allkeys-lru cat <<EOF >./kustomization.yaml configMapGenerator: - name: example-redis-config files: - redis-config EOF redis-pod.yaml apiVersion: v1 kind: Pod metadata: name: redis spec: containers: - name: redis image: redis:5.0.4 command: - redis-server - \"/redis-master/redis.conf\" env: - name: MASTER value: \"true\" ports: - containerPort: 6379 resources: limits: cpu: \"0.1\" volumeMounts: - mountPath: /redis-master-data name: data - mountPath: /redis-master name: config volumes: - name: data emptyDir: {} - name: config configMap: name: example-redis-config items: - key: redis-config path: redis.conf cat <<EOF >>./kustomization.yaml resources: - redis-pod.yaml EOF kustomization.yaml configMapGenerator: - name: example-redis-config files: - redis-config resources: - redis-pod.yaml $ tree . . \u251c\u2500\u2500 kustomization.yaml \u251c\u2500\u2500 redis-config \u2514\u2500\u2500 redis-pod.yaml 0 directories, 3 files kustomize build . | kubectl apply -f - Use kubectl exec to enter the pod and run the redis-cli tool to verify that the configuration was correctly applied: $ kubectl exec -it redis redis-cli -n redis 127.0.0.1:6379> CONFIG GET maxmemory 1) \"maxmemory\" 2) \"2097152\" 127.0.0.1:6379> CONFIG GET maxmemory-policy 1) \"maxmemory-policy\" 2) \"allkeys-lru\" 127.0.0.1:6379> kubectl exec -it redis /bin/sh # redis-cli -h redis-cli 5.0.4 Usage: redis-cli [OPTIONS] [cmd [arg [arg ...]]] -h <hostname> Server hostname (default: 127.0.0.1). -p <port> Server port (default: 6379). -s <socket> Server socket (overrides hostname and port). -a <password> Password to use when connecting to the server. You can also use the REDISCLI_AUTH environment variable to pass this password more safely (if both are used, this argument takes predecence). -u <uri> Server URI. -r <repeat> Execute specified command N times. -i <interval> When -r is used, waits <interval> seconds per command. It is possible to specify sub-second times like -i 0.1. -n <db> Database number. -x Read last argument from STDIN. -d <delimiter> Multi-bulk delimiter in for raw formatting (default: \\n). -c Enable cluster mode (follow -ASK and -MOVED redirections). --raw Use raw formatting for replies (default when STDOUT is not a tty). --no-raw Force formatted output even when STDOUT is not a tty. --csv Output in CSV format. --stat Print rolling stats about server: mem, clients, ... --latency Enter a special mode continuously sampling latency. If you use this mode in an interactive session it runs forever displaying real-time stats. Otherwise if --raw or --csv is specified, or if you redirect the output to a non TTY, it samples the latency for 1 second (you can use -i to change the interval), then produces a single output and exits. --latency-history Like --latency but tracking latency changes over time. Default time interval is 15 sec. Change it using -i. --latency-dist Shows latency as a spectrum, requires xterm 256 colors. Default time interval is 1 sec. Change it using -i. --lru-test <keys> Simulate a cache workload with an 80-20 distribution. --replica Simulate a replica showing commands received from the master. --rdb <filename> Transfer an RDB dump from remote server to local file. --pipe Transfer raw Redis protocol from stdin to server. --pipe-timeout <n> In --pipe mode, abort with error if after sending all data. no reply is received within <n> seconds. Default timeout: 30. Use 0 to wait forever. --bigkeys Sample Redis keys looking for keys with many elements (complexity). --memkeys Sample Redis keys looking for keys consuming a lot of memory. --memkeys-samples <n> Sample Redis keys looking for keys consuming a lot of memory. And define number of key elements to sample --hotkeys Sample Redis keys looking for hot keys. only works when maxmemory-policy is *lfu. --scan List all keys using the SCAN command. --pattern <pat> Useful with --scan to specify a SCAN pattern. --intrinsic-latency <sec> Run a test to measure intrinsic system latency. The test will run for the specified amount of seconds. --eval <file> Send an EVAL command using the Lua script at <file>. --ldb Used with --eval enable the Redis Lua debugger. --ldb-sync-mode Like --ldb but uses the synchronous Lua debugger, in this mode the server is blocked and script changes are not rolled back from the server memory. --cluster <command> [args...] [opts...] Cluster Manager command and arguments (see below). --verbose Verbose mode. --no-auth-warning Don't show warning message when using password on command line interface. --help Output this help and exit. --version Output version and exit. Cluster Manager Commands: Use --cluster help to list all available cluster manager commands. Examples: cat /etc/passwd | redis-cli -x set mypasswd redis-cli get mypasswd redis-cli -r 100 lpush mylist x redis-cli -r 100 -i 1 info | grep used_memory_human: redis-cli --eval myscript.lua key1 key2 , arg1 arg2 arg3 redis-cli --scan --pattern '*:12345*' (Note: when using --eval the comma separates KEYS[] from ARGV[] items) When no command is given, redis-cli starts in interactive mode. Type \"help\" in interactive mode for information on available commands and settings.","title":"\u7b2c\u4e8c\u8282 \u5229\u7528ConfigMap\u8bbe\u7f6e\u5b89\u88c5 Redis"},{"location":"chap9/2redis_k8s_config/#configmap-redis","text":"","title":"\u7b2c\u4e8c\u8282 \u5229\u7528ConfigMap\u8bbe\u7f6e\u5b89\u88c5 Redis"},{"location":"chap9/2redis_k8s_config/#1configuring-redis-using-a-configmap","text":"\u90e8\u7f72\u53ca\u6d4b\u8bd5\u4ee3\u7801\u6587\u4ef6 First create a kustomization.yaml containing a ConfigMap from the redis-config file: redis-config maxmemory 2mb maxmemory-policy allkeys-lru cat <<EOF >./kustomization.yaml configMapGenerator: - name: example-redis-config files: - redis-config EOF redis-pod.yaml apiVersion: v1 kind: Pod metadata: name: redis spec: containers: - name: redis image: redis:5.0.4 command: - redis-server - \"/redis-master/redis.conf\" env: - name: MASTER value: \"true\" ports: - containerPort: 6379 resources: limits: cpu: \"0.1\" volumeMounts: - mountPath: /redis-master-data name: data - mountPath: /redis-master name: config volumes: - name: data emptyDir: {} - name: config configMap: name: example-redis-config items: - key: redis-config path: redis.conf cat <<EOF >>./kustomization.yaml resources: - redis-pod.yaml EOF kustomization.yaml configMapGenerator: - name: example-redis-config files: - redis-config resources: - redis-pod.yaml $ tree . . \u251c\u2500\u2500 kustomization.yaml \u251c\u2500\u2500 redis-config \u2514\u2500\u2500 redis-pod.yaml 0 directories, 3 files kustomize build . | kubectl apply -f - Use kubectl exec to enter the pod and run the redis-cli tool to verify that the configuration was correctly applied: $ kubectl exec -it redis redis-cli -n redis 127.0.0.1:6379> CONFIG GET maxmemory 1) \"maxmemory\" 2) \"2097152\" 127.0.0.1:6379> CONFIG GET maxmemory-policy 1) \"maxmemory-policy\" 2) \"allkeys-lru\" 127.0.0.1:6379> kubectl exec -it redis /bin/sh # redis-cli -h redis-cli 5.0.4 Usage: redis-cli [OPTIONS] [cmd [arg [arg ...]]] -h <hostname> Server hostname (default: 127.0.0.1). -p <port> Server port (default: 6379). -s <socket> Server socket (overrides hostname and port). -a <password> Password to use when connecting to the server. You can also use the REDISCLI_AUTH environment variable to pass this password more safely (if both are used, this argument takes predecence). -u <uri> Server URI. -r <repeat> Execute specified command N times. -i <interval> When -r is used, waits <interval> seconds per command. It is possible to specify sub-second times like -i 0.1. -n <db> Database number. -x Read last argument from STDIN. -d <delimiter> Multi-bulk delimiter in for raw formatting (default: \\n). -c Enable cluster mode (follow -ASK and -MOVED redirections). --raw Use raw formatting for replies (default when STDOUT is not a tty). --no-raw Force formatted output even when STDOUT is not a tty. --csv Output in CSV format. --stat Print rolling stats about server: mem, clients, ... --latency Enter a special mode continuously sampling latency. If you use this mode in an interactive session it runs forever displaying real-time stats. Otherwise if --raw or --csv is specified, or if you redirect the output to a non TTY, it samples the latency for 1 second (you can use -i to change the interval), then produces a single output and exits. --latency-history Like --latency but tracking latency changes over time. Default time interval is 15 sec. Change it using -i. --latency-dist Shows latency as a spectrum, requires xterm 256 colors. Default time interval is 1 sec. Change it using -i. --lru-test <keys> Simulate a cache workload with an 80-20 distribution. --replica Simulate a replica showing commands received from the master. --rdb <filename> Transfer an RDB dump from remote server to local file. --pipe Transfer raw Redis protocol from stdin to server. --pipe-timeout <n> In --pipe mode, abort with error if after sending all data. no reply is received within <n> seconds. Default timeout: 30. Use 0 to wait forever. --bigkeys Sample Redis keys looking for keys with many elements (complexity). --memkeys Sample Redis keys looking for keys consuming a lot of memory. --memkeys-samples <n> Sample Redis keys looking for keys consuming a lot of memory. And define number of key elements to sample --hotkeys Sample Redis keys looking for hot keys. only works when maxmemory-policy is *lfu. --scan List all keys using the SCAN command. --pattern <pat> Useful with --scan to specify a SCAN pattern. --intrinsic-latency <sec> Run a test to measure intrinsic system latency. The test will run for the specified amount of seconds. --eval <file> Send an EVAL command using the Lua script at <file>. --ldb Used with --eval enable the Redis Lua debugger. --ldb-sync-mode Like --ldb but uses the synchronous Lua debugger, in this mode the server is blocked and script changes are not rolled back from the server memory. --cluster <command> [args...] [opts...] Cluster Manager command and arguments (see below). --verbose Verbose mode. --no-auth-warning Don't show warning message when using password on command line interface. --help Output this help and exit. --version Output version and exit. Cluster Manager Commands: Use --cluster help to list all available cluster manager commands. Examples: cat /etc/passwd | redis-cli -x set mypasswd redis-cli get mypasswd redis-cli -r 100 lpush mylist x redis-cli -r 100 -i 1 info | grep used_memory_human: redis-cli --eval myscript.lua key1 key2 , arg1 arg2 arg3 redis-cli --scan --pattern '*:12345*' (Note: when using --eval the comma separates KEYS[] from ARGV[] items) When no command is given, redis-cli starts in interactive mode. Type \"help\" in interactive mode for information on available commands and settings.","title":"1\u3001Configuring Redis using a ConfigMap"}]}